000010 IDENTIFICATION DIVISION.                                         00001001
000020 PROGRAM-ID.    RCKCS221.                                         00002001
000030 AUTHOR.        TOM RUSKA. G&R.                                   00003001
000040 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00004001
000050 DATE-WRITTEN.  02-14-94.                                         00005001
000060 DATE-COMPILED.                                                   00006001
000070                                                                  00007027
000080* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00008020
000090*         I   M   P   O   R   T   A  N  T                       * 00009020
000100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00010020
000110*                                                               * 00011020
000120* THERE WAS AN ISSUE WITH RCKCS221 AFTER PO NUMBER EXPANSION    * 00012020
000130* LOADLIB FOR RCKUT023 WAS FROM 1995 - RECEIVED AZRA WHEN       * 00013020
000140* RCKCS221 WAS RECOMPILED IN 2015                               * 00014020
000150*                                                               * 00015020
000160* CHANGED RCKCS221 TO USE RCKUT151 MODULE INSTEAD RCKUT023      * 00016020
000170* RCKUT151 SHOULD ONLY BE COMPILED AS CICS                      * 00017020
000180* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 00018020
000190*                                                                 00019020
000200                                                                  00020001
000210*---------------------------------------------------------------* 00021001
000220*                                                               * 00022001
000230*    TRANID      - E221                                         * 00023001
000240*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00024001
000250*    DESCRIPTION - ADD/CHANGE RECEIVER INFORMATION              * 00025001
000260*    MAPSET      - RCKM221                                      * 00026001
000270*                                                               * 00027001
000280*    PROVIDES THE ABILITY TO ADD OR UPDATE INFORMATION FOR A    * 00028001
000290*    GIVEN RECEIVER.                                            * 00029001
000300*                                                               * 00030001
000310*    AN 88 LEVEL SWITCH WAS CREATED TO DRIVE THE                * 00031001
000320*    LOGIC WHICH DICTATES WHAT "MODE" THE PROGRAM IS CURRENTLY  * 00032001
000330*    IN. THIS PROGRAM CAN BE IN AN "ADD" OR "UPDATE"            * 00033001
000340*    MODE AT ANY GIVEN TIME.                                    * 00034001
000350*                                                               * 00035001
000360*    ALL "ADD" LOGIC IS CONTAINED IN THE 5000- SERIES           * 00036001
000370*    PARAGRAPHS.                                                * 00037001
000380*                                                               * 00038001
000390*    ALL "UPDATE" LOGIC IS CONTAINED IN THE 6000- SERIES        * 00039001
000400*    PARAGRAPHS.                                                * 00040001
000410*                                                               * 00041001
000420*                                                               * 00042001
000430*    IR-XXX: OPER SET MAY NOT BE CHANGED IF ANY INSTRUCTIONS    * 00043001
000440*            FOR CURRENT OPER SET HAVE BEEN STARTED.            * 00044001
000450*            7/26/94 BY M. FURLICK                              * 00045001
000460*                                                               * 00046001
000470*    WR-28767 REMOVE ARCHIVING OF TRECEIVER SEGMENT REPLACE     * 00047001
000480*             WITH UPDATE. ADD NEW COLUMNS FOR PHYSICAL LOCATION* 00048001
000490*             BY GARDNER     8/26/94                            * 00049001
000500*                                                               * 00050001
000510* DATE 12/01/2011 CHRISTINE TWIEHAUS WR40574                      00051001
000520*      CHANGE MADE: ADDED CAN (CARR-AUT-ID)                       00052019
000530*---------------------------------------------------------------* 00053001
000531* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00053133
000532* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00053234
000533* MAKING THE CALL DYNAMIC VS STATIC.                              00053334
000534*---------------------------------------------------------------* 00053434
000540                                                                  00054001
000550 ENVIRONMENT DIVISION.                                            00055001
000560 DATA DIVISION.                                                   00056001
000570/                                                                 00057001
000580 WORKING-STORAGE SECTION.                                         00058001
000590                                                                  00059001
000600 01  DN-DB2-NULL-INDICATORS.                                      00060001
000610     05  DN-TRIP-ID                   PIC S9(04) COMP VALUE +0.   00061001
000620     05  DN-SHIP-EST-AR-TMST          PIC S9(04) COMP VALUE +0.   00062001
000630     05  DN-VEH-NBR                   PIC S9(04) COMP VALUE +0.   00063001
000640     05  DN-SUBAREA-OF-ID             PIC S9(04) COMP VALUE +0.   00064001
000650     05  DN-TKT-FMT-ID-MAX            PIC S9(04) COMP VALUE +0.   00065001
000660     05  DN-TKT-FMT-ID-MIN            PIC S9(04) COMP VALUE +0.   00066001
000670     05  DN-TKT-DESC                  PIC S9(04) COMP VALUE +0.   00067001
000680     05  DN-AD-EVNT-DTE               PIC S9(04) COMP VALUE +0.   00068001
000690                                                                  00069001
000700 01  DK-DB2-KEYS.                                                 00070001
000710     05  DK-PO-NBR                    PIC S9(09) COMP VALUE +0.   00071001
000720     05  DK-ORD-NBR                   PIC S9(09) COMP VALUE +0.   00072001
000730     05  DK-REC-SEQ-NBR               PIC S9(09) COMP VALUE +0.   00073001
000740     05  DK-TRIP-ID                   PIC S9(09) COMP VALUE +0.   00074001
000750     05  DK-TRIP-ID-B                 PIC S9(09) COMP VALUE +0.   00075001
000760     05  DK-TRIP-ID-E                 PIC S9(09) COMP VALUE +0.   00076001
000770     05  DK-SHIPT-ID                  PIC S9(09) COMP VALUE +0.   00077001
000780     05  DK-OWNER-SCAC-ID             PIC X(04)  VALUE SPACES.    00078001
000790     05  DK-OWNER-SCAC-ID-B           PIC X(04)  VALUE SPACES.    00079001
000800     05  DK-OWNER-SCAC-ID-E           PIC X(04)  VALUE SPACES.    00080001
000810     05  DK-VEH-NBR                   PIC X(10)  VALUE SPACES.    00081001
000820     05  DK-VEH-NBR-B                 PIC X(10)  VALUE SPACES.    00082001
000830     05  DK-VEH-NBR-E                 PIC X(10)  VALUE SPACES.    00083001
000840     05  DK-STATUS-DTE                PIC X(10)  VALUE SPACES.    00084001
000850     05  DK-STATUS-DTE-B              PIC X(10)  VALUE SPACES.    00085001
000860     05  DK-STATUS-DTE-E              PIC X(10)  VALUE SPACES.    00086001
000870     05  DK-PRO-NBR                   PIC X(22)  VALUE SPACES.    00087001
000880     05  DK-BOL-NBR                   PIC X(30)  VALUE SPACES.    00088001
000890     05  DK-PRO-NBR-B                 PIC X(22)  VALUE SPACES.    00089001
000900     05  DK-PRO-NBR-E                 PIC X(22)  VALUE SPACES.    00090001
000910     05  DK-BOL-NBR-B                 PIC X(30)  VALUE SPACES.    00091001
000920     05  DK-BOL-NBR-E                 PIC X(30)  VALUE SPACES.    00092001
000930     05  DK-ENT-ID                    PIC S9(09) COMP VALUE +0.   00093001
000940     05  DK-OPER-UNT-ID               PIC S9(04) COMP VALUE +0.   00094001
000950     05  DK-FCLTY-ID                  PIC S9(04) COMP VALUE +0.   00095001
000960     05  CURR-OPER-UNT-ID             PIC S9(04) COMP VALUE +0.   00096001
000970     05  CURR-FCLTY-ID                PIC S9(04) COMP VALUE +0.   00097001
000980     05  DK-TKT-FMT-ID                PIC X(06)  VALUE SPACES.    00098001
000990     05  DK-TKT-FMT-ID-MIN            PIC X(06)  VALUE SPACES.    00099001
001000     05  DK-TKT-FMT-ID-MAX            PIC X(06)  VALUE SPACES.    00100001
001010     05  DK-TKT-DESC                  PIC X(20)  VALUE SPACES.    00101001
001020     05  DK-TKT-DESC-MIN              PIC X(20)  VALUE SPACES.    00102001
001030     05  DK-TKT-DESC-MAX              PIC X(20)  VALUE SPACES.    00103001
001040     05  DK-DEPT-NBR                  PIC X(03)  VALUE SPACES.    00104001
001050     05  DK-OPER-SET-ID               PIC S9(04) COMP VALUE +0.   00105001
001060     05  DK-AGRMT-TYP-ID              PIC X(01)  VALUE SPACES.    00106001
001070     05  DK-TYP-CDE                   PIC S9(04) COMP VALUE +0.   00107001
001080     05  DK-LOCATION-NBR              PIC 9(04)  VALUE ZERO.      00108001
001090     05  DK-RCVR-NBR                  PIC S9(09) COMP VALUE +0.   00109001
001100     05  DK-SUBCLASS-NBR              PIC X(03) VALUE SPACE.      00110001
001110     05  DK-MAJCLASS-NBR              PIC X(02) VALUE SPACE.      00111001
001120     05  DK-CHARTC-SEQ-NBR            PIC S9(4) COMP VALUE +0.    00112001
001130     05  DK-TKT-TYP-SEQ-NBR           PIC S9(4) COMP VALUE +0.    00113001
001140     05  DK-MDSEAR-ID                 PIC S9(9) COMP VALUE +0.    00114001
001150                                                                  00115001
001160 01  PC-PROGRAM-CONSTANTS.                                        00116001
001170     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'RCKCS221'.  00117022
001180     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'RC221A  '.  00118001
001190     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'RCKM221 '.  00119001
001200     05  PC-RANDNBR-PGM           PIC  X(08)  VALUE  'DPKUT902'.  00120001
001210     05  PC-TROUBLE-RTN           PIC X(08)   VALUE  'TMKCS520'.  00121001
001220     05  PC-TROUBLE-RTN-LENGTH    PIC S9(04)  VALUE +600 COMP.    00122001
001230     05  PC-AUDIT-RTN             PIC  X(08)  VALUE 'RCKCS290'.   00123001
001240     05  PC-AUDIT-RTN-LENGTH      PIC S9(04)  VALUE +300 COMP.    00124001
001250     05  PC-RCKCS807              PIC X(08)   VALUE 'RCKCS807'.   00125001
001260     05  PC-LOCATION-MODULE       PIC X(08)   VALUE 'XLKUT071'.   00126001
001270     05  PC-CORPORATE             PIC 9(4)    VALUE 90.           00127001
001280     05  PC-600                   PIC S9(04)  VALUE +600 COMP.    00128001
001290     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1 COMP.     00129001
001300     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3 COMP.     00130001
001310     05  PC-MAX-RETRY-TSHIPMT-ADD PIC S9(04)  VALUE  +50 COMP.    00131001
001320     05  PC-ZERO                  PIC S9(04)  VALUE  +0 COMP.     00132001
001330     05  PC-CURRENT-DATE          PIC X(10) VALUE SPACE.          00133001
001340     05  PC-VALID-VND-DT-RANGE    PIC 9(05)   VALUE 7.            00134001
001350     05  PC-I                     PIC  X(01)  VALUE  'I'.         00135001
001360     05  PC-A                     PIC  X(01)  VALUE  'A'.         00136001
001370     05  PC-N                     PIC  X(01)  VALUE  'N'.         00137001
001380     05  PC-U                     PIC  X(01)  VALUE  'U'.         00138001
001390     05  PC-B                     PIC  X(01)  VALUE  'B'.         00139001
001400     05  PC-C                     PIC  X(01)  VALUE  'C'.         00140001
001410     05  PC-M                     PIC  X(01)  VALUE  'M'.         00141001
001420     05  PC-S                     PIC  X(01)  VALUE  'S'.         00142001
001430     05  PC-CM                    PIC  X(02)  VALUE  'CM'.        00143001
001440     05  PC-VS-TICKET-TYPE-CDE       PIC S9(04) COMP              00144001
001450                                                VALUE +2.         00145001
001460     05  PC-INNER-PPK             PIC  X(13) VALUE                00146001
001470                                              'INNER PREPACK'.    00147001
001480     05  PC-MULTI-SKU             PIC  X(12) VALUE                00148001
001490                                              'MULTIPLE SKU'.     00149001
001500     05  PC-SINGLE-SKU            PIC  X(10) VALUE                00150001
001510                                              'SINGLE SKU'.       00151001
001520     05  PC-CASEPACK              PIC  X(08) VALUE                00152001
001530                                              'CASEPACK'.         00153001
001540     05  PC-BULK-PACK             PIC  X(09) VALUE                00154001
001550                                              'BULK PACK'.        00155001
001560     05  PC-NOT-FOUND             PIC  X(09) VALUE                00156001
001570                                              'NOT FOUND'.        00157001
001580     05  PC-INTER-APPL-CODES.                                     00158001
001590         10  PC-INTER-APPL-MENU   PIC  X(01)  VALUE  ' '.         00159001
001600         10  PC-INTER-APPL-ADD    PIC  X(01)  VALUE  '2'.         00160001
001610         10  PC-INTER-APPL-LIST-ADD                               00161001
001620                                  PIC  X(01)  VALUE  '3'.         00162001
001630         10  PC-INTER-APPL-LIST-UPDATE                            00163001
001640                                  PIC  X(01)  VALUE  '4'.         00164001
001650         10  PC-INTER-APPL-UPDATE PIC  X(01)  VALUE  '5'.         00165001
001660         10  PC-INTER-APPL-SHPPO-ADD                              00166001
001670                                  PIC  X(01)  VALUE  '6'.         00167001
001680*        10  PC-INTER-APPL-MULT-ADD                               00168001
001690*                                 PIC  X(01)  VALUE  '7'.         00169001
001700         10  PC-INTER-APPL-RCVR-LIST-ADD                          00170001
001710                                  PIC  X(01)  VALUE  '8'.         00171001
001720         10  PC-INTER-APPL-RCVR-SHP-LIST                          00172001
001730                                  PIC  X(01)  VALUE  '9'.         00173001
001740         10  PC-INTER-APPL-RCVR-PO-LIST                           00174001
001750                                  PIC  X(01)  VALUE  'A'.         00175001
001760     05  PC-DEFAULT-DATE          PIC X(10)   VALUE               00176001
001770                                  '0001-01-01'.                   00177001
001780     05  PC-DEFAULT-9DATE         PIC X(10)   VALUE               00178001
001790                                  '9999-09-09'.                   00179001
001800     05  PC-DEFAULT-TIME          PIC X(08)   VALUE               00180001
001810                                  '00.00.00'.                     00181001
001820     05  PC-SUBCLASS-MDSELV-CDE   PIC X(03) VALUE 'SCL'.          00182001
001830     05  PC-MAJCLASS-MDSELV-CDE   PIC X(03) VALUE 'MCL'.          00183001
001840     05  PC-DPT-MDSELV-CDE        PIC X(03) VALUE 'DPT'.          00184001
001850                                                                  00185001
001860     05  PC-TSYMSG-NUMBERS.                                       00186001
001870         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.       00187001
001880         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00188001
001890         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00189001
001900         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00190001
001910         10  PC-TSYMSG-00009      PIC  9(05)  VALUE  00009.       00191001
001920         10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       00192001
001930         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00193001
001940         10  PC-TSYMSG-00045      PIC  9(05)  VALUE  00045.       00194001
001950         10  PC-TSYMSG-00046      PIC  9(05)  VALUE  00046.       00195001
001960         10  PC-TSYMSG-00047      PIC  9(05)  VALUE  00047.       00196001
001970         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       00197001
001980         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       00198001
001990         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       00199001
002000         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00200001
002010         10  PC-TSYMSG-00083      PIC  9(05)  VALUE  00083.       00201001
002020         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       00202001
002030         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       00203001
002040         10  PC-TSYMSG-00116      PIC  9(05)  VALUE  00116.       00204001
002050         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.       00205001
002060         10  PC-TSYMSG-00122      PIC  9(05)  VALUE  00122.       00206001
002070         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       00207001
002080         10  PC-TSYMSG-00224      PIC  9(05)  VALUE  00224.       00208001
002090         10  PC-TSYMSG-00268      PIC  9(05)  VALUE  00268.       00209001
002100         10  PC-TSYMSG-00316      PIC  9(05)  VALUE  00316.       00210001
002110         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       00211001
002120         10  PC-TSYMSG-00308      PIC  9(05)  VALUE  00308.       00212001
002130         10  PC-TSYMSG-00354      PIC  9(05)  VALUE  00354.       00213001
002140         10  PC-TSYMSG-00391      PIC  9(05)  VALUE  00391.       00214001
002150         10  PC-TSYMSG-00392      PIC  9(05)  VALUE  00392.       00215001
002160         10  PC-TSYMSG-00461      PIC  9(05)  VALUE  00461.       00216001
002170         10  PC-TSYMSG-00462      PIC  9(05)  VALUE  00462.       00217001
002180         10  PC-TSYMSG-00463      PIC  9(05)  VALUE  00463.       00218001
002190         10  PC-TSYMSG-00464      PIC  9(05)  VALUE  00464.       00219001
002200         10  PC-TSYMSG-00465      PIC  9(05)  VALUE  00465.       00220001
002210         10  PC-TSYMSG-00466      PIC  9(05)  VALUE  00466.       00221001
002220         10  PC-TSYMSG-00737      PIC  9(05)  VALUE  00737.       00222001
002230         10  PC-TSYMSG-00742      PIC  9(05)  VALUE  00742.       00223001
002240         10  PC-TSYMSG-00743      PIC  9(05)  VALUE  00743.       00224001
002250         10  PC-TSYMSG-00772      PIC  9(05)  VALUE  00772.       00225001
002260         10  PC-TSYMSG-00815      PIC  9(05)  VALUE  00815.       00226001
002270         10  PC-TSYMSG-00847      PIC  9(05)  VALUE  00847.       00227001
002280         10  PC-TSYMSG-00937      PIC  9(05)  VALUE  00937.       00228001
002290         10  PC-TSYMSG-00954      PIC  9(05)  VALUE  00954.       00229001
002300         10  PC-TSYMSG-00955      PIC  9(05)  VALUE  00955.       00230001
002310         10  PC-TSYMSG-00984      PIC  9(05)  VALUE  00984.       00231001
002320         10  PC-TSYMSG-00987      PIC  9(05)  VALUE  00987.       00232001
002330         10  PC-TSYMSG-00993      PIC  9(05)  VALUE  00993.       00233001
002340         10  PC-TSYMSG-01019      PIC  9(05)  VALUE  01019.       00234001
002350         10  PC-TSYMSG-01065      PIC  9(05)  VALUE  01065.       00235001
002360         10  PC-TSYMSG-01067      PIC  9(05)  VALUE  01067.       00236001
002370         10  PC-TSYMSG-01090      PIC  9(05)  VALUE  01090.       00237001
002380         10  PC-TSYMSG-01807      PIC  9(05)  VALUE  01807.       00238001
002390** 1838 - DATE OUTSIDE RECOMMENDED RANGE - PRESS F2 TO CONFIRM    00239001
002400         10  PC-TSYMSG-01838      PIC  9(05)  VALUE  01838.       00240001
002410         10  PC-TSYMSG-02153      PIC  9(05)  VALUE  02153.       00241001
002420         10  PC-TSYMSG-02154      PIC  9(05)  VALUE  02154.       00242001
002430         10  PC-TSYMSG-02155      PIC  9(05)  VALUE  02155.       00243001
002440         10  PC-TSYMSG-02158      PIC  9(05)  VALUE  02158.       00244001
002450         10  PC-TSYMSG-02159      PIC  9(05)  VALUE  02159.       00245001
002460         10  PC-TSYMSG-02160      PIC  9(05)  VALUE  02160.       00246001
002470         10  PC-TSYMSG-02161      PIC  9(05)  VALUE  02161.       00247001
002480         10  PC-TSYMSG-02162      PIC  9(05)  VALUE  02162.       00248001
002490         10  PC-TSYMSG-02456      PIC  9(05)  VALUE  02456.       00249001
002500         10  PC-TSYMSG-02476      PIC  9(05)  VALUE  02476.       00250001
002510* * *  SHIPMENT ID EXISTS TRY AGAIN!                              00251001
002520         10  PC-TSYMSG-02841      PIC  9(05)  VALUE  02841.       00252001
002530* * *  SHIPMENT EXISTS, CANNOT ADD!                               00253001
002540         10  PC-TSYMSG-02842      PIC  9(05)  VALUE  02842.       00254001
002550* * *  INVALID RCVR TYPE CODE                                     00255001
002560         10  PC-TSYMSG-03165      PIC  9(05)  VALUE  03165.       00256001
002570         10  PC-TSYMSG-03230      PIC  9(05)  VALUE  03230.       00257001
002580* * *  EFC RECEIVER, PACKAGING CODE MUST BE BULK                  00258001
002590         10  PC-TSYMSG-03329      PIC  9(05)  VALUE  03329.       00259001
002600* * *    UNABLE TO UPDATE CURR OPER - CARTONS HAVE BEEN MANIFESTED00260001
002610*        TO RECEIVER                                              00261001
002620         10  PC-TSYMSG-03338      PIC  9(05)  VALUE  03338.       00262001
002630* * UNABLE TO UPDATE RCVR TYPE - CASEPACK SPLIT HAS BEEN PERFORMED00263001
002640         10  PC-TSYMSG-03341      PIC  9(05)  VALUE  03341.       00264001
002650* * UNABLE TO UPDATE RCVR TYPE - CARTONS HAVE BEEN CHECKED-IN     00265001
002660         10  PC-TSYMSG-03345      PIC  9(05)  VALUE  03345.       00266001
002670* * UNABLE TO CREATE A RECEIVER FOR A CUSTOMER DIRECT PO          00267001
002680         10  PC-TSYMSG-03405      PIC  9(05)  VALUE  03405.       00268001
002690* * UNABLE TO CHANGE CURR LOC - CURR LOC IS A WMS DC.             00269001
002700         10  PC-TSYMSG-03582      PIC  9(05)  VALUE  03582.       00270001
002710* * UNABLE TO CHANGE CURR LOC - NEW CURR LOC TURNED ON FOR WMS.   00271001
002720         10  PC-TSYMSG-03583      PIC  9(05)  VALUE  03583.       00272001
002730* JAK 08/2007 -ADD MSG 3589                                       00273001
002740* * UNABLE TO UPDATE CURR OPER UNTIL PKSLIP ARE INACTIVATED.      00274001
002750         10  PC-TSYMSG-03589      PIC  9(05)  VALUE  03589.       00275001
002760* * PACK TYPE CAN'T BE CHANGED UNTIL CARTONS ARE RECLAIMED        00276001
002770         10  PC-TSYMSG-03655      PIC  9(05)  VALUE  03655.       00277001
002780                                                                  00278001
002790 01  PS-PROGRAM-SWITCHES.                                         00279001
002800     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00280001
002810         88  PS-ERROR                         VALUE  'Y'.         00281001
002820         88  PS-NO-ERROR                      VALUE  'N'.         00282001
002830     05  PS-COMMAREA-SW           PIC  X(01)  VALUE 'N'.          00283001
002840         88  PS-COMMAREA-VALID                VALUE 'Y'.          00284001
002850         88  PS-COMMAREA-NOT-VALID            VALUE 'N'.          00285001
002860     05  PS-LIST-END-SW           PIC X(01)   VALUE 'N'.          00286001
002870         88  PS-LIST-END                      VALUE 'Y'.          00287001
002880         88  PS-NO-LIST-END                   VALUE 'N'.          00288001
002890     05  PS-TOSOPFA-CURSOR-SW     PIC  X(01)  VALUE 'N'.          00289001
002900         88  PS-EOF-TOSOPFA-CSR               VALUE 'Y'.          00290001
002910     05  PS-TRECVER-CURSOR-SW     PIC  X(01)  VALUE 'N'.          00291001
002920         88  PS-EOF-TRECVER-CSR               VALUE 'Y'.          00292001
002930     05  PS-INSTRUCTION-SW        PIC  X(01)  VALUE 'N'.          00293001
002940         88  PS-FIRST-INSTRUCTION             VALUE 'Y'.          00294001
002950     05  PS-TRIP-EXISTS-SW        PIC  X(01)  VALUE 'N'.          00295001
002960         88  PS-TRIP-EXISTS                   VALUE 'Y'.          00296001
002970         88  PS-TRIP-DOESNT-EXIST             VALUE 'N'.          00297001
002980     05  PS-RCVR-FOUND-SW         PIC  X(01)  VALUE 'N'.          00298001
002990         88  PS-RCVR-FOUND                    VALUE 'Y'.          00299001
003000         88  PS-NO-RCVR-FOUND                 VALUE 'N'.          00300001
003010     05  PS-INFO-MSG-FND-SW       PIC  X(01)  VALUE 'N'.          00301001
003020         88  PS-INFO-MSG-FND                  VALUE 'Y'.          00302001
003030         88  PS-INFO-MSG-NOTFND               VALUE 'N'.          00303001
003040     05  PS-CITM-FOUND-SW         PIC  X(01)  VALUE 'N'.          00304001
003050         88  PS-CITM-FOUND                    VALUE 'Y'.          00305001
003060         88  PS-NO-CITM-FOUND                 VALUE 'N'.          00306001
003070     05  PS-PRETIC-FOUND-SW       PIC  X(01)  VALUE 'N'.          00307001
003080         88  PS-PRETIC-FOUND                  VALUE 'Y'.          00308001
003090         88  PS-NO-PRETIC-FOUND               VALUE 'N'.          00309001
003100     05  PS-VSM-SW                PIC X       VALUE 'N'.          00310001
003110         88  PS-NOT-VSM                       VALUE 'N'.          00311001
003120         88  PS-VSM                           VALUE 'Y'.          00312001
003130     05  PS-VALID-VND-DT-RANGE-SW PIC X       VALUE 'Y'.          00313001
003140         88  PS-VALID-VND-DT-RANGE            VALUE 'Y'.          00314001
003150         88  PS-INVALID-VND-DT-RANGE          VALUE 'N'.          00315001
003160     05  PS-VEND-DT-FMT-SW        PIC X       VALUE 'N'.          00316001
003170         88  PS-VEND-DT-FMT                   VALUE 'Y'.          00317001
003180         88  PS-VEND-DT-NOT-FMT               VALUE 'N'.          00318001
003190     05  PS-VALID-LOC-SW          PIC  X(01)  VALUE 'N'.          00319001
003200         88  PS-VALID-LOC                     VALUE 'Y'.          00320001
003210         88  PS-INVALID-LOC                   VALUE 'N'.          00321001
003220     05  PS-SOFT-ABORT-ERROR-SW   PIC  X(01)  VALUE  'N'.         00322001
003230         88  PS-SOFT-ABORT-ERROR              VALUE  'Y'.         00323001
003240         88  PS-NO-SOFT-ABORT-ERROR           VALUE  'N'.         00324001
003250     05  PS-CALL-API-SW           PIC  X    VALUE 'N'.            00325001
003260         88  PS-CALL-API-NO                 VALUE 'N'.            00326001
003270         88  PS-CALL-API-YES                VALUE 'Y'.            00327001
003280     05  PS-MANIFEST-CTN-SW       PIC  X    VALUE 'N'.            00328001
003290         88  PS-MANIFEST-CTN-NO             VALUE 'N'.            00329001
003300         88  PS-MANIFEST-CTN-YES            VALUE 'Y'.            00330001
003310     05  PS-ASNS-TO-WMS-SW        PIC X(01) VALUE 'N'.            00331001
003320         88  PS-ASNS-TO-WMS-YES             VALUE 'Y'.            00332001
003330         88  PS-ASNS-TO-WMS-NO              VALUE 'N'.            00333001
003340* JAK 08/2007 - ADD RECITM SWITCH                                 00334001
003350     05  PS-RECITM-FOUND-SW       PIC X(01) VALUE 'N'.            00335001
003360         88  PS-RECITM-FOUND-YES            VALUE 'Y'.            00336001
003370         88  PS-RECITM-FOUND-NO             VALUE 'N'.            00337001
003380                                                                  00338001
003390                                                                  00339001
003400 01  PV-EIBTRMID-BREAKDOWN.                                       00340001
003410     05  PV-EIBTRMID12            PIC XX      VALUE SPACES.       00341001
003420     05  PV-EIBTRMID34            PIC XX      VALUE SPACES.       00342001
003430                                                                  00343001
003440 01  PV-PROGRAM-VARIABLES.                                        00344001
003450     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00345001
003460                                              COMP SYNC.          00346001
003470     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00347001
003480                                              COMP SYNC.          00348001
003490     05  PV-DB2-COUNT             PIC S9(09)  VALUE +0            00349001
003500                                              COMP-3.             00350001
003510     05  PV-COUNT                 PIC S9(09)  VALUE +0            00351001
003520                                              COMP-3.             00352001
003530     05  PV-LINE-COUNT            PIC S9(09)  VALUE +0            00353001
003540                                              COMP-3.             00354001
003550     05  PV-TKT-COUNT             PIC S9(09)  VALUE +0            00355001
003560                                              COMP-3.             00356001
003570     05  PV-COPER-UNT-ID          PIC S9(04) COMP VALUE +0.       00357001
003580     05  PV-TRN-CDE               PIC X VALUE SPACE.              00358001
003590     05  PV-REC-SEQ-NBR           PIC S9(09) COMP VALUE +0.       00359001
003600*    05  PV-ABSTIME               PIC S9(15)  COMP.               00360001
003610*    05  PV-CURRENT-TIME          PIC  9(06).                     00361001
003620*    05  PV-CURRENT-DATE          PIC  9(06).                     00362001
003630     05  PV-DB2-CURRENT-DATE      PIC  X(10).                     00363001
003640     05  PV-DB2-CURRENT-DATE-M7DD PIC  X(10).                     00364001
003650     05  PV-DB2-DATE              PIC  X(10).                     00365001
003660     05  FILLER  REDEFINES PV-DB2-DATE.                           00366001
003670         10  PV-DB2-DATE-CC       PIC  X(02).                     00367001
003680         10  PV-DB2-DATE-YY       PIC  X(02).                     00368001
003690         10  PV-DB2-DASH-1        PIC  X(01).                     00369001
003700         10  PV-DB2-DATE-MM       PIC  X(02).                     00370001
003710         10  PV-DB2-DASH-2        PIC  X(01).                     00371001
003720         10  PV-DB2-DATE-DD       PIC  X(02).                     00372001
003730     05  PV-DISP-SHIPT-ID         PIC  Z(9).                      00373021
003740     05  PV-DISPLAY-DATE.                                         00374021
003750         10  PV-DISPLAY-DATE-MM   PIC  X(02).                     00375001
003760         10  FILLER               PIC  X(01) VALUE '/'.           00376001
003770         10  PV-DISPLAY-DATE-DD   PIC  X(02).                     00377001
003780         10  FILLER               PIC  X(01) VALUE '/'.           00378001
003790         10  PV-DISPLAY-DATE-YY   PIC  X(02).                     00379001
003800     05  PV-DISPLAY-PARAGRAPH     PIC  X(30) VALUE SPACES.        00380014
003810     05  PV-DISPLAY-SQLCODE2      PIC +9(09).                     00381016
003820     05  PV-DAY-OF-WEEK-NMBR      PIC S9(08)  VALUE +0            00382001
003830                                              COMP SYNC.          00383001
003840     05  PV-DB2-HOST-TIMESTAMP    PIC X(26).                      00384001
003850     05  PV-DB2-TIMESTAMP         PIC X(26).                      00385001
003860     05  FILLER  REDEFINES PV-DB2-TIMESTAMP.                      00386001
003870         10  PV-DB2-TMST-CC       PIC X(02).                      00387001
003880         10  PV-DB2-TMST-YY       PIC X(02).                      00388001
003890         10  FILLER               PIC X(01).                      00389001
003900         10  PV-DB2-TMST-MM       PIC X(02).                      00390001
003910         10  FILLER               PIC X(01).                      00391001
003920         10  PV-DB2-TMST-DD       PIC X(02).                      00392001
003930         10  FILLER               PIC X(01).                      00393001
003940         10  PV-DB2-TMST-TIME     PIC X(15).                      00394001
003950                                                                  00395001
003960     05  PV-FCLTY-AREA-ID         PIC X(6)    VALUE SPACES.       00396001
003970     05  PV-TKT-FMT-ID            PIC X(6)    VALUE SPACES.       00397001
003980     05  PV-TKT-DESC              PIC X(20)   VALUE SPACES.       00398001
003990     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        00399001
004000                                                COMP SYNC.        00400001
004010                                                                  00401001
004020     05  PV-ARRIVAL-DTE-YMD       PIC 9(8)    VALUE ZEROES.       00402001
004030     05  PV-MAP-RECEIPT-TIME      PIC 9(4)    VALUE ZEROS.        00403001
004040     05  PV-OWNR-SCAC-SHIP-DTE-YMD PIC 9(8) VALUE ZERO.           00404001
004050                                                                  00405001
004060     05  PV-PROC-AREA             PIC X(6)    VALUE SPACES.       00406001
004070     05  PV-TICKET-TYP            PIC X(6)    VALUE SPACES.       00407001
004080     05  PV-TRIP-ID-DISPLAY       PIC 9(9)    VALUE ZERO.         00408001
004090     05  PV-CURR-DAY-OF-WEEK      PIC X(3)    VALUE SPACES.       00409001
004100     05  PV-CURR-DATE-PLUS-3      PIC 9(8)    VALUE ZERO.         00410001
004110     05  PV-CURR-DATE-MINUS-366   PIC 9(8)    VALUE ZERO.         00411001
004120     05  PV-DB2-HOLD-DATE         PIC  X(10).                     00412001
004130     05  FILLER  REDEFINES PV-DB2-HOLD-DATE.                      00413001
004140         10  PV-DB2-HOLD-DATE-CC  PIC  X(02).                     00414001
004150         10  PV-DB2-HOLD-DATE-YY  PIC  X(02).                     00415001
004160         10  PV-DB2-HOLD-DASH-1   PIC  X(01).                     00416001
004170         10  PV-DB2-HOLD-DATE-MM  PIC  X(02).                     00417001
004180         10  PV-DB2-HOLD-DASH-2   PIC  X(01).                     00418001
004190         10  PV-DB2-HOLD-DATE-DD  PIC  X(02).                     00419001
004200     05  PV-VEND-SHIP-DATE.                                       00420001
004210         10  PV-VEND-SHIP-DATE-CCYY PIC X(04).                    00421001
004220         10  FILLER               PIC  X(01)  VALUE '-'.          00422001
004230         10  PV-VEND-SHIP-DATE-MM PIC  X(02).                     00423001
004240         10  FILLER               PIC  X(01)  VALUE '-'.          00424001
004250         10  PV-VEND-SHIP-DATE-DD PIC  X(02).                     00425001
004260     05  PV-GREG-FMT-DTE.                                         00426001
004270         10  PV-GREG-FMT-MM       PIC  X(02).                     00427001
004280         10  FILLER               PIC  X(01) VALUE '/'.           00428001
004290         10  PV-GREG-FMT-DD       PIC  X(02).                     00429001
004300         10  FILLER               PIC  X(01) VALUE '/'.           00430001
004310         10  PV-GREG-FMT-YY       PIC  X(02).                     00431001
004320     05  PV-GREG-DTE.                                             00432001
004330         10  PV-GREG-MM           PIC  X(02).                     00433001
004340         10  PV-GREG-DD           PIC  X(02).                     00434001
004350         10  PV-GREG-YY           PIC  X(02).                     00435001
004360         10  FILLER               PIC  X(02)  VALUE SPACES.       00436001
004370     05  PV-COMMAREA-LENGTH       PIC S9(04)  VALUE +0 COMP.      00437001
004380     05  PV-PO-NBR                PIC S9(09)  VALUE +0 COMP.      00438001
004390     05  PV-WO-INSTR-SEQ-NBR      PIC S9(04)  VALUE +0 COMP.      00439001
004400     05  PV-DISPLAY-LOCATION.                                     00440001
004410         10  PV-DISPLAY-OPER-ID         PIC X(04).                00441001
004420         10  FILLER                     PIC X(01) VALUE '-'.      00442001
004430         10  PV-DISPLAY-FCLTY-ID        PIC X(04).                00443001
004440     05  PV-MESSAGE.                                              00444001
004450         10  PV-MESSAGE1                PIC X(10).                00445001
004460         10  PV-FILLER                  PIC X(01).                00446001
004470         10  PV-MESSAGE2                PIC X(10).                00447001
004480         10  PV-FILLER                  PIC X(01).                00448001
004490         10  PV-MESSAGE3                PIC X(10).                00449001
004500     05  PV-DISPLAY-VEHICLE.                                      00450001
004510         10  PV-DISPLAY-SCAC-ID   PIC X(04).                      00451001
004520         10  FILLER               PIC X(02).                      00452001
004530         10  PV-DISPLAY-VEH-NBR   PIC X(10).                      00453001
004540                                                                  00454001
004550     05  PV-DAYS-OF-WEEK-TABLE.                                   00455001
004560         10  FILLER               PIC X(03)   VALUE 'MON'.        00456001
004570         10  FILLER               PIC X(03)   VALUE 'TUE'.        00457001
004580         10  FILLER               PIC X(03)   VALUE 'WED'.        00458001
004590         10  FILLER               PIC X(03)   VALUE 'THU'.        00459001
004600         10  FILLER               PIC X(03)   VALUE 'FRI'.        00460001
004610         10  FILLER               PIC X(03)   VALUE 'SAT'.        00461001
004620                                                                  00462001
004630     05  PV-DAYS-OF-WEEK-ENTRIES  REDEFINES                       00463001
004640         PV-DAYS-OF-WEEK-TABLE    OCCURS 6 TIMES.                 00464001
004650         10  PV-DAY-OF-THE-WEEK   PIC X(03).                      00465001
004660                                                                  00466001
004670     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 00467001
004680     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 00468001
004690     05  PV-CICS-MSG-HOLD.                                        00469001
004700         10  FILLER                      PIC  X(01)  VALUE SPACE. 00470001
004710         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 00471001
004720     05  PV-CICS-MSG-HOLD2.                                       00472001
004730         10  FILLER                      PIC  X(01)  VALUE SPACE. 00473001
004740         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 00474001
004750     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00475001
004760                                                    COMP SYNC.    00476001
004770                                                                  00477001
004780     05  PV-DISPLAY-RCVR                PIC  9(9).                00478001
004790     05  PV-DISPLAY-COUNT               PIC  9(9).                00479001
004800     05  PV-DISPLAY-SQLCODE             PIC  9(9).                00480001
004810                                                                  00481001
004820     05  PV-RECEIV-KEY-MSG.                                       00482001
004830         10  FILLER               PIC X(07)   VALUE ' KEY = '.    00483001
004840         10  PVT-OPER             PIC 9(04).                      00484001
004850         10  FILLER               PIC X(03)   VALUE ' - '.        00485001
004860         10  PVT-FCLTY            PIC 9(04).                      00486001
004870         10  FILLER               PIC X(03)   VALUE ' - '.        00487001
004880         10  PVT-PO               PIC 9(09).                      00488001
004890         10  FILLER               PIC X(03)   VALUE ' - '.        00489001
004900         10  PVT-SEQ              PIC 9(09).                      00490001
004910     05  PV-SYSTEM-ID.                                            00491001
004920         10  FILLER                     PIC  X(04)  VALUE SPACE.  00492001
004930         10  PV-REGION-IND              PIC  X(01).               00493001
004940             88  PV-TEST-CICS                 VALUE 'T'.          00494001
004950             88  PV-QA-CICS                   VALUE 'Q'.          00495001
004960             88  PV-PROD-CICS                 VALUE 'P'.          00496001
004970             88  PV-LEARN-CICS                VALUE 'L'.          00497001
004980         10  FILLER                     PIC X(01)    VALUE SPACES.00498001
004990     05  PV-SUBCLASS-NBR.                                         00499001
005000         10  FILLER                   PIC X(01) VALUE '0'.        00500001
005010         10  PV-SUBCLASS.                                         00501001
005020             15  PV-SUBCLASS-MAJ-NBR   PIC X(01).                 00502001
005030             15  PV-SUBCLASS-MIN-NBR  PIC X(01).                  00503001
005040     05  PV-MAJCLASS-NBR.                                         00504001
005050         10  PV-MAJCLASS-MAJ-NBR      PIC X(01).                  00505001
005060         10  FILLER                   PIC X(01) VALUE '0'.        00506001
005070     05  PV-TEMP-FIELDS.                                          00507001
005080** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  00508004
005090         10  PV-TEMP-PO-NBR           PIC 9(08).                  00509004
005100         10  PV-TEMP-OPER-UNT         PIC 9(04).                  00510001
005110         10  PV-TEMP-FCLTY            PIC 9(04).                  00511001
005120         10  PV-TEMP-OPER-SET         PIC 9(03).                  00512001
005130                                                                  00513001
005140     05  PV-TRLR-ERROR-MSG.                                       00514001
005150         10  FILLER                   PIC X(4) VALUE 'PO= '.      00515001
005160         10  PV-TRLR-ERROR-PO         PIC Z(8)9.                  00516001
005170         10  FILLER                   PIC X(6) VALUE ' RCVR='.    00517001
005180         10  PV-TRLR-ERROR-SEQ        PIC Z(8)9.                  00518001
005190         10  FILLER                   PIC X(6) VALUE ' OPER='.    00519001
005200         10  PV-TRLR-ERROR-OPER-UNT-ID PIC Z(3)9.                 00520001
005210         10  FILLER                   PIC X(6) VALUE ' SCAC='.    00521001
005220         10  PV-TRLR-ERROR-SCAC       PIC X(04).                  00522001
005230         10  FILLER                   PIC X(6) VALUE ' TRLR='.    00523001
005240         10  PV-TRLR-ERROR-TRLR       PIC X(10).                  00524001
005250                                                                  00525001
005260**  AHP - BEGIN - 04/07/08                                        00526001
005270     05  PV-OPER-UNT-ID               PIC S9(4) VALUE +0 COMP.    00527001
005280     05  PV-CURR-OPER-UNT-ID          PIC S9(4) VALUE +0 COMP.    00528001
005290**  AHP - END   - 04/07/08                                        00529001
005291                                                                  00529135
005292     05  PV-DISP-OPER                 PIC ZZZ9.                   00529235
005293     05  PV-DISP-PO                   PIC 9(09).                  00529335
005294     05  PV-DISP-RCVR                 PIC 9(04).                  00529435
005300                                                                  00530001
005310 01  WA-WORK-AREA.                                                00531001
005320     05  WS-MAX-RCVR-NBR      PIC 9(09)  VALUE ZERO.              00532001
005330     05  WS-KEYREC-WORK.                                          00533001
005340         10 WS-FIRST-7-DIG    PIC 9(07)  VALUE ZERO.              00534001
005350         10 WS-CHECK-DIGIT    PIC 9(01)  VALUE ZERO.              00535001
005360     05  WS-KEYREC-QUOTIENT   PIC S9(07) COMP-3                   00536001
005370                                         VALUE ZERO.              00537001
005380     05  WS-KEYREC-REMAINDER  PIC S9(01) COMP-3                   00538001
005390                                         VALUE ZERO.              00539001
005400     05  WS-KEYREC-SUM        PIC S9(07) COMP-3                   00540001
005410                                         VALUE ZERO.              00541001
005420 01  PW-PROGRAM-WORKAREA.                                         00542001
005430     05  PW-CONTROL-REC.                                          00543001
005440         10  PW-CONTROL-KEYREC.                                   00544001
005450             20  PW-CONTROL-PANL-NBR.                             00545001
005460                 30  PW-CONTROL-PANEL    PIC 9(05)  VALUE ZERO.   00546001
005470                 30  PW-CONTROL-KEYREC-NBR                        00547001
005480                                         PIC 9(02)  VALUE ZERO.   00548001
005490             20  PW-CONTROL-PANL-NBR-9 REDEFINES                  00549001
005500                                       PW-CONTROL-PANL-NBR        00550001
005510                                         PIC 9(7).                00551001
005520             20  PW-CONTROL-CEHCK-DIG    PIC 9(01)  VALUE ZERO.   00552001
005530         10  PW-CONTROL-KEYREC-9 REDEFINES PW-CONTROL-KEYREC      00553001
005540                                         PIC 9(08).               00554001
005550         10  PW-CONTROL-FILLER           PIC X(73)  VALUE SPACE.  00555001
005560                                                                  00556001
005570     05  PW-SAVE-PANEL-NBR               PIC X(7)   VALUE SPACES. 00557001
005580                                                                  00558001
005590     05  PW-QUOTIENT                     PIC S9(7)  VALUE ZERO.   00559001
005600     05  PW-REMAINDER                    PIC S9     VALUE ZERO.   00560001
005610/                                                                 00561001
005620*----------------------------------------------------------------*00562001
005630*    MAP LAYOUT                                                  *00563001
005640*----------------------------------------------------------------*00564001
005650     COPY RCKM221.                                                00565001
005660                                                                  00566001
005670     COPY RCWS031.                                                00567001
005680                                                                  00568001
005690/                                                                 00569001
005700*    AUTO-VE MODULE RCKUT127                                      00570001
005710     COPY RCWS040.                                                00571001
005720/                                                                 00572001
005730*----------------------------------------------------------------*00573001
005740*  WORK AREA PASSED IN CALL TO DPKUT500                          *00574001
005750*----------------------------------------------------------------*00575001
005760     COPY DPWS500.                                                00576001
005770                                                                  00577001
005780*----------------------------------------------------------------*00578001
005790*  WORK AREA PASSED IN CALL TO DPKUT100                          *00579001
005800*----------------------------------------------------------------*00580001
005810     COPY DPWS010I.                                               00581001
005820                                                                  00582001
005830*----------------------------------------------------------------*00583001
005840**  SECURITY SUBROUTINE PARAMETERS                                00584001
005850*----------------------------------------------------------------*00585001
005860     COPY DPWS008.                                                00586001
005870                                                                  00587001
005880*----------------------------------------------------------------*00588001
005890*    ATTRIBUTE SETTINGS COPYBOOK.                                *00589001
005900*----------------------------------------------------------------*00590001
005910     COPY DPWS015.                                                00591001
005920                                                                  00592001
005930*----------------------------------------------------------------*00593001
005940*    FUNCTION KEYS COPYBOOK                                      *00594001
005950*----------------------------------------------------------------*00595001
005960     COPY DPWS016.                                                00596001
005970                                                                  00597001
005980***************************************************************** 00598001
005990* RECORD LAYOUT OF TEMP QUEUE FROM LIST PROGRAM                   00599001
006000***************************************************************** 00600001
006010     COPY RCWS013.                                                00601001
006020                                                                  00602001
006030*----------------------------------------------------------------*00603001
006040*    COPYBOOK FOR THE FIELDS PASSED TO THE TROUBLE SUBROUTINE     00604001
006050*----------------------------------------------------------------*00605001
006060     COPY TMWS500.                                                00606001
006070                                                                  00607001
006080*----------------------------------------------------------------*00608001
006090*  WORK AREA PASSED IN CALL TO DPKUT902                          *00609001
006100*----------------------------------------------------------------*00610001
006110     COPY DPWS902.                                                00611001
006120                                                                  00612001
006130*----------------------------------------------------------------*00613001
006140*  WORK AREA PASSED IN CALL TO RCKUT023                           00614001
006150*-----------------------------------------------------------------00615001
006160     COPY RCWS023.                                                00616001
006170                                                                  00617001
006180******************************************************************00618001
006190* COPY BOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 230ZZ  *00619001
006200******************************************************************00620001
006210     COPY XLWS001.                                                00621001
006220                                                                  00622001
006230*----------------------------------------------------------------*00623001
006240*  COPYBOOK FOR LOCATION CALL MODULE                              00624001
006250*-----------------------------------------------------------------00625001
006260     COPY XLWS071.                                                00626001
006270                                                                  00627001
006280***************************************************************** 00628001
006290* PARAMETERS FOR CALLING CICS ARCHITECTURE API.                   00629034
006300***************************************************************** 00630001
006310     COPY DPWS017.                                                00631001
006320                                                                  00632001
006330     COPY DPWS030.                                                00633001
006331     COPY DPWS930.                                                00633134
006340                                                                  00634001
006350***************************************************************** 00635001
006360*    STANDARD COMMAREA.                                           00636001
006370***************************************************************** 00637001
006380     COPY DPWS020.                                                00638001
006390     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00639001
006400                                                                  00640001
006410***************************************************************** 00641001
006420*    INTER-APPLICATION COMMAREA.                                  00642001
006430***************************************************************** 00643001
006440         10  INTER-APPL-COMM-AREA PIC X(200).                     00644001
006450     COPY RCWS012.                                                00645001
006460     COPY RCWS015.                                                00646001
006470     COPY RCWS800.                                                00647001
006480***************************************************************** 00648001
006490*    SPECIFIC COMMMAREA FOR RCKCS221.                             00649001
006500***************************************************************** 00650001
006510         10  ASC-SPECIFIC-COMMAREA.                               00651001
006520             15  ASC-USE-SELECTION-QUEUE-IND                      00652001
006530                                           PIC X(01).             00653001
006540                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        00654001
006550             15  ASC-SEL-QUEUE-NAME        PIC X(08).             00655001
006560             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     00656001
006570             15  ASC-NUMBER-OF-SELECTED-ITEMS                     00657001
006580                                           PIC S9(09) COMP-3.     00658001
006590             15  ASC-SEL-SUB               PIC S9(04) COMP.       00659001
006600             15  ASC-SEL-ITEM              PIC S9(04) COMP.       00660001
006610             15  ASC-ACTION-SW            PIC X(03).              00661001
006620                 88  ASC-ADD-PENDING      VALUE 'ADD'.            00662001
006630                 88  ASC-UPDATE-PENDING   VALUE 'UPD'.            00663001
006640             15  ASC-ALL-LINES-SW         PIC X.                  00664001
006650                 88  ASC-ALL-LINES        VALUE 'Y'.              00665001
006660             15  ASC-ANY-LINES-SW         PIC X.                  00666001
006670                 88  ASC-ANY-LINES        VALUE 'Y'.              00667001
006680             15  ASC-PACK-REDISTRO-SW     PIC X.                  00668001
006690                 88  ASC-PACK-REDISTRO    VALUE 'Y'.              00669001
006700             15  ASC-CONFIRM-REDISTRO-SW  PIC X.                  00670001
006710                 88  ASC-CONFIRM-REDISTRO VALUE 'Y'.              00671001
006720             15  ASC-PKG-BCS-SW           PIC X.                  00672001
006730                 88  ASC-PKG-BCS-CHGD     VALUE 'Y'.              00673001
006740                 88  ASC-PKG-BCS-NOTCHGD  VALUE 'N'.              00674001
006750             15  ASC-ADD-TYPE-SW          PIC X(03).              00675001
006760                 88  ASC-ADD-FROM-SHPPO   VALUE 'SHP'.            00676001
006770                 88  ASC-ADD-MULTIPLE     VALUE 'MUL'.            00677001
006780                 88  ASC-ADD-FROM-MENU    VALUE 'MEN'.            00678001
006790                 88  ASC-ADD-FROM-MAINT   VALUE 'MNT'.            00679001
006800             15  ASC-PRE-RECEIVER-VEND-SW  PIC X(01).             00680001
006810                 88  ASC-PRE-RECEIVER-VENDOR                      00681001
006820                                           VALUE 'Y'.             00682001
006830             15  ASC-SELECTION-MADE-SW     PIC X(01).             00683001
006840                 88  ASC-NO-SELECTION-MADE VALUE 'N'.             00684001
006850                 88  ASC-SELECTION-MADE    VALUE 'Y'.             00685001
006860             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            00686001
006870                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            00687001
006880                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            00688001
006890             15  ASC-TRIP-SW                PIC X(01).            00689001
006900                 88  ASC-TRIP-EXISTS        VALUE 'Y'.            00690001
006910                 88  ASC-TRIP-DOESNT-EXIST  VALUE 'N'.            00691001
006920             15  ASC-SHIPMENTS-SW           PIC X(01).            00692001
006930                 88  ASC-SHIPMENT-EXISTS       VALUE 'Y'.         00693001
006940                 88  ASC-SHIPMENT-DOESNT-EXIST VALUE 'N'.         00694001
006950             15  ASC-MULTIPLE-SHIPMENTS-SW  PIC X(01).            00695001
006960                 88  ASC-MULTIPLE-SHIPMENTS    VALUE 'Y'.         00696001
006970             15  ASC-MULT-SHIP-SW           PIC X(01).            00697001
006980                 88  ASC-MULT-SHIP             VALUE 'Y'.         00698001
006990             15  ASC-PO-SW                  PIC X(01).            00699001
007000                 88  ASC-PO-EXISTS            VALUE 'Y'.          00700001
007010                 88  ASC-PO-DOESNT-EXIST      VALUE 'N'.          00701001
007020             15  ASC-FIELDS-CHANGED-SW      PIC X(01).            00702001
007030                 88  ASC-FIELDS-CHANGED       VALUE 'Y'.          00703001
007040             15  ASC-RECEIPT-TYPE-SW        PIC X(01).            00704001
007050                 88  ASC-EXPENSE-RECEIPT      VALUE 'E'.          00705001
007060             15  ASC-DIRECT-STORE-SW        PIC X(01).            00706001
007070                 88  ASC-DIRECT-STORE         VALUE 'D'.          00707001
007080             15  ASC-OPER-SET-UPDATE-SW     PIC X(01).            00708001
007090                 88  ASC-MAY-UPDATE-OPER-SET  VALUE 'Y'.          00709001
007100             15  ASC-TRIP-ID                PIC S9(09) COMP.      00710001
007110             15  ASC-SHIPT-ID               PIC S9(09) COMP.      00711001
007120             15  ASC-DEPT-NBR               PIC X(03).            00712001
007130             15  ASC-VER-NBR                PIC S9(09) COMP.      00713001
007140             15  ASC-NEW-STR-PO-IND         PIC X(01).            00714001
007150             15  ASC-TRIP-STATUS-CDE        PIC X(02).            00715001
007160             15  ASC-PO-TYPE                PIC X(02).            00716001
007170                                                                  00717001
007180             15  ASC-KEY-FIELDS.                                  00718001
007190                 20  ASC-KEY-PO-NBR          PIC S9(09) COMP.     00719001
007200                 20  ASC-KEY-REC-SEQ-NBR     PIC S9(09) COMP.     00720001
007210                 20  ASC-KEY-SHIPT-ID        PIC S9(09) COMP.     00721001
007220                 20  ASC-KEY-TRIP-ID         PIC S9(09) COMP.     00722001
007230                 20  ASC-KEY-OWNER-SCAC-ID   PIC X(04).           00723001
007240                 20  ASC-KEY-VEH-NBR         PIC X(10).           00724001
007250                 20  ASC-KEY-PRO-NBR         PIC X(22).           00725001
007260                 20  ASC-KEY-BOL-NBR         PIC X(30).           00726001
007270                 20  ASC-KEY-STATUS-DTE      PIC X(10).           00727001
007280                                                                  00728001
007290             15  ASC-SCREEN-FIELDS.                               00729001
007300                 20  ASC-REC-SEQ-NBR         PIC 9(04).           00730001
007310** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  00731004
007320                 20  ASC-PO-NBR              PIC X(08).           00732004
007330                 20  ASC-PO-NBR-N REDEFINES ASC-PO-NBR            00733001
007340                                             PIC 9(08).           00734004
007350                 20  ASC-TRBL-DESC           PIC X(11).           00735001
007360                 20  ASC-ENT-NAME-DESC       PIC X(25).           00736001
007370                 20  ASC-EXPENSE-IND         PIC X(01).           00737001
007380                 20  ASC-AP-RCVR-NBR         PIC X(08).           00738001
007390                 20  ASC-AP-RCVR-NBR-N REDEFINES                  00739001
007400                     ASC-AP-RCVR-NBR         PIC 9(08).           00740001
007410                 20  ASC-OWNER-SCAC-ID       PIC X(04).           00741001
007420                 20  ASC-VEH-NBR             PIC X(10).           00742001
007430                 20  ASC-PRO-NBR             PIC X(22).           00743001
007440                 20  ASC-COMP-PRO-NBR        PIC X(22).           00744001
007450                 20  ASC-OWNR-SCAC-SHIP-DTE  PIC X(08).           00745001
007460                 20  ASC-OWNR-SCAC-SHIP-DTE-ISO PIC X(10).        00746001
007470                 20  ASC-ARRIVAL-DTE         PIC X(08).           00747001
007480                 20  ASC-OPER-UNT-ID         PIC X(04).           00748001
007490                 20  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID  00749001
007500                                             PIC 9(04).           00750001
007510                 20  ASC-OPER-UNT-ID-OLD     PIC X(04).           00751001
007520                 20  ASC-FCLTY-ID            PIC X(04).           00752001
007530                 20  ASC-FCLTY-ID-N REDEFINES ASC-FCLTY-ID        00753001
007540                                             PIC 9(04).           00754001
007550                 20  ASC-VEND-SHIP-DTE       PIC X(08).           00755001
007560                 20  ASC-VEND-SHIP-DTE-ISO   PIC X(10).           00756001
007570                 20  ASC-CRE-UID             PIC X(08).           00757001
007580                 20  ASC-DOCK-AREA           PIC X(06).           00758001
007600                 20  ASC-BOL-NBR             PIC X(30).           00760001
007610* WR40574 02-09-2012 START CLT                                    00761001
007620                 20  ASC-CARR-AUTH-ID        PIC X(30).           00762001
007630* WR40574 02-09-2012 END   CLT                                    00763001
007640                 20  ASC-COMP-BOL-NBR        PIC X(30).           00764001
007650                 20  ASC-OPER-SET-ID         PIC X(03).           00765001
007660                 20  ASC-OPER-SET-ID-N REDEFINES                  00766001
007670                     ASC-OPER-SET-ID         PIC 9(03).           00767001
007680                 20  ASC-OPER-SET-DESC       PIC X(25).           00768001
007690                 20  ASC-TKT-FMT-ID          PIC X(06).           00769001
007700                 20  ASC-TKT-DESC            PIC X(20).           00770001
007710                 20  ASC-EXPTED-CART-CNT     PIC X(04).           00771001
007720                 20  ASC-EXPTED-CART-CNT-N REDEFINES              00772001
007730                     ASC-EXPTED-CART-CNT     PIC 9(04).           00773001
007740                 20  ASC-ASN-IND             PIC X(01).           00774001
007750                 20  ASC-ACTL-CART-CNT       PIC X(04).           00775001
007760                 20  ASC-ACTL-CART-CNT-N REDEFINES                00776001
007770                     ASC-ACTL-CART-CNT       PIC 9(04).           00777001
007780                 20  ASC-AD-DTE              PIC X(08).           00778001
007790                 20  ASC-PRE-TKT-IND         PIC X(01).           00779001
007800                 20  ASC-HANGER-IND          PIC X(01).           00780001
007810                 20  ASC-DMG-CART-CNT        PIC X(04).           00781001
007820                 20  ASC-DMG-CART-CNT-N REDEFINES                 00782001
007830                     ASC-DMG-CART-CNT        PIC 9(04).           00783001
007840                 20  ASC-PACK-BY-ST-IND      PIC X(01).           00784001
007850                 20  ASC-PKGNG-CDE           PIC X(01).           00785001
007860                     88  ASC-VALID-PKGNG-CDE VALUES 'M' 'I' 'C'   00786001
007870                                                    'S' 'B' ' '.  00787001
007880                     88  ASC-PREPK-I-OR-M    VALUES 'M' 'I'.      00788001
007890                 20  ASC-RCVG-CLERK-INIT-ID  PIC X(03).           00789001
007900                 20  ASC-COPER-UNT-ID        PIC X(04).           00790001
007910                 20  ASC-COPER-UNT-ID-N REDEFINES ASC-COPER-UNT-ID00791001
007920                                             PIC 9(04).           00792001
007930                 20  ASC-CFCLTY-ID           PIC X(04).           00793001
007940                 20  ASC-CFCLTY-ID-N REDEFINES ASC-CFCLTY-ID      00794001
007950                                             PIC 9(04).           00795001
007960                 20  ASC-CRE-OPER-UNT-ID     PIC X(04).           00796001
007970                 20  ASC-CRE-OPER-UNT-ID-N REDEFINES              00797001
007980                     ASC-CRE-OPER-UNT-ID                          00798001
007990                                             PIC 9(04).           00799001
008000                 20  ASC-CRE-FCLTY-ID        PIC X(04).           00800001
008010                 20  ASC-CRE-FCLTY-ID-N REDEFINES ASC-CRE-FCLTY-ID00801001
008020                                             PIC 9(04).           00802001
008030                 20  ASC-APRON-LOC-DESC      PIC X(08).           00803001
008040                 20  ASC-ARRIVAL-DISPLAY-DTE PIC X(08).           00804001
008050                 20  ASC-REC-TYP             PIC X(02).           00805001
008060             15  ASC-SCREEN-FIELDS-OLD.                           00806001
008070** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  00807004
008080                 20  ASC-PO-NBR-OLD          PIC X(08).           00808004
008090                 20  ASC-ENT-NAME-DESC-OLD   PIC X(25).           00809001
008100                 20  ASC-OWNER-SCAC-ID-OLD   PIC X(04).           00810001
008110                 20  ASC-VEH-NBR-OLD         PIC X(10).           00811001
008120                 20  ASC-PRO-NBR-OLD         PIC X(22).           00812001
008130                 20  ASC-OWNR-SCAC-SHIP-DTE-OLD PIC X(08).        00813001
008140                 20  ASC-ARRIVAL-DTE-OLD     PIC X(08).           00814001
008150                 20  ASC-VEND-SHIP-DTE-OLD   PIC X(08).           00815001
008160                 20  ASC-BOL-NBR-OLD         PIC X(30).           00816001
008170* WR40574 02-09-2012 START CLT                                    00817001
008180                 20  ASC-CARR-AUTH-ID-OLD    PIC X(30).           00818001
008190* WR40574 02-09-2012 END  NUM COB STD                             00819001
008200                 20  ASC-OPER-SET-ID-OLD     PIC X(03).           00820001
008210                 20  ASC-EXPTED-CART-CNT-OLD PIC X(04).           00821001
008220                 20  ASC-PRE-TKT-IND-OLD     PIC X(01).           00822001
008230                 20  ASC-HANGER-IND-OLD      PIC X(01).           00823001
008240                 20  ASC-ACTL-CART-CNT-OLD   PIC X(04).           00824001
008250                 20  ASC-DMG-CART-CNT-OLD    PIC X(04).           00825001
008260                 20  ASC-PACK-BY-ST-IND-OLD  PIC X(01).           00826001
008270                 20  ASC-RCVG-CLERK-INIT-ID-OLD PIC X(03).        00827001
008280                 20  ASC-PKGNG-CDE-OLD       PIC X(01).           00828001
008290                     88  ASC-VALID-CHG-PKGNG-CDE-OLD              00829001
008300                                                  VALUES 'M' 'I'. 00830001
008310                 20  ASC-COPER-UNT-ID-OLD    PIC X(04).           00831001
008320                 20  ASC-COPER-UNT-ID-N-OLD                       00832001
008330                     REDEFINES ASC-COPER-UNT-ID-OLD               00833001
008340                                             PIC 9(04).           00834001
008350                 20  ASC-CFCLTY-ID-OLD       PIC X(04).           00835001
008360                 20  ASC-CFCLTY-ID-N-OLD                          00836001
008370                     REDEFINES ASC-CFCLTY-ID-OLD                  00837001
008380                                             PIC 9(04).           00838001
008390                 20  ASC-APRON-LOC-DESC-OLD  PIC X(08).           00839001
008400                 20  ASC-REC-TYP-OLD         PIC X(02).           00840001
008410             15  ASC-VEND-SHIP-DATE-EDIT-FIELDS.                  00841001
008420                 20  ASC-VND-DT-F2-REQUIRED-SW    PIC X(01).      00842001
008430                     88  ASC-VND-DT-F2-REQUIRED       VALUE 'Y'.  00843001
008440                     88  ASC-VND-DT-F2-NOT-REQUIRED   VALUE 'N'.  00844001
008450                 20  ASC-VND-DT-CHGD-SW           PIC X(01).      00845001
008460                     88  ASC-VND-DT-CHGD              VALUE 'Y'.  00846001
008470                     88  ASC-VND-DT-NOT-CHGD          VALUE 'N'.  00847001
008480                 20  ASC-VND-DT-CHG-PENDING-SW    PIC X(01).      00848001
008490                     88  ASC-VND-DT-CHG-PENDING       VALUE 'Y'.  00849001
008500                     88  ASC-VND-DT-CHG-NOT-PENDING   VALUE 'N'.  00850001
008510                 20  ASC-VND-SHIP-DATE-OLD.                       00851001
008520                     25  ASC-VND-SHIP-MM-OLD     PIC X(02).       00852001
008530                     25  ASC-VND-SHIP-DD-OLD     PIC X(02).       00853001
008540                     25  ASC-VND-SHIP-CCYY-OLD.                   00854001
008550                         30  ASC-VND-SHIP-CC-OLD PIC X(02).       00855001
008560                         30  ASC-VND-SHIP-YY-OLD PIC X(02).       00856001
008570                 20  ASC-VND-SHIP-DATE-NEW.                       00857001
008580                     25  ASC-VND-SHIP-MM-NEW     PIC X(02).       00858001
008590                     25  ASC-VND-SHIP-DD-NEW     PIC X(02).       00859001
008600                     25  ASC-VND-SHIP-CCYY-NEW.                   00860001
008610                         30  ASC-VND-SHIP-CC-NEW PIC X(02).       00861001
008620                         30  ASC-VND-SHIP-YY-NEW PIC X(02).       00862001
008630                 20  ASC-CASEPACK-SPLT-CNT   PIC  S9(9) COMP.     00863001
008640                 20  ASC-OTBND-CTN-CNT       PIC  S9(9) COMP.     00864001
008650             15  ASC-ARRIVED-SW            PIC X(01).             00865001
008660                 88  ASC-RECEIVER-ARRIVED      VALUE 'Y'.         00866001
008670                 88  ASC-RECEIVER-NOT-ARRIVED  VALUE 'N'.         00867001
008680                                                                  00868001
008690/                                                                 00869001
008700*----------------------------------------------------------------*00870001
008710*    ABEND PROCESSING COPYBOOK.                                  *00871001
008720*----------------------------------------------------------------*00872001
008730     COPY DPWS013.                                                00873001
008740                                                                  00874001
008750/                                                                 00875001
008760*---------------------------------------------------------------* 00876001
008770*    DB2 AREA FOR THE COMPANY CONTROL TABLE                     * 00877001
008780*---------------------------------------------------------------* 00878001
008790     EXEC SQL                                                     00879001
008800          INCLUDE TCOCNTL                                         00880001
008810     END-EXEC.                                                    00881001
008820                                                                  00882001
008830/                                                                 00883001
008840*---------------------------------------------------------------* 00884001
008850*    DB2 AREA FOR THE ENTERPRISE TABLE                          * 00885001
008860*---------------------------------------------------------------* 00886001
008870     EXEC SQL                                                     00887001
008880          INCLUDE TEXTENT                                         00888001
008890     END-EXEC.                                                    00889001
008900                                                                  00890001
008910/                                                                 00891001
008920*---------------------------------------------------------------* 00892001
008930*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 00893001
008940*---------------------------------------------------------------* 00894001
008950     EXEC SQL                                                     00895001
008960          INCLUDE TENTNME                                         00896001
008970     END-EXEC.                                                    00897001
008980                                                                  00898001
008990/                                                                 00899001
009000*---------------------------------------------------------------* 00900001
009010*    DB2 AREA FOR RECEIVER TABLE                                * 00901001
009020*---------------------------------------------------------------* 00902001
009030     EXEC SQL                                                     00903001
009040          INCLUDE TRECEIV                                         00904001
009050     END-EXEC.                                                    00905001
009060/                                                                 00906001
009070*---------------------------------------------------------------* 00907001
009080*    DB2 AREA FOR STATUS CODE TABLE                             * 00908001
009090*---------------------------------------------------------------* 00909001
009100     EXEC SQL                                                     00910001
009110          INCLUDE TSTATCD                                         00911001
009120     END-EXEC.                                                    00912001
009130                                                                  00913001
009140/                                                                 00914001
009150*---------------------------------------------------------------* 00915001
009160*    DB2 AREA FOR SHIPMENT TABLE                                * 00916001
009170*---------------------------------------------------------------* 00917001
009180     EXEC SQL                                                     00918001
009190          INCLUDE TSHIPMT                                         00919001
009200     END-EXEC.                                                    00920001
009210                                                                  00921001
009220/                                                                 00922001
009230*---------------------------------------------------------------* 00923001
009240*    DB2 AREA FOR SHIPMENT AUDIT TABLE                          * 00924001
009250*---------------------------------------------------------------* 00925001
009260     EXEC SQL                                                     00926001
009270          INCLUDE TAUSHIP                                         00927001
009280     END-EXEC.                                                    00928001
009290                                                                  00929001
009300/                                                                 00930001
009310*---------------------------------------------------------------* 00931001
009320*    DB2 AREA FOR SHIPMENT STATUS TABLE                         * 00932001
009330*---------------------------------------------------------------* 00933001
009340     EXEC SQL                                                     00934001
009350          INCLUDE TSHIPST                                         00935001
009360     END-EXEC.                                                    00936001
009370                                                                  00937001
009380/                                                                 00938001
009390*---------------------------------------------------------------* 00939001
009400*    DB2 AREA FOR SHIPMENT STATUS TYPE TABLE                    * 00940001
009410*---------------------------------------------------------------* 00941001
009420     EXEC SQL                                                     00942001
009430          INCLUDE TSHSTYP                                         00943001
009440     END-EXEC.                                                    00944001
009450                                                                  00945001
009460/                                                                 00946001
009470*---------------------------------------------------------------* 00947001
009480*    DB2 AREA FOR SHIPMENT PACKAGE CODE TABLE                   * 00948001
009490*---------------------------------------------------------------* 00949001
009500     EXEC SQL                                                     00950001
009510          INCLUDE TSHPPKG                                         00951001
009520     END-EXEC.                                                    00952001
009530                                                                  00953001
009540/                                                                 00954001
009550*---------------------------------------------------------------* 00955001
009560*    DB2 AREA FOR PURCHASE ORDER TABLE                          * 00956001
009570*---------------------------------------------------------------* 00957001
009580     EXEC SQL                                                     00958001
009590          INCLUDE TPURCHS                                         00959001
009600     END-EXEC.                                                    00960001
009610                                                                  00961001
009620/                                                                 00962001
009630*---------------------------------------------------------------* 00963001
009640*    DB2 AREA FOR PURCHASE ORDER LINE ITEM TABLE                * 00964001
009650*---------------------------------------------------------------* 00965001
009660     EXEC SQL                                                     00966001
009670          INCLUDE TPURITM                                         00967001
009680     END-EXEC.                                                    00968001
009690                                                                  00969001
009700/                                                                 00970001
009710*---------------------------------------------------------------* 00971001
009720*    DB2 AREA FOR SHIPMENT PO TABLE                             * 00972001
009730*---------------------------------------------------------------* 00973001
009740     EXEC SQL                                                     00974001
009750          INCLUDE TSHPTPO                                         00975001
009760     END-EXEC.                                                    00976001
009770                                                                  00977001
009780/                                                                 00978001
009790*---------------------------------------------------------------* 00979001
009800*    DB2 AREA FOR SHIPMENT PO AUDIT TABLE                       * 00980001
009810*---------------------------------------------------------------* 00981001
009820     EXEC SQL                                                     00982001
009830          INCLUDE TAUSHPO                                         00983001
009840     END-EXEC.                                                    00984001
009850                                                                  00985001
009860/                                                                 00986001
009870*---------------------------------------------------------------* 00987001
009880*    DB2 AREA FOR VEHICLE TABLE                                 * 00988001
009890*---------------------------------------------------------------* 00989001
009900     EXEC SQL                                                     00990001
009910          INCLUDE TVEHICL                                         00991001
009920     END-EXEC.                                                    00992001
009930                                                                  00993001
009940/                                                                 00994001
009950*---------------------------------------------------------------* 00995001
009960*    DB2 AREA FOR VEHICLE TRIP TABLE                            * 00996001
009970*---------------------------------------------------------------* 00997001
009980     EXEC SQL                                                     00998001
009990          INCLUDE TVHTRIP                                         00999001
010000     END-EXEC.                                                    01000001
010010                                                                  01001001
010020/                                                                 01002001
010030*---------------------------------------------------------------* 01003001
010040*    DB2 AREA FOR VEHICLE TRIP AUDIT TABLE                      * 01004001
010050*---------------------------------------------------------------* 01005001
010060     EXEC SQL                                                     01006001
010070          INCLUDE TAUTRIP                                         01007001
010080     END-EXEC.                                                    01008001
010090                                                                  01009001
010100/                                                                 01010001
010110*---------------------------------------------------------------* 01011001
010120*    DB2 AREA FOR VEHICLE TRIP STATUS TABLE                     * 01012001
010130*---------------------------------------------------------------* 01013001
010140     EXEC SQL                                                     01014001
010150          INCLUDE TTRIPST                                         01015001
010160     END-EXEC.                                                    01016001
010170                                                                  01017001
010180/                                                                 01018001
010190*---------------------------------------------------------------* 01019001
010200*    DB2 AREA FOR TRIP STATUS CODE TABLE                        * 01020001
010210*---------------------------------------------------------------* 01021001
010220     EXEC SQL                                                     01022001
010230          INCLUDE TTRSTYP                                         01023001
010240     END-EXEC.                                                    01024001
010250                                                                  01025001
010260/                                                                 01026001
010270*---------------------------------------------------------------* 01027001
010280*    DB2 AREA FOR PACKING SLIP TABLE                            * 01028001
010290*---------------------------------------------------------------* 01029001
010300     EXEC SQL                                                     01030001
010310          INCLUDE TPKSLIP                                         01031001
010320     END-EXEC.                                                    01032001
010330                                                                  01033001
010350     EXEC SQL                                                     01035001
010360          INCLUDE TINPKSU                                         01036001
010370     END-EXEC.                                                    01037001
010380                                                                  01038001
010390     EXEC SQL                                                     01039001
010400          INCLUDE TSHUNLO                                         01040001
010410     END-EXEC.                                                    01041001
010420                                                                  01042001
010430     EXEC SQL                                                     01043001
010440          INCLUDE TSULBXF                                         01044001
010450     END-EXEC.                                                    01045001
010460                                                                  01046001
010470/                                                                 01047001
010650*----------------------------------------------------------------*01065001
010660*    DB2 AREA FOR TDCFAAS  DEPT/CLASS FACILITY LOC. ASSIGNMENTS  *01066001
010670*----------------------------------------------------------------*01067001
010680                                                                  01068001
010690     EXEC SQL                                                     01069001
010700          INCLUDE TDCFAAS                                         01070001
010710     END-EXEC.                                                    01071001
010720                                                                  01072001
010730/                                                                 01073001
010740*----------------------------------------------------------------*01074001
010750*    DB2 AREA FOR TDCTFAS  DEPT/CLASS TICKET FORMAT ASIGNMENTS   *01075001
010760*----------------------------------------------------------------*01076001
010770                                                                  01077001
010780     EXEC SQL                                                     01078001
010790          INCLUDE TDCTFAS                                         01079001
010800     END-EXEC.                                                    01080001
010810                                                                  01081001
010820/                                                                 01082001
010830*----------------------------------------------------------------*01083001
010840*    DB2 AREA FOR OPERATION SET TABLE                            *01084001
010850*----------------------------------------------------------------*01085001
010860                                                                  01086001
010870     EXEC SQL                                                     01087001
010880          INCLUDE TOPRSET                                         01088001
010890     END-EXEC.                                                    01089001
010900                                                                  01090001
010910/                                                                 01091001
010920*----------------------------------------------------------------*01092001
010930*    DB2 AREA FOR OPERATION SET/FACILITY TABLE                   *01093001
010940*----------------------------------------------------------------*01094001
010950                                                                  01095001
010960     EXEC SQL                                                     01096001
010970          INCLUDE TOSOPFA                                         01097001
010980     END-EXEC.                                                    01098001
010990                                                                  01099001
011000/                                                                 01100001
011010*----------------------------------------------------------------*01101001
011020*    DB2 AREA FOR WORK ORDER TABLE                               *01102001
011030*----------------------------------------------------------------*01103001
011040                                                                  01104001
011050     EXEC SQL                                                     01105001
011060          INCLUDE TWRKORD                                         01106001
011070     END-EXEC.                                                    01107001
011080                                                                  01108001
011090/                                                                 01109001
011100*----------------------------------------------------------------*01110001
011110*    DB2 AREA FOR WORK ORDER INSTRUCTION TABLE                   *01111001
011120*----------------------------------------------------------------*01112001
011130     EXEC SQL                                                     01113001
011140          INCLUDE TWKORIN                                         01114001
011150     END-EXEC.                                                    01115001
011160                                                                  01116001
011170*----------------------------------------------------------------*01117001
011180*    DB2 DCLGEN FOR PO AGREEMENT TABLE                            01118001
011190*----------------------------------------------------------------*01119001
011200     EXEC SQL                                                     01120001
011210          INCLUDE TPOAGMT                                         01121001
011220     END-EXEC.                                                    01122001
011230                                                                  01123001
011240*----------------------------------------------------------------*01124001
011250*    DB2 DCLGEN FOR THE RECEIVER NUMBER TABLE                     01125001
011260*----------------------------------------------------------------*01126001
011270     EXEC SQL                                                     01127001
011280          INCLUDE TRECVER                                         01128001
011290     END-EXEC.                                                    01129001
011300                                                                  01130001
011310*----------------------------------------------------------------*01131001
011320*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                01132001
011330*----------------------------------------------------------------*01133001
011340     EXEC SQL                                                     01134001
011350          INCLUDE TTRBNTF                                         01135001
011360     END-EXEC.                                                    01136001
011370/                                                                 01137001
011380*----------------------------------------------------------------*01138001
011390*    DB2 DCLGEN FOR THE TROUBLE REASON TABLE                      01139001
011400*----------------------------------------------------------------*01140001
011410     EXEC SQL                                                     01141001
011420          INCLUDE TTRBRSN                                         01142001
011430     END-EXEC.                                                    01143001
011440/                                                                 01144001
011450*----------------------------------------------------------------*01145001
011460*    DB2 DCLGEN FOR THE TRECITM TABLE                             01146001
011470*----------------------------------------------------------------*01147001
011480     EXEC SQL                                                     01148001
011490          INCLUDE TRECITM                                         01149001
011500     END-EXEC.                                                    01150001
011510/                                                                 01151001
011520*----------------------------------------------------------------*01152001
011530*    DB2 DCLGEN FOR THE TPTKREQ TABLE                             01153001
011540*----------------------------------------------------------------*01154001
011550     EXEC SQL                                                     01155001
011560          INCLUDE TPTKREQ                                         01156001
011570     END-EXEC.                                                    01157001
011580/                                                                 01158001
011590*----------------------------------------------------------------*01159001
011600*    DB2 DCLGEN FOR THE TPTKREQ TABLE                             01160001
011610*----------------------------------------------------------------*01161001
011620     EXEC SQL                                                     01162001
011630          INCLUDE TPTKLNE                                         01163001
011640     END-EXEC.                                                    01164001
011650/                                                                 01165001
011660*----------------------------------------------------------------*01166001
011670*    DB2 DCLGEN FOR THE TTKTFMT TABLE                             01167001
011680*----------------------------------------------------------------*01168001
011690     EXEC SQL                                                     01169001
011700          INCLUDE TTKTFMT                                         01170001
011710     END-EXEC.                                                    01171001
011720/                                                                 01172001
011730*----------------------------------------------------------------*01173001
011740*    DB2 DCLGEN FOR THE TMDSEAR TABLE                             01174001
011750*----------------------------------------------------------------*01175001
011760     EXEC SQL                                                     01176001
011770          INCLUDE TMDSEAR                                         01177001
011780     END-EXEC.                                                    01178001
011790/                                                                 01179001
011800/                                                                 01180001
011810*----------------------------------------------------------------*01181001
011820*    DB2 DCLGEN FOR THE TDCVSVL TABLE                             01182001
011830*----------------------------------------------------------------*01183001
011840     EXEC SQL                                                     01184001
011850          INCLUDE TDCVSVL                                         01185001
011860     END-EXEC.                                                    01186001
011870/                                                                 01187001
011880*----------------------------------------------------------------*01188001
011890*    DB2 DCLGEN FOR THE TVSCHVL TABLE                             01189001
011900*----------------------------------------------------------------*01190001
011910     EXEC SQL                                                     01191001
011920          INCLUDE TVSCHVL                                         01192001
011930     END-EXEC.                                                    01193001
011940/                                                                 01194001
011950*----------------------------------------------------------------*01195001
011960*    DB2 DCLGEN FOR THE TVNDSTL TABLE                             01196001
011970*----------------------------------------------------------------*01197001
011980     EXEC SQL                                                     01198001
011990          INCLUDE TVNDSTL                                         01199001
012000     END-EXEC.                                                    01200001
012010/                                                                 01201001
012020*----------------------------------------------------------------*01202001
012030*    DB2 DCLGEN FOR THE TMDARVS TABLE                             01203001
012040*----------------------------------------------------------------*01204001
012050     EXEC SQL                                                     01205001
012060          INCLUDE TMDARVS                                         01206001
012070     END-EXEC.                                                    01207001
012080/                                                                 01208001
012090*----------------------------------------------------------------*01209001
012100*    DB2 DCLGEN FOR THE TDISTHD TABLE                             01210001
012110*----------------------------------------------------------------*01211001
012120     EXEC SQL                                                     01212001
012130          INCLUDE TDISTHD                                         01213001
012140     END-EXEC.                                                    01214001
012150/                                                                 01215001
012160*----------------------------------------------------------------*01216001
012170*    DB2 DCLGEN FOR THE SUT_OTBND_CART TABLE                      01217001
012180*----------------------------------------------------------------*01218001
012190     EXEC SQL                                                     01219001
012200          INCLUDE SUT00024                                        01220001
012210     END-EXEC.                                                    01221001
012220/                                                                 01222001
012230*---------------------------------------------------------------* 01223001
012240*    DB2 AREA FOR THE PARM TABLE                                * 01224001
012250*---------------------------------------------------------------* 01225001
012260     EXEC SQL                                                     01226001
012270          INCLUDE TKRPRPM                                         01227001
012280     END-EXEC.                                                    01228001
012290*----------------------------------------------------------------*01229001
012300*    DB2 DCLGEN FOR THE SUT_OTBND_UPC  TABLE                      01230001
012310*----------------------------------------------------------------*01231001
012320     EXEC SQL                                                     01232001
012330          INCLUDE SUT00028                                        01233001
012340     END-EXEC.                                                    01234001
012350/                                                                 01235001
012360     EXEC SQL                                                     01236001
012370          INCLUDE TPOSYNC                                         01237001
012380     END-EXEC.                                                    01238001
012390/                                                                 01239001
012400*----------------------------------------------------------------*01240001
012410*    DB2 DCLGEN FOR THE WST_INTGRTN_TYP TABLE                     01241001
012420*----------------------------------------------------------------*01242001
012430     EXEC SQL                                                     01243001
012440          INCLUDE WST00008                                        01244001
012450     END-EXEC.                                                    01245001
012460/                                                                 01246001
012470*----------------------------------------------------------------*01247001
012480*    DB2 DCLGEN FOR THE WST_ATTR_DEFN TABLE                       01248001
012490*----------------------------------------------------------------*01249001
012500     EXEC SQL                                                     01250001
012510          INCLUDE WST00009                                        01251001
012520     END-EXEC.                                                    01252001
012530/                                                                 01253001
012540*----------------------------------------------------------------*01254001
012550*    DB2 DCLGEN FOR THE WST_ATTR_ELEM TABLE                       01255001
012560*----------------------------------------------------------------*01256001
012570     EXEC SQL                                                     01257001
012580          INCLUDE WST00010                                        01258001
012590     END-EXEC.                                                    01259001
012600/                                                                 01260001
012601*----------------------------------------------------------------*01260135
012602*    DB2 DCLGEN FOR THE RCT_PO_RCVR_TRKG TABLE - PO TRACKING      01260235
012603*----------------------------------------------------------------*01260335
012604     EXEC SQL                                                     01260435
012605          INCLUDE RCT00017                                        01260535
012606     END-EXEC.                                                    01260635
012607/                                                                 01260735
012610*----------------------------------------------------------------*01261001
012620*    DB2 AREA FOR COMMUNICATIONS                                 *01262001
012630*----------------------------------------------------------------*01263001
012640                                                                  01264001
012650     EXEC SQL                                                     01265001
012660          INCLUDE SQLCA                                           01266001
012670     END-EXEC.                                                    01267001
012680                                                                  01268001
012690/                                                                 01269001
012700*---------------------------------------------------------------* 01270001
012710*  CURSOR TO LIST COLUMNS FOR A OPERATION SET                   * 01271001
012720*---------------------------------------------------------------* 01272001
012730                                                                  01273001
012740     EXEC SQL                                                     01274001
012750          DECLARE TOSOPFA-CSR CURSOR FOR                          01275001
012760           SELECT OPER_SET_ID                                     01276001
012770                 ,OPER_ID                                         01277001
012780                 ,OPER_UNT_ID                                     01278001
012790                 ,FCLTY_ID                                        01279001
012800                 ,FCLTY_AREA_ID                                   01280001
012810                 ,PRC_FCLTY_AREA_ID                               01281001
012820                 ,SCRN_SEQ_NBR                                    01282001
012830           FROM   TOSOPFA                                         01283001
012840           WHERE  OPER_SET_ID    = :DK-OPER-SET-ID                01284001
012850             AND  OPER_UNT_ID    = :CURR-OPER-UNT-ID              01285001
012860             AND  FCLTY_ID       = :CURR-FCLTY-ID                 01286001
012870             AND  VER_STATUS_CDE = 'A'                            01287001
012880           ORDER BY SCRN_SEQ_NBR                                  01288001
012890     END-EXEC.                                                    01289001
012900                                                                  01290001
012910/                                                                 01291001
012920*---------------------------------------------------------------* 01292001
012930*  CURSOR TO RETREIVE MAX RECEIVER NUMBER AND TO LOCK ROW       * 01293001
012940*---------------------------------------------------------------* 01294001
012950                                                                  01295001
012960     EXEC SQL                                                     01296001
012970          DECLARE TRECVER-CSR CURSOR FOR                          01297001
012980           SELECT MAX_RCVR_NBR                                    01298001
012990           FROM   TRECVER                                         01299001
013000           WHERE  OPERCO_NBR = '03'                               01300001
013010           FOR UPDATE OF MAX_RCVR_NBR                             01301001
013020     END-EXEC.                                                    01302001
013030                                                                  01303001
013040/                                                                 01304001
013050 LINKAGE SECTION.                                                 01305001
013060                                                                  01306001
013070 01  DFHCOMMAREA.                                                 01307001
013080     05  FILLER                         OCCURS  1 TO 4072 TIMES   01308001
013090                                        DEPENDING ON EIBCALEN.    01309001
013100         10  FILLER                     PIC  X(01).               01310001
013110                                                                  01311001
013120/                                                                 01312001
013130 PROCEDURE DIVISION.                                              01313001
013140***************************************************************** 01314001
013150** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01315001
013160** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01316001
013170** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01317001
013180**                                                             ** 01318001
013190** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01319001
013200** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01320001
013210***************************************************************** 01321001
013220 0000-MAIN-MODULE.                                                01322001
013230     INITIALIZE DP030-CICS-API-FIELDS.                            01323001
013240     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01324001
013250     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01325001
013260     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01326001
013270     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01327001
013280     MOVE LENGTH OF RC221AI        TO DP030-MAP-LENGTH (1).       01328001
013290     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01329001
013300     PERFORM 0001-CALL-CICS-ARCH-API.                             01330001
013310*                                                                 01331001
013320     PERFORM 1000-CONTROL-PROCESSING.                             01332001
013330*                                                                 01333001
013340     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01334001
013350     PERFORM 0001-CALL-CICS-ARCH-API.                             01335001
013360                                                                  01336001
013370 0001-CALL-CICS-ARCH-API.                                         01337001
013381     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      01338134
013390                                    DFHCOMMAREA                   01339034
013400                                    DP030-CICS-API-FIELDS         01340034
013410                                    DP020-STANDARD-COMMAREA       01341034
013420                                    RC221AI.                      01342034
013430*                                                                 01343001
013440     IF  DP030-RC-CALL-SUCCESSFUL                                 01344001
013450         CONTINUE                                                 01345001
013460     ELSE                                                         01346001
013470         SET DP013-NO-ROLLBACK                                    01347001
013480             DP013-XCTL-DISPLAY-RESTART                           01348001
013490             DP013-CICS-ABEND      TO TRUE                        01349001
013500         MOVE 'BEFORE 0000-MAIN-MODULE'                           01350001
013510                                   TO DP013-PARAGRAPH             01351001
013511         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O01351134
013512-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      01351234
013540         MOVE DP030-RETURN-CODE                                   01354001
013550                                   TO DP013-MESSAGE-TEXT (3)      01355001
013560         PERFORM DP013-0000-PROCESS-ABEND                         01356001
013570     END-IF.                                                      01357001
013580                                                                  01358001
013590/                                                                 01359001
013600*----------------------------------------------------------------*01360001
013610*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01361001
013620*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01362001
013630*----------------------------------------------------------------*01363001
013640 1000-CONTROL-PROCESSING.                                         01364001
013650                                                                  01365001
013660     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       01366001
013670                                                                  01367001
013680     EVALUATE TRUE                                                01368001
013690         WHEN DP020-NEXT-ACT-INITIAL                              01369001
013700              PERFORM 1100-PROCESS-INTER-APPL-COMM                01370001
013710              IF  PS-ERROR                                        01371001
013720                  CONTINUE                                        01372001
013730              ELSE                                                01373001
013740                 PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT  01374001
013750                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             01375001
013760                 PERFORM 3200-RESET-ATTRIBUTES                    01376001
013770                 PERFORM 3500-SAVE-SCREEN-FIELDS                  01377001
013780              END-IF                                              01378001
013790                                                                  01379001
013800         WHEN DP020-NEXT-ACT-READ-MAP                             01380001
013810             PERFORM 2000-PROCESS-PANEL                           01381001
013820         WHEN DP020-NEXT-ACT-RETURN                               01382001
013830              PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT     01383001
013840              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                01384001
013850              PERFORM 3200-RESET-ATTRIBUTES                       01385001
013860              PERFORM 3500-SAVE-SCREEN-FIELDS                     01386001
013870                                                                  01387001
013880         WHEN OTHER                                               01388001
013890             SET DP013-LOGIC-ABEND                                01389001
013900                 DP013-NO-ROLLBACK TO TRUE                        01390001
013910             MOVE '1000-CONTROL-PROCESSING'                       01391001
013920                                   TO DP013-PARAGRAPH             01392001
013930             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   01393001
013940                                   TO DP013-MESSAGE-TEXT(1)       01394001
013950             MOVE DP020-NEXT-APPL-ACTIVITY                        01395001
013960                                   TO DP013-MESSAGE-TEXT(2)       01396001
013970             PERFORM DP013-0000-PROCESS-ABEND                     01397001
013980     END-EVALUATE.                                                01398001
013990                                                                  01399001
014000/                                                                 01400001
014010******************************************************************01401001
014020** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **01402001
014030** INTER-APPLICATION FORMAT CODE.                               **01403001
014040******************************************************************01404001
014050 1100-PROCESS-INTER-APPL-COMM.                                    01405001
014060                                                                  01406001
014070     INITIALIZE ASC-SPECIFIC-COMMAREA.                            01407001
014080                                                                  01408001
014090                                                                  01409001
014100     EVALUATE DP020-INT-APPL-FORMAT-IND                           01410001
014110                                                                  01411001
014120         WHEN PC-INTER-APPL-MENU                                  01412001
014130             SET ASC-ADD-PENDING                                  01413001
014140                 ASC-ADD-FROM-MENU TO TRUE                        01414001
014150             MOVE '0001-01-01'     TO ASC-KEY-STATUS-DTE          01415001
014160             MOVE ZEROES           TO ASC-OPER-UNT-ID-N           01416001
014170                                      ASC-FCLTY-ID-N              01417001
014180                                                                  01418001
014190         WHEN PC-INTER-APPL-ADD                                   01419001
014200             SET ASC-ADD-PENDING                                  01420001
014210                 ASC-ADD-FROM-MAINT TO TRUE                       01421001
014220             MOVE RC012-OPER-UNT-ID TO ASC-OPER-UNT-ID-N          01422001
014230             MOVE RC012-FCLTY-ID    TO ASC-FCLTY-ID-N             01423001
014240             MOVE RC012-PO-NBR      TO ASC-KEY-PO-NBR             01424001
014250                                       ASC-PO-NBR-N               01425001
014260             MOVE RC012-REC-SEQ-NBR TO ASC-KEY-REC-SEQ-NBR        01426001
014270                                       ASC-REC-SEQ-NBR            01427001
014280             MOVE RC012-OWNER-SCAC-ID                             01428001
014290                                   TO ASC-KEY-OWNER-SCAC-ID       01429001
014300                                      ASC-OWNER-SCAC-ID           01430001
014310             MOVE RC012-VEH-NBR    TO ASC-KEY-VEH-NBR             01431001
014320                                      ASC-VEH-NBR                 01432001
014330             MOVE RC012-PRO-NBR    TO ASC-KEY-PRO-NBR             01433001
014340                                      ASC-PRO-NBR                 01434001
014350             MOVE RC012-BOL-NBR    TO ASC-KEY-BOL-NBR             01435001
014360                                      ASC-BOL-NBR                 01436001
014370             IF  RC012-ARRIVAL-DTE = SPACES                       01437001
014380                 MOVE '0001-01-01'      TO ASC-KEY-STATUS-DTE     01438001
014390             ELSE                                                 01439001
014400                 MOVE RC012-ARRIVAL-DTE TO ASC-KEY-STATUS-DTE     01440001
014410             END-IF                                               01441001
014420                                                                  01442001
014430         WHEN PC-INTER-APPL-LIST-ADD                              01443001
014440             SET ASC-ADD-PENDING   TO TRUE                        01444001
014450             MOVE RC015-OPER-UNT-ID TO ASC-OPER-UNT-ID-N          01445001
014460             MOVE RC015-FCLTY-ID    TO ASC-FCLTY-ID-N             01446001
014470             MOVE RC015-PO-NBR      TO ASC-KEY-PO-NBR             01447001
014480                                       ASC-PO-NBR-N               01448001
014490             MOVE '0001-01-01'      TO ASC-KEY-STATUS-DTE         01449001
014500                                                                  01450001
014510         WHEN PC-INTER-APPL-SHPPO-ADD                             01451001
014520             IF  RC015-NUMBER-OF-SELECTED-ITEMS > +1              01452001
014530                 SET DP030-OVERRIDE-GO                            01453001
014540                                   TO TRUE                        01454001
014550                 MOVE PC-TSYMSG-00047                             01455001
014560                                   TO DP020-MSG-NUMBER            01456001
014570                 SET PS-ERROR                                     01457001
014580                     DP020-MSG-WARNING                            01458001
014590                     DP020-NEXT-ACT-APPL-ERROR                    01459001
014600                                   TO TRUE                        01460001
014610             ELSE                                                 01461001
014620             IF  RC015-NUMBER-OF-SELECTED-ITEMS = +0              01462001
014630                 SET DP030-OVERRIDE-GO                            01463001
014640                                   TO TRUE                        01464001
014650                 MOVE PC-TSYMSG-00057                             01465001
014660                                   TO DP020-MSG-NUMBER            01466001
014670                 SET PS-ERROR                                     01467001
014680                     DP020-MSG-WARNING                            01468001
014690                     DP020-NEXT-ACT-APPL-ERROR                    01469001
014700                                   TO TRUE                        01470001
014710             ELSE                                                 01471001
014720                 SET ASC-ADD-PENDING                              01472001
014730                     ASC-ADD-FROM-SHPPO                           01473001
014740                     ASC-USE-SELECTION-QUEUE                      01474001
014750                     ASC-SELECTION-MADE                           01475001
014760                                   TO TRUE                        01476001
014770                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              01477001
014780                                   TO ASC-NUMBER-OF-SELECTED-ITEMS01478001
014790                 MOVE RC015-NUMBER-OF-TS-ITEMS                    01479001
014800                                   TO ASC-NUMBER-OF-TS-ITEMS      01480001
014810                 MOVE RC015-SEL-QUEUE-NAME                        01481001
014820                                   TO ASC-SEL-QUEUE-NAME          01482001
014830                 PERFORM 1120-PREPARE-LIST-ENTRY                  01483001
014840                 IF  ASC-OPER-UNT-ID-N = ZEROES                   01484001
014850                     MOVE RC015-OPER-UNT-ID                       01485001
014860                                   TO ASC-OPER-UNT-ID-N           01486001
014870                                      DK-OPER-UNT-ID              01487001
014880                     MOVE RC015-FCLTY-ID TO ASC-FCLTY-ID-N        01488001
014890                                            DK-FCLTY-ID           01489001
014900                 END-IF                                           01490001
014910                 IF  ASC-KEY-REC-SEQ-NBR NOT = +0                 01491001
014920                     MOVE PC-TSYMSG-00268                         01492001
014930                                   TO DP020-MSG-NUMBER            01493001
014940                     SET PS-ERROR                                 01494001
014950                         DP020-MSG-FATAL                          01495001
014960                         DP020-NEXT-ACT-APPL-ERROR                01496001
014970                                   TO TRUE                        01497001
014980                 ELSE                                             01498001
014990                     MOVE RC015-SHIPT-ID                          01499001
015000                                   TO DK-SHIPT-ID                 01500001
015010                                      ASC-KEY-SHIPT-ID            01501001
015020                     PERFORM 1150-SELECT-TSHIPMT                  01502001
015030                 END-IF                                           01503001
015040                 END-IF                                           01504001
015050             END-IF                                               01505001
015060                                                                  01506001
015070         WHEN PC-INTER-APPL-RCVR-LIST-ADD                         01507001
015080             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            01508001
015090                 SET DP030-OVERRIDE-GO                            01509001
015100                                   TO TRUE                        01510001
015110                 MOVE PC-TSYMSG-00057                             01511001
015120                                   TO DP020-MSG-NUMBER            01512001
015130                 SET PS-ERROR                                     01513001
015140                     DP020-MSG-WARNING                            01514001
015150                     DP020-NEXT-ACT-APPL-ERROR                    01515001
015160                                   TO TRUE                        01516001
015170             ELSE                                                 01517001
015180             IF  RC015-NUMBER-OF-SELECTED-ITEMS > +1              01518001
015190                 SET DP030-OVERRIDE-GO                            01519001
015200                                   TO TRUE                        01520001
015210                 MOVE PC-TSYMSG-00047                             01521001
015220                                   TO DP020-MSG-NUMBER            01522001
015230                 SET PS-ERROR                                     01523001
015240                     DP020-MSG-WARNING                            01524001
015250                     DP020-NEXT-ACT-APPL-ERROR                    01525001
015260                                   TO TRUE                        01526001
015270             ELSE                                                 01527001
015280                 SET ASC-ADD-PENDING                              01528001
015290                     ASC-ADD-FROM-SHPPO                           01529001
015300                     ASC-SELECTION-MADE                           01530001
015310                     ASC-USE-SELECTION-QUEUE                      01531001
015320                                   TO TRUE                        01532001
015330                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              01533001
015340                                   TO ASC-NUMBER-OF-SELECTED-ITEMS01534001
015350                 MOVE RC015-NUMBER-OF-TS-ITEMS                    01535001
015360                                   TO ASC-NUMBER-OF-TS-ITEMS      01536001
015370                 MOVE RC015-SEL-QUEUE-NAME                        01537001
015380                                   TO ASC-SEL-QUEUE-NAME          01538001
015390                 PERFORM 1120-PREPARE-LIST-ENTRY                  01539001
015400                 MOVE RC015-OPER-UNT-ID TO ASC-OPER-UNT-ID-N      01540001
015410                                           DK-OPER-UNT-ID         01541001
015420                 MOVE RC015-FCLTY-ID    TO ASC-FCLTY-ID-N         01542001
015430                                           DK-FCLTY-ID            01543001
015440                 IF  ASC-KEY-REC-SEQ-NBR NOT = +0                 01544001
015450                     MOVE PC-TSYMSG-00268                         01545001
015460                                   TO DP020-MSG-NUMBER            01546001
015470                     SET PS-ERROR                                 01547001
015480                         DP020-MSG-FATAL                          01548001
015490                         DP020-NEXT-ACT-APPL-ERROR                01549001
015500                                   TO TRUE                        01550001
015510                 ELSE                                             01551001
015520                     MOVE ASC-KEY-SHIPT-ID                        01552001
015530                                   TO DK-SHIPT-ID                 01553001
015540                     PERFORM 1150-SELECT-TSHIPMT                  01554001
015550                 END-IF                                           01555001
015560             END-IF                                               01556001
015570             END-IF                                               01557001
015580                                                                  01558001
015590         WHEN PC-INTER-APPL-RCVR-PO-LIST                          01559001
015600             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            01560001
015610                 SET DP030-OVERRIDE-GO                            01561001
015620                                   TO TRUE                        01562001
015630                 MOVE PC-TSYMSG-00057                             01563001
015640                                   TO DP020-MSG-NUMBER            01564001
015650                 SET PS-ERROR                                     01565001
015660                     DP020-MSG-WARNING                            01566001
015670                     DP020-NEXT-ACT-APPL-ERROR                    01567001
015680                                   TO TRUE                        01568001
015690             ELSE                                                 01569001
015700             IF  RC015-NUMBER-OF-SELECTED-ITEMS > +1              01570001
015710                 SET DP030-OVERRIDE-GO                            01571001
015720                                   TO TRUE                        01572001
015730                 MOVE PC-TSYMSG-00047                             01573001
015740                                   TO DP020-MSG-NUMBER            01574001
015750                 SET PS-ERROR                                     01575001
015760                     DP020-MSG-WARNING                            01576001
015770                     DP020-NEXT-ACT-APPL-ERROR                    01577001
015780                                   TO TRUE                        01578001
015790             ELSE                                                 01579001
015800                 SET ASC-ADD-PENDING                              01580001
015810                     ASC-ADD-FROM-SHPPO                           01581001
015820                     ASC-SELECTION-MADE                           01582001
015830                     ASC-USE-SELECTION-QUEUE                      01583001
015840                                   TO TRUE                        01584001
015850                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              01585001
015860                                   TO ASC-NUMBER-OF-SELECTED-ITEMS01586001
015870                 MOVE RC015-NUMBER-OF-TS-ITEMS                    01587001
015880                                   TO ASC-NUMBER-OF-TS-ITEMS      01588001
015890                 MOVE RC015-SEL-QUEUE-NAME                        01589001
015900                                   TO ASC-SEL-QUEUE-NAME          01590001
015910                 PERFORM 1120-PREPARE-LIST-ENTRY                  01591001
015920                 MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)             01592001
015930                                        TO ASC-OPER-UNT-ID-N      01593001
015940                                           DK-OPER-UNT-ID         01594001
015950                 MOVE RC013-FCLTY-ID    (ASC-SEL-SUB)             01595001
015960                                        TO ASC-FCLTY-ID-N         01596001
015970                                           DK-FCLTY-ID            01597001
015980                 IF  ASC-KEY-REC-SEQ-NBR NOT = +0                 01598001
015990                     MOVE PC-TSYMSG-00268                         01599001
016000                                   TO DP020-MSG-NUMBER            01600001
016010                     SET PS-ERROR                                 01601001
016020                         DP020-MSG-FATAL                          01602001
016030                         DP020-NEXT-ACT-APPL-ERROR                01603001
016040                                   TO TRUE                        01604001
016050                 ELSE                                             01605001
016060                     MOVE ASC-KEY-SHIPT-ID                        01606001
016070                                   TO DK-SHIPT-ID                 01607001
016080                     PERFORM 1150-SELECT-TSHIPMT                  01608001
016090                 END-IF                                           01609001
016100             END-IF                                               01610001
016110             END-IF                                               01611001
016120                                                                  01612001
016130         WHEN PC-INTER-APPL-RCVR-SHP-LIST                         01613001
016140             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            01614001
016150                 SET ASC-ADD-PENDING                              01615001
016160                     ASC-ADD-FROM-MENU TO TRUE                    01616001
016170                 MOVE '0001-01-01'     TO ASC-KEY-STATUS-DTE      01617001
016180                 MOVE ZEROES           TO ASC-OPER-UNT-ID-N       01618001
016190                                          ASC-FCLTY-ID-N          01619001
016200             ELSE                                                 01620001
016210                IF  RC015-NUMBER-OF-SELECTED-ITEMS > +1           01621001
016220                    SET DP030-OVERRIDE-GO                         01622001
016230                                      TO TRUE                     01623001
016240                    MOVE PC-TSYMSG-00047                          01624001
016250                                      TO DP020-MSG-NUMBER         01625001
016260                    SET PS-ERROR                                  01626001
016270                        DP020-MSG-WARNING                         01627001
016280                        DP020-NEXT-ACT-APPL-ERROR                 01628001
016290                                      TO TRUE                     01629001
016300                ELSE                                              01630001
016310                    SET ASC-ADD-PENDING                           01631001
016320                        ASC-ADD-FROM-SHPPO                        01632001
016330                        ASC-NO-SELECTION-MADE                     01633001
016340                        ASC-USE-SELECTION-QUEUE                   01634001
016350                                      TO TRUE                     01635001
016360                    MOVE RC015-NUMBER-OF-SELECTED-ITEMS           01636001
016370                              TO ASC-NUMBER-OF-SELECTED-ITEMS     01637001
016380                    MOVE RC015-NUMBER-OF-TS-ITEMS                 01638001
016390                                      TO ASC-NUMBER-OF-TS-ITEMS   01639001
016400                    MOVE RC015-SEL-QUEUE-NAME                     01640001
016410                                      TO ASC-SEL-QUEUE-NAME       01641001
016420                    IF  RC015-NUMBER-OF-SELECTED-ITEMS = +0       01642001
016430                        MOVE RC015-TRIP-ID TO ASC-KEY-TRIP-ID     01643001
016440                        PERFORM 4010-SELECT-TVHTRIP               01644001
016450                    ELSE                                          01645001
016460                        PERFORM 1120-PREPARE-LIST-ENTRY           01646001
016470                        MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)      01647001
016480                                            TO ASC-OPER-UNT-ID-N  01648001
016490                                               DK-OPER-UNT-ID     01649001
016500                        MOVE RC013-FCLTY-ID    (ASC-SEL-SUB)      01650001
016510                                               TO ASC-FCLTY-ID-N  01651001
016520                                                  DK-FCLTY-ID     01652001
016530                        IF RC013-CSR-IND(ASC-SEL-SUB) = 'B'       01653001
016540                            MOVE PC-TSYMSG-01065                  01654001
016550                                          TO DP020-MSG-NUMBER     01655001
016560                            SET PS-ERROR                          01656001
016570                                DP020-MSG-FATAL                   01657001
016580                                DP020-NEXT-ACT-APPL-ERROR         01658001
016590                                          TO TRUE                 01659001
016600                        ELSE                                      01660001
016610                            IF  ASC-KEY-REC-SEQ-NBR NOT = +0      01661001
016620                                MOVE PC-TSYMSG-00268              01662001
016630                                              TO DP020-MSG-NUMBER 01663001
016640                                SET PS-ERROR                      01664001
016650                                    DP020-MSG-FATAL               01665001
016660                                    DP020-NEXT-ACT-APPL-ERROR     01666001
016670                                              TO TRUE             01667001
016680                            ELSE                                  01668001
016690                                MOVE ASC-KEY-SHIPT-ID             01669001
016700                                              TO DK-SHIPT-ID      01670001
016710                                PERFORM 1150-SELECT-TSHIPMT       01671001
016720                            END-IF                                01672001
016730                        END-IF                                    01673001
016740                    END-IF                                        01674001
016750                END-IF                                            01675001
016760             END-IF                                               01676001
016770                                                                  01677001
016780         WHEN PC-INTER-APPL-UPDATE                                01678001
016790             IF  RC012-OPER-UNT-ID = ZEROES                       01679001
016800             AND RC012-FCLTY-ID    = ZEROES                       01680001
016810                 MOVE PC-TSYMSG-00815                             01681001
016820                                   TO DP020-MSG-NUMBER            01682001
016830                 SET PS-ERROR                                     01683001
016840                     DP020-MSG-FATAL                              01684001
016850                     DP020-NEXT-ACT-APPL-ERROR                    01685001
016860                                   TO TRUE                        01686001
016870             END-IF                                               01687001
016880             IF  PS-NO-ERROR                                      01688001
016890             AND RC012-PO-NBR = ZEROES                            01689001
016900                 MOVE PC-TSYMSG-00461                             01690001
016910                                   TO DP020-MSG-NUMBER            01691001
016920                 SET PS-ERROR                                     01692001
016930                     DP020-MSG-FATAL                              01693001
016940                     DP020-NEXT-ACT-APPL-ERROR                    01694001
016950                                   TO TRUE                        01695001
016960             END-IF                                               01696001
016970             IF  PS-NO-ERROR                                      01697001
016980             AND RC012-REC-SEQ-NBR = ZEROES                       01698001
016990                 MOVE PC-TSYMSG-00737                             01699001
017000                                   TO DP020-MSG-NUMBER            01700001
017010                 SET PS-ERROR                                     01701001
017020                     DP020-MSG-FATAL                              01702001
017030                     DP020-NEXT-ACT-APPL-ERROR                    01703001
017040                                   TO TRUE                        01704001
017050             END-IF                                               01705001
017060             IF  PS-NO-ERROR                                      01706001
017070                 MOVE RC012-OPER-UNT-ID TO ASC-OPER-UNT-ID-N      01707001
017080                                           DK-OPER-UNT-ID         01708001
017090                 MOVE RC012-FCLTY-ID    TO ASC-FCLTY-ID-N         01709001
017100                                           DK-FCLTY-ID            01710001
017110                 MOVE RC012-PO-NBR      TO DK-PO-NBR              01711001
017120                                           DK-ORD-NBR             01712001
017130                 MOVE RC012-REC-SEQ-NBR TO DK-REC-SEQ-NBR         01713001
017140                 INITIALIZE PV-DB2-COUNT                          01714001
017150                 PERFORM 6100-CHECK-RECEIVER                      01715001
017160                 IF SQLCODE = +100                                01716001
017170                     MOVE PC-TSYMSG-00954                         01717001
017180                                       TO DP020-MSG-NUMBER        01718001
017190                     SET PS-ERROR                                 01719001
017200                         DP020-MSG-FATAL                          01720001
017210                         DP020-NEXT-ACT-APPL-ERROR                01721001
017220                                       TO TRUE                    01722001
017230                 ELSE                                             01723001
017240                     PERFORM 6150-CHECK-RECEIVER                  01724001
017250                     IF SQLCODE = +100                            01725001
017260                         MOVE PC-TSYMSG-00955                     01726001
017270                                           TO DP020-MSG-NUMBER    01727001
017280                         SET PS-ERROR                             01728001
017290                             DP020-MSG-FATAL                      01729001
017300                             DP020-NEXT-ACT-APPL-ERROR            01730001
017310                                           TO TRUE                01731001
017320                     ELSE                                         01732001
017330                         MOVE RECEIV-OPER-UNT-ID                  01733001
017340                                           TO ASC-OPER-UNT-ID-N   01734001
017350                                              DK-OPER-UNT-ID      01735001
017360                         MOVE RECEIV-FCLTY-ID  TO ASC-FCLTY-ID-N  01736001
017370                                                  DK-FCLTY-ID     01737001
017380                         MOVE DK-OPER-UNT-ID                      01738001
017390                                           TO DK-LOCATION-NBR     01739001
017400                         PERFORM 4060-CHECK-DIRECT-STORE          01740001
017410                         INITIALIZE PV-DB2-COUNT                  01741001
017420                         PERFORM 4065-CHECK-EXPENSE-RECEIPT       01742001
017430                         IF  PV-DB2-COUNT = +0                    01743001
017440                             MOVE SPACES  TO ASC-RECEIPT-TYPE-SW  01744001
017450                         ELSE                                     01745001
017460                             SET ASC-EXPENSE-RECEIPT  TO TRUE     01746001
017470                         END-IF                                   01747001
017480                         IF  ASC-DIRECT-STORE                     01748001
017490                         OR  ASC-EXPENSE-RECEIPT                  01749001
017500                             CONTINUE                             01750001
017510                         ELSE                                     01751001
017520                             PERFORM 1130-CHECK-TRIPS             01752001
017530                             IF  SQLCODE = +100                   01753001
017540                                 MOVE PC-TSYMSG-00743             01754001
017550                                              TO DP020-MSG-NUMBER 01755001
017560                                 SET PS-ERROR                     01756001
017570                                     DP020-NEXT-ACT-APPL-ERROR    01757001
017580                                     DP020-MSG-FATAL              01758001
017590                                                  TO TRUE         01759001
017600                             END-IF                               01760001
017610                         END-IF                                   01761001
017620                     END-IF                                       01762001
017630                 END-IF                                           01763001
017640             END-IF                                               01764001
017650             IF  PS-NO-ERROR                                      01765001
017660                 INITIALIZE PV-DB2-COUNT                          01766001
017670                 PERFORM 1140-CHECK-STATUS                        01767001
017680                 IF  PV-DB2-COUNT > +0                            01768001
017690                     MOVE PC-TSYMSG-00463                         01769001
017700                                 TO DP020-MSG-NUMBER              01770001
017710                     SET PS-ERROR                                 01771001
017720                         DP020-NEXT-ACT-APPL-ERROR                01772001
017730                         DP020-MSG-FATAL                          01773001
017740                                 TO TRUE                          01774001
017750                 END-IF                                           01775001
017760             END-IF                                               01776001
017770             IF  PS-NO-ERROR                                      01777001
017780                 MOVE RC012-REC-SEQ-NBR                           01778001
017790                                   TO ASC-KEY-REC-SEQ-NBR         01779001
017800                                      ASC-REC-SEQ-NBR             01780001
017810                 MOVE RC012-PO-NBR TO ASC-KEY-PO-NBR              01781001
017820                                      ASC-PO-NBR-N                01782001
017830                 SET ASC-UPDATE-PENDING                           01783001
017840                                   TO TRUE                        01784001
017850             END-IF                                               01785001
017860                                                                  01786001
017870         WHEN PC-INTER-APPL-LIST-UPDATE                           01787001
017880             IF  RC015-NUMBER-OF-SELECTED-ITEMS = ZERO            01788001
017890                 SET DP030-OVERRIDE-GO                            01789001
017900                                   TO TRUE                        01790001
017910                 MOVE PC-TSYMSG-00057                             01791001
017920                                   TO DP020-MSG-NUMBER            01792001
017930                 SET PS-ERROR                                     01793001
017940                     DP020-MSG-WARNING                            01794001
017950                     DP020-NEXT-ACT-APPL-ERROR                    01795001
017960                                   TO TRUE                        01796001
017970             ELSE                                                 01797001
017980                 SET ASC-USE-SELECTION-QUEUE                      01798001
017990                                   TO TRUE                        01799001
018000                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              01800001
018010                                   TO ASC-NUMBER-OF-SELECTED-ITEMS01801001
018020                 MOVE RC015-NUMBER-OF-TS-ITEMS                    01802001
018030                                   TO ASC-NUMBER-OF-TS-ITEMS      01803001
018040                 MOVE RC015-SEL-QUEUE-NAME                        01804001
018050                                   TO ASC-SEL-QUEUE-NAME          01805001
018060                 PERFORM 1120-PREPARE-LIST-ENTRY                  01806001
018070                 MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR            01807001
018080                                             DK-ORD-NBR           01808001
018090                 MOVE ASC-KEY-REC-SEQ-NBR TO DK-REC-SEQ-NBR       01809001
018100                 MOVE ASC-OPER-UNT-ID-N   TO DK-OPER-UNT-ID       01810001
018110                 MOVE ASC-FCLTY-ID-N      TO DK-FCLTY-ID          01811001
018120                 IF  PS-NO-ERROR                                  01812001
018130                 AND ASC-KEY-REC-SEQ-NBR = ZEROES                 01813001
018140                     MOVE PC-TSYMSG-00466                         01814001
018150                                       TO DP020-MSG-NUMBER        01815001
018160                     SET PS-ERROR                                 01816001
018170                         DP020-MSG-FATAL                          01817001
018180                         DP020-NEXT-ACT-APPL-ERROR                01818001
018190                                       TO TRUE                    01819001
018200                 END-IF                                           01820001
018210                 IF  PS-NO-ERROR                                  01821001
018220                     INITIALIZE PV-DB2-COUNT                      01822001
018230                     MOVE DK-OPER-UNT-ID TO DK-LOCATION-NBR       01823001
018240                     PERFORM 4060-CHECK-DIRECT-STORE              01824001
018250                     INITIALIZE PV-DB2-COUNT                      01825001
018260                     PERFORM 4065-CHECK-EXPENSE-RECEIPT           01826001
018270                     IF  PV-DB2-COUNT = +0                        01827001
018280                         MOVE SPACES     TO ASC-RECEIPT-TYPE-SW   01828001
018290                     ELSE                                         01829001
018300                         SET ASC-EXPENSE-RECEIPT                  01830001
018310                                         TO TRUE                  01831001
018320                     END-IF                                       01832001
018330                 END-IF                                           01833001
018340                 IF  PS-NO-ERROR                                  01834001
018350                     IF  ASC-DIRECT-STORE                         01835001
018360                     OR  ASC-EXPENSE-RECEIPT                      01836001
018370                         CONTINUE                                 01837001
018380                     ELSE                                         01838001
018390                         PERFORM 1130-CHECK-TRIPS                 01839001
018400                         IF  SQLCODE = +100                       01840001
018410                             MOVE PC-TSYMSG-00743                 01841001
018420                                         TO DP020-MSG-NUMBER      01842001
018430                             SET PS-ERROR                         01843001
018440                                 DP020-NEXT-ACT-APPL-ERROR        01844001
018450                                 DP020-MSG-FATAL                  01845001
018460                                         TO TRUE                  01846001
018470                         END-IF                                   01847001
018480                     END-IF                                       01848001
018490                 END-IF                                           01849001
018500                 IF  PS-NO-ERROR                                  01850001
018510                     INITIALIZE PV-DB2-COUNT                      01851001
018520                     PERFORM 1140-CHECK-STATUS                    01852001
018530                     IF  PV-DB2-COUNT > +0                        01853001
018540                         MOVE PC-TSYMSG-00463                     01854001
018550                                     TO DP020-MSG-NUMBER          01855001
018560                         SET PS-ERROR                             01856001
018570                             DP020-NEXT-ACT-APPL-ERROR            01857001
018580                             DP020-MSG-FATAL                      01858001
018590                                     TO TRUE                      01859001
018600                     END-IF                                       01860001
018610                 END-IF                                           01861001
018620                 IF  PS-NO-ERROR                                  01862001
018630                     SET ASC-UPDATE-PENDING                       01863001
018640                                     TO TRUE                      01864001
018650                 ELSE                                             01865001
018660                     SET RC013-ERR (ASC-SEL-SUB)                  01866001
018670                                     TO TRUE                      01867001
018680                     PERFORM 9200-REWRITE-SEL-QUEUE               01868001
018690                 END-IF                                           01869001
018700             END-IF                                               01870001
018710                                                                  01871001
018720         WHEN OTHER                                               01872001
018730             SET PS-ERROR                                         01873001
018740                 DP020-MSG-FATAL                                  01874001
018750                 DP020-NEXT-ACT-APPL-ERROR                        01875001
018760                                  TO TRUE                         01876001
018770                                                                  01877001
018780     END-EVALUATE.                                                01878001
018790                                                                  01879001
018800     IF ASC-ADD-PENDING                                           01880001
018810         EXEC CICS ASSIGN                                         01881001
018820                   APPLID(PV-SYSTEM-ID)                           01882001
018830         END-EXEC                                                 01883001
018840                                                                  01884001
018850         MOVE DP020-LOCATION-NBR                                  01885003
018860                          TO ASC-COPER-UNT-ID-N                   01886003
018870                             ASC-CRE-OPER-UNT-ID-N                01887003
018880                             CURR-OPER-UNT-ID                     01888003
018890         MOVE 1           TO ASC-CFCLTY-ID-N                      01889001
018900                             ASC-CRE-FCLTY-ID-N                   01890001
018910                             CURR-FCLTY-ID                        01891001
018920     END-IF.                                                      01892001
018930*----------------------------------------------------------------*01893001
018940*    ENTRY IS FROM A LIST.  GET THE KEY INFORMATION FROM THE     *01894001
018950*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *01895001
018960*----------------------------------------------------------------*01896001
018970 1120-PREPARE-LIST-ENTRY.                                         01897001
018980                                                                  01898001
018990     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                01899001
019000     MOVE ZERO                     TO ASC-SEL-ITEM.               01900001
019010     PERFORM 2110-GET-NEXT-RECORD.                                01901001
019020                                                                  01902001
019030/                                                                 01903001
019040*----------------------------------------------------------------*01904001
019050*    CHECK TO SEE IF MULTIPLE TRIPS/SHIPMENTS EXIST              *01905001
019060*----------------------------------------------------------------*01906001
019070 1130-CHECK-TRIPS.                                                01907001
019080                                                                  01908001
019090     PERFORM                                                      01909001
019100         WITH TEST AFTER                                          01910001
019110         VARYING PV-RETRY-COUNTER                                 01911001
019120         FROM 1 BY 1                                              01912001
019130         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               01913001
019140             OR (SQLCODE = +0)                                    01914001
019150             OR (SQLCODE = +100)                                  01915001
019160             OR (SQLCODE = -811))                                 01916001
019170                                                                  01917001
019180         EXEC SQL                                                 01918001
019190              SELECT DISTINCT                                     01919001
019200                     B.SHIPT_ID                                   01920001
019210                    ,C.TRIP_ID                                    01921001
019220                INTO :SHIPMT-SHIPT-ID                             01922001
019230                    ,:VHTRIP-TRIP-ID                              01923001
019240                FROM TSHPTPO A                                    01924001
019250                    ,TSHIPMT B                                    01925001
019260                    ,TVHTRIP C                                    01926001
019270                    ,TTRIPST D                                    01927001
019280                    ,TVEHICL E                                    01928001
019290               WHERE A.PO_NBR      = :DK-PO-NBR                   01929001
019300                 AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR              01930001
019310                 AND A.SHIPT_ID = B.SHIPT_ID                      01931001
019320                 AND B.TRIP_ID  = C.TRIP_ID                       01932001
019330                 AND C.TRIP_ID  = D.TRIP_ID                       01933001
019340                 AND D.TRIP_ID  = E.CURR_TRIP_ID                  01934001
019350         END-EXEC                                                 01935001
019360                                                                  01936001
019370         EVALUATE TRUE                                            01937001
019380             WHEN SQLCODE = +0                                    01938001
019390                  MOVE SHIPMT-SHIPT-ID TO ASC-KEY-SHIPT-ID        01939001
019400                  MOVE VHTRIP-TRIP-ID  TO ASC-KEY-TRIP-ID         01940001
019410             WHEN SQLCODE = -811                                  01941001
019420                  SET ASC-MULT-SHIP TO TRUE                       01942001
019430                  PERFORM 1135-GET-PRIM-SHIP                      01943001
019440                                                                  01944001
019450             WHEN SQLCODE = +100                                  01945001
019460             WHEN SQLCODE = -904                                  01946001
019470             WHEN SQLCODE = -913                                  01947001
019480                  CONTINUE                                        01948001
019490                                                                  01949001
019500             WHEN SQLWARN0 NOT = SPACES                           01950001
019510             WHEN SQLCODE < +0                                    01951001
019520             WHEN SQLCODE > +0                                    01952001
019530                  INITIALIZE PV-MESSAGE                           01953001
019540                  MOVE DK-PO-NBR  TO PV-MESSAGE1                  01954001
019550                  MOVE DK-REC-SEQ-NBR TO PV-MESSAGE2              01955001
019560                  MOVE '1130-CHECK-TRIPS  '                       01956001
019570                                  TO DP013-PARAGRAPH              01957001
019580                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         01958001
019590                                  TO DP013-MESSAGE-TEXT (1)       01959001
019600                  MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)       01960001
019610                  MOVE SQLCA      TO DP013-SQLCA                  01961001
019620                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     01962001
019630                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (2)     01963001
019640                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (3)     01964001
019650                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (4)     01965001
019660                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (5)     01966001
019670                  SET DP013-DB2-ABEND                             01967001
019680                      DP013-XCTL-DISPLAY-RESTART                  01968001
019690                                  TO TRUE                         01969001
019700                  PERFORM DP013-0000-PROCESS-ABEND                01970001
019710         END-EVALUATE                                             01971001
019720     END-PERFORM.                                                 01972001
019730                                                                  01973001
019740     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        01974001
019750             AND (SQLCODE = -904 OR -913)                         01975001
019760         MOVE '1130-CHECK-TRIPS  '                                01976001
019770                                  TO DP013-PARAGRAPH              01977001
019780         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR TRIPS  '         01978001
019790                                  TO DP013-MESSAGE-TEXT (1)       01979001
019800         MOVE SQLCA               TO DP013-SQLCA                  01980001
019810         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     01981001
019820         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (2)     01982001
019830         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (3)     01983001
019840         MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (4)     01984001
019850         MOVE 'TVEHICL '          TO DP013-DB2-TABLE-NAME (5)     01985001
019860         SET DP013-DB2-ABEND                                      01986001
019870             DP013-XCTL-DISPLAY-RESTART                           01987001
019880                                  TO TRUE                         01988001
019890         PERFORM DP013-0000-PROCESS-ABEND                         01989001
019900     END-IF.                                                      01990001
019910                                                                  01991001
019920     IF  SQLCODE = +100                                           01992001
019930         PERFORM                                                  01993001
019940             WITH TEST AFTER                                      01994001
019950             VARYING PV-RETRY-COUNTER                             01995001
019960             FROM 1 BY 1                                          01996001
019970             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           01997001
019980                 OR (SQLCODE = +0)                                01998001
019990                 OR (SQLCODE = +100)                              01999001
020000                 OR (SQLCODE = -811))                             02000001
020010                                                                  02001001
020020             EXEC SQL                                             02002001
020030                  SELECT DISTINCT                                 02003001
020040                         B.SHIPT_ID                               02004001
020050                        ,C.TRIP_ID                                02005001
020060                    INTO :SHIPMT-SHIPT-ID                         02006001
020070                        ,:VHTRIP-TRIP-ID                          02007001
020080                    FROM TSHPTPO A                                02008001
020090                        ,TSHIPMT B                                02009001
020100                        ,TVHTRIP C                                02010001
020110                        ,TTRIPST D                                02011001
020120                        ,TTRSTYP E                                02012001
020130                   WHERE A.PO_NBR      = :DK-PO-NBR               02013001
020140                     AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR          02014001
020150                     AND A.SHIPT_ID = B.SHIPT_ID                  02015001
020160                     AND B.TRIP_ID  = C.TRIP_ID                   02016001
020170                     AND C.TRIP_ID  = D.TRIP_ID                   02017001
020180                     AND D.TRIP_STATUS_CDE = E.TRIP_STATUS_CDE    02018001
020190                     AND E.PRTY_CDE =                             02019001
020200                      (SELECT MAX(G.PRTY_CDE)                     02020001
020210                         FROM TTRIPST F                           02021001
020220                             ,TTRSTYP G                           02022001
020230                        WHERE F.TRIP_ID       = B.TRIP_ID         02023001
020240                        AND F.TRIP_STATUS_CDE = G.TRIP_STATUS_CDE)02024001
020250             END-EXEC                                             02025001
020260                                                                  02026001
020270             EVALUATE TRUE                                        02027001
020280                 WHEN SQLCODE = +0                                02028001
020290                      MOVE SHIPMT-SHIPT-ID TO ASC-KEY-SHIPT-ID    02029001
020300                      MOVE VHTRIP-TRIP-ID  TO ASC-KEY-TRIP-ID     02030001
020310                 WHEN SQLCODE = -811                              02031001
020320                      SET ASC-MULT-SHIP TO TRUE                   02032001
020330                      PERFORM 1135-GET-PRIM-SHIP                  02033001
020340                                                                  02034001
020350                 WHEN SQLCODE = +100                              02035001
020360                 WHEN SQLCODE = -904                              02036001
020370                 WHEN SQLCODE = -913                              02037001
020380                      CONTINUE                                    02038001
020390                                                                  02039001
020400                 WHEN SQLWARN0 NOT = SPACES                       02040001
020410                 WHEN SQLCODE < +0                                02041001
020420                 WHEN SQLCODE > +0                                02042001
020430                      INITIALIZE PV-MESSAGE                       02043001
020440                      MOVE DK-PO-NBR    TO PV-MESSAGE1            02044001
020450                      MOVE DK-REC-SEQ-NBR TO PV-MESSAGE2          02045001
020460                      MOVE '1130-CHECK-TRIPS  '                   02046001
020470                                      TO DP013-PARAGRAPH          02047001
020480                      MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '     02048001
020490                                      TO DP013-MESSAGE-TEXT (1)   02049001
020500                      MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)   02050001
020510                      MOVE SQLCA      TO DP013-SQLCA              02051001
020520                      MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1) 02052001
020530                      MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (2) 02053001
020540                      MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (3) 02054001
020550                      MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (4) 02055001
020560                      MOVE 'TTRSTYP ' TO DP013-DB2-TABLE-NAME (5) 02056001
020570                      SET DP013-DB2-ABEND                         02057001
020580                          DP013-XCTL-DISPLAY-RESTART              02058001
020590                                      TO TRUE                     02059001
020600                      PERFORM DP013-0000-PROCESS-ABEND            02060001
020610             END-EVALUATE                                         02061001
020620         END-PERFORM                                              02062001
020630                                                                  02063001
020640         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    02064001
020650             AND (SQLCODE = -904 OR -913)                         02065001
020660             MOVE '1130-CHECK-TRIPS  '                            02066001
020670                                      TO DP013-PARAGRAPH          02067001
020680             MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR TRIPS  '     02068001
020690                                      TO DP013-MESSAGE-TEXT (1)   02069001
020700             MOVE SQLCA               TO DP013-SQLCA              02070001
020710             MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1) 02071001
020720             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (2) 02072001
020730             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (3) 02073001
020740             MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (4) 02074001
020750             MOVE 'TTRSTYP '          TO DP013-DB2-TABLE-NAME (5) 02075001
020760             SET DP013-DB2-ABEND                                  02076001
020770                 DP013-XCTL-DISPLAY-RESTART                       02077001
020780                                      TO TRUE                     02078001
020790             PERFORM DP013-0000-PROCESS-ABEND                     02079001
020800         END-IF                                                   02080001
020810     END-IF.                                                      02081001
020820                                                                  02082001
020830/                                                                 02083001
020840*----------------------------------------------------------------*02084001
020850*    IN THE CASE OF MULTIPLE SHIPMENTS PER RECEIVER THIS PARAGRAPH02085001
020860*    WILL GET THE PRIMARY SHIPMENT                                02086001
020870*----------------------------------------------------------------*02087001
020880 1135-GET-PRIM-SHIP.                                              02088001
020890                                                                  02089001
020900     PERFORM                                                      02090001
020910         WITH TEST AFTER                                          02091001
020920         VARYING PV-RETRY-COUNTER                                 02092001
020930         FROM 1 BY 1                                              02093001
020940         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               02094001
020950             OR (SQLCODE = +0))                                   02095001
020960                                                                  02096001
020970         EXEC SQL                                                 02097001
020980              SELECT DISTINCT                                     02098001
020990                     B.SHIPT_ID                                   02099001
021000                    ,C.TRIP_ID                                    02100001
021010                INTO :SHIPMT-SHIPT-ID                             02101001
021020                    ,:VHTRIP-TRIP-ID                              02102001
021030                FROM TSHPTPO A                                    02103001
021040                    ,TSHIPMT B                                    02104001
021050                    ,TVHTRIP C                                    02105001
021060               WHERE A.PO_NBR      = :DK-PO-NBR                   02106001
021070                 AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR              02107001
021080                 AND A.SHIPT_ID = B.SHIPT_ID                      02108001
021090                 AND B.TRIP_ID  = C.TRIP_ID                       02109001
021100                 AND A.PRIM_SHIPT_IND = 'Y'                       02110001
021110         END-EXEC                                                 02111001
021120                                                                  02112001
021130         EVALUATE TRUE                                            02113001
021140             WHEN SQLCODE = +0                                    02114001
021150                  MOVE SHIPMT-SHIPT-ID TO ASC-KEY-SHIPT-ID        02115001
021160                  MOVE VHTRIP-TRIP-ID  TO ASC-KEY-TRIP-ID         02116001
021170             WHEN SQLCODE = -904                                  02117001
021180             WHEN SQLCODE = -913                                  02118001
021190                  CONTINUE                                        02119001
021200                                                                  02120001
021210             WHEN SQLWARN0 NOT = SPACES                           02121001
021220             WHEN SQLCODE < +0                                    02122001
021230             WHEN SQLCODE > +0                                    02123001
021240                  INITIALIZE PV-MESSAGE                           02124001
021250                  MOVE DK-PO-NBR      TO PV-MESSAGE1              02125001
021260                  MOVE DK-REC-SEQ-NBR TO PV-MESSAGE2              02126001
021270                  MOVE '1135-GET-PRIM-SHIP'                       02127001
021280                                  TO DP013-PARAGRAPH              02128001
021290                  MOVE 'UNSUCCESSFUL SELECT'                      02129001
021300                                  TO DP013-MESSAGE-TEXT (1)       02130001
021310                  MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)       02131001
021320                  MOVE SQLCA      TO DP013-SQLCA                  02132001
021330                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     02133001
021340                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     02134001
021350                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     02135001
021360                  SET DP013-DB2-ABEND                             02136001
021370                      DP013-XCTL-DISPLAY-RESTART                  02137001
021380                                  TO TRUE                         02138001
021390                  PERFORM DP013-0000-PROCESS-ABEND                02139001
021400         END-EVALUATE                                             02140001
021410     END-PERFORM.                                                 02141001
021420                                                                  02142001
021430     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        02143001
021440             AND (SQLCODE = -904 OR -913)                         02144001
021450         MOVE '1135-GET-PRIM-SHIP'                                02145001
021460                                  TO DP013-PARAGRAPH              02146001
021470         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR STATUS '         02147001
021480                                  TO DP013-MESSAGE-TEXT (1)       02148001
021490         MOVE SQLCA               TO DP013-SQLCA                  02149001
021500         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     02150001
021510         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     02151001
021520         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)     02152001
021530         SET DP013-DB2-ABEND                                      02153001
021540             DP013-XCTL-DISPLAY-RESTART                           02154001
021550                                  TO TRUE                         02155001
021560         PERFORM DP013-0000-PROCESS-ABEND                         02156001
021570     END-IF.                                                      02157001
021580                                                                  02158001
021590/                                                                 02159001
021600*----------------------------------------------------------------*02160001
021610*    CHECK TO SEE IF VALID STATUS FOR UPDATE                     *02161001
021620*----------------------------------------------------------------*02162001
021630 1140-CHECK-STATUS.                                               02163001
021640                                                                  02164001
021650     PERFORM                                                      02165001
021660         WITH TEST AFTER                                          02166001
021670         VARYING PV-RETRY-COUNTER                                 02167001
021680         FROM 1 BY 1                                              02168001
021690         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               02169001
021700             OR (SQLCODE = +0)                                    02170001
021710             OR (SQLCODE = +100))                                 02171001
021720                                                                  02172001
021730         EXEC SQL                                                 02173001
021740              SELECT COUNT(*)                                     02174001
021750                INTO :PV-DB2-COUNT                                02175001
021760                FROM TRECEIV                                      02176001
021770               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             02177001
021780                 AND FCLTY_ID       = :DK-FCLTY-ID                02178001
021790                 AND ORD_NBR        = :DK-ORD-NBR                 02179001
021800                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             02180001
021810                 AND VER_STATUS_CDE = 'A'                         02181001
021820                 AND STATUS_CDE     = 'VE'                        02182001
021830         END-EXEC                                                 02183001
021840                                                                  02184001
021850         EVALUATE TRUE                                            02185001
021860             WHEN SQLCODE = +0                                    02186001
021870             WHEN SQLCODE = +100                                  02187001
021880             WHEN SQLCODE = -904                                  02188001
021890             WHEN SQLCODE = -913                                  02189001
021900                  CONTINUE                                        02190001
021910                                                                  02191001
021920             WHEN SQLWARN0 NOT = SPACES                           02192001
021930             WHEN SQLCODE < +0                                    02193001
021940             WHEN SQLCODE > +0                                    02194001
021950                  INITIALIZE PV-MESSAGE                           02195001
021960                  MOVE DK-OPER-UNT-ID TO PV-MESSAGE1              02196001
021970                  MOVE DK-FCLTY-ID    TO PV-MESSAGE2              02197001
021980                  MOVE DK-ORD-NBR     TO PV-MESSAGE3              02198001
021990                  MOVE '1140-CHECK-STATUS'                        02199001
022000                                  TO DP013-PARAGRAPH              02200001
022010                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         02201001
022020                                  TO DP013-MESSAGE-TEXT (1)       02202001
022030                  MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)       02203001
022040                  MOVE DK-REC-SEQ-NBR                             02204001
022050                                  TO DP013-MESSAGE-TEXT (3)       02205001
022060                  MOVE SQLCA      TO DP013-SQLCA                  02206001
022070                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     02207001
022080                  SET DP013-DB2-ABEND                             02208001
022090                      DP013-XCTL-DISPLAY-RESTART                  02209001
022100                                  TO TRUE                         02210001
022110                  PERFORM DP013-0000-PROCESS-ABEND                02211001
022120         END-EVALUATE                                             02212001
022130     END-PERFORM.                                                 02213001
022140                                                                  02214001
022150     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        02215001
022160             AND (SQLCODE = -904 OR -913)                         02216001
022170         MOVE '1140-CHECK-STATUS'                                 02217001
022180                                  TO DP013-PARAGRAPH              02218001
022190         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR STATUS '         02219001
022200                                  TO DP013-MESSAGE-TEXT (1)       02220001
022210         MOVE SQLCA               TO DP013-SQLCA                  02221001
022220         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     02222001
022230         SET DP013-DB2-ABEND                                      02223001
022240             DP013-XCTL-DISPLAY-RESTART                           02224001
022250                                  TO TRUE                         02225001
022260         PERFORM DP013-0000-PROCESS-ABEND                         02226001
022270     END-IF.                                                      02227001
022280                                                                  02228001
022290/                                                                 02229001
022300*----------------------------------------------------------------*02230001
022310*    RETREIVE SHIPMENT INFO                                      *02231001
022320*----------------------------------------------------------------*02232001
022330* ADDED CARR-AUTH-ID BELOW WR40574 02-09-2012 CLT                 02233001
022340 1150-SELECT-TSHIPMT.                                             02234001
022350                                                                  02235001
022360     PERFORM                                                      02236001
022370         WITH TEST AFTER                                          02237001
022380         VARYING PV-RETRY-COUNTER                                 02238001
022390         FROM 1 BY 1                                              02239001
022400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               02240001
022410             OR (SQLCODE = +0))                                   02241001
022420                                                                  02242001
022430         EXEC SQL                                                 02243001
022440              SELECT DISTINCT                                     02244001
022450                     A.PRO_NBR                                    02245001
022460                    ,A.BOL_NBR                                    02246001
022470                    ,B.OWNER_SCAC_ID                              02247001
022480                    ,B.VEH_NBR                                    02248001
022490                    ,B.TRIP_ID                                    02249001
022500                    ,C.STATUS_DTE                                 02250001
022510                    ,A.CARR_AUTH_ID                               02251001
022520                INTO :SHIPMT-PRO-NBR                              02252001
022530                    ,:SHIPMT-BOL-NBR                              02253001
022540                    ,:VHTRIP-OWNER-SCAC-ID                        02254001
022550                    ,:VHTRIP-VEH-NBR                              02255001
022560                       :DN-VEH-NBR                                02256001
022570                    ,:VHTRIP-TRIP-ID                              02257001
022580                    ,:TRIPST-STATUS-DTE                           02258001
022590                    ,:SHIPMT-CARR-AUTH-ID                         02259001
022600                FROM TSHIPMT A                                    02260001
022610                    ,TVHTRIP B                                    02261001
022620                    ,TTRIPST C                                    02262001
022630               WHERE A.SHIPT_ID = :DK-SHIPT-ID                    02263001
022640                 AND C.STATUS_DTE =                               02264001
022650                      (SELECT MAX(E.STATUS_DTE)                   02265001
022660                       FROM TTRIPST E                             02266001
022670                       WHERE E.TRIP_ID = A.TRIP_ID)               02267001
022680                 AND A.TRIP_ID  = B.TRIP_ID                       02268001
022690                 AND B.TRIP_ID  = C.TRIP_ID                       02269001
022700         END-EXEC                                                 02270001
022710                                                                  02271001
022720         EVALUATE TRUE                                            02272001
022730             WHEN SQLCODE = +0                                    02273001
022740*3/05 - BEGIN                                                     02274001
022750                  IF  DN-VEH-NBR  =  -1                           02275001
022760                      MOVE  SPACES     TO  VHTRIP-VEH-NBR         02276001
022770                      SET DP030-OVERRIDE-GO  TO  TRUE             02277001
022780                      MOVE PC-TSYMSG-01065                        02278001
022790                                       TO DP020-MSG-NUMBER        02279001
022800                      SET PS-ERROR                                02280001
022810                          DP020-MSG-WARNING                       02281001
022820                          DP020-NEXT-ACT-APPL-ERROR               02282001
022830                                       TO TRUE                    02283001
022840*3/05 - END                                                       02284001
022850                  END-IF                                          02285001
022860                  MOVE SHIPMT-PRO-NBR  TO ASC-KEY-PRO-NBR         02286001
022870                  MOVE SHIPMT-BOL-NBR  TO ASC-KEY-BOL-NBR         02287001
022880* WR40574 02-09-2012 CLT START                                    02288001
022890                  MOVE SHIPMT-CARR-AUTH-ID                        02289001
022900                                       TO ASC-CARR-AUTH-ID        02290001
022910* WR40574 02-09-2012 CLT END                                      02291001
022920                  MOVE VHTRIP-VEH-NBR  TO ASC-KEY-VEH-NBR         02292001
022930                  MOVE VHTRIP-OWNER-SCAC-ID                       02293001
022940                                       TO ASC-KEY-OWNER-SCAC-ID   02294001
022950                  MOVE VHTRIP-TRIP-ID  TO ASC-KEY-TRIP-ID         02295001
022960                  MOVE TRIPST-STATUS-DTE TO ASC-KEY-STATUS-DTE    02296001
022970                                                                  02297001
022980             WHEN SQLCODE = -904                                  02298001
022990             WHEN SQLCODE = -913                                  02299001
023000                  CONTINUE                                        02300001
023010                                                                  02301001
023020             WHEN SQLWARN0 NOT = SPACES                           02302001
023030             WHEN SQLCODE < +0                                    02303001
023040             WHEN SQLCODE > +0                                    02304001
023050                  MOVE '1150-SELECT-TSHIPMT     '                 02305001
023060                                  TO DP013-PARAGRAPH              02306001
023070                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         02307001
023080                                  TO DP013-MESSAGE-TEXT (1)       02308001
023090                  MOVE DK-SHIPT-ID TO DP013-MESSAGE-TEXT (2)      02309001
023100                  STRING 'FORMAT IND = '                          02310001
023110                         DP020-INT-APPL-FORMAT-IND                02311001
023120                         DELIMITED BY SIZE                        02312001
023130                         INTO DP013-MESSAGE-TEXT(3)               02313001
023140                  MOVE SQLCA      TO DP013-SQLCA                  02314001
023150                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     02315001
023160                  SET DP013-DB2-ABEND                             02316001
023170                      DP013-XCTL-DISPLAY-RESTART                  02317001
023180                                  TO TRUE                         02318001
023190                  PERFORM DP013-0000-PROCESS-ABEND                02319001
023200         END-EVALUATE                                             02320001
023210     END-PERFORM.                                                 02321001
023220                                                                  02322001
023230     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        02323001
023240             AND (SQLCODE = -904 OR -913)                         02324001
023250         MOVE '1150-SELECT-TSHIPMT     '                          02325001
023260                                  TO DP013-PARAGRAPH              02326001
023270         MOVE 'MAX RETRIES EXCEEDED FOR SELECT ON TSHIPMT '       02327001
023280                                  TO DP013-MESSAGE-TEXT (1)       02328001
023290         MOVE SQLCA               TO DP013-SQLCA                  02329001
023300         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     02330001
023310         SET DP013-DB2-ABEND                                      02331001
023320             DP013-XCTL-DISPLAY-RESTART                           02332001
023330                                  TO TRUE                         02333001
023340         PERFORM DP013-0000-PROCESS-ABEND                         02334001
023350     END-IF.                                                      02335001
023360                                                                  02336001
023370/                                                                 02337001
023380*----------------------------------------------------------------*02338001
023390*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*02339001
023400*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*02340001
023410*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *02341001
023420*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *02342001
023430*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *02343001
023440*----------------------------------------------------------------*02344001
023450 2000-PROCESS-PANEL.                                              02345001
023460                                                                  02346001
023470     EVALUATE TRUE                                                02347001
023480                                                                  02348001
023490         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 02349001
023500             SET ASC-VND-DT-CHG-NOT-PENDING                       02350001
023510                 ASC-VND-DT-NOT-CHGD       TO TRUE                02351001
023520             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02352001
023530             IF ASC-PO-NBR-OLD = ZEROES AND                       02353001
023540                ASC-KEY-PO-NBR = ZEROES                           02354001
023550                SET PS-ERROR                                      02355001
023560                    DP020-MSG-FATAL        TO TRUE                02356001
023570                MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER    02357001
023580                MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA             02358001
023590                MOVE DP015-RED             TO APONBRC             02359001
023600                MOVE DP015-REVERSE         TO APONBRH             02360001
023610                MOVE -1                    TO APONBRL             02361001
023620                SET DP030-SET-CURSOR-APPL-1                       02362001
023630                                           TO TRUE                02363001
023640                SET DP030-OVERRIDE-GO TO TRUE                     02364001
023650             ELSE                                                 02365001
023660                PERFORM 8000-FORMAT-COMMAREA                      02366001
023670             END-IF                                               02367001
023680                                                                  02368001
023690         WHEN DP020-SRC-AID = DP016-CLEAR                         02369001
023700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02370001
023710             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02371001
023720                                                                  02372001
023730         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02373001
023740             PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT      02374001
023750             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02375001
023760             PERFORM 3200-RESET-ATTRIBUTES                        02376001
023770             PERFORM 3500-SAVE-SCREEN-FIELDS                      02377001
023780                                                                  02378001
023790         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             02379001
023800              IF ASC-USE-SELECTION-QUEUE                          02380001
023810                 PERFORM 2110-GET-NEXT-RECORD                     02381001
023820                 MOVE ASC-OPER-UNT-ID-N   TO DK-OPER-UNT-ID       02382001
023830                 MOVE ASC-FCLTY-ID-N      TO DK-FCLTY-ID          02383001
023840                 MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR            02384001
023850                                             DK-ORD-NBR           02385001
023860                 MOVE ASC-KEY-REC-SEQ-NBR TO DK-REC-SEQ-NBR       02386001
023870                 INITIALIZE PV-DB2-COUNT                          02387001
023880                 MOVE DK-OPER-UNT-ID      TO DK-LOCATION-NBR      02388001
023890                 PERFORM 4060-CHECK-DIRECT-STORE                  02389001
023900                 INITIALIZE PV-DB2-COUNT                          02390001
023910                 PERFORM 4065-CHECK-EXPENSE-RECEIPT               02391001
023920                 IF  PV-DB2-COUNT = +0                            02392001
023930                     MOVE SPACES          TO ASC-RECEIPT-TYPE-SW  02393001
023940                 ELSE                                             02394001
023950                     SET ASC-EXPENSE-RECEIPT                      02395001
023960                                          TO TRUE                 02396001
023970                 END-IF                                           02397001
023980                 IF  PS-NO-ERROR                                  02398001
023990                     IF  ASC-DIRECT-STORE                         02399001
024000                     OR  ASC-EXPENSE-RECEIPT                      02400001
024010                         CONTINUE                                 02401001
024020                     ELSE                                         02402001
024030                         PERFORM 1130-CHECK-TRIPS                 02403001
024040                         IF  SQLCODE = +100                       02404001
024050                             MOVE PC-TSYMSG-00743                 02405001
024060                                             TO DP020-MSG-NUMBER  02406001
024070                             SET PS-ERROR                         02407001
024080                                 DP020-NEXT-ACT-APPL-ERROR        02408001
024090                                 DP020-MSG-FATAL                  02409001
024100                                             TO TRUE              02410001
024110                         END-IF                                   02411001
024120                     END-IF                                       02412001
024130                 END-IF                                           02413001
024140                 IF  PS-NO-ERROR                                  02414001
024150                     INITIALIZE PV-DB2-COUNT                      02415001
024160                     PERFORM 1140-CHECK-STATUS                    02416001
024170                     IF  PV-DB2-COUNT > +0                        02417001
024180                         MOVE PC-TSYMSG-00463 TO DP020-MSG-NUMBER 02418001
024190                         SET PS-ERROR                             02419001
024200                             DP020-NEXT-ACT-APPL-ERROR            02420001
024210                             DP020-MSG-FATAL  TO TRUE             02421001
024220                     END-IF                                       02422001
024230                 END-IF                                           02423001
024240                 IF  PS-ERROR                                     02424001
024250                     SET RC013-ERR (ASC-SEL-SUB)                  02425001
024260                                              TO TRUE             02426001
024270                     PERFORM 9200-REWRITE-SEL-QUEUE               02427001
024280                 ELSE                                             02428001
024290                     PERFORM 4000-BUILD-INITIAL-PANEL             02429001
024300                                          THRU 4000-EXIT          02430001
024310                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         02431001
024320                     PERFORM 3200-RESET-ATTRIBUTES                02432001
024330                     PERFORM 3500-SAVE-SCREEN-FIELDS              02433001
024340                 END-IF                                           02434001
024350              ELSE                                                02435001
024360*                --- BOTTOM OF LIST ---                           02436001
024370                 MOVE PC-TSYMSG-00070                             02437001
024380                                   TO DP020-MSG-NUMBER            02438001
024390                 SET DP020-MSG-INFORMATIONAL                      02439001
024400                                   TO TRUE                        02440001
024410              END-IF                                              02441001
024420                                                                  02442001
024430         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             02443001
024440              IF ASC-USE-SELECTION-QUEUE                          02444001
024450                 PERFORM 2120-GET-PREV-RECORD                     02445001
024460                 MOVE ASC-OPER-UNT-ID-N   TO DK-OPER-UNT-ID       02446001
024470                 MOVE ASC-FCLTY-ID-N      TO DK-FCLTY-ID          02447001
024480                 MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR            02448001
024490                                             DK-ORD-NBR           02449001
024500                 MOVE ASC-KEY-REC-SEQ-NBR TO DK-REC-SEQ-NBR       02450001
024510                 INITIALIZE PV-DB2-COUNT                          02451001
024520                 MOVE DK-OPER-UNT-ID      TO DK-LOCATION-NBR      02452001
024530                 PERFORM 4060-CHECK-DIRECT-STORE                  02453001
024540                 INITIALIZE PV-DB2-COUNT                          02454001
024550                 PERFORM 4065-CHECK-EXPENSE-RECEIPT               02455001
024560                 IF  PV-DB2-COUNT = +0                            02456001
024570                     MOVE SPACES          TO ASC-RECEIPT-TYPE-SW  02457001
024580                 ELSE                                             02458001
024590                     SET ASC-EXPENSE-RECEIPT                      02459001
024600                                          TO TRUE                 02460001
024610                 END-IF                                           02461001
024620                 IF  PS-NO-ERROR                                  02462001
024630                     IF  ASC-DIRECT-STORE                         02463001
024640                     OR  ASC-EXPENSE-RECEIPT                      02464001
024650                         CONTINUE                                 02465001
024660                     ELSE                                         02466001
024670                         PERFORM 1130-CHECK-TRIPS                 02467001
024680                         IF  SQLCODE = +100                       02468001
024690                             MOVE PC-TSYMSG-00743                 02469001
024700                                             TO DP020-MSG-NUMBER  02470001
024710                             SET PS-ERROR                         02471001
024720                                 DP020-NEXT-ACT-APPL-ERROR        02472001
024730                                 DP020-MSG-FATAL                  02473001
024740                                             TO TRUE              02474001
024750                         END-IF                                   02475001
024760                     END-IF                                       02476001
024770                 END-IF                                           02477001
024780                 IF  PS-NO-ERROR                                  02478001
024790                     INITIALIZE PV-DB2-COUNT                      02479001
024800                     PERFORM 1140-CHECK-STATUS                    02480001
024810                     IF  PV-DB2-COUNT > +0                        02481001
024820                         MOVE PC-TSYMSG-00463 TO DP020-MSG-NUMBER 02482001
024830                         SET PS-ERROR                             02483001
024840                             DP020-NEXT-ACT-APPL-ERROR            02484001
024850                             DP020-MSG-FATAL  TO TRUE             02485001
024860                     END-IF                                       02486001
024870                 END-IF                                           02487001
024880                 IF  PS-ERROR                                     02488001
024890                     SET RC013-ERR (ASC-SEL-SUB)                  02489001
024900                                              TO TRUE             02490001
024910                     PERFORM 9200-REWRITE-SEL-QUEUE               02491001
024920                 ELSE                                             02492001
024930                     PERFORM 4000-BUILD-INITIAL-PANEL             02493001
024940                                   THRU 4000-EXIT                 02494001
024950                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         02495001
024960                     PERFORM 3200-RESET-ATTRIBUTES                02496001
024970                 END-IF                                           02497001
024980              ELSE                                                02498001
024990*                --- TOP OF LIST ---                              02499001
025000                 MOVE PC-TSYMSG-00069                             02500001
025010                                   TO DP020-MSG-NUMBER            02501001
025020                 SET DP020-MSG-INFORMATIONAL                      02502001
025030                                   TO TRUE                        02503001
025040              END-IF                                              02504001
025050                                                                  02505001
025060         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              02506001
025070             SET ASC-VND-DT-CHG-NOT-PENDING                       02507001
025080                 ASC-VND-DT-NOT-CHGD       TO TRUE                02508001
025090             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02509001
025100             IF ASC-PO-NBR-OLD = ZEROES AND                       02510001
025110                ASC-KEY-PO-NBR = ZEROES                           02511001
025120                SET PS-ERROR                                      02512001
025130                    DP020-MSG-FATAL        TO TRUE                02513001
025140                MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER    02514001
025150                MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA             02515001
025160                MOVE DP015-RED             TO APONBRC             02516001
025170                MOVE DP015-REVERSE         TO APONBRH             02517001
025180                MOVE -1                    TO APONBRL             02518001
025190                SET DP030-SET-CURSOR-APPL-1                       02519001
025200                                           TO TRUE                02520001
025210                SET DP030-OVERRIDE-GO TO TRUE                     02521001
025220             ELSE                                                 02522001
025230                 SET DP030-CONTINUE-GO                            02523001
025240                                   TO TRUE                        02524001
025250                 PERFORM 2100-CHECK-FUNCTION-KEY                  02525001
025260             END-IF                                               02526001
025270                                                                  02527001
025280         WHEN OTHER                                               02528001
025290             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02529001
025300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02530001
025310             IF  PS-NO-ERROR                                      02531001
025320                 SET DP030-CONTINUE-GO                            02532001
025330                                   TO TRUE                        02533001
025340                 PERFORM 2100-CHECK-FUNCTION-KEY                  02534001
025350             ELSE                                                 02535001
025360                 SET DP030-OVERRIDE-GO                            02536001
025370                                   TO TRUE                        02537001
025380             END-IF                                               02538001
025390     END-EVALUATE.                                                02539001
025400                                                                  02540001
025410/                                                                 02541001
025420******************************************************************02542001
025430** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02543001
025440** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02544001
025450** FROM THE CICS ARCHITECTURE API.                              **02545001
025460******************************************************************02546001
025470 2100-CHECK-FUNCTION-KEY.                                         02547001
025480                                                                  02548001
025490     EVALUATE TRUE                                                02549001
025500                                                                  02550001
025510         WHEN DP020-SRC-AID = DP016-ENTER                         02551001
025520             CONTINUE                                             02552001
025530                                                                  02553001
025540         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              02554001
025550********** CHECK IF VENDOR DATE IS WITHIN THE REQUIRED RANGE      02555001
025560**********      VENDOR DATE NOT > CURRENT DATE OR < CURRENT       02556001
025570**********      DATE - PC-VALID-VND-DT-RANGE   DAYS               02557001
025580             IF ASC-VND-DT-CHG-PENDING                            02558001
025590                 PERFORM 3005-CHK-VND-DATE-RANGE                  02559001
025600                 IF PS-VALID-VND-DT-RANGE                         02560001
025610                     PERFORM 2150-RCVR-CREATE                     02561001
025620                     SET ASC-VND-DT-CHG-NOT-PENDING TO TRUE       02562001
025630                     MOVE DP015-UNP-ALP-NOR-OFF TO AVNSHDTA       02563001
025640                     MOVE DP015-GREEN           TO AVNSHDTC       02564001
025650                     MOVE DP015-UNDERLINE       TO AVNSHDTH       02565001
025660                 ELSE                                             02566001
025670                     SET ASC-VND-DT-F2-REQUIRED                   02567001
025680                         PS-ERROR                                 02568001
025690                         DP020-MSG-WARNING  TO TRUE               02569001
025700                     MOVE DP015-YELLOW      TO AVNSHDTC           02570001
025710                     MOVE DP015-REVERSE     TO AVNSHDTH           02571001
025720                     MOVE -1                TO AVNSHDTL           02572001
025730                     MOVE PC-TSYMSG-01838   TO DP020-MSG-NUMBER   02573001
025740                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          02574001
025750                 END-IF                                           02575001
025760             ELSE                                                 02576001
025770                 PERFORM 2150-RCVR-CREATE                         02577001
025780             END-IF                                               02578001
025790                                                                  02579001
025800**  UPDATE - PF15                                                 02580001
025810         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              02581001
025820                                                                  02582001
025830********** CHECK IF PACK REDISTRO SHOULD BE PROCESSED             02583001
025840             IF ASC-ALL-LINES                                     02584001
025850                 MOVE PC-TSYMSG-02158 TO DP020-MSG-NUMBER         02585001
025860                 SET DP020-MSG-INFORMATIONAL                      02586001
025870                                      TO TRUE                     02587001
025880                 SET ASC-UPDATE-PENDING                           02588001
025890                                      TO TRUE                     02589001
025900                 SET ASC-CONFIRM-REDISTRO                         02590001
025910                                      TO TRUE                     02591001
025920                 MOVE SPACES TO ASC-ALL-LINES-SW                  02592001
025930             ELSE                                                 02593001
025940                 IF ASC-ANY-LINES                                 02594001
025950                     MOVE PC-TSYMSG-02160                         02595001
025960                                      TO DP020-MSG-NUMBER         02596001
025970                     SET DP020-MSG-INFORMATIONAL                  02597001
025980                                      TO TRUE                     02598001
025990                     SET ASC-PACK-REDISTRO                        02599001
026000                                      TO TRUE                     02600001
026010                     SET ASC-UPDATE-PENDING                       02601001
026020                                      TO TRUE                     02602001
026030                     SET ASC-CONFIRM-REDISTRO                     02603001
026040                                      TO TRUE                     02604001
026050                     MOVE SPACE TO ASC-ANY-LINES-SW               02605001
026060                 ELSE                                             02606001
026070********** CHECK IF VENDOR DATE IS WITHIN THE REQUIRED RANGE      02607001
026080**********      VENDOR DATE NOT > CURRENT DATE OR < CURRENT       02608001
026090**********      DATE - PC-VALID-VND-DT-RANGE   DAYS               02609001
026100                     IF ASC-VND-DT-CHG-PENDING                    02610001
026110                         PERFORM 3005-CHK-VND-DATE-RANGE          02611001
026120                         IF PS-VALID-VND-DT-RANGE                 02612001
026130                             PERFORM 2160-RCVR-UPDATE             02613001
026140                             SET ASC-VND-DT-CHG-NOT-PENDING       02614001
026150                                          TO TRUE                 02615001
026160                             MOVE DP015-UNP-ALP-NOR-OFF           02616001
026170                                          TO AVNSHDTA             02617001
026180                             MOVE DP015-GREEN                     02618001
026190                                          TO AVNSHDTC             02619001
026200                             MOVE DP015-UNDERLINE                 02620001
026210                                          TO AVNSHDTH             02621001
026220                         ELSE                                     02622001
026230                             SET ASC-VND-DT-F2-REQUIRED           02623001
026240                             PS-ERROR                             02624001
026250                             DP020-MSG-WARNING  TO TRUE           02625001
026260                             MOVE DP015-YELLOW                    02626001
026270                                            TO AVNSHDTC           02627001
026280                             MOVE DP015-REVERSE                   02628001
026290                                            TO AVNSHDTH           02629001
026300                             MOVE -1        TO AVNSHDTL           02630001
026310                             MOVE PC-TSYMSG-01838                 02631001
026320                                            TO DP020-MSG-NUMBER   02632001
026330                             SET DP030-SET-CURSOR-APPL-1          02633001
026340                                            TO TRUE               02634001
026350                         END-IF                                   02635001
026360                     ELSE                                         02636001
026370                         PERFORM 2160-RCVR-UPDATE                 02637001
026380                     END-IF                                       02638001
026390                 END-IF                                           02639001
026400             END-IF                                               02640001
026410                                                                  02641001
026420         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              02642001
026430             INITIALIZE RC012-INTER-APPL-COMMAREA                 02643001
026440             MOVE ASC-KEY-PO-NBR      TO RC012-PO-NBR             02644001
026450             MOVE ASC-KEY-REC-SEQ-NBR TO RC012-REC-SEQ-NBR        02645001
026460             MOVE ASC-OPER-UNT-ID     TO RC012-OPER-UNT-ID        02646001
026470             MOVE ASC-FCLTY-ID        TO RC012-FCLTY-ID           02647001
026480                                                                  02648001
026490**  CONFIRM - PF2                                                 02649001
026500         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    02650001
026510             IF ASC-VND-DT-F2-REQUIRED OR                         02651001
026520                 ASC-CONFIRM-REDISTRO                             02652001
026530*** ONCE F2 PRESSED NO LONGER KNOW IF FUNC-01 OR FUNC-02          02653001
026540*****- ADD -*****IF DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)        02654001
026550                 IF ASC-ADD-PENDING                               02655001
026560                     IF (ASC-VND-SHIP-MM-NEW =                    02656001
026570                                        ASC-VND-SHIP-MM-OLD       02657001
026580                         AND ASC-VND-SHIP-DD-NEW =                02658001
026590                                        ASC-VND-SHIP-DD-OLD       02659001
026600                         AND  ASC-VND-SHIP-CCYY-NEW =             02660001
026610                                        ASC-VND-SHIP-CCYY-OLD)    02661001
026620                         AND ASC-VND-DT-CHG-PENDING               02662001
026630                           MOVE DP015-UNP-ALP-NOR-OFF TO AVNSHDTA 02663001
026640                           MOVE DP015-GREEN           TO AVNSHDTC 02664001
026650                           MOVE DP015-UNDERLINE       TO AVNSHDTH 02665001
026660                           PERFORM 2150-RCVR-CREATE               02666001
026670                           SET ASC-VND-DT-CHG-NOT-PENDING TO TRUE 02667001
026680                     ELSE                                         02668001
026690                         IF ASC-VND-DT-CHG-PENDING                02669001
026700                             AND  ASC-VND-DT-CHGD                 02670001
026710                             PERFORM 3005-CHK-VND-DATE-RANGE      02671001
026720                             IF PS-VALID-VND-DT-RANGE             02672001
026730                                 PERFORM 2150-RCVR-CREATE         02673001
026740                                 SET ASC-VND-DT-CHG-NOT-PENDING   02674001
026750                                                          TO TRUE 02675001
026760                                 MOVE DP015-UNP-ALP-NOR-OFF       02676001
026770                                                      TO AVNSHDTA 02677001
026780                                 MOVE DP015-GREEN                 02678001
026790                                                      TO AVNSHDTC 02679001
026800                                 MOVE DP015-UNDERLINE             02680001
026810                                                      TO AVNSHDTH 02681001
026820                             ELSE                                 02682001
026830                                 SET ASC-VND-DT-F2-REQUIRED       02683001
026840                                     PS-ERROR                     02684001
026850                                     DP020-MSG-WARNING  TO TRUE   02685001
026860                                 MOVE DP015-YELLOW  TO AVNSHDTC   02686001
026870                                 MOVE DP015-REVERSE TO AVNSHDTH   02687001
026880                                 MOVE -1            TO AVNSHDTL   02688001
026890                                 MOVE PC-TSYMSG-01838   TO        02689001
026900                                               DP020-MSG-NUMBER   02690001
026910                                 SET DP030-SET-CURSOR-APPL-1      02691001
026920                                                          TO TRUE 02692001
026930                             END-IF                               02693001
026940                         ELSE                                     02694001
026950                             PERFORM 2150-RCVR-CREATE             02695001
026960                     END-IF                                       02696001
026970                 ELSE                                             02697001
026980*****- UPDATE -******IF DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)    02698001
026990                     IF ASC-UPDATE-PENDING                        02699001
027000                         IF ASC-VND-DT-CHG-PENDING                02700001
027010                             AND  ASC-VND-DT-CHGD                 02701001
027020                             PERFORM 3005-CHK-VND-DATE-RANGE      02702001
027030                             IF PS-VALID-VND-DT-RANGE             02703001
027040                                 MOVE DP015-UNP-ALP-NOR-OFF       02704001
027050                                                      TO AVNSHDTA 02705001
027060                                 MOVE DP015-GREEN     TO AVNSHDTC 02706001
027070                                 MOVE DP015-UNDERLINE TO AVNSHDTH 02707001
027080                                 SET ASC-VND-DT-CHG-NOT-PENDING   02708001
027090                                                          TO TRUE 02709001
027100                                 PERFORM 2160-RCVR-UPDATE         02710001
027110                                 IF ASC-PACK-REDISTRO             02711001
027120                                     PERFORM 2170-PACK-REDISTRO   02712001
027130                                 ELSE                             02713001
027140*  ERROR MESSAGE  (UPDATE SUCCESSFUL - REDISTRO NOT PERFORMED)    02714001
027150                                     MOVE PC-TSYMSG-02159         02715001
027160                                            TO DP020-MSG-NUMBER   02716001
027170                                     SET DP020-MSG-INFORMATIONAL  02717001
027180                                            TO TRUE               02718001
027190                                 END-IF                           02719001
027200                             ELSE                                 02720001
027210                                 SET ASC-VND-DT-F2-REQUIRED       02721001
027220                                     PS-ERROR                     02722001
027230                                     DP020-MSG-WARNING  TO TRUE   02723001
027240                                 MOVE DP015-YELLOW  TO AVNSHDTC   02724001
027250                                 MOVE DP015-REVERSE TO AVNSHDTH   02725001
027260                                 MOVE -1            TO AVNSHDTL   02726001
027270                                 MOVE PC-TSYMSG-01838   TO        02727001
027280                                               DP020-MSG-NUMBER   02728001
027290                                 SET DP030-SET-CURSOR-APPL-1      02729001
027300                                                          TO TRUE 02730001
027310                             END-IF                               02731001
027320                         ELSE                                     02732001
027330                             PERFORM 2160-RCVR-UPDATE             02733001
027340                             IF ASC-PACK-REDISTRO                 02734001
027350                                 PERFORM 2170-PACK-REDISTRO       02735001
027360                             ELSE                                 02736001
027370*  ERROR MESSAGE  (UPDATE SUCCESSFUL - REDISTRO NOT PERFORMED)    02737001
027380                                 MOVE PC-TSYMSG-02159             02738001
027390                                        TO DP020-MSG-NUMBER       02739001
027400                                 SET DP020-MSG-INFORMATIONAL      02740001
027410                                        TO TRUE                   02741001
027420                             END-IF                               02742001
027430                         END-IF                                   02743001
027440                     ELSE                                         02744001
027450                        SET PS-ERROR                              02745001
027460                            DP020-MSG-WARNING  TO TRUE            02746001
027470                        MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER  02747001
027480                     END-IF                                       02748001
027490                 END-IF                                           02749001
027500             ELSE                                                 02750001
027510                 SET PS-ERROR                                     02751001
027520                     DP020-MSG-WARNING  TO TRUE                   02752001
027530                 MOVE PC-TSYMSG-00045 TO DP020-MSG-NUMBER         02753001
027540             END-IF                                               02754001
027550                                                                  02755001
027560         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              02756001
027570             INITIALIZE RC800-INTER-APPL-COMMAREA                 02757001
027580             MOVE ASC-KEY-PO-NBR      TO RC800-REC-NBR-N          02758001
027590             MOVE ASC-KEY-REC-SEQ-NBR TO RC800-REC-SEQ-NBR-N      02759001
027600             MOVE ASC-OPER-UNT-ID     TO RC800-OPER-UNIT-ID       02760001
027610             MOVE ASC-FCLTY-ID        TO RC800-FACILITY-ID        02761001
027620                                                                  02762001
027630                                                                  02763001
027640         WHEN OTHER                                               02764001
027650             SET DP013-NO-ROLLBACK                                02765001
027660                 DP013-XCTL-DISPLAY-RESTART                       02766001
027670                 DP013-CICS-ABEND  TO TRUE                        02767001
027680             MOVE '2100-CHECK-FUNCTION-KEY'                       02768001
027690                                   TO DP013-PARAGRAPH             02769001
027700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02770001
027710                                   TO DP013-MESSAGE-TEXT (1)      02771001
027720             PERFORM DP013-0000-PROCESS-ABEND                     02772001
027730     END-EVALUATE.                                                02773001
027740                                                                  02774001
027750     IF ASC-REC-SEQ-NBR > ZERO                                    02775001
027760         PERFORM 4200-TROUBLE-DESC                                02776001
027770         MOVE ASC-TRBL-DESC       TO ATBLSTO                      02777001
027780     END-IF.                                                      02778001
027790                                                                  02779001
027800*** IF F2-CONFIRM WAS REQUIRED FOR VENDOR SHIP DATE THEN THE      02780001
027810*** DP020-FK WILL NOW REFLECT F2-CONFIRM                          02781001
027820*** THE FOLLOWING WOULD NOT BE DONE IN SOME CASES WHEN IT SHOULD, 02782001
027830*** THEREFORE CHECK FOR FUNC-01 OR CONFIRM                        02783001
027840                                                                  02784001
027850     IF (DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) AND PS-NO-ERROR)  02785001
027860          OR     (DP020-FK-CONFIRM (DP020-SRC-AID) AND            02786001
027870                  ASC-ADD-PENDING  AND PS-NO-ERROR)               02787001
027880         MOVE ZEROES               TO ASC-PO-NBR-N                02788001
027890                                      ASC-KEY-PO-NBR              02789001
027900                                      DK-PO-NBR                   02790001
027910                                      APONBRO                     02791001
027920     END-IF.                                                      02792001
027930                                                                  02793001
027940*----------------------------------------------------------------*02794001
027950*    GET THE DATA (KEY) OF THE NEXT SELECTED OBJECT              *02795001
027960*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *02796001
027970*----------------------------------------------------------------*02797001
027980 2110-GET-NEXT-RECORD.                                            02798001
027990                                                                  02799001
028000     ADD +1                        TO ASC-SEL-SUB.                02800001
028010     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            02801001
028020         ADD +1                    TO ASC-SEL-ITEM                02802001
028030         MOVE +1                   TO ASC-SEL-SUB                 02803001
028040     END-IF.                                                      02804001
028050                                                                  02805001
028060     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                02806001
028070         PERFORM 9100-READ-SEL-QUEUE                              02807001
028080         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      02808001
028090             MOVE RC013-PO-NBR (ASC-SEL-SUB)                      02809001
028100                                   TO ASC-KEY-PO-NBR              02810001
028110                                      ASC-PO-NBR-N                02811001
028120             MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                 02812001
028130                                   TO ASC-KEY-REC-SEQ-NBR         02813001
028140                                      ASC-REC-SEQ-NBR             02814001
028150             MOVE RC013-OWNER-SCAC-ID (ASC-SEL-SUB)               02815001
028160                                   TO ASC-KEY-OWNER-SCAC-ID       02816001
028170                                      ASC-OWNER-SCAC-ID           02817001
028180             MOVE RC013-VEH-NBR       (ASC-SEL-SUB)               02818001
028190                                   TO ASC-KEY-VEH-NBR             02819001
028200                                      ASC-VEH-NBR                 02820001
028210             MOVE RC013-PRO-NBR       (ASC-SEL-SUB)               02821001
028220                                   TO ASC-KEY-PRO-NBR             02822001
028230                                      ASC-PRO-NBR                 02823001
028240             MOVE RC013-BOL-NBR       (ASC-SEL-SUB)               02824001
028250                                   TO ASC-KEY-BOL-NBR             02825001
028260                                      ASC-BOL-NBR                 02826001
028270             MOVE RC013-SHIPT-ID (ASC-SEL-SUB)                    02827001
028280                                   TO ASC-KEY-SHIPT-ID            02828001
028290             MOVE RC013-TRIP-ID (ASC-SEL-SUB)                     02829001
028300                                   TO ASC-KEY-TRIP-ID             02830001
028310             MOVE RC013-ARRIVAL-DTE (ASC-SEL-SUB)                 02831001
028320                                   TO ASC-KEY-STATUS-DTE          02832001
028330             MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                 02833001
028340                                   TO ASC-OPER-UNT-ID-N           02834001
028350             MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                    02835001
028360                                   TO ASC-FCLTY-ID-N              02836001
028370             SET RC013-INQ (ASC-SEL-SUB)                          02837001
028380                                   TO TRUE                        02838001
028390             PERFORM 9200-REWRITE-SEL-QUEUE                       02839001
028400         ELSE                                                     02840001
028410             SUBTRACT +1 FROM ASC-SEL-SUB                         02841001
028420*            --- BOTTOM OF LIST ---                               02842001
028430             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            02843001
028440             SET DP020-MSG-INFORMATIONAL                          02844001
028450                 PS-LIST-END       TO TRUE                        02845001
028460         END-IF                                                   02846001
028470     ELSE                                                         02847001
028480         SUBTRACT +1 FROM ASC-SEL-ITEM                            02848001
028490         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 02849001
028500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            02850001
028510         SET DP020-MSG-INFORMATIONAL                              02851001
028520                                   TO TRUE                        02852001
028530     END-IF.                                                      02853001
028540                                                                  02854001
028550/                                                                 02855001
028560*----------------------------------------------------------------*02856001
028570*    GET THE DATA (KEY) OF THE PREVIOUS SELECTED OBJECT          *02857001
028580*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *02858001
028590*----------------------------------------------------------------*02859001
028600 2120-GET-PREV-RECORD.                                            02860001
028610                                                                  02861001
028620     SUBTRACT +1 FROM ASC-SEL-SUB.                                02862001
028630     IF  ASC-SEL-SUB < +1                                         02863001
028640         SUBTRACT +1 FROM ASC-SEL-ITEM                            02864001
028650         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 02865001
028660     END-IF.                                                      02866001
028670                                                                  02867001
028680     IF  ASC-SEL-ITEM > ZERO                                      02868001
028690         PERFORM 9100-READ-SEL-QUEUE                              02869001
028700         MOVE RC013-PO-NBR (ASC-SEL-SUB)                          02870001
028710                                   TO ASC-KEY-PO-NBR              02871001
028720                                      ASC-PO-NBR-N                02872001
028730         MOVE RC013-REC-SEQ-NBR (ASC-SEL-SUB)                     02873001
028740                                   TO ASC-KEY-REC-SEQ-NBR         02874001
028750                                      ASC-REC-SEQ-NBR             02875001
028760         MOVE RC013-OWNER-SCAC-ID (ASC-SEL-SUB)                   02876001
028770                                   TO ASC-KEY-OWNER-SCAC-ID       02877001
028780                                      ASC-OWNER-SCAC-ID           02878001
028790         MOVE RC013-VEH-NBR       (ASC-SEL-SUB)                   02879001
028800                                   TO ASC-KEY-VEH-NBR             02880001
028810                                      ASC-VEH-NBR                 02881001
028820         MOVE RC013-PRO-NBR       (ASC-SEL-SUB)                   02882001
028830                                   TO ASC-KEY-PRO-NBR             02883001
028840                                      ASC-PRO-NBR                 02884001
028850         MOVE RC013-BOL-NBR       (ASC-SEL-SUB)                   02885001
028860                                   TO ASC-KEY-BOL-NBR             02886001
028870                                      ASC-BOL-NBR                 02887001
028880         MOVE RC013-SHIPT-ID (ASC-SEL-SUB)                        02888001
028890                                   TO ASC-KEY-SHIPT-ID            02889001
028900         MOVE RC013-TRIP-ID (ASC-SEL-SUB)                         02890001
028910                                   TO ASC-KEY-TRIP-ID             02891001
028920         MOVE RC013-ARRIVAL-DTE (ASC-SEL-SUB)                     02892001
028930                                   TO ASC-KEY-STATUS-DTE          02893001
028940         MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                     02894001
028950                                   TO ASC-OPER-UNT-ID             02895001
028960         MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                        02896001
028970                                   TO ASC-FCLTY-ID                02897001
028980     ELSE                                                         02898001
028990         MOVE +1                   TO ASC-SEL-ITEM                02899001
029000                                      ASC-SEL-SUB                 02900001
029010*        --- TOP OF LIST ---                                      02901001
029020         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            02902001
029030         SET DP020-MSG-INFORMATIONAL                              02903001
029040                                   TO TRUE                        02904001
029050     END-IF.                                                      02905001
029060                                                                  02906001
029070 2150-RCVR-CREATE.                                                02907001
029080     SET DP030-CONTINUE-GO TO TRUE                                02908001
029090     IF ASC-TRIP-EXISTS                                           02909001
029100         AND ASC-SHIPMENT-EXISTS                                  02910001
029110         AND ASC-PO-EXISTS                                        02911001
029120         PERFORM 5500-ASSIGN-RECEIVER                             02912001
029130     ELSE                                                         02913001
029140         PERFORM 5000-ADD-RECEIVER                                02914001
029150     END-IF                                                       02915001
029160     IF PS-NO-ERROR                                               02916001
029170         MOVE ZEROES       TO ASC-OPER-SET-ID-N                   02917001
029180                              AOPSETI                             02918001
029190                              AOPSETO                             02919001
029200         MOVE SPACES       TO ASC-OPER-SET-DESC                   02920001
029210                              AOPDESCO                            02921001
029220                              ASC-PRE-TKT-IND                     02922001
029230                              APRETKTI                            02923001
029240                              APRETKTO                            02924001
029250                              ASC-HANGER-IND                      02925001
029260                              AHANGERI                            02926001
029270                              AHANGERO                            02927001
029280                              ASC-PACK-BY-ST-IND                  02928001
029290                              APKBYSTI                            02929001
029300                              APKBYSTO                            02930001
029350                              ASC-ENT-NAME-DESC                   02935001
029360                              AENTNMEO                            02936001
029370                              ASC-PRE-RECEIVER-VEND-SW            02937001
029380                              APRERCVO                            02938001
029390                              ASC-AD-DTE                          02939001
029400                              AADDTEO                             02940001
029410                              ASC-TKT-FMT-ID                      02941001
029420                              ASC-TKT-DESC                        02942001
029430         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      02943001
029440         MOVE -1           TO APONBRL                             02944001
029450     END-IF.                                                      02945001
029460                                                                  02946001
029470                                                                  02947001
029480 2160-RCVR-UPDATE.                                                02948001
029490     PERFORM 3600-CHECK-IF-FIELDS-CHANGED                         02949001
029500     IF  ASC-FIELDS-CHANGED                                       02950001
029510        IF ASC-COPER-UNT-ID  NOT  = ASC-COPER-UNT-ID-OLD          02951001
029520            MOVE ASC-COPER-UNT-ID  TO  PV-COPER-UNT-ID            02952001
029530            PERFORM 8010-CHECK-TKRPRPM                            02953001
029540            IF PS-ASNS-TO-WMS-NO                                  02954001
029550                MOVE ASC-COPER-UNT-ID-OLD  TO  PV-COPER-UNT-ID    02955001
029560                PERFORM 8010-CHECK-TKRPRPM                        02956001
029570                  IF PS-ASNS-TO-WMS-YES                           02957001
029580* JAK 08/2007 - ADD ADDL CHECK OF RECITM                          02958001
029590*****                MOVE PC-TSYMSG-03583 TO DP020-MSG-NUMBER     02959001
029600*****                SET DP020-MSG-INFORMATIONAL TO TRUE          02960001
029610                     PERFORM 2180-CHECK-TRECITM                   02961001
029620                     IF PS-RECITM-FOUND-YES                       02962001
029630                         MOVE PC-TSYMSG-03589                     02963001
029640                                          TO DP020-MSG-NUMBER     02964001
029650                         SET DP020-MSG-INFORMATIONAL TO TRUE      02965001
029660                     ELSE                                         02966001
029670                         SET DP030-CONTINUE-GO TO TRUE            02967001
029680                         PERFORM 6000-UPDATE-RECEIVER             02968001
029690                     END-IF                                       02969001
029700                  ELSE                                            02970001
029710                     SET DP030-CONTINUE-GO TO TRUE                02971001
029720                     PERFORM 6000-UPDATE-RECEIVER                 02972001
029730                  END-IF                                          02973001
029740            ELSE                                                  02974001
029750* JAK 08/2007 - ADD ADDL CHECK OF RECITM                          02975001
029760*****          MOVE PC-TSYMSG-03583 TO DP020-MSG-NUMBER           02976001
029770*****          SET DP020-MSG-INFORMATIONAL TO TRUE                02977001
029780               PERFORM 2180-CHECK-TRECITM                         02978001
029790               IF PS-RECITM-FOUND-YES                             02979001
029800                   MOVE PC-TSYMSG-03589 TO DP020-MSG-NUMBER       02980001
029810                   SET DP020-MSG-INFORMATIONAL TO TRUE            02981001
029820               ELSE                                               02982001
029830                   SET DP030-CONTINUE-GO TO TRUE                  02983001
029840                   PERFORM 6000-UPDATE-RECEIVER                   02984001
029850               END-IF                                             02985001
029860            END-IF                                                02986001
029870        ELSE                                                      02987001
029880            SET DP030-CONTINUE-GO TO TRUE                         02988001
029890            PERFORM 6000-UPDATE-RECEIVER                          02989001
029900        END-IF                                                    02990001
029910     ELSE                                                         02991001
029920         MOVE PC-TSYMSG-00046 TO DP020-MSG-NUMBER                 02992001
029930         SET DP020-MSG-INFORMATIONAL TO TRUE                      02993001
029940     END-IF.                                                      02994001
029950                                                                  02995001
029960/                                                                 02996001
029970*----------------------------------------------------------------*02997001
029980*  LINK TO PROGRAM RCKCS807 - TRANSCRIPT PACKAGING TO BULK       *02998001
029990*----------------------------------------------------------------*02999001
030000 2170-PACK-REDISTRO.                                              03000001
030010                                                                  03001001
030020     MOVE SPACE TO ASC-PACK-REDISTRO-SW.                          03002001
030030                                                                  03003001
030040     INITIALIZE TM500-FIELDS.                                     03004001
030050                                                                  03005001
030060     MOVE DK-OPER-UNT-ID   TO TM500-OPER-UNT-ID.                  03006001
030070     MOVE DK-FCLTY-ID      TO TM500-FCLTY-ID.                     03007001
030080     MOVE DK-ORD-NBR       TO TM500-PO-NBR.                       03008001
030090     MOVE DK-REC-SEQ-NBR   TO TM500-REC-SEQ-NBR.                  03009001
030100                                                                  03010001
030110     EXEC CICS                                                    03011001
030120         LINK PROGRAM (PC-RCKCS807)                               03012001
030130             COMMAREA (TM500-FIELDS)                              03013001
030140             LENGTH (PC-600)                                      03014001
030150     END-EXEC.                                                    03015001
030160                                                                  03016001
030170     EVALUATE TRUE                                                03017001
030180         WHEN TM500-CALL-SUCCESSFUL                               03018001
030190         WHEN TM500-DUPLICATE-TROUBLE                             03019001
030200         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        03020001
030210**GB  11/15/05  BEG                                               03021001
030220              MOVE ASC-PKGNG-CDE TO ASC-PKGNG-CDE-OLD             03022001
030230**GB  11/15/05  END                                               03023001
030240* ERROR MSG  (UPDATE SUCCESSFUL - REDISTRO PERFORMED)             03024001
030250             MOVE PC-TSYMSG-02161                                 03025001
030260                           TO DP020-MSG-NUMBER                    03026001
030270             SET DP020-MSG-INFORMATIONAL                          03027001
030280                           TO TRUE                                03028001
030290         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       03029001
030300             MOVE PC-TSYMSG-00937                                 03030001
030310                           TO DP020-MSG-NUMBER                    03031001
030320             SET DP020-MSG-INFORMATIONAL                          03032001
030330                           TO TRUE                                03033001
030340         WHEN OTHER                                               03034001
030350             MOVE '2170-PACK-REDISTRO'                            03035001
030360                           TO DP013-PARAGRAPH                     03036001
030370             MOVE 'UNSUCCESSFUL CALL TO TROUBLE RTN'              03037001
030380                           TO DP013-MESSAGE-TEXT (1)              03038001
030390             MOVE TM500-RETURN-MSG                                03039001
030400                           TO DP013-MESSAGE-TEXT (2)              03040001
030410             MOVE TM500-SQLCA TO DP013-SQLCA                      03041001
030420             SET DP013-DB2-ABEND                                  03042001
030430                 DP013-XCTL-DISPLAY-RESTART                       03043001
030440                              TO TRUE                             03044001
030450             PERFORM DP013-0000-PROCESS-ABEND                     03045001
030460                                                                  03046001
030470     END-EVALUATE.                                                03047001
030480/                                                                 03048001
030490* JAK 08/2007 - ADD NEW PARAGRAPH 2180-                           03049001
030500*----------------------------------------------------------------*03050001
030510*  CHECK TRECITM FOR ACTIVE ITEMS FOR THE PO/RCVR                *03051001
030520*----------------------------------------------------------------*03052001
030530                                                                  03053001
030540 2180-CHECK-TRECITM.                                              03054001
030550                                                                  03055001
030560     MOVE ASC-KEY-PO-NBR        TO DK-ORD-NBR.                    03056001
030570     MOVE ASC-KEY-REC-SEQ-NBR   TO DK-REC-SEQ-NBR.                03057001
030580     SET PS-RECITM-FOUND-NO     TO TRUE.                          03058001
030590                                                                  03059001
030600     EXEC SQL                                                     03060001
030610        SELECT  ORD_NBR                                           03061001
030620          INTO :RECITM-ORD-NBR                                    03062001
030630          FROM  TRECITM                                           03063001
030640         WHERE  ORD_NBR        = :DK-ORD-NBR                      03064001
030650           AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  03065001
030660           AND  VER_STATUS_CDE = 'A'                              03066001
030670     END-EXEC.                                                    03067001
030680                                                                  03068001
030690     EVALUATE TRUE                                                03069001
030700         WHEN SQLCODE = +0                                        03070001
030710         WHEN SQLCODE = -811                                      03071001
030720             SET PS-RECITM-FOUND-YES     TO TRUE                  03072001
030730         WHEN SQLCODE = +100                                      03073001
030740         WHEN SQLCODE = -904                                      03074001
030750         WHEN SQLCODE = -913                                      03075001
030760             CONTINUE                                             03076001
030770         WHEN SQLWARN0 NOT = SPACES                               03077001
030780         WHEN SQLCODE < +0                                        03078001
030790         WHEN SQLCODE > +0                                        03079001
030800             MOVE '2180-CHECK-TRECITM'                            03080001
030810                                TO DP013-PARAGRAPH                03081001
030820             MOVE 'SELECT ACTIVE RECITM'                          03082001
030830                                 TO DP013-MESSAGE-TEXT (1)        03083001
030840             MOVE SQLCA      TO DP013-SQLCA                       03084001
030850             MOVE 'TRECITM'  TO DP013-DB2-TABLE-NAME (1)          03085001
030860             SET DP013-DB2-ABEND                                  03086001
030870                                 TO TRUE                          03087001
030880             SET DP013-XCTL-DISPLAY-RESTART                       03088001
030890                                 TO TRUE                          03089001
030900             PERFORM DP013-0000-PROCESS-ABEND                     03090001
030910     END-EVALUATE.                                                03091001
030920                                                                  03092001
030930/                                                                 03093001
030940*----------------------------------------------------------------*03094001
030950*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *03095001
030960*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *03096001
030970*----------------------------------------------------------------*03097001
030980 2200-MOVE-SCREEN-TO-COMMAREA.                                    03098001
030990                                                                  03099001
031000     IF  APONBRL > ZERO                                           03100001
031010         MOVE APONBRI              TO ASC-PO-NBR                  03101001
031020     ELSE                                                         03102001
031030        IF  APONBRF = DP015-ERASE-EOF                             03103001
031040            MOVE SPACES            TO ASC-PO-NBR                  03104001
031050        END-IF                                                    03105001
031060     END-IF.                                                      03106001
031070                                                                  03107001
031080     IF  AEXPINDL > ZERO                                          03108001
031090         MOVE AEXPINDI             TO ASC-EXPENSE-IND             03109001
031100     ELSE                                                         03110001
031110        IF  AEXPINDF = DP015-ERASE-EOF                            03111001
031120            MOVE SPACES            TO ASC-EXPENSE-IND             03112001
031130        END-IF                                                    03113001
031140     END-IF.                                                      03114001
031150                                                                  03115001
031160     IF  AAPRCVRL > ZERO                                          03116001
031170         MOVE AAPRCVRI             TO ASC-AP-RCVR-NBR             03117001
031180     ELSE                                                         03118001
031190        IF  AAPRCVRF = DP015-ERASE-EOF                            03119001
031200            MOVE SPACES            TO ASC-AP-RCVR-NBR             03120001
031210        END-IF                                                    03121001
031220     END-IF.                                                      03122001
031230                                                                  03123001
031240     IF  ASCACL > ZERO                                            03124001
031250         MOVE ASCACI               TO ASC-OWNER-SCAC-ID           03125001
031260     ELSE                                                         03126001
031270         IF  ASCACF = DP015-ERASE-EOF                             03127001
031280             MOVE SPACES           TO ASC-OWNER-SCAC-ID           03128001
031290         END-IF                                                   03129001
031300     END-IF.                                                      03130001
031310                                                                  03131001
031320     IF  ATRLRL > ZERO                                            03132001
031330         MOVE ATRLRI               TO ASC-VEH-NBR                 03133001
031340     ELSE                                                         03134001
031350         IF  ATRLRF = DP015-ERASE-EOF                             03135001
031360             MOVE SPACES           TO ASC-VEH-NBR                 03136001
031370         END-IF                                                   03137001
031380     END-IF.                                                      03138001
031390                                                                  03139001
031400     IF  APROL > ZERO                                             03140001
031410         MOVE APROI                TO ASC-PRO-NBR                 03141001
031420     ELSE                                                         03142001
031430         IF  APROF = DP015-ERASE-EOF                              03143001
031440             MOVE SPACES           TO ASC-PRO-NBR                 03144001
031450         END-IF                                                   03145001
031460     END-IF.                                                      03146001
031470                                                                  03147001
031480     IF  ASHPDTL > ZERO                                           03148001
031490         MOVE ASHPDTI              TO ASC-OWNR-SCAC-SHIP-DTE      03149001
031500     ELSE                                                         03150001
031510         IF  ASHPDTF = DP015-ERASE-EOF                            03151001
031520             MOVE SPACES           TO ASC-OWNR-SCAC-SHIP-DTE      03152001
031530         END-IF                                                   03153001
031540     END-IF.                                                      03154001
031550                                                                  03155001
031560     IF  AARVDTL > ZERO                                           03156001
031570         MOVE AARVDTI              TO ASC-ARRIVAL-DTE             03157001
031580     ELSE                                                         03158001
031590         IF  AARVDTF = DP015-ERASE-EOF                            03159001
031600             MOVE SPACES           TO ASC-ARRIVAL-DTE             03160001
031610         END-IF                                                   03161001
031620     END-IF.                                                      03162001
031630                                                                  03163001
031640     IF  AOPERL > ZERO                                            03164001
031650         MOVE AOPERI               TO ASC-OPER-UNT-ID             03165001
031660     ELSE                                                         03166001
031670         IF  AOPERF = DP015-ERASE-EOF                             03167001
031680             MOVE SPACES           TO ASC-OPER-UNT-ID             03168001
031690         END-IF                                                   03169001
031700     END-IF.                                                      03170001
031710                                                                  03171001
031720     IF  AFCLTYL > ZERO                                           03172001
031730         MOVE AFCLTYI              TO ASC-FCLTY-ID                03173001
031740     ELSE                                                         03174001
031750         IF  AFCLTYF = DP015-ERASE-EOF                            03175001
031760             MOVE SPACES           TO ASC-FCLTY-ID                03176001
031770         END-IF                                                   03177001
031780     END-IF.                                                      03178001
031790                                                                  03179001
031800     IF  AVNSHDTL > ZERO                                          03180001
031810         SET ASC-VND-DT-CHGD                                      03181001
031820             ASC-VND-DT-CHG-PENDING TO TRUE                       03182001
031830         MOVE AVNSHDTI             TO ASC-VEND-SHIP-DTE           03183001
031840         PERFORM 2210-GET-VEND-CENTURY                            03184001
031850     ELSE                                                         03185001
031860         SET ASC-VND-DT-NOT-CHGD TO TRUE                          03186001
031870         IF  AVNSHDTF = DP015-ERASE-EOF                           03187001
031880             MOVE SPACES           TO ASC-VEND-SHIP-DTE           03188001
031890         END-IF                                                   03189001
031900     END-IF.                                                      03190001
031910                                                                  03191001
031920     IF  ABOLL > ZERO                                             03192001
031930         MOVE ABOLI                TO ASC-BOL-NBR                 03193001
031940     ELSE                                                         03194001
031950         IF  ABOLF = DP015-ERASE-EOF                              03195001
031960             MOVE SPACES           TO ASC-BOL-NBR                 03196001
031970         END-IF                                                   03197001
031980     END-IF.                                                      03198001
031990                                                                  03199001
032000* WR40574 02-15-2012 START CLT                                    03200001
032010     IF  ACANL > ZERO                                             03201001
032020         MOVE ACANI                TO ASC-CARR-AUTH-ID            03202001
032030     ELSE                                                         03203001
032040         IF  ACANF = DP015-ERASE-EOF                              03204001
032050             MOVE SPACES           TO ASC-CARR-AUTH-ID            03205001
032060         END-IF                                                   03206001
032070     END-IF.                                                      03207001
032080* WR40574 02-15-2012 END   CLT                                    03208001
032090                                                                  03209001
032100     IF  AOPSETL > ZERO                                           03210001
032110         MOVE AOPSETI              TO ASC-OPER-SET-ID             03211001
032120     ELSE                                                         03212001
032130         IF  AOPSETF = DP015-ERASE-EOF                            03213001
032140             MOVE SPACES           TO ASC-OPER-SET-ID             03214001
032150         END-IF                                                   03215001
032160     END-IF.                                                      03216001
032170                                                                  03217001
032180                                                                  03218001
032190     IF  ACTNCNTL > ZERO                                          03219001
032200         MOVE ACTNCNTI             TO ASC-EXPTED-CART-CNT         03220001
032210     ELSE                                                         03221001
032220         IF  ACTNCNTF = DP015-ERASE-EOF                           03222001
032230             MOVE SPACES           TO ASC-EXPTED-CART-CNT         03223001
032240         END-IF                                                   03224001
032250     END-IF.                                                      03225001
032260                                                                  03226001
032270                                                                  03227001
032280     IF  APRETKTL > ZERO                                          03228001
032290         MOVE APRETKTI             TO ASC-PRE-TKT-IND             03229001
032300     ELSE                                                         03230001
032310         IF  APRETKTF = DP015-ERASE-EOF                           03231001
032320             MOVE SPACES           TO ASC-PRE-TKT-IND             03232001
032330         END-IF                                                   03233001
032340     END-IF.                                                      03234001
032350                                                                  03235001
032360     IF  AHANGERL > ZERO                                          03236001
032370         MOVE AHANGERI             TO ASC-HANGER-IND              03237001
032380     ELSE                                                         03238001
032390         IF  AHANGERF = DP015-ERASE-EOF                           03239001
032400             MOVE SPACES           TO ASC-HANGER-IND              03240001
032410         END-IF                                                   03241001
032420     END-IF.                                                      03242001
032430                                                                  03243001
032440     IF  AACTCNTL > ZERO                                          03244001
032450         MOVE AACTCNTI             TO ASC-ACTL-CART-CNT           03245001
032460     ELSE                                                         03246001
032470         IF  AACTCNTF = DP015-ERASE-EOF                           03247001
032480             MOVE SPACES           TO ASC-ACTL-CART-CNT           03248001
032490         END-IF                                                   03249001
032500     END-IF.                                                      03250001
032510                                                                  03251001
032520     IF  ADMGCNTL > ZERO                                          03252001
032530         MOVE ADMGCNTI             TO ASC-DMG-CART-CNT            03253001
032540     ELSE                                                         03254001
032550         IF  ADMGCNTF = DP015-ERASE-EOF                           03255001
032560             MOVE SPACES           TO ASC-DMG-CART-CNT            03256001
032570         END-IF                                                   03257001
032580     END-IF.                                                      03258001
032590                                                                  03259001
032600     IF  APKBYSTL > ZERO                                          03260001
032610         MOVE APKBYSTI             TO ASC-PACK-BY-ST-IND          03261001
032620     ELSE                                                         03262001
032630         IF  APKBYSTF = DP015-ERASE-EOF                           03263001
032640             MOVE SPACES           TO ASC-PACK-BY-ST-IND          03264001
032650         END-IF                                                   03265001
032660     END-IF.                                                      03266001
032670                                                                  03267001
032680     IF  ACLERKL > ZERO                                           03268001
032690         MOVE ACLERKI              TO ASC-RCVG-CLERK-INIT-ID      03269001
032700     ELSE                                                         03270001
032710         IF  ACLERKF = DP015-ERASE-EOF                            03271001
032720             MOVE SPACES           TO ASC-RCVG-CLERK-INIT-ID      03272001
032730         END-IF                                                   03273001
032740     END-IF.                                                      03274001
032750                                                                  03275001
032760                                                                  03276001
032770     IF  ACOPERL > ZERO                                           03277001
032780         MOVE ACOPERI               TO ASC-COPER-UNT-ID           03278001
032790     ELSE                                                         03279001
032800         IF  ACOPERF = DP015-ERASE-EOF                            03280001
032810             MOVE SPACES           TO ASC-COPER-UNT-ID            03281001
032820         END-IF                                                   03282001
032830     END-IF.                                                      03283001
032840                                                                  03284001
032850     IF  ACFCLTYL > ZERO                                          03285001
032860         MOVE ACFCLTYI              TO ASC-CFCLTY-ID              03286001
032870     ELSE                                                         03287001
032880         IF  ACFCLTYF = DP015-ERASE-EOF                           03288001
032890             MOVE SPACES           TO ASC-CFCLTY-ID               03289001
032900         END-IF                                                   03290001
032910     END-IF.                                                      03291001
032920                                                                  03292001
032930     IF  AAPRLOCL > ZERO                                          03293001
032940         MOVE AAPRLOCI              TO ASC-APRON-LOC-DESC         03294001
032950     ELSE                                                         03295001
032960         IF  AAPRLOCF = DP015-ERASE-EOF                           03296001
032970             MOVE SPACES           TO ASC-APRON-LOC-DESC          03297001
032980         END-IF                                                   03298001
032990     END-IF.                                                      03299001
033000     IF  APKGCDEL > ZERO                                          03300001
033010         MOVE APKGCDEI             TO ASC-PKGNG-CDE               03301001
033020     ELSE                                                         03302001
033030         IF  APKGCDEF = DP015-ERASE-EOF                           03303001
033040             MOVE SPACES           TO ASC-PKGNG-CDE               03304001
033050         END-IF                                                   03305001
033060     END-IF.                                                      03306001
033070     IF  ARECTYPL > ZERO                                          03307001
033080         MOVE ARECTYPI             TO ASC-REC-TYP                 03308001
033090     ELSE                                                         03309001
033100         IF  ARECTYPF = DP015-ERASE-EOF                           03310001
033110             MOVE SPACES           TO ASC-REC-TYP                 03311001
033120         END-IF                                                   03312001
033130     END-IF.                                                      03313001
033140                                                                  03314001
033150******************************************************************03315001
033160**   NEED CENTURY FOR VENDOR SHIP DATE EDITS                      03316001
033170******************************************************************03317001
033180 2210-GET-VEND-CENTURY.                                           03318001
033190     MOVE ZEROS TO TALLY.                                         03319001
033200     INSPECT ASC-VEND-SHIP-DTE                                    03320001
033210          TALLYING TALLY FOR ALL '/'.                             03321001
033220     IF TALLY > 1                                                 03322001
033230         MOVE ASC-VEND-SHIP-DTE TO PV-GREG-FMT-DTE                03323001
033240         SET PS-VEND-DT-FMT TO TRUE                               03324001
033250     ELSE                                                         03325001
033260         MOVE ASC-VEND-SHIP-DTE TO PV-GREG-DTE                    03326001
033270         SET PS-VEND-DT-NOT-FMT TO TRUE                           03327001
033280     END-IF.                                                      03328001
033290                                                                  03329001
033300     IF PS-VEND-DT-FMT                                            03330001
033310         MOVE PV-GREG-FMT-MM TO   ASC-VND-SHIP-MM-NEW             03331001
033320         MOVE PV-GREG-FMT-DD TO   ASC-VND-SHIP-DD-NEW             03332001
033330         MOVE PV-GREG-FMT-YY TO   ASC-VND-SHIP-YY-NEW             03333001
033340     ELSE                                                         03334001
033350         MOVE PV-GREG-MM TO   ASC-VND-SHIP-MM-NEW                 03335001
033360         MOVE PV-GREG-DD TO   ASC-VND-SHIP-DD-NEW                 03336001
033370         MOVE PV-GREG-YY TO   ASC-VND-SHIP-YY-NEW                 03337001
033380     END-IF.                                                      03338001
033390                                                                  03339001
033400     IF ASC-VND-SHIP-YY-NEW > '80'                                03340001
033410         MOVE '19' TO ASC-VND-SHIP-CC-NEW                         03341001
033420     ELSE                                                         03342001
033430         MOVE '20' TO ASC-VND-SHIP-CC-NEW                         03343001
033440     END-IF.                                                      03344001
033450                                                                  03345001
033460/                                                                 03346001
033470*----------------------------------------------------------------*03347001
033480* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *03348001
033490* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *03349001
033500* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *03350001
033510*----------------------------------------------------------------*03351001
033520 3000-EDIT-DATA-IN-COMMAREA.                                      03352001
033530                                                                  03353001
033540     MOVE ASC-PO-NBR-N             TO DK-PO-NBR.                  03354018
033550     MOVE ASC-REC-SEQ-NBR          TO DK-REC-SEQ-NBR.             03355001
033560     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             03356001
033570     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                03357001
033580     MOVE ASC-DEPT-NBR             TO DK-DEPT-NBR.                03358001
033590     MOVE ASC-KEY-TRIP-ID          TO DK-TRIP-ID.                 03359001
033600                                                                  03360001
033610     PERFORM 3200-RESET-ATTRIBUTES.                               03361001
033620                                                                  03362001
033630     IF  PS-NO-ERROR                                              03363001
033640     AND ASC-ADD-PENDING                                          03364001
033650         IF  ASC-PO-NBR = (SPACES OR ZEROES)                      03365001
033660             SET PS-ERROR                                         03366001
033670                 DP020-MSG-FATAL        TO TRUE                   03367001
033680             MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER       03368001
033690             MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                03369001
033700             MOVE DP015-RED             TO APONBRC                03370001
033710             MOVE DP015-REVERSE         TO APONBRH                03371001
033720             MOVE -1                    TO APONBRL                03372001
033730             SET DP030-SET-CURSOR-APPL-1                          03373001
033740                                        TO TRUE                   03374001
033750         ELSE                                                     03375001
033760             MOVE ASC-PO-NBR            TO DP010I-UNEDITED-FIELD  03376001
033770             MOVE LENGTH OF ASC-PO-NBR  TO DP010I-MAXIMUM-DIGITS  03377001
033780             MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS03378001
033790             SET  DP010I-NEGATIVE-NOT-ALLOWED                     03379001
033800                                        TO TRUE                   03380001
033810             CALL DP010I-NUMERIC-EDIT-ROUTINE                     03381034
033811                  USING DP010I-NUMERIC-EDIT-AREA                  03381134
033820             IF  DP010I-ERROR-DETECTED                            03382001
033830                 SET PS-ERROR                                     03383001
033840                     DP020-MSG-FATAL    TO TRUE                   03384001
033850                 MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       03385001
033860                 MOVE DP015-UNP-ALP-BRT-OFF                       03386001
033870                                        TO APONBRA                03387001
033880                 MOVE DP015-RED         TO APONBRC                03388001
033890                 MOVE DP015-REVERSE     TO APONBRH                03389001
033900                 MOVE -1                TO APONBRL                03390001
033910                 SET DP030-SET-CURSOR-APPL-1                      03391001
033920                                        TO TRUE                   03392001
033930             ELSE                                                 03393001
033940                 MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-PO-NBR      03394001
033950                 MOVE PV-TEMP-PO-NBR      TO ASC-PO-NBR-N         03395001
033960                                             ASC-KEY-PO-NBR       03396001
033970                                                DK-PO-NBR         03397001
033980                 PERFORM 4045-GET-FRCST-IND                       03398001
033990                 IF  ASC-PRE-RECEIVER-VENDOR                      03399001
034000                     MOVE 'PRE-RECEIVER VENDOR'                   03400001
034010                                           TO APRERCVO            03401001
034020                 ELSE                                             03402001
034030                     MOVE SPACES           TO APRERCVO            03403001
034040                 END-IF                                           03404001
034050             END-IF                                               03405001
034060         END-IF                                                   03406001
034070     END-IF.                                                      03407001
034080                                                                  03408001
034090     IF  ASC-ADD-FROM-MENU                                        03409001
034100         IF  ASC-EXPENSE-IND = ' ' OR 'X'                         03410001
034110             IF  ASC-EXPENSE-IND = 'X'                            03411001
034120                 SET ASC-EXPENSE-RECEIPT                          03412001
034130                                       TO TRUE                    03413001
034140             END-IF                                               03414001
034150         ELSE                                                     03415001
034160             SET PS-ERROR                                         03416001
034170                DP020-MSG-FATAL        TO TRUE                    03417001
034180             MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER        03418001
034190             MOVE DP015-UNP-ALP-BRT-OFF                           03419001
034200                                       TO AEXPINDA                03420001
034210             MOVE DP015-RED            TO AEXPINDC                03421001
034220             MOVE DP015-REVERSE        TO AEXPINDH                03422001
034230             MOVE -1                   TO AEXPINDL                03423001
034240             SET DP030-SET-CURSOR-APPL-1                          03424001
034250                                       TO TRUE                    03425001
034260         END-IF                                                   03426001
034270         IF  PS-NO-ERROR                                          03427001
034280             IF  ASC-EXPENSE-IND = SPACES                         03428001
034290             AND ASC-AP-RCVR-NBR = (SPACES OR ZEROES)             03429001
034300                 MOVE SPACES           TO ASC-RECEIPT-TYPE-SW     03430001
034310                                          ASC-DIRECT-STORE-SW     03431001
034320         END-IF                                                   03432001
034330         MOVE ASC-PO-NBR-N         TO DK-PO-NBR                   03433001
034340         PERFORM 4040-GET-ENT-NAME-DESC                           03434001
034350         MOVE ASC-ENT-NAME-DESC    TO AENTNMEO                    03435001
034360         PERFORM 4045-GET-FRCST-IND                               03436001
034370         IF  ASC-PRE-RECEIVER-VENDOR                              03437001
034380             MOVE 'PRE-RECEIVER VENDOR'                           03438001
034390                                   TO APRERCVO                    03439001
034400         ELSE                                                     03440001
034410             MOVE SPACES           TO APRERCVO                    03441001
034420         END-IF                                                   03442001
034430     END-IF.                                                      03443001
034440                                                                  03444001
034450     IF  ASC-PO-NBR NOT = ASC-PO-NBR-OLD                          03445001
034460         MOVE ZEROES               TO ASC-OPER-SET-ID-N           03446001
034470                                      ASC-OPER-SET-DESC           03447001
034480         MOVE SPACES               TO ASC-TKT-FMT-ID              03448001
034490         MOVE SPACES               TO ASC-TKT-DESC                03449001
034500         MOVE ASC-OPER-UNT-ID-N    TO DK-OPER-UNT-ID              03450001
034510* DRS                                                             03451001
034520                                      CURR-OPER-UNT-ID            03452001
034530* DRS                                                             03453001
034540         MOVE ASC-FCLTY-ID-N       TO DK-FCLTY-ID                 03454001
034550* DRS                                                             03455001
034560                                      CURR-FCLTY-ID               03456001
034570* DRS                                                             03457001
034580         MOVE ASC-PO-NBR-N         TO DK-PO-NBR                   03458019
034590         MOVE ASC-PO-NBR           TO ASC-PO-NBR-OLD              03459001
034600         MOVE ASC-OPER-UNT-ID      TO ASC-OPER-UNT-ID-OLD         03460001
034610         PERFORM 3100-MOVE-DEFAULT-TO-COMMAREA                    03461001
034620     END-IF.                                                      03462001
034630                                                                  03463001
034640     IF ASC-ADD-PENDING                                           03464001
034650** SLH 07/10/07 ADD CHECK FOR WMS                                 03465001
034660** THIS MOVES THE CURR OPER BECAUSE THIS CODE ONLY CARES          03466001
034670** WHEN THE EFC IS PROCESSING THE GOODS TO DETERMINE IF IT SHOULD 03467001
034680** BE FLIPED TO A BULK OR NOT IF EFC PROCESSING DONT FLIP         03468001
034690       MOVE ASC-COPER-UNT-ID TO PV-COPER-UNT-ID                   03469001
034700       PERFORM 8010-CHECK-TKRPRPM                                 03470001
034710       IF PS-ASNS-TO-WMS-YES                                      03471001
034720          IF ASC-OPER-UNT-ID-N NOT = ASC-COPER-UNT-ID             03472001
034730            MOVE ASC-OPER-UNT-ID      TO ASC-OPER-UNT-ID-OLD      03473001
034740            PERFORM 3102-GET-BUS-IND                              03474001
034750            IF XL071-E-BUS-IND = 'Y'                              03475001
034760** AHP - BEGIN - 04/07/08                                         03476001
034770                INITIALIZE PV-DB2-COUNT                           03477001
034780                PERFORM 3015-CHECK-FOR-REPURP                     03478001
034790                IF PV-DB2-COUNT > 0                               03479001
034800                    MOVE PC-B             TO ASC-PKGNG-CDE        03480001
034810                                             APKGCDEO             03481001
034820                    MOVE PC-BULK-PACK     TO APKGDSCO             03482001
034830                    MOVE 'N'              TO ASC-PACK-BY-ST-IND   03483001
034840                                             APKBYSTO             03484001
034850                ELSE                                              03485001
034860                    PERFORM 3110-PBS-PKGNG-CDE                    03486001
034870                END-IF                                            03487001
034880** AHP -  END - 04/07/08                                          03488001
034890            ELSE                                                  03489001
034900                PERFORM 3110-PBS-PKGNG-CDE                        03490001
034910            END-IF                                                03491001
034920          ELSE                                                    03492001
034930             PERFORM 3110-PBS-PKGNG-CDE                           03493001
034940          END-IF                                                  03494001
034950       ELSE                                                       03495001
034960**  THIS IS THE PROD CODE                                         03496001
034970          IF ASC-OPER-UNT-ID NOT = ASC-OPER-UNT-ID-OLD            03497001
034980            MOVE ASC-OPER-UNT-ID      TO ASC-OPER-UNT-ID-OLD      03498001
034990            PERFORM 3102-GET-BUS-IND                              03499001
035000            IF XL071-E-BUS-IND = 'Y'                              03500001
035010** AHP - BEGIN - 04/07/08                                         03501001
035020                INITIALIZE PV-DB2-COUNT                           03502001
035030                PERFORM 3015-CHECK-FOR-REPURP                     03503001
035040                IF PV-DB2-COUNT > 0                               03504001
035050                    MOVE PC-B             TO ASC-PKGNG-CDE        03505001
035060                                             APKGCDEO             03506001
035070                    MOVE PC-BULK-PACK     TO APKGDSCO             03507001
035080                    MOVE 'N'              TO ASC-PACK-BY-ST-IND   03508001
035090                                             APKBYSTO             03509001
035100                ELSE                                              03510001
035110                    PERFORM 3110-PBS-PKGNG-CDE                    03511001
035120                END-IF                                            03512001
035130** AHP -  END - 04/07/08                                          03513001
035140            ELSE                                                  03514001
035150                PERFORM 3110-PBS-PKGNG-CDE                        03515001
035160            END-IF                                                03516001
035170          END-IF                                                  03517001
035180       END-IF                                                     03518001
035190     END-IF.                                                      03519001
035200                                                                  03520001
035210* JAK 06/2007 - REMOVE ERROR 3329                                 03521001
035220* OKAY SLH 7/2007 - ADD WMS CHECK                                 03522001
035230     IF ASC-UPDATE-PENDING                                        03523001
035240        MOVE ASC-COPER-UNT-ID TO PV-COPER-UNT-ID                  03524001
035250        PERFORM 8010-CHECK-TKRPRPM                                03525001
035260        IF PS-ASNS-TO-WMS-YES                                     03526001
035270           IF ASC-OPER-UNT-ID-N NOT = ASC-COPER-UNT-ID            03527001
035280             IF ASC-PKGNG-CDE NOT = PC-B                          03528001
035290               PERFORM 3102-GET-BUS-IND                           03529001
035300                   SET PS-ERROR                                   03530001
035310                       DP020-MSG-FATAL    TO TRUE                 03531001
035320                   MOVE PC-TSYMSG-03329   TO DP020-MSG-NUMBER     03532001
035330                   MOVE DP015-UNP-ALP-BRT-OFF                     03533001
035340                                          TO APKGCDEA             03534001
035350                   MOVE DP015-RED         TO APKGCDEC             03535001
035360                   MOVE DP015-REVERSE     TO APKGCDEH             03536001
035370                   MOVE -1                TO APKGCDEL             03537001
035380                   SET DP030-SET-CURSOR-APPL-1                    03538001
035390                                          TO TRUE                 03539001
035400               END-IF                                             03540001
035410             END-IF                                               03541001
035420          END-IF                                                  03542001
035430        END-IF.                                                   03543001
035440                                                                  03544001
035450** VALIDATE DATA IN PACK-BY-ST-IND FIELD                          03545001
035460**                                                                03546001
035470     IF  ASC-PACK-BY-ST-IND = (' ' OR 'Y' OR 'N')                 03547001
035480         CONTINUE                                                 03548001
035490     ELSE                                                         03549001
035500         SET PS-ERROR                                             03550001
035510             DP020-MSG-FATAL        TO TRUE                       03551001
035520         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           03552001
035530         MOVE DP015-UNP-ALP-BRT-OFF TO APKBYSTA                   03553001
035540         MOVE DP015-RED             TO APKBYSTC                   03554001
035550         MOVE DP015-REVERSE         TO APKBYSTH                   03555001
035560         MOVE -1                    TO APKBYSTL                   03556001
035570         SET DP030-SET-CURSOR-APPL-1                              03557001
035580                                    TO TRUE                       03558001
035590     END-IF.                                                      03559001
035600                                                                  03560001
035610** VALIDATE DATA IN PKGNG-CDE FIELD                               03561001
035620**                                                                03562001
035630     IF  ASC-PKGNG-CDE < SPACES                                   03563001
035640         MOVE SPACE                   TO ASC-PKGNG-CDE            03564001
035650     END-IF                                                       03565001
035660     IF  ASC-PKGNG-CDE-OLD < SPACES                               03566001
035670         MOVE SPACE                   TO ASC-PKGNG-CDE-OLD        03567001
035680     END-IF                                                       03568001
035690                                                                  03569001
035700     IF  ASC-PKGNG-CDE = ('B' OR 'C' OR 'S' OR 'I' OR 'M'         03570001
035710                           OR ' ')                                03571001
035720         CONTINUE                                                 03572001
035730     ELSE                                                         03573001
035740         SET PS-ERROR                                             03574001
035750             DP020-MSG-FATAL        TO TRUE                       03575001
035760         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           03576001
035770         MOVE DP015-UNP-ALP-BRT-OFF TO APKGCDEA                   03577001
035780         MOVE DP015-RED             TO APKGCDEC                   03578001
035790         MOVE DP015-REVERSE         TO APKGCDEH                   03579001
035800         MOVE -1                    TO APKGCDEL                   03580001
035810         SET DP030-SET-CURSOR-APPL-1                              03581001
035820                                    TO TRUE                       03582001
035830     END-IF.                                                      03583001
035840                                                                  03584001
035850*JPL FOR 'PACK', BULK, CASEPACK AND PACK BY STORE ORDERS,         03585001
035860*    CANNOT CHANGE PACKAGING CODE IF CASEPACK SPLIT HAS OCCURRED. 03586001
035870*    IF ASC-PKGNG-CDE-OLD = 'I' OR 'M'                            03587001
035880         IF (ASC-PKGNG-CDE-OLD = 'M' AND ASC-PKGNG-CDE = 'M')     03588001
035890           OR (ASC-PKGNG-CDE-OLD = 'I' AND ASC-PKGNG-CDE = 'I')   03589001
035900           OR (ASC-PKGNG-CDE-OLD = 'B' AND ASC-PKGNG-CDE = 'B')   03590001
035910           OR (ASC-PKGNG-CDE-OLD = 'C' AND ASC-PKGNG-CDE = 'C')   03591001
035920           OR (ASC-PKGNG-CDE-OLD = ' ' AND ASC-PKGNG-CDE = ' ')   03592001
035930*            CONTINUE                                             03593001
035940             MOVE SPACE     TO ASC-ANY-LINES-SW                   03594001
035950             IF ASC-PKG-BCS-CHGD                                  03595001
035960                 MOVE SPACE TO ASC-PKG-BCS-SW                     03596001
035970             END-IF                                               03597001
035980         ELSE                                                     03598001
035990             PERFORM 4052-COUNT-CASEPK-SPLIT                      03599001
036000             IF ASC-CASEPACK-SPLT-CNT > 0                         03600001
036010                 SET PS-ERROR                                     03601001
036020                     DP020-MSG-FATAL         TO TRUE              03602001
036030                 MOVE PC-TSYMSG-02476        TO DP020-MSG-NUMBER  03603001
036040                 MOVE DP015-UNP-ALP-BRT-OFF  TO APKGCDEA          03604001
036050                 MOVE DP015-RED              TO APKGCDEC          03605001
036060                 MOVE DP015-REVERSE          TO APKGCDEH          03606001
036070                 MOVE -1                     TO APKGCDEL          03607001
036080                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              03608001
036090             END-IF                                               03609001
036100         END-IF.                                                  03610001
036110*    END-IF.                                                      03611001
036120                                                                  03612001
036130* * *  IF PACK-BY-STORE THEN PACK TYPE CANNOT BE CHANGED          03613001
036140* * *  THEN PO REVISION REQUIRED TO MAKE CHANGE.                  03614001
036150                                                                  03615001
036160     IF (ASC-PACK-BY-ST-IND = 'Y'                                 03616001
036170         AND (ASC-PKGNG-CDE = 'M' OR 'I' OR 'B' OR 'C' OR 'S'))   03617001
036180         SET PS-ERROR                                             03618001
036190             DP020-MSG-FATAL        TO TRUE                       03619001
036200         MOVE PC-TSYMSG-02154       TO DP020-MSG-NUMBER           03620001
036210         MOVE DP015-UNP-ALP-BRT-OFF TO APKBYSTA                   03621001
036220         MOVE DP015-RED             TO APKBYSTC                   03622001
036230         MOVE DP015-REVERSE         TO APKBYSTH                   03623001
036240         MOVE -1                    TO APKBYSTL                   03624001
036250     END-IF.                                                      03625001
036260                                                                  03626001
036270* * * IF NOT PACK-BY-STORE AND PACK TYPE = SPACE                  03627001
036280* * * THEN INVALID PACK-BY-STORE                                  03628001
036290     IF ((ASC-PACK-BY-ST-IND = 'N' OR ' ')                        03629001
036300         AND (ASC-PKGNG-CDE = ' '))                               03630001
036310            SET PS-ERROR                                          03631001
036320                DP020-MSG-FATAL       TO TRUE                     03632001
036330            MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER             03633001
036340            MOVE DP015-UNP-ALP-BRT-OFF  TO APKBYSTA               03634001
036350            MOVE DP015-RED              TO APKBYSTC               03635001
036360            MOVE DP015-REVERSE          TO APKBYSTH               03636001
036370            MOVE -1                     TO APKBYSTL               03637001
036380            SET DP030-SET-CURSOR-APPL-1 TO TRUE                   03638001
036390     ELSE                                                         03639001
036400* * *  IF NOT PACK-BY-STORE AND PACK TYPE NOT VALID CODES         03640001
036410* * *  OF M,I,B,C,S OR ' '                                        03641001
036420* * *  THEN PO REVISION REQUIRED TO MAKE CHANGE.                  03642001
036430                                                                  03643001
036440         IF ((ASC-PACK-BY-ST-IND = 'N')                           03644001
036450             AND (ASC-PKGNG-CDE NOT = 'M'                         03645001
036460              AND ASC-PKGNG-CDE NOT = 'I'                         03646001
036470              AND ASC-PKGNG-CDE NOT = 'B'                         03647001
036480              AND ASC-PKGNG-CDE NOT = 'C'                         03648001
036490              AND ASC-PKGNG-CDE NOT = 'S'                         03649001
036500              AND ASC-PKGNG-CDE NOT = ' '))                       03650001
036510                 SET PS-ERROR                                     03651001
036520                     DP020-MSG-FATAL   TO TRUE                    03652001
036530                 MOVE PC-TSYMSG-01807  TO DP020-MSG-NUMBER        03653001
036540                 MOVE DP015-UNP-ALP-BRT-OFF                       03654001
036550                                       TO APKGCDEA                03655001
036560                 MOVE DP015-RED        TO APKGCDEC                03656001
036570                 MOVE DP015-REVERSE    TO APKGCDEH                03657001
036580                 MOVE -1               TO APKGCDEL                03658001
036590                 SET DP030-SET-CURSOR-APPL-1                      03659001
036600                                       TO TRUE                    03660001
036610         END-IF                                                   03661001
036620     END-IF.                                                      03662001
036630                                                                  03663001
036640* * *  IF PACK-BY-STORE = SPACES AND PACK TYPE                    03664001
036650* * *  NOT A VALID PACK TYPE OF M,I,B,C,S OR SPACE                03665001
036660* * *  THEN PO REVISION REQUIRED TO MAKE CHANGE.                  03666001
036670                                                                  03667001
036680     IF ((ASC-PACK-BY-ST-IND = SPACE)                             03668001
036690         AND (ASC-PKGNG-CDE NOT = 'M'                             03669001
036700              AND ASC-PKGNG-CDE NOT = 'I'                         03670001
036710              AND ASC-PKGNG-CDE NOT = 'B'                         03671001
036720              AND ASC-PKGNG-CDE NOT = 'C'                         03672001
036730              AND ASC-PKGNG-CDE NOT = 'S'                         03673001
036740              AND ASC-PKGNG-CDE NOT = ' '))                       03674001
036750         SET PS-ERROR                                             03675001
036760             DP020-MSG-FATAL        TO TRUE                       03676001
036770         MOVE PC-TSYMSG-01807       TO DP020-MSG-NUMBER           03677001
036780         MOVE DP015-UNP-ALP-BRT-OFF TO APKGCDEA                   03678001
036790         MOVE DP015-RED             TO APKGCDEC                   03679001
036800         MOVE DP015-REVERSE         TO APKGCDEH                   03680001
036810         MOVE -1                    TO APKGCDEL                   03681001
036820         SET DP030-SET-CURSOR-APPL-1                              03682001
036830                                    TO TRUE                       03683001
036840     END-IF.                                                      03684001
036850* * *  PACK-BY-STORE FLAG AND PACKAGE CODE USE ARE MUTUALLY       03685001
036860* * *  EXCLUSIVE.                                                 03686001
036870****************************************************************  03687001
036880*  UPDATE SCREEN  *                                               03688001
036890****************************************************************  03689001
036900                                                                  03690001
036910     IF ASC-UPDATE-PENDING  AND                                   03691001
036920                                                                  03692001
036940        PS-NO-ERROR                                               03694001
036960                                                                  03696001
036970*   CHECK FOR VALID ENTRYS IN PACK TYPE AND PACK-BY-STORE         03697001
036980      IF ((ASC-PKGNG-CDE = 'B' OR 'C' OR 'S' OR 'M' OR 'I')       03698001
036990        AND (ASC-PACK-BY-ST-IND = 'Y'))                           03699001
037000            SET PS-ERROR                                          03700001
037010                DP020-MSG-FATAL        TO TRUE                    03701001
037020            MOVE PC-TSYMSG-02154       TO DP020-MSG-NUMBER        03702001
037030            MOVE DP015-UNP-ALP-BRT-OFF TO APKBYSTA                03703001
037040            MOVE DP015-RED             TO APKBYSTC                03704001
037050            MOVE DP015-REVERSE         TO APKBYSTH                03705001
037060            MOVE DP015-UNP-ALP-BRT-OFF TO APKGCDEA                03706001
037070            MOVE DP015-RED             TO APKGCDEC                03707001
037080            MOVE DP015-REVERSE         TO APKGCDEH                03708001
037090            MOVE -1                    TO APKGCDEL                03709001
037100            SET DP030-SET-CURSOR-APPL-1                           03710001
037110                                       TO TRUE                    03711001
037120      ELSE                                                        03712001
037130                                                                  03713001
037140*   THE SCREEN PACK TYPE UPDATED FROM  'M' TO 'I' OR 'I' TO 'M'   03714001
037150*   SEND INFORMATIONAL MESSAGE AND SET SWITCH                     03715001
037160                                                                  03716001
037170       IF (ASC-PKGNG-CDE-OLD = 'M' AND (ASC-PKGNG-CDE = 'I'))     03717001
037180         OR (ASC-PKGNG-CDE-OLD = 'I' AND (ASC-PKGNG-CDE = 'M'))   03718001
037190*JPL - ADDED 'IF'/'END-IF' STATEMENTS                             03719001
037200           IF ASC-CASEPACK-SPLT-CNT = 0                           03720001
037210             AND (NOT DP020-MSG-FATAL)                            03721001
037220               MOVE PC-TSYMSG-02162        TO DP020-MSG-NUMBER    03722001
037230               SET DP020-MSG-INFORMATIONAL TO TRUE                03723001
037240               SET PS-INFO-MSG-FND         TO TRUE                03724001
037250           END-IF                                                 03725001
037260       ELSE                                                       03726001
037270                                                                  03727001
037280*   THE SCREEN PACK TYPE UPDATED FROM  'B' 'C' OR 'S'             03728001
037290*   TO ONE OF SAME OR SCREEN PACK TYPE 'M' OR 'I' UNCHANGED       03729001
037300*   THEN CODES ARE VALID                                          03730001
037310                                                                  03731001
037320         IF ((ASC-PKGNG-CDE-OLD = 'B' OR 'C' OR 'S' OR ' ')       03732001
037330           AND (ASC-PKGNG-CDE = 'B' OR 'C' OR 'S'))               03733001
037340             CONTINUE                                             03734001
037350         ELSE                                                     03735001
037360           IF (ASC-PKGNG-CDE-OLD = 'M' AND ASC-PKGNG-CDE = 'M')   03736001
037370           OR (ASC-PKGNG-CDE-OLD = 'I' AND ASC-PKGNG-CDE = 'I')   03737001
037380             CONTINUE                                             03738001
037390           ELSE                                                   03739001
037400                                                                  03740001
037410*   THE SCREEN PACK TYPE 'B' 'C' 'S' OR ' '                       03741001
037420*   CANNOT BE CHANGED TO                                          03742001
037430*   'M' OR 'I' FROM THE UPDATE SCREEN                             03743001
037440*   UNLESS ALL OF THE PACK LINES ARE INACTIVE.                    03744001
037450                                                                  03745001
037460            IF ((ASC-PKGNG-CDE-OLD = 'B' OR 'C' OR 'S' OR ' ')    03746001
037470              AND (ASC-PKGNG-CDE = 'M' OR 'I'))                   03747001
037480                                                                  03748001
037490              SET ASC-PKG-BCS-NOTCHGD    TO TRUE                  03749001
037500              MOVE SPACE TO ASC-ANY-LINES-SW                      03750001
037510              MOVE SPACE TO ASC-ALL-LINES-SW                      03751001
037520                                                                  03752001
037530              INITIALIZE PV-DB2-COUNT                             03753001
037540              PERFORM 3175-CHECK-ALL-INACT                        03754001
037550              IF PV-DB2-COUNT > +0                                03755001
037560                  SET PS-ERROR                                    03756001
037570                      DP020-MSG-FATAL     TO TRUE                 03757001
037580                  MOVE PC-TSYMSG-02153    TO DP020-MSG-NUMBER     03758001
037590                  MOVE DP015-UNP-ALP-BRT-OFF                      03759001
037600                                          TO APKGCDEA             03760001
037610                  MOVE DP015-RED          TO APKGCDEC             03761001
037620                  MOVE DP015-REVERSE      TO APKGCDEH             03762001
037630                  MOVE -1                 TO APKGCDEL             03763001
037640                  SET DP030-SET-CURSOR-APPL-1                     03764001
037650                                          TO TRUE                 03765001
037660              END-IF                                              03766001
037670            ELSE                                                  03767001
037680                                                                  03768001
037690*   THE SCREEN PACK TYPE 'M','I','B','C'OR 'S' CHANGES TO SPACE   03769001
037700             IF ((ASC-PKGNG-CDE-OLD = 'M' OR 'I' OR               03770001
037710                                      'B' OR 'C' OR 'S')          03771001
037720                AND (ASC-PKGNG-CDE = ' ')                         03772001
037730                AND (ASC-PACK-BY-ST-IND = 'Y'))                   03773001
037740                MOVE PC-TSYMSG-02456      TO DP020-MSG-NUMBER     03774001
037750                SET DP020-MSG-INFORMATIONAL  TO TRUE              03775001
037760                SET PS-INFO-MSG-FND          TO TRUE              03776001
037770             ELSE                                                 03777001
037780                                                                  03778001
037790*   THE SCREEN PACK TYPE REMAINS SPACE                            03779001
037800               IF ((ASC-PKGNG-CDE-OLD = ' ')                      03780001
037810                  AND (ASC-PKGNG-CDE = ' ')                       03781001
037820                  AND (ASC-PACK-BY-ST-IND = 'Y'))                 03782001
037830                     CONTINUE                                     03783001
037840               ELSE                                               03784001
037850                                                                  03785001
037860*   THE SCREEN PACK TYPE B,C,S,M,I CHANGES TO SPACE               03786001
037870*   AND PACK BY STORE = 'N' OR ' '                                03787001
037880*   VALIDATED ABOVE SO THIS CHECK BYPASSES FALLING                03788001
037890*   INTO LAST ERROR CHECK                                         03789001
037900                IF ((ASC-PKGNG-CDE-OLD = 'B' OR 'C' OR 'S'        03790001
037910                                      OR 'M' OR 'I')              03791001
037920                    AND (ASC-PKGNG-CDE = ' ')                     03792001
037930                    AND (ASC-PACK-BY-ST-IND = 'N' OR ' '))        03793001
037940                       CONTINUE                                   03794001
037950                ELSE                                              03795001
037960                                                                  03796001
037970*   THE SCREEN PACK TYPE 'M' OR 'I' CHANGES TO 'B' 'C' 'S'        03797001
037980                 IF ((ASC-PKGNG-CDE-OLD = 'M' OR 'I')             03798001
037990                   AND (ASC-PKGNG-CDE = 'B' OR 'C' OR 'S')        03799001
038000                   AND (ASC-PACK-BY-ST-IND = 'N'))                03800001
038010                     SET ASC-PKG-BCS-CHGD     TO TRUE             03801001
038020                 ELSE                                             03802001
038030                    SET PS-ERROR                                  03803001
038040                    DP020-MSG-FATAL          TO TRUE              03804001
038050                    MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER     03805001
038060                    MOVE DP015-UNP-ALP-BRT-OFF  TO APKGCDEA       03806001
038070                    MOVE DP015-RED              TO APKGCDEC       03807001
038080                    MOVE DP015-REVERSE          TO APKGCDEH       03808001
038090                    MOVE -1                     TO APKGCDEL       03809001
038100                    SET DP030-SET-CURSOR-APPL-1 TO TRUE           03810001
038110                 END-IF                                           03811001
038120                END-IF                                            03812001
038130               END-IF                                             03813001
038140             END-IF                                               03814001
038150            END-IF                                                03815001
038160           END-IF                                                 03816001
038170         END-IF                                                   03817001
038180       END-IF                                                     03818001
038190      END-IF                                                      03819001
038200     END-IF.                                                      03820001
038210                                                                  03821001
038220*   MOVE PACK TYPE AND DESCRIPTION TO SCREEN                      03822001
038230     MOVE ASC-PKGNG-CDE           TO APKGCDEO.                    03823001
038240                                                                  03824001
038250     EVALUATE ASC-PKGNG-CDE                                       03825001
038260         WHEN PC-I                                                03826001
038270             MOVE PC-INNER-PPK    TO APKGDSCO                     03827001
038280         WHEN PC-M                                                03828001
038290             MOVE PC-MULTI-SKU    TO APKGDSCO                     03829001
038300         WHEN PC-S                                                03830001
038310             MOVE PC-SINGLE-SKU   TO APKGDSCO                     03831001
038320         WHEN PC-C                                                03832001
038330             MOVE PC-CASEPACK     TO APKGDSCO                     03833001
038340         WHEN PC-B                                                03834001
038350             MOVE PC-BULK-PACK    TO APKGDSCO                     03835001
038360*        WHEN LOW-VALUES                                          03836001
038370*            MOVE PC-NOT-FOUND    TO APKGDSCO                     03837001
038380         WHEN OTHER                                               03838001
038390             MOVE SPACES          TO APKGDSCO                     03839001
038400     END-EVALUATE.                                                03840001
038410                                                                  03841001
038420*  CHECK IF ALL RECEIVER LINES INACTIVE (I)                       03842001
038430*  IF SO, SET MESSAGE SWITCH FOR UPDATE CHECK.                    03843001
038440                                                                  03844001
038450     IF ASC-PKG-BCS-CHGD                                          03845001
038460                                                                  03846001
038470         INITIALIZE PV-DB2-COUNT                                  03847001
038480         PERFORM 3175-CHECK-ALL-INACT                             03848001
038490         IF PV-DB2-COUNT > +0                                     03849001
038500             MOVE SPACES           TO ASC-ALL-LINES-SW            03850001
038510         ELSE                                                     03851001
038520             SET ASC-ALL-LINES     TO TRUE                        03852001
038530         END-IF                                                   03853001
038540     END-IF.                                                      03854001
038550                                                                  03855001
038560*   CHECK IF ANY RECEIVER LINES WHERE VERIFIED OR COMPLETED       03856001
038570                                                                  03857001
038580     IF ASC-PKG-BCS-CHGD                                          03858001
038590                                                                  03859001
038600         INITIALIZE PV-DB2-COUNT                                  03860001
038610         PERFORM 3170-CHECK-ANY-VERIFIED                          03861001
038620         IF PV-DB2-COUNT > +0                                     03862001
038630             SET PS-ERROR                                         03863001
038640                 DP020-MSG-FATAL       TO TRUE                    03864001
038650             MOVE PC-TSYMSG-02155      TO DP020-MSG-NUMBER        03865001
038660             MOVE DP015-UNP-ALP-BRT-OFF                           03866001
038670                                       TO APKBYSTA                03867001
038680             MOVE DP015-RED            TO APKBYSTC                03868001
038690             MOVE DP015-REVERSE        TO APKBYSTH                03869001
038700             MOVE -1                   TO APKBYSTL                03870001
038710             SET DP030-SET-CURSOR-APPL-1                          03871001
038720                                       TO TRUE                    03872001
038730         END-IF                                                   03873001
038740     END-IF.                                                      03874001
038750                                                                  03875001
038760*  CHECK IF ANY RECEIVER LINES ARE ACTIVE (A)                     03876001
038770*  IF SO, SET MESSAGE SWITCH FOR UPDATE CHECK.                    03877001
038780                                                                  03878001
038790     IF ASC-PKG-BCS-CHGD                                          03879001
038800                                                                  03880001
038810         INITIALIZE PV-DB2-COUNT                                  03881001
038820         PERFORM 3180-CHECK-ANY-ACT-INPROC                        03882001
038830         IF PV-DB2-COUNT > +0                                     03883001
038840             SET ASC-ANY-LINES         TO TRUE                    03884001
038850         ELSE                                                     03885001
038860             MOVE SPACES               TO ASC-ANY-LINES-SW        03886001
038870         END-IF                                                   03887001
038880     END-IF.                                                      03888001
038890                                                                  03889001
038900***************************************************************** 03890001
038910     IF  ASC-PRE-TKT-IND = (' ' OR 'Y' OR 'N')                    03891001
038920         CONTINUE                                                 03892001
038930     ELSE                                                         03893001
038940         SET PS-ERROR                                             03894001
038950             DP020-MSG-FATAL        TO TRUE                       03895001
038960         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           03896001
038970         MOVE DP015-UNP-ALP-BRT-OFF TO APRETKTA                   03897001
038980         MOVE DP015-RED             TO APRETKTC                   03898001
038990         MOVE DP015-REVERSE         TO APRETKTH                   03899001
039000         MOVE -1                    TO APRETKTL                   03900001
039010         SET DP030-SET-CURSOR-APPL-1                              03901001
039020                                    TO TRUE                       03902001
039030     END-IF.                                                      03903001
039040                                                                  03904001
039050     IF  ASC-HANGER-IND = (' ' OR 'Y' OR 'N')                     03905001
039060         CONTINUE                                                 03906001
039070     ELSE                                                         03907001
039080         SET PS-ERROR                                             03908001
039090             DP020-MSG-FATAL        TO TRUE                       03909001
039100         MOVE PC-TSYMSG-00005       TO DP020-MSG-NUMBER           03910001
039110         MOVE DP015-UNP-ALP-BRT-OFF TO AHANGERA                   03911001
039120         MOVE DP015-RED             TO AHANGERC                   03912001
039130         MOVE DP015-REVERSE         TO AHANGERH                   03913001
039140         MOVE -1                    TO AHANGERL                   03914001
039150         SET DP030-SET-CURSOR-APPL-1                              03915001
039160                                    TO TRUE                       03916001
039170     END-IF.                                                      03917001
039180                                                                  03918001
039190     IF  ASC-ADD-PENDING                                          03919001
039200         IF  ASC-DMG-CART-CNT = SPACES                            03920001
039210             SET PS-ERROR                                         03921001
039220                 DP020-MSG-FATAL        TO TRUE                   03922001
039230             MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER       03923001
039240             MOVE DP015-UNP-ALP-BRT-OFF TO ADMGCNTA               03924001
039250             MOVE DP015-RED             TO ADMGCNTC               03925001
039260             MOVE DP015-REVERSE         TO ADMGCNTH               03926001
039270             MOVE -1                    TO ADMGCNTL               03927001
039280             SET DP030-SET-CURSOR-APPL-1                          03928001
039290                                        TO TRUE                   03929001
039300         END-IF                                                   03930001
039310     END-IF.                                                      03931001
039320                                                                  03932001
039330     IF  ASC-DMG-CART-CNT > SPACES                                03933001
039340         MOVE ASC-DMG-CART-CNT      TO DP010I-UNEDITED-FIELD      03934001
039350         MOVE LENGTH OF ASC-DMG-CART-CNT                          03935001
039360                                    TO DP010I-MAXIMUM-DIGITS      03936001
039370         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    03937001
039380         SET  DP010I-NEGATIVE-NOT-ALLOWED                         03938001
039390                                    TO TRUE                       03939001
039400         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03940034
039401              USING DP010I-NUMERIC-EDIT-AREA                      03940134
039410         IF  DP010I-ERROR-DETECTED                                03941001
039420             SET PS-ERROR                                         03942001
039430                 DP020-MSG-FATAL    TO TRUE                       03943001
039440             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           03944001
039450             MOVE DP015-UNP-ALP-BRT-OFF                           03945001
039460                                    TO ADMGCNTA                   03946001
039470             MOVE DP015-RED         TO ADMGCNTC                   03947001
039480             MOVE DP015-REVERSE     TO ADMGCNTH                   03948001
039490             MOVE -1                TO ADMGCNTL                   03949001
039500             SET DP030-SET-CURSOR-APPL-1                          03950001
039510                                    TO TRUE                       03951001
039520        ELSE                                                      03952001
039530             MOVE DP010I-NUMERIC-FIELD                            03953001
039540                                    TO ASC-DMG-CART-CNT-N         03954001
039550             MOVE ASC-DMG-CART-CNT  TO ADMGCNTO                   03955001
039560         END-IF                                                   03956001
039570     END-IF.                                                      03957001
039580                                                                  03958001
039590     IF  ASC-ACTL-CART-CNT > SPACES                               03959001
039600         MOVE ASC-ACTL-CART-CNT     TO DP010I-UNEDITED-FIELD      03960001
039610         MOVE LENGTH OF ASC-ACTL-CART-CNT                         03961001
039620                                    TO DP010I-MAXIMUM-DIGITS      03962001
039630         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    03963001
039640         SET  DP010I-NEGATIVE-NOT-ALLOWED                         03964001
039650                                    TO TRUE                       03965001
039660         CALL DP010I-NUMERIC-EDIT-ROUTINE                         03966034
039661              USING DP010I-NUMERIC-EDIT-AREA                      03966134
039670         IF  DP010I-ERROR-DETECTED                                03967001
039680             SET PS-ERROR                                         03968001
039690                 DP020-MSG-FATAL    TO TRUE                       03969001
039700             MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER           03970001
039710             MOVE DP015-UNP-ALP-BRT-OFF                           03971001
039720                                    TO AACTCNTA                   03972001
039730             MOVE DP015-RED         TO AACTCNTC                   03973001
039740             MOVE DP015-REVERSE     TO AACTCNTH                   03974001
039750             MOVE -1                TO AACTCNTL                   03975001
039760             SET DP030-SET-CURSOR-APPL-1                          03976001
039770                                    TO TRUE                       03977001
039780        ELSE                                                      03978001
039790             MOVE DP010I-NUMERIC-FIELD                            03979001
039800                                    TO ASC-ACTL-CART-CNT-N        03980001
039810             MOVE ASC-ACTL-CART-CNT TO AACTCNTO                   03981001
039820         END-IF                                                   03982001
039830     END-IF.                                                      03983001
039840                                                                  03984001
039850     IF  PS-NO-ERROR                                              03985001
039860     AND ASC-ACTL-CART-CNT > SPACES                               03986001
039870         IF  ASC-ACTL-CART-CNT NOT = ASC-ACTL-CART-CNT-OLD        03987001
039880             IF  ASC-RCVG-CLERK-INIT-ID = SPACES                  03988001
039890                 SET PS-ERROR                                     03989001
039900                     DP020-MSG-FATAL        TO TRUE               03990001
039910                 MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER   03991001
039920                 MOVE DP015-UNP-ALP-BRT-OFF TO ACLERKA            03992001
039930                 MOVE DP015-RED             TO ACLERKC            03993001
039940                 MOVE DP015-REVERSE         TO ACLERKH            03994001
039950                 MOVE -1                    TO ACLERKL            03995001
039960                 SET DP030-SET-CURSOR-APPL-1                      03996001
039970                                            TO TRUE               03997001
039980             END-IF                                               03998001
039990         END-IF                                                   03999001
040000     END-IF.                                                      04000001
040010                                                                  04001001
040020     IF ASC-UPDATE-PENDING OR ASC-ADD-PENDING                     04002001
040030        IF  ASC-REC-TYP = ('MR' OR 'AP' OR 'DC' OR 'CR')          04003001
040040* * REC-TYP CAN NOT BE CHANGED IF CASEPACK HAS BEEN RUN           04004001
040050          INITIALIZE ASC-CASEPACK-SPLT-CNT                        04005001
040060                     ASC-OTBND-CTN-CNT                            04006001
040070          PERFORM 3030-CASEPACK-CHECK                             04007001
040080           IF ASC-REC-TYP = 'DC'                                  04008001
040090             AND ASC-CASEPACK-SPLT-CNT = 0                        04009001
040100             AND ASC-OTBND-CTN-CNT     = 0                        04010001
040110              PERFORM 4070-SELECT-TPKSLIP                         04011001
040120              PERFORM 3165-PO-TYPE                                04012001
040130              IF ASC-ASN-IND = 'X'                                04013001
040140                 EVALUATE TRUE                                    04014001
040150                    WHEN (ASC-PO-TYPE = ('IM' OR 'IF' OR 'IE') AND04015001
040160                          ASC-PKGNG-CDE =                         04016001
040170                          ('B' OR 'C' OR 'M' OR 'I'))             04017001
040180                          CONTINUE                                04018001
040190                    WHEN (ASC-PO-TYPE = ('ST' OR 'FB' OR 'EC') AND04019001
040200                          ASC-PKGNG-CDE =                         04020001
040210                          ('B' OR 'C' OR 'M' OR 'I'))             04021001
040220                          SET PS-ERROR                            04022001
040230                              DP020-MSG-FATAL        TO TRUE      04023001
040240                          MOVE PC-TSYMSG-03230 TO DP020-MSG-NUMBER04024001
040250                          MOVE DP015-UNP-ALP-BRT-OFF TO ARECTYPA  04025001
040260                          MOVE DP015-RED             TO ARECTYPC  04026001
040270                          MOVE DP015-REVERSE         TO ARECTYPH  04027001
040280                          MOVE -1                    TO ARECTYPL  04028001
040290                          SET DP030-SET-CURSOR-APPL-1             04029001
040300                                                        TO TRUE   04030001
040310                    WHEN (ASC-PO-TYPE = 'ST' OR                   04031001
040320                         ASC-PO-TYPE = 'FB' OR                    04032001
040330                         ASC-PO-TYPE = 'EC' OR                    04033001
040340                         ASC-PO-TYPE = 'IM' OR                    04034001
040350                         ASC-PO-TYPE = 'IF' OR                    04035001
040360                         ASC-PO-TYPE = 'IE' OR                    04036001
040370                         ASC-PO-TYPE = 'IN' OR                    04037001
040380                         ASC-PO-TYPE = 'RE' OR                    04038027
040390                         ASC-PO-TYPE = 'LD' OR                    04039001
040400                         ASC-PO-TYPE = 'LE' OR                    04040027
040410                         ASC-PO-TYPE = 'SP') AND                  04041001
040420                         ASC-PACK-BY-ST-IND = 'Y'                 04042001
040430                          CONTINUE                                04043001
040440                 END-EVALUATE                                     04044001
040450              END-IF                                              04045001
040460           ELSE                                                   04046001
040470               PERFORM 3165-PO-TYPE                               04047001
040480               IF ASC-PO-TYPE = 'CD'                              04048001
040490                  SET DP008-RSRC-TYPE-FUNC     TO TRUE            04049023
040500                  MOVE 'RCCDRCRE'  TO DP008-FUNCTION-NAME         04050023
040510                  SET DP008-ACCESS-TYPE-USE    TO TRUE            04051023
040520                                                                  04052023
040530                  EXEC CICS                                       04053023
040540                      LINK PROGRAM (DP008-SECURITY-SUBROUTINE)    04054023
040550                           COMMAREA (DP008-SECURITY-COMMAREA)     04055023
040560                           LENGTH (DP008-SECURITY-COMMAREA-LENGTH)04056023
040570                  END-EXEC                                        04057023
040580                                                                  04058023
040590                  IF DP008-CALL-SUCCESSFUL                        04059023
040600                     IF DP008-ACCESS-ALLOWED                      04060023
040610                        CONTINUE                                  04061023
040620                     ELSE                                         04062023
040630*                  -- NO SECURITY CLEARANCE FOR FUNCTION --       04063023
040640                        SET PS-ERROR                              04064023
040650                            DP020-MSG-FATAL        TO TRUE        04065023
040660                        MOVE PC-TSYMSG-03405 TO DP020-MSG-NUMBER  04066023
040670                        MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA     04067023
040680                        MOVE DP015-RED             TO APONBRC     04068023
040690                        MOVE DP015-REVERSE         TO APONBRH     04069023
040700                        MOVE -1                    TO APONBRL     04070023
040710                        SET DP030-SET-CURSOR-APPL-1               04071023
040720                                                   TO TRUE        04072024
040730                     END-IF                                       04073023
040740                  ELSE                                            04074023
040750                     MOVE '3000-EDIT-DATA-IN-COMMAREA'            04075025
040760                                     TO DP013-PARAGRAPH           04076023
040770                     MOVE 'UNABLE TO ACCESS CICS RACF'            04077025
040780                                     TO DP013-MESSAGE-TEXT (1)    04078023
040790                     MOVE SQLCA           TO DP013-SQLCA          04079023
040800                     SET DP013-DB2-ABEND                          04080023
040810                         DP013-XCTL-DISPLAY-RESTART               04081023
040820                                          TO TRUE                 04082024
040830                     PERFORM DP013-0000-PROCESS-ABEND             04083023
040840                  END-IF                                          04084023
040850               END-IF                                             04085001
040860           END-IF                                                 04086001
040870        ELSE                                                      04087001
040880            SET PS-ERROR                                          04088001
040890                DP020-MSG-FATAL        TO TRUE                    04089001
040900            MOVE PC-TSYMSG-03165       TO DP020-MSG-NUMBER        04090001
040910            MOVE DP015-UNP-ALP-BRT-OFF TO ARECTYPA                04091001
040920            MOVE DP015-RED             TO ARECTYPC                04092001
040930            MOVE DP015-REVERSE         TO ARECTYPH                04093001
040940            MOVE -1                    TO ARECTYPL                04094001
040950            SET DP030-SET-CURSOR-APPL-1                           04095001
040960                                       TO TRUE                    04096001
040970        END-IF                                                    04097001
040980     END-IF.                                                      04098001
040990                                                                  04099001
041000*    DO NOT ALLOW CHANGE OF PACK-BY-STORE FROM 'Y' TO 'N'         04100001
041010*    AND THE PACK-TYPE FROM SPACE TO WHATEVER IF THERE ARE        04101001
041020*    ACTIVE OUTBOUND CARTONS.                                     04102001
041030                                                                  04103001
041040*** TKMA177 BEGIN - 12/11/08                                      04104001
041050     IF ASC-UPDATE-PENDING                                        04105001
041060         IF ASC-PACK-BY-ST-IND-OLD = 'Y' AND                      04106001
041070                             ASC-PACK-BY-ST-IND = 'N' OR SPACE    04107001
041080             IF ASC-PKGNG-CDE-OLD = SPACE AND                     04108001
041090                     ASC-PKGNG-CDE NOT = SPACE                    04109001
041100                                                                  04110001
041110             MOVE ZEROES                    TO ASC-OTBND-CTN-CNT  04111001
041120             PERFORM 4053-COUNT-OUTBOUND                          04112001
041130             IF ASC-OTBND-CTN-CNT > ZERO                          04113001
041140                SET PS-ERROR                                      04114001
041150                    DP020-MSG-FATAL         TO TRUE               04115001
041160                MOVE PC-TSYMSG-03655        TO DP020-MSG-NUMBER   04116001
041170                MOVE DP015-UNP-ALP-BRT-OFF  TO APKGCDEA           04117001
041180                                               APKBYSTA           04118001
041190                MOVE DP015-RED              TO APKGCDEC           04119001
041200                                               APKBYSTC           04120001
041210                MOVE DP015-REVERSE          TO APKGCDEH           04121001
041220                                               APKBYSTH           04122001
041230                MOVE -1                     TO APKGCDEL           04123001
041240                SET DP030-SET-CURSOR-APPL-1 TO TRUE               04124001
041250             END-IF                                               04125001
041260         END-IF                                                   04126001
041270     END-IF.                                                      04127001
041280*** TKMA177 END   - 12/11/08                                      04128001
041290                                                                  04129001
041300                                                                  04130001
041310     IF  ASC-ADD-PENDING                                          04131001
041320         IF  ASC-EXPTED-CART-CNT = SPACES                         04132001
041330             SET PS-ERROR                                         04133001
041340                 DP020-MSG-FATAL        TO TRUE                   04134001
041350             MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER       04135001
041360             MOVE DP015-UNP-ALP-BRT-OFF TO ACTNCNTA               04136001
041370             MOVE DP015-RED             TO ACTNCNTC               04137001
041380             MOVE DP015-REVERSE         TO ACTNCNTH               04138001
041390             MOVE -1                    TO ACTNCNTL               04139001
041400             SET DP030-SET-CURSOR-APPL-1                          04140001
041410                                        TO TRUE                   04141001
041420         ELSE                                                     04142001
041430             MOVE ASC-EXPTED-CART-CNT   TO DP010I-UNEDITED-FIELD  04143001
041440             MOVE LENGTH OF ASC-EXPTED-CART-CNT                   04144001
041450                                        TO DP010I-MAXIMUM-DIGITS  04145001
041460             MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS04146001
041470             SET  DP010I-NEGATIVE-NOT-ALLOWED                     04147001
041480                                        TO TRUE                   04148001
041490             CALL DP010I-NUMERIC-EDIT-ROUTINE                     04149034
041491                  USING DP010I-NUMERIC-EDIT-AREA                  04149134
041500             IF  DP010I-ERROR-DETECTED                            04150001
041510                 SET PS-ERROR                                     04151001
041520                     DP020-MSG-FATAL    TO TRUE                   04152001
041530                 MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       04153001
041540                 MOVE DP015-UNP-ALP-BRT-OFF                       04154001
041550                                        TO ACTNCNTA               04155001
041560                 MOVE DP015-RED         TO ACTNCNTC               04156001
041570                 MOVE DP015-REVERSE     TO ACTNCNTH               04157001
041580                 MOVE -1                TO ACTNCNTL               04158001
041590                 SET DP030-SET-CURSOR-APPL-1                      04159001
041600                                        TO TRUE                   04160001
041610             ELSE                                                 04161001
041620                 MOVE DP010I-NUMERIC-FIELD                        04162001
041630                                        TO ASC-EXPTED-CART-CNT-N  04163001
041640                 MOVE ASC-EXPTED-CART-CNT                         04164001
041650                                        TO ACTNCNTO               04165001
041660            END-IF                                                04166001
041670        END-IF                                                    04167001
041680     END-IF.                                                      04168001
041690                                                                  04169001
041700*  CHECK THIS FIRST SO THAT THE CURR KEY FIELDS ARE LOADED        04170001
041710*  BEFORE CHECKING THE OPER-SET                                   04171001
041720                                                                  04172001
041730     IF ASC-COPER-UNT-ID = (SPACES OR ZEROES)                     04173001
041740         SET PS-ERROR                                             04174001
041750             DP020-MSG-FATAL         TO TRUE                      04175001
041760         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          04176001
041770         MOVE DP015-UNP-ALP-BRT-OFF                               04177001
041780                                 TO ACOPERA                       04178001
041790         MOVE DP015-RED              TO ACOPERC                   04179001
041800         MOVE DP015-REVERSE          TO ACOPERH                   04180001
041810         MOVE -1                     TO ACOPERL                   04181001
041820         SET DP030-SET-CURSOR-APPL-1                              04182001
041830                                 TO TRUE                          04183001
041840     ELSE                                                         04184001
041850         MOVE ASC-COPER-UNT-ID        TO DP010I-UNEDITED-FIELD    04185001
041860         MOVE LENGTH OF ASC-COPER-UNT-ID                          04186001
041870                                 TO DP010I-MAXIMUM-DIGITS         04187001
041880         MOVE ZERO                   TO DP010I-MAXIMUM-DECIMALS   04188001
041890         SET DP010I-NEGATIVE-NOT-ALLOWED                          04189001
041900                                 TO TRUE                          04190001
041910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04191034
041911              USING DP010I-NUMERIC-EDIT-AREA                      04191134
041920         IF      DP010I-ERROR-DETECTED                            04192001
041930             SET PS-ERROR                                         04193001
041940                 DP020-MSG-FATAL TO TRUE                          04194001
041950             MOVE PC-TSYMSG-00008                                 04195001
041960                                 TO DP020-MSG-NUMBER              04196001
041970             MOVE DP015-UNP-ALP-BRT-OFF                           04197001
041980                                 TO ACOPERA                       04198001
041990             MOVE DP015-RED          TO ACOPERC                   04199001
042000             MOVE DP015-REVERSE      TO ACOPERH                   04200001
042010             MOVE -1                 TO ACOPERL                   04201001
042020             SET DP030-SET-CURSOR-APPL-1                          04202001
042030                                 TO TRUE                          04203001
042040         ELSE                                                     04204001
042050             MOVE DP010I-NUMERIC-FIELD                            04205001
042060                                 TO ASC-COPER-UNT-ID-N            04206001
042070             MOVE ASC-COPER-UNT-ID                                04207001
042080                                 TO ACOPERO                       04208001
042090                                    CURR-OPER-UNT-ID              04209001
042100             PERFORM 3010-VALIDATE-OPER-UNT-ID                    04210001
042110             IF  PS-INVALID-LOC                                   04211001
042120                 SET PS-ERROR                                     04212001
042130                     DP020-MSG-FATAL         TO TRUE              04213001
042140                 MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER  04214001
042150                 MOVE DP015-UNP-ALP-BRT-OFF                       04215001
042160                                         TO ACOPERA               04216001
042170                 MOVE DP015-RED              TO ACOPERC           04217001
042180                 MOVE DP015-REVERSE          TO ACOPERH           04218001
042190                 MOVE -1                     TO ACOPERL           04219001
042200                 SET DP030-SET-CURSOR-APPL-1                      04220001
042210                                         TO TRUE                  04221001
042220*            ELSE                                                 04222001
042230*                MOVE ASC-COPER-UNT-ID  TO  PV-COPER-UNT-ID       04223001
042240*                PERFORM 8010-CHECK-TKRPRPM                       04224001
042250*                IF  PS-ASNS-TO-WMS-YES                           04225001
042260*                    SET PS-ERROR                                 04226001
042270*                        DP020-MSG-FATAL         TO TRUE          04227001
042280*                    MOVE PC-TSYMSG-03583 TO DP020-MSG-NUMBER     04228001
042290*                    MOVE DP015-UNP-ALP-BRT-OFF                   04229001
042300*                                         TO ACOPERA              04230001
042310*                    MOVE DP015-RED              TO ACOPERC       04231001
042320*                    MOVE DP015-REVERSE          TO ACOPERH       04232001
042330*                    MOVE -1                     TO ACOPERL       04233001
042340*                    SET DP030-SET-CURSOR-APPL-1                  04234001
042350*                                         TO TRUE                 04235001
042360*                END-IF                                           04236001
042370             END-IF                                               04237001
042380         END-IF                                                   04238001
042390     END-IF.                                                      04239001
042400                                                                  04240001
042410     IF  PS-NO-ERROR                                              04241001
042420         MOVE ASC-CFCLTY-ID       TO DP010I-UNEDITED-FIELD        04242001
042430         MOVE LENGTH OF ASC-CFCLTY-ID                             04243001
042440                                 TO DP010I-MAXIMUM-DIGITS         04244001
042450         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       04245001
042460         SET DP010I-NEGATIVE-NOT-ALLOWED                          04246001
042470                                 TO TRUE                          04247001
042480         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04248034
042481              USING DP010I-NUMERIC-EDIT-AREA                      04248134
042490         IF  DP010I-ERROR-DETECTED                                04249001
042500             SET PS-ERROR                                         04250001
042510                 DP020-MSG-FATAL TO TRUE                          04251001
042520             MOVE PC-TSYMSG-00008                                 04252001
042530                                 TO DP020-MSG-NUMBER              04253001
042540             MOVE DP015-UNP-ALP-BRT-OFF                           04254001
042550                                 TO ACFCLTYA                      04255001
042560             MOVE DP015-RED      TO ACFCLTYC                      04256001
042570             MOVE DP015-REVERSE  TO ACFCLTYH                      04257001
042580             MOVE -1             TO ACFCLTYL                      04258001
042590             SET DP030-SET-CURSOR-APPL-1                          04259001
042600                                 TO TRUE                          04260001
042610         ELSE                                                     04261001
042620             MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-FCLTY           04262001
042630             MOVE PV-TEMP-FCLTY  TO ASC-CFCLTY-ID-N               04263001
042640                                    CURR-FCLTY-ID                 04264001
042650             MOVE ASC-CFCLTY-ID   TO ACFCLTYO                     04265001
042660             PERFORM 3020-VALIDATE-FCLTY-ID                       04266001
042670             IF  XL071-LOC-NOT-FOUND                              04267001
042680                 SET PS-ERROR                                     04268001
042690                     DP020-MSG-FATAL     TO TRUE                  04269001
042700                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      04270001
042710                 MOVE DP015-UNP-ALP-BRT-OFF                       04271001
042720                                         TO ACFCLTYA              04272001
042730                 MOVE DP015-RED          TO ACFCLTYC              04273001
042740                 MOVE DP015-REVERSE      TO ACFCLTYH              04274001
042750                 MOVE -1                 TO ACFCLTYL              04275001
042760                 SET DP030-SET-CURSOR-APPL-1                      04276001
042770                                         TO TRUE                  04277001
042780             END-IF                                               04278001
042790         END-IF                                                   04279001
042800     END-IF.                                                      04280001
042810                                                                  04281001
042820*  CHECK THE 'CREATED FOR' FIELDS                                 04282001
042830     IF  ASC-ADD-PENDING                                          04283001
042840         IF  ASC-OPER-UNT-ID = (SPACES OR ZEROES)                 04284001
042850             SET PS-ERROR                                         04285001
042860                 DP020-MSG-FATAL     TO TRUE                      04286001
042870             MOVE PC-TSYMSG-00007    TO DP020-MSG-NUMBER          04287001
042880             MOVE DP015-UNP-ALP-BRT-OFF                           04288001
042890                                     TO AOPERA                    04289001
042900             MOVE DP015-RED          TO AOPERC                    04290001
042910             MOVE DP015-REVERSE      TO AOPERH                    04291001
042920             MOVE -1                 TO AOPERL                    04292001
042930             SET DP030-SET-CURSOR-APPL-1                          04293001
042940                                     TO TRUE                      04294001
042950         ELSE                                                     04295001
042960             MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD     04296001
042970             MOVE LENGTH OF ASC-OPER-UNT-ID                       04297001
042980                                     TO DP010I-MAXIMUM-DIGITS     04298001
042990             MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS   04299001
043000             SET DP010I-NEGATIVE-NOT-ALLOWED                      04300001
043010                                     TO TRUE                      04301001
043020             CALL DP010I-NUMERIC-EDIT-ROUTINE                     04302034
043021                  USING DP010I-NUMERIC-EDIT-AREA                  04302134
043030             IF  DP010I-ERROR-DETECTED                            04303001
043040                 SET PS-ERROR                                     04304001
043050                     DP020-MSG-FATAL TO TRUE                      04305001
043060                 MOVE PC-TSYMSG-00008                             04306001
043070                                     TO DP020-MSG-NUMBER          04307001
043080                 MOVE DP015-UNP-ALP-BRT-OFF                       04308001
043090                                     TO AOPERA                    04309001
043100                 MOVE DP015-RED      TO AOPERC                    04310001
043110                 MOVE DP015-REVERSE  TO AOPERH                    04311001
043120                 MOVE -1             TO AOPERL                    04312001
043130                 SET DP030-SET-CURSOR-APPL-1                      04313001
043140                                     TO TRUE                      04314001
043150             ELSE                                                 04315001
043160                 MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-OPER-UNT    04316001
043170                 MOVE PV-TEMP-OPER-UNT TO ASC-OPER-UNT-ID-N       04317001
043180                                        DK-OPER-UNT-ID            04318001
043190                 MOVE ASC-OPER-UNT-ID                             04319001
043200                                     TO AOPERO                    04320001
043210                 PERFORM 3012-VALIDATE-OPER-UNT-ID                04321001
043220                 IF  PS-INVALID-LOC                               04322001
043230                     SET PS-ERROR                                 04323001
043240                         DP020-MSG-FATAL     TO TRUE              04324001
043250                     MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER  04325001
043260                     MOVE DP015-UNP-ALP-BRT-OFF                   04326001
043270                                             TO AOPERA            04327001
043280                     MOVE DP015-RED          TO AOPERC            04328001
043290                     MOVE DP015-REVERSE      TO AOPERH            04329001
043300                     MOVE -1                 TO AOPERL            04330001
043310                     SET DP030-SET-CURSOR-APPL-1                  04331001
043320                                             TO TRUE              04332001
043330                 ELSE                                             04333001
043340                     INITIALIZE PV-DB2-COUNT                      04334001
043350                     MOVE DK-OPER-UNT-ID                          04335001
043360                                        TO DK-LOCATION-NBR        04336001
043370                     PERFORM 4060-CHECK-DIRECT-STORE              04337001
043380                     IF  ASC-DIRECT-STORE-SW = ' '                04338001
043390* NOT DIRECT-STORE                                                04339001
043400                         MOVE ZEROES        TO ASC-AP-RCVR-NBR    04340001
043410                                               AAPRCVRO           04341001
043420                         MOVE DP015-PRO-NOR-MDT                   04342001
043430                                            TO AAPRCVRA           04343001
043440                         MOVE DP015-BLUE    TO AAPRCVRC           04344001
043450                         MOVE DP015-HL-OFF  TO AAPRCVRH           04345001
043460                                                                  04346001
043470                         PERFORM 3120-GET-OPER-SET-INFO           04347001
043480                                                                  04348001
043490                         IF SQLCODE = ZERO                        04349001
043500                            MOVE DCFAAS-OPER-SET-ID               04350001
043510                                           TO ASC-OPER-SET-ID-N   04351001
043520                                              AOPSETI             04352001
043530                                              AOPSETO             04353001
043540                                              DK-OPER-SET-ID      04354001
043550                            MOVE OPRSET-OPER-SET-DESC             04355001
043560                                           TO ASC-OPER-SET-DESC   04356001
043570                                              AOPDESCO            04357001
043580                        ELSE                                      04358001
043590                                                                  04359001
043600                            PERFORM 3080-GET-OPER-SET-ID          04360001
043610                               MOVE COCNTL-DFLT-OPER-SET-ID       04361001
043620                                 TO ASC-OPER-SET-ID-N             04362001
043630                                    AOPSETO                       04363001
043640                                    DK-OPER-SET-ID                04364001
043650                                                                  04365001
043660                         END-IF                                   04366001
043670                                                                  04367001
043680                         PERFORM 3090-VALIDATE-OPER-SET-ID        04368001
043690                                                                  04369001
043700                         IF SQLCODE = +100                        04370001
043710                            SET PS-ERROR                          04371001
043720                            DP020-MSG-FATAL    TO TRUE            04372001
043730                            MOVE PC-TSYMSG-00987 TO               04373001
043740                                              DP020-MSG-NUMBER    04374001
043750                            MOVE DP015-UNP-ALP-BRT-OFF            04375001
043760                                              TO AOPSETA          04376001
043770                            MOVE DP015-RED         TO AOPSETC     04377001
043780                            MOVE DP015-REVERSE     TO AOPSETH     04378001
043790                            MOVE -1                TO AOPSETL     04379001
043800                            SET DP030-SET-CURSOR-APPL-1           04380001
043810                                                   TO TRUE        04381001
043820                         ELSE                                     04382001
043830                             MOVE OPRSET-OPER-SET-DESC            04383001
043840                                             TO ASC-OPER-SET-DESC 04384001
043850                                               AOPDESCO           04385001
043860                             MOVE OPRSET-OPER-SET-DESC            04386001
043870                                            TO ASC-OPER-SET-DESC  04387001
043880                                               AOPDESCO           04388001
043890                         END-IF                                   04389001
043900                     ELSE                                         04390001
043910                         MOVE ZEROES        TO ASC-OPER-SET-ID-N  04391001
043920                                               AOPSETO            04392001
043930                         MOVE 'DIRECT STORE SHIPMENT'             04393001
043940                                            TO ASC-OPER-SET-DESC  04394001
043950                                               AOPDESCO           04395001
043960                         MOVE DP015-UNP-ALP-NOR-MDT               04396001
043970                                            TO AAPRCVRA           04397001
043980                         MOVE DP015-YELLOW  TO AAPRCVRC           04398001
043990                         MOVE DP015-UNDERLINE                     04399001
044000                                            TO AAPRCVRH           04400001
044010                     END-IF                                       04401001
044020                 END-IF                                           04402001
044030             END-IF                                               04403001
044040         END-IF                                                   04404001
044050     END-IF.                                                      04405001
044060                                                                  04406001
044070     IF  ASC-ADD-PENDING                                          04407001
044080     AND PS-NO-ERROR                                              04408001
044090         MOVE ASC-FCLTY-ID       TO DP010I-UNEDITED-FIELD         04409001
044100         MOVE LENGTH OF ASC-FCLTY-ID                              04410001
044110                                 TO DP010I-MAXIMUM-DIGITS         04411001
044120         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       04412001
044130         SET DP010I-NEGATIVE-NOT-ALLOWED                          04413001
044140                                 TO TRUE                          04414001
044150         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04415034
044151              USING DP010I-NUMERIC-EDIT-AREA                      04415134
044160         IF  DP010I-ERROR-DETECTED                                04416001
044170             SET PS-ERROR                                         04417001
044180                 DP020-MSG-FATAL TO TRUE                          04418001
044190             MOVE PC-TSYMSG-00008                                 04419001
044200                                 TO DP020-MSG-NUMBER              04420001
044210             MOVE DP015-UNP-ALP-BRT-OFF                           04421001
044220                                 TO AFCLTYA                       04422001
044230             MOVE DP015-RED      TO AFCLTYC                       04423001
044240             MOVE DP015-REVERSE  TO AFCLTYH                       04424001
044250             MOVE -1             TO AFCLTYL                       04425001
044260             SET DP030-SET-CURSOR-APPL-1                          04426001
044270                                 TO TRUE                          04427001
044280         ELSE                                                     04428001
044290             MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-FCLTY           04429001
044300             MOVE PV-TEMP-FCLTY  TO ASC-FCLTY-ID-N                04430001
044310                                    DK-FCLTY-ID                   04431001
044320                                    CURR-FCLTY-ID                 04432001
044330             MOVE ASC-FCLTY-ID   TO AFCLTYO                       04433001
044340             PERFORM 3020-VALIDATE-FCLTY-ID                       04434001
044350             IF  XL071-LOC-NOT-FOUND                              04435001
044360                 SET PS-ERROR                                     04436001
044370                     DP020-MSG-FATAL     TO TRUE                  04437001
044380                 MOVE PC-TSYMSG-00005    TO DP020-MSG-NUMBER      04438001
044390                 MOVE DP015-UNP-ALP-BRT-OFF                       04439001
044400                                         TO AFCLTYA               04440001
044410                 MOVE DP015-RED          TO AFCLTYC               04441001
044420                 MOVE DP015-REVERSE      TO AFCLTYH               04442001
044430                 MOVE -1                 TO AFCLTYL               04443001
044440                 SET DP030-SET-CURSOR-APPL-1                      04444001
044450                                         TO TRUE                  04445001
044460             END-IF                                               04446001
044470         END-IF                                                   04447001
044480     END-IF.                                                      04448001
044490                                                                  04449001
044500     IF  ASC-EXPENSE-RECEIPT                                      04450001
044510     OR  ASC-DIRECT-STORE                                         04451001
044520         CONTINUE                                                 04452001
044530     ELSE                                                         04453001
044540         IF  ASC-MAY-UPDATE-OPER-SET                              04454001
044550             IF  ASC-OPER-SET-ID = (SPACES OR ZEROES)             04455001
044560                 SET PS-ERROR                                     04456001
044570                     DP020-MSG-FATAL        TO TRUE               04457001
044580                 MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER   04458001
044590                 MOVE DP015-UNP-ALP-BRT-OFF TO AOPSETA            04459001
044600                 MOVE DP015-RED             TO AOPSETC            04460001
044610                 MOVE DP015-REVERSE         TO AOPSETH            04461001
044620                 MOVE -1                    TO AOPSETL            04462001
044630                 SET DP030-SET-CURSOR-APPL-1                      04463001
044640                                            TO TRUE               04464001
044650             ELSE                                                 04465001
044660                 MOVE ASC-OPER-SET-ID    TO DP010I-UNEDITED-FIELD 04466001
044670                 MOVE LENGTH OF ASC-OPER-SET-ID                   04467001
044680                                         TO DP010I-MAXIMUM-DIGITS 04468001
044690                 MOVE ZERO                                        04469001
044700                                     TO DP010I-MAXIMUM-DECIMALS   04470001
044710                 SET DP010I-NEGATIVE-NOT-ALLOWED                  04471001
044720                                         TO TRUE                  04472001
044730                 CALL DP010I-NUMERIC-EDIT-ROUTINE                 04473034
044731                      USING DP010I-NUMERIC-EDIT-AREA              04473134
044740                 IF  DP010I-ERROR-DETECTED                        04474001
044750                     SET PS-ERROR                                 04475001
044760                         DP020-MSG-FATAL TO TRUE                  04476001
044770                     MOVE PC-TSYMSG-00008                         04477001
044780                                         TO DP020-MSG-NUMBER      04478001
044790                     MOVE DP015-UNP-ALP-BRT-OFF                   04479001
044800                                         TO AOPSETA               04480001
044810                     MOVE DP015-RED      TO AOPSETC               04481001
044820                     MOVE DP015-REVERSE  TO AOPSETH               04482001
044830                     MOVE -1             TO AOPSETL               04483001
044840                     SET DP030-SET-CURSOR-APPL-1                  04484001
044850                                         TO TRUE                  04485001
044860                 ELSE                                             04486001
044870                     MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-OPER-SET04487001
044880                     MOVE PV-TEMP-OPER-SET TO ASC-OPER-SET-ID-N   04488001
044890                                            DK-OPER-SET-ID        04489001
044900                     MOVE ASC-OPER-SET-ID                         04490001
044910                                         TO AOPSETO               04491001
044920                     MOVE ASC-COPER-UNT-ID-N                      04492001
044930                                         TO CURR-OPER-UNT-ID      04493001
044940                     MOVE ASC-CFCLTY-ID-N                         04494001
044950                                         TO CURR-FCLTY-ID         04495001
044960                     PERFORM 3090-VALIDATE-OPER-SET-ID            04496001
044970                     IF  SQLCODE = +100                           04497001
044980                         SET PS-ERROR                             04498001
044990                             DP020-MSG-FATAL     TO TRUE          04499001
045000                         MOVE PC-TSYMSG-00987                     04500001
045010                                             TO DP020-MSG-NUMBER  04501001
045020                         MOVE DP015-UNP-ALP-BRT-OFF               04502001
045030                                                 TO AOPSETA       04503001
045040                         MOVE DP015-RED          TO AOPSETC       04504001
045050                         MOVE DP015-REVERSE      TO AOPSETH       04505001
045060                         MOVE -1                 TO AOPSETL       04506001
045070                         SET DP030-SET-CURSOR-APPL-1              04507001
045080                                                 TO TRUE          04508001
045090                     ELSE                                         04509001
045100                         MOVE OPRSET-OPER-SET-DESC                04510001
045110                                             TO ASC-OPER-SET-DESC 04511001
045120                                                AOPDESCO          04512001
045130                     END-IF                                       04513001
045140                 END-IF                                           04514001
045150             END-IF                                               04515001
045160         END-IF                                                   04516001
045170     END-IF.                                                      04517001
045180                                                                  04518001
045190     IF ASC-VEND-SHIP-DTE > SPACES                                04519001
045200         AND PS-NO-ERROR                                          04520001
045210         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           04521001
045220         SET  DPG51-ACTUAL-CALENDAR-ONLY                          04522001
045230              DPG51-DO-NOT-INCR-DECR-DATE TO TRUE                 04523001
045240         MOVE ZEROES TO TALLY                                     04524001
045250         INSPECT ASC-VEND-SHIP-DTE                                04525001
045260                 TALLYING TALLY FOR ALL '/'                       04526001
045270         IF TALLY > 1                                             04527001
045280*            'MM/DD/YY'                                           04528001
045290             SET DPG52-LK-DTE-GREG-FMT TO TRUE                    04529001
045300         ELSE                                                     04530001
045310*            'MMDDYY  '                                           04531001
045320             SET DPG52-LK-DTE-GREG TO TRUE                        04532001
045330         END-IF                                                   04533001
045340         MOVE ASC-VEND-SHIP-DTE TO DPG52-LK-DATE-INPUT            04534001
045350         CALL DP500-KOHLS-CALENDAR-ROUTINE                        04535001
045360                          USING DPG51 DPG52 DPG53                 04536001
045370                                DPG54 DPG55 DPG56                 04537001
045380         IF (DPG54-DATE-INVALID                                   04538001
045390            OR  DPG54-SEVERE-ERROR)                               04539001
045400             SET PS-ERROR                                         04540001
045410                 DP020-MSG-FATAL   TO TRUE                        04541001
045420             MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER            04542001
045430             MOVE DP015-UNP-ALP-BRT-OFF                           04543001
045440                                    TO AVNSHDTA                   04544001
045450             MOVE DP015-RED         TO AVNSHDTC                   04545001
045460             MOVE DP015-REVERSE     TO AVNSHDTH                   04546001
045470             MOVE -1                TO AVNSHDTL                   04547001
045480             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04548001
045490         ELSE                                                     04549001
045500             MOVE DPG55-GREG-DATE-FMT  TO ASC-VEND-SHIP-DTE       04550001
045510             MOVE DPG55-DB2-ISO-DATE-FMT                          04551001
045520                                     TO ASC-VEND-SHIP-DTE-ISO     04552001
045530                                        PV-DB2-HOLD-DATE          04553001
045540             MOVE DPG55-DB2-ISO-DATE-FMT-YR                       04554001
045550                                    TO ASC-VND-SHIP-CCYY-OLD      04555001
045560             MOVE DPG55-DB2-ISO-DATE-FMT-MO                       04556001
045570                                    TO ASC-VND-SHIP-MM-OLD        04557001
045580             MOVE DPG55-DB2-ISO-DATE-FMT-DY                       04558001
045590                                    TO ASC-VND-SHIP-DD-OLD        04559001
045600         END-IF                                                   04560001
045610     END-IF.                                                      04561001
045620                                                                  04562001
045630     IF ASC-ARRIVAL-DTE = SPACES                                  04563001
045640         SET PS-ERROR                                             04564001
045650             DP020-MSG-FATAL       TO TRUE                        04565001
045660         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            04566001
045670         MOVE DP015-UNP-ALP-BRT-OFF                               04567001
045680                                   TO AARVDTA                     04568001
045690         MOVE DP015-RED            TO AARVDTC                     04569001
045700         MOVE DP015-REVERSE        TO AARVDTH                     04570001
045710         MOVE -1                   TO AARVDTL                     04571001
045720         SET DP030-SET-CURSOR-APPL-1                              04572001
045730                                   TO TRUE                        04573001
045740     ELSE                                                         04574001
045750         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           04575001
045760         SET  DPG51-ACTUAL-CALENDAR-ONLY                          04576001
045770              DPG51-DO-NOT-INCR-DECR-DATE                         04577001
045780                               TO TRUE                            04578001
045790         MOVE ZEROES           TO TALLY                           04579001
045800         INSPECT ASC-ARRIVAL-DTE                                  04580001
045810                 TALLYING TALLY FOR ALL '/'                       04581001
045820         IF  TALLY > 1                                            04582001
045830*        'MM/DD/YY'                                               04583001
045840             SET DPG52-LK-DTE-GREG-FMT                            04584001
045850                               TO TRUE                            04585001
045860         ELSE                                                     04586001
045870*        'MMDDYY  '                                               04587001
045880             SET  DPG52-LK-DTE-GREG                               04588001
045890                               TO TRUE                            04589001
045900         END-IF                                                   04590001
045910         MOVE ASC-ARRIVAL-DTE  TO DPG52-LK-DATE-INPUT             04591001
045920         CALL DP500-KOHLS-CALENDAR-ROUTINE                        04592001
045930                          USING DPG51 DPG52 DPG53                 04593001
045940                                DPG54 DPG55 DPG56                 04594001
045950         IF (DPG54-DATE-INVALID                                   04595001
045960         OR  DPG54-SEVERE-ERROR)                                  04596001
045970             SET PS-ERROR                                         04597001
045980                 DP020-MSG-FATAL       TO TRUE                    04598001
045990             MOVE PC-TSYMSG-00009      TO DP020-MSG-NUMBER        04599001
046000             MOVE DP015-UNP-ALP-BRT-OFF                           04600001
046010                                       TO AARVDTA                 04601001
046020             MOVE DP015-RED            TO AARVDTC                 04602001
046030             MOVE DP015-REVERSE        TO AARVDTH                 04603001
046040             MOVE -1                   TO AARVDTL                 04604001
046050             SET DP030-SET-CURSOR-APPL-1                          04605001
046060                                       TO TRUE                    04606001
046070         ELSE                                                     04607001
046080             MOVE DPG55-GREG-DATE-FMT  TO ASC-ARRIVAL-DTE         04608001
046090             MOVE DPG55-DB2-ISO-DATE-FMT                          04609001
046100                                       TO ASC-KEY-STATUS-DTE      04610001
046110             MOVE DPG55-DB2-ISO-DATE TO PV-ARRIVAL-DTE-YMD        04611001
046120         END-IF                                                   04612001
046130     END-IF.                                                      04613001
046140                                                                  04614001
046150************************************************                  04615001
046160****  IF USER ENTERED RECEIPT DATE IS LESS  ****                  04616001
046170****  THAN CURRENT DATE, THEN RECEIPT DATE  ****                  04617001
046180****  CANNOT BE MORE THAN 366 DAYS BEFORE   ****                  04618001
046190****  CURRENT DATE.                         ****                  04619001
046200************************************************                  04620001
046210                                                                  04621001
046220     IF  ASC-ADD-PENDING                                          04622001
046230     AND PS-NO-ERROR                                              04623001
046240     AND PV-ARRIVAL-DTE-YMD < DP017-CURRENT-DATE-YYYYMMDD         04624001
046250         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           04625001
046260         SET  DPG51-ACTUAL-CALENDAR-ONLY                          04626001
046270              DPG51-DECREMENT-DATE TO TRUE                        04627001
046280         MOVE 366                  TO DPG51-INCR-DECR-DAYS-9      04628001
046290         SET  DPG52-LK-DTE-GREG-FMT TO TRUE                       04629001
046300         MOVE DP017-EDITED-DATE-MDY TO DPG52-LK-DATE-INPUT        04630001
046310        CALL DP500-KOHLS-CALENDAR-ROUTINE                         04631001
046320                         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG5604632001
046330         IF (DPG54-DATE-INVALID                                   04633001
046340         OR  DPG54-SEVERE-ERROR)                                  04634001
046350             SET PS-ERROR                                         04635001
046360             DP020-MSG-FATAL        TO TRUE                       04636001
046370             MOVE PC-TSYMSG-00009   TO DP020-MSG-NUMBER           04637001
046380             MOVE DP015-UNP-ALP-BRT-OFF                           04638001
046390                                    TO AARVDTA                    04639001
046400             MOVE DP015-RED         TO AARVDTC                    04640001
046410             MOVE DP015-REVERSE     TO AARVDTH                    04641001
046420             MOVE -1                TO AARVDTL                    04642001
046430             SET DP030-SET-CURSOR-APPL-1                          04643001
046440                                    TO TRUE                       04644001
046450         ELSE                                                     04645001
046460             MOVE DPG55-DB2-ISO-DATE TO PV-CURR-DATE-MINUS-366    04646001
046470             IF  PV-ARRIVAL-DTE-YMD < PV-CURR-DATE-MINUS-366      04647001
046480                 SET PS-ERROR                                     04648001
046490                     DP020-MSG-FATAL  TO TRUE                     04649001
046500                 MOVE PC-TSYMSG-00009                             04650001
046510                                      TO DP020-MSG-NUMBER         04651001
046520                 MOVE DP015-UNP-ALP-BRT-OFF                       04652001
046530                                      TO AARVDTA                  04653001
046540                 MOVE DP015-RED       TO AARVDTC                  04654001
046550                 MOVE DP015-REVERSE   TO AARVDTH                  04655001
046560                 MOVE -1              TO AARVDTL                  04656001
046570                 SET DP030-SET-CURSOR-APPL-1                      04657001
046580                                      TO TRUE                     04658001
046590             END-IF                                               04659001
046600         END-IF                                                   04660001
046610     END-IF.                                                      04661001
046620                                                                  04662001
046630*************************************************                 04663001
046640**** IF USER ENTERED RECEIPT DATE IS GREATER ****                 04664001
046650**** THAN CURRENT DATE, THEN ALLOW ENTRY UP  ****                 04665001
046660**** TO 3 DAYS IN FUTURE IF RECEIPT DATE IS  ****                 04666001
046670**** A SAT OR SUN OR ENTERED AFTER 11:59 AM  ****                 04667001
046680*************************************************                 04668001
046690                                                                  04669001
046700     IF  ASC-ADD-PENDING                                          04670001
046710     AND PS-NO-ERROR                                              04671001
046720     AND PV-ARRIVAL-DTE-YMD > DP017-CURRENT-DATE-YYYYMMDD         04672001
046730         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           04673001
046740         SET  DPG51-ACTUAL-CALENDAR-ONLY                          04674001
046750              DPG51-INCREMENT-DATE  TO TRUE                       04675001
046760         MOVE 3                     TO DPG51-INCR-DECR-DAYS-9     04676001
046770         SET  DPG52-LK-DTE-GREG-FMT TO TRUE                       04677001
046780         MOVE DP017-EDITED-DATE-MDY TO DPG52-LK-DATE-INPUT        04678001
046790        CALL DP500-KOHLS-CALENDAR-ROUTINE                         04679001
046800                         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG5604680001
046810         IF (DPG54-DATE-INVALID                                   04681001
046820         OR  DPG54-SEVERE-ERROR)                                  04682001
046830             SET PS-ERROR                                         04683001
046840             DP020-MSG-FATAL        TO TRUE                       04684001
046850             MOVE PC-TSYMSG-00009   TO DP020-MSG-NUMBER           04685001
046860             MOVE DP015-UNP-ALP-BRT-OFF                           04686001
046870                                    TO AARVDTA                    04687001
046880             MOVE DP015-RED         TO AARVDTC                    04688001
046890             MOVE DP015-REVERSE     TO AARVDTH                    04689001
046900             MOVE -1                TO AARVDTL                    04690001
046910             SET DP030-SET-CURSOR-APPL-1                          04691001
046920                                    TO TRUE                       04692001
046930         ELSE                                                     04693001
046940             MOVE DPG55-DB2-ISO-DATE TO PV-CURR-DATE-PLUS-3       04694001
046950             EXEC CICS                                            04695001
046960                 ASKTIME                                          04696001
046970                    ABSTIME (DP017-CURRENT-ABSTIME)               04697001
046980             END-EXEC                                             04698001
046990             EXEC CICS                                            04699001
047000                FORMATTIME                                        04700001
047010                    ABSTIME   (DP017-CURRENT-ABSTIME)             04701001
047020                    DAYOFWEEK (PV-DAY-OF-WEEK-NMBR)               04702001
047030             END-EXEC                                             04703001
047040             IF  PV-DAY-OF-WEEK-NMBR = 0                          04704001
047050                 MOVE 'SUN'       TO PV-CURR-DAY-OF-WEEK          04705001
047060             ELSE                                                 04706001
047070                 MOVE PV-DAY-OF-THE-WEEK (PV-DAY-OF-WEEK-NMBR)    04707001
047080                                  TO PV-CURR-DAY-OF-WEEK          04708001
047090             END-IF                                               04709001
047100             IF  ((PV-CURR-DAY-OF-WEEK = 'SAT' OR 'SUN')          04710001
047110             OR   (DP017-CURRENT-TIME-HHMM > 1159))               04711001
047120             AND ((PV-ARRIVAL-DTE-YMD < PV-CURR-DATE-PLUS-3)      04712001
047130             OR   (PV-ARRIVAL-DTE-YMD = PV-CURR-DATE-PLUS-3))     04713001
047140                 CONTINUE                                         04714001
047150             ELSE                                                 04715001
047160                 SET PS-ERROR                                     04716001
047170                     DP020-MSG-FATAL  TO TRUE                     04717001
047180                 MOVE PC-TSYMSG-00009                             04718001
047190                                      TO DP020-MSG-NUMBER         04719001
047200                 MOVE DP015-UNP-ALP-BRT-OFF                       04720001
047210                                      TO AARVDTA                  04721001
047220                 MOVE DP015-RED       TO AARVDTC                  04722001
047230                 MOVE DP015-REVERSE   TO AARVDTH                  04723001
047240                 MOVE -1              TO AARVDTL                  04724001
047250                 SET DP030-SET-CURSOR-APPL-1                      04725001
047260                                      TO TRUE                     04726001
047270             END-IF                                               04727001
047280         END-IF                                                   04728001
047290     END-IF.                                                      04729001
047300                                                                  04730001
047310     IF  ASC-EXPENSE-RECEIPT                                      04731001
047320     OR  ASC-DIRECT-STORE                                         04732001
047330         CONTINUE                                                 04733001
047340     ELSE                                                         04734001
047350         IF  ASC-OWNR-SCAC-SHIP-DTE = SPACES                      04735001
047360         AND ASC-VEND-SHIP-DTE      > SPACES                      04736001
047370             MOVE ASC-VEND-SHIP-DTE                               04737001
047380                                   TO ASC-OWNR-SCAC-SHIP-DTE      04738001
047390                                      ASHPDTI                     04739001
047400                                      ASHPDTO                     04740001
047410             MOVE ASC-VEND-SHIP-DTE-ISO                           04741001
047420                                   TO ASC-OWNR-SCAC-SHIP-DTE-ISO  04742001
047430         END-IF                                                   04743001
047440     END-IF.                                                      04744001
047450                                                                  04745001
047460     IF  ASC-DIRECT-STORE                                         04746001
047470     OR  ASC-EXPENSE-RECEIPT                                      04747001
047480         CONTINUE                                                 04748001
047490     ELSE                                                         04749001
047500         IF ASC-MULT-SHIP                                         04750001
047510            CONTINUE                                              04751001
047520         ELSE                                                     04752001
047530           IF  ASC-OWNR-SCAC-SHIP-DTE = SPACES                    04753001
047540               SET PS-ERROR                                       04754001
047550                   DP020-MSG-FATAL       TO TRUE                  04755001
047560               MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER      04756001
047570               MOVE DP015-UNP-ALP-BRT-OFF                         04757001
047580                                         TO ASHPDTA               04758001
047590               MOVE DP015-RED            TO ASHPDTC               04759001
047600               MOVE DP015-REVERSE        TO ASHPDTH               04760001
047610               MOVE -1                   TO ASHPDTL               04761001
047620               SET DP030-SET-CURSOR-APPL-1                        04762001
047630                                         TO TRUE                  04763001
047640           ELSE                                                   04764001
047650               INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56     04765001
047660               SET  DPG51-ACTUAL-CALENDAR-ONLY                    04766001
047670                    DPG51-DO-NOT-INCR-DECR-DATE                   04767001
047680                                         TO TRUE                  04768001
047690               MOVE ZEROES               TO TALLY                 04769001
047700               INSPECT ASC-OWNR-SCAC-SHIP-DTE                     04770001
047710                       TALLYING TALLY FOR ALL '/'                 04771001
047720               IF  TALLY > 1                                      04772001
047730*                  'MM/DD/YY'                                     04773001
047740                   SET DPG52-LK-DTE-GREG-FMT                      04774001
047750                                         TO TRUE                  04775001
047760               ELSE                                               04776001
047770*                  'MMDDYY  '                                     04777001
047780                   SET  DPG52-LK-DTE-GREG                         04778001
047790                                         TO TRUE                  04779001
047800               END-IF                                             04780001
047810               MOVE ASC-OWNR-SCAC-SHIP-DTE                        04781001
047820                                         TO DPG52-LK-DATE-INPUT   04782001
047830               CALL DP500-KOHLS-CALENDAR-ROUTINE                  04783001
047840                                USING DPG51 DPG52 DPG53           04784001
047850                                      DPG54 DPG55 DPG56           04785001
047860               IF (DPG54-DATE-INVALID                             04786001
047870               OR  DPG54-SEVERE-ERROR)                            04787001
047880                   SET PS-ERROR                                   04788001
047890                       DP020-MSG-FATAL       TO TRUE              04789001
047900                   MOVE PC-TSYMSG-00009      TO DP020-MSG-NUMBER  04790001
047910                   MOVE DP015-UNP-ALP-BRT-OFF                     04791001
047920                                             TO ASHPDTA           04792001
047930                   MOVE DP015-RED            TO ASHPDTC           04793001
047940                   MOVE DP015-REVERSE        TO ASHPDTH           04794001
047950                   MOVE -1                   TO ASHPDTL           04795001
047960                   SET DP030-SET-CURSOR-APPL-1                    04796001
047970                                             TO TRUE              04797001
047980               ELSE                                               04798001
047990                   MOVE DPG55-GREG-DATE-FMT                       04799001
048000                                      TO ASC-OWNR-SCAC-SHIP-DTE   04800001
048010                   MOVE DPG55-DB2-ISO-DATE-FMT                    04801001
048020                                 TO ASC-OWNR-SCAC-SHIP-DTE-ISO    04802001
048030                   MOVE DPG55-DB2-ISO-DATE                        04803001
048040                           TO PV-OWNR-SCAC-SHIP-DTE-YMD           04804001
048050                   IF  PV-OWNR-SCAC-SHIP-DTE-YMD >                04805001
048060                                            PV-ARRIVAL-DTE-YMD    04806001
048070                       SET PS-ERROR                               04807001
048080                           DP020-MSG-FATAL TO TRUE                04808001
048090                       MOVE PC-TSYMSG-00009 TO DP020-MSG-NUMBER   04809001
048100                       MOVE DP015-UNP-ALP-BRT-OFF TO ASHPDTA      04810001
048110                       MOVE DP015-RED     TO ASHPDTC              04811001
048120                       MOVE DP015-REVERSE TO ASHPDTH              04812001
048130                       MOVE -1        TO ASHPDTL                  04813001
048140                       SET DP030-SET-CURSOR-APPL-1 TO TRUE        04814001
048150                   END-IF                                         04815001
048160               END-IF                                             04816001
048170           END-IF                                                 04817001
048180        END-IF                                                    04818001
048190     END-IF.                                                      04819001
048200                                                                  04820001
048210     IF  ASC-EXPENSE-RECEIPT                                      04821001
048220     OR  ASC-DIRECT-STORE                                         04822001
048230         CONTINUE                                                 04823001
048240     ELSE                                                         04824001
048250         IF  ASC-VEND-SHIP-DTE      = SPACES                      04825001
048260         AND ASC-OWNR-SCAC-SHIP-DTE > SPACES                      04826001
048270         AND PS-NO-ERROR                                          04827001
048280             MOVE ASC-OWNR-SCAC-SHIP-DTE                          04828001
048290                                   TO ASC-VEND-SHIP-DTE           04829001
048300                                      AVNSHDTI                    04830001
048310                                      AVNSHDTO                    04831001
048320             MOVE ASC-OWNR-SCAC-SHIP-DTE-ISO                      04832001
048330                                   TO ASC-VEND-SHIP-DTE-ISO       04833001
048340         END-IF                                                   04834001
048350     END-IF.                                                      04835001
048360                                                                  04836001
048370     IF  ASC-EXPENSE-RECEIPT                                      04837001
048380     OR  ASC-DIRECT-STORE                                         04838001
048390         CONTINUE                                                 04839001
048400     ELSE                                                         04840001
048410         IF  ASC-ADD-PENDING                                      04841001
048420             IF  ASC-PRO-NBR = SPACES                             04842001
048430                 SET PS-ERROR                                     04843001
048440                     DP020-MSG-FATAL   TO TRUE                    04844001
048450                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        04845001
048460                 MOVE DP015-UNP-ALP-BRT-OFF                       04846001
048470                                       TO APROA                   04847001
048480                 MOVE DP015-RED        TO APROC                   04848001
048490                 MOVE DP015-REVERSE    TO APROH                   04849001
048500                 MOVE -1               TO APROL                   04850001
048510                 SET DP030-SET-CURSOR-APPL-1                      04851001
048520                                       TO TRUE                    04852001
048530             END-IF                                               04853001
048540         END-IF                                                   04854001
048550     END-IF.                                                      04855001
048560                                                                  04856001
048570     IF  ASC-EXPENSE-RECEIPT                                      04857001
048580     OR  ASC-DIRECT-STORE                                         04858001
048590         CONTINUE                                                 04859001
048600     ELSE                                                         04860001
048610         IF ASC-MULT-SHIP                                         04861001
048620            CONTINUE                                              04862001
048630         ELSE                                                     04863001
048640            IF  (ASC-PRO-NBR > SPACES                             04864001
048650            OR   ASC-BOL-NBR > SPACES)                            04865001
048660            AND (ASC-OWNR-SCAC-SHIP-DTE = SPACES                  04866001
048670            AND  ASC-VEND-SHIP-DTE      = SPACES)                 04867001
048680                SET PS-ERROR                                      04868001
048690                    DP020-MSG-FATAL       TO TRUE                 04869001
048700                MOVE PC-TSYMSG-00308      TO DP020-MSG-NUMBER     04870001
048710                MOVE DP015-UNP-ALP-BRT-OFF                        04871001
048720                                          TO ASHPDTA              04872001
048730                                             AVNSHDTA             04873001
048740                MOVE DP015-RED            TO ASHPDTC              04874001
048750                                             AVNSHDTC             04875001
048760                MOVE DP015-REVERSE        TO ASHPDTH              04876001
048770                                             AVNSHDTH             04877001
048780                MOVE -1                   TO ASHPDTL              04878001
048790                SET DP030-SET-CURSOR-APPL-1                       04879001
048800                                          TO TRUE                 04880001
048810            END-IF                                                04881001
048820         END-IF                                                   04882001
048830     END-IF.                                                      04883001
048840                                                                  04884001
048850     IF  ASC-EXPENSE-RECEIPT                                      04885001
048860     OR  ASC-DIRECT-STORE                                         04886001
048870         CONTINUE                                                 04887001
048880     ELSE                                                         04888001
048890         IF  ASC-ADD-PENDING                                      04889001
048900             IF  ASC-VEH-NBR = SPACES                             04890001
048910                 SET PS-ERROR                                     04891001
048920                     DP020-MSG-FATAL   TO TRUE                    04892001
048930                 MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER        04893001
048940                 MOVE DP015-UNP-ALP-BRT-OFF                       04894001
048950                                       TO ATRLRA                  04895001
048960                 MOVE DP015-RED        TO ATRLRC                  04896001
048970                 MOVE DP015-REVERSE    TO ATRLRH                  04897001
048980                 MOVE -1               TO ATRLRL                  04898001
048990                 SET DP030-SET-CURSOR-APPL-1                      04899001
049000                                       TO TRUE                    04900001
049010             END-IF                                               04901001
049020         END-IF                                                   04902001
049030     END-IF.                                                      04903001
049040                                                                  04904001
049050     IF  ASC-EXPENSE-RECEIPT                                      04905001
049060     OR  ASC-DIRECT-STORE                                         04906001
049070         CONTINUE                                                 04907001
049080     ELSE                                                         04908001
049090         IF  ASC-ADD-PENDING                                      04909001
049100             IF  ASC-OWNER-SCAC-ID = SPACES                       04910001
049110                 SET PS-ERROR                                     04911001
049120                     DP020-MSG-FATAL        TO TRUE               04912001
049130                 MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER   04913001
049140                 MOVE DP015-UNP-ALP-BRT-OFF TO ASCACA             04914001
049150                 MOVE DP015-RED             TO ASCACC             04915001
049160                 MOVE DP015-REVERSE         TO ASCACH             04916001
049170                 MOVE -1                    TO ASCACL             04917001
049180                 SET DP030-SET-CURSOR-APPL-1                      04918001
049190                                            TO TRUE               04919001
049200             ELSE                                                 04920001
049210                 MOVE ASC-OWNER-SCAC-ID    TO DK-OWNER-SCAC-ID    04921001
049220                 PERFORM 3040-VALIDATE-SCAC-CDE                   04922001
049230                 IF  SQLCODE = +100                               04923001
049240                     SET PS-ERROR                                 04924001
049250                         DP020-MSG-FATAL   TO TRUE                04925001
049260                     MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER    04926001
049270                     MOVE DP015-UNP-ALP-BRT-OFF                   04927001
049280                                           TO ASCACA              04928001
049290                     MOVE DP015-RED        TO ASCACC              04929001
049300                     MOVE DP015-REVERSE    TO ASCACH              04930001
049310                     MOVE -1               TO ASCACL              04931001
049320                     SET DP030-SET-CURSOR-APPL-1                  04932001
049330                                           TO TRUE                04933001
049340                 END-IF                                           04934001
049350             END-IF                                               04935001
049360         END-IF                                                   04936001
049370     END-IF.                                                      04937001
049380                                                                  04938001
049390     IF  PS-NO-ERROR                                              04939001
049400     AND ASC-ADD-FROM-MENU                                        04940001
049410     AND ASC-DIRECT-STORE                                         04941001
049420         IF  ASC-AP-RCVR-NBR > (SPACES OR ZEROES)                 04942001
049430             MOVE ASC-AP-RCVR-NBR       TO DP010I-UNEDITED-FIELD  04943001
049440             MOVE LENGTH OF ASC-AP-RCVR-NBR                       04944001
049450                                        TO DP010I-MAXIMUM-DIGITS  04945001
049460             MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS04946001
049470             SET  DP010I-NEGATIVE-NOT-ALLOWED                     04947001
049480                                        TO TRUE                   04948001
049490             CALL DP010I-NUMERIC-EDIT-ROUTINE                     04949034
049491                  USING DP010I-NUMERIC-EDIT-AREA                  04949134
049500             IF  DP010I-ERROR-DETECTED                            04950001
049510                 SET PS-ERROR                                     04951001
049520                     DP020-MSG-FATAL    TO TRUE                   04952001
049530                 MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       04953001
049540                 MOVE DP015-UNP-ALP-BRT-MDT                       04954001
049550                                        TO AAPRCVRA               04955001
049560                 MOVE DP015-RED         TO AAPRCVRC               04956001
049570                 MOVE DP015-REVERSE     TO AAPRCVRH               04957001
049580                 MOVE -1                TO AAPRCVRL               04958001
049590                 SET DP030-SET-CURSOR-APPL-1                      04959001
049600                                        TO TRUE                   04960001
049610             ELSE                                                 04961001
049620                 MOVE DP010I-NUMERIC-FIELD                        04962001
049630                                          TO ASC-AP-RCVR-NBR-N    04963001
049640                 MOVE ASC-AP-RCVR-NBR-N   TO AAPRCVRO             04964001
049650                                             DK-RCVR-NBR          04965001
049660                                             WS-KEYREC-WORK       04966001
049670                 DIVIDE 9 INTO WS-FIRST-7-DIG GIVING              04967001
049680                               WS-KEYREC-QUOTIENT REMAINDER       04968001
049690                               WS-KEYREC-REMAINDER                04969001
049700                 COMPUTE WS-KEYREC-SUM = WS-KEYREC-REMAINDER      04970001
049710                                       + WS-CHECK-DIGIT           04971001
049720                 IF  WS-KEYREC-SUM NOT = 9                        04972001
049730                     SET PS-ERROR                                 04973001
049740                         DP020-MSG-FATAL  TO TRUE                 04974001
049750                     MOVE PC-TSYMSG-00316 TO DP020-MSG-NUMBER     04975001
049760                     MOVE DP015-UNP-ALP-BRT-OFF                   04976001
049770                                          TO AAPRCVRA             04977001
049780                     MOVE DP015-RED       TO AAPRCVRC             04978001
049790                     MOVE DP015-REVERSE   TO AAPRCVRH             04979001
049800                     MOVE -1              TO AAPRCVRL             04980001
049810                     SET DP030-SET-CURSOR-APPL-1                  04981001
049820                                          TO TRUE                 04982001
049830                 END-IF                                           04983001
049840                 IF  PS-NO-ERROR                                  04984001
049850                     INITIALIZE PV-DB2-COUNT                      04985001
049860                     PERFORM 3150-CHECK-DUPL-RCVR-NBR             04986001
049870                     IF  PV-DB2-COUNT > +0                        04987001
049880                         SET PS-ERROR                             04988001
049890                             DP020-MSG-FATAL  TO TRUE             04989001
049900                         MOVE PC-TSYMSG-00117 TO DP020-MSG-NUMBER 04990001
049910                         MOVE DP015-UNP-ALP-BRT-OFF               04991001
049920                                              TO AAPRCVRA         04992001
049930                         MOVE DP015-RED       TO AAPRCVRC         04993001
049940                         MOVE DP015-REVERSE   TO AAPRCVRH         04994001
049950                         MOVE -1              TO AAPRCVRL         04995001
049960                         SET DP030-SET-CURSOR-APPL-1              04996001
049970                                              TO TRUE             04997001
049980                     END-IF                                       04998001
049990                 END-IF                                           04999001
050000             END-IF                                               05000001
050010         END-IF                                                   05001001
050020     END-IF.                                                      05002001
050030     IF  PS-NO-ERROR                                              05003001
050040     AND ASC-ADD-PENDING                                          05004001
050050         IF  ASC-PO-NBR = (SPACES OR ZEROES)                      05005001
050060             SET PS-ERROR                                         05006001
050070                 DP020-MSG-FATAL        TO TRUE                   05007001
050080             MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER       05008001
050090             MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                05009001
050100             MOVE DP015-RED             TO APONBRC                05010001
050110             MOVE DP015-REVERSE         TO APONBRH                05011001
050120             MOVE -1                    TO APONBRL                05012001
050130             SET DP030-SET-CURSOR-APPL-1                          05013001
050140                                        TO TRUE                   05014001
050150         ELSE                                                     05015001
050160             MOVE ASC-PO-NBR            TO DP010I-UNEDITED-FIELD  05016001
050170             MOVE LENGTH OF ASC-PO-NBR  TO DP010I-MAXIMUM-DIGITS  05017001
050180             MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS05018001
050190             SET  DP010I-NEGATIVE-NOT-ALLOWED                     05019001
050200                                        TO TRUE                   05020001
050210             CALL DP010I-NUMERIC-EDIT-ROUTINE                     05021034
050211                  USING DP010I-NUMERIC-EDIT-AREA                  05021134
050220             IF  DP010I-ERROR-DETECTED                            05022001
050230                 SET PS-ERROR                                     05023001
050240                     DP020-MSG-FATAL    TO TRUE                   05024001
050250                 MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       05025001
050260                 MOVE DP015-UNP-ALP-BRT-OFF                       05026001
050270                                        TO APONBRA                05027001
050280                 MOVE DP015-RED         TO APONBRC                05028001
050290                 MOVE DP015-REVERSE     TO APONBRH                05029001
050300                 MOVE -1                TO APONBRL                05030001
050310                 SET DP030-SET-CURSOR-APPL-1                      05031001
050320                                        TO TRUE                   05032001
050330             ELSE                                                 05033001
050340                 MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-PO-NBR      05034001
050350                 MOVE PV-TEMP-PO-NBR      TO ASC-PO-NBR-N         05035001
050360                                             ASC-KEY-PO-NBR       05036001
050370                                                DK-PO-NBR         05037001
050380                 MOVE ASC-PO-NBR-N        TO APONBRO              05038001
050390                 MOVE ASC-VEH-NBR         TO DK-VEH-NBR           05039001
050400                 MOVE ASC-OWNER-SCAC-ID   TO DK-OWNER-SCAC-ID     05040001
050410                 MOVE ASC-KEY-STATUS-DTE  TO DK-STATUS-DTE        05041001
050420                 MOVE ASC-PRO-NBR         TO DK-PRO-NBR           05042001
050430                 MOVE ASC-BOL-NBR         TO DK-BOL-NBR           05043001
050440                 IF  ASC-EXPENSE-RECEIPT                          05044001
050450                 OR  ASC-DIRECT-STORE                             05045001
050460                     CONTINUE                                     05046001
050470                 ELSE                                             05047001
050480                     PERFORM 3050-CHECK-FOR-TRIPS                 05048001
050490                     IF  SQLCODE = +100                           05049001
050500                         SET ASC-TRIP-DOESNT-EXIST                05050001
050510                             PS-ERROR                             05051001
050520                             DP020-MSG-FATAL   TO TRUE            05052001
050530                         MOVE PC-TSYMSG-00743  TO DP020-MSG-NUMBER05053001
050540                         MOVE DP015-UNP-ALP-BRT-OFF               05054001
050550                                               TO ASCACA          05055001
050560                                                  ATRLRA          05056001
050570                                                  AARVDTA         05057001
050580                         MOVE DP015-RED        TO ASCACC          05058001
050590                                                  ATRLRC          05059001
050600                                                  AARVDTC         05060001
050610                         MOVE DP015-REVERSE    TO ASCACH          05061001
050620                                                  ATRLRH          05062001
050630                                                  AARVDTH         05063001
050640                         MOVE -1               TO ASCACL          05064001
050650                     ELSE                                         05065001
050660                         SET ASC-TRIP-EXISTS   TO TRUE            05066001
050670                         MOVE VHTRIP-TRIP-ID   TO ASC-TRIP-ID     05067001
050680                                                  DK-TRIP-ID      05068001
050690                         MOVE TRIPST-TRIP-STATUS-CDE              05069001
050700                                           TO ASC-TRIP-STATUS-CDE 05070001
050710                     END-IF                                       05071001
050720                 END-IF                                           05072001
050730                 IF  ASC-EXPENSE-RECEIPT                          05073001
050740                 OR  ASC-DIRECT-STORE                             05074001
050750                     CONTINUE                                     05075001
050760                 ELSE                                             05076001
050770                 IF  PS-NO-ERROR                                  05077001
050780                     MOVE ASC-OWNER-SCAC-ID TO DK-OWNER-SCAC-ID   05078001
050790                     MOVE ASC-PRO-NBR       TO RC023-FREIGHT-BILL 05079001
050800                                               ASC-COMP-PRO-NBR   05080001
050810                     MOVE ASC-BOL-NBR     TO RC023-BILL-OF-LADING 05081001
050820                                             ASC-COMP-BOL-NBR     05082001
050830                     CALL RC023-FB-BOL-VEH-FORMAT                 05083022
050840                                 USING RC023-FORMAT-DATA-AREA     05084001
050850                     MOVE RC023-FREIGHT-BILL                      05085001
050860                                            TO DK-PRO-NBR         05086001
050870                                               ASC-PRO-NBR        05087001
050880                     MOVE RC023-BILL-OF-LADING                    05088001
050890                                            TO DK-BOL-NBR         05089001
050900                                               ASC-BOL-NBR        05090001
050910                     IF  ASC-PRO-NBR > SPACES                     05091001
050920                         MOVE DK-PRO-NBR   TO DK-PRO-NBR-B        05092001
050930                                              DK-PRO-NBR-E        05093001
050940                     ELSE                                         05094001
050950                         MOVE SPACES       TO DK-PRO-NBR-B        05095001
050960                         MOVE '9999999999999999'                  05096001
050970                                           TO DK-PRO-NBR-E        05097001
050980                     END-IF                                       05098001
050990                     IF  ASC-BOL-NBR > SPACES                     05099001
051000                         MOVE DK-BOL-NBR   TO DK-BOL-NBR-B        05100001
051010                                              DK-BOL-NBR-E        05101001
051020                     ELSE                                         05102001
051030                         MOVE SPACES       TO DK-BOL-NBR-B        05103001
051040                         MOVE '9999999999999999'                  05104001
051050                                           TO DK-BOL-NBR-E        05105001
051060                     END-IF                                       05106001
051070                     PERFORM 3060-CHECK-FOR-SHIPMENTS             05107001
051080                     IF  SQLCODE = +100                           05108001
051090                         SET ASC-SHIPMENT-DOESNT-EXIST            05109001
051100                                           TO TRUE                05110001
051110                         MOVE ZEROES       TO ASC-SHIPT-ID        05111001
051120                                              DK-SHIPT-ID         05112001
051130                     ELSE                                         05113001
051140                         IF PS-NO-ERROR                           05114001
051150                            IF ASC-TRIP-ID = SHIPMT-TRIP-ID OR    05115001
051160                               DN-VEH-NBR = -1                    05116001
051170                               SET ASC-SHIPMENT-EXISTS            05117001
051180                                                 TO TRUE          05118001
051190                               MOVE SHIPMT-SHIPT-ID               05119001
051200                                                 TO ASC-SHIPT-ID  05120001
051210                                                    DK-SHIPT-ID   05121001
051220                            ELSE                                  05122001
051230                               MOVE ZEROES       TO ASC-SHIPT-ID  05123001
051240                                                    DK-SHIPT-ID   05124001
051250                               MOVE VHTRIP-VEH-NBR                05125001
051260                                          TO PV-DISPLAY-VEH-NBR   05126001
051270                               MOVE VHTRIP-OWNER-SCAC-ID          05127001
051280                                          TO PV-DISPLAY-SCAC-ID   05128001
051290                               MOVE PV-DISPLAY-VEHICLE            05129001
051300                                               TO DP020-MSG-TEXT  05130001
051310                               SET ASC-SHIPMENT-DOESNT-EXIST      05131001
051320                                   PS-ERROR                       05132001
051330                                   DP020-MSG-FATAL   TO TRUE      05133001
051340                               MOVE PC-TSYMSG-01067               05134001
051350                                           TO DP020-MSG-NUMBER    05135001
051360* WR40574 02-15-2012 ADDED ACAN BELOW                             05136001
051370                               MOVE DP015-UNP-ALP-BRT-OFF         05137001
051380                                                     TO ASCACA    05138001
051390                                                        APROA     05139001
051400                                                        ABOLA     05140001
051410                                                        ACANA     05141001
051420                               MOVE DP015-RED        TO ASCACC    05142001
051430                                                        APROC     05143001
051440                                                        ABOLC     05144001
051450                                                        ACANC     05145001
051460                               MOVE DP015-REVERSE    TO ASCACH    05146001
051470                                                        APROH     05147001
051480                                                        ABOLH     05148001
051490                                                        ACANH     05149001
051500                               MOVE -1               TO ASCACL    05150001
051510                            END-IF                                05151001
051520                         END-IF                                   05152001
051530                     END-IF                                       05153001
051540                     IF PS-NO-ERROR                               05154001
051550                        INITIALIZE PV-DB2-COUNT                   05155001
051560                        PERFORM 3070-CHECK-FOR-PO                 05156001
051570                        IF  PV-DB2-COUNT = +0                     05157001
051580                            SET ASC-PO-DOESNT-EXIST               05158001
051590                                              TO TRUE             05159001
051600                        ELSE                                      05160001
051610                            SET ASC-PO-EXISTS TO TRUE             05161001
051620                            PERFORM 4040-GET-ENT-NAME-DESC        05162001
051630                            MOVE ASC-ENT-NAME-DESC                05163001
051640                                              TO AENTNMEO         05164001
051650                            PERFORM 4045-GET-FRCST-IND            05165001
051660                        END-IF                                    05166001
051670                     END-IF                                       05167001
051680                 END-IF                                           05168001
051690                 END-IF                                           05169001
051700                 MOVE ASC-PO-NBR-N      TO ASC-KEY-PO-NBR         05170001
051710                 MOVE ASC-VEH-NBR       TO ASC-KEY-VEH-NBR        05171001
051720                 MOVE ASC-OWNER-SCAC-ID TO ASC-KEY-OWNER-SCAC-ID  05172001
051730                 MOVE ASC-PRO-NBR       TO ASC-KEY-PRO-NBR        05173001
051740                 MOVE ASC-BOL-NBR       TO ASC-KEY-BOL-NBR        05174001
051750                 MOVE ASC-SHIPT-ID      TO ASC-KEY-SHIPT-ID       05175001
051760                 MOVE ASC-TRIP-ID       TO ASC-KEY-TRIP-ID        05176001
051770                 MOVE ASC-OPER-UNT-ID-N TO DK-OPER-UNT-ID         05177001
051780                 MOVE ASC-FCLTY-ID-N    TO DK-FCLTY-ID            05178001
051790                 IF  ASC-EXPENSE-RECEIPT                          05179001
051800                     MOVE ZEROES        TO ASC-OPER-SET-ID-N      05180001
051810                                           AOPSETO                05181001
051820                     MOVE 'EXPENSE RECEIPT'                       05182001
051830                                        TO ASC-OPER-SET-DESC      05183001
051840                                           AOPDESCO               05184001
051850                 ELSE                                             05185001
051860                     IF  ASC-DIRECT-STORE                         05186001
051870                         MOVE ZEROES    TO ASC-OPER-SET-ID-N      05187001
051880                                           AOPSETO                05188001
051890                         MOVE 'DIRECT STORE SHIPMENT'             05189001
051900                                        TO ASC-OPER-SET-DESC      05190001
051910                                           AOPDESCO               05191001
051920                     END-IF                                       05192001
051930                 END-IF                                           05193001
051940             END-IF                                               05194001
051950         END-IF                                                   05195001
051960     END-IF.                                                      05196001
051970                                                                  05197001
051980     IF  PS-NO-ERROR                                              05198001
051990         EVALUATE TRUE                                            05199001
052000             WHEN ASC-ADD-PENDING                                 05200001
052010                 IF (ASC-ADD-FROM-SHPPO                           05201001
052020                 AND ASC-SELECTION-MADE)                          05202001
052030                 OR  ASC-ADD-MULTIPLE                             05203001
052040                     MOVE -1       TO ASHPDTL                     05204001
052050                 ELSE                                             05205001
052060                     MOVE -1       TO APONBRL                     05206001
052070                 END-IF                                           05207001
052080                 SET DP030-SET-CURSOR-APPL-1                      05208001
052090                                   TO TRUE                        05209001
052100             WHEN ASC-UPDATE-PENDING                              05210001
052110                 IF  ASC-MULT-SHIP                                05211001
052120                     MOVE -1       TO AOPSETL                     05212001
052130                 ELSE                                             05213001
052140                     MOVE -1       TO ASHPDTL                     05214001
052150                 END-IF                                           05215001
052160                 SET DP030-SET-CURSOR-APPL-1                      05216001
052170                                   TO TRUE                        05217001
052180         END-EVALUATE                                             05218001
052190     END-IF.                                                      05219001
052200/                                                                 05220001
052210*----------------------------------------------------------------*05221001
052220*  CHECK THE VENDOR DATE TO  VERIFY THAT IT IS WITHIN THE        *05222001
052230*  PERMITTED DATE RANGE                                          *05223001
052240*----------------------------------------------------------------*05224001
052250 3005-CHK-VND-DATE-RANGE.                                         05225001
052260     EXEC SQL                                                     05226001
052270         SET :PV-DB2-CURRENT-DATE = CURRENT_DATE                  05227001
052280     END-EXEC.                                                    05228001
052290                                                                  05229001
052300****** GET CURRENT DATE MINUS PC-VALID-VND-DT-RANGE               05230001
052310     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05231001
052320     SET DPG51-ACTUAL-CALENDAR-ONLY                               05232001
052330         DPG51-DECREMENT-DATE                                     05233001
052340         DPG52-LK-DTE-ISO-FMT      TO TRUE.                       05234001
052350                                                                  05235001
052360     MOVE PC-VALID-VND-DT-RANGE TO DPG51-INCR-DECR-DAYS-9.        05236001
052370     MOVE PV-DB2-CURRENT-DATE TO DPG52-LK-DATE-INPUT.             05237001
052380                                                                  05238001
052390     CALL DP500-KOHLS-CALENDAR-ROUTINE                            05239001
052400             USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.           05240001
052410                                                                  05241001
052420     IF DPG54-INCR-DECR-VALID                                     05242001
052430         MOVE DPG55-DB2-ISO-DATE-FMT TO PV-DB2-CURRENT-DATE-M7DD  05243001
052440         MOVE PV-DB2-HOLD-DATE       TO PV-VEND-SHIP-DATE         05244001
052450***** CHECK IF VEND SHIP DATE WITHIN THE RANGE                    05245001
052460         IF PV-VEND-SHIP-DATE GREATER THAN PV-DB2-CURRENT-DATE OR 05246001
052470            PV-VEND-SHIP-DATE LESS THAN PV-DB2-CURRENT-DATE-M7DD  05247001
052480             SET PS-INVALID-VND-DT-RANGE TO TRUE                  05248001
052490         ELSE                                                     05249001
052500             SET PS-VALID-VND-DT-RANGE TO TRUE                    05250001
052510         END-IF                                                   05251001
052520     ELSE                                                         05252001
052530         SET PS-INVALID-VND-DT-RANGE TO TRUE                      05253001
052540     END-IF.                                                      05254001
052550                                                                  05255001
052560     IF PS-VALID-VND-DT-RANGE                                     05256001
052570         IF (DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)               05257001
052580           OR DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID))             05258001
052590             SET ASC-VND-DT-F2-NOT-REQUIRED TO TRUE               05259001
052600         ELSE                                                     05260001
052610             CONTINUE                                             05261001
052620         END-IF                                                   05262001
052630     ELSE                                                         05263001
052640         SET ASC-VND-DT-F2-REQUIRED                               05264001
052650             PS-ERROR                                             05265001
052660             DP020-MSG-WARNING TO TRUE                            05266001
052670         MOVE DP015-YELLOW     TO AVNSHDTC                        05267001
052680         MOVE DP015-REVERSE    TO AVNSHDTH                        05268001
052690         MOVE -1               TO AVNSHDTL                        05269001
052700         MOVE PC-TSYMSG-01838 TO DP020-MSG-NUMBER                 05270001
052710         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      05271001
052720     END-IF.                                                      05272001
052730                                                                  05273001
052740                                                                  05274001
052750*----------------------------------------------------------------*05275001
052760*  CHECK THE OPER UNIT TABLE TO VERIFY THE OPER UNIT             *05276001
052770*  ENTERED ON THE MAP IS VALID.                                  *05277001
052780*----------------------------------------------------------------*05278001
052790                                                                  05279001
052800 3010-VALIDATE-OPER-UNT-ID.                                       05280001
052810                                                                  05281001
052820     INITIALIZE XL071-COMMAREA-REC.                               05282001
052830     MOVE CURR-OPER-UNT-ID           TO XL071-LOCATION-NUMBER.    05283001
052840                                                                  05284001
052850     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  05285001
052860                                        XL071-COMMAREA            05286001
052870                                        XL071-COMMAREA-REC.       05287001
052880                                                                  05288001
052890* * THERE IS LEGITIMATELY NO ROW ON XLT_DC_LOC_ASGMT              05289001
052900* * FOR CORPORATE                                                 05290001
052910     IF XL071-LOCATION-NUMBER = PC-CORPORATE                      05291001
052920       AND XL071-DC-ASGMT-NOT-FND                                 05292001
052930         SET XL071-NO-ERRORS          TO TRUE                     05293001
052940     END-IF.                                                      05294001
052950                                                                  05295001
052960     EVALUATE TRUE                                                05296001
052970         WHEN XL071-NO-ERRORS                                     05297001
052980              CONTINUE                                            05298001
052990         WHEN XL071-LOC-NOT-FOUND                                 05299001
053000                 MOVE 'STORE NAME NOT FOUND' TO                   05300001
053010                                  XL071-LOC-NM                    05301001
053020         WHEN OTHER                                               05302001
053030              INITIALIZE PV-CICS-MSG-AREA                         05303001
053040              MOVE XL071-SQLCODE-N   TO PV-DISPLAY-SQLCODE2       05304017
053050              STRING ' RCKCS221 - 3010- CALL XLKUT071 -'          05305001
053060                     ' SQLCODE='  PV-DISPLAY-SQLCODE2             05306017
053070                     ' PO-NBR='   ASC-PO-NBR-N                    05307017
053080                                              DELIMITED BY SIZE   05308001
053090                                         INTO PV-CICS-MSG-AREA    05309001
053100              PERFORM 9900-WRITE-CICS-LOG                         05310001
053110                                                                  05311001
053120              STRING ' SQLCODE= '                                 05312017
053130                       PV-DISPLAY-SQLCODE2                        05313016
053140                     '  PO-NUMBER= '                              05314016
053150                       ASC-PO-NBR-N  DELIMITED BY SIZE            05315016
053160                                     INTO DP013-MESSAGE-TEXT (1)  05316013
053170              MOVE '3010-VALIDATE-OPER-UNT-ID'                    05317011
053180                                     TO PV-DISPLAY-PARAGRAPH      05318011
053190              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              05319001
053200              PERFORM 9900A-SOFT-ABORT                            05320001
053210     END-EVALUATE.                                                05321001
053220                                                                  05322001
053230     IF XL071-LOC-TYP-CDE = 'DC' OR 'HQ' OR 'DS'                  05323001
053240        SET PS-VALID-LOC            TO TRUE                       05324001
053250     ELSE                                                         05325001
053260        SET PS-INVALID-LOC          TO TRUE                       05326001
053270     END-IF.                                                      05327001
053280                                                                  05328001
053290******************************************************************05329001
053300 3012-VALIDATE-OPER-UNT-ID.                                       05330001
053310                                                                  05331001
053320                                                                  05332001
053330     INITIALIZE XL071-COMMAREA-REC.                               05333001
053340     MOVE DK-OPER-UNT-ID             TO XL071-LOCATION-NUMBER.    05334001
053350                                                                  05335001
053360     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  05336001
053370                                        XL071-COMMAREA            05337001
053380                                        XL071-COMMAREA-REC.       05338001
053390                                                                  05339001
053400     EVALUATE TRUE                                                05340001
053410         WHEN XL071-NO-ERRORS                                     05341001
053420         WHEN XL071-DC-ASGMT-NOT-FND                              05342018
053430              CONTINUE                                            05343001
053440         WHEN XL071-LOC-NOT-FOUND                                 05344001
053450                 MOVE 'STORE NAME NOT FOUND' TO                   05345001
053460                                  XL071-LOC-NM                    05346001
053470         WHEN OTHER                                               05347008
053480              INITIALIZE PV-CICS-MSG-AREA                         05348001
053490              MOVE XL071-SQLCODE-N   TO PV-DISPLAY-SQLCODE2       05349017
053500              STRING ' RCKCS221 - 3012- CALL XLKUT071 -'          05350001
053510                     ' SQLCODE='  PV-DISPLAY-SQLCODE2             05351017
053520                     ' PO-NBR='   ASC-PO-NBR-N                    05352017
053530                                              DELIMITED BY SIZE   05353001
053540                                         INTO PV-CICS-MSG-AREA    05354001
053550              PERFORM 9900-WRITE-CICS-LOG                         05355001
053560                                                                  05356001
053570              STRING ' SQLCODE= '                                 05357017
053580                       PV-DISPLAY-SQLCODE2                        05358016
053590                     '  PO-NUMBER= '                              05359016
053600                       ASC-PO-NBR-N  DELIMITED BY SIZE            05360016
053610                                     INTO DP013-MESSAGE-TEXT (1)  05361016
053620              MOVE '3012-VALIDATE-OPER-UNT-ID'                    05362011
053630                                     TO PV-DISPLAY-PARAGRAPH      05363011
053640              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              05364001
053650              PERFORM 9900A-SOFT-ABORT                            05365001
053660     END-EVALUATE.                                                05366001
053670                                                                  05367001
053680     IF XL071-LOC-TYP-CDE = 'DC' OR 'DS'                          05368001
053690        SET PS-VALID-LOC            TO TRUE                       05369001
053700     ELSE                                                         05370001
053710        SET PS-INVALID-LOC          TO TRUE                       05371001
053720     END-IF.                                                      05372001
053730                                                                  05373001
053740                                                                  05374001
053750                                                                  05375001
053760** AHP - BEGIN - 04/07/08                                         05376001
053770******************************************************************05377001
053780 3015-CHECK-FOR-REPURP.                                           05378001
053790                                                                  05379001
053800     MOVE ASC-OPER-UNT-ID-N    TO PV-OPER-UNT-ID.                 05380001
053810     MOVE ASC-COPER-UNT-ID-N   TO PV-CURR-OPER-UNT-ID.            05381001
053820                                                                  05382001
053830     PERFORM                                                      05383001
053840         WITH TEST AFTER                                          05384001
053850         VARYING PV-RETRY-COUNTER                                 05385001
053860         FROM 1 BY 1                                              05386001
053870         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05387001
053880                   OR (SQLCODE = +0)                              05388001
053890                   OR (SQLCODE = +100))                           05389001
053900                                                                  05390001
053910         EXEC SQL                                                 05391001
053920            SELECT   COUNT(*)                                     05392001
053930              INTO :PV-DB2-COUNT                                  05393001
053940              FROM                                                05394001
053950                    WST_INTGRTN_TYP  A                            05395001
053960                 ,  WST_ATTR_DEFN    B                            05396001
053970                 ,  WST_ATTR_ELEM    C                            05397001
053980                 ,  WST_ATTR_ELEM    D                            05398001
053990                 ,  WST_ATTR_ELEM    E                            05399001
054000                 ,  WST_ATTR_ELEM    F                            05400001
054010                 ,  WST_ATTR_ELEM    G                            05401001
054020              WHERE                                               05402001
054030                    A.INTGRTN_TYP_CDE   = 'EFCREPURP'             05403001
054040                AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE       05404001
054050                AND B.ATTR_DEFN_SEQ_NBR = 1                       05405001
054060                AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE       05406001
054070                AND C.ATTR_DEFN_SEQ_NBR = 1                       05407001
054080                AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE       05408001
054090                AND D.ATTR_DEFN_SEQ_NBR = 2                       05409001
054100                AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE       05410001
054110                AND E.ATTR_DEFN_SEQ_NBR = 3                       05411001
054120                AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE       05412001
054130                AND F.ATTR_DEFN_SEQ_NBR = 4                       05413001
054140                AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE       05414001
054150                AND G.ATTR_DEFN_SEQ_NBR = 5                       05415001
054160                AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR     05416001
054170                AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR     05417001
054180                AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR     05418001
054190                AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR     05419001
054200                AND C.ATTR_ELEM_NBR     = :PV-CURR-OPER-UNT-ID    05420001
054210                AND D.ATTR_ELEM_NBR     = :PV-OPER-UNT-ID         05421001
054220                AND E.ATTR_ELEM_TXT     = 'Y'                     05422001
054230                AND F.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP       05423001
054240             AND G.ATTR_ELEM_TMST = '9999-09-09-23.59.59.999999'  05424001
054250         END-EXEC                                                 05425001
054260                                                                  05426001
054270***  C.ATTR_ELEM_NBR = 1 = DC NUMBER                              05427001
054280***  D.ATTR_ELEM_NBR = 2 = EFC NUMBER                             05428001
054290                                                                  05429001
054300***  WHEN 810 PROCESING FOR 870, CURR OPER = 810, OPER = 870      05430001
054310                                                                  05431001
054320         EVALUATE TRUE                                            05432001
054330             WHEN SQLCODE = +0                                    05433001
054340             WHEN SQLCODE = +100                                  05434001
054350             WHEN SQLCODE = -904                                  05435001
054360             WHEN SQLCODE = -913                                  05436001
054370                  CONTINUE                                        05437001
054380                                                                  05438001
054390             WHEN SQLWARN0 NOT = SPACES                           05439001
054400             WHEN SQLCODE < +0                                    05440001
054410             WHEN SQLCODE > +0                                    05441001
054420                  MOVE '3015-CHECK-FOR-REPURP'                    05442001
054430                                  TO DP013-PARAGRAPH              05443001
054440                  MOVE 'UNSUCCESSFUL SELECT ON WST_INTGRTN_TYP'   05444001
054450                                  TO DP013-MESSAGE-TEXT (1)       05445001
054460                  MOVE SQLCA      TO DP013-SQLCA                  05446001
054470                  MOVE 'WST_INTGRTN_TYP'                          05447001
054480                                  TO DP013-DB2-TABLE-NAME (1)     05448001
054490                  MOVE 'WST_ATTR_DEFN'                            05449001
054500                                  TO DP013-DB2-TABLE-NAME (2)     05450001
054510                  MOVE 'WST_ATTR_ELEM'                            05451001
054520                                  TO DP013-DB2-TABLE-NAME (3)     05452001
054530                  SET DP013-DB2-ABEND                             05453001
054540                      DP013-XCTL-DISPLAY-RESTART                  05454001
054550                                  TO TRUE                         05455001
054560                  PERFORM DP013-0000-PROCESS-ABEND                05456001
054570         END-EVALUATE                                             05457001
054580     END-PERFORM.                                                 05458001
054590                                                                  05459001
054600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05460001
054610             AND (SQLCODE = -904 OR -913)                         05461001
054620         MOVE '3015-CHECK-FOR-REPURP'                             05462001
054630                                  TO DP013-PARAGRAPH              05463001
054640         MOVE 'MAX RETRIES EXCEEDED ON COUNT'                     05464001
054650                                  TO DP013-MESSAGE-TEXT (1)       05465001
054660         MOVE SQLCA               TO DP013-SQLCA                  05466001
054670         MOVE 'WST_INTGRTN_TYP'   TO DP013-DB2-TABLE-NAME (1)     05467001
054680         SET DP013-DB2-ABEND                                      05468001
054690             DP013-XCTL-DISPLAY-RESTART                           05469001
054700                                  TO TRUE                         05470001
054710         PERFORM DP013-0000-PROCESS-ABEND                         05471001
054720     END-IF.                                                      05472001
054730                                                                  05473001
054740** AHP -  END - 04/07/08                                          05474001
054750/                                                                 05475001
054760*----------------------------------------------------------------*05476001
054770*  CHECK THE FACILITY TABLE TO VERIFY THAT THE FACILITY          *05477001
054780*  ENTERED ON THE MAP IS VALID.                                  *05478001
054790*----------------------------------------------------------------*05479001
054800                                                                  05480001
054810 3020-VALIDATE-FCLTY-ID.                                          05481001
054820                                                                  05482001
054830     INITIALIZE XL071-COMMAREA-REC.                               05483001
054840     MOVE CURR-OPER-UNT-ID           TO XL071-LOCATION-NUMBER.    05484001
054850                                                                  05485001
054860     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  05486001
054870                                        XL071-COMMAREA            05487001
054880                                        XL071-COMMAREA-REC.       05488001
054890                                                                  05489001
054900* * THERE IS LEGITIMATELY NO ROW ON XLT_DC_LOC_ASGMT              05490001
054910* * FOR CORPORATE                                                 05491001
054920     IF XL071-LOCATION-NUMBER = PC-CORPORATE                      05492001
054930       AND XL071-DC-ASGMT-NOT-FND                                 05493001
054940         SET XL071-NO-ERRORS         TO TRUE                      05494001
054950     END-IF.                                                      05495001
054960                                                                  05496001
054970     EVALUATE TRUE                                                05497001
054980         WHEN XL071-NO-ERRORS                                     05498001
054990              CONTINUE                                            05499001
055000         WHEN XL071-LOC-NOT-FOUND                                 05500001
055010                 MOVE 'STORE NAME NOT FOUND' TO                   05501001
055020                                  XL071-LOC-NM                    05502001
055030         WHEN OTHER                                               05503008
055040              INITIALIZE PV-CICS-MSG-AREA                         05504001
055050              MOVE XL071-SQLCODE-N   TO PV-DISPLAY-SQLCODE2       05505017
055060              STRING ' RCKCS221 - 3020 - CALL XLKUT071 -'         05506001
055070                     ' SQLCODE='  PV-DISPLAY-SQLCODE2             05507017
055080                     ' PO-NBR='   ASC-PO-NBR-N                    05508017
055090                                              DELIMITED BY SIZE   05509001
055100                                         INTO PV-CICS-MSG-AREA    05510001
055110              PERFORM 9900-WRITE-CICS-LOG                         05511001
055120                                                                  05512001
055130              STRING ' SQLCODE= '                                 05513017
055140                       PV-DISPLAY-SQLCODE2                        05514016
055150                     '  PO-NUMBER= '                              05515016
055160                       ASC-PO-NBR-N  DELIMITED BY SIZE            05516016
055170                                     INTO DP013-MESSAGE-TEXT (1)  05517016
055180              MOVE '3020-VALIDATE-FCLTY-ID'                       05518011
055190                                     TO PV-DISPLAY-PARAGRAPH      05519011
055200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              05520001
055210              PERFORM 9900A-SOFT-ABORT                            05521001
055220     END-EVALUATE.                                                05522001
055230                                                                  05523001
055240/                                                                 05524001
055250 3030-CASEPACK-CHECK.                                             05525001
055260     IF ASC-UPDATE-PENDING                                        05526001
055270       AND ASC-REC-TYP NOT = ASC-REC-TYP-OLD                      05527001
055280         PERFORM 4052-COUNT-CASEPK-SPLIT                          05528001
055290         IF ASC-CASEPACK-SPLT-CNT > 0                             05529001
055300             SET PS-ERROR                                         05530001
055310                 DP020-MSG-FATAL         TO TRUE                  05531001
055320             MOVE PC-TSYMSG-03341        TO DP020-MSG-NUMBER      05532001
055330             MOVE DP015-UNP-ALP-BRT-OFF  TO ARECTYPA              05533001
055340             MOVE DP015-RED              TO ARECTYPC              05534001
055350             MOVE DP015-REVERSE          TO ARECTYPH              05535001
055360             MOVE -1                     TO ARECTYPL              05536001
055370             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05537001
055380         ELSE                                                     05538001
055390             PERFORM 4053-COUNT-OUTBOUND                          05539001
055400             IF ASC-OTBND-CTN-CNT > 0                             05540001
055410                SET PS-ERROR                                      05541001
055420                    DP020-MSG-FATAL         TO TRUE               05542001
055430                MOVE PC-TSYMSG-03345        TO DP020-MSG-NUMBER   05543001
055440                MOVE DP015-UNP-ALP-BRT-OFF  TO ARECTYPA           05544001
055450                MOVE DP015-RED              TO ARECTYPC           05545001
055460                MOVE DP015-REVERSE          TO ARECTYPH           05546001
055470                MOVE -1                     TO ARECTYPL           05547001
055480                SET DP030-SET-CURSOR-APPL-1 TO TRUE               05548001
055490             END-IF                                               05549001
055500         END-IF                                                   05550001
055510     END-IF.                                                      05551001
055520                                                                  05552001
055530*----------------------------------------------------------------*05553001
055540*  CHECK THE EXTERNAL ENTERPRISE TABLE TO VERIFY THE SCAC CODE   *05554001
055550*  ENTERED IS VALID.                                             *05555001
055560*----------------------------------------------------------------*05556001
055570* WR40574 02-09-2012 BELOW ADDED WITH UR                          05557002
055580                                                                  05558001
055590 3040-VALIDATE-SCAC-CDE.                                          05559001
055600                                                                  05560001
055610     PERFORM                                                      05561001
055620         WITH TEST AFTER                                          05562001
055630         VARYING PV-RETRY-COUNTER                                 05563001
055640         FROM 1 BY 1                                              05564001
055650         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05565001
055660                   OR (SQLCODE = +0)                              05566001
055670                   OR (SQLCODE = +100)                            05567001
055680                   OR (SQLCODE = -811))                           05568001
055690                                                                  05569001
055700         EXEC SQL                                                 05570001
055710            SELECT  SCAC_CDE                                      05571001
055720              INTO :EXTENT-SCAC-CDE                               05572001
055730              FROM  TEXTENT                                       05573001
055740             WHERE  SCAC_CDE = :DK-OWNER-SCAC-ID                  05574001
055750            WITH UR                                               05575002
055760         END-EXEC                                                 05576001
055770                                                                  05577001
055780         EVALUATE TRUE                                            05578001
055790             WHEN SQLCODE = +0                                    05579001
055800             WHEN SQLCODE = +100                                  05580001
055810             WHEN SQLCODE = -811                                  05581001
055820             WHEN SQLCODE = -904                                  05582001
055830             WHEN SQLCODE = -913                                  05583001
055840                 CONTINUE                                         05584001
055850                                                                  05585001
055860             WHEN SQLWARN0 NOT = SPACES                           05586001
055870             WHEN SQLCODE < +0                                    05587001
055880             WHEN SQLCODE > +0                                    05588001
055890                 MOVE '3040-VALIDATE-SCAC-CDE'                    05589001
055900                                 TO DP013-PARAGRAPH               05590001
055910                 MOVE 'SELECT SCAC CODE'                          05591001
055920                                 TO DP013-MESSAGE-TEXT (1)        05592001
055930                 MOVE DK-OWNER-SCAC-ID                            05593001
055940                                 TO DP013-MESSAGE-TEXT (2)        05594001
055950                 MOVE SQLCA      TO DP013-SQLCA                   05595001
055960                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (1)      05596001
055970                 SET DP013-DB2-ABEND                              05597001
055980                                 TO TRUE                          05598001
055990                 SET DP013-XCTL-DISPLAY-RESTART                   05599001
056000                                 TO TRUE                          05600001
056010                 PERFORM DP013-0000-PROCESS-ABEND                 05601001
056020         END-EVALUATE                                             05602001
056030     END-PERFORM.                                                 05603001
056040                                                                  05604001
056050     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05605001
056060             AND (SQLCODE = -904 OR -913)                         05606001
056070         MOVE '3040-VALIDATE-SCAC-CDE'                            05607001
056080                                 TO DP013-PARAGRAPH               05608001
056090         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05609001
056100                                 TO DP013-MESSAGE-TEXT (1)        05610001
056110         MOVE 'SCAC CODE       ' TO DP013-MESSAGE-TEXT (2)        05611001
056120         MOVE SQLCA              TO DP013-SQLCA                   05612001
056130         MOVE 'TEXTENT'          TO DP013-DB2-TABLE-NAME (1)      05613001
056140         SET DP013-DB2-ABEND     TO TRUE                          05614001
056150         SET DP013-XCTL-DISPLAY-RESTART                           05615001
056160                                 TO TRUE                          05616001
056170         PERFORM DP013-0000-PROCESS-ABEND                         05617001
056180     END-IF.                                                      05618001
056190                                                                  05619001
056200/                                                                 05620001
056210*----------------------------------------------------------------*05621001
056220*    CHECK TO SEE IF ANY TRIPS EXISTS.                           *05622001
056230*----------------------------------------------------------------*05623001
056240 3050-CHECK-FOR-TRIPS.                                            05624001
056250                                                                  05625001
056260     PERFORM                                                      05626001
056270         WITH TEST AFTER                                          05627001
056280         VARYING PV-RETRY-COUNTER                                 05628001
056290         FROM 1 BY 1                                              05629001
056300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05630001
056310             OR (SQLCODE = +0)                                    05631001
056320             OR (SQLCODE = +100)                                  05632001
056330             OR (SQLCODE = -811))                                 05633001
056340                                                                  05634001
056350         EXEC SQL                                                 05635001
056360              SELECT DISTINCT                                     05636001
056370                     A.TRIP_ID                                    05637001
056380                    ,B.TRIP_STATUS_CDE                            05638001
056390                INTO :VHTRIP-TRIP-ID                              05639001
056400                    ,:TRIPST-TRIP-STATUS-CDE                      05640001
056410                FROM TVHTRIP A                                    05641001
056420                    ,TTRIPST B                                    05642001
056430                    ,TTRSTYP C                                    05643001
056440                    ,TVEHICL E                                    05644001
056450               WHERE A.VEH_NBR       = :DK-VEH-NBR                05645001
056460                 AND A.VEH_NBR IS NOT NULL                        05646001
056470                 AND A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID          05647001
056480                 AND B.STATUS_DTE    = :DK-STATUS-DTE             05648001
056490                 AND A.TRIP_ID         = B.TRIP_ID                05649001
056500                 AND A.TRIP_ID         = E.CURR_TRIP_ID           05650001
056510                 AND B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE        05651001
056520                 AND C.PRTY_CDE =                                 05652001
056530                  (SELECT MAX(G.PRTY_CDE)                         05653001
056540                     FROM TTRIPST F                               05654001
056550                         ,TTRSTYP G                               05655001
056560                    WHERE F.TRIP_ID         = A.TRIP_ID           05656001
056570                      AND F.TRIP_STATUS_CDE = G.TRIP_STATUS_CDE)  05657001
056580         END-EXEC                                                 05658001
056590                                                                  05659001
056600         EVALUATE TRUE                                            05660001
056610             WHEN SQLCODE = +0                                    05661001
056620             WHEN SQLCODE = +100                                  05662001
056630             WHEN SQLCODE = -811                                  05663001
056640             WHEN SQLCODE = -904                                  05664001
056650             WHEN SQLCODE = -913                                  05665001
056660                  CONTINUE                                        05666001
056670                                                                  05667001
056680             WHEN SQLWARN0 NOT = SPACES                           05668001
056690             WHEN SQLCODE < +0                                    05669001
056700             WHEN SQLCODE > +0                                    05670001
056710                  INITIALIZE PV-MESSAGE                           05671001
056720                  MOVE DK-VEH-NBR  TO PV-MESSAGE1                 05672001
056730                  MOVE DK-OWNER-SCAC-ID TO PV-MESSAGE2            05673001
056740                  MOVE DK-STATUS-DTE  TO PV-MESSAGE3              05674001
056750                  MOVE '3050-CHECK-FOR-TRIPS'                     05675001
056760                                  TO DP013-PARAGRAPH              05676001
056770                  MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP  '         05677001
056780                                  TO DP013-MESSAGE-TEXT (1)       05678001
056790                  MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (2)       05679001
056800                  MOVE SQLCA      TO DP013-SQLCA                  05680001
056810                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     05681001
056820                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)     05682001
056830                  MOVE 'TTRSTYP ' TO DP013-DB2-TABLE-NAME (3)     05683001
056840                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (4)     05684001
056850                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (5)     05685001
056860                  SET DP013-DB2-ABEND                             05686001
056870                      DP013-XCTL-DISPLAY-RESTART                  05687001
056880                                  TO TRUE                         05688001
056890                  PERFORM DP013-0000-PROCESS-ABEND                05689001
056900         END-EVALUATE                                             05690001
056910     END-PERFORM.                                                 05691001
056920                                                                  05692001
056930     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05693001
056940             AND (SQLCODE = -904 OR -913)                         05694001
056950         MOVE '3050-CHECK-FOR-TRIPS'                              05695001
056960                                  TO DP013-PARAGRAPH              05696001
056970         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR TRIPS  '         05697001
056980                                  TO DP013-MESSAGE-TEXT (1)       05698001
056990         MOVE SQLCA               TO DP013-SQLCA                  05699001
057000         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)     05700001
057010         MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2)     05701001
057020         MOVE 'TTRSTYP '          TO DP013-DB2-TABLE-NAME (3)     05702001
057030         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (4)     05703001
057040         MOVE 'TVEHICL '          TO DP013-DB2-TABLE-NAME (5)     05704001
057050         SET DP013-DB2-ABEND                                      05705001
057060             DP013-XCTL-DISPLAY-RESTART                           05706001
057070                                  TO TRUE                         05707001
057080         PERFORM DP013-0000-PROCESS-ABEND                         05708001
057090     END-IF.                                                      05709001
057100                                                                  05710001
057110/                                                                 05711001
057120*----------------------------------------------------------------*05712001
057130*    CHECK TO SEE IF ANY SHIPMENTS EXIST                         *05713001
057140*----------------------------------------------------------------*05714001
057150 3060-CHECK-FOR-SHIPMENTS.                                        05715001
057160                                                                  05716001
057170     PERFORM                                                      05717001
057180         WITH TEST AFTER                                          05718001
057190         VARYING PV-RETRY-COUNTER                                 05719001
057200         FROM 1 BY 1                                              05720001
057210         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05721001
057220             OR (SQLCODE = +0)                                    05722001
057230             OR (SQLCODE = +100)                                  05723001
057240             OR (SQLCODE = -811))                                 05724001
057250                                                                  05725001
057260         EXEC SQL                                                 05726001
057270              SELECT B.SHIPT_ID                                   05727001
057280                    ,B.TRIP_ID                                    05728001
057290                INTO :SHIPMT-SHIPT-ID                             05729001
057300                    ,:SHIPMT-TRIP-ID                              05730001
057310                FROM TSHIPMT B                                    05731001
057320                    ,TSHIPST C                                    05732001
057330                    ,TSHSTYP D                                    05733001
057340               WHERE B.PRO_SCAC_ID = :DK-OWNER-SCAC-ID            05734001
057350                 AND B.PRO_NBR BETWEEN :DK-PRO-NBR-B              05735001
057360                                   AND :DK-PRO-NBR-E              05736001
057370                 AND B.BOL_NBR BETWEEN :DK-BOL-NBR-B              05737001
057380                                   AND :DK-BOL-NBR-E              05738001
057390                 AND B.SHIPT_ID         = C.SHIPT_ID              05739001
057400                 AND C.SHIPT_STATUS_CDE NOT IN ('DE','ET')        05740001
057410                 AND C.SHIPT_STATUS_CDE = D.SHIPT_STATUS_CDE      05741001
057420                 AND D.PRTY_CDE =                                 05742001
057430                  (SELECT MAX(E.PRTY_CDE)                         05743001
057440                   FROM TSHIPST D                                 05744001
057450                       ,TSHSTYP E                                 05745001
057460                   WHERE D.SHIPT_ID         = B.SHIPT_ID          05746001
057470                     AND D.SHIPT_STATUS_CDE = E.SHIPT_STATUS_CDE) 05747001
057480         END-EXEC                                                 05748001
057490                                                                  05749001
057500         EVALUATE TRUE                                            05750001
057510             WHEN SQLCODE = +0                                    05751001
057520             WHEN SQLCODE = +100                                  05752001
057530             WHEN SQLCODE = -811                                  05753001
057540             WHEN SQLCODE = -904                                  05754001
057550             WHEN SQLCODE = -913                                  05755001
057560                  CONTINUE                                        05756001
057570                                                                  05757001
057580             WHEN SQLWARN0 NOT = SPACES                           05758001
057590             WHEN SQLCODE < +0                                    05759001
057600             WHEN SQLCODE > +0                                    05760001
057610                  MOVE '3060-CHECK-FOR-SHIPMENTS'                 05761001
057620                                  TO DP013-PARAGRAPH              05762001
057630                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         05763001
057640                                  TO DP013-MESSAGE-TEXT (1)       05764001
057650                  MOVE SQLCA      TO DP013-SQLCA                  05765001
057660                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     05766001
057670                  MOVE 'TSHIPST ' TO DP013-DB2-TABLE-NAME (2)     05767001
057680                  SET DP013-DB2-ABEND                             05768001
057690                      DP013-XCTL-DISPLAY-RESTART                  05769001
057700                                  TO TRUE                         05770001
057710                  PERFORM DP013-0000-PROCESS-ABEND                05771001
057720         END-EVALUATE                                             05772001
057730     END-PERFORM.                                                 05773001
057740                                                                  05774001
057750     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    05775001
057760             SQLCODE = -904 OR -913                               05776001
057770         MOVE '3060-CHECK-FOR-SHIPMENTS'                          05777001
057780                                  TO DP013-PARAGRAPH              05778001
057790         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'       05779001
057800                                  TO DP013-MESSAGE-TEXT (1)       05780001
057810         MOVE SQLCA               TO DP013-SQLCA                  05781001
057820         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     05782001
057830         MOVE 'TSHIPST '          TO DP013-DB2-TABLE-NAME (2)     05783001
057840         MOVE 'TSHSTYP '          TO DP013-DB2-TABLE-NAME (3)     05784001
057850         SET DP013-DB2-ABEND                                      05785001
057860             DP013-XCTL-DISPLAY-RESTART                           05786001
057870                                  TO TRUE                         05787001
057880         PERFORM DP013-0000-PROCESS-ABEND                         05788001
057890     END-IF.                                                      05789001
057900                                                                  05790001
057910     IF SQLCODE = +0                                              05791001
057920        PERFORM 3065-GET-TRIP-OPER                                05792001
057930        IF ASC-OPER-UNT-ID-N = TRIPST-OPER-UNT-ID                 05793001
057940           CONTINUE                                               05794001
057950        ELSE                                                      05795001
057960           MOVE PC-TSYMSG-01019 TO DP020-MSG-NUMBER               05796001
057970           MOVE TRIPST-OPER-UNT-ID                                05797001
057980                                TO PV-DISPLAY-OPER-ID             05798001
057990           MOVE TRIPST-FCLTY-ID TO PV-DISPLAY-FCLTY-ID            05799001
058000           MOVE PV-DISPLAY-LOCATION TO DP020-MSG-TEXT             05800001
058010           SET DP020-MSG-FATAL                                    05801001
058020               PS-ERROR         TO TRUE                           05802001
058030        END-IF                                                    05803001
058040                                                                  05804001
058050        PERFORM                                                   05805001
058060            WITH TEST AFTER                                       05806001
058070            VARYING PV-RETRY-COUNTER                              05807001
058080            FROM 1 BY 1                                           05808001
058090            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            05809001
058100                OR (SQLCODE = +0)                                 05810001
058110                OR (SQLCODE = +100)                               05811001
058120                OR (SQLCODE = -811))                              05812001
058130                                                                  05813001
058140            EXEC SQL                                              05814001
058150                 SELECT VEH_NBR                                   05815001
058160                       ,OWNER_SCAC_ID                             05816001
058170                   INTO :VHTRIP-VEH-NBR  :DN-VEH-NBR              05817001
058180                       ,:VHTRIP-OWNER-SCAC-ID                     05818001
058190                   FROM TVHTRIP                                   05819001
058200                  WHERE TRIP_ID       = :SHIPMT-TRIP-ID           05820001
058210            END-EXEC                                              05821001
058220                                                                  05822001
058230            EVALUATE TRUE                                         05823001
058240                WHEN SQLCODE = +0                                 05824001
058250                WHEN SQLCODE = +100                               05825001
058260                WHEN SQLCODE = -811                               05826001
058270                WHEN SQLCODE = -904                               05827001
058280                WHEN SQLCODE = -913                               05828001
058290                     CONTINUE                                     05829001
058300                                                                  05830001
058310                WHEN SQLWARN0 NOT = SPACES                        05831001
058320                WHEN SQLCODE < +0                                 05832001
058330                WHEN SQLCODE > +0                                 05833001
058340                     MOVE '3060-CHECK-FOR-SHIPMENTS'              05834001
058350                                     TO DP013-PARAGRAPH           05835001
058360                     MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP  '      05836001
058370                                     TO DP013-MESSAGE-TEXT (1)    05837001
058380                     MOVE SQLCA      TO DP013-SQLCA               05838001
058390                     MOVE 'TVHTRIP'  TO DP013-DB2-TABLE-NAME (1)  05839001
058400                     SET DP013-DB2-ABEND                          05840001
058410                         DP013-XCTL-DISPLAY-RESTART               05841001
058420                                     TO TRUE                      05842001
058430                     PERFORM DP013-0000-PROCESS-ABEND             05843001
058440            END-EVALUATE                                          05844001
058450        END-PERFORM                                               05845001
058460                                                                  05846001
058470        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                 05847001
058480             SQLCODE = -904 OR -913                               05848001
058490            MOVE '3060-CHECK-FOR-SHIPMENTS'                       05849001
058500                                     TO DP013-PARAGRAPH           05850001
058510            MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR TRIPS'        05851001
058520                                     TO DP013-MESSAGE-TEXT (1)    05852001
058530            MOVE SQLCA               TO DP013-SQLCA               05853001
058540            MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)  05854001
058550            SET DP013-DB2-ABEND                                   05855001
058560                DP013-XCTL-DISPLAY-RESTART                        05856001
058570                                     TO TRUE                      05857001
058580            PERFORM DP013-0000-PROCESS-ABEND                      05858001
058590        END-IF                                                    05859001
058600     END-IF.                                                      05860001
058610                                                                  05861001
058620/                                                                 05862001
058630*----------------------------------------------------------------*05863001
058640*    GET OPER ID, FCLTY ID FOR THE TRIP.                         *05864001
058650*----------------------------------------------------------------*05865001
058660 3065-GET-TRIP-OPER.                                              05866001
058670                                                                  05867001
058680     PERFORM                                                      05868001
058690         WITH TEST AFTER                                          05869001
058700         VARYING PV-RETRY-COUNTER                                 05870001
058710         FROM 1 BY 1                                              05871001
058720         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05872001
058730             OR (SQLCODE = +0))                                   05873001
058740                                                                  05874001
058750         EXEC SQL                                                 05875001
058760             SELECT OPER_UNT_ID                                   05876001
058770                   ,FCLTY_ID                                      05877001
058780               INTO :TRIPST-OPER-UNT-ID                           05878001
058790                   ,:TRIPST-FCLTY-ID                              05879001
058800               FROM TTRIPST A                                     05880001
058810                   ,TTRSTYP B                                     05881001
058820              WHERE A.TRIP_ID         = :SHIPMT-TRIP-ID           05882001
058830                AND A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE         05883001
058840                AND B.PRTY_CDE =                                  05884001
058850                     (SELECT MAX(D.PRTY_CDE)                      05885001
058860                        FROM TTRIPST C                            05886001
058870                            ,TTRSTYP D                            05887001
058880                       WHERE C.TRIP_ID       = A.TRIP_ID          05888001
058890                       AND C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE) 05889001
058900         END-EXEC                                                 05890001
058910                                                                  05891001
058920         EVALUATE TRUE                                            05892001
058930             WHEN SQLCODE = +0                                    05893001
058940             WHEN SQLCODE = +100                                  05894001
058950             WHEN SQLCODE = -811                                  05895001
058960             WHEN SQLCODE = -904                                  05896001
058970             WHEN SQLCODE = -913                                  05897001
058980                  CONTINUE                                        05898001
058990                                                                  05899001
059000             WHEN SQLWARN0 NOT = SPACES                           05900001
059010             WHEN SQLCODE < +0                                    05901001
059020             WHEN SQLCODE > +0                                    05902001
059030                  MOVE '3065-GET-TRIP-OPER'                       05903001
059040                                  TO DP013-PARAGRAPH              05904001
059050                  MOVE 'UNSUCCESSFUL SELECT ON FOR TRIP '         05905001
059060                                  TO DP013-MESSAGE-TEXT (1)       05906001
059070                  MOVE 'OPER ID '                                 05907001
059080                                  TO DP013-MESSAGE-TEXT (2)       05908001
059090                  MOVE DK-TRIP-ID TO DP013-MESSAGE-TEXT (3)       05909001
059100                  MOVE SQLCA      TO DP013-SQLCA                  05910001
059110                  MOVE 'TTRIPST'  TO DP013-DB2-TABLE-NAME (1)     05911001
059120                  MOVE 'TTRSTYP'  TO DP013-DB2-TABLE-NAME (1)     05912001
059130                  SET DP013-DB2-ABEND                             05913001
059140                      DP013-XCTL-DISPLAY-RESTART                  05914001
059150                                  TO TRUE                         05915001
059160                  PERFORM DP013-0000-PROCESS-ABEND                05916001
059170         END-EVALUATE                                             05917001
059180     END-PERFORM.                                                 05918001
059190                                                                  05919001
059200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05920001
059210             AND (SQLCODE = -904 OR -913)                         05921001
059220         MOVE '3065-GET-TRIP-OPER'                                05922001
059230                                  TO DP013-PARAGRAPH              05923001
059240         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR TRIPS'           05924001
059250                                  TO DP013-MESSAGE-TEXT (1)       05925001
059260         MOVE SQLCA               TO DP013-SQLCA                  05926001
059270         MOVE 'TTRIPST'  TO DP013-DB2-TABLE-NAME (1)              05927001
059280         MOVE 'TTRSTYP'  TO DP013-DB2-TABLE-NAME (1)              05928001
059290         SET DP013-DB2-ABEND                                      05929001
059300             DP013-XCTL-DISPLAY-RESTART                           05930001
059310                                  TO TRUE                         05931001
059320         PERFORM DP013-0000-PROCESS-ABEND                         05932001
059330     END-IF.                                                      05933001
059340                                                                  05934001
059350*----------------------------------------------------------------*05935001
059360*    CHECK TO SEE IF PO EXISTS                                   *05936001
059370*----------------------------------------------------------------*05937001
059380 3070-CHECK-FOR-PO.                                               05938001
059390                                                                  05939001
059400     PERFORM                                                      05940001
059410         WITH TEST AFTER                                          05941001
059420         VARYING PV-RETRY-COUNTER                                 05942001
059430         FROM 1 BY 1                                              05943001
059440         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05944001
059450             OR (SQLCODE = +0)                                    05945001
059460             OR (SQLCODE = +100))                                 05946001
059470                                                                  05947001
059480         EXEC SQL                                                 05948001
059490              SELECT COUNT(*)                                     05949001
059500                INTO :PV-DB2-COUNT                                05950001
059510                FROM TSHPTPO                                      05951001
059520               WHERE PO_NBR   = :DK-PO-NBR                        05952001
059530                 AND SHIPT_ID = :DK-SHIPT-ID                      05953001
059540         END-EXEC                                                 05954001
059550                                                                  05955001
059560         EVALUATE TRUE                                            05956001
059570             WHEN SQLCODE = +0                                    05957001
059580             WHEN SQLCODE = +100                                  05958001
059590             WHEN SQLCODE = -904                                  05959001
059600             WHEN SQLCODE = -913                                  05960001
059610                  CONTINUE                                        05961001
059620                                                                  05962001
059630             WHEN SQLWARN0 NOT = SPACES                           05963001
059640             WHEN SQLCODE < +0                                    05964001
059650             WHEN SQLCODE > +0                                    05965001
059660                  MOVE '3070-CHECK-FOR-PO'                        05966001
059670                                  TO DP013-PARAGRAPH              05967001
059680                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         05968001
059690                                  TO DP013-MESSAGE-TEXT (1)       05969001
059700                  MOVE SQLCA      TO DP013-SQLCA                  05970001
059710                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     05971001
059720                  SET DP013-DB2-ABEND                             05972001
059730                      DP013-XCTL-DISPLAY-RESTART                  05973001
059740                                  TO TRUE                         05974001
059750                  PERFORM DP013-0000-PROCESS-ABEND                05975001
059760         END-EVALUATE                                             05976001
059770     END-PERFORM.                                                 05977001
059780                                                                  05978001
059790     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05979001
059800             AND (SQLCODE = -904 OR -913)                         05980001
059810         MOVE '3070-CHECK-FOR-PO'                                 05981001
059820                                  TO DP013-PARAGRAPH              05982001
059830         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'       05983001
059840                                  TO DP013-MESSAGE-TEXT (1)       05984001
059850         MOVE SQLCA               TO DP013-SQLCA                  05985001
059860         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     05986001
059870         SET DP013-DB2-ABEND                                      05987001
059880             DP013-XCTL-DISPLAY-RESTART                           05988001
059890                                  TO TRUE                         05989001
059900         PERFORM DP013-0000-PROCESS-ABEND                         05990001
059910     END-IF.                                                      05991001
059920                                                                  05992001
059930/                                                                 05993001
059940*----------------------------------------------------------------*05994001
059950*  GET OPER-SET-ID FROM TCOCNTL                                  *05995001
059960*----------------------------------------------------------------*05996001
059970                                                                  05997001
059980 3080-GET-OPER-SET-ID.                                            05998001
059990                                                                  05999001
060000     EXEC SQL                                                     06000001
060010          SELECT  DFLT_OPER_SET_ID                                06001001
060020            INTO :COCNTL-DFLT-OPER-SET-ID                         06002001
060030            FROM  TCOCNTL                                         06003001
060040           WHERE  OPER_UNT_ID    = :CURR-OPER-UNT-ID              06004001
060050             AND  FCLTY_ID       = :CURR-FCLTY-ID                 06005001
060060     END-EXEC.                                                    06006001
060070                                                                  06007001
060080     EVALUATE TRUE                                                06008001
060090         WHEN SQLCODE = +0                                        06009001
060100              CONTINUE                                            06010001
060110                                                                  06011001
060120         WHEN SQLCODE = +100                                      06012001
060130              MOVE  ZEROES  TO  COCNTL-DFLT-OPER-SET-ID           06013001
060140                                                                  06014001
060150         WHEN SQLWARN0 NOT = SPACES                               06015001
060160         WHEN SQLCODE < +0                                        06016001
060170         WHEN SQLCODE > +0                                        06017001
060180              MOVE '3080-GET-OPER-SET-ID'                         06018001
060190                                       TO DP013-PARAGRAPH         06019001
060200              MOVE 'SELECT OPERATION SET ID FROM TCOCNTL'         06020001
060210                                       TO DP013-MESSAGE-TEXT(1)   06021001
060220              MOVE SQLCA               TO DP013-SQLCA             06022001
060230              MOVE 'TCOCNTL'           TO DP013-DB2-TABLE-NAME(1) 06023001
060240              SET DP013-DB2-ABEND      TO TRUE                    06024001
060250              SET DP013-XCTL-DISPLAY-RESTART                      06025001
060260                                       TO TRUE                    06026001
060270              PERFORM DP013-0000-PROCESS-ABEND                    06027001
060280     END-EVALUATE.                                                06028001
060290                                                                  06029001
060300                                                                  06030001
060310*----------------------------------------------------------------*06031001
060320*  VALIDATE THE OPERATION SET ID ENTERED                         *06032001
060330*----------------------------------------------------------------*06033001
060340                                                                  06034001
060350 3090-VALIDATE-OPER-SET-ID.                                       06035001
060360                                                                  06036001
060370     PERFORM                                                      06037001
060380         WITH TEST AFTER                                          06038001
060390         VARYING PV-RETRY-COUNTER                                 06039001
060400         FROM 1 BY 1                                              06040001
060410         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06041001
060420                   OR (SQLCODE = +0)                              06042001
060430                   OR (SQLCODE = +100))                           06043001
060440                                                                  06044001
060450         EXEC SQL                                                 06045001
060460            SELECT  OPER_SET_DESC                                 06046001
060470              INTO :OPRSET-OPER-SET-DESC                          06047001
060480              FROM  TOPRSET                                       06048001
060490             WHERE  OPER_SET_ID    = :DK-OPER-SET-ID              06049001
060500               AND  VER_STATUS_CDE = 'A'                          06050001
060510               AND  OPER_UNT_ID    = :CURR-OPER-UNT-ID            06051001
060520               AND  FCLTY_ID       = :CURR-FCLTY-ID               06052001
060530         END-EXEC                                                 06053001
060540                                                                  06054001
060550         EVALUATE TRUE                                            06055001
060560             WHEN SQLCODE = +0                                    06056001
060570             WHEN SQLCODE = +100                                  06057001
060580             WHEN SQLCODE = -904                                  06058001
060590             WHEN SQLCODE = -913                                  06059001
060600                 CONTINUE                                         06060001
060610                                                                  06061001
060620             WHEN SQLWARN0 NOT = SPACES                           06062001
060630             WHEN SQLCODE < +0                                    06063001
060640             WHEN SQLCODE > +0                                    06064001
060650                 MOVE '3090-VALIDATE-OPER-SET-ID'                 06065001
060660                                 TO DP013-PARAGRAPH               06066001
060670                 MOVE 'SELECT OPERATION SET ID'                   06067001
060680                                 TO DP013-MESSAGE-TEXT (1)        06068001
060690                 MOVE SQLCA      TO DP013-SQLCA                   06069001
060700                 MOVE 'TOPRSET'  TO DP013-DB2-TABLE-NAME (1)      06070001
060710                 SET DP013-DB2-ABEND                              06071001
060720                                 TO TRUE                          06072001
060730                 SET DP013-XCTL-DISPLAY-RESTART                   06073001
060740                                 TO TRUE                          06074001
060750                 PERFORM DP013-0000-PROCESS-ABEND                 06075001
060760         END-EVALUATE                                             06076001
060770     END-PERFORM.                                                 06077001
060780                                                                  06078001
060790     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06079001
060800             AND (SQLCODE = -904 OR -913)                         06080001
060810         MOVE '3090-VALIDATE-OPER-SET-ID'                         06081001
060820                                 TO DP013-PARAGRAPH               06082001
060830         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06083001
060840                                 TO DP013-MESSAGE-TEXT (1)        06084001
060850         MOVE 'ON TOPRSET    '   TO DP013-MESSAGE-TEXT (2)        06085001
060860         MOVE SQLCA              TO DP013-SQLCA                   06086001
060870         MOVE 'TOPRSET'          TO DP013-DB2-TABLE-NAME (1)      06087001
060880         SET DP013-DB2-ABEND     TO TRUE                          06088001
060890         SET DP013-XCTL-DISPLAY-RESTART                           06089001
060900                                 TO TRUE                          06090001
060910         PERFORM DP013-0000-PROCESS-ABEND                         06091001
060920     END-IF.                                                      06092001
060930                                                                  06093001
060940/                                                                 06094001
060950*----------------------------------------------------------------*06095001
060960* MOVE DEFAULT VALUES                                            *06096001
060970*----------------------------------------------------------------*06097001
060980 3100-MOVE-DEFAULT-TO-COMMAREA.                                   06098001
060990                                                                  06099001
061000     IF  ASC-EXPENSE-RECEIPT                                      06100001
061010     OR  ASC-DIRECT-STORE                                         06101001
061020         CONTINUE                                                 06102001
061030     ELSE                                                         06103001
061040         IF  ASC-OPER-SET-ID = (SPACES OR ZEROES)                 06104001
061050             PERFORM 3120-GET-OPER-SET-INFO                       06105001
061060             IF  SQLCODE = +0                                     06106001
061070                 MOVE DCFAAS-OPER-SET-ID   TO ASC-OPER-SET-ID-N   06107001
061080                                              AOPSETI             06108001
061090                                              AOPSETO             06109001
061100                 MOVE OPRSET-OPER-SET-DESC TO ASC-OPER-SET-DESC   06110001
061110                                              AOPDESCO            06111001
061120             ELSE                                                 06112001
061130                                                                  06113001
061140                 PERFORM 3080-GET-OPER-SET-ID                     06114001
061150                    MOVE COCNTL-DFLT-OPER-SET-ID                  06115001
061160                                           TO ASC-OPER-SET-ID-N   06116001
061170                                                  DK-OPER-SET-ID  06117001
061180                                                  AOPSETI         06118001
061190                                                  AOPSETO         06119001
061200                                                                  06120001
061210                 PERFORM 3090-VALIDATE-OPER-SET-ID                06121001
061220                 MOVE OPRSET-OPER-SET-DESC TO ASC-OPER-SET-DESC   06122001
061230                                              AOPDESCO            06123001
061240             END-IF                                               06124001
061250         END-IF                                                   06125001
061260     END-IF.                                                      06126001
061270                                                                  06127001
061280*    CHECK THE PRE TICKET CODE ON THE PO AGREEMENT TABLE          06128001
061290     INITIALIZE PV-DB2-COUNT.                                     06129001
061300     MOVE 4                      TO DK-AGRMT-TYP-ID.              06130001
061310     MOVE 1                      TO DK-TYP-CDE.                   06131001
061320                                                                  06132001
061330     PERFORM 3140-CHECK-PO-SERVICE-INFO.                          06133001
061340                                                                  06134001
061350     IF  PV-DB2-COUNT > +0                                        06135001
061360         MOVE 'Y'                TO ASC-PRE-TKT-IND               06136001
061370                                    APRETKTI                      06137001
061380                                    APRETKTO                      06138001
061390     ELSE                                                         06139001
061400         MOVE 'N'                TO ASC-PRE-TKT-IND               06140001
061410                                    APRETKTI                      06141001
061420                                    APRETKTO                      06142001
061430     END-IF.                                                      06143001
061440                                                                  06144001
061450                                                                  06145001
061460*    CHECK THE HANGER INSERTION CODE ON THE PO AGREEMENT TABLE    06146001
061470     INITIALIZE PV-DB2-COUNT.                                     06147001
061480     MOVE 4                      TO DK-AGRMT-TYP-ID.              06148001
061490     MOVE 2                      TO DK-TYP-CDE.                   06149001
061500                                                                  06150001
061510     PERFORM 3140-CHECK-PO-SERVICE-INFO.                          06151001
061520                                                                  06152001
061530     IF  PV-DB2-COUNT > +0                                        06153001
061540         MOVE 'Y'                TO ASC-HANGER-IND                06154001
061550                                    AHANGERI                      06155001
061560                                    AHANGERO                      06156001
061570     ELSE                                                         06157001
061580         MOVE 'N'                TO ASC-HANGER-IND                06158001
061590                                    AHANGERI                      06159001
061600                                    AHANGERO                      06160001
061610     END-IF.                                                      06161001
061620     PERFORM 3102-GET-BUS-IND.                                    06162001
061630**  SLH 7/10/07  -  ADD FOR WMS                                   06163001
061640     MOVE ASC-COPER-UNT-ID TO PV-COPER-UNT-ID.                    06164001
061650     PERFORM 8010-CHECK-TKRPRPM.                                  06165001
061660     IF PS-ASNS-TO-WMS-YES                                        06166001
061670       IF ASC-OPER-UNT-ID-N NOT = ASC-COPER-UNT-ID                06167001
061680          IF XL071-E-BUS-IND = 'Y'                                06168001
061690** AHP - BEGIN - 04/07/08                                         06169001
061700              INITIALIZE PV-DB2-COUNT                             06170001
061710              PERFORM 3015-CHECK-FOR-REPURP                       06171001
061720              IF PV-DB2-COUNT > 0                                 06172001
061730                  MOVE PC-B               TO ASC-PKGNG-CDE        06173001
061740                                             APKGCDEO             06174001
061750                  MOVE PC-BULK-PACK       TO APKGDSCO             06175001
061760                  MOVE 'N'                TO ASC-PACK-BY-ST-IND   06176001
061770                                             APKBYSTO             06177001
061780              ELSE                                                06178001
061790                  PERFORM 3110-PBS-PKGNG-CDE                      06179001
061800              END-IF                                              06180001
061810          ELSE                                                    06181001
061820              PERFORM 3110-PBS-PKGNG-CDE                          06182001
061830          END-IF                                                  06183001
061840** AHP -  END - 04/07/09                                          06184001
061850       ELSE                                                       06185001
061860          PERFORM 3110-PBS-PKGNG-CDE                              06186001
061870       END-IF                                                     06187001
061880     ELSE                                                         06188001
061890        IF XL071-E-BUS-IND = 'Y'                                  06189001
061900** AHP - BEGIN - 04/07/08                                         06190001
061910            INITIALIZE PV-DB2-COUNT                               06191001
061920            PERFORM 3015-CHECK-FOR-REPURP                         06192001
061930            IF PV-DB2-COUNT > 0                                   06193001
061940                MOVE PC-B           TO ASC-PKGNG-CDE              06194001
061950                                       APKGCDEO                   06195001
061960                MOVE PC-BULK-PACK   TO APKGDSCO                   06196001
061970                MOVE 'N'            TO ASC-PACK-BY-ST-IND         06197001
061980                                       APKBYSTO                   06198001
061990            ELSE                                                  06199001
062000                PERFORM 3110-PBS-PKGNG-CDE                        06200001
062010            END-IF                                                06201001
062020** AHP -  END - 04/07/08                                          06202001
062030        ELSE                                                      06203001
062040            PERFORM 3110-PBS-PKGNG-CDE                            06204001
062050        END-IF                                                    06205001
062060     END-IF.                                                      06206001
062070                                                                  06207001
062230     PERFORM 4040-GET-ENT-NAME-DESC.                              06223001
062240     MOVE ASC-ENT-NAME-DESC      TO AENTNMEO.                     06224001
062250     PERFORM 4045-GET-FRCST-IND.                                  06225001
062260                                                                  06226001
062270     PERFORM 4090-GET-AD-DATE.                                    06227001
062280     MOVE ASC-AD-DTE             TO AADDTEO.                      06228001
062290                                                                  06229001
062300     IF  ASC-AD-DTE > SPACES                                      06230001
062310         MOVE DP015-YELLOW       TO AADDTEC                       06231001
062320     END-IF.                                                      06232001
062330                                                                  06233001
062340     MOVE ASC-DEPT-NBR           TO DK-DEPT-NBR.                  06234001
062350     PERFORM 3120-GET-OPER-SET-INFO.                              06235001
062360     PERFORM 4110-SELECT-TRECITM.                                 06236001
062370     MOVE ASC-TKT-DESC           TO ATKTTYPO.                     06237001
062380                                                                  06238001
062390 3102-GET-BUS-IND.                                                06239001
062400* JAK 06/2007 - GET THE CURRENT OPER UNT ID AND USE IT IN PLACE   06240001
062410*               OF ASC-OPER-UNT-ID IN THIS PARAGRAPH              06241001
062420* SLH  - COMENTED OUT JAK CODE                                    06242001
062430*    PERFORM 3104-GET-CURR-OPER-ID.                               06243001
062440*    INITIALIZE XL071-COMMAREA-REC.                               06244001
062450*    IF RECEIV-CURR-OPER-UNT-ID = ZEROES                          06245001
062460*        CONTINUE                                                 06246001
062470*    ELSE                                                         06247001
062480*        MOVE RECEIV-CURR-OPER-UNT-ID TO PV-TEMP-OPER-UNT         06248001
062490*        MOVE PV-TEMP-OPER-UNT      TO XL071-LOCATION-NUMBER      06249001
062500*        PERFORM 3103-CALL-XLKUT071                               06250001
062510*    END-IF.                                                      06251001
062520     INITIALIZE XL071-COMMAREA-REC.                               06252001
062530     IF  ASC-ADD-PENDING                                          06253001
062540         IF  ASC-OPER-UNT-ID = (SPACES OR ZEROES)                 06254001
062550             CONTINUE                                             06255001
062560         ELSE                                                     06256001
062570             MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD     06257001
062580             MOVE LENGTH OF ASC-OPER-UNT-ID                       06258001
062590                                     TO DP010I-MAXIMUM-DIGITS     06259001
062600             MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS   06260001
062610             SET DP010I-NEGATIVE-NOT-ALLOWED                      06261001
062620                                     TO TRUE                      06262001
062630             CALL DP010I-NUMERIC-EDIT-ROUTINE                     06263034
062631                  USING DP010I-NUMERIC-EDIT-AREA                  06263134
062640             IF  DP010I-ERROR-DETECTED                            06264001
062650                 CONTINUE                                         06265001
062660             ELSE                                                 06266001
062670                 MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-OPER-UNT    06267001
062680                 MOVE PV-TEMP-OPER-UNT                            06268001
062690                                    TO XL071-LOCATION-NUMBER      06269001
062700                 PERFORM 3103-CALL-XLKUT071                       06270001
062710             END-IF                                               06271001
062720         END-IF                                                   06272001
062730     ELSE                                                         06273001
062740         MOVE DK-OPER-UNT-ID        TO XL071-LOCATION-NUMBER      06274001
062750         PERFORM 3103-CALL-XLKUT071                               06275001
062760     END-IF.                                                      06276001
062770                                                                  06277001
062780 3103-CALL-XLKUT071.                                              06278001
062790     CALL XL071-LOCATION-MODULE  USING  DFHEIBLK                  06279001
062800                                        XL071-COMMAREA            06280001
062810                                        XL071-COMMAREA-REC.       06281001
062820     EVALUATE TRUE                                                06282001
062830         WHEN XL071-NO-ERRORS                                     06283001
062840         WHEN XL071-LOC-NOT-FOUND                                 06284001
062850         WHEN XL071-DC-ASGMT-NOT-FND                              06285001
062860             CONTINUE                                             06286001
062870         WHEN OTHER                                               06287008
062880              MOVE '3103-CALL-XLKUT071'                           06288001
062890                                     TO DP013-PARAGRAPH           06289001
062900              MOVE 'UNSUCCESSFUL SELECT ON XLT_LOC TABLE'         06290001
062910                                     TO DP013-MESSAGE-TEXT (1)    06291001
062920              MOVE XL071-SQLCA       TO DP013-SQLCA               06292001
062930              MOVE 'XLT_LOC '        TO DP013-DB2-TABLE-NAME (1)  06293001
062940              SET DP013-DB2-ABEND                                 06294001
062950                         DP013-XCTL-DISPLAY-RESTART               06295001
062960                                     TO TRUE                      06296001
062970              PERFORM DP013-0000-PROCESS-ABEND                    06297001
062980     END-EVALUATE.                                                06298001
062990                                                                  06299001
063000* JAK 06/2007 - ADD PARAGRAPH TO GET THE CURRENT OPER UNIT ID     06300001
063010* GET THE CURRENT OPER ID                                         06301001
063020 3104-GET-CURR-OPER-ID.                                           06302001
063030                                                                  06303001
063040     PERFORM                                                      06304001
063050         WITH TEST AFTER                                          06305001
063060         VARYING PV-RETRY-COUNTER                                 06306001
063070         FROM 1 BY 1                                              06307001
063080         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06308001
063090                   OR (SQLCODE = +0)                              06309001
063100                   OR (SQLCODE = +100))                           06310001
063110                                                                  06311001
063120         EXEC SQL                                                 06312001
063130              SELECT CURR_OPER_UNT_ID                             06313001
063140                INTO :RECEIV-CURR-OPER-UNT-ID                     06314001
063150                FROM TRECEIV                                      06315001
063160               WHERE ORD_NBR        = :DK-ORD-NBR                 06316001
063170                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             06317001
063180                 AND VER_STATUS_CDE = 'A'                         06318001
063190         END-EXEC                                                 06319001
063200                                                                  06320001
063210         EVALUATE TRUE                                            06321001
063220             WHEN SQLCODE = +0                                    06322001
063230             WHEN SQLCODE = +100                                  06323001
063240             WHEN SQLCODE = -811                                  06324001
063250             WHEN SQLCODE = -904                                  06325001
063260             WHEN SQLCODE = -913                                  06326001
063270                 CONTINUE                                         06327001
063280                                                                  06328001
063290             WHEN SQLWARN0 NOT = SPACES                           06329001
063300             WHEN SQLCODE < +0                                    06330001
063310             WHEN SQLCODE > +0                                    06331001
063320                 MOVE '3104-GET-CURR-OPER-ID'                     06332001
063330                                 TO DP013-PARAGRAPH               06333001
063340                 MOVE 'SELECT OPERATION SET ID'                   06334001
063350                                 TO DP013-MESSAGE-TEXT (1)        06335001
063360                 MOVE SQLCA      TO DP013-SQLCA                   06336001
063370                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      06337001
063380                 SET DP013-DB2-ABEND                              06338001
063390                                 TO TRUE                          06339001
063400                 SET DP013-XCTL-DISPLAY-RESTART                   06340001
063410                                 TO TRUE                          06341001
063420                 PERFORM DP013-0000-PROCESS-ABEND                 06342001
063430         END-EVALUATE                                             06343001
063440     END-PERFORM.                                                 06344001
063450                                                                  06345001
063460     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06346001
063470             AND (SQLCODE = -904 OR -913)                         06347001
063480         MOVE '3104-GET-CURR-OPER-ID'                             06348001
063490                                 TO DP013-PARAGRAPH               06349001
063500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     06350001
063510                                 TO DP013-MESSAGE-TEXT (1)        06351001
063520         MOVE 'ON TRECEIV    '   TO DP013-MESSAGE-TEXT (2)        06352001
063530         MOVE SQLCA              TO DP013-SQLCA                   06353001
063540         MOVE 'TRECEIV'          TO DP013-DB2-TABLE-NAME (1)      06354001
063550         SET DP013-DB2-ABEND     TO TRUE                          06355001
063560         SET DP013-XCTL-DISPLAY-RESTART                           06356001
063570                                 TO TRUE                          06357001
063580         PERFORM DP013-0000-PROCESS-ABEND                         06358001
063590     END-IF.                                                      06359001
063600                                                                  06360001
063610/                                                                 06361001
063620  3110-PBS-PKGNG-CDE.                                             06362001
063630     INITIALIZE PV-DB2-COUNT.                                     06363001
063640     MOVE 4                      TO DK-AGRMT-TYP-ID.              06364001
063650     MOVE 4                      TO DK-TYP-CDE.                   06365001
063660                                                                  06366001
063670     PERFORM 3140-CHECK-PO-SERVICE-INFO.                          06367001
063680                                                                  06368001
063690     IF  PV-DB2-COUNT > +0                                        06369001
063700         MOVE 'Y'                TO ASC-PACK-BY-ST-IND            06370001
063710                                    APKBYSTI                      06371001
063720                                    APKBYSTO                      06372001
063730     ELSE                                                         06373001
063740         MOVE 'N'                TO ASC-PACK-BY-ST-IND            06374001
063750                                    APKBYSTI                      06375001
063760                                    APKBYSTO                      06376001
063770     END-IF.                                                      06377001
063780                                                                  06378001
063790     IF  ASC-DIRECT-STORE                                         06379001
063800         MOVE 'Y'                TO ASC-PACK-BY-ST-IND            06380001
063810                                    APKBYSTI                      06381001
063820                                    APKBYSTO                      06382001
063830     END-IF.                                                      06383001
063840     IF ASC-PACK-BY-ST-IND = PC-N                                 06384001
063850         PERFORM 3160-DEFAULT-PACKAGING-CDE                       06385001
063860     END-IF.                                                      06386001
063870                                                                  06387001
063880/                                                                 06388001
063890 3120-GET-OPER-SET-INFO.                                          06389001
063900                                                                  06390001
063910                                                                  06391001
063920*  THIS IS THE OPER SET DEFAULT THAT IS ASSIGNED IN CNUDCLOC      06392001
063930*  BY OPER-UNIT, FACILTY, DEPT, AND CLASS.                        06393001
063940                                                                  06394001
063950     PERFORM 3125-GET-MIN-LNE-NBR.                                06395001
063960     INITIALIZE XL001-ITEM-COMMAREA                               06396001
063970     IF PS-CALL-API-YES                                           06397001
063980        PERFORM 3126-CALL-XLKUT001                                06398001
063990     END-IF                                                       06399001
064000                                                                  06400001
064010     IF XL001-SUCCESSFUL                                          06401001
064020        PERFORM                                                   06402001
064030            WITH TEST AFTER                                       06403001
064040            VARYING PV-RETRY-COUNTER                              06404001
064050            FROM 1 BY 1                                           06405001
064060            UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)            06406001
064070                OR (SQLCODE = +0)                                 06407001
064080                OR (SQLCODE = +100))                              06408001
064090                                                                  06409001
064100            EXEC SQL                                              06410001
064110                 SELECT A.OPER_SET_ID                             06411001
064120                       ,A.CL_NBR                                  06412001
064130                       ,B.OPER_SET_DESC                           06413001
064140                   INTO :DCFAAS-OPER-SET-ID                       06414001
064150                       ,:DCFAAS-CL-NBR                            06415001
064160                       ,:OPRSET-OPER-SET-DESC                     06416001
064170                   FROM TDCFAAS A                                 06417001
064180                       ,TOPRSET B                                 06418001
064190                  WHERE A.OPER_UNT_ID       = :CURR-OPER-UNT-ID   06419001
064200                    AND A.FCLTY_ID          = :CURR-FCLTY-ID      06420001
064210*                   AND A.FCLTY_ID          = :DK-FCLTY-ID        06421001
064220                    AND A.DEPT_NBR          = :DK-DEPT-NBR        06422001
064230                    AND A.FCLTY_LOC_TYP_CDE = 'PA'                06423001
064240                    AND A.RANK_NBR          = 1                   06424001
064250                    AND B.VER_STATUS_CDE    = 'A'                 06425001
064260                    AND A.CL_NBR      = :XL001-SUB-CL-NBR-2CH     06426001
064270                    AND A.OPER_SET_ID = B.OPER_SET_ID             06427001
064280                    AND A.OPER_UNT_ID = B.OPER_UNT_ID             06428001
064290            END-EXEC                                              06429001
064300                                                                  06430001
064310            EVALUATE TRUE                                         06431001
064320                WHEN SQLCODE = +0                                 06432001
064330                WHEN SQLCODE = +100                               06433001
064340                WHEN SQLCODE = -904                               06434001
064350                WHEN SQLCODE = -913                               06435001
064360                     CONTINUE                                     06436001
064370                                                                  06437001
064380                WHEN SQLWARN0 NOT = SPACES                        06438001
064390                WHEN SQLCODE < +0                                 06439001
064400                WHEN SQLCODE > +0                                 06440001
064410                     MOVE '3120-GET-OPER-SET-INFO'                06441001
064420                                     TO DP013-PARAGRAPH           06442001
064430                     MOVE 'UNSUCCESSFUL SELECT ON TDCFAAS TABLE'  06443001
064440                                     TO DP013-MESSAGE-TEXT (1)    06444001
064450                     MOVE SQLCA      TO DP013-SQLCA               06445001
064460                     MOVE 'TDCFAAS ' TO DP013-DB2-TABLE-NAME (1)  06446001
064470                     MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (2)  06447001
064480                     SET DP013-DB2-ABEND                          06448001
064490                         DP013-XCTL-DISPLAY-RESTART               06449001
064500                                     TO TRUE                      06450001
064510                     PERFORM DP013-0000-PROCESS-ABEND             06451001
064520            END-EVALUATE                                          06452001
064530        END-PERFORM                                               06453001
064540                                                                  06454001
064550        IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                     06455001
064560                AND (SQLCODE = -904 OR -913)                      06456001
064570            MOVE '3120-GET-OPER-SET-INFO'  TO DP013-PARAGRAPH     06457001
064580            MOVE                                                  06458001
064590            'MAX RETRIES EXCEEDED ON FACILITY LOC ASSIGNMENTS'    06459001
064600                                     TO DP013-MESSAGE-TEXT (1)    06460001
064610            MOVE SQLCA               TO DP013-SQLCA               06461001
064620            MOVE 'TDCFAAS'           TO DP013-DB2-TABLE-NAME (1)  06462001
064630            MOVE 'TOPRSET'           TO DP013-DB2-TABLE-NAME (2)  06463001
064640            SET DP013-DB2-ABEND                                   06464001
064650                DP013-XCTL-DISPLAY-RESTART                        06465001
064660                                     TO TRUE                      06466001
064670            PERFORM DP013-0000-PROCESS-ABEND                      06467001
064680        END-IF                                                    06468001
064690     END-IF.                                                      06469001
064700                                                                  06470001
064710/                                                                 06471001
064720 3125-GET-MIN-LNE-NBR.                                            06472001
064730     INITIALIZE PS-CALL-API-SW                                    06473001
064740     PERFORM                                                      06474001
064750         WITH TEST AFTER                                          06475001
064760         VARYING PV-RETRY-COUNTER                                 06476001
064770         FROM 1 BY 1                                              06477001
064780         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06478001
064790             OR (SQLCODE = +0)                                    06479001
064800             OR (SQLCODE = +100))                                 06480001
064810                                                                  06481001
064820         EXEC SQL                                                 06482001
064830              SELECT                                              06483001
064840                     A.ITM_NBR                                    06484001
064850                INTO :PURITM-ITM-NBR                              06485001
064860                FROM TPURITM A                                    06486001
064870               WHERE A.PO_NBR        = :DK-PO-NBR                 06487001
064880                 AND A.VER_STATUS_CDE = 'A'                       06488001
064890                 AND A.PO_LNE_NBR =                               06489001
064900                   (SELECT MIN(B.PO_LNE_NBR)                      06490001
064910                      FROM TPURITM B                              06491001
064920                      WHERE B.PO_NBR = A.PO_NBR                   06492001
064930                        AND B.VER_STATUS_CDE = 'A'                06493001
064940                        AND B.STATUS_CDE IN ('AP','AC'))          06494001
064950         END-EXEC                                                 06495001
064960                                                                  06496001
064970         EVALUATE TRUE                                            06497001
064980             WHEN SQLCODE = +0                                    06498001
064990                  SET PS-CALL-API-YES TO TRUE                     06499001
065000                                                                  06500001
065010             WHEN SQLCODE = +100                                  06501001
065020             WHEN SQLCODE = -904                                  06502001
065030             WHEN SQLCODE = -913                                  06503001
065040                  CONTINUE                                        06504001
065050                                                                  06505001
065060             WHEN SQLWARN0 NOT = SPACES                           06506001
065070             WHEN SQLCODE < +0                                    06507001
065080             WHEN SQLCODE > +0                                    06508001
065090                  MOVE '3125-GET-MIN-LNE-NBR'                     06509001
065100                                  TO DP013-PARAGRAPH              06510001
065110                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM TABLE'     06511001
065120                                  TO DP013-MESSAGE-TEXT (1)       06512001
065130                  MOVE DK-PO-NBR  TO DP013-MESSAGE-TEXT (2)       06513001
065140                  MOVE SQLCA      TO DP013-SQLCA                  06514001
065150                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     06515001
065160                  SET DP013-DB2-ABEND                             06516001
065170                      DP013-XCTL-DISPLAY-RESTART                  06517001
065180                                  TO TRUE                         06518001
065190                  PERFORM DP013-0000-PROCESS-ABEND                06519001
065200         END-EVALUATE                                             06520001
065210     END-PERFORM.                                                 06521001
065220                                                                  06522001
065230     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06523001
065240             AND (SQLCODE = -904 OR -913)                         06524001
065250         MOVE '3125-GET-MIN-LNE-NBR'    TO DP013-PARAGRAPH        06525001
065260         MOVE 'MAX RETRIES EXCEEDED ON FACILITY LOC ASSIGNMENTS'  06526001
065270                                  TO DP013-MESSAGE-TEXT (1)       06527001
065280         MOVE SQLCA               TO DP013-SQLCA                  06528001
065290         MOVE 'TPURITM'           TO DP013-DB2-TABLE-NAME (1)     06529001
065300         SET DP013-DB2-ABEND                                      06530001
065310             DP013-XCTL-DISPLAY-RESTART                           06531001
065320                                  TO TRUE                         06532001
065330         PERFORM DP013-0000-PROCESS-ABEND                         06533001
065340     END-IF.                                                      06534001
065350                                                                  06535001
065360 3126-CALL-XLKUT001.                                              06536001
065370                                                                  06537001
065380     MOVE PURITM-ITM-NBR        TO XL001-KEY-ITM-NBR.             06538001
065390                                                                  06539001
065400     SET  XL001-BY-ITEM                                           06540001
065410          XL001-SELECT-VND-STYL TO TRUE.                          06541001
065420                                                                  06542001
065430     CALL XL001-VSM-PGM USING  DFHEIBLK                           06543001
065440                                      XL001-COMMAREA              06544001
065450                                      XL001-ITEM-COMMAREA.        06545001
065460     EVALUATE TRUE                                                06546001
065470                                                                  06547001
065480          WHEN XL001-SUCCESSFUL                                   06548001
065490              WHEN XL001-SKU-SQLCODE      =                       06549001
065500                             (0 OR +100 OR -904 OR -913)          06550001
065510              WHEN XL001-VND-STYL-SQLCODE =                       06551001
065520                             (0 OR +100 OR -904 OR -913)          06552001
065530                  CONTINUE                                        06553001
065540                                                                  06554001
065550              WHEN OTHER                                          06555001
065560                  MOVE '3126-CALL-XLKUT001'                       06556001
065570                                 TO DP013-PARAGRAPH               06557001
065580                  MOVE 'UNSUCCESSFUL SELECT OF SUB CLASS'         06558001
065590                                 TO DP013-MESSAGE-TEXT (1)        06559001
065600                  MOVE XL001-VND-STYL-SQLCODE                     06560001
065610                                 TO SQLCODE                       06561001
065620                  MOVE SQLCA     TO DP013-SQLCA                   06562001
065630                  MOVE 'SKU VEND' TO DP013-DB2-TABLE-NAME (1)     06563001
065640                  SET DP013-DB2-ABEND                             06564001
065650                      DP013-XCTL-DISPLAY-RESTART                  06565001
065660                                 TO TRUE                          06566001
065670                  PERFORM DP013-0000-PROCESS-ABEND                06567001
065680             END-EVALUATE.                                        06568001
065690*----------------------------------------------------------------*06569001
065700*    CHECK TO SEE WHAT TYPES OF SERVICES THIS PO HAS             *06570001
065710*----------------------------------------------------------------*06571001
065720 3140-CHECK-PO-SERVICE-INFO.                                      06572001
065730                                                                  06573001
065740     PERFORM                                                      06574001
065750         WITH TEST AFTER                                          06575001
065760         VARYING PV-RETRY-COUNTER                                 06576001
065770         FROM 1 BY 1                                              06577001
065780         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06578001
065790             OR (SQLCODE = +0)                                    06579001
065800             OR (SQLCODE = +100))                                 06580001
065810                                                                  06581001
065820         EXEC SQL                                                 06582001
065830              SELECT COUNT(*)                                     06583001
065840                INTO :PV-DB2-COUNT                                06584001
065850                FROM TPOAGMT                                      06585001
065860               WHERE PO_NBR         = :DK-PO-NBR                  06586001
065870                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            06587001
065880                 AND VER_STATUS_CDE = 'A'                         06588001
065890                 AND TYP_CDE        = :DK-TYP-CDE                 06589001
065900         END-EXEC                                                 06590001
065910                                                                  06591001
065920         EVALUATE TRUE                                            06592001
065930             WHEN SQLCODE = +0                                    06593001
065940             WHEN SQLCODE = +100                                  06594001
065950             WHEN SQLCODE = -904                                  06595001
065960             WHEN SQLCODE = -913                                  06596001
065970                  CONTINUE                                        06597001
065980                                                                  06598001
065990             WHEN SQLWARN0 NOT = SPACES                           06599001
066000             WHEN SQLCODE < +0                                    06600001
066010             WHEN SQLCODE > +0                                    06601001
066020                  MOVE '3140-CHECK-PO-SERVICE-INFO'               06602001
066030                                  TO DP013-PARAGRAPH              06603001
066040                  MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'   06604001
066050                                  TO DP013-MESSAGE-TEXT (1)       06605001
066060                  MOVE SQLCA      TO DP013-SQLCA                  06606001
066070                  MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)     06607001
066080                  SET DP013-DB2-ABEND                             06608001
066090                      DP013-XCTL-DISPLAY-RESTART                  06609001
066100                                  TO TRUE                         06610001
066110                  PERFORM DP013-0000-PROCESS-ABEND                06611001
066120         END-EVALUATE                                             06612001
066130     END-PERFORM.                                                 06613001
066140                                                                  06614001
066150     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06615001
066160             AND (SQLCODE = -904 OR -913)                         06616001
066170         MOVE '3140-CHECK-PO-SERVICE-INFO'                        06617001
066180                                  TO DP013-PARAGRAPH              06618001
066190         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE AGREEMENT' 06619001
066200                                  TO DP013-MESSAGE-TEXT (1)       06620001
066210         MOVE SQLCA               TO DP013-SQLCA                  06621001
066220         MOVE 'TPOAGMT '          TO DP013-DB2-TABLE-NAME (1)     06622001
066230         SET DP013-DB2-ABEND                                      06623001
066240             DP013-XCTL-DISPLAY-RESTART                           06624001
066250                                  TO TRUE                         06625001
066260         PERFORM DP013-0000-PROCESS-ABEND                         06626001
066270     END-IF.                                                      06627001
066280                                                                  06628001
066290/                                                                 06629001
066300*----------------------------------------------------------------*06630001
066310*    CHECK TO SEE IF RCVR NBR IS UNIQUE                          *06631001
066320*----------------------------------------------------------------*06632001
066330 3150-CHECK-DUPL-RCVR-NBR.                                        06633001
066340                                                                  06634001
066350     PERFORM                                                      06635001
066360         WITH TEST AFTER                                          06636001
066370         VARYING PV-RETRY-COUNTER                                 06637001
066380         FROM 1 BY 1                                              06638001
066390         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06639001
066400             OR (SQLCODE = +0)                                    06640001
066410             OR (SQLCODE = +100))                                 06641001
066420                                                                  06642001
066430         EXEC SQL                                                 06643001
066440              SELECT COUNT(*)                                     06644001
066450                INTO :PV-DB2-COUNT                                06645001
066460                FROM TRECEIV                                      06646001
066470               WHERE RCVR_NBR = :DK-RCVR-NBR                      06647001
066480         END-EXEC                                                 06648001
066490                                                                  06649001
066500         EVALUATE TRUE                                            06650001
066510             WHEN SQLCODE = +0                                    06651001
066520             WHEN SQLCODE = +100                                  06652001
066530             WHEN SQLCODE = -904                                  06653001
066540             WHEN SQLCODE = -913                                  06654001
066550                  CONTINUE                                        06655001
066560*SH FOR TEST      INITIALIZE PV-CICS-MSG-DATA2                    06656001
066570*                 MOVE DK-RCVR-NBR TO PV-DISPLAY-RCVR             06657001
066580*                 MOVE PV-DB2-COUNT TO PV-DISPLAY-COUNT           06658001
066590*                 MOVE SQLCODE      TO PV-DISPLAY-SQLCODE         06659001
066600*                 STRING 'RCKCS221- ' DELIMITED BY SIZE           06660001
066610*                        'PO NBR '    DELIMITED BY SIZE           06661001
066620*                 ASC-PO-NBR          DELIMITED BY SIZE           06662001
066630*                        'RCVR NBR ' DELIMITED BY SIZE            06663001
066640*                 PV-DISPLAY-RCVR     DELIMITED BY SIZE           06664001
066650*                        ' DB2 COUNT ' DELIMITED BY SIZE          06665001
066660*                 PV-DISPLAY-COUNT    DELIMITED BY SIZE           06666001
066670*                        ' SQLCODE = ' DELIMITED BY SIZE          06667001
066680*                 PV-DISPLAY-COUNT    DELIMITED BY SIZE           06668001
066690*                                 INTO PV-CICS-MSG-DATA2          06669001
066700*                 MOVE PV-CICS-MSG-HOLD2                          06670001
066710*                                 TO PV-CICS-MSG-AREA2            06671001
066720*                 MOVE LENGTH OF PV-CICS-MSG-AREA2 TO             06672001
066730*                                 PV-COMMAREA-LENGTH              06673001
066740*                 EXEC CICS                                       06674001
066750*                   WRITEQ TD                                     06675001
066760*                       QUEUE ('CSSL')                            06676001
066770*                       FROM  (PV-CICS-MSG-AREA2)                 06677001
066780*                       LENGTH (PV-COMMAREA-LENGTH)               06678001
066790*                       RESP  (PV-CICS-RESP)                      06679001
066800*                 END-EXEC                                        06680001
066810                                                                  06681001
066820             WHEN SQLWARN0 NOT = SPACES                           06682001
066830             WHEN SQLCODE < +0                                    06683001
066840             WHEN SQLCODE > +0                                    06684001
066850                  MOVE '3150-CHECK-DUPL-RCVR-NBR  '               06685001
066860                                  TO DP013-PARAGRAPH              06686001
066870                  MOVE 'UNSUCCESSFUL SELECT RCVR NBR '            06687001
066880                                  TO DP013-MESSAGE-TEXT (1)       06688001
066890                  MOVE SQLCA      TO DP013-SQLCA                  06689001
066900                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     06690001
066910                  SET DP013-DB2-ABEND                             06691001
066920                      DP013-XCTL-DISPLAY-RESTART                  06692001
066930                                  TO TRUE                         06693001
066940                  PERFORM DP013-0000-PROCESS-ABEND                06694001
066950         END-EVALUATE                                             06695001
066960     END-PERFORM.                                                 06696001
066970                                                                  06697001
066980     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06698001
066990             AND (SQLCODE = -904 OR -913)                         06699001
067000         MOVE '3150-CHECK-DUPL-RCVR-NBR  '                        06700001
067010                                  TO DP013-PARAGRAPH              06701001
067020         MOVE 'MAX RETRIES EXCEEDED ON SELECT RCVR NBR '          06702001
067030                                  TO DP013-MESSAGE-TEXT (1)       06703001
067040         MOVE SQLCA               TO DP013-SQLCA                  06704001
067050         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     06705001
067060         SET DP013-DB2-ABEND                                      06706001
067070             DP013-XCTL-DISPLAY-RESTART                           06707001
067080                                  TO TRUE                         06708001
067090         PERFORM DP013-0000-PROCESS-ABEND                         06709001
067100     END-IF.                                                      06710001
067110                                                                  06711001
067120     IF SQLCODE = +0 AND                                          06712001
067130        PV-DB2-COUNT = +0                                         06713001
067140         SET PS-NO-RCVR-FOUND TO TRUE                             06714001
067150     END-IF.                                                      06715001
067160                                                                  06716001
067170 3160-DEFAULT-PACKAGING-CDE.                                      06717001
067180     IF ASC-ADD-PENDING                                           06718001
067190         PERFORM 3162-PKGNG-CDE-FROM-PO                           06719001
067200     ELSE                                                         06720001
067210         PERFORM 3164-PKGNG-CDE-FROM-RC                           06721001
067220     END-IF.                                                      06722001
067230                                                                  06723001
067240 3162-PKGNG-CDE-FROM-PO.                                          06724001
067250     PERFORM                                                      06725001
067260         WITH TEST AFTER                                          06726001
067270         VARYING PV-RETRY-COUNTER                                 06727001
067280         FROM 1 BY 1                                              06728001
067290         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06729001
067300             OR (SQLCODE = +0)                                    06730001
067310             OR (SQLCODE = +100))                                 06731001
067320                                                                  06732001
067330         EXEC SQL                                                 06733001
067340              SELECT PKGNG_CDE                                    06734001
067350                INTO :PURCHS-PKGNG-CDE                            06735001
067360                FROM TPURCHS A                                    06736001
067370               WHERE PO_NBR         = :DK-PO-NBR                  06737001
067380                 AND VER_STATUS_CDE = 'A'                         06738001
067390         END-EXEC                                                 06739001
067400                                                                  06740001
067410         EVALUATE TRUE                                            06741001
067420             WHEN SQLCODE = +0                                    06742001
067430                  MOVE PURCHS-PKGNG-CDE                           06743001
067440                                  TO ASC-PKGNG-CDE                06744001
067450                                                                  06745001
067460             WHEN SQLCODE = +100                                  06746001
067470                  MOVE SPACES     TO ASC-PKGNG-CDE                06747001
067480                                                                  06748001
067490             WHEN SQLCODE = -904                                  06749001
067500             WHEN SQLCODE = -913                                  06750001
067510                  CONTINUE                                        06751001
067520                                                                  06752001
067530             WHEN SQLWARN0 NOT = SPACES                           06753001
067540             WHEN SQLCODE < +0                                    06754001
067550             WHEN SQLCODE > +0                                    06755001
067560                  MOVE '3162-PKGNG-CDE-FROM-PO'                   06756001
067570                                  TO DP013-PARAGRAPH              06757001
067580                  MOVE 'UNSUCCESSFUL SELECT PKGNG-CDE'            06758001
067590                                  TO DP013-MESSAGE-TEXT (1)       06759001
067600                  MOVE SQLCA      TO DP013-SQLCA                  06760001
067610                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     06761001
067620                  SET DP013-DB2-ABEND                             06762001
067630                      DP013-XCTL-DISPLAY-RESTART                  06763001
067640                                  TO TRUE                         06764001
067650                  PERFORM DP013-0000-PROCESS-ABEND                06765001
067660         END-EVALUATE                                             06766001
067670     END-PERFORM.                                                 06767001
067680                                                                  06768001
067690     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06769001
067700             AND (SQLCODE = -904 OR -913)                         06770001
067710         MOVE '3162-PKGNG-CDE-FROM-PO'                            06771001
067720                                  TO DP013-PARAGRAPH              06772001
067730         MOVE 'MAX RETRIES EXCEEDED ON SELECT PKGNG-CDE'          06773001
067740                                  TO DP013-MESSAGE-TEXT (1)       06774001
067750         MOVE SQLCA               TO DP013-SQLCA                  06775001
067760         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     06776001
067770         SET DP013-DB2-ABEND                                      06777001
067780             DP013-XCTL-DISPLAY-RESTART                           06778001
067790                                  TO TRUE                         06779001
067800         PERFORM DP013-0000-PROCESS-ABEND                         06780001
067810     END-IF.                                                      06781001
067820                                                                  06782001
067830 3164-PKGNG-CDE-FROM-RC.                                          06783001
067840     PERFORM                                                      06784001
067850         WITH TEST AFTER                                          06785001
067860         VARYING PV-RETRY-COUNTER                                 06786001
067870         FROM 1 BY 1                                              06787001
067880         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06788001
067890             OR (SQLCODE = +0)                                    06789001
067900             OR (SQLCODE = +100))                                 06790001
067910                                                                  06791001
067920         EXEC SQL                                                 06792001
067930              SELECT PKGNG_CDE                                    06793001
067940                INTO :RECEIV-PKGNG-CDE                            06794001
067950                FROM TRECEIV A                                    06795001
067960               WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                06796001
067970                 AND FCLTY_ID    = :DK-FCLTY-ID                   06797001
067980                 AND ORD_NBR     = :DK-PO-NBR                     06798001
067990                 AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                06799001
068000                 AND VER_STATUS_CDE = 'A'                         06800001
068010         END-EXEC                                                 06801001
068020                                                                  06802001
068030         EVALUATE TRUE                                            06803001
068040             WHEN SQLCODE = +0                                    06804001
068050                  MOVE RECEIV-PKGNG-CDE                           06805001
068060                                  TO ASC-PKGNG-CDE                06806001
068070                                                                  06807001
068080             WHEN SQLCODE = +100                                  06808001
068090                  MOVE LOW-VALUES TO ASC-PKGNG-CDE                06809001
068100                                                                  06810001
068110             WHEN SQLCODE = -904                                  06811001
068120             WHEN SQLCODE = -913                                  06812001
068130                  CONTINUE                                        06813001
068140                                                                  06814001
068150             WHEN SQLWARN0 NOT = SPACES                           06815001
068160             WHEN SQLCODE < +0                                    06816001
068170             WHEN SQLCODE > +0                                    06817001
068180                  MOVE '3164-PKGNG-CDE-FROM-RC'                   06818001
068190                                  TO DP013-PARAGRAPH              06819001
068200                  MOVE 'UNSUCCESSFUL SELECT PKGNG-CDE'            06820001
068210                                  TO DP013-MESSAGE-TEXT (1)       06821001
068220                  MOVE SQLCA      TO DP013-SQLCA                  06822001
068230                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     06823001
068240                  SET DP013-DB2-ABEND                             06824001
068250                      DP013-XCTL-DISPLAY-RESTART                  06825001
068260                                  TO TRUE                         06826001
068270                  PERFORM DP013-0000-PROCESS-ABEND                06827001
068280         END-EVALUATE                                             06828001
068290     END-PERFORM.                                                 06829001
068300                                                                  06830001
068310     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06831001
068320             AND (SQLCODE = -904 OR -913)                         06832001
068330         MOVE '3164-PKGNG-CDE-FROM-RC'                            06833001
068340                                  TO DP013-PARAGRAPH              06834001
068350         MOVE 'MAX RETRIES EXCEEDED ON SELECT PKGNG-CDE'          06835001
068360                                  TO DP013-MESSAGE-TEXT (1)       06836001
068370         MOVE SQLCA               TO DP013-SQLCA                  06837001
068380         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     06838001
068390         SET DP013-DB2-ABEND                                      06839001
068400             DP013-XCTL-DISPLAY-RESTART                           06840001
068410                                  TO TRUE                         06841001
068420         PERFORM DP013-0000-PROCESS-ABEND                         06842001
068430     END-IF.                                                      06843001
068440/                                                                 06844001
068450 3165-PO-TYPE.                                                    06845001
068460     PERFORM                                                      06846001
068470         WITH TEST AFTER                                          06847001
068480         VARYING PV-RETRY-COUNTER                                 06848001
068490         FROM 1 BY 1                                              06849001
068500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06850001
068510             OR (SQLCODE = +0)                                    06851001
068520             OR (SQLCODE = +100))                                 06852001
068530                                                                  06853001
068540         EXEC SQL                                                 06854001
068550              SELECT PO_TYP_CDE                                   06855001
068560                INTO :PURCHS-PO-TYP-CDE                           06856001
068570                FROM TPURCHS A                                    06857001
068580               WHERE PO_NBR         = :DK-PO-NBR                  06858001
068590                 AND VER_STATUS_CDE = 'A'                         06859001
068600         END-EXEC                                                 06860001
068610                                                                  06861001
068620         EVALUATE TRUE                                            06862001
068630             WHEN SQLCODE = +0                                    06863001
068640                  MOVE PURCHS-PO-TYP-CDE                          06864001
068650                                  TO ASC-PO-TYPE                  06865001
068660                                                                  06866001
068670             WHEN SQLCODE = +100                                  06867001
068680                  MOVE SPACES     TO ASC-PO-TYPE                  06868001
068690                                                                  06869001
068700             WHEN SQLCODE = -904                                  06870001
068710             WHEN SQLCODE = -913                                  06871001
068720                  CONTINUE                                        06872001
068730                                                                  06873001
068740             WHEN SQLWARN0 NOT = SPACES                           06874001
068750             WHEN SQLCODE < +0                                    06875001
068760             WHEN SQLCODE > +0                                    06876001
068770                  MOVE '3165-PO-TYPE'                             06877001
068780                                  TO DP013-PARAGRAPH              06878001
068790                  MOVE 'UNSUCCESSFUL SELECT PO TYPE  '            06879001
068800                                  TO DP013-MESSAGE-TEXT (1)       06880001
068810                  MOVE SQLCA      TO DP013-SQLCA                  06881001
068820                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     06882001
068830                  SET DP013-DB2-ABEND                             06883001
068840                      DP013-XCTL-DISPLAY-RESTART                  06884001
068850                                  TO TRUE                         06885001
068860                  PERFORM DP013-0000-PROCESS-ABEND                06886001
068870         END-EVALUATE                                             06887001
068880     END-PERFORM.                                                 06888001
068890                                                                  06889001
068900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06890001
068910             AND (SQLCODE = -904 OR -913)                         06891001
068920         MOVE '3165-PO-TYPE'                                      06892001
068930                                  TO DP013-PARAGRAPH              06893001
068940         MOVE 'MAX RETRIES EXCEEDED ON SELECT PKGNG-CDE'          06894001
068950                                  TO DP013-MESSAGE-TEXT (1)       06895001
068960         MOVE SQLCA               TO DP013-SQLCA                  06896001
068970         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     06897001
068980         SET DP013-DB2-ABEND                                      06898001
068990             DP013-XCTL-DISPLAY-RESTART                           06899001
069000                                  TO TRUE                         06900001
069010         PERFORM DP013-0000-PROCESS-ABEND                         06901001
069020     END-IF.                                                      06902001
069030/                                                                 06903001
069040 3170-CHECK-ANY-VERIFIED.                                         06904001
069050     PERFORM                                                      06905001
069060         WITH TEST AFTER                                          06906001
069070         VARYING PV-RETRY-COUNTER                                 06907001
069080         FROM 1 BY 1                                              06908001
069090         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06909001
069100             OR (SQLCODE = +0)                                    06910001
069110             OR (SQLCODE = +100))                                 06911001
069120                                                                  06912001
069130         EXEC SQL                                                 06913001
069140             SELECT COUNT(*)                                      06914001
069150                INTO  :PV-DB2-COUNT                               06915001
069160             FROM TRECITM                                         06916001
069170             WHERE ORD_NBR      = :DK-PO-NBR                      06917001
069180               AND REC_SEQ_NBR  = :DK-REC-SEQ-NBR                 06918001
069190               AND STATUS_CDE  IN ('VE','CM')                     06919001
069200         END-EXEC                                                 06920001
069210                                                                  06921001
069220         EVALUATE TRUE                                            06922001
069230             WHEN SQLCODE = +0                                    06923001
069240             WHEN SQLCODE = +100                                  06924001
069250             WHEN SQLCODE = -904                                  06925001
069260             WHEN SQLCODE = -913                                  06926001
069270                 CONTINUE                                         06927001
069280             WHEN SQLWARN0  NOT = SPACES                          06928001
069290             WHEN SQLCODE < +0                                    06929001
069300             WHEN SQLCODE > +0                                    06930001
069310                 MOVE '3170-CHECK-ANY-VERIFIED'                   06931001
069320                                  TO DP013-PARAGRAPH              06932001
069330                 MOVE 'SELECT A TRECITM ROW'                      06933001
069340                                  TO DP013-MESSAGE-TEXT (1)       06934001
069350                 MOVE SQLCA       TO DP013-SQLCA                  06935001
069360                 MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)     06936001
069370                 SET DP013-DB2-ABEND                              06937001
069380                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06938001
069390                 PERFORM DP013-0000-PROCESS-ABEND                 06939001
069400         END-EVALUATE                                             06940001
069410     END-PERFORM.                                                 06941001
069420                                                                  06942001
069430/                                                                 06943001
069440 3175-CHECK-ALL-INACT.                                            06944001
069450     PERFORM                                                      06945001
069460         WITH TEST AFTER                                          06946001
069470         VARYING PV-RETRY-COUNTER                                 06947001
069480         FROM 1 BY 1                                              06948001
069490         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06949001
069500             OR (SQLCODE = +0)                                    06950001
069510             OR (SQLCODE = +100))                                 06951001
069520                                                                  06952001
069530         EXEC SQL                                                 06953001
069540             SELECT COUNT(*)                                      06954001
069550                 INTO :PV-DB2-COUNT                               06955001
069560             FROM TRECITM                                         06956001
069570             WHERE ORD_NBR     = :DK-PO-NBR                       06957001
069580               AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                  06958001
069590               AND VER_STATUS_CDE ^= 'I'                          06959001
069600         END-EXEC                                                 06960001
069610                                                                  06961001
069620         EVALUATE TRUE                                            06962001
069630             WHEN SQLCODE = +0                                    06963001
069640             WHEN SQLCODE = +100                                  06964001
069650             WHEN SQLCODE = -904                                  06965001
069660             WHEN SQLCODE = -913                                  06966001
069670                 CONTINUE                                         06967001
069680             WHEN SQLWARN0 NOT = SPACES                           06968001
069690             WHEN SQLCODE < +0                                    06969001
069700             WHEN SQLCODE > +0                                    06970001
069710                 MOVE '3175-CHECK-ALL-INACT'                      06971001
069720                            TO DP013-PARAGRAPH                    06972001
069730                 MOVE 'SELECT A TRECITM ROW'                      06973001
069740                            TO DP013-MESSAGE-TEXT (1)             06974001
069750                 MOVE SQLCA TO DP013-SQLCA                        06975001
069760                 MOVE 'TRECITM'                                   06976001
069770                            TO DP013-DB2-TABLE-NAME (1)           06977001
069780                 SET DP013-DB2-ABEND                              06978001
069790                     DP013-XCTL-DISPLAY-RESTART TO TRUE           06979001
069800                 PERFORM DP013-0000-PROCESS-ABEND                 06980001
069810             END-EVALUATE                                         06981001
069820     END-PERFORM.                                                 06982001
069830/                                                                 06983001
069840 3180-CHECK-ANY-ACT-INPROC.                                       06984001
069850     PERFORM                                                      06985001
069860         WITH TEST AFTER                                          06986001
069870         VARYING PV-RETRY-COUNTER                                 06987001
069880         FROM 1 BY 1                                              06988001
069890         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06989001
069900             OR (SQLCODE = +0)                                    06990001
069910             OR (SQLCODE = +100))                                 06991001
069920                                                                  06992001
069930         EXEC SQL                                                 06993001
069940             SELECT COUNT(*)                                      06994001
069950                 INTO  :PV-DB2-COUNT                              06995001
069960             FROM  TRECITM                                        06996001
069970             WHERE ORD_NBR        = :DK-PO-NBR                    06997001
069980               AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR               06998001
069990               AND VER_STATUS_CDE = 'A'                           06999001
070000               AND STATUS_CDE     = 'IP'                          07000001
070010         END-EXEC                                                 07001001
070020                                                                  07002001
070030         EVALUATE TRUE                                            07003001
070040             WHEN SQLCODE = +0                                    07004001
070050             WHEN SQLCODE = +100                                  07005001
070060             WHEN SQLCODE = -904                                  07006001
070070             WHEN SQLCODE = -913                                  07007001
070080                 CONTINUE                                         07008001
070090             WHEN SQLWARN0 NOT = SPACES                           07009001
070100             WHEN SQLCODE < +0                                    07010001
070110             WHEN SQLCODE > +0                                    07011001
070120                 MOVE '3180-CHECK-ANY-ACT-INPROC'                 07012001
070130                              TO DP013-PARAGRAPH                  07013001
070140                 MOVE 'SELECT A TRECITM ROW'                      07014001
070150                              TO DP013-MESSAGE-TEXT (1)           07015001
070160                 MOVE SQLCA   TO DP013-SQLCA                      07016001
070170                 MOVE 'TRECITM' TO DP013-DB2-TABLE-NAME (1)       07017001
070180                 SET DP013-DB2-ABEND                              07018001
070190                     DP013-XCTL-DISPLAY-RESTART                   07019001
070200                                TO TRUE                           07020001
070210                 PERFORM DP013-0000-PROCESS-ABEND                 07021001
070220         END-EVALUATE                                             07022001
070230     END-PERFORM.                                                 07023001
070240                                                                  07024001
070250 3200-RESET-ATTRIBUTES.                                           07025001
070260                                                                  07026001
070270     MOVE DP015-PRO-NOR-OFF       TO ARECSEQA                     07027001
070280                                     APONBRA                      07028001
070290                                     ATBLSTA                      07029001
070300                                     AENTNMEA                     07030001
070310                                     ASCACA                       07031001
070320                                     ATRLRA                       07032001
070330                                     APROA                        07033001
070340                                     ASHPDTA                      07034001
070350                                     AARVDTA                      07035001
070360                                     AOPERA                       07036001
070370                                     AFCLTYA                      07037001
070380                                     AVNSHDTA                     07038001
070390                                     ACREUIDA                     07039001
070420* WR40574 02-15-2012 START CLT                                    07042001
070430                                     ACANA                        07043001
070440* WR40574 02-15-2012 END   CLT                                    07044001
070450                                     ABOLA                        07045001
070460                                     AOPSETA                      07046001
070470                                     AOPDESCA                     07047001
070480                                     ATKTTYPA                     07048001
070490                                     ACTNCNTA                     07049001
070500                                     AASNA                        07050001
070510                                     AACTCNTA                     07051001
070520                                     APRETKTA                     07052001
070530                                     AHANGERA                     07053001
070540                                     ACOPERA                      07054001
070550                                     ACFCLTYA                     07055001
070560                                     AACTCNTA                     07056001
070570                                     ADMGCNTA                     07057001
070580                                     APKBYSTA                     07058001
070590                                     APKGCDEA                     07059001
070600                                     ACLERKA                      07060001
070610                                     ARECTYPA.                    07061001
070620                                                                  07062001
070630     MOVE DP015-BLUE              TO ARECSEQC                     07063001
070640                                     APONBRC                      07064001
070650                                     AENTNMEC                     07065001
070660                                     ASCACC                       07066001
070670                                     ATRLRC                       07067001
070680                                     APROC                        07068001
070690                                     AOPSETC                      07069001
070700                                     ASHPDTC                      07070001
070710                                     AARVDTC                      07071001
070720                                     AOPERC                       07072001
070730                                     AFCLTYC                      07073001
070740                                     AVNSHDTC                     07074001
070750                                     ACREUIDC                     07075001
070780* WR40574 02-15-2012 START CLT                                    07078001
070790                                     ACANC                        07079001
070800* WR40574 02-15-2012 END   CLT                                    07080001
070810                                     ABOLC                        07081001
070820                                     AOPSETC                      07082001
070830                                     AOPDESCC                     07083001
070840                                     ATKTTYPC                     07084001
070850                                     ACTNCNTC                     07085001
070860                                     AASNC                        07086001
070870                                     AACTCNTC                     07087001
070880                                     APRETKTC                     07088001
070890                                     AHANGERC                     07089001
070900                                     ACOPERC                      07090001
070910                                     ACFCLTYC                     07091001
070920                                     AACTCNTC                     07092001
070930                                     ADMGCNTC                     07093001
070940                                     APKBYSTC                     07094001
070950                                     APKGCDEC                     07095001
070960                                     ACLERKC                      07096001
070970                                     ARECTYPC.                    07097001
070980                                                                  07098001
070990     MOVE DP015-HL-OFF            TO ARECSEQH                     07099001
071000                                     APONBRH                      07100001
071010                                     ATBLSTH                      07101001
071020                                     AENTNMEH                     07102001
071030                                     ASCACH                       07103001
071040                                     ATRLRH                       07104001
071050                                     APROH                        07105001
071060                                     ASHPDTH                      07106001
071070                                     AARVDTH                      07107001
071080                                     AOPERH                       07108001
071090                                     AFCLTYH                      07109001
071100                                     AVNSHDTH                     07110001
071110                                     ACREUIDH                     07111001
071140                                     ABOLH                        07114001
071150* WR40574 02-15-2012 START CLT                                    07115001
071160                                     ACANH                        07116001
071170* WR40574 02-15-2012 END   CLT                                    07117001
071180                                     AOPSETH                      07118001
071190                                     AOPDESCH                     07119001
071200                                     ATKTTYPH                     07120001
071210                                     ACTNCNTH                     07121001
071220                                     AASNH                        07122001
071230                                     AACTCNTH                     07123001
071240                                     APRETKTH                     07124001
071250                                     AHANGERH                     07125001
071260                                     ACOPERH                      07126001
071270                                     ACFCLTYH                     07127001
071280                                     AACTCNTH                     07128001
071290                                     ADMGCNTH                     07129001
071300                                     APKBYSTH                     07130001
071310                                     APKGCDEH                     07131001
071320                                     ACLERKH                      07132001
071330                                     ARECTYPH.                    07133001
071340                                                                  07134001
071350     MOVE DP015-PRO-DRK-OFF       TO AEXPINDA.                    07135001
071360     MOVE DP015-PRO-DRK-MDT       TO AAPRCVRA.                    07136001
071370     MOVE DP015-BLUE              TO AEXPINDC                     07137001
071380                                     AAPRCVRC.                    07138001
071390     MOVE DP015-HL-OFF            TO AEXPINDH                     07139001
071400                                     AAPRCVRH.                    07140001
071410     IF ASC-ADD-PENDING OR ASC-UPDATE-PENDING                     07141001
071420        IF ASC-REC-TYP = 'EX'                                     07142001
071430           CONTINUE                                               07143001
071440        ELSE                                                      07144001
071450           MOVE DP015-UNP-ALP-NOR-OFF                             07145001
071460                              TO ARECTYPA                         07146001
071470           MOVE DP015-GREEN   TO ARECTYPC                         07147001
071480           MOVE DP015-UNDERLINE                                   07148001
071490                              TO ARECTYPH                         07149001
071500        END-IF                                                    07150001
071510     END-IF.                                                      07151001
071520                                                                  07152001
071530     IF  ASC-ADD-PENDING                                          07153001
071540         IF  ASC-ADD-FROM-SHPPO                                   07154001
071550         OR  ASC-ADD-MULTIPLE                                     07155001
071560             IF  ASC-ADD-FROM-SHPPO                               07156001
071570             AND ASC-NO-SELECTION-MADE                            07157001
071580                 MOVE DP015-UNP-ALP-NOR-OFF                       07158001
071590                                    TO APONBRA                    07159001
071600             END-IF                                               07160001
071610             MOVE DP015-UNP-ALP-NOR-OFF                           07161001
071620                                    TO ASHPDTA                    07162001
071630                                       AVNSHDTA                   07163001
071640                                       ACTNCNTA                   07164001
071650                                       APRETKTA                   07165001
071660                                       AHANGERA                   07166001
071670                                       ACOPERA                    07167001
071680                                       ACFCLTYA                   07168001
071690                                       ADMGCNTA                   07169001
071700                                       APKBYSTA                   07170001
071710                                       APKGCDEA                   07171001
071720                                       ACLERKA                    07172001
071730             IF  ASC-ADD-FROM-SHPPO                               07173001
071740             AND ASC-NO-SELECTION-MADE                            07174001
071750                 MOVE DP015-GREEN   TO APONBRC                    07175001
071760             END-IF                                               07176001
071770             MOVE DP015-GREEN       TO ASHPDTC                    07177001
071780                                       AVNSHDTC                   07178001
071790                                       ACTNCNTC                   07179001
071800                                       APRETKTC                   07180001
071810                                       AHANGERC                   07181001
071820                                       ACOPERC                    07182001
071830                                       ACFCLTYC                   07183001
071840                                       ADMGCNTC                   07184001
071850                                       APKBYSTC                   07185001
071860                                       APKGCDEC                   07186001
071870                                       ACLERKC                    07187001
071880             IF  ASC-ADD-FROM-SHPPO                               07188001
071890             AND ASC-NO-SELECTION-MADE                            07189001
071900                 MOVE DP015-UNDERLINE                             07190001
071910                                    TO APONBRH                    07191001
071920             END-IF                                               07192001
071930             MOVE DP015-UNDERLINE   TO ASHPDTH                    07193001
071940                                       AVNSHDTH                   07194001
071950                                       ACTNCNTH                   07195001
071960                                       APRETKTH                   07196001
071970                                       AHANGERH                   07197001
071980                                       ACOPERH                    07198001
071990                                       ACFCLTYH                   07199001
072000                                       ADMGCNTH                   07200001
072010                                       APKBYSTH                   07201001
072020                                       APKGCDEH                   07202001
072030                                       ACLERKH                    07203001
072040         ELSE                                                     07204001
072050             MOVE DP015-UNP-ALP-NOR-OFF                           07205001
072060                                    TO APONBRA                    07206001
072070                                       ASCACA                     07207001
072080                                       ATRLRA                     07208001
072090                                       APROA                      07209001
072100                                       ASHPDTA                    07210001
072110                                       AARVDTA                    07211001
072120                                       AOPERA                     07212001
072130                                       AFCLTYA                    07213001
072140                                       AVNSHDTA                   07214001
072150                                       ABOLA                      07215001
072160* WR40574 02-15-2012 START CLT                                    07216001
072170                                       ACANA                      07217001
072180* WR40574 02-15-2012 END   CLT                                    07218001
072190                                       ACTNCNTA                   07219001
072200                                       ADMGCNTA                   07220001
072210                                       ACLERKA                    07221001
072220             MOVE DP015-GREEN       TO APONBRC                    07222001
072230                                       ASCACC                     07223001
072240                                       ATRLRC                     07224001
072250                                       APROC                      07225001
072260                                       ASHPDTC                    07226001
072270                                       AARVDTC                    07227001
072280                                       AOPERC                     07228001
072290                                       AFCLTYC                    07229001
072300                                       AVNSHDTC                   07230001
072310                                       ABOLC                      07231001
072320* WR40574 02-15-2012 START CLT                                    07232001
072330                                       ACANC                      07233001
072340* WR40574 02-15-2012 END   CLT                                    07234001
072350                                       ACTNCNTC                   07235001
072360                                       ADMGCNTC                   07236001
072370                                       ACLERKC                    07237001
072380             MOVE DP015-UNDERLINE   TO APONBRH                    07238001
072390                                       ASCACH                     07239001
072400                                       ATRLRH                     07240001
072410                                       APROH                      07241001
072420                                       ASHPDTH                    07242001
072430                                       AARVDTH                    07243001
072440                                       AOPERH                     07244001
072450                                       AFCLTYH                    07245001
072460                                       AVNSHDTH                   07246001
072470                                       ABOLH                      07247001
072480* WR40574 02-15-2012 START CLT                                    07248001
072490                                       ACANH                      07249001
072500* WR40574 02-15-2012 END   CLT                                    07250001
072510                                       ACTNCNTH                   07251001
072520                                       ADMGCNTH                   07252001
072530                                       ACLERKH                    07253001
072540         END-IF                                                   07254001
072550         IF  ASC-ADD-FROM-MENU                                    07255001
072560             MOVE DP015-UNP-ALP-NOR-OFF                           07256001
072570                                    TO AEXPINDA                   07257001
072580             MOVE DP015-YELLOW      TO AEXPINDC                   07258001
072590             MOVE DP015-UNDERLINE   TO AEXPINDH                   07259001
072600             IF  ASC-DIRECT-STORE                                 07260001
072610                 MOVE DP015-UNP-ALP-NOR-MDT                       07261001
072620                                    TO AAPRCVRA                   07262001
072630                 MOVE DP015-YELLOW  TO AAPRCVRC                   07263001
072640                 MOVE DP015-UNDERLINE                             07264001
072650                                    TO AAPRCVRH                   07265001
072660             END-IF                                               07266001
072670         END-IF                                                   07267001
072680     END-IF.                                                      07268001
072690                                                                  07269001
072700     IF  ASC-ADD-SUCCESSFUL                                       07270001
072710         MOVE DP015-UNP-ALP-NOR-OFF TO APONBRA                    07271001
072720         MOVE DP015-GREEN           TO APONBRC                    07272001
072730         MOVE DP015-UNDERLINE       TO APONBRH                    07273001
072740     END-IF.                                                      07274001
072750                                                                  07275001
072760     IF  ASC-UPDATE-PENDING                                       07276001
072770         MOVE DP015-UNP-ALP-NOR-OFF TO ASHPDTA                    07277001
072780                                       AVNSHDTA                   07278001
072790                                       AACTCNTA                   07279001
072800                                       ADMGCNTA                   07280001
072810                                       APKBYSTA                   07281001
072820                                       APKGCDEA                   07282001
072830                                       ACLERKA                    07283001
072840                                       APRETKTA                   07284001
072850                                       AHANGERA                   07285001
072860                                       ACOPERA                    07286001
072870                                       ACFCLTYA                   07287001
072880         MOVE DP015-GREEN           TO ASHPDTC                    07288001
072890                                       AVNSHDTC                   07289001
072900                                       AACTCNTC                   07290001
072910                                       ADMGCNTC                   07291001
072920                                       APKBYSTC                   07292001
072930                                       APKGCDEC                   07293001
072940                                       ACLERKC                    07294001
072950                                       AOPSETC                    07295001
072960                                       APRETKTC                   07296001
072970                                       AHANGERC                   07297001
072980                                       ACOPERC                    07298001
072990                                       ACFCLTYC                   07299001
073000         MOVE DP015-UNDERLINE       TO ASHPDTH                    07300001
073010                                       AVNSHDTH                   07301001
073020                                       AACTCNTH                   07302001
073030                                       ADMGCNTH                   07303001
073040                                       APKBYSTH                   07304001
073050                                       APKGCDEH                   07305001
073060                                       ACLERKH                    07306001
073070                                       AOPSETH                    07307001
073080                                       APRETKTH                   07308001
073090                                       AHANGERH                   07309001
073100                                       ACOPERH                    07310001
073110                                       ACFCLTYH                   07311001
073120         IF  ASC-EXPENSE-RECEIPT                                  07312001
073130         OR  ASC-DIRECT-STORE                                     07313001
073140             MOVE DP015-PRO-NOR-OFF TO AOPSETA                    07314001
073150             MOVE DP015-BLUE        TO AOPSETC                    07315001
073160             MOVE DP015-HL-OFF      TO AOPSETH                    07316001
073170         ELSE                                                     07317001
073180             IF  ASC-MAY-UPDATE-OPER-SET                          07318001
073190                 MOVE DP015-UNP-ALP-NOR-OFF                       07319001
073200                                    TO AOPSETA                    07320001
073210                 MOVE DP015-GREEN   TO AOPSETC                    07321001
073220                 MOVE DP015-UNDERLINE                             07322001
073230                                    TO AOPSETH                    07323001
073240             ELSE                                                 07324001
073250                 MOVE DP015-PRO-NOR-OFF                           07325001
073260                                    TO AOPSETA                    07326001
073270                 MOVE DP015-BLUE    TO AOPSETC                    07327001
073280                 MOVE DP015-HL-OFF  TO AOPSETH                    07328001
073290             END-IF                                               07329001
073300         END-IF                                                   07330001
073310         IF  ASC-MULT-SHIP                                        07331001
073320             MOVE DP015-PRO-NOR-OFF TO ACTNCNTA                   07332001
073330                                       ADMGCNTA                   07333001
073340                                       ASHPDTA                    07334001
073350                                       AVNSHDTA                   07335001
073360                                       AACTCNTA                   07336001
073370             MOVE DP015-BLUE        TO ACTNCNTC                   07337001
073380                                       ADMGCNTC                   07338001
073390                                       ASHPDTC                    07339001
073400                                       AVNSHDTC                   07340001
073410                                       AACTCNTC                   07341001
073420             MOVE DP015-REVERSE     TO ACTNCNTH                   07342001
073430                                       ADMGCNTH                   07343001
073440                                       ASHPDTH                    07344001
073450                                       AVNSHDTH                   07345001
073460                                       AACTCNTH                   07346001
073470         END-IF                                                   07347001
073480         IF  ASC-MULTIPLE-SHIPMENTS                               07348001
073490             MOVE DP015-PRO-NOR-OFF TO ASHPDTA                    07349001
073500                                       AVNSHDTA                   07350001
073510                                       AOPSETA                    07351001
073520             MOVE DP015-BLUE        TO ASHPDTC                    07352001
073530                                       AVNSHDTC                   07353001
073540                                       AOPSETC                    07354001
073550             MOVE DP015-HL-OFF      TO ASHPDTH                    07355001
073560                                       AVNSHDTH                   07356001
073570                                       AOPSETH                    07357001
073580         END-IF                                                   07358001
073590         MOVE DP015-PRO-NOR-MDT     TO AAPRCVRA                   07359001
073600         MOVE DP015-BLUE            TO AAPRCVRC                   07360001
073610         MOVE DP015-HL-OFF          TO AAPRCVRH                   07361001
073620     END-IF.                                                      07362001
073630                                                                  07363001
073640*JPL IF  ASC-PREPK-I-OR-M  AND                                    07364001
073650***      ASC-CASEPACK-SPLT-CNT  >  0                              07365001
073660***          MOVE DP015-PRO-NOR-MDT     TO APKGCDEA               07366001
073670***          MOVE DP015-BLUE            TO APKGCDEC               07367001
073680***          MOVE DP015-HL-OFF          TO APKGCDEH               07368001
073690***  END-IF.                                                      07369001
073700                                                                  07370001
073710     PERFORM 3210-CHECK-RACF.                                     07371001
073720                                                                  07372001
073730     PERFORM 3201-CHECK-AUTOVE                                    07373001
073740     IF RC040-AUTO-VE-YES                                         07374001
073750         PERFORM 3201A-PROTECT-AUTOVE                             07375001
073760         PERFORM 3201C-PROTECT-THE-REST                           07376001
073770     ELSE                                                         07377001
073780         PERFORM 3201B-PROTECT-NORMAL                             07378001
073790         PERFORM 3201C-PROTECT-THE-REST                           07379001
073800     END-IF.                                                      07380001
073810/                                                                 07381001
073820*----------------------------------------------------------------*07382001
073830*  CHECK IF THE PO FOR THE DC IS AUTOVE                           07383001
073840*----------------------------------------------------------------*07384001
073850 3201-CHECK-AUTOVE.                                               07385001
073860                                                                  07386001
073870     IF APONBRL > ZERO                                            07387001
073880         MOVE APONBRI               TO DP010I-UNEDITED-FIELD      07388001
073890         MOVE LENGTH OF ASC-PO-NBR  TO DP010I-MAXIMUM-DIGITS      07389001
073900         MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS    07390001
073910         SET  DP010I-NEGATIVE-NOT-ALLOWED   TO TRUE               07391001
073920         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07392034
073921              USING DP010I-NUMERIC-EDIT-AREA                      07392134
073930         MOVE DP010I-NUMERIC-FIELD TO ASC-PO-NBR-N                07393001
073940     ELSE                                                         07394001
073950         MOVE ASC-KEY-PO-NBR       TO ASC-PO-NBR-N                07395001
073960     END-IF                                                       07396001
073970                                                                  07397001
073980     INITIALIZE RC040-FIELDS.                                     07398001
073990     MOVE ASC-PO-NBR-N                TO RC040-PO-NBR             07399001
074000                                                                  07400001
074010     MOVE ZERO                        TO RC040-PO-RCVR            07401001
074020                                                                  07402001
074030     SET RC040-NO-RCVR-EXISTS         TO TRUE                     07403001
074040                                                                  07404001
074050     MOVE ASC-OPER-UNT-ID-N           TO RC040-SIGNON-LOCATION.   07405001
074060                                                                  07406001
074070     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  07407001
074080                                        RC040-COMMAREA            07408001
074090                                        RC040-FIELDS.             07409001
074100                                                                  07410001
074110     MOVE RC040-SQLCA                 TO SQLCA                    07411001
074120     EVALUATE TRUE                                                07412001
074130         WHEN RC040-SUCCESSFUL                                    07413001
074140             CONTINUE                                             07414001
074150         WHEN RC040-DATABASE-BUSY                                 07415001
074160         WHEN RC040-INVALID-SQL                                   07416001
074170             MOVE PC-TSYMSG-00984  TO DP020-MSG-NUMBER            07417001
074180             SET DP020-MSG-WARNING                                07418001
074190                 DP030-OVERRIDE-GO                                07419001
074200                 PS-ERROR             TO TRUE                     07420001
074210         WHEN SQLCODE = +100                                      07421001
074220             SET PS-ERROR                                         07422001
074230                 DP020-MSG-FATAL      TO TRUE                     07423001
074240             MOVE PC-TSYMSG-00005     TO DP020-MSG-NUMBER         07424001
074250             MOVE DP015-UNP-ALP-BRT-OFF                           07425001
074260                                      TO APONBRA                  07426001
074270             MOVE DP015-RED           TO APONBRC                  07427001
074280             MOVE DP015-REVERSE       TO APONBRH                  07428001
074290             MOVE -1                  TO APONBRL                  07429001
074300             SET DP030-SET-CURSOR-APPL-1                          07430001
074310                                      TO TRUE                     07431001
074320         WHEN OTHER                                               07432001
074330             MOVE '3201-CHECK-AUTOVE' TO DP013-PARAGRAPH          07433001
074340             MOVE 'CALL TO RCKUT127'  TO DP013-MESSAGE-TEXT(1)    07434001
074350             STRING 'MSG - '                                      07435001
074360                     RC040-CRA-RET-MSG   DELIMITED BY SIZE        07436001
074370                              INTO DP013-MESSAGE-TEXT (2)         07437001
074380              MOVE RC040-PO-NBR    TO PV-TRLR-ERROR-PO            07438001
074390              MOVE RC040-PO-RCVR   TO PV-TRLR-ERROR-SEQ           07439001
074400              MOVE RC040-SIGNON-LOCATION                          07440001
074410                                   TO PV-TRLR-ERROR-OPER-UNT-ID   07441001
074420              MOVE ASC-KEY-OWNER-SCAC-ID                          07442001
074430                                   TO PV-TRLR-ERROR-SCAC          07443001
074440              MOVE ASC-VEH-NBR     TO PV-TRLR-ERROR-TRLR          07444001
074450              MOVE PV-TRLR-ERROR-MSG  TO DP013-MESSAGE-TEXT (3)   07445001
074460              MOVE RC040-SQLCA    TO DP013-SQLCA                  07446001
074470              SET DP013-DB2-ABEND                                 07447001
074480                  DP013-ROLLBACK                                  07448001
074490                  DP013-XCTL-DISPLAY-RESTART                      07449001
074500                                      TO TRUE                     07450001
074510                  PERFORM DP013-0000-PROCESS-ABEND                07451001
074520     END-EVALUATE.                                                07452001
074530                                                                  07453001
074540 3201A-PROTECT-AUTOVE.                                            07454001
074550     PERFORM 7000-TRIP-STATUS.                                    07455001
074560     IF TRIPST-TRIP-STATUS-CDE = 'ET' AND                         07456001
074570                                ASC-TRIP-STATUS-CDE = 'VE'        07457001
074580         MOVE DP015-PRO-NOR-OFF       TO AACTCNTA                 07458001
074590         MOVE DP015-BLUE              TO AACTCNTC                 07459001
074600         MOVE DP015-HL-OFF            TO AACTCNTH                 07460001
074610         MOVE DP015-UNP-ALP-NOR-OFF   TO ACLERKA                  07461001
074620         MOVE DP015-GREEN             TO ACLERKC                  07462001
074630         MOVE DP015-UNDERLINE         TO ACLERKH                  07463001
074640         MOVE -1                      TO ACLERKL                  07464001
074650         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     07465001
074660     ELSE                                                         07466001
074670         IF ASC-RECEIVER-NOT-ARRIVED                              07467001
074680*            (RECEIV-REC-TMST = ALL 9'S)                          07468001
074690             MOVE DP015-PRO-NOR-OFF   TO AACTCNTA                 07469001
074700                                         ACLERKA                  07470001
074710             MOVE DP015-BLUE          TO AACTCNTC                 07471001
074720                                         ACLERKC                  07472001
074730             MOVE DP015-HL-OFF        TO AACTCNTH                 07473001
074740                                         ACLERKH                  07474001
074750             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07475001
074760         ELSE                                                     07476001
074770             MOVE DP015-UNP-ALP-NOR-OFF TO ACLERKA                07477001
074780             MOVE DP015-UNP-NUM-NOR-OFF TO AACTCNTA               07478001
074790             MOVE DP015-GREEN         TO AACTCNTC                 07479001
074800                                         ACLERKC                  07480001
074810             MOVE DP015-UNDERLINE     TO ACLERKH                  07481001
074820                                         AACTCNTH                 07482001
074830             MOVE -1                  TO ACLERKL                  07483001
074840             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07484001
074850         END-IF                                                   07485001
074860     END-IF.                                                      07486001
074870                                                                  07487001
074880 3201B-PROTECT-NORMAL.                                            07488001
074890                                                                  07489001
074900     IF ASC-TRIP-STATUS-CDE  = 'VE' OR ASC-RECEIVER-NOT-ARRIVED   07490001
074910*            (RECEIV-REC-TMST = ALL 9'S)                          07491001
074920         MOVE DP015-PRO-NOR-OFF       TO ACLERKA                  07492001
074930                                         AACTCNTA                 07493001
074940         MOVE DP015-BLUE              TO ACLERKC                  07494001
074950                                         AACTCNTC                 07495001
074960         MOVE DP015-HL-OFF            TO ACLERKH                  07496001
074970                                         AACTCNTH                 07497001
074980     ELSE                                                         07498001
074990         MOVE DP015-UNP-ALP-NOR-OFF   TO ACLERKA                  07499001
075000         MOVE DP015-UNP-NUM-NOR-OFF   TO AACTCNTA                 07500001
075010         MOVE DP015-GREEN             TO ACLERKC                  07501001
075020                                         AACTCNTC                 07502001
075030         MOVE DP015-UNDERLINE         TO ACLERKH                  07503001
075040                                         AACTCNTH                 07504001
075050         MOVE -1                      TO ACLERKL                  07505001
075060         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     07506001
075070     END-IF.                                                      07507001
075080                                                                  07508001
075090 3201C-PROTECT-THE-REST.                                          07509001
075100     IF ASC-TRIP-STATUS-CDE = 'VE' OR ASC-RECEIVER-NOT-ARRIVED    07510001
075110*            (RECEIV-REC-TMST = ALL 9'S)                          07511001
075120         MOVE DP015-PRO-NOR-OFF       TO ADMGCNTA                 07512001
075130                                         AOPERA                   07513001
075140         MOVE DP015-BLUE              TO ADMGCNTC                 07514001
075150                                         AOPERC                   07515001
075160         MOVE DP015-HL-OFF            TO ADMGCNTH                 07516001
075170                                         AOPERH                   07517001
075180         SET DP030-SET-CURSOR-APPL-1  TO TRUE                     07518001
075190                                                                  07519001
075200     ELSE                                                         07520001
075210                                                                  07521001
075220         IF ASC-RCVG-CLERK-INIT-ID  = SPACES                      07522001
075230             MOVE DP015-YELLOW        TO ACLERKC                  07523001
075240         END-IF                                                   07524001
075250                                                                  07525001
075260         IF ASC-ACTL-CART-CNT = ZERO OR SPACES                    07526001
075270             MOVE DP015-YELLOW        TO AACTCNTC                 07527001
075280             MOVE DP015-UNP-NUM-BRT-MDT  TO AACTCNTA              07528001
075290         END-IF                                                   07529001
075300                                                                  07530001
075310      END-IF.                                                     07531001
075320/                                                                 07532001
075330*----------------------------------------------------------------*07533001
075340*    THE APRON LOCATION FIELD IS NOT DISPLAYED IF PERFORMING AN  *07534001
075350*    ADD. WHEN PERFORMING AN UPDATE, RACF IS CHECKED TO SEE IF   *07535001
075360*    THE USER HAS ACCESS.  THE FIELD IS NOT UPDATABLE IF THE USER*07536001
075370*    DOES NOT HAVE ACCESS.                                       *07537001
075380*----------------------------------------------------------------*07538001
075390 3210-CHECK-RACF.                                                 07539001
075400                                                                  07540001
075410     EVALUATE TRUE                                                07541001
075420                                                                  07542001
075430         WHEN ASC-ADD-PENDING                                     07543001
075440         WHEN ASC-ADD-FROM-MENU                                   07544001
075450                                                                  07545001
075460            MOVE DP015-PRO-DRK-OFF  TO AAPRLOCA                   07546001
075470                                       AAPRLITA                   07547001
075480            MOVE DP015-HL-OFF       TO AAPRLOCH                   07548001
075490                                                                  07549001
075500         WHEN ASC-UPDATE-PENDING                                  07550001
075510                                                                  07551001
075520            SET DP008-RSRC-TYPE-FUNC     TO TRUE                  07552001
075530            MOVE 'RCAPRLOC'              TO DP008-FUNCTION-NAME   07553001
075540            SET DP008-ACCESS-TYPE-USE    TO TRUE                  07554001
075550                                                                  07555001
075560            EXEC CICS                                             07556001
075570               LINK PROGRAM (DP008-SECURITY-SUBROUTINE)           07557001
075580                    COMMAREA (DP008-SECURITY-COMMAREA)            07558001
075590                    LENGTH (DP008-SECURITY-COMMAREA-LENGTH)       07559001
075600            END-EXEC                                              07560001
075610                                                                  07561001
075620            IF DP008-CALL-SUCCESSFUL                              07562001
075630               IF DP008-ACCESS-ALLOWED                            07563001
075640                   MOVE DP015-PRO-BRT-MDT    TO AAPRLITA          07564001
075650               ELSE                                               07565001
075660*                  -- NO SECURITY CLEARANCE FOR FUNCTION --       07566001
075670                   MOVE DP015-PRO-NOR-OFF    TO AAPRLOCA          07567001
075680                                                AAPRLITA          07568001
075690                   MOVE DP015-BLUE           TO AAPRLOCC          07569001
075700                   MOVE DP015-HL-OFF         TO AAPRLOCH          07570001
075710               END-IF                                             07571001
075720           ELSE                                                   07572001
075730               MOVE '6120-CHECK-RACF-ACCESS'                      07573001
075740                                     TO DP013-PARAGRAPH           07574001
075750                MOVE 'UNABLE TO ACCESS CICS'                      07575001
075760                                     TO DP013-MESSAGE-TEXT (1)    07576001
075770                MOVE SQLCA           TO DP013-SQLCA               07577001
075780                SET DP013-DB2-ABEND                               07578001
075790                    DP013-XCTL-DISPLAY-RESTART                    07579001
075800                                     TO TRUE                      07580001
075810                PERFORM DP013-0000-PROCESS-ABEND                  07581001
075820            END-IF                                                07582001
075830                                                                  07583001
075840     END-EVALUATE.                                                07584001
075850                                                                  07585001
075860/                                                                 07586001
075870*----------------------------------------------------------------*07587001
075880*    SAVE SCREEN FIELDS FOR LATER COMPARISONS                    *07588001
075890*----------------------------------------------------------------*07589001
075900                                                                  07590001
075910 3500-SAVE-SCREEN-FIELDS.                                         07591001
075920                                                                  07592001
075930     MOVE ASC-PO-NBR             TO ASC-PO-NBR-OLD.               07593001
075940     MOVE ASC-ENT-NAME-DESC      TO ASC-ENT-NAME-DESC-OLD.        07594001
075950     MOVE ASC-OWNER-SCAC-ID      TO ASC-OWNER-SCAC-ID-OLD.        07595001
075960     MOVE ASC-VEH-NBR            TO ASC-VEH-NBR-OLD.              07596001
075970     MOVE ASC-PRO-NBR            TO ASC-PRO-NBR-OLD.              07597001
075980     MOVE ASC-OWNR-SCAC-SHIP-DTE TO ASC-OWNR-SCAC-SHIP-DTE-OLD.   07598001
075990     MOVE ASC-ARRIVAL-DTE        TO ASC-ARRIVAL-DTE-OLD.          07599001
076000     MOVE ASC-VEND-SHIP-DTE      TO ASC-VEND-SHIP-DTE-OLD.        07600001
076010     MOVE ASC-BOL-NBR            TO ASC-BOL-NBR-OLD.              07601001
076020* WR40574 02-09-2012 START CLT                                    07602001
076030     MOVE ASC-CARR-AUTH-ID       TO ASC-CARR-AUTH-ID-OLD.         07603001
076040* WR40574 02-09-2012 END   CLT                                    07604001
076050     MOVE ASC-OPER-SET-ID        TO ASC-OPER-SET-ID-OLD.          07605001
076060     MOVE ASC-EXPTED-CART-CNT    TO ASC-EXPTED-CART-CNT-OLD.      07606001
076070     MOVE ASC-PRE-TKT-IND        TO ASC-PRE-TKT-IND-OLD.          07607001
076080     MOVE ASC-HANGER-IND         TO ASC-HANGER-IND-OLD.           07608001
076090     MOVE ASC-DMG-CART-CNT       TO ASC-DMG-CART-CNT-OLD.         07609001
076100     MOVE ASC-ACTL-CART-CNT      TO ASC-ACTL-CART-CNT-OLD.        07610001
076110     MOVE ASC-PACK-BY-ST-IND     TO ASC-PACK-BY-ST-IND-OLD.       07611001
076120     MOVE ASC-PKGNG-CDE          TO ASC-PKGNG-CDE-OLD.            07612001
076130     MOVE ASC-RCVG-CLERK-INIT-ID TO ASC-RCVG-CLERK-INIT-ID-OLD.   07613001
076140     MOVE ASC-COPER-UNT-ID       TO ASC-COPER-UNT-ID-OLD.         07614001
076150     MOVE ASC-CFCLTY-ID          TO ASC-CFCLTY-ID-OLD.            07615001
076160     MOVE ASC-APRON-LOC-DESC     TO ASC-APRON-LOC-DESC-OLD.       07616001
076170     MOVE ASC-REC-TYP            TO ASC-REC-TYP-OLD.              07617001
076180                                                                  07618001
076190/                                                                 07619001
076200 3600-CHECK-IF-FIELDS-CHANGED.                                    07620001
076210                                                                  07621001
076220     IF  ASC-PO-NBR             = ASC-PO-NBR-OLD                  07622001
076230     AND ASC-ENT-NAME-DESC      = ASC-ENT-NAME-DESC-OLD           07623001
076240     AND ASC-OWNER-SCAC-ID      = ASC-OWNER-SCAC-ID-OLD           07624001
076250     AND ASC-VEH-NBR            = ASC-VEH-NBR-OLD                 07625001
076260     AND ASC-PRO-NBR            = ASC-PRO-NBR-OLD                 07626001
076270     AND ASC-OWNR-SCAC-SHIP-DTE = ASC-OWNR-SCAC-SHIP-DTE-OLD      07627001
076280     AND ASC-ARRIVAL-DTE        = ASC-ARRIVAL-DTE-OLD             07628001
076290     AND ASC-VEND-SHIP-DTE      = ASC-VEND-SHIP-DTE-OLD           07629001
076300     AND ASC-BOL-NBR            = ASC-BOL-NBR-OLD                 07630001
076310* WR40574 02-09-2012 START CLT                                    07631001
076320     AND ASC-CARR-AUTH-ID       = ASC-CARR-AUTH-ID-OLD            07632001
076330* WR40574 02-09-2012 END   CLT                                    07633001
076340     AND ASC-OPER-SET-ID        = ASC-OPER-SET-ID-OLD             07634001
076350     AND ASC-EXPTED-CART-CNT    = ASC-EXPTED-CART-CNT-OLD         07635001
076360     AND ASC-PRE-TKT-IND        = ASC-PRE-TKT-IND-OLD             07636001
076370     AND ASC-HANGER-IND         = ASC-HANGER-IND-OLD              07637001
076380     AND ASC-DMG-CART-CNT       = ASC-DMG-CART-CNT-OLD            07638001
076390     AND ASC-ACTL-CART-CNT      = ASC-ACTL-CART-CNT-OLD           07639001
076400     AND ASC-PACK-BY-ST-IND     = ASC-PACK-BY-ST-IND-OLD          07640001
076410     AND ASC-PKGNG-CDE          = ASC-PKGNG-CDE-OLD               07641001
076420     AND ASC-RCVG-CLERK-INIT-ID = ASC-RCVG-CLERK-INIT-ID-OLD      07642001
076430     AND ASC-COPER-UNT-ID       = ASC-COPER-UNT-ID-OLD            07643001
076440     AND ASC-CFCLTY-ID          = ASC-CFCLTY-ID-OLD               07644001
076450     AND ASC-APRON-LOC-DESC     = ASC-APRON-LOC-DESC-OLD          07645001
076460     AND ASC-REC-TYP            = ASC-REC-TYP-OLD                 07646001
076470         CONTINUE                                                 07647001
076480     ELSE                                                         07648001
076490         SET ASC-FIELDS-CHANGED  TO TRUE                          07649001
076500     END-IF.                                                      07650001
076510                                                                  07651001
076520/                                                                 07652001
076530 4000-BUILD-INITIAL-PANEL.                                        07653001
076540                                                                  07654001
076550     MOVE ZEROES                 TO ASC-REC-SEQ-NBR               07655001
076560                                    ASC-PO-NBR-N                  07656001
076570                                    ASC-EXPTED-CART-CNT-N         07657001
076580                                    ASC-ACTL-CART-CNT-N           07658001
076590                                    ASC-DMG-CART-CNT-N.           07659001
076600                                                                  07660001
076610     MOVE ASC-OPER-UNT-ID-N      TO DK-OPER-UNT-ID.               07661001
076620     MOVE ASC-FCLTY-ID-N         TO DK-FCLTY-ID.                  07662001
076630     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR                     07663001
076640                                    DK-ORD-NBR                    07664001
076650                                    ASC-PO-NBR-N.                 07665001
076660     MOVE ASC-KEY-REC-SEQ-NBR    TO DK-REC-SEQ-NBR.               07666001
076670     MOVE ASC-KEY-SHIPT-ID       TO DK-SHIPT-ID.                  07667001
076680                                                                  07668001
076690     IF  ASC-KEY-VEH-NBR > SPACES                                 07669001
076700         MOVE ASC-KEY-VEH-NBR    TO DK-VEH-NBR-B                  07670001
076710                                    DK-VEH-NBR-E                  07671001
076720                                    ASC-VEH-NBR                   07672001
076730     ELSE                                                         07673001
076740         MOVE SPACES             TO DK-VEH-NBR-B                  07674001
076750                                    ASC-VEH-NBR                   07675001
076760         MOVE '9999999999'       TO DK-VEH-NBR-E                  07676001
076770     END-IF.                                                      07677001
076780                                                                  07678001
076790     IF  ASC-KEY-OWNER-SCAC-ID > SPACES                           07679001
076800         MOVE ASC-KEY-OWNER-SCAC-ID                               07680001
076810                                 TO DK-OWNER-SCAC-ID-B            07681001
076820                                    DK-OWNER-SCAC-ID-E            07682001
076830                                    ASC-OWNER-SCAC-ID             07683001
076840     ELSE                                                         07684001
076850         MOVE SPACES             TO DK-OWNER-SCAC-ID-B            07685001
076860                                    ASC-OWNER-SCAC-ID             07686001
076870         MOVE '9999'             TO DK-OWNER-SCAC-ID-E            07687001
076880     END-IF.                                                      07688001
076890                                                                  07689001
076900     IF  ASC-KEY-TRIP-ID > ZEROES                                 07690001
076910         MOVE ASC-KEY-TRIP-ID    TO DK-TRIP-ID-B                  07691001
076920                                    DK-TRIP-ID-E                  07692001
076930     ELSE                                                         07693001
076940         MOVE ZEROES             TO DK-TRIP-ID-B                  07694001
076950         MOVE 999999999          TO DK-TRIP-ID-E                  07695001
076960     END-IF.                                                      07696001
076970                                                                  07697001
076980     IF  ASC-KEY-STATUS-DTE > SPACES                              07698001
076990         MOVE ASC-KEY-STATUS-DTE TO DK-STATUS-DTE-B               07699001
077000                                    DK-STATUS-DTE-E               07700001
077010                                    PV-DB2-DATE                   07701001
077020     ELSE                                                         07702001
077030         MOVE '0001-01-01'       TO DK-STATUS-DTE-B               07703001
077040                                    PV-DB2-DATE                   07704001
077050         MOVE '9999-12-31'       TO DK-STATUS-DTE-E               07705001
077060     END-IF.                                                      07706001
077070                                                                  07707001
077080     IF  ASC-KEY-PRO-NBR > SPACES                                 07708001
077090         MOVE ASC-KEY-PRO-NBR    TO DK-PRO-NBR-B                  07709001
077100                                    DK-PRO-NBR-E                  07710001
077110     ELSE                                                         07711001
077120         MOVE '                ' TO DK-PRO-NBR-B                  07712001
077130         MOVE '9999999999999999' TO DK-PRO-NBR-E                  07713001
077140     END-IF.                                                      07714001
077150                                                                  07715001
077160     IF  ASC-KEY-BOL-NBR > SPACES                                 07716001
077170         MOVE ASC-KEY-BOL-NBR    TO DK-BOL-NBR-B                  07717001
077180                                    DK-BOL-NBR-E                  07718001
077190     ELSE                                                         07719001
077200         MOVE '                ' TO DK-BOL-NBR-B                  07720001
077210         MOVE '9999999999999999' TO DK-BOL-NBR-E                  07721001
077220     END-IF.                                                      07722001
077230                                                                  07723001
077240     IF  PV-DB2-DATE = '0001-01-01'                               07724001
077250         MOVE SPACES             TO ASC-ARRIVAL-DTE               07725001
077260     ELSE                                                         07726001
077270         MOVE PV-DB2-DATE-MM     TO PV-DISPLAY-DATE-MM            07727001
077280         MOVE PV-DB2-DATE-DD     TO PV-DISPLAY-DATE-DD            07728001
077290         MOVE PV-DB2-DATE-YY     TO PV-DISPLAY-DATE-YY            07729001
077300         MOVE PV-DISPLAY-DATE    TO ASC-ARRIVAL-DTE               07730001
077310     END-IF.                                                      07731001
077320                                                                  07732001
077330     IF  ASC-ADD-PENDING                                          07733001
077340         IF  ASC-ADD-FROM-SHPPO                                   07734001
077350         OR  ASC-ADD-FROM-MAINT                                   07735001
077360             CONTINUE                                             07736001
077370         ELSE                                                     07737001
077380             IF ASC-OPER-UNT-ID-N > ZERO                          07738001
077390                 CONTINUE                                         07739001
077400             ELSE                                                 07740001
077410                 MOVE DP020-LOCATION-NBR                          07741001
077420                                 TO ASC-OPER-UNT-ID-N             07742001
077430             END-IF                                               07743001
077440             MOVE 1              TO ASC-FCLTY-ID-N                07744001
077450         END-IF                                                   07745001
077460         MOVE DP020-USERID       TO ASC-CRE-UID                   07746001
077470         MOVE ASC-KEY-PRO-NBR    TO ASC-PRO-NBR                   07747001
077480         MOVE ASC-KEY-BOL-NBR    TO ASC-BOL-NBR                   07748001
077490         MOVE ASC-OPER-UNT-ID-N  TO DK-OPER-UNT-ID                07749001
077500         MOVE ASC-FCLTY-ID-N     TO DK-FCLTY-ID                   07750001
077510     END-IF.                                                      07751001
077520                                                                  07752001
077530     IF ASC-ADD-FROM-MENU                                         07753001
077540         MOVE 'N'                TO ASC-PRE-TKT-IND               07754001
077550                                    ASC-HANGER-IND                07755001
077560         MOVE 'Y'                TO ASC-PACK-BY-ST-IND            07756001
077570         SET ASC-DIRECT-STORE   TO TRUE                           07757001
077580         GO TO 4000-EXIT                                          07758001
077590     END-IF.                                                      07759001
077600                                                                  07760001
077610     IF  ASC-DIRECT-STORE                                         07761001
077620     OR  ASC-EXPENSE-RECEIPT                                      07762001
077630         CONTINUE                                                 07763001
077640     ELSE                                                         07764001
077650         PERFORM 4030-SELECT-TSHPTPO                              07765001
077660         PERFORM 4010-SELECT-TVHTRIP                              07766001
077670         IF  PS-TRIP-EXISTS                                       07767001
077780             PERFORM 4020-SELECT-TSHIPMT                          07778001
077790         END-IF                                                   07779001
077800     END-IF.                                                      07780001
077810                                                                  07781001
077820     IF  ASC-UPDATE-PENDING                                       07782001
077830         PERFORM 4050-SELECT-TRECEIV                              07783001
077840         IF  ASC-PREPK-I-OR-M                                     07784001
077850             PERFORM 4052-COUNT-CASEPK-SPLIT                      07785001
077860         END-IF                                                   07786001
077870         MOVE RECEIV-CURR-OPER-UNT-ID TO                          07787001
077880              ASC-COPER-UNT-ID-N                                  07788001
077890              CURR-OPER-UNT-ID                                    07789001
077900         MOVE RECEIV-CURR-FCLTY-ID TO                             07790001
077910              ASC-CFCLTY-ID-N                                     07791001
077920              CURR-FCLTY-ID                                       07792001
077930         IF  ASC-DIRECT-STORE                                     07793001
077940         OR  ASC-EXPENSE-RECEIPT                                  07794001
077950             IF  ASC-KEY-STATUS-DTE > SPACES                      07795001
077960                 MOVE ASC-KEY-STATUS-DTE  TO DK-STATUS-DTE-B      07796001
077970                                             DK-STATUS-DTE-E      07797001
077980                                             PV-DB2-DATE          07798001
077990             ELSE                                                 07799001
078000                 MOVE '0001-01-01'        TO DK-STATUS-DTE-B      07800001
078010                                             PV-DB2-DATE          07801001
078020                 MOVE '9999-12-31'        TO DK-STATUS-DTE-E      07802001
078030             END-IF                                               07803001
078040             IF  PV-DB2-DATE = '0001-01-01'                       07804001
078050                 MOVE SPACES             TO ASC-ARRIVAL-DTE       07805001
078060             ELSE                                                 07806001
078070                 MOVE PV-DB2-DATE-MM     TO PV-DISPLAY-DATE-MM    07807001
078080                 MOVE PV-DB2-DATE-DD     TO PV-DISPLAY-DATE-DD    07808001
078090                 MOVE PV-DB2-DATE-YY     TO PV-DISPLAY-DATE-YY    07809001
078100                 MOVE PV-DISPLAY-DATE    TO ASC-ARRIVAL-DTE       07810001
078110             END-IF                                               07811001
078120         END-IF                                                   07812001
078130         PERFORM 4055-GET-ORIGINAL-UID                            07813001
078140         PERFORM 4070-SELECT-TPKSLIP                              07814001
078150     END-IF.                                                      07815001
078160                                                                  07816001
078170     INITIALIZE PV-DB2-COUNT.                                     07817001
078180     MOVE DK-OPER-UNT-ID     TO DK-LOCATION-NBR.                  07818001
078190                                                                  07819001
078200     IF  ASC-ADD-FROM-MENU                                        07820001
078210         CONTINUE                                                 07821001
078220     ELSE                                                         07822001
078230         PERFORM 4060-CHECK-DIRECT-STORE                          07823001
078240     END-IF.                                                      07824001
078250                                                                  07825001
078260     PERFORM 4040-GET-ENT-NAME-DESC.                              07826001
078270     PERFORM 4045-GET-FRCST-IND.                                  07827001
078280                                                                  07828001
078290     IF  ASC-EXPENSE-RECEIPT                                      07829001
078300         MOVE ZEROES             TO ASC-OPER-SET-ID-N             07830001
078310         MOVE 'EXPENSE RECEIPT'  TO ASC-OPER-SET-DESC             07831001
078320     ELSE                                                         07832001
078330         IF  ASC-DIRECT-STORE                                     07833001
078340             MOVE ZEROES         TO ASC-OPER-SET-ID-N             07834001
078350             MOVE 'DIRECT STORE SHIPMENT'                         07835001
078360                                 TO ASC-OPER-SET-DESC             07836001
078370         ELSE                                                     07837001
078380             PERFORM 4080-GET-OPER-SET-DESC                       07838001
078390             PERFORM 4085-CHECK-OPER-SET                          07839001
078400         END-IF                                                   07840001
078410     END-IF.                                                      07841001
078420                                                                  07842001
078430     PERFORM 4090-GET-AD-DATE.                                    07843001
078440                                                                  07844001
078450     MOVE ASC-DEPT-NBR            TO DK-DEPT-NBR.                 07845001
078460                                                                  07846001
078470     IF  ASC-ADD-PENDING                                          07847001
078480         PERFORM 3100-MOVE-DEFAULT-TO-COMMAREA                    07848001
078490         IF  ASC-MULTIPLE-SHIPMENTS                               07849001
078500             PERFORM 4035-SUM-TSHPTPO                             07850001
078510         END-IF                                                   07851001
078520     END-IF.                                                      07852001
078530                                                                  07853001
078540                                                                  07854001
078550     PERFORM 3120-GET-OPER-SET-INFO.                              07855001
078560                                                                  07856001
078570     PERFORM 4110-SELECT-TRECITM.                                 07857001
078580                                                                  07858001
078590     IF ASC-REC-SEQ-NBR > ZERO                                    07859001
078600         PERFORM 4200-TROUBLE-DESC                                07860001
078610     END-IF.                                                      07861001
078620                                                                  07862001
078630     IF ASC-UPDATE-PENDING AND ASC-MULT-SHIP                      07863001
078640       MOVE PC-TSYMSG-01090 TO DP020-MSG-NUMBER                   07864001
078650       SET DP020-MSG-WARNING TO TRUE                              07865001
078660     END-IF.                                                      07866001
078670 4000-EXIT.                                                       07867001
078680     EXIT.                                                        07868001
078690/                                                                 07869001
078700*----------------------------------------------------------------*07870001
078710*    RETRIEVE TRIP/VEHICLE INFO                                  *07871001
078720*----------------------------------------------------------------*07872001
078730 4010-SELECT-TVHTRIP.                                             07873001
078740                                                                  07874001
078750     PERFORM                                                      07875001
078760         WITH TEST AFTER                                          07876001
078770         VARYING PV-RETRY-COUNTER                                 07877001
078780         FROM 1 BY 1                                              07878001
078790         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07879001
078800             OR (SQLCODE = +0)                                    07880001
078810             OR (SQLCODE = +100)                                  07881001
078820             OR (SQLCODE = -305))                                 07882001
078830                                                                  07883001
078840         IF  ASC-KEY-TRIP-ID > ZEROES                             07884001
078850             EXEC SQL                                             07885001
078860                  SELECT DISTINCT                                 07886001
078870                         A.OWNER_SCAC_ID                          07887001
078880                        ,A.VEH_NBR                                07888001
078890                        ,A.OWNR_SCAC_SHIP_DTE                     07889001
078900                        ,A.TRIP_ID                                07890001
078910                        ,B.STATUS_DTE                             07891001
078920                    INTO :VHTRIP-OWNER-SCAC-ID                    07892001
078930                        ,:VHTRIP-VEH-NBR                          07893001
078940                        ,:VHTRIP-OWNR-SCAC-SHIP-DTE               07894001
078950                        ,:VHTRIP-TRIP-ID                          07895001
078960                        ,:TRIPST-STATUS-DTE                       07896001
078970                    FROM TVHTRIP A                                07897001
078980                        ,TTRIPST B                                07898001
078990                        ,TVEHICL C                                07899001
079000                   WHERE A.TRIP_ID = :DK-TRIP-ID-B                07900001
079010                     AND B.STATUS_DTE =                           07901001
079020                          (SELECT MAX(STATUS_DTE)                 07902001
079030                           FROM TTRIPST D                         07903001
079040                           WHERE D.TRIP_ID = :DK-TRIP-ID-B)       07904001
079050                     AND A.TRIP_ID = B.TRIP_ID                    07905001
079060                     AND B.TRIP_ID = C.CURR_TRIP_ID               07906001
079070             END-EXEC                                             07907001
079080         ELSE                                                     07908001
079090             EXEC SQL                                             07909001
079100                  SELECT DISTINCT                                 07910001
079110                         A.OWNER_SCAC_ID                          07911001
079120                        ,A.VEH_NBR                                07912001
079130                        ,A.OWNR_SCAC_SHIP_DTE                     07913001
079140                        ,A.TRIP_ID                                07914001
079150                        ,B.STATUS_DTE                             07915001
079160                    INTO :VHTRIP-OWNER-SCAC-ID                    07916001
079170                        ,:VHTRIP-VEH-NBR                          07917001
079180                        ,:VHTRIP-OWNR-SCAC-SHIP-DTE               07918001
079190                        ,:VHTRIP-TRIP-ID                          07919001
079200                        ,:TRIPST-STATUS-DTE                       07920001
079210                    FROM TVHTRIP A                                07921001
079220                        ,TTRIPST B                                07922001
079230                        ,TVEHICL C                                07923001
079240                        ,TSHIPMT D                                07924001
079250                   WHERE A.VEH_NBR       =    :DK-VEH-NBR-B       07925001
079260                     AND A.OWNER_SCAC_ID =    :DK-OWNER-SCAC-ID-B 07926001
079270                     AND D.PRO_SCAC_ID   =    :DK-OWNER-SCAC-ID-B 07927001
079280                     AND A.TRIP_ID       =     B.TRIP_ID          07928001
079290                     AND A.TRIP_ID       =     D.TRIP_ID          07929001
079300                     AND A.TRIP_ID       =     C.CURR_TRIP_ID     07930001
079310                     AND B.STATUS_DTE =                           07931001
079320                          (SELECT MAX(STATUS_DTE)                 07932001
079330                           FROM TTRIPST D                         07933001
079340                           WHERE D.TRIP_ID = :DK-TRIP-ID-B)       07934001
079350             END-EXEC                                             07935001
079360         END-IF                                                   07936001
079370                                                                  07937001
079380         EVALUATE TRUE                                            07938001
079390             WHEN SQLCODE = +0                                    07939001
079400                  MOVE VHTRIP-OWNER-SCAC-ID                       07940001
079410                                       TO ASC-OWNER-SCAC-ID       07941001
079420                                          ASC-KEY-OWNER-SCAC-ID   07942001
079430                  MOVE VHTRIP-VEH-NBR  TO ASC-VEH-NBR             07943001
079440                                          ASC-KEY-VEH-NBR         07944001
079450                  MOVE VHTRIP-OWNR-SCAC-SHIP-DTE                  07945001
079460                                       TO PV-DB2-DATE             07946001
079470                  IF  PV-DB2-DATE = '0001-01-01'                  07947001
079480                      MOVE SPACES      TO ASC-OWNR-SCAC-SHIP-DTE  07948001
079490                  ELSE                                            07949001
079500                      MOVE PV-DB2-DATE-MM                         07950001
079510                                       TO PV-DISPLAY-DATE-MM      07951001
079520                      MOVE PV-DB2-DATE-DD                         07952001
079530                                       TO PV-DISPLAY-DATE-DD      07953001
079540                      MOVE PV-DB2-DATE-YY                         07954001
079550                                       TO PV-DISPLAY-DATE-YY      07955001
079560                      MOVE PV-DISPLAY-DATE                        07956001
079570                                       TO ASC-OWNR-SCAC-SHIP-DTE  07957001
079580                  END-IF                                          07958001
079590                  MOVE TRIPST-STATUS-DTE                          07959001
079600                                       TO PV-DB2-DATE             07960001
079610                                          ASC-KEY-STATUS-DTE      07961001
079620                  MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM      07962001
079630                  MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD      07963001
079640                  MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY      07964001
079650                  MOVE PV-DISPLAY-DATE TO ASC-ARRIVAL-DTE         07965001
079660                  MOVE VHTRIP-TRIP-ID  TO DK-TRIP-ID              07966001
079670                                          ASC-TRIP-ID             07967001
079680                                                                  07968001
079690             WHEN SQLCODE = +100                                  07969001
079700             WHEN SQLCODE = -305                                  07970001
079710             WHEN SQLCODE = -904                                  07971001
079720             WHEN SQLCODE = -913                                  07972001
079730                  CONTINUE                                        07973001
079740                                                                  07974001
079750             WHEN SQLWARN0 NOT = SPACES                           07975001
079760             WHEN SQLCODE < +0                                    07976001
079770             WHEN SQLCODE > +0                                    07977001
079780                  INITIALIZE PV-MESSAGE                           07978001
079790                  MOVE DK-VEH-NBR-B TO PV-MESSAGE1                07979001
079800                  MOVE DK-OWNER-SCAC-ID-B TO PV-MESSAGE2          07980001
079810                  MOVE '4010-SELECT-TVHTRIP '                     07981001
079820                                  TO DP013-PARAGRAPH              07982001
079830                  MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP  '         07983001
079840                                  TO DP013-MESSAGE-TEXT (1)       07984001
079850                  MOVE DK-TRIP-ID-B                               07985001
079860                                  TO DP013-MESSAGE-TEXT (2)       07986001
079870                  MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (3)       07987001
079880                  MOVE SQLCA      TO DP013-SQLCA                  07988001
079890                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     07989001
079900                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)     07990001
079910                  MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (3)     07991001
079920                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (4)     07992001
079930                  SET DP013-DB2-ABEND                             07993001
079940                      DP013-XCTL-DISPLAY-RESTART                  07994001
079950                                  TO TRUE                         07995001
079960                  PERFORM DP013-0000-PROCESS-ABEND                07996001
079970         END-EVALUATE                                             07997001
079980     END-PERFORM.                                                 07998001
079990                                                                  07999001
080000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08000001
080010             AND (SQLCODE = -904 OR -913)                         08001001
080020         MOVE '4010-SELECT-TVHTRIP '                              08002001
080030                                  TO DP013-PARAGRAPH              08003001
080040         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR TRIPS  '         08004001
080050                                  TO DP013-MESSAGE-TEXT (1)       08005001
080060         MOVE SQLCA               TO DP013-SQLCA                  08006001
080070         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)     08007001
080080         MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2)     08008001
080090         MOVE 'TVEHICL '          TO DP013-DB2-TABLE-NAME (3)     08009001
080100         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (4)     08010001
080110         SET DP013-DB2-ABEND                                      08011001
080120             DP013-XCTL-DISPLAY-RESTART                           08012001
080130                                  TO TRUE                         08013001
080140         PERFORM DP013-0000-PROCESS-ABEND                         08014001
080150     END-IF.                                                      08015001
080160                                                                  08016001
080170     IF  SQLCODE = +100 OR -305                                   08017001
080180         PERFORM                                                  08018001
080190             WITH TEST AFTER                                      08019001
080200             VARYING PV-RETRY-COUNTER                             08020001
080210             FROM 1 BY 1                                          08021001
080220             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           08022001
080230                 OR (SQLCODE = +0)                                08023001
080240                 OR (SQLCODE = +100)                              08024001
080250                 OR (SQLCODE = -305))                             08025001
080260                                                                  08026001
080270             IF  ASC-KEY-TRIP-ID > ZEROES                         08027001
080280                 EXEC SQL                                         08028001
080290                      SELECT DISTINCT                             08029001
080300                             A.OWNER_SCAC_ID                      08030001
080310                            ,A.VEH_NBR                            08031001
080320                            ,A.OWNR_SCAC_SHIP_DTE                 08032001
080330                            ,A.TRIP_ID                            08033001
080340                            ,B.STATUS_DTE                         08034001
080350                        INTO :VHTRIP-OWNER-SCAC-ID                08035001
080360                            ,:VHTRIP-VEH-NBR                      08036001
080370                            ,:VHTRIP-OWNR-SCAC-SHIP-DTE           08037001
080380                            ,:VHTRIP-TRIP-ID                      08038001
080390                            ,:TRIPST-STATUS-DTE                   08039001
080400                        FROM TVHTRIP A                            08040001
080410                            ,TTRIPST B                            08041001
080420                            ,TTRSTYP C                            08042001
080430                       WHERE A.TRIP_ID = :DK-TRIP-ID-B            08043001
080440                         AND B.STATUS_DTE =                       08044001
080450                              (SELECT MAX(STATUS_DTE)             08045001
080460                               FROM TTRIPST D                     08046001
080470                               WHERE D.TRIP_ID = :DK-TRIP-ID-B)   08047001
080480                         AND C.PRTY_CDE =                         08048001
080490                       (SELECT MAX(G.PRTY_CDE)                    08049001
080500                          FROM TTRIPST F                          08050001
080510                              ,TTRSTYP G                          08051001
080520                        WHERE F.TRIP_ID         = :DK-TRIP-ID-B   08052001
080530                        AND F.TRIP_STATUS_CDE = G.TRIP_STATUS_CDE)08053001
080540                         AND A.TRIP_ID = B.TRIP_ID                08054001
080550                         AND B.TRIP_STATUS_CDE = C.TRIP_STATUS_CDE08055001
080560                 END-EXEC                                         08056001
080570             ELSE                                                 08057001
080580                 IF DK-STATUS-DTE-B = '0001-01-01'                08058001
080590                    MOVE '00.00.00' TO TRIPST-STATUS-TME          08059001
080600                 ELSE                                             08060001
080610                    PERFORM 4011-GET-TIME                         08061001
080620                 END-IF                                           08062001
080630                 EXEC SQL                                         08063001
080640                      SELECT DISTINCT                             08064001
080650                             A.OWNER_SCAC_ID                      08065001
080660                            ,A.VEH_NBR                            08066001
080670                            ,A.OWNR_SCAC_SHIP_DTE                 08067001
080680                            ,A.TRIP_ID                            08068001
080690                            ,B.STATUS_DTE                         08069001
080700                        INTO :VHTRIP-OWNER-SCAC-ID                08070001
080710                            ,:VHTRIP-VEH-NBR                      08071001
080720                            ,:VHTRIP-OWNR-SCAC-SHIP-DTE           08072001
080730                            ,:VHTRIP-TRIP-ID                      08073001
080740                            ,:TRIPST-STATUS-DTE                   08074001
080750                        FROM TVHTRIP A                            08075001
080760                            ,TTRIPST B                            08076001
080770                            ,TTRSTYP C                            08077001
080780                            ,TSHIPMT D                            08078001
080790                       WHERE A.VEH_NBR     =   :DK-VEH-NBR-B      08079001
080800                         AND A.OWNER_SCAC_ID =                    08080001
080810                                              :DK-OWNER-SCAC-ID-B 08081001
080820                         AND B.STATUS_DTE BETWEEN :DK-STATUS-DTE-B08082001
080830                                              AND :DK-STATUS-DTE-E08083001
080840                         AND B.STATUS_TME  =  :TRIPST-STATUS-TME  08084001
080850                         AND D.PRO_SCAC_ID =  :DK-OWNER-SCAC-ID-B 08085001
080860                         AND C.PRTY_CDE =                         08086001
080870                       (SELECT MAX(G.PRTY_CDE)                    08087001
080880                          FROM TTRIPST F                          08088001
080890                              ,TTRSTYP G                          08089001
080900                        WHERE F.TRIP_ID         = A.TRIP_ID       08090001
080910                        AND F.TRIP_STATUS_CDE = G.TRIP_STATUS_CDE)08091001
080920                         AND A.TRIP_ID  = B.TRIP_ID               08092001
080930                         AND A.TRIP_ID  = D.TRIP_ID               08093001
080940                 END-EXEC                                         08094001
080950             END-IF                                               08095001
080960                                                                  08096001
080970             EVALUATE TRUE                                        08097001
080980                 WHEN SQLCODE = +0                                08098001
080990                      MOVE VHTRIP-OWNER-SCAC-ID                   08099001
081000                                           TO ASC-OWNER-SCAC-ID   08100001
081010                                             ASC-KEY-OWNER-SCAC-ID08101001
081020                      MOVE VHTRIP-VEH-NBR  TO ASC-VEH-NBR         08102001
081030                                              ASC-KEY-VEH-NBR     08103001
081040                      MOVE VHTRIP-OWNR-SCAC-SHIP-DTE              08104001
081050                                           TO PV-DB2-DATE         08105001
081060                      IF  PV-DB2-DATE = '0001-01-01'              08106001
081070                          MOVE SPACES   TO ASC-OWNR-SCAC-SHIP-DTE 08107001
081080                      ELSE                                        08108001
081090                          MOVE PV-DB2-DATE-MM                     08109001
081100                                           TO PV-DISPLAY-DATE-MM  08110001
081110                          MOVE PV-DB2-DATE-DD                     08111001
081120                                           TO PV-DISPLAY-DATE-DD  08112001
081130                          MOVE PV-DB2-DATE-YY                     08113001
081140                                           TO PV-DISPLAY-DATE-YY  08114001
081150                          MOVE PV-DISPLAY-DATE                    08115001
081160                                        TO ASC-OWNR-SCAC-SHIP-DTE 08116001
081170                      END-IF                                      08117001
081180                      MOVE TRIPST-STATUS-DTE                      08118001
081190                                           TO PV-DB2-DATE         08119001
081200                                              ASC-KEY-STATUS-DTE  08120001
081210                      MOVE PV-DB2-DATE-MM  TO PV-DISPLAY-DATE-MM  08121001
081220                      MOVE PV-DB2-DATE-DD  TO PV-DISPLAY-DATE-DD  08122001
081230                      MOVE PV-DB2-DATE-YY  TO PV-DISPLAY-DATE-YY  08123001
081240                      MOVE PV-DISPLAY-DATE TO ASC-ARRIVAL-DTE     08124001
081250                      MOVE VHTRIP-TRIP-ID  TO DK-TRIP-ID          08125001
081260                                              ASC-TRIP-ID         08126001
081270                                                                  08127001
081280                 WHEN SQLCODE = +100                              08128001
081290                 WHEN SQLCODE = -305                              08129001
081300                 WHEN SQLCODE = -904                              08130001
081310                 WHEN SQLCODE = -913                              08131001
081320                      CONTINUE                                    08132001
081330                                                                  08133001
081340                 WHEN SQLWARN0 NOT = SPACES                       08134001
081350                 WHEN SQLCODE < +0                                08135001
081360                 WHEN SQLCODE > +0                                08136001
081370                      INITIALIZE PV-MESSAGE                       08137001
081380                      MOVE DK-VEH-NBR-B  TO PV-MESSAGE1           08138001
081390                      MOVE DK-OWNER-SCAC-ID-B TO PV-MESSAGE2      08139001
081400                      MOVE DK-STATUS-DTE-B TO PV-MESSAGE3         08140001
081410                      MOVE '4010-SELECT-TVHTRIP '                 08141001
081420                                      TO DP013-PARAGRAPH          08142001
081430                      MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP  '     08143001
081440                                      TO DP013-MESSAGE-TEXT (1)   08144001
081450                      MOVE DK-TRIP-ID-B                           08145001
081460                                      TO DP013-MESSAGE-TEXT (2)   08146001
081470                      MOVE PV-MESSAGE TO DP013-MESSAGE-TEXT (3)   08147001
081480                      MOVE SQLCA      TO DP013-SQLCA              08148001
081490                      MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1) 08149001
081500                      MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2) 08150001
081510                      MOVE 'TVEHICL ' TO DP013-DB2-TABLE-NAME (3) 08151001
081520                      MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (4) 08152001
081530                      SET DP013-DB2-ABEND                         08153001
081540                          DP013-XCTL-DISPLAY-RESTART              08154001
081550                                      TO TRUE                     08155001
081560                      PERFORM DP013-0000-PROCESS-ABEND            08156001
081570             END-EVALUATE                                         08157001
081580         END-PERFORM                                              08158001
081590                                                                  08159001
081600         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    08160001
081610             AND (SQLCODE = -904 OR -913)                         08161001
081620             MOVE '4010-SELECT-TVHTRIP '                          08162001
081630                                      TO DP013-PARAGRAPH          08163001
081640             MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR TRIPS  '     08164001
081650                                      TO DP013-MESSAGE-TEXT (1)   08165001
081660             MOVE SQLCA               TO DP013-SQLCA              08166001
081670             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1) 08167001
081680             MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2) 08168001
081690             MOVE 'TVEHICL '          TO DP013-DB2-TABLE-NAME (3) 08169001
081700             MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (4) 08170001
081710             SET DP013-DB2-ABEND                                  08171001
081720                 DP013-XCTL-DISPLAY-RESTART                       08172001
081730                                      TO TRUE                     08173001
081740             PERFORM DP013-0000-PROCESS-ABEND                     08174001
081750         END-IF                                                   08175001
081760     END-IF.                                                      08176001
081770                                                                  08177001
081780     IF SQLCODE = +0                                              08178001
081790         SET PS-TRIP-EXISTS                TO TRUE                08179001
081800     ELSE                                                         08180001
081810         SET PS-TRIP-DOESNT-EXIST          TO TRUE                08181001
081820     END-IF.                                                      08182001
081830                                                                  08183001
081840     PERFORM 4012-GET-ARR-DISP-DTE.                               08184001
081850                                                                  08185001
081860/                                                                 08186001
081870 4011-GET-TIME.                                                   08187001
081880                                                                  08188001
081890     PERFORM                                                      08189001
081900         WITH TEST AFTER                                          08190001
081910         VARYING PV-RETRY-COUNTER                                 08191001
081920         FROM 1 BY 1                                              08192001
081930         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08193001
081940                   OR (SQLCODE = +0)                              08194001
081950                   OR (SQLCODE = +100)                            08195001
081960                   OR (SQLCODE = -811))                           08196001
081970                                                                  08197001
081980         EXEC SQL                                                 08198001
081990           SELECT MAX(B.STATUS_TME)                               08199001
082000             INTO :TRIPST-STATUS-TME                              08200001
082010           FROM   TVHTRIP A                                       08201001
082020                 ,TTRIPST B                                       08202001
082030           WHERE A.OWNER_SCAC_ID = :DK-OWNER-SCAC-ID-B            08203001
082040             AND A.VEH_NBR       = :DK-VEH-NBR-B                  08204001
082050             AND B.OPER_UNT_ID   = :DK-OPER-UNT-ID                08205001
082060             AND B.FCLTY_ID      = :DK-FCLTY-ID                   08206001
082070             AND A.TRIP_ID       = B.TRIP_ID                      08207001
082080             AND B.STATUS_DTE    = :DK-STATUS-DTE-B               08208001
082090         END-EXEC                                                 08209001
082100                                                                  08210001
082110         EVALUATE TRUE                                            08211001
082120             WHEN SQLCODE = -305                                  08212001
082130             WHEN SQLCODE = +100                                  08213001
082140                  MOVE '00.00.00' TO TRIPST-STATUS-TME            08214001
082150             WHEN SQLCODE = +0                                    08215001
082160                  CONTINUE                                        08216001
082170                                                                  08217001
082180             WHEN SQLCODE = -904                                  08218001
082190             WHEN SQLCODE = -913                                  08219001
082200                  CONTINUE                                        08220001
082210                                                                  08221001
082220             WHEN SQLWARN0 NOT = SPACES                           08222001
082230             WHEN SQLCODE < +0                                    08223001
082240             WHEN SQLCODE > +0                                    08224001
082250                  MOVE '4011-GET-TIME'                            08225001
082260                                  TO DP013-PARAGRAPH              08226001
082270                  MOVE 'UNSUCCESSFUL SELECT ON TVHTRIP'           08227001
082280                                  TO DP013-MESSAGE-TEXT (1)       08228001
082290                  MOVE SQLCA      TO DP013-SQLCA                  08229001
082300                  MOVE 'TVHTRIP ' TO DP013-DB2-TABLE-NAME (1)     08230001
082310                  MOVE 'TTRIPST ' TO DP013-DB2-TABLE-NAME (2)     08231001
082320                  SET DP013-DB2-ABEND                             08232001
082330                      DP013-XCTL-DISPLAY-RESTART                  08233001
082340                                  TO TRUE                         08234001
082350                  PERFORM DP013-0000-PROCESS-ABEND                08235001
082360         END-EVALUATE                                             08236001
082370     END-PERFORM.                                                 08237001
082380                                                                  08238001
082390     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08239001
082400             AND (SQLCODE = -904 OR -913)                         08240001
082410         MOVE '4011-GET-TIME'                                     08241001
082420                                  TO DP013-PARAGRAPH              08242001
082430         MOVE 'MAX RETRIES EXCEEDED ON SELECT TVHTRIP'            08243001
082440                                  TO DP013-MESSAGE-TEXT (1)       08244001
082450         MOVE SQLCA               TO DP013-SQLCA                  08245001
082460         MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1)     08246001
082470         MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2)     08247001
082480         SET DP013-DB2-ABEND                                      08248001
082490             DP013-XCTL-DISPLAY-RESTART                           08249001
082500                                  TO TRUE                         08250001
082510         PERFORM DP013-0000-PROCESS-ABEND                         08251001
082520     END-IF.                                                      08252001
082530                                                                  08253001
082540 4012-GET-ARR-DISP-DTE.                                           08254001
082550                                                                  08255001
082560     IF  ASC-KEY-TRIP-ID > ZEROES                                 08256001
082570         PERFORM                                                  08257001
082580             WITH TEST AFTER                                      08258001
082590             VARYING PV-RETRY-COUNTER                             08259001
082600             FROM 1 BY 1                                          08260001
082610             UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)           08261001
082620                 OR (SQLCODE = +0)                                08262001
082630                 OR (SQLCODE = +100))                             08263001
082640                                                                  08264001
082650             EXEC SQL                                             08265001
082660                  SELECT STATUS_DTE                               08266001
082670                    INTO :TRIPST-STATUS-DTE                       08267001
082680                    FROM TTRIPST                                  08268001
082690                   WHERE TRIP_STATUS_CDE = 'AR'                   08269001
082700                     AND TRIP_ID         = :VHTRIP-TRIP-ID        08270001
082710             END-EXEC                                             08271001
082720                                                                  08272001
082730             EVALUATE TRUE                                        08273001
082740                 WHEN SQLCODE = +0                                08274001
082750                      MOVE TRIPST-STATUS-DTE                      08275001
082760                                          TO PV-DB2-DATE          08276001
082770                      MOVE PV-DB2-DATE-MM TO PV-DISPLAY-DATE-MM   08277001
082780                      MOVE PV-DB2-DATE-DD TO PV-DISPLAY-DATE-DD   08278001
082790                      MOVE PV-DB2-DATE-YY TO PV-DISPLAY-DATE-YY   08279001
082800                      MOVE PV-DISPLAY-DATE                        08280001
082810                                       TO ASC-ARRIVAL-DISPLAY-DTE 08281001
082820                 WHEN SQLCODE = +100                              08282001
082830                      MOVE '9999-09-09'      TO PV-DB2-DATE       08283001
082840                      MOVE PV-DB2-DATE-MM TO PV-DISPLAY-DATE-MM   08284001
082850                      MOVE PV-DB2-DATE-DD TO PV-DISPLAY-DATE-DD   08285001
082860                      MOVE PV-DB2-DATE-YY TO PV-DISPLAY-DATE-YY   08286001
082870                      MOVE 'ENROUTE' TO ASC-ARRIVAL-DISPLAY-DTE   08287001
082880                 WHEN SQLCODE = -305                              08288001
082890                 WHEN SQLCODE = -904                              08289001
082900                 WHEN SQLCODE = -913                              08290001
082910                     CONTINUE                                     08291001
082920                                                                  08292001
082930                 WHEN SQLWARN0 NOT = SPACE                        08293001
082940                 WHEN SQLCODE < +0                                08294001
082950                 WHEN SQLCODE > +0                                08295001
082960                     MOVE '4012-GET-ARR-DISP-DATE'                08296001
082970                                     TO DP013-PARAGRAPH           08297001
082980                     MOVE 'SELECT ON TRIP STATUS TABLE'           08298001
082990                                     TO DP013-MESSAGE-TEXT (1)    08299001
083000                     MOVE SQLCA  TO DP013-SQLCA                   08300001
083010                     MOVE 'TTRIPST' TO DP013-DB2-TABLE-NAME (1)   08301001
083020                     SET DP013-DB2-ABEND                          08302001
083030                         DP013-XCTL-DISPLAY-RESTART               08303001
083040                                    TO TRUE                       08304001
083050                     PERFORM DP013-0000-PROCESS-ABEND             08305001
083060             END-EVALUATE                                         08306001
083070         END-PERFORM                                              08307001
083080         IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                    08308001
083090                 AND (SQLCODE = -904 OR -913)                     08309001
083100             MOVE '4012-GET-ARR-DISP-DATE'                        08310001
083110                                      TO DP013-PARAGRAPH          08311001
083120             MOVE 'MAX RETRIES EXCEEDED ON SELECT TRIP STAT TABLE'08312001
083130                                      TO DP013-MESSAGE-TEXT (1)   08313001
083140             MOVE SQLCA               TO DP013-SQLCA              08314001
083150             MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (1) 08315001
083160             SET DP013-DB2-ABEND                                  08316001
083170                 DP013-XCTL-DISPLAY-RESTART                       08317001
083180                                      TO TRUE                     08318001
083190             PERFORM DP013-0000-PROCESS-ABEND                     08319001
083200                                                                  08320001
083210     END-IF.                                                      08321001
083220                                                                  08322001
083230/                                                                 08323001
084490*----------------------------------------------------------------*08449001
084500*    RETREIVE SHIPMENT INFO                                      *08450001
084510*----------------------------------------------------------------*08451001
084520* ADDED CARR-AUTH-ID BELOW WR40574 02-09-2012 CLT                 08452001
084530 4020-SELECT-TSHIPMT.                                             08453001
084540                                                                  08454001
084550     PERFORM                                                      08455001
084560         WITH TEST AFTER                                          08456001
084570         VARYING PV-RETRY-COUNTER                                 08457001
084580         FROM 1 BY 1                                              08458001
084590         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08459001
084600             OR (SQLCODE = +0)                                    08460001
084610             OR (SQLCODE = +100)                                  08461001
084620             OR (SQLCODE = -811))                                 08462001
084630                                                                  08463001
084640         EXEC SQL                                                 08464001
084650              SELECT  B.PRO_NBR                                   08465001
084660                     ,B.BOL_NBR                                   08466001
084670                     ,B.VEND_SHIP_DTE                             08467001
084680                     ,B.CARR_AUTH_ID                              08468001
084690                INTO :SHIPMT-PRO-NBR                              08469001
084700                    ,:SHIPMT-BOL-NBR                              08470001
084710                    ,:SHIPMT-VEND-SHIP-DTE                        08471001
084720                    ,:SHIPMT-CARR-AUTH-ID                         08472001
084730                FROM  TSHPTPO A                                   08473001
084740                     ,TSHIPMT B                                   08474001
084750            WHERE A.PO_NBR      = :DK-PO-NBR                      08475001
084760              AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                 08476001
084770              AND A.SHIPT_ID    = :DK-SHIPT-ID                    08477001
084780              AND A.SHIPT_ID    = B.SHIPT_ID                      08478001
084790         END-EXEC                                                 08479001
084800                                                                  08480001
084810         EVALUATE TRUE                                            08481001
084820             WHEN SQLCODE = +0                                    08482001
084830             WHEN SQLCODE = -811                                  08483001
084840                  MOVE SHIPMT-PRO-NBR  TO ASC-PRO-NBR             08484001
084850                  MOVE SHIPMT-BOL-NBR  TO ASC-BOL-NBR             08485001
084860                  MOVE SHIPMT-CARR-AUTH-ID                        08486001
084870                                       TO ASC-CARR-AUTH-ID        08487001
084880                  IF  SHIPMT-VEND-SHIP-DTE = '0001-01-01'         08488001
084890                      MOVE SPACES      TO ASC-VEND-SHIP-DTE       08489001
084900                  ELSE                                            08490001
084910                      MOVE SHIPMT-VEND-SHIP-DTE                   08491001
084920                                       TO PV-DB2-DATE             08492001
084930                      MOVE PV-DB2-DATE-MM                         08493001
084940                                       TO PV-DISPLAY-DATE-MM      08494001
084950                      MOVE PV-DB2-DATE-DD                         08495001
084960                                       TO PV-DISPLAY-DATE-DD      08496001
084970                      MOVE PV-DB2-DATE-YY                         08497001
084980                                       TO PV-DISPLAY-DATE-YY      08498001
084990                      MOVE PV-DISPLAY-DATE                        08499001
085000                                       TO ASC-VEND-SHIP-DTE       08500001
085010                      IF ASC-REC-TYP = 'EX'                       08501001
085020                         CONTINUE                                 08502001
085030                      ELSE                                        08503001
085040                         MOVE DP015-UNP-ALP-NOR-OFF               08504001
085050                                            TO ARECTYPA           08505001
085060                         MOVE DP015-GREEN   TO ARECTYPC           08506001
085070                         MOVE DP015-UNDERLINE                     08507001
085080                                            TO ARECTYPH           08508001
085090                      END-IF                                      08509001
085100                  END-IF                                          08510001
085110                  IF  SQLCODE = -811                              08511001
085120                      SET ASC-MULTIPLE-SHIPMENTS                  08512001
085130                                       TO TRUE                    08513001
085140                  END-IF                                          08514001
085150                                                                  08515001
085160             WHEN SQLCODE = +100                                  08516001
085170             WHEN SQLCODE = -904                                  08517001
085180             WHEN SQLCODE = -913                                  08518001
085190                  CONTINUE                                        08519001
085200                                                                  08520001
085210             WHEN SQLWARN0 NOT = SPACES                           08521001
085220             WHEN SQLCODE < +0                                    08522001
085230             WHEN SQLCODE > +0                                    08523001
085240                  MOVE '4020-SELECT-TSHIPMT     '                 08524001
085250                                  TO DP013-PARAGRAPH              08525001
085260                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         08526001
085270                                  TO DP013-MESSAGE-TEXT (1)       08527001
085280                  MOVE SQLCA      TO DP013-SQLCA                  08528001
085290                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     08529001
085300                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (2)     08530001
085310                  SET DP013-DB2-ABEND                             08531001
085320                      DP013-XCTL-DISPLAY-RESTART                  08532001
085330                                  TO TRUE                         08533001
085340                  PERFORM DP013-0000-PROCESS-ABEND                08534001
085350         END-EVALUATE                                             08535001
085360     END-PERFORM.                                                 08536001
085370                                                                  08537001
085380     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08538001
085390             AND (SQLCODE = -904 OR -913)                         08539001
085400         MOVE '4020-SELECT-TSHIPMT     '                          08540001
085410                                  TO DP013-PARAGRAPH              08541001
085420         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'       08542001
085430                                  TO DP013-MESSAGE-TEXT (1)       08543001
085440         MOVE SQLCA               TO DP013-SQLCA                  08544001
085450         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     08545001
085460         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (2)     08546001
085470         SET DP013-DB2-ABEND                                      08547001
085480             DP013-XCTL-DISPLAY-RESTART                           08548001
085490                                  TO TRUE                         08549001
085500         PERFORM DP013-0000-PROCESS-ABEND                         08550001
085510     END-IF.                                                      08551001
085520                                                                  08552001
085530* ADDED BELOW ROUTINE TO GET CAN IF NOT ENTERED                   08553001
085540*----------------------------------------------------------------*08554001
085550*    RETREIVE SHIPMENT CARR AUTH ID                              *08555001
085560*----------------------------------------------------------------*08556001
085570 4021-SELECT-CAN.                                                 08557001
085580                                                                  08558001
085590     PERFORM                                                      08559001
085600         WITH TEST AFTER                                          08560001
085610         VARYING PV-RETRY-COUNTER                                 08561001
085620         FROM 1 BY 1                                              08562001
085630         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08563001
085640             OR (SQLCODE = +0)                                    08564001
085650             OR (SQLCODE = +100)                                  08565001
085660             OR (SQLCODE = -811))                                 08566001
085670                                                                  08567001
085680         EXEC SQL                                                 08568001
085690              SELECT DISTINCT A.CARR_AUTH_ID                      08569001
085700                INTO :SHIPMT-CARR-AUTH-ID                         08570001
085710                FROM TSHIPMT A                                    08571001
085720               WHERE A.TRIP_ID = :SHIPMT-TRIP-ID                  08572001
085730         END-EXEC                                                 08573001
085740                                                                  08574001
085750         EVALUATE TRUE                                            08575001
085760             WHEN SQLCODE = +0                                    08576001
085770             WHEN SQLCODE = -811                                  08577001
085780                  MOVE SHIPMT-CARR-AUTH-ID                        08578001
085790                                       TO ASC-CARR-AUTH-ID        08579001
085800             WHEN SQLCODE = +100                                  08580001
085810             WHEN SQLCODE = -904                                  08581001
085820             WHEN SQLCODE = -913                                  08582001
085830                  CONTINUE                                        08583001
085840             WHEN SQLWARN0 NOT = SPACES                           08584001
085850             WHEN SQLCODE < +0                                    08585001
085860             WHEN SQLCODE > +0                                    08586001
085870                  MOVE '4021-SELECT-CAN       '                   08587001
085880                                  TO DP013-PARAGRAPH              08588001
085890                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         08589001
085900                                  TO DP013-MESSAGE-TEXT (1)       08590001
085910                  MOVE SQLCA      TO DP013-SQLCA                  08591001
085920                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (2)     08592001
085930                  SET DP013-DB2-ABEND                             08593001
085940                      DP013-XCTL-DISPLAY-RESTART                  08594001
085950                                  TO TRUE                         08595001
085960                  PERFORM DP013-0000-PROCESS-ABEND                08596001
085970         END-EVALUATE                                             08597001
085980     END-PERFORM.                                                 08598001
085990                                                                  08599001
086000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08600001
086010             AND (SQLCODE = -904 OR -913)                         08601001
086020         MOVE '4021-SELECT-CAN     '                              08602001
086030                                  TO DP013-PARAGRAPH              08603001
086040         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'       08604001
086050                                  TO DP013-MESSAGE-TEXT (1)       08605001
086060         MOVE SQLCA               TO DP013-SQLCA                  08606001
086070         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (2)     08607001
086080         SET DP013-DB2-ABEND                                      08608001
086090             DP013-XCTL-DISPLAY-RESTART                           08609001
086100                                  TO TRUE                         08610001
086110         PERFORM DP013-0000-PROCESS-ABEND                         08611001
086120     END-IF.                                                      08612001
086130                                                                  08613001
086140*----------------------------------------------------------------*08614001
086150*    RETRIEVE SHIPMENT/PO INFO                                   *08615001
086160*----------------------------------------------------------------*08616001
086170 4030-SELECT-TSHPTPO.                                             08617001
086180                                                                  08618001
086190     PERFORM                                                      08619001
086200         WITH TEST AFTER                                          08620001
086210         VARYING PV-RETRY-COUNTER                                 08621001
086220         FROM 1 BY 1                                              08622001
086230         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08623001
086240             OR (SQLCODE = +0)                                    08624001
086250             OR (SQLCODE = +100)                                  08625001
086260             OR (SQLCODE = -811))                                 08626001
086270                                                                  08627001
086280         EXEC SQL                                                 08628001
086290              SELECT EXPTED_CART_CNT                              08629001
086300                    ,ACTL_CART_CNT                                08630001
086310                    ,DMG_CART_CNT                                 08631001
086320                    ,PKSL_IND                                     08632001
086330                    ,SHIPT_ID                                     08633001
086340                    ,VEND_NAME                                    08634001
086350                INTO :SHPTPO-EXPTED-CART-CNT                      08635001
086360                    ,:SHPTPO-ACTL-CART-CNT                        08636001
086370                    ,:SHPTPO-DMG-CART-CNT                         08637001
086380                    ,:SHPTPO-PKSL-IND                             08638001
086390                    ,:SHPTPO-SHIPT-ID                             08639001
086400                    ,:SHPTPO-VEND-NAME                            08640001
086410                FROM TSHPTPO                                      08641001
086420               WHERE PO_NBR      = :DK-PO-NBR                     08642001
086430                 AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                08643001
086440                 AND SHIPT_ID    = :DK-SHIPT-ID                   08644001
086450         END-EXEC                                                 08645001
086460                                                                  08646001
086470         EVALUATE TRUE                                            08647001
086480             WHEN SQLCODE = +0                                    08648001
086490                  MOVE SHPTPO-EXPTED-CART-CNT                     08649001
086500                                       TO ASC-EXPTED-CART-CNT-N   08650001
086510                  MOVE SHPTPO-ACTL-CART-CNT                       08651001
086520                                       TO ASC-ACTL-CART-CNT-N     08652001
086530                  MOVE SHPTPO-DMG-CART-CNT                        08653001
086540                                       TO ASC-DMG-CART-CNT-N      08654001
086550                  MOVE SHPTPO-SHIPT-ID TO ASC-SHIPT-ID            08655001
086560                                          DK-SHIPT-ID             08656001
086570                  MOVE SHPTPO-VEND-NAME TO ASC-ENT-NAME-DESC      08657001
086580                                                                  08658001
086590             WHEN SQLCODE = +100                                  08659001
086600             WHEN SQLCODE = -811                                  08660001
086610             WHEN SQLCODE = -904                                  08661001
086620             WHEN SQLCODE = -913                                  08662001
086630                  CONTINUE                                        08663001
086640                                                                  08664001
086650             WHEN SQLWARN0 NOT = SPACES                           08665001
086660             WHEN SQLCODE < +0                                    08666001
086670             WHEN SQLCODE > +0                                    08667001
086680                  MOVE '4030-SELECT-TSHPTPO'                      08668001
086690                                  TO DP013-PARAGRAPH              08669001
086700                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         08670001
086710                                  TO DP013-MESSAGE-TEXT (1)       08671001
086720                  MOVE SQLCA      TO DP013-SQLCA                  08672001
086730                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     08673001
086740                  SET DP013-DB2-ABEND                             08674001
086750                      DP013-XCTL-DISPLAY-RESTART                  08675001
086760                                  TO TRUE                         08676001
086770                  PERFORM DP013-0000-PROCESS-ABEND                08677001
086780         END-EVALUATE                                             08678001
086790     END-PERFORM.                                                 08679001
086800                                                                  08680001
086810     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08681001
086820             AND (SQLCODE = -904 OR -913)                         08682001
086830         MOVE '4030-SELECT-TSHPTPO'                               08683001
086840                                  TO DP013-PARAGRAPH              08684001
086850         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'       08685001
086860                                  TO DP013-MESSAGE-TEXT (1)       08686001
086870         MOVE SQLCA               TO DP013-SQLCA                  08687001
086880         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     08688001
086890         SET DP013-DB2-ABEND                                      08689001
086900             DP013-XCTL-DISPLAY-RESTART                           08690001
086910                                  TO TRUE                         08691001
086920         PERFORM DP013-0000-PROCESS-ABEND                         08692001
086930     END-IF.                                                      08693001
086940                                                                  08694001
086950/                                                                 08695001
086960*----------------------------------------------------------------*08696001
086970*    SUMMARIZE EXPECTED COUNT IF MULTIPLE SHIPMENTS EXIST        *08697001
086980*----------------------------------------------------------------*08698001
086990 4035-SUM-TSHPTPO.                                                08699001
087000                                                                  08700001
087010     PERFORM                                                      08701001
087020         WITH TEST AFTER                                          08702001
087030         VARYING PV-RETRY-COUNTER                                 08703001
087040         FROM 1 BY 1                                              08704001
087050         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08705001
087060             OR (SQLCODE = +0)                                    08706001
087070             OR (SQLCODE = -305))                                 08707001
087080                                                                  08708001
087090         EXEC SQL                                                 08709001
087100              SELECT SUM(EXPTED_CART_CNT)                         08710001
087110                INTO :SHPTPO-EXPTED-CART-CNT                      08711001
087120                FROM TSHPTPO                                      08712001
087130               WHERE PO_NBR      = :DK-PO-NBR                     08713001
087140                 AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                08714001
087150                 AND SHIPT_ID    = :DK-SHIPT-ID                   08715001
087160         END-EXEC                                                 08716001
087170                                                                  08717001
087180         EVALUATE TRUE                                            08718001
087190             WHEN SQLCODE = +0                                    08719001
087200                  MOVE SHPTPO-EXPTED-CART-CNT                     08720001
087210                                       TO ASC-EXPTED-CART-CNT-N   08721001
087220                                                                  08722001
087230             WHEN SQLCODE = -305                                  08723001
087240                  MOVE ZEROES          TO ASC-EXPTED-CART-CNT-N   08724001
087250                                                                  08725001
087260             WHEN SQLCODE = -904                                  08726001
087270             WHEN SQLCODE = -913                                  08727001
087280                  CONTINUE                                        08728001
087290                                                                  08729001
087300             WHEN SQLWARN0 NOT = SPACES                           08730001
087310             WHEN SQLCODE < +0                                    08731001
087320             WHEN SQLCODE > +0                                    08732001
087330                  MOVE '4035-SUM-TSHPTPO'                         08733001
087340                                  TO DP013-PARAGRAPH              08734001
087350                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         08735001
087360                                  TO DP013-MESSAGE-TEXT (1)       08736001
087370                  MOVE SQLCA      TO DP013-SQLCA                  08737001
087380                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     08738001
087390                  SET DP013-DB2-ABEND                             08739001
087400                      DP013-XCTL-DISPLAY-RESTART                  08740001
087410                                  TO TRUE                         08741001
087420                  PERFORM DP013-0000-PROCESS-ABEND                08742001
087430         END-EVALUATE                                             08743001
087440     END-PERFORM.                                                 08744001
087450                                                                  08745001
087460     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08746001
087470             AND (SQLCODE = -904 OR -913)                         08747001
087480         MOVE '4035-SUM-TSHPTPO'                                  08748001
087490                                  TO DP013-PARAGRAPH              08749001
087500         MOVE 'MAX RETRIES EXCEEDED ON SUM FOR SHIPMENTS'         08750001
087510                                  TO DP013-MESSAGE-TEXT (1)       08751001
087520         MOVE SQLCA               TO DP013-SQLCA                  08752001
087530         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     08753001
087540         SET DP013-DB2-ABEND                                      08754001
087550             DP013-XCTL-DISPLAY-RESTART                           08755001
087560                                  TO TRUE                         08756001
087570         PERFORM DP013-0000-PROCESS-ABEND                         08757001
087580     END-IF.                                                      08758001
087590                                                                  08759001
087600/                                                                 08760001
087610*----------------------------------------------------------------*08761001
087620*  RETRIEVE THE PRIMARY VENDOR NAME                               08762001
087630*----------------------------------------------------------------*08763001
087640                                                                  08764001
087650 4040-GET-ENT-NAME-DESC.                                          08765001
087660                                                                  08766001
087670     PERFORM                                                      08767001
087680         WITH TEST AFTER                                          08768001
087690         VARYING PV-RETRY-COUNTER                                 08769001
087700         FROM 1 BY 1                                              08770001
087710         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08771001
087720             OR (SQLCODE = +0)                                    08772001
087730             OR (SQLCODE = +100))                                 08773001
087740                                                                  08774001
087750         EXEC SQL                                                 08775001
087760              SELECT A.DEPT_NBR                                   08776001
087770                    ,A.VER_NBR                                    08777001
087780                    ,A.NEW_STR_PO_IND                             08778001
087790                    ,B.ENT_NAME_DESC                              08779001
087800                    ,B.ENT_ID                                     08780001
087810                INTO :PURCHS-DEPT-NBR                             08781001
087820                    ,:PURCHS-VER-NBR                              08782001
087830                    ,:PURCHS-NEW-STR-PO-IND                       08783001
087840                    ,:ENTNME-ENT-NAME-DESC                        08784001
087850                    ,:ENTNME-ENT-ID                               08785001
087860                FROM TPURCHS A                                    08786001
087870                    ,TENTNME B                                    08787001
087880               WHERE A.PO_NBR         = :DK-PO-NBR                08788001
087890                 AND A.VER_STATUS_CDE = 'A'                       08789001
087900                 AND B.TYPE_CDE       = '01'                      08790001
087910                 AND A.ENT_ID = B.ENT_ID                          08791001
087920         END-EXEC                                                 08792001
087930                                                                  08793001
087940         EVALUATE TRUE                                            08794001
087950             WHEN SQLCODE = +0                                    08795001
087960                  MOVE PURCHS-DEPT-NBR                            08796001
087970                                  TO ASC-DEPT-NBR                 08797001
087980                  MOVE PURCHS-VER-NBR                             08798001
087990                                  TO ASC-VER-NBR                  08799001
088000                  MOVE PURCHS-NEW-STR-PO-IND                      08800001
088010                                  TO ASC-NEW-STR-PO-IND           08801001
088020                  MOVE ENTNME-ENT-NAME-DESC                       08802001
088030                                  TO ASC-ENT-NAME-DESC            08803001
088040                                                                  08804001
088050             WHEN SQLCODE = +100                                  08805001
088060                  MOVE SPACES     TO ASC-DEPT-NBR                 08806001
088070                                     ASC-ENT-NAME-DESC            08807001
088080                                     ASC-NEW-STR-PO-IND           08808001
088090                  MOVE +1         TO ASC-VER-NBR                  08809001
088100                                                                  08810001
088110             WHEN SQLCODE = -904                                  08811001
088120             WHEN SQLCODE = -913                                  08812001
088130                  CONTINUE                                        08813001
088140                                                                  08814001
088150             WHEN SQLWARN0 NOT = SPACES                           08815001
088160             WHEN SQLCODE < +0                                    08816001
088170             WHEN SQLCODE > +0                                    08817001
088180                  MOVE '4040-GET-ENT-NAME-DESC'                   08818001
088190                                  TO DP013-PARAGRAPH              08819001
088200                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      08820001
088210                                  TO DP013-MESSAGE-TEXT (1)       08821001
088220                  MOVE SQLCA      TO DP013-SQLCA                  08822001
088230                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     08823001
088240                  SET DP013-DB2-ABEND                             08824001
088250                      DP013-XCTL-DISPLAY-RESTART                  08825001
088260                                  TO TRUE                         08826001
088270                  PERFORM DP013-0000-PROCESS-ABEND                08827001
088280         END-EVALUATE                                             08828001
088290     END-PERFORM.                                                 08829001
088300                                                                  08830001
088310     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08831001
088320             AND (SQLCODE = -904 OR -913)                         08832001
088330         MOVE '4040-GET-ENT-NAME-DESC'                            08833001
088340                                  TO DP013-PARAGRAPH              08834001
088350         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    08835001
088360                                  TO DP013-MESSAGE-TEXT (1)       08836001
088370         MOVE SQLCA               TO DP013-SQLCA                  08837001
088380         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     08838001
088390         SET DP013-DB2-ABEND                                      08839001
088400             DP013-XCTL-DISPLAY-RESTART                           08840001
088410                                  TO TRUE                         08841001
088420         PERFORM DP013-0000-PROCESS-ABEND                         08842001
088430     END-IF.                                                      08843001
088440                                                                  08844001
088450/                                                                 08845001
088460*----------------------------------------------------------------*08846001
088470* GET THE VENDOR CREATE ASN FORECAST IND                         *08847001
088480*----------------------------------------------------------------*08848001
088490* WR40574 02-09-2012 BELOW ADDED WITH UR                          08849002
088500 4045-GET-FRCST-IND.                                              08850001
088510                                                                  08851001
088520     PERFORM                                                      08852001
088530         WITH TEST AFTER                                          08853001
088540         VARYING PV-RETRY-COUNTER                                 08854001
088550         FROM 1 BY 1                                              08855001
088560         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08856001
088570             OR (SQLCODE = +0)                                    08857001
088580             OR (SQLCODE = +100))                                 08858001
088590                                                                  08859001
088600         EXEC SQL                                                 08860001
088610              SELECT D.CRE_ASN_FCST_IND                           08861001
088620                INTO :EXTENT-CRE-ASN-FCST-IND                     08862001
088630                FROM TPURCHS A                                    08863001
088640                    ,TENTNME B                                    08864001
088650                    ,TSTATCD C                                    08865001
088660                    ,TEXTENT D                                    08866001
088670               WHERE A.PO_NBR         = :DK-PO-NBR                08867001
088680                 AND A.VER_STATUS_CDE = 'A'                       08868001
088690                 AND B.TYPE_CDE       = '01'                      08869001
088700                 AND C.STATUS_TYP_CDE = 'P'                       08870001
088710                 AND C.STATUS_CLS     = 'ACT'                     08871001
088720                 AND A.STATUS_CDE = C.STATUS_CDE                  08872001
088730                 AND A.ENT_ID     = B.ENT_ID                      08873001
088740                 AND A.ENT_ID     = D.ENT_ID                      08874001
088750               WITH UR                                            08875002
088760         END-EXEC                                                 08876001
088770                                                                  08877001
088780         EVALUATE TRUE                                            08878001
088790             WHEN SQLCODE = +0                                    08879001
088800                  MOVE EXTENT-CRE-ASN-FCST-IND                    08880001
088810                                    TO ASC-PRE-RECEIVER-VEND-SW   08881001
088820                                                                  08882001
088830             WHEN SQLCODE = +100                                  08883001
088840                  MOVE 'N'          TO ASC-PRE-RECEIVER-VEND-SW   08884001
088850                                                                  08885001
088860             WHEN SQLCODE = -904                                  08886001
088870             WHEN SQLCODE = -913                                  08887001
088880                  CONTINUE                                        08888001
088890                                                                  08889001
088900             WHEN SQLWARN0 NOT = SPACES                           08890001
088910             WHEN SQLCODE < +0                                    08891001
088920             WHEN SQLCODE > +0                                    08892001
088930                  MOVE '4045-GET-FRCST-IND'                       08893001
088940                                  TO DP013-PARAGRAPH              08894001
088950                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE IND'       08895001
088960                                  TO DP013-MESSAGE-TEXT (1)       08896001
088970                  MOVE SQLCA      TO DP013-SQLCA                  08897001
088980                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     08898001
088990                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     08899001
089000                  MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (3)     08900001
089010                  MOVE 'TEXTENT ' TO DP013-DB2-TABLE-NAME (4)     08901001
089020                  SET DP013-DB2-ABEND                             08902001
089030                      DP013-XCTL-DISPLAY-RESTART                  08903001
089040                                  TO TRUE                         08904001
089050                  PERFORM DP013-0000-PROCESS-ABEND                08905001
089060         END-EVALUATE                                             08906001
089070     END-PERFORM.                                                 08907001
089080                                                                  08908001
089090     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08909001
089100             AND (SQLCODE = -904 OR -913)                         08910001
089110         MOVE '4045-GET-FRCST-IND'                                08911001
089120                                  TO DP013-PARAGRAPH              08912001
089130         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE IND'     08913001
089140                                  TO DP013-MESSAGE-TEXT (1)       08914001
089150         MOVE SQLCA               TO DP013-SQLCA                  08915001
089160         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     08916001
089170         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (2)     08917001
089180         MOVE 'TSTATCD '          TO DP013-DB2-TABLE-NAME (3)     08918001
089190         MOVE 'TEXTENT '          TO DP013-DB2-TABLE-NAME (4)     08919001
089200         SET DP013-DB2-ABEND                                      08920001
089210             DP013-XCTL-DISPLAY-RESTART                           08921001
089220                                  TO TRUE                         08922001
089230         PERFORM DP013-0000-PROCESS-ABEND                         08923001
089240     END-IF.                                                      08924001
089250                                                                  08925001
089260                                                                  08926001
089270/                                                                 08927001
089280*----------------------------------------------------------------*08928001
089290*    RETRIEVE RECEIVER INFO                                      *08929001
089300*----------------------------------------------------------------*08930001
089310 4050-SELECT-TRECEIV.                                             08931001
089320                                                                  08932001
089330     PERFORM                                                      08933001
089340         WITH TEST AFTER                                          08934001
089350         VARYING PV-RETRY-COUNTER                                 08935001
089360         FROM 1 BY 1                                              08936001
089370         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08937001
089380             OR (SQLCODE = +0)                                    08938001
089390             OR (SQLCODE = +100))                                 08939001
089400                                                                  08940001
089410         EXEC SQL                                                 08941001
089420              SELECT ORD_NBR                                      08942001
089430                    ,REC_SEQ_NBR                                  08943001
089440                    ,PACK_BY_ST_IND                               08944001
089450                    ,EXPTED_CART_CNT                              08945001
089460                    ,ACTL_CART_CNT                                08946001
089470                    ,PRE_TKT_IND                                  08947001
089480                    ,GOH_IND                                      08948001
089490                    ,AD_INFO_DESC                                 08949001
089500                    ,REC_TYP_CDE                                  08950001
089510                    ,RCVG_CLERK_INIT_ID                           08951001
089520                    ,OPER_UNT_ID                                  08952001
089530                    ,FCLTY_ID                                     08953001
089540                    ,RCVR_NBR                                     08954001
089550                    ,DATE(REC_TMST)                               08955001
089560                    ,CURR_OPER_UNT_ID                             08956001
089570                    ,CURR_FCLTY_ID                                08957001
089580                    ,APRON_LOC_DESC                               08958001
089590                    ,PKGNG_CDE                                    08959001
089600                    ,REC_TMST                                     08960001
089610                INTO :RECEIV-ORD-NBR                              08961001
089620                    ,:RECEIV-REC-SEQ-NBR                          08962001
089630                    ,:RECEIV-PACK-BY-ST-IND                       08963001
089640                    ,:RECEIV-EXPTED-CART-CNT                      08964001
089650                    ,:RECEIV-ACTL-CART-CNT                        08965001
089660                    ,:RECEIV-PRE-TKT-IND                          08966001
089670                    ,:RECEIV-GOH-IND                              08967001
089680                    ,:RECEIV-AD-INFO-DESC                         08968001
089690                    ,:RECEIV-REC-TYP-CDE                          08969001
089700                    ,:RECEIV-RCVG-CLERK-INIT-ID                   08970001
089710                    ,:RECEIV-OPER-UNT-ID                          08971001
089720                    ,:RECEIV-FCLTY-ID                             08972001
089730                    ,:RECEIV-RCVR-NBR                             08973001
089740                    ,:ASC-KEY-STATUS-DTE                          08974001
089750                    ,:RECEIV-CURR-OPER-UNT-ID                     08975001
089760                    ,:RECEIV-CURR-FCLTY-ID                        08976001
089770                    ,:RECEIV-APRON-LOC-DESC                       08977001
089780                    ,:RECEIV-PKGNG-CDE                            08978001
089790                    ,:RECEIV-REC-TMST                             08979001
089800                FROM TRECEIV                                      08980001
089810               WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                08981001
089820                 AND FCLTY_ID    = :DK-FCLTY-ID                   08982001
089830                 AND ORD_NBR     = :DK-PO-NBR                     08983001
089840                 AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                08984001
089850                 AND VER_STATUS_CDE = 'A'                         08985001
089860         END-EXEC                                                 08986001
089870                                                                  08987001
089880         EVALUATE TRUE                                            08988001
089890             WHEN SQLCODE = +0                                    08989001
089900                  MOVE RECEIV-ORD-NBR        TO ASC-PO-NBR-N      08990001
089910                  MOVE RECEIV-REC-SEQ-NBR    TO ASC-REC-SEQ-NBR   08991001
089920                  MOVE RECEIV-PACK-BY-ST-IND TO ASC-PACK-BY-ST-IND08992001
089930                  MOVE RECEIV-EXPTED-CART-CNT                     08993001
089940                                          TO ASC-EXPTED-CART-CNT-N08994001
089950                  MOVE RECEIV-ACTL-CART-CNT TO ASC-ACTL-CART-CNT-N08995001
089960                  MOVE RECEIV-PRE-TKT-IND  TO ASC-PRE-TKT-IND     08996001
089970                  MOVE RECEIV-GOH-IND      TO ASC-HANGER-IND      08997001
089980                  MOVE RECEIV-RCVG-CLERK-INIT-ID                  08998001
089990                                         TO ASC-RCVG-CLERK-INIT-ID08999001
090000                  MOVE RECEIV-APRON-LOC-DESC                      09000001
090010                                         TO ASC-APRON-LOC-DESC    09001001
090020                  MOVE RECEIV-PKGNG-CDE  TO ASC-PKGNG-CDE         09002001
090030                  IF  RECEIV-REC-TYP-CDE = 'EX'                   09003001
090040                      SET ASC-EXPENSE-RECEIPT                     09004001
090050                                           TO TRUE                09005001
090060                  ELSE                                            09006001
090070                      MOVE SPACES          TO ASC-RECEIPT-TYPE-SW 09007001
090080                  END-IF                                          09008001
090090                  MOVE RECEIV-OPER-UNT-ID                         09009001
090100                                       TO ASC-OPER-UNT-ID         09010001
090110                                          DK-OPER-UNT-ID          09011001
090120                  MOVE RECEIV-FCLTY-ID TO ASC-FCLTY-ID            09012001
090130                                          DK-FCLTY-ID             09013001
090140                  MOVE RECEIV-RCVR-NBR TO ASC-AP-RCVR-NBR-N       09014001
090150                  MOVE RECEIV-REC-TYP-CDE TO ASC-REC-TYP          09015001
090160                  IF  RECEIV-REC-TMST                             09016001
090170                          = '9999-09-09-09.09.09.999999'          09017001
090180                     SET  ASC-RECEIVER-NOT-ARRIVED  TO  TRUE      09018001
090190                 ELSE                                             09019001
090200                     SET ASC-RECEIVER-ARRIVED       TO TRUE       09020001
090210                 END-IF                                           09021001
090220                                                                  09022001
090230             WHEN SQLCODE = +100                                  09023001
090240                  MOVE SPACES TO ASC-RECEIPT-TYPE-SW              09024001
090250                                                                  09025001
090260             WHEN SQLCODE = -904                                  09026001
090270             WHEN SQLCODE = -913                                  09027001
090280                  CONTINUE                                        09028001
090290                                                                  09029001
090300             WHEN SQLWARN0 NOT = SPACES                           09030001
090310             WHEN SQLCODE < +0                                    09031001
090320             WHEN SQLCODE > +0                                    09032001
090330                  MOVE '4050-SELECT-TRECEIV'                      09033001
090340                                  TO DP013-PARAGRAPH              09034001
090350                  MOVE 'UNSUCCESSFUL SELECT ON TRECEIV  '         09035001
090360                                  TO DP013-MESSAGE-TEXT (1)       09036001
090370                  MOVE SQLCA      TO DP013-SQLCA                  09037001
090380                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     09038001
090390                  SET DP013-DB2-ABEND                             09039001
090400                      DP013-XCTL-DISPLAY-RESTART                  09040001
090410                                  TO TRUE                         09041001
090420                  PERFORM DP013-0000-PROCESS-ABEND                09042001
090430         END-EVALUATE                                             09043001
090440     END-PERFORM.                                                 09044001
090450                                                                  09045001
090460     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09046001
090470             AND (SQLCODE = -904 OR -913)                         09047001
090480         MOVE '4050-SELECT-TRECEIV'                               09048001
090490                                  TO DP013-PARAGRAPH              09049001
090500         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TRECEIV  '       09050001
090510                                  TO DP013-MESSAGE-TEXT (1)       09051001
090520         MOVE SQLCA               TO DP013-SQLCA                  09052001
090530         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     09053001
090540         SET DP013-DB2-ABEND                                      09054001
090550             DP013-XCTL-DISPLAY-RESTART                           09055001
090560                                  TO TRUE                         09056001
090570         PERFORM DP013-0000-PROCESS-ABEND                         09057001
090580     END-IF.                                                      09058001
090590                                                                  09059001
090600                                                                  09060001
090610*----------------------------------------------------------------*09061001
090620* IF PREPK ORDER 'M' OR 'I', COUNT THE NUMBER OF LINES THAT HAVE *09062001
090630* ALREADY BEEN PROCESSED THROUGH CASEPACK SPLIT.  IF COUNT IS    *09063001
090640* GREATER THAN 0 DO NOT ALLOW THE PACK TYPE TO BE CHANGED.       *09064001
090650*----------------------------------------------------------------*09065001
090660 4052-COUNT-CASEPK-SPLIT.                                         09066001
090670                                                                  09067001
090680     MOVE ASC-KEY-PO-NBR           TO DK-PO-NBR.                  09068001
090690     MOVE ASC-KEY-REC-SEQ-NBR      TO DK-REC-SEQ-NBR.             09069001
090700                                                                  09070001
090710     PERFORM                                                      09071001
090720         WITH TEST AFTER                                          09072001
090730         VARYING PV-RETRY-COUNTER                                 09073001
090740         FROM 1 BY 1                                              09074001
090750         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09075001
090760             OR (SQLCODE = +0)                                    09076001
090770             OR (SQLCODE = +100))                                 09077001
090780                                                                  09078001
090790         EXEC SQL                                                 09079001
090800             SELECT COUNT (*)                                     09080001
090810               INTO :ASC-CASEPACK-SPLT-CNT                        09081001
090820               FROM TDISTHD                                       09082001
090830              WHERE ORD_NBR            = :DK-PO-NBR               09083001
090840                AND RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR          09084001
090850*** DMH BEGIN - 4/10/09                                           09085001
090860***             AND TOT_CART_CNT       >  0                       09086001
090870                AND ((TOT_CART_CNT     > 0)                       09087001
090880                 OR  (TOT_CART_CNT     = 0          AND           09088001
090890                     NOT CRE_USR_ID    = ' '        AND           09089001
090900                     NOT CRE_USR_ID    = 'RCKUT129' AND           09090001
090910                     NOT PRCG_STAT_CDE = 'C'        AND           09091001
090920                     NOT SYS_CRE_CDE   = ' ')                     09092001
090930                    )                                             09093001
090940*** DMH END   - 4/10/09                                           09094001
090950         END-EXEC                                                 09095001
090960                                                                  09096001
090970         EVALUATE TRUE                                            09097001
090980             WHEN SQLCODE = +0                                    09098001
090990             WHEN SQLCODE = +100                                  09099001
091000                  CONTINUE                                        09100001
091010                                                                  09101001
091020             WHEN SQLCODE = -904                                  09102001
091030             WHEN SQLCODE = -913                                  09103001
091040                  CONTINUE                                        09104001
091050                                                                  09105001
091060             WHEN SQLWARN0 NOT = SPACES                           09106001
091070             WHEN SQLCODE < +0                                    09107001
091080             WHEN SQLCODE > +0                                    09108001
091090                                                                  09109001
091100                  MOVE '4052-COUNT-CASEPK-SPLIT'                  09110001
091110                                  TO DP013-PARAGRAPH              09111001
091120                  MOVE 'UNSUCCESSFUL SELECT ON TDISTHD  '         09112001
091130                                  TO DP013-MESSAGE-TEXT (1)       09113001
091140                  MOVE SQLCA      TO DP013-SQLCA                  09114001
091150                  MOVE 'TDISTHD ' TO DP013-DB2-TABLE-NAME (1)     09115001
091160                  SET DP013-DB2-ABEND                             09116001
091170                      DP013-XCTL-DISPLAY-RESTART                  09117001
091180                                  TO TRUE                         09118001
091190                  PERFORM DP013-0000-PROCESS-ABEND                09119001
091200         END-EVALUATE                                             09120001
091210     END-PERFORM.                                                 09121001
091220                                                                  09122001
091230     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09123001
091240             AND (SQLCODE = -904 OR -913)                         09124001
091250         MOVE '4052-COUNT-CASEPK-SPLIT'                           09125001
091260                                  TO DP013-PARAGRAPH              09126001
091270         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TDISTHD  '       09127001
091280                                  TO DP013-MESSAGE-TEXT (1)       09128001
091290         MOVE SQLCA               TO DP013-SQLCA                  09129001
091300         MOVE 'TDISTHD '          TO DP013-DB2-TABLE-NAME (1)     09130001
091310         SET DP013-DB2-ABEND                                      09131001
091320             DP013-XCTL-DISPLAY-RESTART                           09132001
091330                                  TO TRUE                         09133001
091340         PERFORM DP013-0000-PROCESS-ABEND                         09134001
091350     END-IF.                                                      09135001
091360                                                                  09136001
091370                                                                  09137001
091380 4053-COUNT-OUTBOUND.                                             09138001
091390                                                                  09139001
091400     MOVE ASC-KEY-PO-NBR           TO DK-PO-NBR.                  09140001
091410     MOVE ASC-KEY-REC-SEQ-NBR      TO DK-REC-SEQ-NBR.             09141001
091420                                                                  09142001
091430     PERFORM                                                      09143001
091440         WITH TEST AFTER                                          09144001
091450         VARYING PV-RETRY-COUNTER                                 09145001
091460         FROM 1 BY 1                                              09146001
091470         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09147001
091480             OR (SQLCODE = +0)                                    09148001
091490             OR (SQLCODE = +100))                                 09149001
091500                                                                  09150001
091510         EXEC SQL                                                 09151001
091520             SELECT COUNT (*)                                     09152001
091530               INTO :ASC-OTBND-CTN-CNT                            09153001
091540               FROM SUT_OTBND_UPC A                               09154001
091550                   ,SUT_OTBND_CART B                              09155001
091560              WHERE A.TRN_NBR            = :DK-PO-NBR             09156001
091570                AND A.RCVR_SEQ_NBR       = :DK-REC-SEQ-NBR        09157001
091580                AND A.SHIPT_UNT_ID       = B.SHIPT_UNT_ID         09158001
091590                AND B.ACTV_IND           = 'Y'                    09159001
091600         END-EXEC                                                 09160001
091610                                                                  09161001
091620         EVALUATE TRUE                                            09162001
091630             WHEN SQLCODE = +0                                    09163001
091640                  CONTINUE                                        09164001
091650             WHEN SQLCODE = +100                                  09165001
091660             WHEN SQLCODE = -305                                  09166001
091670                  MOVE ZEROES TO ASC-OTBND-CTN-CNT                09167001
091680                                                                  09168001
091690             WHEN SQLCODE = -904                                  09169001
091700             WHEN SQLCODE = -913                                  09170001
091710                  CONTINUE                                        09171001
091720                                                                  09172001
091730             WHEN SQLWARN0 NOT = SPACES                           09173001
091740             WHEN SQLCODE < +0                                    09174001
091750             WHEN SQLCODE > +0                                    09175001
091760                                                                  09176001
091770                  MOVE '4053-COUNT-OUTBOUND '                     09177001
091780                                  TO DP013-PARAGRAPH              09178001
091790                  MOVE 'UNSUCCESSFUL SELECT ON OTBND TBL'         09179001
091800                                  TO DP013-MESSAGE-TEXT (1)       09180001
091810                  MOVE SQLCA      TO DP013-SQLCA                  09181001
091820                  MOVE 'SUT_OTBND_CART'                           09182001
091830                                  TO DP013-DB2-TABLE-NAME (1)     09183001
091840                  SET DP013-DB2-ABEND                             09184001
091850                      DP013-XCTL-DISPLAY-RESTART                  09185001
091860                                  TO TRUE                         09186001
091870                  PERFORM DP013-0000-PROCESS-ABEND                09187001
091880         END-EVALUATE                                             09188001
091890     END-PERFORM.                                                 09189001
091900                                                                  09190001
091910     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09191001
091920             AND (SQLCODE = -904 OR -913)                         09192001
091930         MOVE '4053-COUNT-OUTBOUND    '                           09193001
091940                                  TO DP013-PARAGRAPH              09194001
091950         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON OTBND TBL'       09195001
091960                                  TO DP013-MESSAGE-TEXT (1)       09196001
091970         MOVE SQLCA               TO DP013-SQLCA                  09197001
091980         MOVE 'SUT_OTBND_CART'                                    09198001
091990                                  TO DP013-DB2-TABLE-NAME (1)     09199001
092000         SET DP013-DB2-ABEND                                      09200001
092010             DP013-XCTL-DISPLAY-RESTART                           09201001
092020                                  TO TRUE                         09202001
092030         PERFORM DP013-0000-PROCESS-ABEND                         09203001
092040     END-IF.                                                      09204001
092050                                                                  09205001
092060                                                                  09206001
092070                                                                  09207001
092080*----------------------------------------------------------------*09208001
092090*    GET ORIGINAL UID                                            *09209001
092100*----------------------------------------------------------------*09210001
092110 4055-GET-ORIGINAL-UID.                                           09211001
092120                                                                  09212001
092130     PERFORM                                                      09213001
092140         WITH TEST AFTER                                          09214001
092150         VARYING PV-RETRY-COUNTER                                 09215001
092160         FROM 1 BY 1                                              09216001
092170         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09217001
092180            OR (SQLCODE = +0)                                     09218001
092190            OR (SQLCODE = +100))                                  09219001
092200                                                                  09220001
092210         EXEC SQL                                                 09221001
092220             SELECT A.CRE_UID                                     09222001
092230              INTO :ASC-CRE-UID                                   09223001
092240              FROM  TRECEIV A                                     09224001
092250             WHERE A.OPER_UNT_ID = :DK-OPER-UNT-ID                09225001
092260               AND A.FCLTY_ID    = :DK-FCLTY-ID                   09226001
092270               AND A.ORD_NBR     = :DK-PO-NBR                     09227001
092280               AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                09228001
092290               AND A.CRE_TMST    =                                09229001
092300                (SELECT MIN(B.CRE_TMST)                           09230001
092310                   FROM TRECEIV B                                 09231001
092320                   WHERE B.OPER_UNT_ID = :DK-OPER-UNT-ID          09232001
092330                     AND B.FCLTY_ID    = :DK-FCLTY-ID             09233001
092340                     AND B.ORD_NBR     = :DK-PO-NBR               09234001
092350                     AND B.REC_SEQ_NBR = :DK-REC-SEQ-NBR)         09235001
092360         END-EXEC                                                 09236001
092370                                                                  09237001
092380         EVALUATE TRUE                                            09238001
092390             WHEN SQLCODE = +0                                    09239001
092400             WHEN SQLCODE = +100                                  09240001
092410             WHEN SQLCODE = -904                                  09241001
092420             WHEN SQLCODE = -913                                  09242001
092430                 CONTINUE                                         09243001
092440                                                                  09244001
092450             WHEN SQLWARN0 NOT = SPACE                            09245001
092460             WHEN SQLCODE < +0                                    09246001
092470             WHEN SQLCODE > +0                                    09247001
092480                 MOVE '4055-GET-ORIGINAL-UID'                     09248001
092490                                 TO DP013-PARAGRAPH               09249001
092500                 MOVE 'SELECT ON TRECEIV'                         09250001
092510                                 TO DP013-MESSAGE-TEXT (1)        09251001
092520                 MOVE SQLCA      TO DP013-SQLCA                   09252001
092530                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      09253001
092540                 SET DP013-DB2-ABEND                              09254001
092550                                 TO TRUE                          09255001
092560                 SET DP013-XCTL-DISPLAY-RESTART                   09256001
092570                                 TO TRUE                          09257001
092580                 PERFORM DP013-0000-PROCESS-ABEND                 09258001
092590         END-EVALUATE                                             09259001
092600     END-PERFORM.                                                 09260001
092610                                                                  09261001
092620     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09262001
092630             AND (SQLCODE = -904 OR -913)                         09263001
092640         MOVE '4055-GET-ORIGINAL-UID'                             09264001
092650                                 TO DP013-PARAGRAPH               09265001
092660         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     09266001
092670                                 TO DP013-MESSAGE-TEXT (1)        09267001
092680         MOVE 'RECEIVER UID '                                     09268001
092690                                 TO DP013-MESSAGE-TEXT (2)        09269001
092700         MOVE SQLCA              TO DP013-SQLCA                   09270001
092710         MOVE 'TRECEIV'          TO DP013-DB2-TABLE-NAME (1)      09271001
092720         SET DP013-DB2-ABEND     TO TRUE                          09272001
092730         SET DP013-XCTL-DISPLAY-RESTART                           09273001
092740                                 TO TRUE                          09274001
092750         PERFORM DP013-0000-PROCESS-ABEND                         09275001
092760     END-IF.                                                      09276001
092770                                                                  09277001
092780*----------------------------------------------------------------*09278001
092790*     CHECK TO SEE IF OPERATING UNIT IS A STORE                  *09279001
092800*----------------------------------------------------------------*09280001
092810 4060-CHECK-DIRECT-STORE.                                         09281001
092820                                                                  09282001
092830* THE TSTR000 TABLE WAS REMOVED BUT REPLACED WITH THE LOCATION    09283001
092840* HIERARCY DOMAIN TABLE XL00010        DMB 2/2004                 09284001
092850                                                                  09285001
092860     INITIALIZE XL071-COMMAREA-REC.                               09286001
092870     MOVE DK-LOCATION-NBR TO XL071-LOCATION-NUMBER.               09287001
092880                                                                  09288001
092890     CALL PC-LOCATION-MODULE  USING                               09289001
092900                                    DFHEIBLK                      09290001
092910                                    XL071-COMMAREA                09291001
092920                                    XL071-COMMAREA-REC.           09292001
092930                                                                  09293001
092940                                                                  09294001
092950     IF XL071-LOC-TYP-CDE = 'DS'                                  09295001
092960         SET ASC-DIRECT-STORE  TO TRUE                            09296001
092970     ELSE                                                         09297001
092980         IF XL071-LOC-NOT-FOUND                                   09298001
092990             MOVE SPACES TO ASC-DIRECT-STORE-SW                   09299001
093000         ELSE                                                     09300001
093010             IF XL071-BAD-DB2-RETURN                              09301001
093020                 MOVE '4060-CHECK-DIRECT-STORE'                   09302001
093030                                         TO DP013-PARAGRAPH       09303001
093040                 MOVE 'CALL LOCATION MOD '                        09304001
093050                                         TO DP013-MESSAGE-TEXT (1)09305001
093060                 MOVE XL071-SQLCA    TO SQLCA                     09306001
093070                 MOVE SQLCA          TO DP013-SQLCA               09307001
093080                 MOVE 'XLT00010'     TO DP013-DB2-TABLE-NAME (1)  09308001
093090                 SET DP013-DB2-ABEND TO TRUE                      09309001
093100                 SET DP013-XCTL-DISPLAY-RESTART TO TRUE           09310001
093110                 PERFORM DP013-0000-PROCESS-ABEND                 09311001
093120             END-IF                                               09312001
093130         END-IF                                                   09313001
093140     END-IF.                                                      09314001
093150                                                                  09315001
093160*----------------------------------------------------------------*09316001
093170*     CHECK TO SEE IF RECEIVER IS AN EXPENSE RECEIPT             *09317001
093180*----------------------------------------------------------------*09318001
093190 4065-CHECK-EXPENSE-RECEIPT.                                      09319001
093200                                                                  09320001
093210     PERFORM                                                      09321001
093220         WITH TEST AFTER                                          09322001
093230         VARYING PV-RETRY-COUNTER                                 09323001
093240         FROM 1 BY 1                                              09324001
093250         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09325001
093260            OR (SQLCODE = +0)                                     09326001
093270            OR (SQLCODE = +100))                                  09327001
093280                                                                  09328001
093290         EXEC SQL                                                 09329001
093300             SELECT COUNT(*)                                      09330001
093310              INTO :PV-DB2-COUNT                                  09331001
093320              FROM  TRECEIV                                       09332001
093330             WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                  09333001
093340               AND FCLTY_ID    = :DK-FCLTY-ID                     09334001
093350               AND ORD_NBR     = :DK-ORD-NBR                      09335001
093360               AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                  09336001
093370               AND REC_TYP_CDE = 'EX'                             09337001
093380         END-EXEC                                                 09338001
093390                                                                  09339001
093400         EVALUATE TRUE                                            09340001
093410             WHEN SQLCODE = +0                                    09341001
093420             WHEN SQLCODE = +100                                  09342001
093430             WHEN SQLCODE = -904                                  09343001
093440             WHEN SQLCODE = -913                                  09344001
093450                 CONTINUE                                         09345001
093460                                                                  09346001
093470             WHEN SQLWARN0 NOT = SPACE                            09347001
093480             WHEN SQLCODE < +0                                    09348001
093490             WHEN SQLCODE > +0                                    09349001
093500                 MOVE '4065-CHECK-EXPENSE-RECEIPT'                09350001
093510                                 TO DP013-PARAGRAPH               09351001
093520                 MOVE 'COUNT ON TRECEIV'                          09352001
093530                                 TO DP013-MESSAGE-TEXT (1)        09353001
093540                 MOVE SQLCA      TO DP013-SQLCA                   09354001
093550                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      09355001
093560                 SET DP013-DB2-ABEND                              09356001
093570                                 TO TRUE                          09357001
093580                 SET DP013-XCTL-DISPLAY-RESTART                   09358001
093590                                 TO TRUE                          09359001
093600                 PERFORM DP013-0000-PROCESS-ABEND                 09360001
093610         END-EVALUATE                                             09361001
093620     END-PERFORM.                                                 09362001
093630                                                                  09363001
093640     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09364001
093650             AND (SQLCODE = -904 OR -913)                         09365001
093660         MOVE '4065-CHECK-EXPENSE-RECEIPT'                        09366001
093670                                 TO DP013-PARAGRAPH               09367001
093680         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     09368001
093690                                 TO DP013-MESSAGE-TEXT (1)        09369001
093700         MOVE 'ON TRECEIV'       TO DP013-MESSAGE-TEXT (2)        09370001
093710         MOVE SQLCA              TO DP013-SQLCA                   09371001
093720         MOVE 'TRECEIV'          TO DP013-DB2-TABLE-NAME (1)      09372001
093730         SET DP013-DB2-ABEND     TO TRUE                          09373001
093740         SET DP013-XCTL-DISPLAY-RESTART                           09374001
093750                                 TO TRUE                          09375001
093760         PERFORM DP013-0000-PROCESS-ABEND                         09376001
093770     END-IF.                                                      09377001
093780                                                                  09378001
093790/                                                                 09379001
093800*----------------------------------------------------------------*09380001
093810*    RETRIEVE PACKING SLIP INFO                                  *09381001
093820*----------------------------------------------------------------*09382001
093830 4070-SELECT-TPKSLIP.                                             09383001
093840                                                                  09384001
093850     PERFORM                                                      09385001
093860         WITH TEST AFTER                                          09386001
093870         VARYING PV-RETRY-COUNTER                                 09387001
093880         FROM 1 BY 1                                              09388001
093890         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09389001
093900             OR (SQLCODE = +0)                                    09390001
093910             OR (SQLCODE = +100)                                  09391001
093920             OR (SQLCODE = -811))                                 09392001
093930                                                                  09393001
093940         EXEC SQL                                                 09394001
093950              SELECT CRE_SRC_CDE                                  09395001
093960                INTO :PKSLIP-CRE-SRC-CDE                          09396001
093970                FROM TPKSLIP                                      09397001
093980               WHERE OPER_UNT_ID  = :DK-OPER-UNT-ID               09398001
093990                 AND FCLTY_ID     = :DK-FCLTY-ID                  09399001
094000                 AND PO_NBR       = :DK-PO-NBR                    09400001
094010                 AND REC_SEQ_NBR  = :DK-REC-SEQ-NBR               09401001
094020                 AND VER_STAT_CDE = 'A'                           09402001
094021                 AND CRE_SRC_CDE  = 'ASN '                        09402128
094030         END-EXEC                                                 09403001
094040                                                                  09404001
094050         EVALUATE TRUE                                            09405001
094060             WHEN SQLCODE = +0                                    09406001
094070             WHEN SQLCODE = -811                                  09407001
094080                  EVALUATE PKSLIP-CRE-SRC-CDE                     09408001
094090                     WHEN 'ASN '                                  09409001
094100                        MOVE 'X'           TO ASC-ASN-IND         09410001
094110                  END-EVALUATE                                    09411001
094120                                                                  09412001
094130             WHEN SQLCODE = +100                                  09413001
094140             WHEN SQLCODE = -904                                  09414001
094150             WHEN SQLCODE = -913                                  09415001
094160                  CONTINUE                                        09416001
094170                                                                  09417001
094180             WHEN SQLWARN0 NOT = SPACES                           09418001
094190             WHEN SQLCODE < +0                                    09419001
094200             WHEN SQLCODE > +0                                    09420001
094210                  MOVE '4070-SELECT-TPKSLIP'                      09421001
094220                                  TO DP013-PARAGRAPH              09422001
094230                  MOVE 'UNSUCCESSFUL SELECT ON TPKSLIP  '         09423001
094240                                  TO DP013-MESSAGE-TEXT (1)       09424001
094250                  MOVE SQLCA      TO DP013-SQLCA                  09425001
094260                  MOVE 'TPKSLIP ' TO DP013-DB2-TABLE-NAME (1)     09426001
094270                  SET DP013-DB2-ABEND                             09427001
094280                      DP013-XCTL-DISPLAY-RESTART                  09428001
094290                                  TO TRUE                         09429001
094300                  PERFORM DP013-0000-PROCESS-ABEND                09430001
094310         END-EVALUATE                                             09431001
094320     END-PERFORM.                                                 09432001
094330                                                                  09433001
094340     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09434001
094350             AND (SQLCODE = -904 OR -913)                         09435001
094360         MOVE '4070-SELECT-TPKSLIP'                               09436001
094370                                  TO DP013-PARAGRAPH              09437001
094380         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TPKSLIP  '       09438001
094390                                  TO DP013-MESSAGE-TEXT (1)       09439001
094400         MOVE SQLCA               TO DP013-SQLCA                  09440001
094410         MOVE 'TPKSLIP '          TO DP013-DB2-TABLE-NAME (1)     09441001
094420         SET DP013-DB2-ABEND                                      09442001
094430             DP013-XCTL-DISPLAY-RESTART                           09443001
094440                                  TO TRUE                         09444001
094450         PERFORM DP013-0000-PROCESS-ABEND                         09445001
094460     END-IF.                                                      09446001
094470                                                                  09447001
094480/                                                                 09448001
094490*----------------------------------------------------------------*09449001
094500*    RETRIEVE OPERATION SET DESCRIPTION                          *09450001
094510*----------------------------------------------------------------*09451001
094520 4080-GET-OPER-SET-DESC.                                          09452001
094530                                                                  09453001
094540     PERFORM                                                      09454001
094550         WITH TEST AFTER                                          09455001
094560         VARYING PV-RETRY-COUNTER                                 09456001
094570         FROM 1 BY 1                                              09457001
094580         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09458001
094590             OR (SQLCODE = +0)                                    09459001
094600             OR (SQLCODE = +100))                                 09460001
094610                                                                  09461001
094620         EXEC SQL                                                 09462001
094630            SELECT  DISTINCT                                      09463001
094640                    B.OPER_SET_ID                                 09464001
094650                   ,C.OPER_SET_DESC                               09465001
094660              INTO :WRKORD-OPER-SET-ID                            09466001
094670                  ,:OPRSET-OPER-SET-DESC                          09467001
094680              FROM  TRECEIV A                                     09468001
094690                   ,TWRKORD B                                     09469001
094700                   ,TOPRSET C                                     09470001
094710*** DMH BEGIN 11/04/08                                            09471001
094720***          WHERE  A.OPER_UNT_ID    = :DK-OPER-UNT-ID            09472001
094730***            AND  A.FCLTY_ID       = :DK-FCLTY-ID               09473001
094740*** DMH END   11/04/08                                            09474001
094750             WHERE  A.ORD_NBR        = :DK-ORD-NBR                09475001
094760               AND  A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR            09476001
094770               AND  B.ORD_LNE_NBR    = 0                          09477001
094780               AND  A.VER_STATUS_CDE = 'A'                        09478001
094790               AND  B.VER_STATUS_CDE = 'A'                        09479001
094800*** DMH BEGIN 11/04/08                                            09480001
094810***            AND  A.OPER_UNT_ID    = B.OPER_UNT_ID              09481001
094820***            AND  A.FCLTY_ID       = B.FCLTY_ID                 09482001
094830*** DMH END   11/04/08                                            09483001
094840               AND  A.ORD_NBR        = B.ORD_NBR                  09484001
094850               AND  A.REC_SEQ_NBR    = B.RCVR_SEQ_NBR             09485001
094860               AND  B.OPER_SET_ID    = C.OPER_SET_ID              09486001
094870               AND  C.OPER_UNT_ID    = A.CURR_OPER_UNT_ID         09487001
094880         END-EXEC                                                 09488001
094890                                                                  09489001
094900         EVALUATE TRUE                                            09490001
094910             WHEN SQLCODE = +0                                    09491001
094920                  MOVE WRKORD-OPER-SET-ID   TO ASC-OPER-SET-ID-N  09492001
094930                                               DK-OPER-SET-ID     09493001
094940                  MOVE OPRSET-OPER-SET-DESC TO ASC-OPER-SET-DESC  09494001
094950                                                                  09495001
094960             WHEN SQLCODE = +100                                  09496001
094970             WHEN SQLCODE = -904                                  09497001
094980             WHEN SQLCODE = -913                                  09498001
094990                  CONTINUE                                        09499001
095000                                                                  09500001
095010             WHEN SQLWARN0 NOT = SPACES                           09501001
095020             WHEN SQLCODE < +0                                    09502001
095030             WHEN SQLCODE > +0                                    09503001
095040                  MOVE '4080-GET-OPER-SET-DESC'                   09504001
095050                                  TO DP013-PARAGRAPH              09505001
095060                  MOVE 'UNSUCCESSFUL SELECT ON TOPRSET  '         09506001
095070                                  TO DP013-MESSAGE-TEXT (1)       09507001
095080                  MOVE SQLCA      TO DP013-SQLCA                  09508001
095090                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     09509001
095100                  MOVE 'TWRKORD ' TO DP013-DB2-TABLE-NAME (2)     09510001
095110                  MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (3)     09511001
095120                  SET DP013-DB2-ABEND                             09512001
095130                      DP013-XCTL-DISPLAY-RESTART                  09513001
095140                                  TO TRUE                         09514001
095150                  PERFORM DP013-0000-PROCESS-ABEND                09515001
095160         END-EVALUATE                                             09516001
095170     END-PERFORM.                                                 09517001
095180                                                                  09518001
095190     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09519001
095200             AND (SQLCODE = -904 OR -913)                         09520001
095210         MOVE '4080-GET-OPER-SET-DESC'                            09521001
095220                                  TO DP013-PARAGRAPH              09522001
095230         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TOPRSET  '       09523001
095240                                  TO DP013-MESSAGE-TEXT (1)       09524001
095250         MOVE SQLCA               TO DP013-SQLCA                  09525001
095260         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     09526001
095270         MOVE 'TWRKORD '          TO DP013-DB2-TABLE-NAME (2)     09527001
095280         MOVE 'TOPRSET '          TO DP013-DB2-TABLE-NAME (3)     09528001
095290         SET DP013-DB2-ABEND                                      09529001
095300             DP013-XCTL-DISPLAY-RESTART                           09530001
095310                                  TO TRUE                         09531001
095320         PERFORM DP013-0000-PROCESS-ABEND                         09532001
095330     END-IF.                                                      09533001
095340/                                                                 09534001
095350 4085-CHECK-OPER-SET.                                             09535001
095360                                                                  09536001
095370     PERFORM                                                      09537001
095380         WITH TEST AFTER                                          09538001
095390         VARYING PV-RETRY-COUNTER                                 09539001
095400         FROM 1 BY 1                                              09540001
095410         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09541001
095420             OR (SQLCODE = +0)                                    09542001
095430             OR (SQLCODE = +100))                                 09543001
095440                                                                  09544001
095450         EXEC SQL                                                 09545001
095460             SELECT ORD_NBR                                       09546001
095470              INTO  :WRKORD-ORD-NBR                               09547001
095480             FROM TWRKORD                                         09548001
095490            WHERE ORD_NBR          =  :DK-PO-NBR                  09549001
095500              AND RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR             09550001
095510              AND OPER_SET_ID      =  :DK-OPER-SET-ID             09551001
095520              AND VER_STATUS_CDE   =  :PC-A                       09552001
095530              AND ORD_LNE_NBR      =  :PC-ZERO                    09553001
095540              AND STAT_CDE         =  :PC-CM                      09554001
095550         END-EXEC                                                 09555001
095560                                                                  09556001
095570         EVALUATE TRUE                                            09557001
095580             WHEN SQLCODE = +0                                    09558001
095590                INITIALIZE ASC-OPER-SET-UPDATE-SW                 09559001
095600             WHEN SQLCODE = +100                                  09560001
095610             WHEN SQLCODE = -904                                  09561001
095620             WHEN SQLCODE = -913                                  09562001
095630                 CONTINUE                                         09563001
095640                                                                  09564001
095650             WHEN SQLWARN0 NOT = SPACES                           09565001
095660             WHEN SQLCODE < +0                                    09566001
095670             WHEN SQLCODE > +0                                    09567001
095680                 MOVE '4085-CHECK-OPER-SET'                       09568001
095690                                   TO DP013-PARAGRAPH             09569001
095700                 MOVE 'SELECT TWRKORD'                            09570001
095710                                   TO DP013-MESSAGE-TEXT(1)       09571001
095720                 MOVE SQLCA        TO DP013-SQLCA                 09572001
095730                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    09573001
095740                 SET DP013-DB2-ABEND                              09574001
095750                     DP013-XCTL-DISPLAY-RESTART TO TRUE           09575001
095760                 PERFORM DP013-0000-PROCESS-ABEND                 09576001
095770         END-EVALUATE                                             09577001
095780     END-PERFORM.                                                 09578001
095790                                                                  09579001
095800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09580001
095810             AND (SQLCODE = -904 OR -913)                         09581001
095820         MOVE '4085-CHECK-OPER-SET'                               09582001
095830                                   TO DP013-PARAGRAPH             09583001
095840         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              09584001
095850                                   TO DP013-MESSAGE-TEXT (1)      09585001
095860         MOVE 'TO SELECT TWRKORD'                                 09586001
095870                                   TO DP013-MESSAGE-TEXT (2)      09587001
095880         MOVE SQLCA                TO DP013-SQLCA                 09588001
095890         MOVE 'TWRKORD'            TO DP013-DB2-TABLE-NAME (1)    09589001
095900         SET DP013-DB2-ABEND                                      09590001
095910             DP013-XCTL-DISPLAY-RESTART                           09591001
095920                                   TO TRUE                        09592001
095930         PERFORM DP013-0000-PROCESS-ABEND                         09593001
095940     END-IF.                                                      09594001
095950                                                                  09595001
095960     IF SQLCODE = +100                                            09596001
095970         SET ASC-MAY-UPDATE-OPER-SET                              09597001
095980                                   TO TRUE                        09598001
095990     END-IF.                                                      09599001
096000/                                                                 09600001
096010*----------------------------------------------------------------*09601001
096020*    GET THE EARLIEST AD DATE                                    *09602001
096030*----------------------------------------------------------------*09603001
096040 4090-GET-AD-DATE.                                                09604001
096050                                                                  09605001
096060     PERFORM                                                      09606001
096070         WITH TEST AFTER                                          09607001
096080         VARYING PV-RETRY-COUNTER                                 09608001
096090         FROM 1 BY 1                                              09609001
096100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09610001
096110             OR (SQLCODE = +0)                                    09611001
096120             OR (SQLCODE = -305))                                 09612001
096130                                                                  09613001
096140         EXEC SQL                                                 09614001
096150              SELECT MIN(AD_EVNT_DTE)                             09615001
096160                INTO :PURITM-AD-EVNT-DTE                          09616001
096170                       :DN-AD-EVNT-DTE                            09617001
096180                FROM TPURITM                                      09618001
096190               WHERE PO_NBR         = :DK-PO-NBR                  09619001
096200                 AND VER_STATUS_CDE = 'A'                         09620001
096210                 AND AD_EVNT_DTE > '0001-01-01'                   09621001
096220         END-EXEC                                                 09622001
096230                                                                  09623001
096240         EVALUATE TRUE                                            09624001
096250             WHEN SQLCODE = +0                                    09625001
096260                IF  DN-AD-EVNT-DTE = -1                           09626001
096270                    MOVE SPACES           TO ASC-AD-DTE           09627001
096280                ELSE                                              09628001
096290                    MOVE PURITM-AD-EVNT-DTE TO PV-DB2-DATE        09629001
096300                    MOVE PV-DB2-DATE-MM   TO PV-DISPLAY-DATE-MM   09630001
096310                    MOVE PV-DB2-DATE-DD   TO PV-DISPLAY-DATE-DD   09631001
096320                    MOVE PV-DB2-DATE-YY   TO PV-DISPLAY-DATE-YY   09632001
096330                    MOVE PV-DISPLAY-DATE  TO ASC-AD-DTE           09633001
096340                END-IF                                            09634001
096350                                                                  09635001
096360             WHEN SQLCODE = -305                                  09636001
096370                    MOVE SPACES           TO ASC-AD-DTE           09637001
096380                                                                  09638001
096390             WHEN SQLCODE = -904                                  09639001
096400             WHEN SQLCODE = -913                                  09640001
096410                  CONTINUE                                        09641001
096420                                                                  09642001
096430             WHEN SQLWARN0 NOT = SPACES                           09643001
096440             WHEN SQLCODE < +0                                    09644001
096450             WHEN SQLCODE > +0                                    09645001
096460                  MOVE '4090-GET-AD-DATE'                         09646001
096470                                  TO DP013-PARAGRAPH              09647001
096480                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           09648001
096490                                  TO DP013-MESSAGE-TEXT (1)       09649001
096500                  MOVE SQLCA      TO DP013-SQLCA                  09650001
096510                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     09651001
096520                  SET DP013-DB2-ABEND                             09652001
096530                      DP013-XCTL-DISPLAY-RESTART                  09653001
096540                                  TO TRUE                         09654001
096550                  PERFORM DP013-0000-PROCESS-ABEND                09655001
096560         END-EVALUATE                                             09656001
096570     END-PERFORM.                                                 09657001
096580                                                                  09658001
096590     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09659001
096600             AND (SQLCODE = -904 OR -913)                         09660001
096610         MOVE '4090-GET-AD-DATE'                                  09661001
096620                                  TO DP013-PARAGRAPH              09662001
096630         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            09663001
096640                                  TO DP013-MESSAGE-TEXT (1)       09664001
096650         MOVE SQLCA               TO DP013-SQLCA                  09665001
096660         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     09666001
096670         SET DP013-DB2-ABEND                                      09667001
096680             DP013-XCTL-DISPLAY-RESTART                           09668001
096690                                  TO TRUE                         09669001
096700         PERFORM DP013-0000-PROCESS-ABEND                         09670001
096710     END-IF.                                                      09671001
096720                                                                  09672001
096730/                                                                 09673001
096740*----------------------------------------------------------------*09674001
096750*    CHECK TO SEE IF ALL PACKING SLIP IND FIELDS HAVE SAME VALUE *09675001
096760*----------------------------------------------------------------*09676001
096770/                                                                 09677001
096780 4110-SELECT-TRECITM.                                             09678001
096790     MOVE SPACE TO ASC-TKT-DESC.                                  09679001
096800     PERFORM 4111-SELECT-ONE-TKT-FMT.                             09680001
096810     IF ASC-TKT-FMT-ID = SPACE                                    09681001
096820         SET  PS-NO-CITM-FOUND TO TRUE                            09682001
096830     ELSE                                                         09683001
096840         IF ASC-TKT-DESC = 'MULTIPLE'                             09684001
096850             SET PS-CITM-FOUND TO TRUE                            09685001
096860          ELSE                                                    09686001
096870              PERFORM 4300-GET-TKT-DESC                           09687001
096880              SET PS-CITM-FOUND TO TRUE                           09688001
096890          END-IF                                                  09689001
096900     END-IF.                                                      09690001
096910     IF PS-NO-CITM-FOUND                                          09691001
096920         PERFORM 4121-SELECT-PRETIC-TKT-FMT                       09692001
096930           IF PS-PRETIC-FOUND                                     09693001
096940               CONTINUE                                           09694001
096950           ELSE                                                   09695001
096960               PERFORM 4130-GET-VSM-TKTTYPE                       09696001
096970               IF PS-VSM                                          09697001
096980                   MOVE VSCHVL-CHARTC-VAL-DESC                    09698001
096990                       TO ASC-TKT-DESC                            09699001
097000               ELSE                                               09700001
097010                    PERFORM 4150-SELECT-DEFAULT-TYPE              09701001
097020                    MOVE VSCHVL-CHARTC-VAL-DESC                   09702001
097030                       TO ASC-TKT-DESC                            09703001
097040               END-IF                                             09704001
097050           END-IF                                                 09705001
097060     END-IF.                                                      09706001
097070 4111-SELECT-ONE-TKT-FMT.                                         09707001
097080     EXEC SQL                                                     09708001
097090         SELECT MIN(TKT_FMT_ID)                                   09709001
097100              , MAX(TKT_FMT_ID)                                   09710001
097110             INTO :DK-TKT-FMT-ID-MIN :DN-TKT-FMT-ID-MIN           09711001
097120                 ,:DK-TKT-FMT-ID-MAX :DN-TKT-FMT-ID-MAX           09712001
097130             FROM                                                 09713001
097140              TRECITM                                             09714001
097150              WHERE                                               09715001
097160                  ORD_NBR =     :DK-PO-NBR                        09716001
097170              AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                   09717001
097180      END-EXEC                                                    09718001
097190         EVALUATE TRUE                                            09719001
097200             WHEN SQLCODE = +0                                    09720001
097210                  IF  DN-TKT-FMT-ID-MIN =  -1                     09721001
097220                      MOVE SPACES     TO ASC-TKT-FMT-ID           09722001
097230                      SET PS-NO-CITM-FOUND TO TRUE                09723001
097240                  ELSE                                            09724001
097250                      IF DK-TKT-FMT-ID-MIN =                      09725001
097260                             DK-TKT-FMT-ID-MAX                    09726001
097270                          MOVE DK-TKT-FMT-ID-MIN                  09727001
097280                                         TO DK-TKT-FMT-ID         09728001
097290                                            ASC-TKT-FMT-ID        09729001
097300                           SET PS-CITM-FOUND TO TRUE              09730001
097310                       ELSE                                       09731001
097320                           MOVE 'MULTIPLE' TO ASC-TKT-DESC        09732001
097330                                              ASC-TKT-FMT-ID      09733001
097340                           SET PS-CITM-FOUND TO TRUE              09734001
097350                       END-IF                                     09735001
097360                  END-IF                                          09736001
097370                                                                  09737001
097380             WHEN SQLCODE = +100                                  09738001
097390                  MOVE SPACES            TO ASC-TKT-FMT-ID        09739001
097400                  SET PS-NO-CITM-FOUND TO TRUE                    09740001
097410                                                                  09741001
097420             WHEN SQLCODE = -904                                  09742001
097430             WHEN SQLCODE = -913                                  09743001
097440                  CONTINUE                                        09744001
097450                                                                  09745001
097460             WHEN SQLWARN0 NOT = SPACES                           09746001
097470             WHEN SQLCODE < +0                                    09747001
097480             WHEN SQLCODE > +0                                    09748001
097490                  MOVE '4110-SELECT-TRECITM'                      09749001
097500                                  TO DP013-PARAGRAPH              09750001
097510                  MOVE 'UNSUCCESSFUL SELECT ON TDCTFAS TABLE'     09751001
097520                                  TO DP013-MESSAGE-TEXT (1)       09752001
097530                  MOVE SQLCA      TO DP013-SQLCA                  09753001
097540                  MOVE 'TDCTFAS ' TO DP013-DB2-TABLE-NAME (1)     09754001
097550                  SET DP013-DB2-ABEND                             09755001
097560                      DP013-XCTL-DISPLAY-RESTART                  09756001
097570                                  TO TRUE                         09757001
097580                  PERFORM DP013-0000-PROCESS-ABEND                09758001
097590     END-EVALUATE.                                                09759001
097600 4121-SELECT-PRETIC-TKT-FMT.                                      09760001
097610     EXEC SQL                                                     09761001
097620         SELECT MIN(TKT_DESC)                                     09762001
097630              , MAX(TKT_DESC)                                     09763001
097640             INTO :DK-TKT-DESC-MIN  :DN-TKT-DESC                  09764001
097650                 ,:DK-TKT-DESC-MAX  :DN-TKT-DESC                  09765001
097660             FROM                                                 09766001
097670              TPTKREQ A                                           09767001
097680            , TPTKLNE B                                           09768001
097690              WHERE                                               09769001
097700                   A.PO_NBR      =     :DK-PO-NBR                 09770001
097710              AND  A.PO_REQ_NBR  =   B.PO_REQ_NBR                 09771001
097720      END-EXEC                                                    09772001
097730         EVALUATE TRUE                                            09773001
097740             WHEN SQLCODE = +0                                    09774001
097750                  IF  DN-TKT-DESC   = -1                          09775001
097760                      MOVE SPACES        TO ASC-TKT-DESC          09776001
097770                      SET PS-NO-PRETIC-FOUND TO TRUE              09777001
097780                  ELSE                                            09778001
097790                      IF DK-TKT-DESC-MIN =                        09779001
097800                           DK-TKT-DESC-MAX                        09780001
097810                           MOVE DK-TKT-DESC-MIN  TO ASC-TKT-DESC  09781001
097820                           SET PS-PRETIC-FOUND TO TRUE            09782001
097830                      ELSE                                        09783001
097840                          MOVE 'MULTIPLE'                         09784001
097850                                         TO ASC-TKT-DESC          09785001
097860                          SET PS-PRETIC-FOUND TO TRUE             09786001
097870                      END-IF                                      09787001
097880                   END-IF                                         09788001
097890             WHEN SQLCODE = +100                                  09789001
097900                  MOVE SPACES            TO ASC-TKT-DESC          09790001
097910                  SET PS-NO-PRETIC-FOUND TO TRUE                  09791001
097920                                                                  09792001
097930             WHEN SQLCODE = -904                                  09793001
097940             WHEN SQLCODE = -913                                  09794001
097950                  CONTINUE                                        09795001
097960                                                                  09796001
097970             WHEN SQLWARN0 NOT = SPACES                           09797001
097980             WHEN SQLCODE < +0                                    09798001
097990             WHEN SQLCODE > +0                                    09799001
098000                  MOVE '4120-SELECT-PRETIC-TKT-FMT'               09800001
098010                                  TO DP013-PARAGRAPH              09801001
098020                  MOVE 'UNSUCCESSFUL SELECT ON TPTKREQ TABLE'     09802001
098030                                  TO DP013-MESSAGE-TEXT (1)       09803001
098040                  MOVE SQLCA      TO DP013-SQLCA                  09804001
098050                  MOVE 'TDCTFAS ' TO DP013-DB2-TABLE-NAME (1)     09805001
098060                  SET DP013-DB2-ABEND                             09806001
098070                      DP013-XCTL-DISPLAY-RESTART                  09807001
098080                                  TO TRUE                         09808001
098090                  PERFORM DP013-0000-PROCESS-ABEND                09809001
098100     END-EVALUATE.                                                09810001
098110 4300-GET-TKT-DESC.                                               09811001
098120                                                                  09812005
098130      EXEC SQL                                                    09813001
098140          SELECT DISTINCT TKT_FMT_DESC                            09814001
098150                INTO :TKTFMT-TKT-FMT-DESC                         09815001
098160              FROM TTKTFMT                                        09816001
098170           WHERE                                                  09817001
098180              TKT_FMT_ID   = :DK-TKT-FMT-ID                       09818001
098190     END-EXEC                                                     09819001
098200                                                                  09820001
098210     EVALUATE TRUE                                                09821001
098220           WHEN SQLCODE = +0                                      09822001
098230             MOVE TKTFMT-TKT-FMT-DESC TO ASC-TKT-DESC             09823001
098240           WHEN SQLCODE = +100                                    09824001
098250                  MOVE SPACES    TO ASC-TKT-DESC                  09825001
098260             WHEN SQLCODE = -904                                  09826001
098270             WHEN SQLCODE = -911                                  09827001
098280             WHEN SQLCODE = -913                                  09828001
098290                  CONTINUE                                        09829001
098300             WHEN SQLWARN0 NOT = SPACES                           09830001
098310             WHEN SQLCODE  NOT = ZERO                             09831001
098320               DISPLAY 'RCKCS221 - DK-TKT-FMT-ID = ' DK-TKT-FMT-ID09832005
098330                  MOVE '4300-GET-TKT-DESC'                        09833001
098340                                 TO DP013-PARAGRAPH               09834001
098350                  MOVE 'UNSUCCESSFUL SELECT OF TTKTFMT'           09835001
098360                                 TO DP013-MESSAGE-TEXT (1)        09836001
098370                  MOVE DK-TKT-DESC                                09837001
098380                                 TO DP013-MESSAGE-TEXT (2)        09838001
098390                  MOVE SQLCA     TO DP013-SQLCA                   09839001
098400                  MOVE 'TTKTFMT' TO DP013-DB2-TABLE-NAME (1)      09840001
098410                  SET DP013-DB2-ABEND                             09841001
098420                      DP013-XCTL-DISPLAY-RESTART                  09842001
098430                                 TO TRUE                          09843001
098440                  PERFORM DP013-0000-PROCESS-ABEND                09844001
098450         END-EVALUATE.                                            09845001
098460                                                                  09846001
098470 4130-GET-VSM-TKTTYPE.                                            09847001
098480     MOVE ENTNME-ENT-ID       TO DK-ENT-ID.                       09848001
098490                                                                  09849001
098500     MOVE DCFAAS-CL-NBR                                           09850001
098510                             TO  PV-SUBCLASS                      09851001
098520*    MOVE TSK-MERCH-DEPT-NMBR                                     09852001
098530*                              TO DK-MERCH-DEPT-NMBR.             09853001
098540                                                                  09854001
098550     MOVE PV-SUBCLASS-NBR      TO  DK-SUBCLASS-NBR.               09855001
098560                                                                  09856001
098570     MOVE PV-SUBCLASS-MAJ-NBR  TO  PV-MAJCLASS-MAJ-NBR.           09857001
098580     MOVE PV-MAJCLASS-NBR      TO  DK-MAJCLASS-NBR .              09858001
098590                                                                  09859001
098600     EXEC SQL                                                     09860001
098610         SELECT DISTINCT                                          09861001
098620              A.MDSEAR_DKEY,                                      09862001
098630              B.VS_ID,                                            09863001
098640              B.ENT_ID,                                           09864001
098650              B.EFF_BEG_DTE,                                      09865001
098660              B.EFF_END_DTE,                                      09866001
098670              C.TKT_TYP_SEQ_NBR,                                  09867001
098680              C.HNG_FOLD_SEQ_NBR,                                 09868001
098690              CURRENT_DATE                                        09869001
098700         INTO                                                     09870001
098710             :MDSEAR-DKEY,                                        09871001
098720             :VNDSTL-VS-ID,                                       09872001
098730             :VNDSTL-ENT-ID,                                      09873001
098740             :VNDSTL-EFF-BEG-DTE     :PV-NULL-IND,                09874001
098750             :VNDSTL-EFF-END-DTE     :PV-NULL-IND,                09875001
098760             :MDARVS-TKT-TYP-SEQ-NBR :PV-NULL-IND,                09876001
098770             :MDARVS-HNG-FOLD-SEQ-NBR :PV-NULL-IND,               09877001
098780             :PC-CURRENT-DATE                                     09878001
098790         FROM                                                     09879001
098800              TMDSEAR A                                           09880001
098810            , TVNDSTL B                                           09881001
098820            , TMDARVS C                                           09882001
098830         WHERE                                                    09883001
098840                 A.MDSELV_CDE = :PC-SUBCLASS-MDSELV-CDE           09884001
098850           AND   A.DEPT_NBR   = :DK-DEPT-NBR                      09885001
098860* 2/23/12 BEGIN                                                   09886001
098870           AND   A.STRT_DTE  <=  CURRENT DATE                     09887001
098880           AND   A.END_DTE   >=  CURRENT DATE                     09888001
098890* 2/23/12 END                                                     09889001
098900           AND   B.ENT_ID     = :DK-ENT-ID                        09890001
098910           AND   A.SUB_CL_NBR = :DK-SUBCLASS-NBR                  09891001
098920           AND   C.SUB_CL_MDSEAR_ID = A.MDSEAR_DKEY               09892001
098930           AND   B.VS_ID      = C.VS_ID                           09893001
098940           AND   C.ACTV_IND   = 'Y'                               09894001
098950           AND   B.EFF_BEG_DTE <= CURRENT_DATE                    09895001
098960           AND   B.EFF_END_DTE IS NULL                            09896001
098970         END-EXEC.                                                09897001
098980                                                                  09898001
098990         EVALUATE TRUE                                            09899001
099000             WHEN SQLCODE = ZERO                                  09900001
099010                  MOVE MDARVS-TKT-TYP-SEQ-NBR TO                  09901001
099020                                            DK-TKT-TYP-SEQ-NBR    09902001
099030                  MOVE MDSEAR-DKEY TO DK-MDSEAR-ID                09903001
099040                  PERFORM  4140-SELECT-PRETIC-TYPE                09904001
099050             WHEN SQLCODE = -811                                  09905001
099060                  MOVE MDARVS-TKT-TYP-SEQ-NBR TO                  09906001
099070                                            DK-TKT-TYP-SEQ-NBR    09907001
099080                  MOVE MDSEAR-DKEY TO DK-MDSEAR-ID                09908001
099090                  PERFORM  4140-SELECT-PRETIC-TYPE                09909001
099100             WHEN SQLCODE = +100                                  09910001
099110                  SET PS-NOT-VSM    TO TRUE                       09911001
099120             WHEN SQLCODE = -904                                  09912001
099130             WHEN SQLCODE = -911                                  09913001
099140             WHEN SQLCODE = -913                                  09914001
099150                  CONTINUE                                        09915001
099160             WHEN SQLWARN0 NOT = SPACE                            09916001
099170             WHEN SQLCODE NOT = ZERO                              09917001
099180                  MOVE '4130-SELECT-VSM-TKT-TYPE'                 09918001
099190                                   TO DP013-PARAGRAPH             09919001
099200                  MOVE 'SELECT TICKET TYPE FROM VNDR STYLE TABLE' 09920001
099210                                   TO DP013-MESSAGE-TEXT (1)      09921001
099220                  MOVE SQLCA       TO DP013-SQLCA                 09922001
099230                  SET DP013-DB2-ABEND                             09923001
099240                                   TO TRUE                        09924001
099250                  PERFORM DP013-0000-PROCESS-ABEND                09925001
099260         END-EVALUATE.                                            09926001
099270 4140-SELECT-PRETIC-TYPE.                                         09927001
099280         EXEC SQL                                                 09928001
099290             SELECT  DISTINCT                                     09929001
099300                     CHARTC_VAL_DESC                              09930001
099310             INTO                                                 09931001
099320                    :VSCHVL-CHARTC-VAL-DESC                       09932001
099330             FROM                                                 09933001
099340                    TDCVSVL A                                     09934001
099350                   ,TVSCHVL B                                     09935001
099360             WHERE                                                09936001
099370                   A.MDSEAR_ID      = :DK-MDSEAR-ID               09937001
099380               AND B.CHARTC_CDE     = :PC-VS-TICKET-TYPE-CDE      09938001
099390               AND A.PRIM_IND       = 'Y'                         09939001
099400               AND A.CHARTC_CDE     = B.CHARTC_CDE                09940001
099410               AND A.CHARTC_SEQ_NBR = :DK-TKT-TYP-SEQ-NBR         09941001
099420               AND A.CHARTC_SEQ_NBR = B.CHARTC_SEQ_NBR            09942001
099430               AND B.STAT_CDE       = 'A'                         09943001
099440         END-EXEC.                                                09944001
099450                                                                  09945001
099460                                                                  09946001
099470         EVALUATE TRUE                                            09947001
099480             WHEN SQLCODE = ZERO                                  09948001
099490                  MOVE  VSCHVL-CHARTC-VAL-DESC  TO                09949001
099500                       ASC-TKT-DESC                               09950001
099510                  SET PS-VSM   TO TRUE                            09951001
099520             WHEN SQLCODE = -811                                  09952001
099530                  MOVE  VSCHVL-CHARTC-VAL-DESC  TO                09953001
099540                       ASC-TKT-DESC                               09954001
099550                  SET PS-VSM   TO TRUE                            09955001
099560             WHEN SQLCODE = +100                                  09956001
099570                  SET PS-NOT-VSM    TO TRUE                       09957001
099580             WHEN SQLCODE = -904                                  09958001
099590             WHEN SQLCODE = -911                                  09959001
099600             WHEN SQLCODE = -913                                  09960001
099610                  CONTINUE                                        09961001
099620             WHEN SQLWARN0 NOT = SPACE                            09962001
099630             WHEN SQLCODE NOT = ZERO                              09963001
099640                  MOVE '4140-SELECT-PRETIC-TYPE'                  09964001
099650                                   TO DP013-PARAGRAPH             09965001
099660                  MOVE 'SELECT TICKET TYPE FROM VNDR STYLE TABLE' 09966001
099670                                   TO DP013-MESSAGE-TEXT (1)      09967001
099680                  MOVE SQLCA       TO DP013-SQLCA                 09968001
099690                  SET DP013-DB2-ABEND                             09969001
099700                                   TO TRUE                        09970001
099710                  PERFORM DP013-0000-PROCESS-ABEND                09971001
099720         END-EVALUATE.                                            09972001
099730 4150-SELECT-DEFAULT-TYPE.                                        09973001
099740*  MOVE TSK-MERCH-DEPT-NMBR                                       09974001
099750*                            TO DK-DEPT-NBR                       09975001
099760                                                                  09976001
099770     MOVE DCFAAS-CL-NBR                                           09977001
099780                               TO  PV-SUBCLASS                    09978001
099790     MOVE PV-SUBCLASS-NBR      TO  DK-SUBCLASS-NBR                09979001
099800                                                                  09980001
099810     MOVE PV-SUBCLASS-MAJ-NBR  TO  PV-MAJCLASS-MAJ-NBR            09981001
099820     MOVE PV-MAJCLASS-NBR      TO  DK-MAJCLASS-NBR                09982001
099830                                                                  09983001
099840     PERFORM                                                      09984001
099850         WITH TEST AFTER                                          09985001
099860         VARYING PV-RETRY-COUNTER                                 09986001
099870         FROM 1 BY 1                                              09987001
099880         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09988001
099890                   OR (SQLCODE = ZERO)                            09989001
099900                   OR (SQLCODE = +100))                           09990001
099910                                                                  09991001
099920*  FIRST TRY THE DEFAULT AT THE SUBCLASS LEVEL                    09992001
099930         EXEC SQL                                                 09993001
099940             SELECT                                               09994001
099950                     CHARTC_VAL_DESC                              09995001
099960             INTO                                                 09996001
099970                    :VSCHVL-CHARTC-VAL-DESC                       09997001
099980             FROM                                                 09998001
099990                    TMDSEAR A                                     09999001
100000                   ,TDCVSVL B                                     10000001
100010                   ,TVSCHVL C                                     10001001
100020             WHERE                                                10002001
100030                   A.MDSELV_CDE     = :PC-SUBCLASS-MDSELV-CDE     10003001
100040               AND A.DEPT_NBR       = :DK-DEPT-NBR                10004001
100050               AND A.SUB_CL_NBR     = :DK-SUBCLASS-NBR            10005001
100060               AND A.MDSEAR_DKEY    = B.MDSEAR_ID                 10006001
100070* 2/23/12 BEGIN                                                   10007001
100080               AND A.STRT_DTE      <=  CURRENT DATE               10008001
100090               AND A.END_DTE       >=  CURRENT DATE               10009001
100100* 2/23/12 END                                                     10010001
100110               AND B.CHARTC_CDE     = :PC-VS-TICKET-TYPE-CDE      10011001
100120               AND B.PRIM_IND       = 'Y'                         10012001
100130               AND B.CHARTC_CDE     = C.CHARTC_CDE                10013001
100140               AND B.CHARTC_SEQ_NBR = C.CHARTC_SEQ_NBR            10014001
100150               AND C.STAT_CDE       = 'A'                         10015001
100160         END-EXEC                                                 10016001
100170                                                                  10017001
100180         EVALUATE TRUE                                            10018001
100190             WHEN SQLCODE = ZERO                                  10019001
100200             WHEN SQLCODE = +100                                  10020001
100210             WHEN SQLCODE = -904                                  10021001
100220             WHEN SQLCODE = -913                                  10022001
100230                 CONTINUE                                         10023001
100240                                                                  10024001
100250             WHEN SQLWARN0 NOT = SPACES                           10025001
100260             WHEN SQLCODE < ZERO                                  10026001
100270             WHEN SQLCODE > ZERO                                  10027001
100280                 MOVE '4320-GET-DEFAULT-TICKET-TYPE'              10028001
100290                                   TO DP013-PARAGRAPH             10029001
100300                 MOVE 'SELECT THE SUBCLASS DEFAULT TICKET TYPE'   10030001
100310                                   TO DP013-MESSAGE-TEXT (1)      10031001
100320                 MOVE DK-DEPT-NBR  TO DP013-MESSAGE-TEXT (2)      10032001
100330                 MOVE DK-SUBCLASS-NBR                             10033001
100340                                   TO DP013-MESSAGE-TEXT (3)      10034001
100350                 MOVE SQLCA        TO DP013-SQLCA                 10035001
100360                 MOVE 'TMDSEAR'    TO DP013-DB2-TABLE-NAME (1)    10036001
100370                 MOVE 'TDCVSVL'    TO DP013-DB2-TABLE-NAME (2)    10037001
100380                 MOVE 'TVSCHVL'    TO DP013-DB2-TABLE-NAME (3)    10038001
100390                 SET DP013-DB2-ABEND                              10039001
100400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10040001
100410                 PERFORM DP013-0000-PROCESS-ABEND                 10041001
100420         END-EVALUATE                                             10042001
100430                                                                  10043001
100440*  IF NOT SUBCLASS LEVEL, TRY AS THE MAJOR CLASS LEVEL            10044001
100450         IF SQLCODE = +100                                        10045001
100460             EXEC SQL                                             10046001
100470                 SELECT                                           10047001
100480                         CHARTC_VAL_DESC                          10048001
100490                 INTO                                             10049001
100500                        :VSCHVL-CHARTC-VAL-DESC                   10050001
100510                 FROM                                             10051001
100520                        TMDSEAR A                                 10052001
100530                       ,TDCVSVL B                                 10053001
100540                       ,TVSCHVL C                                 10054001
100550                 WHERE                                            10055001
100560                       A.MDSELV_CDE     = :PC-MAJCLASS-MDSELV-CDE 10056001
100570                   AND A.DEPT_NBR       = :DK-DEPT-NBR            10057001
100580                   AND A.MAJ_CL_NBR     = :DK-MAJCLASS-NBR        10058001
100590                   AND A.MDSEAR_DKEY    = B.MDSEAR_ID             10059001
100600* 2/23/12 BEGIN                                                   10060001
100610                   AND A.STRT_DTE      <=  CURRENT DATE           10061001
100620                   AND A.END_DTE       >=  CURRENT DATE           10062001
100630* 2/23/12 END                                                     10063001
100640                   AND B.CHARTC_CDE     = :PC-VS-TICKET-TYPE-CDE  10064001
100650                   AND B.PRIM_IND       = 'Y'                     10065001
100660                   AND B.CHARTC_CDE     = C.CHARTC_CDE            10066001
100670                   AND B.CHARTC_SEQ_NBR = C.CHARTC_SEQ_NBR        10067001
100680                   AND C.STAT_CDE       = 'A'                     10068001
100690             END-EXEC                                             10069001
100700                                                                  10070001
100710             EVALUATE TRUE                                        10071001
100720                 WHEN SQLCODE = ZERO                              10072001
100730                 WHEN SQLCODE = +100                              10073001
100740                 WHEN SQLCODE = -904                              10074001
100750                 WHEN SQLCODE = -913                              10075001
100760                     CONTINUE                                     10076001
100770                                                                  10077001
100780                 WHEN SQLWARN0 NOT = SPACES                       10078001
100790                 WHEN SQLCODE < ZERO                              10079001
100800                 WHEN SQLCODE > ZERO                              10080001
100810                     MOVE '4320-GET-DEFAULT-TICKET-TYPE'          10081001
100820                                       TO DP013-PARAGRAPH         10082001
100830                     MOVE 'SELECT THE MAJOR CLASS TICKET TYPE'    10083001
100840                                       TO DP013-MESSAGE-TEXT (1)  10084001
100850                     MOVE DK-DEPT-NBR  TO DP013-MESSAGE-TEXT (2)  10085001
100860                     MOVE DK-MAJCLASS-NBR                         10086001
100870                                       TO DP013-MESSAGE-TEXT (3)  10087001
100880                     MOVE SQLCA        TO DP013-SQLCA             10088001
100890                     MOVE 'TMDSEAR'    TO DP013-DB2-TABLE-NAME (1)10089001
100900                     MOVE 'TDCVSVL'    TO DP013-DB2-TABLE-NAME (2)10090001
100910                     MOVE 'TVSCHVL'    TO DP013-DB2-TABLE-NAME (3)10091001
100920                     SET DP013-DB2-ABEND                          10092001
100930                         DP013-XCTL-DISPLAY-RESTART TO TRUE       10093001
100940                     PERFORM DP013-0000-PROCESS-ABEND             10094001
100950             END-EVALUATE                                         10095001
100960         END-IF                                                   10096001
100970                                                                  10097001
100980* OTHERWISE TRY AT THE DEPARTMENT LEVEL                           10098001
100990       IF SQLCODE = +100                                          10099001
101000           EXEC SQL                                               10100001
101010               SELECT                                             10101001
101020                       CHARTC_VAL_DESC                            10102001
101030               INTO                                               10103001
101040                      :VSCHVL-CHARTC-VAL-DESC                     10104001
101050               FROM                                               10105001
101060                      TMDSEAR A                                   10106001
101070                     ,TDCVSVL B                                   10107001
101080                     ,TVSCHVL C                                   10108001
101090               WHERE                                              10109001
101100                     A.MDSELV_CDE     = :PC-DPT-MDSELV-CDE        10110001
101110                 AND A.DEPT_NBR       = :DK-DEPT-NBR              10111001
101120                 AND A.MDSEAR_DKEY    = B.MDSEAR_ID               10112001
101130* 2/23/12 BEGIN                                                   10113001
101140                 AND A.STRT_DTE      <=  CURRENT DATE             10114001
101150                 AND A.END_DTE       >=  CURRENT DATE             10115001
101160* 2/23/12 END                                                     10116001
101170                 AND B.CHARTC_CDE     = :PC-VS-TICKET-TYPE-CDE    10117001
101180                 AND B.PRIM_IND       = 'Y'                       10118001
101190                 AND B.CHARTC_CDE     = C.CHARTC_CDE              10119001
101200                 AND B.CHARTC_SEQ_NBR = C.CHARTC_SEQ_NBR          10120001
101210                 AND C.STAT_CDE       = 'A'                       10121001
101220           END-EXEC                                               10122001
101230                                                                  10123001
101240           EVALUATE TRUE                                          10124001
101250               WHEN SQLCODE = ZERO                                10125001
101260               WHEN SQLCODE = +100                                10126001
101270               WHEN SQLCODE = -904                                10127001
101280               WHEN SQLCODE = -913                                10128001
101290                   CONTINUE                                       10129001
101300                                                                  10130001
101310               WHEN SQLWARN0 NOT = SPACES                         10131001
101320               WHEN SQLCODE < ZERO                                10132001
101330               WHEN SQLCODE > ZERO                                10133001
101340                   MOVE '4320-GET-DEFAULT-TICKET-TYPE'            10134001
101350                                    TO DP013-PARAGRAPH            10135001
101360                   MOVE 'SELECT THE DEFAULT TICKET TYPE'          10136001
101370                                    TO DP013-MESSAGE-TEXT (1)     10137001
101380                   MOVE DK-DEPT-NBR  TO DP013-MESSAGE-TEXT (2)    10138001
101390                   MOVE PC-DPT-MDSELV-CDE TO                      10139001
101400                                        DP013-MESSAGE-TEXT (3)    10140001
101410                   MOVE PC-VS-TICKET-TYPE-CDE TO                  10141001
101420                                        DP013-MESSAGE-TEXT (4)    10142001
101430                   MOVE SQLCA       TO DP013-SQLCA                10143001
101440                   MOVE 'TMDSEAR'   TO DP013-DB2-TABLE-NAME (1)   10144001
101450                   MOVE 'TDCVSVL'   TO DP013-DB2-TABLE-NAME (2)   10145001
101460                   MOVE 'TVSCHVL'   TO DP013-DB2-TABLE-NAME (3)   10146001
101470                   SET DP013-DB2-ABEND                            10147001
101480                       DP013-XCTL-DISPLAY-RESTART TO TRUE         10148001
101490                   PERFORM DP013-0000-PROCESS-ABEND               10149001
101500           END-EVALUATE                                           10150001
101510       END-IF                                                     10151001
101520                                                                  10152001
101530     END-PERFORM.                                                 10153001
101540                                                                  10154001
101550     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10155001
101560         MOVE '4110-GET-LEAD-TIME' TO DP013-PARAGRAPH             10156001
101570         MOVE 'MAXIMUM RETRIES EXCEEDED SELECTING VND LEAD TIME'  10157001
101580                                   TO DP013-MESSAGE-TEXT (1)      10158001
101590         MOVE DK-DEPT-NBR          TO DP013-MESSAGE-TEXT (2)      10159001
101600         MOVE DK-SUBCLASS-NBR      TO DP013-MESSAGE-TEXT (3)      10160001
101610         MOVE SQLCA                TO DP013-SQLCA                 10161001
101620         MOVE 'TMDSEAR'            TO DP013-DB2-TABLE-NAME (1)    10162001
101630         MOVE 'TDCVSVL'            TO DP013-DB2-TABLE-NAME (2)    10163001
101640         MOVE 'TVSCHVL'            TO DP013-DB2-TABLE-NAME (3)    10164001
101650         SET DP013-DB2-ABEND                                      10165001
101660             DP013-XCTL-DISPLAY-RESTART                           10166001
101670                                   TO TRUE                        10167001
101680         PERFORM DP013-0000-PROCESS-ABEND                         10168001
101690     END-IF.                                                      10169001
101700                                                                  10170001
101710     IF SQLCODE = +100                                            10171001
101720         MOVE SPACES       TO ASC-TKT-DESC                        10172001
101730     END-IF.                                                      10173001
101740*    END-PERFORM.                                                 10174001
101750*    PERFORM                                                      10175001
101760*        WITH TEST AFTER                                          10176001
101770*        VARYING PV-RETRY-COUNTER                                 10177001
101780*        FROM 1 BY 1                                              10178001
101790**       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10179001
101800*            OR (SQLCODE = +0)                                    10180001
101810*            OR (SQLCODE = +100))                                 10181001
101820*                                                                 10182001
101830*        EXEC SQL                                                 10183001
101840*             SELECT TKT_FMT_ID                                   10184001
101850*               INTO :DCTFAS-TKT-FMT-ID                           10185001
101860*               FROM TDCTFAS A                                    10186001
101870*              WHERE A.OPER_UNT_ID = :DK-OPER-UNT-ID              10187001
101880*                AND A.FCLTY_ID    = :DK-FCLTY-ID                 10188001
101890*                AND A.DEPT_NBR    = :DK-DEPT-NBR                 10189001
101900*                AND A.RANK_NBR    = 1                            10190001
101910*                AND A.CL_NBR            =                        10191001
101920*                   (SELECT MIN(B.CL_NBR)                         10192001
101930*                     FROM TPURITM B                              10193001
101940*                    WHERE B.PO_NBR      = :DK-PO-NBR             10194001
101950*                      AND B.VER_STATUS_CDE = 'A')                10195001
101960*        END-EXEC                                                 10196001
101970                                                                  10197001
101980*        EVALUATE TRUE                                            10198001
101990*            WHEN SQLCODE = +0                                    10199001
102000*                 IF  DN-TKT-FMT-ID = -1                          10200001
102010*                     MOVE SPACES        TO ASC-TKT-FMT-ID        10201001
102020*                 ELSE                                            10202001
102030*                     MOVE DCTFAS-TKT-FMT-ID                      10203001
102040*                                        TO ASC-TKT-FMT-ID        10204001
102050*                 END-IF                                          10205001
102060*                                                                 10206001
102070*            WHEN SQLCODE = +100                                  10207001
102080*                 MOVE SPACES            TO ASC-TKT-FMT-ID        10208001
102090*                                                                 10209001
102100*            WHEN SQLCODE = -904                                  10210001
102110*            WHEN SQLCODE = -913                                  10211001
102120*                 CONTINUE                                        10212001
102130                                                                  10213001
102140*            WHEN SQLWARN0 NOT = SPACES                           10214001
102150*            WHEN SQLCODE < +0                                    10215001
102160*            WHEN SQLCODE > +0                                    10216001
102170*                 MOVE '4110-SELECT-TDCTFAS'                      10217001
102180*                                 TO DP013-PARAGRAPH              10218001
102190*                 MOVE 'UNSUCCESSFUL SELECT ON TDCTFAS TABLE'     10219001
102200*                                 TO DP013-MESSAGE-TEXT (1)       10220001
102210*                 MOVE SQLCA      TO DP013-SQLCA                  10221001
102220*                 MOVE 'TDCTFAS ' TO DP013-DB2-TABLE-NAME (1)     10222001
102230*                 SET DP013-DB2-ABEND                             10223001
102240*                     DP013-XCTL-DISPLAY-RESTART                  10224001
102250*                                 TO TRUE                         10225001
102260*                 PERFORM DP013-0000-PROCESS-ABEND                10226001
102270*        END-EVALUATE                                             10227001
102280*    END-PERFORM.                                                 10228001
102290*                                                                 10229001
102300*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10230001
102310*            AND (SQLCODE = -904 OR -913)                         10231001
102320*        MOVE '4110-SELECT-TDCTFAS'  TO DP013-PARAGRAPH           10232001
102330*        MOVE 'MAX RETRIES EXCEEDED ON SELECT TICKET FORMAT ASSIG'10233001
102340**                                TO DP013-MESSAGE-TEXT (1)       10234001
102350*        MOVE SQLCA               TO DP013-SQLCA                  10235001
102360*        MOVE 'TDCTFAS'           TO DP013-DB2-TABLE-NAME (1)     10236001
102370*        SET DP013-DB2-ABEND                                      10237001
102380*            DP013-XCTL-DISPLAY-RESTART                           10238001
102390**                                TO TRUE                         10239001
102400*        PERFORM DP013-0000-PROCESS-ABEND                         10240001
102410**   END-IF.                                                      10241001
102420                                                                  10242001
102430/                                                                 10243001
102440 4200-TROUBLE-DESC.                                               10244001
102450                                                                  10245001
102460     PERFORM                                                      10246001
102470         WITH TEST AFTER                                          10247001
102480         VARYING PV-RETRY-COUNTER                                 10248001
102490         FROM 1 BY 1                                              10249001
102500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10250001
102510            OR (SQLCODE = +0 OR +100 OR -811))                    10251001
102520                                                                  10252001
102530         EXEC SQL                                                 10253001
102540             SELECT B.TRBL_SHT_DESC                               10254001
102541                  , A.NOTIF_TMST                                  10254128
102550             INTO :TRBRSN-TRBL-SHT-DESC                           10255001
102551                , :TRBNTF-NOTIF-TMST                              10255128
102560             FROM  TTRBNTF A                                      10256001
102570                  ,TTRBRSN B                                      10257001
102580             WHERE A.PO_NBR           = :DK-PO-NBR                10258001
102590                   AND A.REC_SEQ_NBR  = :DK-REC-SEQ-NBR           10259001
102600                   AND A.RESOLVED_IND IN (:PC-N, :PC-I)           10260001
102610                   AND A.TRBL_RSN_CDE = B.TRBL_RSN_CDE            10261001
102620                   AND B.TRBL_INITR_CDE <> 'T'                    10262001
102621             ORDER BY A.NOTIF_TMST                                10262129
102630         END-EXEC                                                 10263001
102640                                                                  10264001
102650         EVALUATE TRUE                                            10265001
102660             WHEN SQLCODE = +0                                    10266001
102670                 MOVE TRBRSN-TRBL-SHT-DESC TO ASC-TRBL-DESC       10267001
102680             WHEN SQLCODE = -811                                  10268001
102690                 STRING TRBRSN-TRBL-SHT-DESC '*'                  10269001
102700                     DELIMITED BY SIZE                            10270001
102710                     INTO ASC-TRBL-DESC                           10271001
102720             WHEN SQLCODE = +100                                  10272001
102730                 MOVE SPACES               TO ASC-TRBL-DESC       10273001
102740             WHEN SQLCODE = -904                                  10274001
102750             WHEN SQLCODE = -913                                  10275001
102760                 CONTINUE                                         10276001
102770                                                                  10277001
102780             WHEN SQLWARN0 NOT = SPACE                            10278001
102790             WHEN SQLCODE < ZERO                                  10279001
102800             WHEN SQLCODE > ZERO                                  10280001
102810                 MOVE '4200-TROUBLE-DESC'                         10281001
102820                                 TO DP013-PARAGRAPH               10282001
102830                 MOVE 'SELECT ON TTRBNTF/TTRBRSN'                 10283001
102840                                 TO DP013-MESSAGE-TEXT (1)        10284001
102850                 MOVE SQLCA      TO DP013-SQLCA                   10285001
102860                 MOVE 'TTRBNTF'  TO DP013-DB2-TABLE-NAME (1)      10286001
102870                 MOVE 'TTRBRSN'  TO DP013-DB2-TABLE-NAME (2)      10287001
102880                 SET DP013-DB2-ABEND                              10288001
102890                                 TO TRUE                          10289001
102900                 SET DP013-XCTL-DISPLAY-RESTART                   10290001
102910                                 TO TRUE                          10291001
102920                 PERFORM DP013-0000-PROCESS-ABEND                 10292001
102930         END-EVALUATE                                             10293001
102940     END-PERFORM.                                                 10294001
102950                                                                  10295001
102960     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10296001
102970         AND (SQLCODE = -904 OR -913)                             10297001
102980         MOVE '4200-TROUBLE-DESC'                                 10298001
102990                                 TO DP013-PARAGRAPH               10299001
103000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     10300001
103010                                 TO DP013-MESSAGE-TEXT (1)        10301001
103020         MOVE 'ON TTRBNTF'       TO DP013-MESSAGE-TEXT (2)        10302001
103030         MOVE SQLCA              TO DP013-SQLCA                   10303001
103040         MOVE 'TTRBNTF'          TO DP013-DB2-TABLE-NAME (1)      10304001
103050         MOVE 'TTRBRSN'          TO DP013-DB2-TABLE-NAME (2)      10305001
103060         SET DP013-DB2-ABEND     TO TRUE                          10306001
103070         SET DP013-XCTL-DISPLAY-RESTART                           10307001
103080                                 TO TRUE                          10308001
103090         PERFORM DP013-0000-PROCESS-ABEND                         10309001
103100     END-IF.                                                      10310001
103110                                                                  10311001
103120/                                                                 10312001
103130*----------------------------------------------------------------*10313001
103140* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *10314001
103150*----------------------------------------------------------------*10315001
103160                                                                  10316001
103170 4400-MOVE-COMMAREA-TO-SCREEN.                                    10317001
103180                                                                  10318001
103190     MOVE ASC-REC-SEQ-NBR         TO ARECSEQO.                    10319001
103200     MOVE ASC-PO-NBR-N            TO APONBRO.                     10320001
103210     MOVE ASC-TRBL-DESC           TO ATBLSTO.                     10321001
103220     MOVE ASC-ENT-NAME-DESC       TO AENTNMEO.                    10322001
103230     MOVE ASC-AP-RCVR-NBR-N       TO AAPRCVRO.                    10323001
103240     IF  ASC-PRE-RECEIVER-VENDOR                                  10324001
103250         MOVE 'PRE-RECEIVER VENDOR'                               10325001
103260                                  TO APRERCVO                     10326001
103270     ELSE                                                         10327001
103280         MOVE SPACES              TO APRERCVO                     10328001
103290     END-IF.                                                      10329001
103300     IF  ASC-ADD-FROM-MENU                                        10330001
103310         MOVE 'EXPENSE IND:'      TO AEXPLITO                     10331001
103320         MOVE ASC-EXPENSE-IND     TO AEXPINDO                     10332001
103330         MOVE SPACES              TO ANSLITO                      10333001
103340                                     ANSINDO                      10334001
103350     ELSE                                                         10335001
103360         MOVE SPACES              TO AEXPLITO                     10336001
103370                                     AEXPINDO                     10337001
103380         MOVE 'NEW STR PO..:'     TO ANSLITO                      10338001
103390         MOVE ASC-NEW-STR-PO-IND  TO ANSINDO                      10339001
103400     END-IF.                                                      10340001
103410     MOVE ASC-OWNER-SCAC-ID       TO ASCACO.                      10341001
103420     MOVE ASC-VEH-NBR             TO ATRLRO.                      10342001
103430* WR40574 02-15-2012 ADDED ACAN BELOW                             10343001
103440     IF  ASC-MULTIPLE-SHIPMENTS                                   10344001
103450         MOVE 'MULTIPLE'          TO APROO                        10345001
103460                                     ABOLO                        10346001
103470                                     ACANO                        10347001
103480     ELSE                                                         10348001
103490         MOVE ASC-PRO-NBR         TO APROO                        10349001
103500         MOVE ASC-BOL-NBR         TO ABOLO                        10350001
103510         MOVE ASC-CARR-AUTH-ID    TO ACANO                        10351001
103520     END-IF.                                                      10352001
103530     MOVE ASC-OWNR-SCAC-SHIP-DTE  TO ASHPDTO.                     10353001
103540     MOVE ASC-ARRIVAL-DISPLAY-DTE TO AARVDTO.                     10354001
103550     MOVE ASC-OPER-UNT-ID         TO AOPERO.                      10355001
103560     MOVE ASC-FCLTY-ID            TO AFCLTYO.                     10356001
103570     MOVE ASC-VEND-SHIP-DTE       TO AVNSHDTO.                    10357001
103580     MOVE ASC-CRE-UID             TO ACREUIDO.                    10358001
103610     MOVE ASC-OPER-SET-ID-N       TO AOPSETO.                     10361001
103620     MOVE ASC-OPER-SET-DESC       TO AOPDESCO.                    10362001
103630     MOVE ASC-TKT-DESC            TO ATKTTYPO.                    10363001
103640     MOVE ASC-KEY-TRIP-ID         TO PV-TRIP-ID-DISPLAY.          10364001
103650     MOVE PV-TRIP-ID-DISPLAY      TO ATRIPO.                      10365001
103660     MOVE ASC-EXPTED-CART-CNT-N   TO ACTNCNTO.                    10366001
103670     MOVE ASC-ASN-IND             TO AASNO.                       10367001
103680     MOVE ASC-EXPTED-CART-CNT-N   TO ACTNCNTO.                    10368001
103690     MOVE ASC-AD-DTE              TO AADDTEO.                     10369001
103700     IF  ASC-AD-DTE > SPACES                                      10370001
103710         MOVE DP015-YELLOW        TO AADDTEC                      10371001
103720     END-IF.                                                      10372001
103730     MOVE ASC-PRE-TKT-IND         TO APRETKTO.                    10373001
103740     MOVE ASC-HANGER-IND          TO AHANGERO.                    10374001
103750     MOVE ASC-ACTL-CART-CNT-N     TO AACTCNTO.                    10375001
103760     MOVE ASC-DMG-CART-CNT-N      TO ADMGCNTO.                    10376001
103770     MOVE ASC-PACK-BY-ST-IND      TO APKBYSTO.                    10377001
103780     MOVE ASC-RCVG-CLERK-INIT-ID  TO ACLERKO.                     10378001
103790     MOVE ASC-COPER-UNT-ID        TO ACOPERO.                     10379001
103800     MOVE ASC-CFCLTY-ID           TO ACFCLTYO.                    10380001
103810     MOVE ASC-APRON-LOC-DESC      TO AAPRLOCO.                    10381001
103820     IF ASC-ADD-PENDING                                           10382001
103830        IF ASC-REC-TYP > SPACES                                   10383001
103840           MOVE ASC-REC-TYP             TO ARECTYPO               10384001
103850        ELSE                                                      10385001
103860           MOVE 'MR' TO ASC-REC-TYP                               10386001
103870           MOVE ASC-REC-TYP             TO ARECTYPO               10387001
103880        END-IF                                                    10388001
103890     ELSE                                                         10389001
103900        MOVE ASC-REC-TYP             TO ARECTYPO                  10390001
103910     END-IF.                                                      10391001
103920     MOVE ASC-PKGNG-CDE           TO APKGCDEO.                    10392001
103930     EVALUATE ASC-PKGNG-CDE                                       10393001
103940         WHEN PC-I                                                10394001
103950             MOVE PC-INNER-PPK    TO APKGDSCO                     10395001
103960         WHEN PC-M                                                10396001
103970             MOVE PC-MULTI-SKU    TO APKGDSCO                     10397001
103980         WHEN PC-S                                                10398001
103990             MOVE PC-SINGLE-SKU   TO APKGDSCO                     10399001
104000         WHEN PC-C                                                10400001
104010             MOVE PC-CASEPACK     TO APKGDSCO                     10401001
104020         WHEN PC-B                                                10402001
104030             MOVE PC-BULK-PACK    TO APKGDSCO                     10403001
104040         WHEN LOW-VALUES                                          10404001
104050             MOVE PC-NOT-FOUND    TO APKGDSCO                     10405001
104060         WHEN OTHER                                               10406001
104070             MOVE SPACES          TO APKGDSCO                     10407001
104080     END-EVALUATE.                                                10408001
104090                                                                  10409001
104100     IF  ASC-ADD-PENDING                                          10410001
104110         IF (ASC-ADD-FROM-SHPPO                                   10411001
104120         AND ASC-SELECTION-MADE)                                  10412001
104130         OR  ASC-ADD-MULTIPLE                                     10413001
104140             MOVE -1              TO ASHPDTL                      10414001
104150         ELSE                                                     10415001
104160             MOVE -1              TO APONBRL                      10416001
104170         END-IF                                                   10417001
104180         SET DP030-SET-CURSOR-APPL-1                              10418001
104190                                  TO TRUE                         10419001
104200     ELSE                                                         10420001
104210         IF  ASC-UPDATE-PENDING                                   10421001
104220             IF  ASC-MULT-SHIP                                    10422001
104230                 MOVE -1          TO AOPSETL                      10423001
104240             ELSE                                                 10424001
104250                 MOVE -1          TO ASHPDTL                      10425001
104260             END-IF                                               10426001
104270             SET DP030-SET-CURSOR-APPL-1                          10427001
104280                                  TO TRUE                         10428001
104290         END-IF                                                   10429001
104300     END-IF.                                                      10430001
104310                                                                  10431001
104320/                                                                 10432001
104330 5000-ADD-RECEIVER.                                               10433001
104340                                                                  10434001
104350     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR.                    10435001
104360     MOVE ASC-KEY-REC-SEQ-NBR    TO DK-REC-SEQ-NBR.               10436001
104370     MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR.                   10437001
104380     MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID.             10438001
104390     MOVE ASC-KEY-STATUS-DTE     TO DK-STATUS-DTE.                10439001
104400                                                                  10440001
104410     IF  PS-NO-ERROR                                              10441001
104420         IF  ASC-EXPENSE-RECEIPT                                  10442001
104430         OR  ASC-DIRECT-STORE                                     10443001
104440             MOVE ASC-OPER-UNT-ID TO DK-OPER-UNT-ID               10444001
104450             MOVE ASC-FCLTY-ID    TO DK-FCLTY-ID                  10445001
104460             PERFORM 5015-GET-MAX-SEQ-NBR                         10446001
104470             MOVE PV-REC-SEQ-NBR  TO ASC-REC-SEQ-NBR              10447001
104480             PERFORM 5100-BUILD-RECEIVER-INFO                     10448001
104490         END-IF                                                   10449001
104500     END-IF.                                                      10450001
104510                                                                  10451001
104520     IF  ASC-EXPENSE-RECEIPT                                      10452001
104530     OR  ASC-DIRECT-STORE                                         10453001
104540         CONTINUE                                                 10454001
104550     ELSE                                                         10455001
104560         IF  PS-NO-ERROR                                          10456001
104570         AND ASC-TRIP-EXISTS                                      10457001
104580             IF  ASC-SHIPMENT-EXISTS                              10458001
104590             AND ASC-PO-DOESNT-EXIST                              10459001
104600                 IF ASC-VEND-SHIP-DTE > (SPACES OR ZEROES)        10460001
104610                    PERFORM 5005-UPDATE-TSHIPMT                   10461001
104620                 END-IF                                           10462001
104630                 PERFORM 5010-BUILD-PO-INFO                       10463001
104640                 IF  SQLCODE = +0                                 10464001
104650                     PERFORM 5100-BUILD-RECEIVER-INFO             10465001
104660                     IF PS-NO-ERROR                               10466001
104670                        PERFORM 5300-BUILD-ZERO-LINE-WORK-ORD     10467001
104680                     END-IF                                       10468001
104690                 END-IF                                           10469001
104700             ELSE                                                 10470001
104710                 IF  ASC-SHIPMENT-DOESNT-EXIST                    10471001
104720                     PERFORM 5050-BUILD-SHIPMENT-INFO             10472001
104730                     PERFORM 5010-BUILD-PO-INFO                   10473001
104740                 ELSE                                             10474001
104750                     IF ASC-VEND-SHIP-DTE > (SPACES OR ZEROES)    10475001
104760                        PERFORM 5005-UPDATE-TSHIPMT               10476001
104770                     END-IF                                       10477001
104780                     IF  ASC-PO-DOESNT-EXIST                      10478001
104790                         PERFORM 5010-BUILD-PO-INFO               10479001
104800                     END-IF                                       10480001
104810                 END-IF                                           10481001
104820                 IF  SQLCODE = +0                                 10482001
104830                     PERFORM 5100-BUILD-RECEIVER-INFO             10483001
104840                     IF PS-NO-ERROR                               10484001
104850                        PERFORM 5300-BUILD-ZERO-LINE-WORK-ORD     10485001
104860                     END-IF                                       10486001
104870                 END-IF                                           10487001
104880             END-IF                                               10488001
104890         END-IF                                                   10489001
104900     END-IF.                                                      10490001
104910                                                                  10491001
104920     IF  PS-NO-ERROR                                              10492001
104930         IF TM500-NO-TROUBLE                                      10493001
104940             MOVE PC-TSYMSG-00391    TO DP020-MSG-NUMBER          10494001
104950             MOVE ASC-REC-SEQ-NBR    TO DP020-MSG-TEXT            10495001
104960                                        ARECSEQO                  10496001
104970             MOVE ASC-REC-TYP        TO ARECTYPO                  10497001
104980* WR40574 02-09-2012 START CLT                                    10498001
104990             MOVE ASC-CARR-AUTH-ID   TO ACANO                     10499001
105000* WR40574 02-09-2012 END T CLT                                    10500001
105010         ELSE                                                     10501001
105020             MOVE PC-TSYMSG-00847    TO DP020-MSG-NUMBER          10502001
105030             MOVE ASC-REC-SEQ-NBR    TO DP020-MSG-TEXT            10503001
105040                                        ARECSEQO                  10504001
105050             MOVE ASC-TRBL-DESC      TO ATBLSTO                   10505001
105060             MOVE ASC-REC-TYP        TO ARECTYPO                  10506001
105070         END-IF                                                   10507001
105080         SET DP020-MSG-INFORMATIONAL                              10508001
105090             ASC-ADD-SUCCESSFUL  TO TRUE                          10509001
105100         IF  ASC-USE-SELECTION-QUEUE                              10510001
105110             PERFORM 5200-UPDATE-SELECTION-QUEUE                  10511001
105120         END-IF                                                   10512001
105130     END-IF.                                                      10513001
105140                                                                  10514001
105150     PERFORM 3500-SAVE-SCREEN-FIELDS.                             10515001
105160                                                                  10516001
105170*----------------------------------------------------------------*10517001
105180* UPDATE THE VENDOR SHIP DATE ON THE SHIPMENT TABLE              *10518001
105190*----------------------------------------------------------------*10519001
105200                                                                  10520001
105210 5005-UPDATE-TSHIPMT.                                             10521001
105220                                                                  10522001
105230     MOVE ASC-VEND-SHIP-DTE TO PV-DISPLAY-DATE.                   10523001
105240     MOVE PV-DISPLAY-DATE-MM TO PV-DB2-DATE-MM.                   10524001
105250     MOVE PV-DISPLAY-DATE-DD TO PV-DB2-DATE-DD.                   10525001
105260     MOVE PV-DISPLAY-DATE-YY TO PV-DB2-DATE-YY.                   10526001
105270     MOVE '-'                TO PV-DB2-DASH-1                     10527001
105280                                PV-DB2-DASH-2.                    10528001
105290     IF PV-DISPLAY-DATE-YY > '60'                                 10529001
105300        MOVE '19'            TO PV-DB2-DATE-CC                    10530001
105310     ELSE                                                         10531001
105320        MOVE '20'            TO PV-DB2-DATE-CC                    10532001
105330     END-IF.                                                      10533001
105340     MOVE PV-DB2-DATE        TO SHIPMT-VEND-SHIP-DTE.             10534001
105350                                                                  10535001
105360     PERFORM                                                      10536001
105370         WITH TEST AFTER                                          10537001
105380         VARYING PV-RETRY-COUNTER                                 10538001
105390         FROM 1 BY 1                                              10539001
105400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10540001
105410            OR (SQLCODE = +0)                                     10541001
105420            OR (SQLCODE = +100)                                   10542001
105430            OR (SQLCODE = -305))                                  10543001
105440                                                                  10544001
105450         EXEC SQL                                                 10545001
105460           UPDATE TSHIPMT                                         10546001
105470             SET  VEND_SHIP_DTE = :SHIPMT-VEND-SHIP-DTE           10547001
105480           WHERE  SHIPT_ID      = :ASC-SHIPT-ID                   10548001
105490         END-EXEC                                                 10549001
105500                                                                  10550001
105510         EVALUATE TRUE                                            10551001
105520             WHEN SQLCODE = +0                                    10552001
105530             WHEN SQLCODE = +100                                  10553001
105540             WHEN SQLCODE = -305                                  10554001
105550                                                                  10555001
105560             WHEN SQLCODE = -904                                  10556001
105570             WHEN SQLCODE = -913                                  10557001
105580                 CONTINUE                                         10558001
105590                                                                  10559001
105600             WHEN SQLWARN0 NOT = SPACE                            10560001
105610             WHEN SQLCODE < +0                                    10561001
105620             WHEN SQLCODE > +0                                    10562001
105630                 MOVE '5005-UPDATE-TSHIPMT   '                    10563001
105640                                 TO DP013-PARAGRAPH               10564001
105650                 MOVE 'SELECT MAX ON RECEIPTS TABLE'              10565001
105660                                 TO DP013-MESSAGE-TEXT (1)        10566001
105670                 MOVE SQLCA      TO DP013-SQLCA                   10567001
105680                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (1)      10568001
105690                     SET DP013-DB2-ABEND                          10569001
105700                         DP013-XCTL-DISPLAY-RESTART               10570001
105710                                     TO TRUE                      10571001
105720                 PERFORM DP013-0000-PROCESS-ABEND                 10572001
105730         END-EVALUATE                                             10573001
105740     END-PERFORM.                                                 10574001
105750                                                                  10575001
105760     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10576001
105770             AND (SQLCODE = -904 OR -913)                         10577001
105780         MOVE '5005-UPDATE-TSHIPMT   '                            10578001
105790                                  TO DP013-PARAGRAPH              10579001
105800         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TRECEIV'         10580001
105810                                  TO DP013-MESSAGE-TEXT (1)       10581001
105820         MOVE SQLCA               TO DP013-SQLCA                  10582001
105830         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     10583001
105840         SET DP013-DB2-ABEND                                      10584001
105850             DP013-XCTL-DISPLAY-RESTART                           10585001
105860                                  TO TRUE                         10586001
105870         PERFORM DP013-0000-PROCESS-ABEND                         10587001
105880     END-IF.                                                      10588001
105890                                                                  10589001
105900/                                                                 10590001
105910*----------------------------------------------------------------*10591001
105920* CREATE TSHPTPO ROW                                             *10592001
105930*----------------------------------------------------------------*10593001
105940                                                                  10594001
105950 5010-BUILD-PO-INFO.                                              10595001
105960                                                                  10596001
105970     INITIALIZE DCLTSHPTPO.                                       10597001
105980                                                                  10598001
105990     MOVE ASC-SHIPT-ID           TO DK-SHIPT-ID.                  10599001
106000     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR.                    10600001
106010                                                                  10601001
106020     IF  ASC-ADD-FROM-SHPPO                                       10602001
106030         CONTINUE                                                 10603001
106040     ELSE                                                         10604001
106050         INITIALIZE PV-DB2-COUNT                                  10605001
106060         PERFORM 5030-CHECK-DUPL-SHPPO                            10606001
106070         IF  PV-DB2-COUNT > +0                                    10607001
106080             SET PS-ERROR                                         10608001
106090                 DP020-MSG-FATAL    TO TRUE                       10609001
106100             MOVE PC-TSYMSG-00117   TO DP020-MSG-NUMBER           10610001
106110             MOVE DP015-UNP-ALP-BRT-OFF                           10611001
106120                                    TO APONBRA                    10612001
106130             MOVE DP015-RED         TO APONBRC                    10613001
106140             MOVE DP015-REVERSE     TO APONBRH                    10614001
106150             MOVE -1                TO APONBRL                    10615001
106160             SET DP030-SET-CURSOR-APPL-1                          10616001
106170                                    TO TRUE                       10617001
106180         END-IF                                                   10618001
106190     END-IF.                                                      10619001
106200                                                                  10620001
106210     IF  PS-NO-ERROR                                              10621001
106220         MOVE ASC-SHIPT-ID          TO SHPTPO-SHIPT-ID            10622001
106230         MOVE ASC-KEY-PO-NBR        TO SHPTPO-PO-NBR              10623001
106240         MOVE ASC-EXPTED-CART-CNT-N TO SHPTPO-EXPTED-CART-CNT     10624001
106250         MOVE ASC-ACTL-CART-CNT-N   TO SHPTPO-ACTL-CART-CNT       10625001
106260         MOVE ASC-DMG-CART-CNT-N    TO SHPTPO-DMG-CART-CNT        10626001
106270         MOVE ASC-OPER-UNT-ID       TO DK-OPER-UNT-ID             10627001
106280         MOVE ASC-FCLTY-ID          TO DK-FCLTY-ID                10628001
106290         PERFORM 5015-GET-MAX-SEQ-NBR                             10629001
106300         MOVE PV-REC-SEQ-NBR        TO SHPTPO-REC-SEQ-NBR         10630001
106310                                       ASC-REC-SEQ-NBR            10631001
106320         MOVE 'Y'                   TO SHPTPO-PRIM-SHIPT-IND      10632001
106330         PERFORM 5020-INSERT-TSHPTPO                              10633001
106340         MOVE SHPTPO-SHIPT-ID TO DK-SHIPT-ID                      10634001
106350         MOVE SHPTPO-PO-NBR   TO DK-PO-NBR                        10635001
106360         MOVE PC-A                  TO PV-TRN-CDE                 10636001
106370         PERFORM 8200-AUDIT-TSHPTPO                               10637001
106380     END-IF.                                                      10638001
106390                                                                  10639001
106400/                                                                 10640001
106410*----------------------------------------------------------------*10641001
106420* GET THE NEXT HIGHEST RECEIVER SEQ NBR                          *10642001
106430*----------------------------------------------------------------*10643001
106440 5015-GET-MAX-SEQ-NBR.                                            10644001
106450                                                                  10645001
106460     PERFORM                                                      10646001
106470         WITH TEST AFTER                                          10647001
106480         VARYING PV-RETRY-COUNTER                                 10648001
106490         FROM 1 BY 1                                              10649001
106500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10650001
106510            OR (SQLCODE = +0)                                     10651001
106520            OR (SQLCODE = -305))                                  10652001
106530                                                                  10653001
106540         EXEC SQL                                                 10654001
106550           SELECT MAX(REC_SEQ_NBR)                                10655001
106560           INTO  :RECEIV-REC-SEQ-NBR                              10656001
106570           FROM   TRECEIV                                         10657001
106580           WHERE  ORD_NBR = :DK-PO-NBR                            10658001
106590         END-EXEC                                                 10659001
106600                                                                  10660001
106610         EVALUATE TRUE                                            10661001
106620             WHEN SQLCODE = +0                                    10662001
106630                 MOVE RECEIV-REC-SEQ-NBR                          10663001
106640                                 TO PV-REC-SEQ-NBR                10664001
106650                 ADD +1          TO PV-REC-SEQ-NBR                10665001
106660                                                                  10666001
106670             WHEN SQLCODE = -305                                  10667001
106680                 MOVE +1         TO PV-REC-SEQ-NBR                10668001
106690                                                                  10669001
106700             WHEN SQLCODE = -904                                  10670001
106710             WHEN SQLCODE = -913                                  10671001
106720                 CONTINUE                                         10672001
106730                                                                  10673001
106740             WHEN SQLWARN0 NOT = SPACE                            10674001
106750             WHEN SQLCODE < +0                                    10675001
106760             WHEN SQLCODE > +0                                    10676001
106770                 MOVE '5015-GET-MAX-SEQ-NBR  '                    10677001
106780                                 TO DP013-PARAGRAPH               10678001
106790                 MOVE 'SELECT MAX ON RECEIPTS TABLE'              10679001
106800                                 TO DP013-MESSAGE-TEXT (1)        10680001
106810                 MOVE SQLCA      TO DP013-SQLCA                   10681001
106820                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      10682001
106830                     SET DP013-DB2-ABEND                          10683001
106840                         DP013-XCTL-DISPLAY-RESTART               10684001
106850                                     TO TRUE                      10685001
106860                 PERFORM DP013-0000-PROCESS-ABEND                 10686001
106870         END-EVALUATE                                             10687001
106880     END-PERFORM.                                                 10688001
106890                                                                  10689001
106900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10690001
106910             AND (SQLCODE = -904 OR -913)                         10691001
106920         MOVE '5015-GET-MAX-SEQ-NBR  '                            10692001
106930                                  TO DP013-PARAGRAPH              10693001
106940         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TRECEIV'         10694001
106950                                  TO DP013-MESSAGE-TEXT (1)       10695001
106960         MOVE SQLCA               TO DP013-SQLCA                  10696001
106970         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     10697001
106980         SET DP013-DB2-ABEND                                      10698001
106990             DP013-XCTL-DISPLAY-RESTART                           10699001
107000                                  TO TRUE                         10700001
107010         PERFORM DP013-0000-PROCESS-ABEND                         10701001
107020     END-IF.                                                      10702001
107030                                                                  10703001
107040/                                                                 10704001
107050 5020-INSERT-TSHPTPO.                                             10705001
107060* REMOVE INSERTING THE DEPT# (DEPT_NBR) INTO TSHPTO  WR/IR# 230ZZ*10706001
107070* LINES 094390/094610 DELETED                        WR/IR# 230ZZ*10707001
107080                                                                  10708001
107090     PERFORM                                                      10709001
107100         WITH TEST AFTER                                          10710001
107110         VARYING PV-RETRY-COUNTER                                 10711001
107120         FROM 1 BY 1                                              10712001
107130         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10713001
107140             OR (SQLCODE = +0))                                   10714001
107150                                                                  10715001
107160         EXEC SQL                                                 10716001
107170              INSERT INTO TSHPTPO                                 10717001
107180                     ( SHIPT_ID                                   10718001
107190                      ,PO_NBR                                     10719001
107200                      ,REC_SEQ_NBR                                10720001
107210                      ,EXPTED_CART_CNT                            10721001
107220                      ,ACTL_CART_CNT                              10722001
107230                      ,DMG_CART_CNT                               10723001
107240                      ,PKSL_IND                                   10724001
107250                      ,LAST_UPD_PGM_ID                            10725001
107260                      ,CRE_USER_ID                                10726001
107270                      ,CARR_LAST_UPD_DTE                          10727001
107280                      ,CARR_LAST_UPD_TIME                         10728001
107290                      ,VEND_LAST_UPD_DTE                          10729001
107300                      ,VEND_LAST_UPD_TIME                         10730001
107310                      ,CRE_TMST                                   10731001
107320                      ,LAST_UPD_DTE                               10732001
107330                      ,LAST_UPD_TIME                              10733001
107340                      ,LAST_UPD_USER_ID                           10734001
107350                      ,PRIM_SHIPT_IND                             10735001
107360                      ,SPLT_XMIT_IND                              10736001
107370                      ,SPLT_XMIT_DTE                              10737001
107380                      ,SPLT_XMIT_TM )                             10738001
107390              VALUES ( :SHPTPO-SHIPT-ID                           10739001
107400                      ,:SHPTPO-PO-NBR                             10740001
107410                      ,:SHPTPO-REC-SEQ-NBR                        10741001
107420                      ,:SHPTPO-EXPTED-CART-CNT                    10742001
107430                      ,:SHPTPO-ACTL-CART-CNT                      10743001
107440                      ,:SHPTPO-DMG-CART-CNT                       10744001
107450                      ,:SHPTPO-PKSL-IND                           10745001
107460                      ,:PC-CURRENT-PROGRAM-NAME                   10746001
107470                      ,:DP020-USERID                              10747001
107480                      ,:PC-DEFAULT-DATE                           10748001
107490                      ,:PC-DEFAULT-TIME                           10749001
107500                      ,:PC-DEFAULT-DATE                           10750001
107510                      ,:PC-DEFAULT-TIME                           10751001
107520                      ,CURRENT TIMESTAMP                          10752001
107530                      ,CURRENT DATE                               10753001
107540                      ,CURRENT TIME                               10754001
107550                      ,:DP020-USERID                              10755001
107560                      ,:SHPTPO-PRIM-SHIPT-IND                     10756001
107570                      ,:SHPTPO-SPLT-XMIT-IND                      10757001
107580                      ,:PC-DEFAULT-DATE                           10758001
107590                      ,:PC-DEFAULT-TIME )                         10759001
107600         END-EXEC                                                 10760001
107610                                                                  10761001
107620         EVALUATE TRUE                                            10762001
107630             WHEN SQLCODE = +0                                    10763001
107640             WHEN SQLCODE = -904                                  10764001
107650             WHEN SQLCODE = -913                                  10765001
107660                 CONTINUE                                         10766001
107670                                                                  10767001
107680             WHEN SQLWARN0 NOT = SPACE                            10768001
107690             WHEN SQLCODE < +0                                    10769001
107700             WHEN SQLCODE > +0                                    10770001
107710                 MOVE '5020-INSERT-TSHPTPO'                       10771001
107720                                 TO DP013-PARAGRAPH               10772001
107730                 MOVE 'INSERT ON TSHPTPO TABLE'                   10773001
107740                                 TO DP013-MESSAGE-TEXT (1)        10774001
107750                 MOVE SQLCA      TO DP013-SQLCA                   10775001
107760                 MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME (1)      10776001
107770                     SET DP013-DB2-ABEND                          10777001
107780                         DP013-XCTL-DISPLAY-RESTART               10778001
107790                                     TO TRUE                      10779001
107800                 PERFORM DP013-0000-PROCESS-ABEND                 10780001
107810         END-EVALUATE                                             10781001
107820     END-PERFORM.                                                 10782001
107830                                                                  10783001
107840     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10784001
107850             AND (SQLCODE = -904 OR -913)                         10785001
107860         MOVE '5020-INSERT-TSHPTPO'                               10786001
107870                                  TO DP013-PARAGRAPH              10787001
107880         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TSHPTPO'         10788001
107890                                  TO DP013-MESSAGE-TEXT (1)       10789001
107900         MOVE SQLCA               TO DP013-SQLCA                  10790001
107910         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     10791001
107920         SET DP013-DB2-ABEND                                      10792001
107930             DP013-XCTL-DISPLAY-RESTART                           10793001
107940                                  TO TRUE                         10794001
107950         PERFORM DP013-0000-PROCESS-ABEND                         10795001
107960     END-IF.                                                      10796001
107970                                                                  10797001
107980/                                                                 10798001
107990 5030-CHECK-DUPL-SHPPO.                                           10799001
108000                                                                  10800001
108010     PERFORM                                                      10801001
108020         WITH TEST AFTER                                          10802001
108030         VARYING PV-RETRY-COUNTER                                 10803001
108040         FROM 1 BY 1                                              10804001
108050         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10805001
108060             OR (SQLCODE = +0)                                    10806001
108070             OR (SQLCODE = +100))                                 10807001
108080                                                                  10808001
108090         EXEC SQL                                                 10809001
108100             SELECT COUNT(*)                                      10810001
108110              INTO  :PV-DB2-COUNT                                 10811001
108120           FROM   TSHPTPO                                         10812001
108130           WHERE  SHIPT_ID = :DK-SHIPT-ID                         10813001
108140             AND  PO_NBR   = :DK-PO-NBR                           10814001
108150         END-EXEC                                                 10815001
108160                                                                  10816001
108170         EVALUATE TRUE                                            10817001
108180             WHEN SQLCODE = +0                                    10818001
108190             WHEN SQLCODE = +100                                  10819001
108200             WHEN SQLCODE = -904                                  10820001
108210             WHEN SQLCODE = -913                                  10821001
108220                 CONTINUE                                         10822001
108230                                                                  10823001
108240             WHEN SQLWARN0 NOT = SPACES                           10824001
108250             WHEN SQLCODE < +0                                    10825001
108260             WHEN SQLCODE > +0                                    10826001
108270                 MOVE '5030-CHECK-DUPL-SHPPO   '                  10827001
108280                                   TO DP013-PARAGRAPH             10828001
108290                 MOVE 'SELECT A TSHPTPO ROW   '                   10829001
108300                                   TO DP013-MESSAGE-TEXT(1)       10830001
108310                 MOVE SQLCA        TO DP013-SQLCA                 10831001
108320                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    10832001
108330                 SET DP013-DB2-ABEND                              10833001
108340                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10834001
108350                 PERFORM DP013-0000-PROCESS-ABEND                 10835001
108360         END-EVALUATE                                             10836001
108370     END-PERFORM.                                                 10837001
108380                                                                  10838001
108390     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10839001
108400             AND (SQLCODE = -904 OR -913)                         10840001
108410         MOVE '5030-CHECK-DUPL-SHPPO   '                          10841001
108420                                   TO DP013-PARAGRAPH             10842001
108430         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              10843001
108440                                   TO DP013-MESSAGE-TEXT (1)      10844001
108450         MOVE 'TO SELECT A TSHPTPO ROW'                           10845001
108460                                   TO DP013-MESSAGE-TEXT (2)      10846001
108470         MOVE SQLCA                TO DP013-SQLCA                 10847001
108480         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    10848001
108490         SET DP013-DB2-ABEND                                      10849001
108500             DP013-XCTL-DISPLAY-RESTART                           10850001
108510                                   TO TRUE                        10851001
108520         PERFORM DP013-0000-PROCESS-ABEND                         10852001
108530     END-IF.                                                      10853001
108540                                                                  10854001
108550 5035-GET-REC-SEQ-NBR.                                            10855001
108560                                                                  10856001
108570     PERFORM                                                      10857001
108580         WITH TEST AFTER                                          10858001
108590         VARYING PV-RETRY-COUNTER                                 10859001
108600         FROM 1 BY 1                                              10860001
108610         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10861001
108620             OR (SQLCODE = +0)                                    10862001
108630             OR (SQLCODE = +100))                                 10863001
108640                                                                  10864001
108650         EXEC SQL                                                 10865001
108660             SELECT REC_SEQ_NBR                                   10866001
108670              INTO  :SHPTPO-REC-SEQ-NBR                           10867001
108680           FROM   TSHPTPO                                         10868001
108690           WHERE  SHIPT_ID = :DK-SHIPT-ID                         10869001
108700             AND  PO_NBR   = :DK-PO-NBR                           10870001
108710         END-EXEC                                                 10871001
108720                                                                  10872001
108730         EVALUATE TRUE                                            10873001
108740             WHEN SQLCODE = +0                                    10874001
108750             WHEN SQLCODE = +100                                  10875001
108760             WHEN SQLCODE = -904                                  10876001
108770             WHEN SQLCODE = -913                                  10877001
108780                 CONTINUE                                         10878001
108790                                                                  10879001
108800             WHEN SQLWARN0 NOT = SPACES                           10880001
108810             WHEN SQLCODE < +0                                    10881001
108820             WHEN SQLCODE > +0                                    10882001
108830                 MOVE '5035-GET-REC-SEQ-NBR'                      10883001
108840                                   TO DP013-PARAGRAPH             10884001
108850                 MOVE 'SELECT A TSHPTPO ROW   '                   10885001
108860                                   TO DP013-MESSAGE-TEXT(1)       10886001
108870                 MOVE SQLCA        TO DP013-SQLCA                 10887001
108880                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    10888001
108890                 SET DP013-DB2-ABEND                              10889001
108900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           10890001
108910                 PERFORM DP013-0000-PROCESS-ABEND                 10891001
108920         END-EVALUATE                                             10892001
108930     END-PERFORM.                                                 10893001
108940                                                                  10894001
108950     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10895001
108960             AND (SQLCODE = -904 OR -913)                         10896001
108970         MOVE '5035-GET-REC-SEQ-NBR'                              10897001
108980                                   TO DP013-PARAGRAPH             10898001
108990         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              10899001
109000                                   TO DP013-MESSAGE-TEXT (1)      10900001
109010         MOVE 'TO SELECT A TSHPTPO ROW'                           10901001
109020                                   TO DP013-MESSAGE-TEXT (2)      10902001
109030         MOVE SQLCA                TO DP013-SQLCA                 10903001
109040         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    10904001
109050         SET DP013-DB2-ABEND                                      10905001
109060             DP013-XCTL-DISPLAY-RESTART                           10906001
109070                                   TO TRUE                        10907001
109080         PERFORM DP013-0000-PROCESS-ABEND                         10908001
109090     END-IF.                                                      10909001
109100                                                                  10910001
109110/                                                                 10911001
109120*----------------------------------------------------------------*10912001
109130* CREATE A SHIPMENT                                              *10913001
109140*----------------------------------------------------------------*10914001
109150                                                                  10915001
109160 5050-BUILD-SHIPMENT-INFO.                                        10916001
109170                                                                  10917001
109180     INITIALIZE DCLTSHIPMT                                        10918001
109190                DCLTSHIPST                                        10919001
109200                DCLTSHPPKG                                        10920001
109210                DCLTRECEIV.                                       10921001
109220                                                                  10922001
109230     MOVE ASC-TRIP-ID          TO SHIPMT-TRIP-ID                  10923001
109240                                  DK-TRIP-ID.                     10924001
109250     MOVE +1                   TO DN-TRIP-ID.                     10925001
109260                                                                  10926001
109270*    INITIALIZE DP065-RANDNBR-ROUTINE-FIELDS.                     10927001
109280                                                                  10928001
109290*    EXEC CICS ASKTIME                                            10929001
109300*         ABSTIME (PV-ABSTIME)                                    10930001
109310*    END-EXEC.                                                    10931001
109320*    EXEC CICS FORMATTIME                                         10932001
109330*         ABSTIME (PV-ABSTIME)                                    10933001
109340*         YYMMDD  (PV-CURRENT-DATE)                               10934001
109350*         TIME    (PV-CURRENT-TIME)                               10935001
109360*    END-EXEC.                                                    10936001
109370                                                                  10937001
109380*    MOVE PV-CURRENT-DATE          TO DP065-CURRENT-DATE.         10938001
109390*    MOVE PV-CURRENT-TIME          TO DP065-CURRENT-TIME.         10939001
109400                                                                  10940001
109410*    CALL PC-RANDNBR-PGM USING DP065-RANDNBR-ROUTINE-FIELDS.      10941001
109420                                                                  10942001
109430*    IF  DP065-SUCCESSFUL                                         10943001
109440*        MOVE DP065-RANDOM-NUMBER  TO SHIPMT-SHIPT-ID             10944001
109450*                                     ASC-SHIPT-ID                10945001
109460*    ELSE                                                         10946001
109470*        MOVE '5050-BUILD-SHIPMENT-INFO'                          10947001
109480*                                  TO DP013-PARAGRAPH             10948001
109490*        MOVE 'CALL TO DPKUT001 FAILED'                           10949001
109500*                                  TO DP013-MESSAGE-TEXT(1)       10950001
109510*        SET DP013-XCTL-DISPLAY-RESTART                           10951001
109520*                                  TO TRUE                        10952001
109530*        PERFORM DP013-0000-PROCESS-ABEND                         10953001
109540*    END-IF.                                                      10954001
109550                                                                  10955001
109560     PERFORM 5062-GEN-NEW-SHIPT-ID                                10956001
109570                                                                  10957001
109580     MOVE 'RA'                   TO SHIPMT-CRT-SRC-CDE.           10958001
109590     MOVE ASC-OWNER-SCAC-ID      TO SHIPMT-PRO-SCAC-ID            10959001
109600                                    SHIPMT-ORIG-SCAC-ID.          10960001
109610     MOVE ASC-PRO-NBR            TO SHIPMT-PRO-NBR.               10961001
109620     MOVE ASC-BOL-NBR            TO SHIPMT-BOL-NBR.               10962001
109630* WR40574 02-09-2012 CLT START                                    10963001
109640     MOVE ASC-CARR-AUTH-ID       TO SHIPMT-CARR-AUTH-ID.          10964001
109650* WR40574 02-09-2012 CLT END                                      10965001
109660     MOVE ASC-COMP-PRO-NBR       TO SHIPMT-COMPLETE-PRO-NBR.      10966001
109670     MOVE ASC-COMP-BOL-NBR       TO SHIPMT-COMPLETE-BOL-NBR.      10967001
109680     MOVE +1                     TO SHIPMT-SHIPT-TYP-CDE.         10968001
109690     MOVE 'CTN'                  TO SHIPMT-PKG-TYP-CDE.           10969001
109700     MOVE ASC-EXPTED-CART-CNT-N  TO SHIPMT-EXPTED-PKG-QTY.        10970001
109710     MOVE ASC-ENT-NAME-DESC      TO SHIPMT-SHIPPER-NME.           10971001
109720                                                                  10972001
109730     MOVE ASC-OWNER-SCAC-ID      TO DK-OWNER-SCAC-ID.             10973001
109740     MOVE ASC-PRO-NBR            TO DK-PRO-NBR.                   10974001
109750     MOVE ASC-BOL-NBR            TO DK-BOL-NBR.                   10975001
109760                                                                  10976001
109770     IF  ASC-PRO-NBR > SPACES                                     10977001
109780         MOVE ASC-PRO-NBR  TO DK-PRO-NBR-B                        10978001
109790                              DK-PRO-NBR-E                        10979001
109800     ELSE                                                         10980001
109810         MOVE SPACES       TO DK-PRO-NBR-B                        10981001
109820         MOVE '9999999999999999'                                  10982001
109830                           TO DK-PRO-NBR-E                        10983001
109840     END-IF.                                                      10984001
109850     IF  ASC-BOL-NBR > SPACES                                     10985001
109860         MOVE ASC-BOL-NBR  TO DK-BOL-NBR-B                        10986001
109870                              DK-BOL-NBR-E                        10987001
109880     ELSE                                                         10988001
109890         MOVE SPACES       TO DK-BOL-NBR-B                        10989001
109900         MOVE '9999999999999999'                                  10990001
109910                           TO DK-BOL-NBR-E                        10991001
109920     END-IF.                                                      10992001
109930                                                                  10993001
109940     INITIALIZE PV-DB2-COUNT.                                     10994001
109950     PERFORM 5055-CHECK-DUPL-SHIPMENT.                            10995001
109960                                                                  10996001
109970     IF  PV-DB2-COUNT > +0                                        10997001
109980         SET PS-ERROR                                             10998001
109990             DP020-MSG-FATAL    TO TRUE                           10999001
110000         MOVE PC-TSYMSG-02842   TO DP020-MSG-NUMBER               11000001
110010         MOVE DP015-UNP-ALP-BRT-OFF                               11001001
110020                                TO ASCACA                         11002001
110030                                   APROA                          11003001
110040                                   ABOLA                          11004001
110050         MOVE DP015-RED         TO ASCACC                         11005001
110060                                   APROC                          11006001
110070                                   ABOLC                          11007001
110080         MOVE DP015-REVERSE     TO ASCACH                         11008001
110090                                   APROH                          11009001
110100                                   ABOLH                          11010001
110110         MOVE -1                TO ASCACL                         11011001
110120         SET DP030-SET-CURSOR-APPL-1                              11012001
110130                                TO TRUE                           11013001
110140     ELSE                                                         11014001
110150         MOVE ASC-ARRIVAL-DTE TO PV-DISPLAY-DATE                  11015001
110160         MOVE PV-DISPLAY-DATE-MM TO PV-DB2-DATE-MM                11016001
110170         MOVE PV-DISPLAY-DATE-DD TO PV-DB2-DATE-DD                11017001
110180         MOVE PV-DISPLAY-DATE-YY TO PV-DB2-DATE-YY                11018001
110190         MOVE '-'                TO PV-DB2-DASH-1                 11019001
110200         MOVE '-'                TO PV-DB2-DASH-2                 11020001
110210         IF PV-DISPLAY-DATE-YY > '60'                             11021001
110220             MOVE '19'           TO PV-DB2-DATE-CC                11022001
110230         ELSE                                                     11023001
110240             MOVE '20'           TO PV-DB2-DATE-CC                11024001
110250         END-IF                                                   11025001
110260         STRING PV-DB2-DATE        DELIMITED BY SIZE              11026001
110270                '-'                DELIMITED BY SIZE              11027001
110280                '00.00.00.000000'  DELIMITED BY SIZE              11028001
110290                                   INTO SHIPMT-EST-AR-TMST        11029001
110300         MOVE +1 TO DN-SHIP-EST-AR-TMST                           11030001
110310                                                                  11031001
110320         MOVE ASC-VEND-SHIP-DTE TO PV-DISPLAY-DATE                11032001
110330         MOVE PV-DISPLAY-DATE-MM TO PV-DB2-DATE-MM                11033001
110340         MOVE PV-DISPLAY-DATE-DD TO PV-DB2-DATE-DD                11034001
110350         MOVE PV-DISPLAY-DATE-YY TO PV-DB2-DATE-YY                11035001
110360         MOVE '-'                TO PV-DB2-DASH-1                 11036001
110370                                    PV-DB2-DASH-2                 11037001
110380         IF PV-DISPLAY-DATE-YY > '60'                             11038001
110390            MOVE '19'            TO PV-DB2-DATE-CC                11039001
110400         ELSE                                                     11040001
110410            MOVE '20'            TO PV-DB2-DATE-CC                11041001
110420         END-IF                                                   11042001
110430         MOVE PV-DB2-DATE        TO SHIPMT-VEND-SHIP-DTE          11043001
110440                                                                  11044001
110450* WR40574 02-09-2012 CLT START                                    11045001
110460         IF SHIPMT-CARR-AUTH-ID > SPACES                          11046001
110470             CONTINUE                                             11047001
110480         ELSE                                                     11048001
110490             PERFORM 4021-SELECT-CAN                              11049001
110500         END-IF                                                   11050001
110510* WR40574 02-09-2012 CLT END                                      11051001
110520         PERFORM 5060-INSERT-TSHIPMT                              11052001
110530         IF  SQLCODE = +0                                         11053001
110540             MOVE SHIPMT-SHIPT-ID TO SHIPST-SHIPT-ID              11054001
110550                                     SHPPKG-SHIPT-ID              11055001
110560                                     ASC-SHIPT-ID                 11056001
110570                                     DK-SHIPT-ID                  11057001
110580             PERFORM 6400-AUDIT-TSHIPMT                           11058001
110590             MOVE ASC-TRIP-STATUS-CDE                             11059001
110600                                  TO SHIPST-SHIPT-STATUS-CDE      11060001
110610             MOVE 'CTN'           TO SHPPKG-PKG-TYP-CDE           11061001
110620             MOVE ASC-EXPTED-CART-CNT-N                           11062001
110630                                  TO SHPPKG-EXPTED-PKG-QTY        11063001
110640             PERFORM 5070-INSERT-TSHIPST                          11064001
110650             PERFORM 5080-INSERT-TSHPPKG                          11065001
110660         END-IF                                                   11066001
110670     END-IF.                                                      11067001
110680                                                                  11068001
110690/                                                                 11069001
110700 5055-CHECK-DUPL-SHIPMENT.                                        11070001
110710                                                                  11071001
110720     PERFORM                                                      11072001
110730         WITH TEST AFTER                                          11073001
110740         VARYING PV-RETRY-COUNTER                                 11074001
110750         FROM 1 BY 1                                              11075001
110760         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11076001
110770             OR (SQLCODE = +0)                                    11077001
110780             OR (SQLCODE = +100))                                 11078001
110790                                                                  11079001
110800         EXEC SQL                                                 11080001
110810             SELECT COUNT(*)                                      11081001
110820              INTO  :PV-DB2-COUNT                                 11082001
110830             FROM TSHPTPO A                                       11083001
110840                 ,TSHIPMT B                                       11084001
110850            WHERE A.PO_NBR      = :DK-PO-NBR                      11085001
110860              AND B.PRO_SCAC_ID = :DK-OWNER-SCAC-ID               11086001
110870              AND B.TRIP_ID     = :DK-TRIP-ID                     11087001
110880              AND B.PRO_NBR BETWEEN :DK-PRO-NBR-B                 11088001
110890                                AND :DK-PRO-NBR-E                 11089001
110900              AND B.BOL_NBR BETWEEN :DK-BOL-NBR-B                 11090001
110910                                AND :DK-BOL-NBR-E                 11091001
110920              AND A.SHIPT_ID = B.SHIPT_ID                         11092001
110930         END-EXEC                                                 11093001
110940                                                                  11094001
110950         EVALUATE TRUE                                            11095001
110960             WHEN SQLCODE = +0                                    11096001
110970             WHEN SQLCODE = +100                                  11097001
110980             WHEN SQLCODE = -904                                  11098001
110990             WHEN SQLCODE = -913                                  11099001
111000                 CONTINUE                                         11100001
111010                                                                  11101001
111020             WHEN SQLWARN0 NOT = SPACES                           11102001
111030             WHEN SQLCODE < +0                                    11103001
111040             WHEN SQLCODE > +0                                    11104001
111050                 MOVE '5055-CHECK-DUPL-SHIPMENT'                  11105001
111060                                   TO DP013-PARAGRAPH             11106001
111070                 MOVE 'SELECT A TSHIPMT ROW   '                   11107001
111080                                   TO DP013-MESSAGE-TEXT(1)       11108001
111090                 MOVE SQLCA        TO DP013-SQLCA                 11109001
111100                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    11110001
111110                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (2)    11111001
111120                 MOVE 'TSHSTYP'    TO DP013-DB2-TABLE-NAME (3)    11112001
111130                 SET DP013-DB2-ABEND                              11113001
111140                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11114001
111150                 PERFORM DP013-0000-PROCESS-ABEND                 11115001
111160         END-EVALUATE                                             11116001
111170     END-PERFORM.                                                 11117001
111180                                                                  11118001
111190     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11119001
111200             AND (SQLCODE = -904 OR -913)                         11120001
111210         MOVE '5055-CHECK-DUPL-SHIPMENT'                          11121001
111220                                   TO DP013-PARAGRAPH             11122001
111230         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              11123001
111240                                   TO DP013-MESSAGE-TEXT (1)      11124001
111250         MOVE 'TO SELECT A TSHIPMT ROW'                           11125001
111260                                   TO DP013-MESSAGE-TEXT (2)      11126001
111270         MOVE SQLCA                TO DP013-SQLCA                 11127001
111280         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    11128001
111290         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (2)    11129001
111300         MOVE 'TSHSTYP'            TO DP013-DB2-TABLE-NAME (3)    11130001
111310         SET DP013-DB2-ABEND                                      11131001
111320             DP013-XCTL-DISPLAY-RESTART                           11132001
111330                                   TO TRUE                        11133001
111340         PERFORM DP013-0000-PROCESS-ABEND                         11134001
111350     END-IF.                                                      11135001
111360                                                                  11136001
111370/                                                                 11137001
111380*----------------------------------------------------------------*11138001
111390*  INSERT A ROW ON THE TSHIPMT TABLE                             *11139001
111400*----------------------------------------------------------------*11140001
111410 5060-INSERT-TSHIPMT.                                             11141001
111420                                                                  11142001
111430* CLT 12-01-2011 WR40574 ADDED CARR-AUTH-ID BELOW                 11143001
111440     PERFORM                                                      11144001
111450         WITH TEST AFTER                                          11145001
111460         VARYING PV-RETRY-COUNTER                                 11146001
111470         FROM 1 BY 1                                              11147001
111480         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRY-TSHIPMT-ADD        11148001
111490             OR SQLCODE = +0                                      11149001
111500*            OR SQLCODE = -803                                    11150001
111510                                                                  11151001
111520         EXEC SQL                                                 11152001
111530             INSERT  INTO TSHIPMT                                 11153001
111540                    (TRIP_ID                                      11154001
111550                    ,SHIPT_ID                                     11155001
111560                    ,CRT_SRC_CDE                                  11156001
111570                    ,LAST_UPD_DTE                                 11157001
111580                    ,LAST_UPD_TME                                 11158001
111590                    ,LAST_UPD_UID                                 11159001
111600                    ,PRO_SCAC_ID                                  11160001
111610                    ,PRO_NBR                                      11161001
111620                    ,BOL_NBR                                      11162001
111630                    ,SHIPPER_NME                                  11163001
111640                    ,SHIPT_TYP_CDE                                11164001
111650                    ,EXPTED_GRO_WGHT                              11165001
111660                    ,PKG_TYP_CDE                                  11166001
111670                    ,EXPTED_PKG_QTY                               11167001
111680                    ,FRGT_CHG_AMT                                 11168001
111690                    ,FRGT_TERMS_CDE                               11169001
111700                    ,EXPTED_PLT_QTY                               11170001
111710                    ,VEND_SHIP_DTE                                11171001
111720                    ,EST_AR_TMST                                  11172001
111730                    ,ORIG_SCAC_ID                                 11173001
111740                    ,LAST_UPD_PGM_ID                              11174001
111750                    ,CRE_USER_ID                                  11175001
111760                    ,CARR_LAST_UPD_DTE                            11176001
111770                    ,CARR_LAST_UPD_TIME                           11177001
111780                    ,VEND_LAST_UPD_DTE                            11178001
111790                    ,VEND_LAST_UPD_TIME                           11179001
111800                    ,AUTH_DTE                                     11180001
111810                    ,CONFIRM_DTE                                  11181001
111820                    ,CONFIRM_TIME                                 11182001
111830                    ,COMPLETE_PRO_NBR                             11183001
111840                    ,COMPLETE_BOL_NBR                             11184001
111850                    ,PROCESSED_DTE                                11185001
111860                    ,CARR_AUTH_ID)                                11186001
111870            VALUES  (:SHIPMT-TRIP-ID                              11187001
111880                        :DN-TRIP-ID                               11188001
111890                    ,:SHIPMT-SHIPT-ID                             11189001
111900                    ,:SHIPMT-CRT-SRC-CDE                          11190001
111910                    ,CURRENT DATE                                 11191001
111920                    ,CURRENT TIME                                 11192001
111930                    ,:DP020-USERID                                11193001
111940                    ,:SHIPMT-PRO-SCAC-ID                          11194001
111950                    ,:SHIPMT-PRO-NBR                              11195001
111960                    ,:SHIPMT-BOL-NBR                              11196001
111970                    ,:SHIPMT-SHIPPER-NME                          11197001
111980                    ,:SHIPMT-SHIPT-TYP-CDE                        11198001
111990                    ,:SHIPMT-EXPTED-GRO-WGHT                      11199001
112000                    ,:SHIPMT-PKG-TYP-CDE                          11200001
112010                    ,:SHIPMT-EXPTED-PKG-QTY                       11201001
112020                    ,:SHIPMT-FRGT-CHG-AMT                         11202001
112030                    ,:SHIPMT-FRGT-TERMS-CDE                       11203001
112040                    ,:SHIPMT-EXPTED-PLT-QTY                       11204001
112050                    ,:SHIPMT-VEND-SHIP-DTE                        11205001
112060                    ,:SHIPMT-EST-AR-TMST :DN-SHIP-EST-AR-TMST     11206001
112070                    ,:SHIPMT-ORIG-SCAC-ID                         11207001
112080                    ,:PC-CURRENT-PROGRAM-NAME                     11208001
112090                    ,:DP020-USERID                                11209001
112100                    ,:PC-DEFAULT-DATE                             11210001
112110                    ,:PC-DEFAULT-TIME                             11211001
112120                    ,:PC-DEFAULT-DATE                             11212001
112130                    ,:PC-DEFAULT-TIME                             11213001
112140                    ,:PC-DEFAULT-DATE                             11214001
112150                    ,:PC-DEFAULT-DATE                             11215001
112160                    ,:PC-DEFAULT-TIME                             11216001
112170                    ,:SHIPMT-COMPLETE-PRO-NBR                     11217001
112180                    ,:SHIPMT-COMPLETE-BOL-NBR                     11218001
112190                    ,:PC-DEFAULT-DATE                             11219001
112200                    ,:SHIPMT-CARR-AUTH-ID)                        11220001
112210         END-EXEC                                                 11221001
112220                                                                  11222001
112230         EVALUATE TRUE                                            11223001
112240             WHEN SQLCODE = +0                                    11224001
112250                 CONTINUE                                         11225001
112260                                                                  11226001
112270             WHEN SQLCODE = -803                                  11227001
112280               IF PV-RETRY-COUNTER > PC-MAX-RETRY-TSHIPMT-ADD     11228001
112290                 SET PS-ERROR           TO TRUE                   11229001
112300                 SET DP020-MSG-FATAL    TO TRUE                   11230001
112310                 MOVE PC-TSYMSG-02841   TO DP020-MSG-NUMBER       11231001
112320                 MOVE DP015-UNP-ALP-BRT-OFF                       11232001
112330                                        TO ASCACA                 11233001
112340                                           APROA                  11234001
112350                                           ABOLA                  11235001
112360                 MOVE DP015-RED         TO ASCACC                 11236001
112370                                           APROC                  11237001
112380                                           ABOLC                  11238001
112390                 MOVE DP015-REVERSE     TO ASCACH                 11239001
112400                                           APROH                  11240001
112410                                           ABOLH                  11241001
112420                 MOVE -1                TO ASCACL                 11242001
112430                 SET DP030-SET-CURSOR-APPL-1                      11243001
112440                                        TO TRUE                   11244001
112450               ELSE                                               11245001
112460                 PERFORM 5062-GEN-NEW-SHIPT-ID                    11246001
112470               END-IF                                             11247001
112480                                                                  11248001
112490             WHEN SQLCODE = -904                                  11249001
112500             WHEN SQLCODE = -913                                  11250001
112510                 CONTINUE                                         11251001
112520                                                                  11252001
112530             WHEN SQLWARN0 NOT = SPACES                           11253001
112540             WHEN SQLCODE < +0                                    11254001
112550             WHEN SQLCODE > +0                                    11255001
112560                 MOVE '5060-INSERT-TSHIPMT'                       11256001
112570                                   TO DP013-PARAGRAPH             11257001
112580                 MOVE 'INSERT A ROW ON TSHIPMT'                   11258001
112590                                   TO DP013-MESSAGE-TEXT(1)       11259001
112600                 MOVE SQLCA        TO DP013-SQLCA                 11260001
112610                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    11261001
112620                 SET DP013-DB2-ABEND                              11262001
112630                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11263001
112640                 PERFORM DP013-0000-PROCESS-ABEND                 11264001
112650         END-EVALUATE                                             11265001
112660     END-PERFORM.                                                 11266001
112670                                                                  11267001
112680     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11268001
112690             AND (SQLCODE = -904 OR -913)                         11269001
112700         MOVE '5060-INSERT-TSHIPMT'                               11270001
112710                                   TO DP013-PARAGRAPH             11271001
112720         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              11272001
112730                                   TO DP013-MESSAGE-TEXT (1)      11273001
112740         MOVE 'TO INSERT A TSHIPMT ROW'                           11274001
112750                                   TO DP013-MESSAGE-TEXT (2)      11275001
112760         MOVE SQLCA                TO DP013-SQLCA                 11276001
112770         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    11277001
112780         SET DP013-DB2-ABEND                                      11278001
112790             DP013-XCTL-DISPLAY-RESTART                           11279001
112800                                   TO TRUE                        11280001
112810         PERFORM DP013-0000-PROCESS-ABEND                         11281001
112820     END-IF.                                                      11282001
112830                                                                  11283001
112840 5062-GEN-NEW-SHIPT-ID.                                           11284001
112850     INITIALIZE DP902-RANDNBR-ROUTINE-FIELDS.                     11285001
112860                                                                  11286001
112870     CALL PC-RANDNBR-PGM USING DFHEIBLK                           11287001
112880                               DFHCOMMAREA                        11288001
112890                               DP902-RANDNBR-ROUTINE-FIELDS.      11289001
112900                                                                  11290001
112910     IF  DP902-SUCCESSFUL                                         11291001
112920         MOVE DP902-RANDOM-NUMBER  TO SHIPMT-SHIPT-ID             11292001
112930                                      ASC-SHIPT-ID                11293001
112940     ELSE                                                         11294001
112950         MOVE '5062-GEN-NEW-SHIPT-ID'                             11295001
112960                                   TO DP013-PARAGRAPH             11296001
112970         MOVE 'CALL TO DPKUT902 FAILED'                           11297001
112980                                   TO DP013-MESSAGE-TEXT(1)       11298001
112990         SET DP013-XCTL-DISPLAY-RESTART                           11299001
113000                                   TO TRUE                        11300001
113010         PERFORM DP013-0000-PROCESS-ABEND                         11301001
113020     END-IF.                                                      11302001
113030/                                                                 11303001
113040*----------------------------------------------------------------*11304001
113050*  INSERT A SHIPMENT STATUS ROW                                  *11305001
113060*----------------------------------------------------------------*11306001
113070 5070-INSERT-TSHIPST.                                             11307001
113080                                                                  11308001
113090     PERFORM                                                      11309001
113100         WITH TEST AFTER                                          11310001
113110         VARYING PV-RETRY-COUNTER                                 11311001
113120         FROM 1 BY 1                                              11312001
113130         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11313001
113140             OR (SQLCODE = +0))                                   11314001
113150                                                                  11315001
113160         EXEC SQL                                                 11316001
113170             INSERT  INTO TSHIPST                                 11317001
113180                    (SHIPT_ID                                     11318001
113190                    ,SHIPT_STATUS_CDE                             11319001
113200                    ,STATUS_DTE                                   11320001
113210                    ,STATUS_TME                                   11321001
113220                    ,STATUS_UID                                   11322001
113230                    ,DELAY_RSN_CDE)                               11323001
113240            VALUES  (:SHIPST-SHIPT-ID                             11324001
113250                    ,:SHIPST-SHIPT-STATUS-CDE                     11325001
113260                    ,CURRENT DATE                                 11326001
113270                    ,CURRENT TIME                                 11327001
113280                    ,:DP020-USERID                                11328001
113290                    ,:SHIPST-DELAY-RSN-CDE)                       11329001
113300         END-EXEC                                                 11330001
113310                                                                  11331001
113320         EVALUATE TRUE                                            11332001
113330             WHEN SQLCODE = +0                                    11333001
113340             WHEN SQLCODE = -904                                  11334001
113350             WHEN SQLCODE = -913                                  11335001
113360                 CONTINUE                                         11336001
113370                                                                  11337001
113380             WHEN SQLWARN0 NOT = SPACES                           11338001
113390             WHEN SQLCODE < +0                                    11339001
113400             WHEN SQLCODE > +0                                    11340001
113410                 MOVE SHIPST-SHIPT-ID  TO  PV-DISP-SHIPT-ID       11341021
113420                 MOVE '5070-INSERT-TSHIPST'                       11342001
113430                                   TO DP013-PARAGRAPH             11343001
113440                 MOVE 'INSERT A ROW ON TSHIPST'                   11344001
113450                                   TO DP013-MESSAGE-TEXT(1)       11345001
113460                 STRING 'SHIPT ID:'  PV-DISP-SHIPT-ID             11346021
113470                                     DELIMITED BY SIZE            11347021
113480                               INTO DP013-MESSAGE-TEXT (2)        11348021
113490                 MOVE SQLCA        TO DP013-SQLCA                 11349001
113500                 MOVE 'TSHIPST'    TO DP013-DB2-TABLE-NAME (1)    11350001
113510                 SET DP013-DB2-ABEND                              11351001
113520                     DP013-XCTL-DISPLAY-RESTART TO TRUE           11352001
113530                 PERFORM DP013-0000-PROCESS-ABEND                 11353001
113540         END-EVALUATE                                             11354001
113550     END-PERFORM.                                                 11355001
113560                                                                  11356001
113570     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11357001
113580             AND (SQLCODE = -904 OR -913)                         11358001
113590         MOVE '5070-INSERT-TSHIPST'                               11359001
113600                                   TO DP013-PARAGRAPH             11360001
113610         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              11361001
113620                                   TO DP013-MESSAGE-TEXT (1)      11362001
113630         MOVE 'TO INSERT A TSHIPST ROW'                           11363001
113640                                   TO DP013-MESSAGE-TEXT (2)      11364001
113650         MOVE SQLCA                TO DP013-SQLCA                 11365001
113660         MOVE 'TSHIPST'            TO DP013-DB2-TABLE-NAME (1)    11366001
113670         SET DP013-DB2-ABEND                                      11367001
113680             DP013-XCTL-DISPLAY-RESTART                           11368001
113690                                   TO TRUE                        11369001
113700         PERFORM DP013-0000-PROCESS-ABEND                         11370001
113710     END-IF.                                                      11371001
113720                                                                  11372001
113730/                                                                 11373001
113740 5080-INSERT-TSHPPKG.                                             11374001
113750                                                                  11375001
113760     PERFORM                                                      11376001
113770         WITH TEST AFTER                                          11377001
113780         VARYING PV-RETRY-COUNTER                                 11378001
113790         FROM 1 BY 1                                              11379001
113800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11380001
113810             OR (SQLCODE = +0)                                    11381021
113820             OR (SQLCODE = -803))                                 11382021
113830                                                                  11383001
113840         EXEC SQL                                                 11384001
113850              INSERT INTO TSHPPKG                                 11385001
113860                     ( SHIPT_ID                                   11386001
113870                      ,PKG_TYP_CDE                                11387001
113880                      ,EXPTED_PKG_QTY                             11388001
113890                      ,ACTL_PKG_QTY                               11389001
113900                      ,DMG_PKG_QTY )                              11390001
113910              VALUES ( :SHPPKG-SHIPT-ID                           11391001
113920                      ,:SHPPKG-PKG-TYP-CDE                        11392001
113930                      ,:SHPPKG-EXPTED-PKG-QTY                     11393001
113940                      ,:SHPPKG-ACTL-PKG-QTY                       11394001
113950                      ,:SHPPKG-DMG-PKG-QTY )                      11395001
113960         END-EXEC                                                 11396001
113970                                                                  11397001
113980         EVALUATE TRUE                                            11398001
113990             WHEN SQLCODE = +0                                    11399001
114000             WHEN SQLCODE = -803                                  11400021
114010             WHEN SQLCODE = -904                                  11401001
114020             WHEN SQLCODE = -913                                  11402001
114030                 CONTINUE                                         11403001
114040                                                                  11404001
114050             WHEN SQLWARN0 NOT = SPACE                            11405001
114060             WHEN SQLCODE < +0                                    11406001
114070             WHEN SQLCODE > +0                                    11407001
114080                 MOVE SHPPKG-SHIPT-ID  TO  PV-DISP-SHIPT-ID       11408021
114090                 MOVE '5080-INSERT-TSHPPKG'                       11409001
114100                                 TO DP013-PARAGRAPH               11410001
114110                 MOVE 'INSERT ON TSHPPKG TABLE'                   11411001
114120                                 TO DP013-MESSAGE-TEXT (1)        11412001
114130                 STRING 'SHIPT ID:'  PV-DISP-SHIPT-ID             11413021
114140                                     DELIMITED BY SIZE            11414021
114150                               INTO DP013-MESSAGE-TEXT (2)        11415021
114160                 MOVE SQLCA      TO DP013-SQLCA                   11416001
114170                 MOVE 'TSHPPKG'  TO DP013-DB2-TABLE-NAME (1)      11417001
114180                     SET DP013-DB2-ABEND                          11418001
114190                         DP013-XCTL-DISPLAY-RESTART               11419001
114200                                     TO TRUE                      11420001
114210                 PERFORM DP013-0000-PROCESS-ABEND                 11421001
114220         END-EVALUATE                                             11422001
114230     END-PERFORM.                                                 11423001
114240                                                                  11424001
114250     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11425001
114260             AND (SQLCODE = -904 OR -913)                         11426001
114270         MOVE '5080-INSERT-TSHPPKG'                               11427001
114280                                  TO DP013-PARAGRAPH              11428001
114290         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TSHPPKG'         11429001
114300                                  TO DP013-MESSAGE-TEXT (1)       11430001
114310         MOVE SQLCA               TO DP013-SQLCA                  11431001
114320         MOVE 'TSHPPKG '          TO DP013-DB2-TABLE-NAME (1)     11432001
114330         SET DP013-DB2-ABEND                                      11433001
114340             DP013-XCTL-DISPLAY-RESTART                           11434001
114350                                  TO TRUE                         11435001
114360         PERFORM DP013-0000-PROCESS-ABEND                         11436001
114370     END-IF.                                                      11437001
114380                                                                  11438001
114390/                                                                 11439001
114400*----------------------------------------------------------------*11440001
114410* CREATE A RECEIVER ROW                                          *11441001
114420*----------------------------------------------------------------*11442001
114430                                                                  11443001
114440 5100-BUILD-RECEIVER-INFO.                                        11444001
114450                                                                  11445001
114460     INITIALIZE DCLTRECEIV.                                       11446001
114470                                                                  11447001
114480     MOVE ASC-PO-NBR-N           TO RECEIV-ORD-NBR.               11448001
114490     MOVE ASC-REC-SEQ-NBR        TO RECEIV-REC-SEQ-NBR            11449001
114500                                    RECEIV-REFER-BACK-SEQ-NBR.    11450001
114510     MOVE ASC-VER-NBR            TO RECEIV-PO-VER-NBR.            11451001
114520     MOVE ASC-OPER-UNT-ID        TO RECEIV-OPER-UNT-ID.           11452001
114530     MOVE ASC-FCLTY-ID           TO RECEIV-FCLTY-ID.              11453001
114540     MOVE 'IP'                   TO RECEIV-STATUS-CDE.            11454001
114550     MOVE 'I'                    TO RECEIV-SYST-CRE-CDE.          11455001
114560     IF  ASC-EXPENSE-RECEIPT                                      11456001
114570         MOVE 'EX'               TO RECEIV-REC-TYP-CDE            11457001
114580     ELSE                                                         11458001
114590*        MOVE 'MR'               TO RECEIV-REC-TYP-CDE            11459001
114600         MOVE ASC-REC-TYP        TO RECEIV-REC-TYP-CDE            11460001
114610     END-IF.                                                      11461001
114620     MOVE 'A'                    TO RECEIV-VER-STATUS-CDE.        11462001
114630     MOVE ASC-PACK-BY-ST-IND     TO RECEIV-PACK-BY-ST-IND.        11463001
114640     MOVE ASC-EXPTED-CART-CNT-N  TO RECEIV-EXPTED-CART-CNT.       11464001
114650     MOVE ASC-ACTL-CART-CNT-N    TO RECEIV-ACTL-CART-CNT.         11465001
114660     MOVE '9999-09-09'           TO RECEIV-AP-PRC-DTE.            11466001
114670     MOVE '9999-09-09-09.09.09.999999'                            11467001
114680                                 TO RECEIV-ML-POST-TMST           11468001
114690                                    RECEIV-FS-POST-TMST           11469001
114700                                    RECEIV-IN-TRBL-TMST           11470001
114710                                    RECEIV-VERFYD-TMST            11471001
114720                                    RECEIV-MKNG-APRN-PRT-TMST.    11472001
114730                                                                  11473001
114740     MOVE ASC-APRON-LOC-DESC      TO RECEIV-APRON-LOC-DESC.       11474001
114750     MOVE ASC-COPER-UNT-ID        TO RECEIV-CURR-OPER-UNT-ID.     11475001
114760     MOVE ASC-CRE-OPER-UNT-ID     TO RECEIV-CRE-OPER-UNT-ID.      11476001
114770     MOVE ASC-CFCLTY-ID           TO RECEIV-CURR-FCLTY-ID.        11477001
114780     MOVE ASC-CRE-FCLTY-ID        TO RECEIV-CRE-FCLTY-ID.         11478001
114790     MOVE DP020-USERID            TO RECEIV-UPD-UID.              11479001
114800     MOVE PC-CURRENT-PROGRAM-NAME TO RECEIV-UPD-PGM-ID.           11480001
114810                                                                  11481001
114820     EXEC SQL                                                     11482001
114830         SET :PV-DB2-HOST-TIMESTAMP = CURRENT TIMESTAMP           11483001
114840     END-EXEC.                                                    11484001
114850                                                                  11485001
114860     MOVE PV-DB2-HOST-TIMESTAMP  TO PV-DB2-TIMESTAMP.             11486001
114870                                                                  11487001
114880     PERFORM 4012-GET-ARR-DISP-DTE.                               11488001
114890                                                                  11489001
114900     IF ASC-KEY-TRIP-ID > ZEROES                                  11490001
114910        IF ASC-ARRIVAL-DISPLAY-DTE = 'ENROUTE'                    11491001
114920           MOVE '9999-09-09-09.09.09.999999'                      11492001
114930                                     TO RECEIV-REC-TMST           11493001
114940        ELSE                                                      11494001
114950           STRING TRIPST-STATUS-DTE DELIMITED BY SIZE             11495001
114960                  '-'          DELIMITED BY SIZE                  11496001
114970                  PV-DB2-TMST-TIME DELIMITED BY SIZE              11497001
114980                                     INTO RECEIV-REC-TMST         11498001
114990        END-IF                                                    11499001
115000     ELSE                                                         11500001
115010        STRING ASC-KEY-STATUS-DTE DELIMITED BY SIZE               11501001
115020               '-'             DELIMITED BY SIZE                  11502001
115030               PV-DB2-TMST-TIME DELIMITED BY SIZE                 11503001
115040                                  INTO RECEIV-REC-TMST            11504001
115050     END-IF.                                                      11505001
115060                                                                  11506001
115070     MOVE ASC-PRE-TKT-IND        TO RECEIV-PRE-TKT-IND.           11507001
115080     MOVE ASC-HANGER-IND         TO RECEIV-GOH-IND.               11508001
115090     MOVE ASC-RCVG-CLERK-INIT-ID TO RECEIV-RCVG-CLERK-INIT-ID.    11509001
115100     MOVE ASC-PKGNG-CDE          TO RECEIV-PKGNG-CDE.             11510001
115110                                                                  11511001
115120     IF  ASC-AP-RCVR-NBR = (SPACES OR ZEROES)                     11512001
115130         SET PS-RCVR-FOUND TO TRUE                                11513001
115140         PERFORM VARYING PV-COUNT FROM 1 BY 1 UNTIL               11514001
115150              PV-COUNT > 10 OR PS-NO-RCVR-FOUND                   11515001
115160             PERFORM 5120-OPEN-TRECVER-CSR                        11516001
115170             PERFORM 5125-FETCH-TRECVER-CSR                       11517001
115180                                                                  11518001
115190             MOVE RECVER-MAX-RCVR-NBR  TO PW-CONTROL-PANL-NBR-9   11519001
115200             DIVIDE PW-CONTROL-PANL-NBR-9 BY 9 GIVING PW-QUOTIENT 11520001
115210                                           REMAINDER  PW-REMAINDER11521001
115220             COMPUTE PW-CONTROL-CEHCK-DIG = ( 9 - PW-REMAINDER )  11522001
115230             COMPUTE RECEIV-RCVR-NBR = PW-CONTROL-KEYREC-9 * 1    11523001
115240             MOVE PW-CONTROL-KEYREC-9  TO ASC-AP-RCVR-NBR-N       11524001
115250                                          AAPRCVRO                11525001
115260             ADD +1                    TO RECVER-MAX-RCVR-NBR     11526001
115270             PERFORM 5130-DELETE-TRECVER-CSR                      11527001
115280             PERFORM 5135-INSERT-TRECVER                          11528001
115290             PERFORM 5140-CLOSE-TRECVER-CSR                       11529001
115300             INITIALIZE PV-DB2-COUNT                              11530001
115310             MOVE RECEIV-RCVR-NBR      TO DK-RCVR-NBR             11531001
115320*            PERFORM 3150-CHECK-DUPL-RCVR-NBR                     11532001
115330         END-PERFORM                                              11533001
115340*        IF PS-RCVR-FOUND                                         11534001
115350*            MOVE '5100-BUILD-RECEIVER-INFO'                      11535001
115360*                                     TO DP013-PARAGRAPH          11536001
115370*            MOVE 'MAX RETRIES EXCEEDED ON TRECVER CURSOR'        11537001
115380*                                     TO DP013-MESSAGE-TEXT (1)   11538001
115390*            MOVE SQLCA               TO DP013-SQLCA              11539001
115400*            MOVE 'TRECVER '          TO DP013-DB2-TABLE-NAME (1) 11540001
115410*            SET DP013-DB2-ABEND                                  11541001
115420*                DP013-XCTL-DISPLAY-RESTART                       11542001
115430*                                     TO TRUE                     11543001
115440*            PERFORM DP013-0000-PROCESS-ABEND                     11544001
115450*        END-IF                                                   11545001
115460     ELSE                                                         11546001
115470         MOVE ASC-AP-RCVR-NBR-N    TO RECEIV-RCVR-NBR             11547001
115480         MOVE RECEIV-RCVR-NBR      TO DK-RCVR-NBR                 11548001
115490     END-IF.                                                      11549001
115500                                                                  11550001
115510                                                                  11551001
115520     IF  PS-NO-ERROR                                              11552001
115530         PERFORM 5110-INSERT-TRECEIV                              11553001
115540         PERFORM 5115-INSERT-TPOSYNC                              11554001
115550         PERFORM 5150-CHECK-FOR-TROUBLE                           11555001
115560     END-IF.                                                      11556001
115570                                                                  11557001
115580/                                                                 11558001
115590 5110-INSERT-TRECEIV.                                             11559001
115600                                                                  11560001
115610     PERFORM                                                      11561001
115620         WITH TEST AFTER                                          11562001
115630         VARYING PV-RETRY-COUNTER                                 11563001
115640         FROM 1 BY 1                                              11564001
115650         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11565001
115660             OR (SQLCODE = +0))                                   11566001
115670                                                                  11567001
115680         EXEC SQL                                                 11568001
115690              INSERT INTO TRECEIV                                 11569001
115700                     ( ORD_NBR                                    11570001
115710                      ,REC_SEQ_NBR                                11571001
115720                      ,CRE_TMST                                   11572001
115730                      ,CRE_UID                                    11573001
115740                      ,PO_VER_NBR                                 11574001
115750                      ,OPER_UNT_ID                                11575001
115760                      ,FCLTY_ID                                   11576001
115770                      ,STATUS_CDE                                 11577001
115780                      ,SYST_CRE_CDE                               11578001
115790                      ,REC_TYP_CDE                                11579001
115800                      ,VER_STATUS_CDE                             11580001
115810                      ,PACK_BY_ST_IND                             11581001
115820                      ,REC_TMST                                   11582001
115830                      ,EXPTED_CART_CNT                            11583001
115840                      ,ACTL_CART_CNT                              11584001
115850                      ,EXPTED_ITM_QTY                             11585001
115860                      ,ACTL_ITM_QTY                               11586001
115870                      ,RCVR_NBR                                   11587001
115880                      ,ML_POST_TMST                               11588001
115890                      ,FS_POST_TMST                               11589001
115900                      ,PRE_TKT_IND                                11590001
115910                      ,AD_INFO_DESC                               11591001
115920                      ,IN_TRBL_TMST                               11592001
115930                      ,IN_TRBL_MIN_CNT                            11593001
115940                      ,IN_TRBL_HOUR_CNT                           11594001
115950                      ,VERFYD_TMST                                11595001
115960                      ,RCVG_CLERK_INIT_ID                         11596001
115970                      ,REFER_BACK_SEQ_NBR                         11597001
115980                      ,AP_PRC_CDE                                 11598001
115990                      ,AP_PRC_DTE                                 11599001
116000                      ,MIS_DIRECT_IND                             11600001
116010                      ,IMPRT_IND                                  11601001
116020                      ,CRE_OPER_UNT_ID                            11602001
116030                      ,CRE_FCLTY_ID                               11603001
116040                      ,CURR_OPER_UNT_ID                           11604001
116050                      ,CURR_FCLTY_ID                              11605001
116060                      ,UPD_TMST                                   11606001
116070                      ,UPD_UID                                    11607001
116080                      ,UPD_PGM_ID                                 11608001
116090                      ,APRON_LOC_DESC                             11609001
116100                      ,GOH_IND                                    11610001
116110                      ,MKNG_APRN_PRT_TMST                         11611001
116120                      ,AP_RVRSL_DTE                               11612001
116130                      ,PKGNG_CDE                                  11613001
116140                      )                                           11614001
116150             VALUES ( :RECEIV-ORD-NBR                             11615001
116160                     ,:RECEIV-REC-SEQ-NBR                         11616001
116170                     ,CURRENT TIMESTAMP                           11617001
116180                     ,:DP020-USERID                               11618001
116190                     ,:RECEIV-PO-VER-NBR                          11619001
116200                     ,:RECEIV-OPER-UNT-ID                         11620001
116210                     ,:RECEIV-FCLTY-ID                            11621001
116220                     ,:RECEIV-STATUS-CDE                          11622001
116230                     ,:RECEIV-SYST-CRE-CDE                        11623001
116240                     ,:RECEIV-REC-TYP-CDE                         11624001
116250                     ,:RECEIV-VER-STATUS-CDE                      11625001
116260                     ,:RECEIV-PACK-BY-ST-IND                      11626001
116270                     ,:RECEIV-REC-TMST                            11627001
116280                     ,:RECEIV-EXPTED-CART-CNT                     11628001
116290                     ,:RECEIV-ACTL-CART-CNT                       11629001
116300                     ,:RECEIV-EXPTED-ITM-QTY                      11630001
116310                     ,:RECEIV-ACTL-ITM-QTY                        11631001
116320                     ,:RECEIV-RCVR-NBR                            11632001
116330                     ,:RECEIV-ML-POST-TMST                        11633001
116340                     ,:RECEIV-FS-POST-TMST                        11634001
116350                     ,:RECEIV-PRE-TKT-IND                         11635001
116360                     ,:RECEIV-AD-INFO-DESC                        11636001
116370                     ,:RECEIV-IN-TRBL-TMST                        11637001
116380                     ,:RECEIV-IN-TRBL-MIN-CNT                     11638001
116390                     ,:RECEIV-IN-TRBL-HOUR-CNT                    11639001
116400                     ,:RECEIV-VERFYD-TMST                         11640001
116410                     ,:RECEIV-RCVG-CLERK-INIT-ID                  11641001
116420                     ,:RECEIV-REFER-BACK-SEQ-NBR                  11642001
116430                     ,:RECEIV-AP-PRC-CDE                          11643001
116440                     ,:RECEIV-AP-PRC-DTE                          11644001
116450                     ,:RECEIV-MIS-DIRECT-IND                      11645001
116460                     ,:RECEIV-IMPRT-IND                           11646001
116470                     ,:RECEIV-CRE-OPER-UNT-ID                     11647001
116480                     ,:RECEIV-CRE-FCLTY-ID                        11648001
116490                     ,:RECEIV-CURR-OPER-UNT-ID                    11649001
116500                     ,:RECEIV-CURR-FCLTY-ID                       11650001
116510                     ,CURRENT TIMESTAMP                           11651001
116520                     ,:RECEIV-UPD-UID                             11652001
116530                     ,:RECEIV-UPD-PGM-ID                          11653001
116540                     ,:RECEIV-APRON-LOC-DESC                      11654001
116550                     ,:RECEIV-GOH-IND                             11655001
116560                     ,:RECEIV-MKNG-APRN-PRT-TMST                  11656001
116570                     ,:PC-DEFAULT-9DATE                           11657001
116580                     ,:RECEIV-PKGNG-CDE                           11658001
116590                     )                                            11659001
116600         END-EXEC                                                 11660001
116610                                                                  11661001
116620         EVALUATE TRUE                                            11662001
116630             WHEN SQLCODE = +0                                    11663001
116631                 PERFORM 5113-INSERT-PO-TRACK                     11663135
116632                                                                  11663235
116640             WHEN SQLCODE = -904                                  11664001
116650             WHEN SQLCODE = -913                                  11665001
116660                 CONTINUE                                         11666001
116670                                                                  11667001
116680             WHEN SQLWARN0 NOT = SPACE                            11668001
116690             WHEN SQLCODE < +0                                    11669001
116700             WHEN SQLCODE > +0                                    11670001
116710                 MOVE '5110-INSERT-TRECEIV'                       11671001
116720                                 TO DP013-PARAGRAPH               11672001
116730                 MOVE 'INSERT ON RECEIPTS TABLE'                  11673001
116740                                 TO DP013-MESSAGE-TEXT (1)        11674001
116750                 MOVE RECEIV-REC-TMST                             11675001
116760                                 TO DP013-MESSAGE-TEXT (2)        11676001
116770                 MOVE ASC-KEY-TRIP-ID                             11677001
116780                                 TO DP013-MESSAGE-TEXT (3)        11678001
116790                 MOVE SQLCA      TO DP013-SQLCA                   11679001
116800                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      11680001
116810                     SET DP013-DB2-ABEND                          11681001
116820                         DP013-XCTL-DISPLAY-RESTART               11682001
116830                                     TO TRUE                      11683001
116840                 PERFORM DP013-0000-PROCESS-ABEND                 11684001
116850         END-EVALUATE                                             11685001
116860     END-PERFORM.                                                 11686001
116870                                                                  11687001
116880     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11688001
116890             AND (SQLCODE = -904 OR -913)                         11689001
116900         MOVE '5110-INSERT-TRECEIV'                               11690001
116910                                  TO DP013-PARAGRAPH              11691001
116920         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TRECEIV'         11692001
116930                                  TO DP013-MESSAGE-TEXT (1)       11693001
116940         MOVE SQLCA               TO DP013-SQLCA                  11694001
116950         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     11695001
116960         SET DP013-DB2-ABEND                                      11696001
116970             DP013-XCTL-DISPLAY-RESTART                           11697001
116980                                  TO TRUE                         11698001
116990         PERFORM DP013-0000-PROCESS-ABEND                         11699001
117000     END-IF.                                                      11700001
117010                                                                  11701001
117011 5113-INSERT-PO-TRACK.                                            11701135
117012                                                                  11701235
117013     MOVE RECEIV-ORD-NBR           TO  RCT00017-PO-NBR.           11701335
117016     MOVE RECEIV-REC-SEQ-NBR       TO  RCT00017-RCVR-SEQ-NBR.     11701635
117017     MOVE RECEIV-OPER-UNT-ID       TO  RCT00017-LOC-NBR.          11701735
117018     MOVE RECEIV-CURR-OPER-UNT-ID  TO  RCT00017-DEST-LOC-NBR.     11701835
117019     MOVE DP020-USERID             TO  RCT00017-CRE-BY-USR-ID.    11701935
117020     MOVE '0N'                     TO  RCT00017-DC-FUNC-CDE.      11702035
117021     MOVE 'RCKCS221'               TO  RCT00017-CRE-BY-PGM-NM.    11702135
117022     MOVE 0                        TO  RCT00017-PO-LNE-NBR        11702235
117023                                       RCT00017-PREPK-ID          11702335
117024                                       RCT00017-QTY-TRKD-NBR      11702435
117025                                       RCT00017-PKSL-SEQ-NBR.     11702535
117026                                                                  11702635
117027     PERFORM                                                      11702735
117028         WITH TEST AFTER                                          11702835
117029         VARYING PV-RETRY-COUNTER                                 11702935
117030         FROM 1 BY 1                                              11703035
117031         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11703135
117032             OR (SQLCODE = +0))                                   11703235
117033                                                                  11703335
117034         EXEC SQL                                                 11703435
117035              INSERT INTO RCT_PO_RCVR_TRKG                        11703535
117036                     ( PO_NBR                                     11703635
117037                      ,RCVR_SEQ_NBR                               11703735
117038                      ,CRE_BY_USR_ID                              11703835
117039                      ,CRE_TMST                                   11703935
117040                      ,DC_FUNC_CDE                                11704035
117041                      ,LOC_NBR                                    11704135
117042                      ,PO_LNE_NBR                                 11704235
117043                      ,PREPK_ID                                   11704335
117044                      ,CRE_BY_PGM_NM                              11704435
117045                      ,QTY_TRKD_NBR                               11704535
117046                      ,LAST_UPD_TMST                              11704635
117047                      ,PKSL_SEQ_NBR                               11704735
117050                      ,DEST_LOC_NBR                               11705035
117066                      )                                           11706635
117067             VALUES ( :RCT00017-PO-NBR                            11706735
117068                     ,:RCT00017-RCVR-SEQ-NBR                      11706835
117070                     ,:RCT00017-CRE-BY-USR-ID                     11707035
117071                     , CURRENT TIMESTAMP                          11707135
117072                     ,:RCT00017-DC-FUNC-CDE                       11707235
117073                     ,:RCT00017-LOC-NBR                           11707335
117074                     ,:RCT00017-PO-LNE-NBR                        11707435
117075                     ,:RCT00017-PREPK-ID                          11707535
117076                     ,:RCT00017-CRE-BY-PGM-NM                     11707635
117077                     ,:RCT00017-QTY-TRKD-NBR                      11707735
117078                     , CURRENT TIMESTAMP                          11707835
117094                     ,:RCT00017-PKSL-SEQ-NBR                      11709435
117102                     ,:RCT00017-DEST-LOC-NBR                      11710235
117112                     )                                            11711235
117113         END-EXEC                                                 11711335
117114                                                                  11711435
117115         EVALUATE TRUE                                            11711535
117116             WHEN SQLCODE = +0                                    11711635
117119             WHEN SQLCODE = -904                                  11711935
117120             WHEN SQLCODE = -913                                  11712035
117121                 CONTINUE                                         11712135
117122                                                                  11712235
117123             WHEN SQLWARN0 NOT = SPACE                            11712335
117124             WHEN SQLCODE < +0                                    11712435
117125             WHEN SQLCODE > +0                                    11712535
117126                                                                  11712635
117127                 MOVE RCT00017-LOC-NBR      TO PV-DISP-OPER       11712735
117128                 MOVE RCT00017-PO-NBR       TO PV-DISP-PO         11712835
117129                 MOVE RCT00017-RCVR-SEQ-NBR TO PV-DISP-RCVR       11712935
117130                                                                  11713035
117131                 MOVE '5113-INSERT-PO-TRACK'                      11713135
117132                                 TO DP013-PARAGRAPH               11713235
117133                 MOVE 'INSERT PO TRACKING TABLE'                  11713335
117134                                 TO DP013-MESSAGE-TEXT (1)        11713435
117135                 STRING PV-DISP-OPER '-'                          11713535
117136                        PV-DISP-PO   '-'                          11713635
117137                        PV-DISP-RCVR  DELIMITED BY SIZE           11713735
117138                                 INTO DP013-MESSAGE-TEXT (2)      11713835
117143                 MOVE SQLCA      TO DP013-SQLCA                   11714335
117144                 MOVE 'RCT00017'  TO DP013-DB2-TABLE-NAME (1)     11714435
117145                     SET DP013-DB2-ABEND                          11714535
117146                         DP013-XCTL-DISPLAY-RESTART               11714635
117147                                     TO TRUE                      11714735
117148                 PERFORM DP013-0000-PROCESS-ABEND                 11714835
117149         END-EVALUATE                                             11714935
117150     END-PERFORM.                                                 11715035
117151                                                                  11715135
117152     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11715235
117153             AND (SQLCODE = -904 OR -913)                         11715335
117154         MOVE '5113-INSERT-PO-TRACK'                              11715435
117155                                  TO DP013-PARAGRAPH              11715535
117156         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON PO TRACKING'     11715635
117157                                  TO DP013-MESSAGE-TEXT (1)       11715735
117158         MOVE SQLCA               TO DP013-SQLCA                  11715835
117159         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     11715935
117160         SET DP013-DB2-ABEND                                      11716035
117161             DP013-XCTL-DISPLAY-RESTART                           11716135
117162                                  TO TRUE                         11716235
117163         PERFORM DP013-0000-PROCESS-ABEND                         11716335
117164     END-IF.                                                      11716435
117165                                                                  11716535
117166                                                                  11716635
117167 5115-INSERT-TPOSYNC.                                             11716701
117168     EXEC SQL                                                     11716801
117169         INSERT INTO TPOSYNC                                      11716901
117170           ( PO_NBR                                               11717001
117171            ,LAST_SYNC_TMST                                       11717101
117172            ,SYNC_STAT_CDE                                        11717201
117173           )                                                      11717301
117174         VALUES                                                   11717401
117175           ( :RECEIV-ORD-NBR                                      11717501
117176           , CURRENT TIMESTAMP                                    11717601
117177           , 'N'                                                  11717701
117178           )                                                      11717801
117179     END-EXEC                                                     11717901
117180                                                                  11718001
117181     EVALUATE TRUE                                                11718101
117182         WHEN SQLCODE = ZERO                                      11718201
117183         WHEN SQLCODE = -803                                      11718301
117190                 CONTINUE                                         11719001
117200         WHEN SQLCODE = -904                                      11720001
117210         WHEN SQLCODE = -913                                      11721001
117220         WHEN SQLCODE = -911                                      11722001
117230         MOVE '5115-INSERT-TPOSYNC'                               11723001
117240                                 TO DP013-PARAGRAPH               11724001
117250         MOVE 'DB2 TIMEOUT ON INSERT ON TPOSYNC'                  11725001
117260                                  TO DP013-MESSAGE-TEXT (1)       11726001
117270         MOVE SQLCA               TO DP013-SQLCA                  11727001
117280         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     11728001
117290         SET DP013-DB2-ABEND                                      11729001
117300             DP013-XCTL-DISPLAY-RESTART                           11730001
117310                                  TO TRUE                         11731001
117320         PERFORM DP013-0000-PROCESS-ABEND                         11732001
117330                                                                  11733001
117340         WHEN SQLWARN0 NOT = SPACE                                11734001
117350         WHEN SQLCODE < ZERO                                      11735001
117360         WHEN SQLCODE > ZERO                                      11736001
117370             MOVE '5115-INSERT-TPOSYNC'                           11737001
117380                                 TO DP013-PARAGRAPH               11738001
117390             MOVE 'INSERT ON POSYNC TABLE'                        11739001
117400                                 TO DP013-MESSAGE-TEXT (1)        11740001
117410             MOVE SQLCA      TO DP013-SQLCA                       11741001
117420             MOVE 'TPOSYNC'  TO DP013-DB2-TABLE-NAME (1)          11742001
117430             SET DP013-DB2-ABEND                                  11743001
117440                 DP013-XCTL-DISPLAY-RESTART                       11744001
117450                                     TO TRUE                      11745001
117460             PERFORM DP013-0000-PROCESS-ABEND                     11746001
117470     END-EVALUATE.                                                11747001
117480/                                                                 11748001
117490/                                                                 11749001
117500*----------------------------------------------------------------*11750001
117510* OPEN THE TRECVER CURSOR                                        *11751001
117520*----------------------------------------------------------------*11752001
117530                                                                  11753001
117540 5120-OPEN-TRECVER-CSR.                                           11754001
117550                                                                  11755001
117560     PERFORM                                                      11756001
117570         WITH TEST AFTER                                          11757001
117580         VARYING PV-RETRY-COUNTER                                 11758001
117590         FROM 1 BY 1                                              11759001
117600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11760001
117610            OR (SQLCODE = +0))                                    11761001
117620                                                                  11762001
117630         EXEC SQL                                                 11763001
117640              OPEN TRECVER-CSR                                    11764001
117650         END-EXEC                                                 11765001
117660                                                                  11766001
117670         EVALUATE TRUE                                            11767001
117680             WHEN SQLCODE = +0                                    11768001
117690                  CONTINUE                                        11769001
117700             WHEN SQLCODE = -904                                  11770001
117710             WHEN SQLCODE = -913                                  11771001
117720                  CONTINUE                                        11772001
117730             WHEN SQLWARN0 NOT = SPACE                            11773001
117740             WHEN SQLCODE  NOT = +0                               11774001
117750                  MOVE '5120-OPEN-TRECVER-CSR'                    11775001
117760                                   TO DP013-PARAGRAPH             11776001
117770                  MOVE 'OPEN TRECVER CURSOR'                      11777001
117780                                   TO DP013-MESSAGE-TEXT (1)      11778001
117790                  MOVE SQLCA       TO DP013-SQLCA                 11779001
117800                  MOVE 'TRECVER'   TO DP013-DB2-TABLE-NAME (1)    11780001
117810                  SET DP013-DB2-ABEND                             11781001
117820                                   TO TRUE                        11782001
117830                  PERFORM DP013-0000-PROCESS-ABEND                11783001
117840         END-EVALUATE                                             11784001
117850     END-PERFORM.                                                 11785001
117860                                                                  11786001
117870     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11787001
117880             AND (SQLCODE = -904 OR -913)                         11788001
117890         MOVE '5120-OPEN-TRECVER-CSR' TO DP013-PARAGRAPH          11789001
117900         MOVE 'MAX RETRIES EXCEEDED FOR OPEN TRECVER CURSOR'      11790001
117910                                   TO DP013-MESSAGE-TEXT (1)      11791001
117920         MOVE SQLCA                TO DP013-SQLCA                 11792001
117930         SET DP013-DB2-ABEND       TO TRUE                        11793001
117940         PERFORM DP013-0000-PROCESS-ABEND                         11794001
117950     END-IF.                                                      11795001
117960                                                                  11796001
117970/                                                                 11797001
117980*----------------------------------------------------------------*11798001
117990*    FETCH A TOSOPFA ROW                                         *11799001
118000*----------------------------------------------------------------*11800001
118010                                                                  11801001
118020 5125-FETCH-TRECVER-CSR.                                          11802001
118030                                                                  11803001
118040     EXEC SQL                                                     11804001
118050          FETCH TRECVER-CSR                                       11805001
118060          INTO :RECVER-MAX-RCVR-NBR                               11806001
118070     END-EXEC                                                     11807001
118080                                                                  11808001
118090     EVALUATE TRUE                                                11809001
118100         WHEN SQLCODE = +0                                        11810001
118110              CONTINUE                                            11811001
118120                                                                  11812001
118130         WHEN SQLCODE = +100                                      11813001
118140              SET PS-EOF-TRECVER-CSR TO TRUE                      11814001
118150                                                                  11815001
118160         WHEN SQLWARN0 NOT = SPACE                                11816001
118170         WHEN SQLCODE < +0                                        11817001
118180         WHEN SQLCODE > +0                                        11818001
118190              MOVE '5125-FETCH-TRECVER-CSR'                       11819001
118200                                   TO DP013-PARAGRAPH             11820001
118210              MOVE 'FETCH TRECVER CURSOR'                         11821001
118220                                   TO DP013-MESSAGE-TEXT (1)      11822001
118230              MOVE SQLCA           TO DP013-SQLCA                 11823001
118240              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    11824001
118250              SET DP013-DB2-ABEND  TO TRUE                        11825001
118260              PERFORM DP013-0000-PROCESS-ABEND                    11826001
118270     END-EVALUATE.                                                11827001
118280                                                                  11828001
118290/                                                                 11829001
118300*----------------------------------------------------------------*11830001
118310*    UDPATE CURRENT CURSOR                                       *11831001
118320*----------------------------------------------------------------*11832001
118330                                                                  11833001
118340 5130-DELETE-TRECVER-CSR.                                         11834001
118350                                                                  11835001
118360     EXEC SQL                                                     11836001
118370          DELETE FROM TRECVER                                     11837001
118380            WHERE CURRENT OF TRECVER-CSR                          11838001
118390     END-EXEC                                                     11839001
118400                                                                  11840001
118410     EVALUATE TRUE                                                11841001
118420         WHEN SQLCODE = +0                                        11842001
118430              CONTINUE                                            11843001
118440                                                                  11844001
118450         WHEN SQLWARN0 NOT = SPACE                                11845001
118460         WHEN SQLCODE < +0                                        11846001
118470         WHEN SQLCODE > +0                                        11847001
118480              MOVE '5130-DELETE-TRECVER-CSR'                      11848001
118490                                   TO DP013-PARAGRAPH             11849001
118500              MOVE 'DELETE TRECVER CURSOR'                        11850001
118510                                   TO DP013-MESSAGE-TEXT (1)      11851001
118520              MOVE SQLCA           TO DP013-SQLCA                 11852001
118530              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    11853001
118540              SET DP013-DB2-ABEND  TO TRUE                        11854001
118550              PERFORM DP013-0000-PROCESS-ABEND                    11855001
118560     END-EVALUATE.                                                11856001
118570                                                                  11857001
118580/                                                                 11858001
118590*----------------------------------------------------------------*11859001
118600* INSERT THE TRECVER ROW                                         *11860001
118610*----------------------------------------------------------------*11861001
118620                                                                  11862001
118630 5135-INSERT-TRECVER.                                             11863001
118640                                                                  11864001
118650     PERFORM                                                      11865001
118660         WITH TEST AFTER                                          11866001
118670         VARYING PV-RETRY-COUNTER                                 11867001
118680         FROM 1 BY 1                                              11868001
118690         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11869001
118700             OR (SQLCODE = +0))                                   11870001
118710                                                                  11871001
118720         EXEC SQL                                                 11872001
118730              INSERT INTO TRECVER                                 11873001
118740                     ( OPERCO_NBR                                 11874001
118750                      ,MAX_RCVR_NBR )                             11875001
118760              VALUES ( '03'                                       11876001
118770                      ,:RECVER-MAX-RCVR-NBR )                     11877001
118780         END-EXEC                                                 11878001
118790                                                                  11879001
118800         EVALUATE TRUE                                            11880001
118810             WHEN SQLCODE = +0                                    11881001
118820             WHEN SQLCODE = -904                                  11882001
118830             WHEN SQLCODE = -913                                  11883001
118840                 CONTINUE                                         11884001
118850                                                                  11885001
118860             WHEN SQLWARN0 NOT = SPACE                            11886001
118870             WHEN SQLCODE < +0                                    11887001
118880             WHEN SQLCODE > +0                                    11888001
118890                 MOVE '5135-INSERT-TRECVER'                       11889001
118900                                 TO DP013-PARAGRAPH               11890001
118910                 MOVE 'INSERT ON TRECVER TABLE   '                11891001
118920                                 TO DP013-MESSAGE-TEXT (1)        11892001
118930                 MOVE SQLCA      TO DP013-SQLCA                   11893001
118940                 MOVE 'TRECVER'  TO DP013-DB2-TABLE-NAME (1)      11894001
118950                     SET DP013-DB2-ABEND                          11895001
118960                         DP013-XCTL-DISPLAY-RESTART               11896001
118970                                     TO TRUE                      11897001
118980                 PERFORM DP013-0000-PROCESS-ABEND                 11898001
118990         END-EVALUATE                                             11899001
119000     END-PERFORM.                                                 11900001
119010                                                                  11901001
119020     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11902001
119030             AND (SQLCODE = -904 OR -913)                         11903001
119040         MOVE '5135-INSERT-TRECVER'                               11904001
119050                                  TO DP013-PARAGRAPH              11905001
119060         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TRECVER'         11906001
119070                                  TO DP013-MESSAGE-TEXT (1)       11907001
119080         MOVE SQLCA               TO DP013-SQLCA                  11908001
119090         MOVE 'TRECVER '          TO DP013-DB2-TABLE-NAME (1)     11909001
119100         SET DP013-DB2-ABEND                                      11910001
119110             DP013-XCTL-DISPLAY-RESTART                           11911001
119120                                  TO TRUE                         11912001
119130         PERFORM DP013-0000-PROCESS-ABEND                         11913001
119140     END-IF.                                                      11914001
119150                                                                  11915001
119160/                                                                 11916001
119170*----------------------------------------------------------------*11917001
119180* CLOSE THE TRECVER CURSOR                                       *11918001
119190*----------------------------------------------------------------*11919001
119200                                                                  11920001
119210 5140-CLOSE-TRECVER-CSR.                                          11921001
119220                                                                  11922001
119230     EXEC SQL                                                     11923001
119240          CLOSE TRECVER-CSR                                       11924001
119250     END-EXEC                                                     11925001
119260                                                                  11926001
119270     EVALUATE TRUE                                                11927001
119280         WHEN SQLCODE = +0                                        11928001
119290              CONTINUE                                            11929001
119300         WHEN SQLWARN0 NOT = SPACE                                11930001
119310         WHEN SQLCODE  NOT = +0                                   11931001
119320              MOVE '5140-CLOSE-TRECVER-CSR'                       11932001
119330                                   TO DP013-PARAGRAPH             11933001
119340              MOVE 'CLOSE TRECVER CURSOR'                         11934001
119350                                   TO DP013-MESSAGE-TEXT (1)      11935001
119360              MOVE SQLCA           TO DP013-SQLCA                 11936001
119370              MOVE 'TRECVER'       TO DP013-DB2-TABLE-NAME (1)    11937001
119380              SET DP013-DB2-ABEND  TO TRUE                        11938001
119390              PERFORM DP013-0000-PROCESS-ABEND                    11939001
119400     END-EVALUATE.                                                11940001
119410                                                                  11941001
119420/                                                                 11942001
119430 5150-CHECK-FOR-TROUBLE.                                          11943001
119440                                                                  11944001
119450     INITIALIZE TM500-FIELDS.                                     11945001
119460                                                                  11946001
119470     SET  TM500-CREATE-AUTO        TO TRUE.                       11947001
119480     SET  TM500-PO-LEVEL           TO TRUE.                       11948001
119490     SET  TM500-NO-DETAILS         TO TRUE.                       11949001
119500                                                                  11950001
119510     MOVE RECEIV-ORD-NBR           TO TM500-PO-NBR.               11951001
119520     MOVE RECEIV-OPER-UNT-ID       TO TM500-OPER-UNT-ID.          11952001
119530     MOVE RECEIV-FCLTY-ID          TO TM500-FCLTY-ID.             11953001
119540     MOVE PC-CURRENT-PROGRAM-NAME  TO TM500-NOTIF-UID.            11954001
119550     MOVE ASC-VEND-SHIP-DTE-ISO    TO TM500-VEND-SHIP-DTE.        11955001
119560     MOVE RECEIV-REC-SEQ-NBR       TO TM500-REC-SEQ-NBR.          11956001
119570                                                                  11957001
119580     EXEC CICS                                                    11958001
119590         LINK PROGRAM  (PC-TROUBLE-RTN)                           11959001
119600              COMMAREA (TM500-FIELDS)                             11960001
119610              LENGTH   (PC-TROUBLE-RTN-LENGTH)                    11961001
119620     END-EXEC.                                                    11962001
119630                                                                  11963001
119640     IF TM500-CALL-SUCCESSFUL        OR                           11964001
119650        TM500-TPURCHS-SELECT-NOT-FND OR                           11965001
119660        TM500-DUPLICATE-TROUBLE      OR                           11966001
119670        TM500-TTRBNTF-UPDATE-NOT-FND                              11967001
119680         CONTINUE                                                 11968001
119690     ELSE                                                         11969001
119700         MOVE '5150-CHECK-FOR-TROUBLE '                           11970001
119710                         TO DP013-PARAGRAPH                       11971001
119720         MOVE 'UNSUCCESSFUL CALL TO TROUBLE RTN'                  11972001
119730                         TO DP013-MESSAGE-TEXT (1)                11973001
119740         MOVE TM500-RETURN-MSG                                    11974001
119750                         TO DP013-MESSAGE-TEXT (2)                11975001
119760         MOVE TM500-SQLCA                                         11976001
119770                         TO DP013-SQLCA                           11977001
119780         SET DP013-DB2-ABEND                                      11978001
119790             DP013-XCTL-DISPLAY-RESTART                           11979001
119800                         TO TRUE                                  11980001
119810         PERFORM DP013-0000-PROCESS-ABEND                         11981001
119820     END-IF.                                                      11982001
119830                                                                  11983001
119840/                                                                 11984001
119850*----------------------------------------------------------------*11985001
119860* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *11986001
119870* OBJECT WAS UPDATED.                                            *11987001
119880*----------------------------------------------------------------*11988001
119890                                                                  11989001
119900 5200-UPDATE-SELECTION-QUEUE.                                     11990001
119910                                                                  11991001
119920     PERFORM 9100-READ-SEL-QUEUE.                                 11992001
119930                                                                  11993001
119940     SET RC013-UPD (ASC-SEL-SUB) TO TRUE.                         11994001
119950                                                                  11995001
119960     PERFORM 9200-REWRITE-SEL-QUEUE.                              11996001
119970                                                                  11997001
119980/                                                                 11998001
119990 5300-BUILD-ZERO-LINE-WORK-ORD.                                   11999001
120000                                                                  12000001
120010     INITIALIZE DCLTWRKORD.                                       12001001
120020                                                                  12002001
120030     MOVE ASC-PO-NBR-N           TO WRKORD-ORD-NBR.               12003001
120040     MOVE ASC-REC-SEQ-NBR        TO WRKORD-RCVR-SEQ-NBR.          12004001
120050*** DMH BEGIN 11/04/08                                            12005001
120060***  MOVE ASC-OPER-UNT-ID-N      TO WRKORD-OPER-UNT-ID.           12006001
120070     MOVE CURR-OPER-UNT-ID       TO WRKORD-OPER-UNT-ID.           12007001
120080*** DMH END   11/04/08                                            12008001
120090     MOVE ASC-FCLTY-ID-N         TO WRKORD-FCLTY-ID.              12009001
120100     MOVE +1                     TO WRKORD-WORK-ORD-SEQ-NBR.      12010001
120110     MOVE ASC-ACTL-CART-CNT-N    TO WRKORD-ACTL-CART-CNT.         12011001
120120     MOVE ASC-EXPTED-CART-CNT-N  TO WRKORD-EXPTED-CART-CNT.       12012001
120130     MOVE 'A'                    TO WRKORD-VER-STATUS-CDE.        12013001
120140     MOVE 'IP'                   TO WRKORD-STAT-CDE.              12014001
120150     MOVE 'N'                    TO WRKORD-WORK-ORD-DISTR-IND.    12015001
120160     MOVE ASC-OPER-SET-ID-N      TO WRKORD-OPER-SET-ID.           12016001
120170                                                                  12017001
120180     PERFORM 5305-INACTIVATE-TWRKORD.                             12018001
120190     PERFORM 5310-INSERT-TWRKORD.                                 12019001
120200                                                                  12020001
120210     MOVE +0                     TO PV-WO-INSTR-SEQ-NBR.          12021001
120220     MOVE 'N'                    TO PS-TOSOPFA-CURSOR-SW.         12022001
120230     MOVE 'Y'                    TO PS-INSTRUCTION-SW.            12023001
120240     PERFORM 5320-OPEN-TOSOPFA-CSR.                               12024001
120250     PERFORM 5330-FETCH-TOSOPFA-CSR.                              12025001
120260                                                                  12026001
120270     PERFORM UNTIL PS-EOF-TOSOPFA-CSR                             12027001
120280        PERFORM 5400-BUILD-WORK-ORDER-INSTR                       12028001
120290        PERFORM 5330-FETCH-TOSOPFA-CSR                            12029001
120300     END-PERFORM.                                                 12030001
120310                                                                  12031001
120320     PERFORM 5340-CLOSE-TOSOPFA-CSR.                              12032001
120330                                                                  12033001
120340/                                                                 12034001
120350 5305-INACTIVATE-TWRKORD.                                         12035001
120360                                                                  12036001
120370         EXEC SQL                                                 12037001
120380           UPDATE TWRKORD                                         12038001
120390              SET VER_STATUS_CDE   =  :PC-I                       12039001
120400           WHERE                                                  12040001
120410                 ORD_NBR           = :WRKORD-ORD-NBR              12041001
120420            AND  RCVR_SEQ_NBR      = :WRKORD-RCVR-SEQ-NBR         12042001
120430            AND  ORD_LNE_NBR       = :WRKORD-ORD-LNE-NBR          12043001
120440            AND  WORK_ORD_SEQ_NBR  = :WRKORD-WORK-ORD-SEQ-NBR     12044001
120450            AND  OPER_UNT_ID       = :WRKORD-OPER-UNT-ID          12045001
120460            AND  FCLTY_ID          = :WRKORD-FCLTY-ID             12046001
120470         END-EXEC.                                                12047001
120480                                                                  12048001
120490         EVALUATE TRUE                                            12049001
120500             WHEN SQLCODE = +0                                    12050001
120510             WHEN SQLCODE = +100                                  12051001
120520                 CONTINUE                                         12052001
120530                                                                  12053001
120540             WHEN SQLWARN0 NOT = SPACES                           12054001
120550             WHEN SQLCODE < +0                                    12055001
120560             WHEN SQLCODE > +0                                    12056001
120570                 MOVE '5305-INACTIVATE-TWRKORD'                   12057001
120580                                   TO DP013-PARAGRAPH             12058001
120590                 MOVE 'UPDATE VER STATUS CODE ON TWRKORD'         12059001
120600                                   TO DP013-MESSAGE-TEXT(1)       12060001
120610                 MOVE SQLCA        TO DP013-SQLCA                 12061001
120620                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    12062001
120630                 SET DP013-DB2-ABEND                              12063001
120640                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12064001
120650                 PERFORM DP013-0000-PROCESS-ABEND                 12065001
120660         END-EVALUATE.                                            12066001
120670/                                                                 12067001
120680 5310-INSERT-TWRKORD.                                             12068001
120690                                                                  12069001
120700     PERFORM                                                      12070001
120710         WITH TEST AFTER                                          12071001
120720         VARYING PV-RETRY-COUNTER                                 12072001
120730         FROM 1 BY 1                                              12073001
120740         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12074001
120750             OR (SQLCODE = +0))                                   12075001
120760                                                                  12076001
120770         EXEC SQL                                                 12077001
120780              INSERT INTO TWRKORD                                 12078001
120790                     ( ORD_NBR                                    12079001
120800                      ,RCVR_SEQ_NBR                               12080001
120810                      ,ORD_LNE_NBR                                12081001
120820                      ,WORK_ORD_SEQ_NBR                           12082001
120830                      ,OPER_UNT_ID                                12083001
120840                      ,FCLTY_ID                                   12084001
120850                      ,CRE_TMST                                   12085001
120860                      ,VER_STATUS_CDE                             12086001
120870                      ,CRE_UID_ID                                 12087001
120880                      ,EXPTED_CART_CNT                            12088001
120890                      ,ACTL_CART_CNT                              12089001
120900                      ,EXPTED_ITM_CNT                             12090001
120910                      ,ACTL_ITM_CNT                               12091001
120920                      ,STAT_CDE                                   12092001
120930                      ,WORK_ORD_DISTR_IND                         12093001
120940                      ,OPER_SET_ID )                              12094001
120950              VALUES ( :WRKORD-ORD-NBR                            12095001
120960                      ,:WRKORD-RCVR-SEQ-NBR                       12096001
120970                      ,:WRKORD-ORD-LNE-NBR                        12097001
120980                      ,:WRKORD-WORK-ORD-SEQ-NBR                   12098001
120990                      ,:WRKORD-OPER-UNT-ID                        12099001
121000                      ,:WRKORD-FCLTY-ID                           12100001
121010                      ,CURRENT TIMESTAMP                          12101001
121020                      ,:WRKORD-VER-STATUS-CDE                     12102001
121030                      ,:DP020-USERID                              12103001
121040                      ,:WRKORD-EXPTED-CART-CNT                    12104001
121050                      ,:WRKORD-ACTL-CART-CNT                      12105001
121060                      ,:WRKORD-EXPTED-ITM-CNT                     12106001
121070                      ,:WRKORD-ACTL-ITM-CNT                       12107001
121080                      ,:WRKORD-STAT-CDE                           12108001
121090                      ,:WRKORD-WORK-ORD-DISTR-IND                 12109001
121100                      ,:WRKORD-OPER-SET-ID )                      12110001
121110         END-EXEC                                                 12111001
121120                                                                  12112001
121130         EVALUATE TRUE                                            12113001
121140             WHEN SQLCODE = +0                                    12114001
121150             WHEN SQLCODE = -904                                  12115001
121160             WHEN SQLCODE = -913                                  12116001
121170                 CONTINUE                                         12117001
121180                                                                  12118001
121190             WHEN SQLWARN0 NOT = SPACE                            12119001
121200             WHEN SQLCODE < +0                                    12120001
121210             WHEN SQLCODE > +0                                    12121001
121220                 MOVE '5310-INSERT-TWRKORD'                       12122001
121230                                 TO DP013-PARAGRAPH               12123001
121240                 MOVE 'INSERT ON WORK ORDER TABLE'                12124001
121250                                 TO DP013-MESSAGE-TEXT (1)        12125001
121260                 MOVE SQLCA      TO DP013-SQLCA                   12126001
121270                 MOVE 'TWRKORD'  TO DP013-DB2-TABLE-NAME (1)      12127001
121280                     SET DP013-DB2-ABEND                          12128001
121290                         DP013-XCTL-DISPLAY-RESTART               12129001
121300                                     TO TRUE                      12130001
121310                 PERFORM DP013-0000-PROCESS-ABEND                 12131001
121320         END-EVALUATE                                             12132001
121330     END-PERFORM.                                                 12133001
121340                                                                  12134001
121350     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12135001
121360             AND (SQLCODE = -904 OR -913)                         12136001
121370         MOVE '5310-INSERT-TWRKORD'                               12137001
121380                                  TO DP013-PARAGRAPH              12138001
121390         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TWRKORD'         12139001
121400                                  TO DP013-MESSAGE-TEXT (1)       12140001
121410         MOVE SQLCA               TO DP013-SQLCA                  12141001
121420         MOVE 'TWRKORD '          TO DP013-DB2-TABLE-NAME (1)     12142001
121430         SET DP013-DB2-ABEND                                      12143001
121440             DP013-XCTL-DISPLAY-RESTART                           12144001
121450                                  TO TRUE                         12145001
121460         PERFORM DP013-0000-PROCESS-ABEND                         12146001
121470     END-IF.                                                      12147001
121480                                                                  12148001
121490/                                                                 12149001
121500*----------------------------------------------------------------*12150001
121510* OPEN THE TOSOPFA CURSOR                                        *12151001
121520*----------------------------------------------------------------*12152001
121530                                                                  12153001
121540 5320-OPEN-TOSOPFA-CSR.                                           12154001
121550                                                                  12155001
121560     PERFORM                                                      12156001
121570         WITH TEST AFTER                                          12157001
121580         VARYING PV-RETRY-COUNTER                                 12158001
121590         FROM 1 BY 1                                              12159001
121600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12160001
121610            OR (SQLCODE = +0))                                    12161001
121620                                                                  12162001
121630         EXEC SQL                                                 12163001
121640              OPEN TOSOPFA-CSR                                    12164001
121650         END-EXEC                                                 12165001
121660                                                                  12166001
121670         EVALUATE TRUE                                            12167001
121680             WHEN SQLCODE = +0                                    12168001
121690                  CONTINUE                                        12169001
121700             WHEN SQLCODE = -904                                  12170001
121710             WHEN SQLCODE = -913                                  12171001
121720                  CONTINUE                                        12172001
121730             WHEN SQLWARN0 NOT = SPACE                            12173001
121740             WHEN SQLCODE  NOT = +0                               12174001
121750                  MOVE '5320-OPEN-TOSOPFA-CSR'                    12175001
121760                                   TO DP013-PARAGRAPH             12176001
121770                  MOVE 'OPEN TOSOPFA CURSOR'                      12177001
121780                                   TO DP013-MESSAGE-TEXT (1)      12178001
121790                  MOVE SQLCA       TO DP013-SQLCA                 12179001
121800                  MOVE 'TOSOPFA'   TO DP013-DB2-TABLE-NAME (1)    12180001
121810                  SET DP013-DB2-ABEND                             12181001
121820                                   TO TRUE                        12182001
121830                  PERFORM DP013-0000-PROCESS-ABEND                12183001
121840         END-EVALUATE                                             12184001
121850     END-PERFORM.                                                 12185001
121860                                                                  12186001
121870     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12187001
121880             AND (SQLCODE = -904 OR -913)                         12188001
121890         MOVE '5320-OPEN-TOSOPFA-CSR' TO DP013-PARAGRAPH          12189001
121900         MOVE 'MAX RETRIES EXCEEDED FOR OPEN TOSOPFA CURSOR'      12190001
121910                                   TO DP013-MESSAGE-TEXT (1)      12191001
121920         MOVE SQLCA                TO DP013-SQLCA                 12192001
121930         SET DP013-DB2-ABEND       TO TRUE                        12193001
121940         PERFORM DP013-0000-PROCESS-ABEND                         12194001
121950     END-IF.                                                      12195001
121960                                                                  12196001
121970/                                                                 12197001
121980*----------------------------------------------------------------*12198001
121990*    FETCH A TOSOPFA ROW                                         *12199001
122000*----------------------------------------------------------------*12200001
122010                                                                  12201001
122020 5330-FETCH-TOSOPFA-CSR.                                          12202001
122030                                                                  12203001
122040     EXEC SQL                                                     12204001
122050          FETCH TOSOPFA-CSR                                       12205001
122060          INTO :OSOPFA-OPER-SET-ID                                12206001
122070              ,:OSOPFA-OPER-ID                                    12207001
122080              ,:OSOPFA-OPER-UNT-ID                                12208001
122090              ,:OSOPFA-FCLTY-ID                                   12209001
122100              ,:OSOPFA-FCLTY-AREA-ID                              12210001
122110              ,:OSOPFA-PRC-FCLTY-AREA-ID                          12211001
122120              ,:OSOPFA-SCRN-SEQ-NBR                               12212001
122130     END-EXEC                                                     12213001
122140                                                                  12214001
122150     EVALUATE TRUE                                                12215001
122160         WHEN SQLCODE = +0                                        12216001
122170              CONTINUE                                            12217001
122180                                                                  12218001
122190         WHEN SQLCODE = +100                                      12219001
122200              SET PS-EOF-TOSOPFA-CSR TO TRUE                      12220001
122210                                                                  12221001
122220         WHEN SQLWARN0 NOT = SPACE                                12222001
122230         WHEN SQLCODE < +0                                        12223001
122240         WHEN SQLCODE > +0                                        12224001
122250              MOVE '5330-FETCH-TOSOPFA-CSR'                       12225001
122260                                   TO DP013-PARAGRAPH             12226001
122270              MOVE 'FETCH TOSOPFA CURSOR'                         12227001
122280                                   TO DP013-MESSAGE-TEXT (1)      12228001
122290              MOVE SQLCA           TO DP013-SQLCA                 12229001
122300              MOVE 'TOSOPFA'       TO DP013-DB2-TABLE-NAME (1)    12230001
122310              SET DP013-DB2-ABEND  TO TRUE                        12231001
122320              PERFORM DP013-0000-PROCESS-ABEND                    12232001
122330     END-EVALUATE.                                                12233001
122340                                                                  12234001
122350/                                                                 12235001
122360*----------------------------------------------------------------*12236001
122370* CLOSE THE TOSOPFA CURSOR                                       *12237001
122380*----------------------------------------------------------------*12238001
122390                                                                  12239001
122400 5340-CLOSE-TOSOPFA-CSR.                                          12240001
122410                                                                  12241001
122420     EXEC SQL                                                     12242001
122430          CLOSE TOSOPFA-CSR                                       12243001
122440     END-EXEC                                                     12244001
122450                                                                  12245001
122460     EVALUATE TRUE                                                12246001
122470         WHEN SQLCODE = +0                                        12247001
122480              CONTINUE                                            12248001
122490         WHEN SQLWARN0 NOT = SPACE                                12249001
122500         WHEN SQLCODE  NOT = +0                                   12250001
122510              MOVE '5340-CLOSE-TOSOPFA-CSR'                       12251001
122520                                   TO DP013-PARAGRAPH             12252001
122530              MOVE 'CLOSE TOSOPFA CURSOR'                         12253001
122540                                   TO DP013-MESSAGE-TEXT (1)      12254001
122550              MOVE SQLCA           TO DP013-SQLCA                 12255001
122560              MOVE 'TOSOPFA'       TO DP013-DB2-TABLE-NAME (1)    12256001
122570              SET DP013-DB2-ABEND  TO TRUE                        12257001
122580              PERFORM DP013-0000-PROCESS-ABEND                    12258001
122590     END-EVALUATE.                                                12259001
122600                                                                  12260001
122610/                                                                 12261001
122620 5400-BUILD-WORK-ORDER-INSTR.                                     12262001
122630                                                                  12263001
122640     INITIALIZE DCLTWKORIN.                                       12264001
122650                                                                  12265001
122660     MOVE ASC-PO-NBR-N           TO WKORIN-ORD-NBR.               12266001
122670     MOVE ASC-REC-SEQ-NBR        TO WKORIN-RCVR-SEQ-NBR.          12267001
122680     MOVE +1                     TO WKORIN-WORK-ORD-SEQ-NBR.      12268001
122690     ADD +1                      TO PV-WO-INSTR-SEQ-NBR.          12269001
122700     MOVE PV-WO-INSTR-SEQ-NBR    TO WKORIN-WO-INSTR-SEQ-NBR.      12270001
122710     MOVE 'A'                    TO WKORIN-VER-STATUS-CDE.        12271001
122720*** DMH - BEGIN 11/04/08                                          12272001
122730***  MOVE ASC-OPER-UNT-ID-N      TO WKORIN-OPER-UNT-ID.           12273001
122740     MOVE CURR-OPER-UNT-ID       TO WKORIN-OPER-UNT-ID.           12274001
122750*** DMH - END   11/04/08                                          12275001
122760     MOVE ASC-FCLTY-ID-N         TO WKORIN-FCLTY-ID.              12276001
122770     MOVE OSOPFA-OPER-ID         TO WKORIN-OPER-ID.               12277001
122780     MOVE OSOPFA-FCLTY-AREA-ID   TO WKORIN-FCLTY-AREA-ID.         12278001
122790     MOVE OSOPFA-PRC-FCLTY-AREA-ID                                12279001
122800                                 TO WKORIN-PRC-FCLTY-AREA-ID.     12280001
122810     MOVE OSOPFA-SCRN-SEQ-NBR    TO WKORIN-SCREEN-SEQ-NBR.        12281001
122820     IF  PS-FIRST-INSTRUCTION                                     12282001
122830         MOVE 'N'                TO PS-INSTRUCTION-SW             12283001
122840         MOVE ASC-EXPTED-CART-CNT-N                               12284001
122850                                 TO WKORIN-EXPTED-CART-CNT        12285001
122860         MOVE ASC-ACTL-CART-CNT-N                                 12286001
122870                                 TO WKORIN-ACTL-CART-CNT          12287001
122880     END-IF.                                                      12288001
122890     MOVE 'N'                    TO WKORIN-ALLOC-IND              12289001
122900                                    WKORIN-REPACK-IND.            12290001
122910     MOVE '9999-09-09-09.09.09.999999'                            12291001
122920                                 TO WKORIN-STRT-TMST              12292001
122930                                    WKORIN-STOP-TMST.             12293001
122940                                                                  12294001
122950     PERFORM 5405-INACTIVATE-TWKORIN.                             12295001
122960     PERFORM 5410-INSERT-TWKORIN.                                 12296001
122970                                                                  12297001
122980 5405-INACTIVATE-TWKORIN.                                         12298001
122990                                                                  12299001
123000     EXEC SQL                                                     12300001
123010          UPDATE                                                  12301001
123020                 TWKORIN                                          12302001
123030             SET                                                  12303001
123040                 VER_STATUS_CDE      =  :PC-I                     12304001
123050           WHERE                                                  12305001
123060                 ORD_NBR             =  :WKORIN-ORD-NBR           12306001
123070             AND RCVR_SEQ_NBR        =  :WKORIN-RCVR-SEQ-NBR      12307001
123080             AND ORD_LNE_NBR         =  :WKORIN-ORD-LNE-NBR       12308001
123090             AND WORK_ORD_SEQ_NBR    =  :WKORIN-WORK-ORD-SEQ-NBR  12309001
123100             AND WO_INSTR_SEQ_NBR    =  :WKORIN-WO-INSTR-SEQ-NBR  12310001
123110             AND VER_STATUS_CDE      =  :PC-A                     12311001
123120     END-EXEC.                                                    12312001
123130                                                                  12313001
123140     EVALUATE TRUE                                                12314001
123150         WHEN SQLCODE = ZERO                                      12315001
123160         WHEN SQLCODE = +100                                      12316001
123170              CONTINUE                                            12317001
123180         WHEN SQLWARN0 NOT = SPACES                               12318001
123190         WHEN SQLCODE NOT EQUAL ZERO                              12319001
123200              MOVE '5405-INACTIVATE-TWKORIN'                      12320001
123210                                   TO DP013-PARAGRAPH             12321001
123220              MOVE '"LOGICAL" DELETE; SET STATUS TO I'            12322001
123230                                   TO DP013-MESSAGE-TEXT (1)      12323001
123240              MOVE SQLCA           TO DP013-SQLCA                 12324001
123250              MOVE 'TWKORIN'       TO DP013-DB2-TABLE-NAME (1)    12325001
123260              SET DP013-DB2-ABEND                                 12326001
123270                  DP013-XCTL-DISPLAY-RESTART                      12327001
123280                                   TO TRUE                        12328001
123290              PERFORM DP013-0000-PROCESS-ABEND                    12329001
123300     END-EVALUATE.                                                12330001
123310/                                                                 12331001
123320 5410-INSERT-TWKORIN.                                             12332001
123330                                                                  12333001
123340     PERFORM                                                      12334001
123350         WITH TEST AFTER                                          12335001
123360         VARYING PV-RETRY-COUNTER                                 12336001
123370         FROM 1 BY 1                                              12337001
123380         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12338001
123390             OR (SQLCODE = +0))                                   12339001
123400                                                                  12340001
123410         EXEC SQL                                                 12341001
123420              INSERT INTO TWKORIN                                 12342001
123430                     ( ORD_NBR                                    12343001
123440                      ,RCVR_SEQ_NBR                               12344001
123450                      ,ORD_LNE_NBR                                12345001
123460                      ,WORK_ORD_SEQ_NBR                           12346001
123470                      ,OPER_UNT_ID                                12347001
123480                      ,FCLTY_ID                                   12348001
123490                      ,WO_INSTR_SEQ_NBR                           12349001
123500                      ,CRE_TMST                                   12350001
123510                      ,VER_STATUS_CDE                             12351001
123520                      ,CRE_UID_ID                                 12352001
123530                      ,OPER_ID                                    12353001
123540                      ,FCLTY_AREA_ID                              12354001
123550                      ,PRC_FCLTY_AREA_ID                          12355001
123560                      ,EXPTED_CART_CNT                            12356001
123570                      ,ACTL_CART_CNT                              12357001
123580                      ,ALLOC_IND                                  12358001
123590                      ,REPACK_IND                                 12359001
123600                      ,STRT_TMST                                  12360001
123610                      ,STOP_TMST                                  12361001
123620                      ,SCREEN_SEQ_NBR                             12362001
123630                      ,LNE_LOC_CDE                                12363001
123640                      ,REC_SEL_IND )                              12364001
123650              VALUES ( :WKORIN-ORD-NBR                            12365001
123660                      ,:WKORIN-RCVR-SEQ-NBR                       12366001
123670                      ,:WKORIN-ORD-LNE-NBR                        12367001
123680                      ,:WKORIN-WORK-ORD-SEQ-NBR                   12368001
123690                      ,:WKORIN-OPER-UNT-ID                        12369001
123700                      ,:WKORIN-FCLTY-ID                           12370001
123710                      ,:WKORIN-WO-INSTR-SEQ-NBR                   12371001
123720                      ,CURRENT TIMESTAMP                          12372001
123730                      ,:WKORIN-VER-STATUS-CDE                     12373001
123740                      ,:DP020-USERID                              12374001
123750                      ,:WKORIN-OPER-ID                            12375001
123760                      ,:WKORIN-FCLTY-AREA-ID                      12376001
123770                      ,:WKORIN-PRC-FCLTY-AREA-ID                  12377001
123780                      ,:WKORIN-EXPTED-CART-CNT                    12378001
123790                      ,:WKORIN-ACTL-CART-CNT                      12379001
123800                      ,:WKORIN-ALLOC-IND                          12380001
123810                      ,:WKORIN-REPACK-IND                         12381001
123820                      ,:WKORIN-STRT-TMST                          12382001
123830                      ,:WKORIN-STOP-TMST                          12383001
123840                      ,:WKORIN-SCREEN-SEQ-NBR                     12384001
123850                      ,:WKORIN-LNE-LOC-CDE                        12385001
123860                      ,:WKORIN-REC-SEL-IND )                      12386001
123870         END-EXEC                                                 12387001
123880                                                                  12388001
123890         EVALUATE TRUE                                            12389001
123900             WHEN SQLCODE = +0                                    12390001
123910             WHEN SQLCODE = -904                                  12391001
123920             WHEN SQLCODE = -913                                  12392001
123930                 CONTINUE                                         12393001
123940                                                                  12394001
123950             WHEN SQLWARN0 NOT = SPACE                            12395001
123960             WHEN SQLCODE < +0                                    12396001
123970             WHEN SQLCODE > +0                                    12397001
123980                 MOVE '5410-INSERT-TWKORIN'                       12398001
123990                                 TO DP013-PARAGRAPH               12399001
124000                 MOVE 'INSERT ON WORK ORDER INSTRUCTION TABLE'    12400001
124010                                 TO DP013-MESSAGE-TEXT (1)        12401001
124020                 MOVE SQLCA      TO DP013-SQLCA                   12402001
124030                 MOVE 'TWKORIN'  TO DP013-DB2-TABLE-NAME (1)      12403001
124040                     SET DP013-DB2-ABEND                          12404001
124050                         DP013-XCTL-DISPLAY-RESTART               12405001
124060                                     TO TRUE                      12406001
124070                 PERFORM DP013-0000-PROCESS-ABEND                 12407001
124080         END-EVALUATE                                             12408001
124090     END-PERFORM.                                                 12409001
124100                                                                  12410001
124110     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12411001
124120             AND (SQLCODE = -904 OR -913)                         12412001
124130         MOVE '5410-INSERT-TWKORIN'                               12413001
124140                                  TO DP013-PARAGRAPH              12414001
124150         MOVE 'MAX RETRIES EXCEEDED ON INSERT ON TWKORIN'         12415001
124160                                  TO DP013-MESSAGE-TEXT (1)       12416001
124170         MOVE SQLCA               TO DP013-SQLCA                  12417001
124180         MOVE 'TWKORIN '          TO DP013-DB2-TABLE-NAME (1)     12418001
124190         SET DP013-DB2-ABEND                                      12419001
124200             DP013-XCTL-DISPLAY-RESTART                           12420001
124210                                  TO TRUE                         12421001
124220         PERFORM DP013-0000-PROCESS-ABEND                         12422001
124230     END-IF.                                                      12423001
124240                                                                  12424001
124250/                                                                 12425001
124260 5500-ASSIGN-RECEIVER.                                            12426001
124270                                                                  12427001
124280     MOVE ASC-SHIPT-ID           TO DK-SHIPT-ID.                  12428001
124290     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR.                    12429001
124300                                                                  12430001
124310                                                                  12431001
124320     PERFORM 5035-GET-REC-SEQ-NBR                                 12432001
124330     IF  SHPTPO-REC-SEQ-NBR > 0                                   12433001
124340         SET PS-ERROR                                             12434001
124350             DP020-MSG-FATAL    TO TRUE                           12435001
124360         MOVE PC-TSYMSG-00117   TO DP020-MSG-NUMBER               12436001
124370         MOVE DP015-UNP-ALP-BRT-OFF                               12437001
124380                                TO APONBRA                        12438001
124390         MOVE DP015-RED         TO APONBRC                        12439001
124400         MOVE DP015-REVERSE     TO APONBRH                        12440001
124410         MOVE -1                TO APONBRL                        12441001
124420         SET DP030-SET-CURSOR-APPL-1                              12442001
124430                                TO TRUE                           12443001
124440     END-IF                                                       12444001
124450                                                                  12445001
124460     IF  PS-NO-ERROR                                              12446001
124470         MOVE ASC-OPER-UNT-ID    TO DK-OPER-UNT-ID                12447001
124480         MOVE ASC-FCLTY-ID       TO DK-FCLTY-ID                   12448001
124490         MOVE ASC-KEY-PO-NBR     TO DK-PO-NBR                     12449001
124500                                    DK-ORD-NBR                    12450001
124510         MOVE ASC-SHIPT-ID       TO DK-SHIPT-ID                   12451001
124520         PERFORM 5015-GET-MAX-SEQ-NBR                             12452001
124530         MOVE PV-REC-SEQ-NBR     TO SHPTPO-REC-SEQ-NBR            12453001
124540                                    ASC-REC-SEQ-NBR               12454001
124550                                    ASC-KEY-REC-SEQ-NBR           12455001
124560         IF  ASC-ADD-MULTIPLE                                     12456001
124570             SET PS-NO-LIST-END        TO TRUE                    12457001
124580             PERFORM 1120-PREPARE-LIST-ENTRY                      12458001
124590             PERFORM UNTIL PS-LIST-END                            12459001
124600                MOVE ASC-KEY-SHIPT-ID                             12460001
124610                                     TO DK-SHIPT-ID               12461001
124620                PERFORM 5510-UPDATE-SEQ-NBR                       12462001
124630                MOVE PC-U           TO PV-TRN-CDE                 12463001
124640                PERFORM 8200-AUDIT-TSHPTPO                        12464001
124650                PERFORM 2110-GET-NEXT-RECORD                      12465001
124660             END-PERFORM                                          12466001
124670         ELSE                                                     12467001
124680             PERFORM 5510-UPDATE-SEQ-NBR                          12468001
124690             MOVE PC-U              TO PV-TRN-CDE                 12469001
124700             PERFORM 8200-AUDIT-TSHPTPO                           12470001
124710         END-IF                                                   12471001
124720         PERFORM 5100-BUILD-RECEIVER-INFO                         12472001
124730         IF PS-NO-ERROR                                           12473001
124740            PERFORM 5300-BUILD-ZERO-LINE-WORK-ORD                 12474001
124750            PERFORM 6000-UPDATE-RECEIVER                          12475001
124760         END-IF                                                   12476001
124770     END-IF.                                                      12477001
124780                                                                  12478001
124790/                                                                 12479001
124800 5510-UPDATE-SEQ-NBR.                                             12480001
124810                                                                  12481001
124820     PERFORM                                                      12482001
124830         WITH TEST AFTER                                          12483001
124840         VARYING PV-RETRY-COUNTER                                 12484001
124850         FROM 1 BY 1                                              12485001
124860         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12486001
124870             OR (SQLCODE = +0))                                   12487001
124880                                                                  12488001
124890         EXEC SQL                                                 12489001
124900           UPDATE TSHPTPO                                         12490001
124910              SET REC_SEQ_NBR      = :SHPTPO-REC-SEQ-NBR          12491001
124920                 ,LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME     12492001
124930                 ,LAST_UPD_DTE     = CURRENT DATE                 12493001
124940                 ,LAST_UPD_TIME    = CURRENT TIME                 12494001
124950                 ,LAST_UPD_USER_ID = :DP020-USERID                12495001
124960           WHERE  PO_NBR   = :DK-PO-NBR                           12496001
124970             AND  SHIPT_ID = :DK-SHIPT-ID                         12497001
124980         END-EXEC                                                 12498001
124990                                                                  12499001
125000         EVALUATE TRUE                                            12500001
125010             WHEN SQLCODE = +0                                    12501001
125020             WHEN SQLCODE = -904                                  12502001
125030             WHEN SQLCODE = -913                                  12503001
125040                 CONTINUE                                         12504001
125050                                                                  12505001
125060             WHEN SQLWARN0 NOT = SPACES                           12506001
125070             WHEN SQLCODE < +0                                    12507001
125080             WHEN SQLCODE > +0                                    12508001
125090                 MOVE '5510-UPDATE-SEQ-NBR'                       12509001
125100                                   TO DP013-PARAGRAPH             12510001
125110                 MOVE 'UPDATE REC SEQ NBR ON TSHPTPO'             12511001
125120                                   TO DP013-MESSAGE-TEXT(1)       12512001
125130                 MOVE SQLCA        TO DP013-SQLCA                 12513001
125140                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    12514001
125150                 SET DP013-DB2-ABEND                              12515001
125160                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12516001
125170                 PERFORM DP013-0000-PROCESS-ABEND                 12517001
125180         END-EVALUATE                                             12518001
125190     END-PERFORM.                                                 12519001
125200                                                                  12520001
125210     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12521001
125220             AND (SQLCODE = -904 OR -913)                         12522001
125230         MOVE '5510-UPDATE-SEQ-NBR'                               12523001
125240                                   TO DP013-PARAGRAPH             12524001
125250         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              12525001
125260                                   TO DP013-MESSAGE-TEXT (1)      12526001
125270         MOVE 'TO UPDATE A TSHPTPO ROW'                           12527001
125280                                   TO DP013-MESSAGE-TEXT (2)      12528001
125290         MOVE SQLCA                TO DP013-SQLCA                 12529001
125300         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    12530001
125310         SET DP013-DB2-ABEND                                      12531001
125320             DP013-XCTL-DISPLAY-RESTART                           12532001
125330                                   TO TRUE                        12533001
125340         PERFORM DP013-0000-PROCESS-ABEND                         12534001
125350     END-IF.                                                      12535001
125360                                                                  12536001
125370/                                                                 12537001
125380 6000-UPDATE-RECEIVER.                                            12538001
125390                                                                  12539001
125400     MOVE ASC-OPER-UNT-ID-N      TO DK-OPER-UNT-ID.               12540001
125410     MOVE ASC-FCLTY-ID-N         TO DK-FCLTY-ID.                  12541001
125420     MOVE ASC-COPER-UNT-ID-N     TO RECEIV-CURR-OPER-UNT-ID.      12542001
125430     MOVE ASC-CFCLTY-ID-N        TO RECEIV-CURR-FCLTY-ID.         12543001
125440     MOVE ASC-KEY-PO-NBR         TO DK-PO-NBR                     12544001
125450                                    DK-ORD-NBR.                   12545001
125460     MOVE ASC-KEY-REC-SEQ-NBR    TO DK-REC-SEQ-NBR.               12546001
125470                                                                  12547001
125480*    CHECK FOR MANIFESTED CARTONS FOR THE RECEIVER                12548001
125490     IF ASC-COPER-UNT-ID       = ASC-COPER-UNT-ID-OLD             12549001
125500         CONTINUE                                                 12550001
125510     ELSE                                                         12551001
125520         PERFORM 7050-MANIFESTED-CARTONS                          12552001
125530         IF PS-MANIFEST-CTN-YES                                   12553001
125540             SET PS-ERROR                                         12554001
125550                 DP020-MSG-FATAL        TO TRUE                   12555001
125560             MOVE PC-TSYMSG-03338       TO DP020-MSG-NUMBER       12556001
125570             MOVE DP015-UNP-NUM-BRT-OFF TO ACOPERA                12557001
125580                                           ACFCLTYA               12558001
125590             MOVE DP015-RED             TO ACOPERC                12559001
125600                                           ACFCLTYC               12560001
125610             MOVE DP015-REVERSE         TO ACOPERH                12561001
125620                                           ACFCLTYH               12562001
125630             MOVE -1                    TO ACOPERL                12563001
125640             SET DP030-SET-CURSOR-APPL-1                          12564001
125650                                        TO TRUE                   12565001
125660         END-IF                                                   12566001
125670     END-IF                                                       12567001
125680                                                                  12568001
125690     IF PS-NO-ERROR                                               12569001
125700         PERFORM 6001-CONTINUE-UPDATE                             12570001
125710     END-IF.                                                      12571001
125720                                                                  12572001
125730 6001-CONTINUE-UPDATE.                                            12573001
125740     MOVE ASC-KEY-VEH-NBR        TO DK-VEH-NBR.                   12574001
125750     MOVE ASC-KEY-OWNER-SCAC-ID  TO DK-OWNER-SCAC-ID.             12575001
125760                                                                  12576001
125770     MOVE ASC-KEY-STATUS-DTE     TO DK-STATUS-DTE.                12577001
125780     MOVE ASC-TRIP-ID            TO DK-TRIP-ID.                   12578001
125790     MOVE ASC-SHIPT-ID           TO DK-SHIPT-ID.                  12579001
125800     MOVE ASC-OPER-SET-ID-N      TO DK-OPER-SET-ID.               12580001
125810                                                                  12581001
125820     IF  ASC-TRIP-ID > ZEROES                                     12582001
125830     AND ASC-OWNR-SCAC-SHIP-DTE NOT = ASC-OWNR-SCAC-SHIP-DTE-OLD  12583001
125840         MOVE ASC-OWNR-SCAC-SHIP-DTE-ISO                          12584001
125850                                   TO VHTRIP-OWNR-SCAC-SHIP-DTE   12585001
125860         PERFORM 6010-UPDATE-TVHTRIP                              12586001
125870         PERFORM 6300-AUDIT-TVHTRIP                               12587001
125880                                                                  12588001
125890     END-IF.                                                      12589001
125900                                                                  12590001
125910     IF  ASC-SHIPT-ID > ZEROES                                    12591001
125920     AND ASC-VEND-SHIP-DTE NOT = ASC-VEND-SHIP-DTE-OLD            12592001
125930         IF  ASC-VEND-SHIP-DTE = SPACES                           12593001
125940             MOVE '0001-01-01'      TO SHIPMT-VEND-SHIP-DTE       12594001
125950         ELSE                                                     12595001
125960             MOVE ASC-VEND-SHIP-DTE-ISO                           12596001
125970                                    TO SHIPMT-VEND-SHIP-DTE       12597001
125980         END-IF                                                   12598001
125990         PERFORM 6020-UPDATE-TSHIPMT                              12599001
126000         PERFORM 6400-AUDIT-TSHIPMT                               12600001
126010     END-IF.                                                      12601001
126020                                                                  12602001
126030     IF  ASC-PACK-BY-ST-IND = ASC-PACK-BY-ST-IND-OLD              12603001
126040     AND ASC-PKGNG-CDE      = ASC-PKGNG-CDE-OLD                   12604001
126050     AND ASC-ACTL-CART-CNT  = ASC-ACTL-CART-CNT-OLD               12605001
126060     AND ASC-PRE-TKT-IND    = ASC-PRE-TKT-IND-OLD                 12606001
126070     AND ASC-HANGER-IND     = ASC-HANGER-IND-OLD                  12607001
126080     AND ASC-RCVG-CLERK-INIT-ID = ASC-RCVG-CLERK-INIT-ID-OLD      12608001
126090     AND ASC-COPER-UNT-ID       = ASC-COPER-UNT-ID-OLD            12609001
126100     AND ASC-CFCLTY-ID          = ASC-CFCLTY-ID-OLD               12610001
126110     AND ASC-APRON-LOC-DESC     = ASC-APRON-LOC-DESC-OLD          12611001
126120     AND ASC-REC-TYP            = ASC-REC-TYP-OLD                 12612001
126130         CONTINUE                                                 12613001
126140     ELSE                                                         12614001
126150         PERFORM 6200-UPDATE-TRECEIV                              12615001
126160     END-IF.                                                      12616001
126170                                                                  12617001
126180     IF  ASC-DMG-CART-CNT = ASC-DMG-CART-CNT-OLD                  12618001
126190     AND ASC-EXPTED-CART-CNT = ASC-EXPTED-CART-CNT-OLD            12619001
126200     AND ASC-ACTL-CART-CNT = ASC-ACTL-CART-CNT-OLD                12620001
126210         CONTINUE                                                 12621001
126220     ELSE                                                         12622001
126230         IF ASC-ACTL-CART-CNT = ASC-ACTL-CART-CNT-OLD             12623001
126240             MOVE ASC-DMG-CART-CNT-N TO SHPTPO-DMG-CART-CNT       12624001
126250             MOVE ASC-EXPTED-CART-CNT-N TO SHPTPO-EXPTED-CART-CNT 12625001
126260             PERFORM 6060-UPDATE-TSHPTPO                          12626001
126270             MOVE ASC-SHIPT-ID           TO DK-SHIPT-ID           12627001
126280             MOVE PC-U                  TO PV-TRN-CDE             12628001
126290             PERFORM 8200-AUDIT-TSHPTPO                           12629001
126300         ELSE                                                     12630001
126310             MOVE ASC-DMG-CART-CNT-N TO SHPTPO-DMG-CART-CNT       12631001
126320             MOVE ASC-ACTL-CART-CNT-N TO SHPTPO-ACTL-CART-CNT     12632001
126330             PERFORM 6065-UPDATE-TSHPTPO                          12633001
126340             MOVE ASC-SHIPT-ID           TO DK-SHIPT-ID           12634001
126350             MOVE PC-U                  TO PV-TRN-CDE             12635001
126360             PERFORM 8200-AUDIT-TSHPTPO                           12636001
126370     END-IF.                                                      12637001
126380                                                                  12638001
126390     IF  ASC-OPER-SET-ID = ASC-OPER-SET-ID-OLD                    12639001
126400     OR  ASC-EXPENSE-RECEIPT                                      12640001
126410     OR  ASC-DIRECT-STORE                                         12641001
126420         CONTINUE                                                 12642001
126430     ELSE                                                         12643001
126440         IF  ASC-OPER-SET-ID     > (SPACES OR ZEROES)             12644001
126450         AND ASC-OPER-SET-ID-OLD = (SPACES OR ZEROES)             12645001
126460             PERFORM 5300-BUILD-ZERO-LINE-WORK-ORD                12646001
126470         ELSE                                                     12647001
126480             MOVE ASC-OPER-SET-ID-N                               12648001
126490                                 TO WRKORD-OPER-SET-ID            12649001
126500             PERFORM 6070-UPDATE-TWRKORD                          12650001
126510             PERFORM 6080-DELETE-TWKORIN                          12651001
126520             MOVE 'N'            TO PS-TOSOPFA-CURSOR-SW          12652001
126530             MOVE 'Y'            TO PS-INSTRUCTION-SW             12653001
126540             PERFORM 5320-OPEN-TOSOPFA-CSR                        12654001
126550             PERFORM 5330-FETCH-TOSOPFA-CSR                       12655001
126560             PERFORM UNTIL PS-EOF-TOSOPFA-CSR                     12656001
126570                PERFORM 5400-BUILD-WORK-ORDER-INSTR               12657001
126580                PERFORM 5330-FETCH-TOSOPFA-CSR                    12658001
126590             END-PERFORM                                          12659001
126600             PERFORM 5340-CLOSE-TOSOPFA-CSR                       12660001
126610         END-IF                                                   12661001
126620     END-IF.                                                      12662001
126630                                                                  12663001
126640     IF ASC-ADD-FROM-SHPPO                                        12664001
126650         IF TM500-NO-TROUBLE                                      12665001
126660             MOVE PC-TSYMSG-00391    TO DP020-MSG-NUMBER          12666001
126670             MOVE ASC-REC-SEQ-NBR    TO DP020-MSG-TEXT            12667001
126680                                        ARECSEQO                  12668001
126690             MOVE ASC-REC-TYP        TO ARECTYPO                  12669001
126700* WR40574 02-09-2012 START CLT                                    12670001
126710             MOVE ASC-CARR-AUTH-ID   TO ACANO                     12671001
126720* WR40574 02-09-2012 END   CLT                                    12672001
126730         ELSE                                                     12673001
126740             MOVE PC-TSYMSG-00847    TO DP020-MSG-NUMBER          12674001
126750             MOVE ASC-REC-SEQ-NBR    TO DP020-MSG-TEXT            12675001
126760                                        ARECSEQO                  12676001
126770             MOVE ASC-TRBL-DESC      TO ATBLSTO                   12677001
126780             MOVE ASC-REC-TYP        TO ARECTYPO                  12678001
126790         END-IF                                                   12679001
126800     ELSE                                                         12680001
126810         IF PS-INFO-MSG-FND                                       12681001
126820             SET PS-INFO-MSG-NOTFND  TO TRUE                      12682001
126830         ELSE                                                     12683001
126840             MOVE PC-TSYMSG-00392    TO DP020-MSG-NUMBER          12684001
126850             MOVE ASC-REC-SEQ-NBR    TO DP020-MSG-TEXT            12685001
126860                                        ARECSEQO                  12686001
126870             MOVE ASC-REC-TYP        TO ARECTYPO                  12687001
126880         END-IF                                                   12688001
126890     END-IF.                                                      12689001
126900                                                                  12690001
126910     SET DP020-MSG-INFORMATIONAL                                  12691001
126920         ASC-ADD-SUCCESSFUL      TO TRUE.                         12692001
126930     IF  ASC-USE-SELECTION-QUEUE                                  12693001
126940         PERFORM 5200-UPDATE-SELECTION-QUEUE                      12694001
126950     END-IF.                                                      12695001
126960*                                                                 12696001
126970*----------------------------------------------------------------*12697001
126980*  REFRESH SCREEEN AFTER UPDATE                                   12698001
126990*----------------------------------------------------------------*12699001
127000*    PERFORM 1100-PROCESS-INTER-APPL-COMM.                        12700001
127010*    PERFORM 4000-BUILD-INITIAL-PANEL THRU 4000-EXIT.             12701001
127020*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12702001
127030*    PERFORM 3200-RESET-ATTRIBUTES.                               12703001
127040*    PERFORM 3500-SAVE-SCREEN-FIELDS.                             12704001
127050                                                                  12705001
127060/                                                                 12706001
127070*----------------------------------------------------------------*12707001
127080*  UPDATE THE OWNER SCAC SHIP DATE                               *12708001
127090*----------------------------------------------------------------*12709001
127100 6010-UPDATE-TVHTRIP.                                             12710001
127110                                                                  12711001
127120     PERFORM                                                      12712001
127130         WITH TEST AFTER                                          12713001
127140         VARYING PV-RETRY-COUNTER                                 12714001
127150         FROM 1 BY 1                                              12715001
127160         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12716001
127170             OR (SQLCODE = +0))                                   12717001
127180                                                                  12718001
127190         EXEC SQL                                                 12719001
127200           UPDATE TVHTRIP                                         12720001
127210              SET LAST_UPD_DTE       = CURRENT DATE               12721001
127220                 ,LAST_UPD_TME       = CURRENT TIME               12722001
127230                 ,LAST_UPD_UID       = :DP020-USERID              12723001
127240                 ,OWNR_SCAC_SHIP_DTE = :VHTRIP-OWNR-SCAC-SHIP-DTE 12724001
127250           WHERE  TRIP_ID = :DK-TRIP-ID                           12725001
127260         END-EXEC                                                 12726001
127270                                                                  12727001
127280         EVALUATE TRUE                                            12728001
127290             WHEN SQLCODE = +0                                    12729001
127300             WHEN SQLCODE = -904                                  12730001
127310             WHEN SQLCODE = -913                                  12731001
127320                 CONTINUE                                         12732001
127330                                                                  12733001
127340             WHEN SQLWARN0 NOT = SPACES                           12734001
127350             WHEN SQLCODE < +0                                    12735001
127360             WHEN SQLCODE > +0                                    12736001
127370                 MOVE '6010-UPDATE-TVHTRIP'                       12737001
127380                                   TO DP013-PARAGRAPH             12738001
127390                 MOVE 'UPDATE OWNER SCAC SHIP DTE ON TVHTRIP'     12739001
127400                                   TO DP013-MESSAGE-TEXT(1)       12740001
127410                 MOVE SQLCA        TO DP013-SQLCA                 12741001
127420                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    12742001
127430                 SET DP013-DB2-ABEND                              12743001
127440                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12744001
127450                 PERFORM DP013-0000-PROCESS-ABEND                 12745001
127460         END-EVALUATE                                             12746001
127470     END-PERFORM.                                                 12747001
127480                                                                  12748001
127490     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12749001
127500             AND (SQLCODE = -904 OR -913)                         12750001
127510         MOVE '6010-UPDATE-TVHTRIP'                               12751001
127520                                   TO DP013-PARAGRAPH             12752001
127530         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              12753001
127540                                   TO DP013-MESSAGE-TEXT (1)      12754001
127550         MOVE 'TO UPDATE A TVHTRIP ROW'                           12755001
127560                                   TO DP013-MESSAGE-TEXT (2)      12756001
127570         MOVE SQLCA                TO DP013-SQLCA                 12757001
127580         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    12758001
127590         SET DP013-DB2-ABEND                                      12759001
127600             DP013-XCTL-DISPLAY-RESTART                           12760001
127610                                   TO TRUE                        12761001
127620         PERFORM DP013-0000-PROCESS-ABEND                         12762001
127630     END-IF.                                                      12763001
127640                                                                  12764001
127650/                                                                 12765001
127660*----------------------------------------------------------------*12766001
127670*  UPDATE THE VENDOR SHIP DATE                                   *12767001
127680*----------------------------------------------------------------*12768001
127690 6020-UPDATE-TSHIPMT.                                             12769001
127700                                                                  12770001
127710     PERFORM                                                      12771001
127720         WITH TEST AFTER                                          12772001
127730         VARYING PV-RETRY-COUNTER                                 12773001
127740         FROM 1 BY 1                                              12774001
127750         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12775001
127760             OR (SQLCODE = +0))                                   12776001
127770                                                                  12777001
127780         EXEC SQL                                                 12778001
127790           UPDATE TSHIPMT                                         12779001
127800              SET LAST_UPD_DTE  = CURRENT DATE                    12780001
127810                 ,LAST_UPD_TME  = CURRENT TIME                    12781001
127820                 ,LAST_UPD_UID  = :DP020-USERID                   12782001
127830                 ,VEND_SHIP_DTE = :SHIPMT-VEND-SHIP-DTE           12783001
127840           WHERE  SHIPT_ID      = :DK-SHIPT-ID                    12784001
127850         END-EXEC                                                 12785001
127860                                                                  12786001
127870         EVALUATE TRUE                                            12787001
127880             WHEN SQLCODE = +0                                    12788001
127890             WHEN SQLCODE = -904                                  12789001
127900             WHEN SQLCODE = -913                                  12790001
127910                 CONTINUE                                         12791001
127920                                                                  12792001
127930             WHEN SQLWARN0 NOT = SPACES                           12793001
127940             WHEN SQLCODE < +0                                    12794001
127950             WHEN SQLCODE > +0                                    12795001
127960                 MOVE '6020-UPDATE-TSHIPMT'                       12796001
127970                                   TO DP013-PARAGRAPH             12797001
127980                 MOVE 'UPDATE VENDOR SHIP DTE ON TSHIPMT'         12798001
127990                                   TO DP013-MESSAGE-TEXT(1)       12799001
128000                 MOVE SQLCA        TO DP013-SQLCA                 12800001
128010                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    12801001
128020                 SET DP013-DB2-ABEND                              12802001
128030                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12803001
128040                 PERFORM DP013-0000-PROCESS-ABEND                 12804001
128050         END-EVALUATE                                             12805001
128060     END-PERFORM.                                                 12806001
128070                                                                  12807001
128080     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12808001
128090             AND (SQLCODE = -904 OR -913)                         12809001
128100         MOVE '6020-UPDATE-TSHIPMT'                               12810001
128110                                   TO DP013-PARAGRAPH             12811001
128120         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              12812001
128130                                   TO DP013-MESSAGE-TEXT (1)      12813001
128140         MOVE 'TO UPDATE A TSHIPMT ROW'                           12814001
128150                                   TO DP013-MESSAGE-TEXT (2)      12815001
128160         MOVE SQLCA                TO DP013-SQLCA                 12816001
128170         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    12817001
128180         SET DP013-DB2-ABEND                                      12818001
128190             DP013-XCTL-DISPLAY-RESTART                           12819001
128200                                   TO TRUE                        12820001
128210         PERFORM DP013-0000-PROCESS-ABEND                         12821001
128220     END-IF.                                                      12822001
128230                                                                  12823001
128240/                                                                 12824001
128250*----------------------------------------------------------------*12825001
128260*  UPDATE THE DAMAGED CARTON COUNT                               *12826001
128270*----------------------------------------------------------------*12827001
128280 6060-UPDATE-TSHPTPO.                                             12828001
128290                                                                  12829001
128300     PERFORM                                                      12830001
128310         WITH TEST AFTER                                          12831001
128320         VARYING PV-RETRY-COUNTER                                 12832001
128330         FROM 1 BY 1                                              12833001
128340         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12834001
128350             OR (SQLCODE = +0))                                   12835001
128360                                                                  12836001
128370         EXEC SQL                                                 12837001
128380           UPDATE TSHPTPO                                         12838001
128390              SET EXPTED_CART_CNT  = :SHPTPO-EXPTED-CART-CNT      12839001
128400                 ,DMG_CART_CNT     = :SHPTPO-DMG-CART-CNT         12840001
128410                 ,PKSL_IND         = :SHPTPO-PKSL-IND             12841001
128420                 ,LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME     12842001
128430                 ,LAST_UPD_DTE     = CURRENT DATE                 12843001
128440                 ,LAST_UPD_TIME    = CURRENT TIME                 12844001
128450                 ,LAST_UPD_USER_ID = :DP020-USERID                12845001
128460           WHERE  PO_NBR          = :DK-PO-NBR                    12846001
128470             AND  REC_SEQ_NBR     = :DK-REC-SEQ-NBR               12847001
128480         END-EXEC                                                 12848001
128490                                                                  12849001
128500         EVALUATE TRUE                                            12850001
128510             WHEN SQLCODE = +0                                    12851001
128520             WHEN SQLCODE = -904                                  12852001
128530             WHEN SQLCODE = -913                                  12853001
128540                 CONTINUE                                         12854001
128550                                                                  12855001
128560             WHEN SQLWARN0 NOT = SPACES                           12856001
128570             WHEN SQLCODE < +0                                    12857001
128580             WHEN SQLCODE > +0                                    12858001
128590                 MOVE '6060-UPDATE-TSHPTPO'                       12859001
128600                                   TO DP013-PARAGRAPH             12860001
128610                 MOVE 'UPDATE DAMAGED CARTON COUNT ON TSHPTPO'    12861001
128620                                   TO DP013-MESSAGE-TEXT(1)       12862001
128630                 MOVE SQLCA        TO DP013-SQLCA                 12863001
128640                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    12864001
128650                 SET DP013-DB2-ABEND                              12865001
128660                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12866001
128670                 PERFORM DP013-0000-PROCESS-ABEND                 12867001
128680         END-EVALUATE                                             12868001
128690     END-PERFORM.                                                 12869001
128700                                                                  12870001
128710     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12871001
128720             AND (SQLCODE = -904 OR -913)                         12872001
128730         MOVE '6060-UPDATE-TSHPTPO'                               12873001
128740                                   TO DP013-PARAGRAPH             12874001
128750         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              12875001
128760                                   TO DP013-MESSAGE-TEXT (1)      12876001
128770         MOVE 'TO UPDATE A TSHPTPO ROW'                           12877001
128780                                   TO DP013-MESSAGE-TEXT (2)      12878001
128790         MOVE SQLCA                TO DP013-SQLCA                 12879001
128800         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    12880001
128810         SET DP013-DB2-ABEND                                      12881001
128820             DP013-XCTL-DISPLAY-RESTART                           12882001
128830                                   TO TRUE                        12883001
128840         PERFORM DP013-0000-PROCESS-ABEND                         12884001
128850     END-IF.                                                      12885001
128860/                                                                 12886001
128870*----------------------------------------------------------------*12887001
128880*  UPDATE THE DAMAGED CARTON COUNT                               *12888001
128890*----------------------------------------------------------------*12889001
128900 6065-UPDATE-TSHPTPO.                                             12890001
128910                                                                  12891001
128920     PERFORM                                                      12892001
128930         WITH TEST AFTER                                          12893001
128940         VARYING PV-RETRY-COUNTER                                 12894001
128950         FROM 1 BY 1                                              12895001
128960         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12896001
128970             OR (SQLCODE = +0))                                   12897001
128980                                                                  12898001
128990         EXEC SQL                                                 12899001
129000           UPDATE TSHPTPO                                         12900001
129010              SET ACTL_CART_CNT    = :SHPTPO-ACTL-CART-CNT        12901001
129020                 ,DMG_CART_CNT     = :SHPTPO-DMG-CART-CNT         12902001
129030                 ,PKSL_IND         = :SHPTPO-PKSL-IND             12903001
129040                 ,LAST_UPD_PGM_ID  = :PC-CURRENT-PROGRAM-NAME     12904001
129050                 ,LAST_UPD_DTE     = CURRENT DATE                 12905001
129060                 ,LAST_UPD_TIME    = CURRENT TIME                 12906001
129070                 ,LAST_UPD_USER_ID = :DP020-USERID                12907001
129080           WHERE  PO_NBR          = :DK-PO-NBR                    12908001
129090             AND  REC_SEQ_NBR     = :DK-REC-SEQ-NBR               12909001
129100         END-EXEC                                                 12910001
129110                                                                  12911001
129120         EVALUATE TRUE                                            12912001
129130             WHEN SQLCODE = +0                                    12913001
129140             WHEN SQLCODE = -904                                  12914001
129150             WHEN SQLCODE = -913                                  12915001
129160                 CONTINUE                                         12916001
129170                                                                  12917001
129180             WHEN SQLWARN0 NOT = SPACES                           12918001
129190             WHEN SQLCODE < +0                                    12919001
129200             WHEN SQLCODE > +0                                    12920001
129210                 MOVE '6060-UPDATE-TSHPTPO'                       12921001
129220                                   TO DP013-PARAGRAPH             12922001
129230                 MOVE 'UPDATE DAMAGED CARTON COUNT ON TSHPTPO'    12923001
129240                                   TO DP013-MESSAGE-TEXT(1)       12924001
129250                 MOVE SQLCA        TO DP013-SQLCA                 12925001
129260                 MOVE 'TSHPTPO'    TO DP013-DB2-TABLE-NAME (1)    12926001
129270                 SET DP013-DB2-ABEND                              12927001
129280                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12928001
129290                 PERFORM DP013-0000-PROCESS-ABEND                 12929001
129300         END-EVALUATE                                             12930001
129310     END-PERFORM.                                                 12931001
129320                                                                  12932001
129330     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12933001
129340             AND (SQLCODE = -904 OR -913)                         12934001
129350         MOVE '6060-UPDATE-TSHPTPO'                               12935001
129360                                   TO DP013-PARAGRAPH             12936001
129370         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              12937001
129380                                   TO DP013-MESSAGE-TEXT (1)      12938001
129390         MOVE 'TO UPDATE A TSHPTPO ROW'                           12939001
129400                                   TO DP013-MESSAGE-TEXT (2)      12940001
129410         MOVE SQLCA                TO DP013-SQLCA                 12941001
129420         MOVE 'TSHPTPO'            TO DP013-DB2-TABLE-NAME (1)    12942001
129430         SET DP013-DB2-ABEND                                      12943001
129440             DP013-XCTL-DISPLAY-RESTART                           12944001
129450                                   TO TRUE                        12945001
129460         PERFORM DP013-0000-PROCESS-ABEND                         12946001
129470     END-IF.                                                      12947001
129480/                                                                 12948001
129490*----------------------------------------------------------------*12949001
129500*  UPDATE THE WORK ORDER WITH THE NEW OPER SET ID                *12950001
129510*----------------------------------------------------------------*12951001
129520 6070-UPDATE-TWRKORD.                                             12952001
129530                                                                  12953001
129540     PERFORM                                                      12954001
129550         WITH TEST AFTER                                          12955001
129560         VARYING PV-RETRY-COUNTER                                 12956001
129570         FROM 1 BY 1                                              12957001
129580         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               12958001
129590             OR (SQLCODE = +0))                                   12959001
129600                                                                  12960001
129610         EXEC SQL                                                 12961001
129620           UPDATE TWRKORD                                         12962001
129630              SET OPER_SET_ID    = :WRKORD-OPER-SET-ID            12963001
129640           WHERE  ORD_NBR        = :DK-PO-NBR                     12964001
129650             AND  RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR                12965001
129660             AND  VER_STATUS_CDE = 'A'                            12966001
129670         END-EXEC                                                 12967001
129680                                                                  12968001
129690         EVALUATE TRUE                                            12969001
129700             WHEN SQLCODE = +0                                    12970001
129710             WHEN SQLCODE = -904                                  12971001
129720             WHEN SQLCODE = -913                                  12972001
129730                 CONTINUE                                         12973001
129740                                                                  12974001
129750             WHEN SQLWARN0 NOT = SPACES                           12975001
129760             WHEN SQLCODE < +0                                    12976001
129770             WHEN SQLCODE > +0                                    12977001
129780                 MOVE '6070-UPDATE-TWRKORD'                       12978001
129790                                   TO DP013-PARAGRAPH             12979001
129800                 MOVE 'UPDATE OPER SET ID ON TWRKORD'             12980001
129810                                   TO DP013-MESSAGE-TEXT(1)       12981001
129820                 MOVE SQLCA        TO DP013-SQLCA                 12982001
129830                 MOVE 'TWRKORD'    TO DP013-DB2-TABLE-NAME (1)    12983001
129840                 SET DP013-DB2-ABEND                              12984001
129850                     DP013-XCTL-DISPLAY-RESTART TO TRUE           12985001
129860                 PERFORM DP013-0000-PROCESS-ABEND                 12986001
129870         END-EVALUATE                                             12987001
129880     END-PERFORM.                                                 12988001
129890                                                                  12989001
129900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12990001
129910             AND (SQLCODE = -904 OR -913)                         12991001
129920         MOVE '6070-UPDATE-TWRKORD'                               12992001
129930                                   TO DP013-PARAGRAPH             12993001
129940         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              12994001
129950                                   TO DP013-MESSAGE-TEXT (1)      12995001
129960         MOVE 'TO UPDATE A TWRKORD ROW'                           12996001
129970                                   TO DP013-MESSAGE-TEXT (2)      12997001
129980         MOVE SQLCA                TO DP013-SQLCA                 12998001
129990         MOVE 'TWRKORD'            TO DP013-DB2-TABLE-NAME (1)    12999001
130000         SET DP013-DB2-ABEND                                      13000001
130010             DP013-XCTL-DISPLAY-RESTART                           13001001
130020                                   TO TRUE                        13002001
130030         PERFORM DP013-0000-PROCESS-ABEND                         13003001
130040     END-IF.                                                      13004001
130050                                                                  13005001
130060/                                                                 13006001
130070*----------------------------------------------------------------*13007001
130080*  DELETE ALL THE ZERO LINE NUMBER WORK ORDER INSTRUCTIONS       *13008001
130090*----------------------------------------------------------------*13009001
130100 6080-DELETE-TWKORIN.                                             13010001
130110                                                                  13011001
130120     PERFORM                                                      13012001
130130         WITH TEST AFTER                                          13013001
130140         VARYING PV-RETRY-COUNTER                                 13014001
130150         FROM 1 BY 1                                              13015001
130160         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13016001
130170             OR (SQLCODE = +0 OR +100))                           13017001
130180                                                                  13018001
130190         EXEC SQL                                                 13019001
130200           DELETE FROM TWKORIN                                    13020001
130210           WHERE  ORD_NBR          = :DK-PO-NBR                   13021001
130220             AND  RCVR_SEQ_NBR     = :DK-REC-SEQ-NBR              13022001
130230             AND  ORD_LNE_NBR      = 0                            13023001
130240             AND  WORK_ORD_SEQ_NBR = 1                            13024001
130250         END-EXEC                                                 13025001
130260                                                                  13026001
130270         EVALUATE TRUE                                            13027001
130280             WHEN SQLCODE = +0                                    13028001
130290             WHEN SQLCODE = +100                                  13029001
130300             WHEN SQLCODE = -904                                  13030001
130310             WHEN SQLCODE = -913                                  13031001
130320                 CONTINUE                                         13032001
130330                                                                  13033001
130340             WHEN SQLWARN0 NOT = SPACES                           13034001
130350             WHEN SQLCODE < +0                                    13035001
130360             WHEN SQLCODE > +0                                    13036001
130370                 MOVE '6080-DELETE-TWKORIN'                       13037001
130380                                   TO DP013-PARAGRAPH             13038001
130390                 MOVE 'DELETE ZERO LINE NBR WORK ORDER INSTR '    13039001
130400                                   TO DP013-MESSAGE-TEXT(1)       13040001
130410                 MOVE SQLCA        TO DP013-SQLCA                 13041001
130420                 MOVE 'TWKORIN'    TO DP013-DB2-TABLE-NAME (1)    13042001
130430                 SET DP013-DB2-ABEND                              13043001
130440                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13044001
130450                 PERFORM DP013-0000-PROCESS-ABEND                 13045001
130460         END-EVALUATE                                             13046001
130470     END-PERFORM.                                                 13047001
130480                                                                  13048001
130490     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13049001
130500                      AND (SQLCODE = -904 OR -913)                13050001
130510         MOVE '6080-DELETE-TWKORIN'                               13051001
130520                                   TO DP013-PARAGRAPH             13052001
130530         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              13053001
130540                                   TO DP013-MESSAGE-TEXT (1)      13054001
130550         MOVE 'TO DELETE A TWKORIN ROW'                           13055001
130560                                   TO DP013-MESSAGE-TEXT (2)      13056001
130570         MOVE SQLCA                TO DP013-SQLCA                 13057001
130580         MOVE 'TWKORIN'            TO DP013-DB2-TABLE-NAME (1)    13058001
130590         SET DP013-DB2-ABEND                                      13059001
130600             DP013-XCTL-DISPLAY-RESTART                           13060001
130610                                   TO TRUE                        13061001
130620         PERFORM DP013-0000-PROCESS-ABEND                         13062001
130630     END-IF.                                                      13063001
130640                                                                  13064001
130650/                                                                 13065001
130660*----------------------------------------------------------------*13066001
130670* READ CURRENT RECEIVER INFO                                     *13067001
130680*----------------------------------------------------------------*13068001
130690 6100-CHECK-RECEIVER.                                             13069001
130700                                                                  13070001
130710                                                                  13071001
130720     PERFORM                                                      13072001
130730         WITH TEST AFTER                                          13073001
130740         VARYING PV-RETRY-COUNTER                                 13074001
130750         FROM 1 BY 1                                              13075001
130760         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13076001
130770             OR (SQLCODE = +0)                                    13077001
130780             OR (SQLCODE = +100))                                 13078001
130790                                                                  13079001
130800         EXEC SQL                                                 13080001
130810              SELECT   ORD_NBR,                                   13081001
130820                       OPER_UNT_ID,                               13082001
130830                       FCLTY_ID                                   13083001
130840              INTO     :RECEIV-ORD-NBR,                           13084001
130850                       :RECEIV-OPER-UNT-ID,                       13085001
130860                       :RECEIV-FCLTY-ID                           13086001
130870                FROM TRECEIV                                      13087001
130880               WHERE ORD_NBR        = :DK-PO-NBR                  13088001
130890                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             13089001
130900                 AND VER_STATUS_CDE = 'A'                         13090001
130910         END-EXEC                                                 13091001
130920                                                                  13092001
130930         EVALUATE TRUE                                            13093001
130940             WHEN SQLCODE = +0                                    13094001
130950             WHEN SQLCODE = +100                                  13095001
130960             WHEN SQLCODE = -904                                  13096001
130970             WHEN SQLCODE = -913                                  13097001
130980                 CONTINUE                                         13098001
130990                                                                  13099001
131000             WHEN SQLWARN0 NOT = SPACE                            13100001
131010             WHEN SQLCODE < +0                                    13101001
131020             WHEN SQLCODE > +0                                    13102001
131030                 MOVE '6100-CHECK-RECEIVER'                       13103001
131040                                 TO DP013-PARAGRAPH               13104001
131050                 MOVE 'SELECT ON RECEIPTS TABLE'                  13105001
131060                                 TO DP013-MESSAGE-TEXT (1)        13106001
131070                 MOVE SQLCA      TO DP013-SQLCA                   13107001
131080                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      13108001
131090                     SET DP013-DB2-ABEND                          13109001
131100                         DP013-XCTL-DISPLAY-RESTART               13110001
131110                                     TO TRUE                      13111001
131120                 PERFORM DP013-0000-PROCESS-ABEND                 13112001
131130         END-EVALUATE                                             13113001
131140     END-PERFORM.                                                 13114001
131150                                                                  13115001
131160     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13116001
131170             AND (SQLCODE = -904 OR -913)                         13117001
131180         MOVE '6100-CHECK-RECEIVER'                               13118001
131190                                  TO DP013-PARAGRAPH              13119001
131200         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TRECEIV'         13120001
131210                                  TO DP013-MESSAGE-TEXT (1)       13121001
131220         MOVE SQLCA               TO DP013-SQLCA                  13122001
131230         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     13123001
131240         SET DP013-DB2-ABEND                                      13124001
131250             DP013-XCTL-DISPLAY-RESTART                           13125001
131260                                  TO TRUE                         13126001
131270         PERFORM DP013-0000-PROCESS-ABEND                         13127001
131280     END-IF.                                                      13128001
131290                                                                  13129001
131300/                                                                 13130001
131310*----------------------------------------------------------------*13131001
131320* READ CURRENT RECEIVER INFO                                     *13132001
131330*----------------------------------------------------------------*13133001
131340 6150-CHECK-RECEIVER.                                             13134001
131350                                                                  13135001
131360                                                                  13136001
131370     PERFORM                                                      13137001
131380         WITH TEST AFTER                                          13138001
131390         VARYING PV-RETRY-COUNTER                                 13139001
131400         FROM 1 BY 1                                              13140001
131410         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13141001
131420             OR (SQLCODE = +0)                                    13142001
131430             OR (SQLCODE = +100)                                  13143001
131440             OR (SQLCODE = -811))                                 13144001
131450                                                                  13145001
131460         EXEC SQL                                                 13146001
131470              SELECT   ORD_NBR                                    13147001
131480              INTO     :RECEIV-ORD-NBR                            13148001
131490                FROM TRECEIV                                      13149001
131500               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             13150001
131510                 AND FCLTY_ID       = :DK-FCLTY-ID                13151001
131520                 AND ORD_NBR        = :DK-PO-NBR                  13152001
131530                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             13153001
131540                 AND VER_STATUS_CDE = 'A'                         13154001
131550         END-EXEC                                                 13155001
131560                                                                  13156001
131570         EVALUATE TRUE                                            13157001
131580             WHEN SQLCODE = +0                                    13158001
131590             WHEN SQLCODE = +100                                  13159001
131600             WHEN SQLCODE = -904                                  13160001
131610             WHEN SQLCODE = -913                                  13161001
131620             WHEN SQLCODE = -811                                  13162001
131630                 CONTINUE                                         13163001
131640                                                                  13164001
131650             WHEN SQLWARN0 NOT = SPACE                            13165001
131660             WHEN SQLCODE < +0                                    13166001
131670             WHEN SQLCODE > +0                                    13167001
131680                 MOVE '6150-CHECK-RECEIVER'                       13168001
131690                                 TO DP013-PARAGRAPH               13169001
131700                 MOVE 'SELECT ON RECEIPTS TABLE'                  13170001
131710                                 TO DP013-MESSAGE-TEXT (1)        13171001
131720                 MOVE SQLCA      TO DP013-SQLCA                   13172001
131730                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      13173001
131740                     SET DP013-DB2-ABEND                          13174001
131750                         DP013-XCTL-DISPLAY-RESTART               13175001
131760                                     TO TRUE                      13176001
131770                 PERFORM DP013-0000-PROCESS-ABEND                 13177001
131780         END-EVALUATE                                             13178001
131790     END-PERFORM.                                                 13179001
131800                                                                  13180001
131810     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13181001
131820             AND (SQLCODE = -904 OR -913)                         13182001
131830         MOVE '6150-CHECK-RECEIVER'                               13183001
131840                                  TO DP013-PARAGRAPH              13184001
131850         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TRECEIV'         13185001
131860                                  TO DP013-MESSAGE-TEXT (1)       13186001
131870         MOVE SQLCA               TO DP013-SQLCA                  13187001
131880         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     13188001
131890         SET DP013-DB2-ABEND                                      13189001
131900             DP013-XCTL-DISPLAY-RESTART                           13190001
131910                                  TO TRUE                         13191001
131920         PERFORM DP013-0000-PROCESS-ABEND                         13192001
131930     END-IF.                                                      13193001
131940                                                                  13194001
131950/                                                                 13195001
131960*----------------------------------------------------------------*13196001
131970* UPDATE RECEIVER ROW                                            *13197001
131980*----------------------------------------------------------------*13198001
131990 6200-UPDATE-TRECEIV.                                             13199001
132000                                                                  13200001
132010     MOVE 'V'      TO RC031-TABLE-TO-AUDIT.                       13201001
132020     MOVE 'B'      TO RC031-AUD-TYP-CDE.                          13202001
132030     MOVE 'U'      TO RC031-AUD-FUNC-CDE.                         13203001
132040     MOVE DK-PO-NBR                                               13204001
132050                   TO RC031-PO-NBR.                               13205001
132060     MOVE DK-REC-SEQ-NBR                                          13206001
132070                   TO RC031-REC-SEQ-NBR.                          13207001
132080     MOVE DK-OPER-UNT-ID                                          13208001
132090                   TO RC031-OPER-UNT-ID.                          13209001
132100     MOVE DK-FCLTY-ID                                             13210001
132110                   TO RC031-FCLTY-ID.                             13211001
132120     EXEC CICS                                                    13212001
132130         LINK PROGRAM  (PC-AUDIT-RTN)                             13213001
132140              COMMAREA (RC031-FIELDS)                             13214001
132150              LENGTH   (PC-AUDIT-RTN-LENGTH)                      13215001
132160     END-EXEC.                                                    13216001
132170     EVALUATE TRUE                                                13217001
132180         WHEN RC031-CALL-SUCCESSFUL                               13218001
132190             CONTINUE                                             13219001
132200                                                                  13220001
132210         WHEN OTHER                                               13221001
132220            MOVE '6200-UPDATE-TRECEIV'                            13222001
132230                            TO DP013-PARAGRAPH                    13223001
132240            MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'                 13224001
132250                        TO DP013-MESSAGE-TEXT (1)                 13225001
132260            MOVE RC031-RETURN-DESC                                13226001
132270                        TO DP013-MESSAGE-TEXT (2)                 13227001
132280            MOVE RC031-SQLCA      TO DP013-SQLCA                  13228001
132290            SET DP013-DB2-ABEND                                   13229001
132300                DP013-XCTL-DISPLAY-RESTART                        13230001
132310                                  TO TRUE                         13231001
132320            PERFORM DP013-0000-PROCESS-ABEND                      13232001
132330     END-EVALUATE                                                 13233001
132340                                                                  13234001
132350     MOVE ASC-PACK-BY-ST-IND      TO RECEIV-PACK-BY-ST-IND.       13235001
132360     MOVE ASC-ACTL-CART-CNT-N TO RECEIV-ACTL-CART-CNT.            13236001
132370     MOVE ASC-PRE-TKT-IND         TO RECEIV-PRE-TKT-IND.          13237001
132380     MOVE ASC-HANGER-IND          TO RECEIV-GOH-IND.              13238001
132390     MOVE ASC-RCVG-CLERK-INIT-ID                                  13239001
132400                              TO RECEIV-RCVG-CLERK-INIT-ID.       13240001
132410     MOVE ASC-APRON-LOC-DESC      TO RECEIV-APRON-LOC-DESC.       13241001
132420     MOVE ASC-PKGNG-CDE           TO RECEIV-PKGNG-CDE.            13242001
132430     MOVE ASC-REC-TYP             TO RECEIV-REC-TYP-CDE.          13243001
132440                                                                  13244001
132450     PERFORM                                                      13245001
132460         WITH TEST AFTER                                          13246001
132470         VARYING PV-RETRY-COUNTER                                 13247001
132480         FROM 1 BY 1                                              13248001
132490         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13249001
132500             OR (SQLCODE = +0))                                   13250001
132510                                                                  13251001
132520         EXEC SQL                                                 13252001
132530           UPDATE TRECEIV                                         13253001
132540              SET   VER_STATUS_CDE     =  :PC-A                   13254001
132550                   ,PACK_BY_ST_IND     =  :RECEIV-PACK-BY-ST-IND  13255001
132560                   ,ACTL_CART_CNT      =  :RECEIV-ACTL-CART-CNT   13256001
132570                   ,PRE_TKT_IND        =  :RECEIV-PRE-TKT-IND     13257001
132580                   ,GOH_IND            =  :RECEIV-GOH-IND         13258001
132590                   ,AD_INFO_DESC       =  :RECEIV-AD-INFO-DESC    13259001
132600                   ,RCVG_CLERK_INIT_ID =                          13260001
132610                                      :RECEIV-RCVG-CLERK-INIT-ID  13261001
132620                   ,CURR_OPER_UNT_ID   =  :RECEIV-CURR-OPER-UNT-ID13262001
132630                   ,CURR_FCLTY_ID      =  :RECEIV-CURR-FCLTY-ID   13263001
132640                   ,UPD_TMST           =  CURRENT TIMESTAMP       13264001
132650                   ,UPD_UID            =  :DP020-USERID           13265001
132660                   ,UPD_PGM_ID         =  :PC-CURRENT-PROGRAM-NAME13266001
132670                   ,APRON_LOC_DESC     =  :RECEIV-APRON-LOC-DESC  13267001
132680                   ,PKGNG_CDE          =  :RECEIV-PKGNG-CDE       13268001
132690                   ,REC_TYP_CDE        =  :RECEIV-REC-TYP-CDE     13269001
132700               WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID             13270001
132710                 AND FCLTY_ID       = :DK-FCLTY-ID                13271001
132720                 AND ORD_NBR        = :DK-PO-NBR                  13272001
132730                 AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR             13273001
132740                 AND VER_STATUS_CDE = 'A'                         13274001
132750         END-EXEC                                                 13275001
132760                                                                  13276001
132770                                                                  13277001
132780                                                                  13278001
132790         EVALUATE TRUE                                            13279001
132800             WHEN SQLCODE = +0                                    13280001
132810             WHEN SQLCODE = -904                                  13281001
132820             WHEN SQLCODE = -913                                  13282001
132830                 CONTINUE                                         13283001
132840                                                                  13284001
132850             WHEN SQLWARN0 NOT = SPACES                           13285001
132860             WHEN SQLCODE < +0                                    13286001
132870             WHEN SQLCODE > +0                                    13287001
132880                 MOVE '6200-UPDATE-TRECEIV'                       13288001
132890                                   TO DP013-PARAGRAPH             13289001
132900                 MOVE 'DELETE RECEIVER HEADER    '                13290001
132910                                   TO DP013-MESSAGE-TEXT(1)       13291001
132920                 MOVE SQLCA        TO DP013-SQLCA                 13292001
132930                 MOVE 'TRECEIV'    TO DP013-DB2-TABLE-NAME (1)    13293001
132940                 SET DP013-DB2-ABEND                              13294001
132950                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13295001
132960                 PERFORM DP013-0000-PROCESS-ABEND                 13296001
132970         END-EVALUATE                                             13297001
132980     END-PERFORM.                                                 13298001
132990                                                                  13299001
133000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13300001
133010             AND (SQLCODE = -904 OR -913)                         13301001
133020         MOVE '6200-UPDATE-TRECEIV'                               13302001
133030                                   TO DP013-PARAGRAPH             13303001
133040         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              13304001
133050                                   TO DP013-MESSAGE-TEXT (1)      13305001
133060         MOVE 'TO UPDATE A TRECEIV ROW'                           13306001
133070                                   TO DP013-MESSAGE-TEXT (2)      13307001
133080         MOVE SQLCA                TO DP013-SQLCA                 13308001
133090         MOVE 'TRECEIV'            TO DP013-DB2-TABLE-NAME (1)    13309001
133100         SET DP013-DB2-ABEND                                      13310001
133110             DP013-XCTL-DISPLAY-RESTART                           13311001
133120                                   TO TRUE                        13312001
133130         PERFORM DP013-0000-PROCESS-ABEND                         13313001
133140     END-IF.                                                      13314001
133150                                                                  13315001
133160/                                                                 13316001
133170*----------------------------------------------------------------*13317001
133180*  TAKE A SNAPSHOT OF THE BEFORE IMAGE OF TVHTRIP AND WRITE      *13318001
133190*  TO THE AUDIT TABLE.                                           *13319001
133200*----------------------------------------------------------------*13320001
133210 6300-AUDIT-TVHTRIP.                                              13321001
133220                                                                  13322001
133230     INITIALIZE DCLTAUTRIP.                                       13323001
133240                                                                  13324001
133250     PERFORM                                                      13325001
133260         WITH TEST AFTER                                          13326001
133270         VARYING PV-RETRY-COUNTER                                 13327001
133280         FROM 1 BY 1                                              13328001
133290         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13329001
133300             OR (SQLCODE = +0))                                   13330001
133310                                                                  13331001
133320         EXEC SQL                                                 13332001
133330             SELECT  OWNER_SCAC_ID                                13333001
133340                    ,VEH_NBR                                      13334001
133350                    ,TRIP_ID                                      13335001
133360                    ,TRIP_BEG_DTE                                 13336001
133370                    ,TRIP_BEG_TME                                 13337001
133380                    ,CRT_SRC_CDE                                  13338001
133390                    ,LAST_UPD_DTE                                 13339001
133400                    ,LAST_UPD_TME                                 13340001
133410                    ,LAST_UPD_UID                                 13341001
133420                    ,MANIFEST_NBR                                 13342001
133430                    ,PLND_TRIP_SEQ                                13343001
133440                    ,PLND_ACTVY_CDE                               13344001
133450                    ,REF_TRIP_ID                                  13345001
133460                    ,SPLT_XMIT_IND                                13346001
133470                    ,SPLT_XMIT_DTE                                13347001
133480                    ,SPLT_XMIT_TM                                 13348001
133490            INTO     :VHTRIP-OWNER-SCAC-ID                        13349001
133500                    ,:VHTRIP-VEH-NBR                              13350001
133510                       :DN-VEH-NBR                                13351001
133520                    ,:VHTRIP-TRIP-ID                              13352001
133530                    ,:VHTRIP-TRIP-BEG-DTE                         13353001
133540                    ,:VHTRIP-TRIP-BEG-TME                         13354001
133550                    ,:VHTRIP-CRT-SRC-CDE                          13355001
133560                    ,:VHTRIP-LAST-UPD-DTE                         13356001
133570                    ,:VHTRIP-LAST-UPD-TME                         13357001
133580                    ,:VHTRIP-LAST-UPD-UID                         13358001
133590                    ,:VHTRIP-MANIFEST-NBR                         13359001
133600                    ,:VHTRIP-PLND-TRIP-SEQ                        13360001
133610                    ,:VHTRIP-PLND-ACTVY-CDE                       13361001
133620                    ,:VHTRIP-REF-TRIP-ID                          13362001
133630                    ,:VHTRIP-SPLT-XMIT-IND                        13363001
133640                    ,:VHTRIP-SPLT-XMIT-DTE                        13364001
133650                    ,:VHTRIP-SPLT-XMIT-TM                         13365001
133660           FROM   TVHTRIP                                         13366001
133670           WHERE  TRIP_ID = :DK-TRIP-ID                           13367001
133680         END-EXEC                                                 13368001
133690                                                                  13369001
133700         EVALUATE TRUE                                            13370001
133710             WHEN SQLCODE = +0                                    13371001
133720             WHEN SQLCODE = -904                                  13372001
133730             WHEN SQLCODE = -913                                  13373001
133740                 CONTINUE                                         13374001
133750                                                                  13375001
133760             WHEN SQLWARN0 NOT = SPACES                           13376001
133770             WHEN SQLCODE < +0                                    13377001
133780             WHEN SQLCODE > +0                                    13378001
133790                 MOVE '6300-AUDIT-TVHTRIP'                        13379001
133800                                   TO DP013-PARAGRAPH             13380001
133810                 MOVE 'SELECT A ROW ON TVHTRIP'                   13381001
133820                                   TO DP013-MESSAGE-TEXT(1)       13382001
133830                 MOVE SQLCA        TO DP013-SQLCA                 13383001
133840                 MOVE 'TVHTRIP'    TO DP013-DB2-TABLE-NAME (1)    13384001
133850                 SET DP013-DB2-ABEND                              13385001
133860                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13386001
133870                 PERFORM DP013-0000-PROCESS-ABEND                 13387001
133880         END-EVALUATE                                             13388001
133890     END-PERFORM.                                                 13389001
133900                                                                  13390001
133910     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13391001
133920             AND (SQLCODE = -904 OR -913)                         13392001
133930         MOVE '6300-AUDIT-TVHTRIP'                                13393001
133940                                   TO DP013-PARAGRAPH             13394001
133950         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              13395001
133960                                   TO DP013-MESSAGE-TEXT (1)      13396001
133970         MOVE 'TO SELECT A TVHTRIP ROW'                           13397001
133980                                   TO DP013-MESSAGE-TEXT (2)      13398001
133990         MOVE SQLCA                TO DP013-SQLCA                 13399001
134000         MOVE 'TVHTRIP'            TO DP013-DB2-TABLE-NAME (1)    13400001
134010         SET DP013-DB2-ABEND                                      13401001
134020             DP013-XCTL-DISPLAY-RESTART                           13402001
134030                                   TO TRUE                        13403001
134040         PERFORM DP013-0000-PROCESS-ABEND                         13404001
134050     END-IF.                                                      13405001
134060                                                                  13406001
134070     PERFORM                                                      13407001
134080         WITH TEST AFTER                                          13408001
134090         VARYING PV-RETRY-COUNTER                                 13409001
134100         FROM 1 BY 1                                              13410001
134110         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13411001
134120             OR (SQLCODE = +0))                                   13412001
134130                                                                  13413001
134140         EXEC SQL                                                 13414001
134150             INSERT  INTO TAUTRIP                                 13415001
134160                    (OWNER_SCAC_ID                                13416001
134170                    ,VEH_NBR                                      13417001
134180                    ,TRIP_ID                                      13418001
134190                    ,TRIP_BEG_DTE                                 13419001
134200                    ,TRIP_BEG_TME                                 13420001
134210                    ,CRT_SRC_CDE                                  13421001
134220                    ,LAST_UPD_DTE                                 13422001
134230                    ,LAST_UPD_TME                                 13423001
134240                    ,LAST_UPD_UID                                 13424001
134250                    ,MANIFEST_NBR                                 13425001
134260                    ,PLND_TRIP_SEQ                                13426001
134270                    ,PLND_ACTVY_CDE                               13427001
134280                    ,REF_TRIP_ID                                  13428001
134290                    ,SPLT_XMIT_IND                                13429001
134300                    ,SPLT_XMIT_DTE                                13430001
134310                    ,SPLT_XMIT_TM )                               13431001
134320            VALUES  (:VHTRIP-OWNER-SCAC-ID                        13432001
134330                    ,:VHTRIP-VEH-NBR                              13433001
134340                       :DN-VEH-NBR                                13434001
134350                    ,:VHTRIP-TRIP-ID                              13435001
134360                    ,:VHTRIP-TRIP-BEG-DTE                         13436001
134370                    ,:VHTRIP-TRIP-BEG-TME                         13437001
134380                    ,:VHTRIP-CRT-SRC-CDE                          13438001
134390                    ,:VHTRIP-LAST-UPD-DTE                         13439001
134400                    ,:VHTRIP-LAST-UPD-TME                         13440001
134410                    ,:VHTRIP-LAST-UPD-UID                         13441001
134420                    ,:VHTRIP-MANIFEST-NBR                         13442001
134430                    ,:VHTRIP-PLND-TRIP-SEQ                        13443001
134440                    ,:VHTRIP-PLND-ACTVY-CDE                       13444001
134450                    ,:VHTRIP-REF-TRIP-ID                          13445001
134460                    ,:VHTRIP-SPLT-XMIT-IND                        13446001
134470                    ,:VHTRIP-SPLT-XMIT-DTE                        13447001
134480                    ,:VHTRIP-SPLT-XMIT-TM )                       13448001
134490         END-EXEC                                                 13449001
134500                                                                  13450001
134510         EVALUATE TRUE                                            13451001
134520             WHEN SQLCODE = +0                                    13452001
134530             WHEN SQLCODE = -904                                  13453001
134540             WHEN SQLCODE = -913                                  13454001
134550                 CONTINUE                                         13455001
134560                                                                  13456001
134570             WHEN SQLWARN0 NOT = SPACES                           13457001
134580             WHEN SQLCODE < +0                                    13458001
134590             WHEN SQLCODE > +0                                    13459001
134600                 MOVE '6300-AUDIT-TVHTRIP'                        13460001
134610                                   TO DP013-PARAGRAPH             13461001
134620                 MOVE 'INSERT A ROW ON TAUTRIP'                   13462001
134630                                   TO DP013-MESSAGE-TEXT(1)       13463001
134640                 MOVE SQLCA        TO DP013-SQLCA                 13464001
134650                 MOVE 'TAUTRIP'    TO DP013-DB2-TABLE-NAME (1)    13465001
134660                 SET DP013-DB2-ABEND                              13466001
134670                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13467001
134680                 PERFORM DP013-0000-PROCESS-ABEND                 13468001
134690         END-EVALUATE                                             13469001
134700     END-PERFORM.                                                 13470001
134710                                                                  13471001
134720     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13472001
134730             AND (SQLCODE = -904 OR -913)                         13473001
134740         MOVE '6300-AUDIT-TVHTRIP'                                13474001
134750                                   TO DP013-PARAGRAPH             13475001
134760         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              13476001
134770                                   TO DP013-MESSAGE-TEXT (1)      13477001
134780         MOVE 'TO INSERT A TAUTRIP ROW'                           13478001
134790                                   TO DP013-MESSAGE-TEXT (2)      13479001
134800         MOVE SQLCA                TO DP013-SQLCA                 13480001
134810         MOVE 'TAUTRIP'            TO DP013-DB2-TABLE-NAME (1)    13481001
134820         SET DP013-DB2-ABEND                                      13482001
134830             DP013-XCTL-DISPLAY-RESTART                           13483001
134840                                   TO TRUE                        13484001
134850         PERFORM DP013-0000-PROCESS-ABEND                         13485001
134860     END-IF.                                                      13486001
134870                                                                  13487001
134880/                                                                 13488001
134890*----------------------------------------------------------------*13489001
134900*  TAKE A SNAPSHOT OF THE BEFORE IMAGE OF TSHIPMT AND WRITE      *13490001
134910*  TO THE AUDIT TABLE.                                           *13491001
134920*----------------------------------------------------------------*13492001
134930 6400-AUDIT-TSHIPMT.                                              13493001
134940                                                                  13494001
134950     INITIALIZE DCLTAUSHIP.                                       13495001
134960                                                                  13496001
134970* CLT 12-01-2011 WR40574 ADDED CARR-AUTH-ID BELOW                 13497001
134980     PERFORM                                                      13498001
134990         WITH TEST AFTER                                          13499001
135000         VARYING PV-RETRY-COUNTER                                 13500001
135010         FROM 1 BY 1                                              13501001
135020         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13502001
135030             OR (SQLCODE = +0))                                   13503001
135040                                                                  13504001
135050         EXEC SQL                                                 13505001
135060             SELECT  TRIP_ID                                      13506001
135070                    ,SHIPT_ID                                     13507001
135080                    ,CRT_SRC_CDE                                  13508001
135090                    ,LAST_UPD_DTE                                 13509001
135100                    ,LAST_UPD_TME                                 13510001
135110                    ,LAST_UPD_UID                                 13511001
135120                    ,PRO_SCAC_ID                                  13512001
135130                    ,PRO_NBR                                      13513001
135140                    ,BOL_NBR                                      13514001
135150                    ,SHIPPER_NME                                  13515001
135160                    ,SHIPT_TYP_CDE                                13516001
135170                    ,EXPTED_GRO_WGHT                              13517001
135180                    ,PKG_TYP_CDE                                  13518001
135190                    ,EXPTED_PKG_QTY                               13519001
135200                    ,FRGT_CHG_AMT                                 13520001
135210                    ,FRGT_TERMS_CDE                               13521001
135220                    ,EXPTED_PLT_QTY                               13522001
135230                    ,VEND_SHIP_DTE                                13523001
135240                    ,EST_AR_TMST                                  13524001
135250                    ,ORIG_SCAC_ID                                 13525001
135260                    ,LAST_UPD_PGM_ID                              13526001
135270                    ,CRE_USER_ID                                  13527001
135280                    ,CARR_CART_CT                                 13528001
135290                    ,CARR_LAST_UPD_DTE                            13529001
135300                    ,CARR_LAST_UPD_TIME                           13530001
135310                    ,VEND_CART_CT                                 13531001
135320                    ,VEND_LAST_UPD_DTE                            13532001
135330                    ,VEND_LAST_UPD_TIME                           13533001
135340                    ,VEH_NBR                                      13534001
135350                    ,AUTH_NBR                                     13535001
135360                    ,AUTH_DTE                                     13536001
135370                    ,CONFIRM_DTE                                  13537001
135380                    ,CONFIRM_TIME                                 13538001
135390                    ,COMPLETE_PRO_NBR                             13539001
135400                    ,COMPLETE_BOL_NBR                             13540001
135410                    ,PROCESSED_DTE                                13541001
135420                    ,INVC_NBR                                     13542001
135430                    ,CARR_AUTH_ID                                 13543001
135440            INTO     :SHIPMT-TRIP-ID                              13544001
135450                       :DN-TRIP-ID                                13545001
135460                    ,:SHIPMT-SHIPT-ID                             13546001
135470                    ,:SHIPMT-CRT-SRC-CDE                          13547001
135480                    ,:SHIPMT-LAST-UPD-DTE                         13548001
135490                    ,:SHIPMT-LAST-UPD-TME                         13549001
135500                    ,:SHIPMT-LAST-UPD-UID                         13550001
135510                    ,:SHIPMT-PRO-SCAC-ID                          13551001
135520                    ,:SHIPMT-PRO-NBR                              13552001
135530                    ,:SHIPMT-BOL-NBR                              13553001
135540                    ,:SHIPMT-SHIPPER-NME                          13554001
135550                    ,:SHIPMT-SHIPT-TYP-CDE                        13555001
135560                    ,:SHIPMT-EXPTED-GRO-WGHT                      13556001
135570                    ,:SHIPMT-PKG-TYP-CDE                          13557001
135580                    ,:SHIPMT-EXPTED-PKG-QTY                       13558001
135590                    ,:SHIPMT-FRGT-CHG-AMT                         13559001
135600                    ,:SHIPMT-FRGT-TERMS-CDE                       13560001
135610                    ,:SHIPMT-EXPTED-PLT-QTY                       13561001
135620                    ,:SHIPMT-VEND-SHIP-DTE                        13562001
135630                    ,:SHIPMT-EST-AR-TMST                          13563001
135640                       :DN-SHIP-EST-AR-TMST                       13564001
135650                    ,:SHIPMT-ORIG-SCAC-ID                         13565001
135660                    ,:SHIPMT-LAST-UPD-PGM-ID                      13566001
135670                    ,:SHIPMT-CRE-USER-ID                          13567001
135680                    ,:SHIPMT-CARR-CART-CT                         13568001
135690                    ,:SHIPMT-CARR-LAST-UPD-DTE                    13569001
135700                    ,:SHIPMT-CARR-LAST-UPD-TIME                   13570001
135710                    ,:SHIPMT-VEND-CART-CT                         13571001
135720                    ,:SHIPMT-VEND-LAST-UPD-DTE                    13572001
135730                    ,:SHIPMT-VEND-LAST-UPD-TIME                   13573001
135740                    ,:SHIPMT-VEH-NBR                              13574001
135750                    ,:SHIPMT-AUTH-NBR                             13575001
135760                    ,:SHIPMT-AUTH-DTE                             13576001
135770                    ,:SHIPMT-CONFIRM-DTE                          13577001
135780                    ,:SHIPMT-CONFIRM-TIME                         13578001
135790                    ,:SHIPMT-COMPLETE-PRO-NBR                     13579001
135800                    ,:SHIPMT-COMPLETE-BOL-NBR                     13580001
135810                    ,:SHIPMT-PROCESSED-DTE                        13581001
135820                    ,:SHIPMT-INVC-NBR                             13582001
135830                    ,:SHIPMT-CARR-AUTH-ID                         13583001
135840           FROM   TSHIPMT                                         13584001
135850           WHERE  SHIPT_ID = :DK-SHIPT-ID                         13585001
135860         END-EXEC                                                 13586001
135870                                                                  13587001
135880         EVALUATE TRUE                                            13588001
135890             WHEN SQLCODE = +0                                    13589001
135900             WHEN SQLCODE = -904                                  13590001
135910             WHEN SQLCODE = -913                                  13591001
135920                 CONTINUE                                         13592001
135930                                                                  13593001
135940             WHEN SQLWARN0 NOT = SPACES                           13594001
135950             WHEN SQLCODE < +0                                    13595001
135960             WHEN SQLCODE > +0                                    13596001
135970                 MOVE '6400-AUDIT-TSHIPMT'                        13597001
135980                                   TO DP013-PARAGRAPH             13598001
135990                 MOVE 'SELECT A TSHIPMT ROW   '                   13599001
136000                                   TO DP013-MESSAGE-TEXT(1)       13600001
136010                 MOVE SQLCA        TO DP013-SQLCA                 13601001
136020                 MOVE 'TSHIPMT'    TO DP013-DB2-TABLE-NAME (1)    13602001
136030                 SET DP013-DB2-ABEND                              13603001
136040                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13604001
136050                 PERFORM DP013-0000-PROCESS-ABEND                 13605001
136060         END-EVALUATE                                             13606001
136070     END-PERFORM.                                                 13607001
136080                                                                  13608001
136090     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13609001
136100             AND (SQLCODE = -904 OR -913)                         13610001
136110         MOVE '6400-AUDIT-TSHIPMT '                               13611001
136120                                   TO DP013-PARAGRAPH             13612001
136130         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              13613001
136140                                   TO DP013-MESSAGE-TEXT (1)      13614001
136150         MOVE 'TO SELECT A TSHIPMT ROW'                           13615001
136160                                   TO DP013-MESSAGE-TEXT (2)      13616001
136170         MOVE SQLCA                TO DP013-SQLCA                 13617001
136180         MOVE 'TSHIPMT'            TO DP013-DB2-TABLE-NAME (1)    13618001
136190         SET DP013-DB2-ABEND                                      13619001
136200             DP013-XCTL-DISPLAY-RESTART                           13620001
136210                                   TO TRUE                        13621001
136220         PERFORM DP013-0000-PROCESS-ABEND                         13622001
136230     END-IF.                                                      13623001
136240                                                                  13624001
136250* CLT 12-01-2011 WR40574 ADDED CARR-AUTH-ID BELOW                 13625001
136260     PERFORM                                                      13626001
136270         WITH TEST AFTER                                          13627001
136280         VARYING PV-RETRY-COUNTER                                 13628001
136290         FROM 1 BY 1                                              13629001
136300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13630001
136310             OR (SQLCODE = +0))                                   13631001
136320                                                                  13632001
136330         EXEC SQL                                                 13633001
136340             INSERT  INTO TAUSHIP                                 13634001
136350                    (TRIP_ID                                      13635001
136360                    ,SHIPT_ID                                     13636001
136370                    ,CRT_SRC_CDE                                  13637001
136380                    ,LAST_UPD_DTE                                 13638001
136390                    ,LAST_UPD_TME                                 13639001
136400                    ,LAST_UPD_UID                                 13640001
136410                    ,PRO_SCAC_ID                                  13641001
136420                    ,PRO_NBR                                      13642001
136430                    ,BOL_NBR                                      13643001
136440                    ,SHIPPER_NME                                  13644001
136450                    ,SHIPT_TYP_CDE                                13645001
136460                    ,EXPTED_GRO_WGHT                              13646001
136470                    ,PKG_TYP_CDE                                  13647001
136480                    ,EXPTED_PKG_QTY                               13648001
136490                    ,FRGT_CHG_AMT                                 13649001
136500                    ,FRGT_TERMS_CDE                               13650001
136510                    ,EST_AR_TMST                                  13651001
136520                    ,VEND_SHIP_DTE                                13652001
136530                    ,EXPTED_PLT_QTY                               13653001
136540                    ,ORIG_SCAC_ID                                 13654001
136550                    ,LAST_UPD_PGM_ID                              13655001
136560                    ,CRE_USER_ID                                  13656001
136570                    ,CARR_CART_CT                                 13657001
136580                    ,CARR_LAST_UPD_DTE                            13658001
136590                    ,CARR_LAST_UPD_TIME                           13659001
136600                    ,VEND_CART_CT                                 13660001
136610                    ,VEND_LAST_UPD_DTE                            13661001
136620                    ,VEND_LAST_UPD_TIME                           13662001
136630                    ,VEH_NBR                                      13663001
136640                    ,AUTH_NBR                                     13664001
136650                    ,AUTH_DTE                                     13665001
136660                    ,CONFIRM_DTE                                  13666001
136670                    ,CONFIRM_TIME                                 13667001
136680                    ,PROCESSED_DTE                                13668001
136690                    ,INVC_NBR                                     13669001
136700                    ,AUD_STATUS_CDE                               13670001
136710                    ,CARR_AUTH_ID)                                13671001
136720            VALUES  (:SHIPMT-TRIP-ID                              13672001
136730                       :DN-TRIP-ID                                13673001
136740                    ,:SHIPMT-SHIPT-ID                             13674001
136750                    ,:SHIPMT-CRT-SRC-CDE                          13675001
136760                    ,:SHIPMT-LAST-UPD-DTE                         13676001
136770                    ,:SHIPMT-LAST-UPD-TME                         13677001
136780                    ,:SHIPMT-LAST-UPD-UID                         13678001
136790                    ,:SHIPMT-PRO-SCAC-ID                          13679001
136800                    ,:SHIPMT-COMPLETE-PRO-NBR                     13680001
136810                    ,:SHIPMT-COMPLETE-BOL-NBR                     13681001
136820                    ,:SHIPMT-SHIPPER-NME                          13682001
136830                    ,:SHIPMT-SHIPT-TYP-CDE                        13683001
136840                    ,:SHIPMT-EXPTED-GRO-WGHT                      13684001
136850                    ,:SHIPMT-PKG-TYP-CDE                          13685001
136860                    ,:SHIPMT-EXPTED-PKG-QTY                       13686001
136870                    ,:SHIPMT-FRGT-CHG-AMT                         13687001
136880                    ,:SHIPMT-FRGT-TERMS-CDE                       13688001
136890                    ,:SHIPMT-EST-AR-TMST                          13689001
136900                       :DN-SHIP-EST-AR-TMST                       13690001
136910                    ,:SHIPMT-VEND-SHIP-DTE                        13691001
136920                    ,:SHIPMT-EXPTED-PLT-QTY                       13692001
136930                    ,:SHIPMT-ORIG-SCAC-ID                         13693001
136940                    ,:SHIPMT-LAST-UPD-PGM-ID                      13694001
136950                    ,:SHIPMT-CRE-USER-ID                          13695001
136960                    ,:SHIPMT-CARR-CART-CT                         13696001
136970                    ,:SHIPMT-CARR-LAST-UPD-DTE                    13697001
136980                    ,:SHIPMT-CARR-LAST-UPD-TIME                   13698001
136990                    ,:SHIPMT-VEND-CART-CT                         13699001
137000                    ,:SHIPMT-VEND-LAST-UPD-DTE                    13700001
137010                    ,:SHIPMT-VEND-LAST-UPD-TIME                   13701001
137020                    ,:SHIPMT-VEH-NBR                              13702001
137030                    ,:SHIPMT-AUTH-NBR                             13703001
137040                    ,:SHIPMT-AUTH-DTE                             13704001
137050                    ,:SHIPMT-CONFIRM-DTE                          13705001
137060                    ,:SHIPMT-CONFIRM-TIME                         13706001
137070                    ,:SHIPMT-PROCESSED-DTE                        13707001
137080                    ,:SHIPMT-INVC-NBR                             13708001
137090                    ,:ASC-TRIP-STATUS-CDE                         13709001
137100                    ,:SHIPMT-CARR-AUTH-ID)                        13710001
137110         END-EXEC                                                 13711001
137120                                                                  13712001
137130         EVALUATE TRUE                                            13713001
137140             WHEN SQLCODE = +0                                    13714001
137150             WHEN SQLCODE = -904                                  13715001
137160             WHEN SQLCODE = -913                                  13716001
137170                 CONTINUE                                         13717001
137180                                                                  13718001
137190             WHEN SQLWARN0 NOT = SPACES                           13719001
137200             WHEN SQLCODE < +0                                    13720001
137210             WHEN SQLCODE > +0                                    13721001
137220                 MOVE '6400-AUDIT-TSHIPMT '                       13722001
137230                                   TO DP013-PARAGRAPH             13723001
137240                 MOVE 'INSERT A ROW ON TAUSHIP'                   13724001
137250                                   TO DP013-MESSAGE-TEXT(1)       13725001
137260                 MOVE SQLCA        TO DP013-SQLCA                 13726001
137270                 MOVE 'TAUSHIP'    TO DP013-DB2-TABLE-NAME (1)    13727001
137280                 SET DP013-DB2-ABEND                              13728001
137290                     DP013-XCTL-DISPLAY-RESTART TO TRUE           13729001
137300                 PERFORM DP013-0000-PROCESS-ABEND                 13730001
137310         END-EVALUATE                                             13731001
137320     END-PERFORM.                                                 13732001
137330                                                                  13733001
137340     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        13734001
137350             AND (SQLCODE = -904 OR -913)                         13735001
137360         MOVE '6400-AUDIT-TSHIPMT'                                13736001
137370                                   TO DP013-PARAGRAPH             13737001
137380         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              13738001
137390                                   TO DP013-MESSAGE-TEXT (1)      13739001
137400         MOVE 'TO INSERT A TAUSHIP ROW'                           13740001
137410                                   TO DP013-MESSAGE-TEXT (2)      13741001
137420         MOVE SQLCA                TO DP013-SQLCA                 13742001
137430         MOVE 'TAUSHIP'            TO DP013-DB2-TABLE-NAME (1)    13743001
137440         SET DP013-DB2-ABEND                                      13744001
137450             DP013-XCTL-DISPLAY-RESTART                           13745001
137460                                   TO TRUE                        13746001
137470         PERFORM DP013-0000-PROCESS-ABEND                         13747001
137480     END-IF.                                                      13748001
137490                                                                  13749001
137500/                                                                 13750001
137510 7000-TRIP-STATUS.                                                13751001
137520     MOVE SPACES                      TO TRIPST-TRIP-STATUS-CDE   13752001
137530     MOVE ASC-KEY-OWNER-SCAC-ID       TO VHTRIP-OWNER-SCAC-ID     13753001
137540     MOVE ASC-OPER-UNT-ID-N           TO TRIPST-OPER-UNT-ID       13754001
137550     MOVE ASC-VEH-NBR                 TO VHTRIP-VEH-NBR           13755001
137560     MOVE ASC-TRIP-ID                 TO VHTRIP-TRIP-ID           13756001
137570     EXEC SQL                                                     13757001
137580         SELECT                                                   13758001
137590             B.TRIP_STATUS_CDE                                    13759001
137600         INTO                                                     13760001
137610             :TRIPST-TRIP-STATUS-CDE                              13761001
137620         FROM   TVHTRIP A                                         13762001
137630             ,  TTRIPST B                                         13763001
137640         WHERE A.OWNER_SCAC_ID   = :VHTRIP-OWNER-SCAC-ID          13764001
137650             AND A.VEH_NBR       = :VHTRIP-VEH-NBR                13765001
137660             AND B.OPER_UNT_ID   = :TRIPST-OPER-UNT-ID            13766001
137670             AND A.TRIP_ID       = :VHTRIP-TRIP-ID                13767001
137680             AND B.FCLTY_ID      = 1                              13768001
137690             AND A.TRIP_ID       = B.TRIP_ID                      13769001
137700             AND TIMESTAMP(B.STATUS_DTE, B.STATUS_TME)    =       13770001
137710                 (SELECT MAX                                      13771001
137720                      (TIMESTAMP(D.STATUS_DTE, D.STATUS_TME))     13772001
137730                         FROM TTRIPST D                           13773001
137740                        WHERE D.TRIP_ID       = A.TRIP_ID)        13774001
137750     END-EXEC.                                                    13775001
137760                                                                  13776001
137770     EVALUATE TRUE                                                13777001
137780         WHEN SQLCODE = ZERO                                      13778001
137790         WHEN SQLCODE = +100                                      13779001
137800             CONTINUE                                             13780001
137810         WHEN SQLCODE = -904                                      13781001
137820         WHEN SQLCODE = -911                                      13782001
137830         WHEN SQLCODE = -913                                      13783001
137840             MOVE '7000-TRIP-STATUS'                              13784001
137850                                      TO DP013-PARAGRAPH          13785001
137860             MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'   13786001
137870                                      TO DP013-MESSAGE-TEXT (1)   13787001
137880             MOVE SQLCA               TO DP013-SQLCA              13788001
137890             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1) 13789001
137900             MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2) 13790001
137910             SET DP013-DB2-ABEND                                  13791001
137920                 DP013-XCTL-DISPLAY-RESTART                       13792001
137930                                      TO TRUE                     13793001
137940             PERFORM DP013-0000-PROCESS-ABEND                     13794001
137950         WHEN SQLWARN0 NOT = SPACE                                13795001
137960         WHEN SQLCODE NOT = ZERO                                  13796001
137970              MOVE '7000-TRIP-STATUS'   TO DP013-PARAGRAPH        13797001
137980              MOVE 'FIND TRIP CURRENT STATUS '                    13798001
137990                                      TO DP013-MESSAGE-TEXT (1)   13799001
138000              MOVE ASC-PO-NBR         TO PV-TRLR-ERROR-PO         13800001
138010              MOVE ASC-REC-SEQ-NBR    TO PV-TRLR-ERROR-SEQ        13801001
138020              MOVE TRIPST-OPER-UNT-ID TO PV-TRLR-ERROR-OPER-UNT-ID13802001
138030              MOVE VHTRIP-OWNER-SCAC-ID                           13803001
138040                                      TO PV-TRLR-ERROR-SCAC       13804001
138050              MOVE VHTRIP-VEH-NBR     TO PV-TRLR-ERROR-TRLR       13805001
138060              MOVE PV-TRLR-ERROR-MSG  TO DP013-MESSAGE-TEXT (2)   13806001
138070              MOVE SQLCA              TO DP013-SQLCA              13807001
138080              MOVE 'TVHTRIP '         TO DP013-DB2-TABLE-NAME (1) 13808001
138090              MOVE 'TTRIPST '         TO DP013-DB2-TABLE-NAME (2) 13809001
138100              SET DP013-DB2-ABEND     TO TRUE                     13810001
138110              PERFORM DP013-0000-PROCESS-ABEND                    13811001
138120     END-EVALUATE.                                                13812001
138130/                                                                 13813001
138140 7050-MANIFESTED-CARTONS.                                         13814001
138150     MOVE 'N'                         TO PS-MANIFEST-CTN-SW       13815001
138160     EXEC SQL                                                     13816001
138170         SELECT 'Y'                                               13817001
138180     INTO                                                         13818001
138190         :PS-MANIFEST-CTN-SW                                      13819001
138200     FROM                                                         13820001
138210         TPKSLIP A                                                13821001
138220      ,  TINPKSU B                                                13822001
138230      ,  TSHUNLO C                                                13823001
138240      ,  TSULBXF D                                                13824001
138250      WHERE                                                       13825001
138260              A.PO_NBR         = :DK-PO-NBR                       13826001
138270         AND  A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR                  13827001
138280         AND  A.VER_STAT_CDE   = 'A'                              13828001
138290         AND  A.SEQ_NBR        = B.SEQ_NBR                        13829001
138300         AND  A.PO_NBR         = B.PO_NBR                         13830001
138310         AND  B.SHIPT_UNT_ID   = C.SHIPT_UNT_ID                   13831001
138320         AND  C.SHIPT_UNT_ID   = D.SHIPT_UNT_ID                   13832001
138330         AND  D.STAT_CDE       = 'A'                              13833001
138340                                                                  13834001
138350         FETCH FIRST 1 ROWS ONLY                                  13835001
138360         WITH UR                                                  13836001
138370     END-EXEC.                                                    13837001
138380                                                                  13838001
138390     EVALUATE TRUE                                                13839001
138400         WHEN SQLCODE = ZERO                                      13840001
138410         WHEN SQLCODE = +100                                      13841001
138420             CONTINUE                                             13842001
138430         WHEN SQLCODE = -904                                      13843001
138440         WHEN SQLCODE = -911                                      13844001
138450         WHEN SQLCODE = -913                                      13845001
138460             MOVE '7050-MANIFESTED-CARTONS'                       13846001
138470                                      TO DP013-PARAGRAPH          13847001
138480             MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'   13848001
138490                                      TO DP013-MESSAGE-TEXT (1)   13849001
138500             MOVE SQLCA               TO DP013-SQLCA              13850001
138510             MOVE 'TVHTRIP '          TO DP013-DB2-TABLE-NAME (1) 13851001
138520             MOVE 'TTRIPST '          TO DP013-DB2-TABLE-NAME (2) 13852001
138530             SET DP013-DB2-ABEND                                  13853001
138540                 DP013-XCTL-DISPLAY-RESTART                       13854001
138550                                      TO TRUE                     13855001
138560             PERFORM DP013-0000-PROCESS-ABEND                     13856001
138570         WHEN SQLWARN0 NOT = SPACE                                13857001
138580         WHEN SQLCODE NOT = ZERO                                  13858001
138590              MOVE '7050-MANIFESTED-CARTONS' TO DP013-PARAGRAPH   13859001
138600              MOVE 'CHECK FOR MANIFEST CARTONS'                   13860001
138610                                      TO DP013-MESSAGE-TEXT (1)   13861001
138620              MOVE ASC-PO-NBR         TO PV-TRLR-ERROR-PO         13862001
138630              MOVE ASC-REC-SEQ-NBR    TO PV-TRLR-ERROR-SEQ        13863001
138640              STRING ' PO='                                       13864001
138650                     PV-TRLR-ERROR-PO                             13865001
138660                     ' PCVR= '                                    13866001
138670                     PV-TRLR-ERROR-SEQ                            13867001
138680                      '-  BAD SQLCODE '                           13868001
138690                     DELIMITED BY SIZE                            13869001
138700                     INTO DP013-MESSAGE-TEXT (2)                  13870001
138710              MOVE SQLCA              TO DP013-SQLCA              13871001
138720              MOVE 'TPKSLIP '         TO DP013-DB2-TABLE-NAME (1) 13872001
138730              MOVE 'TINPKSU '         TO DP013-DB2-TABLE-NAME (2) 13873001
138740              MOVE 'TSHUNLO '         TO DP013-DB2-TABLE-NAME (3) 13874001
138750              MOVE 'TSULBXF '         TO DP013-DB2-TABLE-NAME (4) 13875001
138760              SET DP013-DB2-ABEND     TO TRUE                     13876001
138770              PERFORM DP013-0000-PROCESS-ABEND                    13877001
138780     END-EVALUATE.                                                13878001
138790/                                                                 13879001
138800 7900-EDIT-PO.                                                    13880001
138810                                                                  13881001
138820      IF  ASC-PO-NBR = (SPACES OR ZEROES)                         13882001
138830          SET PS-ERROR                                            13883001
138840              DP020-MSG-FATAL        TO TRUE                      13884001
138850          MOVE PC-TSYMSG-00007       TO DP020-MSG-NUMBER          13885001
138860          MOVE DP015-UNP-ALP-BRT-OFF TO APONBRA                   13886001
138870          MOVE DP015-RED             TO APONBRC                   13887001
138880          MOVE DP015-REVERSE         TO APONBRH                   13888001
138890          MOVE -1                    TO APONBRL                   13889001
138900          SET DP030-SET-CURSOR-APPL-1                             13890001
138910                                     TO TRUE                      13891001
138920      ELSE                                                        13892001
138930          MOVE ASC-PO-NBR            TO DP010I-UNEDITED-FIELD     13893001
138940          MOVE LENGTH OF ASC-PO-NBR  TO DP010I-MAXIMUM-DIGITS     13894001
138950          MOVE ZERO                  TO DP010I-MAXIMUM-DECIMALS   13895001
138960          SET  DP010I-NEGATIVE-NOT-ALLOWED                        13896001
138970                                     TO TRUE                      13897001
138980          CALL DP010I-NUMERIC-EDIT-ROUTINE                        13898034
138981               USING DP010I-NUMERIC-EDIT-AREA                     13898134
138990          IF  DP010I-ERROR-DETECTED                               13899001
139000              SET PS-ERROR                                        13900001
139010                  DP020-MSG-FATAL    TO TRUE                      13901001
139020              MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER          13902001
139030              MOVE DP015-UNP-ALP-BRT-OFF                          13903001
139040                                     TO APONBRA                   13904001
139050              MOVE DP015-RED         TO APONBRC                   13905001
139060              MOVE DP015-REVERSE     TO APONBRH                   13906001
139070              MOVE -1                TO APONBRL                   13907001
139080              SET DP030-SET-CURSOR-APPL-1                         13908001
139090                                     TO TRUE                      13909001
139100          ELSE                                                    13910001
139110              MOVE DP010I-NUMERIC-FIELD TO PV-TEMP-PO-NBR         13911001
139120              MOVE PV-TEMP-PO-NBR      TO ASC-PO-NBR-N            13912001
139130                                          ASC-KEY-PO-NBR          13913001
139140                                             DK-PO-NBR            13914001
139150          END-IF                                                  13915001
139160      END-IF.                                                     13916001
139170                                                                  13917001
139180 8000-FORMAT-COMMAREA.                                            13918001
139190                                                                  13919001
139200     INITIALIZE RC012-INTER-APPL-COMMAREA.                        13920001
139210                                                                  13921001
139220     IF  ASC-ADD-SUCCESSFUL                                       13922001
139230         MOVE ASC-PO-NBR-OLD      TO RC012-PO-NBR                 13923001
139240         MOVE ASC-REC-SEQ-NBR     TO RC012-REC-SEQ-NBR            13924001
139250     ELSE                                                         13925001
139260         MOVE ASC-KEY-PO-NBR      TO RC012-PO-NBR                 13926001
139270         MOVE ASC-KEY-REC-SEQ-NBR TO RC012-REC-SEQ-NBR            13927001
139280     END-IF.                                                      13928001
139290                                                                  13929001
139300     MOVE ASC-OPER-UNT-ID-N       TO RC012-OPER-UNT-ID.           13930001
139310     MOVE ASC-FCLTY-ID-N          TO RC012-FCLTY-ID.              13931001
139320     MOVE ASC-KEY-OWNER-SCAC-ID   TO RC012-OWNER-SCAC-ID.         13932001
139330     MOVE ASC-KEY-VEH-NBR         TO RC012-VEH-NBR.               13933001
139340     MOVE ASC-TKT-FMT-ID          TO RC012-TKT-TYP-DESC.          13934001
139350     MOVE ASC-PRE-TKT-IND         TO RC012-PRE-TKT-IND.           13935001
139360     MOVE 'AC'                    TO RC012-AC-STAT.               13936001
139370     MOVE 'IN'                    TO RC012-IN-STAT.               13937001
139380     MOVE 'IP'                    TO RC012-IP-STAT.               13938001
139390     MOVE 'CM'                    TO RC012-CM-STAT.               13939001
139400                                                                  13940001
139410/                                                                 13941001
139420*----------------------------------------------------------------*13942001
139430*  CHECK PARM TABLE TO SEE IF DC IS TURNED ON TO DOWNLOAD ASN'S   13943001
139440*  TO WMS.                                                        13944001
139450*----------------------------------------------------------------*13945001
139460 8010-CHECK-TKRPRPM.                                              13946001
139470                                                                  13947001
139480     EXEC SQL                                                     13948001
139490          SELECT   FUNC_TXT                                       13949001
139500            INTO  :KRPRPM-FUNC-TXT                                13950001
139510            FROM                                                  13951001
139520                  TKRPRPM A                                       13952001
139530            WHERE                                                 13953001
139540                  LOC_ID            = :PV-COPER-UNT-ID            13954001
139550              AND SYS_PRC_FUNC_CDE  = 'ASNDWN'                    13955001
139560              AND FUNC_PRC_STAT_CDE = 'AC'                        13956001
139570              AND INTFC_SYS_CDE     = 'KHL'                       13957001
139580              AND FUNC_TXT          = 'Y'                         13958001
139590              AND FUNC_BEG_TMST    <= CURRENT TIMESTAMP           13959001
139600     END-EXEC.                                                    13960001
139610                                                                  13961001
139620     EVALUATE TRUE                                                13962001
139630         WHEN SQLCODE = ZERO                                      13963001
139640             SET PS-ASNS-TO-WMS-YES    TO TRUE                    13964001
139650         WHEN SQLCODE = +100                                      13965001
139660             SET PS-ASNS-TO-WMS-NO     TO TRUE                    13966001
139670         WHEN SQLWARN0 NOT = SPACES                               13967001
139680         WHEN SQLCODE  NOT = ZERO                                 13968001
139690             MOVE '8010-CHECK-TKRPRPM'                            13969001
139700                                 TO DP013-PARAGRAPH               13970001
139710             MOVE 'SELECT A TKRPRPM ROW   '                       13971001
139720                                 TO DP013-MESSAGE-TEXT(1)         13972001
139730             MOVE DK-OPER-UNT-ID TO DP013-MESSAGE-TEXT(2)         13973001
139740             MOVE SQLCA          TO DP013-SQLCA                   13974001
139750             MOVE 'TKRPRPM'      TO DP013-DB2-TABLE-NAME (1)      13975001
139760             SET DP013-DB2-ABEND                                  13976001
139770                 DP013-XCTL-DISPLAY-RESTART TO TRUE               13977001
139780*           SET PS-WMS-MESSAGE-YES        TO TRUE                 13978001
139790             PERFORM DP013-0000-PROCESS-ABEND                     13979001
139800     END-EVALUATE.                                                13980001
139810                                                                  13981001
139820                                                                  13982001
139830 8200-AUDIT-TSHPTPO.                                              13983001
139840* REMOVE DEPT# (DEPT_NBR) FROM BEING SELECTED FROM TSHPTO       **13984001
139850* LINES 525323/525349 DELETED               WR/IR# 230ZZ        **13985001
139860                                                                  13986001
139870     INITIALIZE DCLTAUSHPO.                                       13987001
139880                                                                  13988001
139890     PERFORM                                                      13989001
139900         WITH TEST AFTER                                          13990001
139910         VARYING PV-RETRY-COUNTER                                 13991001
139920         FROM 1 BY 1                                              13992001
139930         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               13993001
139940             OR (SQLCODE = +0))                                   13994001
139950                                                                  13995001
139960         EXEC SQL                                                 13996001
139970              SELECT SHIPT_ID                                     13997001
139980                    ,PO_NBR                                       13998001
139990                    ,REC_SEQ_NBR                                  13999001
140000                    ,EXPTED_CART_CNT                              14000001
140010                    ,ACTL_CART_CNT                                14001001
140020                    ,DMG_CART_CNT                                 14002001
140030                    ,PKSL_IND                                     14003001
140040                    ,VEND_NAME                                    14004001
140050                    ,FRGT_CHG_AMT                                 14005001
140060                    ,LAST_UPD_PGM_ID                              14006001
140070                    ,CRE_USER_ID                                  14007001
140080                    ,CARR_CART_CT                                 14008001
140090                    ,CARR_LAST_UPD_DTE                            14009001
140100                    ,CARR_LAST_UPD_TIME                           14010001
140110                    ,VEND_CART_CT                                 14011001
140120                    ,VEND_LAST_UPD_DTE                            14012001
140130                    ,VEND_LAST_UPD_TIME                           14013001
140140                    ,CRE_TMST                                     14014001
140150                    ,LAST_UPD_DTE                                 14015001
140160                    ,LAST_UPD_TIME                                14016001
140170                    ,LAST_UPD_USER_ID                             14017001
140180                    ,PRIM_SHIPT_IND                               14018001
140190                    ,SPLT_XMIT_IND                                14019001
140200                    ,SPLT_XMIT_DTE                                14020001
140210                    ,SPLT_XMIT_TM                                 14021001
140220                INTO :SHPTPO-SHIPT-ID                             14022001
140230                    ,:SHPTPO-PO-NBR                               14023001
140240                    ,:SHPTPO-REC-SEQ-NBR                          14024001
140250                    ,:SHPTPO-EXPTED-CART-CNT                      14025001
140260                    ,:SHPTPO-ACTL-CART-CNT                        14026001
140270                    ,:SHPTPO-DMG-CART-CNT                         14027001
140280                    ,:SHPTPO-PKSL-IND                             14028001
140290                    ,:SHPTPO-VEND-NAME                            14029001
140300                    ,:SHPTPO-FRGT-CHG-AMT                         14030001
140310                    ,:SHPTPO-LAST-UPD-PGM-ID                      14031001
140320                    ,:SHPTPO-CRE-USER-ID                          14032001
140330                    ,:SHPTPO-CARR-CART-CT                         14033001
140340                    ,:SHPTPO-CARR-LAST-UPD-DTE                    14034001
140350                    ,:SHPTPO-CARR-LAST-UPD-TIME                   14035001
140360                    ,:SHPTPO-VEND-CART-CT                         14036001
140370                    ,:SHPTPO-VEND-LAST-UPD-DTE                    14037001
140380                    ,:SHPTPO-VEND-LAST-UPD-TIME                   14038001
140390                    ,:SHPTPO-CRE-TMST                             14039001
140400                    ,:SHPTPO-LAST-UPD-DTE                         14040001
140410                    ,:SHPTPO-LAST-UPD-TIME                        14041001
140420                    ,:SHPTPO-LAST-UPD-USER-ID                     14042001
140430                    ,:SHPTPO-PRIM-SHIPT-IND                       14043001
140440                    ,:SHPTPO-SPLT-XMIT-IND                        14044001
140450                    ,:SHPTPO-SPLT-XMIT-DTE                        14045001
140460                    ,:SHPTPO-SPLT-XMIT-TM                         14046001
140470                FROM TSHPTPO                                      14047001
140480               WHERE PO_NBR      = :DK-PO-NBR                     14048001
140490                 AND SHIPT_ID    = :DK-SHIPT-ID                   14049001
140500         END-EXEC                                                 14050001
140510                                                                  14051001
140520         EVALUATE TRUE                                            14052001
140530             WHEN SQLCODE = +0                                    14053001
140540             WHEN SQLCODE = -904                                  14054001
140550             WHEN SQLCODE = -913                                  14055001
140560                  CONTINUE                                        14056001
140570                                                                  14057001
140580             WHEN SQLWARN0 NOT = SPACES                           14058001
140590             WHEN SQLCODE < +0                                    14059001
140600             WHEN SQLCODE > +0                                    14060001
140610                  MOVE '8200-AUDIT-TSHPTPO'                       14061001
140620                                  TO DP013-PARAGRAPH              14062001
140630                  MOVE 'UNSUCCESSFUL SELECT ON TSHPTPO  '         14063001
140640                                  TO DP013-MESSAGE-TEXT (1)       14064001
140650                  MOVE SQLCA      TO DP013-SQLCA                  14065001
140660                  MOVE 'TSHPTPO ' TO DP013-DB2-TABLE-NAME (1)     14066001
140670                  SET DP013-DB2-ABEND                             14067001
140680                      DP013-XCTL-DISPLAY-RESTART                  14068001
140690                                  TO TRUE                         14069001
140700                  PERFORM DP013-0000-PROCESS-ABEND                14070001
140710         END-EVALUATE                                             14071001
140720     END-PERFORM.                                                 14072001
140730                                                                  14073001
140740     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14074001
140750             AND (SQLCODE = -904 OR -913)                         14075001
140760         MOVE '8200-AUDIT-TSHPTPO'                                14076001
140770                                  TO DP013-PARAGRAPH              14077001
140780         MOVE 'MAX RETRIES EXCEEDED ON COUNT FOR SHIPMENTS'       14078001
140790                                  TO DP013-MESSAGE-TEXT (1)       14079001
140800         MOVE SQLCA               TO DP013-SQLCA                  14080001
140810         MOVE 'TSHPTPO '          TO DP013-DB2-TABLE-NAME (1)     14081001
140820         SET DP013-DB2-ABEND                                      14082001
140830             DP013-XCTL-DISPLAY-RESTART                           14083001
140840                                  TO TRUE                         14084001
140850         PERFORM DP013-0000-PROCESS-ABEND                         14085001
140860     END-IF.                                                      14086001
140870                                                                  14087001
140880     MOVE PV-TRN-CDE              TO AUSHPO-TRN-CDE               14088001
140890     PERFORM                                                      14089001
140900         WITH TEST AFTER                                          14090001
140910         VARYING PV-RETRY-COUNTER                                 14091001
140920         FROM 1 BY 1                                              14092001
140930         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14093001
140940             OR (SQLCODE = +0))                                   14094001
140950                                                                  14095001
140960         EXEC SQL                                                 14096001
140970             INSERT  INTO TAUSHPO                                 14097001
140980                    (SHIPT_ID                                     14098001
140990                    ,PO_NBR                                       14099001
141000                    ,REC_SEQ_NBR                                  14100001
141010                    ,EXPTED_CART_CNT                              14101001
141020                    ,ACTL_CART_CNT                                14102001
141030                    ,DMG_CART_CNT                                 14103001
141040                    ,PKSL_IND                                     14104001
141050                    ,VEND_NAME                                    14105001
141060                    ,FRGT_CHG_AMT                                 14106001
141070                    ,LAST_UPD_PGM_ID                              14107001
141080                    ,CRE_USER_ID                                  14108001
141090                    ,CARR_CART_CT                                 14109001
141100                    ,CARR_LAST_UPD_DTE                            14110001
141110                    ,CARR_LAST_UPD_TIME                           14111001
141120                    ,VEND_CART_CT                                 14112001
141130                    ,VEND_LAST_UPD_DTE                            14113001
141140                    ,VEND_LAST_UPD_TIME                           14114001
141150                    ,CRE_TMST                                     14115001
141160                    ,LAST_UPD_DTE                                 14116001
141170                    ,LAST_UPD_TIME                                14117001
141180                    ,LAST_UPD_USER_ID                             14118001
141190                    ,PRIM_SHIPT_IND                               14119001
141200                    ,SPLT_XMIT_IND                                14120001
141210                    ,SPLT_XMIT_DTE                                14121001
141220                    ,SPLT_XMIT_TM                                 14122001
141230                    ,TRN_CDE )                                    14123001
141240            VALUES  (:SHPTPO-SHIPT-ID                             14124001
141250                    ,:SHPTPO-PO-NBR                               14125001
141260                    ,:SHPTPO-REC-SEQ-NBR                          14126001
141270                    ,:SHPTPO-EXPTED-CART-CNT                      14127001
141280                    ,:SHPTPO-ACTL-CART-CNT                        14128001
141290                    ,:SHPTPO-DMG-CART-CNT                         14129001
141300                    ,:SHPTPO-PKSL-IND                             14130001
141310                    ,:SHPTPO-VEND-NAME                            14131001
141320                    ,:SHPTPO-FRGT-CHG-AMT                         14132001
141330                    ,:SHPTPO-LAST-UPD-PGM-ID                      14133001
141340                    ,:SHPTPO-CRE-USER-ID                          14134001
141350                    ,:SHPTPO-CARR-CART-CT                         14135001
141360                    ,:SHPTPO-CARR-LAST-UPD-DTE                    14136001
141370                    ,:SHPTPO-CARR-LAST-UPD-TIME                   14137001
141380                    ,:SHPTPO-VEND-CART-CT                         14138001
141390                    ,:SHPTPO-VEND-LAST-UPD-DTE                    14139001
141400                    ,:SHPTPO-VEND-LAST-UPD-TIME                   14140001
141410                    ,:SHPTPO-CRE-TMST                             14141001
141420                    ,:SHPTPO-LAST-UPD-DTE                         14142001
141430                    ,:SHPTPO-LAST-UPD-TIME                        14143001
141440                    ,:SHPTPO-LAST-UPD-USER-ID                     14144001
141450                    ,:SHPTPO-PRIM-SHIPT-IND                       14145001
141460                    ,:SHPTPO-SPLT-XMIT-IND                        14146001
141470                    ,:SHPTPO-SPLT-XMIT-DTE                        14147001
141480                    ,:SHPTPO-SPLT-XMIT-TM                         14148001
141490                    ,:AUSHPO-TRN-CDE )                            14149001
141500         END-EXEC                                                 14150001
141510                                                                  14151001
141520         EVALUATE TRUE                                            14152001
141530             WHEN SQLCODE = +0                                    14153001
141540             WHEN SQLCODE = -904                                  14154001
141550             WHEN SQLCODE = -913                                  14155001
141560                 CONTINUE                                         14156001
141570                                                                  14157001
141580             WHEN SQLWARN0 NOT = SPACES                           14158001
141590             WHEN SQLCODE < +0                                    14159001
141600             WHEN SQLCODE > +0                                    14160001
141610                 MOVE '8200-AUDIT-TSHPTPO'                        14161001
141620                                   TO DP013-PARAGRAPH             14162001
141630                 MOVE 'INSERT A ROW ON TAUSHPO'                   14163001
141640                                   TO DP013-MESSAGE-TEXT(1)       14164001
141650                 MOVE SQLCA        TO DP013-SQLCA                 14165001
141660                 MOVE 'TAUSHPO'    TO DP013-DB2-TABLE-NAME (1)    14166001
141670                 SET DP013-DB2-ABEND                              14167001
141680                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14168001
141690                 PERFORM DP013-0000-PROCESS-ABEND                 14169001
141700         END-EVALUATE                                             14170001
141710     END-PERFORM.                                                 14171001
141720                                                                  14172001
141730     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14173001
141740             AND (SQLCODE = -904 OR -913)                         14174001
141750         MOVE '8200-AUDIT-TSHPTPO'                                14175001
141760                                   TO DP013-PARAGRAPH             14176001
141770         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              14177001
141780                                   TO DP013-MESSAGE-TEXT (1)      14178001
141790         MOVE 'TO INSERT A TAUSHPO ROW'                           14179001
141800                                   TO DP013-MESSAGE-TEXT (2)      14180001
141810         MOVE SQLCA                TO DP013-SQLCA                 14181001
141820         MOVE 'TAUSHPO'            TO DP013-DB2-TABLE-NAME (1)    14182001
141830         SET DP013-DB2-ABEND                                      14183001
141840             DP013-XCTL-DISPLAY-RESTART                           14184001
141850                                   TO TRUE                        14185001
141860         PERFORM DP013-0000-PROCESS-ABEND                         14186001
141870     END-IF.                                                      14187001
141880                                                                  14188001
141890/                                                                 14189001
141900*----------------------------------------------------------------*14190001
141910* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *14191001
141920*----------------------------------------------------------------*14192001
141930 9100-READ-SEL-QUEUE.                                             14193001
141940     EXEC CICS                                                    14194001
141950         READQ TS                                                 14195001
141960             QUEUE (ASC-SEL-QUEUE-NAME)                           14196001
141970             INTO  (RC013-DC-SELECT-RECORD)                       14197001
141980             ITEM  (ASC-SEL-ITEM)                                 14198001
141990             RESP  (PV-CICS-RESPONSE)                             14199001
142000     END-EXEC.                                                    14200001
142010                                                                  14201001
142020     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   14202001
142030         CONTINUE                                                 14203001
142040     ELSE                                                         14204001
142050         SET DP013-LOGIC-ABEND                                    14205001
142060             DP013-NO-ROLLBACK     TO TRUE                        14206001
142070         MOVE '9100-READ-SEL-QUEUE'                               14207001
142080                                   TO DP013-PARAGRAPH             14208001
142090         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   14209001
142100                                   TO DP013-MESSAGE-TEXT (1)      14210001
142110         PERFORM DP013-0000-PROCESS-ABEND                         14211001
142120     END-IF.                                                      14212001
142130                                                                  14213001
142140                                                                  14214001
142150*----------------------------------------------------------------*14215001
142160* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *14216001
142170*----------------------------------------------------------------*14217001
142180 9200-REWRITE-SEL-QUEUE.                                          14218001
142190     EXEC CICS                                                    14219001
142200          WRITEQ TS                                               14220001
142210              QUEUE  (ASC-SEL-QUEUE-NAME)                         14221001
142220              FROM   (RC013-DC-SELECT-RECORD)                     14222001
142230              ITEM   (ASC-SEL-ITEM)                               14223001
142240              RESP   (PV-CICS-RESPONSE)                           14224001
142250              REWRITE                                             14225001
142260     END-EXEC.                                                    14226001
142270                                                                  14227001
142280     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       14228001
142290         CONTINUE                                                 14229001
142300     ELSE                                                         14230001
142310         SET DP013-CICS-ABEND                                     14231001
142320             DP013-NO-ROLLBACK     TO TRUE                        14232001
142330         MOVE '9200-REWRITE-SEL-QUEUE'                            14233001
142340                                   TO DP013-PARAGRAPH             14234001
142350         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   14235001
142360                                   TO DP013-MESSAGE-TEXT (1)      14236001
142370         PERFORM DP013-0000-PROCESS-ABEND                         14237001
142380     END-IF.                                                      14238001
142390                                                                  14239001
142400/                                                                 14240001
142410******************************************************************14241001
142420 9900-WRITE-CICS-LOG.                                             14242001
142430                                                                  14243001
142440     MOVE LENGTH OF PV-CICS-MSG-AREA                              14244001
142450          TO PV-COMMAREA-LENGTH                                   14245001
142460                                                                  14246001
142470     EXEC CICS                                                    14247001
142480         WRITEQ TD                                                14248001
142490             QUEUE  ('CSSL')                                      14249001
142500             FROM   (PV-CICS-MSG-AREA)                            14250001
142510             LENGTH (PV-COMMAREA-LENGTH)                          14251001
142520             RESP   (PV-CICS-RESPONSE)                            14252001
142530     END-EXEC.                                                    14253001
142540                                                                  14254001
142550     MOVE SPACES TO PV-CICS-MSG-AREA.                             14255001
142560*                                                                 14256001
142570*----------------------------------------------------------------*14257001
142580*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *14258001
142590*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *14259001
142600*----------------------------------------------------------------*14260001
142610 9900A-SOFT-ABORT.                                                14261001
142620                                                                  14262001
142630     EXEC CICS SYNCPOINT                                          14263001
142640          ROLLBACK                                                14264001
142650     END-EXEC.                                                    14265001
142660                                                                  14266001
142670     SET  PS-ERROR                                                14267001
142680          PS-SOFT-ABORT-ERROR                                     14268001
142690          DP020-MSG-FATAL       TO  TRUE.                         14269001
142700                                                                  14270001
142710*----------------------------------------------------------------*14271001
142720 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  14272001
142730                                                                  14273001
142740     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           14274001
142750     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          14275001
142760     MOVE PV-DISPLAY-PARAGRAPH        TO DP013-PARAGRAPH.         14276011
142770     INITIALIZE DP013-SRC-TASK-NUMBER                             14277001
142780                DP013-STACK.                                      14278001
142790     SET DP013-LINK-RETURN            TO TRUE.                    14279001
142800                                                                  14280001
142810     EXEC CICS                                                    14281001
142820         LINK                                                     14282001
142830             PROGRAM   (DP013-NAME)                               14283001
142840             COMMAREA  (DP013-PARAMETERS)                         14284001
142850             LENGTH    (DP013-LENGTH)                             14285001
142860     END-EXEC.                                                    14286001
142870/                                                                 14287001
142880*----------------------------------------------------------------*14288001
142890*    ABEND PROCESSOR MODULE                                      *14289001
142900*----------------------------------------------------------------*14290001
142910                                                                  14291001
142920     COPY DPPD013.                                                14292001
142930                                                                  14293001
142940/                                                                 14294001
142950*----------------------------------------------------------------*14295001
142960*    CICS ARCHITECTURE DATE TIME MODULE                          *14296001
142970*----------------------------------------------------------------*14297001
142980                                                                  14298001
142990     COPY DPPD017.                                                14299001
143000                                                                  14300001
143010     MOVE DP017-CURRENT-YMD-YEAR    TO DP017-EDITED-MDY-YEAR.     14301001
143020/                                                                 14302001
