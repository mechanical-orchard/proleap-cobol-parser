000100******************************************************************        
000200 IDENTIFICATION DIVISION.                                                 
000300******************************************************************        
000400                                                                          
000500 PROGRAM-ID.    SUKUT177.                                                 
000600 AUTHOR.        DENISE HAHN                                               
000700 INSTALLATION.  KOHLS.                                                    
000800 DATE-WRITTEN   MAY, 2016.                                                
000900 DATE-COMPILED.                                                           
001000                                                                          
001100******************************************************************        
001200*  THIS PROGRAM READS THE EXTRACT FILE CONTAINING THE SHIPPED             
001300*  CARTONS FOR A GIVEN DATE RANGE.  CREATE BY SUKUT176                    
001301*                                                                         
001302*  FOR EACH TRIP - GET THE TRIP CONTENTS                                  
001303*      - SML#'S FROM SUT_OTBND_CART (OTBND_TRIP_ID)                       
001305*      - P2L CARTON - DETERMINE - OPEN/CLOSE TMST                         
001306*        TIMES CONVERTED TO CENTRAL TIME BASED ON PARM                    
001307*        TIMEZN - DIFFERENCE BETWEEN DC AND CENTRAL TIME                  
001308*      - CHECK WHEN THE CARTON WAS ATTACHED TO THE TRAILER                
001309*      - CHECK IF SCANNED ON OR DIVERTED TO THE TRAILER                   
001310*      - CHECK IF CARTON WAS PART OF A MASTER CONTAINER                   
001311*                                                                         
001312*  SUKUT178 WILL GET THE CARTON CONTENTS AND RECEIVER INFORMATION         
001313*                                                                         
001314*  SUKUT179 WILL CALCULATE THE TIMES BETWEEN EACH STATUS                  
001315*                                                                         
001316*  INPUT FILE IS IN SURD117 FORMAT                                        
001317*  OUTPUT FILE IS IN SURD117 FORMAT                                       
001318*                                                                         
001319*  INPUT FILE IS IN SURD117 FORMAT                                        
001320*  OUTPUT FILE IS IN SURD117 FORMAT                                       
001400******************************************************************        
001500                                                                          
001600******************************************************************        
001700 ENVIRONMENT DIVISION.                                                    
001800******************************************************************        
001900                                                                          
002000 CONFIGURATION SECTION.                                                   
002100                                                                          
002200 SOURCE-COMPUTER.        IBM-3090.                                        
002300 OBJECT-COMPUTER.        IBM-3090.                                        
002400                                                                          
002500 INPUT-OUTPUT SECTION.                                                    
002600                                                                          
002700 FILE-CONTROL.                                                            
002800                                                                          
003300     SELECT INPUT-FILE                                                    
003400            ASSIGN TO INP01.                                              
003401                                                                          
003402     SELECT OUTPUT-FILE                                                   
003403            ASSIGN TO OUT01.                                              
003410                                                                          
003500******************************************************************        
003600 DATA DIVISION.                                                           
003700******************************************************************        
003800                                                                          
003900 FILE SECTION.                                                            
003910                                                                          
004000 FD  INPUT-FILE                                                           
004100     RECORDING MODE IS F                                                  
004200     LABEL RECORDS ARE STANDARD                                           
004400     BLOCK CONTAINS 0 RECORDS.                                            
004600 01  INPUT-RECORD               PIC X(550).                               
004700                                                                          
004800 FD  OUTPUT-FILE                                                          
004900     RECORDING MODE IS F                                                  
005000     LABEL RECORDS ARE STANDARD                                           
005100     BLOCK CONTAINS 0 RECORDS.                                            
005300 01  OUTPUT-RECORD              PIC X(550).                               
005470                                                                          
005500                                                                          
005600******************************************************************        
005700 WORKING-STORAGE SECTION.                                                 
005800******************************************************************        
005801                                                                          
005810 01  DK-FIELDS.                                                           
005820     05  DK-OTBND-TRIP-ID                  PIC S9(09)  COMP.              
005821     05  DK-SHIPT-UNT-ID                   PIC S9(18)V COMP-3.            
005822     05  DK-OPER-UNT-ID                    PIC S9(04)  COMP.              
005823     05  DK-DEST-OPER-UNT-ID               PIC S9(04)  COMP.              
005830                                                                          
005840 01  PROGRAM-VARIABLES.                                                   
005841     05  PV-PARAGRAPH-NAME                  PIC  X(40).                   
005842     05  PV-DB2-OPERATION-ATTEMPTED         PIC  X(40).                   
005843*                                                                         
005844     05  PV-MESSAGE-1                       PIC  X(100).                  
005845     05  PV-MESSAGE-2                       PIC  X(100).                  
005846     05  PV-SQLCODE                         PIC  -999.                    
005847*                                                                         
005848     05  PV-WORK-TIMESTAMP.                                               
005849         10  PV-WORK-TMST-DATE              PIC X(10).                    
005850         10  PV-WORK-TMST-TIME              PIC X(16).                    
005853*                                                                         
005857     05  PV-OTBND-CART-CRE-TMST             PIC X(26).                    
005858     05  PV-OTBND-CART-CRE-TMST-R REDEFINES                               
005859                                  PV-OTBND-CART-CRE-TMST.                 
005860         10  PV-OTBND-CART-CRE-DATE         PIC  X(10).                   
005861         10  PV-OTBND-CART-DASH-1           PIC  X(01).                   
005862         10  PV-OTBND-CART-CRE-TIME         PIC  X(08).                   
005863         10  PV-OTBND-CART-CRE-MS           PIC  X(07).                   
005864                                                                          
005865     05  PV-P2L-CREATE-TIMESTAMP            PIC  X(26).                   
005866                                                                          
005867     05  PV-P2L-OPEN-TMST                   PIC  X(26).                   
005868     05  PV-P2L-OPEN-TMST-R       REDEFINES                               
005869                                  PV-P2L-OPEN-TMST.                       
005870         10  PV-P2L-OPEN-DATE               PIC  X(10).                   
005871         10  FILLER                         PIC  X(01).                   
005872         10  PV-P2L-OPEN-TIME               PIC  X(08).                   
005873         10  FILLER                         PIC  X(07).                   
005874                                                                          
005875     05  PV-P2L-CLOSE-TMST                  PIC  X(26).                   
005876     05  PV-P2L-CLOSE-TMST-R      REDEFINES                               
005877                                  PV-P2L-CLOSE-TMST.                      
005878         10  PV-P2L-CLOSE-DATE              PIC  X(10).                   
005879         10  FILLER                         PIC  X(01).                   
005880         10  PV-P2L-CLOSE-TIME              PIC  X(08).                   
005881         10  FILLER                         PIC  X(07).                   
005882                                                                          
005883     05  PV-SML-DIVERT-TMST                 PIC  X(26).                   
005884     05  PV-SML-DIVERT-TMST-R     REDEFINES PV-SML-DIVERT-TMST.           
005885         10  PV-SML-DIVERT-DATE             PIC  X(10).                   
005886         10  FILLER                         PIC  X(01).                   
005887         10  PV-SML-DIVERT-TIME             PIC  X(08).                   
005888         10  FILLER                         PIC  X(07).                   
005889                                                                          
005890     05  PV-SML-SCANON-TMST                 PIC  X(26).                   
005891     05  PV-SML-SCANON-TMST-R     REDEFINES PV-SML-SCANON-TMST.           
005892         10  PV-SML-SCANON-DATE             PIC  X(10).                   
005893         10  FILLER                         PIC  X(01).                   
005894         10  PV-SML-SCANON-TIME             PIC  X(08).                   
005900         10  FILLER                         PIC  X(07).                   
005910                                                                          
005920     05  PV-MST-CREATE-TMST                 PIC  X(26).                   
005930     05  PV-MST-CREATE-TMST-R     REDEFINES PV-MST-CREATE-TMST.           
005940         10  PV-MST-CREATE-DATE             PIC  X(10).                   
005950         10  FILLER                         PIC  X(01).                   
005960         10  PV-MST-CREATE-TIME             PIC  X(08).                   
005970         10  FILLER                         PIC  X(07).                   
005980                                                                          
005990     05  PV-MST-CHILD-TMST                  PIC  X(26).                   
005991     05  PV-MST-CHILD-TMST-R      REDEFINES PV-MST-CHILD-TMST.            
005992         10  PV-MST-CHILD-DATE              PIC  X(10).                   
005993         10  FILLER                         PIC  X(01).                   
005994         10  PV-MST-CHILD-TIME              PIC  X(08).                   
005995         10  FILLER                         PIC  X(07).                   
005999                                                                          
006000     05  PV-MST-FIRST-TMST                  PIC  X(26).                   
006001     05  PV-MST-FIRST-TMST-R      REDEFINES PV-MST-FIRST-TMST.            
006002         10  PV-MST-FIRST-DATE              PIC  X(10).                   
006003         10  FILLER                         PIC  X(01).                   
006004         10  PV-MST-FIRST-TIME              PIC  X(08).                   
006005         10  FILLER                         PIC  X(07).                   
006006                                                                          
006007     05  PV-MST-LAST-TMST                   PIC  X(26).                   
006008     05  PV-MST-LAST-TMST-R       REDEFINES PV-MST-LAST-TMST.             
006009         10  PV-MST-LAST-DATE               PIC  X(10).                   
006010         10  FILLER                         PIC  X(01).                   
006011         10  PV-MST-LAST-TIME               PIC  X(08).                   
006012         10  FILLER                         PIC  X(07).                   
006013                                                                          
006014     05  PV-PROCESSED-TMST                  PIC  X(26).                   
006015     05  PV-PROCESSED-TMST-R      REDEFINES PV-PROCESSED-TMST.            
006016         10  PV-PROCESSED-DATE              PIC  X(10).                   
006017         10  FILLER                         PIC  X(01).                   
006018         10  PV-PROCESSED-TIME              PIC  X(08).                   
006019         10  FILLER                         PIC  X(07).                   
006020                                                                          
006036*                                                                         
006037     05  PV-DISP-OPER                       PIC  Z(04).                   
006038     05  PV-DISP-DEST-OPER                  PIC  Z(04).                   
006039     05  PV-DISP-STORE                      PIC  Z(04).                   
006040     05  PV-DISP-TRIP-ID                    PIC  Z(09).                   
006041     05  PV-DISP-SHIPT-UNT-ID               PIC  9(18).                   
006042     05  PV-DISP-MSTR                       PIC  9(18).                   
006043*                                                                         
006044     05  PV-DISPLAY-COUNT                   PIC  ZZZ,ZZZ,ZZZ.             
006045     05  PV-FETCH-COUNT                     PIC  9(09).                   
006046     05  PV-TRIP-CRTN-CNT                   PIC  9(09).                   
006047     05  PV-INPUT-COUNTER                   PIC  9(09).                   
006048     05  PV-WRITE-COUNTER                   PIC  9(09).                   
006049     05  PV-FETCH-COUNT-DISP                PIC  9(09).                   
006050     05  PV-MST-SHIPT-UNT-ID                PIC S9(18)V COMP-3.           
006051                                                                          
006052 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
006053                                                   COMP SYNC.             
006054 01  PROGRAM-SWITCHES.                                                    
006055     05  PS-EOF-INPUT-SW                    PIC X(01) VALUE 'N'.          
006056         88  PS-EOF-INPUT                             VALUE 'Y'.          
006057         88  PS-EOF-INPUT-NO                          VALUE 'N'.          
006058     05  PS-EOF-TRIP-CRTN-SW                PIC X(01) VALUE 'N'.          
006059         88  PS-EOF-TRIP-CRTN                         VALUE 'Y'.          
006060         88  PS-EOF-TRIP-CRTN-NO                      VALUE 'N'.          
006061     05  PS-EOF-CRTN-CONTENTS-SW            PIC X(01) VALUE 'N'.          
006062         88  PS-EOF-CRTN-CONTENTS                     VALUE 'Y'.          
006063         88  PS-EOF-CRTN-CONTENTS-NO                  VALUE 'N'.          
006064     05  PS-TRIP-DIVERT-SW                  PIC X(01) VALUE 'T'.          
006065         88  PS-TRIP-CURSOR                           VALUE 'T'.          
006066         88  PS-DIVERT-CURSOR                         VALUE 'D'.          
006067                                                                          
006068******************************************************************        
006069* INPUT & OUTPUT RECORD LAYOUT                                            
006070******************************************************************        
006071     COPY SURD117.                                                        
006072*                                                                         
006073* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006074* SUT_OTBND_CART - OUTBOUND CARTON                                        
006075* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006076     EXEC SQL                                                             
006077          INCLUDE SUT00024                                                
006078     END-EXEC.                                                            
006079                                                                          
006080* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006081* SUT_OTBND_UPC - OUTBOUND CARTON UPC                                     
006082* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006083     EXEC SQL                                                             
006084          INCLUDE SUT00028                                                
006085     END-EXEC.                                                            
006086                                                                          
006091* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006092* SUT_OTBND_LOC - OUTBOUND LOCATION                                       
006093* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006094     EXEC SQL                                                             
006095          INCLUDE SUT00027                                                
006096     END-EXEC.                                                            
006097                                                                          
006098* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006099* TKRPRPM - PARM TABLE                                                    
006100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006101     EXEC SQL                                                             
006102          INCLUDE TKRPRPM                                                 
006103     END-EXEC.                                                            
006110                                                                          
006200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006201* TSUCRDV - CONVEYOR DIVERT                                               
006202* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006203     EXEC SQL                                                             
006204          INCLUDE TSUCRDV                                                 
006205     END-EXEC.                                                            
006206                                                                          
006207* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006208* TSUCDOT - CONVEYOR CUTOFF                                               
006209* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006210     EXEC SQL                                                             
006211          INCLUDE TSUCDOT                                                 
006212     END-EXEC.                                                            
006213                                                                          
006214* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006215* SUT_MSTR_SHIPT_UNT - MASTER CONTAINER                                   
006216* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006217     EXEC SQL                                                             
006218          INCLUDE SUT00098                                                
006219     END-EXEC.                                                            
006220                                                                          
006221* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006222* SUT_MSTR_SHIPT_CNT - CHILD CONTAINER IN MASTER                          
006223* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006224     EXEC SQL                                                             
006225          INCLUDE SUT00099                                                
006226     END-EXEC.                                                            
006227                                                                          
006270* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006271*                                                                         
006272* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006273     EXEC SQL                                                             
006274          INCLUDE SQLCA                                                   
006275     END-EXEC.                                                            
006276                                                                          
006277                                                                          
006278* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006279*                                                                         
006280* OUTBOUND TRIP - MANIFESTED CARTON CURSOR - FROM OUTBOUND CART           
006281*                                                                         
006282* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006290     EXEC SQL                                                             
006291         DECLARE DC-TRIP-CRTN-CSR CURSOR FOR                              
006292          SELECT SHIPT_UNT_ID                                             
006293               , CART_SRC_CDE                                             
006294               , CRE_DTE                                                  
006295               , CRE_TM                                                   
006296               , ORIG_CART_ID                                             
006298            FROM SUT_OTBND_CART                                           
006299           WHERE OTBND_TRIP_ID = :DK-OTBND-TRIP-ID                        
006300             AND NOT CART_SRC_CDE  =  'FXR'                               
006310           ORDER BY CART_SRC_CDE                                          
006320                  , CRE_DTE                                               
006330                  , CRE_TM                                                
006340                  , SHIPT_UNT_ID                                          
006360         WITH UR                                                          
006395     END-EXEC.                                                            
006396                                                                          
006400                                                                          
006500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
006600*                                                                         
006700* OUTBOUND TRIP - MANIFESTED CARTON CURSOR - FROM DIVERT/SHON             
006800*                                                                         
006900* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
007000     EXEC SQL                                                             
007001         DECLARE TRIP-CRTN-DIVERT-CSR CURSOR FOR                          
007010          SELECT A.SHIPT_UNT_ID                                           
007011               , A.CART_SRC_CDE                                           
007012               , A.CRE_DTE                                                
007013               , A.CRE_TM                                                 
007014               , A.ORIG_CART_ID                                           
007015            FROM SUT_OTBND_CART A                                         
007016               , TSUCDOT B                                                
007017               , TSUCRDV C                                                
007018           WHERE B.OTBND_TRIP_ID     = :DK-OTBND-TRIP-ID                  
007019             AND B.OPER_UNT_ID       =  C.OPER_UNT_ID                     
007020             AND B.DOOR_ID           =  C.DOOR_ID                         
007021             AND B.STRT_DIVERT_TMST <=  C.DIVERT_TMST                     
007030             AND B.END_DIVERT_TMST  >=  C.DIVERT_TMST                     
007040             AND C.ACTV_CDE          = 'A'                                
007050             AND C.DIVERT_TMST  IN                                        
007060                 (SELECT MAX(D.DIVERT_TMST)                               
007070                    FROM TSUCRDV D                                        
007080                   WHERE C.SHIPT_UNT_ID  =  D.SHIPT_UNT_ID)               
007090             AND C.SHIPT_UNT_ID      =  A.SHIPT_UNT_ID                    
007091             AND A.ACTV_IND          = 'Y'                                
007092             AND A.DEST_LOC_NBR      =  :DK-DEST-OPER-UNT-ID              
007093             AND NOT A.CART_SRC_CDE  =  'FXR'                             
007094           UNION                                                          
007095          SELECT F.SHIPT_UNT_ID                                           
007096               , F.CART_SRC_CDE                                           
007097               , F.CRE_DTE                                                
007098               , F.CRE_TM                                                 
007099               , F.ORIG_CART_ID                                           
007100            FROM SUT_OTBND_LOC E                                          
007101               , SUT_OTBND_CART F                                         
007102           WHERE E.OTBND_TRIP_ID     =  :DK-OTBND-TRIP-ID                 
007103             AND E.SCN_CDE           = 'SHON'                             
007104             AND E.ACTV_CDE          = 'A'                                
007105             AND E.SHIPT_UNT_ID      =  F.SHIPT_UNT_ID                    
007106             AND F.ACTV_IND          = 'Y'                                
007107             AND F.DEST_LOC_NBR      =  :DK-DEST-OPER-UNT-ID              
007108             AND NOT F.CART_SRC_CDE  =  'FXR'                             
007109           ORDER BY 2,3,4,1                                               
007293         WITH UR                                                          
007294     END-EXEC.                                                            
007295                                                                          
007296                                                                          
007300*-----------------------------------------------------------------        
007500*  DB2 FORMATTED MESSAGE AREA                                             
007510*-----------------------------------------------------------------        
007700     COPY DPWS004.                                                        
007800                                                                          
018300                                                                          
018400                                                                          
018600 PROCEDURE DIVISION.                                                      
018801                                                                          
018810*-----------------------------------------------------------------        
018820*                                                                         
018840*-----------------------------------------------------------------        
018900 0000-PROGRAM-MAINLINE.                                                   
019400                                                                          
019500     PERFORM 1000-INITIALIZE.                                             
019510                                                                          
019520     DISPLAY '********************************************'.              
019530     DISPLAY '*                                          *'.              
019540     DISPLAY '*                                          *'.              
019600     IF  PS-EOF-INPUT-NO                                                  
019700         PERFORM 2000-PROCESS-FILE                                        
019800           UNTIL PS-EOF-INPUT                                             
019900     END-IF.                                                              
019910                                                                          
020000     PERFORM 9000-EOJ-ROUTINE.                                            
020113                                                                          
020120     DISPLAY '*                                          *'.              
020130     DISPLAY '*                                          *'.              
020131     DISPLAY '********************************************'.              
020140                                                                          
020200     STOP RUN.                                                            
020300                                                                          
020310                                                                          
020320*-----------------------------------------------------------------        
020330*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                            
020340*    -- OPEN INPUT FILE                                                   
020341*    -- OPEN OUTPUT FILE                                                  
020350*    -- INITIAL READ OF INPUT                                             
020361*    -- IF EMPTY FILE  - JOB FINISHES - NOTHING TO REPORT                 
020370*-----------------------------------------------------------------        
020400 1000-INITIALIZE.                                                         
021100                                                                          
021500     OPEN INPUT  INPUT-FILE                                               
021510          OUTPUT OUTPUT-FILE.                                             
021600                                                                          
021700     PERFORM 8000-READ-INPUT-REC.                                         
021710                                                                          
022001     IF  PS-EOF-INPUT                                                     
022002         MOVE 4095  TO  ABEND-CODE                                        
022003     END-IF.                                                              
022004                                                                          
022010                                                                          
025449*-----------------------------------------------------------------        
025450*  LOOP THROUGH THE RESULTS TABLE.                                        
025451*  FORMAT THE OUTPUT RECORD.  WRITE THE RECORDS THAT MEET CRITERIA.       
025452*-----------------------------------------------------------------        
025460 2000-PROCESS-FILE.                                                       
026000                                                                          
026001     MOVE  SU117-TRIP-ID     TO  DK-OTBND-TRIP-ID.                        
026002     MOVE  SU117-STORE-DEST  TO  DK-DEST-OPER-UNT-ID.                     
026003                                                                          
026004     SET  PS-TRIP-CURSOR   TO  TRUE                                       
026006     PERFORM 7000-OPEN-TRIP-CRTN-CURSOR.                                  
026007     PERFORM 7005-FETCH-TRIP-CRTN-CURSOR.                                 
026008                                                                          
026009     PERFORM 3000-PROCESS-TRIP-CRTN-CSR                                   
026010       UNTIL PS-EOF-TRIP-CRTN.                                            
026020                                                                          
026200     PERFORM 7010-CLOSE-TRIP-CRTN-CURSOR.                                 
026201                                                                          
026202     IF  PV-TRIP-CRTN-CNT  >  0                                           
026203         MOVE ZEROES  TO  PV-TRIP-CRTN-CNT                                
026204                          PV-FETCH-COUNT-DISP                             
026205         CONTINUE                                                         
026206     ELSE                                                                 
026207         SET  PS-EOF-TRIP-CRTN-NO  TO  TRUE                               
026208         SET  PS-DIVERT-CURSOR     TO  TRUE                               
026209         PERFORM 7020-OPEN-TRIP-CRTN-CURSOR                               
026210         PERFORM 7025-FETCH-TRIP-CRTN-CURSOR                              
026211                                                                          
026212         PERFORM 3000-PROCESS-TRIP-CRTN-CSR                               
026213           UNTIL PS-EOF-TRIP-CRTN                                         
026214                                                                          
026215         PERFORM 7030-CLOSE-TRIP-CRTN-CURSOR                              
026216     END-IF.                                                              
026217                                                                          
026218     MOVE  DK-OTBND-TRIP-ID        TO  PV-DISP-TRIP-ID.                   
026219     DISPLAY 'TRIP:'                   PV-DISP-TRIP-ID                    
026220             '  TOTAL CARTON COUNT: '  PV-TRIP-CRTN-CNT.                  
026221                                                                          
026222     MOVE  ZEROES  TO  PV-TRIP-CRTN-CNT.                                  
026223                                                                          
026224     SET  PS-EOF-TRIP-CRTN-NO  TO  TRUE.                                  
026230     PERFORM 8000-READ-INPUT-REC.                                         
026300                                                                          
026310                                                                          
026311*-----------------------------------------------------------------        
026312*  TRIP CARTON                                                            
026313*-----------------------------------------------------------------        
026314 3000-PROCESS-TRIP-CRTN-CSR.                                              
026315***  05  PV-OTBND-CART-CRE-TMST.                                          
026316     MOVE SUT00024-CRE-DTE         TO  PV-OTBND-CART-CRE-DATE             
026317     MOVE '-'                      TO  PV-OTBND-CART-DASH-1               
026318     MOVE SUT00024-CRE-TM          TO  PV-OTBND-CART-CRE-TIME             
026319     MOVE '.000000'                TO  PV-OTBND-CART-CRE-MS               
026320                                                                          
026321     MOVE SUT00024-SHIPT-UNT-ID    TO  DK-SHIPT-UNT-ID.                   
026322                                                                          
026323     MOVE SUT00024-SHIPT-UNT-ID    TO  SU117-SML-NBR.                     
026324     MOVE SUT00024-CART-SRC-CDE    TO  SU117-SML-SRC-CDE.                 
026325     MOVE SUT00024-CRE-DTE         TO  SU117-SML-CRE-DTE.                 
026326     MOVE SUT00024-CRE-TM          TO  SU117-SML-CRE-TM.                  
026328                                                                          
026329     IF  SUT00024-CART-SRC-CDE = 'P2L'  OR                                
026330         SUT00024-CART-SRC-CDE = 'JWL'                                    
026331         PERFORM 4000-GET-P2L-JWL-INFO                                    
026332     ELSE                                                                 
026333         MOVE  SPACES  TO  SU117-SML-P2L-OPEN-DTE                         
026334                           SU117-SML-P2L-OPEN-TM                          
026335                           SU117-SML-P2L-CLOSE-DTE                        
026336                           SU117-SML-P2L-CLOSE-TM                         
026338     END-IF.                                                              
026339                                                                          
026340     PERFORM 4010-WHEN-CARTON-ATTACHED.                                   
026341                                                                          
026342     PERFORM 4025-CHECK-IF-PART-MASTER.                                   
026343                                                                          
026344     PERFORM 4100-CHECK-CARTON-PROCESSED.                                 
026345                                                                          
026346     PERFORM 8100-WRITE-OUTPUT-RECORD.                                    
026347                                                                          
026348                                                                          
026349                                                                          
026350                                                                          
026351     IF  PS-TRIP-CURSOR                                                   
026354         PERFORM 7005-FETCH-TRIP-CRTN-CURSOR                              
026355     ELSE                                                                 
026356         PERFORM 7025-FETCH-TRIP-CRTN-CURSOR                              
026357     END-IF.                                                              
026358                                                                          
026435                                                                          
026501*-----------------------------------------------------------------        
026502*  CARTON CREATED IN PACK-TO-LIGHT/JEWELRY.                               
026503*  GET P2L/JWL INFORMATION.                                               
026504*-----------------------------------------------------------------        
026510 4000-GET-P2L-JWL-INFO.                                                   
026511                                                                          
026580     MOVE SUT00024-SHIPT-UNT-ID    TO  DK-SHIPT-UNT-ID.                   
026581     MOVE SU117-OPER-UNT-ID        TO  DK-OPER-UNT-ID.                    
026590                                                                          
026596     PERFORM 4003-GET-P2L-SML-OPEN-TMST.                                  
026597     PERFORM 4005-GET-P2L-OPEN-CLOSE-TMST.                                
026598     PERFORM 4007-GET-P2L-CLOSE-TMST.                                     
026599                                                                          
026600     IF  PV-P2L-OPEN-TMST  > SPACES  AND                                  
026601         PV-P2L-OPEN-TMST  <  PV-P2L-CREATE-TIMESTAMP                     
026602         MOVE  PV-P2L-OPEN-TMST        TO PV-OTBND-CART-CRE-TMST          
026603         MOVE  PV-P2L-OPEN-TMST        TO PV-P2L-CREATE-TIMESTAMP         
026604         MOVE  PV-OTBND-CART-CRE-DATE  TO SU117-SML-CRE-DTE               
026605         MOVE  PV-OTBND-CART-CRE-TIME  TO SU117-SML-CRE-TM                
026606     ELSE                                                                 
026607         MOVE  PV-P2L-CREATE-TIMESTAMP TO PV-OTBND-CART-CRE-TMST          
026608         MOVE  PV-P2L-CREATE-TIMESTAMP TO PV-P2L-OPEN-TMST                
026609         MOVE  PV-OTBND-CART-CRE-DATE  TO SU117-SML-CRE-DTE               
026610         MOVE  PV-OTBND-CART-CRE-TIME  TO SU117-SML-CRE-TM                
026611     END-IF.                                                              
026612                                                                          
026613*    PV-P2L-CREATE-TIMESTAMP                                              
026614                                                                          
026615*    PV-P2L-OPEN-TMST                                                     
026616     MOVE  PV-P2L-OPEN-DATE        TO SU117-SML-P2L-OPEN-DTE.             
026617     MOVE  PV-P2L-OPEN-TIME        TO SU117-SML-P2L-OPEN-TM.              
026618                                                                          
026619*    PV-P2L-CLOSE-TMST                                                    
026620     MOVE  PV-P2L-CLOSE-DATE       TO SU117-SML-P2L-CLOSE-DTE.            
026621     MOVE  PV-P2L-CLOSE-TIME       TO SU117-SML-P2L-CLOSE-TM.             
026622                                                                          
026623                                                                          
026624*-----------------------------------------------------------------        
026625*  GET THE P2L/JWL CARTON OPEN TIMESTAMPS.                                
026626*-----------------------------------------------------------------        
026627 4003-GET-P2L-SML-OPEN-TMST.                                              
026628                                                                          
026630     EXEC SQL                                                             
026640         SELECT                                                           
026650                TIMESTAMP(:PV-OTBND-CART-CRE-TMST)                        
026651                            - D.FUNC_QTY HOURS                            
026697           INTO                                                           
026698                :PV-P2L-CREATE-TIMESTAMP                                  
026701           FROM                                                           
026704                 TKRPRPM D                                                
026719          WHERE D.LOC_ID                = :DK-OPER-UNT-ID                 
026720            AND D.INTFC_SYS_CDE         = 'KHL'                           
026721            AND D.SYS_PRC_FUNC_CDE      = 'TIMEZN'                        
026722            AND D.FUNC_PRC_STAT_CDE     = 'AC'                            
026762          WITH UR                                                         
026763                                                                          
026764     END-EXEC.                                                            
026765                                                                          
026766     EVALUATE TRUE                                                        
026767         WHEN SQLCODE = ZERO                                              
026768              CONTINUE                                                    
026769                                                                          
026775         WHEN SQLWARN0 NOT = SPACES                                       
026776         WHEN SQLCODE < ZERO                                              
026777         WHEN SQLCODE > ZERO                                              
026778              MOVE SQLCODE              TO PV-SQLCODE                     
026779              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
026780              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER                   
026781              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
026782*                                                                         
026783              STRING '4003-'                                              
026784                     ' SQL:'   PV-SQLCODE                                 
026785                     ' TRIP:'  PV-DISP-TRIP-ID                            
026786                     ' OPER:'  PV-DISP-OPER                               
026787                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
026788                     ' TMST:'  PV-OTBND-CART-CRE-TMST                     
026789                               DELIMITED BY SIZE                          
026790                          INTO PV-MESSAGE-1                               
026791                                                                          
026792             DISPLAY PV-MESSAGE-1                                         
026793                                                                          
026794             MOVE '4003-GET-P2L-SML-OPEN-TMST     '                       
026795                                 TO PV-PARAGRAPH-NAME                     
026796             MOVE 'GET P2L/JWL SML OPEN DATE      '                       
026797                                 TO PV-DB2-OPERATION-ATTEMPTED            
026798             PERFORM 9100-SQL-ABEND                                       
026799     END-EVALUATE.                                                        
026800                                                                          
026801                                                                          
026802*-----------------------------------------------------------------        
026803*  GET THE P2L/JWL CARTON OPEN TIMESTAMPS.                                
026804*-----------------------------------------------------------------        
026805 4005-GET-P2L-OPEN-CLOSE-TMST.                                            
026806                                                                          
026807     EXEC SQL                                                             
026808         SELECT                                                           
026811                A.CRE_TMST                                                
026812           INTO                                                           
026814                :PV-P2L-OPEN-TMST                                         
026815           FROM                                                           
026816                 SUT_OTBND_LOC A                                          
026817              ,  TKRPRPM D                                                
026818          WHERE A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                        
026819            AND A.SCN_CDE       = 'LTP'                                   
026820            AND A.CRE_USR_ID    = 'PCKUT074'                              
026822            AND D.LOC_ID                = :DK-OPER-UNT-ID                 
026823            AND D.INTFC_SYS_CDE         = 'KHL'                           
026824            AND D.SYS_PRC_FUNC_CDE      = 'TIMEZN'                        
026825            AND D.FUNC_PRC_STAT_CDE     = 'AC'                            
026826          WITH UR                                                         
026827                                                                          
026828     END-EXEC.                                                            
026829                                                                          
026830     EVALUATE TRUE                                                        
026831         WHEN SQLCODE = ZERO                                              
026832              CONTINUE                                                    
026833                                                                          
026834         WHEN SQLCODE = +100                                              
026835         WHEN SQLCODE = -305                                              
026836              MOVE SPACES  TO  PV-P2L-OPEN-TMST                           
026837                                                                          
026838         WHEN SQLWARN0 NOT = SPACES                                       
026839         WHEN SQLCODE < ZERO                                              
026840         WHEN SQLCODE > ZERO                                              
026841              MOVE SQLCODE              TO PV-SQLCODE                     
026842              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
026843              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER                   
026844              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
026845*                                                                         
026846              STRING '4005-'                                              
026847                     ' SQL:'   PV-SQLCODE                                 
026848                     ' TRIP:'  PV-DISP-TRIP-ID                            
026849                     ' OPER:'  PV-DISP-OPER                               
026850                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
026851                     ' TMST:'  PV-OTBND-CART-CRE-TMST                     
026852                               DELIMITED BY SIZE                          
026853                          INTO PV-MESSAGE-1                               
026854                                                                          
026855             DISPLAY PV-MESSAGE-1                                         
026856                                                                          
026857             MOVE '4005-GET-P2L-OPEN-TMST         '                       
026858                                 TO PV-PARAGRAPH-NAME                     
026859             MOVE 'GET P2L/JWL OPEN DATE          '                       
026860                                 TO PV-DB2-OPERATION-ATTEMPTED            
026861             PERFORM 9100-SQL-ABEND                                       
026862     END-EVALUATE.                                                        
026863                                                                          
026864                                                                          
026865*-----------------------------------------------------------------        
026866*  GET THE P2L/JWL CARTON CLOSE TIMESTAMPS.                               
026867*-----------------------------------------------------------------        
026868 4007-GET-P2L-CLOSE-TMST.                                                 
026869                                                                          
026870     EXEC SQL                                                             
026871         SELECT                                                           
026872                B.CRE_TMST - E.FUNC_QTY HOURS                             
026873           INTO                                                           
026874                :PV-P2L-CLOSE-TMST                                        
026875           FROM                                                           
026876                 SUT_OTBND_LOC B                                          
026877              ,  TKRPRPM E                                                
026878          WHERE B.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                        
026879            AND B.SCN_CDE       = 'LTP'                                   
026880            AND B.CRE_USR_ID    = 'PCKCS723'                              
026881            AND B.CRE_TMST  IN                                            
026882                (SELECT MAX(C.CRE_TMST)                                   
026883                   FROM SUT_OTBND_LOC C                                   
026884                  WHERE B.SHIPT_UNT_ID  =  C.SHIPT_UNT_ID                 
026885                    AND C.SCN_CDE       = 'LTP'                           
026886                    AND C.CRE_USR_ID    = 'PCKCS723')                     
026887            AND E.LOC_ID                = :DK-OPER-UNT-ID                 
026888            AND E.INTFC_SYS_CDE         = 'KHL'                           
026889            AND E.SYS_PRC_FUNC_CDE      = 'TIMEZN'                        
026890            AND E.FUNC_PRC_STAT_CDE     = 'AC'                            
026891          WITH UR                                                         
026892                                                                          
026893     END-EXEC.                                                            
026894                                                                          
026895     EVALUATE TRUE                                                        
026896         WHEN SQLCODE = ZERO                                              
026897              CONTINUE                                                    
026898                                                                          
026899         WHEN SQLCODE = -305                                              
026900         WHEN SQLCODE = +100                                              
026901              MOVE SPACES  TO  PV-P2L-CLOSE-TMST                          
026902                                                                          
026903         WHEN SQLWARN0 NOT = SPACES                                       
026904         WHEN SQLCODE < ZERO                                              
026905         WHEN SQLCODE > ZERO                                              
026906              MOVE SQLCODE              TO PV-SQLCODE                     
026907              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
026908              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER                   
026909              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
026910*                                                                         
026911              STRING '4007-'                                              
026912                     ' SQL:'   PV-SQLCODE                                 
026913                     ' TRIP:'  PV-DISP-TRIP-ID                            
026914                     ' OPER:'  PV-DISP-OPER                               
026915                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
026916                     ' TMST:'  PV-OTBND-CART-CRE-TMST                     
026917                               DELIMITED BY SIZE                          
026918                          INTO PV-MESSAGE-1                               
026919                                                                          
026920             DISPLAY PV-MESSAGE-1                                         
026921                                                                          
026922             MOVE '4007-GET-P2L-CLOSE-TMST        '                       
026923                                 TO PV-PARAGRAPH-NAME                     
026924             MOVE 'GET P2L/JWL CLOSE DATES        '                       
026925                                 TO PV-DB2-OPERATION-ATTEMPTED            
026926             PERFORM 9100-SQL-ABEND                                       
026927     END-EVALUATE.                                                        
026928                                                                          
026929                                                                          
026930*-----------------------------------------------------------------        
026931*  WHEN WAS CARTON ATTACHED TO THE TRAILER?                               
026932*-----------------------------------------------------------------        
026933 4010-WHEN-CARTON-ATTACHED.                                               
026934     PERFORM 4015-CHECK-LAST-DIVERT.                                      
026935     PERFORM 4020-CHECK-SCANON.                                           
026936                                                                          
026937     IF  PV-SML-DIVERT-TMST = SPACES  AND                                 
026938         PV-SML-SCANON-TMST = SPACES                                      
026939         PERFORM 4017-CHECK-LAST-DIVERT-INACT                             
026940         PERFORM 4022-CHECK-SCANON-INACTIVE                               
026941     END-IF.                                                              
026942                                                                          
026943     IF  PV-SML-DIVERT-TMST  >  PV-SML-SCANON-TMST                        
026944         SET SU117-SML-ON-OTBND-DVRT  TO  TRUE                            
026945         MOVE  PV-SML-DIVERT-DATE     TO  SU117-SML-ON-OTBND-DTE          
026946         MOVE  PV-SML-DIVERT-TIME     TO  SU117-SML-ON-OTBND-TM           
026947     ELSE                                                                 
026948         SET SU117-SML-ON-OTBND-SCAN  TO  TRUE                            
026949         MOVE  PV-SML-SCANON-DATE     TO  SU117-SML-ON-OTBND-DTE          
026950         MOVE  PV-SML-SCANON-TIME     TO  SU117-SML-ON-OTBND-TM           
026951     END-IF.                                                              
026952                                                                          
026953                                                                          
026954*-----------------------------------------------------------------        
026955* WHEN IS THE LAST DIVERT FOR THE CARTON                                  
026956*-----------------------------------------------------------------        
026957 4015-CHECK-LAST-DIVERT.                                                  
026958                                                                          
026959     MOVE  SPACES  TO  PV-SML-DIVERT-TMST.                                
026960                                                                          
026961     EXEC SQL                                                             
026962         SELECT  MAX(A.DIVERT_TMST)                                       
026963           INTO :PV-SML-DIVERT-TMST                                       
026964           FROM  TSUCRDV A                                                
026965              ,  TSUCDOT B                                                
026966          WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                       
026967            AND  B.OTBND_TRIP_ID = :DK-OTBND-TRIP-ID                      
026968            AND  A.DIVERT_TMST  >=  B.STRT_DIVERT_TMST                    
026969            AND  A.DIVERT_TMST  <=  B.END_DIVERT_TMST                     
026970            AND  A.OPER_UNT_ID   =  B.OPER_UNT_ID                         
026971            AND  A.DOOR_ID       =  B.DOOR_ID                             
026972            AND  A.ACTV_CDE      = 'A'                                    
026973          WITH UR                                                         
026974                                                                          
026975     END-EXEC.                                                            
026976                                                                          
026977     EVALUATE TRUE                                                        
026978         WHEN SQLCODE = ZERO                                              
026979              CONTINUE                                                    
026980                                                                          
026981         WHEN SQLCODE = +100                                              
026982         WHEN SQLCODE = -305                                              
026983              MOVE  SPACES  TO  PV-SML-DIVERT-TMST                        
026984                                                                          
026985         WHEN SQLWARN0 NOT = SPACES                                       
026986         WHEN SQLCODE < ZERO                                              
026987         WHEN SQLCODE > ZERO                                              
026988              MOVE SQLCODE              TO PV-SQLCODE                     
026989              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
026990              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
026991*                                                                         
026992              STRING '4015-'                                              
026993                     ' SQL:'   PV-SQLCODE                                 
026994                     ' TRIP:'  PV-DISP-TRIP-ID                            
026995                     ' OPER:'  PV-DISP-OPER                               
026996                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
026997                               DELIMITED BY SIZE                          
026998                          INTO PV-MESSAGE-1                               
026999                                                                          
027000             DISPLAY PV-MESSAGE-1                                         
027001                                                                          
027002             MOVE '4015-CHECK-LAST-DIVERT         '                       
027003                                 TO PV-PARAGRAPH-NAME                     
027004             MOVE 'GET LAST DIVERT TIMEATAMP      '                       
027005                                 TO PV-DB2-OPERATION-ATTEMPTED            
027006             PERFORM 9100-SQL-ABEND                                       
027007     END-EVALUATE.                                                        
027008                                                                          
027009                                                                          
027010*-----------------------------------------------------------------        
027011* WHEN IS THE LAST DIVERT FOR THE CARTON  - INACTIVE                      
027012*-----------------------------------------------------------------        
027013 4017-CHECK-LAST-DIVERT-INACT.                                            
027014                                                                          
027015     MOVE  SPACES  TO  PV-SML-DIVERT-TMST.                                
027016                                                                          
027017     EXEC SQL                                                             
027018         SELECT  MAX(A.DIVERT_TMST)                                       
027019           INTO :PV-SML-DIVERT-TMST                                       
027020           FROM  TSUCRDV A                                                
027021              ,  TSUCDOT B                                                
027022          WHERE  A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                       
027023            AND  B.OTBND_TRIP_ID = :DK-OTBND-TRIP-ID                      
027024            AND  A.DIVERT_TMST  >=  B.STRT_DIVERT_TMST                    
027025            AND  A.DIVERT_TMST  <=  B.END_DIVERT_TMST                     
027026            AND  A.OPER_UNT_ID   =  B.OPER_UNT_ID                         
027027            AND  A.DOOR_ID       =  B.DOOR_ID                             
027028            AND  A.ACTV_CDE      = 'I'                                    
027029          WITH UR                                                         
027030                                                                          
027031     END-EXEC.                                                            
027032                                                                          
027033     EVALUATE TRUE                                                        
027034         WHEN SQLCODE = ZERO                                              
027035              CONTINUE                                                    
027036                                                                          
027037         WHEN SQLCODE = +100                                              
027038         WHEN SQLCODE = -305                                              
027039              MOVE  SPACES  TO  PV-SML-DIVERT-TMST                        
027040                                                                          
027041         WHEN SQLWARN0 NOT = SPACES                                       
027042         WHEN SQLCODE < ZERO                                              
027043         WHEN SQLCODE > ZERO                                              
027044              MOVE SQLCODE              TO PV-SQLCODE                     
027045              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027046              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027047*                                                                         
027048              STRING '4017-'                                              
027049                     ' SQL:'   PV-SQLCODE                                 
027050                     ' TRIP:'  PV-DISP-TRIP-ID                            
027051                     ' OPER:'  PV-DISP-OPER                               
027052                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027053                               DELIMITED BY SIZE                          
027054                          INTO PV-MESSAGE-1                               
027055                                                                          
027056             DISPLAY PV-MESSAGE-1                                         
027057                                                                          
027058             MOVE '4017-CHECK-LAST-DIVERT-INACT   '                       
027059                                 TO PV-PARAGRAPH-NAME                     
027060             MOVE 'GET LAST DIVERT TIMESTAMP      '                       
027061                                 TO PV-DB2-OPERATION-ATTEMPTED            
027062             PERFORM 9100-SQL-ABEND                                       
027063     END-EVALUATE.                                                        
027064                                                                          
027065                                                                          
027066*-----------------------------------------------------------------        
027067*  WHEN WAS THE CARTON SCANNED ONTO THE TRAILER                           
027068*-----------------------------------------------------------------        
027069 4020-CHECK-SCANON.                                                       
027070                                                                          
027071     MOVE  SPACES  TO  PV-SML-SCANON-TMST.                                
027072                                                                          
027073     EXEC SQL                                                             
027074         SELECT  MAX(CRE_TMST)                                            
027075           INTO :PV-SML-SCANON-TMST                                       
027076           FROM  SUT_OTBND_LOC                                            
027077          WHERE  SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                         
027078            AND  OTBND_TRIP_ID = :DK-OTBND-TRIP-ID                        
027079            AND  SCN_CDE       = 'SHON'                                   
027080            AND  ACTV_CDE      = 'A'                                      
027081          WITH UR                                                         
027082                                                                          
027083     END-EXEC.                                                            
027084                                                                          
027085     EVALUATE TRUE                                                        
027086         WHEN SQLCODE = ZERO                                              
027087              CONTINUE                                                    
027088                                                                          
027089         WHEN SQLCODE = +100                                              
027090         WHEN SQLCODE = -305                                              
027091              MOVE  SPACES  TO  PV-SML-SCANON-TMST                        
027092                                                                          
027093         WHEN SQLWARN0 NOT = SPACES                                       
027094         WHEN SQLCODE < ZERO                                              
027095         WHEN SQLCODE > ZERO                                              
027096              MOVE SQLCODE              TO PV-SQLCODE                     
027097              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027098              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027099*                                                                         
027100              STRING '4020-'                                              
027101                     ' SQL:'   PV-SQLCODE                                 
027102                     ' TRIP:'  PV-DISP-TRIP-ID                            
027103                     ' OPER:'  PV-DISP-OPER                               
027104                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027105                               DELIMITED BY SIZE                          
027106                          INTO PV-MESSAGE-1                               
027107                                                                          
027108             DISPLAY PV-MESSAGE-1                                         
027109                                                                          
027110             MOVE '4020-CHECK-SCANON              '                       
027111                                 TO PV-PARAGRAPH-NAME                     
027112             MOVE 'CHECK SCAN ON TMST             '                       
027113                                 TO PV-DB2-OPERATION-ATTEMPTED            
027114             PERFORM 9100-SQL-ABEND                                       
027115     END-EVALUATE.                                                        
027116                                                                          
027117                                                                          
027118*-----------------------------------------------------------------        
027119*  WHEN WAS THE CARTON SCANNED ONTO THE TRAILER - INACTIVE                
027120*-----------------------------------------------------------------        
027121 4022-CHECK-SCANON-INACTIVE.                                              
027122                                                                          
027123     MOVE  SPACES  TO  PV-SML-SCANON-TMST.                                
027124                                                                          
027125     EXEC SQL                                                             
027126         SELECT  MAX(CRE_TMST)                                            
027127           INTO :PV-SML-SCANON-TMST                                       
027128           FROM  SUT_OTBND_LOC                                            
027129          WHERE  SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                         
027130            AND  OTBND_TRIP_ID = :DK-OTBND-TRIP-ID                        
027131            AND  SCN_CDE       = 'SHON'                                   
027132            AND  ACTV_CDE      = 'I'                                      
027133          WITH UR                                                         
027134                                                                          
027135     END-EXEC.                                                            
027136                                                                          
027137     EVALUATE TRUE                                                        
027138         WHEN SQLCODE = ZERO                                              
027139              CONTINUE                                                    
027140                                                                          
027141         WHEN SQLCODE = +100                                              
027142         WHEN SQLCODE = -305                                              
027143              MOVE  SPACES  TO  PV-SML-SCANON-TMST                        
027144                                                                          
027145         WHEN SQLWARN0 NOT = SPACES                                       
027146         WHEN SQLCODE < ZERO                                              
027147         WHEN SQLCODE > ZERO                                              
027148              MOVE SQLCODE              TO PV-SQLCODE                     
027149              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027150              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027151*                                                                         
027152              STRING '4022-'                                              
027153                     ' SQL:'   PV-SQLCODE                                 
027154                     ' TRIP:'  PV-DISP-TRIP-ID                            
027155                     ' OPER:'  PV-DISP-OPER                               
027156                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027157                               DELIMITED BY SIZE                          
027158                          INTO PV-MESSAGE-1                               
027159                                                                          
027160             DISPLAY PV-MESSAGE-1                                         
027161                                                                          
027162             MOVE '4022-CHECK-SCANON-INACTIVE     '                       
027163                                 TO PV-PARAGRAPH-NAME                     
027164             MOVE 'CHECK SCAN ON TMST             '                       
027165                                 TO PV-DB2-OPERATION-ATTEMPTED            
027166             PERFORM 9100-SQL-ABEND                                       
027167     END-EVALUATE.                                                        
027168                                                                          
027169                                                                          
027170*-----------------------------------------------------------------        
027171*  CHECK IF THE CARTON WAS PART OF A MASTER CONTAINER                     
027172*-----------------------------------------------------------------        
027173 4025-CHECK-IF-PART-MASTER.                                               
027174                                                                          
027175     MOVE  ZEROES            TO  SU117-MSTR-SML-NBR                       
027176     MOVE  SPACES            TO  SU117-MSTR-CRE-DTE                       
027177                                 SU117-MSTR-CRE-TM                        
027178                                 SU117-SML-IN-MSTR-DTE                    
027179                                 SU117-SML-IN-MSTR-TM                     
027180                                 SU117-FIRST-SML-IN-MSTR-DTE              
027181                                 SU117-FIRST-SML-IN-MSTR-TM               
027182                                 SU117-LAST-SML-IN-MSTR-DTE               
027183                                 SU117-LAST-SML-IN-MSTR-TM.               
027184                                                                          
027185     IF  SU117-SML-ON-OTBND-SCAN                                          
027186         PERFORM 4030-CHECK-SCANON-MST                                    
027187     ELSE                                                                 
027188         PERFORM 4035-CHECK-DIVERT-MST                                    
027189     END-IF.                                                              
027190                                                                          
027191                                                                          
027192*-----------------------------------------------------------------        
027193*  CHECK IF SML IS PART OF A SCANNED ON MASTER                            
027194*-----------------------------------------------------------------        
027195 4030-CHECK-SCANON-MST.                                                   
027196                                                                          
027197     MOVE  ZEROES  TO  PV-MST-SHIPT-UNT-ID.                               
027198     MOVE  SPACES  TO  PV-MST-CREATE-TMST                                 
027199                       PV-MST-CHILD-TMST                                  
027200                       PV-MST-FIRST-TMST                                  
027201                       PV-MST-LAST-TMST.                                  
027202                                                                          
027203     MOVE SU117-STORE-DEST  TO  DK-DEST-OPER-UNT-ID.                      
027204     MOVE SU117-TRIP-ID     TO  DK-OTBND-TRIP-ID.                         
027205                                                                          
027206     EXEC SQL                                                             
027207         SELECT  C.MSTR_SHIPT_UNT_ID                                      
027208              ,  C.CRE_TMST                                               
027209              ,  D.CRE_TMST                                               
027210           INTO :PV-MST-SHIPT-UNT-ID                                      
027211              , :PV-MST-CREATE-TMST                                       
027212              , :PV-MST-CHILD-TMST                                        
027213           FROM  SUT_OTBND_CART A                                         
027214              ,  SUT_OTBND_LOC B                                          
027215              ,  SUT_MSTR_SHIPT_UNT C                                     
027216              ,  SUT_MSTR_SHIPT_CNT D                                     
027217          WHERE  A.SHIPT_UNT_ID       =  B.SHIPT_UNT_ID                   
027218            AND  A.ACTV_IND           = 'N'                               
027219            AND  A.CART_SRC_CDE       = 'MST'                             
027220            AND  A.DEST_LOC_NBR       = :DK-DEST-OPER-UNT-ID              
027221            AND  B.OTBND_TRIP_ID      = :DK-OTBND-TRIP-ID                 
027222            AND  B.SCN_CDE            = 'SHON'                            
027223            AND  B.ACTV_CDE           = 'I'                               
027224            AND  A.SHIPT_UNT_ID       =  C.MSTR_SHIPT_UNT_ID              
027225            AND  C.MSTR_SHIPT_UNT_ID  =  D.MSTR_SHIPT_UNT_ID              
027226            AND  D.CHLD_SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                  
027227            AND  D.CRE_TMST IN                                            
027233                 (SELECT MAX(E.CRE_TMST)                                  
027234                    FROM SUT_MSTR_SHIPT_CNT E                             
027235                   WHERE D.MSTR_SHIPT_UNT_ID =                            
027236                         E.MSTR_SHIPT_UNT_ID                              
027237                     AND D.CHLD_SHIPT_UNT_ID =                            
027238                         E.CHLD_SHIPT_UNT_ID                              
027239                     AND E.ACTN_TYP_CDE  IN ('RTM','ACM')                 
027240                 )                                                        
027241                                                                          
027242          ORDER BY D.CRE_TMST DESC                                        
027243          FETCH FIRST 1 ROW ONLY                                          
027244          WITH UR                                                         
027245                                                                          
027246     END-EXEC.                                                            
027247                                                                          
027248     EVALUATE TRUE                                                        
027249         WHEN SQLCODE = ZERO                                              
027250         WHEN SQLCODE = -811                                              
027251              MOVE  PV-MST-SHIPT-UNT-ID TO SU117-MSTR-SML-NBR             
027252              MOVE  PV-MST-CREATE-DATE  TO SU117-MSTR-CRE-DTE             
027253              MOVE  PV-MST-CREATE-TIME  TO SU117-MSTR-CRE-TM              
027254              MOVE  PV-MST-CHILD-DATE   TO SU117-SML-IN-MSTR-DTE          
027255              MOVE  PV-MST-CHILD-TIME   TO SU117-SML-IN-MSTR-TM           
027256                                                                          
027257              PERFORM 4040-GET-MST-FIRST-DATE                             
027258              PERFORM 4045-GET-MST-LAST-DATE                              
027259                                                                          
027260         WHEN SQLCODE = +100                                              
027261              CONTINUE                                                    
027262                                                                          
027263         WHEN SQLWARN0 NOT = SPACES                                       
027264         WHEN SQLCODE < ZERO                                              
027265         WHEN SQLCODE > ZERO                                              
027266              MOVE SQLCODE              TO PV-SQLCODE                     
027267              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027268              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027269              MOVE DK-DEST-OPER-UNT-ID  TO PV-DISP-DEST-OPER              
027270*                                                                         
027271              STRING '4030-'                                              
027272                     ' SQL:'   PV-SQLCODE                                 
027273                     ' TRIP:'  PV-DISP-TRIP-ID                            
027274                     ' DEST:'  PV-DISP-DEST-OPER                          
027275                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027276                               DELIMITED BY SIZE                          
027277                          INTO PV-MESSAGE-1                               
027278                                                                          
027279             DISPLAY PV-MESSAGE-1                                         
027280                                                                          
027281             MOVE '4030-CHECK-SCANON-MST          '                       
027282                                 TO PV-PARAGRAPH-NAME                     
027283             MOVE 'CHECK IF PART OF SCANNED ON MST'                       
027284                                 TO PV-DB2-OPERATION-ATTEMPTED            
027285             PERFORM 9100-SQL-ABEND                                       
027286     END-EVALUATE.                                                        
027287                                                                          
027288                                                                          
027289*-----------------------------------------------------------------        
027290*  CHECK IF SML IS PART OF A DIVERTED MASTER                              
027291*-----------------------------------------------------------------        
027292 4035-CHECK-DIVERT-MST.                                                   
027293                                                                          
027294     MOVE  ZEROES  TO  PV-MST-SHIPT-UNT-ID.                               
027295     MOVE  SPACES  TO  PV-MST-CREATE-TMST                                 
027296                       PV-MST-CHILD-TMST                                  
027297                       PV-MST-FIRST-TMST                                  
027298                       PV-MST-LAST-TMST.                                  
027299                                                                          
027300     MOVE SU117-STORE-DEST  TO  DK-DEST-OPER-UNT-ID.                      
027301     MOVE SU117-TRIP-ID     TO  DK-OTBND-TRIP-ID.                         
027302     MOVE SU117-OPER-UNT-ID TO  DK-OPER-UNT-ID.                           
027303                                                                          
027304     EXEC SQL                                                             
027305         SELECT  E.MSTR_SHIPT_UNT_ID                                      
027306              ,  E.CRE_TMST                                               
027307              ,  F.CRE_TMST                                               
027308           INTO :PV-MST-SHIPT-UNT-ID                                      
027309              , :PV-MST-CREATE-TMST                                       
027310              , :PV-MST-CHILD-TMST                                        
027311           FROM  SUT_OTBND_CART A                                         
027312              ,  TSUCRDV C                                                
027313              ,  TSUCDOT D                                                
027314              ,  SUT_MSTR_SHIPT_UNT E                                     
027315              ,  SUT_MSTR_SHIPT_CNT F                                     
027316          WHERE  A.ACTV_IND          = 'N'                                
027317            AND  A.CART_SRC_CDE      = 'MST'                              
027318            AND  A.DEST_LOC_NBR      = :DK-DEST-OPER-UNT-ID               
027319            AND  A.ORGN_LOC_NBR      = :DK-OPER-UNT-ID                    
027320            AND  A.SHIPT_UNT_ID      =  C.SHIPT_UNT_ID                    
027321            AND  A.ORGN_LOC_NBR      =  C.OPER_UNT_ID                     
027322            AND  A.DEST_LOC_NBR      =  C.DEST_OPER_UNT_ID                
027323            AND  D.OTBND_TRIP_ID     = :DK-OTBND-TRIP-ID                  
027324            AND  C.ACTV_CDE          = 'I'                                
027325            AND  C.DIVERT_TMST      >=  D.STRT_DIVERT_TMST                
027326            AND  C.DIVERT_TMST      <=  D.END_DIVERT_TMST                 
027327            AND  C.DOOR_ID           =  D.DOOR_ID                         
027328            AND  A.SHIPT_UNT_ID      =  E.MSTR_SHIPT_UNT_ID               
027329            AND  E.MSTR_SHIPT_UNT_ID =  F.MSTR_SHIPT_UNT_ID               
027330            AND  F.CHLD_SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                   
027331            AND  F.CRE_TMST IN                                            
027332                 (SELECT MAX(G.CRE_TMST)                                  
027333                    FROM SUT_MSTR_SHIPT_CNT G                             
027334                   WHERE F.MSTR_SHIPT_UNT_ID =                            
027335                         G.MSTR_SHIPT_UNT_ID                              
027336                     AND F.CHLD_SHIPT_UNT_ID =                            
027337                         G.CHLD_SHIPT_UNT_ID                              
027338                     AND G.ACTN_TYP_CDE  IN ('RTM','ACM')                 
027339                 )                                                        
027340                                                                          
027341          ORDER BY F.CRE_TMST DESC                                        
027342          FETCH FIRST 1 ROW ONLY                                          
027343          WITH UR                                                         
027344                                                                          
027345     END-EXEC.                                                            
027346                                                                          
027347     EVALUATE TRUE                                                        
027348         WHEN SQLCODE = ZERO                                              
027349         WHEN SQLCODE = -811                                              
027350              MOVE  PV-MST-SHIPT-UNT-ID TO SU117-MSTR-SML-NBR             
027351              MOVE  PV-MST-CREATE-DATE  TO SU117-MSTR-CRE-DTE             
027352              MOVE  PV-MST-CREATE-TIME  TO SU117-MSTR-CRE-TM              
027353              MOVE  PV-MST-CHILD-DATE   TO SU117-SML-IN-MSTR-DTE          
027354              MOVE  PV-MST-CHILD-TIME   TO SU117-SML-IN-MSTR-TM           
027355                                                                          
027356              PERFORM 4040-GET-MST-FIRST-DATE                             
027357              PERFORM 4045-GET-MST-LAST-DATE                              
027358                                                                          
027359         WHEN SQLCODE = +100                                              
027360              CONTINUE                                                    
027361                                                                          
027362         WHEN SQLWARN0 NOT = SPACES                                       
027363         WHEN SQLCODE < ZERO                                              
027364         WHEN SQLCODE > ZERO                                              
027365              MOVE SQLCODE              TO PV-SQLCODE                     
027366              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027367              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027368              MOVE DK-DEST-OPER-UNT-ID  TO PV-DISP-DEST-OPER              
027369              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER                   
027370                                                                          
027371              STRING '4035-'                                              
027372                     ' SQL:'   PV-SQLCODE                                 
027373                     ' TRIP:'  PV-DISP-TRIP-ID                            
027374                     ' OPER:'  PV-DISP-OPER                               
027375                     ' DEST:'  PV-DISP-DEST-OPER                          
027376                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027377                               DELIMITED BY SIZE                          
027378                          INTO PV-MESSAGE-1                               
027379                                                                          
027380             DISPLAY PV-MESSAGE-1                                         
027381                                                                          
027382             MOVE '4035-CHECK-DIVERT-MST          '                       
027383                                 TO PV-PARAGRAPH-NAME                     
027384             MOVE 'CHECK IF PART OF SCANNED ON MST'                       
027385                                 TO PV-DB2-OPERATION-ATTEMPTED            
027386             PERFORM 9100-SQL-ABEND                                       
027387     END-EVALUATE.                                                        
027388                                                                          
027389                                                                          
027390*-----------------------------------------------------------------        
027391*  WHEN WAS THE FIRST CARTON ATTACHED TO THE MASTER                       
027392*-----------------------------------------------------------------        
027393 4040-GET-MST-FIRST-DATE.                                                 
027394                                                                          
027395     MOVE  SPACES  TO  PV-MST-FIRST-TMST.                                 
027396                                                                          
027397     MOVE PV-MST-SHIPT-UNT-ID TO SUT00099-MSTR-SHIPT-UNT-ID.              
027398                                                                          
027399     EXEC SQL                                                             
027400         SELECT MIN(CRE_TMST)                                             
027401           INTO :PV-MST-FIRST-TMST                                        
027402           FROM  SUT_MSTR_SHIPT_CNT                                       
027403          WHERE  MSTR_SHIPT_UNT_ID = :SUT00099-MSTR-SHIPT-UNT-ID          
027404          WITH UR                                                         
027405                                                                          
027406     END-EXEC.                                                            
027407                                                                          
027408     EVALUATE TRUE                                                        
027409         WHEN SQLCODE = ZERO                                              
027410              MOVE  PV-MST-FIRST-DATE                                     
027411                TO SU117-FIRST-SML-IN-MSTR-DTE                            
027412              MOVE  PV-MST-FIRST-TIME                                     
027413                TO SU117-FIRST-SML-IN-MSTR-TM                             
027414                                                                          
027415         WHEN SQLWARN0 NOT = SPACES                                       
027416         WHEN SQLCODE < ZERO                                              
027417         WHEN SQLCODE > ZERO                                              
027418              MOVE SQLCODE              TO PV-SQLCODE                     
027419              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027420              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027421              MOVE DK-DEST-OPER-UNT-ID  TO PV-DISP-DEST-OPER              
027422              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER                   
027423              MOVE PV-MST-SHIPT-UNT-ID  TO PV-DISP-MSTR                   
027424*                                                                         
027425              STRING '4040-'                                              
027426                     ' SQL:'   PV-SQLCODE                                 
027427                     ' TRIP:'  PV-DISP-TRIP-ID                            
027428                     ' '       PV-DISP-OPER                               
027429                     '-'       PV-DISP-DEST-OPER                          
027430                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027431                     ' MST:'   PV-DISP-MSTR                               
027432                               DELIMITED BY SIZE                          
027433                          INTO PV-MESSAGE-1                               
027434                                                                          
027435             DISPLAY PV-MESSAGE-1                                         
027436                                                                          
027437             MOVE '4040-GET-MST-FIRST-DATE        '                       
027438                                 TO PV-PARAGRAPH-NAME                     
027439             MOVE 'CHECK WHEN FIRST CARTON IN MSTR'                       
027440                                 TO PV-DB2-OPERATION-ATTEMPTED            
027441             PERFORM 9100-SQL-ABEND                                       
027442     END-EVALUATE.                                                        
027443                                                                          
027444                                                                          
027445*-----------------------------------------------------------------        
027446*  WHEN WAS THE LAST CARTON ATTACHED TO THE MASTER                        
027447*-----------------------------------------------------------------        
027448 4045-GET-MST-LAST-DATE.                                                  
027449                                                                          
027450     MOVE  SPACES  TO  PV-MST-LAST-TMST.                                  
027451                                                                          
027452     MOVE PV-MST-SHIPT-UNT-ID TO SUT00099-MSTR-SHIPT-UNT-ID.              
027453                                                                          
027454     EXEC SQL                                                             
027455         SELECT MAX(CRE_TMST)                                             
027456           INTO :PV-MST-LAST-TMST                                         
027457           FROM  SUT_MSTR_SHIPT_CNT                                       
027458          WHERE  MSTR_SHIPT_UNT_ID = :SUT00099-MSTR-SHIPT-UNT-ID          
027459          WITH UR                                                         
027460                                                                          
027461     END-EXEC.                                                            
027462                                                                          
027463     EVALUATE TRUE                                                        
027464         WHEN SQLCODE = ZERO                                              
027465              MOVE  PV-MST-LAST-DATE                                      
027466                TO SU117-LAST-SML-IN-MSTR-DTE                             
027467              MOVE  PV-MST-LAST-TIME                                      
027468                TO SU117-LAST-SML-IN-MSTR-TM                              
027469                                                                          
027470         WHEN SQLWARN0 NOT = SPACES                                       
027471         WHEN SQLCODE < ZERO                                              
027472         WHEN SQLCODE > ZERO                                              
027473              MOVE SQLCODE              TO PV-SQLCODE                     
027474              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027475              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027476              MOVE DK-DEST-OPER-UNT-ID  TO PV-DISP-DEST-OPER              
027477              MOVE DK-OPER-UNT-ID       TO PV-DISP-OPER                   
027478              MOVE PV-MST-SHIPT-UNT-ID  TO PV-DISP-MSTR                   
027479                                                                          
027480              STRING '4045-'                                              
027481                     ' SQL:'   PV-SQLCODE                                 
027482                     ' TRIP:'  PV-DISP-TRIP-ID                            
027483                     ' '       PV-DISP-OPER                               
027484                     '-'       PV-DISP-DEST-OPER                          
027485                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027486                     ' MST:'   PV-DISP-MSTR                               
027487                               DELIMITED BY SIZE                          
027488                          INTO PV-MESSAGE-1                               
027489                                                                          
027490             DISPLAY PV-MESSAGE-1                                         
027491                                                                          
027492             MOVE '4045-GET-MST-LAST-DATE         '                       
027493                                 TO PV-PARAGRAPH-NAME                     
027494             MOVE 'CHECK WHEN LAST CARTON IN MSTR '                       
027495                                 TO PV-DB2-OPERATION-ATTEMPTED            
027496             PERFORM 9100-SQL-ABEND                                       
027497     END-EVALUATE.                                                        
027498                                                                          
027499                                                                          
027500*-----------------------------------------------------------------        
027501* WHEN WAS CARTON PROCESSED?                                              
027502* FOR ASN - WHEN WAS THE CARTON CHECKED IN                                
027503* FOR P2L/JWL - WHEN WAS THE EARLIERS CARTON CHECKED IN THAT              
027504*               WENT TO P2L/JWL                                           
027505*               P2L WILL BE DETERMINED IN NEXT PROGRAM SUKUT178           
027506*               ONCE THE RECEIVER NUMBER HAS BEEN DETERMINED              
027507* FOR ALL OTHER CARTONS IT IS THE CREATE DATE/TIME ON OUTBOUND            
027508* CARTON DATABASE                                                         
027509*-----------------------------------------------------------------        
027510 4100-CHECK-CARTON-PROCESSED.                                             
027511                                                                          
027512     IF  SUT00024-CART-SRC-CDE  =  'ASN'                                  
027513         PERFORM 4110-ASN-PROCESS                                         
027514     ELSE                                                                 
027515     IF  SUT00024-CART-SRC-CDE  =  'P2L'  OR                              
027516         SUT00024-CART-SRC-CDE  =  'JWL'                                  
027517         CONTINUE                                                         
027518     ELSE                                                                 
027519         MOVE SUT00024-CRE-DTE  TO  SU117-SRC-CART-PRC-DTE                
027520         MOVE SUT00024-CRE-TM   TO  SU117-SRC-CART-PRC-TM                 
027521     END-IF.                                                              
027522                                                                          
027523                                                                          
027524*-----------------------------------------------------------------        
027525*  ASN - WHEN WAS THE CARTON CHECKED IN                                   
027526*-----------------------------------------------------------------        
027527 4110-ASN-PROCESS.                                                        
027528                                                                          
027529     MOVE  SPACES  TO  PV-PROCESSED-TMST.                                 
027530                                                                          
027531     EXEC SQL                                                             
027532         SELECT MIN(CRE_TMST)                                             
027533           INTO :PV-PROCESSED-TMST                                        
027534           FROM  SUT_OTBND_LOC                                            
027535          WHERE  SHIPT_UNT_ID = :DK-SHIPT-UNT-ID                          
027536            AND  SCN_CDE      = 'RECV'                                    
027537          WITH UR                                                         
027538                                                                          
027539     END-EXEC.                                                            
027540                                                                          
027541     EVALUATE TRUE                                                        
027542         WHEN SQLCODE = ZERO                                              
027543              MOVE  PV-PROCESSED-DATE                                     
027544                TO SU117-SRC-CART-PRC-DTE                                 
027545              MOVE  PV-PROCESSED-TIME                                     
027546                TO SU117-SRC-CART-PRC-TM                                  
027547                                                                          
027548         WHEN SQLCODE = -305                                              
027549              MOVE SUT00024-CRE-DTE                                       
027550                TO SU117-SRC-CART-PRC-DTE                                 
027551              MOVE SUT00024-CRE-TM                                        
027552                TO SU117-SRC-CART-PRC-TM                                  
027553                                                                          
027554         WHEN SQLWARN0 NOT = SPACES                                       
027555         WHEN SQLCODE < ZERO                                              
027556         WHEN SQLCODE > ZERO                                              
027557              MOVE SQLCODE              TO PV-SQLCODE                     
027558              MOVE DK-OTBND-TRIP-ID     TO PV-DISP-TRIP-ID                
027559              MOVE DK-SHIPT-UNT-ID      TO PV-DISP-SHIPT-UNT-ID           
027560                                                                          
027561              STRING '4110-'                                              
027562                     ' SQL:'   PV-SQLCODE                                 
027563                     ' TRIP:'  PV-DISP-TRIP-ID                            
027564                     ' '       PV-DISP-OPER                               
027565                     '-'       PV-DISP-DEST-OPER                          
027566                     ' SML:'   PV-DISP-SHIPT-UNT-ID                       
027567                     ' MST:'   PV-DISP-MSTR                               
027568                               DELIMITED BY SIZE                          
027569                          INTO PV-MESSAGE-1                               
027570                                                                          
027571             DISPLAY PV-MESSAGE-1                                         
027572                                                                          
027573             MOVE '4110-ASN-PROCESS               '                       
027574                                 TO PV-PARAGRAPH-NAME                     
027575             MOVE 'CHECK WHEN WAS ASN CHECKED IN  '                       
027576                                 TO PV-DB2-OPERATION-ATTEMPTED            
027577             PERFORM 9100-SQL-ABEND                                       
027578     END-EVALUATE.                                                        
027579                                                                          
027580                                                                          
027708*-----------------------------------------------------------------        
027709*  OPEN THE CURSOR. BY TRIP/CARTON                                        
027710*-----------------------------------------------------------------        
027711 7000-OPEN-TRIP-CRTN-CURSOR.                                              
027712                                                                          
027713     EXEC SQL                                                             
027714          OPEN DC-TRIP-CRTN-CSR                                           
027715     END-EXEC                                                             
027720                                                                          
027800     EVALUATE TRUE                                                        
027810         WHEN SQLCODE = ZERO                                              
027820              CONTINUE                                                    
027900         WHEN SQLCODE = -904                                              
028000         WHEN SQLCODE = -911                                              
028100              CONTINUE                                                    
028200         WHEN SQLWARN0 NOT = SPACES                                       
028300         WHEN SQLCODE < ZERO                                              
028400         WHEN SQLCODE > ZERO                                              
028410              MOVE SQLCODE              TO PV-SQLCODE                     
028472*                                                                         
028473              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
028474              STRING '7000-'                                              
028475                     ' SQL:'   PV-SQLCODE                                 
028476                     ' TRIP:'  PV-DISP-TRIP-ID                            
028482                               DELIMITED BY SIZE                          
028483                          INTO PV-MESSAGE-1                               
028484                                                                          
028506                                                                          
028510             MOVE '7000-OPEN-TRIP-CRTN-CSR     '                          
028600                                 TO PV-PARAGRAPH-NAME                     
028700             MOVE 'OPEN THE DC-TRIP-CRTN-CSR   '                          
028800                                 TO PV-DB2-OPERATION-ATTEMPTED            
028900             PERFORM 9100-SQL-ABEND                                       
029200     END-EVALUATE.                                                        
029400                                                                          
030200                                                                          
030210*-----------------------------------------------------------------        
030220*  FETCH THE ROW FROM TRIP CARTON CURSOR                                  
030230*-----------------------------------------------------------------        
030300 7005-FETCH-TRIP-CRTN-CURSOR.                                             
030500                                                                          
030700     EXEC SQL                                                             
030920          FETCH DC-TRIP-CRTN-CSR                                          
031010           INTO :SUT00024-SHIPT-UNT-ID                                    
031020               ,:SUT00024-CART-SRC-CDE                                    
031030               ,:SUT00024-CRE-DTE                                         
031040               ,:SUT00024-CRE-TM                                          
031050               ,:SUT00024-ORIG-CART-ID                                    
032300     END-EXEC.                                                            
032400                                                                          
032500     EVALUATE TRUE                                                        
032600         WHEN SQLCODE = ZERO                                              
032610              ADD  1  TO  PV-TRIP-CRTN-CNT                                
032611                          PV-FETCH-COUNT-DISP                             
032620              IF  PV-FETCH-COUNT-DISP >= 100                              
032621                  MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID              
032630                  DISPLAY 'TRIP:'    PV-DISP-TRIP-ID                      
032631                          '  CNT: '  PV-TRIP-CRTN-CNT                     
032640                  MOVE  ZEROES  TO  PV-FETCH-COUNT-DISP                   
032650              END-IF                                                      
032700                                                                          
032800         WHEN SQLCODE = +100                                              
032810              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
032820              DISPLAY 'TRIP:'    PV-DISP-TRIP-ID                          
032830                      '  CNT: '  PV-TRIP-CRTN-CNT                         
032840                      '  TOTAL CARTONS ON TRIP '                          
032841                      '  END OF CURSOR: DC-TRIP-CRTN-CSR'                 
032900              SET PS-EOF-TRIP-CRTN         TO  TRUE                       
033000                                                                          
033100         WHEN SQLWARN0 NOT = SPACES                                       
033200         WHEN SQLCODE < ZERO                                              
033300         WHEN SQLCODE > ZERO                                              
033301              MOVE SQLCODE              TO PV-SQLCODE                     
033302              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
033394              STRING '7005-'                                              
033395                     ' SQL:'   PV-SQLCODE                                 
033396                     ' TRIP:'  PV-DISP-TRIP-ID                            
033403                               DELIMITED BY SIZE                          
033404                          INTO PV-MESSAGE-1                               
033405             DISPLAY PV-MESSAGE-1                                         
033406                                                                          
033410             MOVE '7005-FETCH-TRIP-CRTN-CURSOR'                           
033500                                 TO PV-PARAGRAPH-NAME                     
033600             MOVE 'FETCH THE DC-TRIP-CRTN-CSR     '                       
033700                                 TO PV-DB2-OPERATION-ATTEMPTED            
033800             PERFORM 9100-SQL-ABEND                                       
033900     END-EVALUATE.                                                        
034000                                                                          
034120                                                                          
034121*-----------------------------------------------------------------        
034122*  CLOSE THE CURSOR.                                                      
034123*-----------------------------------------------------------------        
034124 7010-CLOSE-TRIP-CRTN-CURSOR.                                             
034125                                                                          
034126     EXEC SQL                                                             
034127          CLOSE DC-TRIP-CRTN-CSR                                          
034128     END-EXEC                                                             
034129                                                                          
034130     EVALUATE TRUE                                                        
034131         WHEN SQLCODE = ZERO                                              
034132              CONTINUE                                                    
034133         WHEN SQLCODE = -904                                              
034134         WHEN SQLCODE = -911                                              
034135              CONTINUE                                                    
034136         WHEN SQLWARN0 NOT = SPACES                                       
034137         WHEN SQLCODE < ZERO                                              
034138         WHEN SQLCODE > ZERO                                              
034139              MOVE SQLCODE              TO PV-SQLCODE                     
034140              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
034147*                                                                         
034148              STRING '7010-'                                              
034149                     ' SQL:'   PV-SQLCODE                                 
034150                     ' TRIP:'  PV-DISP-TRIP-ID                            
034157                               DELIMITED BY SIZE                          
034158                          INTO PV-MESSAGE-1                               
034159                                                                          
034160             MOVE '7010-CLOSE-TRIP-CRTN-CURSOR '                          
034161                                 TO PV-PARAGRAPH-NAME                     
034162             MOVE 'CLOSE THE DC-TRIP-CRTN-CSR   '                         
034163                                 TO PV-DB2-OPERATION-ATTEMPTED            
034164             PERFORM 9100-SQL-ABEND                                       
034165     END-EVALUATE.                                                        
034166                                                                          
034168                                                                          
034169*-----------------------------------------------------------------        
034170*  OPEN THE CURSOR. BY DIVERT                                             
034180*-----------------------------------------------------------------        
034190 7020-OPEN-TRIP-CRTN-CURSOR.                                              
034200                                                                          
034210     EXEC SQL                                                             
034220          OPEN TRIP-CRTN-DIVERT-CSR                                       
034230     END-EXEC                                                             
034240                                                                          
034250     EVALUATE TRUE                                                        
034260         WHEN SQLCODE = ZERO                                              
034270              CONTINUE                                                    
034280         WHEN SQLCODE = -904                                              
034290         WHEN SQLCODE = -911                                              
034291              CONTINUE                                                    
034292         WHEN SQLWARN0 NOT = SPACES                                       
034293         WHEN SQLCODE < ZERO                                              
034294         WHEN SQLCODE > ZERO                                              
034295              MOVE SQLCODE              TO PV-SQLCODE                     
034296*                                                                         
034297              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
034298              STRING '7020-'                                              
034299                     ' SQL:'   PV-SQLCODE                                 
034300                     ' TRIP:'  PV-DISP-TRIP-ID                            
034301                               DELIMITED BY SIZE                          
034302                          INTO PV-MESSAGE-1                               
034303                                                                          
034304                                                                          
034305             MOVE '7020-OPEN-TRIP-CRTN-CSR     '                          
034306                                 TO PV-PARAGRAPH-NAME                     
034307             MOVE 'OPEN THE TRIP-CRTN-DIVERT-CSR'                         
034308                                 TO PV-DB2-OPERATION-ATTEMPTED            
034309             PERFORM 9100-SQL-ABEND                                       
034310     END-EVALUATE.                                                        
034311                                                                          
034312                                                                          
034313*-----------------------------------------------------------------        
034314*  FETCH THE ROW FROM TRIP CARTON CURSOR                                  
034315*-----------------------------------------------------------------        
034316 7025-FETCH-TRIP-CRTN-CURSOR.                                             
034317                                                                          
034318     EXEC SQL                                                             
034319          FETCH TRIP-CRTN-DIVERT-CSR                                      
034320           INTO :SUT00024-SHIPT-UNT-ID                                    
034321               ,:SUT00024-CART-SRC-CDE                                    
034322               ,:SUT00024-CRE-DTE                                         
034323               ,:SUT00024-CRE-TM                                          
034324               ,:SUT00024-ORIG-CART-ID                                    
034325     END-EXEC.                                                            
034326                                                                          
034327     EVALUATE TRUE                                                        
034328         WHEN SQLCODE = ZERO                                              
034329              ADD  1  TO  PV-TRIP-CRTN-CNT                                
034330                          PV-FETCH-COUNT-DISP                             
034331              IF  PV-FETCH-COUNT-DISP >= 100                              
034332                  MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID              
034333                  DISPLAY 'TRIP:'    PV-DISP-TRIP-ID                      
034334                          '  CNT: '  PV-TRIP-CRTN-CNT                     
034335                  MOVE  ZEROES  TO  PV-FETCH-COUNT-DISP                   
034336              END-IF                                                      
034340                                                                          
034341         WHEN SQLCODE = +100                                              
034342              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
034343              DISPLAY 'TRIP:'    PV-DISP-TRIP-ID                          
034344                      '  CNT: '  PV-TRIP-CRTN-CNT                         
034345                      '  TOTAL CARTONS ON TRIP '                          
034346                      '  END OF CURSOR:  TRIP-CRTN-DIVERT-CSR'            
034347              MOVE ZEROES  TO  PV-TRIP-CRTN-CNT                           
034348                               PV-FETCH-COUNT-DISP                        
034349              SET PS-EOF-TRIP-CRTN         TO  TRUE                       
034350                                                                          
034351         WHEN SQLWARN0 NOT = SPACES                                       
034352         WHEN SQLCODE < ZERO                                              
034353         WHEN SQLCODE > ZERO                                              
034354              MOVE SQLCODE              TO PV-SQLCODE                     
034355              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
034356              STRING '7025-'                                              
034357                     ' SQL:'   PV-SQLCODE                                 
034358                     ' TRIP:'  PV-DISP-TRIP-ID                            
034359                               DELIMITED BY SIZE                          
034360                          INTO PV-MESSAGE-1                               
034361             DISPLAY PV-MESSAGE-1                                         
034362                                                                          
034363             MOVE '7025-FETCH-TRIP-CRTN-CURSOR'                           
034364                                 TO PV-PARAGRAPH-NAME                     
034365             MOVE 'FETCH THE TRIP-CRTN-DIVERT-CSR '                       
034366                                 TO PV-DB2-OPERATION-ATTEMPTED            
034367             PERFORM 9100-SQL-ABEND                                       
034368     END-EVALUATE.                                                        
034369                                                                          
034370                                                                          
034371*-----------------------------------------------------------------        
034372*  CLOSE THE CURSOR.                                                      
034373*-----------------------------------------------------------------        
034374 7030-CLOSE-TRIP-CRTN-CURSOR.                                             
034375                                                                          
034376     EXEC SQL                                                             
034377          CLOSE TRIP-CRTN-DIVERT-CSR                                      
034378     END-EXEC                                                             
034379                                                                          
034380     EVALUATE TRUE                                                        
034381         WHEN SQLCODE = ZERO                                              
034382              CONTINUE                                                    
034383         WHEN SQLCODE = -904                                              
034384         WHEN SQLCODE = -911                                              
034385              CONTINUE                                                    
034386         WHEN SQLWARN0 NOT = SPACES                                       
034387         WHEN SQLCODE < ZERO                                              
034388         WHEN SQLCODE > ZERO                                              
034389              MOVE SQLCODE              TO PV-SQLCODE                     
034390              MOVE DK-OTBND-TRIP-ID  TO  PV-DISP-TRIP-ID                  
034391*                                                                         
034392              STRING '7030-'                                              
034393                     ' SQL:'   PV-SQLCODE                                 
034394                     ' TRIP:'  PV-DISP-TRIP-ID                            
034395                               DELIMITED BY SIZE                          
034396                          INTO PV-MESSAGE-1                               
034397                                                                          
034398             MOVE '7030-CLOSE-TRIP-CRTN-CURSOR '                          
034399                                 TO PV-PARAGRAPH-NAME                     
034400             MOVE 'CLOSE THE TRIP-CRTN-DIVERT-CSR'                        
034401                                 TO PV-DB2-OPERATION-ATTEMPTED            
034402             PERFORM 9100-SQL-ABEND                                       
034403     END-EVALUATE.                                                        
034404                                                                          
034405                                                                          
034406*-----------------------------------------------------------------        
034407*  READ INPUT FILE                                                        
034408*-----------------------------------------------------------------        
034409 8000-READ-INPUT-REC.                                                     
034410                                                                          
034411     READ INPUT-FILE       INTO                                           
034412           SU117-EXTRACT-RECORD                                           
034413     AT END                                                               
034414         SET PS-EOF-INPUT             TO TRUE                             
034415         DISPLAY ' SUKUT177'                                              
034416                 'END OF INPUT FILE'                                      
034417         DISPLAY SPACES                                                   
034418     NOT AT END                                                           
034419         ADD  1                 TO  PV-INPUT-COUNTER                      
034420         MOVE SU117-OPER-UNT-ID TO  PV-DISP-OPER                          
034421         MOVE SU117-STORE-DEST  TO  PV-DISP-STORE                         
034422         MOVE SU117-TRIP-ID     TO  DK-OTBND-TRIP-ID                      
034423                                    PV-DISP-TRIP-ID                       
034424         DISPLAY ' SUKUT177'                                              
034425                 '  OPER:'  PV-DISP-OPER                                  
034426                 '  STORE:' PV-DISP-STORE                                 
034427                 '  TRIP:'  PV-DISP-TRIP-ID                               
034428         DISPLAY SPACES                                                   
034429     END-READ.                                                            
034430                                                                          
034431*-----------------------------------------------------------------        
034432*  WRITE THE SHIPMENT-UNIT-RECORD                                         
034433*-----------------------------------------------------------------        
034440 8100-WRITE-OUTPUT-RECORD.                                                
034500                                                                          
034600     WRITE OUTPUT-RECORD                                                  
034700      FROM SU117-EXTRACT-RECORD.                                          
034800     ADD +1 TO PV-WRITE-COUNTER.                                          
035690                                                                          
035700                                                                          
035710*-----------------------------------------------------------------        
035711*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                                  
035720*-----------------------------------------------------------------        
035800 9000-EOJ-ROUTINE.                                                        
035900                                                                          
036300     CLOSE INPUT-FILE                                                     
036310           OUTPUT-FILE.                                                   
036400                                                                          
036410     DISPLAY SPACES.                                                      
036420     DISPLAY ' SUKUT177 '.                                                
036500     MOVE PV-INPUT-COUNTER  TO PV-DISPLAY-COUNT.                          
036601     DISPLAY 'TOTAL INPUT:   ' PV-DISPLAY-COUNT.                          
036610     MOVE PV-WRITE-COUNTER  TO PV-DISPLAY-COUNT.                          
036620     DISPLAY 'TOTAL OUTPUT:  ' PV-DISPLAY-COUNT.                          
036630     DISPLAY SPACES.                                                      
036700                                                                          
040200                                                                          
040210*-----------------------------------------------------------------        
040220*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL            
040230*  ERROR OR WARNING CODE OCCURS.                                          
040240*-----------------------------------------------------------------        
040300 9100-SQL-ABEND.                                                          
040800     DISPLAY '9100-SQL-ABEND'.                                            
040900     DISPLAY '** ABEND     **'.                                           
041000     DISPLAY '** PROGRAM   ** =  SUKUT177'.                               
041100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
041200     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
041300                                                                          
041400******************************************************************        
041500* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-            
041600* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE                 
041700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE             
041800* FORMAT.                                                                 
041900******************************************************************        
042000     COPY DPPD004.                                                        
042100                                                                          
042200     MOVE +4013                  TO ABEND-CODE.                           
042300     CALL 'ILBOABN0' USING ABEND-CODE.                                    
042310/                                                                         
