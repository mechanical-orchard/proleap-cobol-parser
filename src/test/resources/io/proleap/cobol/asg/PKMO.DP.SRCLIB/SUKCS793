000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000210*-----------------------*                                         00021002
000220 PROGRAM-ID.    SUKCS793.                                         00022002
000230 AUTHOR.        OMAN.                                             00023002
000240 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024002
000250 DATE-WRITTEN.  OCTOBER  2008.                                    00025002
000260 DATE-COMPILED.                                                   00026002
000270*----------------------------------------------------------------*00027002
000280*    S793 - PRINT AND APPLY CRITERIA SPECIFICATION               *00028006
000290*                                                                *00029002
000300*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00030002
000400*    SUBSEQUENT PROGRAMS.  FROM THIS SCREEN THE USER CAN PRESS:  *00040002
000800*    F23 TO DISPLAY A LIST OF DOOR IDS AND TRIPS RELATED TO DOOR *00080022
000900*    F24 TO DISPLAY A LIST OF PRINT AND APPLY STATIONS FOR A DC  *00090022
001000*----------------------------------------------------------------*00100002
001010*    01/16/2009 CHRISTINE TWIEHAUS IR 18,117                      00101079
001011*               POSITION CURSOR ON FIRST FIELD                    00101175
001020*----------------------------------------------------------------*00102075
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968         00104086
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00105086
263968* MAKING THE CALL DYNAMIC VS STATIC.                              00106086
001130*                                                                 00106187
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099         00106287
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                           00106387
263968*---------------------------------------------------------------* 00107086
001100 ENVIRONMENT DIVISION.                                            00110002
001200 DATA DIVISION.                                                   00120002
001300                                                                  00130002
001400 WORKING-STORAGE SECTION.                                         00140002
001500                                                                  00150002
001600 01  DK-DB2-KEYS.                                                 00160002
001700     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00170002
001800     05  DK-FCLTY-ID               PIC S9(04) COMP VALUE +0.      00180002
001900     05  DK-PRINTER-ID             PIC X(08)       VALUE SPACES.  00190002
002000     05  DK-DOOR-TYPE-CDE          PIC X(02)       VALUE SPACES.  00200002
002100     05  DK-DOOR-ID                PIC X(04)       VALUE SPACES.  00210002
002200                                                                  00220002
002300 01  PV-PROGRAM-VARIABLES.                                        00230002
002400     05  PV-CICS-RESPONSE          PIC S9(08)  VALUE ZEROES       00240002
002500                                   COMP SYNC.                     00250002
002600                                                                  00260002
002700     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     00270002
002800                                                    COMP SYNC.    00280002
002810     05  PV-CURRENT-TIMESTAMP      PIC X(26) VALUE SPACES.        00281038
002811     05  PV-CURRENT-TIMESTAMP-REDEF REDEFINES                     00281170
002812                    PV-CURRENT-TIMESTAMP.                         00281238
002813         10  PV-CURRENT-DATE-FMT   PIC  X(10).                    00281338
002814         10  PV-CURRENT-HYPHEN     PIC  X(01).                    00281438
002815         10  PV-CURRENT-TIME-FMT   PIC  X(15).                    00281538
002816     05  PV-FROM-DATE-HOLD.                                       00281638
002820         10  PV-FROM-YY            PIC  9(04)  VALUE ZEROS.       00282038
002830         10  PV-FROM-MM            PIC  9(02)  VALUE ZEROS.       00283038
002840         10  PV-FROM-DD            PIC  9(02)  VALUE ZEROES.      00284007
002850                                                                  00285007
002860     05  PV-TO-DATE-HOLD.                                         00286007
002870         10  PV-TO-YY              PIC  9(04)  VALUE ZEROES.      00287007
002880         10  PV-TO-MM              PIC  9(02)  VALUE ZEROES.      00288007
002890         10  PV-TO-DD              PIC  9(02)  VALUE ZEROES.      00289007
002891                                                                  00289107
002892     05  PV-MIN-START-DATE         PIC X(10)   VALUE SPACES.      00289282
002893     05  PV-MIN-START-DATE-R REDEFINES PV-MIN-START-DATE.         00289382
002894         10  PV-MIN-FROM-YY        PIC  9(04).                    00289485
002895         10  FILLER                PIC  X(01).                    00289582
002896         10  PV-MIN-FROM-MM        PIC  9(02).                    00289685
002897         10  FILLER                PIC  X(01).                    00289782
002898         10  PV-MIN-FROM-DD        PIC  9(02).                    00289885
002899                                                                  00289982
002900     05  PV-MIN-START-WORK.                                       00290082
002901         10  PV-MIN-FROM-YY-WORK   PIC  9(04)  VALUE ZEROES.      00290182
002902         10  PV-MIN-FROM-MM-WORK   PIC  9(02)  VALUE ZEROES.      00290281
002904         10  PV-MIN-FROM-DD-WORK   PIC  9(02)  VALUE ZEROES.      00290481
002910                                                                  00291002
003000 01  PC-PROGRAM-CONSTANTS.                                        00300002
003100     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'SUK793'.   00310003
003200     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'SUKM793'.  00320003
003300     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'SUKCS793'. 00330002
003400     05  PC-PRTR-VALIDATION-PGM    PIC  X(08)  VALUE  'DPKCS060'. 00340002
003500     05  PC-REPORT-PGM-1           PIC  X(08)  VALUE  'SUKCS793'. 00350002
003510     05  PC-CALENDAR-MODULE        PIC  X(08)  VALUE  'DPKUT500'. 00351017
003600     05  PC-01                     PIC  X(02)  VALUE  '01'.       00360002
003700     05  PC-DC                     PIC  X(02)  VALUE  'DC'.       00370002
003800     05  PC-A                      PIC  X(01)  VALUE  'A'.        00380002
003900     05  PC-D                      PIC  X(01)  VALUE  'D'.        00390002
004000     05  PC-N                      PIC  X(01)  VALUE  'N'.        00400002
004100     05  PC-U                      PIC  X(01)  VALUE  'U'.        00410002
004200     05  PC-Y                      PIC  X(01)  VALUE  'Y'.        00420002
004300     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00430002
004400                                               COMP-3.            00440002
004500*                                                                 00450002
004600 01  PS-PROGRAM-SWITCHES.                                         00460002
004700     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00470002
004800         88  PS-ERROR                          VALUE  'Y'.        00480002
004900         88  PS-NO-ERROR                       VALUE  'N'.        00490002
004901     05  PS-NUM-ERROR-SW           PIC  X(01)  VALUE  'N'.        00490118
004902         88  PS-NUM-ERROR                      VALUE  'Y'.        00490218
004903         88  PS-NO-NUM-ERROR                   VALUE  'N'.        00490318
004910     05  PS-DATE-ERROR-SW          PIC  X(01)  VALUE  'N'.        00491016
004920         88  PS-DATE-ERROR                     VALUE  'Y'.        00492016
004930         88  PS-NO-DATE-ERROR                  VALUE  'N'.        00493016
005000     05  PS-PRINTER-ID-EXISTS-SW   PIC  X(01)  VALUE  'N'.        00500002
005100         88  PS-PRINTER-ID-EXISTS              VALUE  'Y'.        00510002
005200         88  PS-PRINTER-ID-DOESNT-EXIST        VALUE  'N'.        00520002
005300     05  PS-DOOR-TYPE-EXISTS-SW    PIC  X(01)  VALUE  'N'.        00530002
005400         88  PS-DOOR-TYPE-EXISTS               VALUE  'Y'.        00540002
005500         88  PS-DOOR-TYPE-DOESNT-EXIST         VALUE  'N'.        00550002
005600                                                                  00560002
005700*----------------------------------------------------------------*00570002
005800*  SYSTEM MESSAGES                                               *00580002
005900*----------------------------------------------------------------*00590002
006000*   00005 - INVALID VALUE                                         00600002
006100*   00007 - REQUIRED ENTRY                                        00610002
006200*   00008 - MUST BE NUMERIC                                       00620002
006300*   02571 - UNABLE TO UPD - CURRENT OPER UNT AND OPER UNIT ID ENTE00630002
006400*   02572 - INVALID VALUE - OPER UNIT ID MUST BE A DC LOCATION    00640002
006500*   02573 - ADD FUNCTION INVALID - DOOR ALREADY DEFINED FOR THE DC00650002
006600*   02574 - UPDATE FUNCTION INVALID - DOOR IS CURRENTLY NOT DEFINE00660002
006700*   02575 - STORE ASSIGNMNT FUNCTION ONLY VALID FOR DOOR TYPES SHI00670002
006800*----------------------------------------------------------------*00680002
006900 01  PC-TSYMSG-NUMBERS.                                           00690002
007000     05  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.          00700002
007100     05  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.          00710002
007200     05  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.          00720002
007210     05  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.          00721021
007300     05  PC-TSYMSG-02221       PIC  9(05)  VALUE  02221.          00730021
007310     05  PC-TSYMSG-02571       PIC  9(05)  VALUE  02571.          00731021
007400     05  PC-TSYMSG-02572       PIC  9(05)  VALUE  02572.          00740002
007500     05  PC-TSYMSG-02573       PIC  9(05)  VALUE  02573.          00750002
007600     05  PC-TSYMSG-02574       PIC  9(05)  VALUE  02574.          00760002
007700     05  PC-TSYMSG-02575       PIC  9(05)  VALUE  02575.          00770002
007800*                                                                 00780002
007900 01  PM-PROGRAM-MESSAGES.                                         00790002
008000     05  PM-ABEND-INFO-A.                                         00800002
008100         10  FILLER                PIC X(15)   VALUE              00810002
008200                                   'DP020-SRC-AID: '.             00820002
008300         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00830002
008400         10  FILLER                PIC X(19)   VALUE              00840002
008500                                   '. DP020-FK-ACTION: '.         00850002
008600         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00860002
008700         10  FILLER                PIC X(22)   VALUE              00870002
008800                                   '. DP020-FK-DISPN-IND: '.      00880002
008900         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00890002
009000         10  FILLER                PIC X(01)   VALUE '.'.         00900002
009100         10  FILLER                PIC X(19)   VALUE SPACE.       00910002
009200                                                                  00920002
009300*----------------------------------------------------------------*00930002
009400*    MAP LAYOUT                                                  *00940002
009500*----------------------------------------------------------------*00950002
009600     COPY SUKM793.                                                00960002
009700                                                                  00970002
009800*----------------------------------------------------------------*00980002
009900*    ATTRIBUTE SETTINGS COPYBOOK.                                *00990002
010000*----------------------------------------------------------------*01000002
010100     COPY DPWS015.                                                01010002
010200                                                                  01020002
010300*----------------------------------------------------------------*01030002
010400*    FUNCTION KEYS COPYBOOK                                      *01040002
010500*----------------------------------------------------------------*01050002
010600     COPY DPWS016.                                                01060002
010700                                                                  01070002
010800******************************************************************01080002
010900** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01090002
011000** SUB-ROUTINE (DPKUT100).                                      **01100002
011100******************************************************************01110002
011200     COPY DPWS010I.                                               01120002
011300                                                                  01130002
011310******************************************************************01131014
011330**  DPKUT500 DATE VALIDATION SUBROUTINE                         **01133014
011340******************************************************************01134014
011350     COPY DPWS500.                                                01135014
011360                                                                  01136014
011700******************************************************************01137087
011600** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **01160087
011700******************************************************************01170002
011800     COPY DPWS030.                                                01180002
011800     COPY DPWS930.                                                01181087
011900                                                                  01190002
012000***************************************************************** 01200002
012100*    STANDARD COMMAREA.                                           01210002
012200***************************************************************** 01220002
012300     COPY DPWS020.                                                01230002
012400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01240002
012500                                                                  01250002
012600***************************************************************** 01260002
012700*    INTER-APPLICATION COMMAREA.                                  01270002
012800***************************************************************** 01280002
012900         10  INTER-APPL-COMM-AREA PIC X(200).                     01290002
013000     COPY SUWS087.                                                01300011
013100                                                                  01310002
013200***************************************************************** 01320002
013300*    SPECIFIC COMMAREA FOR SUKCS793.                              01330002
013400***************************************************************** 01340002
013500         10  ASC-SPECIFIC-COMMAREA.                               01350066
013900             15  ASC-OPER-UNT-ID             PIC  X(04).          01390002
014000             15  ASC-OPER-UNT-ID-N REDEFINES ASC-OPER-UNT-ID      01400002
014100                                             PIC  9(04).          01410002
014200             15  ASC-FCLTY-ID                PIC  X(04).          01420002
014300             15  ASC-FCLTY-ID-N REDEFINES ASC-FCLTY-ID            01430002
014400                                             PIC  Z(04).          01440002
014411             15  ASC-PNA-STA-NBR             PIC  X(04).          01441149
014412             15  ASC-PNA-STA-NBR-N REDEFINES ASC-PNA-STA-NBR      01441249
014413                                             PIC  9(04).          01441317
014600             15  ASC-FCLTY-NME               PIC  X(25).          01460002
014700             15  ASC-ASSIGN-FROM-DATE.                            01470050
014701                 20  ASC-ASSIGN-FROM-DATE-YY.                     01470150
014702                     25  ASC-ASSIGN-FROM-DATE-YY-N PIC 9(04).     01470250
014710                 20  ASC-ASSIGN-FROM-DATE-MM.                     01471050
014720                     25  ASC-ASSIGN-FROM-DATE-MM-N PIC 9(02).     01472050
014730                 20  ASC-ASSIGN-FROM-DATE-DD.                     01473050
014751                     25  ASC-ASSIGN-FROM-DATE-DD-N PIC 9(02).     01475150
014760             15  ASC-ASSIGN-TO-DATE.                              01476050
014761                 20  ASC-ASSIGN-TO-DATE-YY.                       01476150
014762                     25  ASC-ASSIGN-TO-DATE-YY-N PIC 9(04).       01476250
014763                 20  ASC-ASSIGN-TO-DATE-MM.                       01476350
014764                     25  ASC-ASSIGN-TO-DATE-MM-N PIC 9(02).       01476450
014765                 20  ASC-ASSIGN-TO-DATE-DD.                       01476550
014766                     25  ASC-ASSIGN-TO-DATE-DD-N PIC 9(02).       01476650
015100             15  ASC-FUNCTION                PIC  X(01).          01510002
015900             15  FILLER                      PIC  X(40).          01590002
016000                                                                  01600002
016100*----------------------------------------------------------------*01610002
016200*    ABEND PROCESSING COPYBOOK.                                  *01620002
016300*----------------------------------------------------------------*01630002
016400     COPY DPWS013.                                                01640002
016500                                                                  01650002
018000*----------------------------------------------------------------*01800002
018100*    COMMAREA USED TO CALL XLKUT071                               01810002
018200*----------------------------------------------------------------*01820002
018300     COPY XLWS071.                                                01830002
018400                                                                  01840002
018500*----------------------------------------------------------------*01850002
018600*  DB2 DCLGEN FOR PARAMETER TABLE                                 01860072
018700*----------------------------------------------------------------*01870002
018800     EXEC SQL                                                     01880002
018900         INCLUDE TKRPRPM                                          01890072
019000     END-EXEC.                                                    01900002
019100                                                                  01910002
019101*----------------------------------------------------------------*01910183
019102*  DB2 DCLGEN FOR PARAMETER TABLE - SUT_PNA_STA_TRIP_ASGMT        01910283
019103*----------------------------------------------------------------*01910383
019104     EXEC SQL                                                     01910483
019105         INCLUDE SUT00110                                         01910583
019106     END-EXEC.                                                    01910683
019107                                                                  01910783
019110*----------------------------------------------------------------*01911072
019120*  COMMUNICATION AREAS FOR DB2                                    01912072
019130*----------------------------------------------------------------*01913072
019140     EXEC SQL                                                     01914072
019150         INCLUDE SQLCA                                            01915072
019160     END-EXEC.                                                    01916072
019170                                                                  01917072
019200*----------------------------------------------------------------*01920002
019300 LINKAGE SECTION.                                                 01930002
019400                                                                  01940002
019500 01  DFHCOMMAREA.                                                 01950002
019600     05  FILLER                         OCCURS  1 TO 4072 TIMES   01960002
019700                                        DEPENDING ON EIBCALEN.    01970002
019800         10  FILLER                     PIC X.                    01980002
019900                                                                  01990002
020000                                                                  02000002
020100 PROCEDURE DIVISION.                                              02010002
020200***************************************************************** 02020002
020300** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02030002
020400** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02040002
020500** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02050002
020600**                                                             ** 02060002
020700** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02070002
020800** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02080002
020900***************************************************************** 02090002
021000 0000-MAIN-MODULE.                                                02100002
021100     INITIALIZE DP030-CICS-API-FIELDS.                            02110002
021200     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02120002
021300     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02130002
021400     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02140002
021500     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02150002
021600     MOVE LENGTH OF SUK793I       TO DP030-MAP-LENGTH (1).        02160003
021700     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02170002
021800     PERFORM 0001-CALL-CICS-ARCH-API.                             02180002
021900*                                                                 02190002
022000     PERFORM 1000-CONTROL-PROCESSING                              02200002
022100*                                                                 02210002
022200     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02220002
022300     PERFORM 0001-CALL-CICS-ARCH-API.                             02230002
022400                                                                  02240002
022500*---------------------------------------------------------------- 02250002
022600 0001-CALL-CICS-ARCH-API.                                         02260002
022700*    CALL 'DPKCS030' USING DFHEIBLK                               02270087
022700     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02271087
022800                           DFHCOMMAREA                            02280002
022900                           DP030-CICS-API-FIELDS                  02290002
023000                           DP020-STANDARD-COMMAREA                02300002
023100                           SUK793I.                               02310003
023200*                                                                 02320002
023300     IF  DP030-RC-CALL-SUCCESSFUL                                 02330002
023400         CONTINUE                                                 02340002
023500     ELSE                                                         02350002
023600         SET DP013-NO-ROLLBACK                                    02360002
023700             DP013-XCTL-DISPLAY-RESTART                           02370002
023800             DP013-CICS-ABEND      TO TRUE                        02380002
023900         MOVE 'BEFORE 0000-MAIN-MODULE'                           02390002
024000                                   TO DP013-PARAGRAPH             02400002
024100*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX02410087
024200*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      02420087
024100         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02421087
024200-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02422087
024300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02430002
024400         PERFORM DP013-0000-PROCESS-ABEND                         02440002
024500     END-IF.                                                      02450002
024600                                                                  02460002
024700*----------------------------------------------------------------*02470002
024800*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02480002
024900*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02490002
025000*----------------------------------------------------------------*02500002
025100 1000-CONTROL-PROCESSING.                                         02510002
025200                                                                  02520002
025300     EVALUATE TRUE                                                02530002
025400         WHEN DP020-NEXT-ACT-INITIAL                              02540002
025410**           WHEN 1ST COMING TO THIS SCREEN                       02541051
025500             INITIALIZE ASC-SPECIFIC-COMMAREA                     02550002
025600             MOVE DP020-LOCATION-NBR TO ASC-OPER-UNT-ID           02560010
025610*CT BEGIN 1/16                                                    02561077
025700             MOVE -1                 TO AOPRUNTL                  02570053
025701*CT END   1/16                                                    02570177
025710             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  02571054
025800             PERFORM 4000-BUILD-INITIAL-PANEL                     02580002
025900             PERFORM 3200-RESET-ATTRIBUTES                        02590002
026000                                                                  02600002
026100         WHEN DP020-NEXT-ACT-RETURN                               02610002
026110**           WHEN RETURNING FROM ANOTHER SCREEN                   02611051
026111*CT BEGIN 1/16                                                    02611177
026120             MOVE -1                 TO AOPRUNTL                  02612076
026130*CT END   1/16                                                    02613077
026200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02620002
026300             PERFORM 3200-RESET-ATTRIBUTES                        02630002
026310             MOVE -1                     TO ASTANBRL              02631064
026320             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  02632064
026400                                                                  02640002
026500         WHEN DP020-NEXT-ACT-READ-MAP                             02650002
026510**           WHEN DOING ANYTHING ON CURRENT SCREEN INCLUDING      02651051
026520**           PRESSING FKEYS TO GO TO ANOTHER SCREEN               02652051
026600             PERFORM 2000-FKEY-PROCESSING                         02660002
026700                                                                  02670002
026800         WHEN OTHER                                               02680002
026900             SET DP013-LOGIC-ABEND                                02690002
027000                 DP013-NO-ROLLBACK TO TRUE                        02700002
027100             MOVE 'SUKCS793 - 1000-CONTROL-PROCESSING'            02710002
027200                                   TO  DP013-PARAGRAPH            02720002
027300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02730002
027400                                   TO  DP013-MESSAGE-TEXT(1)      02740002
027500             MOVE DP020-NEXT-APPL-ACTIVITY                        02750002
027600                                   TO DP013-MESSAGE-TEXT(2)       02760002
027700             PERFORM DP013-0000-PROCESS-ABEND                     02770002
027800     END-EVALUATE.                                                02780002
027900                                                                  02790002
028000*----------------------------------------------------------------*02800002
028100* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02810002
028200* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02820002
028300* EDITS.                                                         *02830002
028400*----------------------------------------------------------------*02840002
028500 2000-FKEY-PROCESSING.                                            02850002
028600                                                                  02860002
028700     EVALUATE TRUE                                                02870002
028800                                                                  02880002
028900         WHEN DP020-SRC-AID = DP016-CLEAR                         02890002
029000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02900002
029100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02910002
029200                                                                  02920002
029300*F5-REFRESH                                                       02930002
029400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02940002
029500             INITIALIZE ASC-SPECIFIC-COMMAREA                     02950002
030200             MOVE SPACES      TO AOPRUNTO                         03020009
030300                                 AOPRNMEO                         03030009
030400                                 ASTANBRO                         03040009
030500                                 ADATFMMO                         03050009
030600                                 ADATFDDO                         03060009
030610                                 ADATFYYO                         03061009
030620                                 ADATTDDO                         03062009
030630                                 ADATTMMO                         03063009
030640                                 ADATTYYO                         03064009
030800             MOVE DP020-LOCATION-NBR TO ASC-OPER-UNT-ID           03080010
030810*CT BEGIN 1/16                                                    03081077
030900             MOVE -1                 TO AOPRUNTL                  03090076
030910*CT BEGIN 1/16                                                    03091077
031000             PERFORM 4000-BUILD-INITIAL-PANEL                     03100002
031100             PERFORM 3200-RESET-ATTRIBUTES                        03110002
031200                                                                  03120002
031300         WHEN OTHER                                               03130002
031400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03140002
031500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03150002
031600             IF  PS-NO-ERROR                                      03160002
031700                 SET DP030-CONTINUE-GO TO TRUE                    03170002
031800                 PERFORM 2100-CHECK-FUNCTION-KEY                  03180002
031900                 IF  PS-ERROR                                     03190002
032000                     SET DP030-OVERRIDE-GO TO TRUE                03200002
032100                 END-IF                                           03210002
032200             ELSE                                                 03220002
032300                 SET DP030-OVERRIDE-GO TO TRUE                    03230002
032400             END-IF                                               03240002
032500     END-EVALUATE.                                                03250002
032600                                                                  03260002
032700******************************************************************03270002
032800** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **03280002
032900** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **03290002
033000** FROM THE CICS ARCHITECTURE API.                              **03300002
033100******************************************************************03310002
033200 2100-CHECK-FUNCTION-KEY.                                         03320002
033300     EVALUATE TRUE                                                03330002
033500         WHEN DP020-SRC-AID = DP016-ENTER                         03350002
033600              MOVE -1                     TO AOPRUNTL             03360079
034100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03410056
038400                                                                  03840002
038500*F23 PNADRLST ----> (SULPATDR) GOES TO SUKCS794 TO LIST DOORS     03850032
038600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03860020
039190              PERFORM 2110-PREPARE-INTER-APPL-COMM                03919060
039191              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03919160
039200                                                                  03920002
039300*F24 PNALIST  ----> (SULPASTN) GOES TO SUKCS795                   03930032
039310*                    PRINT AND APPLY STATION LIST                 03931032
039400         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03940020
039500             IF  ASC-OPER-UNT-ID = SPACES                         03950002
039501                 SET PS-ERROR                                     03950102
039502                     DP020-MSG-FATAL         TO TRUE              03950202
039503                 MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER  03950302
039504                 MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA          03950402
039505                 MOVE DP015-RED              TO AOPRUNTC          03950502
039506                 MOVE DP015-REVERSE          TO AOPRUNTH          03950602
039507                 MOVE -1                     TO AOPRUNTL          03950702
039508                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              03950802
039509                 MOVE SPACES                 TO AOPRNMEO          03950902
039520             ELSE                                                 03952027
039521                 PERFORM 2110-PREPARE-INTER-APPL-COMM             03952127
039522             END-IF                                               03952227
039523             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03952327
039580     END-EVALUATE.                                                03958002
039590                                                                  03959002
039600******************************************************************03960002
039700** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03970002
039800** INTER-APPLICATION COMMAREA.                                  **03980002
039900******************************************************************03990002
040000 2110-PREPARE-INTER-APPL-COMM.                                    04000002
040100                                                                  04010002
040200     INITIALIZE SU087-INTER-APPL-COMMAREA.                        04020007
040300                                                                  04030002
040400     MOVE ASC-OPER-UNT-ID          TO SU087-OPER-UNT-ID.          04040007
041000     MOVE ASC-FCLTY-NME            TO SU087-FCLTY-NME.            04100007
041010     MOVE ASC-PNA-STA-NBR          TO SU087-PNA-STA-NBR.          04101049
041020                                                                  04102067
041200     STRING ASC-ASSIGN-FROM-DATE-YY  '-'                          04120067
041201            ASC-ASSIGN-FROM-DATE-MM  '-'                          04120167
041202            ASC-ASSIGN-FROM-DATE-DD  '-'                          04120268
041203            DELIMITED BY SIZE                                     04120367
041204            INTO SU087-ASSIGN-FROM-DATE.                          04120467
041205     STRING ASC-ASSIGN-TO-DATE-YY    '-'                          04120567
041206            ASC-ASSIGN-TO-DATE-MM    '-'                          04120667
041207            ASC-ASSIGN-TO-DATE-DD    '-'                          04120768
041208            DELIMITED BY SIZE                                     04120867
041209            INTO SU087-ASSIGN-TO-DATE.                            04120967
041260                                                                  04126002
041270*----------------------------------------------------------------*04127002
041280* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*04128002
041290* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *04129002
041300* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *04130002
041400*----------------------------------------------------------------*04140002
041500 2200-MOVE-SCREEN-TO-COMMAREA.                                    04150002
041600*OPER UNT ID                                                      04160002
041700     IF  AOPRUNTL > ZERO                                          04170002
041800         MOVE AOPRUNTI      TO ASC-OPER-UNT-ID                    04180002
041900     ELSE                                                         04190002
042000         IF AOPRUNTF = DP015-ERASE-EOF                            04200002
042100            MOVE SPACES      TO ASC-OPER-UNT-ID                   04210002
042200         END-IF                                                   04220002
042300     END-IF.                                                      04230002
042310                                                                  04231007
042311*STATION NUMBER                                                   04231107
042312     IF  ASTANBRL > ZERO                                          04231210
042313         MOVE ASTANBRI      TO ASC-PNA-STA-NBR                    04231349
042314     ELSE                                                         04231407
042315         IF ASTANBRF = DP015-ERASE-EOF                            04231510
042316            MOVE SPACES      TO ASC-PNA-STA-NBR                   04231649
042317         END-IF                                                   04231707
042318     END-IF.                                                      04231807
042319                                                                  04231907
042320*FROM DATE                                                        04232007
042321     IF  ADATFMML > ZERO                                          04232107
042330         MOVE ADATFMMI             TO ASC-ASSIGN-FROM-DATE-MM     04233050
042340     ELSE                                                         04234007
042350         IF  ADATFMMF = DP015-ERASE-EOF                           04235007
042360             MOVE SPACE            TO ASC-ASSIGN-FROM-DATE-MM     04236050
042370         END-IF                                                   04237007
042380     END-IF.                                                      04238007
042390                                                                  04239007
042391     IF  ADATFDDL > ZERO                                          04239107
042392         MOVE ADATFDDI             TO ASC-ASSIGN-FROM-DATE-DD     04239250
042393     ELSE                                                         04239307
042394         IF  ADATFDDF = DP015-ERASE-EOF                           04239407
042395             MOVE SPACE            TO ASC-ASSIGN-FROM-DATE-DD     04239550
042396         END-IF                                                   04239607
042397     END-IF.                                                      04239707
042398                                                                  04239807
042399     IF  ADATFYYL > ZERO                                          04239907
042400         MOVE ADATFYYI             TO ASC-ASSIGN-FROM-DATE-YY     04240050
042401     ELSE                                                         04240107
042402         IF  ADATFYYF = DP015-ERASE-EOF                           04240207
042403             MOVE SPACE            TO ASC-ASSIGN-FROM-DATE-YY     04240350
042404         END-IF                                                   04240407
042405     END-IF.                                                      04240507
042406                                                                  04240607
042407*  TO DATE                                                        04240707
042408     IF  ADATTMML > ZERO                                          04240807
042409         MOVE ADATTMMI             TO ASC-ASSIGN-TO-DATE-MM       04240950
042410     ELSE                                                         04241007
042411         IF  ADATTMMF = DP015-ERASE-EOF                           04241107
042412             MOVE SPACE            TO ASC-ASSIGN-TO-DATE-MM       04241250
042413         END-IF                                                   04241307
042414     END-IF.                                                      04241407
042415                                                                  04241507
042416     IF  ADATTDDL > ZERO                                          04241607
042417         MOVE ADATTDDI             TO ASC-ASSIGN-TO-DATE-DD       04241750
042418     ELSE                                                         04241807
042419         IF  ADATTDDF = DP015-ERASE-EOF                           04241907
042420             MOVE SPACE            TO ASC-ASSIGN-TO-DATE-DD       04242050
042421         END-IF                                                   04242107
042422     END-IF.                                                      04242207
042423                                                                  04242307
042424     IF  ADATTYYL > ZERO                                          04242407
042425         MOVE ADATTYYI             TO ASC-ASSIGN-TO-DATE-YY       04242550
042426     ELSE                                                         04242607
042427         IF  ADATTYYF = DP015-ERASE-EOF                           04242707
042428             MOVE SPACE            TO ASC-ASSIGN-TO-DATE-YY       04242850
042429         END-IF                                                   04242907
042430     END-IF.                                                      04243007
042431                                                                  04243107
044200                                                                  04420002
044300******************************************************************04430002
044400* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *04440002
044500* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *04450002
044600* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE     *04460002
044700* DONE IN THE DESTINATION PROGRAM, NOT HERE.                     *04470002
044800******************************************************************04480002
044900 3000-EDIT-DATA-IN-COMMAREA.                                      04490002
045000     PERFORM 3200-RESET-ATTRIBUTES.                               04500002
045100                                                                  04510002
045200*EDIT OPER UNIT TO MAKE SURE NUMERIC                              04520002
045300     IF  ASC-OPER-UNT-ID = SPACES                                 04530024
045301         SET PS-ERROR                                             04530123
045302             DP020-MSG-FATAL         TO TRUE                      04530223
045303         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          04530323
045304         MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA                  04530423
045305         MOVE DP015-RED              TO AOPRUNTC                  04530523
045306         MOVE DP015-REVERSE          TO AOPRUNTH                  04530623
045307         MOVE -1                     TO AOPRUNTL                  04530723
045308         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      04530823
045309         MOVE SPACES                 TO AOPRNMEO                  04530923
045310     ELSE                                                         04531023
045400         MOVE ASC-OPER-UNT-ID    TO DP010I-UNEDITED-FIELD         04540002
045500         MOVE LENGTH OF ASC-OPER-UNT-ID TO DP010I-MAXIMUM-DIGITS  04550002
045600         MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS       04560002
045700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  04570002
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                         04581086
263968              USING DP010I-NUMERIC-EDIT-AREA                      04582086
045900         IF  DP010I-ERROR-DETECTED                                04590002
046000             SET PS-ERROR                                         04600002
046100                 DP020-MSG-FATAL         TO TRUE                  04610002
046200             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      04620002
046300             MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA              04630002
046400             MOVE DP015-RED              TO AOPRUNTC              04640002
046500             MOVE DP015-REVERSE          TO AOPRUNTH              04650002
046600             MOVE -1                     TO AOPRUNTL              04660002
046700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04670002
046800             MOVE SPACES                 TO AOPRNMEO              04680002
046900         ELSE                                                     04690002
047000             MOVE DP010I-NUMERIC-FIELD TO ASC-OPER-UNT-ID-N       04700002
047100             MOVE ASC-OPER-UNT-ID      TO AOPRUNTO                04710002
047200*VALIDATE OPER UNIT                                               04720002
047300             PERFORM 3010-VALIDATE-OPER-UNT-ID                    04730002
047400             IF PS-ERROR                                          04740002
047500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04750002
047600             END-IF                                               04760002
047700         END-IF                                                   04770002
047800     END-IF.                                                      04780002
047810                                                                  04781004
047820*EDIT STATION NUMBER TO MAKE SURE IT'S NUMERIC                    04782004
047830     IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID) AND               04783058
047831         PS-NO-ERROR                                              04783158
047832         IF  ASC-PNA-STA-NBR = SPACES                             04783258
047833             SET PS-ERROR                                         04783358
047834                 DP020-MSG-FATAL         TO TRUE                  04783458
047835             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      04783558
047836             MOVE DP015-UNP-ALP-BRT-OFF  TO ASTANBRA              04783658
047837             MOVE DP015-RED              TO ASTANBRC              04783758
047838             MOVE DP015-REVERSE          TO ASTANBRH              04783858
047839             MOVE -1                     TO ASTANBRL              04783958
047840             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04784058
047842         ELSE                                                     04784223
047844             MOVE ASC-PNA-STA-NBR    TO DP010I-UNEDITED-FIELD     04784449
047850             MOVE LENGTH OF ASC-PNA-STA-NBR TO                    04785049
047851                                             DP010I-MAXIMUM-DIGITS04785123
047860             MOVE ZERO               TO DP010I-MAXIMUM-DECIMALS   04786023
047870             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              04787023
263968             CALL DP010I-NUMERIC-EDIT-ROUTINE                     04788186
263968                  USING DP010I-NUMERIC-EDIT-AREA                  04788286
047890             IF  DP010I-ERROR-DETECTED                            04789023
047891                 SET PS-ERROR                                     04789123
047892                     DP020-MSG-FATAL         TO TRUE              04789223
047893                 MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  04789323
047894                 MOVE DP015-UNP-ALP-BRT-OFF  TO ASTANBRA          04789423
047895                 MOVE DP015-RED              TO ASTANBRC          04789523
047896                 MOVE DP015-REVERSE          TO ASTANBRH          04789623
047897                 MOVE -1                     TO ASTANBRL          04789723
047898                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04789823
047900             ELSE                                                 04790023
047901                 MOVE DP010I-NUMERIC-FIELD TO ASC-PNA-STA-NBR-N   04790149
047902                 MOVE ASC-PNA-STA-NBR      TO ASTANBRO            04790249
047906                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             04790623
047908             END-IF                                               04790823
047910     END-IF.                                                      04791007
047920                                                                  04792008
047930     IF  DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                   04793059
047932         IF (ASC-ASSIGN-FROM-DATE = SPACES OR                     04793250
047933             ASC-ASSIGN-FROM-DATE = ZEROES) AND                   04793350
047934            (ASC-ASSIGN-TO-DATE  = SPACES  OR                     04793450
047935             ASC-ASSIGN-TO-DATE  = ZEROES)                        04793550
047936             PERFORM 3160-DEFAULT-DATES                           04793641
047937         ELSE                                                     04793741
047939             PERFORM 3140-VALIDATE-DATES                          04793941
048406         END-IF                                                   04840608
048407     END-IF.                                                      04840708
048410                                                                  04841004
048500                                                                  04850004
048600****************************************************************  04860004
048700*    VERIFY OPER UNIT ID.                                      *  04870004
048800*                                                              *  04880004
048900****************************************************************  04890004
049000                                                                  04900004
049100 3010-VALIDATE-OPER-UNT-ID.                                       04910004
049200                                                                  04920004
049300     INITIALIZE XL071-COMMAREA.                                   04930004
049400     MOVE ASC-OPER-UNT-ID TO XL071-LOCATION-NUMBER.               04940004
049500                                                                  04950004
049600     CALL XL071-LOCATION-MODULE USING                             04960004
049700                                DFHEIBLK                          04970004
049800                                XL071-COMMAREA                    04980004
049900                                XL071-COMMAREA-REC.               04990004
050000                                                                  05000004
050100     EVALUATE TRUE                                                05010004
050200         WHEN XL071-NO-ERRORS                                     05020004
050300         WHEN XL071-DC-ASGMT-NOT-FND                              05030004
050400              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  05040004
050500              IF XL071-LOC-TYP-CDE = PC-DC                        05050004
050600                 CONTINUE                                         05060004
050700              ELSE                                                05070004
050800                 SET PS-ERROR                                     05080004
050900                     DP020-MSG-FATAL         TO TRUE              05090004
051000                 MOVE PC-TSYMSG-02572        TO DP020-MSG-NUMBER  05100004
051100                 MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA          05110004
051200                 MOVE DP015-RED              TO AOPRUNTC          05120004
051300                 MOVE DP015-REVERSE          TO AOPRUNTH          05130004
051400                 MOVE -1                     TO AOPRUNTL          05140004
051500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05150004
051600                 MOVE SPACES                 TO AOPRNMEO          05160004
051700              END-IF                                              05170004
051800                                                                  05180004
051900         WHEN XL071-LOC-NOT-FOUND                                 05190004
052000              MOVE 'NAME NOT FOUND'   TO ASC-FCLTY-NME            05200004
052100              SET PS-ERROR                                        05210004
052200                  DP020-MSG-FATAL         TO TRUE                 05220004
052300              MOVE PC-TSYMSG-02572        TO DP020-MSG-NUMBER     05230004
052400              MOVE DP015-UNP-ALP-BRT-OFF  TO AOPRUNTA             05240004
052500              MOVE DP015-RED              TO AOPRUNTC             05250004
052600              MOVE DP015-REVERSE          TO AOPRUNTH             05260004
052700              MOVE -1                     TO AOPRUNTL             05270004
052800              SET DP030-SET-CURSOR-APPL-1 TO TRUE                 05280004
052900              MOVE SPACES                 TO AOPRNMEO             05290004
053000                                                                  05300004
053100         WHEN OTHER                                               05310004
053200              MOVE '3010-VALIDATE-OPER-UNT-ID'                    05320004
053300                                  TO DP013-PARAGRAPH              05330004
053400              STRING 'SELECT STORE NUMBER - '                     05340004
053500                      XL071-LOCATION-NUMBER                       05350004
053600                     ' - BAD RETURN CODE FROM XLKUT071 - '        05360004
053700                      XL071-RETURN-CODE                           05370004
053800                      DELIMITED BY SIZE                           05380004
053900                      INTO DP013-MESSAGE-TEXT (1)                 05390004
054000              STRING 'SQLCODE - '                                 05400004
054100                      XL071-SQLCODE                               05410004
054200                     ' - '                                        05420004
054300                      XL071-DB2-TABLE                             05430004
054400                      DELIMITED BY SIZE                           05440004
054500                      INTO DP013-MESSAGE-TEXT (2)                 05450004
054600              MOVE XL071-SQLCA     TO DP013-SQLCA                 05460004
054700              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)    05470004
054800              MOVE XL071-SQLCODE TO SQLCODE                       05480004
054900              SET DP013-DB2-ABEND                                 05490004
055000                  DP013-XCTL-DISPLAY-RESTART TO TRUE              05500004
055100              PERFORM DP013-0000-PROCESS-ABEND                    05510004
055200                                                                  05520004
055300     END-EVALUATE.                                                05530004
055400                                                                  05540004
075116*-----------------------------------------------------------------07511607
075117*  VALIDATE CREATE FROM AND TO DATES                              07511707
075118*-----------------------------------------------------------------07511807
075119 3140-VALIDATE-DATES.                                             07511939
075120     MOVE ASC-ASSIGN-FROM-DATE-MM  TO  PV-FROM-MM                 07512050
075121     MOVE ASC-ASSIGN-FROM-DATE-DD  TO  PV-FROM-DD                 07512150
075122     MOVE ASC-ASSIGN-FROM-DATE-YY  TO  PV-FROM-YY                 07512250
075123     MOVE ASC-ASSIGN-TO-DATE-MM    TO  PV-TO-MM                   07512350
075124     MOVE ASC-ASSIGN-TO-DATE-DD    TO  PV-TO-DD                   07512450
075125     MOVE ASC-ASSIGN-TO-DATE-YY    TO  PV-TO-YY                   07512550
075126     SET PS-NO-DATE-ERROR TO TRUE                                 07512636
075127                                                                  07512736
075148                                                                  07514807
075149     IF  PV-TO-DATE-HOLD  >=  PV-FROM-DATE-HOLD                   07514907
075150         CONTINUE                                                 07515007
075151     ELSE                                                         07515107
075152         IF PS-NUM-ERROR                                          07515207
075153             CONTINUE                                             07515307
075154         ELSE                                                     07515407
075155             SET PS-ERROR                                         07515507
075156                 PS-DATE-ERROR                                    07515607
075157                 DP020-MSG-FATAL         TO TRUE                  07515707
075158             MOVE PC-TSYMSG-02221        TO DP020-MSG-NUMBER      07515807
075159             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07515907
075160         END-IF                                                   07516007
075161     END-IF.                                                      07516107
075162                                                                  07516207
075163     IF  PS-NO-ERROR                                              07516307
075164         INITIALIZE DPG51 DPG52 DPG53                             07516407
075165                    DPG54 DPG55 DPG56                             07516507
075166         SET  DPG51-ACTUAL-CALENDAR-ONLY                          07516607
075167              DPG51-DO-NOT-INCR-DECR-DATE                         07516707
075168                                    TO TRUE                       07516807
075169*            'CCYYMMDD'                                           07516907
075170         SET  DPG52-LK-DTE-ISO                                    07517007
075171                                    TO TRUE                       07517107
075172         MOVE PV-FROM-DATE-HOLD     TO DPG52-LK-DATE-INPUT        07517207
075173         CALL PC-CALENDAR-MODULE USING DPG51 DPG52 DPG53          07517307
075174                                       DPG54 DPG55 DPG56          07517407
075175         IF (DPG54-DATE-INVALID  OR                               07517507
075176             DPG54-SEVERE-ERROR)                                  07517607
075177             SET PS-ERROR                                         07517707
075178                 PS-DATE-ERROR                                    07517807
075179                 DP020-MSG-FATAL       TO TRUE                    07517907
075180             MOVE PC-TSYMSG-00009      TO DP020-MSG-NUMBER        07518007
075181             SET DP030-SET-CURSOR-APPL-1                          07518107
075182                                       TO TRUE                    07518207
075183         END-IF                                                   07518307
075184                                                                  07518407
075185         INITIALIZE DPG51 DPG52 DPG53                             07518507
075186                    DPG54 DPG55 DPG56                             07518607
075187         SET  DPG51-ACTUAL-CALENDAR-ONLY                          07518707
075188              DPG51-DO-NOT-INCR-DECR-DATE                         07518807
075189                                    TO TRUE                       07518907
075190*            'CCYYMMDD'                                           07519007
075191             SET  DPG52-LK-DTE-ISO                                07519107
075192                                    TO TRUE                       07519207
075193         MOVE PV-TO-DATE-HOLD       TO DPG52-LK-DATE-INPUT        07519307
075194         CALL PC-CALENDAR-MODULE USING DPG51 DPG52 DPG53          07519407
075195                                       DPG54 DPG55 DPG56          07519507
075196         IF (DPG54-DATE-INVALID                                   07519607
075197         OR  DPG54-SEVERE-ERROR)                                  07519707
075198             SET PS-ERROR                                         07519807
075199                 PS-DATE-ERROR                                    07519907
075200                 DP020-MSG-FATAL       TO TRUE                    07520007
075201             MOVE PC-TSYMSG-00009      TO DP020-MSG-NUMBER        07520107
075202             SET DP030-SET-CURSOR-APPL-1                          07520207
075203                                       TO TRUE                    07520307
075204         END-IF                                                   07520407
075205     END-IF.                                                      07520507
075206                                                                  07520636
075207     IF PS-DATE-ERROR                                             07520736
075208         MOVE DP015-UNP-ALP-BRT-OFF  TO ADATFMMA                  07520836
075209                                        ADATFDDA                  07520936
075210                                        ADATFYYA                  07521036
075211                                        ADATTMMA                  07521136
075212                                        ADATTDDA                  07521236
075213                                        ADATTYYA                  07521336
075214         MOVE DP015-RED              TO ADATFMMC                  07521436
075215                                        ADATFDDC                  07521536
075216                                        ADATFYYC                  07521636
075217                                        ADATTMMC                  07521736
075218                                        ADATTDDC                  07521836
075219                                        ADATTYYC                  07521936
075220         MOVE DP015-REVERSE          TO ADATFMMH                  07522036
075221                                        ADATFDDH                  07522136
075222                                        ADATFYYH                  07522236
075223                                        ADATTMMH                  07522336
075224                                        ADATTDDH                  07522436
075225                                        ADATTYYH                  07522536
075226         MOVE -1                     TO ADATFMML.                 07522636
075228                                                                  07522804
075229******************************************************************07522904
075231**                                                              **07523136
075232**                                                              **07523236
075233******************************************************************07523336
075234 3160-DEFAULT-DATES.                                              07523436
075235                                                                  07523536
075236     PERFORM 6000-FORMAT-CURRENT-DATE.                            07523637
075237                                                                  07523737
075238     INITIALIZE DPG51 DPG52 DPG53                                 07523836
075239                DPG54 DPG55 DPG56                                 07523936
075240     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    07524036
075241     SET  DPG51-DECREMENT-DATE        TO TRUE.                    07524136
075242****     'CCYYMMDD'                                               07524236
075243     SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    07524336
075244                                                                  07524474
075245     PERFORM 4100-GET-DEFAULT-DAYS                                07524574
075246                                                                  07524636
075247     MOVE KRPRPM-FUNC-QTY       TO DPG51-INCR-DECR-DAYS-9.        07524771
075248     MOVE PV-CURRENT-DATE-FMT   TO DPG52-LK-DATE-INPUT.           07524842
075249     CALL PC-CALENDAR-MODULE USING DPG51 DPG52 DPG53              07524942
075250                                   DPG54 DPG55 DPG56              07525042
075251     IF DPG54-DATE-VALID                                          07525144
075253        MOVE DPG55-DB2-ISO-DATE-FMT-YR    TO                      07525346
075254                       ASC-ASSIGN-FROM-DATE-YY                    07525450
075255        MOVE DPG55-DB2-ISO-DATE-FMT-MO    TO                      07525546
075256                       ASC-ASSIGN-FROM-DATE-MM                    07525650
075257        MOVE DPG55-DB2-ISO-DATE-FMT-DY    TO                      07525746
075258                       ASC-ASSIGN-FROM-DATE-DD                    07525850
075260        MOVE PV-CURRENT-DATE-FMT (1:4)    TO                      07526044
075261                       ASC-ASSIGN-TO-DATE-YY                      07526150
075262        MOVE PV-CURRENT-DATE-FMT (6:2)    TO                      07526244
075264                       ASC-ASSIGN-TO-DATE-MM                      07526450
075265        MOVE PV-CURRENT-DATE-FMT (9:2)    TO                      07526544
075267                       ASC-ASSIGN-TO-DATE-DD                      07526750
075268     ELSE                                                         07526844
075270         SET PS-ERROR                                             07527044
075271             PS-DATE-ERROR                                        07527144
075272             DP020-MSG-FATAL       TO TRUE                        07527244
075273         MOVE PC-TSYMSG-00009      TO DP020-MSG-NUMBER            07527344
075274         SET DP030-SET-CURSOR-APPL-1                              07527444
075275                                   TO TRUE                        07527544
075276     END-IF.                                                      07527644
075277                                                                  07527744
075278*                                                                 07527880
075279*** DMH BEGIN - 9/27/13                                           07527980
075280*                                                                 07528081
075281     PERFORM 4110-GET-OLDEST-ACTIVE-DATE.                         07528181
075282                                                                  07528280
075283     IF  ASC-ASSIGN-FROM-DATE  >  PV-MIN-START-WORK               07528381
075284         MOVE PV-MIN-START-WORK  TO  ASC-ASSIGN-FROM-DATE         07528481
075285     END-IF.                                                      07528581
075286                                                                  07528681
075287*                                                                 07528781
075288*** DMH END - 9/27/13                                             07528881
075289*                                                                 07528981
075290                                                                  07529081
075291                                                                  07529181
075292******************************************************************07529281
075293** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **07529381
075294** MAP.                                                         **07529481
075295******************************************************************07529581
075296 3200-RESET-ATTRIBUTES.                                           07529681
075297     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07529781
075298                                                                  07529881
075299     MOVE DP015-UNP-ALP-NOR-OFF TO AOPRUNTA                       07529981
075300                                   ASTANBRA                       07530081
075301                                   ADATFMMA                       07530181
075302                                   ADATFDDA                       07530281
075303                                   ADATFYYA                       07530381
075304                                   ADATTMMA                       07530481
075305                                   ADATTDDA                       07530581
075306                                   ADATTYYA.                      07530681
075307     MOVE DP015-GREEN          TO AOPRUNTC                        07530781
075308                                  ASTANBRC                        07530881
075309                                  ADATFMMC                        07530981
075310                                  ADATFDDC                        07531081
075311                                  ADATFYYC                        07531181
075312                                  ADATTMMC                        07531281
075313                                  ADATTDDC                        07531381
075314                                  ADATTYYC.                       07531481
075315     MOVE DP015-UNDERLINE      TO AOPRUNTH                        07531581
075316                                  ASTANBRH                        07531681
075317                                  ADATFMMH                        07531781
075318                                  ADATFDDH                        07531881
075319                                  ADATFYYH                        07531981
075320                                  ADATTMMH                        07532081
075321                                  ADATTDDH                        07532181
075322                                  ADATTYYH.                       07532281
075323                                                                  07532381
075324     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       07532481
075325*----------------------------------------------------------------*07532581
075326*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *07532681
075327*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *07532781
075328*  IT HERE.                                                      *07532881
075329*----------------------------------------------------------------*07532981
075330 4000-BUILD-INITIAL-PANEL.                                        07533081
075331                                                                  07533181
075332     PERFORM 4100-GET-STORE-INFORMATION.                          07533281
075333                                                                  07533381
075340     PERFORM 3160-DEFAULT-DATES.                                  07534081
075400                                                                  07540004
075500     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        07550004
075600                                                                  07560004
076300     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   07630010
076400     MOVE ASC-FCLTY-NME            TO AOPRNMEO.                   07640011
076401                                                                  07640144
076410     MOVE ASC-ASSIGN-FROM-DATE-MM  TO ADATFMMO.                   07641050
076420     MOVE ASC-ASSIGN-FROM-DATE-DD  TO ADATFDDO.                   07642050
076430     MOVE ASC-ASSIGN-FROM-DATE-YY  TO ADATFYYO.                   07643050
076440                                                                  07644044
076450     MOVE ASC-ASSIGN-TO-DATE-MM  TO ADATTMMO.                     07645050
076460     MOVE ASC-ASSIGN-TO-DATE-DD  TO ADATTDDO.                     07646050
076470     MOVE ASC-ASSIGN-TO-DATE-YY  TO ADATTYYO.                     07647050
076500                                                                  07650004
076600****************************************************************  07660004
076700*    GET STORE INFORMATION.                                    *  07670004
076800*                                                              *  07680004
076900****************************************************************  07690004
077000                                                                  07700004
077100 4100-GET-STORE-INFORMATION.                                      07710004
077200                                                                  07720004
077300     INITIALIZE XL071-COMMAREA.                                   07730004
077400     MOVE ASC-OPER-UNT-ID TO XL071-LOCATION-NUMBER.               07740010
077500                                                                  07750004
077600     CALL XL071-LOCATION-MODULE USING                             07760004
077700                                DFHEIBLK                          07770004
077800                                XL071-COMMAREA                    07780004
077900                                XL071-COMMAREA-REC.               07790004
078000                                                                  07800004
078100     EVALUATE TRUE                                                07810004
078200         WHEN XL071-NO-ERRORS                                     07820004
078300         WHEN XL071-DC-ASGMT-NOT-FND                              07830004
078400              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  07840011
078500                                                                  07850004
078510         WHEN XL071-LOC-NOT-FOUND                                 07851004
078520              MOVE 'STORE NAME NOT FOUND' TO ASC-FCLTY-NME        07852011
078530                                                                  07853004
078540         WHEN OTHER                                               07854004
078550              MOVE '4000-BUILD-INITIAL-PANEL'                     07855004
078560                                  TO DP013-PARAGRAPH              07856004
078570              STRING 'SELECT STORE NUMBER - '                     07857004
078580                      XL071-LOCATION-NUMBER                       07858004
078590                     ' - BAD RETURN CODE FROM XLKUT071 - '        07859004
078600                      XL071-RETURN-CODE                           07860004
078610                      DELIMITED BY SIZE                           07861004
078611                      INTO DP013-MESSAGE-TEXT (1)                 07861104
078612              STRING 'SQLCODE - '                                 07861204
078613                      XL071-SQLCODE                               07861304
078614                     ' - '                                        07861404
078615                      XL071-DB2-TABLE                             07861504
078616                      DELIMITED BY SIZE                           07861604
078617                      INTO DP013-MESSAGE-TEXT (2)                 07861704
078618              MOVE XL071-SQLCA     TO DP013-SQLCA                 07861804
078619              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)    07861904
078620              MOVE XL071-SQLCODE TO SQLCODE                       07862004
078630              SET DP013-DB2-ABEND                                 07863004
078640                  DP013-XCTL-DISPLAY-RESTART TO TRUE              07864004
078641              PERFORM DP013-0000-PROCESS-ABEND                    07864104
078642                                                                  07864204
078643     END-EVALUATE.                                                07864304
078644****************************************************************  07864471
078645*    GET DEFUALT PARM DATES FOR DATE RANGE                     *  07864571
078646*                                                              *  07864671
078647****************************************************************  07864771
078648                                                                  07864871
078649 4100-GET-DEFAULT-DAYS.                                           07864971
078650                                                                  07865071
078651     MOVE ASC-OPER-UNT-ID TO DK-OPER-UNT-ID                       07865171
078652                                                                  07865271
078656     EXEC SQL                                                     07865671
078657          SELECT FUNC_QTY                                         07865771
078658            INTO :KRPRPM-FUNC-QTY                                 07865871
078659            FROM TKRPRPM                                          07865971
078660           WHERE LOC_ID           = :DK-OPER-UNT-ID               07866071
078661             AND INTFC_SYS_CDE    = 'KHL'                         07866171
078662             AND SYS_PRC_FUNC_CDE = 'PNADYS'                      07866271
078663     END-EXEC.                                                    07866371
078664                                                                  07866471
078665     EVALUATE TRUE                                                07866571
078666         WHEN SQLCODE = ZERO                                      07866671
078667              CONTINUE                                            07866771
078668         WHEN SQLCODE = +100                                      07866871
078670         WHEN SQLCODE = -305                                      07867071
078671              MOVE +2     TO KRPRPM-FUNC-QTY                      07867171
078672         WHEN SQLWARN0 NOT = SPACE                                07867271
078673         WHEN SQLCODE NOT = ZERO                                  07867371
078674              MOVE '4100-GET-DEFAULT-DAYS '                       07867471
078675                               TO DP013-PARAGRAPH                 07867571
078676              MOVE 'SELECT QTY FOR DEFAULT DATE '                 07867671
078677                               TO DP013-MESSAGE-TEXT (1)          07867771
078678              MOVE SQLCA       TO DP013-SQLCA                     07867871
078679              SET DP013-DB2-ABEND                                 07867971
078680                               TO TRUE                            07868071
078681              PERFORM DP013-0000-PROCESS-ABEND                    07868171
078682     END-EVALUATE.                                                07868273
078683                                                                  07868371
078723                                                                  07872371
078724*----------------------------------------------------------------*07872481
078725*  GET THE OLDEST DATE FOR A TRAILER THAT IS CURRENTLY ASSIGNED  *07872581
078726*  DMH 9/27/13                                                   *07872681
078727*----------------------------------------------------------------*07872781
078728 4110-GET-OLDEST-ACTIVE-DATE.                                     07872881
078729                                                                  07872981
078730     MOVE ASC-OPER-UNT-ID TO DK-OPER-UNT-ID                       07873081
078731                                                                  07873181
078732     EXEC SQL                                                     07873281
078733          SELECT  MIN(DATE(ASGD_STRT_TMST))                       07873381
078734            INTO :PV-MIN-START-DATE                               07873481
078735            FROM SUT_PNA_TRIP_ASGMT                               07873581
078736           WHERE OPER_UNT_ID      = :DK-OPER-UNT-ID               07873684
078737             AND ACM_LBL_STA_NBR  BETWEEN 1 AND 999               07873781
078738             AND ASGD_END_TMST    = '9999-09-09-09.09.09.999999'  07873881
078739     END-EXEC.                                                    07873981
078750                                                                  07875081
078751     EVALUATE TRUE                                                07875181
078752         WHEN SQLCODE = ZERO                                      07875281
078755              MOVE  PV-MIN-FROM-YY TO PV-MIN-FROM-YY-WORK         07875581
078757              MOVE  PV-MIN-FROM-MM TO PV-MIN-FROM-MM-WORK         07875781
078759              MOVE  PV-MIN-FROM-DD TO PV-MIN-FROM-DD-WORK         07875981
078760                                                                  07876081
078766         WHEN SQLCODE = +100                                      07876681
078767         WHEN SQLCODE = -305                                      07876781
078768              MOVE ASC-ASSIGN-FROM-DATE TO PV-MIN-START-WORK      07876881
078769                                                                  07876981
078770         WHEN SQLWARN0 NOT = SPACE                                07877081
078771         WHEN SQLCODE NOT = ZERO                                  07877181
078772              MOVE '4110-GET-OLDEST-ACTIVE-DATE'                  07877281
078773                               TO DP013-PARAGRAPH                 07877381
078774              MOVE 'GET DATE OF OLDEST TRAILER  '                 07877481
078775                               TO DP013-MESSAGE-TEXT (1)          07877581
078776              MOVE SQLCA       TO DP013-SQLCA                     07877681
078777              SET DP013-DB2-ABEND                                 07877781
078778                               TO TRUE                            07877881
078779              PERFORM DP013-0000-PROCESS-ABEND                    07877981
078780     END-EVALUATE.                                                07878081
078781                                                                  07878181
078782                                                                  07878281
078783*----------------------------------------------------------------*07878381
078784*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *07878481
078785*----------------------------------------------------------------*07878581
078786 4400-MOVE-COMMAREA-TO-SCREEN.                                    07878681
078787     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   07878781
078788     MOVE ASC-FCLTY-NME            TO AOPRNMEO.                   07878881
078789     MOVE ASC-PNA-STA-NBR          TO ASTANBRO.                   07878981
078790     MOVE ASC-ASSIGN-FROM-DATE-MM  TO ADATFMMO.                   07879081
078791     MOVE ASC-ASSIGN-FROM-DATE-DD  TO ADATFDDO.                   07879181
078792     MOVE ASC-ASSIGN-FROM-DATE-YY  TO ADATFYYO.                   07879281
078800                                                                  07880048
078801     MOVE ASC-ASSIGN-TO-DATE-MM    TO ADATTMMO.                   07880150
078802     MOVE ASC-ASSIGN-TO-DATE-DD    TO ADATTDDO.                   07880250
078803     MOVE ASC-ASSIGN-TO-DATE-YY    TO ADATTYYO.                   07880350
078804                                                                  07880448
078810******************************************************************07881037
078840*                                                                 07884037
078850*                                                                 07885037
078860******************************************************************07886037
078870                                                                  07887037
078880 6000-FORMAT-CURRENT-DATE.                                        07888037
078894                                                                  07889437
078921     EXEC SQL                                                     07892137
078922        SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP             07892237
078923     END-EXEC.                                                    07892337
078924                                                                  07892437
078925     EVALUATE TRUE                                                07892537
078926        WHEN SQLCODE = +0                                         07892637
078927            CONTINUE                                              07892737
078928        WHEN OTHER                                                07892837
078930            SET DP013-DB2-ABEND                                   07893065
078931                DP013-XCTL-DISPLAY-RESTART TO TRUE                07893165
078932            PERFORM DP013-0000-PROCESS-ABEND                      07893265
078937     END-EVALUATE.                                                07893739
078938                                                                  07893865
078940*----------------------------------------------------------------*07894004
079000*    ABEND PROCESSOR MODULE                                      *07900004
079100*----------------------------------------------------------------*07910004
079200                                                                  07920004
079300     COPY DPPD013.                                                07930004
