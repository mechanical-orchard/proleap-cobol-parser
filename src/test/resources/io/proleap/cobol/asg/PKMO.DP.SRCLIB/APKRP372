000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    APKRP372.                                         00020000
000300 AUTHOR.        COGNIZANT.                                        00030000
000400 DATE-WRITTEN.  FEBRUARY 2020.                                    00040001
000500 DATE-COMPILED.                                                   00050000
000600*---------------------------------------------------------------* 00060000
000700*        IMPORT FREIGHT INVOICE REJECTION REPORT                * 00070001
000800*---------------------------------------------------------------* 00080000
000900*  PURPOSE:  TO GENERATE A REPORT OF THE INVOICE REJECTIONS.    * 00090000
001000*  THIS REPORT WILL BE FORWARDED TO TI SO THEY CAN CORRECT AND  * 00100000
001100*  RESEND THE INVALID INVOICES.  THE BUSINESS HAS REQUESTED     * 00110000
001200*  THAT THE REJECTION DATA BE PRESENTED BOTH AS A REPORT,       * 00120000
001300*  AND AS A COMMA-DELIMITED TEXT FILE THAT CAN BE OPENED IN     * 00130000
001400*  EXCEL AND MORE EASILY SHARED WITH TI.                        * 00140000
001500*---------------------------------------------------------------* 00150000
001600*                                                               * 00160000
001700*  INPUT:  REJECTED TI INVOICES   (APRD129)                     * 00170000
001800*  OUTPUT: REJECTION REPORT TEXT FILE                           * 00180001
001810*  REPORT: REJECTION REPORT                                     * 00181001
001900*---------------------------------------------------------------* 00190000
002000* CHANGES:                                                      * 00200000
002100* DATE  11/03/2020                                              * 00210001
002200* CHANGE MADE: INITIAL IMPLEMENTATION.  TR RATE MGMT RETIREMENT * 00220001
002210* PROJECT.                                                        00221001
002300* MADE BY: NANCY EILBES            WR/IR #: CHG0250510          * 00230001
002400*                                                               * 00240000
007020* DATE  05/10/2023                                              * 00242003
007030*    CHANGE MADE: RECOMPILED FOR CHANGES TO COPYBOOK APWS010    * 00243002
007050*    MADE BY: JEAN KURK               WR/IR #: CHG0288104       * 00244003
007010*                                                               * 00245002
002500***************************************************************** 00250000
002600 ENVIRONMENT DIVISION.                                            00260000
002700 CONFIGURATION SECTION.                                           00270000
002800 SOURCE-COMPUTER.        IBM-370.                                 00280000
002900 OBJECT-COMPUTER.        IBM-370.                                 00290000
003000                                                                  00300000
003100 INPUT-OUTPUT SECTION.                                            00310000
003200 FILE-CONTROL.                                                    00320000
003300     SELECT REJECT-INVC-FILE       ASSIGN TO INP01.               00330000
003400     SELECT TEXT-OUTPUT-FILE       ASSIGN TO OUT01.               00340000
003500     SELECT AP-INVC-REJECT-REPORT  ASSIGN TO RPT01.               00350000
003600                                                                  00360000
003700 DATA DIVISION.                                                   00370000
003800 FILE SECTION.                                                    00380000
003900                                                                  00390000
004000 FD  REJECT-INVC-FILE                                             00400000
004100     RECORDING MODE IS F                                          00410000
004200     LABEL RECORDS ARE STANDARD                                   00420000
004300     BLOCK CONTAINS 0 RECORDS                                     00430000
004400     DATA RECORD IS REJECT-INVC-RECORD.                           00440000
004500                                                                  00450000
004600 01  REJECT-INVC-RECORD                 PIC X(492).               00460000
004700                                                                  00470000
004800 FD  TEXT-OUTPUT-FILE                                             00480000
004900     RECORDING MODE IS F                                          00490000
005000     LABEL RECORDS ARE STANDARD                                   00500000
005100     BLOCK CONTAINS 0 RECORDS                                     00510000
005200     DATA RECORD IS TEXT-OUT-REC.                                 00520000
005300                                                                  00530000
005400 01  TEXT-OUT-REC                      PIC X(165).                00540000
005500                                                                  00550000
005600 FD  AP-INVC-REJECT-REPORT                                        00560000
005700     RECORDING MODE IS F                                          00570000
005800     LABEL RECORDS ARE STANDARD                                   00580000
005900     BLOCK CONTAINS 0 RECORDS                                     00590000
006000     DATA RECORD IS AP-INVC-REJECT-RECORD.                        00600000
006100                                                                  00610000
006200 01  AP-INVC-REJECT-RECORD              PIC X(200).               00620000
006300                                                                  00630000
006400                                                                  00640000
006500 WORKING-STORAGE SECTION.                                         00650000
006600                                                                  00660000
006700 01  END-OF-INPUT-SW                PIC X       VALUE 'N'.        00670000
006800     88  END-OF-INPUT                           VALUE 'Y'.        00680000
006900                                                                  00690000
007000 01  PS-END-OF-PTP-FILE-SW          PIC X       VALUE 'N'.        00700000
007100     88  PS-END-OF-PTP-FILE                     VALUE 'Y'.        00710000
007200                                                                  00720000
007300 01  CHRG-CDE-AREA.                                               00730000
007400     05  CHRG-ACCT-TABLE OCCURS 20 TIMES INDEXED BY PV-CHRG-IDX.  00740000
007500         10  PV-CHRG-CDE              PIC X(03).                  00750000
007600         10  PV-CHRG-AMT              PIC S9(8)V99 COMP-3         00760000
007700                                      VALUE +0.                   00770000
007800         10  PV-ERR-NBR               PIC X(02).                  00780000
007900         10  PV-ERR-MSG               PIC X(45).                  00790000
008000                                                                  00800000
008100 01  ERROR-SWITCHES.                                              00810000
008200     05  AP-DETAIL-WRITTEN-SW       PIC X       VALUE ' '.        00820000
008300         88 AP-DETAIL-WRITTEN                   VALUE 'Y'.        00830000
008400     05  AP-ERRORS-SW               PIC X       VALUE ' '.        00840000
008500         88 AP-ERRORS-END                       VALUE 'N'.        00850000
008600     05  AP-CHARGE-SW               PIC X       VALUE ' '.        00860000
008700         88 AP-CHARGE-END                       VALUE 'N'.        00870000
008800     05  AP-CHARGE-ERROR-SW         PIC X       VALUE ' '.        00880000
008900         88 AP-CHARGE-ERROR                     VALUE 'Y'.        00890000
009000                                                                  00900000
009100 01  PROGRAM-VARIABLES.                                           00910000
009200     05  PV-COUNT-AP                    PIC 9(12)       VALUE 0.  00920000
009300     05  PV-AP-RPT-OUT                  PIC 9(12)       VALUE 0.  00930000
009400     05  PV-INPUT-COUNT                 PIC 9(12)       VALUE 0.  00940000
009500     05  PV-OUTPUT-COUNT                PIC 9(12)       VALUE 0.  00950000
009600     05  PV-TEXT-OUTPUT-COUNT           PIC 9(12)                 00960000
009700                                                 VALUE 0.         00970000
009800     05  MAX-LINES                      PIC  S9(3)  COMP-3        00980000
009900                                                 VALUE +60.       00990000
010000     05  PAGE-COUNT-AP                 PIC S9(9) COMP-3 VALUE +0. 01000000
010100     05  LINE-COUNT-AP                 PIC S9(3) COMP-3 VALUE +0. 01010000
010200     05  PV-TEMP-CHRG-AMT              PIC ZZZZZZZZZ.ZZ           01020000
010300                                                 VALUE ZEROES.    01030000
010400     05  PV-TEXT-CHRG-AMT              PIC ZZZZZZZZZ.ZZ           01040000
010500                                                 VALUE ZEROES.    01050000
010600     05  PV-SYSTEM-DATE                PIC  X(08)  VALUE ZERO.    01060000
010700     05  FILLER REDEFINES PV-SYSTEM-DATE.                         01070000
010800         10  PV-SYSTEM-CCYY.                                      01080000
010900             15  PV-SYSTEM-CENTURY      PIC X(02).                01090000
011000             15  PV-SYSTEM-YEAR         PIC X(02).                01100000
011100         10  PV-SYSTEM-MONTH            PIC X(02).                01110000
011200         10  PV-SYSTEM-DAY              PIC X(02).                01120000
011300     05  PV-SYSTEM-TIME.                                          01130000
011400         10  PV-SYSTEM-HOUR         PIC  9(02)  VALUE ZERO.       01140000
011500         10  PV-SYSTEM-MINUTE       PIC  9(02)  VALUE ZERO.       01150000
011600         10  PV-SYSTEM-SECOND       PIC  9(02)  VALUE ZERO.       01160000
011700         10  FILLER                 PIC  9(02)  VALUE ZERO.       01170000
011800     05  PV-PROGRAM-NAME            PIC  X(8)   VALUE 'APKRP372'. 01180000
011900                                                                  01190000
012000*----------------------------------------------------------------*01200000
012100*    ABEND DATA AREAS                                             01210000
012200*----------------------------------------------------------------*01220000
012300                                                                  01230000
012400 01  ABEND-AREAS.                                                 01240000
012500     05  AA-ABEND-LIT              PIC  X(40)   VALUE             01250000
012600             '*****       ABEND'.                                 01260000
012700     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             01270000
012800             '*****   PROGRAM: APKRP372'.                         01280000
012900     05  AA-PARAGRAPH-LIT.                                        01290000
013000         10  FILLER                PIC  X(17)   VALUE             01300000
013100             '***** PARAGRAPH: '.                                 01310000
013200         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     01320000
013300     05  AA-MESSAGE-LINE-1.                                       01330000
013400         10  FILLER                PIC  X(06)   VALUE '*****'.    01340000
013500         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     01350000
013600     05  AA-MESSAGE-LINE-2.                                       01360000
013700         10  FILLER                PIC  X(06)   VALUE '*****'.    01370000
013800         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     01380000
013900                                                                  01390000
014000 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      01400000
014100                                   COMP         SYNC.             01410000
014200                                                                  01420000
014300     88  AC-ANY-ERROR                           VALUE  +4001      01430000
014400                                                THRU   +4019.     01440000
014500     88  AC-INVALID-KEY-WRITE                   VALUE  +4001.     01450000
014600     88  AC-INVALID-KEY-READ                    VALUE  +4002.     01460000
014700     88  AC-INVALID-CONTROL-CARD                VALUE  +4003.     01470000
014800     88  AC-OPEN-ERROR                          VALUE  +4005.     01480000
014900     88  AC-CLOSE-ERROR                         VALUE  +4006.     01490000
015000     88  AC-INVALID-DATA                        VALUE  +4008.     01500000
015100     88  AC-DB2-ERROR                           VALUE  +4013.     01510000
015200     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     01520000
015300     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     01530000
015400                                                                  01540000
015500*----------------------------------------------------------------*01550000
015600*           KOHLS STANDARD 200 CHARACTER REPORT HEADER           *01560001
015700*----------------------------------------------------------------*01570000
015800     COPY DPWS200O.                                               01580000
015900                                                                  01590000
016000 01  BLANK-LINE                PIC X(200) VALUE SPACES.           01600000
016100 01  SAVE-PRINT-LINE           PIC X(200) VALUE SPACES.           01610000
016200                                                                  01620000
016300 01  HDR-TITLE-1.                                                 01630000
016400     05  FILLER                  PIC  X(80)     VALUE SPACE.      01640001
016500     05  FILLER                  PIC  X(39)     VALUE             01650000
016600             'IMPORT FREIGHT INVOICE EXCEPTION REPORT'.           01660000
016700     05  FILLER                  PIC  X(81)     VALUE SPACE.      01670001
016800                                                                  01680000
016900 01  HEADER-1.                                                    01690000
017000     05  FILLER                PIC X(10) VALUE 'VENDOR NBR'.      01700000
017100     05  FILLER                PIC X(01) VALUE SPACES.            01710000
017200     05  FILLER                PIC X(09) VALUE 'PO NUMBER'.       01720000
017300     05  FILLER                PIC X(02) VALUE SPACES.            01730000
017400     05  FILLER                PIC X(10) VALUE 'INVOICE ID'.      01740000
017500     05  FILLER                PIC X(15) VALUE SPACES.            01750000
017600     05  FILLER                PIC X(30) VALUE 'BOL NUMBER'.      01760000
017700     05  FILLER                PIC X(02) VALUE SPACES.            01770000
017800     05  FILLER                PIC X(13) VALUE 'CONTAINER NBR'.   01780000
017900     05  FILLER                PIC X(01) VALUE SPACES.            01790000
018000     05  FILLER                PIC X(08) VALUE 'CHRG CDE'.        01800000
018100     05  FILLER                PIC X(01) VALUE SPACES.            01810000
018200     05  FILLER                PIC X(12) VALUE 'CHRG AMT'.        01820000
018300     05  FILLER                PIC X(02) VALUE SPACES.            01830000
018400     05  FILLER                PIC X(26) VALUE                    01840000
018500             'ERROR CODE AND DESCRIPTION'.                        01850000
018600     05  FILLER                PIC X(51) VALUE SPACES.            01860000
018700                                                                  01870000
018800 01  DETAIL-LINE.                                                 01880000
018900     05  DTL-VENDOR-NBR        PIC X(09) VALUE SPACES.            01890000
019000     05  FILLER                PIC X(02) VALUE SPACES.            01900000
019100     05  DTL-PO-NBR            PIC 9(09) VALUE ZEROES.            01910000
019200     05  FILLER                PIC X(02) VALUE SPACES.            01920000
019300     05  DTL-INVOICE-ID        PIC X(22) VALUE SPACES.            01930000
019400     05  FILLER                PIC X(03) VALUE SPACES.            01940000
019500     05  DTL-IMP-BOL-ID        PIC X(30) VALUE SPACES.            01950000
019600     05  FILLER                PIC X(02) VALUE SPACES.            01960000
019700     05  DTL-CNTNR-NBR         PIC X(12) VALUE SPACES.            01970000
019800     05  FILLER                PIC X(02) VALUE SPACES.            01980000
019900     05  DTL-CHRG-CDE          PIC X(03) VALUE SPACES.            01990000
020000     05  FILLER                PIC X(06) VALUE SPACES.            02000000
020100     05  DTL-CHRG-AMT          PIC ZZZZZZZZZ.ZZ VALUE ZEROES.     02010000
020200     05  FILLER                PIC X(02) VALUE SPACES.            02020000
020300     05  DTL-ERROR-NBR         PIC X(02) VALUE SPACES.            02030000
020400     05  FILLER                PIC X(03) VALUE ' - '.             02040000
020500     05  DTL-ERROR-MSG         PIC X(45) VALUE SPACES.            02050000
020600                                                                  02060000
020700 01  CHRG-ERR-DETAIL-LINE3.                                       02070000
020800     05  FILLER                 PIC X(93) VALUE SPACES.           02080000
020900     05  DTL3-CHRG-CDE          PIC X(03) VALUE SPACES.           02090000
021000     05  FILLER                 PIC X(06) VALUE SPACES.           02100000
021100     05  DTL3-CHRG-AMT          PIC X(12) VALUE SPACES.           02110000
021200     05  FILLER                 PIC X(02) VALUE SPACES.           02120000
021300     05  DTL3-ERROR-NBR         PIC X(02) VALUE SPACES.           02130000
021400     05  FILLER                 PIC X(01) VALUE SPACES.           02140000
021500     05  DTL3-HYPEN             PIC X(01) VALUE '-'.              02150000
021600     05  FILLER                 PIC X(01) VALUE SPACES.           02160000
021700     05  DTL3-ERROR-MSG         PIC X(45) VALUE SPACES.           02170000
021800                                                                  02180000
021900 01  END-OF-REPORT.                                               02190000
022000     05  FILLER                PIC X(85) VALUE SPACES.            02200000
022100     05  FILLER                PIC X(29) VALUE                    02210000
022200        '- - - - END OF REPORT - - - -'.                          02220000
022300     05  FILLER                PIC X(45) VALUE SPACES.            02230000
022400                                                                  02240000
022500 01  NO-DATA-TO-REPORT.                                           02250000
022600     05  FILLER                PIC X(82) VALUE SPACES.            02260000
022700     05  FILLER                PIC X(36) VALUE                    02270000
022800        'NO DATA FOR INVOICE REJECTION REPORT'.                   02280000
022900     05  FILLER                PIC X(41) VALUE SPACES.            02290000
023000                                                                  02300000
023100 01  TEXT-HEADER.                                                 02310000
023200     05  FILLER                PIC X(09) VALUE 'VNDR NBR'.        02320000
023300     05  FILLER                PIC X(01) VALUE ','.               02330000
023400     05  FILLER                PIC X(09) VALUE 'PO NBR'.          02340000
023500     05  FILLER                PIC X(01) VALUE ','.               02350000
023600     05  FILLER                PIC X(22) VALUE 'INVOICE ID'.      02360000
023700     05  FILLER                PIC X(01) VALUE ','.               02370000
023800     05  FILLER                PIC X(30) VALUE 'BOL NUMBER'.      02380000
023900     05  FILLER                PIC X(01) VALUE ','.               02390000
024000     05  FILLER                PIC X(12) VALUE 'CONTNR NBR'.      02400000
024100     05  FILLER                PIC X(01) VALUE ','.               02410000
024200     05  FILLER                PIC X(08) VALUE 'CHRG CDE'.        02420000
024300     05  FILLER                PIC X(01) VALUE ','.               02430000
024400     05  FILLER                PIC X(12) VALUE 'CHRG AMT'.        02440000
024500     05  FILLER                PIC X(01) VALUE ','.               02450000
024600     05  FILLER                PIC X(10) VALUE                    02460000
024700             'ERROR CODE'.                                        02470000
024800     05  FILLER                PIC X(01) VALUE ','.               02480000
024900     05  FILLER                PIC X(17) VALUE                    02490000
025000             'ERROR DESCRIPTION'.                                 02500000
025100     05  FILLER                PIC X(28) VALUE SPACES.            02510000
025200                                                                  02520000
025300                                                                  02530000
025400 01  TI-TEXT-RECORD.                                              02540000
025500     05  AP-VENDOR-NBR         PIC X(09) VALUE SPACES.            02550000
025600     05  FILLER                PIC X(01) VALUE ','.               02560000
025700     05  AP-PO-NBR             PIC 9(09) VALUE ZEROES.            02570000
025800     05  FILLER                PIC X(01) VALUE ','.               02580000
025900     05  AP-INVOICE-ID         PIC X(22) VALUE SPACES.            02590000
026000     05  FILLER                PIC X(01) VALUE ','.               02600000
026100     05  AP-IMP-BOL-ID         PIC X(30) VALUE SPACES.            02610000
026200     05  FILLER                PIC X(01) VALUE ','.               02620000
026300     05  AP-CNTNR-NBR          PIC X(12) VALUE SPACES.            02630000
026400     05  FILLER                PIC X(01) VALUE ','.               02640000
026500     05  AP-CHRG-CDE           PIC X(03) VALUE SPACES.            02650000
026600     05  FILLER                PIC X(05) VALUE SPACES.            02660000
026700     05  FILLER                PIC X(01) VALUE ','.               02670000
026800     05  AP-CHRG-AMT           PIC ZZZZZZZZZ.ZZ VALUE ZEROES.     02680000
026900     05  FILLER                PIC X(01) VALUE ','.               02690000
027000     05  AP-ERROR-NBR          PIC X(02) VALUE SPACES.            02700000
027100     05  FILLER                PIC X(08) VALUE SPACES.            02710000
027200     05  FILLER                PIC X(01) VALUE ','.               02720000
027300     05  AP-ERROR-MSG          PIC X(45) VALUE SPACES.            02730000
027400                                                                  02740000
027500 01  TI-TEXT-ERROR-ONLY-RECORD.                                   02750000
027600     05  AP1-VENDOR-NBR         PIC X(09) VALUE SPACES.           02760000
027700     05  FILLER                 PIC X(01) VALUE ','.              02770000
027800     05  AP1-PO-NBR             PIC 9(09) VALUE ZEROES.           02780000
027900     05  FILLER                 PIC X(01) VALUE ','.              02790000
028000     05  AP1-INVOICE-ID         PIC X(22) VALUE SPACES.           02800000
028100     05  FILLER                 PIC X(01) VALUE ','.              02810000
028200     05  AP1-IMP-BOL-ID         PIC X(30) VALUE SPACES.           02820000
028300     05  FILLER                 PIC X(01) VALUE ','.              02830000
028400     05  AP1-CNTNR-NBR          PIC X(12) VALUE SPACES.           02840000
028500     05  FILLER                 PIC X(01) VALUE ','.              02850000
028600     05  AP1-CHRG-CDE           PIC X(03) VALUE SPACES.           02860000
028700     05  FILLER                 PIC X(05) VALUE SPACES.           02870000
028800     05  FILLER                 PIC X(01) VALUE ','.              02880000
028900     05  AP1-CHRG-AMT           PIC X(12) VALUE SPACES.           02890000
029000     05  FILLER                 PIC X(01) VALUE ','.              02900000
029100     05  AP1-ERROR-NBR          PIC X(02) VALUE SPACES.           02910000
029200     05  FILLER                 PIC X(08) VALUE SPACES.           02920000
029300     05  FILLER                 PIC X(01) VALUE ','.              02930000
029400     05  AP1-ERROR-MSG          PIC X(45) VALUE SPACES.           02940000
029500                                                                  02950000
029600*--------------------------------------------------------------*  02960000
029700*  APRD129 RECORD LAYOUT FOR EDI IMPORT INVOICE REJECTION FILE *  02970000
029800*--------------------------------------------------------------*  02980000
029900     COPY APRD129.                                                02990000
030000                                                                  03000000
030100*--------------------------------------------------------------*  03010000
030200*  APWS010 RECORD LAYOUT FOR ERROR MESSAGE REPORTING           *  03020000
030300*--------------------------------------------------------------*  03030000
030400 01  WS-EDIT-CODES.                                               03040000
030500     COPY APWS010.                                                03050000
030600                                                                  03060000
030700 LINKAGE SECTION.                                                 03070000
030800                                                                  03080000
030900 PROCEDURE DIVISION.                                              03090000
031000                                                                  03100000
031100 A100-MAINLINE-ROUTINE.                                           03110000
031200                                                                  03120000
031300     PERFORM B100-INITIALIZATION.                                 03130000
031400                                                                  03140000
031500     PERFORM B200-CREATE-REJECT-RPTS                              03150000
031600       UNTIL END-OF-INPUT.                                        03160000
031700                                                                  03170000
031800     PERFORM B300-TERMINATION.                                    03180000
031900                                                                  03190000
032000     GOBACK.                                                      03200000
032100                                                                  03210000
032200*--------------------------------------------------------------*  03220000
032300* B100-INITIALIZATION                                          *  03230000
032400*  INITIALIZATION PROCESSING.                                  *  03240000
032500*--------------------------------------------------------------*  03250000
032600 B100-INITIALIZATION.                                             03260000
032700                                                                  03270000
032800     DISPLAY ' '.                                                 03280000
032900     DISPLAY 'BEGINNING APKRP372 '.                               03290000
033000                                                                  03300000
033100     OPEN INPUT  REJECT-INVC-FILE                                 03310000
033200          OUTPUT TEXT-OUTPUT-FILE                                 03320000
033300                 AP-INVC-REJECT-REPORT                            03330000
033400                                                                  03340000
033500     MOVE FUNCTION CURRENT-DATE TO PV-SYSTEM-DATE                 03350000
033600     MOVE PV-SYSTEM-MONTH        TO DP200O-RUN-MONTH.             03360000
033700     MOVE PV-SYSTEM-DAY          TO DP200O-RUN-DAY.               03370000
033800     MOVE PV-SYSTEM-YEAR         TO DP200O-RUN-YEAR.              03380000
033900     ACCEPT PV-SYSTEM-TIME FROM TIME.                             03390000
034000     MOVE PV-SYSTEM-HOUR         TO DP200O-RUN-HOUR.              03400000
034100     MOVE PV-SYSTEM-MINUTE       TO DP200O-RUN-MINUTE.            03410000
034200     MOVE PV-PROGRAM-NAME        TO DP200O-PROGRAM-NAME.          03420000
034300                                                                  03430000
034400     PERFORM W100-WRITE-AP-HEADINGS.                              03440000
034500                                                                  03450000
034600     PERFORM R100-READ-INPUT.                                     03460000
034700                                                                  03470000
034800     IF END-OF-INPUT                                              03480000
034900         DISPLAY '!!!! NO RECORDS TO PROCESS !!!!'                03490000
035000         DISPLAY '!!!! NO RECORDS TO PROCESS !!!!'                03500000
035100         WRITE AP-INVC-REJECT-RECORD FROM NO-DATA-TO-REPORT       03510000
035200             AFTER ADVANCING 1 LINE                               03520000
035300     ELSE                                                         03530000
035400          MOVE 4095       TO RETURN-CODE                          03540000
035500     END-IF.                                                      03550000
035600     WRITE TEXT-OUT-REC FROM TEXT-HEADER.                         03560000
035700                                                                  03570000
035800*--------------------------------------------------------------*  03580000
035900*  B200-CREATE-REJECT-RPT                                      *  03590000
036000*   THIS ROUTINE HOLDS THE MAIN LOGIC FOR REJECTION REPORTING. *  03600000
036100*--------------------------------------------------------------*  03610000
036200 B200-CREATE-REJECT-RPTS.                                         03620000
036300                                                                  03630000
036400     INITIALIZE ERROR-SWITCHES.                                   03640000
036500     INITIALIZE DETAIL-LINE.                                      03650000
036600     INITIALIZE TI-TEXT-ERROR-ONLY-RECORD.                        03660000
036700     SET CHRG-IDX TO 1.                                           03670000
036800     SET AP129-IDX TO 1.                                          03680000
036900     SET MSG-IDX TO AP129-ERR-CDE(AP129-IDX)                      03690000
037000     MOVE AP129-VND-NBR           TO DTL-VENDOR-NBR               03700000
037100                                     AP-VENDOR-NBR                03710000
037200                                     AP1-VENDOR-NBR.              03720000
037300     MOVE AP129-PO-NBR            TO DTL-PO-NBR                   03730000
037400                                     AP-PO-NBR                    03740000
037500                                     AP1-PO-NBR.                  03750000
037600     MOVE AP129-INVC-ID           TO DTL-INVOICE-ID               03760000
037700                                     AP-INVOICE-ID                03770000
037800                                     AP1-INVOICE-ID.              03780000
037900     MOVE AP129-CONTAINER-NBR     TO DTL-CNTNR-NBR                03790000
038000                                     AP-CNTNR-NBR                 03800000
038100                                     AP1-CNTNR-NBR.               03810000
038200     MOVE AP129-IMPRT-BOL-ID      TO DTL-IMP-BOL-ID               03820000
038300                                     AP-IMP-BOL-ID                03830000
038400                                     AP1-IMP-BOL-ID.              03840000
038500     MOVE AP129-CHRG-CDE(CHRG-IDX) TO DTL-CHRG-CDE                03850000
038600                                      AP-CHRG-CDE                 03860000
038700                                      AP1-CHRG-CDE.               03870000
038800     MOVE AP129-CHRG-AMT(CHRG-IDX) TO DTL-CHRG-AMT                03880000
038900                                      AP-CHRG-AMT                 03890000
039000                                      AP1-CHRG-AMT.               03900000
039100     MOVE AP129-ERR-CDE(AP129-IDX) TO DTL-ERROR-NBR               03910000
039200                                      AP-ERROR-NBR                03920000
039300                                      AP1-ERROR-NBR.              03930000
039400     MOVE WS010-ERROR-MSG(MSG-IDX) TO DTL-ERROR-MSG               03940000
039500                                      AP-ERROR-MSG                03950000
039600                                      AP1-ERROR-MSG.              03960000
039700     PERFORM W200-WRITE-DETAIL-AP.                                03970000
039800     PERFORM W400-WRITE-TEXT-FILE.                                03980000
039900     PERFORM C100-PROCESS-CHARGE-ERROR.                           03990000
040000     PERFORM R100-READ-INPUT.                                     04000000
040100                                                                  04010000
040200*--------------------------------------------------------------*  04020000
040300* B300-TERMINATION                                             *  04030000
040400*  END OF PROGRAM PROCESSING.                                  *  04040000
040500*--------------------------------------------------------------*  04050000
040600 B300-TERMINATION.                                                04060000
040700                                                                  04070000
040800     DISPLAY '*** PROCESSING SUMMARY FOR APKRP372 ***'.           04080000
040900     DISPLAY 'INPUT RECORDS READ   = ' PV-INPUT-COUNT.            04090000
041000     DISPLAY 'AP ERRORS REPORTED   = ' PV-AP-RPT-OUT.             04100000
041100     DISPLAY 'RECORDS TO OUTPUT FILE  = ' PV-OUTPUT-COUNT.        04110000
041200     DISPLAY 'RECORDS TO TEXT FILE  = ' PV-TEXT-OUTPUT-COUNT.     04120000
041300     DISPLAY '*************************************'.             04130000
041400                                                                  04140000
041500     CLOSE REJECT-INVC-FILE                                       04150000
041600           TEXT-OUTPUT-FILE                                       04160000
041700           AP-INVC-REJECT-REPORT.                                 04170000
041800                                                                  04180000
041900*--------------------------------------------------------------*  04190000
042000* C100-PROCESS-CHARGE-ERROR.                                   *  04200000
042100* PROCESS THE CHARGE AND ERROR DETAILS TO REPORT AND TEXT FILE *  04210000
042200*--------------------------------------------------------------*  04220000
042300 C100-PROCESS-CHARGE-ERROR.                                       04230000
042400                                                                  04240000
042500         SET CHRG-IDX TO 2.                                       04250000
042600         SET AP129-IDX TO 2.                                      04260000
042700         PERFORM VARYING PV-CHRG-IDX FROM 2 BY 1                  04270000
042800           UNTIL PV-CHRG-IDX > 20                                 04280000
042900              OR (AP-CHARGE-END AND AP-ERRORS-END)                04290000
043000                SET MSG-IDX TO AP129-ERR-CDE(AP129-IDX)           04300000
043100                MOVE AP129-CHRG-CDE(CHRG-IDX) TO DTL3-CHRG-CDE    04310000
043200                                                 AP1-CHRG-CDE     04320000
043300                MOVE AP129-CHRG-AMT(CHRG-IDX) TO PV-TEMP-CHRG-AMT 04330000
043400                                                 PV-TEXT-CHRG-AMT 04340000
043500                MOVE AP129-ERR-CDE(AP129-IDX) TO DTL3-ERROR-NBR   04350000
043600                                                 AP1-ERROR-NBR    04360000
043700                MOVE WS010-ERROR-MSG(MSG-IDX) TO DTL3-ERROR-MSG   04370000
043800                                                 AP1-ERROR-MSG    04380000
043900                IF DTL3-CHRG-CDE = SPACES                         04390000
044000                   SET AP-CHARGE-END TO TRUE                      04400000
044100                   INITIALIZE DTL3-CHRG-CDE                       04410000
044200                              DTL3-CHRG-AMT                       04420000
044300                              AP1-CHRG-CDE                        04430000
044400                              AP1-CHRG-AMT                        04440000
044500                ELSE                                              04450000
044600                   MOVE PV-TEMP-CHRG-AMT TO DTL3-CHRG-AMT         04460000
044700                   MOVE PV-TEXT-CHRG-AMT TO AP1-CHRG-AMT          04470000
044800                END-IF                                            04480000
044900                IF DTL3-ERROR-NBR = SPACES OR '00'                04490000
045000                   SET AP-ERRORS-END TO TRUE                      04500000
045100                   INITIALIZE DTL3-ERROR-NBR                      04510000
045200                              DTL3-ERROR-MSG                      04520000
045300                              DTL3-HYPEN                          04530000
045400                              AP1-ERROR-NBR                       04540000
045500                              AP1-ERROR-MSG                       04550000
045600                END-IF                                            04560000
045700                IF AP-CHARGE-END AND AP-ERRORS-END                04570000
045800                 CONTINUE                                         04580000
045900              ELSE                                                04590000
046000                 PERFORM W300-WRITE-CHRG-ERROR-AP                 04600000
046100                 PERFORM W500-WRITE-CHRG-ERROR-FILE               04610000
046200              END-IF                                              04620000
046300             SET CHRG-IDX UP BY 1                                 04630000
046400             SET AP129-IDX UP BY 1                                04640000
046500         END-PERFORM                                              04650000
046600                                                                  04660000
046700     SET CHRG-IDX TO 1.                                           04670000
046800     SET AP129-IDX TO 1.                                          04680000
046900     SET CHRG-IDX DOWN BY 1.                                      04690000
047000     SET AP129-IDX DOWN BY 1.                                     04700000
047100                                                                  04710000
047200*--------------------------------------------------------------*  04720000
047300* R100-READ-INPUT                                              *  04730000
047400*  READS THE INPUT FILE.                                       *  04740000
047500*--------------------------------------------------------------*  04750000
047600 R100-READ-INPUT.                                                 04760000
047700                                                                  04770000
047800     READ REJECT-INVC-FILE INTO AP129-FRGT-INV-REJECT-RECORD      04780000
047900       AT END SET END-OF-INPUT TO TRUE.                           04790000
048000                                                                  04800000
048100     IF END-OF-INPUT                                              04810000
048200        CONTINUE                                                  04820000
048300     ELSE                                                         04830000
048400        ADD 1 TO PV-INPUT-COUNT                                   04840000
048500     END-IF.                                                      04850000
048600                                                                  04860000
048700*----------------------------------------------------------------*04870000
048800* W100-WRITE-AP-HEADINGS                                         *04880000
048900*  PRODUCE THE PAGE HEADINGS FOR THE REPORT.                     *04890000
049000*----------------------------------------------------------------*04900000
049100 W100-WRITE-AP-HEADINGS.                                          04910000
049200                                                                  04920000
049300     ADD 1 TO PAGE-COUNT-AP.                                      04930000
049400     MOVE PAGE-COUNT-AP TO DP200O-PAGE-NUMBER.                    04940000
049500     MOVE '1'    TO DP200O-REPORT-NUMBER.                         04950000
049600     WRITE AP-INVC-REJECT-RECORD FROM                             04960000
049700                                  DP200O-STANDRD-HEADER-200-COLS  04970000
049800         AFTER ADVANCING PAGE.                                    04980000
049900     WRITE AP-INVC-REJECT-RECORD FROM HDR-TITLE-1                 04990000
050000         AFTER ADVANCING 1 LINE.                                  05000000
050100     WRITE AP-INVC-REJECT-RECORD FROM BLANK-LINE.                 05010000
050200     WRITE AP-INVC-REJECT-RECORD FROM HEADER-1                    05020000
050300           AFTER ADVANCING 2 LINES.                               05030000
050400     MOVE +6            TO LINE-COUNT-AP.                         05040000
050500                                                                  05050000
050600*--------------------------------------------------------------*  05060000
050700*  W200-WRITE-DETAIL-AP                                        *  05070000
050800*   THIS ROUTINE WRITES THE DETAIL LINES TO THE AP REPORT.     *  05080000
050900*--------------------------------------------------------------*  05090000
051000 W200-WRITE-DETAIL-AP.                                            05100000
051100                                                                  05110000
051200     IF LINE-COUNT-AP >= MAX-LINES                                05120000
051300        PERFORM W100-WRITE-AP-HEADINGS                            05130000
051400            WRITE AP-INVC-REJECT-RECORD FROM DETAIL-LINE          05140000
051500            ADD 2 TO LINE-COUNT-AP                                05150000
051600            ADD 1 TO PV-AP-RPT-OUT                                05160000
051700     END-IF.                                                      05170000
051800                                                                  05180000
051900         WRITE AP-INVC-REJECT-RECORD FROM BLANK-LINE.             05190000
052000         WRITE AP-INVC-REJECT-RECORD FROM DETAIL-LINE.            05200000
052100         ADD 2 TO LINE-COUNT-AP.                                  05210000
052200         ADD 1 TO PV-AP-RPT-OUT.                                  05220000
052300                                                                  05230000
052400*----------------------------------------------------------------*05240000
052500*    WRITE CHARGES AND ERROR RECORDS TO REPORT                   *05250000
052600*----------------------------------------------------------------*05260000
052700 W300-WRITE-CHRG-ERROR-AP.                                        05270000
052800                                                                  05280000
052900     WRITE AP-INVC-REJECT-RECORD FROM CHRG-ERR-DETAIL-LINE3       05290000
053000     ADD 1 TO PV-OUTPUT-COUNT.                                    05300000
053100                                                                  05310000
053200*----------------------------------------------------------------*05320000
053300*    WRITE RECORDS TO TEXT FILE.                                 *05330000
053400*----------------------------------------------------------------*05340000
053500 W400-WRITE-TEXT-FILE.                                            05350000
053600                                                                  05360000
053700     WRITE TEXT-OUT-REC FROM TI-TEXT-RECORD.                      05370000
053800     ADD 1 TO PV-TEXT-OUTPUT-COUNT.                               05380000
053900                                                                  05390000
054000*----------------------------------------------------------------*05400000
054100*    WRITE CHARGES AND ERROR RECORDS TO FILE                     *05410000
054200*----------------------------------------------------------------*05420000
054300 W500-WRITE-CHRG-ERROR-FILE.                                      05430000
054400                                                                  05440000
054500     WRITE TEXT-OUT-REC FROM TI-TEXT-ERROR-ONLY-RECORD            05450000
054600     ADD 1 TO PV-TEXT-OUTPUT-COUNT.                               05460000
054700                                                                  05470000
