000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.             RCKUT194.                                00040001
000500 AUTHOR.                 DENISE HAHN.                             00050001
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060001
000700 DATE-WRITTEN.           MAY, 2022.                               00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*                                                               * 00100001
001100*  THIS PROGRAM WILL USE A CURSOR TO DETERMINE IF THERE ARE ANY * 00110001
001200*  DC PREPACK RECEIVERS WHERE AT LEAST 1 LINE ON THE PREPACK    * 00120001
001300*  IS VERIFIED, BUT NOT ALL LINES ON THE PREPACK ARE VERIFIED.  * 00130001
001400*                                                               * 00140001
001410*  THE OUTPUT FILE(S) WILL BE USED TO SEND AN EARLY ALERT TO    * 00141001
001420*  THE DC(S) TO HAVE THEM FIX THE ISSUE.                        * 00142001
001430*                                                               * 00143001
001440*  STEPS THAT WOULD NEED TO BE PERFORMED TO FIX THE ISSUE.      * 00144001
001450*  - UNVERIFY THE LINE(S) ON THE PREPACK THAT ARE VERIFIED      * 00145001
001460*    USING THE CICS SCREEN                                      * 00146001
001470*  - RESOLVE THE UNVERIFY TROUBLE                               * 00147001
001480*  - RESTART THE WORK ORDER                                     * 00148001
001481*  - HOT COMPLETE THE WORK ORDER INSTRUCTION                    * 00148101
001490***************************************************************** 00149001
001500 ENVIRONMENT DIVISION.                                            00150001
001600***************************************************************** 00160002
003600 INPUT-OUTPUT SECTION.                                            00360002
003700                                                                  00370002
003800 FILE-CONTROL.                                                    00380002
003900                                                                  00390002
004300     SELECT ERROR-OUT-FILE                                        00430002
004400         ASSIGN TO OUT01.                                         00440002
004500                                                                  00450002
004600***************************************************************** 00460002
004700 DATA DIVISION.                                                   00470002
004800***************************************************************** 00480002
004900 FILE SECTION.                                                    00490002
005000                                                                  00500002
005800 FD  ERROR-OUT-FILE                                               00580002
005900     RECORDING MODE IS F                                          00590002
006000     BLOCK CONTAINS 0 RECORDS                                     00600002
006100     LABEL RECORDS ARE STANDARD.                                  00610002
006200                                                                  00620002
006300 01  ERROR-OUT-RECORD             PIC X(80).                      00630002
006400                                                                  00640002
006500***************************************************************** 00650002
006600 WORKING-STORAGE SECTION.                                         00660002
006700                                                                  00670002
006800***************************************************************** 00680002
006900*    INPUT CONTROL CARD                                           00690002
007100***************************************************************** 00710002
007200 01  CC-CONTROL-CARD.                                             00720002
007300     05  CC-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    00730002
007400     05  FILLER                      PIC X(03)     VALUE SPACES.  00740002
007500     05  CC-FCLTY-NAME               PIC X(20)     VALUE SPACES.  00750002
007600                                                                  00760002
007700 01  DK-DB2-KEYS.                                                 00770002
007800     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00780002
007900                                                   COMP SYNC.     00790002
008000                                                                  00800002
008800 01  PS-PROGRAM-SWITCHES.                                         00880002
008900     05  PS-EOF-ERROR-CSR-SW          PIC X(01)  VALUE 'N'.       00890002
009000         88  PS-EOF-ERROR-CSR-YES                VALUE 'Y'.       00900002
009100         88  PS-EOF-ERROR-CSR-NO                 VALUE 'N'.       00910002
009110     05  PS-FIRST-REC-SW              PIC X(01)  VALUE 'N'.       00911013
009120         88  PS-FIRST-REC                        VALUE 'Y'.       00912013
009130         88  PS-FIRST-REC-NO                     VALUE 'N'.       00913013
009200                                                                  00920002
009300 01  PC-PROGRAM-CONSTANTS.                                        00930002
009400     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'RCKUT194'.00940002
009500                                                                  00950002
010000     05  PV-REC-CNT                   PIC  9(09) VALUE  0.        01000002
010200     05  PV-ERR-CNT                   PIC S9(09) COMP VALUE +0.   01020002
010500     05  PV-SQL-RETURN-CD             PIC -9(04).                 01050002
010600     05  PV-DISPLAY-ERR               PIC -9(04).                 01060002
011000                                                                  01100002
011100 01  PV-ABEND-FIELDS.                                             01110002
011200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01120002
011300     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    01130002
011400     05  PV-DB2-MESSAGE               PIC  X(50) VALUE SPACES.    01140002
011500     05  PV-ABEND-CODE                PIC S9(04) COMP SYNC        01150002
011600                                                 VALUE +0.        01160002
011700                                                                  01170002
011800 01  HEADING-OUT.                                                 01180002
011900     05  HEAD-REC                     PIC X(80)   VALUE SPACES.   01190002
011910                                                                  01191003
012000 01  RECORD-OUT.                                                  01200002
012100     05  FILLER                       PIC X(01)   VALUE SPACES.   01210010
012200     05  OUT-OPER                     PIC ZZZ9    VALUE ZEROES.   01220010
012300     05  FILLER                       PIC X(01)   VALUE '-'.      01230010
012400     05  OUT-PO                       PIC 9(09)   VALUE ZEROES.   01240010
012600     05  FILLER                       PIC X(01)   VALUE '-'.      01260010
012700     05  OUT-RCVR                     PIC 9(04)   VALUE ZEROES.   01270010
012800     05  FILLER                       PIC X(09)   VALUE           01280010
012810                                                  '   PREPK:'.    01281011
012900     05  OUT-PREPK                    PIC 9(04)   VALUE ZEROES.   01290010
012940     05  FILLER                       PIC X(27)   VALUE SPACES.   01294023
013001                                                                  01300103
013010     COPY RCRD123.                                                01301003
013020                                                                  01302003
013100                                                                  01310002
013200* * * TRECEIV TABLE                                               01320002
013300     EXEC SQL                                                     01330002
013400         INCLUDE TRECEIV                                          01340006
013500     END-EXEC.                                                    01350002
013600                                                                  01360002
013620* * * TRECITM TABLE                                               01362002
013630     EXEC SQL                                                     01363002
013640         INCLUDE TRECITM                                          01364002
013650     END-EXEC.                                                    01365002
013660                                                                  01366002
013700* * * COMMUNICATIONS AREA FOR DB2                                 01370002
013800     EXEC SQL                                                     01380002
013900          INCLUDE SQLCA                                           01390002
014000     END-EXEC.                                                    01400002
014100                                                                  01410002
014200**DECLARE THE ERROR-REC-CSR                                       01420002
014300     EXEC SQL                                                     01430002
014400          DECLARE ERROR-REC-CSR CURSOR FOR                        01440002
014510           SELECT DISTINCT                                        01451022
014511                  A.OPER_UNT_ID                                   01451122
014520                , A.ORD_NBR                                       01452002
014530                , A.REC_SEQ_NBR                                   01453002
014570                , B.PREPK_ID                                      01457002
015000             FROM TRECEIV A                                       01500002
015100                , TRECITM B                                       01510002
015200                , TRECITM C                                       01520002
015300            WHERE A.STATUS_CDE  IN ('IP','CM')                    01530002
015400              AND A.PKGNG_CDE         = 'M'                       01540002
015500              AND A.ORD_NBR           =  B.ORD_NBR                01550002
015510              AND A.REC_SEQ_NBR       =  B.REC_SEQ_NBR            01551002
015511              AND A.CURR_OPER_UNT_ID  = :DK-OPER-UNT-ID           01551102
015520              AND B.STATUS_CDE        = 'VE'                      01552002
015530              AND B.ORD_NBR           =  C.ORD_NBR                01553002
015540              AND B.REC_SEQ_NBR       =  C.REC_SEQ_NBR            01554002
015550              AND B.ORD_LNE_NBR      <>  C.ORD_LNE_NBR            01555002
015560              AND B.PREPK_ID          =  C.PREPK_ID               01556002
015570              AND C.STATUS_CDE       <>  B.STATUS_CDE             01557002
015580            ORDER BY A.OPER_UNT_ID                                01558002
015590                   , A.ORD_NBR                                    01559002
015591                   , A.REC_SEQ_NBR                                01559102
015592                   , B.PREPK_ID                                   01559202
015593**                 , C.ORD_LNE_NBR                                01559322
015594           WITH UR                                                01559402
016500     END-EXEC.                                                    01650002
016600                                                                  01660002
016700     COPY DPWS004.                                                01670002
016800                                                                  01680002
016900                                                                  01690002
017000***************************************************************** 01700002
017100 PROCEDURE DIVISION.                                              01710002
017200***************************************************************** 01720002
017300                                                                  01730002
017500     OPEN OUTPUT ERROR-OUT-FILE.                                  01750002
017501                                                                  01750109
017510     MOVE SPACES                        TO HEAD-REC.              01751009
017520     MOVE  'PROGRAM - RCKUT194'         TO HEAD-REC.              01752009
017530     DISPLAY HEAD-REC.                                            01753009
017540                                                                  01754009
017550     MOVE SPACES                        TO HEAD-REC.              01755009
017570     DISPLAY HEAD-REC.                                            01757009
017580                                                                  01758009
017800     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01780002
017900                                                                  01790002
018000     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              01800002
018100                                                                  01810002
018200     MOVE CC-OPER-UNT-ID       TO DK-OPER-UNT-ID.                 01820002
018300                                                                  01830002
018400     MOVE '*****************************************'             01840002
018500                                        TO HEAD-REC.              01850002
018600     DISPLAY HEAD-REC.                                            01860002
018700     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01870002
018800                                                                  01880002
019300     MOVE  CC-CONTROL-CARD              TO HEAD-REC.              01930002
019400     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01940002
019600                                                                  01960002
019740     MOVE SPACES                        TO HEAD-REC.              01974002
019750     DISPLAY HEAD-REC.                                            01975002
019760     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        01976002
019770                                                                  01977002
019817     SET  PS-FIRST-REC                  TO TRUE.                  01981713
019818                                                                  01981802
019900     PERFORM 2000-OPEN-ERROR-CSR.                                 01990002
020000     PERFORM 2010-FETCH-ERROR-CSR                                 02000002
020100         UNTIL PS-EOF-ERROR-CSR-YES.                              02010002
020200     PERFORM 2020-CLOSE-ERROR-CSR.                                02020002
020300                                                                  02030002
020400     MOVE SPACES  TO  HEAD-REC.                                   02040002
020500     DISPLAY HEADING-OUT.                                         02050002
020600     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02060002
020700                                                                  02070002
020710     IF PV-REC-CNT > 0                                            02071016
020840         MOVE SPACES                TO HEAD-REC                   02084016
020850         MOVE '*****************************************'         02085016
020860                                    TO HEAD-REC                   02086016
020870         DISPLAY HEAD-REC                                         02087016
020880         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02088016
020890                                                                  02089016
020891         MOVE SPACES                TO HEAD-REC                   02089116
020892         DISPLAY HEAD-REC                                         02089216
020893         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02089316
020894                                                                  02089416
020895         MOVE SPACES                TO HEAD-REC                   02089516
020896         STRING  'PLEASE PERFORM THE STEPS BELOW TO '             02089616
020897                 'VERIFY THE RECEIVER' DELIMITED BY SIZE          02089718
020898                                  INTO HEAD-REC                   02089816
020899         DISPLAY HEAD-REC                                         02089916
020900         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02090016
020901                                                                  02090116
020902         MOVE SPACES                TO HEAD-REC                   02090220
020906         DISPLAY HEAD-REC                                         02090620
020907         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02090720
020908                                                                  02090820
020909         MOVE SPACES                TO HEAD-REC                   02090919
020910         STRING  '- DCMENU ==> RCMENU  => RCSVRCT '               02091016
020911                 '(RECEIPT VERIFICATION)' DELIMITED BY SIZE       02091116
020912                                  INTO HEAD-REC                   02091216
020913         DISPLAY HEAD-REC                                         02091316
020914         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02091416
020915                                                                  02091516
020916         MOVE SPACES                TO HEAD-REC                   02091619
020917         STRING  '- KEY IN THE PO-RCVR '                          02091716
020918                                        DELIMITED BY SIZE         02091821
020919                                  INTO HEAD-REC                   02091916
020920                                                                  02092019
020921         DISPLAY HEAD-REC                                         02092116
020922         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02092216
020923                                                                  02092316
020924                                                                  02092421
020925         MOVE SPACES                TO HEAD-REC                   02092521
020927         STRING  '- F24 - PACK LIST '    DELIMITED BY SIZE        02092721
020928                                  INTO HEAD-REC                   02092821
020929                                                                  02092921
020930         DISPLAY HEAD-REC                                         02093021
020931         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02093121
020932                                                                  02093221
020933         MOVE SPACES                TO HEAD-REC                   02093319
020934         STRING  '- SELECT THE LINE SHOWING PREPACK THAT IS'      02093416
020935                 ' VERIFIED'            DELIMITED BY SIZE         02093516
020936                                  INTO HEAD-REC                   02093616
020937         DISPLAY HEAD-REC                                         02093716
020938         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02093816
020939                                                                  02093916
020940         MOVE SPACES                TO HEAD-REC                   02094019
020941         STRING  '- F17 - UNVERIFY'                               02094116
020942                                        DELIMITED BY SIZE         02094216
020943                                  INTO HEAD-REC                   02094316
020944         DISPLAY HEAD-REC                                         02094416
020945         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02094516
020946                                                                  02094616
020947                                                                  02094716
020948         MOVE SPACES                TO HEAD-REC                   02094819
020949         STRING  '- RESOLVE THE UNVERIFY TROUBLE'                 02094921
020950                                        DELIMITED BY SIZE         02095017
020951                                  INTO HEAD-REC                   02095116
020952         DISPLAY HEAD-REC                                         02095216
020953         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02095316
020954                                                                  02095416
020955         MOVE SPACES                TO HEAD-REC                   02095519
020956         STRING  '- THE RECEIVER CAN THEN BE VERIFIED AGAIN BY'   02095616
020957                 ' HOT COMPLETING THE WORK ORDER'                 02095725
020958                                        DELIMITED BY SIZE         02095817
020959                                  INTO HEAD-REC                   02095916
020960         DISPLAY HEAD-REC                                         02096016
020961         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02096116
020962                                                                  02096216
020963                                                                  02096316
020964         MOVE SPACES                TO HEAD-REC                   02096419
020965         STRING  '  OR WAITING FOR THE VERIFICATION SWEEPER '     02096516
020966                 'TO RUN'                                         02096620
020967                                        DELIMITED BY SIZE         02096717
020968                                  INTO HEAD-REC                   02096816
020969         DISPLAY HEAD-REC                                         02096916
020970         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02097016
020971                                                                  02097120
020972         MOVE SPACES                TO HEAD-REC                   02097220
020973         DISPLAY HEAD-REC                                         02097320
020974         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02097420
020975                                                                  02097520
020976         MOVE '*****************************************'         02097620
020977                                    TO HEAD-REC                   02097720
020978         DISPLAY HEAD-REC                                         02097820
020979         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02097920
020980                                                                  02098020
020981         MOVE SPACES                TO HEAD-REC                   02098120
020982         DISPLAY HEAD-REC                                         02098220
020983         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     02098320
020984      END-IF.                                                     02098416
020985                                                                  02098516
020990     CLOSE ERROR-OUT-FILE.                                        02099002
021000                                                                  02100002
021100*    IF ANY ERRORS WERE FOUND, THEN SET THE RETURN-CODE, SO       02110002
021200*    THAT THE EMAIL WILL GET SENT OUT IN THE NEXT STEP            02120002
021300                                                                  02130002
021400     IF PV-REC-CNT > 0                                            02140002
021500         MOVE 4095 TO RETURN-CODE                                 02150002
021600     END-IF.                                                      02160002
021700                                                                  02170002
021800     GOBACK.                                                      02180002
021900                                                                  02190002
028200***************************************************************** 02820002
028300*  OPEN THE ERROR REC CURSOR                                      02830002
028400***************************************************************** 02840002
028500 2000-OPEN-ERROR-CSR.                                             02850002
028600                                                                  02860002
028700     SET PS-EOF-ERROR-CSR-NO        TO TRUE.                      02870002
028800                                                                  02880002
028900     EXEC SQL                                                     02890002
029000          OPEN ERROR-REC-CSR                                      02900002
029100     END-EXEC.                                                    02910002
029200                                                                  02920002
029300     EVALUATE TRUE                                                02930002
029400         WHEN SQLCODE = ZERO                                      02940002
029500         WHEN SQLCODE = -904                                      02950002
029600         WHEN SQLCODE = -913                                      02960002
029700         WHEN SQLCODE = -911                                      02970002
029800              CONTINUE                                            02980002
029900         WHEN SQLWARN0 NOT = SPACES                               02990002
030000         WHEN SQLCODE NOT = ZERO                                  03000002
030100             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03010002
030200             STRING 'SQL='                                        03020002
030300                  PV-SQL-RETURN-CD                                03030002
030400                  DELIMITED BY SIZE                               03040002
030500                            INTO PV-DB2-MESSAGE                   03050002
030600             MOVE '2000-OPEN-ERROR-CSR'                           03060002
030700                              TO PV-ABEND-PARAGRAPH               03070002
030800             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03080002
030900             PERFORM 9100-SQL-ABEND                               03090002
031000     END-EVALUATE.                                                03100002
031100                                                                  03110002
031200                                                                  03120002
031300***************************************************************** 03130002
031400*  FETCH THE ERROR REC CURSOR RECORDS                             03140002
031500***************************************************************** 03150002
031600 2010-FETCH-ERROR-CSR.                                            03160002
031700                                                                  03170002
031710     MOVE SPACES                     TO RC123-PREPK-RCVR-VE-REC.  03171002
031720                                                                  03172002
031800     EXEC SQL                                                     03180002
031900          FETCH ERROR-REC-CSR                                     03190002
032010          INTO    :RC123-OPER-UNT-ID                              03201005
032020                , :RC123-ORD-NBR                                  03202004
032030                , :RC123-REC-SEQ-NBR                              03203004
032070                , :RC123-VE-PREPK-ID                              03207004
032500     END-EXEC.                                                    03250002
032600                                                                  03260002
032700     EVALUATE TRUE                                                03270002
032800         WHEN SQLCODE = ZERO                                      03280002
032810              IF  PS-FIRST-REC                                    03281013
032811                  MOVE SPACES  TO HEAD-REC                        03281126
032820                  STRING 'THIS PROCESS HAS FOUND SOME VERIFIED'   03282026
032821                                            DELIMITED BY SIZE     03282126
032830                                      INTO HEAD-REC               03283022
032840                  DISPLAY HEAD-REC                                03284013
032850                  WRITE ERROR-OUT-RECORD FROM HEAD-REC            03285013
032860                                                                  03286013
032861                  MOVE SPACES  TO HEAD-REC                        03286126
032862                  STRING 'PREPACKS THAT HAVE LINES IN THE '       03286226
032863                         'PREPACK '         DELIMITED BY SIZE     03286326
032864                                      INTO HEAD-REC               03286426
032865                  DISPLAY HEAD-REC                                03286526
032866                  WRITE ERROR-OUT-RECORD FROM HEAD-REC            03286626
032867                                                                  03286726
032868                  MOVE SPACES  TO HEAD-REC                        03286826
032869                  STRING 'THAT ARE NOT VERIFIED AND THUS NEED '   03286926
032870                         'TO'               DELIMITED BY SIZE     03287026
032871                                      INTO HEAD-REC               03287126
032872                  DISPLAY HEAD-REC                                03287226
032873                  WRITE ERROR-OUT-RECORD FROM HEAD-REC            03287326
032874                                                                  03287426
032875                  MOVE SPACES  TO HEAD-REC                        03287526
032876                  STRING 'BE CORRECTED'                           03287626
032877                                            DELIMITED BY SIZE     03287726
032878                                      INTO HEAD-REC               03287826
032879                  DISPLAY HEAD-REC                                03287926
032880                  WRITE ERROR-OUT-RECORD FROM HEAD-REC            03288026
032881                                                                  03288126
032882                  MOVE SPACES  TO HEAD-REC                        03288226
032886                  DISPLAY HEAD-REC                                03288626
032887                  WRITE ERROR-OUT-RECORD FROM HEAD-REC            03288726
032888                                                                  03288826
032889                  MOVE SPACES  TO HEAD-REC                        03288926
032890                  STRING '*** PREPACK(S) WITH LINES '             03289026
032891                         'NOT VERIFIED ***' DELIMITED BY SIZE     03289126
032892                                      INTO HEAD-REC               03289226
032893                  DISPLAY HEAD-REC                                03289326
032894                  WRITE ERROR-OUT-RECORD FROM HEAD-REC            03289426
032895                                                                  03289526
032896                  MOVE SPACES           TO HEAD-REC               03289613
032897                  DISPLAY HEAD-REC                                03289713
032898                  WRITE ERROR-OUT-RECORD FROM HEAD-REC            03289813
032899                                                                  03289913
032900                  SET PS-FIRST-REC-NO   TO TRUE                   03290013
032901              END-IF                                              03290113
032902                                                                  03290213
032910              PERFORM 2100-WRITE-RECORD                           03291002
033000         WHEN SQLCODE = +100                                      03300002
033100              SET PS-EOF-ERROR-CSR-YES   TO TRUE                  03310002
033200                                                                  03320002
034600                                                                  03460002
034700         WHEN SQLCODE = -904                                      03470002
034800         WHEN SQLCODE = -913                                      03480002
034900         WHEN SQLCODE = -911                                      03490002
035000              CONTINUE                                            03500002
035100         WHEN SQLWARN0 NOT = SPACES                               03510002
035200         WHEN SQLCODE NOT = ZERO                                  03520002
035300             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03530002
035400             STRING 'SQL='                                        03540002
035500                  PV-SQL-RETURN-CD                                03550002
035600                  DELIMITED BY SIZE                               03560002
035700                            INTO PV-DB2-MESSAGE                   03570002
035800             MOVE '2010-FETCH-ERROR-CSR'                          03580002
035900                              TO PV-ABEND-PARAGRAPH               03590002
036000             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03600002
036100             PERFORM 9100-SQL-ABEND                               03610002
036200     END-EVALUATE.                                                03620002
036300                                                                  03630002
036400                                                                  03640002
036500***************************************************************** 03650002
036600*  CLOSE THE ERROR REC CURSOR                                     03660002
036700***************************************************************** 03670002
036800 2020-CLOSE-ERROR-CSR.                                            03680002
036900                                                                  03690002
037000     EXEC SQL                                                     03700002
037100          CLOSE ERROR-REC-CSR                                     03710002
037200     END-EXEC.                                                    03720002
037300                                                                  03730002
037400     EVALUATE TRUE                                                03740002
037500         WHEN SQLCODE = ZERO                                      03750002
037600         WHEN SQLCODE = -904                                      03760002
037700         WHEN SQLCODE = -913                                      03770002
037800         WHEN SQLCODE = -911                                      03780002
037900             CONTINUE                                             03790002
038000         WHEN SQLWARN0 NOT = SPACES                               03800002
038100         WHEN SQLCODE NOT = ZERO                                  03810002
038200             MOVE SQLCODE               TO PV-SQL-RETURN-CD       03820002
038300             STRING 'SQL='                                        03830002
038400                  PV-SQL-RETURN-CD                                03840002
038500                  DELIMITED BY SIZE                               03850002
038600                            INTO PV-DB2-MESSAGE                   03860002
038700             MOVE '2020-CLOSE-ERROR-CSR'                          03870002
038800                              TO PV-ABEND-PARAGRAPH               03880002
038900             MOVE 'TUPLDER'   TO PV-ABEND-TABLE                   03890002
039000             PERFORM 9100-SQL-ABEND                               03900002
039100     END-EVALUATE.                                                03910002
039200                                                                  03920002
039300                                                                  03930002
039400***************************************************************** 03940002
039500*  WRITE A RECORD TO THE ERROR FILE                               03950002
039600***************************************************************** 03960002
039700 2100-WRITE-RECORD.                                               03970002
039800                                                                  03980002
040000     MOVE RC123-OPER-UNT-ID        TO OUT-OPER.                   04000010
040200     MOVE RC123-ORD-NBR            TO OUT-PO.                     04020010
040400     MOVE RC123-REC-SEQ-NBR        TO OUT-RCVR.                   04040010
040700     MOVE RC123-VE-PREPK-ID        TO OUT-PREPK.                  04070010
041100                                                                  04110010
043600     DISPLAY RECORD-OUT.                                          04360002
043700     WRITE ERROR-OUT-RECORD FROM RECORD-OUT.                      04370002
043800                                                                  04380002
044000     ADD +1                        TO PV-REC-CNT.                 04400008
044200                                                                  04420002
044300                                                                  04430002
044400******************************************************************04440002
044500*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04450002
044600*  ERROR OR WARNING CODE OCCURS.                                  04460002
044700******************************************************************04470002
044800 9100-SQL-ABEND.                                                  04480002
044900     DISPLAY '9100-SQL-ABEND'.                                    04490002
045000     DISPLAY '** ABEND     **'.                                   04500002
045100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04510002
045200     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             04520002
045300     DISPLAY '** TABLE     ** = ' PV-ABEND-TABLE.                 04530002
045400     DISPLAY '** MESSAGE   ** = ' PV-DB2-MESSAGE.                 04540002
045500     COPY DPPD004.                                                04550002
045600                                                                  04560002
045700     MOVE +4013                  TO PV-ABEND-CODE.                04570002
045800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04580002
045900                                                                  04590002
