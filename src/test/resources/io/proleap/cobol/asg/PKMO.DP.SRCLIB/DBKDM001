000100 IDENTIFICATION DIVISION.                                         00010004
000200 PROGRAM-ID.     DBKDM001.                                        00020008
000300 AUTHOR.         CRAIG MARTIN.                                    00030004
000400 INSTALLATION.   KOHLS.                                           00040004
000500 DATE-WRITTEN.   OCTOBER 1998.                                    00050004
000600****************************************************************  00060004
000700***  DB2 COLLECTIONS/PACKAGES/PLAN LISTING  ********************  00070004
000800***             E.K.R.1 TSO OPTION          ********************  00080004
001050***********************************************************       00081018
001020* 03/14  BETSY JEFFERY                                            00082018
001030*     INCREASED THE SIZE OF THE TEMPORARY FILE NAME TO            00083018
001040*     MULTI-LOGON ISPF REQUIREMENTS.                              00084018
000900****************************************************************  00090004
001000*                                                                 00100004
001100 ENVIRONMENT DIVISION.                                            00110004
001200 CONFIGURATION SECTION.                                           00120004
001300 SOURCE-COMPUTER.        IBM.                                     00130004
001400 OBJECT-COMPUTER.        IBM.                                     00140004
001500 INPUT-OUTPUT SECTION.                                            00150004
001600                                                                  00160004
001700 FILE-CONTROL.                                                    00170004
001800                                                                  00180004
001900     SELECT BROWSE-FILE ASSIGN TO PLNDDATA.                       00190005
002100                                                                  00210004
002200 DATA DIVISION.                                                   00220004
002300 FILE SECTION.                                                    00230004
002400 FD  BROWSE-FILE                                                  00240004
002500     RECORDING MODE IS F                                          00250004
002600     LABEL RECORDS ARE STANDARD                                   00260004
002700     RECORD CONTAINS 080 CHARACTERS                               00270004
002800     BLOCK CONTAINS 0 RECORDS                                     00280004
002900     DATA RECORD IS BROWSE-RECORD.                                00290004
003000 01  BROWSE-RECORD           PIC X(080).                          00300004
003800                                                                  00380004
003900*                                                                 00390004
004000     EJECT                                                        00400004
004100 WORKING-STORAGE SECTION.                                         00410004
004200*                                                                 00420004
004300 01  SQL-FILLER          PIC X         VALUE SPACE.               00430004
004400                                                                  00440004
004500 01  NO-MATCH-INFO.                                               00450004
004600     05  PIC X(02)  VALUE  SPACES.                                00460004
004700     05  PIC X(33)  VALUE  'NO DB2 TABLE MATCHED FOR CREATOR'.    00470004
004800     05  NO-MATCH-INFO-CREATOR         PIC X(08)   VALUE SPACES.  00480004
004900     05  PIC X(15)  VALUE  'AND TABLE NAME'.                      00490004
005000     05  NO-MATCH-INFO-TABLE-NAME      PIC X(18)   VALUE SPACES.  00500004
005100                                                                  00510004
005200 01  REPORT-TITLE1.                                               00520004
005300     05  PIC X(09)  VALUE  SPACES.                                00530004
005400     05  PIC X(51)  VALUE                                         00540004
005500         'REALTIME DB2 PLAN/COLLECTIONS/PACKAGES LISTING FOR'.    00550004
005600     05  TITLE-PLAN     PIC X(8)   VALUE SPACES.                  00560004
005700                                                                  00570004
005800 01  REPORT-TITLE2.                                               00580004
005900     05                    PIC X(03)  VALUE SPACES.               00590004
006000     05                    PIC X(32)  VALUE                       00600004
006100         'PACKAGES BOUND UNDER COLLECTION'.                       00610004
006200     05  TITLE-COLLECTION  PIC X(19)  VALUE SPACES.               00620004
006300     05                    PIC X(01)  VALUE ':'.                  00630004
006400                                                                  00640004
006500 01  REPORT-TITLE3.                                               00650004
006600     05                    PIC X(03)  VALUE SPACES.               00660004
006700     05                    PIC X(08)  VALUE 'PROGRAM'.            00670004
006800     05                    PIC X(01)  VALUE SPACES.               00680004
006900     05                    PIC X(08)  VALUE 'PACKAGE'.            00690004
007000     05                    PIC X(01)  VALUE SPACES.               00700004
007100     05                    PIC X(08)  VALUE 'BOUND'.              00710004
007200     05                    PIC X(01)  VALUE SPACES.               00720004
007300     05                    PIC X(16)  VALUE 'PACKAGE BOUND'.      00730004
007400     05                    PIC X(01)  VALUE SPACES.               00740004
007500     05                    PIC X(16)  VALUE 'PRECOMPILED'.        00750004
007600     05                    PIC X(01)  VALUE SPACES.               00760004
007700     05                    PIC X(10)  VALUE 'DB2 OBJECT'.         00770004
007800     05                    PIC X(01)  VALUE SPACES.               00780004
007900     05                    PIC X(04)  VALUE 'DBRM'.               00790004
008000                                                                  00800004
008100 01  REPORT-TITLE4.                                               00810004
008200     05                    PIC X(03)  VALUE SPACES.               00820004
008300     05                    PIC X(08)  VALUE 'NAME'.               00830004
008400     05                    PIC X(01)  VALUE SPACES.               00840004
008500     05                    PIC X(08)  VALUE 'OWNER'.              00850004
008600     05                    PIC X(01)  VALUE SPACES.               00860004
008700     05                    PIC X(08)  VALUE 'BY UID'.             00870004
008800     05                    PIC X(01)  VALUE SPACES.               00880004
008900     05                    PIC X(16)  VALUE 'DATETIME'.           00890004
009000     05                    PIC X(01)  VALUE SPACES.               00900004
009100     05                    PIC X(16)  VALUE 'DATETIME'.           00910004
009200     05                    PIC X(01)  VALUE SPACES.               00920004
009300     05                    PIC X(10)  VALUE 'QUALIFIER'.          00930004
009400     05                    PIC X(01)  VALUE SPACES.               00940004
009500     05                    PIC X(04)  VALUE 'HLQ'.                00950004
009600                                                                  00960004
009700 01  REPORT-LINE1.                                                00970004
009800     05                    PIC X(03)  VALUE SPACES.               00980004
009900*    05  RP1-COLLID        PIC X(18)  VALUE SPACES.               00990004
010000*    05                    PIC X(01)  VALUE SPACES.               01000004
010100     05  RP1-NAME          PIC X(08)  VALUE SPACES.               01010004
010200     05                    PIC X(01)  VALUE SPACES.               01020004
010300     05  RP1-OWNER         PIC X(08)  VALUE SPACES.               01030004
010400     05                    PIC X(01)  VALUE SPACES.               01040004
010500     05  RP1-CREATOR       PIC X(08)  VALUE SPACES.               01050004
010600     05                    PIC X(01)  VALUE SPACES.               01060004
010700     05  RP1-BINDTIME      PIC X(16)  VALUE SPACES.               01070004
010800     05                    PIC X(01)  VALUE SPACES.               01080004
010900     05  RP1-PCTIMESTAMP   PIC X(16)  VALUE SPACES.               01090004
011000     05                    PIC X(01)  VALUE SPACES.               01100004
011100     05  RP1-QUALIFIER     PIC X(08)  VALUE SPACES.               01110004
011200     05                    PIC X(03)  VALUE SPACES.               01120004
011300     05  RP1-PDSNAME       PIC X(04)  VALUE SPACES.               01130004
011400                                                                  01140004
011500 01  ISP-FUNCTIONS.                                               01150004
011600     05  ISP-DISPLAY     PIC X(8) VALUE 'DISPLAY'.                01160004
011700     05  ISP-ADDPOP      PIC X(8) VALUE 'ADDPOP  '.               01170004
011800     05  ISP-REMPOP      PIC X(8) VALUE 'REMPOP  '.               01180004
011900     05  ISP-VDEFINE     PIC X(8) VALUE 'VDEFINE'.                01190004
012000     05  ISP-VDELETE     PIC X(8) VALUE 'VDELETE'.                01200004
012100     05  ISP-VGET        PIC X(8) VALUE 'VGET'.                   01210004
012200     05  ISP-VPUT        PIC X(8) VALUE 'VPUT'.                   01220004
012300     05  ISP-VRESET      PIC X(8) VALUE 'VRESET'.                 01230004
012400     05  ISP-VCOPY       PIC X(8) VALUE 'VCOPY'.                  01240004
012500     05  ISP-VREPLACE    PIC X(8) VALUE 'VREPLACE'.               01250004
012600     05  ISP-TBOPEN      PIC X(8) VALUE 'TBOPEN'.                 01260004
012700     05  ISP-TBCREATE    PIC X(8) VALUE 'TBCREATE'.               01270004
012800     05  ISP-TBCLOSE     PIC X(8) VALUE 'TBCLOSE'.                01280004
012900     05  ISP-TBEND       PIC X(8) VALUE 'TBEND  '.                01290004
013000     05  ISP-TBDISPL     PIC X(8) VALUE 'TBDISPL'.                01300004
013100     05  ISP-TBSORT      PIC X(8) VALUE 'TBSORT'.                 01310004
013200     05  ISP-TBTOP       PIC X(8) VALUE 'TBTOP'.                  01320004
013300     05  ISP-TBBOTTOM    PIC X(8) VALUE 'TBBOTTOM'.               01330004
013400     05  ISP-TBSKIP      PIC X(8) VALUE 'TBSKIP'.                 01340004
013500     05  ISP-TBADD       PIC X(8) VALUE 'TBADD '.                 01350004
013600     05  ISP-TBPUT       PIC X(8) VALUE 'TBPUT '.                 01360004
013700     05  ISP-TBMOD       PIC X(8) VALUE 'TBMOD '.                 01370004
013800     05  ISP-TBDELETE    PIC X(8) VALUE 'TBDELETE'.               01380004
013900     05  ISP-TBEXIST     PIC X(8) VALUE 'TBEXIST '.               01390004
014000     05  ISP-TBSCAN      PIC X(8) VALUE 'TBSCAN'.                 01400004
014100     05  ISP-TBPAD       PIC 9(8) COMP VALUE 0.                   01410004
014200     05  ISP-NEWCOPY     PIC X(8) VALUE 'NEWCOPY'.                01420004
014300     05  ISP-FTOPEN      PIC X(8) VALUE 'FTOPEN'.                 01430004
014400     05  ISP-FTINCL      PIC X(8) VALUE 'FTINCL'.                 01440004
014500     05  ISP-FTCLOSE     PIC X(8) VALUE 'FTCLOSE'.                01450004
014600     05  ISP-SELECT      PIC X(8) VALUE 'SELECT'.                 01460004
014700     05  ISP-BROWSE      PIC X(8) VALUE 'BROWSE'.                 01470004
014800     05  ISP-SETMSG      PIC X(8) VALUE 'SETMSG'.                 01480004
014900     05  ISP-CONTROL     PIC X(8) VALUE 'CONTROL'.                01490004
015000     05  ISP-NONDISPL    PIC X(8) VALUE 'NONDISPL'.               01500004
015100     05  ISP-SPLIT       PIC X(8) VALUE 'SPLIT'.                  01510004
015200     05  ISP-DISABLE     PIC X(8) VALUE 'DISABLE'.                01520004
015300     05  ISP-ENABLE      PIC X(8) VALUE 'ENABLE'.                 01530004
015400     05  ISP-NO          PIC X(8) VALUE 'NO'.                     01540004
015500     05  ISP-YES         PIC X(8) VALUE 'YES'.                    01550004
015600*                                                                 01560004
015700 01  ISP-MISC-DEFS.                                               01570004
015800     05  ISP-FORMAT      PIC X(8) VALUE 'CHAR'.                   01580004
015900     05  ISP-MOVE        PIC X(8) VALUE 'MOVE'.                   01590004
016000     05  ISP-WRITE       PIC X(8) VALUE 'WRITE'.                  01600004
016100     05  ISP-NOWRITE     PIC X(8) VALUE 'NOWRITE'.                01610004
016200     05  ISP-REPLACE     PIC X(8) VALUE 'REPLACE'.                01620004
016300     05  ISP-ORDERED     PIC X(8) VALUE 'ORDERED'.                01630004
016400     05  ISP-SHARED      PIC X(8) VALUE 'SHARED'.                 01640004
016500     05  ISP-PROFILE     PIC X(8) VALUE 'PROFILE'.                01650004
016600     05  ISP-ASIS        PIC X(8) VALUE 'ASIS'.                   01660004
016700     05  ISP-NOREAD      PIC X(8) VALUE 'NOREAD'.                 01670004
016800     05  ISP-NEXT        PIC X(8) VALUE 'NEXT'.                   01680004
016900     05  ISP-TEMP        PIC X(8) VALUE 'TEMP'.                   01690004
017000     05  ISP-PANEL       PIC X(8) VALUE  SPACES.                  01700004
017100     05  ISP-DUMMY       PIC X(8) VALUE  SPACES.                  01710004
017200     05  ISP-MSG         PIC X(8) VALUE  'CMN000  '.              01720004
017300     05  ISP-CSR         PIC X(8) VALUE  SPACES.                  01730004
017400     05  ISP-FIELD       PIC X(8) VALUE  SPACES.                  01740004
017500     05  ISP-SKEL        PIC X(8) VALUE  SPACES.                  01750004
017600     05  ISP-ERRORS      PIC X(8) VALUE 'ERRORS'.                 01760004
017700     05  ISP-RETURN      PIC X(8) VALUE 'RETURN'.                 01770004
017800     05  ISP-CANCEL      PIC X(8) VALUE 'CANCEL'.                 01780004
017900     05  ISP-SAVE        PIC X(8) VALUE 'SAVE'.                   01790004
018000     05  ISP-RESTORE     PIC X(8) VALUE 'RESTORE'.                01800004
018100     05  TBL-LIST-GT     PIC X(4) VALUE '(GT)'.                   01810004
018200*                                                                 01820004
018300***  DEFINE DATA TYPE PARAMETER FOR VARIABLE DEFINE SERVICE CALL. 01830004
018400*                                                                 01840004
018500 01  CHAR                PIC X(08)     VALUE 'CHAR    '.          01850004
018600                                                                  01860005
018700*                                                                 01870005
018800*  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE              01880005
018900*                                                                 01890005
019000     COPY DPWS023.                                                01900005
019100                                                                  01910005
019200*                                                                 01920005
019300*  PARAMETER LIST FOR THE ISPF PRINT PANEL ROUTINE                01930005
019400*                                                                 01940005
019500     COPY DPWS300.                                                01950005
019600                                                                  01960005
019700 01  VAR-SMSG                    PIC X(24)   VALUE SPACES.        01970013
019800 01  FILLER                      REDEFINES VAR-SMSG.              01980013
019900     05  VAR-SMSG-FILLER         PIC X(20).                       01990013
020000     05  VAR-SMSG-SQLCODE        PIC 9(4).                        02000013
020100 01  VAR-LMSG                    PIC X(72)   VALUE SPACES.        02010013
021800 01  PV-PROGRAM-VARIABLES.                                        02180005
021900     05  VAR-ZTEMPF              PIC X(44)   VALUE SPACES.        02190004
022000     05  VAR-DSNAME              PIC X(46)   VALUE SPACES.        02200004
022100     05  VAR-VOLUME              PIC X(06)   VALUE SPACES.        02210004
022200     05  VAR-PASSWORD            PIC X(08)   VALUE SPACES.        02220004
022210     05  PV-DYNALC-ROUTINE-ERROR-MSG.                             02221005
022220         10  FILLER              PIC X(13)    VALUE               02222005
022230             'DYNALC ERROR '.                                     02223005
022240         10  PV-DR-RETURN-CODE   PIC 9999     VALUE ZEROS.        02224005
022250         10  FILLER              PIC X(2)     VALUE '; '.         02225005
022260         10  PV-DR-DDNAME        PIC X(8)     VALUE SPACES.       02226005
022270         10  FILLER              PIC X(5)     VALUE ' DD; '.      02227005
022280         10  PV-DR-ERROR-DESC    PIC X(41)    VALUE SPACES.       02228005
022290     05  PV-BROWSE-DSNAME        PIC X(44)   VALUE SPACES.        02229011
022300     05  PV-COUNTR               PIC S9(4)   COMP.                02230004
022400     05  PV-FIELD-LENGTH         PIC 9(8)     VALUE ZEROS         02240013
022500                                              COMP SYNC.          02250013
023400*                                                                 02340004
023500***  DEFINE STORAGE FOR DIALOG VARIABLES.                         02350004
023600*                                                                 02360004
023700 01  VAR-CMNEKPLN        PIC X(08)     VALUE SPACES.              02370004
023800 01  VAR-CMNEKPLN-RD                   REDEFINES                  02380004
023900     VAR-CMNEKPLN.                                                02390004
024000     05                  PIC X(02).                               02400004
024100     05  PLAN-SYSTEM-ID  PIC X.                                   02410004
024200     05                  PIC X(05).                               02420004
024300                                                                  02430004
024400 01  ABEND-CODE                    PIC S9(4) VALUE ZERO           02440004
024500                                             COMP.                02450004
024600     88  ABEND-4013                          VALUE 4013.          02460004
024700                                                                  02470004
024900 01  HOLD-COLLID                 PIC X(18)   VALUE SPACES.        02490004
025000 01  HOLD-GRANTEE                PIC X(08)   VALUE SPACES.        02500004
025100 01  HOLD-PGMNAME                PIC X(08)   VALUE SPACES.        02510004
025200 01  HOLD-PROCNUM                PIC S99     VALUE ZEROS.         02520004
025300                                                                  02530004
025400 01  PS-PRINT-SWITCH               PIC X(1)  VALUE 'N'.           02540004
025500     88  PS-EOF-PRINT                        VALUE 'Y'.           02550004
025600     88  PS-NOT-EOF-PRINT                    VALUE 'N'.           02560004
025700 01  PS-TABLE-VALIDITY             PIC X(1)  VALUE 'N'.           02570004
025800     88  PS-TABLE-IS-VALID                   VALUE 'Y'.           02580004
025900     88  PS-TABLE-IS-NOT-VALID               VALUE 'N'.           02590004
026000 01  PS-ALLOCATE-SW                PIC X(1)  VALUE 'N'.           02600004
026100     88  PS-IS-ALLOCATED                     VALUE 'Y'.           02610004
026200     88  PS-IS-NOT-ALLOCATED                 VALUE 'N'.           02620004
026300 01  PS-DB2-ERROR-INDICATOR        PIC X(1)  VALUE 'N'.           02630004
026400     88  PS-DB2-ERROR                        VALUE 'Y'.           02640004
026500     88  PS-NO-DB2-ERROR                     VALUE 'N'.           02650004
026600 01  PS-USER-INPUT                 PIC X(1)  VALUE 'N'.           02660004
026700     88  PS-USER-INPUT-VALID                 VALUE 'Y'.           02670004
026800     88  PS-USER-INPUT-NOT-VALID             VALUE 'N'.           02680004
026900 01  PS-PKEY                       PIC X(1)  VALUE 'N'.           02690004
027000     88  PS-PKEY-DEFINED                     VALUE 'Y'.           02700004
027100     88  PS-PKEY-NOT-DEFINED                 VALUE 'N'.           02710004
027200 01  PS-KEY-COLUMN-SELECT          PIC X(1)  VALUE 'N'.           02720004
027300     88  PS-KEY-COLUMN-SELECTED              VALUE 'Y'.           02730004
027400     88  PS-KEY-COLUMN-NOT-SELECTED          VALUE 'N'.           02740004
027500                                                                  02750004
027600 01  PS-END-OF-TABLE               PIC X(1)  VALUE 'N'.           02760004
027700     88  PS-NO-MORE-ROWS                     VALUE 'Y'.           02770004
027800     88  PS-SOME-MORE-ROWS                   VALUE 'N'.           02780004
027900                                                                  02790004
028000**                                                                02800004
028100 01  WORK-FIELDS.                                                 02810004
028200     05  WF-PDS-NAME-LONG          PIC X(44) VALUE SPACES.        02820004
028300     05  WF-PDS-NAME               REDEFINES                      02830004
028400         WF-PDS-NAME-LONG.                                        02840004
028500         10  WF-PDS-NAME-4         PIC X(04).                     02850004
028600         10  WF-PDS-NAME-40        PIC X(40).                     02860004
028700                                                                  02870004
028800     05  WF-COLLECTION-NAME        PIC X(18) VALUE SPACES.        02880004
028900*                                                                 02890004
029000 01  PROGRAM-CONSTANTS.                                           02900004
029010     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'DBKDM001'.   02901005
029020     05  PC-BROWSE-DDNAME          PIC X(08)  VALUE 'PLNDDATA'.   02902011
029030     05  PC-BROWSE-DSNAME-SUFFIX   PIC X(05)  VALUE '.PLND'.      02903012
029100     05  PC-MAX-RETRIES            PIC S9(3)  VALUE +3            02910004
029200                                              COMP-3.             02920004
029300     05  PC-COMMIT-MAX             PIC S9(3)  VALUE +49           02930004
029400                                              COMP-3.             02940004
029500*                                                                 02950004
029600 01  COMMON-NAMELIST.                                             02960004
030300     05  NAM-ZTEMPF      PIC X(08)     VALUE 'ZTEMPF'.            03030004
030400     05  NAM-SMSG        PIC X(08)     VALUE 'SMSG'.              03040004
030500     05  NAM-LMSG        PIC X(08)     VALUE 'LMSG'.              03050004
030600*                                                                 03060004
030700***  DEFINE DIALOG VARIABLE NAMES FOR DIALOG SERVICE CALLS.       03070004
030800*                                                                 03080004
030900 01  NAM-CMNEKPLN        PIC X(08)     VALUE 'CMNEKPLN'.          03090004
032800*                                                                 03280004
032900***                                                               03290004
033000************************************************************      03300004
033100*    SYSIBM.SYSPLAN       DCLGEN                           *      03310004
033200************************************************************      03320004
033300     EXEC SQL                                                     03330004
033400         INCLUDE SYSPLAN                                          03340004
033500     END-EXEC.                                                    03350004
033600*                                                                 03360004
033700***                                                               03370004
033800************************************************************      03380004
033900*    SYSIBM.SYSPACKLIST   DCLGEN                           *      03390004
034000************************************************************      03400004
034100     EXEC SQL                                                     03410004
034200         INCLUDE SYSPACKL                                         03420004
034300     END-EXEC.                                                    03430004
034400*                                                                 03440004
034500***                                                               03450004
034600************************************************************      03460004
034700*    SYSIBM.SYSPACKAGE    DCLGEN                           *      03470004
034800************************************************************      03480004
034900     EXEC SQL                                                     03490004
035000         INCLUDE SYSPKG                                           03500004
035100     END-EXEC.                                                    03510004
035200*                                                                 03520004
035300***                                                               03530004
035400************************************************************      03540004
035500*    DECLARE PLCOLLPK_CURSOR CURSOR                        *      03550004
035600************************************************************      03560004
035700*                                                                 03570004
035800     EXEC SQL                                                     03580004
035900      DECLARE PLCOLLPK_CURSOR CURSOR FOR                          03590004
036000      SELECT    P.COLLID                                          03600004
036100               ,P.NAME                                            03610004
036200               ,OWNER                                             03620004
036300               ,CREATOR                                           03630004
036400               ,BINDTIME                                          03640004
036500               ,PCTIMESTAMP                                       03650004
036600               ,QUALIFIER                                         03660004
036700               ,PDSNAME                                           03670004
036800      FROM      SYSIBM.SYSPACKAGE   P                             03680004
036900               ,SYSIBM.SYSPACKLIST  L                             03690004
037000      WHERE     PLANNAME  = :VAR-CMNEKPLN                         03700004
037100      AND       P.COLLID = L.COLLID                               03710004
037200      ORDER BY  P.COLLID, NAME                                    03720004
037300                                                                  03730004
037400   END-EXEC.                                                      03740004
037500                                                                  03750009
039900************************************************************      03990004
040000*    SQL COMMUNICATIONS AREA DCLGEN                        *      04000004
040100************************************************************      04010004
040200*                                                                 04020004
040300     EXEC SQL                                                     04030004
040400         INCLUDE SQLCA                                            04040004
040500     END-EXEC.                                                    04050004
040600*                                                                 04060004
040700*                                                                 04070004
040800 PROCEDURE DIVISION.                                              04080004
040900                                                                  04090004
041000************************************************************      04100004
041100*    VDEFINES FOR PANEL                                    *      04110004
041200************************************************************      04120004
041300     MOVE LENGTH OF VAR-ZTEMPF TO PV-FIELD-LENGTH.                04130014
041400     CALL 'ISPLINK' USING ISP-VDEFINE NAM-ZTEMPF VAR-ZTEMPF       04140014
041500                          ISP-FORMAT PV-FIELD-LENGTH.             04150014
041600     MOVE LENGTH OF VAR-SMSG TO PV-FIELD-LENGTH.                  04160014
041700     CALL 'ISPLINK' USING ISP-VDEFINE NAM-SMSG VAR-SMSG           04170014
041800                          ISP-FORMAT PV-FIELD-LENGTH.             04180014
041900     MOVE LENGTH OF VAR-LMSG TO PV-FIELD-LENGTH.                  04190014
042000     CALL 'ISPLINK' USING ISP-VDEFINE NAM-LMSG VAR-LMSG           04200014
042100                          ISP-FORMAT PV-FIELD-LENGTH.             04210014
042230     MOVE LENGTH OF VAR-CMNEKPLN TO PV-FIELD-LENGTH.              04223014
042240     CALL 'ISPLINK' USING ISP-VDEFINE                             04224014
042250         NAM-CMNEKPLN  VAR-CMNEKPLN  CHAR  PV-FIELD-LENGTH.       04225014
042500                                                                  04250004
042600************************************************************      04260004
042700*    VGETS FROM PROFILES                                   *      04270004
042800************************************************************      04280004
042900                                                                  04290004
043200     CALL 'ISPLINK' USING ISP-VGET NAM-ZTEMPF ISP-SHARED.         04320005
043300     MOVE SPACES TO ISP-MSG.                                      04330005
043310                                                                  04331005
043320     INSPECT VAR-ZTEMPF TALLYING PV-COUNTR FOR CHARACTERS         04332005
043330                 BEFORE INITIAL '.CNTL'.                          04333005
043340     MOVE VAR-ZTEMPF (1:PV-COUNTR)  TO PV-BROWSE-DSNAME.          04334011
043350     ADD 1 TO PV-COUNTR.                                          04335005
043370     MOVE PC-BROWSE-DSNAME-SUFFIX TO                              04337012
043380               PV-BROWSE-DSNAME (PV-COUNTR:5).                    04338011
043400                                                                  04340004
043500     PERFORM 1700-DISPLAY-PANEL THRU 1700-EXIT UNTIL              04350004
043600          RETURN-CODE NOT = 0.                                    04360004
043700                                                                  04370004
043800     IF PS-IS-ALLOCATED                                           04380005
043900         PERFORM 9100-DELETE-FILE                                 04390005
043910     END-IF.                                                      04391005
044000                                                                  04400004
044100     GOBACK.                                                      04410004
044200                                                                  04420004
044300************************************************************      04430004
044400*    DISPLAY THE PANEL                                     *      04440004
044500************************************************************      04450004
044600*                                                                 04460004
044700 1700-DISPLAY-PANEL.                                              04470004
044800                                                                  04480004
044900     MOVE SPACES TO WF-COLLECTION-NAME.                           04490004
045000     MOVE 'CMNEKPLN' TO ISP-CSR.                                  04500004
045100     MOVE 'CMNEKR1' TO ISP-PANEL.                                 04510004
045200     CALL 'ISPLINK' USING ISP-DISPLAY,                            04520004
045300                          ISP-PANEL,                              04530004
045400                          ISP-MSG,                                04540004
045500                          ISP-CSR.                                04550004
045600                                                                  04560004
045700     MOVE SPACES TO ISP-MSG.                                      04570004
045800     MOVE SPACES TO VAR-SMSG.                                     04580004
045900     MOVE SPACES TO VAR-LMSG.                                     04590004
046000                                                                  04600004
046100     IF RETURN-CODE NOT = 0                                       04610004
046200         GO TO 1700-EXIT.                                         04620004
046300                                                                  04630004
046400     PERFORM 2100-EDIT-INPUT THRU 2100-EXIT.                      04640004
046500     IF PS-USER-INPUT-NOT-VALID                                   04650004
046600         GO TO 1700-EXIT.                                         04660004
046700                                                                  04670004
046710     IF PS-IS-NOT-ALLOCATED                                       04671005
046800         PERFORM 3000-ALLOCATE-TEMP-FILE                          04680005
046810     END-IF.                                                      04681005
046900                                                                  04690004
047000     IF PS-IS-ALLOCATED                                           04700004
047100         OPEN OUTPUT BROWSE-FILE                                  04710004
047400         PERFORM 4000-GET-PACKAGES                                04740004
047500             THRU 4000-EXIT                                       04750004
047600         CLOSE BROWSE-FILE                                        04760005
047610     END-IF.                                                      04761005
047700                                                                  04770004
047800     IF ((PS-IS-ALLOCATED)                                        04780005
047900             AND (PS-NO-DB2-ERROR))                               04790005
047910         PERFORM 8000-BROWSE-FILE                                 04791005
047920     END-IF.                                                      04792005
048000                                                                  04800004
048100 1700-EXIT.                                                       04810004
048200     EXIT.                                                        04820004
048300     EJECT                                                        04830004
048400************************************************************      04840004
048500* SET SWITCHES TO INDICATE WHAT OPTION HAS BEEN SPECIFIED  *      04850004
048600* BY THE USER                                              *      04860004
048700************************************************************      04870004
048800 2100-EDIT-INPUT.                                                 04880004
048900                                                                  04890004
049000     SET PS-NOT-EOF-PRINT TO TRUE.                                04900004
049100     SET PS-NO-DB2-ERROR TO TRUE.                                 04910004
049200     MOVE 'Y' TO PS-USER-INPUT.                                   04920004
049300                                                                  04930004
049400     IF VAR-CMNEKPLN = SPACES                                     04940004
049500          MOVE 'N' TO PS-USER-INPUT                               04950004
049600          MOVE 'SPECIFY REQUIRED PARM' TO VAR-SMSG                04960004
049700          MOVE                                                    04970004
049800          'SUPPLY THE DB2 PLAN YOU WISH TO LOOK UP'               04980004
049900              TO VAR-LMSG                                         04990004
050000          MOVE 'CMN000  ' TO ISP-MSG                              05000004
050100          GO TO 2100-EXIT                                         05010004
050200     ELSE                                                         05020004
050300          MOVE 'Y' TO PS-USER-INPUT.                              05030004
050400                                                                  05040004
050500     EXEC SQL                                                     05050004
050600       SELECT    '1'                                              05060004
050700         INTO                                                     05070004
050800            :SQL-FILLER                                           05080004
050900       FROM      SYSIBM.SYSPLAN                                   05090004
051000       WHERE     NAME    = :VAR-CMNEKPLN                          05100004
051100     END-EXEC.                                                    05110004
051200                                                                  05120004
051300     IF SQLCODE = ZERO                                            05130004
051400         GO TO 2100-EXIT.                                         05140004
051500                                                                  05150004
051600     IF SQLCODE = +100                                            05160004
051700         MOVE 'NO SUCH PLAN EXISTS' TO VAR-SMSG                   05170004
051800          MOVE                                                    05180004
051900          'SUPPLY THE CORRECT DB2 PLAN YOU WISH TO LOOK UP'       05190004
052000              TO VAR-LMSG                                         05200004
052100         MOVE 'N' TO PS-USER-INPUT                                05210004
052200     ELSE                                                         05220004
052300         MOVE 'N' TO PS-USER-INPUT                                05230004
052400         MOVE 'SQLCODE = ' TO VAR-SMSG-FILLER                     05240004
052500         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         05250004
052600         MOVE '2100-EDIT-INPUT ABEND, CONTACT DBA'                05260004
052700             TO VAR-LMSG.                                         05270004
052800     MOVE 'CMN000  ' TO ISP-MSG .                                 05280004
052900     SET  PS-DB2-ERROR TO TRUE.                                   05290004
053000 2100-EXIT.                                                       05300004
053100     EXIT.                                                        05310004
053200     EJECT                                                        05320004
053300************************************************************      05330004
053400* USE DYNALLOC TO ALLOCATE TEMP FILE THAT WILL BE DISPLAYED*      05340004
053500************************************************************      05350004
053600 3000-ALLOCATE-TEMP-FILE.                                         05360004
053610     PERFORM 9100-DELETE-FILE.                                    05361005
053620                                                                  05362005
053630     IF ((DP023-LASTRC = ZERO)                                    05363005
053640             OR (DP023-LASTRC = DP023-RC-DATASET-DOESNT-EXIST))   05364005
053650         INITIALIZE DP023-DYNALC-PARMS                            05365005
053660         MOVE PC-BROWSE-DDNAME TO DP023-DDNAME                    05366011
053670         MOVE PV-BROWSE-DSNAME TO DP023-DSNAME                    05367011
053680         SET DP023-DISP-NEW TO TRUE                               05368005
053690         SET DP023-FREE-CLOSE-NO TO TRUE                          05369005
053691         SET DP023-RECFM-FIXED-BLOCK TO TRUE                      05369105
053692         MOVE LENGTH OF BROWSE-RECORD TO DP023-RECSZ              05369215
053693         MOVE 2000 TO DP023-RECOUNT                               05369305
053694                                                                  05369405
053695         SET DP023-DISABLE-DISPLAY-ABEND TO TRUE                  05369505
053696                                                                  05369605
053697         PERFORM DP023-0000-DYNALC                                05369705
053698         IF DP023-LASTRC = ZERO                                   05369805
053699             SET PS-IS-ALLOCATED TO TRUE                          05369905
053700         ELSE                                                     05370005
053701             SET PS-IS-NOT-ALLOCATED TO TRUE                      05370105
053702             MOVE DP023-DDNAME TO PV-DR-DDNAME                    05370205
053703             MOVE DP023-RC (DP023-SUB) TO PV-DR-RETURN-CODE       05370305
053704             MOVE DP023-DESC (DP023-SUB) TO PV-DR-ERROR-DESC      05370405
053705             MOVE PV-DYNALC-ROUTINE-ERROR-MSG TO VAR-LMSG         05370505
053706             MOVE 'CMN000  ' TO ISP-MSG                           05370605
053707         END-IF                                                   05370705
053708     ELSE                                                         05370805
053709         SET PS-IS-NOT-ALLOCATED TO TRUE                          05370905
053710         MOVE DP023-DDNAME TO PV-DR-DDNAME                        05371005
053711         MOVE DP023-RC (DP023-SUB) TO PV-DR-RETURN-CODE           05371105
053712         MOVE DP023-DESC (DP023-SUB) TO PV-DR-ERROR-DESC          05371205
053713         MOVE PV-DYNALC-ROUTINE-ERROR-MSG TO VAR-LMSG             05371305
053714         MOVE 'CMN000  ' TO ISP-MSG                               05371405
053715     END-IF.                                                      05371505
058300                                                                  05830005
058400************************************************************      05840004
058500* MAIN-LINE LOGIC                                          *      05850004
058600************************************************************      05860004
058700 4000-GET-PACKAGES.                                               05870004
058800                                                                  05880004
058900     PERFORM 4200-OPEN-PLCOLLPK-CURSOR                            05890004
059000         THRU 4200-EXIT.                                          05900004
059100     IF PS-DB2-ERROR                                              05910004
059200         GO TO 4000-EXIT.                                         05920004
059300                                                                  05930004
059400     MOVE 'N' TO PS-PKEY.                                         05940004
059500     MOVE VAR-CMNEKPLN TO TITLE-PLAN.                             05950004
059600     WRITE BROWSE-RECORD FROM REPORT-TITLE1.                      05960004
059700     MOVE 'N' TO PS-END-OF-TABLE.                                 05970004
059800     PERFORM 4300-FETCH-PLCOLLPK THRU 4300-EXIT                   05980004
059900         UNTIL PS-NO-MORE-ROWS                                    05990004
060000            OR SQLCODE NOT = ZERO.                                06000004
060100     IF PS-DB2-ERROR                                              06010004
060200         GO TO 4000-EXIT.                                         06020004
060300                                                                  06030004
060400     PERFORM 4400-CLOSE-PLCOLLPK-CURSOR                           06040004
060500         THRU 4400-EXIT.                                          06050004
060600     MOVE SPACES TO BROWSE-RECORD.                                06060004
060700     WRITE BROWSE-RECORD.                                         06070004
060800                                                                  06080004
060900 4000-EXIT.                                                       06090004
061000     EXIT.                                                        06100004
061100     EJECT                                                        06110004
061200************************************************************      06120004
061300* OPEN PLCOLLPK_CURSOR CURSOR                              *      06130004
061400************************************************************      06140004
061500 4200-OPEN-PLCOLLPK-CURSOR.                                       06150004
061600                                                                  06160004
061700      EXEC SQL                                                    06170004
061800          OPEN PLCOLLPK_CURSOR                                    06180004
061900      END-EXEC.                                                   06190004
062000                                                                  06200004
062100      IF SQLCODE NOT = 0                                          06210004
062200          SET PS-DB2-ERROR TO TRUE                                06220004
062300          MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                     06230004
062400          MOVE SQLCODE TO VAR-SMSG-SQLCODE                        06240004
062500          MOVE '4200-OPEN CURSOR ABEND, CONTACT DBA'              06250004
062600               TO VAR-LMSG                                        06260004
062700          MOVE 'CMN000  ' TO ISP-MSG.                             06270004
062800                                                                  06280004
062900 4200-EXIT.                                                       06290004
063000     EXIT.                                                        06300004
063100     EJECT                                                        06310004
063200************************************************************      06320004
063300* FETCH THE ROWS FROM SYSIBM.SYSCOLUMNS                    *      06330004
063400************************************************************      06340004
063500 4300-FETCH-PLCOLLPK.                                             06350004
063600                                                                  06360004
063700     INITIALIZE DCLSYSPACKAGE.                                    06370004
063800                                                                  06380004
063900     EXEC SQL                                                     06390004
064000         FETCH PLCOLLPK_CURSOR                                    06400004
064100         INTO                                                     06410004
064200               :SYSPKG-COLLID                                     06420004
064300              ,:SYSPKG-NAME                                       06430004
064400              ,:SYSPKG-OWNER                                      06440004
064500              ,:SYSPKG-CREATOR                                    06450004
064600              ,:SYSPKG-BINDTIME                                   06460004
064700              ,:SYSPKG-PCTIMESTAMP                                06470004
064800              ,:SYSPKG-QUALIFIER                                  06480004
064900              ,:SYSPKG-PDSNAME                                    06490004
065000     END-EXEC.                                                    06500004
065100                                                                  06510004
065200     IF SQLCODE = ZERO                                            06520004
065300         PERFORM 5000-GENERATE-OUTPUT THRU 5000-EXIT              06530004
065400     ELSE                                                         06540004
065500     IF SQLCODE =  +100                                           06550004
065600         MOVE 'Y' TO PS-END-OF-TABLE                              06560004
065700     ELSE                                                         06570004
065800         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      06580004
065900         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         06590004
066000         MOVE                                                     06600004
066100         '4300-FETCH ABEND, CONTACT DBA'                          06610004
066200             TO VAR-LMSG                                          06620004
066300         MOVE 'CMN000  ' TO ISP-MSG                               06630004
066400         SET PS-DB2-ERROR TO TRUE.                                06640004
066500                                                                  06650004
066600  4300-EXIT.                                                      06660004
066700     EXIT.                                                        06670004
066800     EJECT                                                        06680004
066900************************************************************      06690004
067000* CLOSE PLCOLLPK_CURSOR                                   *       06700004
067100************************************************************      06710004
067200 4400-CLOSE-PLCOLLPK-CURSOR.                                      06720004
067300                                                                  06730004
067400     EXEC SQL                                                     06740004
067500         CLOSE PLCOLLPK_CURSOR                                    06750004
067600     END-EXEC.                                                    06760004
067700                                                                  06770004
067800     IF SQLCODE NOT = ZERO                                        06780004
067900         SET PS-DB2-ERROR TO TRUE                                 06790004
068000         MOVE 'SQLCODE =' TO VAR-SMSG-FILLER                      06800004
068100         MOVE SQLCODE TO VAR-SMSG-SQLCODE                         06810004
068200         MOVE '4400-CLOSE CURSOR ABEND, CONTACT DBA'              06820004
068300              TO VAR-LMSG                                         06830004
068400         MOVE 'CMN000  ' TO ISP-MSG.                              06840004
068500*                                                                 06850004
068600 4400-EXIT.                                                       06860004
068700     EXIT.                                                        06870004
068800     EJECT                                                        06880004
068900************************************************************      06890004
069000* CREATE REPORT                                            *      06900004
069100************************************************************      06910004
069200 5000-GENERATE-OUTPUT.                                            06920004
069300                                                                  06930004
069400     IF WF-COLLECTION-NAME NOT = SYSPKG-COLLID-TEXT               06940016
069500         MOVE SPACES TO BROWSE-RECORD                             06950004
069600         WRITE BROWSE-RECORD                                      06960004
069700         MOVE SYSPKG-COLLID-TEXT TO WF-COLLECTION-NAME            06970016
069800         MOVE SYSPKG-COLLID-TEXT TO TITLE-COLLECTION              06980016
069900         WRITE BROWSE-RECORD FROM REPORT-TITLE2                   06990004
070000         MOVE SPACES TO BROWSE-RECORD                             07000004
070100         WRITE BROWSE-RECORD                                      07010004
070200         WRITE BROWSE-RECORD FROM REPORT-TITLE3                   07020004
070300         WRITE BROWSE-RECORD FROM REPORT-TITLE4                   07030004
070400         MOVE SPACES TO BROWSE-RECORD                             07040004
070500         WRITE BROWSE-RECORD.                                     07050004
070600                                                                  07060004
070700     MOVE SPACES TO REPORT-LINE1.                                 07070004
070800     MOVE SYSPKG-NAME-TEXT    TO RP1-NAME.                        07080016
070900     MOVE SYSPKG-OWNER-TEXT   TO RP1-OWNER.                       07090016
071000     MOVE SYSPKG-CREATOR-TEXT TO RP1-CREATOR.                     07100016
071100     MOVE SYSPKG-BINDTIME     TO RP1-BINDTIME.                    07110004
071200     MOVE SYSPKG-PCTIMESTAMP  TO RP1-PCTIMESTAMP.                 07120004
071300     MOVE SYSPKG-QUALIFIER-TEXT   TO RP1-QUALIFIER.               07130016
071400     MOVE SYSPKG-PDSNAME-TEXT TO WF-PDS-NAME-LONG.                07140004
071500     IF WF-PDS-NAME-4 = 'SYS9'                                    07150004
071600         IF SYSPKG-OWNER-TEXT = 'PKMO000'                         07160016
071700             MOVE 'PKMO' TO RP1-PDSNAME                           07170004
071800         ELSE                                                     07180004
071900         IF PLAN-SYSTEM-ID = '#'                                  07190004
072000             MOVE 'TKMA' TO RP1-PDSNAME                           07200004
072100         ELSE                                                     07210004
072200         IF PLAN-SYSTEM-ID = 'Q'                                  07220004
072300             MOVE 'QKMO' TO RP1-PDSNAME                           07230004
072400         ELSE                                                     07240004
072500         IF PLAN-SYSTEM-ID = 'L'                                  07250004
072600             MOVE 'LKMO' TO RP1-PDSNAME                           07260004
072700         ELSE                                                     07270004
072800             MOVE WF-PDS-NAME-4 TO RP1-PDSNAME                    07280004
072900     ELSE                                                         07290004
073000         MOVE WF-PDS-NAME-4 TO RP1-PDSNAME.                       07300004
073100     WRITE BROWSE-RECORD FROM REPORT-LINE1.                       07310004
073200                                                                  07320004
073300  5000-EXIT.                                                      07330004
073400     EXIT.                                                        07340004
073500     EJECT                                                        07350004
073600************************************************************      07360004
073700* DISPLAY BROWSE-FILE                                      *      07370004
073800************************************************************      07380004
073900 8000-BROWSE-FILE.                                                07390004
074000     MOVE ZERO TO PV-COUNTR.                                      07400005
074100     INSPECT PV-BROWSE-DSNAME TALLYING PV-COUNTR FOR              07410011
074200                 CHARACTERS BEFORE INITIAL '.'.                   07420005
074300     ADD 2 TO PV-COUNTR.                                          07430005
074400*BLJ MOVE PV-BROWSE-DSNAME (PV-COUNTR:13) TO VAR-DSNAME.          07440019
074400     MOVE PV-BROWSE-DSNAME (PV-COUNTR:21) TO VAR-DSNAME.          07441017
074500     MOVE 'CMNEKR1D' TO ISP-PANEL.                                07450007
074600     CALL 'ISPLINK' USING ISP-BROWSE,                             07460005
074700                          VAR-DSNAME,                             07470005
074800                          VAR-VOLUME,                             07480005
074900                          VAR-PASSWORD,                           07490005
075000                          ISP-PANEL.                              07500005
075100*                                                                 07510005
075200*  CALL THE COMMON PRINT REQUEST PANEL PROGRAM TO ALLOW THE OPTION07520005
075300*  OF PRINTING THE FILE THAT WAS JUST BROWSED.                    07530005
075400*                                                                 07540005
075500     INITIALIZE DP300-ISPF-PRINT-PARMS.                           07550005
075600     MOVE PC-CURRENT-PROGRAM-NAME TO                              07560005
075700               DP300-CALLING-PROGRAM-NAME.                        07570005
075800     MOVE 1 TO DP300-CALLING-REPORT-NUMBER.                       07580005
075900     MOVE PV-BROWSE-DSNAME TO DP300-FILE-DSNAME.                  07590011
076100     SET DP300-FR-FIXED-BLOCK TO TRUE.                            07610005
076200     MOVE 80 TO DP300-FILE-LRECL.                                 07620005
076300     SET DP300-PT-PRINT-TITLE-LINE                                07630005
076400         DP300-RH-REPEAT-HEADINGS TO TRUE.                        07640005
076500     MOVE 2 TO DP300-HEADING-LINE-COUNT.                          07650005
076600     CALL DP300-ISPF-PRINT-REQ-PROGRAM                            07660005
076700               USING DP300-ISPF-PRINT-PARMS.                      07670005
076800     MOVE 'CMN000  ' TO ISP-MSG                                   07680005
076900     MOVE DP300-ERROR-MESSAGE TO VAR-LMSG.                        07690005
077000     IF DP300-RI-PRINT-REQUESTED                                  07700005
077100         MOVE DP300-ERROR-MESSAGE TO VAR-SMSG                     07710005
077200     END-IF.                                                      07720005
077300                                                                  07730005
077400************************************************************      07740005
077500* DELETE BROWSE FILE                                       *      07750005
077600************************************************************      07760005
077700 9100-DELETE-FILE.                                                07770005
077800     INITIALIZE DP023-DYNALC-PARMS.                               07780005
077900     MOVE PC-BROWSE-DDNAME TO DP023-DDNAME.                       07790011
078000     MOVE PV-BROWSE-DSNAME TO DP023-DSNAME.                       07800011
078100     SET DP023-DISP-DELETE TO TRUE.                               07810005
078200     SET DP023-FREE-CLOSE-NO TO TRUE.                             07820005
078300     SET DP023-RECFM-FIXED-BLOCK TO TRUE.                         07830005
078400     MOVE LENGTH OF BROWSE-RECORD TO DP023-RECSZ.                 07840015
078500     MOVE ZEROES TO DP023-RECOUNT.                                07850015
078600                                                                  07860005
078700     SET DP023-DISABLE-DISPLAY-ABEND TO TRUE.                     07870005
078800                                                                  07880005
078900     PERFORM DP023-0000-DYNALC.                                   07890005
079000                                                                  07900005
079100     SET PS-IS-NOT-ALLOCATED TO TRUE.                             07910005
079200                                                                  07920005
079300*                                                                 07930005
079400*  DYNAMIC ALLOCATION ROUTINE                                     07940005
079500*                                                                 07950005
079600     COPY DPPD023.                                                07960005
