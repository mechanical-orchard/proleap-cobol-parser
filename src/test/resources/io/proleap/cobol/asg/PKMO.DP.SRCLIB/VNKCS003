000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400                                                                  00040004
000410 PROGRAM-ID.    VNKCS003.                                         00041004
000500 AUTHOR.        DOUG NOLTNER - STRATAGEM.                         00050000
000600 DATE-WRITTEN.  06/93.                                            00060000
000700*---------------------------------------------------------------* 00070000
000800*    V003 - VENDOR/DEPARTMENT LIST PROGRAM                      * 00080000
000900*                                                               * 00090000
001000*    THIS PROGRAM GENERATES A LIST OF VENDORS FOR THE SPECIFIC  * 00100000
001100*    DEPARTMENT ENTERED.                                        * 00110000
001200*                                                               * 00120000
001210*    WR#21278                                                   * 00121005
001220*                                                               * 00122005
001230*    THE SQL THAT RETRIEVES DATA FROM 'TEXTENT' MUST BE MODIFIED* 00123005
001240*    TO REMOVE 'MDSE_VENDOR_IND', 'EXP_VEND_IND', 'CARRIER_IND, * 00124005
001250*    AND 'FCTR_IND, AND TO ADD THE SELECT OF 'PRIM_TYP_CDE' AND * 00125005
001260*    'PRTNR_TYP_CDE'.                                           * 00126005
001270*                                                               * 00127005
001280*    THE LOGIC THAT IS CHECKING THE CENDOR TYPE ON 'TEXTENT'    * 00128005
001290*    AGAINST THE TYPE THAT WAS KEYED IN THE SELECTION CRITERIA  * 00129005
001291*    SCREEN AND PASSED IN THE INTERAPPL COMMAREA NEEDS TO BE    * 00129105
001292*    MODIFIED TO USE THE APPRPRIATE NEW VALUES OF 'PRIM_TYP_CODE' 00129205
001293*    AND 'PRTNR_TYP_CDE'.                                       * 00129305
001294*                                                               * 00129405
001295*                                                               * 00129505
001296*---------------------------------------------------------------* 00129609
001297* CHANGE LOG:                                                   * 00129709
001298* 09/01/2021 GERMAN BANDA                    WR/IR #: CHG0261091  00129811
001299*            - CHANGE CALL OF DPKUT100 TO                       * 00129909
001300*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00130009
001301*              MAKING THE CALL DYNAMIC VS STATIC                * 00130109
001298* 01/05/2023 JEAN KURK                       WR/IR #: CHG0277999  00130212
001299*            - CHANGE CALL OF DPKCS939 TO DYNAMIC               * 00130312
001302*                                                               * 00130409
001303*---------------------------------------------------------------* 00130500
001310                                                                  00131004
001400 ENVIRONMENT DIVISION.                                            00140000
001410                                                                  00141004
001420     EJECT                                                        00142004
001430                                                                  00143004
001500 DATA DIVISION.                                                   00150000
001600                                                                  00160000
001700 WORKING-STORAGE SECTION.                                         00170000
001800                                                                  00180000
001900 01  DK-DB2-KEY.                                                  00190000
002000     05  DK-STATUS-CODE                 PIC  X(01)  VALUE SPACES. 00200000
002100     05  DK-VEND-NAME                   PIC  X(30)  VALUE SPACE.  00210000
002200     05  DK-VEND-NAME-BYTE              REDEFINES DK-VEND-NAME    00220000
002300                                        OCCURS 30 TIMES           00230000
002400                                        PIC  X(01).               00240000
002500     05  DK-PRIM-NAME                   PIC  X(30).               00250000
002600                                                                  00260000
002700 01  PC-PROGRAM-CONSTANTS.                                        00270000
002800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00280000
002900                                                    'VN003A  '.   00290000
003000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00300000
003100                                                    'VNKM003 '.   00310000
003200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00320000
003300                                                    'VNKCS003'.   00330000
003400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00340000
003500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00350000
003600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00360000
003700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00370000
003800                                                    COMP SYNC.    00380000
003900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00390000
004000                                                    COMP SYNC.    00400000
004100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00410000
004200                                                    +1000000      00420000
004300                                                    COMP-3.       00430000
004400     05  PC-ITM-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00440000
004500                                                    COMP SYNC.    00450000
004600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00460000
004700                                                    COMP-3.       00470000
004800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00480000
004900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00490000
005000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00500000
005100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00510000
005200     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00520000
005300     05  PC-TYPE-CODES.                                           00530000
005400         10  PC-PRIMARY                 PIC  X(02)  VALUE '01'.   00540000
005500         10  PC-ALIAS                   PIC  X(02)  VALUE '02'.   00550000
005600         10  PC-LABEL                   PIC  X(02)  VALUE '03'.   00560000
005700         10  PC-SHORTNAME               PIC  X(02)  VALUE '04'.   00570000
005800                                                                  00580000
005810     EJECT                                                        00581004
005820                                                                  00582004
005900     05  PC-TSYMSG-NUMBERS.                                       00590000
006000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00600000
006100         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00610000
006200         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00620000
006300         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00630000
006400         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00640000
006500         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00650000
006600         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00660000
006700         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00670000
006800         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00680000
006900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00690000
007000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00700000
007100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00710000
007200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00720000
007210         10  PC-TSYMSG-02336            PIC  9(05)  VALUE 02336.  00721003
007300         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00730000
007400                                                                  00740000
007410     EJECT                                                        00741004
007420                                                                  00742004
007500 01  PS-PROGRAM-SWITCHES.                                         00750000
007600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00760000
007700         88  PS-NO-ERROR                            VALUE 'Y'.    00770000
007800         88  PS-ERROR                               VALUE 'N'.    00780000
007900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00790000
008000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00800000
008100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00810000
008200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00820000
008300         88  PS-DONE                                VALUE 'Y'.    00830000
008400         88  PS-NOT-DONE                            VALUE 'N'.    00840000
008500                                                                  00850000
008600 01  PL-PROGRAM-LITERALS.                                         00860000
008700     05  PL-PRIMARY                     PIC  X(10)  VALUE         00870000
008800                                                    'PRIMARY   '. 00880000
008900     05  PL-ALIAS                       PIC  X(10)  VALUE         00890000
009000                                                    'ALIAS     '. 00900000
009100     05  PL-LABEL                       PIC  X(10)  VALUE         00910000
009200                                                    'LABEL     '. 00920000
009300     05  PL-SHORTNAME                   PIC  X(10)  VALUE         00930000
009400                                                    'SHORT NAME'. 00940000
009500                                                                  00950000
009600 01  PV-PROGRAM-VARIABLES.                                        00960000
009700     05  PV-SUB                         PIC S9(04)  VALUE +0      00970000
009800                                                    COMP SYNC.    00980000
009900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00990000
010000                                                    COMP SYNC.    01000000
010100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01010000
010200                                                    COMP-3.       01020000
010300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01030000
010400                                                    COMP-3.       01040000
010500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01050000
010600                                                    COMP-3.       01060000
010700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01070000
010800                                                    COMP-3.       01080000
010900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01090000
011000                                                    COMP-3.       01100000
011100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01110000
011200                                                    COMP-3.       01120000
011300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01130000
011400                                                    COMP-3.       01140000
011500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01150000
011600                                                    COMP SYNC.    01160000
011700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01170000
011800                                                    COMP SYNC.    01180000
011900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01190000
012000                                                    COMP SYNC.    01200000
012100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01210000
012200                                                    COMP SYNC.    01220000
012300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01230000
012400                                                    COMP SYNC.    01240000
012500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01250000
012600                                                    COMP SYNC.    01260000
012700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01270000
012800                                                    COMP SYNC.    01280000
012900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01330000
013400                                                    COMP SYNC.    01340000
013500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01350000
013600                                                    COMP SYNC.    01360000
013700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01370000
013800                                                    COMP SYNC.    01380000
013900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01390000
014000                                                    COMP SYNC.    01400000
014100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01410000
014200                                                    COMP SYNC.    01420000
014300     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01430000
014400                                                    COMP SYNC.    01440000
014500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01450000
014600                                                    COMP SYNC.    01460000
014610                                                                  01461004
014620     EJECT                                                        01462004
014630                                                                  01463004
014700******************************************************************01470000
014800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01480000
014900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01490000
015000**  APPLICATION-SPECIFIC COMMAREA.                              **01500000
015100******************************************************************01510000
015200                                                                  01520004
015210 01  LQW-LIST-QUEUE-WORK-AREA.                                    01521004
015300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01530000
015400     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01540000
015500                                        INDEXED BY LQW-IDX.       01550000
015600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01560000
015700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01570000
015800         10  LQW-SELECTED-SW            PIC  X(01).               01580000
015900             88  LQW-SELECT                         VALUE 'S'.    01590000
016000             88  LQW-DESELECT                       VALUE ' '.    01600000
016100         10  LQW-ACTION                 PIC  X(03).               01610000
016200         10  LQW-VEND-TYPE              PIC  X(01).               01620000
016300         10  LQW-VEND-NAME              PIC  X(28).               01630000
016400         10  LQW-TYPE-CDE               PIC  X(02).               01640000
016500         10  LQW-PRM-NME                PIC  X(24).               01650000
016600         10  LQW-ENT-ID                 PIC S9(09)  COMP.         01660000
016700                                                                  01670000
016710     EJECT                                                        01671004
016720                                                                  01672004
016800*---------------------------------------------------------------* 01680000
016900*  RECORD LAYOUT FOR THE VENDOR  SELECTION TEMP STORAGE QUEUE.  * 01690000
017000*---------------------------------------------------------------* 01700000
017010                                                                  01701004
017110     COPY VNWS003.                                                01711008
017200                                                                  01720000
017210     EJECT                                                        01721004
017220                                                                  01722004
017300*---------------------------------------------------------------* 01730000
017400*    MAP LAYOUT                                                 * 01740000
017500*---------------------------------------------------------------* 01750000
017510                                                                  01751004
017600     COPY VNKM003.                                                01760000
017700                                                                  01770000
017710     EJECT                                                        01771004
017720                                                                  01772004
017800 01  MR-OCCURS-LAYOUT                   REDEFINES  VN003AO.       01780000
017900     05  FILLER                         PIC X(48).                01790000
018000     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          01800000
018100         10  MR-SELECTL                 PIC S9(04) COMP.          01810000
018200         10  MR-SELECTA                 PIC  X(01).               01820000
018300         10  MR-SELECTC                 PIC  X(01).               01830000
018400         10  MR-SELECTH                 PIC  X(01).               01840000
018500         10  MR-SELECTI                 PIC  X(01).               01850000
018600                                                                  01860000
018700         10  MR-ACTIONL                 PIC S9(04) COMP.          01870000
018800         10  MR-ACTIONA                 PIC  X(01).               01880000
018900         10  MR-ACTIONC                 PIC  X(01).               01890000
019000         10  MR-ACTIONH                 PIC  X(01).               01900000
019100         10  MR-ACTION                  PIC  X(03).               01910000
019200                                                                  01920000
019300         10  MR-VEND-TYPEL              PIC S9(04) COMP.          01930000
019400         10  MR-VEND-TYPEA              PIC  X(01).               01940000
019500         10  MR-VEND-TYPEC              PIC  X(01).               01950000
019600         10  MR-VEND-TYPEH              PIC  X(01).               01960000
019700         10  MR-VEND-TYPE               PIC  X(01).               01970000
019800                                                                  01980000
019900         10  MR-VEND-NAMEL              PIC S9(04) COMP.          01990000
020000         10  MR-VEND-NAMEA              PIC  X(01).               02000000
020100         10  MR-VEND-NAMEC              PIC  X(01).               02010000
020200         10  MR-VEND-NAMEH              PIC  X(01).               02020000
020300         10  MR-VEND-NAME               PIC  X(28).               02030000
020400                                                                  02040000
020500         10  MR-TYPE-DSCL               PIC S9(04) COMP.          02050000
020600         10  MR-TYPE-DSCA               PIC  X(01).               02060000
020700         10  MR-TYPE-DSCC               PIC  X(01).               02070000
020800         10  MR-TYPE-DSCH               PIC  X(01).               02080000
020900         10  MR-TYPE-DSC                PIC  X(10).               02090000
021000                                                                  02100000
021100         10  MR-PRM-NMEL                PIC S9(04) COMP.          02110000
021200         10  MR-PRM-NMEA                PIC  X(01).               02120000
021300         10  MR-PRM-NMEC                PIC  X(01).               02130000
021400         10  MR-PRM-NMEH                PIC  X(01).               02140000
021500         10  MR-PRM-NME                 PIC  X(24).               02150000
021600                                                                  02160000
021610     EJECT                                                        02161004
021620                                                                  02162004
021700*---------------------------------------------------------------* 02170000
021800*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02180000
021900*---------------------------------------------------------------* 02190000
021910                                                                  02191004
022010     COPY DPWS015.                                                02201008
022100                                                                  02210000
022110     EJECT                                                        02211004
022120                                                                  02212004
022200*---------------------------------------------------------------* 02220000
022300*    FUNCTION KEYS COPYBOOK.                                    * 02230000
022400*---------------------------------------------------------------* 02240000
022410                                                                  02241004
022510     COPY DPWS016.                                                02251008
022600                                                                  02260000
022610     EJECT                                                        02261004
022620                                                                  02262004
022700*---------------------------------------------------------------* 02270000
022800*    NUMERIC EDIT LAYOUT.                                       * 02280000
022900*---------------------------------------------------------------* 02290000
022910                                                                  02291004
023010     COPY DPWS010I.                                               02301008
023100                                                                  02310000
023110     EJECT                                                        02311004
023120                                                                  02312004
023200*---------------------------------------------------------------* 02320000
023300*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 02330012
023400*---------------------------------------------------------------* 02340000
023410                                                                  02341004
023510     COPY DPWS030.                                                02351008
023510     COPY DPWS930.                                                02352013
023600                                                                  02360000
023610     EJECT                                                        02361004
023620                                                                  02362004
023700*---------------------------------------------------------------* 02370000
023800*    STANDARD COMMAREA.                                         * 02380000
023900*---------------------------------------------------------------* 02390000
023910                                                                  02391004
024001     COPY DPWS020.                                                02400108
024010                                                                  02401004
024100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02410000
024200*---------------------------------------------------------------* 02420000
024300* INTER-APPLICATION COMMAREA.                                   * 02430000
024400*   VNWS001 - INPUT FROM CRITERIA SPECIFICATION PROGRAM         * 02440000
024500*   VNWS002 - OUTPUT TO LOCAL-GO FUNCTION                       * 02450000
024600*---------------------------------------------------------------* 02460000
024700         10  INTER-APPL-COMM-AREA       PIC X(200).               02470000
024710                                                                  02471004
024801     COPY VNWS001.                                                02480108
024810                                                                  02481004
024901     COPY VNWS002.                                                02490108
024910                                                                  02491004
025000*---------------------------------------------------------------* 02500000
025100*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02510000
025200*---------------------------------------------------------------* 02520000
025210                                                                  02521004
025300         10  ASC-SPECIFIC-COMMAREA.                               02530000
025400             15  ASC-LIST-KEYS.                                   02540000
025500                 20  ASC-KEY-VEND-NAME               PIC  X(30).  02550000
025600                 20  ASC-KEY-VEND-TYPE               PIC  X(01).  02560000
025700                 20  ASC-KEY-STATUS-CODE             PIC  X(01).  02570000
025800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02580000
025900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  02590000
026000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   02600000
026100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   02610000
026200                                                                  02620000
026300                 20  ASC-ITEM-ARRAY.                              02630000
026400                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        02640000
026500                         30  ASC-LIST-ITEM-NUMBER                 02650000
026600                                                     PIC S9(09)   02660000
026700                                                     COMP-3.      02670000
026800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  02680000
026900                             88  ASC-VALID-SELECT    VALUE ' '    02690000
027000                                                           'S'    02700000
027100                                                           'B'    02710000
027200                                                           'E'.   02720000
027300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   02730000
027400                             88  ASC-TEMP-SELECT     VALUE 'S'.   02740000
027500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   02750000
027600                             88  ASC-TEMP-END        VALUE 'E'.   02760000
027700                         30  ASC-SELECTED-SW         PIC  X(01).  02770000
027800                             88  ASC-NO-SELECT       VALUE ' '.   02780000
027900                             88  ASC-SELECT          VALUE 'S'.   02790000
028000                             88  ASC-BEGIN           VALUE 'B'.   02800000
028100                             88  ASC-END             VALUE 'E'.   02810000
028200                         30  ASC-ACTION              PIC  X(03).  02820000
028300                         30  ASC-VEND-TYPE           PIC  X(01).  02830000
028400                         30  ASC-VEND-NAME           PIC  X(28).  02840000
028500                         30  ASC-TYPE-CDE            PIC  X(02).  02850000
028600                         30  ASC-PRM-NME             PIC  X(24).  02860000
028700                         30  ASC-ENT-ID              PIC S9(09)   02870000
028800                                                     COMP.        02880000
028900                                                                  02890000
029000             15  ASC-BLK-SUB                         PIC S9(04)   02900000
029100                                                          COMP    02910000
029200                                                          SYNC.   02920000
029300             15  ASC-ITEM-SUB                        PIC S9(04)   02930000
029400                                                          COMP    02940000
029500                                                          SYNC.   02950000
029600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   02960000
029700                                                          COMP-3. 02970000
029800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   02980000
029900                                                          COMP-3. 02990000
030000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03000000
030100                                                          COMP-3. 03010000
030200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03020000
030300                                                          COMP-3. 03030000
030400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03040000
030500                                                          COMP-3. 03050000
030600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03060000
030700                                                          COMP    03070000
030800                                                          SYNC.   03080000
030900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03090000
031000                                                          COMP-3. 03100000
031100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03110000
031200                                                          COMP-3. 03120000
031300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03130000
031400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03140000
031500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03150000
031600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03160000
031700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03170000
031800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03180000
031900             15  ASC-LIST-QUEUE-NAME.                             03190000
032000                 20  ASC-LIST-TERM-ID                PIC  X(04).  03200000
032100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03210000
032200                                                          COMP-3. 03220000
032300                 20  ASC-LIST-SEQ                    PIC  9(01).  03230000
032400             15  ASC-SEL-QUEUE-NAME.                              03240000
032500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03250000
032600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03260000
032700                                                          COMP-3. 03270000
032800                 20  ASC-SEL-SEQ                     PIC  9(01).  03280000
032900                                                                  03290000
033000             15  ASC-START-ITEM-REQUEST.                          03300000
033100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  03310000
033200             15  ASC-SAVE-INPUT                      PIC  X(200). 03320000
033300                                                                  03330000
033310     EJECT                                                        03331004
033320                                                                  03332004
033400*---------------------------------------------------------------* 03340000
033500*    ABEND PROCESSING COPYBOOK.                                 * 03350000
033600*---------------------------------------------------------------* 03360000
033610                                                                  03361004
033710     COPY DPWS013.                                                03371008
033800                                                                  03380000
033810     EJECT                                                        03381004
033820                                                                  03382004
033900*---------------------------------------------------------------* 03390000
034000*    DB2 AREA FOR ENTERPRISE NAME                               * 03400000
034100*---------------------------------------------------------------* 03410000
034200     EXEC SQL                                                     03420000
034300          INCLUDE TENTNME                                         03430000
034400     END-EXEC.                                                    03440000
034500                                                                  03450000
034510     EJECT                                                        03451004
034520                                                                  03452004
034600*---------------------------------------------------------------* 03460000
034700*    DB2 AREA FOR EXTERNAL ENTERPRISE                           * 03470000
034800*---------------------------------------------------------------* 03480000
034900     EXEC SQL                                                     03490000
035000          INCLUDE TEXTENT                                         03500000
035100     END-EXEC.                                                    03510000
035200                                                                  03520000
035210     EJECT                                                        03521004
035220                                                                  03522004
035300*---------------------------------------------------------------* 03530000
035400*    DB2 AREA FOR COMMUNICATIONS                                * 03540000
035500*---------------------------------------------------------------* 03550000
035600     EXEC SQL                                                     03560000
035700          INCLUDE SQLCA                                           03570000
035800     END-EXEC.                                                    03580000
035900                                                                  03590000
035910     EJECT                                                        03591004
035920                                                                  03592004
036000*---------------------------------------------------------------* 03600000
036100*    VENDOR CURSOR WHEN VENDOR NAME IS ENTERED                  * 03610000
036200*---------------------------------------------------------------* 03620000
036300                                                                  03630005
037901     EXEC SQL                                                     03790105
037902          DECLARE VENDOR-CSR CURSOR FOR                           03790205
037903           SELECT A.ENT_ID                                        03790305
037904                 ,A.ENT_NAME_DESC                                 03790405
037905                 ,A.TYPE_CDE                                      03790505
037906                 ,B.PRIM_TYP_CDE                                  03790605
037907                 ,B.PRTNR_TYP_CDE                                 03790705
037910                 ,B.PRNT_CO_IND                                   03791005
037911             FROM TENTNME A                                       03791105
037912                 ,TEXTENT B                                       03791205
037913            WHERE A.ENT_NAME_DESC LIKE :DK-VEND-NAME              03791305
037914              AND B.ENT_ID        = A.ENT_ID                      03791405
037915              AND B.STATUS_CDE    = :DK-STATUS-CODE               03791505
037916              AND A.TYPE_CDE NOT IN ('05')                        03791608
037917         ORDER BY A.ENT_NAME_DESC                                 03791708
037918                 ,A.TYPE_CDE                                      03791808
037919     END-EXEC.                                                    03791908
037920                                                                  03792008
037921                                                                  03792108
037922     EJECT                                                        03792208
037930                                                                  03793004
038000 LINKAGE SECTION.                                                 03800000
038100                                                                  03810000
038200 01  DFHCOMMAREA.                                                 03820000
038300     05  FILLER                         OCCURS  1 TO 4072 TIMES   03830000
038400                                        DEPENDING ON EIBCALEN.    03840000
038500         10  FILLER                     PIC X.                    03850000
038600                                                                  03860000
038610     EJECT                                                        03861004
038620                                                                  03862004
038700 PROCEDURE DIVISION.                                              03870000
038800                                                                  03880000
038900     INITIALIZE DP030-CICS-API-FIELDS.                            03890000
038910                                                                  03891004
039000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03900000
039100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03910000
039200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03920000
039300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03930000
039400     MOVE LENGTH OF VN003AI        TO DP030-MAP-LENGTH (1).       03940000
039500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03950000
039600                                                                  03960000
039700     PERFORM 0001-CALL-CICS-ARCH-API.                             03970000
039800                                                                  03980000
039900     PERFORM 1000-CONTROL-PROCESSING                              03990000
040000                                                                  04000000
040100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04010000
040200                                                                  04020000
040300     PERFORM 0001-CALL-CICS-ARCH-API.                             04030000
040400                                                                  04040000
040410     EJECT                                                        04041004
040420                                                                  04042004
040500******************************************************************04050000
040600**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04060000
040700**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04070000
040800******************************************************************04080000
040810                                                                  04081004
040900 0001-CALL-CICS-ARCH-API.                                         04090000
041000                                                                  04100000
041100*    CALL 'DPKCS030' USING DFHEIBLK                               04110012
041100     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04111012
041200                           DFHCOMMAREA                            04120000
041300                           DP030-CICS-API-FIELDS                  04130000
041400                           DP020-STANDARD-COMMAREA                04140000
041500                           VN003AI.                               04150000
041600                                                                  04160000
041700     IF DP030-RC-CALL-SUCCESSFUL                                  04170000
041800         CONTINUE                                                 04180000
041900     ELSE                                                         04190000
042000         SET DP013-NO-ROLLBACK                                    04200000
042100             DP013-XCTL-DISPLAY-RESTART                           04210000
042200             DP013-CICS-ABEND      TO TRUE                        04220000
042300         MOVE '0001-CALL-CICS-ARCH-API'                           04230000
042400                                   TO DP013-PARAGRAPH             04240000
042500*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX04250012
042600*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      04260012
042500         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04261012
042600-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04262012
042700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04270000
042800         PERFORM DP013-0000-PROCESS-ABEND.                        04280000
042900                                                                  04290000
042910     EJECT                                                        04291004
042920                                                                  04292004
043000*----------------------------------------------------------------*04300000
043100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04310000
043200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04320000
043300*----------------------------------------------------------------*04330000
043310                                                                  04331004
043400 1000-CONTROL-PROCESSING.                                         04340000
043500                                                                  04350000
043600     EVALUATE TRUE                                                04360000
043700         WHEN DP020-NEXT-ACT-INITIAL                              04370000
043800             INITIALIZE ASC-SPECIFIC-COMMAREA                     04380000
043900             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       04390000
044000                                           ASC-SEL-TERM-ID        04400000
044100             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   04410000
044200                                           ASC-SEL-TASK-NUMBER    04420000
044300             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           04430000
044400             MOVE PC-SEL-QUEUE-SEQ      TO ASC-SEL-SEQ            04440000
044500                                                                  04450000
044600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 04460000
044700                                                                  04470000
044800             PERFORM 4000-BUILD-INITIAL-PANEL                     04480000
044900                                                                  04490000
045000         WHEN DP020-NEXT-ACT-READ-MAP                             04500000
045100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04510000
045200                                                                  04520000
045300             PERFORM 2000-PROCESS-PANEL                           04530000
045400                                                                  04540000
045500         WHEN DP020-NEXT-ACT-RETURN                               04550000
045600             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         04560000
045700             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                04570000
045800                                                                  04580000
045900             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04590000
046000                                                                  04600000
046100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04610000
046200                                                                  04620000
046300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   04630000
046400                                                                  04640000
046500         WHEN OTHER                                               04650000
046600             SET DP013-LOGIC-ABEND                                04660000
046700                 DP013-NO-ROLLBACK TO TRUE                        04670000
046800             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    04680000
046900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    04690000
047000                                          TO DP013-MESSAGE-TEXT(1)04700000
047100             PERFORM DP013-0000-PROCESS-ABEND                     04710000
047200     END-EVALUATE.                                                04720000
047300                                                                  04730000
047310     EJECT                                                        04731007
047320                                                                  04732007
047400*----------------------------------------------------------------*04740000
047500* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04750000
047600* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04760000
047700*----------------------------------------------------------------*04770000
047800 1100-PROCESS-INTER-APPL-COMM.                                    04780000
047900                                                                  04790000
048000     SET PS-COMMAREA-VALID TO TRUE.                               04800000
048100     MOVE SPACE TO ASC-START-ITEM-REQUEST.                        04810000
048200                                                                  04820000
048300     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           04830000
048400         MOVE VN001-VENDOR-NAME         TO ASC-KEY-VEND-NAME      04840000
048500         MOVE VN001-VENDOR-TYPE         TO ASC-KEY-VEND-TYPE      04850000
048600         MOVE VN001-STATUS-CODE         TO ASC-KEY-STATUS-CODE    04860000
048700         MOVE VN001-INTER-APPL-COMMAREA TO ASC-SAVE-INPUT         04870000
048800     ELSE                                                         04880000
048900         IF DP020-NAV-KEY-DATA > SPACES                           04890000
049000             MOVE DP020-NAV-KEY-DATA TO ASC-KEY-VEND-NAME         04900000
049100         END-IF                                                   04910000
049200         MOVE 'A' TO ASC-KEY-STATUS-CODE                          04920000
049300     END-IF.                                                      04930000
049400                                                                  04940000
049500*----------------------------------------------------------------*04950000
049600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *04960000
049700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *04970000
049800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *04980000
049900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *04990000
050000* FUNCTION KEYS CAN GET THIS FAR.                                *05000000
050100*----------------------------------------------------------------*05010000
050200 2000-PROCESS-PANEL.                                              05020000
050300                                                                  05030000
050400     EVALUATE TRUE                                                05040000
050500         WHEN DP020-SRC-AID = DP016-CLEAR                         05050000
050600              MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL               05060000
050700                                                                  05070000
050800              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05080000
050900                                                                  05090000
051000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05100000
051100                                                                  05110000
051200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05120000
051300              PERFORM 2050-DELETE-LIST-QUEUE                      05130000
051400                                                                  05140000
051500              PERFORM 4000-BUILD-INITIAL-PANEL                    05150000
051600                                                                  05160000
051700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    05170000
051800              PERFORM 2140-DESELECT-ALL-ITEMS                     05180000
051900                                                                  05190000
052000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05200000
052100                                                                  05210000
052200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  05220000
052300              PERFORM 2150-SELECT-ALL-ITEMS                       05230000
052400                                                                  05240000
052500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                05250000
052600                                                                  05260000
052700         WHEN OTHER                                               05270000
052800              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                05280000
052900                                                                  05290000
053000              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  05300000
053100                                                                  05310000
053200              IF PS-NO-ERROR                                      05320000
053300                  SET DP030-CONTINUE-GO TO TRUE                   05330000
053400                                                                  05340000
053500                  PERFORM 2100-CHECK-FUNCTION-KEY                 05350000
053600              ELSE                                                05360000
053700                  SET DP030-OVERRIDE-GO TO TRUE                   05370000
053800              END-IF                                              05380000
053900     END-EVALUATE.                                                05390000
054000                                                                  05400000
054100*----------------------------------------------------------------*05410000
054200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05420000
054300*----------------------------------------------------------------*05430000
054400 2050-DELETE-LIST-QUEUE.                                          05440000
054500                                                                  05450000
054600     EXEC CICS                                                    05460000
054700         DELETEQ TS                                               05470000
054800             QUEUE (ASC-LIST-QUEUE-NAME)                          05480000
054900             RESP  (PV-CICS-RESP)                                 05490000
055000     END-EXEC.                                                    05500000
055100                                                                  05510000
055200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05520000
055300        (PV-CICS-RESP = DFHRESP(QIDERR))                          05530000
055400         CONTINUE                                                 05540000
055500     ELSE                                                         05550000
055600         SET DP013-CICS-ABEND                                     05560000
055700             DP013-NO-ROLLBACK TO TRUE                            05570000
055800                                                                  05580000
055900         MOVE '2050-DELETE-LIST-QUEUE'                            05590000
056000                                   TO DP013-PARAGRAPH             05600000
056100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05610000
056200                                   TO DP013-MESSAGE-TEXT (1)      05620000
056300         PERFORM DP013-0000-PROCESS-ABEND                         05630000
056400     END-IF.                                                      05640000
056500                                                                  05650000
056600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  05660000
056700                                                                  05670000
056800*----------------------------------------------------------------*05680000
056900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05690000
057000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05700000
057100* CICS ARCHITECTURE API.                                         *05710000
057200*----------------------------------------------------------------*05720000
057300 2100-CHECK-FUNCTION-KEY.                                         05730000
057400                                                                  05740000
057500     EVALUATE TRUE                                                05750000
057600         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  05760000
057700              IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              05770000
057800                  INITIALIZE VN002-INTER-APPL-COMMAREA            05780000
057900                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               05790000
058000                                TO VN002-NUMBER-OF-SELECTED-ITEMS 05800000
058100                  PERFORM 5000-PREPARE-SEL-QUEUE                  05810000
058200              ELSE                                                05820000
058300                  SET DP030-OVERRIDE-GO                           05830000
058400                      DP020-MSG-WARNING TO TRUE                   05840000
058500                  MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER       05850000
058600             END-IF                                               05860000
058700                                                                  05870000
058800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05880000
058900             MOVE +1               TO PV-TOP-ITEM                 05890000
059000                                                                  05900000
059100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05910000
059200                                                                  05920000
059300             PERFORM 3200-RESET-ATTRIBUTES                        05930000
059400                                                                  05940000
059500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05950000
059600             PERFORM 2110-BROWSE-BACKWARD                         05960000
059700                                                                  05970000
059800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05980000
059900                                                                  05990000
060000             PERFORM 3200-RESET-ATTRIBUTES                        06000000
060100                                                                  06010000
060200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06020000
060300             PERFORM 2120-BROWSE-FORWARD                          06030000
060400                                                                  06040000
060500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06050000
060600                                                                  06060000
060700             PERFORM 3200-RESET-ATTRIBUTES                        06070000
060800                                                                  06080000
060900         WHEN DP020-SRC-AID = DP016-ENTER                         06090000
061000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06100000
061100                                                                  06110000
061200             IF PS-ERROR                                          06120000
061300                 CONTINUE                                         06130000
061400             ELSE                                                 06140000
061500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06150000
061600             END-IF                                               06160000
061700                                                                  06170000
061800         WHEN OTHER                                               06180000
061900             SET DP013-NO-ROLLBACK                                06190000
062000                 DP013-XCTL-DISPLAY-RESTART                       06200000
062100                 DP013-CICS-ABEND  TO TRUE                        06210000
062200             MOVE '2100-CHECK-FUNCTION-KEY'                       06220000
062300                                   TO DP013-PARAGRAPH             06230000
062400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06240000
062500                                   TO DP013-MESSAGE-TEXT (1)      06250000
062600             PERFORM DP013-0000-PROCESS-ABEND                     06260000
062700     END-EVALUATE.                                                06270000
062800                                                                  06280000
062900*----------------------------------------------------------------*06290000
063000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06300000
063100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06310000
063200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06320000
063300*    MESSAGE.                                                    *06330000
063400*----------------------------------------------------------------*06340000
063500 2110-BROWSE-BACKWARD.                                            06350000
063600                                                                  06360000
063700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06370000
063800         GIVING PV-TOP-ITEM.                                      06380000
063900                                                                  06390000
064000     IF  ((PV-TOP-ITEM < +1)                                      06400000
064100       OR (PV-TOP-ITEM = +1))                                     06410000
064200         MOVE +1                   TO PV-TOP-ITEM                 06420000
064300*        -- TOP OF LIST --                                        06430000
064400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06440000
064500         SET DP020-MSG-INFORMATIONAL TO TRUE                      06450000
064600     END-IF.                                                      06460000
064700                                                                  06470000
064800*----------------------------------------------------------------*06480000
064900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06490000
065000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06500000
065100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06510000
065200*----------------------------------------------------------------*06520000
065300 2120-BROWSE-FORWARD.                                             06530000
065400                                                                  06540000
065500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06550000
065600         GIVING PV-TOP-ITEM.                                      06560000
065700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06570000
065800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06580000
065900                                   TO PV-TOP-ITEM                 06590000
066000*        -- BOTTOM OF LIST --                                     06600000
066100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06610000
066200         SET DP020-MSG-INFORMATIONAL                              06620000
066300                                   TO TRUE                        06630000
066400     ELSE                                                         06640000
066500         COMPUTE PV-BOTTOM-ITEM =                                 06650000
066600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06660000
066700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06670000
066800*            -- BOTTOM OF LIST --                                 06680000
066900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06690000
067000             SET DP020-MSG-INFORMATIONAL                          06700000
067100                                   TO TRUE                        06710000
067200         END-IF                                                   06720000
067300     END-IF.                                                      06730000
067400                                                                  06740000
067500*----------------------------------------------------------------*06750000
067600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06760000
067700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06770000
067800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06780000
067900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06790000
068000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06800000
068100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06810000
068200*----------------------------------------------------------------*06820000
068300 2130-CHECK-FOR-JUMP-BROWSE.                                      06830000
068400                                                                  06840000
068500     SET PS-NO-ERROR               TO TRUE.                       06850000
068600     IF (ASC-START-ITEM-REQUEST = SPACE)                          06860000
068700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06870000
068800                                   TO PV-TOP-ITEM                 06880000
068900     ELSE                                                         06890000
069000         MOVE ASC-START-ITEM-REQUEST                              06900000
069100                                   TO DP010I-UNEDITED-FIELD       06910000
069200         MOVE PC-ITM-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06920000
069300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06930000
069400         SET DP010I-NEGATIVE-NOT-ALLOWED                          06940000
069500                                   TO TRUE                        06950000
069610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06961009
069620                         USING DP010I-NUMERIC-EDIT-AREA           06962009
069700                                                                  06970000
069800         IF  NOT DP010I-ERROR-DETECTED                            06980000
069900             MOVE DP010I-NUMERIC-FIELD                            06990000
070000                                   TO  ASC-START-ITEM-REQUEST-N   07000000
070100             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07010000
070200                 IF  ASC-START-ITEM-REQUEST-N >                   07020000
070300                                          ASC-NUMBER-OF-ITEMS-READ07030000
070400                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07040000
070500                     COMPUTE PV-TOP-ITEM =                        07050000
070600                             ASC-NUMBER-OF-ITEMS-READ             07060000
070700                             - PC-ITEMS-PER-PANEL + 1             07070000
070800                     IF  PV-TOP-ITEM < +1                         07080000
070900                         MOVE +1   TO PV-TOP-ITEM                 07090000
071000                         MOVE PC-TSYMSG-00070                     07100000
071100                                   TO DP020-MSG-NUMBER            07110000
071200                         SET DP020-MSG-INFORMATIONAL              07120000
071300                                   TO TRUE                        07130000
071400                     END-IF                                       07140000
071500                 ELSE                                             07150000
071600                     MOVE ASC-START-ITEM-REQUEST-N                07160000
071700                                   TO PV-TOP-ITEM                 07170000
071800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07180000
071900                     COMPUTE PV-BOTTOM-ITEM =                     07190000
072000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07200000
072100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07210000
072200*                        -- BOTTOM OF LIST --                     07220000
072300                         MOVE PC-TSYMSG-00070                     07230000
072400                                   TO DP020-MSG-NUMBER            07240000
072500                         SET DP020-MSG-INFORMATIONAL              07250000
072600                                   TO TRUE                        07260000
072700                     END-IF                                       07270000
072800                 END-IF                                           07280000
072900             ELSE                                                 07290000
073000*                --- VALUE OUT OF RANGE ----                      07300000
073100                 MOVE PC-TSYMSG-00101                             07310000
073200                                   TO DP020-MSG-NUMBER            07320000
073300                 MOVE -1           TO ASTRTITL                    07330000
073400                 SET DP030-SET-CURSOR-APPL-1                      07340000
073500                                   TO TRUE                        07350000
073600                 MOVE DP015-REVERSE                               07360000
073700                                   TO ASTRTITH                    07370000
073800                 MOVE DP015-RED    TO ASTRTITC                    07380000
073900                 MOVE DP015-UNP-NUM-BRT-MDT                       07390000
074000                                   TO ASTRTITA                    07400000
074100                 SET DP020-MSG-FATAL                              07410000
074200                                   TO TRUE                        07420000
074300                 SET PS-ERROR      TO TRUE                        07430000
074400             END-IF                                               07440000
074500                                                                  07450000
074600         ELSE                                                     07460000
074700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07470000
074800             MOVE -1               TO ASTRTITL                    07480000
074900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07490000
075000             MOVE DP015-REVERSE    TO ASTRTITH                    07500000
075100             MOVE DP015-RED        TO ASTRTITC                    07510000
075200             MOVE DP015-UNP-NUM-BRT-MDT                           07520000
075300                                   TO ASTRTITA                    07530000
075400             SET DP020-MSG-FATAL   TO TRUE                        07540000
075500             SET PS-ERROR          TO TRUE                        07550000
075600         END-IF                                                   07560000
075700     END-IF.                                                      07570000
075800                                                                  07580000
075900*----------------------------------------------------------------*07590000
076000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *07600000
076100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *07610000
076200*----------------------------------------------------------------*07620000
076300 2140-DESELECT-ALL-ITEMS.                                         07630000
076400                                                                  07640000
076500     MOVE +1                       TO ASC-BLK-SUB.                07650000
076600                                                                  07660000
076700     PERFORM 2141-CLEAR-SELECTED-INDS                             07670000
076800         VARYING ASC-ITEM-SUB                                     07680000
076900         FROM 1 BY 1                                              07690000
077000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07700000
077100                                                                  07710000
077200     ADD +1                        TO ASC-BLK-SUB.                07720000
077300                                                                  07730000
077400     PERFORM 2141-CLEAR-SELECTED-INDS                             07740000
077500         VARYING ASC-ITEM-SUB                                     07750000
077600         FROM 1 BY 1                                              07760000
077700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 07770000
077800                                                                  07780000
077900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               07790000
078000                                   TO PV-LIST-ITEM-NUMBER.        07800000
078100                                                                  07810000
078200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            07820000
078300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    07830000
078400                                                                  07840000
078500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     07850000
078600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      07860000
078700         MOVE +1                   TO ASC-BLK-SUB                 07870000
078800                                                                  07880000
078900         PERFORM 5100-WRITE-TEMP-STORAGE                          07890000
079000                                                                  07900000
079100         MOVE +1                   TO PV-BLOCK-NUMBER             07910000
079200                                                                  07920000
079300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         07930000
079400             PV-FIRST-BLOCK-IN-ARRAY - 1                          07940000
079500                                                                  07950000
079600         PERFORM                                                  07960000
079700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       07970000
079800                                                                  07980000
079900             PERFORM 4410-READ-TEMP-STORAGE                       07990000
080000                                                                  08000000
080100             PERFORM 2141-CLEAR-SELECTED-INDS                     08010000
080200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 08020000
080300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08030000
080400                                                                  08040000
080500             PERFORM 5100-WRITE-TEMP-STORAGE                      08050000
080600                                                                  08060000
080700             ADD +1                TO PV-BLOCK-NUMBER             08070000
080800                                                                  08080000
080900         END-PERFORM                                              08090000
081000                                                                  08100000
081100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         08110000
081200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     08120000
081300                                                                  08130000
081400         PERFORM                                                  08140000
081500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       08150000
081600                   ASC-HIGHEST-BLOCK-WRITTEN                      08160000
081700                                                                  08170000
081800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          08180000
081900                                   TO PV-BLOCK-NUMBER             08190000
082000                                                                  08200000
082100             PERFORM 4410-READ-TEMP-STORAGE                       08210000
082200                                                                  08220000
082300             PERFORM 2141-CLEAR-SELECTED-INDS                     08230000
082400                 VARYING ASC-ITEM-SUB                             08240000
082500                 FROM 1 BY 1                                      08250000
082600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08260000
082700                                                                  08270000
082800             PERFORM 5100-WRITE-TEMP-STORAGE                      08280000
082900                                                                  08290000
083000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      08300000
083100                                                                  08310000
083200         END-PERFORM                                              08320000
083300                                                                  08330000
083400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             08340000
083500                                   TO PV-BLOCK-NUMBER             08350000
083600                                                                  08360000
083700         PERFORM 4410-READ-TEMP-STORAGE                           08370000
083800     END-IF.                                                      08380000
083900                                                                  08390000
084000                                                                  08400000
084100     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 08410000
084200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.08420000
084300     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  08430000
084400                                                                  08440000
084500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        08450000
084600                                                                  08460000
084700*----------------------------------------------------------------*08470000
084800*    MARK EACH ITEM AS BEING NOT SELECTED.                       *08480000
084900*----------------------------------------------------------------*08490000
085000 2141-CLEAR-SELECTED-INDS.                                        08500000
085100                                                                  08510000
085200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           08520000
085300             NOT EQUAL ZERO                                       08530000
085400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08540000
085500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          08550000
085600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    08560000
085700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  08570000
085800                                   TO TRUE                        08580000
085900         END-IF                                                   08590000
086000     END-IF.                                                      08600000
086100                                                                  08610000
086200*----------------------------------------------------------------*08620000
086300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *08630000
086400*  FOR ALL ITEMS.                                                *08640000
086500*----------------------------------------------------------------*08650000
086600 2150-SELECT-ALL-ITEMS.                                           08660000
086700                                                                  08670000
086800     MOVE +1                       TO ASC-BLK-SUB.                08680000
086900                                                                  08690000
087000     PERFORM 2151-SET-SELECTED-INDS                               08700000
087100         VARYING ASC-ITEM-SUB                                     08710000
087200         FROM 1 BY 1                                              08720000
087300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08730000
087400                                                                  08740000
087500     ADD +1                        TO ASC-BLK-SUB.                08750000
087600                                                                  08760000
087700     PERFORM 2151-SET-SELECTED-INDS                               08770000
087800         VARYING ASC-ITEM-SUB                                     08780000
087900         FROM 1 BY 1                                              08790000
088000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08800000
088100                                                                  08810000
088200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08820000
088300                                   TO PV-LIST-ITEM-NUMBER.        08830000
088400                                                                  08840000
088500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            08850000
088600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    08860000
088700                                                                  08870000
088800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     08880000
088900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    08890000
089000         MOVE +1                   TO ASC-BLK-SUB                 08900000
089100                                                                  08910000
089200         PERFORM 5100-WRITE-TEMP-STORAGE                          08920000
089300                                                                  08930000
089400         MOVE +1                   TO PV-BLOCK-NUMBER             08940000
089500                                                                  08950000
089600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         08960000
089700             PV-FIRST-BLOCK-IN-ARRAY - 1                          08970000
089800                                                                  08980000
089900         PERFORM                                                  08990000
090000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09000000
090100                                                                  09010000
090200             PERFORM 4410-READ-TEMP-STORAGE                       09020000
090300                                                                  09030000
090400             PERFORM 2151-SET-SELECTED-INDS                       09040000
090500                 VARYING ASC-ITEM-SUB                             09050000
090600                 FROM 1 BY 1                                      09060000
090700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09070000
090800                                                                  09080000
090900             PERFORM 5100-WRITE-TEMP-STORAGE                      09090000
091000                                                                  09100000
091100             ADD +1                TO PV-BLOCK-NUMBER             09110000
091200                                                                  09120000
091300         END-PERFORM                                              09130000
091400                                                                  09140000
091500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09150000
091600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09160000
091700                                                                  09170000
091800         PERFORM                                                  09180000
091900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09190000
092000                   ASC-HIGHEST-BLOCK-WRITTEN                      09200000
092100                                                                  09210000
092200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09220000
092300                                   TO PV-BLOCK-NUMBER             09230000
092400                                                                  09240000
092500             PERFORM 4410-READ-TEMP-STORAGE                       09250000
092600                                                                  09260000
092700             PERFORM 2151-SET-SELECTED-INDS                       09270000
092800                 VARYING ASC-ITEM-SUB                             09280000
092900                 FROM 1 BY 1                                      09290000
093000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09300000
093100                                                                  09310000
093200             PERFORM 5100-WRITE-TEMP-STORAGE                      09320000
093300                                                                  09330000
093400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09340000
093500                                                                  09350000
093600         END-PERFORM                                              09360000
093700                                                                  09370000
093800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09380000
093900                                   TO PV-BLOCK-NUMBER             09390000
094000                                                                  09400000
094100         PERFORM 4410-READ-TEMP-STORAGE                           09410000
094200     END-IF.                                                      09420000
094300                                                                  09430000
094400                                                                  09440000
094500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             09450000
094600                       ASC-NUMBER-OF-SELECTED-ITEMS.              09460000
094700                                                                  09470000
094800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09480000
094900                                                                  09490000
095000*----------------------------------------------------------------*09500000
095100*    MARK EACH ITEM AS BEING SELECTED.                           *09510000
095200*----------------------------------------------------------------*09520000
095300 2151-SET-SELECTED-INDS.                                          09530000
095400                                                                  09540000
095500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09550000
095600             NOT EQUAL ZERO                                       09560000
095700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09570000
095800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             09580000
095900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        09590000
096000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09600000
096100                               TO  TRUE                           09610000
096200         END-IF                                                   09620000
096300     END-IF.                                                      09630000
096400                                                                  09640000
096500******************************************************************09650000
096600** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **09660000
096700** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **09670000
096800******************************************************************09680000
096900 2200-MOVE-SCREEN-TO-COMMAREA.                                    09690000
097000                                                                  09700000
097100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             09710000
097200     MOVE +1                       TO PV-SUB.                     09720000
097300                                                                  09730000
097400     PERFORM 3100-SET-SUBSCRIPTS.                                 09740000
097500     IF  ASTRTITL > ZERO                                          09750000
097600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          09760000
097700     ELSE                                                         09770000
097800         IF  ASTRTITF = DP015-ERASE-EOF                           09780000
097900             INITIALIZE ASC-START-ITEM-REQUEST                    09790000
098000         END-IF                                                   09800000
098100     END-IF.                                                      09810000
098200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          09820000
098300         VARYING PV-SUB                                           09830000
098400         FROM 1 BY 1                                              09840000
098500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      09850000
098600                                                                  09860000
098700******************************************************************09870000
098800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**09880000
098900******************************************************************09890000
099000 2210-MOVE-LINES-TO-COMMAREA.                                     09900000
099100                                                                  09910000
099200     IF  MR-SELECTL (PV-SUB) > ZERO                               09920000
099300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             09930000
099400         MOVE MR-SELECTI (PV-SUB)                                 09940000
099500                                   TO ASC-TEMP-SELECTED-SW        09950000
099600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      09960000
099700     ELSE                                                         09970000
099800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                09980000
099900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     09990000
100000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10000000
100100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      10010000
100200         END-IF                                                   10020000
100300     END-IF.                                                      10030000
100400     ADD +1                        TO ASC-ITEM-SUB.               10040000
100500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10050000
100600         ADD +1                    TO ASC-BLK-SUB                 10060000
100700         MOVE +1                   TO ASC-ITEM-SUB                10070000
100800     END-IF.                                                      10080000
100900                                                                  10090000
101000******************************************************************10100000
101100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10110000
101200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10120000
101300******************************************************************10130000
101400 3000-EDIT-DATA-IN-COMMAREA.                                      10140000
101500                                                                  10150000
101600     SET PS-NO-ERROR               TO TRUE.                       10160000
101700     PERFORM 3200-RESET-ATTRIBUTES.                               10170000
101800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10180000
101900**                                                                10190000
102000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10200000
102100* EDITTING IS DONE FROM THE BOTTOM UP.                            10210000
102200**                                                                10220000
102300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10230000
102400         ASC-ITEMS-DISPLAYED - 1.                                 10240000
102500     PERFORM 3100-SET-SUBSCRIPTS.                                 10250000
102600     PERFORM 3300-EDIT-SELECTIONS                                 10260000
102700         VARYING PV-SUB                                           10270000
102800         FROM PV-SUB BY -1                                        10280000
102900         UNTIL PV-SUB < +1                                        10290000
103000                                                                  10300000
103100     IF  PS-NO-ERROR                                              10310000
103200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10320000
103300     END-IF.                                                      10330000
103400                                                                  10340000
103500     IF  ((PS-NO-ERROR)                                           10350000
103600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   10360000
103700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    10370000
103800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  10380000
103900     END-IF.                                                      10390000
104000                                                                  10400000
104100*----------------------------------------------------------------*10410000
104200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *10420000
104300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*10430000
104400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *10440000
104500*                                                                *10450000
104600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *10460000
104700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *10470000
104800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *10480000
104900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *10490000
105000*----------------------------------------------------------------*10500000
105100 3100-SET-SUBSCRIPTS.                                             10510000
105200                                                                  10520000
105300     COMPUTE ASC-ITEM-SUB =                                       10530000
105400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        10540000
105500                                                                  10550000
105600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         10560000
105700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            10570000
105800                                                                  10580000
105900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               10590000
106000     ELSE                                                         10600000
106100         MOVE +1                     TO ASC-BLK-SUB               10610000
106200     END-IF.                                                      10620000
106300                                                                  10630000
106400******************************************************************10640000
106500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **10650000
106600******************************************************************10660000
106700 3200-RESET-ATTRIBUTES.                                           10670000
106800                                                                  10680000
106900     MOVE DP015-UNP-ALP-NOR-OFF TO ASTRTITA.                      10690000
107000     MOVE DP015-GREEN           TO ASTRTITC.                      10700000
107100     MOVE DP015-UNDERLINE       TO ASTRTITH.                      10710000
107200                                                                  10720000
107300     IF DP020-NEXT-ACT-RETURN OR                                  10730000
107400        DP020-NEXT-ACT-READ-MAP                                   10740000
107500         PERFORM VARYING PV-SUB  FROM 1 BY 1                      10750000
107600                 UNTIL   PV-SUB > ASC-ITEMS-DISPLAYED             10760000
107700                  MOVE DP015-UNP-ALP-NOR-OFF                      10770000
107800                                       TO MR-SELECTA (PV-SUB)     10780000
107900                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     10790000
108000                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     10800000
108100         END-PERFORM                                              10810000
108200     ELSE                                                         10820000
108300         PERFORM VARYING PV-SUB  FROM 1 BY 1                      10830000
108400                 UNTIL   PV-SUB > PC-ITEMS-PER-PANEL              10840000
108500                  MOVE DP015-UNP-ALP-NOR-OFF                      10850000
108600                                       TO MR-SELECTA (PV-SUB)     10860000
108700                  MOVE DP015-GREEN     TO MR-SELECTC (PV-SUB)     10870000
108800                  MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)     10880000
108900         END-PERFORM.                                             10890000
109000                                                                  10900000
109100******************************************************************10910000
109200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **10920000
109300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **10930000
109400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **10940000
109500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **10950000
109600******************************************************************10960000
109700 3300-EDIT-SELECTIONS.                                            10970000
109800                                                                  10980000
109900     EVALUATE TRUE                                                10990000
110000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11000000
110100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         11010000
110200                 CONTINUE                                         11020000
110300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         11030000
110400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        11040000
110500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   11050000
110600                 MOVE ASC-TEMP-SELECTED-SW                        11060000
110700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11070000
110800                                TO ASC-SELECTED-SW                11080000
110900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11090000
111000             END-IF                                               11100000
111100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     11110000
111200                 = SPACE                                          11120000
111300             EVALUATE TRUE                                        11130000
111400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       11140000
111500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS11150000
111600                     MOVE SPACE TO ASC-SELECTED-SW                11160000
111700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11170000
111800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        11180000
111900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    11190000
112000                     MOVE SPACE TO ASC-SELECTED-SW                11200000
112100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11210000
112200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          11220000
112300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      11230000
112400                     MOVE SPACE TO ASC-SELECTED-SW                11240000
112500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11250000
112600             END-EVALUATE                                         11260000
112700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           11270000
112800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11280000
112900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11290000
113000             END-IF                                               11300000
113100             PERFORM 3310-EDIT-RANGE                              11310000
113200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             11320000
113300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11330000
113400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    11340000
113500             END-IF                                               11350000
113600             PERFORM 3310-EDIT-RANGE                              11360000
113700         WHEN OTHER                                               11370000
113800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           11380000
113900             SET DP020-MSG-FATAL    TO TRUE                       11390000
114000             MOVE -1                TO MR-SELECTL (PV-SUB)        11400000
114100             SET DP030-SET-CURSOR-APPL-1                          11410000
114200                                    TO TRUE                       11420000
114300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        11430000
114400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        11440000
114500             SET PS-ERROR TO TRUE                                 11450000
114600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            11460000
114700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     11470000
114800                 MOVE SPACE         TO ASC-SELECTED-SW            11480000
114900                                        (ASC-BLK-SUB ASC-ITEM-SUB)11490000
115000             END-IF                                               11500000
115100     END-EVALUATE.                                                11510000
115200                                                                  11520000
115300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 11530000
115400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               11540000
115500     IF  ASC-ITEM-SUB < 1                                         11550000
115600         SUBTRACT +1 FROM ASC-BLK-SUB                             11560000
115700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                11570000
115800     END-IF.                                                      11580000
115900                                                                  11590000
116000******************************************************************11600000
116100** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **11610000
116200** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **11620000
116300** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**11630000
116400** THE ENDING.                                                  **11640000
116500******************************************************************11650000
116600 3310-EDIT-RANGE.                                                 11660000
116700                                                                  11670000
116800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                11680000
116900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   11690000
117000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)11700000
117100                                   TO ASC-SELECTED-SW             11710000
117200                                        (ASC-BLK-SUB ASC-ITEM-SUB)11720000
117300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 11730000
117400         ELSE                                                     11740000
117500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     11750000
117600                 CONTINUE                                         11760000
117700             ELSE                                                 11770000
117800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        11780000
117900                 MOVE PC-TSYMSG-00054                             11790000
118000                                   TO DP020-MSG-NUMBER            11800000
118100                 SET DP020-MSG-FATAL                              11810000
118200                                   TO TRUE                        11820000
118300                 MOVE -1           TO MR-SELECTL (PV-SUB)         11830000
118400                 SET DP030-SET-CURSOR-APPL-1                      11840000
118500                                   TO TRUE                        11850000
118600                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         11860000
118700                 MOVE DP015-UNDERLINE                             11870000
118800                                   TO MR-SELECTH (PV-SUB)         11880000
118900                 SET PS-ERROR      TO TRUE                        11890000
119000             END-IF                                               11900000
119100         END-IF                                                   11910000
119200     ELSE                                                         11920000
119300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     11930000
119400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 11940000
119500                                   TO ASC-SELECTED-SW             11950000
119600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11960000
119700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   11970000
119800         ELSE                                                     11980000
119900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       11990000
120000                 CONTINUE                                         12000000
120100             ELSE                                                 12010000
120200*                -- ONLY ONE END-OF-RANGE ALLOWED --              12020000
120300                 MOVE PC-TSYMSG-00055                             12030000
120400                                   TO DP020-MSG-NUMBER            12040000
120500                 SET DP020-MSG-FATAL                              12050000
120600                                   TO TRUE                        12060000
120700                 MOVE -1           TO MR-SELECTL (PV-SUB)         12070000
120800                 SET DP030-SET-CURSOR-APPL-1                      12080000
120900                                   TO TRUE                        12090000
121000                 SET PS-ERROR      TO TRUE                        12100000
121100             END-IF                                               12110000
121200         END-IF                                                   12120000
121300     END-IF.                                                      12130000
121400                                                                  12140000
121500******************************************************************12150000
121600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **12160000
121700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **12170000
121800******************************************************************12180000
121900 3400-CHECK-RANGE-SEQUENCE.                                       12190000
122000                                                                  12200000
122100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       12210000
122200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      12220000
122300       AND  ASC-START-OF-SELECTED-RANGE >                         12230000
122400                                         ASC-END-OF-SELECTED-RANGE12240000
122500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                12250000
122600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 12260000
122700         SET DP020-MSG-FATAL TO TRUE                              12270000
122800         SET PS-ERROR TO TRUE                                     12280000
122900         PERFORM 3410-POSITION-AT-ERROR                           12290000
123000     END-IF.                                                      12300000
123100                                                                  12310000
123200******************************************************************12320000
123300** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **12330000
123400** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **12340000
123500** SHOULD BE POSITIONED ON A RANGE ERROR.                       **12350000
123600******************************************************************12360000
123700 3410-POSITION-AT-ERROR.                                          12370000
123800                                                                  12380000
123900     SET DP030-SET-CURSOR-APPL-1                                  12390000
124000                                   TO TRUE.                       12400000
124100     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 12410000
124200                    - PV-TOP-ITEM + 1.                            12420000
124300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12430000
124400         CONTINUE                                                 12440000
124500     ELSE                                                         12450000
124600         MOVE -1                   TO MR-SELECTL (PV-SUB)         12460000
124700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12470000
124800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12480000
124900     END-IF.                                                      12490000
125000                                                                  12500000
125100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   12510000
125200                    - PV-TOP-ITEM + 1.                            12520000
125300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      12530000
125400         CONTINUE                                                 12540000
125500     ELSE                                                         12550000
125600         MOVE -1                   TO MR-SELECTL (PV-SUB)         12560000
125700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         12570000
125800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         12580000
125900     END-IF.                                                      12590000
126000                                                                  12600000
126100*----------------------------------------------------------------*12610000
126200*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *12620000
126300*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *12630000
126400*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *12640000
126500*----------------------------------------------------------------*12650000
126600 3500-MARK-RANGE-AS-SELECTED.                                     12660000
126700                                                                  12670000
126800     MOVE +1                       TO  ASC-BLK-SUB.               12680000
126900     PERFORM 3510-MARK-SELECTED-INDS                              12690000
127000         VARYING ASC-ITEM-SUB                                     12700000
127100         FROM 1 BY 1                                              12710000
127200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12720000
127300                                                                  12730000
127400     ADD +1                        TO ASC-BLK-SUB.                12740000
127500     PERFORM 3510-MARK-SELECTED-INDS                              12750000
127600         VARYING ASC-ITEM-SUB                                     12760000
127700         FROM 1 BY 1                                              12770000
127800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12780000
127900                                                                  12790000
128000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12800000
128100                                   TO  PV-LIST-ITEM-NUMBER.       12810000
128200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12820000
128300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         12830000
128400               PC-ITEMS-PER-PANEL).                               12840000
128500                                                                  12850000
128600     MOVE ASC-START-OF-SELECTED-RANGE                             12860000
128700                                   TO PV-START-OF-SELECTED-RANGE. 12870000
128800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            12880000
128900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  12890000
129000               PC-ITEMS-PER-PANEL).                               12900000
129100                                                                  12910000
129200     MOVE ASC-END-OF-SELECTED-RANGE                               12920000
129300                                   TO  PV-END-OF-SELECTED-RANGE.  12930000
129400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             12940000
129500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    12950000
129600               PC-ITEMS-PER-PANEL).                               12960000
129700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             12970000
129800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             12980000
129900                                                                  12990000
130000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    13000000
130100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        13010000
130200         MOVE +1                   TO ASC-BLK-SUB                 13020000
130300         PERFORM 5100-WRITE-TEMP-STORAGE                          13030000
130400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13040000
130500             PV-FIRST-BLOCK-IN-ARRAY - 1                          13050000
130600                                                                  13060000
130700         PERFORM                                                  13070000
130800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      13080000
130900                   PV-PREV-BLOCK-IN-ARRAY                         13090000
131000             MOVE PV-FIRST-BLOCK-IN-RANGE                         13100000
131100                                   TO PV-BLOCK-NUMBER             13110000
131200             PERFORM 4410-READ-TEMP-STORAGE                       13120000
131300             PERFORM 3510-MARK-SELECTED-INDS                      13130000
131400                 VARYING ASC-ITEM-SUB                             13140000
131500                 FROM 1 BY 1                                      13150000
131600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13160000
131700             PERFORM 5100-WRITE-TEMP-STORAGE                      13170000
131800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     13180000
131900         END-PERFORM                                              13190000
132000                                                                  13200000
132100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13210000
132200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13220000
132300         PERFORM                                                  13230000
132400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13240000
132500                   PV-LAST-BLOCK-IN-RANGE                         13250000
132600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13260000
132700                                   TO PV-BLOCK-NUMBER             13270000
132800             PERFORM 4410-READ-TEMP-STORAGE                       13280000
132900             PERFORM 3510-MARK-SELECTED-INDS                      13290000
133000                 VARYING ASC-ITEM-SUB                             13300000
133100                 FROM 1 BY 1                                      13310000
133200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13320000
133300             PERFORM 5100-WRITE-TEMP-STORAGE                      13330000
133400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13340000
133500         END-PERFORM                                              13350000
133600                                                                  13360000
133700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13370000
133800                                   TO PV-BLOCK-NUMBER             13380000
133900         PERFORM 4410-READ-TEMP-STORAGE                           13390000
134000     END-IF.                                                      13400000
134100                                                                  13410000
134200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 13420000
134300                                      ASC-END-OF-SELECTED-RANGE.  13430000
134400                                                                  13440000
134500*----------------------------------------------------------------*13450000
134600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *13460000
134700*----------------------------------------------------------------*13470000
134800 3510-MARK-SELECTED-INDS.                                         13480000
134900                                                                  13490000
135000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13500000
135100                                ASC-ITEM-SUB) >                   13510000
135200         ASC-START-OF-SELECTED-RANGE)                             13520000
135300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         13530000
135400                                ASC-ITEM-SUB) =                   13540000
135500         ASC-START-OF-SELECTED-RANGE)                             13550000
135600                                                                  13560000
135700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13570000
135800                                    ASC-ITEM-SUB) <               13580000
135900             ASC-END-OF-SELECTED-RANGE)                           13590000
136000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     13600000
136100                                    ASC-ITEM-SUB) =               13610000
136200             ASC-END-OF-SELECTED-RANGE)                           13620000
136300                                                                  13630000
136400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          13640000
136500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   13650000
136600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   13660000
136700                               TO TRUE                            13670000
136800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              13680000
136900                               TO TRUE                            13690000
137000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    13700000
137100             END-IF                                               13710000
137200         END-IF                                                   13720000
137300     END-IF.                                                      13730000
137400                                                                  13740000
137500*----------------------------------------------------------------*13750000
137600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *13760000
137700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *13770000
137800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13780000
137900*    DISPLAY THE PANEL TO USER.                                  *13790000
138000*----------------------------------------------------------------*13800000
138100 4000-BUILD-INITIAL-PANEL.                                        13810000
138200                                                                  13820000
138300     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13830000
138400                                 ASC-BLOCK-ENTRIES (2).           13840000
138500     MOVE +1                 TO ASC-BLK-SUB.                      13850000
138600     SET ASC-ITEMS-LEFT-ON-DB                                     13860000
138700                             TO TRUE.                             13870000
138800                                                                  13880000
138900     MOVE +0                 TO ASC-ITEM-SUB                      13890000
139000                                ASC-NUMBER-OF-ITEMS-READ          13900000
139100                                ASC-NUMBER-OF-SELECTED-ITEMS      13910000
139200                                ASC-HIGHEST-BLOCK-WRITTEN         13920000
139300                                ASC-START-OF-SELECTED-RANGE       13930000
139400                                ASC-END-OF-SELECTED-RANGE         13940000
139500                                ASC-ITEM-AT-TOP-OF-PANEL.         13950000
139600                                                                  13960000
139601* IF SOMEONE TRIES TO RETURN A LIST OF EXPENSE VENDORS WITHOUT    13960103
139602* ENTERING SOMETHING FOR A NAME, THE TEMP STORAGE QUEUE GETS      13960203
139603* BLOWN OUT BECAUSE OF THE NUMBER OF VENDORS RETURNED. THIS       13960303
139604* LOGIC WILL PREVENT THIS FROM HAPPENING.                         13960403
139605                                                                  13960503
139610     IF ASC-KEY-VEND-TYPE = 'E' AND                               13961002
139620        (ASC-KEY-VEND-NAME = ' ' OR '*')                          13962002
139630         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    13963002
139631         SET DP020-MSG-FATAL   TO  TRUE                           13963102
139632         MOVE PC-TSYMSG-02336  TO  DP020-MSG-NUMBER               13963203
139633     ELSE                                                         13963302
139640                                                                  13964002
139700         PERFORM 4050-PREPARE-CURSOR-KEY                          13970002
139800                                                                  13980002
139900         PERFORM 4100-OPEN-CURSOR                                 13990002
140000                                                                  14000002
140100         PERFORM 4200-READ-ITEMS-FROM-DB                          14010002
140200                                                                  14020002
140300         PERFORM 4300-CLOSE-CURSOR                                14030002
140400                                                                  14040002
140500         MOVE +1                   TO  PV-TOP-ITEM                14050002
140600         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      14060002
140700             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                14070002
140800             SET DP020-MSG-FATAL   TO  TRUE                       14080002
140900             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           14090002
141000         ELSE                                                     14100002
141100             MOVE -1               TO MR-SELECTL (1)              14110002
141200             SET DP030-SET-CURSOR-APPL-1                          14120002
141300                                   TO TRUE                        14130002
141400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14140002
141500         END-IF                                                   14150002
141510     END-IF.                                                      14151002
141600                                                                  14160000
141700*----------------------------------------------------------------*14170000
141800* PREPARE THE DB KEY BY REPLACING * WITH %                       *14180000
141900*----------------------------------------------------------------*14190000
142000 4050-PREPARE-CURSOR-KEY.                                         14200000
142100                                                                  14210000
142210     MOVE ASC-KEY-VEND-NAME    TO DK-VEND-NAME.                   14221002
142300     MOVE ASC-KEY-STATUS-CODE  TO DK-STATUS-CODE.                 14230000
142400     IF DK-VEND-NAME > SPACES                                     14240000
142500         IF DK-VEND-NAME-BYTE (1) = '*'                           14250000
142600             MOVE PC-PERCENT   TO DK-VEND-NAME-BYTE (1)           14260000
142700             INSPECT DK-VEND-NAME                                 14270000
142800                 REPLACING FIRST '*' BY PC-PERCENT                14280000
142900         END-IF                                                   14290000
143000         SET PS-NOT-DONE TO TRUE                                  14300000
143100         PERFORM VARYING PV-SUB                                   14310000
143200             FROM LENGTH OF DK-VEND-NAME BY -1                    14320000
143300             UNTIL PV-SUB = 1                                     14330000
143400                OR PS-DONE                                        14340000
143500                 IF DK-VEND-NAME-BYTE (PV-SUB) = '*'              14350000
143600                     MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)14360000
143700                     SET PS-DONE TO TRUE                          14370000
143800                 END-IF                                           14380000
143900                 IF DK-VEND-NAME-BYTE (PV-SUB) > SPACES           14390000
144000                     SET PS-DONE TO TRUE                          14400000
144100                 ELSE                                             14410000
144200                     MOVE PC-PERCENT TO DK-VEND-NAME-BYTE (PV-SUB)14420000
144300                 END-IF                                           14430000
144400         END-PERFORM                                              14440000
144500     ELSE                                                         14450000
144600         MOVE ALL '%' TO DK-VEND-NAME.                            14460000
144700                                                                  14470000
144800*----------------------------------------------------------------*14480000
144900* OPEN  THE VENDOR   CURSOR.                                     *14490000
145000*----------------------------------------------------------------*14500000
145100 4100-OPEN-CURSOR.                                                14510000
145200                                                                  14520000
145300     PERFORM                                                      14530000
145400         WITH TEST AFTER                                          14540000
145500         VARYING PV-RETRY-COUNTER                                 14550000
145600         FROM 1 BY 1                                              14560000
145700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14570000
145800                   OR (SQLCODE = ZERO))                           14580000
145900             MOVE 'CURSOR:  VENDOR-CSR'                           14590000
146000                               TO DP013-MESSAGE-TEXT (2)          14600000
146100             EXEC SQL                                             14610000
146200                  OPEN VENDOR-CSR                                 14620000
146300             END-EXEC                                             14630000
146400                                                                  14640000
146500         EVALUATE TRUE                                            14650000
146600             WHEN SQLCODE = ZERO                                  14660000
146700             WHEN SQLCODE = -904                                  14670000
146800             WHEN SQLCODE = -913                                  14680000
146900                 CONTINUE                                         14690000
147000             WHEN SQLWARN0 NOT = SPACES                           14700000
147100             WHEN SQLCODE < ZERO                                  14710000
147200             WHEN SQLCODE > ZERO                                  14720000
147300                 MOVE '4100-OPEN-CURSOR'                          14730000
147400                                   TO DP013-PARAGRAPH             14740000
147500                 MOVE 'OPEN VENDOR CURSOR - '                     14750000
147600                                   TO DP013-MESSAGE-TEXT (1)      14760000
147700                 MOVE SQLCA        TO DP013-SQLCA                 14770000
147800                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    14780000
147900                 SET DP013-DB2-ABEND                              14790000
148000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14800000
148100                 PERFORM DP013-0000-PROCESS-ABEND                 14810000
148200         END-EVALUATE                                             14820000
148300     END-PERFORM.                                                 14830000
148400                                                                  14840000
148500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14850000
148600         MOVE '4100-OPEN-CURSOR'   TO DP013-PARAGRAPH             14860000
148700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   14870000
148800                                   TO DP013-MESSAGE-TEXT (1)      14880000
148900         MOVE SQLCA                TO DP013-SQLCA                 14890000
149000         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    14900000
149100         SET DP013-DB2-ABEND                                      14910000
149200             DP013-XCTL-DISPLAY-RESTART                           14920000
149300                                   TO TRUE                        14930000
149400         PERFORM DP013-0000-PROCESS-ABEND                         14940000
149500     END-IF.                                                      14950000
149600                                                                  14960000
149700*----------------------------------------------------------------*14970000
149800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *14980000
149900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *14990000
150000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15000000
150100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15010000
150200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15020000
150300*----------------------------------------------------------------*15030000
150400 4200-READ-ITEMS-FROM-DB.                                         15040000
150500                                                                  15050000
150600     PERFORM VARYING PV-READ-COUNT  FROM 1 BY 1                   15060000
150700             UNTIL   PV-READ-COUNT > PC-MAX-ITEMS OR              15070000
150800                     ASC-NO-ITEMS-LEFT-ON-DB                      15080000
150900                                                                  15090000
151000             PERFORM 4210-FETCH                                   15100000
151100                                                                  15110000
151200             IF ASC-ITEMS-LEFT-ON-DB                              15120000
151300                IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL              15130000
151400                    CONTINUE                                      15140000
151500                ELSE                                              15150000
151600                    ADD  +1 TO ASC-BLK-SUB                        15160000
151700                    MOVE +0 TO ASC-ITEM-SUB                       15170000
151800                    IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY       15180000
151900                        MOVE +1 TO ASC-BLK-SUB                    15190000
152000                        SET ASC-BLOCK-MODIFIED (1) TO TRUE        15200000
152100                                                                  15210000
152200                        PERFORM 5100-WRITE-TEMP-STORAGE           15220000
152300                                                                  15230000
152400                        MOVE ASC-BLOCK-ENTRIES                    15240000
152500                                          (PC-MAX-BLOCKS-IN-ARRAY)15250000
152600                                TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)15260000
152700                        ADD +1 TO ASC-BLK-SUB                     15270000
152800                        INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)15280000
152900                        SET ASC-BLOCK-NOT-MODIFIED   (ASC-BLK-SUB)15290000
153000                                                           TO TRUE15300000
153100                    END-IF                                        15310000
153200                END-IF                                            15320000
153300                PERFORM 4220-CHECK-VEND-TYPE THRU 4220-EXIT       15330000
153400             END-IF                                               15340000
153500     END-PERFORM.                                                 15350000
153600                                                                  15360000
153700     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           15370000
153800         MOVE +1 TO ASC-BLK-SUB                                   15380000
153900                                                                  15390000
154000         PERFORM 5100-WRITE-TEMP-STORAGE                          15400000
154100                                                                  15410000
154200         ADD  +1 TO ASC-BLK-SUB                                   15420000
154300                                                                  15430000
154400         PERFORM 5100-WRITE-TEMP-STORAGE                          15440000
154500                                                                  15450000
154600         MOVE 1  TO ASC-BLK-SUB                                   15460000
154700                    PV-BLOCK-NUMBER                               15470000
154800                                                                  15480000
154900         PERFORM 4410-READ-TEMP-STORAGE                           15490000
155000                                                                  15500000
155100         IF ASC-HIGHEST-BLOCK-WRITTEN > 1                         15510000
155200             MOVE 2 TO ASC-BLK-SUB                                15520000
155300                       PV-BLOCK-NUMBER                            15530000
155400                                                                  15540000
155500             PERFORM 4410-READ-TEMP-STORAGE                       15550000
155600         END-IF                                                   15560000
155700     END-IF.                                                      15570000
155800                                                                  15580000
155900 4210-FETCH.                                                      15590000
156000                                                                  15600000
157000                                                                  15700000
157010     EXEC SQL                                                     15701005
157020          FETCH VENDOR-CSR                                        15702005
157030          INTO  :ENTNME-ENT-ID                                    15703005
157040               ,:ENTNME-ENT-NAME-DESC                             15704005
157050               ,:ENTNME-TYPE-CDE                                  15705005
157060               ,:EXTENT-PRIM-TYP-CDE                              15706005
157070               ,:EXTENT-PRTNR-TYP-CDE                             15707005
157091               ,:EXTENT-PRNT-CO-IND                               15709105
157092     END-EXEC                                                     15709205
157093                                                                  15709305
157100     EVALUATE TRUE                                                15710000
157200         WHEN SQLCODE = ZERO                                      15720000
157300         WHEN SQLCODE = +100                                      15730000
157400              CONTINUE                                            15740000
157500         WHEN SQLWARN0 NOT = SPACE                                15750000
157600         WHEN SQLCODE NOT = ZERO                                  15760000
157700              MOVE '4210-FETCH-CURSOR'                            15770005
157800                               TO DP013-PARAGRAPH                 15780000
157900              MOVE 'FETCH VENDOR CURSOR'                          15790000
158000                               TO DP013-MESSAGE-TEXT (1)          15800000
158100              MOVE SQLCA       TO DP013-SQLCA                     15810000
158200              SET DP013-DB2-ABEND                                 15820000
158300                               TO TRUE                            15830000
158400              PERFORM DP013-0000-PROCESS-ABEND                    15840000
158500     END-EVALUATE.                                                15850000
158600                                                                  15860000
158700     IF  SQLCODE EQUAL +100                                       15870000
158800         SET ASC-NO-ITEMS-LEFT-ON-DB                              15880000
158900                                   TO TRUE                        15890000
159000     END-IF.                                                      15900000
159100                                                                  15910000
159110     EJECT                                                        15911007
159120                                                                  15912007
159200 4220-CHECK-VEND-TYPE.                                            15920000
159300                                                                  15930000
162110     IF ASC-KEY-VEND-TYPE NOT = 'M' AND 'E' AND 'C' AND           16211005
162120                                'F' AND 'P'                       16212005
162130         CONTINUE                                                 16213005
162140     ELSE                                                         16214005
162150         IF ASC-KEY-VEND-TYPE = 'M'                               16215005
162160             IF EXTENT-PRIM-TYP-CDE    = 'M'                      16216005
162170                 CONTINUE                                         16217005
162180             ELSE                                                 16218005
162190                 GO TO 4220-EXIT                                  16219005
162191             END-IF                                               16219105
162192         ELSE                                                     16219205
162193             IF ASC-KEY-VEND-TYPE = 'E'                           16219305
162194                 IF EXTENT-PRIM-TYP-CDE = 'E'                     16219405
162195                     CONTINUE                                     16219505
162196                 ELSE                                             16219605
162197                     GO TO 4220-EXIT                              16219705
162198                 END-IF                                           16219805
162199             ELSE                                                 16219905
162200                 IF ASC-KEY-VEND-TYPE = 'C'                       16220005
162201                     IF EXTENT-PRTNR-TYP-CDE = 'CR'               16220106
162202                         CONTINUE                                 16220205
162203                     ELSE                                         16220305
162204                         GO TO 4220-EXIT                          16220405
162205                     END-IF                                       16220505
162206                 ELSE                                             16220605
162207                     IF ASC-KEY-VEND-TYPE = 'F'                   16220705
162208                         IF EXTENT-PRIM-TYP-CDE = 'F'             16220805
162209                             CONTINUE                             16220905
162210                         ELSE                                     16221005
162211                             GO TO 4220-EXIT                      16221105
162212                         END-IF                                   16221205
162213                     ELSE                                         16221305
162214                         IF ASC-KEY-VEND-TYPE = 'P'               16221405
162215                             IF EXTENT-PRNT-CO-IND = 'Y'          16221505
162216                                 CONTINUE                         16221605
162217                             ELSE                                 16221705
162218                                 GO TO 4220-EXIT                  16221805
162219                             END-IF                               16221905
162220                         END-IF                                   16222005
162221                     END-IF                                       16222105
162222                 END-IF                                           16222205
162223             END-IF                                               16222305
162224         END-IF                                                   16222405
162225     END-IF.                                                      16222505
162226                                                                  16222605
162227     EJECT                                                        16222705
162228                                                                  16222805
162230     ADD +1 TO ASC-ITEM-SUB                                       16223000
162300               ASC-NUMBER-OF-ITEMS-READ.                          16230000
162400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER        16240000
162500                                       (ASC-BLK-SUB ASC-ITEM-SUB).16250000
162600     MOVE ASC-KEY-VEND-TYPE    TO ASC-VEND-TYPE                   16260000
162700                                       (ASC-BLK-SUB ASC-ITEM-SUB).16270000
162800     MOVE ENTNME-ENT-NAME-DESC TO ASC-VEND-NAME                   16280000
162900                                       (ASC-BLK-SUB ASC-ITEM-SUB).16290000
163000     MOVE ENTNME-TYPE-CDE      TO ASC-TYPE-CDE                    16300000
163100                                       (ASC-BLK-SUB ASC-ITEM-SUB).16310000
163200     MOVE ENTNME-ENT-ID        TO ASC-ENT-ID                      16320000
163300                                       (ASC-BLK-SUB ASC-ITEM-SUB).16330000
163400     PERFORM 4222-GET-PRIM-NAME.                                  16340000
163500                                                                  16350000
163600     MOVE DK-PRIM-NAME         TO ASC-PRM-NME                     16360000
163700                                       (ASC-BLK-SUB ASC-ITEM-SUB).16370000
163800 4220-EXIT.                                                       16380000
163900     EXIT.                                                        16390000
164000                                                                  16400000
164100*----------------------------------------------------------------*16410000
164200* GET THE PRIMARY NAME OF THE VENDOR                             *16420000
164300*----------------------------------------------------------------*16430000
164400 4222-GET-PRIM-NAME.                                              16440000
164500                                                                  16450000
164600     EXEC SQL                                                     16460000
164700          SELECT ENT_NAME_DESC                                    16470000
164800            INTO :DK-PRIM-NAME                                    16480000
164900            FROM TENTNME                                          16490000
165000           WHERE ENT_ID = :ENTNME-ENT-ID                          16500000
165100             AND TYPE_CDE = '01'                                  16510000
165200     END-EXEC                                                     16520000
165300                                                                  16530000
165400     EVALUATE TRUE                                                16540000
165500         WHEN SQLCODE = ZERO                                      16550000
165600              CONTINUE                                            16560000
165700                                                                  16570000
165800         WHEN SQLCODE = +100                                      16580000
165900              MOVE SPACES TO DK-PRIM-NAME                         16590000
166000                                                                  16600000
166100         WHEN SQLWARN0 NOT = SPACES                               16610000
166200         WHEN SQLCODE < ZERO                                      16620000
166300         WHEN SQLCODE > ZERO                                      16630000
166400             MOVE '4222-GET-PRIM-NAME'                            16640000
166500                               TO DP013-PARAGRAPH                 16650000
166600             MOVE 'SELECT TENTNME'                                16660000
166700                               TO DP013-MESSAGE-TEXT (1)          16670000
166800             MOVE SQLCA        TO DP013-SQLCA                     16680000
166900             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (1)        16690000
167000             SET DP013-DB2-ABEND                                  16700000
167100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16710000
167200             PERFORM DP013-0000-PROCESS-ABEND                     16720000
167300     END-EVALUATE.                                                16730000
167400                                                                  16740000
167500*----------------------------------------------------------------*16750000
167600* CLOSE THE VENDOR   CURSOR.                                     *16760000
167700*----------------------------------------------------------------*16770000
167800 4300-CLOSE-CURSOR.                                               16780000
167900                                                                  16790000
168000     EXEC SQL                                                     16800000
168100         CLOSE VENDOR-CSR                                         16810000
168200     END-EXEC                                                     16820000
168300                                                                  16830000
168400     EVALUATE TRUE                                                16840000
168500         WHEN SQLCODE = ZERO                                      16850000
168600             CONTINUE                                             16860000
168700         WHEN SQLWARN0 NOT = SPACES                               16870000
168800         WHEN SQLCODE < ZERO                                      16880000
168900         WHEN SQLCODE > ZERO                                      16890000
169000             MOVE '4300-CLOSE-CURSOR'                             16900000
169100                               TO DP013-PARAGRAPH                 16910000
169200             MOVE 'CLOSE VENDOR CURSOR '                          16920000
169300                               TO DP013-MESSAGE-TEXT (1)          16930000
169400             MOVE SQLCA        TO DP013-SQLCA                     16940000
169500             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        16950000
169600             SET DP013-DB2-ABEND                                  16960000
169700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16970000
169800             PERFORM DP013-0000-PROCESS-ABEND                     16980000
169900     END-EVALUATE.                                                16990000
170000                                                                  17000000
170100*----------------------------------------------------------------*17010000
170200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17020000
170300*----------------------------------------------------------------*17030000
170400 4400-MOVE-COMMAREA-TO-SCREEN.                                    17040000
170500                                                                  17050000
170600     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             17060000
170700         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          17070000
170800         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          17080000
170900             MOVE +1    TO ASC-BLK-SUB                            17090000
171000             PERFORM 5100-WRITE-TEMP-STORAGE                      17100000
171100             ADD +1     TO ASC-BLK-SUB                            17110000
171200             PERFORM 5100-WRITE-TEMP-STORAGE                      17120000
171300             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             17130000
171400                 GIVING PV-BLOCK-NUMBER                           17140000
171500                 REMAINDER PV-REMAINDER                           17150000
171600             IF  PV-REMAINDER > ZERO                              17160000
171700                 ADD +1 TO PV-BLOCK-NUMBER                        17170000
171800             END-IF                                               17180000
171900             MOVE +1    TO ASC-BLK-SUB                            17190000
172000             PERFORM 4410-READ-TEMP-STORAGE                       17200000
172100             ADD +1     TO ASC-BLK-SUB                            17210000
172200                           PV-BLOCK-NUMBER                        17220000
172300             PERFORM 4410-READ-TEMP-STORAGE                       17230000
172400     END-IF.                                                      17240000
172500     MOVE +1            TO ASC-BLK-SUB.                           17250000
172600     COMPUTE ASC-ITEM-SUB =                                       17260000
172700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              17270000
172800         + PC-ITEMS-PER-PANEL).                                   17280000
172900                                                                  17290000
173000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        17300000
173100         ADD +1         TO ASC-BLK-SUB                            17310000
173200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17320000
173300     END-IF.                                                      17330000
173400                                                                  17340000
173500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           17350000
173600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                17360000
173700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        17370000
173800     PERFORM 4420-FORMAT-LIST-LINES                               17380000
173900         VARYING PV-SUB                                           17390000
174000         FROM PC-ITEMS-PER-PANEL BY -1                            17400000
174100         UNTIL PV-SUB < +1.                                       17410000
174200                                                                  17420000
174300     COMPUTE ASC-ITEMS-DISPLAYED =                                17430000
174400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          17440000
174500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    17450000
174600                                      ASTRTITO.                   17460000
174700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    17470000
174800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    17480000
174900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17490000
175000                                   TO ASELITO.                    17500000
175100                                                                  17510000
175200     IF  DP020-MSG-NUMBER-X = SPACE                               17520000
175300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  17530000
175400*            --- MORE ITEMS TO DISPLAY ----                       17540000
175500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17550000
175600             SET DP020-MSG-INFORMATIONAL TO TRUE                  17560000
175700         END-IF                                                   17570000
175800     END-IF.                                                      17580000
175900                                                                  17590000
176000*----------------------------------------------------------------*17600000
176100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17610000
176200*----------------------------------------------------------------*17620000
176300 4410-READ-TEMP-STORAGE.                                          17630000
176400                                                                  17640000
176500     EXEC CICS                                                    17650000
176600         READQ TS                                                 17660000
176700             QUEUE (ASC-LIST-QUEUE-NAME)                          17670000
176800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17680000
176900             ITEM  (PV-BLOCK-NUMBER)                              17690000
177000             RESP  (PV-CICS-RESP)                                 17700000
177100     END-EXEC.                                                    17710000
177200                                                                  17720000
177300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17730000
177400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17740000
177500         CONTINUE                                                 17750000
177600     ELSE                                                         17760000
177700         SET DP013-CICS-ABEND     TO TRUE                         17770000
177800         SET DP013-NO-ROLLBACK    TO TRUE                         17780000
177900         MOVE '4410-READ-TEMP-STORAGE'                            17790000
178000                                  TO DP013-PARAGRAPH              17800000
178100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17810000
178200                                  TO DP013-MESSAGE-TEXT(1)        17820000
178300         PERFORM DP013-0000-PROCESS-ABEND                         17830000
178400     END-IF.                                                      17840000
178500                                                                  17850000
178600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17860000
178700                                                                  17870000
178800     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         17880000
178900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17890000
179000     END-IF.                                                      17900000
179100                                                                  17910000
179200*----------------------------------------------------------------*17920000
179300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17930000
179400*----------------------------------------------------------------*17940000
179500 4420-FORMAT-LIST-LINES.                                          17950000
179600                                                                  17960000
179700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       17970000
179800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17980000
179900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA   (PV-SUB)         17990000
180000         MOVE SPACES             TO MR-SELECTI   (PV-SUB)         18000000
180100                                    MR-ACTION    (PV-SUB)         18010000
180200                                    MR-VEND-TYPE (PV-SUB)         18020000
180300                                    MR-VEND-NAME (PV-SUB)         18030000
180400                                    MR-TYPE-DSC  (PV-SUB)         18040000
180500                                    MR-PRM-NME   (PV-SUB)         18050000
180600     ELSE                                                         18060000
180700         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       18070000
180800                                                           > SPACE18080000
180900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18090000
181000                                           TO MR-SELECTI (PV-SUB) 18100000
181100         ELSE                                                     18110000
181200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      18120000
181300                                           TO MR-SELECTI (PV-SUB) 18130000
181400         END-IF                                                   18140000
181500                                                                  18150000
181600         IF DP030-SET-CURSOR-TRAILER                              18160000
181700             IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)   18170000
181800                                                           > SPACE18180000
181900                OR PV-SUB = 1                                     18190000
182000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              18200000
182100                 MOVE -1 TO MR-SELECTL (PV-SUB)                   18210000
182200             END-IF                                               18220000
182300         END-IF                                                   18230000
182400                                                                  18240000
182500         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            18250000
182600             MOVE ASC-ACTION    (ASC-BLK-SUB ASC-ITEM-SUB)        18260000
182700                                             TO MR-ACTION (PV-SUB)18270000
182800             MOVE ASC-VEND-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)        18280000
182900                                          TO MR-VEND-TYPE (PV-SUB)18290000
183000             MOVE ASC-VEND-NAME (ASC-BLK-SUB ASC-ITEM-SUB)        18300000
183100                                          TO MR-VEND-NAME (PV-SUB)18310000
183200             MOVE ASC-PRM-NME   (ASC-BLK-SUB ASC-ITEM-SUB)        18320000
183300                                            TO MR-PRM-NME (PV-SUB)18330000
183400             EVALUATE ASC-TYPE-CDE (ASC-BLK-SUB ASC-ITEM-SUB)     18340000
183500                 WHEN PC-PRIMARY                                  18350000
183600                      MOVE PL-PRIMARY TO MR-TYPE-DSC (PV-SUB)     18360000
183700                 WHEN PC-ALIAS                                    18370000
183800                      MOVE PL-ALIAS TO MR-TYPE-DSC (PV-SUB)       18380000
183900                 WHEN PC-LABEL                                    18390000
184000                      MOVE PL-LABEL TO MR-TYPE-DSC (PV-SUB)       18400000
184100                 WHEN PC-SHORTNAME                                18410000
184200                      MOVE PL-SHORTNAME TO MR-TYPE-DSC (PV-SUB)   18420000
184300             END-EVALUATE                                         18430000
184400         END-IF                                                   18440000
184500     END-IF.                                                      18450000
184600                                                                  18460000
184700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18470000
184800                                                                  18480000
184900     IF ASC-ITEM-SUB < + 1                                        18490000
185000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18500000
185100         MOVE +1                 TO ASC-BLK-SUB                   18510000
185200     END-IF.                                                      18520000
185300                                                                  18530000
185400******************************************************************18540000
185500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **18550000
185600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **18560000
185700** ISSUE A WARNING.                                             **18570000
185800******************************************************************18580000
185900 4430-CHECK-FOR-BEGIN-AND-END.                                    18590000
186000                                                                  18600000
186100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18610000
186200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18620000
186300*            -- NO END-OF-RANGE SPECFIED ---                      18630000
186400             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            18640000
186500             SET DP020-MSG-WARNING TO TRUE                        18650000
186600             PERFORM 4431-POSITION-AT-WARNING                     18660000
186700         END-IF                                                   18670000
186800     ELSE                                                         18680000
186900         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     18690000
187000*            -- NO BEGINNING-OF-RANGE SPECFIED ---                18700000
187100             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            18710000
187200             SET DP020-MSG-WARNING TO TRUE                        18720000
187300             PERFORM 4431-POSITION-AT-WARNING                     18730000
187400         END-IF                                                   18740000
187500     END-IF.                                                      18750000
187600                                                                  18760000
187700******************************************************************18770000
187800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **18780000
187900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **18790000
188000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **18800000
188100** POSITION THE CURSOR THERE.                                   **18810000
188200******************************************************************18820000
188300 4431-POSITION-AT-WARNING.                                        18830000
188400                                                                  18840000
188500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18850000
188600                    - PV-TOP-ITEM + 1.                            18860000
188700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18870000
188800         CONTINUE                                                 18880000
188900     ELSE                                                         18890000
189000         SET DP030-SET-CURSOR-APPL-1                              18900000
189100                                   TO TRUE                        18910000
189200         MOVE -1                   TO MR-SELECTL (PV-SUB)         18920000
189300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18930000
189400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         18940000
189500     END-IF.                                                      18950000
189600                                                                  18960000
189700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18970000
189800                    - PV-TOP-ITEM + 1.                            18980000
189900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18990000
190000         CONTINUE                                                 19000000
190100     ELSE                                                         19010000
190200         SET DP030-SET-CURSOR-APPL-1                              19020000
190300                                   TO TRUE                        19030000
190400         MOVE -1                   TO MR-SELECTL (PV-SUB)         19040000
190500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19050000
190600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19060000
190700     END-IF.                                                      19070000
190800                                                                  19080000
190900*----------------------------------------------------------------*19090000
191000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *19100000
191100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *19110000
191200* FOR THE SELECTED ITEMS QUEUE.                                  *19120000
191300*                                                                *19130000
191400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *19140000
191500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *19150000
191600* THE ARRAY IS FULL.                                             *19160000
191700*----------------------------------------------------------------*19170000
191800 5000-PREPARE-SEL-QUEUE.                                          19180000
191900                                                                  19190000
192000     MOVE +1                   TO  ASC-BLK-SUB.                   19200000
192100     PERFORM 5100-WRITE-TEMP-STORAGE.                             19210000
192200     ADD +1                    TO  ASC-BLK-SUB.                   19220000
192300     PERFORM 5100-WRITE-TEMP-STORAGE.                             19230000
192400                                                                  19240000
192500     MOVE ASC-SEL-QUEUE-NAME   TO  VN002-SEL-QUEUE-NAME.          19250000
192600     PERFORM 6010-DELETE-SEL-QUEUE.                               19260000
192700                                                                  19270000
192800     SET ASC-UPDATE-TSQ        TO  TRUE.                          19280000
192900                                                                  19290000
193000     SET VN003-IDX             TO  1.                             19300000
193100     MOVE ZERO                 TO VN002-NUMBER-OF-TS-ITEMS.       19310000
193200     INITIALIZE VN003-SELECTED-ITEM-ARRAY.                        19320000
193300                                                                  19330000
193400     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           19340000
193500             VARYING PV-ITEM                                      19350000
193600             FROM 1 BY 1                                          19360000
193700             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     19370000
193800                                                                  19380000
193900     IF  VN003-IDX > 1                                            19390000
194000         PERFORM 5205-WRITE-SEL-QUEUE                             19400000
194100         ADD +1                TO VN002-NUMBER-OF-TS-ITEMS        19410000
194200     END-IF.                                                      19420000
194300                                                                  19430000
194400*----------------------------------------------------------------*19440000
194500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *19450000
194600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *19460000
194700*----------------------------------------------------------------*19470000
194800 5100-WRITE-TEMP-STORAGE.                                         19480000
194900                                                                  19490000
195000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     19500000
195100                                   TO PV-LIST-ITEM-NUMBER.        19510000
195200     COMPUTE PV-BLOCK-NUMBER =                                    19520000
195300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    19530000
195400                                                                  19540000
195500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             19550000
195600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             19560000
195700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      19570000
195800             PERFORM 5105-REWRITE-ASC-LISTQ                       19580000
195900         END-IF                                                   19590000
196000     ELSE                                                         19600000
196100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       19610000
196200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            19620000
196300         PERFORM 5110-WRITE-ASC-LISTQ                             19630000
196400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   19640000
196500     END-IF.                                                      19650000
196600                                                                  19660000
196700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19670000
196800******************************************************************19680000
196900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **19690000
197000** SPECIFIC COMMAREA.                                           **19700000
197100******************************************************************19710000
197200 5105-REWRITE-ASC-LISTQ.                                          19720000
197300                                                                  19730000
197400     EXEC CICS                                                    19740000
197500         WRITEQ TS                                                19750000
197600             QUEUE (ASC-LIST-QUEUE-NAME)                          19760000
197700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19770000
197800             ITEM  (PV-BLOCK-NUMBER)                              19780000
197900             REWRITE                                              19790000
198000             RESP  (PV-CICS-RESP)                                 19800000
198100     END-EXEC.                                                    19810000
198200                                                                  19820000
198300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           19830000
198400         CONTINUE                                                 19840000
198500     ELSE                                                         19850000
198600         SET DP013-CICS-ABEND            TO TRUE                  19860000
198700         SET DP013-NO-ROLLBACK           TO TRUE                  19870000
198800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       19880000
198900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     19890000
199000                                         TO DP013-MESSAGE-TEXT(1) 19900000
199100         PERFORM DP013-0000-PROCESS-ABEND                         19910000
199200     END-IF.                                                      19920000
199300                                                                  19930000
199400******************************************************************19940000
199500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **19950000
199600** SPECIFIC COMMAREA.                                           **19960000
199700******************************************************************19970000
199800 5110-WRITE-ASC-LISTQ.                                            19980000
199900                                                                  19990000
200000     EXEC CICS                                                    20000000
200100         WRITEQ TS                                                20010000
200200             QUEUE (ASC-LIST-QUEUE-NAME)                          20020000
200300             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20030000
200400             ITEM  (PV-BLOCK-NUMBER)                              20040000
200500             RESP  (PV-CICS-RESP)                                 20050000
200600     END-EXEC.                                                    20060000
200700     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      20070000
200800         SET DP013-CICS-ABEND      TO TRUE                        20080000
200900         SET DP013-NO-ROLLBACK     TO TRUE                        20090000
201000         MOVE '5110-WRITE-ASC-LISTQ'                              20100000
201100                                   TO DP013-PARAGRAPH             20110000
201200         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           20120000
201300                                   TO DP013-MESSAGE-TEXT(1)       20130000
201400         PERFORM DP013-0000-PROCESS-ABEND                         20140000
201500     END-IF.                                                      20150000
201600                                                                  20160000
201700*----------------------------------------------------------------*20170000
201800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *20180000
201900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *20190000
202000*----------------------------------------------------------------*20200000
202100 5200-FILL-SEL-QUEUE-RECORD.                                      20210000
202200                                                                  20220000
202300     PERFORM 6112-READ-LIST-QUEUE.                                20230000
202400                                                                  20240000
202500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       20250000
202600         PERFORM                                                  20260000
202700         VARYING LQW-IDX                                          20270000
202800         FROM 1 BY 1                                              20280000
202900         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            20290000
203000           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          20300000
203100                                                                  20310000
203200             IF  LQW-SELECT (LQW-IDX)                             20320000
203300                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              20330000
203400                                   TO VN003-ITEM (VN003-IDX)      20340000
203500                 MOVE SPACES       TO VN003-DEPARTMENT (VN003-IDX)20350000
203600                 MOVE LQW-ENT-ID (LQW-IDX)                        20360000
203700                                   TO VN003-ENT-ID (VN003-IDX)    20370000
203800                 MOVE SPACE        TO VN003-ACTION-SW (VN003-IDX) 20380000
203900                 SET VN003-IDX UP BY 1                            20390000
204000                 IF  VN003-IDX > VN003-MAX-ITEMS                  20400000
204100                     PERFORM 5205-WRITE-SEL-QUEUE                 20410000
204200                     ADD +1        TO VN002-NUMBER-OF-TS-ITEMS    20420000
204300                     INITIALIZE VN003-SELECTED-ITEM-ARRAY         20430000
204400                     SET VN003-IDX TO  1                          20440000
204500                 END-IF                                           20450000
204600             END-IF                                               20460000
204700         END-PERFORM                                              20470000
204800     END-IF.                                                      20480000
204900                                                                  20490000
205000*----------------------------------------------------------------*20500000
205100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *20510000
205200*----------------------------------------------------------------*20520000
205300 5205-WRITE-SEL-QUEUE.                                            20530000
205400                                                                  20540000
205500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20550000
205600                                   TO VN003-SELECTED-ITEMS.       20560000
205700                                                                  20570000
205800     EXEC CICS                                                    20580000
205900          WRITEQ TS                                               20590000
206000              QUEUE (ASC-SEL-QUEUE-NAME)                          20600000
206100              FROM  (VN003-VENDOR-SEL-REC)                        20610000
206200              ITEM  (PV-SEL-QUEUE-ITEM)                           20620000
206300              RESP  (PV-CICS-RESP)                                20630000
206400     END-EXEC.                                                    20640000
206500                                                                  20650000
206600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          20660000
206700         CONTINUE                                                 20670000
206800     ELSE                                                         20680000
206900         SET DP013-CICS-ABEND      TO TRUE                        20690000
207000         SET DP013-NO-ROLLBACK     TO TRUE                        20700000
207100         MOVE '5205-WRITE-SEL-QUEUE'                              20710000
207200                                   TO DP013-PARAGRAPH             20720000
207300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20730000
207400                                   TO DP013-MESSAGE-TEXT(1)       20740000
207500         PERFORM DP013-0000-PROCESS-ABEND                         20750000
207600     END-IF.                                                      20760000
207700                                                                  20770000
207800******************************************************************20780000
207900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **20790000
208000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **20800000
208100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **20810000
208200** THE USER.                                                    **20820000
208300******************************************************************20830000
208400 6000-REFRESH-PANEL-FROM-TEMP.                                    20840000
208500                                                                  20850000
208600     IF  ASC-UPDATE-TSQ                                           20860000
208700         SET ASC-NO-TSQ-UPDATE TO TRUE                            20870000
208800         MOVE ZERO                 TO PV-SAVE-ITEM                20880000
208900                                      PV-SEL-QUEUE-ITEM           20890000
209000         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        20900000
209100                                   TO PV-HOLD-SELECTED-ITEMS      20910000
209200         PERFORM 6100-UPDATE-TSQ                                  20920000
209300             UNTIL PV-ITEMS-PROCESSED >                           20930000
209400                                     ASC-NUMBER-OF-SELECTED-ITEMS 20940000
209500         PERFORM 6010-DELETE-SEL-QUEUE                            20950000
209600         INITIALIZE ASC-BLOCK-ENTRIES (1)                         20960000
209700                    ASC-BLOCK-ENTRIES (2)                         20970000
209800     END-IF.                                                      20980000
209900                                                                  20990000
210000*----------------------------------------------------------------*21000000
210100*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *21010000
210200*----------------------------------------------------------------*21020000
210300 6010-DELETE-SEL-QUEUE.                                           21030000
210400                                                                  21040000
210500     EXEC CICS                                                    21050000
210600         DELETEQ TS                                               21060000
210700             QUEUE (ASC-SEL-QUEUE-NAME)                           21070000
210800             RESP  (PV-CICS-RESP)                                 21080000
210900     END-EXEC.                                                    21090000
211000                                                                  21100000
211100     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      21110000
211200        (PV-CICS-RESP = DFHRESP(QIDERR)))                         21120000
211300         CONTINUE                                                 21130000
211400     ELSE                                                         21140000
211500         SET DP013-CICS-ABEND TO TRUE                             21150000
211600         SET DP013-NO-ROLLBACK TO TRUE                            21160000
211700         MOVE '6010-DELETE-SEL-QUEUE'                             21170000
211800                        TO DP013-PARAGRAPH                        21180000
211900         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         21190000
212000                        TO DP013-MESSAGE-TEXT (1)                 21200000
212100         PERFORM DP013-0000-PROCESS-ABEND                         21210000
212200     END-IF.                                                      21220000
212300                                                                  21230000
212400*----------------------------------------------------------------*21240000
212500*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *21250000
212600*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *21260000
212700*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *21270000
212800*    THE TEMP QUEUE.                                             *21280000
212900*----------------------------------------------------------------*21290000
213000 6100-UPDATE-TSQ.                                                 21300000
213100                                                                  21310000
213200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             21320000
213300     PERFORM 6105-READ-SEL-QUEUE.                                 21330000
213400     PERFORM                                                      21340000
213500         VARYING VN003-IDX                                        21350000
213600         FROM 1 BY 1                                              21360000
213700         UNTIL ((PV-ITEMS-PROCESSED >                             21370000
213800                              PV-HOLD-SELECTED-ITEMS)             21380000
213900         OR (VN003-IDX GREATER THAN VN003-MAX-ITEMS))             21390000
214000         IF  VN003-ACTION-SW (VN003-IDX) > SPACE                  21400000
214100             PERFORM 6110-PROCESS-ITEMS                           21410000
214200         END-IF                                                   21420000
214300         ADD +1                TO PV-ITEMS-PROCESSED              21430000
214400     END-PERFORM.                                                 21440000
214500                                                                  21450000
214600     PERFORM 6111-WRITE-LIST-QUEUE.                               21460000
214700                                                                  21470000
214800*----------------------------------------------------------------*21480000
214900*    READ THE LIST QUEUE RECORD.                                 *21490000
215000*----------------------------------------------------------------*21500000
215100 6105-READ-SEL-QUEUE.                                             21510000
215200                                                                  21520000
215300     EXEC CICS                                                    21530000
215400          READQ TS                                                21540000
215500              QUEUE (ASC-SEL-QUEUE-NAME)                          21550000
215600              INTO  (VN003-VENDOR-SEL-REC)                        21560000
215700              ITEM  (PV-SEL-QUEUE-ITEM)                           21570000
215800              RESP  (PV-CICS-RESP)                                21580000
215900     END-EXEC.                                                    21590000
216000                                                                  21600000
216100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21610000
216200         CONTINUE                                                 21620000
216300     ELSE                                                         21630000
216400         SET DP013-CICS-ABEND      TO  TRUE                       21640000
216500         SET DP013-NO-ROLLBACK     TO  TRUE                       21650000
216600         MOVE '6105-READ-SEL-QUEUE'                               21660000
216700                                   TO  DP013-PARAGRAPH            21670000
216800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           21680000
216900                                   TO  DP013-MESSAGE-TEXT(1)      21690000
217000         PERFORM DP013-0000-PROCESS-ABEND                         21700000
217100     END-IF.                                                      21710000
217200                                                                  21720000
217300*----------------------------------------------------------------*21730000
217400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*21740000
217500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*21750000
217600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *21760000
217700*----------------------------------------------------------------*21770000
217800 6110-PROCESS-ITEMS.                                              21780000
217900                                                                  21790000
218000     COMPUTE PV-ITEM = 1 + ((VN003-ITEM (VN003-IDX) - 1)          21800000
218100                     / PC-ITEMS-PER-PANEL).                       21810000
218200                                                                  21820000
218300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           21830000
218400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          21840000
218500             PERFORM 6111-WRITE-LIST-QUEUE                        21850000
218600         END-IF                                                   21860000
218700         MOVE PV-ITEM          TO PV-SAVE-ITEM                    21870000
218800                                                                  21880000
218900         PERFORM 6112-READ-LIST-QUEUE                             21890000
219000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               21900000
219100             CONTINUE                                             21910000
219200         END-IF                                                   21920000
219300     END-IF.                                                      21930000
219400                                                                  21940000
219500     COMPUTE PV-SUB = (VN003-ITEM (VN003-IDX)                     21950000
219600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              21960000
219700     SET LQW-DESELECT (PV-SUB) TO    TRUE                         21970000
219800     MOVE LQW-SELECTED-SW (PV-SUB)                                21980000
219900                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  21990000
220000     EVALUATE TRUE                                                22000000
220100         WHEN VN003-INQ (VN003-IDX)                               22010000
220200              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             22020000
220300                                                                  22030000
220400         WHEN VN003-UPD (VN003-IDX)                               22040000
220500              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             22050000
220600                                                                  22060000
220700         WHEN VN003-DEL (VN003-IDX)                               22070000
220800              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             22080000
220900                                                                  22090000
221000         WHEN VN003-ERR (VN003-IDX)                               22100000
221100              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             22110000
221200     END-EVALUATE.                                                22120000
221300                                                                  22130000
221400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                22140000
221500                                                                  22150000
221600*----------------------------------------------------------------*22160000
221700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *22170000
221800*----------------------------------------------------------------*22180000
221900 6111-WRITE-LIST-QUEUE.                                           22190000
222000                                                                  22200000
222100     EXEC CICS                                                    22210000
222200         WRITEQ TS                                                22220000
222300             QUEUE (ASC-LIST-QUEUE-NAME)                          22230000
222400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     22240000
222500             ITEM  (PV-SAVE-ITEM)                                 22250000
222600             REWRITE                                              22260000
222700             RESP  (PV-CICS-RESP)                                 22270000
222800     END-EXEC.                                                    22280000
222900                                                                  22290000
223000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22300000
223100         CONTINUE                                                 22310000
223200     ELSE                                                         22320000
223300         SET DP013-CICS-ABEND  TO  TRUE                           22330000
223400         SET DP013-NO-ROLLBACK TO  TRUE                           22340000
223500         MOVE '6111-WRITE-LIST-QUEUE'                             22350000
223600                               TO  DP013-PARAGRAPH                22360000
223700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  22370000
223800                               TO  DP013-MESSAGE-TEXT(1)          22380000
223900         PERFORM DP013-0000-PROCESS-ABEND                         22390000
224000     END-IF.                                                      22400000
224100                                                                  22410000
224110     EJECT                                                        22411004
224120                                                                  22412004
224200*----------------------------------------------------------------*22420000
224300*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*22430000
224400*----------------------------------------------------------------*22440000
224500 6112-READ-LIST-QUEUE.                                            22450000
224600                                                                  22460000
224700     EXEC CICS                                                    22470000
224800         READQ TS                                                 22480000
224900             QUEUE (ASC-LIST-QUEUE-NAME)                          22490000
225000             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     22500000
225100             ITEM  (PV-ITEM)                                      22510000
225200             RESP  (PV-CICS-RESP)                                 22520000
225300     END-EXEC.                                                    22530000
225400                                                                  22540000
225500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22550000
225600         CONTINUE                                                 22560000
225700     ELSE                                                         22570000
225800         SET DP013-CICS-ABEND        TO TRUE                      22580000
225900         SET DP013-NO-ROLLBACK       TO TRUE                      22590000
226000         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           22600000
226100         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    22610000
226200                                     TO DP013-MESSAGE-TEXT(1)     22620000
226300         PERFORM DP013-0000-PROCESS-ABEND                         22630000
226400     END-IF.                                                      22640000
226500                                                                  22650000
226510     EJECT                                                        22651004
226520                                                                  22652004
226600*----------------------------------------------------------------*22660000
226700*    ABEND PROCESSOR MODULE                                      *22670000
226800*----------------------------------------------------------------*22680000
226810                                                                  22681004
226901     COPY DPPD013.                                                22690108
226910                                                                  22691004
227000*                                                                 22700004
227100*----------------------------------------------------------------*22710004
