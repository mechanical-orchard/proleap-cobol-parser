000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000600 PROGRAM-ID.    CNKCS239.                                         00060001
000700 AUTHOR.        DENISE HAHN.                                      00070002
000800 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00080001
000900 DATE-WRITTEN.  JUNE, 2012.                                       00090002
001000 DATE-COMPILED.                                                   00100001
001100                                                                  00110001
001200*---------------------------------------------------------------* 00120001
001300*    Y239 - SEASONAL SET LIST                                   * 00130002
001400*---------------------------------------------------------------* 00140001
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00141058
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00142058
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00143058
263455*----------------------------------------------------------------*00144058
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00145059
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00146059
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00147059
CICS  *-----------------------------------------------------------------00148059
001500 ENVIRONMENT DIVISION.                                            00150001
001600 DATA DIVISION.                                                   00160001
001700                                                                  00170001
001800 WORKING-STORAGE SECTION.                                         00180001
001900*                                                                 00190003
002000 01  DK-DB2-KEYS.                                                 00200006
002100     05  DK-SET-YEAR               PIC X(04)      VALUE SPACES.   00210006
002200     05  DK-SET-SHRTNM             PIC X(05)      VALUE SPACES.   00220006
002210     05  DK-WORK-YEAR              PIC X(04)      VALUE SPACES.   00221006
002800                                                                  00280029
002900 01  PC-PROGRAM-CONSTANTS.                                        00290008
003000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK239  '.  00300008
003100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM239 '.  00310008
003200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS239'.  00320008
003500     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00350009
003600     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00360008
003700     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00370010
003900     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +13          00390010
004000                                               COMP SYNC.         00400010
004100     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00410010
004200                                               COMP SYNC.         00420010
004300     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00430010
004400                                               COMP-3.            00440010
004500     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00450010
004600                                               COMP SYNC.         00460010
004700     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00470022
004800                                               COMP-3.            00480022
004900     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00490022
005000     05  PC-ADD                    PIC  X(03)  VALUE 'ADD'.       00500022
005100     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00510022
005200     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00520022
005300     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00530022
005700     05  PC-A                      PIC  X(01)  VALUE 'A'.         00570010
006400                                                                  00640029
006500*----------------------------------------------------------------*00650001
006600*  SYSTEM MESSAGES                                               *00660001
006700*----------------------------------------------------------------*00670001
006800*   00005 = INVALID VALUE                                        *00680001
006900*   00008 = MUST BE NUMERIC                                      *00690001
007000*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00700001
007100*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00710001
007200*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00720001
007300*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00730001
007400*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00740001
007500*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00750001
007600*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00760001
007700*   00069 - TOP OF LIST                                          *00770001
007800*   00070 - BOTTOM OF LIST                                       *00780001
007900*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00790001
008000*   00279 - MORE ITEMS TO DISPLAY                                *00800001
008300*----------------------------------------------------------------*00830001
008400     05  PC-TSYMSG-NUMBERS.                                       00840015
008500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00850020
008600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00860017
008700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00870020
008800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00880020
008900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00890020
009000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00900022
009100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00910020
009200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00920020
009300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00930012
009400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00940015
009500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00950015
009600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00960017
009700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00970020
010000                                                                  01000029
010100 01  PS-PROGRAM-SWITCHES.                                         01010011
010200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01020011
010300         88  PS-NO-ERROR                            VALUE 'Y'.    01030011
010400         88  PS-ERROR                               VALUE 'N'.    01040011
010500     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01050011
010600         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01060011
010700         88  PS-BLOCK-ERROR                         VALUE 'N'.    01070011
011400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01140010
011500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01150010
011600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01160010
012000                                                                  01200029
012100 01  PV-PROGRAM-VARIABLES.                                        01210006
012111     15  PV-WORK-YEAR                   PIC  9(04).               01211106
012112     15  PV-WORK-YEAR-CHAR              PIC  X(04).               01211206
012113     15  PV-RECORD-TYPE                 PIC  X(01).               01211307
012120                                                                  01212006
012400     05  PV-SUB                         PIC S9(04)  VALUE +0      01240017
012500                                                    COMP SYNC.    01250017
012600     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01260022
012700                                                    COMP SYNC.    01270022
012800     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01280022
012900                                                    COMP-3.       01290022
013000     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01300022
013100                                                    COMP-3.       01310022
013200     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01320022
013300                                                    COMP-3.       01330022
013400     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01340019
013500                                                    COMP-3.       01350019
013600     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01360009
013700                                                    COMP-3.       01370009
013800     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01380009
013900                                                    COMP-3.       01390009
014000     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01400009
014100                                                    COMP-3.       01410009
014200     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01420009
014300                                                    COMP SYNC.    01430009
014400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01440009
014500                                                    COMP SYNC.    01450009
014600     05  PV-ITEM                        PIC S9(04)  VALUE +0      01460017
014700                                                    COMP SYNC.    01470017
014800     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01480022
014900                                                    COMP SYNC.    01490022
015000     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01500022
015100                                                    COMP SYNC.    01510022
015200     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01520022
015300                                                    COMP SYNC.    01530022
015400     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01540017
015500                                                    COMP SYNC.    01550017
015600     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01560017
015700                                                    COMP SYNC.    01570017
015800     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01580017
015900                                                    COMP SYNC.    01590017
016000     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01600017
016100                                                    COMP SYNC.    01610017
016200     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01620017
016300                                                    COMP SYNC.    01630017
016400     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01640017
016500                                                    COMP SYNC.    01650017
016600     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01660017
016700                                                    COMP SYNC.    01670017
016800     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01680017
016900                                                    COMP SYNC.    01690017
017000     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01700022
017100                                                    COMP SYNC.    01710022
018800                                                                  01880029
018900     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01890019
019000                                                     COMP SYNC.   01900019
019100     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01910011
019200     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01920011
019500                                                                  01950001
019600******************************************************************01960001
019700**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01970001
019800**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01980001
019900**  APPLICATION-SPECIFIC COMMAREA.                              **01990001
020000******************************************************************02000001
020100 01  LQW-LIST-QUEUE-WORK-AREA.                                    02010001
020200     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02020001
020300     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           02030048
020400                                        INDEXED BY LQW-IDX.       02040001
020500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02050001
020600         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02060001
020700         10  LQW-SELECTED-SW            PIC  X(01).               02070001
020800             88  LQW-SELECT                         VALUE 'S'.    02080001
020900             88  LQW-DESELECT                       VALUE ' '.    02090001
021000         10  LQW-ACTION                 PIC  X(03).               02100001
021100             88  LQW-ADD                            VALUE 'ADD'.  02110001
021200             88  LQW-INQ                            VALUE 'INQ'.  02120001
021300             88  LQW-UPD                            VALUE 'UPD'.  02130001
021400             88  LQW-ERR                            VALUE 'ERR'.  02140001
021410         10  LQW-DIVERT                 PIC  9(05).               02141044
021420         10  LQW-DIVERT-R REDEFINES LQW-DIVERT.                   02142044
021430             15  FILLER                 PIC  X(03).               02143044
021440             15  LQW-DIVERT-2DIGIT      PIC  X(02).               02144044
021500         10  LQW-SET-YR                 PIC  X(04).               02150005
021600         10  LQW-SHRTNM                 PIC  X(05).               02160005
021700         10  LQW-TYPE                   PIC  X(03).               02170005
021800         10  LQW-SET-NAME               PIC  X(25).               02180005
021900         10  LQW-STATUS                 PIC  X(01).               02190005
022000         10  LQW-END-DATE               PIC  X(10).               02200005
022100         10  FILLER                     PIC  X(10).               02210045
022200                                                                  02220001
022300*---------------------------------------------------------------* 02230001
022400* SELECTION QUEUE LAYOUT                                        * 02240001
022500*---------------------------------------------------------------* 02250001
022600     COPY CNWS017.                                                02260001
022700                                                                  02270001
022800*---------------------------------------------------------------* 02280001
022900*    MAP LAYOUT                                                 * 02290001
023000*---------------------------------------------------------------* 02300001
023100     COPY CNKM239.                                                02310001
023200*                                                                 02320001
023300 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK239O.       02330001
023400     05  FILLER                         PIC X(42).                02340022
023500     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02350005
023600         10  MR-SELECTL                 PIC S9(04) COMP.          02360001
023700         10  MR-SELECTA                 PIC  X(01).               02370001
023800         10  MR-SELECTC                 PIC  X(01).               02380001
023900         10  MR-SELECTH                 PIC  X(01).               02390001
024000         10  MR-SELECTI                 PIC  X(01).               02400001
024100                                                                  02410001
024200         10  MR-ACTIONL                 PIC S9(04) COMP.          02420001
024300         10  MR-ACTIONA                 PIC  X(01).               02430001
024400         10  MR-ACTIONC                 PIC  X(01).               02440001
024500         10  MR-ACTIONH                 PIC  X(01).               02450001
024600         10  MR-ACTION                  PIC  X(03).               02460001
024700                                                                  02470001
025310         10  MR-DIVERTL                PIC S9(04) COMP.           02531023
025320         10  MR-DIVERTA                PIC  X(01).                02532023
025330         10  MR-DIVERTC                PIC  X(01).                02533023
025340         10  MR-DIVERTH                PIC  X(01).                02534023
025350         10  MR-DIVERT                 PIC  X(02).                02535023
025360                                                                  02536023
025370         10  MR-SET-YRL                PIC S9(04) COMP.           02537023
025380         10  MR-SET-YRA                PIC  X(01).                02538023
025390         10  MR-SET-YRC                PIC  X(01).                02539023
025391         10  MR-SET-YRH                PIC  X(01).                02539123
025392         10  MR-SET-YR                 PIC  X(04).                02539223
025393                                                                  02539323
025400         10  MR-SHRTNML                PIC S9(04) COMP.           02540005
025500         10  MR-SHRTNMA                PIC  X(01).                02550005
025600         10  MR-SHRTNMC                PIC  X(01).                02560005
025700         10  MR-SHRTNMH                PIC  X(01).                02570005
025800         10  MR-SHRTNM                 PIC  X(05).                02580005
025900                                                                  02590001
026000         10  MR-TYPEL                  PIC S9(04) COMP.           02600005
026100         10  MR-TYPEA                  PIC  X(01).                02610005
026200         10  MR-TYPEC                  PIC  X(01).                02620005
026300         10  MR-TYPEH                  PIC  X(01).                02630005
026400         10  MR-TYPE                   PIC  X(03).                02640005
026500                                                                  02650001
026600         10  MR-SET-NAMEL              PIC S9(04) COMP.           02660005
026700         10  MR-SET-NAMEA              PIC  X(01).                02670005
026800         10  MR-SET-NAMEC              PIC  X(01).                02680005
026900         10  MR-SET-NAMEH              PIC  X(01).                02690005
027000         10  MR-SET-NAME               PIC  X(25).                02700005
027100                                                                  02710001
027200         10  MR-STATUSL                PIC S9(04) COMP.           02720005
027300         10  MR-STATUSA                PIC  X(01).                02730005
027400         10  MR-STATUSC                PIC  X(01).                02740005
027500         10  MR-STATUSH                PIC  X(01).                02750005
027600         10  MR-STATUS                 PIC  X(01).                02760005
027700                                                                  02770001
027800         10  MR-END-DATEL              PIC S9(04) COMP.           02780005
027900         10  MR-END-DATEA              PIC  X(01).                02790005
028000         10  MR-END-DATEC              PIC  X(01).                02800005
028100         10  MR-END-DATEH              PIC  X(01).                02810005
028200         10  MR-END-DATE               PIC  X(10).                02820027
028300                                                                  02830001
029000     05  FILLER                         PIC  X(12).               02900001
029100                                                                  02910001
029200*----------------------------------------------------------------*02920001
029900*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02990001
030000*---------------------------------------------------------------* 03000001
030100     COPY DPWS015.                                                03010001
030200                                                                  03020001
030300*---------------------------------------------------------------* 03030001
030400*    FUNCTION KEYS COPYBOOK.                                    * 03040001
030500*---------------------------------------------------------------* 03050001
030600     COPY DPWS016.                                                03060001
030700                                                                  03070001
030800*---------------------------------------------------------------* 03080001
030900*    NUMERIC EDIT LAYOUT.                                       * 03090001
031000*---------------------------------------------------------------* 03100001
031100     COPY DPWS010I.                                               03110001
031200                                                                  03120001
031300*---------------------------------------------------------------* 03130001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03140059
031500*---------------------------------------------------------------* 03150001
031600     COPY DPWS030.                                                03160001
CICS       COPY DPWS930.                                                03161059
031700                                                                  03170001
031800*---------------------------------------------------------------* 03180001
031900*    STANDARD COMMAREA.                                         * 03190001
032000*---------------------------------------------------------------* 03200001
032100     COPY DPWS020.                                                03210001
032200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03220001
032300                                                                  03230001
032400*---------------------------------------------------------------* 03240001
032500* INTER-APPLICATION COMMAREA.                                   * 03250001
032600*   CNWS015 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03260001
032700*             SPEC SCREEN.                                      * 03270001
032800*   CNWS016 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03280001
032900*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03290001
033000*---------------------------------------------------------------* 03300001
033100         10  INTER-APPL-COMM-AREA       PIC X(200).               03310001
033200     COPY CNWS015.                                                03320001
033300     COPY CNWS016.                                                03330001
033400                                                                  03340001
033500*---------------------------------------------------------------* 03350001
033600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03360001
033700*---------------------------------------------------------------* 03370001
033710                                                                  03371029
033800         10  ASC-SPECIFIC-COMMAREA.                               03380008
033900             15  ASC-FUNCTION                 PIC  X(01).         03390022
033910             15  ASC-CRIT-SET-YEAR            PIC  9(04).         03391010
033920             15  ASC-CRIT-SHORT-NAME          PIC  X(05).         03392010
034400             15  ASC-BLK-SUB                  PIC S9(04) COMP     03440009
034500                                                         SYNC.    03450009
034600             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03460009
034700                                                         SYNC.    03470009
034800             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03480009
034900             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03490009
035000             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03500019
035100             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03510009
035200             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03520009
035300             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03530009
035400                                                         SYNC.    03540009
035500             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03550018
035600             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03560018
036000             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03600018
036100                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03610018
036200                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03620018
036300             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03630018
036400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03640018
036500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03650018
036600             15  ASC-LIST-QUEUE-NAME.                             03660008
036700                 20  ASC-LIST-TERM-ID         PIC  X(04).         03670008
036800                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03680008
036900                 20  ASC-LIST-SEQ             PIC  9(01).         03690008
037000                                                                  03700008
037100             15  ASC-START-ITEM-REQUEST.                          03710010
037200                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03720010
037300                                                                  03730010
037400             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03740010
037500             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03750010
037600             15  ASC-CURSOR-SW                PIC  X(02).         03760008
037700                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03770008
037800                 88  ASC-SET-YR-SHRTNM-CSR           VALUE 'A '.  03780008
037900                 88  ASC-SET-NO-SET-CSR              VALUE 'B '.  03790008
038700                                                                  03870010
038800             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03880006
038900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03890006
039000             15  ASC-SEL-QUEUE-NAME.                              03900006
039100                 20  ASC-SEL-TERM-ID          PIC  X(04).         03910006
039200                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03920006
039300                 20  ASC-SEL-SEQ              PIC  9(01).         03930006
039400                                                                  03940006
039500             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03950006
039600                                                                  03960006
039610             15  ASC-CURRENT-TIMESTAMP               PIC  X(26).  03961046
039620             15  ASC-CURRENT-TIMESTAMP-R                          03962046
039630                 REDEFINES ASC-CURRENT-TIMESTAMP.                 03963046
039640                 20  ASC-CURRENT-YEAR                PIC  9(04).  03964053
039650                 20  FILLER                          PIC  X(22).  03965046
039660             15  ASC-CURRENT-TIMESTAMP-R2                         03966046
039670                 REDEFINES ASC-CURRENT-TIMESTAMP.                 03967046
039680                 20  ASC-CURRENT-DATE                PIC  X(10).  03968046
039690                 20  FILLER                          PIC  X(16).  03969046
039691             15  ASC-DEFAULT-DATE                    PIC  X(10).  03969146
039692                 88  ASC-NO-STR-RLSE-DTE     VALUE '9999-09-09'.  03969246
039693             15  FILLER                              PIC X(100).  03969346
039694                                                                  03969446
039700*-----------------------------------------------------------------03970001
039800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03980006
039900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03990006
040000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04000006
040100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04010006
040200                                                                  04020006
040300                 20  ASC-ITEM-ARRAY.                              04030006
040400                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        04040047
040500                         30  ASC-LIST-ITEM-NUMBER                 04050006
040600                                                     PIC S9(09)   04060006
040700                                                     COMP-3.      04070006
040800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  04080006
040900                             88  ASC-VALID-SELECT    VALUE ' '    04090006
041000                                                           'S'    04100006
041100                                                           'B'    04110006
041200                                                           'E'.   04120006
041300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   04130006
041400                             88  ASC-TEMP-SELECT     VALUE 'S'.   04140006
041500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   04150006
041600                             88  ASC-TEMP-END        VALUE 'E'.   04160006
041700                         30  ASC-SELECTED-SW         PIC  X(01).  04170006
041800                             88  ASC-NO-SELECT       VALUE ' '.   04180006
041900                             88  ASC-SELECT          VALUE 'S'.   04190006
042000                             88  ASC-BEGIN           VALUE 'B'.   04200006
042100                             88  ASC-END             VALUE 'E'.   04210006
042200                         30  ASC-ACTION              PIC  X(03).  04220006
042300                         30  ASC-DIVERT              PIC  9(05).  04230028
042310                         30  ASC-DIVERT-R REDEFINES ASC-DIVERT.   04231028
042320                             40  FILLER              PIC  X(03).  04232028
042330                             40  ASC-DIVERT-2DIGIT   PIC  X(02).  04233028
042400                         30  ASC-SET-YEAR            PIC  X(04).  04240006
042500                         30  ASC-SHRTNM              PIC  X(05).  04250006
042600                         30  ASC-SET-TYPE            PIC  X(03).  04260006
042700                         30  ASC-SET-NAME            PIC  X(25).  04270006
042800                         30  ASC-STATUS              PIC  X(01).  04280006
042900                         30  ASC-END-DATE            PIC  X(10).  04290006
043000                         30  FILLER                  PIC  X(10).  04300045
043010                                                                  04301039
043280                                                                  04328039
043300                                                                  04330001
043400*---------------------------------------------------------------* 04340001
043500*    ABEND PROCESSING COPYBOOK.                                 * 04350001
043600*---------------------------------------------------------------* 04360001
043700     COPY DPWS013.                                                04370001
043800                                                                  04380001
043900*----------------------------------------------------------------*04390001
044000*    DB2 TABLE FOR SEASONAL SET TABLE                             04400003
044100*----------------------------------------------------------------*04410001
044200     EXEC SQL                                                     04420001
044300          INCLUDE TSEASET                                         04430003
044400     END-EXEC.                                                    04440001
044500                                                                  04450001
045900                                                                  04590001
046000*---------------------------------------------------------------* 04600001
046100* SEASONAL SET CURSOR - WHEN SET YEAR AND SHORT NAME ARE KNOWN  * 04610004
046110*                                                               * 04611056
046111* A-SET YR/NAME MATCH                                           * 04611156
046120* B-NOT YR/NAME MATCH, HAS DIVERT, FROM LAST 3 YEARS            * 04612055
046130* C-NOT YR/NAME MATCH, HAS DIVERT, FROM LAST 3 YEARS - NOT 9999 * 04613055
046140* D-NOT YR/NAME MATCH, NO DIVERT , FROM LAST 3 YEARS - 9999     * 04614055
046200*---------------------------------------------------------------* 04620001
046300     EXEC SQL                                                     04630001
046310        DECLARE SET-YR-SHRTNM-CSR CURSOR FOR                      04631009
046400         SELECT 'A'                                               04640004
046500              , A.SEASET_YR                                       04650004
046600              , A.SEASET_SHRT_NM                                  04660004
046700              , A.SEASET_TYP_CDE                                  04670004
046800              , A.SEASET_NM                                       04680004
046900              , A.SEASET_STAT_CDE                                 04690004
047100              , A.STR_RLSE_END_DTE                                04710004
047200              , A.DIVERT_PFX_NBR                                  04720004
047300          FROM TSEASET A                                          04730008
047400         WHERE A.SEASET_YR      = :DK-SET-YEAR                    04740004
047500           AND A.SEASET_SHRT_NM = :DK-SET-SHRTNM                  04750004
047600         UNION                                                    04760004
047700         SELECT DISTINCT 'B'                                      04770004
047800              , B.SEASET_YR                                       04780004
047900              , B.SEASET_SHRT_NM                                  04790004
048000              , B.SEASET_TYP_CDE                                  04800004
048100              , B.SEASET_NM                                       04810004
048200              , B.SEASET_STAT_CDE                                 04820004
048400              , B.STR_RLSE_END_DTE                                04840004
048500              , B.DIVERT_PFX_NBR                                  04850004
048600          FROM TSEASET B                                          04860008
048700         WHERE B.SEASET_YR          >= :PV-WORK-YEAR-CHAR         04870053
048800           AND B.DIVERT_PFX_NBR IN (10,20,30,40,50,60,70,80,90)   04880004
048900           AND NOT (B.SEASET_YR      = :DK-SET-YEAR AND           04890004
049000                    B.SEASET_SHRT_NM = :DK-SET-SHRTNM)            04900004
049010         UNION                                                    04901033
049020         SELECT DISTINCT 'C'                                      04902033
049030              , B.SEASET_YR                                       04903033
049040              , B.SEASET_SHRT_NM                                  04904033
049050              , B.SEASET_TYP_CDE                                  04905033
049060              , B.SEASET_NM                                       04906033
049070              , B.SEASET_STAT_CDE                                 04907033
049080              , B.STR_RLSE_END_DTE                                04908033
049090              , B.DIVERT_PFX_NBR                                  04909033
049091          FROM TSEASET B                                          04909133
049092         WHERE B.SEASET_YR          >= :PV-WORK-YEAR-CHAR         04909253
049093           AND NOT B.DIVERT_PFX_NBR                               04909333
049094                                IN (10,20,30,40,50,60,70,80,90)   04909433
049095           AND NOT (B.SEASET_YR      = :DK-SET-YEAR AND           04909533
049096                    B.SEASET_SHRT_NM = :DK-SET-SHRTNM)            04909633
049097           AND NOT B.STR_RLSE_END_DTE =  '9999-09-09'             04909750
049098         UNION                                                    04909850
049099         SELECT DISTINCT 'D'                                      04909950
049100              , B.SEASET_YR                                       04910050
049101              , B.SEASET_SHRT_NM                                  04910150
049102              , B.SEASET_TYP_CDE                                  04910250
049103              , B.SEASET_NM                                       04910350
049104              , B.SEASET_STAT_CDE                                 04910450
049105              , B.STR_RLSE_END_DTE                                04910550
049106              , B.DIVERT_PFX_NBR                                  04910650
049107          FROM TSEASET B                                          04910750
049108         WHERE B.SEASET_YR          >= :PV-WORK-YEAR-CHAR         04910853
049109           AND NOT B.DIVERT_PFX_NBR                               04910950
049110                                IN (10,20,30,40,50,60,70,80,90)   04911050
049111           AND NOT (B.SEASET_YR      = :DK-SET-YEAR AND           04911150
049112                    B.SEASET_SHRT_NM = :DK-SET-SHRTNM)            04911250
049113           AND B.STR_RLSE_END_DTE =  '9999-09-09'                 04911350
049120         ORDER BY 1 ASC                                           04912034
049200                 ,7 DESC                                          04920034
049300                 ,2 DESC                                          04930054
049400                 ,3 ASC                                           04940034
053600     END-EXEC.                                                    05360001
053700                                                                  05370001
053800*---------------------------------------------------------------* 05380001
053900*  SEASONAL SET CURSOR - WHEN SET NAME IS UNKNOWN                 05390055
053910*                                                               * 05391056
053930* B-                   HAS DIVERT, FROM LAST 3 YEARS            * 05393056
053940* C-                   HAS DIVERT, FROM LAST 3 YEARS - NOT 9999 * 05394056
053950* D-                   NO DIVERT , FROM LAST 3 YEARS - 9999     * 05395056
054000*---------------------------------------------------------------* 05400001
054100     EXEC SQL                                                     05410001
054110        DECLARE SET-NO-SET-CSR CURSOR FOR                         05411004
054196         SELECT DISTINCT 'B'                                      05419604
054197              , B.SEASET_YR                                       05419704
054198              , B.SEASET_SHRT_NM                                  05419804
054199              , B.SEASET_TYP_CDE                                  05419904
054200              , B.SEASET_NM                                       05420004
054201              , B.SEASET_STAT_CDE                                 05420104
054203              , B.STR_RLSE_END_DTE                                05420304
054204              , B.DIVERT_PFX_NBR                                  05420404
054205          FROM TSEASET B                                          05420508
054206         WHERE B.SEASET_YR          >= :PV-WORK-YEAR-CHAR         05420653
054207           AND B.DIVERT_PFX_NBR IN (10,20,30,40,50,60,70,80,90)   05420704
054208         UNION                                                    05420833
054209         SELECT DISTINCT 'C'                                      05420933
054210              , B.SEASET_YR                                       05421033
054211              , B.SEASET_SHRT_NM                                  05421133
054212              , B.SEASET_TYP_CDE                                  05421233
054213              , B.SEASET_NM                                       05421333
054214              , B.SEASET_STAT_CDE                                 05421433
054215              , B.STR_RLSE_END_DTE                                05421533
054216              , B.DIVERT_PFX_NBR                                  05421633
054217          FROM TSEASET B                                          05421733
054218         WHERE B.SEASET_YR          >= :PV-WORK-YEAR-CHAR         05421853
054219           AND NOT B.DIVERT_PFX_NBR                               05421933
054220                                IN (10,20,30,40,50,60,70,80,90)   05422033
054230           AND NOT B.STR_RLSE_END_DTE =  '9999-09-09'             05423051
054231         UNION                                                    05423151
054232         SELECT DISTINCT 'D'                                      05423251
054233              , B.SEASET_YR                                       05423351
054234              , B.SEASET_SHRT_NM                                  05423451
054235              , B.SEASET_TYP_CDE                                  05423551
054236              , B.SEASET_NM                                       05423651
054237              , B.SEASET_STAT_CDE                                 05423751
054238              , B.STR_RLSE_END_DTE                                05423851
054239              , B.DIVERT_PFX_NBR                                  05423951
054240          FROM TSEASET B                                          05424051
054241         WHERE B.SEASET_YR          >= :PV-WORK-YEAR-CHAR         05424153
054242           AND NOT B.DIVERT_PFX_NBR                               05424251
054243                                IN (10,20,30,40,50,60,70,80,90)   05424351
054244           AND B.STR_RLSE_END_DTE =  '9999-09-09'                 05424451
054245         ORDER BY 1 ASC                                           05424534
054250                 ,7 DESC                                          05425034
054260                 ,2 DESC                                          05426054
054270                 ,3 ASC                                           05427034
061400     END-EXEC.                                                    06140001
061500                                                                  06150001
118100                                                                  11810001
118200*---------------------------------------------------------------* 11820001
118300*    DB2 AREA FOR COMMUNICATIONS                                * 11830001
118400*---------------------------------------------------------------* 11840001
118500     EXEC SQL                                                     11850001
118600          INCLUDE SQLCA                                           11860001
118700     END-EXEC.                                                    11870001
118800                                                                  11880001
118900***************************************************************** 11890001
119000 LINKAGE SECTION.                                                 11900001
119100                                                                  11910001
119200 01  DFHCOMMAREA.                                                 11920001
119300     05  FILLER                         OCCURS  1 TO 4072 TIMES   11930001
119400                                        DEPENDING ON EIBCALEN.    11940001
119500         10  FILLER                     PIC X.                    11950001
119600                                                                  11960001
119700                                                                  11970001
119800 PROCEDURE DIVISION.                                              11980001
119900******************************************************************11990001
120000**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **12000001
120100**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **12010001
120200**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **12020001
120300******************************************************************12030001
120310                                                                  12031006
120400 0000-MAIN-MODULE.                                                12040006
120500     INITIALIZE DP030-CICS-API-FIELDS.                            12050006
120600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       12060006
120700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          12070006
120800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         12080006
120900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       12090006
121000     MOVE LENGTH OF CNK239I        TO DP030-MAP-LENGTH (1).       12100006
121100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     12110006
121200     PERFORM 0001-CALL-CICS-ARCH-API.                             12120006
121300                                                                  12130006
121400     PERFORM 1000-CONTROL-PROCESSING                              12140006
121500                                                                  12150006
121600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     12160006
121700     PERFORM 0001-CALL-CICS-ARCH-API.                             12170006
121800                                                                  12180006
121900******************************************************************12190001
122000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **12200001
122100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **12210001
122200******************************************************************12220001
122300 0001-CALL-CICS-ARCH-API.                                         12230006
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      12240059
122500                                    DFHCOMMAREA                   12250059
122600                                    DP030-CICS-API-FIELDS         12260059
122700                                    DP020-STANDARD-COMMAREA       12270059
122800                                    CNK239I.                      12280059
122900                                                                  12290006
123000     IF  DP030-RC-CALL-SUCCESSFUL                                 12300006
123100         CONTINUE                                                 12310006
123200     ELSE                                                         12320006
123300         SET DP013-NO-ROLLBACK                                    12330006
123400             DP013-XCTL-DISPLAY-RESTART                           12340006
123500             DP013-CICS-ABEND      TO TRUE                        12350006
123600         MOVE '0001-CALL-CICS-ARCH-API'                           12360006
123700                                   TO DP013-PARAGRAPH             12370006
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O12371059
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      12372059
124000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      12400006
124100         PERFORM DP013-0000-PROCESS-ABEND                         12410006
124200     END-IF.                                                      12420006
124300                                                                  12430006
124400*----------------------------------------------------------------*12440001
124500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *12450001
124600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *12460001
124700*                                                                *12470001
124800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *12480001
124900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *12490001
125000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *12500001
125100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *12510001
125200*----------------------------------------------------------------*12520001
125300 1000-CONTROL-PROCESSING.                                         12530006
125400     EVALUATE TRUE                                                12540006
125500         WHEN DP020-NEXT-ACT-INITIAL                              12550006
125600             INITIALIZE ASC-SPECIFIC-COMMAREA                     12560006
125700             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 12570006
125800                                 ASC-SEL-TERM-ID                  12580006
125900             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   12590006
126000                                           ASC-SEL-TASK-NUMBER    12600006
126100             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               12610006
126200             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                12620006
126300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 12630006
126600             PERFORM 4000-BUILD-INITIAL-PANEL                     12660006
126700                                                                  12670006
126800         WHEN DP020-NEXT-ACT-READ-MAP                             12680006
126900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         12690006
127000             PERFORM 2000-PROCESS-PANEL                           12700006
127100                                                                  12710006
127200         WHEN DP020-NEXT-ACT-RETURN                               12720006
127300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         12730006
127400             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               12740006
127700             IF CN015-FUNCTION = PC-A                             12770006
127800                 EVALUATE TRUE                                    12780006
127900                     WHEN ASC-SET-NO-SET-CSR                      12790008
128000                         MOVE SPACES            TO DK-SET-YEAR    12800009
128100                         MOVE SPACES            TO DK-SET-SHRTNM  12810009
128500                     WHEN ASC-SET-YR-SHRTNM-CSR                   12850008
128600                         MOVE CN015-SET-YEAR    TO DK-SET-YEAR    12860009
128700                         MOVE CN015-SHORT-NAME  TO DK-SET-SHRTNM  12870010
128800                 END-EVALUATE                                     12880006
128900                 PERFORM 2050-DELETE-LIST-QUEUE                   12890006
129000                 PERFORM 4000-BUILD-INITIAL-PANEL                 12900006
129100                 PERFORM 3200-RESET-ATTRIBUTES                    12910006
129200             ELSE                                                 12920006
129300                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP             12930006
129400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12940006
129500             END-IF                                               12950006
129600                                                                  12960006
129700         WHEN OTHER                                               12970006
129800             SET DP013-LOGIC-ABEND TO TRUE                        12980006
129900             SET DP013-NO-ROLLBACK TO TRUE                        12990006
130000             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    13000006
130100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    13010006
130200                                   TO DP013-MESSAGE-TEXT(1)       13020006
130300             PERFORM DP013-0000-PROCESS-ABEND                     13030006
130400     END-EVALUATE.                                                13040006
130500                                                                  13050006
130600*----------------------------------------------------------------*13060001
130700* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *13070001
130800* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *13080001
130900*----------------------------------------------------------------*13090001
131000 1100-PROCESS-INTER-APPL-COMM.                                    13100006
131100                                                                  13110006
131200     SET PS-COMMAREA-VALID         TO TRUE.                       13120006
131300     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     13130006
131400                                                                  13140006
131500     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          13150006
131510         IF  CN015-SET-YEAR    >  SPACES  AND                     13151010
131520             CN015-SHORT-NAME  >  SPACES                          13152010
131600             SET ASC-SET-YR-SHRTNM-CSR TO TRUE                    13160010
131610         ELSE                                                     13161010
131700             SET ASC-SET-NO-SET-CSR    TO TRUE                    13170010
131710         END-IF                                                   13171010
131800         MOVE CN015-FUNCTION           TO ASC-FUNCTION            13180006
131900         MOVE CN015-SET-YEAR           TO ASC-CRIT-SET-YEAR       13190010
132000         MOVE CN015-SHORT-NAME         TO ASC-CRIT-SHORT-NAME     13200010
132100         MOVE CN015-SET-YEAR           TO ASC-SET-YEAR (1 1)      13210011
132200         MOVE CN015-SHORT-NAME         TO ASC-SHRTNM   (1 1)      13220011
132300     ELSE                                                         13230006
132310         IF  CN016-SET-YEAR    >  SPACES  AND                     13231010
132320             CN016-SHORT-NAME  >  SPACES                          13232010
132330             SET ASC-SET-YR-SHRTNM-CSR TO TRUE                    13233010
132340         ELSE                                                     13234010
132350             SET ASC-SET-NO-SET-CSR    TO TRUE                    13235010
132360         END-IF                                                   13236010
132400         MOVE CN016-FUNCTION           TO ASC-FUNCTION            13240006
132500         MOVE CN016-SET-YEAR           TO ASC-CRIT-SET-YEAR       13250010
132510         MOVE CN016-SHORT-NAME         TO ASC-CRIT-SHORT-NAME     13251010
132600     END-IF.                                                      13260006
132700                                                                  13270006
132800*----------------------------------------------------------------*13280001
132900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *13290001
133000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *13300001
133100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *13310001
133200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *13320001
133300* FUNCTION KEYS CAN GET THIS FAR.                                *13330001
133400*----------------------------------------------------------------*13340001
133500 2000-PROCESS-PANEL.                                              13350010
133600     EVALUATE TRUE                                                13360010
133700         WHEN DP020-SRC-AID = DP016-CLEAR                         13370010
133800             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                13380010
133900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13390010
134000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13400010
134100                                                                  13410010
134200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    13420010
134300             PERFORM 2050-DELETE-LIST-QUEUE                       13430010
134400             SET CN015-FUNCTION-NONE  TO TRUE                     13440010
134500             EVALUATE TRUE                                        13450010
134600                WHEN ASC-SET-NO-SET-CSR                           13460011
134700                     MOVE SPACES              TO DK-SET-YEAR      13470011
134800                     MOVE SPACES              TO DK-SET-SHRTNM    13480011
135200                WHEN ASC-SET-YR-SHRTNM-CSR                        13520011
135300                     MOVE ASC-CRIT-SET-YEAR   TO DK-SET-YEAR      13530011
135400                     MOVE ASC-CRIT-SHORT-NAME TO DK-SET-SHRTNM    13540011
135500             END-EVALUATE                                         13550010
135600             PERFORM 4000-BUILD-INITIAL-PANEL                     13560010
135700                                                                  13570010
135800         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   13580010
135900             PERFORM 2140-DESELECT-ALL-ITEMS                      13590010
136000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13600010
136100                                                                  13610010
136200         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  13620010
136300             PERFORM 2150-SELECT-ALL-ITEMS                        13630010
136400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 13640010
136500         WHEN OTHER                                               13650010
136600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 13660010
136700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   13670010
136800             IF  PS-NO-ERROR                                      13680010
136900                 SET DP030-CONTINUE-GO TO TRUE                    13690010
137000                 PERFORM 2100-CHECK-FUNCTION-KEY                  13700010
137100             ELSE                                                 13710010
137200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             13720010
137300                 SET DP030-OVERRIDE-GO TO TRUE                    13730010
137400             END-IF                                               13740010
137500     END-EVALUATE.                                                13750010
137600                                                                  13760010
137700*----------------------------------------------------------------*13770001
137800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *13780001
137900*----------------------------------------------------------------*13790001
138000 2050-DELETE-LIST-QUEUE.                                          13800010
138100                                                                  13810010
138200     EXEC CICS                                                    13820010
138300         DELETEQ TS                                               13830010
138400             QUEUE (ASC-LIST-QUEUE-NAME)                          13840010
138500             RESP  (PV-CICS-RESP)                                 13850010
138600     END-EXEC.                                                    13860010
138700                                                                  13870010
138800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       13880010
138900        (PV-CICS-RESP = DFHRESP(QIDERR))                          13890010
139000         CONTINUE                                                 13900010
139100     ELSE                                                         13910010
139200         SET DP013-CICS-ABEND      TO TRUE                        13920010
139300         SET DP013-NO-ROLLBACK     TO TRUE                        13930010
139400                                                                  13940010
139500         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         13950010
139600         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    13960010
139700                                   TO DP013-MESSAGE-TEXT (1)      13970010
139800         PERFORM DP013-0000-PROCESS-ABEND                         13980010
139900     END-IF.                                                      13990010
140000                                                                  14000010
140100     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       14010010
140200                                                                  14020010
140300*----------------------------------------------------------------*14030001
140400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*14040001
140500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *14050001
140600* CICS ARCHITECTURE API.                                         *14060001
140700*----------------------------------------------------------------*14070001
140800 2100-CHECK-FUNCTION-KEY.                                         14080011
140900                                                                  14090011
141000     EVALUATE TRUE                                                14100011
141100                                                                  14110011
142700* F15 - UPDATE SEASONAL SET (LOCAL-FUNC-01)                       14270042
142800         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              14280042
143100                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              14310011
143200                     SET ASC-USE-SELECTION-QUEUE TO TRUE          14320011
143300                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            14330011
143400                                TO CN016-NUMBER-OF-SELECTED-ITEMS 14340011
143500                     MOVE ASC-NUMBER-OF-TS-ITEMS                  14350011
143600                                      TO CN016-NUMBER-OF-TS-ITEMS 14360011
143700                     MOVE ASC-SEL-QUEUE-NAME                      14370011
143800                                         TO  CN016-SEL-QUEUE-NAME 14380011
144500                     SET CN016-UPD-TSEASET TO TRUE                14450011
144600                     PERFORM 5000-PREPARE-SEL-QUEUE               14460011
144700                 ELSE                                             14470011
144800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         14480011
144900                     SET DP030-OVERRIDE-GO TO TRUE                14490011
145000                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    14500011
145100                     SET DP020-MSG-FATAL   TO TRUE                14510011
145200                 END-IF                                           14520011
146000                                                                  14600011
156300                                                                  15630011
156400* F6 - FIRST PAGE                                                 15640011
156500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  15650011
156510             PERFORM 3200-RESET-ATTRIBUTES                        15651038
156600             MOVE +1               TO PV-TOP-ITEM                 15660011
156700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15670011
156800                                                                  15680011
156900* F7 - PREVIOUS PAGE                                              15690011
157000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   15700011
157010             PERFORM 3200-RESET-ATTRIBUTES                        15701038
157100             PERFORM 2110-BROWSE-BACKWARD                         15710011
157200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15720011
157300                                                                  15730011
157400* F8 - NEXT PAGE                                                  15740011
157500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   15750011
157510             PERFORM 3200-RESET-ATTRIBUTES                        15751038
157600             PERFORM 2120-BROWSE-FORWARD                          15760011
157700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 15770011
157800                                                                  15780011
157900* ENTER KEY                                                       15790011
158000         WHEN DP020-SRC-AID = DP016-ENTER                         15800011
158100             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   15810011
158200             IF  PS-ERROR                                         15820011
158300                 CONTINUE                                         15830011
158400             ELSE                                                 15840011
158500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             15850011
158600             END-IF                                               15860011
158700                                                                  15870011
158800         WHEN OTHER                                               15880011
158900             SET DP013-NO-ROLLBACK                                15890011
159000                 DP013-XCTL-DISPLAY-RESTART                       15900011
159100                 DP013-CICS-ABEND  TO TRUE                        15910011
159200             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    15920011
159300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      15930011
159400                                   TO DP013-MESSAGE-TEXT (1)      15940011
159500             PERFORM DP013-0000-PROCESS-ABEND                     15950011
159600     END-EVALUATE.                                                15960011
159700                                                                  15970011
159800******************************************************************15980001
159900** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **15990001
160000** INTER-APPLICATION COMMAREA.                                  **16000001
160100******************************************************************16010001
160200 2110-PREPARE-INTER-APPL-COMM.                                    16020011
160300                                                                  16030011
160400     INITIALIZE CN015-INTER-APPL-COMMAREA.                        16040011
160500                                                                  16050022
160600     MOVE ASC-FUNCTION             TO CN015-FUNCTION.             16060022
161300                                                                  16130011
161400*----------------------------------------------------------------*16140001
161500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *16150001
161600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *16160001
161700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *16170001
161800*    MESSAGE.                                                    *16180001
161900*----------------------------------------------------------------*16190001
162000 2110-BROWSE-BACKWARD.                                            16200011
162100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    16210011
162200         GIVING PV-TOP-ITEM.                                      16220011
162300                                                                  16230011
162400     IF  ((PV-TOP-ITEM < +1)                                      16240011
162500       OR (PV-TOP-ITEM = +1))                                     16250011
162600         MOVE +1                   TO PV-TOP-ITEM                 16260011
162700*        -- TOP OF LIST --                                        16270013
162800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            16280011
162900         SET DP020-MSG-INFORMATIONAL TO TRUE                      16290011
163000     END-IF.                                                      16300011
163100                                                                  16310011
163200*----------------------------------------------------------------*16320001
163300*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *16330001
163400*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *16340001
163500*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *16350001
163600*----------------------------------------------------------------*16360001
163700 2120-BROWSE-FORWARD.                                             16370011
163800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              16380011
163900         GIVING PV-TOP-ITEM.                                      16390011
164000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   16400011
164100         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             16410011
164200*        -- BOTTOM OF LIST --                                     16420014
164300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            16430011
164400         SET DP020-MSG-INFORMATIONAL TO TRUE                      16440011
164500     ELSE                                                         16450011
164600         COMPUTE PV-BOTTOM-ITEM =                                 16460011
164700             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 16470011
164800         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            16480011
164900*            -- BOTTOM OF LIST --                                 16490014
165000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            16500011
165100             SET DP020-MSG-INFORMATIONAL TO TRUE                  16510011
165200         END-IF                                                   16520011
165300     END-IF.                                                      16530011
165400                                                                  16540011
165500*----------------------------------------------------------------*16550001
165600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *16560001
165700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *16570001
165800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *16580001
165900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *16590001
166000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *16600001
166100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *16610001
166200*----------------------------------------------------------------*16620001
166300 2130-CHECK-FOR-JUMP-BROWSE.                                      16630011
166400     SET PS-NO-ERROR               TO TRUE.                       16640011
166500     IF (ASC-START-ITEM-REQUEST = SPACE)                          16650011
166600         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             16660011
166700     ELSE                                                         16670011
166800         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     16680011
166900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       16690011
167000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     16700011
167100         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  16710011
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         16721058
263455              USING DP010I-NUMERIC-EDIT-AREA                      16722058
167300                                                                  16730011
167400         IF  NOT DP010I-ERROR-DETECTED                            16740011
167500             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N16750011
167600             IF  ASC-START-ITEM-REQUEST-N > ZERO                  16760011
167700                 IF  ASC-START-ITEM-REQUEST-N >                   16770011
167800                                          ASC-NUMBER-OF-ITEMS-READ16780011
167900                     MOVE SPACE TO ASC-START-ITEM-REQUEST         16790011
168000                     COMPUTE PV-TOP-ITEM =                        16800011
168100                             ASC-NUMBER-OF-ITEMS-READ             16810011
168200                             - PC-ITEMS-PER-PANEL + 1             16820011
168300                     IF  PV-TOP-ITEM < +1                         16830011
168400                         MOVE +1   TO PV-TOP-ITEM                 16840011
168500                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 16850011
168600                         SET DP020-MSG-INFORMATIONAL TO TRUE      16860011
168700                     END-IF                                       16870011
168800                 ELSE                                             16880011
168900                     MOVE ASC-START-ITEM-REQUEST-N                16890011
169000                                   TO PV-TOP-ITEM                 16900011
169100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      16910011
169200                     COMPUTE PV-BOTTOM-ITEM =                     16920011
169300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     16930011
169400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ16940011
169500*                        -- BOTTOM OF LIST --                     16950015
169600                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 16960011
169700                         SET DP020-MSG-INFORMATIONAL TO TRUE      16970011
169800                     END-IF                                       16980011
169900                 END-IF                                           16990011
170000             ELSE                                                 17000011
170100*                --- VALUE OUT OF RANGE ----                      17010016
170200                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         17020011
170300                 MOVE -1              TO ASTRTITL                 17030011
170400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              17040011
170500                 MOVE DP015-REVERSE   TO ASTRTITH                 17050011
170600                 MOVE DP015-RED       TO ASTRTITC                 17060011
170700                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           17070011
170800                 SET DP020-MSG-FATAL  TO TRUE                     17080011
170900                 SET PS-ERROR         TO TRUE                     17090011
171000             END-IF                                               17100011
171100         ELSE                                                     17110011
171200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            17120011
171300             MOVE -1               TO ASTRTITL                    17130011
171400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  17140011
171500             MOVE DP015-REVERSE    TO ASTRTITH                    17150011
171600             MOVE DP015-RED        TO ASTRTITC                    17160011
171700             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               17170011
171800             SET DP020-MSG-FATAL   TO TRUE                        17180011
171900             SET PS-ERROR          TO TRUE                        17190011
172000         END-IF                                                   17200011
172100     END-IF.                                                      17210011
172200                                                                  17220011
172300*----------------------------------------------------------------*17230001
172400*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *17240001
172500*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *17250001
172600*----------------------------------------------------------------*17260001
172700 2140-DESELECT-ALL-ITEMS.                                         17270011
172800     MOVE +1                       TO ASC-BLK-SUB.                17280011
172900                                                                  17290011
173000     PERFORM 2141-CLEAR-SELECTED-INDS                             17300011
173100         VARYING ASC-ITEM-SUB                                     17310011
173200         FROM 1 BY 1                                              17320011
173300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17330011
173400                                                                  17340011
173500     ADD +1                        TO ASC-BLK-SUB.                17350011
173600                                                                  17360011
173700     PERFORM 2141-CLEAR-SELECTED-INDS                             17370011
173800         VARYING ASC-ITEM-SUB                                     17380011
173900         FROM 1 BY 1                                              17390011
174000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17400011
174100                                                                  17410011
174200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17420011
174300                                   TO PV-LIST-ITEM-NUMBER.        17430011
174400                                                                  17440011
174500     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17450011
174600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    17460011
174700                                                                  17470011
174800     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            17480011
174900         MOVE +1                   TO ASC-BLK-SUB                 17490011
175000                                                                  17500011
175100         PERFORM 5100-WRITE-TEMP-STORAGE                          17510011
175200         MOVE +2                   TO ASC-BLK-SUB                 17520011
175300         PERFORM 5100-WRITE-TEMP-STORAGE                          17530011
175400         MOVE +1                   TO ASC-BLK-SUB                 17540011
175500         MOVE +1                   TO PV-BLOCK-NUMBER             17550011
175600     END-IF.                                                      17560011
175700                                                                  17570011
175800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     17580011
175900        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      17590011
176000         MOVE +1                   TO ASC-BLK-SUB                 17600011
176100                                                                  17610011
176200         PERFORM 5100-WRITE-TEMP-STORAGE                          17620011
176300         MOVE +2  TO ASC-BLK-SUB                                  17630011
176400         PERFORM 5100-WRITE-TEMP-STORAGE                          17640011
176500         MOVE +1  TO ASC-BLK-SUB                                  17650011
176600         MOVE +1  TO PV-BLOCK-NUMBER                              17660011
176700                                                                  17670011
176800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         17680011
176900             PV-FIRST-BLOCK-IN-ARRAY - 1                          17690011
177000                                                                  17700011
177100         PERFORM                                                  17710011
177200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       17720011
177300                                                                  17730011
177400             PERFORM 4410-READ-TEMP-STORAGE                       17740011
177500                                                                  17750011
177600             PERFORM 2141-CLEAR-SELECTED-INDS                     17760011
177700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 17770011
177800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17780011
177900                                                                  17790011
178000             PERFORM 5100-WRITE-TEMP-STORAGE                      17800011
178100                                                                  17810011
178200             ADD +1                TO PV-BLOCK-NUMBER             17820011
178300                                                                  17830011
178400         END-PERFORM                                              17840011
178500                                                                  17850011
178600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         17860011
178700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     17870011
178800                                                                  17880011
178900         PERFORM                                                  17890011
179000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       17900011
179100                   ASC-HIGHEST-BLOCK-WRITTEN                      17910011
179200                                                                  17920011
179300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          17930011
179400                                   TO PV-BLOCK-NUMBER             17940011
179500                                                                  17950011
179600             PERFORM 4410-READ-TEMP-STORAGE                       17960011
179700                                                                  17970011
179800             PERFORM 2141-CLEAR-SELECTED-INDS                     17980011
179900                 VARYING ASC-ITEM-SUB                             17990011
180000                 FROM 1 BY 1                                      18000011
180100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18010011
180200                                                                  18020011
180300             PERFORM 5100-WRITE-TEMP-STORAGE                      18030011
180400                                                                  18040011
180500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18050011
180600                                                                  18060011
180700         END-PERFORM                                              18070011
180800                                                                  18080011
180900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18090011
181000                                   TO PV-BLOCK-NUMBER             18100011
181100                                                                  18110011
181200         PERFORM 4410-READ-TEMP-STORAGE                           18120011
181300     END-IF.                                                      18130011
181400                                                                  18140011
181500                                                                  18150011
181600     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 18160011
181700     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  18170011
181800     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    18180011
181900                                                                  18190011
182000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        18200011
182100                                                                  18210011
182200*----------------------------------------------------------------*18220001
182300*    MARK EACH ITEM AS BEING NOT SELECTED.                       *18230001
182400*----------------------------------------------------------------*18240001
182500 2141-CLEAR-SELECTED-INDS.                                        18250011
182600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           18260011
182700             NOT EQUAL ZERO                                       18270011
182800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18280011
182900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18290011
183000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    18300011
183100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          18310011
183200         END-IF                                                   18320011
183300     END-IF.                                                      18330011
183400                                                                  18340011
183500*----------------------------------------------------------------*18350001
183600*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *18360001
183700*  FOR ALL ITEMS.                                                *18370001
183800*----------------------------------------------------------------*18380001
183900 2150-SELECT-ALL-ITEMS.                                           18390011
184000     MOVE +1                       TO ASC-BLK-SUB.                18400011
184100                                                                  18410011
184200     PERFORM 2151-SET-SELECTED-INDS                               18420011
184300         VARYING ASC-ITEM-SUB                                     18430011
184400         FROM 1 BY 1                                              18440011
184500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18450011
184600                                                                  18460011
184700     ADD +1                        TO ASC-BLK-SUB.                18470011
184800                                                                  18480011
184900     PERFORM 2151-SET-SELECTED-INDS                               18490011
185000         VARYING ASC-ITEM-SUB                                     18500011
185100         FROM 1 BY 1                                              18510011
185200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18520011
185300                                                                  18530011
185400     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      18540011
185500                                                                  18550011
185600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18560011
185700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    18570011
185800                                                                  18580011
185900     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            18590011
186000         MOVE +1                   TO ASC-BLK-SUB                 18600011
186100                                                                  18610011
186200         PERFORM 5100-WRITE-TEMP-STORAGE                          18620011
186300         MOVE +2                   TO ASC-BLK-SUB                 18630011
186400         PERFORM 5100-WRITE-TEMP-STORAGE                          18640011
186500         MOVE +1                   TO ASC-BLK-SUB                 18650011
186600         MOVE +1                   TO PV-BLOCK-NUMBER             18660011
186700     END-IF.                                                      18670011
186800     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     18680011
186900        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    18690011
187000         MOVE +1                   TO ASC-BLK-SUB                 18700011
187100                                                                  18710011
187200         PERFORM 5100-WRITE-TEMP-STORAGE                          18720011
187300                                                                  18730011
187400         MOVE +1                   TO PV-BLOCK-NUMBER             18740011
187500                                                                  18750011
187600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18760011
187700             PV-FIRST-BLOCK-IN-ARRAY - 1                          18770011
187800                                                                  18780011
187900         PERFORM                                                  18790011
188000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       18800011
188100                                                                  18810011
188200             PERFORM 4410-READ-TEMP-STORAGE                       18820011
188300                                                                  18830011
188400             PERFORM 2151-SET-SELECTED-INDS                       18840011
188500                 VARYING ASC-ITEM-SUB                             18850011
188600                 FROM 1 BY 1                                      18860011
188700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18870011
188800                                                                  18880011
188900             PERFORM 5100-WRITE-TEMP-STORAGE                      18890011
189000                                                                  18900011
189100             ADD +1                TO PV-BLOCK-NUMBER             18910011
189200                                                                  18920011
189300         END-PERFORM                                              18930011
189400                                                                  18940011
189500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18950011
189600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18960011
189700                                                                  18970011
189800         PERFORM                                                  18980011
189900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18990011
190000                   ASC-HIGHEST-BLOCK-WRITTEN                      19000011
190100                                                                  19010011
190200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19020011
190300                                   TO PV-BLOCK-NUMBER             19030011
190400                                                                  19040011
190500             PERFORM 4410-READ-TEMP-STORAGE                       19050011
190600                                                                  19060011
190700             PERFORM 2151-SET-SELECTED-INDS                       19070011
190800                 VARYING ASC-ITEM-SUB                             19080011
190900                 FROM 1 BY 1                                      19090011
191000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19100011
191100                                                                  19110011
191200             PERFORM 5100-WRITE-TEMP-STORAGE                      19120011
191300                                                                  19130011
191400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19140011
191500                                                                  19150011
191600         END-PERFORM                                              19160011
191700                                                                  19170011
191800         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         19180011
191900                                                                  19190011
192000         PERFORM 4410-READ-TEMP-STORAGE                           19200011
192100     END-IF.                                                      19210011
192200                                                                  19220011
192300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             19230011
192400                       ASC-NUMBER-OF-SELECTED-ITEMS.              19240011
192500                                                                  19250011
192600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        19260011
192700                                                                  19270011
192800*----------------------------------------------------------------*19280001
192900*    MARK EACH ITEM AS BEING SELECTED.                           *19290001
193000*----------------------------------------------------------------*19300001
193100 2151-SET-SELECTED-INDS.                                          19310011
193200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           19320011
193300             NOT EQUAL ZERO                                       19330011
193400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             19340011
193500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             19350011
193600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        19360011
193700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  19370011
193800                               TO  TRUE                           19380011
193900         END-IF                                                   19390011
194000     END-IF.                                                      19400011
194100                                                                  19410011
194200******************************************************************19420001
194300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **19430001
194400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **19440001
194500******************************************************************19450001
194600 2200-MOVE-SCREEN-TO-COMMAREA.                                    19460011
194700                                                                  19470011
194800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             19480011
194900     MOVE +1                       TO PV-SUB.                     19490011
195000                                                                  19500011
195100     PERFORM 3100-SET-SUBSCRIPTS.                                 19510011
195200                                                                  19520011
195300     IF  ASTRTITL > ZERO                                          19530011
195400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          19540011
195500     ELSE                                                         19550011
195600         IF  ASTRTITF = DP015-ERASE-EOF                           19560011
195700             INITIALIZE ASC-START-ITEM-REQUEST                    19570011
195800         END-IF                                                   19580011
195900     END-IF.                                                      19590011
196000                                                                  19600011
196100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          19610011
196200         VARYING PV-SUB FROM 1 BY 1                               19620011
196300         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      19630011
196400                                                                  19640011
196500******************************************************************19650001
196600** MOVE THE ENTERABLE FIELDS OF EACH LIST LINE INTO THE COMMAREA**19660001
196700******************************************************************19670001
196800 2210-MOVE-LINES-TO-COMMAREA.                                     19680011
196900     IF  MR-SELECTL (PV-SUB) > ZERO                               19690011
197000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             19700011
197100         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        19710011
197200                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 19720011
197300     ELSE                                                         19730011
197400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                19740011
197500                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     19750011
197600                 MOVE SPACE  TO ASC-TEMP-SELECTED-SW              19760011
197700                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 19770011
197800         END-IF                                                   19780011
197900     END-IF.                                                      19790011
198000                                                                  19800011
198100     ADD +1                        TO ASC-ITEM-SUB.               19810011
198200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19820011
198300         ADD +1                    TO ASC-BLK-SUB                 19830011
198400         MOVE +1                   TO ASC-ITEM-SUB                19840011
198500     END-IF.                                                      19850011
198600                                                                  19860011
198700******************************************************************19870001
198800** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **19880001
198900** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **19890001
199000******************************************************************19900001
199100 3000-EDIT-DATA-IN-COMMAREA.                                      19910011
199200     PERFORM 3200-RESET-ATTRIBUTES.                               19920011
199300     SET PS-NO-ERROR               TO TRUE.                       19930011
199400     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     19940011
199500                                                                  19950011
199600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              19960001
199700* EDITTING IS DONE FROM THE BOTTOM UP.                            19970001
199800                                                                  19980011
199900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       19990011
200000         ASC-ITEMS-DISPLAYED - 1.                                 20000011
200100     PERFORM 3100-SET-SUBSCRIPTS.                                 20010011
200200                                                                  20020011
200300      IF  PS-NO-ERROR                                             20030011
200400          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       20040011
200500      END-IF.                                                     20050011
200600                                                                  20060011
200700     IF  PS-NO-ERROR                                              20070011
200800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        20080011
200900     END-IF.                                                      20090011
201000                                                                  20100011
201100     IF  ((PS-NO-ERROR)                                           20110011
201200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   20120011
201300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    20130011
201400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  20140011
201500     END-IF.                                                      20150011
201600                                                                  20160011
201700*----------------------------------------------------------------*20170001
201800* 3005-EDIT-COMMAREA-BLOCKS                                      *20180001
201900*----------------------------------------------------------------*20190001
202000 3005-EDIT-COMMAREA-BLOCKS.                                       20200011
202100     MOVE +1                       TO PV-BLOCK-NUMBER.            20210011
202200     MOVE +1                       TO ASC-BLK-SUB.                20220011
202300     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               20230011
202400                                                                  20240011
202500     COMPUTE PV-BLOCK-NUMBER  =                                   20250011
202600             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            20260011
202700             PC-ITEMS-PER-PANEL.                                  20270011
202800                                                                  20280011
202900     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          20290011
203000                                                                  20300011
203100     PERFORM                                                      20310011
203200        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         20320011
203300           OR PS-ERROR                                            20330011
203400           OR PS-BLOCK-ERROR                                      20340011
203500                                                                  20350011
203600              COMPUTE PV-ITEMS-HOLD  =                            20360011
203700                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       20370011
203800                      PC-ITEMS-PER-PANEL - 1                      20380011
203900                                                                  20390011
204000               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     20400011
204100                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             20410011
204200                       FROM  PV-ITEMS-HOLD                        20420011
204300                     GIVING  PV-ITEMS-DIFF                        20430011
204400                   SUBTRACT  PV-ITEMS-DIFF                        20440011
204500                       FROM  PC-ITEMS-PER-PANEL                   20450011
204600                     GIVING  PV-ITEMS-HOLD                        20460011
204700                       MOVE  PV-ITEMS-HOLD TO PV-SUB              20470011
204800                                              ASC-ITEM-SUB        20480011
204900                                              ASC-ITEMS-DISPLAYED 20490011
205000               ELSE                                               20500011
205100                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            20510011
205200                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      20520011
205300               END-IF                                             20530011
205400                                                                  20540011
205500               PERFORM 3300-EDIT-SELECTIONS                       20550011
205600                       VARYING PV-SUB                             20560011
205700                          FROM PV-SUB BY -1                       20570011
205800                          UNTIL PV-SUB < +1                       20580011
205900                                                                  20590011
206000               MOVE +1               TO ASC-BLK-SUB               20600011
206100                                                                  20610011
206200               PERFORM 5105-REWRITE-ASC-LISTQ                     20620011
206300                                                                  20630011
206400               MOVE +1                TO ASC-BLK-SUB              20640011
206500                                                                  20650011
206600               IF  PS-BLOCK-ERROR                                 20660011
206700                   SET  PS-ERROR     TO TRUE                      20670011
206800                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      20680011
206900                                     TO PV-TOP-ITEM               20690011
207000               ELSE                                               20700011
207100                   ADD  +1           TO PV-BLOCK-NUMBER           20710011
207200                   IF  PV-BLOCK-NUMBER >                          20720011
207300                       ASC-HIGHEST-BLOCK-WRITTEN                  20730011
207400                       MOVE +2       TO ASC-BLK-SUB               20740011
207500                       PERFORM 4410-READ-TEMP-STORAGE             20750011
207600                       MOVE +1       TO ASC-BLK-SUB               20760011
207700                   ELSE                                           20770011
207800                       PERFORM 4410-READ-TEMP-STORAGE             20780011
207900                       ADD  +1        TO PV-BLOCK-NUMBER          20790011
208000                       MOVE +2        TO ASC-BLK-SUB              20800011
208100                       PERFORM 4410-READ-TEMP-STORAGE             20810011
208200                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          20820011
208300                       MOVE +1        TO ASC-BLK-SUB              20830011
208400               END-IF                                             20840011
208500           END-IF                                                 20850011
208600     END-PERFORM.                                                 20860011
208700                                                                  20870011
208800     IF  (PV-ORIGINAL-BLOCK  = +1   AND                           20880011
208900          ASC-LIST-ITEM-NUMBER (1 1) = 1)  OR                     20890011
209000         PS-ERROR                   OR                            20900011
209100         PS-BLOCK-ERROR                                           20910011
209200             CONTINUE                                             20920011
209300     ELSE                                                         20930011
209400         MOVE +1                 TO PV-BLOCK-NUMBER               20940011
209500         MOVE +1                 TO ASC-BLK-SUB                   20950011
209600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20960011
209700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           20970011
209800         PERFORM 4410-READ-TEMP-STORAGE                           20980011
209900                                                                  20990011
210000         PERFORM                                                  21000011
210100            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             21010011
210200               OR PS-ERROR                                        21020011
210300               OR PS-BLOCK-ERROR                                  21030011
210400                                                                  21040011
210500                  COMPUTE PV-ITEMS-HOLD  =                        21050011
210600                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   21060011
210700                          PC-ITEMS-PER-PANEL - 1                  21070011
210800                                                                  21080011
210900                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    21090011
211000                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          21100011
211100                          FROM  PV-ITEMS-HOLD                     21110011
211200                        GIVING  PV-ITEMS-DIFF                     21120011
211300                      SUBTRACT  PV-ITEMS-DIFF                     21130011
211400                          FROM  PC-ITEMS-PER-PANEL                21140011
211500                        GIVING  PV-ITEMS-HOLD                     21150011
211600                          MOVE  PV-ITEMS-HOLD TO PV-SUB           21160011
211700                                                 ASC-ITEM-SUB     21170011
211800                                              ASC-ITEMS-DISPLAYED 21180011
211900                  ELSE                                            21190011
212000                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         21200011
212100                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   21210011
212200                  END-IF                                          21220011
212300                                                                  21230011
212400                  PERFORM 3300-EDIT-SELECTIONS                    21240011
212500                          VARYING PV-SUB                          21250011
212600                             FROM PV-SUB BY -1                    21260011
212700                            UNTIL PV-SUB < +1                     21270011
212800                                                                  21280011
212900                  MOVE +1               TO ASC-BLK-SUB            21290011
213000                                                                  21300011
213100                  PERFORM 5105-REWRITE-ASC-LISTQ                  21310011
213200                                                                  21320011
213300                  MOVE +1                TO ASC-BLK-SUB           21330011
213400                                                                  21340011
213500                  IF  PS-BLOCK-ERROR                              21350011
213600                      SET  PS-ERROR     TO TRUE                   21360011
213700                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   21370011
213800                                        TO PV-TOP-ITEM            21380011
213900                  ELSE                                            21390011
214000                      ADD  +1            TO PV-BLOCK-NUMBER       21400011
214100                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     21410011
214200                          MOVE +2        TO ASC-BLK-SUB           21420011
214300                          PERFORM 4410-READ-TEMP-STORAGE          21430011
214400                          MOVE +1        TO ASC-BLK-SUB           21440011
214500                      ELSE                                        21450011
214600                          PERFORM 4410-READ-TEMP-STORAGE          21460011
214700                          ADD  +1        TO PV-BLOCK-NUMBER       21470011
214800                          MOVE +2        TO ASC-BLK-SUB           21480011
214900                          PERFORM 4410-READ-TEMP-STORAGE          21490011
215000                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       21500011
215100                          MOVE +1        TO ASC-BLK-SUB           21510011
215200                      END-IF                                      21520011
215300                  END-IF                                          21530011
215400     END-PERFORM.                                                 21540011
215500     MOVE +0 TO PV-ITEMS-HOLD.                                    21550011
215600                                                                  21560011
215700*----------------------------------------------------------------*21570001
215800*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *21580001
215900*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*21590001
216000*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *21600001
216100*                                                                *21610001
216200*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *21620001
216300*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *21630001
216400*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *21640001
216500*    US IN THE 2ND BLOCK OF THE ARRAY.                           *21650001
216600*----------------------------------------------------------------*21660001
216700 3100-SET-SUBSCRIPTS.                                             21670018
216800     COMPUTE ASC-ITEM-SUB =                                       21680018
216900         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        21690018
217000                                                                  21700018
217100     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         21710018
217200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21720018
217300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               21730018
217400     ELSE                                                         21740018
217500         MOVE +1                     TO ASC-BLK-SUB               21750018
217600     END-IF.                                                      21760018
217700                                                                  21770018
217800******************************************************************21780001
217900** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **21790001
218000******************************************************************21800001
218100 3200-RESET-ATTRIBUTES.                                           21810010
218200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   21820010
218300     MOVE DP015-GREEN              TO ASTRTITC.                   21830010
218400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   21840010
218500                                                                  21850010
218600     PERFORM                                                      21860010
218700         VARYING PV-SUB                                           21870010
218800         FROM 1 BY 1                                              21880010
218900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        21890010
219000         MOVE DP015-UNP-ALP-NOR-OFF                               21900010
219100                                   TO MR-SELECTA   (PV-SUB)       21910035
219200         MOVE DP015-GREEN          TO MR-SELECTC   (PV-SUB)       21920035
219300         MOVE DP015-UNDERLINE      TO MR-SELECTH   (PV-SUB)       21930035
219310         MOVE DP015-BLUE           TO MR-DIVERTC   (PV-SUB)       21931035
219320                                      MR-END-DATEC (PV-SUB)       21932035
219400     END-PERFORM.                                                 21940010
219500                                                                  21950010
219600******************************************************************21960001
219700** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **21970001
219800** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **21980001
219900** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **21990001
220000** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **22000001
220100******************************************************************22010001
220200 3300-EDIT-SELECTIONS.                                            22020019
220300     EVALUATE TRUE                                                22030019
220400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     22040019
220500             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         22050019
220600                 CONTINUE                                         22060019
220700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         22070019
220800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        22080019
220900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   22090019
221000                 MOVE ASC-TEMP-SELECTED-SW                        22100019
221100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22110019
221200                                TO ASC-SELECTED-SW                22120019
221300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22130019
221400             END-IF                                               22140019
221500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     22150019
221600                 = SPACE                                          22160019
221700             EVALUATE TRUE                                        22170019
221800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       22180019
221900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS22190019
222000                     MOVE SPACE TO ASC-SELECTED-SW                22200019
222100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22210019
222200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        22220019
222300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    22230019
222400                     MOVE SPACE TO ASC-SELECTED-SW                22240019
222500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22250019
222600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          22260019
222700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      22270019
222800                     MOVE SPACE TO ASC-SELECTED-SW                22280019
222900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22290019
223000             END-EVALUATE                                         22300019
223100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           22310019
223200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22320019
223300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22330019
223400             END-IF                                               22340019
223500             PERFORM 3310-EDIT-RANGE                              22350019
223600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             22360019
223700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22370019
223800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    22380019
223900             END-IF                                               22390019
224000             PERFORM 3310-EDIT-RANGE                              22400019
224100         WHEN OTHER                                               22410019
224200             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           22420019
224300             SET DP020-MSG-FATAL    TO TRUE                       22430019
224400             MOVE -1                TO ASTRTITL                   22440019
224500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  22450019
224600             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        22460019
224700             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        22470019
224800             SET PS-ERROR TO TRUE                                 22480019
224900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            22490019
225000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     22500019
225100                 MOVE SPACE         TO ASC-SELECTED-SW            22510019
225200                                        (ASC-BLK-SUB ASC-ITEM-SUB)22520019
225300             END-IF                                               22530019
225400     END-EVALUATE.                                                22540019
225500                                                                  22550019
225600     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 22560019
225700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               22570019
225800     IF  ASC-ITEM-SUB < 1                                         22580019
225900         SUBTRACT +1 FROM ASC-BLK-SUB                             22590019
226000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                22600019
226100     END-IF.                                                      22610019
226200                                                                  22620019
226300******************************************************************22630001
226400** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **22640001
226500** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **22650001
226600** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**22660001
226700** THE ENDING.                                                  **22670001
226800******************************************************************22680001
226900 3310-EDIT-RANGE.                                                 22690019
227000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                22700019
227100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   22710019
227200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)22720019
227300                                   TO ASC-SELECTED-SW             22730019
227400                                        (ASC-BLK-SUB ASC-ITEM-SUB)22740019
227500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 22750019
227600         ELSE                                                     22760019
227700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     22770019
227800                 CONTINUE                                         22780019
227900             ELSE                                                 22790019
228000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        22800019
228100                 MOVE PC-TSYMSG-00054                             22810019
228200                                   TO DP020-MSG-NUMBER            22820019
228300                 SET DP020-MSG-FATAL                              22830019
228400                                   TO TRUE                        22840019
228500                 MOVE -1           TO ASTRTITL                    22850019
228600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              22860019
228700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         22870019
228800                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      22880019
228900                 SET PS-ERROR      TO TRUE                        22890019
229000             END-IF                                               22900019
229100         END-IF                                                   22910019
229200     ELSE                                                         22920019
229300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22930019
229400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22940019
229500                                   TO ASC-SELECTED-SW             22950019
229600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   22960019
229700             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   22970019
229800         ELSE                                                     22980019
229900             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       22990019
230000                 CONTINUE                                         23000019
230100             ELSE                                                 23010019
230200*                -- ONLY ONE END-OF-RANGE ALLOWED --              23020001
230300                 MOVE PC-TSYMSG-00055                             23030019
230400                                   TO DP020-MSG-NUMBER            23040019
230500                 SET DP020-MSG-FATAL                              23050019
230600                                   TO TRUE                        23060019
230700                 MOVE -1           TO ASTRTITL                    23070019
230800                 SET DP030-SET-CURSOR-APPL-1                      23080019
230900                                   TO TRUE                        23090019
231000                 SET PS-ERROR      TO TRUE                        23100019
231100             END-IF                                               23110019
231200         END-IF                                                   23120019
231300     END-IF.                                                      23130019
231400                                                                  23140019
231500******************************************************************23150001
231600** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **23160001
231700** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **23170001
231800******************************************************************23180001
231900 3400-CHECK-RANGE-SEQUENCE.                                       23190019
232000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23200019
232100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      23210019
232200       AND  ASC-START-OF-SELECTED-RANGE >                         23220019
232300                                         ASC-END-OF-SELECTED-RANGE23230019
232400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                23240021
232500         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 23250019
232600         SET DP020-MSG-FATAL TO TRUE                              23260019
232700         SET PS-ERROR TO TRUE                                     23270019
232800         PERFORM 3410-POSITION-AT-ERROR                           23280019
232900     END-IF.                                                      23290019
233000                                                                  23300019
233100******************************************************************23310001
233200** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **23320001
233300** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **23330001
233400** SHOULD BE POSITIONED ON A RANGE ERROR.                       **23340001
233500******************************************************************23350001
233600 3410-POSITION-AT-ERROR.                                          23360019
233700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       23370019
233800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23380019
233900                    - PV-TOP-ITEM + 1.                            23390019
234000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23400019
234100         CONTINUE                                                 23410019
234200     ELSE                                                         23420019
234300         MOVE -1                   TO MR-SELECTL (PV-SUB)         23430019
234400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23440019
234500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         23450019
234600     END-IF.                                                      23460019
234700                                                                  23470019
234800     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23480019
234900                    - PV-TOP-ITEM + 1.                            23490019
235000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23500019
235100         CONTINUE                                                 23510019
235200     ELSE                                                         23520019
235300         MOVE -1                   TO MR-SELECTL (PV-SUB)         23530019
235400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23540019
235500         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         23550019
235600     END-IF.                                                      23560019
235700                                                                  23570019
235800*----------------------------------------------------------------*23580001
235900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *23590001
236000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *23600001
236100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *23610001
236200*----------------------------------------------------------------*23620001
236300 3500-MARK-RANGE-AS-SELECTED.                                     23630019
236400     MOVE +1                       TO  ASC-BLK-SUB.               23640019
236500     PERFORM 3510-MARK-SELECTED-INDS                              23650019
236600         VARYING ASC-ITEM-SUB                                     23660019
236700         FROM 1 BY 1                                              23670019
236800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 23680019
236900                                                                  23690019
237000     ADD +1                        TO ASC-BLK-SUB.                23700019
237100     PERFORM 3510-MARK-SELECTED-INDS                              23710019
237200         VARYING ASC-ITEM-SUB                                     23720019
237300         FROM 1 BY 1                                              23730019
237400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 23740019
237500                                                                  23750019
237600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               23760019
237700                                   TO  PV-LIST-ITEM-NUMBER.       23770019
237800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            23780019
237900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         23790019
238000               PC-ITEMS-PER-PANEL).                               23800019
238100                                                                  23810019
238200     MOVE ASC-START-OF-SELECTED-RANGE                             23820019
238300                                   TO PV-START-OF-SELECTED-RANGE. 23830019
238400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            23840019
238500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  23850019
238600               PC-ITEMS-PER-PANEL).                               23860019
238700                                                                  23870019
238800     MOVE ASC-END-OF-SELECTED-RANGE                               23880019
238900                                   TO  PV-END-OF-SELECTED-RANGE.  23890019
239000     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             23900019
239100         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    23910019
239200               PC-ITEMS-PER-PANEL).                               23920019
239300     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             23930019
239400         PV-FIRST-BLOCK-IN-ARRAY + 1.                             23940019
239500                                                                  23950019
239600     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    23960019
239700        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        23970019
239800         MOVE +1                   TO ASC-BLK-SUB                 23980019
239900         PERFORM 5100-WRITE-TEMP-STORAGE                          23990019
240000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         24000019
240100             PV-FIRST-BLOCK-IN-ARRAY - 1                          24010019
240200                                                                  24020019
240300         PERFORM                                                  24030019
240400             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      24040019
240500                   PV-PREV-BLOCK-IN-ARRAY                         24050019
240600             MOVE PV-FIRST-BLOCK-IN-RANGE                         24060019
240700                                   TO PV-BLOCK-NUMBER             24070019
240800             PERFORM 4410-READ-TEMP-STORAGE                       24080019
240900             PERFORM 3510-MARK-SELECTED-INDS                      24090019
241000                 VARYING ASC-ITEM-SUB                             24100019
241100                 FROM 1 BY 1                                      24110019
241200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24120019
241300             PERFORM 5100-WRITE-TEMP-STORAGE                      24130019
241400             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     24140019
241500         END-PERFORM                                              24150019
241600                                                                  24160019
241700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         24170019
241800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     24180019
241900         PERFORM                                                  24190019
242000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       24200019
242100                   PV-LAST-BLOCK-IN-RANGE                         24210019
242200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          24220019
242300                                   TO PV-BLOCK-NUMBER             24230019
242400             PERFORM 4410-READ-TEMP-STORAGE                       24240019
242500             PERFORM 3510-MARK-SELECTED-INDS                      24250019
242600                 VARYING ASC-ITEM-SUB                             24260019
242700                 FROM 1 BY 1                                      24270019
242800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          24280019
242900             PERFORM 5100-WRITE-TEMP-STORAGE                      24290019
243000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      24300019
243100         END-PERFORM                                              24310019
243200                                                                  24320019
243300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             24330019
243400                                   TO PV-BLOCK-NUMBER             24340019
243500         PERFORM 4410-READ-TEMP-STORAGE                           24350019
243600     END-IF.                                                      24360019
243700                                                                  24370019
243800     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 24380019
243900                                      ASC-END-OF-SELECTED-RANGE.  24390019
244000                                                                  24400019
244100*----------------------------------------------------------------*24410001
244200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *24420001
244300*----------------------------------------------------------------*24430001
244400 3510-MARK-SELECTED-INDS.                                         24440019
244500     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         24450019
244600                                ASC-ITEM-SUB) >                   24460019
244700         ASC-START-OF-SELECTED-RANGE)                             24470019
244800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         24480019
244900                                ASC-ITEM-SUB) =                   24490019
245000         ASC-START-OF-SELECTED-RANGE)                             24500019
245100                                                                  24510019
245200         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     24520019
245300                                    ASC-ITEM-SUB) <               24530019
245400             ASC-END-OF-SELECTED-RANGE)                           24540019
245500         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     24550019
245600                                    ASC-ITEM-SUB) =               24560019
245700             ASC-END-OF-SELECTED-RANGE)                           24570019
245800                                                                  24580019
245900             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          24590019
246000                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   24600019
246100                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   24610019
246200                               TO TRUE                            24620019
246300                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              24630019
246400                               TO TRUE                            24640019
246500                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    24650019
246600             END-IF                                               24660019
246700         END-IF                                                   24670019
246800     END-IF.                                                      24680019
246900                                                                  24690019
247000*----------------------------------------------------------------*24700001
247100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *24710001
247200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *24720001
247300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *24730001
247400*    DISPLAY THE PANEL TO USER.                                  *24740001
247500*----------------------------------------------------------------*24750001
247600 4000-BUILD-INITIAL-PANEL.                                        24760006
247700     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            24770006
247800                                 ASC-BLOCK-ENTRIES (2).           24780006
247900     MOVE +1                   TO ASC-BLK-SUB.                    24790006
248000     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           24800006
248100                                                                  24810006
248200     MOVE +0                 TO ASC-ITEM-SUB                      24820006
248300                                ASC-NUMBER-OF-ITEMS-READ          24830006
248400                                ASC-NUMBER-OF-SELECTED-ITEMS      24840006
248500                                ASC-HIGHEST-BLOCK-WRITTEN         24850006
248600                                ASC-START-OF-SELECTED-RANGE       24860006
248700                                ASC-END-OF-SELECTED-RANGE         24870006
248800                                ASC-ITEM-AT-TOP-OF-PANEL.         24880006
248900                                                                  24890006
248910     PERFORM 4005-GET-CURRENT-YEAR.                               24891006
249000                                                                  24900006
249200     PERFORM 4100-PREPARE-CURSOR.                                 24920022
249300     PERFORM 4010-OPEN-CURSOR.                                    24930022
249400     PERFORM 4300-READ-ITEMS-FROM-DB.                             24940022
249500     PERFORM 4020-CLOSE-CURSOR.                                   24950022
250200                                                                  25020006
250300     MOVE +1                   TO  PV-TOP-ITEM.                   25030006
250400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          25040006
250500         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    25050006
250600         SET DP020-MSG-FATAL   TO  TRUE                           25060006
250700         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               25070006
250800     ELSE                                                         25080006
250900         MOVE -1               TO MR-SELECTL (1)                  25090006
251000         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      25100006
251100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     25110006
251200     END-IF.                                                      25120006
251300                                                                  25130006
251301                                                                  25130106
251302*----------------------------------------------------------------*25130206
251303*    GET CURRENT YEAR.                                         *  25130306
251305*----------------------------------------------------------------*25130506
251310 4005-GET-CURRENT-YEAR.                                           25131006
251311                                                                  25131106
251312         SET  ASC-NO-STR-RLSE-DTE   TO  TRUE.                     25131241
251313                                                                  25131341
251320         EXEC SQL                                                 25132006
251330             SET :ASC-CURRENT-TIMESTAMP = CURRENT TIMESTAMP       25133039
251340         END-EXEC.                                                25134006
251341                                                                  25134106
251342         SUBTRACT 3                                               25134206
251343             FROM ASC-CURRENT-YEAR                                25134339
251345           GIVING PV-WORK-YEAR.                                   25134506
251346                                                                  25134606
251347         MOVE PV-WORK-YEAR  TO  PV-WORK-YEAR-CHAR.                25134753
251350                                                                  25135006
251360                                                                  25136006
251400*----------------------------------------------------------------*25140001
251500* OPEN THE CURSOR.                                               *25150001
251600*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *25160001
251700*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *25170001
251800*   ASSOCIATE.                                                   *25180001
251900*----------------------------------------------------------------*25190001
252000 4010-OPEN-CURSOR.                                                25200022
252100     PERFORM                                                      25210022
252200         WITH TEST AFTER                                          25220022
252300         VARYING PV-RETRY-COUNTER                                 25230022
252400         FROM 1 BY 1                                              25240022
252500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25250022
252600                   OR (SQLCODE = ZERO))                           25260022
252700                                                                  25270022
252800         EVALUATE TRUE                                            25280022
252900             WHEN ASC-SET-YR-SHRTNM-CSR                           25290022
253000                  MOVE 'CURSOR:  SET-YR-SHRTNM-CSR'               25300022
253100                                        TO DP013-MESSAGE-TEXT (2) 25310022
253200                  EXEC SQL                                        25320022
253300                      OPEN SET-YR-SHRTNM-CSR                      25330022
253400                  END-EXEC                                        25340022
253500                                                                  25350022
253600             WHEN ASC-SET-NO-SET-CSR                              25360022
253700                 MOVE 'CURSOR:  SET-NO-SET-CSR'                   25370022
253800                                        TO DP013-MESSAGE-TEXT (2) 25380022
253900                   EXEC SQL                                       25390022
254000                      OPEN SET-NO-SET-CSR                         25400022
254100                   END-EXEC                                       25410022
254200                                                                  25420022
254900                                                                  25490022
255000         END-EVALUATE                                             25500022
255100                                                                  25510022
255200         EVALUATE TRUE                                            25520022
255300             WHEN SQLCODE = ZERO                                  25530022
255400             WHEN SQLCODE = -904                                  25540022
255500             WHEN SQLCODE = -913                                  25550022
255600                 CONTINUE                                         25560022
255700             WHEN SQLWARN0 NOT = SPACES                           25570022
255800             WHEN SQLCODE < ZERO                                  25580022
255900             WHEN SQLCODE > ZERO                                  25590022
256000                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       25600022
256100                 MOVE 'UNABLE TO OPEN A CURSOR -'                 25610022
256200                                   TO DP013-MESSAGE-TEXT (1)      25620022
256300                 MOVE SQLCA        TO DP013-SQLCA                 25630022
256400                 MOVE 'TSEASET '   TO DP013-DB2-TABLE-NAME (1)    25640022
256500                 SET DP013-DB2-ABEND                              25650022
256600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           25660022
256700                 PERFORM DP013-0000-PROCESS-ABEND                 25670022
256800         END-EVALUATE                                             25680022
256900     END-PERFORM.                                                 25690022
257000                                                                  25700022
257100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25710022
257200         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             25720022
257300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   25730022
257400                                   TO DP013-MESSAGE-TEXT (1)      25740022
257500         MOVE SQLCA                TO DP013-SQLCA                 25750022
257600         MOVE 'TSEASET '           TO DP013-DB2-TABLE-NAME (1)    25760022
257700         SET DP013-DB2-ABEND                                      25770022
257800             DP013-XCTL-DISPLAY-RESTART TO TRUE                   25780022
257900         PERFORM DP013-0000-PROCESS-ABEND                         25790022
258000     END-IF.                                                      25800022
258100                                                                  25810022
264800*----------------------------------------------------------------*26480001
264900* CLOSE THE CURSOR                                               *26490001
265000*----------------------------------------------------------------*26500001
265100 4020-CLOSE-CURSOR.                                               26510022
265200     EVALUATE TRUE                                                26520022
265300         WHEN ASC-SET-YR-SHRTNM-CSR                               26530022
265400              EXEC SQL                                            26540022
265500                   CLOSE SET-YR-SHRTNM-CSR                        26550022
265600              END-EXEC                                            26560022
265700                                                                  26570022
265800         WHEN ASC-SET-NO-SET-CSR                                  26580022
265900              EXEC SQL                                            26590022
266000                   CLOSE SET-NO-SET-CSR                           26600022
266100              END-EXEC                                            26610022
266200                                                                  26620022
266700     END-EVALUATE.                                                26670022
266800                                                                  26680022
266900     EVALUATE TRUE                                                26690022
267000         WHEN SQLCODE = ZERO                                      26700022
267100             CONTINUE                                             26710022
267200         WHEN SQLWARN0 NOT = SPACES                               26720022
267300         WHEN SQLCODE < ZERO                                      26730022
267400         WHEN SQLCODE > ZERO                                      26740022
267500             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          26750022
267600             MOVE 'UNABLE TO CLOSE CURSOR '                       26760022
267700                               TO DP013-MESSAGE-TEXT (1)          26770022
267800             MOVE SQLCA        TO DP013-SQLCA                     26780022
267900             MOVE 'TSEASET '   TO DP013-DB2-TABLE-NAME (1)        26790022
268000             SET DP013-DB2-ABEND                                  26800022
268100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               26810022
268200             PERFORM DP013-0000-PROCESS-ABEND                     26820022
268300     END-EVALUATE.                                                26830022
268400                                                                  26840022
272200*----------------------------------------------------------------*27220001
272300*    SET UP THE HOST VARIABLES.                                  *27230001
272400*----------------------------------------------------------------*27240001
272500 4100-PREPARE-CURSOR.                                             27250022
272600                                                                  27260022
272700     MOVE ASC-CRIT-SET-YEAR    TO  DK-SET-YEAR.                   27270022
272710     MOVE ASC-CRIT-SHORT-NAME  TO  DK-SET-SHRTNM.                 27271022
272800                                                                  27280022
273300     IF  DK-SET-YEAR     > SPACES  AND                            27330022
273310         DK-SET-SHRTNM   > SPACES                                 27331022
273320             SET ASC-SET-YR-SHRTNM-CSR TO TRUE                    27332022
273500         ELSE                                                     27350022
273600             SET ASC-SET-NO-SET-CSR TO TRUE                       27360022
273800     END-IF.                                                      27380022
273900                                                                  27390022
275700*----------------------------------------------------------------*27570001
275800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *27580001
275900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *27590001
276000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *27600001
276100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *27610001
276200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *27620001
276300*                                                                *27630001
276400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *27640001
276500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *27650001
276600*    UPON INITIALIZATION.                                        *27660001
276700*----------------------------------------------------------------*27670001
276800 4300-READ-ITEMS-FROM-DB.                                         27680005
276900     PERFORM                                                      27690005
277000         VARYING PV-READ-COUNT                                    27700005
277100         FROM 1 BY 1                                              27710005
277200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    27720005
277300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         27730005
277400                                                                  27740005
277800        PERFORM 4310-FETCH                                        27780022
278000                                                                  27800005
278100         IF  ASC-ITEMS-LEFT-ON-DB                                 27810005
278200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                27820005
278300                 ADD +1            TO ASC-ITEM-SUB                27830005
278400             ELSE                                                 27840005
278500                 ADD +1            TO ASC-BLK-SUB                 27850005
278600                 MOVE +1           TO ASC-ITEM-SUB                27860005
278700                                                                  27870005
278800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         27880005
278900                     MOVE +1       TO ASC-BLK-SUB                 27890005
279000                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           27900005
279100                     PERFORM 5100-WRITE-TEMP-STORAGE              27910005
279200                     MOVE ASC-BLOCK-ENTRIES                       27920005
279300                               (PC-MAX-BLOCKS-IN-ARRAY)           27930005
279400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 27940005
279500                     ADD +1        TO ASC-BLK-SUB                 27950005
279600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   27960005
279700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      27970005
279800                                   TO TRUE                        27980005
279900                 END-IF                                           27990005
280000             END-IF                                               28000005
280100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    28010005
280200             MOVE ASC-NUMBER-OF-ITEMS-READ                        28020005
280300                                   TO ASC-LIST-ITEM-NUMBER        28030005
280400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28040005
280500             EVALUATE TRUE                                        28050005
280600                 WHEN CN015-FUNCTION-NONE                         28060005
280700                     MOVE SPACES TO ASC-ACTION                    28070005
280800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28080005
281400                 WHEN CN015-UPD-TSEASET                           28140006
281500                     MOVE PC-UPD TO ASC-ACTION                    28150005
281600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28160005
282300                 WHEN CN016-UPD-TSEASET                           28230006
282400                     MOVE PC-UPD TO ASC-ACTION                    28240005
282500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  28250005
282600             END-EVALUATE                                         28260005
282700             MOVE SEASET-DIVERT-PFX-NBR TO ASC-DIVERT             28270006
282800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28280005
282900             MOVE SEASET-SEASET-YR      TO ASC-SET-YEAR           28290006
283000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28300005
283100             MOVE SEASET-SEASET-SHRT-NM TO ASC-SHRTNM             28310006
283200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28320005
283300             MOVE SEASET-SEASET-TYP-CDE TO ASC-SET-TYPE           28330006
283400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28340005
283500             MOVE SEASET-SEASET-NM      TO ASC-SET-NAME           28350006
283600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28360005
283700             MOVE SEASET-SEASET-STAT-CDE TO ASC-STATUS            28370006
283800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28380005
283900             MOVE SEASET-STR-RLSE-END-DTE TO ASC-END-DATE         28390032
284000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28400032
285400         END-IF                                                   28540005
285500     END-PERFORM.                                                 28550005
285600                                                                  28560005
285700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          28570005
285800         MOVE +1               TO ASC-BLK-SUB                     28580005
285900         PERFORM 5100-WRITE-TEMP-STORAGE                          28590005
286000         ADD +1                TO ASC-BLK-SUB                     28600005
286100         PERFORM 5100-WRITE-TEMP-STORAGE                          28610005
286200                                                                  28620005
286300         MOVE 1                TO ASC-BLK-SUB                     28630005
286400                                  PV-BLOCK-NUMBER                 28640005
286500         PERFORM 4410-READ-TEMP-STORAGE                           28650005
286600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             28660005
286700             MOVE 2            TO ASC-BLK-SUB                     28670005
286800                                  PV-BLOCK-NUMBER                 28680005
286900             PERFORM 4410-READ-TEMP-STORAGE                       28690005
287000         END-IF                                                   28700005
287100     END-IF.                                                      28710005
287200                                                                  28720005
287300*----------------------------------------------------------------*28730001
287400*    FETCH THE CURSOR                                             28740001
287500*----------------------------------------------------------------*28750001
287600 4310-FETCH.                                                      28760005
287700       EVALUATE TRUE                                              28770005
287800           WHEN ASC-SET-YR-SHRTNM-CSR                             28780008
287900               EXEC SQL                                           28790005
288000                    FETCH SET-YR-SHRTNM-CSR                       28800008
288100                    INTO  :PV-RECORD-TYPE                         28810007
288101                        , :SEASET-SEASET-YR                       28810107
288102                        , :SEASET-SEASET-SHRT-NM                  28810207
288103                        , :SEASET-SEASET-TYP-CDE                  28810307
288104                        , :SEASET-SEASET-NM                       28810407
288105                        , :SEASET-SEASET-STAT-CDE                 28810507
288106                        , :SEASET-STR-RLSE-END-DTE                28810607
288110                        , :SEASET-DIVERT-PFX-NBR                  28811007
288800               END-EXEC                                           28880005
288900                                                                  28890005
289000           WHEN ASC-SET-NO-SET-CSR                                28900008
289100               EXEC SQL                                           28910005
289200                    FETCH SET-NO-SET-CSR                          28920008
289210                    INTO  :PV-RECORD-TYPE                         28921007
289220                        , :SEASET-SEASET-YR                       28922007
289230                        , :SEASET-SEASET-SHRT-NM                  28923007
289240                        , :SEASET-SEASET-TYP-CDE                  28924007
289250                        , :SEASET-SEASET-NM                       28925007
289260                        , :SEASET-SEASET-STAT-CDE                 28926007
289270                        , :SEASET-STR-RLSE-END-DTE                28927007
289280                        , :SEASET-DIVERT-PFX-NBR                  28928007
290000               END-EXEC                                           29000005
290100                                                                  29010005
291300     END-EVALUATE.                                                29130005
291400                                                                  29140005
291500     EVALUATE TRUE                                                29150005
291600         WHEN SQLCODE = ZERO                                      29160005
291700              CONTINUE                                            29170022
291800         WHEN SQLCODE = +100                                      29180005
291900              CONTINUE                                            29190005
292000         WHEN SQLWARN0 NOT = SPACE                                29200005
292100         WHEN SQLCODE NOT = ZERO                                  29210005
292200              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         29220005
292300              MOVE 'COULD NOT FETCH CURSOR'                       29230005
292400                               TO DP013-MESSAGE-TEXT (1)          29240005
292500              MOVE SQLCA       TO DP013-SQLCA                     29250005
292600              SET DP013-DB2-ABEND TO TRUE                         29260005
292700              PERFORM DP013-0000-PROCESS-ABEND                    29270005
292800     END-EVALUATE.                                                29280005
292900                                                                  29290005
293000     IF  SQLCODE EQUAL +100                                       29300005
293100         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      29310005
293200     END-IF.                                                      29320005
293300                                                                  29330005
307900*----------------------------------------------------------------*30790001
308000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *30800001
308100*----------------------------------------------------------------*30810001
308200 4400-MOVE-COMMAREA-TO-SCREEN.                                    30820005
308300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             30830005
308400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          30840005
308500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          30850005
308600             MOVE +1    TO ASC-BLK-SUB                            30860005
308700             PERFORM 5100-WRITE-TEMP-STORAGE                      30870005
308800             ADD +1     TO ASC-BLK-SUB                            30880005
308900             PERFORM 5100-WRITE-TEMP-STORAGE                      30890005
309000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             30900005
309100                 GIVING PV-BLOCK-NUMBER                           30910005
309200                 REMAINDER PV-REMAINDER                           30920005
309300             IF  PV-REMAINDER > ZERO                              30930005
309400                 ADD +1 TO PV-BLOCK-NUMBER                        30940005
309500             END-IF                                               30950005
309600             MOVE +1    TO ASC-BLK-SUB                            30960005
309700             PERFORM 4410-READ-TEMP-STORAGE                       30970005
309800             ADD +1     TO ASC-BLK-SUB                            30980005
309900                           PV-BLOCK-NUMBER                        30990005
310000             PERFORM 4410-READ-TEMP-STORAGE                       31000005
310100     END-IF.                                                      31010005
310200     MOVE +1            TO ASC-BLK-SUB.                           31020005
310300     COMPUTE ASC-ITEM-SUB =                                       31030005
310400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              31040005
310500         + PC-ITEMS-PER-PANEL).                                   31050005
310600                                                                  31060005
310700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        31070005
310800         ADD +1         TO ASC-BLK-SUB                            31080005
310900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            31090005
311000     END-IF.                                                      31100005
311100                                                                  31110005
311200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           31120005
311300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                31130005
311400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        31140005
311500     PERFORM 4420-FORMAT-LIST-LINES                               31150005
311600         VARYING PV-SUB                                           31160005
311700         FROM PC-ITEMS-PER-PANEL BY -1                            31170005
311800         UNTIL PV-SUB < +1.                                       31180005
311900                                                                  31190005
312000     COMPUTE ASC-ITEMS-DISPLAYED =                                31200005
312100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          31210005
312200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    31220005
312300                                      ASTRTITO.                   31230005
312400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    31240005
312500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    31250005
312600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            31260005
312700                                   TO ASELITO.                    31270005
313100                                                                  31310005
313200     IF  DP020-MSG-NUMBER-X = SPACE                               31320005
313300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  31330005
313400*            --- MORE ITEMS TO DISPLAY ----                       31340022
313500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            31350005
313600             SET DP020-MSG-INFORMATIONAL TO TRUE                  31360005
313700         END-IF                                                   31370005
313800     END-IF.                                                      31380005
313900                                                                  31390005
314000*----------------------------------------------------------------*31400001
314100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *31410001
314200*----------------------------------------------------------------*31420001
314300 4410-READ-TEMP-STORAGE.                                          31430005
314400     EXEC CICS                                                    31440005
314500         READQ TS                                                 31450005
314600             QUEUE (ASC-LIST-QUEUE-NAME)                          31460005
314700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31470005
314800             ITEM  (PV-BLOCK-NUMBER)                              31480005
314900             RESP  (PV-CICS-RESP)                                 31490005
315000     END-EXEC.                                                    31500005
315100                                                                  31510005
315200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       31520005
315300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     31530005
315400         CONTINUE                                                 31540005
315500     ELSE                                                         31550005
315600         SET DP013-CICS-ABEND     TO TRUE                         31560005
315700         SET DP013-NO-ROLLBACK    TO TRUE                         31570005
315800         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         31580005
315900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      31590005
316000                                  TO DP013-MESSAGE-TEXT(1)        31600005
316100         PERFORM DP013-0000-PROCESS-ABEND                         31610005
316200     END-IF.                                                      31620005
316300                                                                  31630005
316400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             31640005
316500                                                                  31650005
316600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         31660005
316700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               31670005
316800     END-IF.                                                      31680005
316900                                                                  31690005
317000*----------------------------------------------------------------*31700001
317100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *31710001
317200*----------------------------------------------------------------*31720001
317300 4420-FORMAT-LIST-LINES.                                          31730005
317400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      31740005
317500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                31750005
317600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           31760005
317700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           31770005
317800         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      31780005
317900                                    MR-ACTION       (PV-SUB)      31790005
318000                                    MR-DIVERT       (PV-SUB)      31800024
318010                                    MR-SET-YR       (PV-SUB)      31801024
318020                                    MR-SHRTNM       (PV-SUB)      31802024
318100                                    MR-TYPE         (PV-SUB)      31810005
318200                                    MR-SET-NAME     (PV-SUB)      31820025
318300                                    MR-STATUS       (PV-SUB)      31830024
318600                                    MR-END-DATE     (PV-SUB)      31860005
318700     ELSE                                                         31870005
318800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      31880005
318900                                                   > SPACE        31890005
319000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 31900005
319100                                          TO MR-SELECTI (PV-SUB)  31910005
319200         ELSE                                                     31920005
319300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      31930005
319400                                           TO MR-SELECTI (PV-SUB) 31940005
319500         END-IF                                                   31950005
319600                                                                  31960005
319700         IF  DP030-SET-CURSOR-TRAILER                             31970005
319800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)31980005
319900                 > SPACE)                                         31990005
320000               OR (PV-SUB = 1))                                   32000005
320100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               32010005
320200                MOVE -1          TO MR-SELECTL (PV-SUB)           32020005
320300             END-IF                                               32030005
320400         END-IF                                                   32040005
320500*>>>>>>>>                                                         32050001
320600         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               32060005
320700                                          TO MR-ACTION   (PV-SUB) 32070022
320800         MOVE ASC-DIVERT-2DIGIT (ASC-BLK-SUB ASC-ITEM-SUB)        32080028
320900                                          TO MR-DIVERT   (PV-SUB) 32090024
320910         MOVE ASC-SET-YEAR      (ASC-BLK-SUB ASC-ITEM-SUB)        32091028
320920                                          TO MR-SET-YR   (PV-SUB) 32092024
321000         MOVE ASC-SHRTNM        (ASC-BLK-SUB ASC-ITEM-SUB)        32100028
321100                                          TO MR-SHRTNM   (PV-SUB) 32110022
321200         MOVE ASC-SET-TYPE      (ASC-BLK-SUB ASC-ITEM-SUB)        32120028
321300                                          TO MR-TYPE     (PV-SUB) 32130022
321400         MOVE ASC-SET-NAME      (ASC-BLK-SUB ASC-ITEM-SUB)        32140028
321500                                          TO MR-SET-NAME (PV-SUB) 32150022
321800         MOVE ASC-STATUS        (ASC-BLK-SUB ASC-ITEM-SUB)        32180028
321900                                          TO MR-STATUS   (PV-SUB) 32190022
322000         MOVE ASC-END-DATE      (ASC-BLK-SUB ASC-ITEM-SUB)        32200028
322100                                          TO MR-END-DATE (PV-SUB) 32210022
322110                                                                  32211035
322120         IF  ASC-END-DATE  (ASC-BLK-SUB ASC-ITEM-SUB)             32212036
322121                           >=  ASC-CURRENT-DATE        AND        32212139
322130             ASC-END-DATE  (ASC-BLK-SUB ASC-ITEM-SUB)             32213036
322131                        NOT =  ASC-DEFAULT-DATE                   32213140
322132             MOVE DP015-YELLOW     TO MR-DIVERTC   (PV-SUB)       32213236
322133                                      MR-END-DATEC (PV-SUB)       32213336
322200         END-IF                                                   32220035
322201                                                                  32220135
322210     END-IF.                                                      32221035
322300     SUBTRACT +1 FROM ASC-ITEM-SUB                                32230005
322400     IF  ASC-ITEM-SUB < + 1                                       32240005
322500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  32250005
322600         MOVE +1                 TO ASC-BLK-SUB                   32260005
322700     END-IF.                                                      32270005
322800                                                                  32280005
322900******************************************************************32290001
323000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **32300001
323100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **32310001
323200** ISSUE A WARNING.                                             **32320001
323300******************************************************************32330001
323400 4430-CHECK-FOR-BEGIN-AND-END.                                    32340005
323500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       32350005
323600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     32360005
323700*            -- NO END-OF-RANGE SPECFIED ---                      32370022
323800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            32380005
323900             SET DP020-MSG-WARNING TO TRUE                        32390005
324000             PERFORM 4431-POSITION-AT-WARNING                     32400005
324100         END-IF                                                   32410005
324200     ELSE                                                         32420005
324300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     32430005
324400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                32440022
324500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            32450005
324600             SET DP020-MSG-WARNING TO TRUE                        32460005
324700             PERFORM 4431-POSITION-AT-WARNING                     32470005
324800         END-IF                                                   32480005
324900     END-IF.                                                      32490005
325000*                                                                 32500003
325100******************************************************************32510001
325200** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **32520001
325300** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **32530001
325400** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **32540001
325500** POSITION THE CURSOR THERE.                                   **32550001
325600******************************************************************32560001
325700 4431-POSITION-AT-WARNING.                                        32570005
325800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 32580005
325900                    - PV-TOP-ITEM + 1.                            32590005
326000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      32600005
326100         CONTINUE                                                 32610005
326200     ELSE                                                         32620005
326300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      32630005
326400         MOVE -1                     TO MR-SELECTL (PV-SUB)       32640005
326500         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       32650005
326600         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       32660005
326700     END-IF.                                                      32670005
326800                                                                  32680005
326900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   32690005
327000                    - PV-TOP-ITEM + 1.                            32700005
327100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      32710005
327200         CONTINUE                                                 32720005
327300     ELSE                                                         32730005
327400         SET DP030-SET-CURSOR-APPL-1                              32740005
327500                                   TO TRUE                        32750005
327600         MOVE -1                   TO MR-SELECTL (PV-SUB)         32760005
327700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         32770005
327800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         32780005
327900     END-IF.                                                      32790005
328000                                                                  32800005
328100*----------------------------------------------------------------*32810001
328200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *32820001
328300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *32830001
328400* FOR THE SELECTED ITEMS QUEUE.                                  *32840001
328500*                                                                *32850001
328600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *32860001
328700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *32870001
328800* THE ARRAY IS FULL.                                             *32880001
328900*----------------------------------------------------------------*32890001
329000 5000-PREPARE-SEL-QUEUE.                                          32900005
329100     MOVE +1                   TO  ASC-BLK-SUB.                   32910005
329200     PERFORM 5100-WRITE-TEMP-STORAGE.                             32920005
329300     ADD +1                    TO  ASC-BLK-SUB.                   32930005
329400     PERFORM 5100-WRITE-TEMP-STORAGE.                             32940005
329500                                                                  32950005
329600     MOVE ASC-SEL-QUEUE-NAME   TO  CN016-SEL-QUEUE-NAME.          32960005
329700     PERFORM 6010-DELETE-SEL-QUEUE.                               32970005
329800                                                                  32980005
329900     SET ASC-UPDATE-TSQ        TO  TRUE.                          32990005
330000                                                                  33000005
330100     SET CN017-IDX             TO  1.                             33010005
330200     MOVE ZERO                 TO CN016-NUMBER-OF-TS-ITEMS.       33020005
330300     INITIALIZE CN017-SELECTED-ITEM-ARRAY.                        33030005
330400                                                                  33040005
330500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           33050005
330600             VARYING PV-ITEM                                      33060005
330700             FROM 1 BY 1                                          33070005
330800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     33080005
330900                                                                  33090005
331000     IF  CN017-IDX > 1                                            33100005
331100         PERFORM 5205-WRITE-SEL-QUEUE                             33110005
331200         ADD +1                TO CN016-NUMBER-OF-TS-ITEMS        33120005
331300     END-IF.                                                      33130005
331400                                                                  33140005
331500*----------------------------------------------------------------*33150001
331600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *33160001
331700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *33170001
331800*----------------------------------------------------------------*33180001
331900 5100-WRITE-TEMP-STORAGE.                                         33190005
332000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     33200005
332100                                   TO PV-LIST-ITEM-NUMBER.        33210005
332200     COMPUTE PV-BLOCK-NUMBER =                                    33220005
332300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    33230005
332400                                                                  33240005
332500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             33250005
332600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             33260005
332700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      33270005
332800             PERFORM 5105-REWRITE-ASC-LISTQ                       33280005
332900         END-IF                                                   33290005
333000     ELSE                                                         33300005
333100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       33310005
333200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            33320005
333300         PERFORM 5110-WRITE-ASC-LISTQ                             33330005
333400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   33340005
333500     END-IF.                                                      33350005
333600                                                                  33360005
333700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             33370005
333800                                                                  33380005
333900******************************************************************33390001
334000** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **33400001
334100** SPECIFIC COMMAREA.                                           **33410001
334200******************************************************************33420001
334300 5105-REWRITE-ASC-LISTQ.                                          33430005
334400     EXEC CICS                                                    33440005
334500         WRITEQ TS                                                33450005
334600             QUEUE (ASC-LIST-QUEUE-NAME)                          33460005
334700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               33470005
334800             ITEM  (PV-BLOCK-NUMBER)                              33480005
334900             REWRITE                                              33490005
335000             RESP  (PV-CICS-RESP)                                 33500005
335100     END-EXEC.                                                    33510005
335200                                                                  33520005
335300     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           33530005
335400         CONTINUE                                                 33540005
335500     ELSE                                                         33550005
335600         SET DP013-CICS-ABEND            TO TRUE                  33560005
335700         SET DP013-NO-ROLLBACK           TO TRUE                  33570005
335800         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       33580005
335900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     33590005
336000                                         TO DP013-MESSAGE-TEXT(1) 33600005
336100         PERFORM DP013-0000-PROCESS-ABEND                         33610005
336200     END-IF.                                                      33620005
336300                                                                  33630005
336400******************************************************************33640001
336500** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **33650001
336600** SPECIFIC COMMAREA.                                           **33660001
336700******************************************************************33670001
336800 5110-WRITE-ASC-LISTQ.                                            33680005
336900     EXEC CICS                                                    33690005
337000         WRITEQ TS                                                33700005
337100             QUEUE (ASC-LIST-QUEUE-NAME)                          33710005
337200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               33720005
337300             ITEM  (PV-BLOCK-NUMBER)                              33730005
337400             RESP  (PV-CICS-RESP)                                 33740005
337500     END-EXEC.                                                    33750005
337600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      33760005
337700         SET DP013-CICS-ABEND      TO TRUE                        33770005
337800         SET DP013-NO-ROLLBACK     TO TRUE                        33780005
337900         MOVE '5110-WRITE-ASC-LISTQ'                              33790005
338000                                   TO DP013-PARAGRAPH             33800005
338100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           33810005
338200                                   TO DP013-MESSAGE-TEXT(1)       33820005
338300         PERFORM DP013-0000-PROCESS-ABEND                         33830005
338400     END-IF.                                                      33840005
338500                                                                  33850005
338600*----------------------------------------------------------------*33860001
338700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *33870001
338800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *33880001
338900*----------------------------------------------------------------*33890001
339000 5200-FILL-SEL-QUEUE-RECORD.                                      33900005
339100     PERFORM 6112-READ-LIST-QUEUE.                                33910005
339200                                                                  33920005
339300     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       33930005
339400         PERFORM VARYING LQW-IDX                                  33940005
339500         FROM 1 BY 1                                              33950005
339600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            33960005
339700           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               33970005
339800                                                                  33980005
339900           IF LQW-SELECT (LQW-IDX)                                33990005
340000                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX)               34000022
340100                            TO CN017-ITEM          (CN017-IDX)    34010022
340200                 MOVE LQW-ACTION (LQW-IDX)                        34020005
340300                            TO CN017-ACTION-SW     (CN017-IDX)    34030022
340400                 MOVE LQW-DIVERT-2DIGIT (LQW-IDX)                 34040057
340500                            TO CN017-DIVERT-PREFIX (CN017-IDX)    34050057
340510                 MOVE LQW-SET-YR (LQW-IDX)                        34051057
340520                            TO CN017-SEASET-YEAR   (CN017-IDX)    34052057
340600                 MOVE LQW-SHRTNM (LQW-IDX)                        34060005
340700                            TO CN017-SEASET-SHRTNM (CN017-IDX)    34070022
340800                 MOVE LQW-TYPE (LQW-IDX)                          34080005
340900                            TO CN017-SEASET-TYPE   (CN017-IDX)    34090022
341000                 MOVE LQW-SET-NAME (LQW-IDX)                      34100005
341100                            TO CN017-SEASET-NAME   (CN017-IDX)    34110022
341200                 MOVE LQW-STATUS (LQW-IDX)                        34120005
341300                            TO CN017-STATUS        (CN017-IDX)    34130022
341400                 MOVE LQW-END-DATE (LQW-IDX)                      34140005
341500                            TO CN017-RLSE-DATE     (CN017-IDX)    34150022
341800                                                                  34180005
341900                 SET CN017-IDX UP BY 1                            34190005
342000                 IF  CN017-IDX > CN017-MAX-ITEMS                  34200005
342100                     PERFORM 5205-WRITE-SEL-QUEUE                 34210005
342200                     ADD +1        TO CN016-NUMBER-OF-TS-ITEMS    34220005
342300                     INITIALIZE CN017-SELECTED-ITEM-ARRAY         34230005
342400                     SET CN017-IDX TO  1                          34240005
342500                 END-IF                                           34250005
342600           END-IF                                                 34260005
342700         END-PERFORM                                              34270005
342800     END-IF.                                                      34280005
342900                                                                  34290005
343000*----------------------------------------------------------------*34300001
343100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *34310001
343200*----------------------------------------------------------------*34320001
343300 5205-WRITE-SEL-QUEUE.                                            34330005
343400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN017-SELECTED-ITEMS.   34340005
343500                                                                  34350005
343600     EXEC CICS                                                    34360005
343700          WRITEQ TS                                               34370005
343800              QUEUE (ASC-SEL-QUEUE-NAME)                          34380005
343900              FROM  (CN017-SELECT-RECORD)                         34390005
344000              ITEM  (PV-SEL-QUEUE-ITEM)                           34400005
344100              RESP  (PV-CICS-RESP)                                34410005
344200     END-EXEC.                                                    34420005
344300                                                                  34430005
344400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34440005
344500         CONTINUE                                                 34450005
344600     ELSE                                                         34460005
344700         SET DP013-CICS-ABEND      TO TRUE                        34470005
344800         SET DP013-NO-ROLLBACK     TO TRUE                        34480005
344900         MOVE '5205-WRITE-SEL-QUEUE'                              34490005
345000                                   TO DP013-PARAGRAPH             34500005
345100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          34510005
345200                                   TO DP013-MESSAGE-TEXT(1)       34520005
345300         PERFORM DP013-0000-PROCESS-ABEND                         34530005
345400     END-IF.                                                      34540005
345500                                                                  34550005
345600******************************************************************34560001
345700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **34570001
345800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **34580001
345900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **34590001
346000** THE USER.                                                    **34600001
346100******************************************************************34610001
346200 6000-REFRESH-PANEL-FROM-TEMP.                                    34620005
346300     IF  ASC-UPDATE-TSQ                                           34630005
346400         SET ASC-NO-TSQ-UPDATE TO TRUE                            34640005
346500         MOVE ZERO                 TO PV-SAVE-ITEM                34650005
346600                                      PV-SEL-QUEUE-ITEM           34660005
346700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        34670005
346800                                   TO PV-HOLD-SELECTED-ITEMS      34680005
346900         MOVE +1                   TO PV-ITEMS-PROCESSED          34690005
347000         PERFORM 6100-UPDATE-TSQ                                  34700005
347100             UNTIL PV-ITEMS-PROCESSED >                           34710005
347200                                     PV-HOLD-SELECTED-ITEMS       34720005
347300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         34730005
347400                    ASC-BLOCK-ENTRIES (2)                         34740005
347500     END-IF.                                                      34750005
347600                                                                  34760005
347700*----------------------------------------------------------------*34770001
347800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *34780001
347900*----------------------------------------------------------------*34790001
348000 6010-DELETE-SEL-QUEUE.                                           34800005
348100                                                                  34810005
348200     EXEC CICS                                                    34820005
348300         DELETEQ TS                                               34830005
348400             QUEUE (ASC-SEL-QUEUE-NAME)                           34840005
348500             RESP  (PV-CICS-RESP)                                 34850005
348600     END-EXEC.                                                    34860005
348700                                                                  34870005
348800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      34880005
348900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         34890005
349000         CONTINUE                                                 34900005
349100     ELSE                                                         34910005
349200         SET DP013-CICS-ABEND TO TRUE                             34920005
349300         SET DP013-NO-ROLLBACK TO TRUE                            34930005
349400         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          34940005
349500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         34950005
349600                                        TO DP013-MESSAGE-TEXT (1) 34960005
349700         PERFORM DP013-0000-PROCESS-ABEND                         34970005
349800     END-IF.                                                      34980005
349900                                                                  34990005
350000*----------------------------------------------------------------*35000001
350100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *35010001
350200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *35020001
350300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *35030001
350400*    THE TEMP QUEUE.                                             *35040001
350500*----------------------------------------------------------------*35050001
350600 6100-UPDATE-TSQ.                                                 35060005
350700                                                                  35070005
350800     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              35080005
350900     PERFORM 6105-READ-SEL-QUEUE.                                 35090005
351000     PERFORM                                                      35100005
351100         VARYING CN017-IDX FROM 1 BY 1                            35110005
351200         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     35120005
351300         OR (CN017-IDX GREATER THAN CN017-MAX-ITEMS))             35130005
351400         IF  CN017-ACTION-SW (CN017-IDX) > SPACE                  35140005
351500             PERFORM 6110-PROCESS-ITEMS                           35150005
351600         END-IF                                                   35160005
351700         ADD +1                TO PV-ITEMS-PROCESSED              35170005
351800     END-PERFORM.                                                 35180005
351900     PERFORM 6111-WRITE-LIST-QUEUE.                               35190005
352000                                                                  35200005
352100*----------------------------------------------------------------*35210001
352200*    READ THE LIST QUEUE RECORD.                                 *35220001
352300*----------------------------------------------------------------*35230001
352400 6105-READ-SEL-QUEUE.                                             35240005
352500                                                                  35250005
352600     EXEC CICS                                                    35260005
352700          READQ TS                                                35270005
352800              QUEUE (ASC-SEL-QUEUE-NAME)                          35280005
352900              INTO  (CN017-SELECT-RECORD)                         35290005
353000              ITEM  (PV-SEL-QUEUE-ITEM)                           35300005
353100              RESP  (PV-CICS-RESP)                                35310005
353200     END-EXEC.                                                    35320005
353300                                                                  35330005
353400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          35340005
353500         CONTINUE                                                 35350005
353600     ELSE                                                         35360005
353700         SET DP013-CICS-ABEND      TO  TRUE                       35370005
353800         SET DP013-NO-ROLLBACK     TO  TRUE                       35380005
353900         MOVE '6105-READ-SEL-QUEUE'                               35390005
354000                                   TO  DP013-PARAGRAPH            35400005
354100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           35410005
354200                                   TO  DP013-MESSAGE-TEXT(1)      35420005
354300         PERFORM DP013-0000-PROCESS-ABEND                         35430005
354400     END-IF.                                                      35440005
354500                                                                  35450005
354600*----------------------------------------------------------------*35460001
354700*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*35470001
354800*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*35480001
354900*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *35490001
355000*----------------------------------------------------------------*35500001
355100 6110-PROCESS-ITEMS.                                              35510005
355200                                                                  35520005
355300     COMPUTE PV-ITEM = 1 + ((CN017-ITEM (CN017-IDX) - 1)          35530005
355400                     / PC-ITEMS-PER-PANEL).                       35540005
355500                                                                  35550005
355600     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           35560005
355700         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          35570005
355800             PERFORM 6111-WRITE-LIST-QUEUE                        35580005
355900         END-IF                                                   35590005
356000         MOVE PV-ITEM          TO PV-SAVE-ITEM                    35600005
356100                                                                  35610005
356200         PERFORM 6112-READ-LIST-QUEUE                             35620005
356300         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               35630005
356400             CONTINUE                                             35640005
356500         END-IF                                                   35650005
356600     END-IF.                                                      35660005
356700                                                                  35670005
356800     COMPUTE PV-SUB = (CN017-ITEM (CN017-IDX)                     35680005
356900                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              35690005
357000     SET LQW-DESELECT (PV-SUB) TO    TRUE                         35700005
357100     MOVE LQW-SELECTED-SW (PV-SUB)                                35710005
357200                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  35720005
357300     EVALUATE TRUE                                                35730005
357400         WHEN CN017-INQ (CN017-IDX)                               35740005
357500              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             35750005
357600                                                                  35760005
357700         WHEN CN017-UPD (CN017-IDX)                               35770005
357800              MOVE PC-UPD      TO LQW-ACTION  (PV-SUB)            35780022
357900              MOVE CN017-DIVERT-PREFIX     (CN017-IDX)            35790049
358000                               TO LQW-DIVERT-2DIGIT (PV-SUB)      35800049
358001              MOVE CN017-SEASET-YEAR       (CN017-IDX)            35800149
358002                               TO LQW-SET-YR  (PV-SUB)            35800249
358010              MOVE CN017-SEASET-SHRTNM     (CN017-IDX)            35801022
358020                               TO LQW-SHRTNM  (PV-SUB)            35802022
358100              MOVE CN017-SEASET-TYPE       (CN017-IDX)            35810022
358200                               TO LQW-TYPE    (PV-SUB)            35820022
358300              MOVE CN017-SEASET-NAME       (CN017-IDX)            35830022
358400                               TO LQW-SET-NAME(PV-SUB)            35840005
358500              MOVE CN017-STATUS            (CN017-IDX)            35850022
358600                               TO LQW-STATUS  (PV-SUB)            35860022
358700              MOVE CN017-RLSE-DATE         (CN017-IDX)            35870022
358800                               TO LQW-END-DATE (PV-SUB)           35880005
359100                                                                  35910005
359200         WHEN CN017-DEL (CN017-IDX)                               35920005
359300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             35930005
359400                                                                  35940005
359500         WHEN CN017-ERR (CN017-IDX)                               35950005
359600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             35960005
359700                                                                  35970005
359800         WHEN OTHER                                               35980005
359900              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             35990005
360000                                                                  36000005
360100     END-EVALUATE.                                                36010005
360200                                                                  36020005
360300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                36030005
360400                                                                  36040005
360500*----------------------------------------------------------------*36050001
360600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *36060001
360700*----------------------------------------------------------------*36070001
360800 6111-WRITE-LIST-QUEUE.                                           36080005
360900                                                                  36090005
361000     EXEC CICS                                                    36100005
361100         WRITEQ TS                                                36110005
361200             QUEUE (ASC-LIST-QUEUE-NAME)                          36120005
361300             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     36130005
361400             ITEM  (PV-SAVE-ITEM)                                 36140005
361500             REWRITE                                              36150005
361600             RESP  (PV-CICS-RESP)                                 36160005
361700     END-EXEC.                                                    36170005
361800                                                                  36180005
361900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          36190005
362000         CONTINUE                                                 36200005
362100     ELSE                                                         36210005
362200         SET DP013-CICS-ABEND  TO  TRUE                           36220005
362300         SET DP013-NO-ROLLBACK TO  TRUE                           36230005
362400         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         36240005
362500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  36250005
362600                               TO  DP013-MESSAGE-TEXT(1)          36260005
362700         PERFORM DP013-0000-PROCESS-ABEND                         36270005
362800     END-IF.                                                      36280005
362900                                                                  36290005
363000*----------------------------------------------------------------*36300001
363100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*36310001
363200*----------------------------------------------------------------*36320001
363300 6112-READ-LIST-QUEUE.                                            36330005
363400     EXEC CICS                                                    36340005
363500         READQ TS                                                 36350005
363600             QUEUE (ASC-LIST-QUEUE-NAME)                          36360005
363700             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     36370005
363800             ITEM  (PV-ITEM)                                      36380005
363900             RESP  (PV-CICS-RESP)                                 36390005
364000     END-EXEC.                                                    36400005
364100                                                                  36410005
364200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          36420005
364300         CONTINUE                                                 36430005
364400     ELSE                                                         36440005
364500         SET DP013-CICS-ABEND        TO TRUE                      36450005
364600         SET DP013-NO-ROLLBACK       TO TRUE                      36460005
364700         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           36470005
364800         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    36480005
364900                                     TO DP013-MESSAGE-TEXT(1)     36490005
365000         PERFORM DP013-0000-PROCESS-ABEND                         36500005
365100     END-IF.                                                      36510005
365200                                                                  36520005
365300*----------------------------------------------------------------*36530001
365400*    ABEND PROCESSOR MODULE                                      *36540001
365500*----------------------------------------------------------------*36550001
365600     COPY DPPD013.                                                36560001
