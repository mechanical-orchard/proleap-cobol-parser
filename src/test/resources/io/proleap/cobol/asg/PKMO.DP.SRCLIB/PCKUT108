000100 TITLE 'RFID CARTON, UNIT LOOKUP'.                                00010063
000200 IDENTIFICATION DIVISION.                                         00020064
000300 PROGRAM-ID.    PCKUT108.                                         00030064
000400 AUTHOR.        RICH KELLEN.                                      00040064
000500 DATE-WRITTEN.  MAY, 2013.                                        00050064
000600                                                                  00060064
000700*THIS PROGRAM WILL READ PREVIOUSLY EXTRACTED FILES, LOOK UP       00070064
000800*RFID CARTON AND UNIT DATA, UPDATE INPUT RECORDS AND WRITE THEM   00080064
000900* BACK OUT. BOTH INPUT AND OUTPUT FILES USE PCRD068 COPYBOOK.     00090064
001000* IF A VENDOR IS TAGGING OR COMPLIANT ANY PO'S FOR THEM WILL NOT  00100064
001100* LOOKUP OR INCLUDE THEIR RFID QTYS.                              00110064
001200*                                                                 00120064
001300* OCTOBER, 2015  CHG0125072  (FIND '125072' TO SEE CHANGES)       00130064
001400* REWRITING SELECT IN PARA 3000-RET-CARTON-QTY TO GET CARTON      00140064
001500* AND UNIT QTYS BY STORE (FOR RFID STORES ONLY).                  00150064
001600* ADDED LINE NBR TO SQL CALL IN PARA 3050-RET-PBS-CARTON-QTY      00160064
001700* TO LINK TRECDIS AND TSHUUPC TABLES.  THIS WILL ELIMINATE        00170064
001800* TABLE SPACE SCANNING AND GREATLY REDUCE CPU AND ELAPSED TIMES.  00180064
001900*                                                                 00190064
002000 ENVIRONMENT DIVISION.                                            00200064
002100 INPUT-OUTPUT SECTION.                                            00210064
002200                                                                  00220064
002300 FILE-CONTROL.                                                    00230064
002400     SELECT TRIP-EXTRACT-FILE-IN1   ASSIGN TO INP01.              00240064
002500     SELECT TRIP-EXTRACT-FILE-IN2   ASSIGN TO INP02.              00250064
002600     SELECT TRIP-EXTRACT-FILE1      ASSIGN TO OUT01.              00260064
002700     SELECT TRIP-EXTRACT-FILE2      ASSIGN TO OUT02.              00270064
002800                                                                  00280064
002900 DATA DIVISION.                                                   00290064
003000 FILE SECTION.                                                    00300064
003100                                                                  00310064
003200 FD  TRIP-EXTRACT-FILE-IN1                                        00320064
003300     RECORDING MODE IS F                                          00330064
003400     LABEL RECORDS ARE STANDARD                                   00340064
003500     BLOCK CONTAINS 0 RECORDS.                                    00350064
003600                                                                  00360064
003700 01  TRIP-EXTRACT-RECORD-IN1          PIC X(400).                 00370064
003800                                                                  00380064
003900 FD  TRIP-EXTRACT-FILE-IN2                                        00390064
004000     RECORDING MODE IS F                                          00400064
004100     LABEL RECORDS ARE STANDARD                                   00410064
004200     BLOCK CONTAINS 0 RECORDS.                                    00420064
004300                                                                  00430064
004400 01  TRIP-EXTRACT-RECORD-IN2          PIC X(400).                 00440064
004500                                                                  00450064
004600 FD  TRIP-EXTRACT-FILE1                                           00460064
004700     RECORDING MODE IS F                                          00470064
004800     LABEL RECORDS ARE STANDARD                                   00480064
004900     BLOCK CONTAINS 0 RECORDS.                                    00490064
005000                                                                  00500064
005100 01  TRIP-EXTRACT-RECORD1             PIC X(400).                 00510064
005200                                                                  00520064
005300 FD  TRIP-EXTRACT-FILE2                                           00530064
005400     RECORDING MODE IS F                                          00540064
005500     LABEL RECORDS ARE STANDARD                                   00550064
005600     BLOCK CONTAINS 0 RECORDS.                                    00560064
005700                                                                  00570064
005800 01  TRIP-EXTRACT-RECORD2             PIC X(400).                 00580064
005900                                                                  00590064
006000 WORKING-STORAGE SECTION.                                         00600064
006100                                                                  00610064
006200 01  WS-PROGRAM-SWITCHES.                                         00620064
006300     05  WS-END-INP01-SW              PIC X(1)   VALUE 'N'.       00630064
006400         88  WS-END-INP01-FILE                   VALUE 'Y'.       00640064
006500     05  WS-END-INP02-SW              PIC X(1)   VALUE 'N'.       00650064
006600         88  WS-END-INP02-FILE                   VALUE 'Y'.       00660064
006610     05  PS-EAS-EXECUTE-BYPASS-SW        PIC  X(01)  VALUE 'N'.   00661064
006620         88  PS-EAS-EXECUTE-BYPASS-YES               VALUE 'Y'.   00662064
006630         88  PS-EAS-EXECUTE-BYPASS-NO                VALUE 'N'.   00663064
006640     05  PS-EAS-SEASET-BYPASS-SW         PIC  X(01)  VALUE 'N'.   00664064
006650         88  PS-EAS-SEASET-BYPASS-YES                VALUE 'Y'.   00665064
006660         88  PS-EAS-SEASET-BYPASS-NO                 VALUE 'N'.   00666064
006670     05  PS-EAS-PO-BYPASS-SW             PIC  X(01)  VALUE 'N'.   00667064
006680         88  PS-EAS-PO-BYPASS-YES                    VALUE 'Y'.   00668064
006690         88  PS-EAS-PO-BYPASS-NO                     VALUE 'N'.   00669064
006700                                                                  00670064
006800 01  WS-PROGRAM-VARIABLES.                                        00680064
006900     05  WS-SQLCODE                   PIC 9(9)    VALUE ZERO.     00690064
007000     05  WS-DISPLAY-NUMBER            PIC 9999999999.             00700064
007100     05  WS-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            00710064
007200     05  WS-WRITE-COUNT               PIC S9(9)   COMP-3          00720064
007300                                                  VALUE ZEROS.    00730064
007400     05  WS-OPER-UNT-ID               PIC S9(04) COMP SYNC        00740064
007500                                                    VALUE ZERO.   00750064
007600     05  WS-WRITE-COUNT2              PIC S9(9)  COMP-3 VALUE 0.  00760064
007700     05  WS-RFID-CART-QTY             PIC S9(9)  COMP-3 VALUE 0.  00770064
007800     05  WS-RFID-UNIT-QTY             PIC S9(9)  COMP-3 VALUE 0.  00780064
007810     05  WS-EAS-CART-QTY              PIC S9(9)  COMP-3 VALUE 0.  00781064
007820     05  WS-EAS-UNIT-QTY              PIC S9(9)  COMP-3 VALUE 0.  00782064
007830     05  PV-REMAINDER                 PIC 9(09) VALUE ZEROS.      00783064
007840     05  PV-TOTAL-DTL-RATIO           PIC S9(04) COMP VALUE +0.   00784064
007850     05  PV-EAS-CTN-CNT               PIC S9(09) COMP-3.          00785064
007860     05  PV-EAS-UNT-CNT               PIC S9(09) COMP-3.          00786064
007861     05  PV-NUMERIC-PO-NBR            PIC 9999999999.             00786165
007870     05  PV-DEPT-NBR-X.                                           00787064
007880         10  PV-DEPT-NBR-N            PIC 9(03) VALUE ZERO.       00788064
007890     05  PV-VNDR-TAGGING-OR-COMP-SW   PIC X      VALUE 'N'.       00789064
007900       88 PV-VNDR-NOT-TAGGING-OR-COMP            VALUE 'N'.       00790064
008000       88 PV-VNDR-TAGGING-OR-COMP                VALUE 'Y'.       00800064
008100     05  PV-RFID-DC-SW                PIC X(1)   VALUE 'N'.       00810064
008200         88  PV-RFID-DC-NO                       VALUE 'N'.       00820064
008300         88  PV-RFID-DC-YES                      VALUE 'Y'.       00830064
008400     05  PV-EAS-DC-SW                 PIC X(1)   VALUE 'N'.       00840064
008500         88  PV-EAS-DC-NO                        VALUE 'N'.       00850064
008600         88  PV-EAS-DC-YES                       VALUE 'Y'.       00860064
008610     05  PV-EAS-TAGGING-FOR-DEPT-SW   PIC X      VALUE 'N'.       00861064
008620       88 PV-EAS-TAGGING-FOR-DEPT-NO             VALUE 'N'.       00862064
008630       88 PV-EAS-TAGGING-FOR-DEPT-YES            VALUE 'Y'.       00863064
008640     05  PV-ABEND-PARAGRAPH           PIC X(32)  VALUE SPACE.     00864064
008650                                                                  00865064
008660 01  DK-KEYS.                                                     00866064
008670     05  DK-OPER-UNT-ID               PIC S9(4) COMP.             00867064
008680     05  DK-DEPT-NBR                  PIC S9(4)V COMP-3.          00868064
008681     05  DK-PO-NBR                    PIC S9(9) COMP.             00868164
008690                                                                  00869064
008700 01  PC-PROGRAM-CONSTANTS.                                        00870064
008800     05  PC-PROGRAM-NAME              PIC X(08)  VALUE 'PCKUT108'.00880064
008900 01  WS-ABEND-FIELDS.                                             00890064
009000     05  WS-ABEND-CODE                PIC S9(04)   VALUE ZERO.    00900064
009100     05  WS-ABEND-PROGRAM             PIC X(8)   VALUE 'PCKUT108'.00910064
009200     05  WS-ABEND-PARAGRAPH           PIC X(50)  VALUE SPACES.    00920064
009300     05  WS-ABEND-OPERATION           PIC X(50)  VALUE SPACES.    00930064
009400     05  WS-ABEND-STRUCTURE-1         PIC X(15)  VALUE SPACES.    00940064
009500     05  WS-ABEND-STRUCTURE-2         PIC X(15)  VALUE SPACES.    00950064
009600     05  WS-ABEND-STRUCTURE-3         PIC X(15)  VALUE SPACES.    00960064
009700     05  WS-ABEND-STRUCTURE-4         PIC X(15)  VALUE SPACES.    00970064
009800     05  WS-ABEND-STRUCTURE-5         PIC X(15)  VALUE SPACES.    00980064
009900     05  WS-ABEND-STRUCTURE-6         PIC X(15)  VALUE SPACES.    00990064
010000     05  WS-ABEND-STRUCTURE-7         PIC X(15)  VALUE SPACES.    01000064
010100     05  WS-ABEND-STATUS              PIC XX     VALUE SPACES.    01010064
010200     05  WS-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01020064
010300     05  WS-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01030064
010400     05  WS-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01040064
010500     05  WS-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01050064
010600                                                                  01060064
010700/                                                                 01070064
010800******************************************************************01080064
010900*    EXPORT EXTRACT FILE LAYOUT                                   01090064
011000******************************************************************01100064
011100     COPY PCRD068.                                                01110064
011200                                                                  01120064
011300******************************************************************01130064
011400*    DCLGEN FOR RC-PACK SLIP TABLE                                01140064
011500******************************************************************01150064
011600     EXEC SQL                                                     01160064
011700         INCLUDE TPKSLIP                                          01170064
011800     END-EXEC                                                     01180064
011900                                                                  01190064
012000******************************************************************01200064
012100*    DCLGEN FOR SU-INBOUND EDI PCKLST/VEND SHIPMENT UNIT ASSOC    01210064
012200******************************************************************01220064
012300     EXEC SQL                                                     01230064
012400         INCLUDE TINPKSU                                          01240064
012500     END-EXEC                                                     01250064
012600                                                                  01260064
012700******************************************************************01270064
012800*    DCLGEN FOR SU-SHIPMENT UNIT/UPC ASSOCIATION                  01280064
012900******************************************************************01290064
013000     EXEC SQL                                                     01300064
013100         INCLUDE TSHUUPC                                          01310064
013200     END-EXEC                                                     01320064
013300                                                                  01330064
013400******************************************************************01340064
013500*    DCLGEN FOR TRECDIS TABLE                                     01350064
013600******************************************************************01360064
013700     EXEC SQL                                                     01370064
013800         INCLUDE TRECDIS                                          01380064
013900     END-EXEC                                                     01390064
014000                                                                  01400064
014100******************************************************************01410064
014200*    DCLGEN FOR TSHPUNT TABLE                                     01420064
014300******************************************************************01430064
014400     EXEC SQL                                                     01440064
014500         INCLUDE TSHPUNT                                          01450064
014600     END-EXEC                                                     01460064
014700                                                                  01470064
014800******************************************************************01480064
014900*    DCLGEN FOR RC-RECEIPT ITEM TABLE                             01490064
015000******************************************************************01500064
015100     EXEC SQL                                                     01510064
015200         INCLUDE TRECITM                                          01520064
015300     END-EXEC                                                     01530064
015400                                                                  01540064
015500******************************************************************01550064
015600*    DCLGEN FOR SU-RADIO FREQUENCY VERIFICATION TABLE             01560064
015700******************************************************************01570064
015800*    (RIT_RFID_VRFN)                                              01580064
015900     EXEC SQL                                                     01590064
016000         INCLUDE RIT00000                                         01600064
016100     END-EXEC                                                     01610064
016200******************************************************************01620064
016300*   DB2 DCLGEN FOR TPURCHS - PO-PURCHASE TABLE                    01630064
016400******************************************************************01640064
016500     EXEC SQL                                                     01650064
016600          INCLUDE TPURCHS                                         01660064
016700     END-EXEC.                                                    01670064
016800                                                                  01680064
016900******************************************************************01690064
017000*   DB2 DCLGEN FOR TVNDAGR - PO-PURCHASE TABLE                    01700064
017100******************************************************************01710064
017200     EXEC SQL                                                     01720064
017300          INCLUDE TVNDAGR                                         01730064
017400     END-EXEC.                                                    01740064
017500                                                                  01750064
017600******************************************************************01760064
017700*   DB2 DCLGEN FOR SUT_TRLR_RPLN_CART                             01770064
017800******************************************************************01780064
017900     EXEC SQL                                                     01790064
018000          INCLUDE SUT00113                                        01800064
018100     END-EXEC.                                                    01810064
018200                                                                  01820064
018300******************************************************************01830064
018400*   DB2 DCLGEN FOR SUT_OTBND_CART - OUTBOUND CARTON               01840064
018500******************************************************************01850064
018600     EXEC SQL                                                     01860064
018700          INCLUDE SUT00024                                        01870064
018800     END-EXEC.                                                    01880064
018900                                                                  01890064
019000******************************************************************01900064
019100*   DB2 DCLGEN FOR SUT_OTBND_UPC  - OUTBOUND UPC                  01910064
019200******************************************************************01920064
019300     EXEC SQL                                                     01930064
019400          INCLUDE SUT00028                                        01940064
019500     END-EXEC.                                                    01950064
019600                                                                  01960064
019700******************************************************************01970064
019800*   DB2 DCLGEN FOR TKRPRPM - DC PROCESSING PARAMETER TABLE        01980064
019810******************************************************************01981064
019820     EXEC SQL                                                     01982064
019830          INCLUDE TKRPRPM                                         01983064
019840     END-EXEC.                                                    01984064
019850                                                                  01985064
019862******************************************************************01986239
019863*  DCLGEN FOR INTEGRATION TABLE WST_ATTR_ELEM                     01986339
019864******************************************************************01986439
019865     EXEC SQL                                                     01986539
019866         INCLUDE WST00010                                         01986639
019867     END-EXEC.                                                    01986739
019868                                                                  01986839
019869******************************************************************01986939
019870*  DCLGEN FOR INTEGRATION TABLE WST_INTGRTN_TYP                   01987039
019871******************************************************************01987139
019872     EXEC SQL                                                     01987239
019873         INCLUDE WST00008                                         01987339
019874     END-EXEC.                                                    01987439
019875                                                                  01987539
019876******************************************************************01987639
019877*  DCLGEN FOR INTEGRATION TABLE WST_ATTR_DEFN                     01987739
019878******************************************************************01987839
019879     EXEC SQL                                                     01987939
019880         INCLUDE WST00009                                         01988039
019881     END-EXEC.                                                    01988139
019900                                                                  01990000
019910******************************************************************01991050
019920*  DCLGEN FOR LOGISTICS DOMAIN SKU TABLE (XLT_SKU)                01992050
019930******************************************************************01993050
019940     EXEC SQL                                                     01994050
019950         INCLUDE XLT00003                                         01995050
019960     END-EXEC.                                                    01996050
019970                                                                  01997050
019980******************************************************************01998050
019990*  DCLGEN FOR LOGISTICS DOMAIN VENDOR STYLE TABLE (XLT_VND_STYL)  01999050
019991******************************************************************01999150
019992     EXEC SQL                                                     01999250
019993         INCLUDE XLT00004                                         01999350
019994     END-EXEC.                                                    01999450
019995                                                                  01999550
019996******************************************************************01999650
019997*  DCLGEN FOR LOGISTICS DOMAIN UPC TABLE (XLT_UPC)                01999750
019998******************************************************************01999850
019999     EXEC SQL                                                     01999950
020000         INCLUDE XLT00006                                         02000050
020001     END-EXEC.                                                    02000150
020002                                                                  02000250
020010*  USED FOR DB2 ERROR MESSAGE BUILDING                            02001050
020100     COPY DPWS004.                                                02010000
020200                                                                  02020000
020300*   DB2 SQL COMMUNICATION AREA                                    02030000
020400     EXEC SQL                                                     02040000
020500          INCLUDE SQLCA                                           02050000
020600     END-EXEC.                                                    02060000
020700/                                                                 02070000
020800 PROCEDURE DIVISION.                                              02080000
020900                                                                  02090000
021000     PERFORM 1000-INIT.                                           02100000
021100                                                                  02110000
021200     PERFORM 2000-MAIN-PROCESS.                                   02120000
021300                                                                  02130000
021400     PERFORM 9000-TERMINATE.                                      02140000
021500                                                                  02150000
021600     GOBACK.                                                      02160000
021700                                                                  02170000
021800 1000-INIT.                                                       02180000
021900     MOVE '1000-INIT'         TO PV-ABEND-PARAGRAPH.              02190000
022000                                                                  02200000
022100     OPEN INPUT TRIP-EXTRACT-FILE-IN1                             02210000
022200                TRIP-EXTRACT-FILE-IN2.                            02220000
022300     OPEN OUTPUT TRIP-EXTRACT-FILE1                               02230000
022400                 TRIP-EXTRACT-FILE2.                              02240000
022401                                                                  02240164
022410     PERFORM 8905-CHECK-BYPASS-PARM.                              02241064
022500                                                                  02250000
022600 2000-MAIN-PROCESS.                                               02260000
022700     MOVE '2000-MAIN-PROCESS' TO PV-ABEND-PARAGRAPH.              02270000
022800                                                                  02280000
022900     PERFORM 7000-READ-INPUT-REC1.                                02290000
023000     PERFORM 2100-PROCESS-INPUT1-FILE                             02300000
023100       UNTIL WS-END-INP01-FILE.                                   02310000
023200                                                                  02320000
023300     PERFORM 7100-READ-INPUT-REC2.                                02330000
023400     PERFORM 2200-PROCESS-INPUT2-FILE                             02340000
023500       UNTIL WS-END-INP02-FILE.                                   02350000
023600                                                                  02360000
023700 2100-PROCESS-INPUT1-FILE.                                        02370000
023800     MOVE '2100-PROCESS-INPUT1-FILE' TO PV-ABEND-PARAGRAPH.       02380000
023900     IF RIT00000-DC-LOC-NBR = PC068-OPER-UNT-ID                   02390000
024000       NEXT SENTENCE                                              02400000
024100     ELSE                                                         02410000
024200       SET PV-RFID-DC-NO TO TRUE                                  02420000
024300       MOVE PC068-OPER-UNT-ID TO RIT00000-DC-LOC-NBR              02430000
024400       PERFORM 3200-RETRIEVE-RFID-DC                              02440000
024410       MOVE PC068-OPER-UNT-ID TO DK-OPER-UNT-ID                   02441039
024420       PERFORM 3300-RETRIEVE-EAS-DC                               02442039
024500     END-IF.                                                      02450000
024600     IF PC068-EFC-NBR > 0                                         02460000
024700* WE DO NOT WANT EFC CARTONS INCLUDED IN RFID TOTALS IF THEY      02470000
024800* ARE NOT MARKED AS RFID TAGGING ON RFID TABLE.                   02480000
024900       MOVE PC068-EFC-NBR TO RIT00000-DC-LOC-NBR                  02490000
025000       PERFORM 3200-RETRIEVE-RFID-DC                              02500000
025001       MOVE PC068-EFC-NBR TO DK-OPER-UNT-ID                       02500140
025002       PERFORM 3300-RETRIEVE-EAS-DC                               02500240
025100     END-IF.                                                      02510000
025200     SET PV-VNDR-NOT-TAGGING-OR-COMP TO TRUE.                     02520000
025300     MOVE PC068-ENT-ID TO VNDAGR-ENT-ID.                          02530000
025400     PERFORM 4100-CHECK-FOR-VENDOR.                               02540000
025500* ONLY LOOKUP RFID QTYS FOR VENDORS NOT TAGGING OR COMPLIANT      02550000
025600                                                                  02560000
025700     MOVE PC068-PO-NBR TO PKSLIP-PO-NBR                           02570000
025800                          RECDIS-ORD-NBR.                         02580000
025900     MOVE PC068-PO-LNE-NBR TO SHUUPC-TRN-LNE-NBR                  02590000
026000                              RECDIS-ORD-LNE-NBR.                 02600000
026100     MOVE PC068-OPER-UNT-ID TO RECDIS-OPER-UNT-ID.                02610000
026200     MOVE PC068-DEPT-NBR    TO RIT00000-DEPT-NBR.                 02620000
026300     MOVE PC068-REC-SEQ-NBR TO PKSLIP-REC-SEQ-NBR                 02630000
026400                               RECDIS-REC-SEQ-NBR.                02640000
026420                                                                  02642052
026600     IF PV-VNDR-NOT-TAGGING-OR-COMP                               02660000
026700       AND PV-RFID-DC-YES                                         02670000
026800       IF PC068-PBS-IND = 'Y'                                     02680000
026900         PERFORM 3050-RET-PBS-CARTON-QTY                          02690000
027000       ELSE                                                       02700000
027100         PERFORM 3000-RET-CARTON-QTY                              02710000
027200       END-IF                                                     02720000
027300     ELSE                                                         02730000
027400       MOVE ZERO TO PC068-RFID-CTN-CNT                            02740000
027500       MOVE ZERO TO PC068-RFID-UNT-CNT                            02750000
027600     END-IF.                                                      02760000
027601                                                                  02760140
027610* CHECK IF VENDOR AND DEPARTMENT ARE DOING EAS TAGGING.           02761040
027620     IF PV-EAS-DC-YES                                             02762040
027621       SET PV-EAS-TAGGING-FOR-DEPT-NO TO TRUE                     02762165
027630       PERFORM 3400-CHK-EAS-TAGGING                               02763040
027640     END-IF.                                                      02764040
027641                                                                  02764140
027644     IF PV-EAS-TAGGING-FOR-DEPT-YES                               02764440
027645       IF PC068-PBS-IND = 'Y'                                     02764540
027646         PERFORM 3060-RET-PBS-CARTON-QTY-EAS                      02764640
027647       ELSE                                                       02764740
027648         PERFORM 3020-RET-CARTON-QTY-EAS                          02764840
027649       END-IF                                                     02764940
027652     END-IF.                                                      02765240
027653                                                                  02765340
027700     PERFORM 8000-WRITE-OUTPUT-REC1.                              02770000
027800     PERFORM 7000-READ-INPUT-REC1.                                02780000
027900                                                                  02790000
028000 2200-PROCESS-INPUT2-FILE.                                        02800000
028100     IF RIT00000-DC-LOC-NBR = PC068-OPER-UNT-ID                   02810000
028200       NEXT SENTENCE                                              02820000
028300     ELSE                                                         02830000
028400       SET PV-RFID-DC-NO TO TRUE                                  02840000
028500       MOVE PC068-OPER-UNT-ID TO RIT00000-DC-LOC-NBR              02850000
028600       PERFORM 3200-RETRIEVE-RFID-DC                              02860000
028611       MOVE PC068-OPER-UNT-ID TO DK-OPER-UNT-ID                   02861146
028612       PERFORM 3300-RETRIEVE-EAS-DC                               02861246
028700     END-IF.                                                      02870000
028800     IF PC068-EFC-NBR > 0                                         02880000
028900* WE DO NOT WANT EFC CARTONS INCLUDED IN RFID TOTALS              02890000
029000       MOVE PC068-EFC-NBR TO RIT00000-DC-LOC-NBR                  02900000
029100       PERFORM 3200-RETRIEVE-RFID-DC                              02910000
029101       MOVE PC068-EFC-NBR TO DK-OPER-UNT-ID                       02910146
029120       PERFORM 3300-RETRIEVE-EAS-DC                               02912046
029200       DISPLAY 'ECOM CARTON1- ' PC068-PO-NBR ' '                  02920046
029300       PC068-REC-SEQ-NBR ' ' PC068-DEPT-NBR                       02930000
029400     END-IF.                                                      02940000
029500     IF PV-RFID-DC-YES                                            02950000
029600       MOVE '2200-PROCESS-INPUT2-FILE' TO PV-ABEND-PARAGRAPH      02960000
029700       MOVE PC068-SCAC   TO SUT00113-SCAC-CDE                     02970000
029800       MOVE PC068-TRLR-NBR TO SUT00113-VEH-NBR                    02980000
029900       MOVE PC068-TRIP-ID TO SUT00113-INBND-TRIP-ID               02990000
030000       MOVE PC068-OPER-UNT-ID TO SUT00024-ORGN-LOC-NBR            03000000
030100       PERFORM 3100-RETRIEVE-REPL-CART-QTY                        03010000
030200     END-IF.                                                      03020000
030201                                                                  03020147
030210* CHECK IF VENDOR AND DEPARTMENT ARE DOING EAS TAGGING.           03021047
030220     IF PV-EAS-DC-YES                                             03022047
030230       PERFORM 3400-CHK-EAS-TAGGING                               03023047
030240     END-IF.                                                      03024047
030250                                                                  03025047
030262     IF PV-EAS-TAGGING-FOR-DEPT-YES                               03026260
030263       MOVE '2200-PROCESS-INPUT2-FILE' TO PV-ABEND-PARAGRAPH      03026360
030264       MOVE PC068-SCAC   TO SUT00113-SCAC-CDE                     03026460
030265       MOVE PC068-TRLR-NBR TO SUT00113-VEH-NBR                    03026560
030266       MOVE PC068-TRIP-ID TO SUT00113-INBND-TRIP-ID               03026660
030267       MOVE PC068-OPER-UNT-ID TO SUT00024-ORGN-LOC-NBR            03026760
030268       PERFORM 3150-FETCH-REPL-CART-QTY-EAS                       03026860
030293     END-IF.                                                      03029347
030294                                                                  03029447
030300     PERFORM 8100-WRITE-OUTPUT-REC2.                              03030000
030400     PERFORM 7100-READ-INPUT-REC2.                                03040000
030500                                                                  03050000
030600 3000-RET-CARTON-QTY.                                             03060029
030700     MOVE '3000-RET-CARTON-QTY' TO PV-ABEND-PARAGRAPH.            03070029
030800                                                                  03080029
030900     EXEC SQL                                                     03090030
031000       SELECT  COALESCE(SUM(D.EXPTED_ITM_QTY),0)                  03100028
031100         INTO :RECDIS-EXPTED-ITM-QTY                              03110028
031200         FROM  TRECDIS          D                                 03120028
031300            ,  RIT_RFID_VRFN    R                                 03130028
031400        WHERE  D.ORD_NBR        = :RECDIS-ORD-NBR                 03140028
031500          AND  D.ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR             03150028
031600          AND  D.REC_SEQ_NBR    = :RECDIS-REC-SEQ-NBR             03160028
031800          AND  R.STR_NBR       IN(D.STR_NBR, 0)                   03180028
031900          AND  R.RFID_LVL_CDE   = 'STRDPT'                        03190028
032000          AND  R.DEPT_NBR       = :RIT00000-DEPT-NBR              03200028
032100          AND (CURRENT DATE BETWEEN DATE(R.EFF_STRT_TMST)         03210028
032200          AND  DATE(R.EFF_END_TMST))                              03220028
032300      WITH UR                                                     03230028
032400     END-EXEC.                                                    03240030
032500                                                                  03250030
032600     EVALUATE TRUE                                                03260030
032700         WHEN SQLCODE = ZERO                                      03270028
032800             MOVE RECDIS-EXPTED-ITM-QTY TO  PC068-RFID-UNT-CNT    03280028
032900             IF RECDIS-EXPTED-ITM-QTY > 0                         03290028
033000               IF PC068-OTPK-QTY > 0                              03300028
033100                 DIVIDE RECDIS-EXPTED-ITM-QTY BY PC068-OTPK-QTY   03310028
033200                   GIVING PC068-RFID-CTN-CNT                      03320028
033300                   REMAINDER PV-REMAINDER                         03330028
033400                   IF PV-REMAINDER  > ZERO                        03340028
033500                     ADD +1 TO PC068-RFID-CTN-CNT                 03350028
033600                   END-IF                                         03360028
033700                   IF PC068-PKG-TYPE = 'M'                        03370030
033800                       PERFORM 3010-CALC-MULTI-PACK-UNITS         03380030
033900                   END-IF                                         03390030
034000               ELSE                                               03400028
034100***              DEFAULT PACK SIZE = 1                            03410028
034200                 MOVE RECDIS-EXPTED-ITM-QTY TO PC068-RFID-CTN-CNT 03420028
034300               END-IF                                             03430028
034400             ELSE                                                 03440028
034500               MOVE ZERO TO PC068-RFID-CTN-CNT                    03450028
034600             END-IF                                               03460028
034700         WHEN SQLCODE = +100                                      03470028
034800             MOVE ZERO TO PC068-RFID-CTN-CNT                      03480028
034900             MOVE ZERO TO PC068-RFID-UNT-CNT                      03490028
035000         WHEN OTHER                                               03500028
035100             MOVE '3000-RET-CARTON-QTY' TO  WS-ABEND-PARAGRAPH    03510030
035200             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03520028
035300             MOVE 'TRECDIS'       TO WS-ABEND-STRUCTURE-1         03530028
035400             MOVE 'RIT_RFID_VRFN' TO WS-ABEND-STRUCTURE-2         03540028
035500             PERFORM 9900-DB2-ABEND                               03550028
035600     END-EVALUATE.                                                03560030
035700                                                                  03570030
035800 3010-CALC-MULTI-PACK-UNITS.                                      03580030
035900     MOVE '3010-CALC-MULTI-PACK-UNITS' TO PV-ABEND-PARAGRAPH.     03590030
036000     EXEC SQL                                                     03600030
036100       SELECT  DISTINCT SUM(A.PREPK_RATO_QTY)                     03610033
036200         INTO :PV-TOTAL-DTL-RATIO                                 03620030
036300         FROM  TRECITM          A                                 03630030
036400        WHERE  A.ORD_NBR        = :RECDIS-ORD-NBR                 03640030
036500          AND  A.REC_SEQ_NBR    = :RECDIS-REC-SEQ-NBR             03650030
036600          AND  A.PREPK_ID       = :PC068-PACK-ID                  03660030
036700      WITH UR                                                     03670030
036800     END-EXEC.                                                    03680030
036900                                                                  03690030
037000     EVALUATE TRUE                                                03700030
037100         WHEN SQLCODE = ZERO                                      03710030
037200             MULTIPLY PC068-RFID-CTN-CNT                          03720034
037300               BY PV-TOTAL-DTL-RATIO GIVING PC068-RFID-UNT-CNT    03730030
037400         WHEN SQLCODE = +100                                      03740035
037500             CONTINUE                                             03750030
037600         WHEN SQLCODE = -305                                      03760030
037700             CONTINUE                                             03770030
037800         WHEN OTHER                                               03780030
037900             MOVE '3010-CALC-MULTI-PACK-UNITS'                    03790030
038000                                  TO WS-ABEND-PARAGRAPH           03800030
038100             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03810030
038200             MOVE 'TRECITM'       TO WS-ABEND-STRUCTURE-1         03820030
038300             PERFORM 9900-DB2-ABEND                               03830030
038400     END-EVALUATE.                                                03840030
038500                                                                  03850019
038510 3020-RET-CARTON-QTY-EAS.                                         03851040
038520     MOVE '3020-RET-CARTON-QTY-EAS' TO PV-ABEND-PARAGRAPH.        03852040
038530                                                                  03853040
038540     EXEC SQL                                                     03854040
038550       SELECT  COALESCE(SUM(D.EXPTED_ITM_QTY),0)                  03855040
038560         INTO :RECDIS-EXPTED-ITM-QTY                              03856040
038570         FROM  TRECDIS          D                                 03857040
038590        WHERE  D.ORD_NBR        = :RECDIS-ORD-NBR                 03859040
038591          AND  D.ORD_LNE_NBR    = :RECDIS-ORD-LNE-NBR             03859140
038592          AND  D.REC_SEQ_NBR    = :RECDIS-REC-SEQ-NBR             03859240
038599      WITH UR                                                     03859940
038600     END-EXEC.                                                    03860040
038601                                                                  03860140
038602     EVALUATE TRUE                                                03860240
038603         WHEN SQLCODE = ZERO                                      03860340
038605             IF RECDIS-EXPTED-ITM-QTY > 0                         03860540
038606               IF PC068-OTPK-QTY > 0                              03860640
038607                 DIVIDE RECDIS-EXPTED-ITM-QTY BY PC068-OTPK-QTY   03860740
038608                   GIVING PV-EAS-CTN-CNT                          03860840
038609                   REMAINDER PV-REMAINDER                         03860940
038610                   IF PV-REMAINDER  > ZERO                        03861040
038611                     ADD +1 TO PV-EAS-CTN-CNT                     03861140
038612                   END-IF                                         03861240
038613                   ADD PV-EAS-CTN-CNT   TO PC068-RFID-CTN-CNT     03861340
038614                   IF PC068-PKG-TYPE = 'M'                        03861440
038615                       PERFORM 3030-CALC-MULTI-PACK-UNITS-EAS     03861540
038616                   ELSE                                           03861651
038617                       ADD  RECDIS-EXPTED-ITM-QTY                 03861751
038618                                        TO  PC068-RFID-UNT-CNT    03861851
038619                   END-IF                                         03861940
038620               ELSE                                               03862040
038621***              DEFAULT PACK SIZE = 1                            03862140
038622                 ADD  RECDIS-EXPTED-ITM-QTY TO PC068-RFID-CTN-CNT 03862240
038623               END-IF                                             03862340
038624             END-IF                                               03862440
038625         WHEN SQLCODE = +100                                      03862540
038626             CONTINUE                                             03862640
038627         WHEN OTHER                                               03862740
038628             MOVE '3020-RET-CARTON-QTY-EAS' TO  WS-ABEND-PARAGRAPH03862840
038629             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03862940
038630             MOVE 'TRECDIS'       TO WS-ABEND-STRUCTURE-1         03863040
038631             PERFORM 9900-DB2-ABEND                               03863140
038632     END-EVALUATE.                                                03863240
038633                                                                  03863340
038634 3030-CALC-MULTI-PACK-UNITS-EAS.                                  03863440
038635     MOVE '3030-CALC-MULTI-PACK-UNITS-EAS' TO PV-ABEND-PARAGRAPH. 03863562
038636     EXEC SQL                                                     03863640
038637       SELECT  DISTINCT SUM(A.PREPK_RATO_QTY)                     03863740
038638         INTO :PV-TOTAL-DTL-RATIO                                 03863840
038639         FROM  TRECITM          A                                 03863940
038640        WHERE  A.ORD_NBR        = :RECDIS-ORD-NBR                 03864040
038641          AND  A.REC_SEQ_NBR    = :RECDIS-REC-SEQ-NBR             03864140
038642          AND  A.PREPK_ID       = :PC068-PACK-ID                  03864240
038643      WITH UR                                                     03864340
038644     END-EXEC.                                                    03864440
038645                                                                  03864540
038646     EVALUATE TRUE                                                03864640
038647         WHEN SQLCODE = ZERO                                      03864740
038648             MULTIPLY PC068-RFID-CTN-CNT                          03864840
038649               BY PV-TOTAL-DTL-RATIO GIVING PV-EAS-UNT-CNT        03864951
038650             ADD PV-EAS-UNT-CNT   TO PC068-RFID-UNT-CNT           03865051
038651         WHEN SQLCODE = +100                                      03865151
038652             CONTINUE                                             03865251
038653         WHEN SQLCODE = -305                                      03865351
038654             CONTINUE                                             03865451
038655         WHEN OTHER                                               03865551
038656             MOVE '3030-CALC-MULTI-PACK-UNITS-EAS'                03865662
038657                                  TO WS-ABEND-PARAGRAPH           03865751
038658             MOVE 'SELECT'        TO WS-ABEND-OPERATION           03865851
038659             MOVE 'TRECITM'       TO WS-ABEND-STRUCTURE-1         03865951
038660             PERFORM 9900-DB2-ABEND                               03866051
038661     END-EVALUATE.                                                03866151
038662                                                                  03866251
038670 3050-RET-PBS-CARTON-QTY.                                         03867019
038700     MOVE '3050-RET-PBS-CARTON-QTY' TO PV-ABEND-PARAGRAPH.        03870000
038800                                                                  03880000
038900     MOVE PC068-DEPT-NBR TO RIT00000-DEPT-NBR                     03890000
039000     EXEC SQL                                                     03900000
039100       SELECT  COUNT(DISTINCT U.SHIPT_UNT_ID)                     03910000
039200       INTO :WS-RFID-CART-QTY                                     03920000
039300       FROM RIT_RFID_VRFN F                                       03930000
039400           ,RIT_RFID_VRFN G                                       03940000
039500           ,TRECDIS T                                             03950000
039600           ,TSHPUNT D                                             03960000
039700           ,TSHUUPC U                                             03970000
039800       WHERE F.DEPT_NBR = :RIT00000-DEPT-NBR                      03980000
039900         AND F.STR_NBR = 0                                        03990000
040000         AND F.SUB_CL_NBR = 0                                     04000000
040100         AND F.MAJ_CL_NBR = 0                                     04010000
040200         AND F.RFID_LVL_CDE = 'DPTSCL'                            04020000
040300         AND CURRENT DATE BETWEEN DATE(F.EFF_STRT_TMST)           04030000
040400          AND DATE(F.EFF_END_TMST)                                04040000
040500         AND G.STR_NBR = T.STR_NBR                                04050000
040600         AND G.DEPT_NBR = :RIT00000-DEPT-NBR                      04060000
040700         AND G.SUB_CL_NBR = 0                                     04070000
040800         AND G.MAJ_CL_NBR = 0                                     04080000
040900         AND G.RFID_LVL_CDE = 'STRDPT'                            04090000
041000         AND CURRENT DATE BETWEEN DATE(G.EFF_STRT_TMST)           04100000
041100          AND DATE(G.EFF_END_TMST)                                04110000
041200         AND T.ORD_NBR          = :RECDIS-ORD-NBR                 04120026
041300         AND T.REC_SEQ_NBR      = :RECDIS-REC-SEQ-NBR             04130026
041400         AND T.OPER_UNT_ID      = :RECDIS-OPER-UNT-ID             04140026
041600         AND U.TRN_NBR          = T.ORD_NBR                       04160026
041700         AND U.TRN_LNE_NBR      = T.ORD_LNE_NBR                   04170028
041800         AND D.DEST_OPER_UNT_ID = T.STR_NBR                       04180000
041900         AND D.SHIPT_UNT_ID     = U.SHIPT_UNT_ID                  04190026
042000       WITH UR                                                    04200000
042100     END-EXEC.                                                    04210000
042200                                                                  04220000
042300     EVALUATE TRUE                                                04230000
042400         WHEN SQLCODE = ZERO                                      04240000
042500             MOVE WS-RFID-CART-QTY TO PC068-RFID-CTN-CNT          04250000
042600             IF WS-RFID-CART-QTY > 0                              04260000
042700               PERFORM 4050-RETRIEVE-PBS-UNIT-QTY                 04270000
042800             ELSE                                                 04280000
042900               MOVE ZERO TO PC068-RFID-UNT-CNT                    04290000
043000             END-IF                                               04300000
043100         WHEN SQLCODE = +100                                      04310000
043200               MOVE ZERO TO PC068-RFID-CTN-CNT                    04320000
043300               MOVE ZERO TO PC068-RFID-UNT-CNT                    04330000
043400         WHEN OTHER                                               04340000
043500             MOVE '3050-RET-PBS-CARTON-QTY'                       04350000
043600                                      TO WS-ABEND-PARAGRAPH       04360000
043700             MOVE 'SELECT'        TO WS-ABEND-OPERATION           04370000
043800             MOVE 'TPKSLIP'       TO WS-ABEND-STRUCTURE-1         04380000
043900             MOVE 'TINPKSU'       TO WS-ABEND-STRUCTURE-2         04390000
044000             MOVE 'TSHUUPC'       TO WS-ABEND-STRUCTURE-3         04400000
044100             PERFORM 9900-DB2-ABEND                               04410000
044200     END-EVALUATE.                                                04420000
044300                                                                  04430000
044310 3060-RET-PBS-CARTON-QTY-EAS.                                     04431040
044320     MOVE '3060-RET-PBS-CARTON-QTY-EAS' TO PV-ABEND-PARAGRAPH.    04432040
044330                                                                  04433040
044350     EXEC SQL                                                     04435040
044360       SELECT  COUNT(DISTINCT U.SHIPT_UNT_ID)                     04436040
044370       INTO :WS-EAS-CART-QTY                                      04437040
044391       FROM TRECDIS T                                             04439140
044392           ,TSHPUNT D                                             04439240
044393           ,TSHUUPC U                                             04439340
044408       WHERE T.ORD_NBR          = :RECDIS-ORD-NBR                 04440840
044409         AND T.REC_SEQ_NBR      = :RECDIS-REC-SEQ-NBR             04440940
044410         AND T.OPER_UNT_ID      = :RECDIS-OPER-UNT-ID             04441040
044412         AND U.TRN_NBR          = T.ORD_NBR                       04441240
044413         AND U.TRN_LNE_NBR      = T.ORD_LNE_NBR                   04441340
044414         AND D.DEST_OPER_UNT_ID = T.STR_NBR                       04441440
044415         AND D.SHIPT_UNT_ID     = U.SHIPT_UNT_ID                  04441540
044416       WITH UR                                                    04441640
044417     END-EXEC.                                                    04441740
044418                                                                  04441840
044419     EVALUATE TRUE                                                04441940
044420         WHEN SQLCODE = ZERO                                      04442040
044421             ADD  WS-EAS-CART-QTY  TO PC068-RFID-CTN-CNT          04442140
044422             IF WS-EAS-CART-QTY > 0                               04442240
044423               PERFORM 4060-RETRIEVE-PBS-UNIT-QTY-EAS             04442340
044426             END-IF                                               04442640
044427         WHEN SQLCODE = +100                                      04442740
044428             CONTINUE                                             04442840
044430         WHEN OTHER                                               04443040
044431             MOVE '3060-RET-PBS-CARTON-QTY-EAS'                   04443147
044432                                      TO WS-ABEND-PARAGRAPH       04443240
044433             MOVE 'SELECT'        TO WS-ABEND-OPERATION           04443340
044434             MOVE 'TPKSLIP'       TO WS-ABEND-STRUCTURE-1         04443440
044435             MOVE 'TINPKSU'       TO WS-ABEND-STRUCTURE-2         04443540
044436             MOVE 'TSHUUPC'       TO WS-ABEND-STRUCTURE-3         04443640
044437             PERFORM 9900-DB2-ABEND                               04443740
044438     END-EVALUATE.                                                04443840
044439                                                                  04443940
044440 3100-RETRIEVE-REPL-CART-QTY.                                     04444040
044500     MOVE '3100-RETRIEVE-REPL-CART-QTY' TO PV-ABEND-PARAGRAPH.    04450000
044600                                                                  04460000
044700     EXEC SQL                                                     04470000
044800       SELECT  COUNT(DISTINCT (T.SHIPT_UNT_ID ))                  04480000
044900              ,COALESCE(SUM(SHPD_UNT_QTY),0)                      04490000
045000       INTO :WS-RFID-CART-QTY                                     04500000
045100           ,:SUT00028-SHPD-UNT-QTY                                04510000
045200       FROM SUT_TRLR_RPLN_CART T                                  04520000
045300           ,SUT_OTBND_CART     C                                  04530000
045400           ,SUT_OTBND_UPC      U                                  04540000
045500           ,XLT_UPC            P                                  04550000
045600           ,XLT_SKU            S                                  04560000
045700           ,XLT_VND_STYL       V                                  04570000
045800           ,(SELECT DEPT_NBR                                      04580000
045900                 FROM RIT_RFID_VRFN F                             04590000
046000                 WHERE F.STR_NBR = 0                              04600000
046100                 AND   F.SUB_CL_NBR = 0                           04610000
046200                 AND   F.MAJ_CL_NBR = 0                           04620000
046300                 AND   F.RFID_LVL_CDE = 'DPTSCL'                  04630000
046400                 AND CURRENT DATE BETWEEN DATE(EFF_STRT_TMST)     04640000
046500                 AND DATE(EFF_END_TMST)) E                        04650000
046600            ,(SELECT STR_NBR                                      04660000
046700                  FROM RIT_RFID_VRFN G                            04670000
046800                  WHERE G.RFID_LVL_CDE = 'STRDPT'                 04680000
046900                  AND CURRENT DATE BETWEEN DATE(EFF_STRT_TMST)    04690000
047000                  AND DATE(EFF_END_TMST)) H                       04700000
047100             WHERE T.SCAC_CDE     = :SUT00113-SCAC-CDE            04710000
047200               AND T.VEH_NBR      = :SUT00113-VEH-NBR             04720000
047300               AND T.INBND_TRIP_ID = :SUT00113-INBND-TRIP-ID      04730000
047400               AND T.SHIPT_UNT_ID  = C.SHIPT_UNT_ID               04740000
047500               AND T.SHIPT_UNT_ID  = U.SHIPT_UNT_ID               04750000
047600               AND C.ORGN_LOC_NBR  = :SUT00024-ORGN-LOC-NBR       04760000
047700               AND U.UPC_NBR       = P.UPC_NBR                    04770000
047800               AND P.INTR_UPC_ID   = S.INTR_UPC_ID                04780000
047900               AND H.STR_NBR       = C.DEST_LOC_NBR               04790000
048000               AND V.DEPT_NBR      = E.DEPT_NBR                   04800000
048100               AND V.STYL_ID       = S.STYL_ID                    04810000
048200       WITH UR                                                    04820000
048300     END-EXEC.                                                    04830000
048400                                                                  04840000
048500     EVALUATE TRUE                                                04850000
048600         WHEN SQLCODE = ZERO                                      04860000
048700             MOVE WS-RFID-CART-QTY TO PC068-RFID-CTN-CNT          04870000
048800             MOVE SUT00028-SHPD-UNT-QTY TO PC068-RFID-UNT-CNT     04880000
048900         WHEN SQLCODE = +100                                      04890000
049000               MOVE ZERO TO PC068-RFID-CTN-CNT                    04900000
049100               MOVE ZERO TO PC068-RFID-UNT-CNT                    04910000
049200         WHEN OTHER                                               04920000
049300             MOVE '3100-RETRIEVE-REPL-CART-QTY'                   04930000
049400                         TO WS-ABEND-PARAGRAPH                    04940000
049500             MOVE 'SELECT'         TO WS-ABEND-OPERATION          04950000
049600             MOVE 'SUT_TRLR_RPLN_CART' TO WS-ABEND-STRUCTURE-1    04960000
049700             MOVE 'SUT_OTBND_CART' TO WS-ABEND-STRUCTURE-2        04970000
049800             MOVE 'SUT_OTBND_UPC'  TO WS-ABEND-STRUCTURE-3        04980000
049900             MOVE 'XLT_UPC'        TO WS-ABEND-STRUCTURE-4        04990000
050000             MOVE 'XLT_SKU'        TO WS-ABEND-STRUCTURE-5        05000000
050100             MOVE 'XLT_VND_STYL'   TO WS-ABEND-STRUCTURE-6        05010000
050200             MOVE 'TSHUUPC'        TO WS-ABEND-STRUCTURE-7        05020000
050300             PERFORM 9900-DB2-ABEND                               05030000
050400     END-EVALUATE.                                                05040000
050500                                                                  05050000
050510 3150-FETCH-REPL-CART-QTY-EAS.                                    05051048
050520     MOVE '3150-FETCH-REPL-CART-QTY-EAS' TO PV-ABEND-PARAGRAPH.   05052048
050530                                                                  05053047
050540     EXEC SQL                                                     05054047
050550       SELECT  COUNT(DISTINCT (T.SHIPT_UNT_ID ))                  05055047
050560              ,COALESCE(SUM(SHPD_UNT_QTY),0)                      05056047
050570       INTO :WS-RFID-CART-QTY                                     05057047
050580           ,:SUT00028-SHPD-UNT-QTY                                05058047
050590       FROM SUT_TRLR_RPLN_CART T                                  05059047
050591           ,SUT_OTBND_CART     C                                  05059147
050592           ,SUT_OTBND_UPC      U                                  05059247
050593           ,XLT_UPC            P                                  05059347
050594           ,XLT_SKU            S                                  05059447
050595           ,XLT_VND_STYL       V                                  05059547
050609             WHERE T.SCAC_CDE     = :SUT00113-SCAC-CDE            05060947
050610               AND T.VEH_NBR      = :SUT00113-VEH-NBR             05061047
050611               AND T.INBND_TRIP_ID = :SUT00113-INBND-TRIP-ID      05061147
050612               AND T.SHIPT_UNT_ID  = C.SHIPT_UNT_ID               05061247
050613               AND T.SHIPT_UNT_ID  = U.SHIPT_UNT_ID               05061347
050614               AND C.ORGN_LOC_NBR  = :SUT00024-ORGN-LOC-NBR       05061447
050615               AND U.UPC_NBR       = P.UPC_NBR                    05061547
050616               AND P.INTR_UPC_ID   = S.INTR_UPC_ID                05061647
050619               AND V.STYL_ID       = S.STYL_ID                    05061947
050620       WITH UR                                                    05062047
050621     END-EXEC.                                                    05062147
050623                                                                  05062347
050624     EVALUATE TRUE                                                05062447
050625         WHEN SQLCODE = ZERO                                      05062547
050626             ADD  WS-RFID-CART-QTY TO PC068-RFID-CTN-CNT          05062647
050627             ADD  SUT00028-SHPD-UNT-QTY TO PC068-RFID-UNT-CNT     05062747
050628         WHEN SQLCODE = +100                                      05062847
050629             CONTINUE                                             05062947
050631         WHEN OTHER                                               05063147
050632             MOVE '3150-FETCH-REPL-CART-QTY-EAS'                  05063248
050633                         TO WS-ABEND-PARAGRAPH                    05063347
050634             MOVE 'SELECT'         TO WS-ABEND-OPERATION          05063447
050635             MOVE 'SUT_TRLR_RPLN_CART' TO WS-ABEND-STRUCTURE-1    05063547
050636             MOVE 'SUT_OTBND_CART' TO WS-ABEND-STRUCTURE-2        05063647
050637             MOVE 'SUT_OTBND_UPC'  TO WS-ABEND-STRUCTURE-3        05063747
050638             MOVE 'XLT_UPC'        TO WS-ABEND-STRUCTURE-4        05063847
050639             MOVE 'XLT_SKU'        TO WS-ABEND-STRUCTURE-5        05063947
050640             MOVE 'XLT_VND_STYL'   TO WS-ABEND-STRUCTURE-6        05064047
050641             MOVE 'TSHUUPC'        TO WS-ABEND-STRUCTURE-7        05064147
050642             PERFORM 9900-DB2-ABEND                               05064247
050643     END-EVALUATE.                                                05064347
050644                                                                  05064447
050650 3200-RETRIEVE-RFID-DC.                                           05065047
050700     MOVE '3200-RETRIEVE-RFID-DC' TO PV-ABEND-PARAGRAPH.          05070000
050800                                                                  05080000
050900     EXEC SQL                                                     05090000
051000       SELECT 'Y'                                                 05100000
051100       INTO :PV-RFID-DC-SW                                        05110000
051200       FROM RIT_RFID_VRFN E                                       05120000
051300       WHERE RFID_LVL_CDE = 'RFIDDC'                              05130000
051400       AND CURRENT DATE BETWEEN DATE(EFF_STRT_TMST)               05140000
051500             AND DATE(EFF_END_TMST)                               05150000
051600       AND  DC_LOC_NBR = :RIT00000-DC-LOC-NBR                     05160000
051700       WITH UR                                                    05170000
051800     END-EXEC.                                                    05180000
051900                                                                  05190000
052000     EVALUATE TRUE                                                05200000
052100         WHEN SQLCODE = ZERO                                      05210000
052200            CONTINUE                                              05220000
052300         WHEN SQLCODE = +100                                      05230000
052400            SET PV-RFID-DC-NO TO TRUE                             05240000
052500         WHEN OTHER                                               05250000
052600             MOVE '3200-RETRIEVE-RFID-DCRT-QTY'                   05260000
052700                         TO WS-ABEND-PARAGRAPH                    05270000
052800             MOVE 'SELECT'         TO WS-ABEND-OPERATION          05280000
052900             MOVE 'RIT_RFID_VRFN' TO WS-ABEND-STRUCTURE-1         05290000
053000             PERFORM 9900-DB2-ABEND                               05300000
053100     END-EVALUATE.                                                05310000
053200                                                                  05320000
053201******************************************************************05320136
053202* CHECK THE TKRPRPM TABLE TO SEE IF THE DC IS DOING EAS TAGGING.  05320236
053203******************************************************************05320336
053220 3300-RETRIEVE-EAS-DC.                                            05322036
053230     MOVE '3300-RETRIEVE-EAS-DC'  TO PV-ABEND-PARAGRAPH.          05323036
053240                                                                  05324036
053250     EXEC SQL                                                     05325036
053260       SELECT FUNC_TXT                                            05326036
053270       INTO  :PV-EAS-DC-SW                                        05327036
053280       FROM   TKRPRPM                                             05328036
053281       WHERE  LOC_ID = :DK-OPER-UNT-ID                            05328143
053290       AND    SYS_PRC_FUNC_CDE = 'RFIDDC'                         05329036
053291       AND    CURRENT DATE BETWEEN DATE(FUNC_BEG_TMST)            05329136
053292              AND DATE(FUNC_END_TMST)                             05329236
053294       WITH UR                                                    05329436
053295     END-EXEC.                                                    05329536
053296                                                                  05329636
053297     EVALUATE TRUE                                                05329736
053298         WHEN SQLCODE = ZERO                                      05329836
053299            CONTINUE                                              05329936
053300         WHEN SQLCODE = +100                                      05330036
053301            SET PV-EAS-DC-NO TO TRUE                              05330136
053302         WHEN OTHER                                               05330236
053303             MOVE '3300-RETRIEVE-EAS-DC'                          05330336
053304                         TO WS-ABEND-PARAGRAPH                    05330436
053305             MOVE 'SELECT'         TO WS-ABEND-OPERATION          05330536
053306             MOVE 'TKRPRPM'       TO WS-ABEND-STRUCTURE-1         05330636
053307             PERFORM 9900-DB2-ABEND                               05330736
053308     END-EVALUATE.                                                05330836
053309                                                                  05330936
053310******************************************************************05331039
053311* CHECK THE WST TABLES TO SEE IF THE DC IS DOING EAS TAGGING FOR  05331139
053312* THE SPECIFIED VENDOR AND DEPARTMENT.                            05331239
053313******************************************************************05331339
053314 3400-CHK-EAS-TAGGING.                                            05331439
053315                                                                  05331539
053316     MOVE PC068-DEPT-NBR  TO PV-DEPT-NBR-X.                       05331643
053317     MOVE PV-DEPT-NBR-N   TO DK-DEPT-NBR.                         05331745
053318                                                                  05331843
053319                                                                  05331943
053320     EXEC SQL                                                     05332043
053321     SELECT   H.ATTR_ELEM_TXT                                     05332143
053322      INTO  :PV-EAS-TAGGING-FOR-DEPT-SW                           05332243
053323      FROM                                                        05332343
053324            WST_INTGRTN_TYP  A                                    05332443
053325         ,  WST_ATTR_DEFN    B                                    05332543
053326         ,  WST_ATTR_ELEM    C              -- OPER               05332643
053327         ,  WST_ATTR_ELEM    D              -- DEPT               05332743
053328         ,  WST_ATTR_ELEM    E              -- ENT ID             05332843
053329         ,  WST_ATTR_ELEM    F              -- FROM TMST          05332943
053330         ,  WST_ATTR_ELEM    G              -- TO TMST            05333043
053331         ,  WST_ATTR_ELEM    H              -- Y/N SWITCH         05333143
053332      WHERE                                                       05333243
053333            A.INTGRTN_TYP_CDE   = 'EASTAG'                        05333343
053334        AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE               05333443
053335        AND B.ATTR_DEFN_SEQ_NBR = 1                               05333543
053336        AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE               05333643
053337        AND C.ATTR_DEFN_SEQ_NBR = 1                               05333743
053338        AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE               05333843
053339        AND D.ATTR_DEFN_SEQ_NBR = 2                               05333943
053340        AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE               05334043
053341        AND E.ATTR_DEFN_SEQ_NBR = 3                               05334143
053342        AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE               05334243
053343        AND F.ATTR_DEFN_SEQ_NBR = 4                               05334343
053344        AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE               05334443
053345        AND G.ATTR_DEFN_SEQ_NBR = 5                               05334543
053346        AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE               05334643
053347        AND H.ATTR_DEFN_SEQ_NBR = 6                               05334743
053348        AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR             05334843
053349        AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR             05334943
053350        AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR             05335043
053351        AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR             05335143
053352        AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR             05335243
053353        AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID                 05335343
053354        AND D.ATTR_ELEM_NBR     = :DK-DEPT-NBR                    05335443
053355        AND E.ATTR_ELEM_NBR     = :PC068-ENT-ID                   05335543
053356        AND F.ATTR_ELEM_TMST   <=  CURRENT TIMESTAMP              05335643
053357        AND G.ATTR_ELEM_TMST   >=  CURRENT TIMESTAMP              05335743
053358        AND H.ATTR_ELEM_TXT     =  'Y'                            05335843
053359      WITH UR                                                     05335943
053360     END-EXEC.                                                    05336043
053361                                                                  05336143
053362     EVALUATE TRUE                                                05336243
053363         WHEN SQLCODE = ZERO                                      05336343
053365              IF  PS-EAS-EXECUTE-BYPASS-NO                        05336564
053366                  CONTINUE                                        05336664
053367              ELSE                                                05336764
053368                  PERFORM 8910-FURTHER-EAS-CHECKS                 05336864
053369              END-IF                                              05336964
053371         WHEN SQLCODE = +100                                      05337143
053372              SET PV-EAS-TAGGING-FOR-DEPT-NO  TO TRUE             05337243
053373         WHEN OTHER                                               05337343
053374             DISPLAY 'BAD KEY - ' DK-OPER-UNT-ID ' - '            05337444
053375                                  PC068-ENT-ID ' - '              05337544
053376                                  PC068-DEPT-NBR                  05337645
053377             MOVE '3400-CHK-EAS-TAGGING'                          05337744
053378                                    TO WS-ABEND-PARAGRAPH         05337844
053379             MOVE 'SELECT'          TO WS-ABEND-OPERATION         05337944
053380             MOVE 'WST_INTGRTN_TYP' TO WS-ABEND-STRUCTURE-1       05338044
053381             MOVE 'WST_ATTR_DEFN  ' TO WS-ABEND-STRUCTURE-2       05338144
053382             MOVE 'WST_ATTR_ELEM  ' TO WS-ABEND-STRUCTURE-3       05338244
053383             PERFORM 9900-DB2-ABEND                               05338344
053384     END-EVALUATE.                                                05338444
053385                                                                  05338544
053390/                                                                 05339044
053400 4000-RETRIEVE-UNIT-QTY.                                          05340000
053500     MOVE '4000-RETRIEVE-UNIT-QTY' TO PV-ABEND-PARAGRAPH.         05350000
053600     EXEC SQL                                                     05360000
053700         SELECT COALESCE(SUM(EXPTED_ITM_QTY),0)                   05370000
053800         INTO :RECDIS-EXPTED-ITM-QTY                              05380000
053900            FROM  TRECDIS A                                       05390000
054000            WHERE A.ORD_NBR       = :RECDIS-ORD-NBR               05400000
054100              AND A.ORD_LNE_NBR   = :RECDIS-ORD-LNE-NBR           05410000
054200              AND A.OPER_UNT_ID   = :RECDIS-OPER-UNT-ID           05420000
054300              AND A.REC_SEQ_NBR   = :RECDIS-REC-SEQ-NBR           05430000
054500         WITH UR                                                  05450000
054600     END-EXEC.                                                    05460000
054700                                                                  05470000
054800     EVALUATE TRUE                                                05480000
054900         WHEN SQLCODE = ZERO                                      05490000
055000             MOVE RECDIS-EXPTED-ITM-QTY TO  PC068-RFID-UNT-CNT    05500000
055100         WHEN SQLCODE = +100                                      05510000
055200             MOVE ZERO                TO  PC068-RFID-UNT-CNT      05520000
055300         WHEN OTHER                                               05530000
055400             DISPLAY 'BAD KEY - ' RECITM-ORD-NBR ' - '            05540000
055500                                  RECITM-ORD-LNE-NBR              05550000
055600             MOVE '4000-RETRIEVE-UNIT-QTY' TO WS-ABEND-PARAGRAPH  05560000
055700             MOVE 'SELECT'        TO WS-ABEND-OPERATION           05570000
055800             MOVE 'TRECITM'       TO WS-ABEND-STRUCTURE-1         05580000
055900             PERFORM 9900-DB2-ABEND                               05590000
056000     END-EVALUATE.                                                05600000
056100                                                                  05610000
056200 4050-RETRIEVE-PBS-UNIT-QTY.                                      05620000
056300     MOVE '4050-RETRIEVE-PBS-UNIT-QTY' TO PV-ABEND-PARAGRAPH.     05630000
056400     EXEC SQL                                                     05640000
056500         SELECT COALESCE(SUM(T.EXPTED_ITM_QTY),0)                 05650000
056600         INTO :RECDIS-EXPTED-ITM-QTY                              05660000
056700         FROM RIT_RFID_VRFN F                                     05670000
056800             ,RIT_RFID_VRFN G                                     05680000
056900             ,TRECDIS T                                           05690000
057000         WHERE F.DEPT_NBR = :RIT00000-DEPT-NBR                    05700000
057100          AND F.STR_NBR = 0                                       05710000
057200          AND F.SUB_CL_NBR = 0                                    05720000
057300          AND F.MAJ_CL_NBR = 0                                    05730000
057400          AND F.RFID_LVL_CDE = 'DPTSCL'                           05740000
057500          AND CURRENT DATE BETWEEN DATE(F.EFF_STRT_TMST)          05750000
057600            AND DATE(F.EFF_END_TMST)                              05760000
057700          AND G.STR_NBR = T.STR_NBR                               05770000
057800          AND G.DEPT_NBR = F.DEPT_NBR                             05780000
057900          AND G.SUB_CL_NBR = 0                                    05790000
058000          AND G.MAJ_CL_NBR = 0                                    05800000
058100          AND G.RFID_LVL_CDE = 'STRDPT'                           05810000
058200          AND CURRENT DATE BETWEEN DATE(G.EFF_STRT_TMST)          05820000
058300            AND DATE(G.EFF_END_TMST)                              05830000
058400          AND T.ORD_NBR        = :RECDIS-ORD-NBR                  05840000
058500          AND T.REC_SEQ_NBR    = :RECDIS-REC-SEQ-NBR              05850000
058600          AND T.OPER_UNT_ID    = :RECDIS-OPER-UNT-ID              05860000
058800         WITH UR                                                  05880000
058900     END-EXEC.                                                    05890000
059000                                                                  05900000
059100     EVALUATE TRUE                                                05910000
059200         WHEN SQLCODE = ZERO                                      05920000
059300             MOVE RECDIS-EXPTED-ITM-QTY TO  PC068-RFID-UNT-CNT    05930000
059400         WHEN SQLCODE = +100                                      05940000
059500             MOVE ZERO                TO  PC068-RFID-UNT-CNT      05950000
059600         WHEN OTHER                                               05960000
059700             DISPLAY 'BAD KEY - ' RECITM-ORD-NBR ' - '            05970000
059800                                  RECITM-ORD-LNE-NBR              05980000
059900             MOVE '4050-RETRIEVE-PBS-UNIT-QTY' TO                 05990000
060000                    WS-ABEND-PARAGRAPH                            06000000
060100             MOVE 'SELECT'        TO WS-ABEND-OPERATION           06010000
060200             MOVE 'TRECITM'       TO WS-ABEND-STRUCTURE-1         06020000
060300             PERFORM 9900-DB2-ABEND                               06030000
060400     END-EVALUATE.                                                06040000
060500                                                                  06050000
060510 4060-RETRIEVE-PBS-UNIT-QTY-EAS.                                  06051040
060520     MOVE '4060-RETRIEVE-PBS-UNIT-QTY-EAS' TO PV-ABEND-PARAGRAPH. 06052040
060530     EXEC SQL                                                     06053040
060540         SELECT COALESCE(SUM(T.EXPTED_ITM_QTY),0)                 06054040
060550         INTO :RECDIS-EXPTED-ITM-QTY                              06055040
060580         FROM TRECDIS T                                           06058040
060604        WHERE T.ORD_NBR        = :RECDIS-ORD-NBR                  06060440
060605          AND T.REC_SEQ_NBR    = :RECDIS-REC-SEQ-NBR              06060540
060606          AND T.OPER_UNT_ID    = :RECDIS-OPER-UNT-ID              06060640
060608         WITH UR                                                  06060840
060609     END-EXEC.                                                    06060940
060610                                                                  06061040
060611     EVALUATE TRUE                                                06061140
060612         WHEN SQLCODE = ZERO                                      06061240
060613             ADD  RECDIS-EXPTED-ITM-QTY TO  PC068-RFID-UNT-CNT    06061357
060614         WHEN SQLCODE = +100                                      06061440
060615             CONTINUE                                             06061540
060616         WHEN OTHER                                               06061640
060617             DISPLAY 'BAD KEY - ' RECITM-ORD-NBR ' - '            06061740
060618                                  RECITM-ORD-LNE-NBR              06061840
060619             MOVE '4060-RETRIEVE-PBS-UNIT-QTY-EAS'                06061963
060620                                  TO WS-ABEND-PARAGRAPH           06062063
060621             MOVE 'SELECT'        TO WS-ABEND-OPERATION           06062140
060622             MOVE 'TRECITM'       TO WS-ABEND-STRUCTURE-1         06062240
060623             PERFORM 9900-DB2-ABEND                               06062340
060624     END-EVALUATE.                                                06062440
060625                                                                  06062540
060630***************************************************************** 06063040
060700 4100-CHECK-FOR-VENDOR.                                           06070000
060800***************************************************************** 06080000
060900     MOVE '4100-CHECK-FOR-VENDOR ' TO PV-ABEND-PARAGRAPH.         06090000
061000                                                                  06100000
061100     EXEC SQL                                                     06110000
061200        SELECT 'Y'                                                06120000
061300         INTO :PV-VNDR-TAGGING-OR-COMP-SW                         06130000
061400         FROM TVNDAGR A                                           06140000
061500         WHERE A.ENT_ID      = :VNDAGR-ENT-ID                     06150000
061600           AND A.AGRMT_TYP_ID      = '4'                          06160000
061700           AND A.TYP_CDE IN (11,12)                               06170000
061800           AND  CURRENT DATE BETWEEN EFFECTIVE_DATE               06180000
061900             AND EXPIRATION_DATE                                  06190000
062000           FETCH FIRST ROW ONLY                                   06200000
062100     WITH UR                                                      06210000
062200     END-EXEC.                                                    06220000
062300                                                                  06230000
062400     EVALUATE TRUE                                                06240000
062500         WHEN SQLCODE = ZERO                                      06250000
062600         WHEN SQLCODE = +100                                      06260000
062700             CONTINUE                                             06270000
062800         WHEN OTHER                                               06280000
062900             DISPLAY 'BAD TPURCHS KEY - ' PURCHS-PO-NBR ' - '     06290000
063000             MOVE '4100-CHECK-FOR-VENDOR' TO WS-ABEND-PARAGRAPH   06300000
063100             MOVE 'SELECT'        TO WS-ABEND-OPERATION           06310000
063200             MOVE 'TVNDAGR'       TO WS-ABEND-STRUCTURE-1         06320000
063300             PERFORM 9900-DB2-ABEND                               06330000
063400     END-EVALUATE.                                                06340000
063500                                                                  06350000
063600 7000-READ-INPUT-REC1.                                            06360000
063700     MOVE '7000-READ-INPUT-REC1 ' TO PV-ABEND-PARAGRAPH.          06370000
063800     READ  TRIP-EXTRACT-FILE-IN1 INTO PC068-RECORD-LAYOUT         06380000
063900       AT END SET WS-END-INP01-FILE TO TRUE.                      06390000
064000                                                                  06400000
064100 7100-READ-INPUT-REC2.                                            06410000
064200     MOVE '7100-READ-INPUT-REC2 ' TO PV-ABEND-PARAGRAPH.          06420000
064300     READ  TRIP-EXTRACT-FILE-IN2 INTO PC068-RECORD-LAYOUT         06430000
064400       AT END SET WS-END-INP02-FILE TO TRUE.                      06440000
064500                                                                  06450000
064600 8000-WRITE-OUTPUT-REC1.                                          06460000
064700     MOVE '8000-WRITE-OUTPUT-REC1' TO PV-ABEND-PARAGRAPH.         06470000
064800                                                                  06480000
064900     WRITE TRIP-EXTRACT-RECORD1    FROM PC068-RECORD-LAYOUT.      06490000
065000     ADD 1                         TO WS-WRITE-COUNT.             06500000
065100                                                                  06510000
065200 8100-WRITE-OUTPUT-REC2.                                          06520000
065300     MOVE '8100-WRITE-OUTPUT-REC2' TO PV-ABEND-PARAGRAPH.         06530000
065400                                                                  06540000
065500     WRITE TRIP-EXTRACT-RECORD2    FROM PC068-RECORD-LAYOUT.      06550000
065600     ADD 1                         TO WS-WRITE-COUNT2.            06560000
065700                                                                  06570000
065710********************************************************          06571064
065720*** READ THE TKRPRPM PARM FOR PARM NAME EASBYP.  IF THE           06572064
065730*** FUNC_TXT IS A 'Y', THEN THE NEW LOGIC TO CHECK FOR            06573064
065740*** THE BYPASS OF EAS TAGGING WOULD BE EXECUTED.  IF THE          06574064
065750*** FUNC_TXT IS A 'N' OR +100, THEN THE NEW LOGIC TO              06575064
065760*** CHECK FOR THE BYPASS OF THE EAS TAGGING WOULD NOT             06576064
065770*** BE EXECUTED.                                                  06577064
065780********************************************************          06578064
065790 8905-CHECK-BYPASS-PARM.                                          06579064
065791                                                                  06579164
065792     EXEC SQL                                                     06579264
065793         SELECT FUNC_TXT                                          06579364
065794           INTO :PS-EAS-EXECUTE-BYPASS-SW                         06579464
065795         FROM TKRPRPM                                             06579564
065796         WHERE LOC_ID            =  90                            06579664
065797           AND INTFC_SYS_CDE     =  'KHL'                         06579764
065798           AND SYS_PRC_FUNC_CDE  =  'EASBYP'                      06579864
065799           AND FUNC_PRC_STAT_CDE =  'AC'                          06579964
065800           AND FUNC_BEG_TMST    <=  CURRENT TIMESTAMP             06580064
065801           AND FUNC_END_TMST    >=  CURRENT TIMESTAMP             06580164
065802         WITH UR                                                  06580264
065803     END-EXEC.                                                    06580364
065804                                                                  06580464
065805     EVALUATE TRUE                                                06580564
065806         WHEN SQLCODE = ZERO                                      06580664
065807              CONTINUE                                            06580764
065808         WHEN SQLCODE = +100                                      06580864
065809              SET PS-EAS-EXECUTE-BYPASS-NO TO TRUE                06580964
065814         WHEN OTHER                                               06581464
065815             MOVE '8905-CHECK-BYPASS-PARM'                        06581564
065816                         TO WS-ABEND-PARAGRAPH                    06581664
065817             MOVE 'SELECT EASBYP'  TO WS-ABEND-OPERATION          06581764
065818             MOVE 'TKRPRPM'       TO WS-ABEND-STRUCTURE-1         06581864
065819             PERFORM 9900-DB2-ABEND                               06581964
065820     END-EVALUATE.                                                06582064
065821                                                                  06582164
065822********************************************************          06582264
065823*** THIS PARAGRAPH WILL BE EXECUTED ONLY IF THE INITIAL           06582364
065824*** CHECK OF THE EASTAG WST PARM CAME BACK INDICATING             06582464
065825*** THAT THE MERCHANDISE NEEDS TO BE EAS TAGGED.  THIS            06582564
065826*** PARAGRAPH WILL DO FURTHER CHECKS TO SEE IF THE                06582664
065827*** MERCHANDISE SHOULD BE BYPASSED FROM EAS TAGGING IF            06582764
065828*** THE ASSOCIATED PO OR ASSOCIATED SEASONAL SET IS SET           06582864
065829*** UP ON THE EASSSBYPAS OR EASPOBYPAS PARMS TO TELL              06582964
065830*** THE SYSTEM TO NOT PERFORM THE EAS TAGGING.                    06583064
065831*** SHOULD BE NOTED THAT IF THE BYPASS IF FOUND ON THE            06583164
065832*** EASSSBYPAS CHECK, THE PROGRAM WOULD NOT DO THE CHECK          06583264
065833*** OF THE EASPOBYPAS PARM SINCE IT HAS ALREADY DETERMINED        06583364
065834*** TO BYPASS THE EAS TAGGING.                                    06583464
065835********************************************************          06583564
065836 8910-FURTHER-EAS-CHECKS.                                         06583664
065837                                                                  06583764
065838     MOVE PC068-PO-NBR TO PV-NUMERIC-PO-NBR.                      06583864
065839     IF  PV-NUMERIC-PO-NBR > 0                                    06583964
065840     AND PV-NUMERIC-PO-NBR IS NUMERIC                             06584064
065842         MOVE PC068-PO-NBR TO DK-PO-NBR                           06584264
065843         PERFORM 8920-EAS-BYPASS-BY-SET                           06584364
065844     ELSE                                                         06584464
065845         CONTINUE                                                 06584564
065860     END-IF.                                                      06586064
065861                                                                  06586164
065862********************************************************          06586264
065863*** THIS PARAGRAPH WILL CHECK THE EASSSBYPAS PARM BASED           06586364
065864*** ON THE SEASONAL SET ASSOCIATED TO THE PO FOR THE              06586464
065865*** MERCHANDISE TO SEE IF WHILE THE EASTAG CHECK FOUND            06586564
065866*** THE MERCHANDISE NEEDS TO BE EAS TAGGED, THIS PARM             06586664
065867*** CHECK WILL OVERRIDE THAT AND FLAG THE MERCHANDISE             06586764
065868*** TO NOT BE EAS TAGGED IF THE SEASONAL SET IS ACTIVE            06586864
065869*** ON THE EASSSBYPAS PARM.                                       06586964
065870********************************************************          06587064
065871 8920-EAS-BYPASS-BY-SET.                                          06587164
065872                                                                  06587264
065873     EXEC SQL                                                     06587364
065874     SELECT   E.ATTR_ELEM_TXT                                     06587464
065875      INTO  :PS-EAS-SEASET-BYPASS-SW                              06587564
065876      FROM                                                        06587664
065877            WST_INTGRTN_TYP  A                                    06587764
065878         ,  WST_ATTR_DEFN    B                                    06587864
065879         ,  WST_ATTR_ELEM    C              -- SET YEAR           06587964
065880         ,  WST_ATTR_ELEM    D              -- SET NAME           06588064
065881         ,  WST_ATTR_ELEM    E              -- Y/N SWITCH         06588164
065882         ,  WST_ATTR_ELEM    F              -- FROM TMST          06588264
065883         ,  WST_ATTR_ELEM    G              -- TO TMST            06588364
065884         ,  TPURCHS          H                                    06588464
065885      WHERE                                                       06588564
065886            A.INTGRTN_TYP_CDE   = 'EASSSBYPAS'                    06588664
065887        AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE               06588764
065888        AND B.ATTR_DEFN_SEQ_NBR = 1                               06588864
065889        AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE               06588964
065890        AND C.ATTR_DEFN_SEQ_NBR = 1                               06589064
065891        AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE               06589164
065892        AND D.ATTR_DEFN_SEQ_NBR = 2                               06589264
065893        AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE               06589364
065894        AND E.ATTR_DEFN_SEQ_NBR = 3                               06589464
065895        AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE               06589564
065896        AND F.ATTR_DEFN_SEQ_NBR = 4                               06589664
065897        AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE               06589764
065898        AND G.ATTR_DEFN_SEQ_NBR = 5                               06589864
065899        AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR             06589964
065900        AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR             06590064
065901        AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR             06590164
065902        AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR             06590264
065903        AND C.ATTR_ELEM_TXT     = H.SEASET_YR                     06590364
065904        AND D.ATTR_ELEM_TXT     = H.SEASET_SHRT_NM                06590464
065905        AND E.ATTR_ELEM_TXT     = 'Y'                             06590564
065906        AND F.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP               06590664
065907        AND G.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP               06590764
065908        AND H.PO_NBR            = :DK-PO-NBR                      06590864
065909        AND H.VER_STATUS_CDE    = 'A'                             06590964
065910         WITH UR                                                  06591064
065911     END-EXEC.                                                    06591164
065912                                                                  06591264
065913     EVALUATE TRUE                                                06591364
065914         WHEN SQLCODE = ZERO                                      06591464
065915              SET PV-EAS-TAGGING-FOR-DEPT-NO  TO TRUE             06591564
065916         WHEN SQLCODE = +100                                      06591664
065917              PERFORM 8930-EAS-BYPASS-BY-PO                       06591764
065918         WHEN OTHER                                               06591864
065922              MOVE '8920-EAS-BYPASS-BY-SET' TO                    06592264
065923                   WS-ABEND-PARAGRAPH                             06592364
065924              MOVE 'SELECT WST PARM EASSSBYPAS' TO                06592464
065925                   WS-ABEND-OPERATION                             06592564
065926              MOVE 'WST_ATTR_ELEM' TO WS-ABEND-STRUCTURE-1        06592664
065927              PERFORM 9900-DB2-ABEND                              06592764
065928     END-EVALUATE.                                                06592864
065929                                                                  06592964
065930********************************************************          06593064
065931*** THIS PARAGRAPH WILL CHECK THE EASPOBYPAS PARM BASED           06593164
065932*** ON THE PO FOR THE MERCHANDISE TO SEE IF WHILE THE             06593264
065933*** EASTAG CHECK FOUND THE MERCHANDISE NEEDS TO BE EAS            06593364
065934*** TAGGED, THIS PARM CHECK WILL OVERRIDE THAT THE FLAG           06593464
065935*** THE MERCHANDISE TO NOT BE EAS TAGGED IF THE PO IS             06593564
065936*** ACTIVE ON THE EASPOBYPAS PARM.                                06593664
065937********************************************************          06593764
065938 8930-EAS-BYPASS-BY-PO.                                           06593864
065939                                                                  06593964
065940     EXEC SQL                                                     06594064
065941     SELECT   E.ATTR_ELEM_TXT                                     06594164
065942      INTO  :PS-EAS-PO-BYPASS-SW                                  06594264
065943      FROM                                                        06594364
065944            WST_INTGRTN_TYP  A                                    06594464
065945         ,  WST_ATTR_DEFN    B                                    06594564
065946         ,  WST_ATTR_ELEM    D              -- PO NUMBER          06594664
065947         ,  WST_ATTR_ELEM    E              -- Y/N SWITCH         06594764
065948         ,  WST_ATTR_ELEM    F              -- FROM TMST          06594864
065949         ,  WST_ATTR_ELEM    G              -- TO TMST            06594964
065950      WHERE                                                       06595064
065951            A.INTGRTN_TYP_CDE   = 'EASPOBYPAS'                    06595164
065952        AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE               06595264
065953        AND B.ATTR_DEFN_SEQ_NBR = 1                               06595364
065954        AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE               06595464
065955        AND D.ATTR_DEFN_SEQ_NBR = 1                               06595564
065956        AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE               06595664
065957        AND E.ATTR_DEFN_SEQ_NBR = 2                               06595764
065958        AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE               06595864
065959        AND F.ATTR_DEFN_SEQ_NBR = 3                               06595964
065960        AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE               06596064
065961        AND G.ATTR_DEFN_SEQ_NBR = 4                               06596164
065962        AND D.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR             06596264
065963        AND D.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR             06596364
065964        AND D.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR             06596464
065965        AND D.ATTR_ELEM_NBR     = :DK-PO-NBR                      06596564
065966        AND E.ATTR_ELEM_TXT     = 'Y'                             06596664
065967        AND F.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP               06596764
065968        AND G.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP               06596864
065969         WITH UR                                                  06596964
065970     END-EXEC.                                                    06597064
065971                                                                  06597164
065972     EVALUATE TRUE                                                06597264
065973         WHEN SQLCODE = ZERO                                      06597364
065974              SET PV-EAS-TAGGING-FOR-DEPT-NO  TO TRUE             06597464
065975         WHEN SQLCODE = +100                                      06597564
065976              CONTINUE                                            06597664
065977         WHEN OTHER                                               06597764
065981              MOVE '8930-EAS-BYPASS-BY-PO' TO                     06598164
065982                   WS-ABEND-PARAGRAPH                             06598264
065983              MOVE 'SELECT WST PARM EASPOBYPAS' TO                06598364
065984                   WS-ABEND-OPERATION                             06598464
065985              MOVE 'WST_ATTR_ELEM' TO WS-ABEND-STRUCTURE-1        06598564
065986              PERFORM 9900-DB2-ABEND                              06598664
065987     END-EVALUATE.                                                06598764
065988                                                                  06598864
065989 9000-TERMINATE.                                                  06598964
065990     MOVE '9000-TERMINATE'         TO PV-ABEND-PARAGRAPH.         06599000
066000                                                                  06600000
066100     CLOSE TRIP-EXTRACT-FILE-IN1                                  06610000
066200           TRIP-EXTRACT-FILE-IN2                                  06620000
066300           TRIP-EXTRACT-FILE1                                     06630000
066400           TRIP-EXTRACT-FILE2.                                    06640000
066500                                                                  06650000
066600                                                                  06660000
066700     DISPLAY '************************'.                          06670000
066800     DISPLAY '******* PCKUT108 *******'.                          06680000
066900     DISPLAY '************************'.                          06690000
067000     DISPLAY SPACES                                               06700000
067100                                                                  06710000
067200     DISPLAY '************************'.                          06720000
067300     MOVE WS-WRITE-COUNT         TO WS-DISPLAY-COUNT.             06730000
067400     DISPLAY 'TOTAL RECORDS WRITTEN TO FILE 1 = '                 06740000
067500                                               WS-DISPLAY-COUNT.  06750000
067600     MOVE WS-WRITE-COUNT2        TO WS-DISPLAY-COUNT.             06760000
067700     DISPLAY 'TOTAL RECORDS WRITTEN TO FILE 2 = '                 06770000
067800                                               WS-DISPLAY-COUNT.  06780000
067900                                                                  06790000
068000     DISPLAY SPACES                                               06800000
068100     DISPLAY '************************'.                          06810000
068200                                                                  06820000
068300                                                                  06830000
068400 9900-DB2-ABEND.                                                  06840000
068500     MOVE '9900-DB2-ABEND'         TO PV-ABEND-PARAGRAPH.         06850000
068600                                                                  06860000
068700     MOVE SQLCODE TO WS-SQLCODE.                                  06870000
068800     DISPLAY '*** DB2 ERROR '.                                    06880000
068900     DISPLAY '*** SQLCODE   = ' WS-SQLCODE.                       06890000
069000     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 06900000
069100     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               06910000
069200     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               06920000
069300     DISPLAY '*** MESSAGE   = ' WS-DB2-OPERATION-MESSAGE-1.       06930000
069400     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-2.       06940000
069500     DISPLAY '***           = ' WS-DB2-OPERATION-MESSAGE-3.       06950000
069600     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             06960000
069700     DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.             06970000
069800     DISPLAY '*** TABLE 3   = ' WS-ABEND-STRUCTURE-3.             06980000
069900     DISPLAY '*** TABLE 4   = ' WS-ABEND-STRUCTURE-4.             06990000
070000     DISPLAY '*** TABLE 5   = ' WS-ABEND-STRUCTURE-5.             07000000
070100     DISPLAY '*** TABLE 6   = ' WS-ABEND-STRUCTURE-6.             07010000
070200     DISPLAY '*** TABLE 7   = ' WS-ABEND-STRUCTURE-7.             07020000
070300                                                                  07030000
070400     IF WS-ABEND-STRUCTURE-2 > SPACES                             07040000
070500         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2          07050000
070600     END-IF.                                                      07060000
070700     IF WS-ABEND-STRUCTURE-3 > SPACES                             07070000
070800         DISPLAY '*** TABLE 3   = ' WS-ABEND-STRUCTURE-3          07080000
070900     END-IF.                                                      07090000
071000                                                                  07100000
071100     COPY DPPD004.                                                07110000
071200                                                                  07120000
071300     MOVE +4013                  TO WS-ABEND-CODE.                07130000
071400     CALL 'ILBOABN0' USING WS-ABEND-CODE.                         07140000
