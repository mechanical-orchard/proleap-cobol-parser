      ******************************************************************00010000
       IDENTIFICATION DIVISION.                                         00020000
      ******************************************************************00030000
                                                                        00040000
       PROGRAM-ID.                FSKCS060.                             00050000
       AUTHOR.                    COGNIZANT.                            00060000
       INSTALLATION.              KOHLS DEPARTMENT STORES.              00070000
       DATE-WRITTEN.              02-25-11.                             00080000
       DATE-COMPILED.                                                   00090000
                                                                        00100000
      ******************************************************************00110000
      *    F060 - FORCE RECEIPT DATE.                                  *00120000
      *                                                                *00130000
      *    THIS PROGRAM ALLOWS THE USER TO FORCE THE FIRST RECEIPT     *00140000
      *    DATE  IN TSKST TABLE.                                       *00150000
      *                                                                *00160000
      *    THIS SCREEN WILL BE ACCESSED VIA FASHION SALES MENU.        *00170000
      ******************************************************************00180000
272945* 08/05/2022  JIM HUNTER    CHANGE CALL OF DPKUT100 TO           *00181029
272945*                           CALL DP010I-NUMERIC-EDIT-ROUTINE     *00182029
272945*                           MAKING THE CALL DYNAMIC VS STATIC.   *00183029
272945*                           CHG0272945                           *00184029
1022RM* 10/25/2022  BOB MCASEY    CHANGE PARAMETERS FOR CALLING THE   * 00184130
1022RM*                           CICS ARCHITECTURE API.  ADDED       * 00184230
1022RM*                           DPKCS930 COPYBOOK.                  * 00184330
1022RM*                           CHG0277188                          * 00184431
272945******************************************************************00185029
                                                                        00190000
      ******************************************************************00200000
       ENVIRONMENT DIVISION.                                            00210000
      ******************************************************************00220000
                                                                        00230000
      ******************************************************************00240000
       DATA DIVISION.                                                   00250000
      ******************************************************************00260000
                                                                        00270000
       WORKING-STORAGE SECTION.                                         00280000
       01  PC-TSYMSG-AREA.                                              00290000
           05  PC-TSYMSG-00073            PIC 9(5) VALUE 00073.         00300015
           05  PC-TSYMSG-03701            PIC 9(5) VALUE 03701.         00302015
           05  PC-TSYMSG-03702            PIC 9(5) VALUE 03702.         00303015
           05  PC-TSYMSG-03703            PIC 9(5) VALUE 03703.         00304015
                                                                        00330000
      ******************************************************************00340000
      *  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00350000
      ******************************************************************00360000
           COPY DPWS013.                                                00370000
                                                                        00380000
      *----------------------------------------------------------------*00390000
      *    FUNCTION KEYS COPYBOOK                                      *00400000
      *----------------------------------------------------------------*00410000
           COPY DPWS016.                                                00420000
                                                                        00430000
           COPY DPWS030.                                                00440000
1022RM     COPY DPWS930.                                                00441030
           COPY DPWS020.                                                00450000
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00460000
               10  INTER-APPL-COMM-AREA  PIC X(200).                    00470000
           COPY FSWS003.                                                00480000
               10 ASC-SPECIFIC-COMMAREA.                                00490000
                  15  FILLER             PIC X(02).                     00500000
                  15  ASC-SKU-NO         PIC X(08).                     00510000
                  15  ASC-RCPT-DT        PIC X(6).                      00511026
                  15  ASC-NEW-SKU-SW     PIC  X(01).                    00512000
                      88  ASC-NEW-SKU-YES VALUE 'Y'.                    00513000
                      88  ASC-NEW-SKU-NO  VALUE 'N'.                    00514000
               10 FILLER                 PIC X(2848).                   00520000
      ******************************************************************00530000
      *  DSECT CREATED BY MAP FSKM060                                   00540000
      ******************************************************************00550000
           COPY FSKM060.                                                00560000
                                                                        00570000
                                                                        00580000
       01  PC-PROGRAM-CONSTANTS.                                        00590000
           05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'FSKCS060'.   00600000
           05  PC-CURRENT-MAPSET-NAME  PIC X(08)    VALUE 'FSKM060 '.   00610000
           05  PC-CURRENT-MAP-NAME     PIC X(08)    VALUE 'FS060A  '.   00620000
           05  PC-DPKCS030             PIC X(08)    VALUE 'DPKCS030'.   00630000
           05  PC-MAXIMUM-RETRY-COUNT  PIC S9(4)    VALUE +2 COMP SYNC. 00640000
                                                                        00760000
                                                                        00770000
       01  PM-CICSAUTH-MESSAGE.                                         00780000
           05  FILLER                  PIC  X(36)     VALUE             00790000
               'INVALID RETURN CODE FROM CICSAUTH - '.                  00800000
           05  PM-CM-RETURN-CODE       PIC  9(04).                      00810000
                                                                        00820000
                                                                        00830000
       01  PS-PROGRAM-SWITCHES.                                         00840000
           05  PS-EDIT-ERROR-SW               PIC X(01)    VALUE 'N'.   00900000
               88  PS-EDIT-ERROR                           VALUE 'Y'.   00910000
               88  PS-NO-EDIT-ERROR                        VALUE 'N'.   00920000
                                                                        00930000
       01  PV-PROGRAM-VARIABLES.                                        00940000
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          00950000
                                       COMP SYNC.                       00960000
           05  PV-CICS-RESPONSE        PIC S9(9)    VALUE ZERO          00970000
                                                    COMP SYNC.          00980000
                                                                        00990000
       01  PV-SKU-NBR                  PIC 9(08).                       01000000
                                                                        01010000
       01  DATE-IN.                                                     01011000
           05 DATE-IN-YY               PIC XX.                          01012000
           05 DATE-IN-MM               PIC XX.                          01013000
           05 DATE-IN-DD               PIC XX.                          01014000
                                                                        01020000
       01  PV-TSKST-DATE.                                               01021127
           05  PV-DATE-EDIT                    PIC 9(06)   VALUE ZERO.  01021227
                                                                        01021327
           05  FILLER REDEFINES PV-DATE-EDIT.                           01021427
               10  PV-DATE-YY                  PIC  9(02).              01021627
               10  PV-DATE-MM                  PIC  9(02).              01021827
               10  PV-DATE-DT                  PIC  9(02).              01022027
                                                                        01022127
           05  PV-DATE-EDT             PIC 9(7).                        01022228
           05  PV-DATE-EDT-TMP REDEFINES PV-DATE-EDT.                   01022328
               10  FILLER              PIC  9(1).                       01022428
               10  PV-YY               PIC  9(2).                       01022528
               10  PV-MM               PIC  9(2).                       01022628
               10  PV-DD               PIC  9(2).                       01022728
           05  PV-DATE-EDIT-FNL.                                        01022828
               10  PV-MM-FNL           PIC  X(2).                       01022928
               10  PV-DD-FNL           PIC  X(2).                       01023028
               10  PV-YY-FNL           PIC  X(2).                       01024028
                                                                        01030000
      ******************************************************************01040000
      *  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE            01050000
      ******************************************************************01060000
           COPY DPWS010I.                                               01070000
                                                                        01080000
      ******************************************************************01090000
      *  STANDARD ATTENTION IDENTIFIER LIST                             01100000
      ******************************************************************01110000
           COPY DFHAID.                                                 01120000
                                                                        01130000
      ******************************************************************01140000
      *  STANDARD KOHL'S ATTRIBUTE LIST                                 01150000
      ******************************************************************01160000
           COPY DPWS015.                                                01170000
                                                                        01180000
      ******************************************************************01190000
      *    SQLCA IS THE DB2 COMMUNICATIONS AREA                        *01200000
      ******************************************************************01210000
           EXEC SQL                                                     01220000
               INCLUDE SQLCA                                            01230000
           END-EXEC.                                                    01240000
                                                                        01250000
      ***************************************************************** 01260000
      *    MBS   TABLE - TSKXREF                                        01270000
      ***************************************************************** 01280000
                                                                        01290000
           EXEC SQL                                                     01300000
               INCLUDE TSKXREF                                          01310000
           END-EXEC.                                                    01320000
                                                                        01330000
      ***************************************************************** 01340000
      *    EMPLOYEE TABLE - TSKST                                       01350000
      ***************************************************************** 01360000
                                                                        01370000
           EXEC SQL                                                     01380000
               INCLUDE TSKST                                            01390000
           END-EXEC.                                                    01400000
                                                                        01410000
      ***************************************************************** 01420000
       LINKAGE SECTION.                                                 01530000
      ******************************************************************01540000
                                                                        01550000
       01  DFHCOMMAREA.                                                 01560000
           05  FILLER                         OCCURS  1 TO 4072 TIMES   01570000
                                              DEPENDING ON EIBCALEN.    01580000
               10  FILLER                     PIC X.                    01590000
                                                                        01600000
      ******************************************************************01610000
       PROCEDURE DIVISION.                                              01620000
      ******************************************************************01630000
                                                                        01640000
       0000-MAINLINE.                                                   01650000
           MOVE '*0000-MAINLINE.                  *' TO DP013-PARAGRAPH 01660000
                                                                        01670000
           ACCEPT DATE-IN  FROM DATE.                                   01671000
           INITIALIZE DP030-CICS-API-FIELDS.                            01680000
           MOVE +1                      TO DP030-NUMBER-OF-MAPS.        01690000
           MOVE PC-CURRENT-MAPSET-NAME  TO DP030-MAPSET-NAME.           01700000
           MOVE PC-CURRENT-MAP-NAME     TO DP030-MAP-NAME (1).          01710000
           SET DP030-RECEIVE-APPL-MAP   TO TRUE.                        01720000
           MOVE LENGTH OF FS060AI       TO DP030-MAP-LENGTH (1).        01730000
           MOVE 'PROGRAM ENTRY CALL'    TO DP013-MESSAGE-TEXT (1).      01740000
           PERFORM 0001-CALL-CICS-ARCH-API.                             01750000
                                                                        01760000
           PERFORM 1000-CONTROL-PROCESSING.                             01770000
                                                                        01780000
           MOVE 'PROGRAM EXIT CALL'     TO DP013-MESSAGE-TEXT (1).      01790000
           PERFORM 0001-CALL-CICS-ARCH-API.                             01800000
                                                                        01810000
           GOBACK.                                                      01820000
                                                                        01830000
           EJECT                                                        01840000
      *----------------------------------------------------------------*01850000
      *   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *01860000
      *   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *01870000
      *----------------------------------------------------------------*01880000
                                                                        01890000
       0001-CALL-CICS-ARCH-API.                                         01900000
                                                                        01910000
           IF PS-EDIT-ERROR                                             01920000
               IF DP030-SET-CURSOR-APPL-1                               01940000
                   IF DP020-MSG-WARNING OR                              01950000
                      DP020-MSG-INFORMATIONAL                           01960000
                       NEXT SENTENCE                                    01970000
                   ELSE                                                 01980000
                       SET DP020-MSG-FATAL           TO TRUE            01990000
               ELSE                                                     02000000
                   IF DP030-SET-CURSOR-ABSOLUTE                         02010000
                       NEXT SENTENCE                                    02020000
                   ELSE                                                 02030000
                       SET DP030-SET-CURSOR-TRAILER  TO TRUE.           02040000
                                                                        02050000
           CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     02060030
                                           DFHCOMMAREA                  02070030
                                           DP030-CICS-API-FIELDS        02080030
                                           DP020-STANDARD-COMMAREA      02090030
                                           FS060AI.                     02100030
                                                                        02110000
           IF  DP030-RC-CALL-SUCCESSFUL                                 02120000
               CONTINUE                                                 02130000
           ELSE                                                         02140000
               SET DP013-NO-ROLLBACK TO TRUE                            02150000
               SET DP013-XCTL-DISPLAY-RESTART TO TRUE                   02160000
               SET DP013-CICS-ABEND TO TRUE                             02170000
               MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        02180000
1022RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02201030
1022RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02202030
               MOVE DP030-RETURN-CODE                                   02210000
                                     TO DP013-MESSAGE-TEXT (3)          02220000
               PERFORM DP013-0000-PROCESS-ABEND                         02230000
           END-IF.                                                      02240000
                                                                        02250000
                                                                        02255020
       1000-CONTROL-PROCESSING.                                         02260000
           MOVE '*1000-CONTROL-PROCESSING.        *' TO DP013-PARAGRAPH 02270000
                                                                        02290000
           EVALUATE TRUE                                                02300000
               WHEN DP020-NEXT-ACT-INITIAL                              02310000
                   INITIALIZE ASC-SKU-NO                                02320000
                              ASC-RCPT-DT                               02321000
                              ASKUI                                     02330000
                              ARCPTDTI                                  02331000
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     02332000
                   SET ASC-NEW-SKU-YES          TO TRUE                 02333000
                   SET DP030-SET-CURSOR-APPL-1  TO TRUE                 02340000
                   MOVE -1                      TO ASKUL                02350000
               WHEN DP020-NEXT-ACT-RETURN                               02360000
                   SET DP030-SET-CURSOR-APPL-1   TO TRUE                02370000
                   MOVE -1                       TO ASKUL               02380000
                   MOVE FS003-SKU-NO TO ASC-SKU-NO                      02390000
                                        ASKUI                           02400000
                   PERFORM 3000-EDIT-INPUT-FIELDS                       02410000
               WHEN DP020-NEXT-ACT-READ-MAP                             02420000
                   PERFORM 2000-FKEY-PROCESSING                         02430000
                                                                        02440000
               WHEN OTHER                                               02450000
                   SET DP013-LOGIC-ABEND                                02460000
                       DP013-NO-ROLLBACK TO TRUE                        02470000
                   MOVE '1000-CONTROL-PROCESSING'                       02480000
                                         TO  DP013-PARAGRAPH            02490000
                   MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02500000
                                         TO  DP013-MESSAGE-TEXT(1)      02510000
                   MOVE DP020-NEXT-APPL-ACTIVITY                        02520000
                                         TO DP013-MESSAGE-TEXT(2)       02530000
                   PERFORM DP013-0000-PROCESS-ABEND                     02540000
           END-EVALUATE.                                                02550000
           EJECT                                                        02560000
      ******************************************************************02570000
      *    FUNCTION KEY PROCESSING                                     *02580000
      ******************************************************************02590000
                                                                        02610000
           EJECT                                                        02620000
                                                                        02621020
      *----------------------------------------------------------------*02623020
      *   THIS PARAGRAPH VALIDATES THE REQUEST TYPE AND INVOKES OTHER  *02624020
      *   PARAGRAPH ACCORDINGLY                                        *02625020
      *----------------------------------------------------------------*02626020
                                                                        02627020
       2000-FKEY-PROCESSING.                                            02630000
           MOVE '*2000-FKEY-PROCESSING.           *' TO DP013-PARAGRAPH 02640000
                                                                        02650000
           SET PS-NO-EDIT-ERROR TO TRUE                                 02660000
                                                                        02670000
           EVALUATE TRUE                                                02680000
                                                                        02690000
      *   REFRESH LOGIC IS MAPPED TO DP020-FK-REFRESH KEY               02691022
               WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02700015
                   MOVE SPACES     TO ARCPTDTO                          02731015
                                      ASKUO                             02732015
                   SET DP030-SET-CURSOR-APPL-1  TO TRUE                 02740015
                   MOVE -1                      TO ASKUL                02750015
                                                                        02760000
      *   UPDATE (F15) LOGIC IS MAPPED TO DP020-FK-LOCAL-FUNC-01        02760122
               WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               02761012
                        PERFORM 3000-EDIT-INPUT-FIELDS                  02763100
                        IF  PS-NO-EDIT-ERROR                            02764000
                            MOVE ASC-SKU-NO  TO ASKUI                   02765000
                            PERFORM 4000-FETCH-FIRST-RCPT-DATE          02766000
                            SET PS-NO-EDIT-ERROR TO TRUE                02766121
                            PERFORM 5000-CHECK-FIRST-RCPT-DATE          02766215
                            IF  PS-NO-EDIT-ERROR                        02766318
                                PERFORM 6000-UPDATE-FIRST-RCPT-DATE     02766418
                            END-IF                                      02766518
                        END-IF                                          02767000
                                                                        02769300
      *   SELECT (F14) LOGIC IS MAPPED TO DP020-FK-LOCAL-FUNC-02        02769422
               WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               02769515
                        PERFORM 3000-EDIT-INPUT-FIELDS                  02770000
                        IF  PS-NO-EDIT-ERROR                            02770100
                            MOVE ASC-SKU-NO   TO ASKUI                  02770200
                            PERFORM 4000-FETCH-FIRST-RCPT-DATE          02770300
                        END-IF                                          02771000
               WHEN OTHER                                               02772000
                                                                        02780000
                   PERFORM 3000-EDIT-INPUT-FIELDS                       02790000
                                                                        02800000
                                                                        02810000
           END-EVALUATE.                                                02820000
                                                                        02830000
           IF  PS-NO-EDIT-ERROR                                         02840000
               SET DP030-CONTINUE-GO TO TRUE                            02850000
           ELSE                                                         02860000
               SET DP030-OVERRIDE-GO TO TRUE                            02870000
               IF DP020-MSG-INFORMATIONAL OR                            02880000
                  DP020-MSG-WARNING                                     02890000
                   NEXT SENTENCE                                        02900000
               ELSE                                                     02910000
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE.                 02920000
                                                                        02930000
           EJECT                                                        02940000
       3000-EDIT-INPUT-FIELDS.                                          02950000
           MOVE '*3000-EDIT-INPUT-FIELDS.         *' TO DP013-PARAGRAPH 02960000
                                                                        02970000
      ******************************************************************02980000
      *  PROCESS INFORMATION ENTERED ON THE SCREEN. RECEIVE THE MAP     02990000
      *  AND FILL THE COMMAREA FIELDS FROM THE MAP FIELDS. UPDATE THE   03000000
      *  SCREEN HEADER IN PREPARATION FOR EVENTUAL SENDING BACK OUT TO  03010000
      *  TERMINAL. RESET THE ATTRIBUTES FOR THE PROGRAM KEY FIELDS BACK 03020000
      *  TO THE DEFAULTS. EDIT THE SCREEN FIELDS.                       03030000
      ******************************************************************03050000
                                                                        03060000
           PERFORM 3200-FILL-COMMAREA.                                  03070000
                                                                        03080000
           PERFORM 3300-EDIT-SCREEN-FIELDS.                             03090000
                                                                        03100000
      *                                                                 03110000
       3200-FILL-COMMAREA.                                              03120000
           MOVE '*3200-FILL-COMMAREA.             *' TO DP013-PARAGRAPH 03130000
      ******************************************************************03140000
      *  MOVE MAP FIELDS TO THE COMMUNICATIONS AREA.                   *03150000
      ******************************************************************03160000
      * SKU NO                                                          03170000
           IF ASKUL > ZERO                                              03180000
               MOVE ASKUI                  TO ASC-SKU-NO                03190000
           ELSE                                                         03200000
               IF ASKUF =     DP015-ERASE-EOF                           03210000
                   MOVE SPACES             TO ASC-SKU-NO                03220000
               ELSE                                                     03230000
                   IF FS003-SKU-NO NOT = SPACES                         03240000
                      MOVE FS003-SKU-NO       TO ASC-SKU-NO             03250000
                   END-IF                                               03260000
               END-IF                                                   03270000
           END-IF.                                                      03280000
                                                                        03290000
       3300-EDIT-SCREEN-FIELDS.                                         03300000
           MOVE '*3300-EDIT-SCREEN-FIELDS.        *' TO DP013-PARAGRAPH 03310000
                                                                        03320000
      ******************************************************************03330000
      *  SET THE ATTRIBUTES FOR ALL ENTERABLE KEY SCREEN FIELDS BACK TO*03340000
      *  THEIR MAP DEFAULTS.                                           *03350000
      ******************************************************************03360000
      * SKU                                                             03370000
           MOVE DP015-UNDERLINE            TO ASKUH.                    03380000
           MOVE DP015-HL-OFF               TO ARCPTDTH.                 03381025
           MOVE DP015-GREEN                TO ASKUC.                    03390000
           MOVE DP015-BLUE                 TO ARCPTDTC                  03390225
           MOVE DP015-UNP-NUM-NOR-OFF      TO ASKUA.                    03400000
           MOVE DP015-PRO-NOR-OFF          TO ARCPTDTA.                 03401020
                                                                        03410000
                                                                        03420000
      ******************************************************************03430000
      *  EDIT SCREEN FIELDS.  IF ERRORS ARE DETECTED, USE REVERSE      *03440000
      *  VIDEO, RED, AND HIGH INTENSITY TO INDICATE THE ERRORS, AND    *03450000
      *  POSITION THE CURSOR AT THE FIRST ERROR ENCOUNTERED,           *03460000
      *  DISPLAYING AN ASSOCIATED ERROR MESSAGE AT THE BOTTOM OF THE   *03470000
      *  SCREEN.                                                        03480000
      ******************************************************************03490000
                                                                        03500000
           SET PS-NO-EDIT-ERROR            TO TRUE.                     03510000
                                                                        03520000
      * SKU NUMBER MUST BE NUMERIC                                      03530000
           MOVE ASC-SKU-NO                 TO DP010I-UNEDITED-FIELD.    03540000
           MOVE 8                          TO DP010I-MAXIMUM-DIGITS.    03550000
           MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03560000
           SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03570000
272945     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03581029
272945                     USING DP010I-NUMERIC-EDIT-AREA.              03582029
                                                                        03590000
           IF  (DP010I-ERROR-DETECTED                                   03600000
                   OR DP010I-NUMERIC-FIELD = ZERO)                      03610000
               MOVE DP015-REVERSE          TO ASKUH                     03620000
               MOVE DP015-RED              TO ASKUC                     03630000
               MOVE DP015-UNP-NUM-BRT-OFF  TO ASKUA                     03640000
               IF  NOT PS-EDIT-ERROR                                    03650000
                   SET PS-EDIT-ERROR       TO TRUE                      03660000
                   MOVE PC-TSYMSG-00073    TO DP020-MSG-NUMBER          03670015
                   SET DP020-MSG-FATAL     TO TRUE                      03671016
                   MOVE -1                 TO ASKUL                     03680000
               END-IF                                                   03690000
           ELSE                                                         03700000
               MOVE DP010I-NUMERIC-FIELD   TO PV-SKU-NBR                03710000
               MOVE PV-SKU-NBR             TO ASC-SKU-NO                03720000
                                              FS003-SKU-NO              03730000
                                              ASKUI                     03740000
           END-IF.                                                      03750000
                                                                        03751000
      ******************************************************************03752022
      *  THIS PARAGRAPH FETCHES THE FIRST RECEIPT DATE                 *03753022
      ******************************************************************03755022
      *                                                                 05390000
       4000-FETCH-FIRST-RCPT-DATE.                                      05391000
                                                                        05392000
           INITIALIZE PV-RETRY-COUNT                                    05393000
                      TSKST-FIRST-RCVD-DATE                             05394000
                      SKXREF-ITM-NBR                                    05395000
                      SKXREF-SKU                                        05396000
           MOVE ASKUI          TO   ASC-SKU-NO                          05397000
                                    SKXREF-SKU                          05398000
           PERFORM                                                      05399000
               WITH TEST AFTER                                          05399100
               UNTIL SQLCODE = ZERO                                     05399200
                  OR SQLCODE = +100                                     05399300
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT            05399400
               EXEC SQL                                                 05399500
                    SELECT S.FIRST_RCVD_DATE,                           05399600
                           X.ITM_NBR                                    05399700
                      INTO :TSKST-FIRST-RCVD-DATE,                      05399800
                           :SKXREF-ITM-NBR                              05399900
                      FROM TSKXREF  X,                                  05400000
                           TSKST    S                                   05400100
                     WHERE X.ITM_NBR = S.ITEM_NMBR                      05400200
                       AND X.SKU = :SKXREF-SKU                          05400300
                       AND S.LOC_NBR = 0                                05400400
               END-EXEC                                                 05400500
               EVALUATE TRUE                                            05400600
                   WHEN SQLCODE = ZERO                                  05400700
                      MOVE TSKST-FIRST-RCVD-DATE  TO PV-DATE-EDT        05400827
                      MOVE PV-YY                 TO PV-YY-FNL           05401026
                      MOVE PV-MM                 TO PV-MM-FNL           05401126
                      MOVE PV-DD                 TO PV-DD-FNL           05401226
                      MOVE PV-DATE-EDIT-FNL      TO ASC-RCPT-DT         05401526
                      MOVE ASC-RCPT-DT           TO ARCPTDTO            05401626
                      IF TSKST-FIRST-RCVD-DATE = 0                      05401726
                         SET PS-EDIT-ERROR       TO TRUE                05401826
                         MOVE PC-TSYMSG-03703    TO DP020-MSG-NUMBER    05401926
                     SET DP020-MSG-INFORMATIONAL TO TRUE                05402026
                         MOVE -1                 TO ASKUL               05402126
                      END-IF                                            05402226
                   WHEN SQLCODE = 100                                   05402326
                      SET PS-EDIT-ERROR       TO TRUE                   05402426
                      MOVE PC-TSYMSG-00073    TO DP020-MSG-NUMBER       05402526
                      SET DP020-MSG-FATAL     TO TRUE                   05402626
                      MOVE -1                 TO ASKUL                  05402726
                      MOVE DP015-UNP-NUM-BRT-MDT TO ASKUA               05402826
                      MOVE DP015-RED             TO ASKUC               05402926
                      MOVE DP015-REVERSE         TO ASKUH               05403026
                   WHEN SQLCODE = -904                                  05403126
                   WHEN SQLCODE = -913                                  05403226
                        ADD +1 TO PV-RETRY-COUNT                        05403326
                   WHEN SQLCODE < ZERO                                  05403426
                   WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))     05403526
                   WHEN SQLWARN0 NOT = SPACES                           05403626
                       MOVE '4000-FETCH-FIRST-RCPT-DATE'                05403726
                         TO DP013-PARAGRAPH                             05403826
                       MOVE 'SELECT A SKU FROM THE XREF TABLE'          05403926
                                          TO DP013-MESSAGE-TEXT(1)      05404026
                       PERFORM 9900-DB2-ERROR                           05404126
               END-EVALUATE                                             05404226
           END-PERFORM.                                                 05404326
           EJECT                                                        05404426
                                                                        05404526
      ******************************************************************05404626
      *  THIS PARAGRAPH VALIDATES IF THE FIRST RECEIPT DATE IS SET     *05404726
      ******************************************************************05404826
       5000-CHECK-FIRST-RCPT-DATE.                                      05405000
                                                                        05406000
           MOVE TSKST-FIRST-RCVD-DATE  TO PV-DATE-EDT                   05407027
           MOVE PV-YY                 TO PV-YY-FNL                      05408026
           MOVE PV-MM                 TO PV-MM-FNL                      05409026
           MOVE PV-DD                 TO PV-DD-FNL                      05409126
           MOVE PV-DATE-EDIT-FNL      TO ASC-RCPT-DT                    05409226
           MOVE ASC-RCPT-DT           TO ARCPTDTO                       05409326
           IF TSKST-FIRST-RCVD-DATE NOT = ZEROES                        05409516
              SET PS-EDIT-ERROR          TO TRUE                        05409600
              MOVE PC-TSYMSG-03701       TO DP020-MSG-NUMBER            05409715
              SET DP020-MSG-FATAL        TO TRUE                        05409816
              MOVE -1                    TO ASKUL                       05409900
              MOVE DP015-PRO-BRT-MDT     TO ARCPTDTA                    05410020
              MOVE DP015-RED             TO ARCPTDTC                    05410100
              MOVE DP015-REVERSE         TO ARCPTDTH                    05410200
           END-IF.                                                      05410400
      *                                                                 05410500
      ******************************************************************05410722
      *  THIS PARAGRAPH UPDATES CURRENT DATE TO FIRST RECEIPT DATE IN  *05410823
      *  TSKST TABLE                                                   *05410923
      ******************************************************************05411023
       6000-UPDATE-FIRST-RCPT-DATE.                                     05411123
                                                                        05411223
           INITIALIZE PV-RETRY-COUNT                                    05411323
                      TSKST-FIRST-RCVD-DATE                             05411423
                      TSKST-ITEM-NMBR                                   05411523
                                                                        05411623
           MOVE DATE-IN-YY    TO PV-DATE-YY.                            05411723
           MOVE DATE-IN-MM    TO PV-DATE-MM.                            05411823
           MOVE DATE-IN-DD    TO PV-DATE-DT.                            05411923
                                                                        05412023
           MOVE PV-DATE-EDIT           TO  TSKST-FIRST-RCVD-DATE        05412123
           MOVE SKXREF-ITM-NBR         TO  TSKST-ITEM-NMBR              05412223
           PERFORM                                                      05412323
               WITH TEST AFTER                                          05412423
               UNTIL SQLCODE = ZERO                                     05412523
                  OR SQLCODE = +100                                     05412623
                  OR PV-RETRY-COUNT > PC-MAXIMUM-RETRY-COUNT            05412723
               EXEC SQL                                                 05412823
                    UPDATE TSKST                                        05412923
                       SET FIRST_RCVD_DATE = :TSKST-FIRST-RCVD-DATE     05413023
                     WHERE ITEM_NMBR = :TSKST-ITEM-NMBR                 05413123
                       AND LOC_NBR = 0                                  05413223
               END-EXEC                                                 05413323
               EVALUATE TRUE                                            05413423
                   WHEN SQLCODE = ZERO                                  05413523
                        PERFORM 7000-DB2-COMMIT                         05413623
                        MOVE -1 TO ASKUL                                05413723
                        MOVE TSKST-FIRST-RCVD-DATE  TO PV-DATE-EDT      05413827
                        MOVE PV-YY                 TO PV-YY-FNL         05413926
                        MOVE PV-MM                 TO PV-MM-FNL         05414026
                        MOVE PV-DD                 TO PV-DD-FNL         05414126
                        MOVE PV-DATE-EDIT-FNL      TO ASC-RCPT-DT       05414226
                        MOVE ASC-RCPT-DT           TO ARCPTDTO          05414326
                        SET PS-EDIT-ERROR           TO TRUE             05414423
                        MOVE PC-TSYMSG-03702        TO DP020-MSG-NUMBER 05414523
                        SET DP020-MSG-INFORMATIONAL TO TRUE             05414623
                        MOVE -1                     TO ASKUL            05414723
                        PERFORM 0001-CALL-CICS-ARCH-API                 05414823
                   WHEN SQLCODE = 100                                   05414923
                        SET PS-EDIT-ERROR          TO TRUE              05415023
                        MOVE PC-TSYMSG-00073       TO DP020-MSG-NUMBER  05415123
                        SET DP020-MSG-FATAL        TO TRUE              05415223
                        MOVE -1                    TO ASKUL             05415323
                        MOVE DP015-UNP-NUM-BRT-MDT TO ASKUA             05415423
                        MOVE DP015-RED             TO ASKUC             05415523
                        MOVE DP015-REVERSE         TO ASKUH             05415623
                   WHEN SQLCODE = -904                                  05415723
                   WHEN SQLCODE = -913                                  05415823
                        ADD +1 TO PV-RETRY-COUNT                        05415923
                   WHEN SQLCODE < ZERO                                  05416023
                   WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))     05416123
                   WHEN SQLWARN0 NOT = SPACES                           05416223
                       MOVE '6000-UPDATE-FIRST-RCPT-DATE'               05416323
                         TO DP013-PARAGRAPH                             05416423
                       MOVE 'UPDATE FAILED ON TSKST TABLE'              05416523
                                          TO DP013-MESSAGE-TEXT(1)      05416623
                      MOVE DP015-UNP-NUM-BRT-MDT TO ASKUA               05416723
                      MOVE DP015-RED             TO ASKUC               05416823
                      MOVE DP015-REVERSE         TO ASKUH               05416923
                      PERFORM 9900-DB2-ERROR                            05417023
               END-EVALUATE                                             05417123
           END-PERFORM.                                                 05417223
      *----------------------------------------------------------------*05417323
      * DB2 COMMIT                                                     *05417423
      *----------------------------------------------------------------*05417523
                                                                        05417623
       7000-DB2-COMMIT.                                                 05417723
                                                                        05417823
           EXEC SQL                                                     05417923
                COMMIT                                                  05418023
           END-EXEC.                                                    05418123
                                                                        05418223
      ******************************************************************05419000
      *  ROLL BACK ALL RESOURCES, FOLLOWING A DB2 ERROR.  FORMAT       *05420000
      *  INFORMATION RELATIVE TO THE ERROR.                            *05430000
      ******************************************************************05440000
       9900-DB2-ERROR.                                                  05450000
                                                                        05460000
           EXEC CICS                                                    05470000
               SYNCPOINT                                                05480000
                   ROLLBACK                                             05490000
                   RESP(PV-CICS-RESPONSE)                               05500000
           END-EXEC.                                                    05510000
                                                                        05520000
           IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    05530000
               MOVE 'ROLLBACK FAILED'    TO DP013-MESSAGE-TEXT(2)       05540000
           END-IF.                                                      05550000
                                                                        05560000
           MOVE SQLCA                TO DP013-SQLCA                     05570000
           SET DP013-DB2-ABEND                                          05580000
               DP013-XCTL-DISPLAY-RESTART TO TRUE                       05590000
           PERFORM DP013-0000-PROCESS-ABEND.                            05600000
                                                                        05610000
      ******************************************************************05620000
      *  ROLL BACK ALL RESOURCES, FOLLOWING A DB2 ERROR.  FORMAT       *05630000
      *  INFORMATION RELATIVE TO THE ERROR.                            *05640000
      ******************************************************************05650000
       9920-CICS-ERROR.                                                 05660000
                                                                        05670000
           SET DP013-NO-ROLLBACK                                        05680000
               DP013-XCTL-DISPLAY-RESTART                               05690000
               DP013-CICS-ABEND      TO TRUE                            05700000
                                                                        05710000
           PERFORM DP013-0000-PROCESS-ABEND.                            05720000
                                                                        05730000
                                                                        05740000
                                                                        05750000
      *----------------------------------------------------------------*05760000
      *    ABEND PROCESSOR MODULE                                      *05770000
      *----------------------------------------------------------------*05780000
                                                                        05790000
           COPY DPPD013.                                                05800000
      *----------------------------------------------------------------*05810000
      *    DATA TIME MODULE                                            *05820000
      *----------------------------------------------------------------*05830000
      *                                                                 05840000
      *    COPY DPPD017.                                                05850000
