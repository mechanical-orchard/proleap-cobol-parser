000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              RCKUT119.                               00020000
000300 AUTHOR.                  PATRICK BURKE.                          00030000
000400 DATE-WRITTEN.            02/19/03.                               00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM ACCESSES THE RECEIVING TABLES TO CREATE A FREIGHT *00080000
000900* PAYMENT PROPRIETARY FILE FOR TRANS-INTERNATIONAL.              *00090000
000910* 07/28/2010  EKTA AGRAWAL             TKID: TKMAV49             *00091000
000911*             MODIFIED TO ADD RECORD TYPE 05 FOR THE PROCESSED   *00091100
000912*             FRIEGHT AS A PART OF THE IMPORT REPLENISHMENT 2010 *00091200
000913*             PROJECT.                                           *00091300
000914*             CHANGES TAGGED AS EA 07/28/2010                    *00091400
000915*                                                                *00091502
000916* 12/01/2011  CHRISTINE TWIEHAUS       WR#40574                  *00091602
000917*             ADDED CARR-AUTH-ID (CAN)                           *00091702
000920*                                                                *00092002
000921******************************************************************00092102
000922 ENVIRONMENT DIVISION.                                            00092202
000923 CONFIGURATION SECTION.                                           00092302
000924                                                                  00092402
000925 INPUT-OUTPUT SECTION.                                            00092502
000926 FILE-CONTROL.                                                    00092602
000930                                                                  00093000
000940     SELECT OUTPUT-FILE                                           00094000
000950        ASSIGN TO OUT01.                                          00095000
000960                                                                  00096000
000970 DATA DIVISION.                                                   00097000
000980 FILE SECTION.                                                    00098000
000990                                                                  00099000
001000 FD  OUTPUT-FILE                                                  00100000
001100     RECORDING MODE IS F                                          00110000
001200     LABEL RECORDS ARE STANDARD                                   00120000
001300     RECORD CONTAINS 100 CHARACTERS                               00130000
001400     DATA RECORD IS OUTPUT-RECORD.                                00140000
001500                                                                  00150000
001600 01  OUTPUT-RECORD.                                               00160007
001610     05  OR-RECORD-TYPE          PIC X(02).                       00161007
001620     05  OR-FILLER               PIC X(98).                       00162007
001700                                                                  00170000
001800                                                                  00180000
001900 WORKING-STORAGE SECTION.                                         00190000
002000                                                                  00200000
002100 01  PROGRAM-CONSTANTS.                                           00210000
002200     05  PC-CALENDAR-ROUTINE         PIC X(8)   VALUE 'DPKUT500'. 00220000
002300                                                                  00230000
002400 01  PROGRAM-SWITCHES.                                            00240000
002500     05  END-OF-TRIPST-SW            PIC X(1)   VALUE 'N'.        00250000
002600         88  END-OF-TRIPST                      VALUE 'Y'.        00260000
002700     05  END-OF-SHIPMT-SW            PIC X(1)   VALUE 'N'.        00270000
002800         88  END-OF-SHIPMT                      VALUE 'Y'.        00280000
002900     05  END-OF-SHPTPO-SW            PIC X(1)   VALUE 'N'.        00290000
003000         88  END-OF-SHPTPO                      VALUE 'Y'.        00300000
003100     05  END-OF-PURITM-SW            PIC X(1)   VALUE 'N'.        00310000
003200         88  END-OF-PURITM                      VALUE 'Y'.        00320000
003300     05  SHIPMENTS-FOUND-SW          PIC X(1)   VALUE 'N'.        00330000
003400         88  SHIPMENTS-FOUND                    VALUE 'Y'.        00340000
003600     05  PRCSD-FREIGHT-EXISTS-SW     PIC X(1)   VALUE 'N'.        00360000
003700          88  PRCSD-FREIGHT-EXISTS              VALUE 'Y'.        00370000
003800     05  PS-NULL-ARRIVE-TMST-SW      PIC X(1)   VALUE 'N'.        00380024
003810          88  PS-ARRIVE-TMST-IS-NULL            VALUE 'Y'.        00381024
003820          88  PS-ARRIVE-TMST-IS-NOT-NULL        VALUE 'N'.        00382024
003900                                                                  00390000
004000 01  HOLD-RECORD-TABLE.                                           00400000
004100     05  WS-HOLD-RECORD-TABLE OCCURS 999 TIMES.                   00410000
004200         10  WS-HOLD-RECORD          PIC X(80).                   00420000
004300                                                                  00430000
004400 01  CLASS-TABLE.                                                 00440000
004500     05  WS-CLASS-TABLE OCCURS 10 TIMES.                          00450000
004600         10  WS-CLASS                PIC X(02).                   00460000
004700                                                                  00470000
004800 01  PROGRAM-VARIABLES.                                           00480000
004810     05  PV-NULL-IND                 PIC S9(04)  VALUE ZERO       00481021
004820                                                 COMP SYNC.       00482022
004900                                                                  00490000
005000     05  WS-PROCESS-DATE             PIC X(10).                   00500000
005100     05  WS-STATUS-DATE              PIC X(10).                   00510000
005200                                                                  00520000
005300     05  WS-EST-AR-TMST              PIC X(26).                   00530000
005400     05  FILLER REDEFINES WS-EST-AR-TMST.                         00540000
005500         10  WS-DELIVERY-DATE        PIC X(10).                   00550000
005600         10  FILLER                  PIC X(16).                   00560000
005700                                                                  00570000
005800     05  WS-MAJOR-CLASS              PIC X(2).                    00580000
005900     05  FILLER REDEFINES WS-MAJOR-CLASS.                         00590000
006000         10  WS-CLASS-CHAR-1         PIC X(1).                    00600000
006100         10  WS-CLASS-CHAR-2         PIC X(1).                    00610000
006200                                                                  00620000
006300     05  SUB                         PIC 9(3).                    00630000
006400     05  CLASS-SUB                   PIC 9(2).                    00640000
006500                                                                  00650000
006600     05  PV-PARAGRAPH-NAME           PIC X(30).                   00660000
006700     05  PV-DB2-OPER-ATTEMPTED       PIC X(30).                   00670000
006710     05  PV-DISPLAY-NUMBER           PIC  ZZ,ZZZ,ZZ9              00671007
006720                                                 VALUE ZERO.      00672007
006900     05  WS-PRCSD-CARTONS            PIC S9(9) VALUE ZERO         00690000
007000                                               COMP.              00700000
007202                                                                  00720207
007204 01  PROGRAM-TOTALS.                                              00720407
007205                                                                  00720507
007210     05  PT-TOT-RECORDS-WRITTEN      PIC  9(08)  VALUE ZERO.      00721007
007220     05  PT-01-RECORDS-WRITTEN       PIC  9(08)  VALUE ZERO.      00722007
007230     05  PT-02-RECORDS-WRITTEN       PIC  9(08)  VALUE ZERO.      00723007
007240     05  PT-03-RECORDS-WRITTEN       PIC  9(08)  VALUE ZERO.      00724007
007250     05  PT-04-RECORDS-WRITTEN       PIC  9(08)  VALUE ZERO.      00725007
007260     05  PT-05-RECORDS-WRITTEN       PIC  9(08)  VALUE ZERO.      00726007
007270     05  PT-99-RECORDS-WRITTEN       PIC  9(08)  VALUE ZERO.      00727007
007300                                                                  00730000
007400 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00740000
007500     88 ABEND-4013                         VALUE +4013.           00750000
007600                                                                  00760000
007700                                                                  00770000
007800***************************************************************** 00780000
007900*    OUTPUT FILE LAYOUT.                                        * 00790000
008000***************************************************************** 00800000
008100     COPY RCRD064.                                                00810000
008200                                                                  00820000
008300***************************************************************** 00830000
008400*    CALENDAR ROUTINE WORK AREA.                                * 00840000
008500***************************************************************** 00850000
008600     COPY DPWS500.                                                00860000
008700                                                                  00870000
008800***************************************************************** 00880000
008900*    SQL ABEND ROUTINE WORKING STORAGE                          * 00890000
009000***************************************************************** 00900000
009100     COPY DPWS004.                                                00910000
009200                                                                  00920000
009300     EXEC SQL                                                     00930000
009400        INCLUDE TCOCNTL                                           00940000
009500     END-EXEC.                                                    00950000
009600                                                                  00960000
009700     EXEC SQL                                                     00970000
009800        INCLUDE TKRPRPM                                           00980000
009900     END-EXEC.                                                    00990000
010000                                                                  01000000
010100     EXEC SQL                                                     01010000
010200        INCLUDE TTRIPST                                           01020000
010300     END-EXEC.                                                    01030000
010400                                                                  01040000
010500     EXEC SQL                                                     01050000
010600        INCLUDE TVHTRIP                                           01060000
010700     END-EXEC.                                                    01070000
010800                                                                  01080000
010900     EXEC SQL                                                     01090000
011000        INCLUDE TTRSTYP                                           01100000
011100     END-EXEC.                                                    01110000
011200                                                                  01120000
011300     EXEC SQL                                                     01130000
011400        INCLUDE TSHIPMT                                           01140000
011500     END-EXEC.                                                    01150000
011600                                                                  01160000
011700     EXEC SQL                                                     01170000
011800        INCLUDE TSHPTPO                                           01180000
011900     END-EXEC.                                                    01190000
012000                                                                  01200000
012100     EXEC SQL                                                     01210000
012200        INCLUDE TRECEIV                                           01220000
012300     END-EXEC.                                                    01230000
012400                                                                  01240000
012500     EXEC SQL                                                     01250000
012600        INCLUDE TPLNSHP                                           01260000
012700     END-EXEC.                                                    01270000
012800                                                                  01280000
012900     EXEC SQL                                                     01290000
013000        INCLUDE TRECITM                                           01300000
013100     END-EXEC.                                                    01310000
013200                                                                  01320000
013300     EXEC SQL                                                     01330000
013400        INCLUDE TPURITM                                           01340000
013500     END-EXEC.                                                    01350000
013600                                                                  01360000
013700     EXEC SQL                                                     01370000
013800        INCLUDE TPURCHS                                           01380000
013900     END-EXEC.                                                    01390000
014000                                                                  01400000
014100     EXEC SQL                                                     01410000
014200        INCLUDE TENTNME                                           01420000
014300     END-EXEC.                                                    01430000
014400                                                                  01440000
014500     EXEC SQL                                                     01450000
014600        INCLUDE TRECDIS                                           01460000
014700     END-EXEC.                                                    01470000
014800                                                                  01480000
015000     EXEC SQL                                                     01500000
015100        INCLUDE SUT00024                                          01510000
015200     END-EXEC.                                                    01520000
015210                                                                  01521000
015220     EXEC SQL                                                     01522000
015230        INCLUDE SUT00027                                          01523000
015240     END-EXEC.                                                    01524000
015241                                                                  01524100
015244     EXEC SQL                                                     01524400
015245        INCLUDE SQLCA                                             01524500
015246     END-EXEC.                                                    01524600
015247                                                                  01524700
015248     EXEC SQL                                                     01524800
015249        DECLARE TRIPST_CURSOR CURSOR FOR                          01524900
015250        SELECT  DISTINCT A.TRIP_ID,                               01525010
015260                B.VEH_NBR,                                        01526000
015270                B.OWNER_SCAC_ID,                                  01527000
015280                B.EST_AR_TMST                                     01528023
015290        FROM    TTRIPST A,                                        01529000
015300                TVHTRIP B,                                        01530010
015310                TSHIPMT C                                         01531010
015400        WHERE   A.TRIP_STATUS_CDE = 'DP'                          01540014
015500          AND   A.STATUS_DTE = :WS-STATUS-DATE                    01550000
015600          AND   B.TRIP_ID = A.TRIP_ID                             01560000
015610          AND   C.TRIP_ID = B.TRIP_ID                             01561010
015700                WITH UR                                           01570000
015800     END-EXEC.                                                    01580000
015900                                                                  01590000
016000     EXEC SQL                                                     01600000
016100        DECLARE SHIPMT_CURSOR CURSOR FOR                          01610000
016200        SELECT  SHIPT_ID,                                         01620000
016300                PRO_NBR,                                          01630000
016400                BOL_NBR,                                          01640005
016410                CARR_AUTH_ID                                      01641003
016500        FROM    TSHIPMT                                           01650000
016600        WHERE   TRIP_ID = :TRIPST-TRIP-ID                         01660000
016700                WITH UR                                           01670000
016800     END-EXEC.                                                    01680000
016900                                                                  01690000
017000     EXEC SQL                                                     01700000
017100        DECLARE SHPTPO_CURSOR CURSOR FOR                          01710000
017200        SELECT  A.PO_NBR,                                         01720006
017300                A.REC_SEQ_NBR                                     01730006
017400        FROM    TSHPTPO A                                         01740006
017410              , TPURCHS B                                         01741006
017500        WHERE   A.SHIPT_ID       = :SHIPMT-SHIPT-ID               01750006
017510          AND   A.PO_NBR         = B.PO_NBR                       01751007
017520          AND   B.VER_STATUS_CDE = 'A'                            01752006
017600                WITH UR                                           01760000
017700     END-EXEC.                                                    01770000
017800                                                                  01780000
017900     EXEC SQL                                                     01790000
018000        DECLARE PURITM_CURSOR CURSOR FOR                          01800000
018100        SELECT  DISTINCT B.CL_NBR                                 01810000
018200        FROM    TRECITM A,                                        01820000
018300                TPURITM B                                         01830000
018400        WHERE   A.ORD_NBR = :SHPTPO-PO-NBR                        01840000
018500          AND   A.REC_SEQ_NBR = :SHPTPO-REC-SEQ-NBR               01850000
018600          AND   B.PO_NBR = A.ORD_NBR                              01860000
018700          AND   B.APP_PO_LNE_NBR = A.ORD_LNE_NBR                  01870000
018800          AND   B.VER_NBR = A.PO_VER_NBR                          01880000
018900                WITH UR                                           01890000
019000     END-EXEC.                                                    01900000
019100                                                                  01910000
019200***********************************************************       01920000
019300 PROCEDURE DIVISION.                                              01930000
019400***********************************************************       01940000
019500     OPEN OUTPUT OUTPUT-FILE.                                     01950000
019600                                                                  01960000
019700     PERFORM 1000-GET-DATE                                        01970000
019800        THRU 1000-GET-DATE-EXIT.                                  01980000
019900                                                                  01990000
020000     PERFORM 2000-CREATE-PAYMENT-FILE                             02000000
020100        THRU 2000-CREATE-PAYMENT-FILE-EXIT.                       02010000
020200                                                                  02020000
020210     MOVE '99' TO RC064-99-RECORD-TYPE.                           02021007
020220     MOVE PT-01-RECORDS-WRITTEN  TO RC064-99-01-RECD-COUNT.       02022007
020221     MOVE PT-02-RECORDS-WRITTEN  TO RC064-99-02-RECD-COUNT.       02022107
020222     MOVE PT-03-RECORDS-WRITTEN  TO RC064-99-03-RECD-COUNT.       02022207
020223     MOVE PT-04-RECORDS-WRITTEN  TO RC064-99-04-RECD-COUNT.       02022307
020224     MOVE PT-05-RECORDS-WRITTEN  TO RC064-99-05-RECD-COUNT.       02022407
020225     ADD  +1                     TO PT-99-RECORDS-WRITTEN         02022508
020226                                    PT-TOT-RECORDS-WRITTEN.       02022607
020227     MOVE PT-99-RECORDS-WRITTEN  TO RC064-99-99-RECD-COUNT.       02022709
020228     MOVE PT-TOT-RECORDS-WRITTEN TO RC064-99-TOTAL-COUNT.         02022807
020229     MOVE WS-STATUS-DATE         TO RC064-99-DEPART-DATE.         02022912
020230     MOVE RC064-RECORD-TYPE-99   TO OUTPUT-RECORD.                02023007
020231     WRITE OUTPUT-RECORD.                                         02023107
020240                                                                  02024007
020250     MOVE PT-01-RECORDS-WRITTEN  TO PV-DISPLAY-NUMBER.            02025007
020260     DISPLAY 'NUMBER 01 TYPE RECORDS WRITTEN:  '                  02026007
020270             PV-DISPLAY-NUMBER.                                   02027007
020271     MOVE PT-02-RECORDS-WRITTEN  TO PV-DISPLAY-NUMBER.            02027107
020272     DISPLAY 'NUMBER 02 TYPE RECORDS WRITTEN:  '                  02027207
020273             PV-DISPLAY-NUMBER.                                   02027307
020274     MOVE PT-03-RECORDS-WRITTEN  TO PV-DISPLAY-NUMBER.            02027407
020275     DISPLAY 'NUMBER 03 TYPE RECORDS WRITTEN:  '                  02027507
020276             PV-DISPLAY-NUMBER.                                   02027607
020277     MOVE PT-04-RECORDS-WRITTEN  TO PV-DISPLAY-NUMBER.            02027707
020278     DISPLAY 'NUMBER 04 TYPE RECORDS WRITTEN:  '                  02027807
020279             PV-DISPLAY-NUMBER.                                   02027907
020280     MOVE PT-05-RECORDS-WRITTEN  TO PV-DISPLAY-NUMBER.            02028007
020281     DISPLAY 'NUMBER 05 TYPE RECORDS WRITTEN:  '                  02028107
020282             PV-DISPLAY-NUMBER.                                   02028207
020283     MOVE PT-99-RECORDS-WRITTEN  TO PV-DISPLAY-NUMBER.            02028307
020284     DISPLAY 'NUMBER 99 TYPE RECORDS WRITTEN:  '                  02028407
020285             PV-DISPLAY-NUMBER.                                   02028507
020286     MOVE PT-TOT-RECORDS-WRITTEN TO PV-DISPLAY-NUMBER.            02028607
020287     DISPLAY 'RCKUT119 TOTAL RECORDS WRITTEN:  '                  02028707
020288             PV-DISPLAY-NUMBER.                                   02028807
020290                                                                  02029007
020300     CLOSE OUTPUT-FILE.                                           02030000
020400                                                                  02040000
020500     STOP RUN.                                                    02050000
020600                                                                  02060000
020700***************************************************************** 02070000
020800*  1.  ACCESS TCOCNTL TO GET THE BTCH_PRC_DTE.                  * 02080000
020900*  2.  ACCESS TKRPRPM TO GET THE FUNC_QTY (NUMBER OF DAYS).     * 02090000
021000*  3.  SUBTRACT FUNC_QTY FROM THE BTCH_PRC_DTE TO GET THE       * 02100000
021100*      DATE THAT SHOULD BE USED FOR THIS PROGRAM.               * 02110000
021200***************************************************************** 02120000
021300 1000-GET-DATE.                                                   02130000
021400                                                                  02140000
021500     EXEC SQL                                                     02150000
021600          SELECT CURRENT DATE - 1 DAYS                            02160000
021700          INTO   :WS-STATUS-DATE                                  02170000
021800          FROM   TCOCNTL                                          02180000
021900                WITH UR                                           02190000
022000     END-EXEC.                                                    02200000
022100                                                                  02210000
022200     DISPLAY 'DATE USED:  ' WS-STATUS-DATE.                       02220000
022300                                                                  02230000
023300 1000-GET-DATE-EXIT.                                              02330000
023400     EXIT.                                                        02340000
023500                                                                  02350000
031500                                                                  03150000
031600***************************************************************** 03160000
031700***********************  RECORD TYPE 01  ************************ 03170000
031800***************************************************************** 03180000
031900*  1. ACCESS TTRIPST WHERE THE TRIP_STATUS_CDE = 'DP' AND THE   * 03190000
032000*     STATUS_DTE = THE DATE CALCULATED IN THE PREVIOUS          * 03200000
032100*     PARAGRAPHS.  THIS WILL RETRIEVE 0 TO MANY ROWS.           * 03210000
032200*  2. USING THE TRIP_ID FROM THE TTRIPST TABLE, ACCESS TVHTRIP. * 03220000
032300*  3. USING THE TRIP_ID AND THE LOWEST PRTY_CDE (TTRSTYP) THAT  * 03230000
032400*     IS GREATER THAN 50, ACCESS THE TTRIPST TABLE TO GET THE   * 03240000
032500*     ARRIVAL DATE.                                             * 03250000
032600***************************************************************** 03260000
032700                                                                  03270000
032800 2000-CREATE-PAYMENT-FILE.                                        03280000
032900                                                                  03290000
033000     EXEC SQL                                                     03300000
033100        OPEN TRIPST_CURSOR                                        03310000
033200     END-EXEC.                                                    03320000
033300                                                                  03330000
033400     IF SQLCODE NOT = +000                                        03340000
033500        MOVE '1300-CREATE-PAYMENT-FILE' TO PV-PARAGRAPH-NAME      03350000
033600        MOVE 'OPEN TRIPST CURSOR' TO PV-DB2-OPER-ATTEMPTED        03360000
033700        PERFORM 9999-SQL-ERROR.                                   03370000
033800                                                                  03380000
033900     PERFORM 3000-RECORD-TYPE-01                                  03390000
034000        THRU 3000-RECORD-TYPE-01-EXIT                             03400000
034100           UNTIL END-OF-TRIPST.                                   03410000
034200                                                                  03420000
034300     EXEC SQL                                                     03430000
034400        CLOSE TRIPST_CURSOR                                       03440000
034500     END-EXEC.                                                    03450000
034600                                                                  03460000
034700     IF SQLCODE NOT = +000                                        03470000
034800        MOVE '1300-CREATE-PAYMENT-FILE' TO PV-PARAGRAPH-NAME      03480000
034900        MOVE 'CLOSE TRIPST CURSOR' TO PV-DB2-OPER-ATTEMPTED       03490000
035000        PERFORM 9999-SQL-ERROR.                                   03500000
035100                                                                  03510000
035200 2000-CREATE-PAYMENT-FILE-EXIT.                                   03520000
035300     EXIT.                                                        03530000
035400                                                                  03540000
035500                                                                  03550000
035600 3000-RECORD-TYPE-01.                                             03560000
035700                                                                  03570000
035710     SET PS-ARRIVE-TMST-IS-NOT-NULL TO TRUE.                      03571024
035720                                                                  03572024
035800     EXEC SQL                                                     03580000
035900        FETCH TRIPST_CURSOR                                       03590000
036000        INTO :TRIPST-TRIP-ID,                                     03600000
036100             :VHTRIP-VEH-NBR,                                     03610000
036200             :VHTRIP-OWNER-SCAC-ID,                               03620000
036300             :VHTRIP-EST-AR-TMST :PV-NULL-IND                     03630015
036400     END-EXEC.                                                    03640000
036500                                                                  03650000
036600     IF SQLCODE = +000                                            03660000
036610        IF PV-NULL-IND < +0                                       03661024
036611           SET PS-ARRIVE-TMST-IS-NULL TO TRUE                     03661124
036650        END-IF                                                    03665024
036800     ELSE                                                         03680000
036900        IF SQLCODE = +100                                         03690000
037000           MOVE 'Y' TO END-OF-TRIPST-SW                           03700000
037100           GO TO 3000-RECORD-TYPE-01-EXIT                         03710000
037200        ELSE                                                      03720000
037300           MOVE '3000-RECORD-TYPE-1' TO PV-PARAGRAPH-NAME         03730000
037400           MOVE 'FETCH TRIPST CURSOR' TO PV-DB2-OPER-ATTEMPTED    03740000
037500           PERFORM 9999-SQL-ERROR.                                03750000
037600                                                                  03760000
037700     MOVE VHTRIP-VEH-NBR TO RC064-01-VEH-NBR.                     03770000
037800     MOVE VHTRIP-OWNER-SCAC-ID TO RC064-01-OWNER-SCAC-ID.         03780000
037900                                                                  03790000
038300     PERFORM 3100-ARRIVAL-DATE                                    03830000
038400        THRU 3100-ARRIVAL-DATE-EXIT.                              03840000
038500                                                                  03850000
038510     IF  PS-ARRIVE-TMST-IS-NULL                                   03851024
038511         MOVE RC064-01-ARRIVAL-DATE TO RC064-01-DELIVERY-DATE     03851124
038530     ELSE                                                         03853024
038540         MOVE VHTRIP-EST-AR-TMST TO WS-EST-AR-TMST                03854024
038550         MOVE WS-DELIVERY-DATE TO RC064-01-DELIVERY-DATE          03855024
038551     END-IF.                                                      03855124
038560                                                                  03856024
038600     MOVE RC064-RECORD-TYPE-01 TO OUTPUT-RECORD.                  03860000
038610     ADD +1 TO PT-01-RECORDS-WRITTEN                              03861007
038620               PT-TOT-RECORDS-WRITTEN.                            03862007
038700     WRITE OUTPUT-RECORD.                                         03870000
038800                                                                  03880000
038900     PERFORM 4000-RECORD-TYPE-02                                  03890000
039000        THRU 4000-RECORD-TYPE-02-EXIT.                            03900000
039100                                                                  03910000
039300     MOVE 'N' TO PRCSD-FREIGHT-EXISTS-SW.                         03930000
039400     INITIALIZE  WS-PRCSD-CARTONS.                                03940000
039500     PERFORM 3200-CHECK-PROCESSED-FREIGHT                         03950000
039600        THRU 3200-EXIT.                                           03960000
039800                                                                  03980000
039900 3000-RECORD-TYPE-01-EXIT.                                        03990000
040000     EXIT.                                                        04000000
040100                                                                  04010000
040200                                                                  04020000
040300 3100-ARRIVAL-DATE.                                               04030000
040400                                                                  04040000
040500     EXEC SQL                                                     04050000
040600        SELECT A.STATUS_DTE,                                      04060000
040700               A.OPER_UNT_ID                                      04070000
040800        INTO   :TRIPST-STATUS-DTE,                                04080000
040900               :TRIPST-OPER-UNT-ID                                04090000
041000        FROM   TTRIPST A,                                         04100000
041100               TTRSTYP B                                          04110000
041200        WHERE  A.TRIP_ID = :TRIPST-TRIP-ID                        04120000
041300          AND  A.TRIP_STATUS_CDE = B.TRIP_STATUS_CDE              04130000
041400          AND  B.PRTY_CDE =                                       04140000
041500               (SELECT MIN(D.PRTY_CDE)                            04150000
041600                FROM   TTRIPST C,                                 04160000
041700                       TTRSTYP D                                  04170000
041800                WHERE  C.TRIP_ID = :TRIPST-TRIP-ID                04180000
041900                  AND  D.PRTY_CDE > '49'                          04190000
042000                  AND  C.TRIP_STATUS_CDE = D.TRIP_STATUS_CDE)     04200000
042100                WITH UR                                           04210000
042200     END-EXEC.                                                    04220000
042300                                                                  04230000
042400     IF SQLCODE = +000                                            04240000
042500        CONTINUE                                                  04250000
042600     ELSE                                                         04260000
042700        DISPLAY 'TRIP_ID (TTRIPST) = ' TRIPST-TRIP-ID             04270000
042800        MOVE '3100-ARRIVAL-DATE' TO PV-PARAGRAPH-NAME             04280000
042900        MOVE 'SELECT ARRIVAL DATE' TO PV-DB2-OPER-ATTEMPTED       04290000
043000        PERFORM 9999-SQL-ERROR.                                   04300000
043100                                                                  04310000
043200     MOVE TRIPST-STATUS-DTE TO RC064-01-ARRIVAL-DATE.             04320000
043300     MOVE TRIPST-OPER-UNT-ID TO RC064-01-DC.                      04330000
043400                                                                  04340000
043500 3100-ARRIVAL-DATE-EXIT.                                          04350000
043600     EXIT.                                                        04360000
043700                                                                  04370000
043800                                                                  04380000
043900***************************************************************** 04390000
044000***********************  RECORD TYPE 02  ************************ 04400000
044100***************************************************************** 04410000
044200*  1. USING THE TRIP_ID FROM THE TTRIPST TABLE, ACCESS THE      * 04420000
044300*     TSHIPMT TABLE TO GET ALL OF THE SHIPMENTS.  THIS WILL     * 04430000
044400*     RETRIEVE 0 TO MANY ROWS.                                  * 04440000
044500*  2. CREATE RECORD TYPES 03 AND 04 ONLY IF SHIPMENTS ARE FOUND.* 04450000
044600*  3. RECORD TYPE 02 CONTAINS THE TOTAL CARTON COUNT, WHICH IS  * 04460000
044700*     THE TOTAL OF THE CARTON COUNTS IN RECORD TYPE 03.  RECORD * 04470000
044800*     TYPES 03 AND 04 ARE CREATED AND STORED IN A TABLE UNTIL   * 04480000
044900*     THE TOTAL CARTON COUNT CAN BE CALCULATED AND RECORD TYPE  * 04490000
045000*     02 IS WRITTEN TO THE OUTPUT FILE.                         * 04500000
045100***************************************************************** 04510000
045200                                                                  04520000
045300 4000-RECORD-TYPE-02.                                             04530000
045400                                                                  04540000
045500     EXEC SQL                                                     04550000
045600        OPEN SHIPMT_CURSOR                                        04560000
045700     END-EXEC.                                                    04570000
045800                                                                  04580000
045900     IF SQLCODE NOT = +000                                        04590000
046000        MOVE '4000-RECORD-TYPE-02' TO PV-PARAGRAPH-NAME           04600000
046100        MOVE 'OPEN SHIPMT CURSOR' TO PV-DB2-OPER-ATTEMPTED        04610000
046200        PERFORM 9999-SQL-ERROR.                                   04620000
046300                                                                  04630000
046400     MOVE 'N' TO END-OF-SHIPMT-SW.                                04640000
046500     MOVE 'N' TO SHIPMENTS-FOUND-SW.                              04650000
046600                                                                  04660000
046700     PERFORM 4100-GET-SHIPMENTS                                   04670000
046800        THRU 4100-GET-SHIPMENTS-EXIT                              04680000
046900           UNTIL END-OF-SHIPMT.                                   04690000
047000                                                                  04700000
047100     EXEC SQL                                                     04710000
047200        CLOSE SHIPMT_CURSOR                                       04720000
047300     END-EXEC.                                                    04730000
047400                                                                  04740000
047500     IF SQLCODE NOT = +000                                        04750000
047600        MOVE '4000-RECORD-TYPE-02' TO PV-PARAGRAPH-NAME           04760000
047700        MOVE 'CLOSE SHIPMT CURSOR' TO PV-DB2-OPER-ATTEMPTED       04770000
047800        PERFORM 9999-SQL-ERROR.                                   04780000
047900                                                                  04790000
048000 4000-RECORD-TYPE-02-EXIT.                                        04800000
048100     EXIT.                                                        04810000
048200                                                                  04820000
048300                                                                  04830000
048400 4100-GET-SHIPMENTS.                                              04840000
048500                                                                  04850000
048600     EXEC SQL                                                     04860000
048700        FETCH SHIPMT_CURSOR                                       04870000
048800        INTO :SHIPMT-SHIPT-ID,                                    04880000
048900             :SHIPMT-PRO-NBR,                                     04890000
049000             :SHIPMT-BOL-NBR,                                     04900004
049010             :SHIPMT-CARR-AUTH-ID                                 04901003
049100     END-EXEC.                                                    04910000
049200                                                                  04920000
049300     IF SQLCODE = +000                                            04930000
049400        CONTINUE                                                  04940000
049500     ELSE                                                         04950000
049600        IF SQLCODE = +100                                         04960000
049700           MOVE 'Y' TO END-OF-SHIPMT-SW                           04970000
049800           GO TO 4100-GET-SHIPMENTS-EXIT                          04980000
049900        ELSE                                                      04990000
050000           DISPLAY 'TRIP_ID (TTRIPST) = ' TRIPST-TRIP-ID          05000000
050100           MOVE '4100-GET-SHIPMENTS' TO PV-PARAGRAPH-NAME         05010000
050200           MOVE 'FETCH SHIPMT CURSOR' TO PV-DB2-OPER-ATTEMPTED    05020000
050300           PERFORM 9999-SQL-ERROR.                                05030000
050400                                                                  05040000
050500     MOVE 'Y' TO SHIPMENTS-FOUND-SW.                              05050000
050600                                                                  05060000
050700     INITIALIZE HOLD-RECORD-TABLE.                                05070000
050800     MOVE ZERO TO SUB.                                            05080000
050900     MOVE ZERO TO RC064-02-TOTAL-COUNT.                           05090000
051000                                                                  05100000
051100     IF SHIPMENTS-FOUND                                           05110000
051200        PERFORM 5000-RECORD-TYPE-03                               05120000
051300           THRU 5000-RECORD-TYPE-03-EXIT.                         05130000
051400                                                                  05140000
051500     MOVE SHIPMT-PRO-NBR TO RC064-02-PRO-NBR.                     05150000
051600     MOVE SHIPMT-BOL-NBR TO RC064-02-BOL-NBR.                     05160000
051620     MOVE SHIPMT-CARR-AUTH-ID TO RC064-02-CARR-AUTH-ID.           05162003
051700                                                                  05170000
051800     MOVE RC064-RECORD-TYPE-02 TO OUTPUT-RECORD.                  05180000
051810     ADD +1 TO PT-02-RECORDS-WRITTEN                              05181007
051820               PT-TOT-RECORDS-WRITTEN.                            05182007
051900     WRITE OUTPUT-RECORD.                                         05190000
052000                                                                  05200000
052100     PERFORM VARYING SUB FROM 1 BY 1                              05210000
052200        UNTIL WS-HOLD-RECORD (SUB) = SPACES OR SUB > 999          05220000
052300           MOVE WS-HOLD-RECORD (SUB) TO OUTPUT-RECORD             05230000
052310           IF  OR-RECORD-TYPE = '03'                              05231007
052311               ADD +1 TO PT-03-RECORDS-WRITTEN                    05231107
052312                         PT-TOT-RECORDS-WRITTEN                   05231207
052320           ELSE                                                   05232007
052321               ADD +1 TO PT-04-RECORDS-WRITTEN                    05232107
052322                         PT-TOT-RECORDS-WRITTEN                   05232207
052330           END-IF                                                 05233007
052400           WRITE OUTPUT-RECORD                                    05240000
052500     END-PERFORM.                                                 05250000
052600                                                                  05260000
052700 4100-GET-SHIPMENTS-EXIT.                                         05270000
052800     EXIT.                                                        05280000
052900                                                                  05290000
053000                                                                  05300000
053100***************************************************************** 05310000
053200***********************  RECORD TYPE 03  ************************ 05320000
053300***************************************************************** 05330000
053400*  1. USING SHIPT_ID FROM THE TSHIPMT TABLE, ACCESS TSHPTPO.    * 05340000
053500*     THIS WILL RETRIEVE 1 TO MANY ROWS.                        * 05350000
053600*  2. USING PO_NBR AND REC_SEQ_NBR FROM THE TSHPTPO TABLE,      * 05360000
053700*     ACCESS THE TRECEIV TABLE TO GET THE CARTON COUNT.         * 05370000
053800*  3. USING PO_NBR, ACCESS THE TPLNSHP TABLE TO GET THE PREPAID * 05380000
053900*     FLAG.                                                     * 05390000
054000*  4. USING PO_NBR, ACCESS THE TPURCHS AND TENTNME TABLES TO    * 05400000
054100*     GET THE VENDOR NAME.                                      * 05410000
054200***************************************************************** 05420000
054300                                                                  05430000
054400 5000-RECORD-TYPE-03.                                             05440000
054500                                                                  05450000
054600     EXEC SQL                                                     05460000
054700        OPEN SHPTPO_CURSOR                                        05470000
054800     END-EXEC.                                                    05480000
054900                                                                  05490000
055000     IF SQLCODE NOT = +000                                        05500000
055100        MOVE '5000-RECORD-TYPE-03' TO PV-PARAGRAPH-NAME           05510000
055200        MOVE 'OPEN SHPTPO CURSOR' TO PV-DB2-OPER-ATTEMPTED        05520000
055300        PERFORM 9999-SQL-ERROR.                                   05530000
055400                                                                  05540000
055500     MOVE 'N' TO END-OF-SHPTPO-SW.                                05550000
055600                                                                  05560000
055700     PERFORM 5100-GET-PO                                          05570000
055800        THRU 5100-GET-PO-EXIT                                     05580000
055900           UNTIL END-OF-SHPTPO.                                   05590000
056000                                                                  05600000
056100     EXEC SQL                                                     05610000
056200        CLOSE SHPTPO_CURSOR                                       05620000
056300     END-EXEC.                                                    05630000
056400                                                                  05640000
056500     IF SQLCODE NOT = +000                                        05650000
056600        MOVE '5000-RECORD-TYPE-03' TO PV-PARAGRAPH-NAME           05660000
056700        MOVE 'CLOSE SHPTPO CURSOR' TO PV-DB2-OPER-ATTEMPTED       05670000
056800        PERFORM 9999-SQL-ERROR.                                   05680000
056900                                                                  05690000
057000 5000-RECORD-TYPE-03-EXIT.                                        05700000
057100     EXIT.                                                        05710000
057200                                                                  05720000
057300                                                                  05730000
057400 5100-GET-PO.                                                     05740000
057500                                                                  05750000
057600     EXEC SQL                                                     05760000
057700        FETCH SHPTPO_CURSOR                                       05770000
057800        INTO :SHPTPO-PO-NBR,                                      05780000
057900             :SHPTPO-REC-SEQ-NBR                                  05790000
058000     END-EXEC.                                                    05800000
058100                                                                  05810000
058200     IF SQLCODE = +000                                            05820000
058300        CONTINUE                                                  05830000
058400     ELSE                                                         05840000
058500        IF SQLCODE = +100                                         05850000
058600           MOVE 'Y' TO END-OF-SHPTPO-SW                           05860000
058700           GO TO 5100-GET-PO-EXIT                                 05870000
058800        ELSE                                                      05880000
058900           DISPLAY 'TRIP_ID (TTRIPST) = ' TRIPST-TRIP-ID          05890000
059000           DISPLAY 'SHIPT_ID (TSHIPMT) = ' SHIPMT-SHIPT-ID        05900000
059100           MOVE '5100-GET-PO' TO PV-PARAGRAPH-NAME                05910000
059200           MOVE 'FETCH SHPTPO CURSOR' TO PV-DB2-OPER-ATTEMPTED    05920000
059300           PERFORM 9999-SQL-ERROR.                                05930000
059400                                                                  05940000
059500     MOVE SHPTPO-PO-NBR TO RC064-03-PO-NBR.                       05950000
059600     MOVE SHPTPO-REC-SEQ-NBR TO RC064-03-REC-SEQ-NBR.             05960000
059700                                                                  05970000
059800     PERFORM 5200-GET-CARTONS                                     05980000
059900        THRU 5200-GET-CARTONS-EXIT.                               05990000
060000                                                                  06000000
060100     PERFORM 5250-GET-UNITS-VRFD                                  06010000
060200        THRU 5250-GET-UNITS-VRFD-EXIT.                            06020000
060300                                                                  06030000
060400     PERFORM 5300-PREPAID-FLAG                                    06040000
060500        THRU 5300-PREPAID-FLAG-EXIT.                              06050000
060600                                                                  06060000
060700     PERFORM 5400-VENDOR-NAME                                     06070000
060800        THRU 5400-VENDOR-NAME-EXIT.                               06080000
060900                                                                  06090000
061000     ADD RC064-03-CARTONS TO RC064-02-TOTAL-COUNT.                06100000
061100                                                                  06110000
061200     ADD 1 TO SUB.                                                06120000
061300     MOVE RC064-RECORD-TYPE-03 TO WS-HOLD-RECORD (SUB).           06130000
061400                                                                  06140000
061500     PERFORM 6000-RECORD-TYPE-04                                  06150000
061600        THRU 6000-RECORD-TYPE-04-EXIT.                            06160000
061700                                                                  06170000
061800 5100-GET-PO-EXIT.                                                06180000
061900     EXIT.                                                        06190000
062000                                                                  06200000
062100                                                                  06210000
062200 5200-GET-CARTONS.                                                06220000
062300                                                                  06230000
062400     EXEC SQL                                                     06240000
062500        SELECT ACTL_CART_CNT                                      06250000
062600              ,OPER_UNT_ID                                        06260000
062700              ,FCLTY_ID                                           06270000
062800        INTO   :RECEIV-ACTL-CART-CNT                              06280000
062900              ,:RECEIV-OPER-UNT-ID                                06290000
063000              ,:RECEIV-FCLTY-ID                                   06300000
063100        FROM   TRECEIV                                            06310000
063200        WHERE  ORD_NBR =:SHPTPO-PO-NBR                            06320000
063300          AND  REC_SEQ_NBR =:SHPTPO-REC-SEQ-NBR                   06330000
063310                WITH UR                                           06331000
063320     END-EXEC.                                                    06332000
063330                                                                  06333000
063340     IF SQLCODE = +000                                            06334000
063350        MOVE RECEIV-ACTL-CART-CNT TO RC064-03-CARTONS             06335000
063360     ELSE                                                         06336000
063370        IF SQLCODE = +100                                         06337000
063380           MOVE ZERO TO RC064-03-CARTONS                          06338000
063390        ELSE                                                      06339000
063400           DISPLAY 'TRIP_ID (TTRIPST) = ' TRIPST-TRIP-ID          06340000
063500           DISPLAY 'SHIPT_ID (TSHIPMT) = ' SHIPMT-SHIPT-ID        06350000
063600           MOVE '5200-GET-CARTONS' TO PV-PARAGRAPH-NAME           06360000
063700           MOVE 'SELECT CARTON COUNT' TO PV-DB2-OPER-ATTEMPTED    06370000
063800           PERFORM 9999-SQL-ERROR.                                06380000
063900                                                                  06390000
064000 5200-GET-CARTONS-EXIT.                                           06400000
064100     EXIT.                                                        06410000
064200                                                                  06420000
064300 5250-GET-UNITS-VRFD.                                             06430000
064400                                                                  06440000
064500     MOVE ZERO                 TO  RECDIS-AP-VERIFY-ITM-QTY.      06450000
064600                                                                  06460000
064700     EXEC SQL                                                     06470000
064800          SELECT SUM(AP_VERIFY_ITM_QTY)                           06480000
064900          INTO  :RECDIS-AP-VERIFY-ITM-QTY                         06490000
065000          FROM   TRECDIS                                          06500000
065100          WHERE ORD_NBR          =  :SHPTPO-PO-NBR                06510000
065200           AND  REC_SEQ_NBR      =  :SHPTPO-REC-SEQ-NBR           06520000
065300           AND  OPER_UNT_ID      =  :RECEIV-OPER-UNT-ID           06530000
065400           AND  FCLTY_ID         =  :RECEIV-FCLTY-ID              06540000
065600                WITH UR                                           06560000
065700     END-EXEC.                                                    06570000
065800                                                                  06580000
065900     EVALUATE TRUE                                                06590000
066000         WHEN SQLCODE = ZERO                                      06600000
066100              MOVE RECDIS-AP-VERIFY-ITM-QTY                       06610000
066200                                       TO  RC064-03-UNITS-VRFD    06620000
066300         WHEN SQLCODE = +100                                      06630000
066400         WHEN SQLCODE = -305                                      06640000
066500              MOVE ZERO TO RC064-03-UNITS-VRFD                    06650000
066600         WHEN SQLWARN0 NOT = SPACE                                06660000
066700         WHEN SQLCODE NOT = ZERO                                  06670000
066800             DISPLAY 'PO_NBR (TSHPTPO) = ' SHPTPO-PO-NBR          06680000
066900             DISPLAY 'REC_SEQ_NBR (TSHPTPO) = ' SHPTPO-REC-SEQ-NBR06690000
067000             MOVE '5250-GET-UNITS-VRFD' TO PV-PARAGRAPH-NAME      06700000
067100             MOVE 'SUMMARIZE AP VERIFIED COUNT'                   06710000
067200                                      TO PV-DB2-OPER-ATTEMPTED    06720000
067300             PERFORM 9999-SQL-ERROR                               06730000
067400     END-EVALUATE.                                                06740000
067500/                                                                 06750000
067600                                                                  06760000
067700 5250-GET-UNITS-VRFD-EXIT.                                        06770000
067800     EXIT.                                                        06780000
067900                                                                  06790000
068000 5300-PREPAID-FLAG.                                               06800000
068100                                                                  06810000
068200     EXEC SQL                                                     06820000
068300        SELECT FRGT_PAYT_CDE                                      06830000
068400        INTO   :PLNSHP-FRGT-PAYT-CDE                              06840000
068500        FROM   TPLNSHP                                            06850000
068600        WHERE  VER_STATUS_CDE = 'A'                               06860000
068700          AND  PO_NBR =:SHPTPO-PO-NBR                             06870000
068800                WITH UR                                           06880000
068900     END-EXEC.                                                    06890000
069000                                                                  06900000
069100     IF SQLCODE = +000                                            06910000
069200        CONTINUE                                                  06920000
069300     ELSE                                                         06930000
069400        IF SQLCODE = +100                                         06940000
069500           MOVE SPACES TO RC064-03-PREPAID                        06950000
069600           GO TO 5300-PREPAID-FLAG-EXIT                           06960000
069700        ELSE                                                      06970000
069800           DISPLAY 'TRIP_ID (TTRIPST) = ' TRIPST-TRIP-ID          06980000
069900           DISPLAY 'SHIPT_ID (TSHIPMT) = ' SHIPMT-SHIPT-ID        06990000
070000           MOVE '5300-PREPAID-FLAG' TO PV-PARAGRAPH-NAME          07000000
070100           MOVE 'SELECT PREPAID FLAG' TO PV-DB2-OPER-ATTEMPTED    07010000
070200           PERFORM 9999-SQL-ERROR.                                07020000
070300                                                                  07030000
070400     IF PLNSHP-FRGT-PAYT-CDE = 'K'                                07040000
070500        MOVE 'N' TO RC064-03-PREPAID                              07050000
070600     ELSE                                                         07060000
070700        MOVE 'Y' TO RC064-03-PREPAID.                             07070000
070800                                                                  07080000
070900 5300-PREPAID-FLAG-EXIT.                                          07090000
071000     EXIT.                                                        07100000
071100                                                                  07110000
071200                                                                  07120000
071300 5400-VENDOR-NAME.                                                07130000
071400                                                                  07140000
071500     EXEC SQL                                                     07150000
071600        SELECT B.ENT_NAME_DESC                                    07160000
071700              ,DEPT_NBR                                           07170000
071800        INTO   :ENTNME-ENT-NAME-DESC                              07180000
071900              ,:PURCHS-DEPT-NBR                                   07190000
072000        FROM   TPURCHS A,                                         07200000
072100               TENTNME B                                          07210000
072200        WHERE  A.PO_NBR = :SHPTPO-PO-NBR                          07220000
072300          AND  A.VER_STATUS_CDE = 'A'                             07230000
072400          AND  B.ENT_ID = A.ENT_ID                                07240000
072500          AND  B.TYPE_CDE = '01'                                  07250000
072600                WITH UR                                           07260000
072700     END-EXEC.                                                    07270000
072800                                                                  07280000
072900     IF SQLCODE = +000                                            07290000
073000        MOVE ENTNME-ENT-NAME-DESC TO RC064-03-VENDOR-NAME         07300000
073100        MOVE PURCHS-DEPT-NBR TO RC064-03-DEPT-NBR                 07310000
073200     ELSE                                                         07320000
073300        IF SQLCODE = +100                                         07330000
073400           MOVE SPACES TO RC064-03-VENDOR-NAME                    07340000
073500           MOVE SPACES TO RC064-03-DEPT-NBR                       07350000
073600           GO TO 5400-VENDOR-NAME-EXIT                            07360000
073700        ELSE                                                      07370000
073800           DISPLAY 'TRIP_ID (TTRIPST) = ' TRIPST-TRIP-ID          07380000
073900           DISPLAY 'SHIPT_ID (TSHIPMT) = ' SHIPMT-SHIPT-ID        07390000
074000           MOVE '5400-VENDOR-NAME' TO PV-PARAGRAPH-NAME           07400000
074100           MOVE 'SELECT VENDOR NAME' TO PV-DB2-OPER-ATTEMPTED     07410000
074200           PERFORM 9999-SQL-ERROR.                                07420000
074300                                                                  07430000
074400 5400-VENDOR-NAME-EXIT.                                           07440000
074500     EXIT.                                                        07450000
074600                                                                  07460000
074700                                                                  07470000
074800***************************************************************** 07480000
074900***********************  RECORD TYPE 04  ************************ 07490000
075000***************************************************************** 07500000
075100*  1. USING PO_NBR AND REC_SEQ_NBR FROM THETSHPTPO TABLE,       * 07510000
075200*     ACCESS THE TRECITM TABLE.                                 * 07520000
075300*  2. USING THE ORD_LNE_NBR AN PO_VER_NBR FROM THE TRECITM      * 07530000
075400*     TABLE, ACCES THE TPURITM TABLE TO THE THE CLASS.          * 07540000
075500***************************************************************** 07550000
075600                                                                  07560000
075700 6000-RECORD-TYPE-04.                                             07570000
075800                                                                  07580000
075900     PERFORM VARYING CLASS-SUB FROM 1 BY 1 UNTIL CLASS-SUB > 10   07590000
076000        MOVE SPACES TO WS-CLASS (CLASS-SUB)                       07600000
076100     END-PERFORM.                                                 07610000
076200                                                                  07620000
076300     EXEC SQL                                                     07630000
076400        OPEN PURITM_CURSOR                                        07640000
076500     END-EXEC.                                                    07650000
076600                                                                  07660000
076700     IF SQLCODE NOT = +000                                        07670000
076800        MOVE '6000-RECORD-TYPE-04' TO PV-PARAGRAPH-NAME           07680000
076900        MOVE 'OPEN PURITM CURSOR' TO PV-DB2-OPER-ATTEMPTED        07690000
077000        PERFORM 9999-SQL-ERROR.                                   07700000
077100                                                                  07710000
077200     MOVE 'N' TO END-OF-PURITM-SW.                                07720000
077300                                                                  07730000
077400     PERFORM 6100-GET-CLASS                                       07740000
077500        THRU 6100-GET-CLASS-EXIT                                  07750000
077600           UNTIL END-OF-PURITM.                                   07760000
077700                                                                  07770000
077800     EXEC SQL                                                     07780000
077900        CLOSE PURITM_CURSOR                                       07790000
078000     END-EXEC.                                                    07800000
078100                                                                  07810000
078200     IF SQLCODE NOT = +000                                        07820000
078300        MOVE '6000-RECORD-TYPE-04' TO PV-PARAGRAPH-NAME           07830000
078400        MOVE 'CLOSE PURITM CURSOR' TO PV-DB2-OPER-ATTEMPTED       07840000
078500        PERFORM 9999-SQL-ERROR.                                   07850000
078600                                                                  07860000
078700     PERFORM VARYING CLASS-SUB FROM 1 BY 1                        07870000
078800        UNTIL CLASS-SUB > 10 OR WS-CLASS (CLASS-SUB) = SPACES     07880000
078900           MOVE WS-CLASS (CLASS-SUB) TO RC064-04-CLASS            07890000
079000           ADD 1 TO SUB                                           07900000
079100           MOVE RC064-RECORD-TYPE-04 TO WS-HOLD-RECORD (SUB)      07910000
079200     END-PERFORM.                                                 07920000
079300                                                                  07930000
079400 6000-RECORD-TYPE-04-EXIT.                                        07940000
079500     EXIT.                                                        07950000
079600                                                                  07960000
079700                                                                  07970000
079800 6100-GET-CLASS.                                                  07980000
079900                                                                  07990000
080000     EXEC SQL                                                     08000000
080100        FETCH PURITM_CURSOR                                       08010000
080200        INTO :PURITM-CL-NBR                                       08020000
080300     END-EXEC.                                                    08030000
080400                                                                  08040000
080500     IF SQLCODE = +000                                            08050000
080600        CONTINUE                                                  08060000
080700     ELSE                                                         08070000
080800        IF SQLCODE = +100                                         08080000
080900           MOVE 'Y' TO END-OF-PURITM-SW                           08090000
081000           GO TO 6100-GET-CLASS-EXIT                              08100000
081100        ELSE                                                      08110000
081200           DISPLAY 'TRIP_ID (TTRIPST) = ' TRIPST-TRIP-ID          08120000
081300           DISPLAY 'SHIPT_ID (TSHIPMT) = ' SHIPMT-SHIPT-ID        08130000
081400           MOVE '6100-GET-CLASS' TO PV-PARAGRAPH-NAME             08140000
081500           MOVE 'FETCH PURITM CURSOR' TO PV-DB2-OPER-ATTEMPTED    08150000
081600           PERFORM 9999-SQL-ERROR.                                08160000
081700                                                                  08170000
081800     MOVE PURITM-CL-NBR TO WS-MAJOR-CLASS.                        08180000
081900     MOVE ZERO TO WS-CLASS-CHAR-2.                                08190000
082000                                                                  08200000
082100     PERFORM VARYING CLASS-SUB FROM 1 BY 1 UNTIL CLASS-SUB > 10   08210000
082200        IF WS-MAJOR-CLASS = WS-CLASS (CLASS-SUB)                  08220000
082300           MOVE 11 TO CLASS-SUB                                   08230000
082400        ELSE                                                      08240000
082500           IF WS-CLASS (CLASS-SUB) = SPACES                       08250000
082600              MOVE WS-MAJOR-CLASS TO WS-CLASS (CLASS-SUB)         08260000
082700              MOVE 11 TO CLASS-SUB                                08270000
082800           END-IF                                                 08280000
082900        END-IF                                                    08290000
083000     END-PERFORM.                                                 08300000
083100                                                                  08310000
083200 6100-GET-CLASS-EXIT.                                             08320000
083300     EXIT.                                                        08330000
083400                                                                  08340000
083600 3200-CHECK-PROCESSED-FREIGHT.                                    08360000
083700                                                                  08370000
083800      PERFORM 3210-RECORD-TYPE-05                                 08380000
083900         THRU 3210-RECORD-TYPE-05-EXIT.                           08390000
084000                                                                  08400000
084100      IF PRCSD-FREIGHT-EXISTS                                     08410000
084101         MOVE TRIPST-TRIP-ID   TO RC064-05-TRIP-ID                08410100
084102         MOVE WS-PRCSD-CARTONS TO RC064-05-CARTONS                08410200
084103         MOVE RC064-RECORD-TYPE-05 TO OUTPUT-RECORD               08410300
084104         ADD +1 TO PT-05-RECORDS-WRITTEN                          08410407
084105                   PT-TOT-RECORDS-WRITTEN                         08410507
084106         WRITE OUTPUT-RECORD                                      08410600
084107      END-IF.                                                     08410700
084108                                                                  08410800
084109 3200-EXIT.                                                       08410900
084110      EXIT.                                                       08411000
084111                                                                  08411100
084112 3210-RECORD-TYPE-05.                                             08411200
084120                                                                  08412000
084121     EXEC SQL                                                     08412100
084122        SELECT  COUNT (DISTINCT(A.SHIPT_UNT_ID))                  08412200
084123        INTO    :WS-PRCSD-CARTONS                                 08412300
084124        FROM    SUT_OTBND_LOC  A,                                 08412400
084125                SUT_OTBND_CART B                                  08412500
084126        WHERE   A.INBD_TRIP_ID = :TRIPST-TRIP-ID                  08412600
084127          AND   A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                   08412700
084128          AND   B.CART_SRC_CDE = 'RDM'                            08412800
084129          AND   A.SCN_CDE      = 'RECV'                           08412901
084130     END-EXEC.                                                    08413001
084131                                                                  08413101
084140                                                                  08414000
084141     IF SQLCODE = +000                                            08414100
084142        CONTINUE                                                  08414200
084143     ELSE                                                         08414300
084144       IF SQLCODE = +100                                          08414400
084145          MOVE 'N' TO PRCSD-FREIGHT-EXISTS-SW                     08414500
084146          GO TO 3210-RECORD-TYPE-05-EXIT                          08414600
084147        ELSE                                                      08414700
084148           MOVE '3210-RECORD-TYPE-05' TO PV-PARAGRAPH-NAME        08414800
084149           MOVE 'FETCH PRCSDFRGT CURSOR' TO PV-DB2-OPER-ATTEMPTED 08414900
084150           PERFORM 9999-SQL-ERROR.                                08415000
084151                                                                  08415100
084152     IF WS-PRCSD-CARTONS > 0                                      08415200
084153        MOVE 'Y' TO PRCSD-FREIGHT-EXISTS-SW.                      08415300
084154                                                                  08415400
084155 3210-RECORD-TYPE-05-EXIT.                                        08415500
084156      EXIT.                                                       08415600
084158                                                                  08415800
084159 9999-SQL-ERROR.                                                  08415900
084160                                                                  08416000
084170     SET ABEND-4013 TO TRUE.                                      08417000
084180                                                                  08418000
084190     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            08419000
084200     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        08420000
084300                                                                  08430000
084400     COPY DPPD004.                                                08440000
084500                                                                  08450000
084600     CALL 'ILBOABN0'  USING ABEND-CODE.                           08460000
