000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.         INKUT332.                                    00020001
000300 AUTHOR.             COGNIZANT.                                   00030001
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040001
000500 DATE-WRITTEN.       10/20.                                       00050019
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800******************************************************************00080001
000900*  10/20/2013       COGNIZANT INITIAL IMPLEMENTATION              00090019
001000*  THIS PROGRAM GETS GMM, DMM AND CLASS DESCRIPTION VALUE TO THE  00100001
001100*  OUTPUT FILE FOR THE CREATION OF INVENTORY SHORTAGE REPORT IN   00110018
001110*  INKRP145 AND INKRP333 PROGRAM                                  00111018
001200***************************************************************** 00120001
001300                                                                  00130001
001400 ENVIRONMENT DIVISION.                                            00140001
001500*                                                                 00150001
001600 CONFIGURATION SECTION.                                           00160001
001700*                                                                 00170001
001800 SOURCE-COMPUTER.        IBM-3090.                                00180001
001900 OBJECT-COMPUTER.        IBM-3090.                                00190001
002000*                                                                 00200001
002100 INPUT-OUTPUT SECTION.                                            00210001
002200 FILE-CONTROL.                                                    00220001
002300     SELECT  STORE-SHORTAGE-FILE                                  00230001
002400         ASSIGN TO INP01.                                         00240001
002500     SELECT  STORE-SHORT-ADDNL-FILE                               00250001
002600         ASSIGN TO OUT01.                                         00260001
002700                                                                  00270001
002800 DATA DIVISION.                                                   00280001
002900 FILE SECTION.                                                    00290001
003000 FD  STORE-SHORTAGE-FILE                                          00300001
003100     LABEL RECORDS ARE STANDARD                                   00310001
003200     RECORDING MODE IS F                                          00320001
003300     BLOCK CONTAINS 0 RECORDS.                                    00330001
003400 01  STORE-SHORTAGE-RECORD  PIC X(126).                           00340001
003500                                                                  00350001
003600 FD  STORE-SHORT-ADDNL-FILE                                       00360001
003700     LABEL RECORDS ARE STANDARD                                   00370001
003800     RECORDING MODE IS F                                          00380001
003900     BLOCK CONTAINS 0 RECORDS.                                    00390001
004000 01  STORE-SHORT-ADDNL-RECORD   PIC X(155).                       00400001
004100                                                                  00410001
004200                                                                  00420001
004300 WORKING-STORAGE SECTION.                                         00430001
004400                                                                  00440001
004500 01  CONTROL-VARIABLES.                                           00450001
004900     05  CC-CURRENT-DATE.                                         00490001
005000         10  CC-DATE-YY          PIC X(02)    VALUE SPACES.       00500001
005100         10  CC-DATE-MM          PIC X(02)    VALUE SPACES.       00510001
005200         10  CC-DATE-DD          PIC X(02)    VALUE SPACES.       00520001
005300                                                                  00530011
006400 01  PV-PROGRAM-VARIABLES.                                        00640001
008500     05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.       00850001
008600     05  PV-DB2-OPER-ATTEMPTED   PIC X(30)    VALUE SPACES.       00860001
008700     05  PV-MDSEAR-GMA-NBR       PIC X(2)  VALUE SPACES.          00870011
008800     05  PV-MDSEAR-DMA-NBR       PIC X(2)  VALUE SPACES.          00880011
008900     05  PV-MDSEAR-DESC          PIC X(25)  VALUE SPACES.         00890011
009000     05  PV-DEPARTMENT-NUMB      PIC X(3).                        00900011
009100     05  PV-BUYER-NUMB           PIC X(3) VALUE ZERO.             00910011
009200     05  PV-CLASS-NUMB           PIC X(2) VALUE ZERO.             00920016
009300                                                                  00930001
009400 01  PS-PROGRAM-SWITCHES.                                         00940001
009500     05  PS-END-OF-FILE-SW       PIC X        VALUE 'Y'.          00950001
009600         88  PS-END-OF-FILE                   VALUE 'N'.          00960001
009700     05  PS-VALID-DEPT-CLASS-SW  PIC X        VALUE 'N'.          00970011
009800         88  PS-VALID-DEPT-CLASS              VALUE 'Y'.          00980011
009900         88  PS-INVALID-DEPT-CLASS            VALUE 'N'.          00990011
012300                                                                  01230001
012400*****  SQL ABEND ROUTINE WORKING STORAGE                          01240001
012500     COPY DPWS004.                                                01250001
012600*                                                                 01260001
012700*****  DB2 MERCHANDISE AREA TABLE DCLGEN                          01270001
012800     EXEC SQL                                                     01280001
012900         INCLUDE TMDSEAR                                          01290001
013000     END-EXEC.                                                    01300001
013100*                                                                 01310001
013200*****  DB2 APPLICATION AVAILABILITY TABLE DCLGEN                  01320001
013300*                                                                 01330001
013400     EXEC SQL                                                     01340001
013500         INCLUDE TAPLAVL                                          01350001
013600     END-EXEC.                                                    01360001
013700*                                                                 01370001
013800*****  DB2 INVENTORY PARAMETERS TABLE DCLGEN                      01380001
019000*                                                                 01900001
019100******************************************************************01910001
019200* COPYBOOK - STORE SHORATGE INPUT FILE                            01920001
019300******************************************************************01930001
019400     COPY INRD003I.                                               01940001
019500******************************************************************01950001
019600* COPYBOOK - STORE SHORATGE OUTPUT FILE                           01960001
019700******************************************************************01970001
019800     COPY INRD010.                                                01980001
019900                                                                  01990001
020000     EXEC SQL                                                     02000001
020100         INCLUDE SQLCA                                            02010001
020200     END-EXEC.                                                    02020001
020300                                                                  02030001
020400     COPY SQLCA2.                                                 02040001
020500******************************************************************02050011
020600* DECLARATION OF STORE_CSR THIS QUERY IS USED TO EXTRACT GMM,     02060015
020610* DMM AND CLASS DESCRIPTION VALUE.                                02061018
020700******************************************************************02070011
020800         EXEC SQL                                                 02080011
020900             DECLARE STORE-CSR CURSOR FOR                         02090011
021000              SELECT GMA_NBR,                                     02100011
021100                     DMA_NBR,                                     02110011
021200                     MDSEAR_DESC                                  02120011
021300              FROM   TMDSEAR A,                                   02130011
021400                     TAPLAVL B                                    02140011
021500              WHERE  A.OPERCO_NBR  = '03'                         02150011
021600               AND   A.DEPT_NBR    = :PV-DEPARTMENT-NUMB          02160011
021700               AND   A.BYR_NBR     = :PV-BUYER-NUMB               02170011
021800               AND   A.MAJ_CL_NBR  = :PV-CLASS-NUMB               02180016
021900               AND   A.MDSEAR_DKEY = B.MDSEAR_DKEY                02190011
022000               AND   MDSELV_CDE    = 'MCL'                        02200014
022100               AND   APLSYS_CDE    = 'IN'                         02210011
022200               AND   (DATE (CURRENT TIMESTAMP) BETWEEN            02220011
022300                                      STRT_DTE AND END_DTE) AND   02230011
022400                     (DATE (CURRENT TIMESTAMP) BETWEEN            02240011
022500                       MDSEAR_STRT_DTE AND MDSEAR_END_DTE)        02250011
033400         END-EXEC                                                 03340001
033401                                                                  03340111
033402 01  ABEND-CODE               PIC S9(04)  VALUE ZERO              03340201
033403                                          COMP SYNC.              03340301
033404     EJECT                                                        03340401
033405 LINKAGE SECTION.                                                 03340501
033406*                                                                 03340601
033407 PROCEDURE DIVISION.                                              03340701
033408*                                                                 03340801
033409******************************************************************03340901
033410*1000-MAIN-MODULE                                                 03341012
033411******************************************************************03341101
033412 1000-MAIN-MODULE.                                                03341201
033413                                                                  03341301
033414     PERFORM 1100-INITIALIZATION.                                 03341401
033415                                                                  03341501
033416     PERFORM 1200-PROCESS-STORE-RECORDS                           03341601
033417         UNTIL PS-END-OF-FILE.                                    03341701
033418                                                                  03341801
033419     PERFORM 1300-CLOSE-FILES.                                    03341901
033420                                                                  03342001
033421     STOP RUN.                                                    03342101
033422                                                                  03342201
033423******************************************************************03342301
033424*1100-INITIALIZATION                                              03342412
033425******************************************************************03342501
033426 1100-INITIALIZATION.                                             03342601
033427*                                                                 03342701
033428     OPEN INPUT  STORE-SHORTAGE-FILE                              03342801
033429          OUTPUT STORE-SHORT-ADDNL-FILE.                          03342901
033430*                                                                 03343001
033431     ACCEPT CC-CURRENT-DATE FROM DATE.                            03343101
033432                                                                  03343201
033433     DISPLAY ' CURRENT DATE : ' CC-CURRENT-DATE.                  03343311
033434*                                                                 03343401
033435         PERFORM 2100-READ-SHORTAGE-FILE.                         03343501
033436*                                                                 03343601
033437******************************************************************03343701
033438* 1200-PROCESS-STORE-RECORDS                                      03343801
033439* PROCESS EACH RECORD IN THE INPUT FILE                           03343901
033440******************************************************************03344001
033441  1200-PROCESS-STORE-RECORDS.                                     03344101
033442                                                                  03344201
033443      IF NOT PS-END-OF-FILE                                       03344301
033444         PERFORM 2200-PROCESS-STORE-FILE                          03344401
033445      END-IF.                                                     03344501
033446                                                                  03344601
033447*                                                                 03344701
033448******************************************************************03344801
033449*  CLOSE ALL FILES USED BY THIS PROGRAM.                          03344901
033450******************************************************************03345001
033451 1300-CLOSE-FILES.                                                03345101
033452*                                                                 03345201
033453     CLOSE       STORE-SHORTAGE-FILE                              03345301
033454                 STORE-SHORT-ADDNL-FILE.                          03345401
033455******************************************************************03345501
033456* 2100-READ-SHORTAGE-FILE                                         03345601
033457* READS STORE SHORTAGE FILE                                       03345701
033458******************************************************************03345801
033459 2100-READ-SHORTAGE-FILE.                                         03345901
033460                                                                  03346001
033470     INITIALIZE PV-MDSEAR-GMA-NBR                                 03347011
033480                PV-MDSEAR-DMA-NBR                                 03348011
033490                PV-MDSEAR-DESC                                    03349011
033491                                                                  03349111
033492     READ STORE-SHORTAGE-FILE                                     03349201
033493         INTO IN003I-STORE-SHORTAGE-REC                           03349301
033494             AT END                                               03349401
033495                 SET PS-END-OF-FILE TO TRUE.                      03349501
033496                                                                  03349601
033497******************************************************************03349701
033498* 2200-PROCESS-STORE-FILE                                         03349801
033499******************************************************************03349901
033500 2200-PROCESS-STORE-FILE.                                         03350001
033600                                                                  03360001
033700      MOVE IN003I-STORE-NUMB         TO IN010-STORE-NUMB.         03370011
033800      MOVE IN003I-DIVISION-NUMB      TO IN010-DIVISION-NUMB.      03380011
033900      MOVE IN003I-DEPARTMENT-NUMB    TO IN010-DEPARTMENT-NUMB.    03390011
034000      MOVE IN003I-CLASS-NUMB         TO IN010-CLASS-NUMB.         03400011
034100      MOVE IN003I-BUYER-NUMB         TO IN010-BUYER-NUMB.         03410011
034101      MOVE IN003I-STORE-NAME         TO IN010-STORE-NAME.         03410111
034102      MOVE IN003I-DEPARTMENT-NAME    TO IN010-DEPARTMENT-NAME.    03410201
034103      MOVE IN003I-FINANCE-CORP-NMBR  TO IN010-FINANCE-CORP-NMBR.  03410301
034104      MOVE IN003I-SHRINK-ALLOWANCE   TO IN010-SHRINK-ALLOWANCE.   03410401
034105      MOVE IN003I-BOOK-INV           TO IN010-BOOK-INV.           03410518
034106      MOVE IN003I-TOTAL-RETAIL       TO IN010-TOTAL-RETAIL.       03410613
034107      MOVE IN003I-TOTAL-COST         TO IN010-TOTAL-COST.         03410713
034108      MOVE IN003I-PHY-INV-RETAIL     TO IN010-PHY-INV-RETAIL.     03410813
034109      MOVE IN003I-SHORT-RETAIL       TO IN010-SHORT-RETAIL.       03410913
034110      MOVE IN003I-SHORT-COST         TO IN010-SHORT-COST.         03411013
034111      MOVE IN003I-TOTAL-SALES        TO IN010-TOTAL-SALES.        03411113
034112      MOVE IN003I-OPN-FSCL-MN-DTE    TO IN010-OPN-FSCL-MN-DTE.    03411213
034113      MOVE IN003I-INV-ID             TO IN010-INV-ID.             03411313
034114      MOVE IN003I-FINCL-INV-STAT-CDE TO IN010-FINCL-INV-STAT-CDE. 03411413
034115      MOVE IN010-DEPARTMENT-NUMB     TO PV-DEPARTMENT-NUMB.       03411513
034116      MOVE IN010-BUYER-NUMB          TO PV-BUYER-NUMB(2:2).       03411613
034117      MOVE IN010-CLASS-NUMB          TO PV-CLASS-NUMB.            03411717
034118      PERFORM 2300-OPEN-STORE-CSR.                                03411813
034119      PERFORM 2310-FETCH-STORE-CSR.                               03411913
034120        MOVE PV-MDSEAR-GMA-NBR         TO IN010-GMM-NUMBER.       03412013
034121        MOVE PV-MDSEAR-DMA-NBR         TO IN010-DMM-NUMBER.       03412113
034130        MOVE PV-MDSEAR-DESC            TO IN010-CLASS-DESCRIPTION.03413001
034131      PERFORM 2320-CLOSE-STORE-CSR.                               03413111
034132                                                                  03413201
034133      IF PS-VALID-DEPT-CLASS                                      03413311
034134       PERFORM 2400-WRITE-RECORD                                  03413401
034135      END-IF.                                                     03413511
034136       PERFORM 2100-READ-SHORTAGE-FILE.                           03413601
034137                                                                  03413701
034138******************************************************************03413811
034139* 2300-OPEN-STORE-CSR                                             03413911
034140******************************************************************03414011
034150 2300-OPEN-STORE-CSR.                                             03415011
034160                                                                  03416011
034170     EXEC SQL                                                     03417011
034180       OPEN STORE-CSR                                             03418011
034190     END-EXEC.                                                    03419011
034200                                                                  03420011
034300     EVALUATE TRUE                                                03430011
034400       WHEN SQLCODE NOT = +0                                      03440011
034500         MOVE '2300-OPEN-STORE-CSR'                               03450011
034600           TO PV-PARAGRAPH-NAME                                   03460011
034700         MOVE 'OPEN STORE-CSR CURSOR'                             03470011
034800           TO PV-DB2-OPER-ATTEMPTED                               03480011
034900         PERFORM 9900-SQL-ABEND                                   03490011
034901     END-EVALUATE.                                                03490111
034902******************************************************************03490201
034903* 2310-FETCH-STORE-CSR EXTRATS GMM, DMM AND CLASS DESCRITION      03490315
034904******************************************************************03490401
034905 2310-FETCH-STORE-CSR.                                            03490501
034906                                                                  03490611
034907         EXEC SQL                                                 03490711
034908              FETCH STORE-CSR                                     03490811
034909              INTO  :PV-MDSEAR-GMA-NBR,                           03490911
034910                    :PV-MDSEAR-DMA-NBR,                           03491011
034911                    :PV-MDSEAR-DESC                               03491111
034912         END-EXEC                                                 03491201
034913                                                                  03491301
034914         EVALUATE TRUE                                            03491401
034915             WHEN SQLCODE = 0                                     03491501
034916                 SET PS-VALID-DEPT-CLASS TO TRUE                  03491601
034917             WHEN SQLCODE = +100                                  03491701
034918                 SET PS-INVALID-DEPT-CLASS TO TRUE                03491801
034919             WHEN SQLCODE = -904                                  03491901
034920             WHEN SQLCODE = -911                                  03492001
034921                 CONTINUE                                         03492101
034922             WHEN OTHER                                           03492201
034923               MOVE '2310-FETCH-STORE-CSR' TO PV-PARAGRAPH-NAME   03492301
034924               PERFORM 9900-SQL-ABEND                             03492401
034925         END-EVALUATE.                                            03492501
034926                                                                  03492601
034927******************************************************************03492701
034928*2320-CLOSE-STORE-CSR                                             03492811
034929******************************************************************03492911
034930 2320-CLOSE-STORE-CSR.                                            03493011
034940                                                                  03494011
034950     EXEC SQL                                                     03495011
034960       CLOSE STORE-CSR                                            03496011
034970     END-EXEC.                                                    03497011
034980                                                                  03498011
034990     EVALUATE TRUE                                                03499011
035000       WHEN SQLCODE NOT = +0                                      03500011
035100         MOVE '2320-OPEN-STORE-TABLE'                             03510011
035200           TO PV-PARAGRAPH-NAME                                   03520011
035300         MOVE 'CLOSE STORE-CSR CURSOR'                            03530011
035400           TO PV-DB2-OPER-ATTEMPTED                               03540011
035500         PERFORM 9900-SQL-ABEND                                   03550011
035501     END-EVALUATE.                                                03550111
035502******************************************************************03550201
035503* RECORDS WHICH SURVIVED THE EDITS ARE WRITTEN TO THE OUTPUT FILE.03550301
035504******************************************************************03550401
035505 2400-WRITE-RECORD.                                               03550501
035506     WRITE STORE-SHORT-ADDNL-RECORD                               03550601
035507         FROM IN010-STORE-SHORTAGE-REC.                           03550701
035600                                                                  03560001
035700                                                                  03570001
035800******************************************************************03580001
035900*  STANDARD DB2 ERROR ABEND ROUTINE                               03590001
036000*  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.             03600001
036100******************************************************************03610001
036200 9900-SQL-ABEND.                                                  03620001
036300                                                                  03630001
036400     MOVE +4013                 TO ABEND-CODE.                    03640001
036500     DISPLAY '**  ABEND     **'.                                  03650001
036600     DISPLAY '**  PROGRAM   **  =  INKUT332'.                     03660001
036700     DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            03670001
036800     DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.        03680001
036900                                                                  03690001
037000*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         03700001
037100*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        03710001
037200                                                                  03720001
037300     COPY DPPD004.                                                03730001
037400                                                                  03740001
037500     CALL 'ILBOABN0'  USING ABEND-CODE.                           03750001
037600                                                                  03760001
