000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.    SUKUT041.                                         00050001
000600 AUTHOR.        GERMAN BANDA                                      00060001
000700 INSTALLATION.  KOHLS.                                            00070001
000800 DATE-WRITTEN   OCTOBER 2000.                                     00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100******************************************************************00110001
001200*  THIS PROGRAM DELETE THE SPECIFIED ROWS FROM THE TSURPRQ TABLE. 00120001
001300******************************************************************00130001
001400                                                                  00140001
001500******************************************************************00150001
001600 ENVIRONMENT DIVISION.                                            00160001
001700******************************************************************00170001
001800                                                                  00180001
001900 CONFIGURATION SECTION.                                           00190001
002000                                                                  00200001
002100 SOURCE-COMPUTER.        IBM-3090.                                00210001
002200 OBJECT-COMPUTER.        IBM-3090.                                00220001
002300                                                                  00230001
002400 INPUT-OUTPUT SECTION.                                            00240001
002500                                                                  00250001
002600 FILE-CONTROL.                                                    00260001
002700                                                                  00270001
002800                                                                  00280001
002900     SELECT RPT-REQ-DATA-EXTRACT                                  00290001
003000         ASSIGN TO INP01.                                         00300001
003100******************************************************************00310001
003200 DATA DIVISION.                                                   00320001
003300******************************************************************00330001
003400                                                                  00340001
003500 FILE SECTION.                                                    00350001
003600                                                                  00360001
003700                                                                  00370001
003800 FD  RPT-REQ-DATA-EXTRACT                                         00380001
003900     RECORDING MODE IS F                                          00390001
004000     LABEL RECORDS ARE STANDARD                                   00400001
004100     BLOCK CONTAINS 0 RECORDS.                                    00410001
004200                                                                  00420001
004710 01  RPT-REQ-DATA                   PIC   X(43).                  00471004
004800*                                                                 00480001
004900*                                                                 00490001
005000******************************************************************00500001
005100 WORKING-STORAGE SECTION.                                         00510001
005200******************************************************************00520001
005300*                                                                 00530001
005400*                                                                 00540001
005500******************************************************************00550001
005600*  DB2 FORMATTED MESSAGE AREA                                     00560001
005700******************************************************************00570001
005800     COPY DPWS004.                                                00580003
005900*                                                                 00590001
006000*                                                                 00600001
006100*                                                                 00610001
006200******************************************************************00620001
006300*  COMMUNICATIONS AREA FOR DB2                                    00630001
006400******************************************************************00640001
006500     EXEC SQL                                                     00650001
006600          INCLUDE SQLCA                                           00660001
006700     END-EXEC.                                                    00670001
006800                                                                  00680001
006900******************************************************************00690001
007000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PRINT REQUEST      00700001
007100*  TABLE                                                          00710001
007200******************************************************************00720001
007300     EXEC SQL                                                     00730001
007400          INCLUDE TSURPRQ                                         00740001
007500     END-EXEC.                                                    00750001
007510******************************************************************00751001
007600*                                                                 00760001
007700 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00770001
007800                                                   COMP SYNC.     00780001
007900                                                                  00790001
008000 01  PS-PROGRAM-SWITCHES.                                         00800001
008100     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00810001
008200         88  PS-END-OF-FILE                        VALUE 'Y'.     00820001
008300         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00830001
008400                                                                  00840001
008500                                                                  00850001
008600 01  PC-PROGRAM-CONSTANTS.                                        00860001
008700     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00870001
008800                                                   COMP SYNC.     00880001
008900     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00890001
009000         'SUKUT041'.                                              00900001
009100     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 100.     00910001
009200                                                                  00920001
009300                                                                  00930001
009400 01  DK-DB2-KEYS.                                                 00940001
009500     05   DK-WRKR-USR-ID            PIC   X(8).                   00950001
009600     05   DK-TRIP-ID                PIC  S9(9) COMP.              00960001
009700     05   DK-PO-NBR                 PIC  S9(9) COMP.              00970002
009800     05   DK-RQST-TMST              PIC   X(26).                  00980001
009900     05   DK-ALL-PO-IND             PIC   X(1).                   00990001
009910                                                                  00991001
010000 01  PV-PROGRAM-VARIABLES.                                        01000001
010100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01010001
010200     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01020001
010300     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     01030001
010400                                                   COMP SYNC.     01040001
010500     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     01050001
010600                                                   COMP SYNC.     01060001
010700     05  PV-FETCH-COUNTER            PIC S9(04)    VALUE ZERO     01070001
010800                                                   COMP SYNC.     01080001
010900     05  PV-DELETE-COUNT             PIC S9(09)    VALUE ZERO     01090001
011000                                                   COMP SYNC.     01100001
011100     05  PV-TOTAL-DELETE-COUNT       PIC S9(09)    VALUE ZERO     01110001
011200                                                   COMP SYNC.     01120001
011300     05  PV-NOT-FOUND-COUNT          PIC S9(09)    VALUE ZERO     01130001
011400                                                   COMP SYNC.     01140001
011500     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01150001
011600     05  PV-DISPLAY-TRIP             PIC 9(09)     VALUE ZEROES.  01160001
011700     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     01170001
011800                                                   COMP-3.        01180001
011900                                                                  01190001
011910                                                                  01191004
011920 01  RPT-REQ-DATA-RECORD.                                         01192004
011930     10 RPRQ-WRKR-USR-ID            PIC   X(8).                   01193004
011940     10 RPRQ-TRIP-ID                PIC  S9(9) COMP.              01194004
011950     10 RPRQ-PO-NBR                 PIC  S9(9) COMP.              01195004
011960     10 RPRQ-RQST-TMST              PIC   X(26).                  01196004
011970     10 RPRQ-ALL-PO-IND             PIC   X(1).                   01197004
012000                                                                  01200001
012100******************************************************************01210001
012200 PROCEDURE DIVISION.                                              01220001
012300******************************************************************01230001
012400                                                                  01240001
012500 0000-PROGRAM-MAINLINE.                                           01250001
012600******************************************************************01260001
012700* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     01270001
012800*      PROGRAM.                                                   01280001
012900******************************************************************01290001
013000                                                                  01300001
013100     PERFORM 1000-INITIALIZE.                                     01310001
013200     IF PS-NOT-END-OF-FILE                                        01320001
013300         PERFORM 2000-PROCESS-RPT-REQ-DELETE                      01330001
013400            UNTIL PS-END-OF-FILE                                  01340001
013500     END-IF.                                                      01350001
013600     PERFORM 9000-EOJ-ROUTINE.                                    01360001
013700                                                                  01370001
013800     STOP RUN.                                                    01380001
013900                                                                  01390001
014000 1000-INITIALIZE.                                                 01400001
014100******************************************************************01410001
014200*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    01420001
014300*    -- OPEN INPUT FILE                                           01430001
014400*    -- READ FILE                                                 01440001
014500******************************************************************01450001
014600                                                                  01460001
014700     OPEN INPUT  RPT-REQ-DATA-EXTRACT.                            01470001
014800     PERFORM 7000-READ-RPT-REQ-DELETES.                           01480001
014900                                                                  01490001
015000                                                                  01500001
015100                                                                  01510001
015200******************************************************************01520001
015300 2000-PROCESS-RPT-REQ-DELETE.                                     01530001
015400                                                                  01540001
015500     PERFORM 8000-DELETE-RPT-REQ-DATA.                            01550001
015600                                                                  01560001
015700     IF PV-DELETE-COUNT > PC-COMMIT-HOLD                          01570001
015800         EXEC SQL                                                 01580001
015900            COMMIT                                                01590001
016000         END-EXEC                                                 01600001
016100                                                                  01610001
016200         IF SQLCODE NOT = +0                                      01620001
016300             DISPLAY '### COMMIT FAILED ! ###'                    01630001
016400             MOVE '2000-PROCESS-RPT-REQ-DELETE'                   01640001
016500                         TO PV-PARAGRAPH-NAME                     01650001
016600             MOVE 'COMMIT OF TSURPRQ'                             01660001
016700                         TO PV-DB2-OPERATION-ATTEMPTED            01670001
016800             PERFORM 9100-SQL-ABEND                               01680001
016900         END-IF                                                   01690001
017000                                                                  01700001
017100         MOVE +0 TO PV-DELETE-COUNT                               01710001
017200     END-IF.                                                      01720001
017300                                                                  01730001
017400                                                                  01740001
017500     PERFORM 7000-READ-RPT-REQ-DELETES.                           01750001
017600                                                                  01760001
017700******************************************************************01770001
017800 7000-READ-RPT-REQ-DELETES.                                       01780001
017900      READ RPT-REQ-DATA-EXTRACT                                   01790001
018000           INTO RPT-REQ-DATA-RECORD                               01800004
018100           AT END SET PS-END-OF-FILE TO TRUE.                     01810001
018200                                                                  01820001
018300******************************************************************01830001
018400*  DELETE THE ROW FROM THE PRINT REQUEST DATA TABLE               01840001
018500******************************************************************01850001
018600 8000-DELETE-RPT-REQ-DATA.                                        01860001
018700                                                                  01870001
018800     MOVE  RPRQ-WRKR-USR-ID     TO  DK-WRKR-USR-ID.               01880001
018900     MOVE  RPRQ-TRIP-ID         TO  DK-TRIP-ID.                   01890001
019000     MOVE  RPRQ-PO-NBR          TO  DK-PO-NBR.                    01900001
019100     MOVE  RPRQ-RQST-TMST       TO  DK-RQST-TMST.                 01910001
019200     MOVE  RPRQ-ALL-PO-IND      TO  DK-ALL-PO-IND.                01920001
019300                                                                  01930001
019400     EXEC SQL                                                     01940001
019500         DELETE                                                   01950001
019600             FROM  TSURPRQ                                        01960001
019700             WHERE WRKR_USR_ID     = :DK-WRKR-USR-ID              01970001
019800               AND TRIP_ID         = :DK-TRIP-ID                  01980001
019900               AND PO_NBR          = :DK-PO-NBR                   01990001
020000               AND RQST_TMST       = :DK-RQST-TMST                02000001
020010               AND ALL_PO_IND      = :DK-ALL-PO-IND               02001001
020020                                                                  02002001
020100     END-EXEC.                                                    02010001
020200                                                                  02020001
020300     EVALUATE TRUE                                                02030001
020400         WHEN SQLCODE = 0                                         02040001
020500             ADD +1           TO PV-DELETE-COUNT                  02050001
020600             ADD +1           TO PV-TOTAL-DELETE-COUNT            02060001
020700         WHEN SQLCODE = +100                                      02070001
020800             ADD +1           TO PV-NOT-FOUND-COUNT               02080001
020900         WHEN SQLCODE < 0                                         02090001
021000         WHEN SQLCODE > 0                                         02100001
021100         WHEN SQLWARN0 = 'W'                                      02110001
021200             MOVE '8000-DELETE-RPT-REQ-DATA'                      02120001
021300                         TO PV-PARAGRAPH-NAME                     02130001
021400             MOVE 'DELETE OF TSURPRQ'                             02140001
021500                         TO PV-DB2-OPERATION-ATTEMPTED            02150001
021600             PERFORM 9100-SQL-ABEND                               02160001
021700     END-EVALUATE.                                                02170001
021800                                                                  02180001
021900                                                                  02190001
022000 9000-EOJ-ROUTINE.                                                02200001
022100******************************************************************02210001
022200*  CLOSE OUTPUT FILE.  CLOSE THE CURSOR.                          02220001
022300******************************************************************02230001
022400     CLOSE RPT-REQ-DATA-EXTRACT.                                  02240001
022500                                                                  02250001
022600     MOVE PV-TOTAL-DELETE-COUNT  TO PV-DISPLAY-COUNT.             02260001
022700     DISPLAY 'TOTL REPT REQ DATA RECORDS DELTD ' PV-DISPLAY-COUNT.02270001
022800     MOVE PV-NOT-FOUND-COUNT TO PV-DISPLAY-COUNT.                 02280001
022900     DISPLAY 'TOTL REPT REQ RECS NOT FOUND ' PV-DISPLAY-COUNT.    02290001
023000                                                                  02300001
023100                                                                  02310001
023200 9100-SQL-ABEND.                                                  02320001
023300******************************************************************02330001
023400*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    02340001
023500*  ERROR OR WARNING CODE OCCURS.                                  02350001
023600******************************************************************02360001
023700     DISPLAY '9100-SQL-ABEND'.                                    02370001
023800     DISPLAY '** ABEND     **'.                                   02380001
023900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        02390001
024000     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              02400001
024100     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     02410001
024200                                                                  02420001
024300******************************************************************02430001
024400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02440001
024500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02450001
024600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02460001
024700* FORMAT.                                                         02470001
024800******************************************************************02480001
024900     COPY DPPD004.                                                02490001
025000                                                                  02500001
025100     MOVE +4013                  TO ABEND-CODE.                   02510001
025200     CALL 'ILBOABN0' USING ABEND-CODE.                            02520001
