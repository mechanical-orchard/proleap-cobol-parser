000100*----------------------------------------------------------------*00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*----------------------------------------------------------------*00030000
000400 PROGRAM-ID.           IMKUT087.                                  00040000
000500 AUTHOR.               PAUL KEBER.                                00050000
000600 INSTALLATION.         KOHLS DEPARTMENT STORES.                   00060000
000700 DATE-WRITTEN.         11/17/2006.                                00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*----------------------------------------------------------------*00100000
001100*   IMKUT087 - CHECKS THE XLPO DB2 TABLES TPLNSHP AND TPURITM FOR*00110000
001200*              THE EXISTENCE OF A SKU ON A PO LESS THAN 2 YEARS  *00120000
001400*----------------------------------------------------------------*00140000
001500*   THIS PROGRAM EXECUTES FOR ALL CLEARANCE SKUS TO CHECK FOR    *00150000
001600*   THE EXISTENCE OF THAT SKU ON XLPO TABLES TO DETERMINE IF THE *00160000
001700*   SKU IS ELIGIBLE FOR COMPRESSION.                             *00170000
001800*   IF THE SKU IS FOUND ON THE TPURITM TABLE, OR IF IT IS        *00180000
001900*   FOUND ON A PO WHOSE DON'T SHIP BEFORE DATE IS LESS THAN TWO  *00190000
002000*   YEARS OLD, THEN THE SKU IS NOT ELIGIBLE FOR COMPRESSION.     *00200000
002200*   THE PROGRAM WILL WRITE OUT ALL VALID COMPRESSION SKUS.       *00220000
002300*   NON-CLEARANCE SKUS, SKUS THAT HAVE PREVIOUSLY BEEN DELETED,  *00230000
002400*   AND SKUS THAT ARE NOT RCP SKUS WILL BE DROPPED.              *00240000
002800*   NOTE: MODIFIED THE EXISTING PROGRAM BY REPLACING THE RMS9    *00250000
002800*   ORACLE PACKAGE WITH XLPO DB2 TABLES.                         *00251000
002600*----------------------------------------------------------------*00260000
002700*  CHANGED:                                                      *00270000
002800*                                                                *00280000
002900*    WR/PITS#     DATE        DESCRIPTION                        *00290000
003000*    --------   ----------   ---------------------------------   *00300000
003100*    WR29925    11-17-2006   INITIAL DEVELOPMENT.                *00310000
003200*    WR29925    12-05-2006   ADD CHECK FOR DELETED SKUS.         *00320000
003300*    WR29925    12-06-2006   ADD CHECK FOR SKU BEING AN RCP SKU. *00330000
003400*----------------------------------------------------------------*00340000
P5207G* 04/25/14 - VENKATSUBBU CHANGE TAG - P5207G, CR NO -CHG0081766  *00350000
P5207G*  - MODIFIED THE PROGRAM TO REPLACE THE K_IMPG_DEL_SKU_VALIDATE *00360000
P5207G*    .K_IMFN_OLD_PO_SKU_VA RMS9 ORACLE PACKAGE WITH DB2 TABLES   *00370000
P5207G*    LIKE TPURITM AND TPLNSHP. FOR EXECUTING THE DB2 QUERY THE   *00380000
P5207G*    SUBPROGRAM IMKUT115 IS CALLED.                              *00381000
003900*----------------------------------------------------------------*00390000
P11161* 05/31/16 - COGNIZANT CHANGE TAG - P11161, CR NO -CHG0146661    *00392075
P11161*  - MODIFIED THE PROGRAM TO REMOVE THE ORACLE QUERY             *00393073
P11161*    BECAUSE THE CRITERIA FROM THE ORACLE QUERIES CAN            *00393173
P11161*    BE REPLACED BY LOOKING AT CRITERIA IN DB2.                  *00393273
P11161*  - REMOVE THE CALL TO IMKUT115, AND INCLUDE THE DB2            *00393373
P11161*    CODE FROM IMKUT115 IN THIS PROGRAM.  NOW THIS               *00393473
P11161*    PROGRAM WILL JUST BE DB2.  ORACLE IS NO LONGER               00394073
P11161*    USED IN THE PROGRAM                                         *00395073
P11161*----------------------------------------------------------------*00396073
004100     EJECT                                                        00410000
004200*----------------------------------------------------------------*00420000
004300 ENVIRONMENT DIVISION.                                            00430000
004400*----------------------------------------------------------------*00440000
004500 CONFIGURATION SECTION.                                           00450000
004600 SOURCE-COMPUTER.    IBM-3090.                                    00460000
004700 OBJECT-COMPUTER.    IBM-3090.                                    00470000
004800*                                                                 00480000
004900 INPUT-OUTPUT SECTION.                                            00490000
005000 FILE-CONTROL.                                                    00500000
005100*                                                                 00510000
005200     SELECT SKU-INPUT-FILE                                        00520000
005300         ASSIGN TO INP01.                                         00530000
005400*                                                                 00540000
005800     SELECT SKU-COMPRESS-CAND-FILE                                00580000
005900         ASSIGN TO OUT01.                                         00590000
006000*                                                                 00600000
006100*----------------------------------------------------------------*00610000
006200 DATA DIVISION.                                                   00620000
006300*----------------------------------------------------------------*00630000
006400 FILE SECTION.                                                    00640000
006500 FD  SKU-INPUT-FILE                                               00650000
006600     RECORDING MODE IS F                                          00660000
006700     BLOCK CONTAINS 0 RECORDS.                                    00670000
006800 01  SD-INPUT-RECORD         PIC X(100).                          00680000
006900                                                                  00690000
007600 FD  SKU-COMPRESS-CAND-FILE                                       00760000
007700     RECORDING MODE IS F                                          00770000
007800     BLOCK CONTAINS 0 RECORDS.                                    00780000
007900 01  SD-OUTPUT-RECORD        PIC X(20).                           00790000
008000                                                                  00800000
008100 WORKING-STORAGE SECTION.                                         00810000
008200                                                                  00820000
008300 01  FILLER                  PIC X(30)  VALUE                     00830000
008400         '** BEGINING OF IMKUT087 W/S **'.                        00840000
008500                                                                  00850000
008600 01  PA-PROGRAM-ACCUMULATORS.                                     00860000
008700     05  PA-WRITE-COUNT              PIC S9(7)     VALUE ZERO     00870000
008800                                                   COMP-3.        00880000
008900     05  PA-READ-COUNT               PIC S9(7)     VALUE ZERO     00890000
009000                                                   COMP-3.        00900000
009100     05  PA-COUNT                    PIC S9(7)     VALUE ZERO     00910000
009200                                                   COMP-3.        00920000
009300     05  PA-BYPASSED-SKU-COUNT       PIC S9(7)     VALUE ZERO     00930000
009400                                                   COMP-3.        00940000
009700     05  PA-NON-CLR-SKU-COUNT        PIC S9(7)     VALUE ZERO     00970000
009800                                                   COMP-3.        00980000
P11161     05  PA-UPC-NOT-FOUND            PIC S9(7)     VALUE ZERO     00981000
P11161                                                   COMP-3.        00982000
P11161     05  PA-SKU-NOT-FOUND            PIC S9(7)     VALUE ZERO     00983000
P11161                                                   COMP-3.        00984000
P11161     05  PA-CORP-ROW-NOT-FOUND       PIC S9(7)     VALUE ZERO     00985000
P11161                                                   COMP-3.        00986000
009900     05  PA-NON-RCP-SKU-COUNT        PIC S9(7)     VALUE ZERO     00990000
010000                                                   COMP-3.        01000000
010100     05  PA-WRITTEN-SKU-COUNT        PIC S9(7)     VALUE ZERO     01010000
010200                                                   COMP-3.        01020000
010300 01  PC-PROGRAM-CONSTANTS.                                        01030000
010400     05  PC-PROGRAM-NAME              PIC X(08)  VALUE            01040000
010500                                                 'IMKUT087'.      01050000
010700     05  PC-CLEARANCE-STATUS          PIC X(02)  VALUE '30'.      01070000
010800     05  PC-MESSAGES.                                             01080000
010900         10  PC-SQL-ABEND-MESSAGE     PIC X(23)  VALUE            01090000
011000         '** ABEND -> SQLERROR = '.                               01100000
011100         10  PC-PROGRAM-MESSAGE       PIC X(23)  VALUE            01110000
011200         '** PROGRAM        ** = '.                               01120000
011300         10  PC-PARAGRAPH-MESSAGE     PIC X(23)  VALUE            01130000
011400         '** PARAGRAPH-NAME ** = '.                               01140000
011500         10  PC-DB2-OPER-MESSAGE      PIC X(23)  VALUE            01150000
011600         '** DB2 OPERATION  ** = '.                               01160000
011700                                                                  01170000
011800 01  PS-PROGRAM-SWITCHES.                                         01180000
011900     05  PS-END-OF-INPUT-FILE-SW           PIC X(1)   VALUE 'N'.  01190000
012000         88  PS-END-OF-INPUT-FILE                     VALUE 'Y'.  01200000
P11161     05  PS-REC-FOUND-SW                   PIC X(1)   VALUE 'N'.  01210069
P11161         88  PS-REC-FOUND                             VALUE 'Y'.  01220069
P11161         88  PS-REC-NOT-FOUND                         VALUE 'N'.  01230069
P11161     05  PS-REGIONAL-PRICE-IND             PIC X(01)  VALUE 'N'.  01231000
P11161         88  PS-REGIONALLY-PRICED                     VALUE 'Y'.  01232000
P11161         88  PS-NON-REGIONALLY-PRICED                 VALUE 'N'.  01233000
012400                                                                  01240000
012500                                                                  01250000
012600  01 PV-PROGRAM-VARIABLES.                                        01260000
012700     05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACE.    01270000
012800     05  PV-OPERATION-ATTEMPTED       PIC X(30)   VALUE SPACE.    01280000
012900     05  PV-ABEND-CODE                PIC S9(04)  VALUE +0  COMP. 01290000
P11161         88  PV-ABEND-4013-SQL-ERR                VALUE 4013.     01340000
013500*            SQL ERROR                                            01350000
013600     05  PV-REMAINDER                 PIC S9(4)V99 VALUE 0 COMP-3.01360000
013700     05  PV-RESULT                    PIC S9(05)   VALUE 0 COMP-3.01370000
013800     05  PV-PARA-NAME                 PIC X(50).                  01380000
P11161     05  PV-TUPCPLS                   PIC X(01).                  01381000
013900     05  PV-SKU-NUM-ID                PIC S9(08)    COMP-3        01390000
014000                                                    VALUE 0.      01400000
014100     05  PV-SKU-ID-UNPACK             PIC 9(08)     VALUE 0.      01410000
014200                                                                  01420000
019200 01  PV-VALIDATE-PARAMETERS.                                      01421000
019300     05  PV-SKU                       PIC X(08).                  01422000
019400     05  PV-RELATION-EXIST            PIC X(01).                  01423000
019500         88  PV-RELATION-DOES-EXIST                 VALUE 'Y'.    01424000
019600         88  PV-RELATION-DOES-NOT-EXIST             VALUE 'N'.    01425000
014200                                                                  01426000
014300 01  WS-MSG-TEXT                      PIC X(512).                 01430000
014400 01  WS-MAX-SIZE                      PIC S9(09) COMP             01440000
014500                                                    VALUE 512.    01450000
014600 01  WS-MSG-LENGTH                    PIC S9(09) COMP.            01460000
014700                                                                  01470000
014800******************************************************************01480000
014900*  INPUT FILE RECORD LAYOUT                                       01490000
015000******************************************************************01500000
015100     COPY IMRD020.                                                01510000
015200                                                                  01520000
017000******************************************************************01700000
017100*  OUTPUT SKU COMPRESSION CANDIDATES RECORD LAYOUT                01710000
017200******************************************************************01720000
017300     COPY IMRD036.                                                01730000
017400                                                                  01740000
023100* DB2 MESSAGE AREA                                                02310000
023200*                                                                 02320000
023300     COPY SQLCA2.                                                 02330000
023400*                                                                 02340000
P11161***************************************************************** 02341000
P11161*    DB2 AREA FOR TABLES                                        * 02342000
P11161***************************************************************** 02343000
P11161     EXEC SQL INCLUDE TPURITM END-EXEC.                           02344000
P11161     EXEC SQL INCLUDE TPLNSHP END-EXEC.                           02345000
P11161     EXEC SQL INCLUDE TUPC    END-EXEC.                           02345100
P11161     EXEC SQL INCLUDE TSK     END-EXEC.                           02345300
P11161     EXEC SQL INCLUDE TUPCPLS END-EXEC.                           02345400
P11161                                                                  02346000
P11161***************************************************************** 02347070
P11161*    SQL COMMUNICATIONS AREA DCLGEN                               02348070
P11161***************************************************************** 02349070
P11161     EXEC SQL                                                     02349170
P11161         INCLUDE SQLCA                                            02349270
P11161     END-EXEC.                                                    02349370
                                                                        02349400
023500 PROCEDURE DIVISION.                                              02350000
023600*                                                                 02360000
023700*                                                                 02370000
023800*----------------------------------------------------------------*02380000
023900*    MAINLINE-LOGIC                                              *02390000
024000*----------------------------------------------------------------*02400000
024100                                                                  02410000
024200 0000-IMKUT087.                                                   02420000
024300                                                                  02430000
024400     PERFORM 1000-INITIALIZATION.                                 02440000
024500     PERFORM 2000-PROCESS-SKU                                     02450000
024600       UNTIL PS-END-OF-INPUT-FILE.                                02460000
024700     PERFORM 1500-END-OF-JOB.                                     02470000
024800     GOBACK.                                                      02480000
024900                                                                  02490000
025000******************************************************************02500000
025100*    OPEN FILES, PERFORM INITIAL READ AND LOGIN TO ORACLE        *02510000
025200******************************************************************02520000
025300 1000-INITIALIZATION.                                             02530000
025400                                                                  02540000
025500     OPEN INPUT  SKU-INPUT-FILE                                   02550000
025700          OUTPUT SKU-COMPRESS-CAND-FILE.                          02570000
027300                                                                  02730000
027400     PERFORM 6000-READ-SKU-INPUT.                                 02740000
027500     IF PS-END-OF-INPUT-FILE                                      02750000
027600         DISPLAY '********** IMKUT087 ************'               02760000
027700         DISPLAY 'SKU COMPRESS INPUT FILE IS EMPTY'               02770000
027800         DISPLAY '********************************'               02780000
028100     END-IF.                                                      02810000
028200                                                                  02820000
033700******************************************************************03370000
033800*  CLOSE FILES AND DISPLAY COUNTS                                *03380000
033900******************************************************************03390000
034000 1500-END-OF-JOB.                                                 03400000
034100                                                                  03410000
034200     CLOSE SKU-INPUT-FILE                                         03420000
034300           SKU-COMPRESS-CAND-FILE.                                03430000
034400                                                                  03440000
034500     DISPLAY '**  IMKUT087 END OF JOB STATISTICS  **'.            03450000
034600     DISPLAY '# OF RECORDS READ       = ' PA-READ-COUNT.          03460000
034700     DISPLAY '# OF NON-CLEARANCE SKUS = ' PA-NON-CLR-SKU-COUNT.   03470000
P11161     DISPLAY '# OF NON-UPC            = ' PA-UPC-NOT-FOUND.       03480000
P11161     DISPLAY '# OF NON-SKU            = ' PA-SKU-NOT-FOUND.       03481000
P11161     DISPLAY '# OF NON-CORP-ROW       = ' PA-CORP-ROW-NOT-FOUND.  03482000
034900     DISPLAY '# OF NON-RCP SKUS       = ' PA-NON-RCP-SKU-COUNT.   03490071
035000     DISPLAY '# OF BYPASSED SKUS      = ' PA-BYPASSED-SKU-COUNT.  03500000
035100     DISPLAY '# OF SKUS WRITTEN       = ' PA-WRITTEN-SKU-COUNT.   03510000
035200                                                                  03520000
035300 EJECT                                                            03530000
035400******************************************************************03540000
035500*    2000-PROCESS-SKU                                            *03550000
035600*      THIS IS PERFORMED ONLY VIA THE 0000-IMKUT087 PARAGRAPH.   *03560000
035700*      PURPOSE: READ AND PROCESS THE SKU INFORMATION.            *03570000
035800*      DETERMINE IF THIS IS A NON-DELETED, RCP CLEARANCE SKU AND *03580000
035900*      THEN DETERMINE IF THE SKU IS ON AN OLD PO.                *03590000
036100******************************************************************03610000
036200 2000-PROCESS-SKU.                                                03620000
036300                                                                  03630000
036400     IF IM020-SKU-STAT = PC-CLEARANCE-STATUS                      03640000
P11161         PERFORM 7000-SELECT-TUPC-REGN-PRIC-IND                   03650000
P11161         IF PS-REC-NOT-FOUND                                      03651068
P11161            CONTINUE                                              03652068
036800         ELSE                                                     03653067
P11161             IF PS-REGIONALLY-PRICED                              03660072
037000                 PERFORM 3000-OLD-PO-SKU-CHECK                    03710072
037100             ELSE                                                 03720072
037200                 ADD 1 TO PA-NON-RCP-SKU-COUNT                    03730072
037300             END-IF                                               03740072
037400         END-IF                                                   03741072
037500     ELSE                                                         03750000
037600         ADD 1 TO PA-NON-CLR-SKU-COUNT                            03760000
037700     END-IF.                                                      03770000
037800                                                                  03780000
037900     PERFORM 6000-READ-SKU-INPUT.                                 03790000
038000                                                                  03800000
038100******************************************************************03810000
038200*    3000-OLD-PO-SKU-CHECK                                       *03820000
038300*      PURPOSE: CALL TPLNSHP AND TPURITM TABLE TO DETERMINE IF   *03830000
038400*      THE SKU IS ON AN OLD PO.                                  *03840000
038500*      IF A SKU IS NOT FOUND IN TPURITM TABLE OR IF THE SKU IS   *03850000
038600*      ONLY ON A PO WHOSE DON'T SHIP BEFORE DATE IS MORE THAN    *03860000
038700*      TWO YEARS OLD, THE SKU IS ELIGIBLE FOR COMPRESSION.       *03870000
039000******************************************************************03900000
039100 3000-OLD-PO-SKU-CHECK.                                           03910000
039200                                                                  03920000
039300     MOVE IM020-SKU        TO PV-SKU-NUM-ID.                      03930000
039400     MOVE PV-SKU-NUM-ID    TO PV-SKU-ID-UNPACK.                   03940000
039500     MOVE PV-SKU-ID-UNPACK TO PV-SKU.                             03950000
039600                                                                  03960000
P11161     EXEC SQL                                                     03981000
P11161          SELECT DECODE (COUNT(*),0,'N','Y')                      03982000
P11161            INTO :PV-RELATION-EXIST                               03983000
P11161            FROM SYSIBM.SYSDUMMY1                                 03984000
P11161           WHERE EXISTS (SELECT A.PO_NBR                          03985000
P11161             FROM TPLNSHP A,TPURITM B                             03986000
P11161             WHERE A.PO_NBR = B.PO_NBR                            03987000
P11161             AND A.VER_STATUS_CDE = 'A'                           03988000
P11161             AND B.VER_STATUS_CDE = 'A'                           03989000
P11161             AND A.DONT_SHIP_BEF_DTE >= CURRENT DATE - 730 DAYS   03989100
P11161             AND B.RMS_PO_SKU_NBR = :PV-SKU)                      03989200
P11161     END-EXEC                                                     03989300
042300                                                                  04230000
042400     EVALUATE TRUE                                                04240000
P5207G       WHEN SQLCODE = 0                                           04250000
042600           IF PV-RELATION-DOES-NOT-EXIST                          04260000
042700               ADD 1 TO PA-WRITTEN-SKU-COUNT                      04270000
042800               PERFORM 8000-WRITE-VALID-SKU-COMPRESSN             04280000
042900           ELSE                                                   04290000
043000               ADD 1 TO PA-BYPASSED-SKU-COUNT                     04300000
043100           END-IF                                                 04310000
043200       WHEN OTHER                                                 04320000
043300           MOVE '2000-PROCESS-SKU' TO PV-PARAGRAPH-NAME           04330000
P5207G           MOVE 'TPURITM,TPLNSHP'                                 04340000
043500                                   TO PV-OPERATION-ATTEMPTED      04350000
043700           PERFORM 9999-SQL-ERROR                                 04370000
043800     END-EVALUATE.                                                04380000
043900                                                                  04390000
044000******************************************************************04400000
044100* READ SKU COMPRESSIONS FILE.                                    *04410000
044200******************************************************************04420000
044300 6000-READ-SKU-INPUT.                                             04430000
044400     MOVE '*6000-READ-SKU-INPUT. *' TO PV-PARA-NAME.              04440000
044500                                                                  04450000
044600     READ SKU-INPUT-FILE INTO IM020-STYLE-DELETE-REC              04460000
044700         AT END                                                   04470000
044800             SET PS-END-OF-INPUT-FILE TO TRUE                     04480000
044900         NOT AT END                                               04490000
045000             ADD +1 TO PA-READ-COUNT                              04500000
045100             DIVIDE PA-READ-COUNT BY 10000 GIVING PV-RESULT       04510000
045200                 REMAINDER PV-REMAINDER                           04520000
045300             IF PV-REMAINDER = 0                                  04530000
045400                 DISPLAY 'NUMBER OF RECORDS READ: '               04540000
045500                       PA-READ-COUNT                              04550000
045600             END-IF                                               04560000
045700     END-READ.                                                    04570000
045800                                                                  04580000
P11161******************************************************************04590000
P11161* DETERMINE THE TUPC REGIONAL PRICE INDICATOR                     04600000
P11161******************************************************************04610000
P11161 7000-SELECT-TUPC-REGN-PRIC-IND.                                  04620000
P11161     MOVE '*7000-SELECT-TUPC-REGN-PRIC-IND *' TO PV-PARA-NAME.    04630000
P11161     SET PS-NON-REGIONALLY-PRICED  TO TRUE.                       04640000
P11161                                                                  04641000
P11161     EXEC SQL                                                     04650000
P11161          SELECT A.REGN_PRIC_IND                                  04660000
P11161            INTO :UPC-REGN-PRIC-IND                               04670000
P11161            FROM TUPC A                                           04680000
P11161            WHERE A.UPC_ID       = :IM020-INTR-UPC-ID             04690000
P11161              AND UPC_TYP_CDE    = 'I'                            04700000
P11161              AND EFF_END_DTE    IS NULL                          04710000
P11161     END-EXEC.                                                    04720000
P11161                                                                  04730000
P11161     IF SQLCODE = 0                                               04740000
P11161        SET PS-REC-FOUND TO TRUE                                  04750066
P11161        IF UPC-REGN-PRIC-IND = 'Y'                                04760000
P11161           PERFORM 7100-SELECT-TSK-REGN-PRIC-IND                  04770000
P11161        END-IF                                                    04780000
P11161     ELSE                                                         04790000
P11161         IF SQLCODE = +100                                        04800000
P11161            SET PS-REC-NOT-FOUND TO TRUE                          04801066
P11161            ADD 1 TO PA-UPC-NOT-FOUND                             04810000
P11161         ELSE                                                     04820000
P11161            MOVE '7000-SELECT-TUPC-REGN-PRIC-IND'                 04830000
P11161                                        TO PV-PARAGRAPH-NAME      04831000
P11161            MOVE 'SELECT REGN_PRIC_IND' TO PV-OPERATION-ATTEMPTED 04840000
P11161            PERFORM 9999-SQL-ERROR                                04850000
P11161         END-IF                                                   04851000
P11161     END-IF.                                                      04852000
P11161                                                                  04853000
P11161******************************************************************04854000
P11161* DETERMINE THE TSK REGIONAL PRICE INDICATOR                      04855000
P11161******************************************************************04856000
P11161 7100-SELECT-TSK-REGN-PRIC-IND.                                   04857000
P11161     MOVE '*7100-SELECT-TSK-REGN-PRIC-IND *' TO PV-PARA-NAME.     04858000
P11161                                                                  04859000
P11161     EXEC SQL                                                     04859100
P11161          SELECT A.REGN_PRIC_IND                                  04859200
P11161            INTO :TSK-REGN-PRIC-IND                               04859300
P11161            FROM TSK A                                            04859400
P11161            WHERE A.ITEM_NMBR    = :IM020-ITM-NBR                 04859500
P11161     END-EXEC.                                                    04859600
P11161                                                                  04859700
P11161     IF SQLCODE = 0                                               04859800
P11161        SET PS-REC-FOUND TO TRUE                                  04859966
P11161        IF TSK-REGN-PRIC-IND = 'Y'                                04860100
P11161           PERFORM 7200-SELECT-TUPCPLS                            04860200
P11161        END-IF                                                    04860700
P11161     ELSE                                                         04860800
P11161         IF SQLCODE = +100                                        04860900
P11161            SET PS-REC-NOT-FOUND TO TRUE                          04861066
P11161            ADD 1 TO PA-SKU-NOT-FOUND                             04861100
P11161         ELSE                                                     04861200
P11161            MOVE '7100-SELECT-TSK-REGN-PRIC-IND'                  04861300
P11161                                        TO PV-PARAGRAPH-NAME      04861400
P11161            MOVE 'SELECT REGN_PRIC_IND' TO PV-OPERATION-ATTEMPTED 04861500
P11161            PERFORM 9999-SQL-ERROR                                04861600
P11161         END-IF                                                   04861700
P11161     END-IF.                                                      04861800
P11161                                                                  04861900
P11161******************************************************************04862000
P11161* DETERMINE THE TUPCPLS UPC STATUS CODE IN CORP ROW              *04862100
P11161******************************************************************04862200
P11161 7200-SELECT-TUPCPLS.                                             04862300
P11161     MOVE '*7200-SELECT-TUPCPLS *' TO PV-PARA-NAME.               04862400
P11161                                                                  04862500
P11161     EXEC SQL                                                     04862600
P11161          SELECT 1                                                04862700
P11161          INTO :PV-TUPCPLS                                        04862800
P11161          FROM TUPCPLS                                            04862900
P11161          WHERE UPC_ID = :IM020-INTR-UPC-ID                       04863000
P11161          AND UPC_STAT_CDE = '30'                                 04863100
P11161          AND STR_NBR = 0                                         04863200
P11161          AND EFF_END_TMST IS  NULL                               04863300
P11161     END-EXEC.                                                    04863400
P11161                                                                  04863500
P11161     IF SQLCODE = 0                                               04863600
P11161        SET PS-REC-FOUND TO TRUE                                  04863767
P11161        SET PS-REGIONALLY-PRICED TO TRUE                          04863867
P11161     ELSE                                                         04863900
P11161         IF SQLCODE = +100                                        04864000
P11161            SET PS-REC-NOT-FOUND TO TRUE                          04864167
P11161            ADD 1 TO PA-CORP-ROW-NOT-FOUND                        04864200
P11161         ELSE                                                     04864300
P11161            MOVE '7200-SELECT-TUPCPLS'  TO PV-PARAGRAPH-NAME      04864400
P11161            MOVE 'SELECT TUPCPLS'       TO PV-OPERATION-ATTEMPTED 04864500
P11161            PERFORM 9999-SQL-ERROR                                04864600
P11161         END-IF                                                   04864700
P11161     END-IF.                                                      04864800
P11161                                                                  04864900
048600******************************************************************04865000
048700* WRITE SKU COMPRESSION CANDIDATES RECORDS                       *04870000
048800******************************************************************04880000
048900 8000-WRITE-VALID-SKU-COMPRESSN.                                  04890000
049000     MOVE '*8000-WRITE-VALID-SKU-COMPRESSN *' TO PV-PARA-NAME.    04900000
049100                                                                  04910000
049200     MOVE IM020-INTR-UPC-ID   TO IM036-INTR-UPC-ID.               04920000
049300     MOVE IM020-ITM-NBR       TO IM036-ITM-NBR.                   04930000
049400     MOVE IM020-SKU           TO IM036-SKU.                       04940000
049500                                                                  04950000
049600     WRITE SD-OUTPUT-RECORD FROM IM036-SKU-COMPRESS-CAND-REC.     04960000
049700     ADD +1 TO PA-WRITE-COUNT.                                    04970000
049800                                                                  04980000
049900 9998-ABEND.                                                      04990000
050000                                                                  05000000
050100     CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        05010000
050200                                                                  05020000
050300 9999-SQL-ERROR.                                                  05030000
050400                                                                  05040000
050500     MOVE SQLCODE    TO SQLCODE2.                                 05050000
050600     MOVE SQLERRD(3) TO SQLERRD3.                                 05060000
050700     DISPLAY '** ABEND **       ** = SQLERROR'.                   05070000
050800     DISPLAY '** PROGRAM        ** = IMKUT087'.                   05080000
050900     DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         05090000
051000     DISPLAY '** OPERATION      ** = ' PV-OPERATION-ATTEMPTED.    05100000
051100     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05110000
051200     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05120000
051300     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05130000
051400     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05140000
051500     DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                05150000
051600                                                                  05160000
051700     MOVE SPACES TO WS-MSG-TEXT.                                  05170000
051800*    GET FULL TEXT OF ERROR MESSAGE                               05180000
051900                                                                  05190000
052000     CALL 'SQLGLM' USING WS-MSG-TEXT,                             05200000
052100                         WS-MAX-SIZE,                             05210000
052200                         WS-MSG-LENGTH.                           05220000
052300     DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               05230000
052400                                                                  05240000
P11161     SET PV-ABEND-4013-SQL-ERR TO TRUE.                           05250000
052600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05260000
052700                                                                  05270000
052800*---------------------------------------------------------------* 05280000
052900*    END OF SOURCE CODE FOR IMKUT087                            * 05290000
053000*---------------------------------------------------------------* 05300000
