000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              RCKUP068.                               00020000
000300 AUTHOR.                  DENISE HAHN.                            00030000
000400 DATE-WRITTEN.            MAY 2020.                               00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM READ IN AN INPUT FILE.                            *00080000
000900* THE 1ST RECORD IS "A" - CONTAINS SEASONAL SET YEAR & NAME      *00090000
000910* ONLY 1 'A' RECORD PER FILE                                     *00091000
000913* ALL REMAINING ROWS ARE "B" - AND CONTAIN PO'S TO BE UPDATE TO  *00091300
000914* THAT SEASONAL SET.                                             *00091400
000915*   A RECORD:  AYYYY NNNNN     YYYY=SET YEAR NNNNN=SET NAME      *00091500
000916*   B RECORD:  BPPPPPPPPP      999999999 = 9 DIGIT PO NUMBER     *00091600
000920* INPUT FILE IS CREATED BY RCKUT169.                             *00092000
000922******************************************************************00092200
000923 ENVIRONMENT DIVISION.                                            00092300
000924 CONFIGURATION SECTION.                                           00092400
000925                                                                  00092500
000926 INPUT-OUTPUT SECTION.                                            00092600
000927 FILE-CONTROL.                                                    00092700
000928                                                                  00092800
000929     SELECT INPUT-FILE                                            00092900
000930        ASSIGN TO INP01.                                          00093000
000931                                                                  00093100
000935 DATA DIVISION.                                                   00093500
000936 FILE SECTION.                                                    00093600
000937                                                                  00093700
000938 FD  INPUT-FILE                                                   00093800
000939     RECORDING MODE IS F                                          00093900
000940     LABEL RECORDS ARE STANDARD                                   00094000
000950     RECORD CONTAINS 80 CHARACTERS                                00095002
000960     DATA RECORD IS INPUT-RECORD.                                 00096000
000970                                                                  00097000
000980 01  INPUT-RECORD                PIC X(80).                       00098002
000990                                                                  00099000
001000                                                                  00100000
002000 WORKING-STORAGE SECTION.                                         00200000
002010                                                                  00201000
002020                                                                  00202000
002030 01  PROGRAM-SWITCHES.                                            00203000
002040     05  PS-EOF-INPUT-SW             PIC  X(01)  VALUE 'N'.       00204000
002050         88  PS-EOF-INPUT                        VALUE 'Y'.       00205000
002060         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00206000
002070     05  PS-ERROR-SW                 PIC  X(01)  VALUE 'N'.       00207000
002080         88  PS-ERROR                            VALUE 'Y'.       00208000
002090         88  PS-ERROR-NO                         VALUE 'N'.       00209000
002100                                                                  00210000
002200                                                                  00220000
002300 01  PV-ABEND-FIELDS.                                             00230000
002400     05  PV-ABEND-PROGRAM            PIC X(8)   VALUE 'RCKUP068'. 00240000
002500     05  PV-ABEND-CODE               PIC S9(04)  VALUE +0         00250000
002600                                                 COMP SYNC.       00260000
002700     05  PV-PARAGRAPH-NAME           PIC  X(30)  VALUE SPACES.    00270000
002800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)  VALUE SPACES.    00280000
002900     05  PV-ABEND-PARAGRAPH          PIC  X(30)  VALUE SPACES.    00290000
003000     05  PV-ABEND-OPERATION          PIC  X(30)  VALUE SPACES.    00300000
003100     05  PV-DB2-OPER-ATTEMPTED       PIC  X(30)  VALUE SPACES.    00310000
003200     05  PV-DB2-OPERATION-MESSAGE-1  PIC  X(79)  VALUE SPACES.    00320000
003300     05  PV-DB2-OPERATION-MESSAGE-2  PIC  X(79)  VALUE SPACES.    00330000
003400     05  PV-DB2-OPERATION-MESSAGE-3  PIC  X(79)  VALUE SPACES.    00340000
003500     05  PV-DB2-OPERATION-MESSAGE-4  PIC  X(79)  VALUE SPACES.    00350000
003600     05  PV-SQLCODE                  PIC -Z(03)  VALUE ZERO.      00360000
003700                                                                  00370000
004200 01  PROGRAM-VARIABLES.                                           00420000
004300     05  PV-INPUT-COUNT              PIC  9(09).                  00430000
004400     05  PV-ERROR-COUNT              PIC  9(09).                  00440000
004500     05  PV-UPDATE-COUNT             PIC  9(09).                  00450000
004510     05  PV-COMMIT-COUNT             PIC  9(09).                  00451001
004600     05  PV-DISP-COUNT               PIC ZZZ,ZZZ,ZZ9 VALUE ZEROS. 00460000
004700     05  PV-DISP-SQLCODE             PIC -999        VALUE ZEROS. 00470000
004710     05  PV-SEASET-YR                PIC X(04)       VALUE SPACE. 00471000
004720     05  PV-SEASET-NM                PIC X(05)       VALUE SPACE. 00472000
004800                                                                  00480000
004900 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00490000
005000     88 ABEND-4013                         VALUE +4013.           00500000
005100                                                                  00510000
005200***************************************************************** 00520000
005300*  INPUT FILE                                                   * 00530000
005400*   A RECORD:  AYYYY NNNNN     YYYY=SET YEAR NNNNN=SET NAME     * 00540000
005500*   B RECORD:  BPPPPPPPPP      999999999 = 9 DIGIT PO NUMBER    * 00550000
005600***************************************************************** 00560000
005610 01  INPUT-RECORD-LAYOUT.                                         00561000
005620     05 IR-RECORD-TYPE               PIC   X(01) VALUE SPACES.    00562000
005630        88 IR-SET-INFO                           VALUE 'A'.       00563000
005640        88 IR-PO-INFO                            VALUE 'B'.       00564000
005650     05 IR-RECORD                    PIC   X(79) VALUE SPACES.    00565002
005660     05 IR-SET-RECORD REDEFINES IR-RECORD.                        00566000
005670        10 IR-SEASET-YEAR            PIC   X(04).                 00567000
005680        10 FILLER                    PIC   X(01).                 00568000
005681        10 IR-SEASET-CODE            PIC   X(05).                 00568100
005682        10 FILLER                    PIC   X(69).                 00568202
005683     05 IR-PO-RECORD REDEFINES IR-RECORD.                         00568300
005684        10 IR-PO-NBR                 PIC   9(09).                 00568400
005685        10 FILLER                    PIC   X(70).                 00568502
005686                                                                  00568600
005687***************************************************************** 00568700
005688*    SQL ABEND ROUTINE WORKING STORAGE                          * 00568800
005689***************************************************************** 00568900
005690     COPY DPWS004.                                                00569000
005700                                                                  00570000
005800     EXEC SQL                                                     00580000
005900        INCLUDE TSEASET                                           00590000
006000     END-EXEC.                                                    00600000
006100                                                                  00610000
006200     EXEC SQL                                                     00620000
006300        INCLUDE TPURCHS                                           00630000
006400     END-EXEC.                                                    00640000
006500                                                                  00650000
006600***************************************************************** 00660000
006700*   DB2 SQL COMMUNICATION AREA                                    00670000
006800***************************************************************** 00680000
006900     EXEC SQL                                                     00690000
007000          INCLUDE SQLCA                                           00700000
007100     END-EXEC.                                                    00710000
007200                                                                  00720000
007300                                                                  00730000
007400******************************************************************00740000
007500 PROCEDURE DIVISION.                                              00750000
007600******************************************************************00760000
007700* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     00770000
007800*      PROGRAM.                                                   00780000
007900******************************************************************00790000
008000 0000-PROGRAM-MAINLINE.                                           00800000
008100                                                                  00810000
008200     OPEN INPUT  INPUT-FILE.                                      00820000
008400                                                                  00840000
008500     SET PS-EOF-INPUT-NO                                          00850000
008600         PS-ERROR-NO      TO  TRUE                                00860000
008700                                                                  00870000
008800     PERFORM 1000-INITIALIZE.                                     00880000
008900                                                                  00890000
009000     IF  PS-ERROR-NO                                              00900000
009100         PERFORM 7000-READ-INPUT                                  00910000
009200     END-IF.                                                      00920000
009300                                                                  00930000
009400     IF  PS-ERROR-NO                                              00940000
009500         PERFORM 2000-PROCESS-INPUT                               00950000
009600           UNTIL PS-EOF-INPUT                                     00960000
009700     END-IF.                                                      00970000
009800                                                                  00980000
009810     DISPLAY ' '.                                                 00981006
009900     MOVE PV-INPUT-COUNT    TO  PV-DISP-COUNT.                    00990005
010000     DISPLAY ' INPUT COUNT: '   PV-DISP-COUNT.                    01000005
010100     MOVE PV-ERROR-COUNT    TO  PV-DISP-COUNT.                    01010005
010200     DISPLAY ' ERROR COUNT: '   PV-DISP-COUNT.                    01020005
010300     MOVE PV-UPDATE-COUNT   TO  PV-DISP-COUNT.                    01030005
010400     DISPLAY ' UPDATE COUNT:'   PV-DISP-COUNT.                    01040005
010500                                                                  01050000
010600     CLOSE INPUT-FILE.                                            01060000
010800                                                                  01080000
010900     STOP RUN.                                                    01090000
011000                                                                  01100000
011100***********************************************************       01110000
011200*                                                         *       01120000
011300***********************************************************       01130000
011400 1000-INITIALIZE.                                                 01140000
011500                                                                  01150000
011600     PERFORM 7000-READ-INPUT.                                     01160000
011700                                                                  01170000
011800     IF  PS-EOF-INPUT                                             01180000
011900         SET PS-ERROR       TO  TRUE                              01190000
012000         DISPLAY ' '                                              01200005
012001         DISPLAY '  RCKUP068'                                     01200105
012010         DISPLAY ' NO INPUT FILE'                                 01201005
012020         DISPLAY ' '                                              01202005
012100         ADD  1  TO  PV-ERROR-COUNT                               01210000
012200     ELSE                                                         01220000
012300         IF  IR-SET-INFO                                          01230000
012400             PERFORM 4000-VALIDATE-SET                            01240000
012500         ELSE                                                     01250000
012600             SET PS-ERROR       TO  TRUE                          01260000
012610             DISPLAY ' '                                          01261005
012620             DISPLAY '  RCKUP068'                                 01262005
012700             DISPLAY ' INVALID RECORD TYPE A: '                   01270005
012800                      INPUT-RECORD                                01280005
012810             DISPLAY ' '                                          01281005
012900             ADD  1  TO  PV-ERROR-COUNT                           01290000
013000         END-IF                                                   01300000
013100     END-IF.                                                      01310000
013110                                                                  01311000
013120                                                                  01312000
013130***********************************************************       01313000
013140*                                                         *       01314000
013150***********************************************************       01315000
013160 2000-PROCESS-INPUT.                                              01316000
013170                                                                  01317000
013180     IF  IR-PO-INFO                                               01318000
013190         PERFORM 4010-PO-NBR                                      01319000
013200     ELSE                                                         01320000
013300         SET PS-ERROR       TO  TRUE                              01330000
013400         DISPLAY ' INVALID RECORD TYPE B: '                       01340005
013500                  INPUT-RECORD                                    01350005
013510         DISPLAY ' '                                              01351005
013600         ADD  1  TO  PV-ERROR-COUNT                               01360000
013610     END-IF.                                                      01361000
013620                                                                  01362000
013621     IF  PV-COMMIT-COUNT > 100                                    01362101
013622         PERFORM 8000-COMMIT                                      01362201
013623         MOVE 0 TO PV-COMMIT-COUNT                                01362301
013624     END-IF.                                                      01362401
013625                                                                  01362501
013630     PERFORM 7000-READ-INPUT.                                     01363000
013640                                                                  01364000
013650                                                                  01365000
013660***********************************************************       01366000
013670*                                                         *       01367000
013680***********************************************************       01368000
013690 4000-VALIDATE-SET.                                               01369000
013700     MOVE IR-SEASET-YEAR  TO  SEASET-SEASET-YR.                   01370000
013800     MOVE IR-SEASET-CODE  TO  SEASET-SEASET-SHRT-NM.              01380000
013900                                                                  01390000
014000     EXEC SQL                                                     01400000
014100        SELECT SEASET_TYP_CDE                                     01410000
014200             , SEASET_NM                                          01420000
014300             , SEASET_STAT_CDE                                    01430000
014400          INTO :SEASET-SEASET-TYP-CDE                             01440000
014500             , :SEASET-SEASET-NM                                  01450000
014600             , :SEASET-SEASET-STAT-CDE                            01460000
014700          FROM TSEASET                                            01470000
014800         WHERE SEASET_YR       = :SEASET-SEASET-YR                01480000
014900           AND SEASET_SHRT_NM  = :SEASET-SEASET-SHRT-NM           01490000
015000     END-EXEC.                                                    01500000
015100                                                                  01510000
015200     EVALUATE TRUE                                                01520000
015300         WHEN SQLCODE = ZERO                                      01530000
015400              DISPLAY ' '                                         01540005
015410              DISPLAY ' VALID SEASONAL SET:   '                   01541005
015500                        SEASET-SEASET-YR      '-'                 01550005
015600                        SEASET-SEASET-SHRT-NM                     01560005
015700              DISPLAY ' TYPE:' SEASET-SEASET-TYP-CDE              01570005
015800              DISPLAY ' NAME:' SEASET-SEASET-NM                   01580005
015900              DISPLAY ' STAT:' SEASET-SEASET-STAT-CDE             01590005
016000              DISPLAY ' '                                         01600005
016010              MOVE SEASET-SEASET-YR      TO PV-SEASET-YR          01601005
016020              MOVE SEASET-SEASET-SHRT-NM TO PV-SEASET-NM          01602005
016100                                                                  01610000
016200         WHEN SQLCODE = +100                                      01620000
016300              DISPLAY ' '                                         01630005
016310              DISPLAY ' INVALID SEASONAL SET: '                   01631005
016400                        SEASET-SEASET-YR      '-'                 01640005
016500                        SEASET-SEASET-SHRT-NM                     01650005
016510              DISPLAY ' '                                         01651005
016600              SET PS-ERROR TO TRUE                                01660000
016640                                                                  01664005
016700         WHEN OTHER                                               01670000
016800              MOVE SQLCODE  TO PV-DISP-SQLCODE                    01680000
016900              DISPLAY ' '                                         01690005
016910              DISPLAY ' SQL-ERROR:            '                   01691005
017000                        SEASET-SEASET-YR      '-'                 01700005
017100                        SEASET-SEASET-SHRT-NM                     01710005
017200              DISPLAY ' SQLCODE:' PV-DISP-SQLCODE                 01720005
017210              DISPLAY ' '                                         01721005
017300              SET PS-ERROR TO TRUE                                01730000
017400              MOVE '4000-VALIDATE-SET'  TO PV-ABEND-PARAGRAPH     01740000
017500              MOVE 'SELECT TSEASET'     TO PV-ABEND-OPERATION     01750000
017600              PERFORM 9900-DB2-ABEND                              01760000
017700     END-EVALUATE.                                                01770000
017800                                                                  01780000
017900                                                                  01790000
018000***********************************************************       01800000
018100*                                                         *       01810000
018200***********************************************************       01820000
018300 4010-PO-NBR.                                                     01830000
018400                                                                  01840000
018500     MOVE  IR-PO-NBR   TO  PURCHS-PO-NBR.                         01850000
018600                                                                  01860000
018700     EXEC SQL                                                     01870000
018800        SELECT SEASET_YR                                          01880000
018900             , SEASET_SHRT_NM                                     01890000
019000          INTO :PURCHS-SEASET-YR                                  01900000
019100             , :PURCHS-SEASET-SHRT-NM                             01910000
019200          FROM TPURCHS                                            01920000
019300         WHERE PO_NBR          = :PURCHS-PO-NBR                   01930000
019400           AND VER_STATUS_CDE  = 'A'                              01940000
019500     END-EXEC.                                                    01950000
019600                                                                  01960000
019700     EVALUATE TRUE                                                01970000
019800         WHEN SQLCODE = ZERO                                      01980000
019900              IF  PURCHS-SEASET-YR      > SPACES  OR              01990000
020000                  PURCHS-SEASET-SHRT-NM > SPACES                  02000000
020100                  DISPLAY ' '                                     02010005
020110                  DISPLAY ' ALREADY HAS SET INFO:  '              02011005
020200                            IR-PO-NBR  ':'                        02020005
020300                            PURCHS-SEASET-YR  ' - '               02030005
020400                            PURCHS-SEASET-SHRT-NM                 02040005
020401                          '   SET WILL BE UPDATED '               02040107
020410                  DISPLAY ' '                                     02041005
020800              END-IF                                              02080000
020801                                                                  02080107
020810              PERFORM 5000-UPDATE-PO                              02081007
020900                                                                  02090000
020901         WHEN SQLCODE = +100                                      02090100
020902              DISPLAY ' '                                         02090205
020903              DISPLAY ' INVALID PO NUMBER:    '                   02090305
020904                        IR-RECORD                                 02090405
020905              DISPLAY ' '                                         02090505
020906              ADD  +1  TO  PV-ERROR-COUNT                         02090600
020907         WHEN OTHER                                               02090700
020908              MOVE SQLCODE  TO PV-DISP-SQLCODE                    02090800
020909              DISPLAY ' '                                         02090905
020910              DISPLAY ' SQL-ERROR:            '                   02091005
020911                        IR-RECORD                                 02091105
020912              DISPLAY ' SQLCODE:' PV-DISP-SQLCODE                 02091205
020913              DISPLAY ' '                                         02091305
020914              SET PS-ERROR TO TRUE                                02091400
020915              MOVE '4010-PO-NBR'        TO PV-ABEND-PARAGRAPH     02091500
020916              MOVE 'SELECT TPURCHS'     TO PV-ABEND-OPERATION     02091600
020917              PERFORM 9900-DB2-ABEND                              02091700
020918     END-EVALUATE.                                                02091800
020919                                                                  02091900
020920                                                                  02092000
020921***********************************************************       02092100
020922*                                                         *       02092200
020923***********************************************************       02092300
020924 5000-UPDATE-PO.                                                  02092400
020925     MOVE SEASET-SEASET-YR      TO PURCHS-SEASET-YR.              02092504
020926     MOVE SEASET-SEASET-SHRT-NM TO PURCHS-SEASET-SHRT-NM.         02092603
020927                                                                  02092700
020928     EXEC SQL                                                     02092800
020929        UPDATE TPURCHS                                            02092900
020930           SET SEASET_YR       = :PURCHS-SEASET-YR                02093000
020931             , SEASET_SHRT_NM  = :PURCHS-SEASET-SHRT-NM           02093100
020932         WHERE PO_NBR          = :PURCHS-PO-NBR                   02093200
020933           AND VER_STATUS_CDE  = 'A'                              02093300
020934     END-EXEC.                                                    02093400
020935                                                                  02093500
020936     EVALUATE TRUE                                                02093600
020937         WHEN SQLCODE = ZERO                                      02093700
020938              ADD  +1  TO PV-UPDATE-COUNT                         02093800
020939                          PV-COMMIT-COUNT                         02093900
020947                                                                  02094700
020952         WHEN OTHER                                               02095200
020953              MOVE SQLCODE  TO PV-DISP-SQLCODE                    02095300
020954              DISPLAY ' '                                         02095405
020955              DISPLAY ' SQL-ERROR:          '                     02095505
020956                        IR-RECORD                                 02095605
020957              DISPLAY ' SQLCODE:' PV-DISP-SQLCODE                 02095705
020958              DISPLAY ' '                                         02095805
020959              SET PS-ERROR TO TRUE                                02095900
020960              MOVE '5000-UPDATE-PO'     TO PV-ABEND-PARAGRAPH     02096000
020961              MOVE 'UPDATE TPURCHS'     TO PV-ABEND-OPERATION     02096100
020962              PERFORM 9900-DB2-ABEND                              02096200
020963     END-EVALUATE.                                                02096300
020964                                                                  02096400
020965                                                                  02096500
020966***********************************************************       02096600
020967*                                                         *       02096700
020968***********************************************************       02096800
020969 7000-READ-INPUT.                                                 02096900
020970                                                                  02097000
020971     READ  INPUT-FILE                                             02097100
020972           INTO INPUT-RECORD-LAYOUT                               02097200
020973                AT END                                            02097300
020974                       SET PS-EOF-INPUT TO TRUE                   02097400
020975                NOT AT END                                        02097500
020976                       ADD +1  TO  PV-INPUT-COUNT.                02097600
020977                                                                  02097700
020978                                                                  02097800
020979***********************************************************       02097901
020980*                                                         *       02098001
020981***********************************************************       02098101
020990 8000-COMMIT.                                                     02099001
020991                                                                  02099101
020992     EXEC SQL                                                     02099201
020993          COMMIT                                                  02099301
020994     END-EXEC.                                                    02099401
021000                                                                  02100001
021100                                                                  02110001
021300***********************************************************       02130000
021400*                                                         *       02140000
021500***********************************************************       02150000
021600 9900-DB2-ABEND.                                                  02160000
021700                                                                  02170000
021800     MOVE SQLCODE TO PV-SQLCODE.                                  02180000
021900     DISPLAY '*** DB2 ERROR '.                                    02190000
022000     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02200000
022100     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02210000
022200     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02220000
022300     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02230000
022400     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02240000
022500     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02250000
022600     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02260000
022700                                                                  02270000
022800     COPY DPPD004.                                                02280000
022900                                                                  02290000
023000     IF SQLCODE NOT = -911                                        02300000
023100         EXEC SQL                                                 02310000
023200              ROLLBACK                                            02320000
023300         END-EXEC                                                 02330000
023400     END-IF.                                                      02340000
023500                                                                  02350000
023600     MOVE +4013                  TO PV-ABEND-CODE.                02360000
023700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02370000
023800                                                                  02380000
