000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKUT096.                                00050000
000600 AUTHOR.                 RON KRIER.                               00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            SEPTEMBER, 2003.                         00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100*                                                               * 00110000
001200*  THIS PROGRAM WILL CREATE AN EXTRACT FILE CONTAINING SML'S    * 00120000
001210*  THAT HAVE A DIVERT ENTRY ON THE DIVERT DATABASE (TSUCRDV)    * 00121000
001220*  THAT ARE OLDER THAN X (PARM VALUE) NUMBER OF WEEKS OLD AND   * 00122000
001300*  DO NOT HAVE AN ENTRY ON THE OUTBOUND CARTON DATABASE FOR THE * 00130000
001400*  SML NUMBER.                                                  * 00140000
001420*  THIS EXTRACT FILE WILL THEN BE PASSED INTO SUKUP011 TO       * 00142000
001430*  DELETE THE ENTRIES FROM THE DIVERT DATABASE.                 * 00143000
001440***************************************************************** 00144000
001450***************************************************************** 00145000
001460 ENVIRONMENT DIVISION.                                            00146000
001470***************************************************************** 00147000
001480                                                                  00148000
001490 CONFIGURATION SECTION.                                           00149000
001500                                                                  00150000
001600 SOURCE-COMPUTER.        IBM-3090.                                00160000
001700 OBJECT-COMPUTER.        IBM-3090.                                00170000
001800                                                                  00180000
001900 INPUT-OUTPUT SECTION.                                            00190000
002000                                                                  00200000
002100 FILE-CONTROL.                                                    00210000
002200*                                                                 00220000
002300     SELECT SU-DVRT-EXTRACT-FILE                                  00230000
002400         ASSIGN TO OUT01.                                         00240000
002500*                                                                 00250000
002600***************************************************************** 00260000
002700 DATA DIVISION.                                                   00270000
002800***************************************************************** 00280000
002900*                                                                 00290000
003000 FILE SECTION.                                                    00300000
003100*                                                                 00310000
003200 FD  SU-DVRT-EXTRACT-FILE                                         00320000
003300     RECORDING MODE IS F                                          00330000
003400     BLOCK CONTAINS 0  RECORDS.                                   00340000
003500 01  SU-DVRT-EXTRACT-RECORD          PIC  X(100).                 00350000
003600*                                                                 00360000
003700                                                                  00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900*                                                                 00390000
004000 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00400000
004100                                                   COMP SYNC.     00410000
004200*                                                                 00420000
004300 01  PROGRAM-SWITCHES.                                            00430000
004400     05  PS-EARLY-DIVERT-SW          PIC  X(01)    VALUE 'N'.     00440000
004500         88  PS-EARLY-DIVERT-FOUND                 VALUE 'Y'.     00450000
004600         88  PS-EARLY-DIVERT-NOT-FOUND             VALUE 'N'.     00460000
004610     05  PS-OUTBOUND-CARTON-SW       PIC  X(01)    VALUE 'N'.     00461000
004620         88  PS-OUTBOUND-FOUND                     VALUE 'Y'.     00462000
004630         88  PS-OUTBOUND-NOT-FOUND                 VALUE 'N'.     00463000
004700     05  PS-EOF-DVRT-CURSOR-SW       PIC  X(01)    VALUE 'N'.     00470000
004800         88  PS-EOF-DVRT-CSR                       VALUE 'Y'.     00480000
004900         88  PS-NOT-EOF-DVRT-CSR                   VALUE 'N'.     00490000
004910     05  PS-EOF-DC-CURSOR-SW         PIC  X(01)    VALUE 'N'.     00491000
004920         88  PS-EOF-DC-CSR                         VALUE 'Y'.     00492000
004930         88  PS-NOT-EOF-DC-CSR                     VALUE 'N'.     00493000
005000                                                                  00500000
005100 01  PC-PROGRAM-CONSTANTS.                                        00510000
005200     05  PC-CURRENT-PROGRAM-NAME    PIC  X(08)     VALUE          00520000
005300                                                   'SUKUT096'.    00530000
005400                                                                  00540000
005500 01  PV-PROGRAM-VARIABLES.                                        00550000
005600     05  PV-DISPLAY-PURGE-WEEKS      PIC  Z(09).                  00560000
005700     05  PV-PURGE-TMST               PIC  X(26).                  00570000
005800     05  PV-PURGE-DATE               PIC  X(10).                  00580000
005900                                                                  00590000
006000     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00600000
006100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00610000
006200     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00620000
006300                                                                  00630000
006400     05  PV-SML-FETCH-CNT            PIC  9(09)    VALUE ZERO.    00640000
006600     05  PV-SML-OUTPUT-CNT           PIC  9(09)    VALUE ZERO.    00660000
006800     05  PV-TOTAL-CNT                PIC  9(09)    VALUE ZERO.    00680000
006810     05  PV-DISPLAY-NBR              PIC  9(05)    VALUE ZERO.    00681000
006820     05  PV-DC-CNT                   PIC  9(09)    VALUE ZERO.    00682000
006821     05  PV-DC-CHECK-CNT             PIC  9(09)    VALUE ZERO.    00682107
006830     05  PV-OUTBOUND-CNT             PIC  9(09)    VALUE ZERO.    00683000
006840     05  PV-DIVERT-CHK-CNT           PIC  9(09)    VALUE ZERO.    00684000
006850     05  PV-PURGE-TIMESTAMP.                                      00685003
006860         10  PV-PT-DATE              PIC  X(10).                  00686003
006870         10  PV-PT-TIME              PIC  X(16)    VALUE          00687003
006880             '-00.00.00.000000'.                                  00688003
006900                                                                  00690000
007000 01  DK-DB-KEYS.                                                  00700000
007100     05  DK-PURGE-WEEKS              PIC S9(09)  COMP.            00710000
007110     05  DK-OPER-UNT-ID              PIC S9(04)  COMP.            00711000
007120     05  DK-SHIPT-UNT-ID             PIC S9(18)V COMP-3.          00712000
007130     05  DK-TIMESTAMP                PIC X(26).                   00713003
007200                                                                  00720000
007310 01  SML-EXTRACT-FILE.                                            00731000
007400     COPY SURD049.                                                00740000
007500                                                                  00750000
007600/                                                                 00760000
007700******************************************************************00770000
007800*  DB2 FORMATTED MESSAGE AREA                                     00780000
007900******************************************************************00790000
008000     COPY DPWS004.                                                00800000
008100                                                                  00810000
008200******************************************************************00820000
008300*  COPY BOOK FOR THE LOCATION TABLE                               00830010
008400******************************************************************00840000
008500     EXEC SQL                                                     00850000
008600          INCLUDE XLT00010                                        00860010
008700     END-EXEC.                                                    00870000
008800                                                                  00880000
008810******************************************************************00881001
008820*  COPY BOOK FOR THE PARAMETER TABLE                              00882001
008830******************************************************************00883001
008840     EXEC SQL                                                     00884001
008850          INCLUDE TKRPRPM                                         00885001
008860     END-EXEC.                                                    00886001
008870                                                                  00887001
008900******************************************************************00890000
009000*  COPY BOOK FOR THE CARTON DIVERT TABLE                          00900000
009100******************************************************************00910000
009200     EXEC SQL                                                     00920000
009300          INCLUDE TSUCRDV                                         00930000
009400     END-EXEC.                                                    00940000
009500                                                                  00950000
010300******************************************************************01030000
010400*  COPY BOOK FOR THE OUTBOUND SHIPPING UNIT TABLE                 01040000
010500******************************************************************01050000
010600     EXEC SQL                                                     01060000
010700          INCLUDE SUT00024                                        01070000
010800     END-EXEC.                                                    01080000
010900                                                                  01090000
012400******************************************************************01240000
012500*  DB2 COMMUNICATION AREA                                         01250000
012600******************************************************************01260000
012700     EXEC SQL                                                     01270000
012800         INCLUDE SQLCA                                            01280000
012900     END-EXEC.                                                    01290000
013000                                                                  01300000
013100******************************************************************01310000
013200*  DB2 COMMUNICATION AREA2                                        01320000
013300******************************************************************01330000
013400     COPY SQLCA2.                                                 01340000
013600                                                                  01360000
013610                                                                  01361000
013700     EXEC SQL                                                     01370000
013800       DECLARE DC-CSR CURSOR FOR                                  01380000
013900         SELECT LOC_NBR                                           01390010
014100          FROM  XLT_LOC                                           01410010
014200          WHERE LOC_TYP_CDE = 'DC'                                01420010
014300          ORDER BY LOC_NBR                                        01430010
014400     END-EXEC.                                                    01440000
014500                                                                  01450000
014510                                                                  01451000
014520     EXEC SQL                                                     01452000
014530       DECLARE DVRT-CSR CURSOR FOR                                01453000
014540         SELECT SHIPT_UNT_ID                                      01454000
014550               ,DEST_OPER_UNT_ID                                  01455000
014560          FROM  TSUCRDV                                           01456000
014561          WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                     01456100
014570            AND DIVERT_TMST < :DK-TIMESTAMP                       01457003
014590     END-EXEC.                                                    01459000
014591                                                                  01459100
015600                                                                  01560000
015700*                                                                 01570000
015800 PROCEDURE DIVISION.                                              01580000
015900*                                                                 01590000
016000 0000-MAINLINE-PROCESSING.                                        01600000
016100******************************************************************01610000
016200**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      01620000
016300******************************************************************01630000
016400                                                                  01640000
016500     PERFORM 1000-INITIALIZATION.                                 01650000
016600                                                                  01660000
016700     PERFORM 2000-PROCESS-DC                                      01670000
016800       UNTIL PS-EOF-DC-CSR.                                       01680000
016900                                                                  01690000
017000     PERFORM 2300-CLOSE-DC-CSR.                                   01700000
017100                                                                  01710000
018100     DISPLAY 'TOTAL DIVERTS EXTRACTED ='                          01810000
018110             PV-TOTAL-CNT       '  **'.                           01811000
018200                                                                  01820000
018300     CLOSE SU-DVRT-EXTRACT-FILE.                                  01830000
018400                                                                  01840000
018500     GOBACK.                                                      01850000
018600                                                                  01860000
018700                                                                  01870000
018800 1000-INITIALIZATION.                                             01880000
018900******************************************************************01890000
019000**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               01900000
019100******************************************************************01910000
019200                                                                  01920000
019300     OPEN OUTPUT SU-DVRT-EXTRACT-FILE.                            01930000
019400                                                                  01940000
019500     PERFORM 7000-GET-PURGE-WEEKS.                                01950000
019600                                                                  01960000
019700     DISPLAY '** SUKUT096 **'.                                    01970000
019800     DISPLAY '** PURGE ' PV-DISPLAY-PURGE-WEEKS ' WEEKS **'.      01980000
019900     DISPLAY '** DATE  ' PV-PURGE-DATE.                           01990000
019910                                                                  01991003
019920     MOVE PV-PURGE-DATE       TO  PV-PT-DATE.                     01992003
019930     MOVE PV-PURGE-TIMESTAMP  TO  DK-TIMESTAMP.                   01993003
020000                                                                  02000000
020100     SET  PS-NOT-EOF-DC-CSR                                       02010000
020200          PS-NOT-EOF-DVRT-CSR TO  TRUE.                           02020000
020300                                                                  02030000
020400     PERFORM 2100-OPEN-DC-CSR.                                    02040000
020500     PERFORM 2200-FETCH-DC-CSR.                                   02050000
020600                                                                  02060000
020700                                                                  02070000
020800*                                                                 02080000
020900 2000-PROCESS-DC.                                                 02090000
021000                                                                  02100000
021200     INITIALIZE  SU049-EXTRACT-RECORD.                            02120000
021300                                                                  02130000
021301     SET  PS-NOT-EOF-DVRT-CSR TO  TRUE.                           02130100
021302     MOVE XLT00010-LOC-NBR TO PV-DISPLAY-NBR                      02130210
021303                              DK-OPER-UNT-ID.                     02130310
021304                                                                  02130400
021310     PERFORM 4100-OPEN-DVRT-CSR.                                  02131000
021320     PERFORM 4200-FETCH-DVRT-CSR.                                 02132000
021321     PERFORM 4400-PROCESS-DVRT-CSR                                02132100
021322       UNTIL PS-EOF-DVRT-CSR.                                     02132200
021330     PERFORM 4300-CLOSE-DVRT-CSR.                                 02133000
021340                                                                  02134000
021350     MOVE XLT00010-LOC-NBR TO PV-DISPLAY-NBR.                     02135010
021360     DISPLAY 'NUMBER OF EXTRACT RECORDS FOR DC: '                 02136000
021370             PV-DISPLAY-NBR                                       02137000
021371             ' IS: '                                              02137100
021372             PV-DC-CNT.                                           02137200
021373     DISPLAY 'NUMBER OF DIVERTS DROPPED - OUTBOUND CHECK: '       02137300
021374             PV-DISPLAY-NBR                                       02137400
021375             ' IS: '                                              02137500
021376             PV-OUTBOUND-CNT.                                     02137600
021377     DISPLAY 'NUMBER OF DIVERTS DROPPED - 2ND DIVERT CHECK: '     02137700
021378             PV-DISPLAY-NBR                                       02137800
021379             ' IS: '                                              02137900
021380             PV-DIVERT-CHK-CNT.                                   02138000
021381     DISPLAY '           '.                                       02138105
021382                                                                  02138200
021383     ADD PV-DC-CNT TO PV-TOTAL-CNT.                               02138300
021384     INITIALIZE PV-DC-CNT                                         02138404
021385                PV-DC-CHECK-CNT                                   02138507
021386                PV-OUTBOUND-CNT                                   02138604
021387                PV-DIVERT-CHK-CNT.                                02138704
021388                                                                  02138800
021390     PERFORM 2200-FETCH-DC-CSR.                                   02139000
023500                                                                  02350000
023600                                                                  02360000
023700 2100-OPEN-DC-CSR.                                                02370000
023800     MOVE '2100-OPEN-DC-CSR'    TO PV-ABEND-PARAGRAPH.            02380000
023900                                                                  02390000
024000     EXEC SQL                                                     02400000
024100          OPEN DC-CSR                                             02410000
024200     END-EXEC.                                                    02420000
024300                                                                  02430000
024400     EVALUATE TRUE                                                02440000
024500         WHEN SQLCODE = 0                                         02450000
024600             CONTINUE                                             02460000
024700         WHEN SQLWARN0 NOT = SPACES                               02470000
024800         WHEN SQLCODE < ZERO                                      02480000
024900         WHEN SQLCODE > ZERO                                      02490000
025000             MOVE '2100-OPEN-DC-CSR'                              02500000
025100                             TO PV-PARAGRAPH-NAME                 02510000
025200             MOVE 'OPEN THE DC_CURSOR            '                02520000
025300                             TO PV-DB2-OPERATION-ATTEMPTED        02530000
025400             PERFORM 9100-SQL-ABEND                               02540000
025500     END-EVALUATE.                                                02550000
025600                                                                  02560000
025700                                                                  02570000
025800 2200-FETCH-DC-CSR.                                               02580000
025900     MOVE '2200-FETCH-DC-CSR'   TO PV-ABEND-PARAGRAPH.            02590000
026000                                                                  02600000
026100     EXEC SQL                                                     02610000
026200          FETCH DC-CSR                                            02620000
026300          INTO  :XLT00010-LOC-NBR                                 02630010
026500     END-EXEC.                                                    02650000
026600                                                                  02660000
026700     EVALUATE TRUE                                                02670000
026800       WHEN SQLCODE = ZEROS                                       02680000
026900            CONTINUE                                              02690000
027000       WHEN SQLCODE = +100                                        02700000
027100            SET PS-EOF-DC-CSR  TO TRUE                            02710000
027200       WHEN SQLWARN0 NOT = SPACES                                 02720000
027300       WHEN SQLCODE < ZERO                                        02730000
027400       WHEN SQLCODE > ZERO                                        02740000
027500           MOVE '2200-FETCH-DC-CSR'                               02750000
027600                               TO PV-PARAGRAPH-NAME               02760000
027700           MOVE 'FETCH DC CURSOR '                                02770000
027800                               TO PV-DB2-OPERATION-ATTEMPTED      02780000
027900           PERFORM 9100-SQL-ABEND                                 02790000
028000     END-EVALUATE.                                                02800000
028100                                                                  02810000
028200                                                                  02820000
028300 2300-CLOSE-DC-CSR.                                               02830000
028400     MOVE '2300-CLOSE-DC-CSR'   TO PV-ABEND-PARAGRAPH.            02840000
028500                                                                  02850000
028600     EXEC SQL                                                     02860000
028700         CLOSE DC-CSR                                             02870000
028800     END-EXEC.                                                    02880000
028900                                                                  02890000
029000     EVALUATE TRUE                                                02900000
029100         WHEN SQLCODE = ZERO                                      02910000
029200         WHEN SQLCODE = -904                                      02920000
029300         WHEN SQLCODE = -911                                      02930000
029400              CONTINUE                                            02940000
029500         WHEN SQLWARN0 NOT = SPACES                               02950000
029600         WHEN SQLCODE < ZERO                                      02960000
029700         WHEN SQLCODE > ZERO                                      02970000
029800              MOVE '2300-CLOSE-DC-CSR'                            02980000
029900                              TO PV-PARAGRAPH-NAME                02990000
030000              MOVE 'CLOSE THE DC-CSR              '               03000000
030100                              TO PV-DB2-OPERATION-ATTEMPTED       03010000
030200              PERFORM 9100-SQL-ABEND                              03020000
030300     END-EVALUATE.                                                03030000
030400                                                                  03040000
030500                                                                  03050000
046851 4100-OPEN-DVRT-CSR.                                              04685101
046852     MOVE '4100-OPEN-DVRT-CSR'    TO PV-ABEND-PARAGRAPH.          04685200
046853                                                                  04685300
046854     EXEC SQL                                                     04685400
046855          OPEN DVRT-CSR                                           04685500
046856     END-EXEC.                                                    04685600
046857                                                                  04685700
046858     EVALUATE TRUE                                                04685800
046859         WHEN SQLCODE = 0                                         04685900
046860             CONTINUE                                             04686000
046861         WHEN SQLWARN0 NOT = SPACES                               04686100
046862         WHEN SQLCODE < ZERO                                      04686200
046863         WHEN SQLCODE > ZERO                                      04686300
046864             MOVE '4100-OPEN-DVRT-CSR'                            04686400
046865                             TO PV-PARAGRAPH-NAME                 04686500
046866             MOVE 'OPEN THE DVRT CURSOR'                          04686600
046867                             TO PV-DB2-OPERATION-ATTEMPTED        04686700
046868             PERFORM 9100-SQL-ABEND                               04686800
046869     END-EVALUATE.                                                04686900
046870                                                                  04687000
046871                                                                  04687100
046872 4200-FETCH-DVRT-CSR.                                             04687200
046873     MOVE '4200-FETCH-DVRT-CSR'  TO PV-ABEND-PARAGRAPH.           04687300
046874                                                                  04687400
046875     EXEC SQL                                                     04687500
046876          FETCH DVRT-CSR                                          04687600
046877          INTO  :SUCRDV-SHIPT-UNT-ID                              04687700
046878              , :SUCRDV-OPER-UNT-ID                               04687800
046879     END-EXEC.                                                    04687900
046880                                                                  04688000
046881     EVALUATE TRUE                                                04688100
046882       WHEN SQLCODE = ZEROS                                       04688200
046883            CONTINUE                                              04688300
046884       WHEN SQLCODE = +100                                        04688400
046885            SET PS-EOF-DVRT-CSR TO TRUE                           04688500
046886       WHEN SQLWARN0 NOT = SPACES                                 04688600
046887       WHEN SQLCODE < ZERO                                        04688700
046888       WHEN SQLCODE > ZERO                                        04688800
046889           MOVE '4200-FETCH-DVRT-CSR'                             04688900
046890                               TO PV-PARAGRAPH-NAME               04689000
046891           MOVE 'FETCH DVRT CURSOR'                               04689100
046892                               TO PV-DB2-OPERATION-ATTEMPTED      04689200
046893           PERFORM 9100-SQL-ABEND                                 04689300
046894     END-EVALUATE.                                                04689400
046895                                                                  04689500
046896                                                                  04689600
046897 4300-CLOSE-DVRT-CSR.                                             04689700
046898     MOVE '4300-CLOSE-DVRT-CSR'  TO PV-ABEND-PARAGRAPH.           04689800
046899                                                                  04689900
046900     EXEC SQL                                                     04690000
046901         CLOSE DVRT-CSR                                           04690101
046902     END-EXEC.                                                    04690200
046903                                                                  04690300
046904     EVALUATE TRUE                                                04690400
046905         WHEN SQLCODE = ZERO                                      04690500
046906         WHEN SQLCODE = -904                                      04690600
046907         WHEN SQLCODE = -911                                      04690700
046908              CONTINUE                                            04690800
046909         WHEN SQLWARN0 NOT = SPACES                               04690900
046910         WHEN SQLCODE < ZERO                                      04691000
046911         WHEN SQLCODE > ZERO                                      04691100
046912              MOVE '4300-CLOSE-DVRT-CSR'                          04691200
046913                              TO PV-PARAGRAPH-NAME                04691300
046914              MOVE 'CLOSE THE DVRT CURSOR'                        04691400
046915                              TO PV-DB2-OPERATION-ATTEMPTED       04691500
046916              PERFORM 9100-SQL-ABEND                              04691600
046917     END-EVALUATE.                                                04691700
046918                                                                  04691800
046920 4400-PROCESS-DVRT-CSR.                                           04692000
046921                                                                  04692100
046922     MOVE SUCRDV-SHIPT-UNT-ID    TO  SU049-SML                    04692200
046923                                     SU049-DISPLAY-SML            04692300
046924                                     DK-SHIPT-UNT-ID.             04692402
046925     MOVE SUCRDV-OPER-UNT-ID     TO  SU049-DEST.                  04692500
046926     SET  SU049-PURGE-YES        TO  TRUE.                        04692600
046928                                                                  04692800
046929     SET PS-OUTBOUND-NOT-FOUND TO TRUE.                           04692900
046930     PERFORM 4500-CHECK-OUTBOUND.                                 04693000
046931                                                                  04693100
046932     IF  PS-OUTBOUND-FOUND                                        04693200
046933         CONTINUE                                                 04693300
046934     ELSE                                                         04693400
046935         SET PS-EARLY-DIVERT-NOT-FOUND TO TRUE                    04693500
046936         PERFORM 4600-CHECK-DIVERT                                04693600
046937         IF  PS-EARLY-DIVERT-FOUND                                04693700
046938             CONTINUE                                             04693800
046939         ELSE                                                     04693900
046941             ADD 1 TO PV-DC-CNT                                   04694100
046942                      PV-DC-CHECK-CNT                             04694207
046943             PERFORM 8000-WRITE-EXTRACT-RECORD                    04694300
046948             IF  PV-DC-CHECK-CNT = 100000                         04694809
046949                 INITIALIZE PV-DC-CHECK-CNT                       04694909
046950                 DISPLAY 'EXTRACT CHECK RECORDS FOR DC: '         04695009
046951                 PV-DISPLAY-NBR                                   04695109
046952                 ' IS: '                                          04695209
046953                 PV-DC-CNT                                        04695309
046954                 DISPLAY 'SML IS : '                              04695409
046955                 SU049-DISPLAY-SML                                04695509
046958             END-IF                                               04695809
046959         END-IF                                                   04695908
046960     END-IF.                                                      04696008
046961                                                                  04696108
046962     PERFORM 4200-FETCH-DVRT-CSR.                                 04696208
046963                                                                  04696308
046964                                                                  04696408
046965 4500-CHECK-OUTBOUND.                                             04696508
046966                                                                  04696608
046967     EXEC SQL                                                     04696708
046968         SELECT SHIPT_UNT_ID                                      04696808
046969           INTO :SUT00024-SHIPT-UNT-ID                            04696908
046970           FROM SUT_OTBND_CART                                    04697008
046971          WHERE SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID                 04697108
046972     END-EXEC.                                                    04697200
046973                                                                  04697300
046974     EVALUATE TRUE                                                04697400
046975         WHEN SQLCODE = ZEROS                                     04697500
046976              SET PS-OUTBOUND-FOUND TO TRUE                       04697600
046977              ADD 1 TO PV-OUTBOUND-CNT                            04697700
046978         WHEN SQLCODE = +100                                      04697800
046979              CONTINUE                                            04697900
046980         WHEN SQLWARN0 NOT = SPACES                               04698000
046981         WHEN SQLCODE < ZERO                                      04698100
046982         WHEN SQLCODE > ZERO                                      04698200
046983             MOVE '4500-CHECK-OUTBOUND'                           04698300
046984                             TO PV-PARAGRAPH-NAME                 04698400
046985             MOVE 'GET OUTBOUND CARTON'                           04698500
046986                             TO PV-DB2-OPERATION-ATTEMPTED        04698600
046987             PERFORM 9100-SQL-ABEND                               04698700
046988          WHEN SQLCODE = ZERO                                     04698800
046989              CONTINUE                                            04698900
046990     END-EVALUATE.                                                04699000
046991                                                                  04699100
047000                                                                  04700000
047010 4600-CHECK-DIVERT.                                               04701000
047011                                                                  04701100
047012     EXEC SQL                                                     04701200
047013         SELECT SHIPT_UNT_ID                                      04701300
047014           INTO :SUCRDV-SHIPT-UNT-ID                              04701400
047015           FROM TSUCRDV                                           04701500
047016          WHERE SHIPT_UNT_ID   = :DK-SHIPT-UNT-ID                 04701600
047017            AND DIVERT_TMST >=   :DK-TIMESTAMP                    04701703
047019     END-EXEC.                                                    04701900
047020                                                                  04702000
047021     EVALUATE TRUE                                                04702100
047022         WHEN SQLCODE = ZEROS                                     04702200
047023         WHEN SQLCODE = -811                                      04702306
047024              SET PS-EARLY-DIVERT-FOUND TO TRUE                   04702407
047026              ADD 1 TO PV-DIVERT-CHK-CNT                          04702600
047027         WHEN SQLCODE = +100                                      04702700
047028              CONTINUE                                            04702806
047029         WHEN SQLWARN0 NOT = SPACES                               04702906
047030         WHEN SQLCODE < ZERO                                      04703006
047031         WHEN SQLCODE > ZERO                                      04703106
047032             MOVE '4600-CHECK-DIVERT  '                           04703206
047033                             TO PV-PARAGRAPH-NAME                 04703306
047034             MOVE 'CHECK FOR EARLY DIVERT'                        04703406
047035                             TO PV-DB2-OPERATION-ATTEMPTED        04703506
047036             PERFORM 9100-SQL-ABEND                               04703606
047037          WHEN SQLCODE = ZERO                                     04703706
047038              CONTINUE                                            04703806
047039     END-EVALUATE.                                                04703906
047040                                                                  04704006
047041                                                                  04704106
047042 7000-GET-PURGE-WEEKS.                                            04704206
047043                                                                  04704306
047044     EXEC SQL                                                     04704406
047045         SELECT  FUNC_QTY                                         04704506
047046           INTO :DK-PURGE-WEEKS                                   04704606
047047           FROM TKRPRPM                                           04704706
047048          WHERE LOC_ID            =  90                           04704806
047049            AND INTFC_SYS_CDE     = 'KHL'                         04704906
047050            AND SYS_PRC_FUNC_CDE  = 'OTPURG'                      04705006
047051            AND FUNC_PRC_STAT_CDE = 'AC'                          04705106
047052     END-EXEC.                                                    04705206
047053                                                                  04705306
047054     EVALUATE TRUE                                                04705406
047055         WHEN SQLCODE = ZEROS                                     04705506
047056              MOVE  DK-PURGE-WEEKS  TO  PV-DISPLAY-PURGE-WEEKS    04705606
047057              PERFORM 7100-GET-PURGE-DATE                         04705706
047058         WHEN SQLCODE = +100                                      04705806
047059              CONTINUE                                            04705906
047060         WHEN SQLWARN0 NOT = SPACES                               04706006
047061         WHEN SQLCODE < ZERO                                      04706106
047062         WHEN SQLCODE > ZERO                                      04706206
047063             MOVE '7000-GET-PURGE-WEEKS'                          04706306
047064                             TO PV-PARAGRAPH-NAME                 04706406
047065             MOVE 'GET NUMBER OF WEEKS TO PURGE   '               04706506
047066                             TO PV-DB2-OPERATION-ATTEMPTED        04706606
047067             PERFORM 9100-SQL-ABEND                               04706706
047068     END-EVALUATE.                                                04706806
047069                                                                  04706906
047070                                                                  04707006
047071 7100-GET-PURGE-DATE.                                             04707106
047072                                                                  04707206
047073     EXEC SQL                                                     04707306
047074         SELECT  (CURRENT_DATE -                                  04707406
047075                  (:DK-PURGE-WEEKS * 7) DAYS)                     04707506
047076           INTO :PV-PURGE-DATE                                    04707606
047077           FROM TKRPRPM                                           04707706
047078          WHERE LOC_ID            =  90                           04707806
047079            AND INTFC_SYS_CDE     = 'KHL'                         04707906
047080            AND SYS_PRC_FUNC_CDE  = 'OTPURG'                      04708006
047081            AND FUNC_PRC_STAT_CDE = 'AC'                          04708106
047082     END-EXEC.                                                    04708206
047083                                                                  04708306
047084     EVALUATE TRUE                                                04708406
047085         WHEN SQLCODE = ZEROS                                     04708506
047086         WHEN SQLCODE = +100                                      04708606
047087              CONTINUE                                            04708706
047088         WHEN SQLWARN0 NOT = SPACES                               04708806
047089         WHEN SQLCODE < ZERO                                      04708906
047090         WHEN SQLCODE > ZERO                                      04709006
047091             MOVE '7100-GET-PURGE-DATE '                          04709106
047092                             TO PV-PARAGRAPH-NAME                 04709206
047093             MOVE 'CALCULATE PURGE DATE           '               04709306
047094                             TO PV-DB2-OPERATION-ATTEMPTED        04709406
047095             PERFORM 9100-SQL-ABEND                               04709506
047096     END-EVALUATE.                                                04709606
047097                                                                  04709706
047098                                                                  04709806
047099 8000-WRITE-EXTRACT-RECORD.                                       04709906
047100     WRITE SU-DVRT-EXTRACT-RECORD                                 04710006
047101       FROM SU049-EXTRACT-RECORD.                                 04710106
047102                                                                  04710206
047103                                                                  04710306
047104 9100-SQL-ABEND.                                                  04710406
047105******************************************************************04710506
047106*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04710606
047107*  ERROR OR WARNING CODE OCCURS.                                  04710706
047108******************************************************************04710806
047109     DISPLAY '9100-SQL-ABEND'.                                    04710906
047110     DISPLAY '** ABEND     **'.                                   04711000
047200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04720000
047300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04730000
047400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04740000
047500                                                                  04750000
047600******************************************************************04760000
047700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    04770000
047800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         04780000
047900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     04790000
048000* FORMAT.                                                         04800000
048100******************************************************************04810000
048200     COPY DPPD004.                                                04820000
048300                                                                  04830000
048400     MOVE +4013                  TO ABEND-CODE.                   04840000
048500     CALL 'ILBOABN0' USING ABEND-CODE.                            04850000
048600                                                                  04860000
