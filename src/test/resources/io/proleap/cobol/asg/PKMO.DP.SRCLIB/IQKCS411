000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    IQKCS411.                                         00040001
000500 AUTHOR.        BARB ERTL.                                        00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  DECEMBER 2003.                                    00070001
000800 DATE-COMPILED.                                                   00080001
000900*----------------------------------------------------------------*00090001
001000*    I411 - RECEIPT LOOKUP CRITERIA SPECIFICATION.               *00100001
001100*                                                                *00110001
001200*    THIS SCREEN CAPTURES AND EDITS INFORMATION THAT WILL BE USED*00120001
001300*    TO FIND POS TRANSACTIONS THAT WERE TENDERED WITH A SPECIFIC *00130001
001400*    CREDIT/DEBIT CARD FOR A SPECIFIC UPC.                       *00140001
001500*                                                                *00150001
001600*    BASIC EDITING SUCH AS NUMERIC CHECKS AND DATE/DATE RANGE    *00160001
001700*    CHECKS ARE DONE IN THIS PROGRAM SO THAT THE LIST PROGRAM IT *00170001
001800*    CALLS DOES NOT HAVE TO DO THIS WORK.                        *00180001
001900*----------------------------------------------------------------*00190001
CICS  * CHANGED 11/01/2022    BY JIM HUNTER      WR: CHG0277565         00191034
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00192034
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00193034
CICS  ******************************************************************00194034
002000                                                                  00200001
002100 ENVIRONMENT DIVISION.                                            00210001
002200                                                                  00220001
002300 DATA DIVISION.                                                   00230001
002400                                                                  00240001
002500 WORKING-STORAGE SECTION.                                         00250001
002600*                                                                 00260001
002700 01  PC-PROGRAM-CONSTANTS.                                        00270001
002800     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'IQ411A  '. 00280001
002900     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'IQKM411 '. 00290001
003000     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'IQKCS411'. 00300001
003100     05  PC-TSYMSG-NUMBERS.                                       00310001
003200         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00320003
003300         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00330003
003400         10  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.      00340001
003500         10  PC-TSYMSG-00234       PIC  9(05)  VALUE  00234.      00350001
003600         10  PC-TSYMSG-02394       PIC  9(05)  VALUE  02394.      00360004
003700         10  PC-TSYMSG-03206       PIC  9(05)  VALUE  03206.      00370006
003800                                                                  00380001
003900 01  PS-PROGRAM-SWITCHES.                                         00390001
004000     05  PS-ERROR-SW               PIC X(01)   VALUE 'N'.         00400001
004100         88 PS-ERROR                           VALUE 'Y'.         00410001
004200         88 PS-NO-ERROR                        VALUE 'N'.         00420001
004300     05  PS-KOHLS-CARD-LENGTH      PIC X(01)   VALUE SPACES.      00430001
004400         88  PS-10-DIGIT-KOHLS-CARD            VALUE '0'.         00440001
004500         88  PS-12-DIGIT-KOHLS-CARD            VALUE '2'.         00450001
004600                                                                  00460001
004700 01  PM-PROGRAM-MESSAGES.                                         00470001
004800     05  PM-ABEND-INFO-A.                                         00480001
004900         10  FILLER                PIC X(15)   VALUE              00490001
005000                                   'DP020-SRC-AID: '.             00500001
005100         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00510001
005200         10  FILLER                PIC X(19)   VALUE              00520001
005300                                   '. DP020-FK-ACTION: '.         00530001
005400         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00540001
005500         10  FILLER                PIC X(22)   VALUE              00550001
005600                                   '. DP020-FK-DISPN-IND: '.      00560001
005700         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00570001
005800         10  FILLER                PIC X(01)   VALUE '.'.         00580001
005900         10  FILLER                PIC X(19)   VALUE SPACE.       00590001
006000                                                                  00600001
006100*----------------------------------------------------------------*00610001
006200*    MAP LAYOUT                                                  *00620001
006300*----------------------------------------------------------------*00630001
006400     COPY IQKM411.                                                00640001
006500                                                                  00650001
006600*----------------------------------------------------------------*00660001
006700*    ATTRIBUTE SETTINGS COPYBOOK.                                *00670001
006800*----------------------------------------------------------------*00680001
006900     COPY DPWS015.                                                00690001
007000                                                                  00700001
007100*----------------------------------------------------------------*00710001
007200*    KOHL'S CALENDAR ROUTINE COPYBOOK                            *00720001
007300*----------------------------------------------------------------*00730001
007400     COPY DPWS500.                                                00740001
007500                                                                  00750001
007600*----------------------------------------------------------------*00760001
007700*    FUNCTION KEYS COPYBOOK                                      *00770001
007800*----------------------------------------------------------------*00780001
007900     COPY DPWS016.                                                00790001
008000                                                                  00800001
008100******************************************************************00810001
008200** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **00820001
008300** SUB-ROUTINE (DPKUT100).                                      **00830001
008400******************************************************************00840001
008500     COPY DPWS010I.                                               00850001
008600                                                                  00860001
008700******************************************************************00870001
008800** THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS            **00880001
008900** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **00890001
009000******************************************************************00900001
009100     COPY DPWS030.                                                00910001
CICS       COPY DPWS930.                                                00911034
009200***************************************************************** 00920001
009300*    STANDARD COMMAREA.                                           00930001
009400***************************************************************** 00940001
009500                                                                  00950001
009600     COPY DPWS020.                                                00960001
009700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00970001
009800                                                                  00980001
009900***************************************************************** 00990001
010000*    INTER-APPLICATION COMMAREA.                                  01000001
010100***************************************************************** 01010001
010200                                                                  01020001
010300         10  INTER-APPL-COMM-AREA PIC X(200).                     01030001
010400     COPY IQWS002.                                                01040001
010500***************************************************************** 01050001
010600*    SPECIFIC COMMMAREA FOR IQKCS411.                             01060001
010700***************************************************************** 01070001
010800         10  ASC-SPECIFIC-COMMAREA.                               01080001
010900             15  ASC-SALES-DATE-MONTH        PIC  X(02).          01090008
011000             15  ASC-SALES-DATE-MONTH-N REDEFINES                 01100008
011100                 ASC-SALES-DATE-MONTH        PIC  9(02).          01110008
011200             15  ASC-SALES-DATE-YEAR         PIC  X(04).          01120008
011300             15  ASC-SALES-DATE-YEAR-N REDEFINES                  01130008
011400                 ASC-SALES-DATE-YEAR         PIC  9(04).          01140009
011500             15  ASC-SALES-DATE-FROM-ISO     PIC  X(10).          01150008
011600             15  ASC-SALES-DATE-TO-ISO.                           01160008
011700                 20  FILLER                  PIC  X(08).          01170008
011800                 20  ASC-SALES-DATE-TO-DD    PIC  X(02).          01180008
011900             15  ASC-SALES-DATE-YYYYMMDD.                         01190009
012000                 20  ASC-SALES-DATE-YYYY     PIC  X(04).          01200008
012100                 20  ASC-SALES-DATE-MM       PIC  X(02).          01210008
012200                 20  ASC-SALES-DATE-DD       PIC  X(02).          01220008
012300             15  ASC-STORE                   PIC  X(04).          01230001
012400             15  ASC-STORE-N REDEFINES ASC-STORE                  01240001
012500                                             PIC  9(04).          01250001
012600             15  ASC-ACCOUNT-NBR             PIC  X(12).          01260012
012700             15  ASC-ACCOUNT-NBR-SPLIT REDEFINES                  01270032
012800                   ASC-ACCOUNT-NBR.                               01280033
012900                 20  ASC-ACCOUNT-NBR-10      PIC  X(10).          01290032
013000                 20  ASC-ACCOUNT-NBR-2       PIC  X(02).          01300032
013100             15  ASC-ACCOUNT-NBR-N           PIC  9(12).          01310032
013200             15  ASC-UPC-NUMBER              PIC  X(15).          01320001
013300             15  ASC-UPC-NUMBER-N REDEFINES ASC-UPC-NUMBER        01330001
013400                                             PIC  9(15).          01340001
013500         10  FILLER                          PIC  X(2788).        01350033
013600                                                                  01360001
013700*----------------------------------------------------------------*01370001
013800*    CURRENT DATE/TIME COPYBOOK                                  *01380001
013900*----------------------------------------------------------------*01390001
014000     COPY DPWS017.                                                01400001
014100                                                                  01410001
014200*----------------------------------------------------------------*01420001
014300*    ABEND PROCESSING COPYBOOK.                                  *01430001
014400*----------------------------------------------------------------*01440001
014500                                                                  01450001
014600     COPY DPWS013.                                                01460001
014700                                                                  01470001
014800 LINKAGE SECTION.                                                 01480001
014900                                                                  01490001
015000 01  DFHCOMMAREA.                                                 01500001
015100     05  FILLER                         OCCURS  1 TO 4072 TIMES   01510001
015200                                        DEPENDING ON EIBCALEN.    01520001
015300         10  FILLER                     PIC X.                    01530001
015400                                                                  01540001
015500                                                                  01550001
015600 PROCEDURE DIVISION.                                              01560001
015700***************************************************************** 01570001
015800** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01580001
015900** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01590001
016000** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01600001
016100**                                                             ** 01610001
016200** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01620001
016300** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01630001
016400***************************************************************** 01640001
016500 0000-MAIN-MODULE.                                                01650001
016600     INITIALIZE DP030-CICS-API-FIELDS.                            01660001
016700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01670001
016800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01680001
016900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01690001
017000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01700001
017100     MOVE LENGTH OF IQ411AI        TO DP030-MAP-LENGTH (1).       01710001
017200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01720001
017300     PERFORM 0001-CALL-CICS-ARCH-API.                             01730001
017400*                                                                 01740001
017500     PERFORM 1000-CONTROL-PROCESSING                              01750001
017600*                                                                 01760001
017700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01770001
017800     PERFORM 0001-CALL-CICS-ARCH-API.                             01780001
017900                                                                  01790001
018000 0001-CALL-CICS-ARCH-API.                                         01800001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      01810034
018200                                    DFHCOMMAREA                   01820034
018300                                    DP030-CICS-API-FIELDS         01830034
018400                                    DP020-STANDARD-COMMAREA       01840034
018500                                    IQ411AI.                      01850034
018600*                                                                 01860001
018700     IF  DP030-RC-CALL-SUCCESSFUL                                 01870001
018800         CONTINUE                                                 01880001
018900     ELSE                                                         01890001
019000         SET DP013-NO-ROLLBACK                                    01900001
019100             DP013-XCTL-DISPLAY-RESTART                           01910001
019200             DP013-CICS-ABEND      TO TRUE                        01920001
019300         MOVE 'BEFORE 0000-MAIN-MODULE'                           01930001
019400                                   TO DP013-PARAGRAPH             01940001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O01941034
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      01942034
019700         MOVE DP030-RETURN-CODE                                   01970001
019800                                   TO DP013-MESSAGE-TEXT (3)      01980001
019900         PERFORM DP013-0000-PROCESS-ABEND                         01990001
020000     END-IF.                                                      02000001
020100                                                                  02010001
020200*----------------------------------------------------------------*02020001
020300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02030001
020400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02040001
020500*----------------------------------------------------------------*02050001
020600                                                                  02060001
020700 1000-CONTROL-PROCESSING.                                         02070001
020800                                                                  02080001
020900     EVALUATE TRUE                                                02090001
021000         WHEN DP020-NEXT-ACT-INITIAL                              02100001
021100             INITIALIZE ASC-SPECIFIC-COMMAREA                     02110001
021200             PERFORM 4000-BUILD-INITIAL-PANEL                     02120001
021300                                                                  02130001
021400         WHEN DP020-NEXT-ACT-READ-MAP                             02140001
021500             PERFORM 2000-FKEY-PROCESSING                         02150001
021600                                                                  02160001
021700         WHEN DP020-NEXT-ACT-RETURN                               02170001
021800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02180001
021900             SET DP030-SET-CURSOR-APPL-1   TO TRUE                02190031
022000             MOVE -1                       TO ACSRPOSL            02200031
022100                                                                  02210001
022200         WHEN OTHER                                               02220001
022300             SET DP013-LOGIC-ABEND                                02230001
022400                 DP013-NO-ROLLBACK TO TRUE                        02240001
022500             MOVE '1000-CONTROL-PROCESSING'                       02250001
022600                                   TO  DP013-PARAGRAPH            02260001
022700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02270001
022800                                   TO  DP013-MESSAGE-TEXT(1)      02280001
022900             MOVE DP020-NEXT-APPL-ACTIVITY                        02290001
023000                                   TO DP013-MESSAGE-TEXT(2)       02300001
023100             PERFORM DP013-0000-PROCESS-ABEND                     02310001
023200     END-EVALUATE.                                                02320001
023300                                                                  02330001
023400*----------------------------------------------------------------*02340001
023500* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02350001
023600* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02360001
023700* EDITS.                                                         *02370001
023800*----------------------------------------------------------------*02380001
023900                                                                  02390001
024000 2000-FKEY-PROCESSING.                                            02400001
024100                                                                  02410001
024200     EVALUATE TRUE                                                02420001
024300                                                                  02430001
024400         WHEN DP020-SRC-AID = DP016-CLEAR                         02440001
024500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02450001
024600                                                                  02460001
024700         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02470001
024800             INITIALIZE ASC-SPECIFIC-COMMAREA                     02480001
024900             PERFORM 4000-BUILD-INITIAL-PANEL                     02490001
025000             PERFORM 3200-RESET-ATTRIBUTES                        02500001
025100                                                                  02510001
025200         WHEN OTHER                                               02520001
025300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02530001
025400             IF  PS-NO-ERROR                                      02540001
025500                 SET DP030-CONTINUE-GO TO TRUE                    02550001
025600                 PERFORM 2100-CHECK-FUNCTION-KEY                  02560001
025700             ELSE                                                 02570001
025800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02580001
025900                 SET DP030-OVERRIDE-GO TO TRUE                    02590001
026000             END-IF                                               02600001
026100     END-EVALUATE.                                                02610001
026200******************************************************************02620001
026300** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02630001
026400** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02640001
026500** FROM THE CICS ARCHITECTURE API.                              **02650001
026600******************************************************************02660001
026700 2100-CHECK-FUNCTION-KEY.                                         02670001
026800     EVALUATE TRUE                                                02680001
026900                                                                  02690001
027000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              02700001
027100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02710023
027200             IF  PS-NO-ERROR                                      02720024
027300                 PERFORM 2110-PREPARE-INTER-APPL-COMM             02730024
027400             ELSE                                                 02740024
027500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02750024
027600                 SET DP030-OVERRIDE-GO TO TRUE                    02760024
027700             END-IF                                               02770024
027800                                                                  02780001
027900         WHEN DP020-SRC-AID = DP016-ENTER                         02790001
028000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02800025
028100             IF  PS-NO-ERROR                                      02810025
028200                 CONTINUE                                         02820025
028300             ELSE                                                 02830025
028400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02840025
028500                 SET DP030-OVERRIDE-GO TO TRUE                    02850025
028600             END-IF                                               02860025
028700                                                                  02870023
028800         WHEN OTHER                                               02880001
028900             SET DP013-NO-ROLLBACK                                02890001
029000                 DP013-XCTL-DISPLAY-RESTART                       02900001
029100                 DP013-CICS-ABEND  TO TRUE                        02910001
029200             MOVE '2100-CHECK-FUNCTION-KEY'                       02920001
029300                                   TO DP013-PARAGRAPH             02930001
029400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02940001
029500                                   TO DP013-MESSAGE-TEXT (1)      02950001
029600             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 02960001
029700                                   TO DP013-MESSAGE-TEXT (2)      02970001
029800             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                02980001
029900             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 02990001
030000                                   TO PM-A-FK-ACTION              03000001
030100             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              03010001
030200                                   TO PM-A-FK-DISPN               03020001
030300             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      03030001
030400             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        03040001
030500                                   TO DP013-MESSAGE-TEXT (4)      03050001
030600             PERFORM DP013-0000-PROCESS-ABEND                     03060001
030700     END-EVALUATE.                                                03070001
030800******************************************************************03080001
030900** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **03090001
031000** INTER-APPLICATION COMMAREA.                                  **03100001
031100******************************************************************03110001
031200 2110-PREPARE-INTER-APPL-COMM.                                    03120001
031300                                                                  03130001
031400     INITIALIZE IQ002-INTER-APPL-COMMAREA.                        03140001
031500     MOVE ASC-SALES-DATE-FROM-ISO  TO IQ002-SALES-DATE-FROM.      03150008
031600     MOVE ASC-SALES-DATE-TO-ISO    TO IQ002-SALES-DATE-TO.        03160009
031700                                                                  03170001
031800     IF ASC-STORE                  NUMERIC                        03180001
031900         MOVE ASC-STORE-N          TO IQ002-STORE                 03190001
032000     END-IF.                                                      03200001
032100                                                                  03210001
032200     IF ASC-ACCOUNT-NBR            > SPACES                       03220019
032300         MOVE ASC-ACCOUNT-NBR      TO IQ002-TENDER-ID             03230019
032400     END-IF.                                                      03240001
032500                                                                  03250001
032600     IF ASC-UPC-NUMBER             NUMERIC                        03260001
032700         MOVE ASC-UPC-NUMBER-N     TO IQ002-UPC-NBR               03270001
032800     END-IF.                                                      03280001
032900                                                                  03290001
033000*----------------------------------------------------------------*03300001
033100* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*03310001
033200* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *03320001
033300* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *03330001
033400*----------------------------------------------------------------*03340001
033500 2200-MOVE-SCREEN-TO-COMMAREA.                                    03350001
033600                                                                  03360001
033700     IF  ASLSMML > ZERO                                           03370015
033800         MOVE ASLSMMI             TO ASC-SALES-DATE-MONTH         03380015
033900                                     ASC-SALES-DATE-MM            03390015
034000     ELSE                                                         03400015
034100         IF  (ASLSMMF = DP015-ERASE-EOF) OR                       03410015
034200             (ASLSMMI = SPACE)                                    03420015
034300             MOVE SPACE           TO ASC-SALES-DATE-MONTH         03430015
034400                                     ASC-SALES-DATE-MM            03440015
034500         END-IF                                                   03450015
034600     END-IF.                                                      03460015
034700                                                                  03470001
034800     IF  ASLSYRL > ZERO                                           03480015
034900         MOVE ASLSYRI             TO ASC-SALES-DATE-YEAR          03490015
035000                                     ASC-SALES-DATE-YYYY          03500015
035100     ELSE                                                         03510015
035200         IF  (ASLSYRF = DP015-ERASE-EOF) OR                       03520015
035300             (ASLSYRI = SPACE)                                    03530015
035400             MOVE SPACE           TO ASC-SALES-DATE-YEAR          03540015
035500                                     ASC-SALES-DATE-YYYY          03550015
035600         END-IF                                                   03560015
035700     END-IF.                                                      03570015
035800                                                                  03580015
035900     MOVE '01'                    TO ASC-SALES-DATE-DD.           03590015
036000                                                                  03600008
036100     IF  ASTOREL > ZERO                                           03610015
036200         MOVE ASTOREI             TO ASC-STORE                    03620015
036300     ELSE                                                         03630015
036400         IF  (ASTOREF = DP015-ERASE-EOF) OR                       03640015
036500             (ASTOREI = SPACE)                                    03650015
036600             MOVE SPACE           TO ASC-STORE                    03660015
036700         END-IF                                                   03670015
036800     END-IF.                                                      03680015
036900                                                                  03690015
037000     IF  ATNDNBRL > ZERO                                          03700015
037100         MOVE ATNDNBRI            TO ASC-ACCOUNT-NBR              03710015
037200         IF ASC-ACCOUNT-NBR-2 = SPACES                            03720032
037300             MOVE '00' TO ASC-ACCOUNT-NBR-2                       03730032
037400         END-IF                                                   03740032
037500     ELSE                                                         03750015
037600         IF  (ATNDNBRF = DP015-ERASE-EOF) OR                      03760015
037700             (ATNDNBRI = SPACE)                                   03770015
037800             MOVE SPACE           TO ASC-ACCOUNT-NBR              03780015
037900         END-IF                                                   03790015
038000     END-IF.                                                      03800015
038100                                                                  03810015
038200     IF  AUPCL > ZERO                                             03820015
038300         MOVE AUPCI               TO ASC-UPC-NUMBER               03830015
038400     ELSE                                                         03840015
038500         IF  (AUPCF = DP015-ERASE-EOF) OR                         03850015
038600             (AUPCI = SPACE)                                      03860015
038700             MOVE SPACE           TO ASC-UPC-NUMBER               03870015
038800         END-IF                                                   03880015
038900     END-IF.                                                      03890015
039000                                                                  03900001
039100*----------------------------------------------------------------*03910001
039200* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *03920001
039300* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *03930001
039400* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*03940001
039500* IN THE DESTINATION PROGRAM, NOT HERE.                          *03950001
039600*----------------------------------------------------------------*03960001
039700                                                                  03970001
039800 3000-EDIT-DATA-IN-COMMAREA.                                      03980001
039900                                                                  03990001
040000     PERFORM 3200-RESET-ATTRIBUTES.                               04000001
040100                                                                  04010001
040200     IF DP020-SRC-AID = DP016-ENTER                               04020027
040300         IF ASC-ACCOUNT-NBR > SPACES                              04030027
040400             IF ASC-UPC-NUMBER > SPACES                           04040027
040500                 MOVE -1                     TO ASTOREL           04050027
040600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04060027
040700             ELSE                                                 04070027
040800                 MOVE -1                     TO ACSRUPCL          04080027
040900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04090027
041000             END-IF                                               04100027
041100         ELSE                                                     04110027
041200             MOVE -1                     TO ACSRPOSL              04120027
041300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04130027
041400         END-IF                                                   04140027
041500     ELSE                                                         04150027
041600*  THE TENDER ACCOUNT NUMBER MUST BE NUMERIC                      04160025
041700                                                                  04170025
041800         IF  ASC-ACCOUNT-NBR           > SPACES                   04180027
041900             MOVE ASC-ACCOUNT-NBR                                 04190027
042000                                       TO DP010I-UNEDITED-FIELD   04200027
042100             MOVE LENGTH OF ASC-ACCOUNT-NBR                       04210027
042200                                       TO DP010I-MAXIMUM-DIGITS   04220027
042300             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 04230027
042400             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              04240027
042500             CALL DP010I-NUMERIC-EDIT-ROUTINE USING               04250027
042600               DP010I-NUMERIC-EDIT-AREA                           04260027
042700             IF  DP010I-ERROR-DETECTED                            04270027
042800                 SET PS-ERROR                                     04280027
042900                     DP020-MSG-FATAL   TO TRUE                    04290027
043000                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        04300027
043100                 MOVE DP015-UNP-ALP-BRT-OFF                       04310027
043200                                       TO ATNDNBRA                04320027
043300                 MOVE DP015-RED        TO ATNDNBRC                04330027
043400                 MOVE DP015-REVERSE    TO ATNDNBRH                04340027
043500                 MOVE -1               TO ACSRPOSL                04350027
043600                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04360027
043700             ELSE                                                 04370027
043800                 MOVE DP010I-NUM-FIELD-13-DIG-4-DEC               04380027
043900                                       TO ASC-ACCOUNT-NBR-N       04390027
044000             END-IF                                               04400027
044100         ELSE                                                     04410027
044200             SET PS-ERROR                                         04420027
044300                 DP020-MSG-FATAL   TO TRUE                        04430027
044400             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            04440027
044500             MOVE DP015-UNP-ALP-BRT-OFF  TO ATNDNBRA              04450027
044600             MOVE DP015-RED              TO ATNDNBRC              04460027
044700             MOVE DP015-REVERSE          TO ATNDNBRH              04470027
044800             MOVE -1                     TO ACSRPOSL              04480027
044900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04490027
045000         END-IF                                                   04500027
045100                                                                  04510025
045200*   THE UPC NUMBER MUST BE NUMERIC                                04520001
045300                                                                  04530001
045400         IF  ASC-UPC-NUMBER            > SPACES                   04540027
045500             MOVE ASC-UPC-NUMBER       TO DP010I-UNEDITED-FIELD   04550027
045600             MOVE LENGTH OF ASC-UPC-NUMBER                        04560027
045700                                       TO DP010I-MAXIMUM-DIGITS   04570027
045800             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 04580027
045900             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              04590027
046000             CALL DP010I-NUMERIC-EDIT-ROUTINE USING               04600027
046100               DP010I-NUMERIC-EDIT-AREA                           04610027
046200             IF  DP010I-ERROR-DETECTED                            04620027
046300                 SET PS-ERROR                                     04630027
046400                     DP020-MSG-FATAL   TO TRUE                    04640027
046500                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        04650027
046600                 MOVE DP015-UNP-ALP-BRT-OFF                       04660027
046700                                       TO AUPCA                   04670027
046800                 MOVE DP015-RED        TO AUPCC                   04680027
046900                 MOVE DP015-REVERSE    TO AUPCH                   04690027
047000                 MOVE -1               TO ACSRUPCL                04700027
047100                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              04710027
047200             ELSE                                                 04720027
047300                 MOVE DP010I-NUM-FIELD-15-DIG-2-DEC               04730027
047400                                       TO ASC-UPC-NUMBER-N        04740027
047500             END-IF                                               04750027
047600         ELSE                                                     04760027
047700             SET PS-ERROR                                         04770027
047800                 DP020-MSG-FATAL   TO TRUE                        04780027
047900             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            04790027
048000             MOVE DP015-UNP-ALP-BRT-OFF  TO AUPCA                 04800027
048100             MOVE DP015-RED              TO AUPCC                 04810027
048200             MOVE DP015-REVERSE          TO AUPCH                 04820027
048300             MOVE -1                     TO ACSRUPCL              04830027
048400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  04840027
048500         END-IF                                                   04850027
048600                                                                  04860001
048700*  THE STORE NUMBER MUST BE NUMERIC                               04870001
048800                                                                  04880001
048900         IF  ASC-STORE > SPACE                                    04890027
049000              MOVE ASC-STORE            TO DP010I-UNEDITED-FIELD  04900027
049100             MOVE LENGTH OF ASC-STORE  TO DP010I-MAXIMUM-DIGITS   04910027
049200             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 04920027
049300             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              04930027
049400             CALL DP010I-NUMERIC-EDIT-ROUTINE USING               04940027
049500               DP010I-NUMERIC-EDIT-AREA                           04950027
049600             IF  DP010I-ERROR-DETECTED                            04960027
049700                 SET PS-ERROR                                     04970027
049800                     DP020-MSG-FATAL   TO TRUE                    04980027
049900                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        04990027
050000                 MOVE DP015-UNP-ALP-BRT-OFF                       05000027
050100                                       TO ASTOREA                 05010027
050200                 MOVE DP015-RED        TO ASTOREC                 05020027
050300                 MOVE DP015-REVERSE    TO ASTOREH                 05030027
050400                 MOVE -1               TO ASTOREL                 05040027
050500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05050027
050600             ELSE                                                 05060027
050700                 MOVE DP010I-NUMERIC-FIELD                        05070027
050800                                       TO ASC-STORE-N             05080027
050900             END-IF                                               05090027
051000         ELSE                                                     05100027
051100             SET PS-ERROR                                         05110027
051200                 DP020-MSG-FATAL   TO TRUE                        05120027
051300             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            05130027
051400             MOVE DP015-UNP-ALP-BRT-OFF  TO ASTOREA               05140027
051500             MOVE DP015-RED              TO ASTOREC               05150027
051600             MOVE DP015-REVERSE          TO ASTOREH               05160027
051700             MOVE -1                     TO ASTOREL               05170027
051800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05180027
051900         END-IF                                                   05190027
052000                                                                  05200001
052100*  THE YEAR MUST BE NUMERIC                                       05210008
052200                                                                  05220001
052300         IF  ASC-SALES-DATE-YEAR > SPACE                          05230027
052400             MOVE ASC-SALES-DATE-YEAR TO DP010I-UNEDITED-FIELD    05240027
052500             MOVE LENGTH OF ASC-SALES-DATE-YEAR                   05250027
052600                                       TO DP010I-MAXIMUM-DIGITS   05260027
052700             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 05270027
052800             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              05280027
052900             CALL DP010I-NUMERIC-EDIT-ROUTINE USING               05290027
053000               DP010I-NUMERIC-EDIT-AREA                           05300027
053100             IF  DP010I-ERROR-DETECTED                            05310027
053200                 SET PS-ERROR                                     05320027
053300                     DP020-MSG-FATAL   TO TRUE                    05330027
053400                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        05340027
053500                 MOVE DP015-UNP-ALP-BRT-OFF                       05350027
053600                                       TO ASLSYRA                 05360027
053700                 MOVE DP015-RED        TO ASLSYRC                 05370027
053800                 MOVE DP015-REVERSE    TO ASLSYRH                 05380027
053900                 MOVE -1               TO ASLSYRL                 05390027
054000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05400027
054100             ELSE                                                 05410027
054200                 MOVE DP010I-NUMERIC-FIELD                        05420027
054300                                       TO ASC-SALES-DATE-YEAR-N   05430027
054400                 MOVE ASC-SALES-DATE-YEAR TO ASC-SALES-DATE-YYYY  05440027
054500             END-IF                                               05450027
054600         ELSE                                                     05460027
054700             SET PS-ERROR                                         05470027
054800                 DP020-MSG-FATAL         TO TRUE                  05480027
054900             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      05490027
055000             MOVE DP015-UNP-ALP-BRT-OFF  TO ASLSYRA               05500027
055100             MOVE DP015-RED              TO ASLSYRC               05510027
055200             MOVE DP015-REVERSE          TO ASLSYRH               05520027
055300             MOVE -1                     TO ASLSYRL               05530027
055400             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05540027
055500         END-IF                                                   05550027
055600                                                                  05560001
055700*   THE MONTH MUST BE NUMERIC                                     05570008
055800                                                                  05580001
055900         IF  ASC-SALES-DATE-MONTH > SPACE                         05590027
056000             MOVE ASC-SALES-DATE-MONTH                            05600027
056100                                       TO DP010I-UNEDITED-FIELD   05610027
056200             MOVE LENGTH OF ASC-SALES-DATE-MONTH                  05620027
056300                                       TO DP010I-MAXIMUM-DIGITS   05630027
056400             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 05640027
056500             SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE              05650027
056600             CALL DP010I-NUMERIC-EDIT-ROUTINE USING               05660027
056700               DP010I-NUMERIC-EDIT-AREA                           05670027
056800             IF  DP010I-ERROR-DETECTED                            05680027
056900                 SET PS-ERROR                                     05690027
057000                     DP020-MSG-FATAL   TO TRUE                    05700027
057100                 MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER        05710027
057200                 MOVE DP015-UNP-ALP-BRT-OFF                       05720027
057300                                       TO ASLSMMA                 05730027
057400                 MOVE DP015-RED        TO ASLSMMC                 05740027
057500                 MOVE DP015-REVERSE    TO ASLSMMH                 05750027
057600                 MOVE -1               TO ASLSMML                 05760027
057700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              05770027
057800             ELSE                                                 05780027
057900                 MOVE DP010I-NUMERIC-FIELD                        05790027
058000                                       TO ASC-SALES-DATE-MONTH-N  05800027
058100                 MOVE ASC-SALES-DATE-MONTH TO ASC-SALES-DATE-MM   05810027
058200             END-IF                                               05820027
058300         ELSE                                                     05830027
058400             SET PS-ERROR                                         05840027
058500                 DP020-MSG-FATAL         TO TRUE                  05850027
058600             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      05860027
058700             MOVE DP015-UNP-ALP-BRT-OFF  TO ASLSMMA               05870027
058800             MOVE DP015-RED              TO ASLSMMC               05880027
058900             MOVE DP015-REVERSE          TO ASLSMMH               05890027
059000             MOVE -1                     TO ASLSMML               05900027
059100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  05910027
059200         END-IF                                                   05920027
059300                                                                  05930001
059400         IF PS-NO-ERROR                                           05940028
059500             PERFORM 3300-VALIDATE-DATES                          05950028
059600         END-IF                                                   05960028
059700     END-IF.                                                      05970001
059800                                                                  05980001
059900******************************************************************05990001
060000** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **06000001
060100** MAP.                                                         **06010001
060200******************************************************************06020001
060300 3200-RESET-ATTRIBUTES.                                           06030001
060400                                                                  06040001
060500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASLSMMA                     06050009
060600                                      ASLSYRA                     06060008
060700                                      ASTOREA                     06070001
060800                                      ATNDNBRA                    06080001
060900                                      AUPCA.                      06090001
061000     MOVE DP015-GREEN              TO ASLSMMC                     06100009
061100                                      ASLSYRC                     06110008
061200                                      ASTOREC                     06120001
061300                                      ATNDNBRC                    06130001
061400                                      AUPCC.                      06140001
061500     MOVE DP015-UNDERLINE          TO ASLSMMH                     06150009
061600                                      ASLSYRH                     06160008
061700                                      ASTOREH                     06170001
061800                                      ATNDNBRH                    06180001
061900                                      AUPCH.                      06190001
062000                                                                  06200001
062100******************************************************************06210001
062200 3300-VALIDATE-DATES.                                             06220001
062300*  VALIDATE THE DATE                                              06230008
062400******************************************************************06240001
062500                                                                  06250001
062600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06260001
062700     MOVE ASC-SALES-DATE-YYYYMMDD       TO DPG52-LK-DATE-INPUT.   06270008
062800     SET DPG52-LK-DTE-ISO               TO TRUE.                  06280008
062900     SET DPG51-ACTUAL-CALENDAR-ONLY     TO TRUE.                  06290008
063000     SET DPG51-DO-NOT-INCR-DECR-DATE    TO TRUE.                  06300008
063100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          06310001
063200                                             DPG53 DPG54          06320001
063300                                             DPG55 DPG56.         06330001
063400                                                                  06340001
063500     EVALUATE TRUE                                                06350001
063600         WHEN DPG54-NO-ERROR                                      06360001
063700             MOVE DPG55-DB2-ISO-DATE-FMT                          06370008
063800                                        TO ASC-SALES-DATE-FROM-ISO06380008
063900                                           ASC-SALES-DATE-TO-ISO  06390008
064000             MOVE DPG55-DAYS-IN-MONTH-X TO ASC-SALES-DATE-TO-DD   06400009
064100                                                                  06410001
064200         WHEN DPG54-SEVERE-ERROR                                  06420001
064300         WHEN DPG54-WARNING-ERROR                                 06430001
064400         WHEN DPG54-DATE-INVALID                                  06440001
064500             SET PS-ERROR                                         06450001
064600                 DP020-MSG-FATAL   TO TRUE                        06460001
064700             MOVE PC-TSYMSG-00009  TO DP020-MSG-NUMBER            06470001
064800             MOVE DP015-UNP-ALP-BRT-OFF                           06480001
064900                                   TO ASLSMMA                     06490009
065000             MOVE DP015-RED        TO ASLSMMC                     06500009
065100             MOVE DP015-REVERSE    TO ASLSMMH                     06510009
065200             MOVE -1               TO ASLSMML                     06520009
065300             SET DP030-SET-CURSOR-APPL-1                          06530001
065400                                   TO TRUE                        06540001
065500     END-EVALUATE.                                                06550001
065600                                                                  06560001
065700*----------------------------------------------------------------*06570001
065800*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *06580001
065900*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *06590001
066000*  IT HERE.                                                      *06600001
066100*----------------------------------------------------------------*06610001
066200 4000-BUILD-INITIAL-PANEL.                                        06620001
066300                                                                  06630001
066400     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        06640001
066500     MOVE -1                       TO ACSRPOSL.                   06650020
066600     MOVE DP020-LOCATION-NBR       TO ASC-STORE-N.                06660030
066700     MOVE ASC-STORE-N              TO ASTOREO.                    06670028
066800                                                                  06680001
066900     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       06690006
067000                                                                  06700006
067100     MOVE DP017-CURRENT-YMD-YYYY   TO ASC-SALES-DATE-YEAR-N       06710029
067200     MOVE ASC-SALES-DATE-YEAR-N    TO ASLSYRO.                    06720029
067300     MOVE DP017-CURRENT-YMD-MONTH  TO ASC-SALES-DATE-MONTH-N.     06730029
067400     MOVE ASC-SALES-DATE-MONTH-N   TO ASLSMMO.                    06740029
067500                                                                  06750007
067600*----------------------------------------------------------------*06760007
067700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *06770001
067800*----------------------------------------------------------------*06780001
067900 4400-MOVE-COMMAREA-TO-SCREEN.                                    06790001
068000                                                                  06800001
068100     MOVE ASC-SALES-DATE-MONTH-N   TO ASLSMMO.                    06810029
068200     MOVE ASC-SALES-DATE-YEAR-N    TO ASLSYRO.                    06820029
068300     MOVE ASC-STORE-N              TO ASTOREO.                    06830029
068400     MOVE ASC-ACCOUNT-NBR-N        TO ATNDNBRO.                   06840029
068500     MOVE ASC-UPC-NUMBER-N         TO AUPCO.                      06850029
068600                                                                  06860001
068700*----------------------------------------------------------------*06870001
068800*    UPDATE DATE AND TIME                                        *06880001
068900*----------------------------------------------------------------*06890001
069000     COPY DPPD017.                                                06900001
069100                                                                  06910001
069200*----------------------------------------------------------------*06920001
069300*    ABEND PROCESSOR MODULE                                      *06930001
069400*----------------------------------------------------------------*06940001
069500                                                                  06950001
069600     COPY DPPD013.                                                06960001
