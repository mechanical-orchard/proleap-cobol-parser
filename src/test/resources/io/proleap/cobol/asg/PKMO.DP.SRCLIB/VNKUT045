000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     VNKUT045.                                        00020000
000300 AUTHOR.         CAROLYN GIFFORD.                                 00030000
000400*DATE-WRITTEN.   JUNE 8, 1999.                                    00040000
000500*DATE-COMPILED.                                                   00050000
000600*************************************************************     00060000
000700*    DELETE TVNDTAU & TVNADAU ROWS                          *     00070000
000800*                                                           *     00080000
000900*    COBOL 2  WITH SQL - PEOPLESOFT                         *     00090000
001000*                                                           *     00100000
001100*    CLEAR VENDOR HISTORY DETAIL AND VENDOR ADDRESS HISTORY *     00110000
001200*    TABLES.                                                *     00120000
001300*                                                           *     00130000
001400*************************************************************     00140000
001500* CHANGE LOG:                                               *     00150000
001600*                                                           *     00160000
001700* 06/08/99     INITIAL VERSION.         WR#                 *     00170000
001800*                                                           *     00180000
001900* 03/15/00 - DO NOT DELETE ROWS WITH STATUS CHANGES FROM    *     00190000
002000*            TVNDTAU TABLE.                                 *     00200000
002100*        BY: CAROLYN GIFFORD                    WR# 20685   *     00210000
002200*                                                           *     00220000
002210* 12/05/00 - MODIFIED THE DELETE FROM TVNDTAU TO DELETE ALL *     00221001
002220*            ROWS THAT ARE NOT FOR MERCHANDISE VENDORS.     *     00222001
002221*            THIS REQUIRED ADDING A SUBQUERY IN THE SQL.    *     00222101
002230*        BY: NANCY EILBES                       WR# 21278   *     00223001
002240*                                                           *     00224001
002300*************************************************************     00230000
002400                                                                  00240000
002500 ENVIRONMENT DIVISION.                                            00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 DATA DIVISION.                                                   00290000
003000                                                                  00300000
003100 FILE SECTION.                                                    00310000
003200                                                                  00320000
003300                                                                  00330000
003400 WORKING-STORAGE SECTION.                                         00340000
003500                                                                  00350000
003600 01  FILLER                        PIC X(25) VALUE                00360000
003700                            'WS FOR VNKUT045 BEGINS==>'.          00370000
003800 01  ABEND-CODE                    PIC S9(4) COMP SYNC            00380000
003900                                             VALUE ZEROS.         00390000
004000     88 AP-DB2-ERROR               VALUE +4013.                   00400000
004100                                                                  00410000
004200 01  PV-ABEND-FILEDS.                                             00420000
004300     05  PV-ABEND-PROGRAM             PIC X(8)  VALUE 'VNKUT045'. 00430000
004400     05  PV-ABEND-SQLCODE             PIC X(4)  VALUE SPACES.     00440000
004500     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00450000
004600     05  PV-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00460000
004700     05  PV-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00470000
004800     05  PV-ABEND-STATUS              PIC XX    VALUE SPACES.     00480000
004900                                                                  00490000
005000 01  PV-WORK-AREA.                                                00500000
005100     05  PV-PROGRAM-NAME         PIC X(08)     VALUE 'VNKUT045'.  00510000
005200                                                                  00520000
005300 01  RUN-TIME.                                                    00530000
005400     05  R-HR                    PIC 99.                          00540000
005500     05  R-MIN                   PIC 99.                          00550000
005600     05  R-SEC                   PIC 99.                          00560000
005700     05  R-TH                    PIC 99.                          00570000
005800                                                                  00580000
005900 01  DATE-IN.                                                     00590000
006000     05 DATE-IN-YY               PIC XX.                          00600000
006100     05 DATE-IN-MM               PIC XX.                          00610000
006200     05 DATE-IN-DD               PIC XX.                          00620000
006300                                                                  00630000
006400 01  FILLER                      PIC X(35)  VALUE                 00640000
006500     'END OF VN WORK RECORD AREA       **'.                       00650000
006600                                                                  00660000
006700     COPY DPWS004.                                                00670003
006800                                                                  00680000
006900******************************************************************00690000
007000*  COMMUNICATIONS AREA2 FOR DB2                                   00700000
007100******************************************************************00710000
007200     COPY SQLCA2.                                                 00720003
007300                                                                  00730000
007400     EXEC SQL                                                     00740000
007500          INCLUDE SQLCA                                           00750000
007600     END-EXEC.                                                    00760000
007700                                                                  00770000
007800******************************************************************00780000
007900*                DCLGEN FOR VENDOR DETAIL HISTORY TABLE           00790000
008000******************************************************************00800000
008100     EXEC SQL                                                     00810000
008200          INCLUDE TVNDTAU                                         00820000
008300     END-EXEC.                                                    00830000
008400                                                                  00840000
008500******************************************************************00850000
008600*                DCLGEN FOR VENDOR ADDRESS HISTORY TABLE          00860000
008700******************************************************************00870000
008800     EXEC SQL                                                     00880000
008900          INCLUDE TVNADAU                                         00890000
009000     END-EXEC.                                                    00900000
009100                                                                  00910000
009110******************************************************************00911002
009120*                DCLGEN FOR EXTERNAL ENTITY TABLE                 00912002
009130******************************************************************00913002
009140     EXEC SQL                                                     00914002
009150          INCLUDE TEXTENT                                         00915002
009160     END-EXEC.                                                    00916002
009170                                                                  00917002
009200 01  FILLER                        PIC X(25) VALUE                00920000
009300          '<====WS FOR VNKUT045 ENDS'.                            00930000
009400                                                                  00940000
009500 PROCEDURE DIVISION.                                              00950000
009600                                                                  00960000
009700 0000-MAINLINE.                                                   00970000
009800                                                                  00980000
009900     PERFORM 1000-HOUSEKEEPING.                                   00990000
010000     PERFORM 2000-DELETE-VNDTAU.                                  01000000
010100     PERFORM 3000-DELETE-VNADAU.                                  01010000
010200                                                                  01020000
010300     PERFORM 4000-END-OF-JOB.                                     01030000
010400                                                                  01040000
010500     GOBACK.                                                      01050000
010600                                                                  01060000
010700 1000-HOUSEKEEPING.                                               01070000
010800*                                                                 01080000
010900***************************************************************** 01090000
011000*    GET DATE AND TIME FROM JOB *                                 01100000
011100***************************************************************** 01110000
011200*                                                                 01120000
011300     ACCEPT RUN-TIME FROM TIME.                                   01130000
011400     ACCEPT DATE-IN  FROM DATE.                                   01140000
011500                                                                  01150000
011600     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    01160000
011700                                                                  01170000
011800     INITIALIZE DCLTVNDTAU                                        01180000
011900                DCLTVNADAU                                        01190002
011910                DCLTEXTENT.                                       01191002
012000                                                                  01200000
012100 2000-DELETE-VNDTAU.                                              01210000
012200*                                                                 01220000
012300***************************************************************** 01230000
012400* DELETE ALL NON-MDS ROWS FROM VENDOR HISTORY DETAIL TABLE      * 01240001
012500***************************************************************** 01250000
012600*                                                                 01260000
012700     EXEC SQL                                                     01270000
012800         DELETE                                                   01280000
012900         FROM TVNDTAU A                                           01290001
013000         WHERE A.STAT_CDE = ' '                                   01300001
013010            OR EXISTS                                             01301001
013020              (SELECT 1                                           01302001
013040                 FROM TEXTENT B                                   01304001
013050                WHERE B.ENT_ID = A.ENT_ID                         01305001
013060                  AND B.MDSE_VENDOR_IND ^= 'Y')                   01306001
013100     END-EXEC.                                                    01310000
013200                                                                  01320000
013300     EVALUATE TRUE                                                01330000
013400        WHEN SQLCODE = ZEROS                                      01340000
013500        WHEN SQLCODE = +100                                       01350000
013600             CONTINUE                                             01360000
013700        WHEN OTHER                                                01370000
013800             MOVE '2000-DELETE-VNDTAU' TO                         01380000
013900                                       PV-ABEND-PARAGRAPH         01390000
014000             MOVE 'UNSUCCESSFUL DELETE TVNDTAU TABLE'             01400000
014100                             TO PV-ABEND-OPERATION                01410000
014200             MOVE 'TVNDTAU'  TO PV-ABEND-STRUCTURE-1              01420000
014300             PERFORM 9999-SQL-ERROR                               01430000
014400     END-EVALUATE.                                                01440000
014500                                                                  01450000
014600 3000-DELETE-VNADAU.                                              01460000
014700*                                                                 01470000
014800***************************************************************** 01480000
014900*     DELETE ALL ROWS FROM VENDOR ADDRESS HISTORY TABLE         * 01490000
015000***************************************************************** 01500000
015100*                                                                 01510000
015200     EXEC SQL                                                     01520000
015300         DELETE                                                   01530000
015400         FROM TVNADAU                                             01540000
015500     END-EXEC.                                                    01550000
015600                                                                  01560000
015700     EVALUATE TRUE                                                01570000
015800        WHEN SQLCODE = ZEROS                                      01580000
015900             CONTINUE                                             01590000
016000        WHEN OTHER                                                01600000
016100             MOVE '3000-DELETE-VNADAU' TO                         01610000
016200                                       PV-ABEND-PARAGRAPH         01620000
016300             MOVE 'UNSUCCESSFUL DELETE ADDRESS HISTORY TBL'       01630000
016400                             TO PV-ABEND-OPERATION                01640000
016500             MOVE 'TVNADAU'  TO PV-ABEND-STRUCTURE-1              01650000
016600             PERFORM 9999-SQL-ERROR                               01660000
016700     END-EVALUATE.                                                01670000
016800                                                                  01680000
016900 4000-END-OF-JOB.                                                 01690000
017000*                                                                 01700000
017100***************************************************************** 01710000
017200*     END JOB                                                   * 01720000
017300***************************************************************** 01730000
017400*                                                                 01740000
017500     DISPLAY '** PROGRAM VNKUT045 ENDS NORMALLY **'.              01750000
017600                                                                  01760000
017700 9999-SQL-ERROR.                                                  01770000
017800*                                                                 01780000
017900***************************************************************** 01790000
018000*     PROCESS DB2 ABENDS                                          01800000
018100***************************************************************** 01810000
018200*                                                                 01820000
018300     DISPLAY 'ENT ID = ' VNADAU-ENT-ID.                           01830000
018400     DISPLAY 'SEQ #  = ' VNADAU-SEQ-NBR.                          01840000
018500     DISPLAY 'AUD TMST = ' VNADAU-AUD-TMST.                       01850000
018600                                                                  01860000
018700     DISPLAY '*** DB2 ERROR '.                                    01870000
018800     DISPLAY '*** SQL CODE = '  PV-ABEND-SQLCODE.                 01880000
018900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 01890000
019000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               01900000
019100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               01910000
019200     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             01920000
019300                                                                  01930000
019400     COPY DPPD004.                                                01940003
019500                                                                  01950000
019600     MOVE +4013                    TO ABEND-CODE.                 01960000
019700                                                                  01970000
019800     CALL 'ILBOABN0' USING ABEND-CODE.                            01980000
