000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    XLKUT017.                                         00040014
000500 AUTHOR.        AL PETERS.                                        00050014
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   DEC 2002.                                         00070014
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*  THIS BATCH DB2 PROGRAM READS THE FILE CREATED BY IMKUT024    * 00100002
001100*  CONTAINING UPC XREF INFORMATION.  THIS DATA IS INSERTED INTO * 00110015
001200*  THE XLT_UPC TABLE.                                           * 00120015
001400***************************************************************** 00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600 INPUT-OUTPUT SECTION.                                            00160001
001700                                                                  00170001
001800 FILE-CONTROL.                                                    00180001
001900                                                                  00190001
002000     SELECT UPC-ADDS-IN                                           00200016
002010         ASSIGN TO INP01.                                         00201001
002100                                                                  00210001
002200***************************************************************** 00220001
002300 DATA DIVISION.                                                   00230001
002400***************************************************************** 00240001
002500 FILE SECTION.                                                    00250001
002600                                                                  00260001
002700 FD  UPC-ADDS-IN                                                  00270015
002800     RECORDING MODE IS F                                          00280001
002810     BLOCK CONTAINS 0 RECORDS                                     00281001
002900     LABEL RECORDS ARE STANDARD.                                  00290001
003000                                                                  00300001
003300 01  UPC-ADDS-IN-RECORD           PIC X(250).                     00330024
003700                                                                  00370001
003800                                                                  00380001
003900***************************************************************** 00390001
004000 WORKING-STORAGE SECTION.                                         00400001
004100                                                                  00410001
       01  PA-DB2-COMMIT-COUNT              PIC S9(09) VALUE +0         00411021
                                                          COMP-3.       00412021
004200 01  PS-PROGRAM-SWITCHES.                                         00420001
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00430001
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00440001
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00450001
004600                                                                  00460001
004700 01  PC-PROGRAM-CONSTANTS.                                        00470001
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUT017'.00480016
005000                                                                  00500001
005100 01  PV-PROGRAM-VARIABLES.                                        00510001
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00590001
006000     05  PV-RECORDS-INSERTED          PIC  9(09) VALUE  0.        00600001
006000     05  PV-RECORDS-SKIP              PIC  9(09) VALUE  0.        00610027
006400     05  PV-DISP-UPC-ID               PIC  9(09) VALUE  0.        00640019
           05  PV-DISP-UPC-NBR              PIC  9(15) VALUE  0.        00650019
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00670001
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00680001
006900                                                                  00690001
007000                                                                  00700001
007100 01  PV-ABEND-FIELDS.                                             00710001
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00720001
007300                                                 COMP SYNC.       00730001
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUT017'.00740025
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00750001
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00760001
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00770001
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00790001
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00800001
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00810001
008200                                                                  00820001
008300                                                                  00830001
008400***********************************************************       00840001
008500*  COPYBOOK USED FOR THE UPC ADDS INPUT FILE              *       00850016
008600***********************************************************       00860001
008700     COPY IMRD055.                                                00870028
008800                                                                  00880001
008900***********************************************************       00890001
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00900001
009100***********************************************************       00910001
009200     COPY DPWS004.                                                00920028
009300                                                                  00930001
009400***********************************************************       00940001
009500*  DB2 SQL COMMUNICATION AREA                             *       00950001
009600***********************************************************       00960001
009700     EXEC SQL                                                     00970001
009800          INCLUDE SQLCA                                           00980001
009900     END-EXEC.                                                    00990001
010000                                                                  01000001
010100***********************************************************       01010001
010200*  XLT_UPC TABLE                                          *       01020016
010300***********************************************************       01030001
010400     EXEC SQL                                                     01040001
010500          INCLUDE XLT00006                                        01050016
010600     END-EXEC.                                                    01060001
010700                                                                  01070001
010800***************************************************************** 01080001
010900 PROCEDURE DIVISION.                                              01090001
011000***************************************************************** 01100001
011100     DISPLAY '**** BEGINNING XLKUT017 ****'.                      01110016
011200     DISPLAY ' '.                                                 01120001
011300                                                                  01130001
011400     OPEN INPUT  UPC-ADDS-IN.                                     01140016
011500                                                                  01150001
011600     PERFORM 1000-READ-INPUT-FILE.                                01160001
011700                                                                  01170001
012100     PERFORM 2000-PROCESS-INPUT-FILE                              01210001
012200       UNTIL PS-EOF-INPUT-YES.                                    01220001
012300                                                                  01230001
012400     CLOSE UPC-ADDS-IN.                                           01240016
012500                                                                  01250001
012510     PERFORM 3000-TABLE-COMMIT.                                   01251001
012520                                                                  01252001
012600     DISPLAY '  INPUT UPC RECS READ    = ' PV-RECORDS-READ.       01260016
012700     DISPLAY '  XLT_UPC ROWS INSERTED  = ' PV-RECORDS-INSERTED.   01270016
012700     DISPLAY '  XLT_UPC ROWS SKIPED    = ' PV-RECORDS-SKIP.       01271027
012800     DISPLAY ' '.                                                 01280001
012900     DISPLAY '****  END OF  XLKUT017  ****'.                      01290016
013000                                                                  01300001
013100     GOBACK.                                                      01310001
013200                                                                  01320001
013300                                                                  01330001
013400***************************************************************** 01340001
013500*  READ A UPC ADD EXTRACT RECORD THAT WILL BE USED TO INSERT    * 01350016
013510*  A ROW OF DATA INTO THE XLT_UPC TABLE.                        * 01351016
013600***************************************************************** 01360001
013700 1000-READ-INPUT-FILE.                                            01370001
013800                                                                  01380001
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01390001
014000                                                                  01400001
014010     INITIALIZE IM055-ITEM-UPC-DOMAIN-REC                         01401024
                      PA-DB2-COMMIT-COUNT.                              01401123
014020                                                                  01402001
014100     READ UPC-ADDS-IN                                             01410016
014200          INTO IM055-ITEM-UPC-DOMAIN-REC                          01420024
014300            AT END                                                01430001
014400               SET PS-EOF-INPUT-YES TO TRUE                       01440001
014500                                                                  01450001
014600            NOT AT END                                            01460001
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01470001
014800               ADD +1 TO PV-RECORDS-READ                          01480001
014900     END-READ.                                                    01490001
015000                                                                  01500001
015100                                                                  01510001
015200***************************************************************** 01520001
015300*  LOAD THE INFORMATION FROM THE UPC ADD EXTRACT FILE INTO THE  * 01530016
015310*  HOST VARIABLES AND PERFORM A PARAGRAPH TO INSERT THE NEW ROW * 01531003
015320*  INTO THE XLT_UPC TABLE.                                      * 01532016
015400***************************************************************** 01540001
015500 2000-PROCESS-INPUT-FILE.                                         01550001
015600                                                                  01560001
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01570001
015800                                                                  01580001
016361     MOVE IM055-UPC-ID               TO XLT00006-UPC-ID.          01636124
016362     MOVE IM055-INTR-UPC-ID          TO XLT00006-INTR-UPC-ID.     01636224
016363     MOVE IM055-UPC-TYP-CDE          TO XLT00006-UPC-TYP-CDE.     01636324
016364     MOVE IM055-EDI-ORD-IND          TO XLT00006-EDI-ORD-IND.     01636424
016365     MOVE IM055-CERTD-IND            TO XLT00006-CERTD-IND.       01636524
016366     MOVE IM055-CERTD-DTE            TO XLT00006-CERTD-DTE.       01636624
016367     MOVE IM055-UPC-NBR              TO XLT00006-UPC-NBR.         01636724
016380                                                                  01638001
016400     PERFORM 2100-INSERT-XLT-UPC.                                 01640016
017700                                                                  01770001
017800     PERFORM 1000-READ-INPUT-FILE.                                01780001
018500                                                                  01850001
018600                                                                  01860001
021600***************************************************************** 02160001
021700*  INSERT A ROW TO THE XLT_UPC TABLE.                           * 02170016
021800***************************************************************** 02180001
021900 2100-INSERT-XLT-UPC.                                             02190016
022000                                                                  02200001
022100     EXEC SQL                                                     02210001
022200          INSERT                                                  02220001
022300          INTO  XLT_UPC                                           02230016
023093              ( UPC_ID                                            02309316
023094               ,INTR_UPC_ID                                       02309416
023095               ,UPC_TYP_CDE                                       02309516
023096               ,EDI_ORD_IND                                       02309616
023097               ,CERTD_IND                                         02309716
023098               ,CERTD_DTE                                         02309816
023099               ,UPC_NBR                                           02309928
                     ,LAST_UPD_TMST)                                    02310028
023200          VALUES                                                  02320001
023993             (  :XLT00006-UPC-ID                                  02399316
023994               ,:XLT00006-INTR-UPC-ID                             02399416
023995               ,:XLT00006-UPC-TYP-CDE                             02399516
023996               ,:XLT00006-EDI-ORD-IND                             02399616
023997               ,:XLT00006-CERTD-IND                               02399716
023998               ,:XLT00006-CERTD-DTE                               02399816
023999               ,:XLT00006-UPC-NBR                                 02399928
                     ,CURRENT TIMESTAMP)                                02400028
024010     END-EXEC.                                                    02401001
024100                                                                  02410001
024200     EVALUATE TRUE                                                02420001
024300         WHEN SQLCODE = ZERO                                      02430001
024400              ADD +1                 TO PV-RECORDS-INSERTED       02440001
                    ADD +1                 TO PA-DB2-COMMIT-COUNT       02440123
                    IF PA-DB2-COMMIT-COUNT > 4500                       02440226
                        PERFORM 3000-TABLE-COMMIT                       02440321
                        MOVE 0 TO PA-DB2-COMMIT-COUNT                   02440423
                    END-IF                                              02440521
               WHEN SQLCODE = -803                                      02441013
                    CONTINUE                                            02442013
               WHEN SQLCODE = -530                                      02443027
024400              ADD +1                 TO PV-RECORDS-SKIP           02443127
024500         WHEN SQLCODE NOT = +0                                    02450001
024600              MOVE '2100-INSERT-XLT-UPC'                          02460016
024700                                     TO PV-ABEND-PARAGRAPH        02470001
024800              MOVE 'INSERT XLT_UPC'                               02480016
024810                                     TO PV-ABEND-OPERATION        02481001
024821              MOVE IM055-UPC-ID      TO PV-DISP-UPC-ID            02482124
                    MOVE IM055-UPC-NBR     TO PV-DISP-UPC-NBR           02482224
025500              STRING 'UPC ID NBR: '           DELIMITED BY SIZE   02550016
025600                     PV-DISP-UPC-ID           DELIMITED BY SIZE   02560016
026100                     '  UPC NBR: '            DELIMITED BY SIZE   02610016
026200                     PV-DISP-UPC-NBR          DELIMITED BY SIZE   02620016
026700                                   INTO PV-DB2-OPERATION-MESSAGE-102670001
026800                                                                  02680001
026900              MOVE 'XLT_UPC'         TO PV-ABEND-TABLE            02690016
027000              PERFORM Z999-SQL-ABEND                              02700001
027100     END-EVALUATE.                                                02710001
027200                                                                  02720001
027300                                                                  02730001
027400***************************************************************** 02740001
027500* COMMIT THE PENDING TABLE CHANGES.                             * 02750001
027600***************************************************************** 02760001
027700 3000-TABLE-COMMIT.                                               02770001
027800                                                                  02780001
027900     EXEC SQL                                                     02790001
028000          COMMIT                                                  02800001
028100     END-EXEC.                                                    02810001
028200                                                                  02820001
028300                                                                  02830001
028400***************************************************************** 02840001
028500*  DISPLAY DB2 ERROR INFORMATION, ROLLBACK ANY PENDING CHANGES, * 02850001
028510*  AND ABEND THE PROGRAM.                                       * 02851001
028600***************************************************************** 02860001
028700 Z999-SQL-ABEND.                                                  02870001
028800                                                                  02880001
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02890001
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02900001
029100     DISPLAY '*** DB2 ERROR '.                                    02910001
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02920001
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02930001
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02940001
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02950001
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02960001
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02970001
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02980001
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   02990001
030000                                                                  03000001
030100     COPY DPPD004.                                                03010028
030200                                                                  03020001
030300     MOVE +4013         TO PV-ABEND-CODE.                         03030001
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03040001
