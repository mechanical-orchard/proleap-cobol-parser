000100******************************************************************00010014
000200 IDENTIFICATION DIVISION.                                         00020014
000300******************************************************************00030014
000400 PROGRAM-ID.    SUKUT058.                                         00040014
000500 AUTHOR.        SUDHAN V.                                         00050014
000600 INSTALLATION.  KOHLS.                                            00060014
000700 DATE-WRITTEN   JULY 2011.                                        00070014
000800 DATE-COMPILED.                                                   00080014
000900******************************************************************00090014
001000*  THIS PROGRAM CREATES AN EXTRACT FILE TO CREATE THE MIXED PACK  00100014
001100*  TO LIGHT TOTE REPORT.                                          00110014
001200******************************************************************00120014
001300 ENVIRONMENT DIVISION.                                            00130014
001400******************************************************************00140014
001500                                                                  00150014
001600 CONFIGURATION SECTION.                                           00160014
001700                                                                  00170014
001800 SOURCE-COMPUTER.        IBM-3090.                                00180014
001900 OBJECT-COMPUTER.        IBM-3090.                                00190014
002000                                                                  00200014
002100 INPUT-OUTPUT SECTION.                                            00210014
002200                                                                  00220014
002300 FILE-CONTROL.                                                    00230014
002400                                                                  00240014
002500     SELECT SUT-MIXED-P2L-TOTE-EXT                                00250014
002600         ASSIGN TO OUT01.                                         00260014
002700                                                                  00270014
002500     SELECT CONTROL-FILE                                          00271022
002600         ASSIGN TO OUT02.                                         00272022
002700                                                                  00273022
002800******************************************************************00280014
002900 DATA DIVISION.                                                   00290014
003000******************************************************************00300014
003100                                                                  00310014
003200 FILE SECTION.                                                    00320014
003300                                                                  00330014
003400 FD  SUT-MIXED-P2L-TOTE-EXT                                       00340014
003500     RECORDING MODE IS F                                          00350014
003600     LABEL RECORDS ARE STANDARD                                   00360014
003700     BLOCK CONTAINS 0 RECORDS.                                    00370014
003800*                                                                 00380014
003900 01  SUT-MIXED-P2L-TOTE-REC    PIC  X(50).                        00390014
004000*                                                                 00400014
004000*                                                                 00400122
003400 FD  CONTROL-FILE                                                 00401022
003500     RECORDING MODE IS F                                          00402022
003600     LABEL RECORDS ARE STANDARD                                   00403022
003700     BLOCK CONTAINS 0 RECORDS.                                    00404022
003800*                                                                 00405022
003900 01  CONTROL-FILE-REC          PIC  X(80).                        00406022
004000*                                                                 00407022
004100******************************************************************00410014
004200 WORKING-STORAGE SECTION.                                         00420014
004210***************************************************************** 00421014
004220*  RECORD LAYOUT FOR THE P2L MIXED TOTE EXTRACT FILE.           * 00422014
004230***************************************************************** 00423014
004240     COPY SURD110.                                                00424020
004250*                                                                 00425014
004210***************************************************************** 00425122
004220*  RECORD LAYOUT FOR THE DATE CONTROL CARD.                     * 00425222
004230***************************************************************** 00425322
007600     COPY SURD032.                                                00425522
007700*                                                                 00425622
004260******************************************************************00426014
004270*  DB2 FORMATTED MESSAGE AREA                                     00427014
004280******************************************************************00428014
004290     COPY DPWS004.                                                00429014
004300*                                                                 00430014
004400******************************************************************00440014
004500*  COMMUNICATIONS AREA FOR DB2                                    00450014
004600******************************************************************00460014
004700     EXEC SQL                                                     00470014
004800          INCLUDE SQLCA                                           00480014
004900     END-EXEC.                                                    00490014
005000*                                                                 00500014
005100******************************************************************00510014
005200*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SUT OUTBOUND CARTON00520014
005300*  TABLE                                                          00530014
005400******************************************************************00540014
005500     EXEC SQL                                                     00550014
005600          INCLUDE SUT00024                                        00560014
005700     END-EXEC.                                                    00570014
005800*                                                                 00580014
005900******************************************************************00590014
006000*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SUT OUTBOUND LOC   00600014
006100*  TABLE                                                          00610014
006200******************************************************************00620014
006210     EXEC SQL                                                     00621014
006220          INCLUDE SUT00027                                        00622014
006230     END-EXEC.                                                    00623014
006240*                                                                 00624014
006250******************************************************************00625014
006260*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE SUT OUTBOUND UPC   00626014
006270*  TABLE                                                          00627014
006280******************************************************************00628014
006290     EXEC SQL                                                     00629014
006300          INCLUDE SUT00028                                        00630014
006400     END-EXEC.                                                    00640014
006500*                                                                 00650014
006600******************************************************************00660014
006700*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE PURCHASE ORDER     00670014
006800*  TABLE                                                          00680014
006900******************************************************************00690014
007000     EXEC SQL                                                     00700014
007100          INCLUDE TPURCHS                                         00710014
007200     END-EXEC.                                                    00720014
007300*                                                                 00730014
007400******************************************************************00740014
007500*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE XLT DEPARTMENT     00750014
007600*  TABLE                                                          00760014
007700******************************************************************00770014
007800     EXEC SQL                                                     00780014
007900          INCLUDE XLT00002                                        00790014
008000     END-EXEC.                                                    00800014
008100*                                                                 00810014
007400******************************************************************00810115
007500*  COBOL DECLARATION AND DCLGEN MEMBER FOR THE DATE RECORD TABLE  00810215
007700******************************************************************00810415
008300     EXEC SQL                                                     00811015
008400         INCLUDE TDTATTR                                          00812015
008500     END-EXEC                                                     00813015
008600*                                                                 00814015
008200 01  CC-CONTROL-CARD.                                             00820014
008300     05  CC-START-DATE               PIC X(10)     VALUE SPACES.  00830014
008400     05  FILLER                      PIC X(01)     VALUE SPACES.  00840014
008500     05  CC-END-DATE                 PIC X(10)     VALUE SPACES.  00850014
008600     05  FILLER                      PIC X(01)     VALUE SPACES.  00860014
008610     05  CC-WEEKLY-OR-MONTHLY-RUN    PIC X(01)     VALUE SPACES.  00861014
008620         88  CC-MONTHLY-RUN                        VALUE 'M'.     00862014
008630         88  CC-WEEKLY-RUN                         VALUE 'W'.     00863014
008640                                                                  00864014
008650 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00865014
008660                                                   COMP SYNC.     00866014
008670                                                                  00867014
008680 01  PS-PROGRAM-SWITCHES.                                         00868014
008690     05  PS-EOF-MIXED-P2L-CSR-SW     PIC  X(01)    VALUE 'N'.     00869014
008700         88  PS-EOF-MIXED-P2L-CSR                  VALUE 'Y'.     00870014
008800                                                                  00880014
008900 01  PC-PROGRAM-CONSTANTS.                                        00890014
009000     05  PC-YEAR                     PIC  9(04)    VALUE ZEROES.  00900014
009100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00910014
009200         'SUKUT058'.                                              00920014
009900                                                                  00990014
010000     05 PC-CURR-MONTH                PIC 9(2)    VALUE ZERO.      01000014
010100 01  PV-PROGRAM-VARIABLES.                                        01010014
010300     05  PV-WRITE-COUNTER            PIC S9(09)    VALUE ZERO     01030014
010400                                                   COMP SYNC.     01040014
010300     05  PV-WRITE-CONTROL-COUNTER    PIC S9(09)    VALUE ZERO     01041022
010400                                                   COMP SYNC.     01042022
010500     05  PV-COUNT                    PIC S9(09)    VALUE ZERO     01050014
010600                                                   COMP SYNC.     01060014
010700     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01070014
010800     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01080014
009300     05  PV-CURRENT-DATE.                                         01081019
009400         10  PV-CURRENT-CCYY         PIC  9(04)    VALUE ZERO.    01082019
009700         10  PV-CURRENT-MONTH        PIC  9(02)    VALUE ZERO.    01085019
009800         10  PV-CURRENT-DAY          PIC  9(02)    VALUE ZERO.    01086019
009300     05  PV-CURRENT-DATE-DISP.                                    01087019
009400         10  PV-CURRENT-CCYY-DISP    PIC  9(04)    VALUE ZERO.    01088019
009400         10  FILLER                  PIC  X(01)    VALUE '-'.     01088119
009700         10  PV-CURRENT-MONTH-DISP   PIC  9(02)    VALUE ZERO.    01089019
009400         10  FILLER                  PIC  X(01)    VALUE '-'.     01089119
009800         10  PV-CURRENT-DAY-DISP     PIC  9(02)    VALUE ZERO.    01089219
010900     05  PV-BEGIN-CRE-TMST           PIC  X(26)    VALUE SPACES.  01090014
011000     05  PV-BEGIN-CRE-TMST-R         REDEFINES                    01100014
011100         PV-BEGIN-CRE-TMST.                                       01110014
011200         10  PV-BEGIN-CCYY-MM-DD     PIC  X(10).                  01120014
011300         10  PV-BEGIN-MM-SS-SSSSSS   PIC  X(16).                  01130014
011400     05  PV-END-CRE-TMST             PIC  X(26)    VALUE SPACES.  01140014
011500     05  PV-END-CRE-TMST-R           REDEFINES                    01150014
011600         PV-END-CRE-TMST.                                         01160014
011700         10  PV-END-CCYY-MM-DD       PIC  X(10).                  01170014
011800         10  PV-END-MM-SS-SSSSSS     PIC  X(16).                  01180014
011900                                                                  01190014
012000*                                                                 01200014
012100*  CURSOR DECLARATION FOR OTBND-MIXED-P2L-TOTE-CSR                01210014
012200*                                                                 01220014
012300                                                                  01230014
012400     EXEC SQL                                                     01240014
012500          DECLARE MIXED-P2L-TOTE-CSR CURSOR FOR                   01250014
012600                SELECT  A.SHIPT_UNT_ID                            01260014
012700                      , A.ORGN_LOC_NBR                            01270014
012800                      , E.STR_ZN_CDE                              01280014
012900                      , B.TRN_NBR                                 01290014
013000                      , B.RCVR_SEQ_NBR                            01300014
013100                      , 1 AS COUNT                                01310014
013200                FROM SUT_OTBND_CART A                             01320014
013300                ,    SUT_OTBND_UPC  B                             01330014
013400                ,    SUT_OTBND_LOC  C                             01340014
013500                ,    TPURCHS        D                             01350014
013600                ,    XLT_DEPT       E                             01360014
013700                WHERE A.CART_SRC_CDE IN ('P2L','JWL')             01370014
013800                AND A.ACTV_IND         = 'Y'                      01380014
013900                AND A.SHIPT_UNT_ID   = B.SHIPT_UNT_ID             01390014
014000                AND A.SHIPT_UNT_ID   = C.SHIPT_UNT_ID             01400014
014100                AND C.CRE_TMST      >= :PV-BEGIN-CRE-TMST         01410014
014200                AND C.CRE_TMST      <= :PV-END-CRE-TMST           01420014
014300                AND C.CRE_TMST       =                            01430014
014400                      (SELECT MAX(F.CRE_TMST)                     01440014
014500                         FROM SUT_OTBND_LOC F                     01450014
014600                        WHERE A.SHIPT_UNT_ID   = F.SHIPT_UNT_ID   01460014
014700                          AND F.CRE_USR_ID     = 'PCKCS723'       01470014
014800                          AND F.ACTV_CDE       = 'A')             01480014
014900                AND B.TRN_NBR        = D.PO_NBR                   01490014
015000                AND D.VER_STATUS_CDE = 'A'                        01500014
015100                AND E.DEPT_NBR       = DECIMAL(D.DEPT_NBR,4,0)    01510014
015200                GROUP BY  A.ORGN_LOC_NBR                          01520014
015300                         ,A.SHIPT_UNT_ID                          01530014
015400                         ,E.STR_ZN_CDE                            01540014
015500                         ,B.TRN_NBR                               01550014
015600                         ,B.RCVR_SEQ_NBR                          01560014
015700                ORDER BY A.ORGN_LOC_NBR                           01570021
015700                       , B.TRN_NBR                                01571021
015700                       , B.RCVR_SEQ_NBR                           01572021
015700                       , A.SHIPT_UNT_ID                           01573021
015800                WITH UR                                           01580014
015900     END-EXEC.                                                    01590014
016000/                                                                 01600014
016100 PROCEDURE DIVISION.                                              01610014
016200******************************************************************01620014
016300 0000-PROGRAM-MAINLINE.                                           01630014
016400******************************************************************01640014
016500*                                                                 01650014
016600     DISPLAY '** PROGRAM SUKUT058 EXECUTION STARTED **'.          01660014
016700*                                                                 01670014
016800     PERFORM 1000-INITIALIZE.                                     01680014
016900     PERFORM 2000-PROCESS-MIXED-P2L-TOTES                         01690014
017000       UNTIL PS-EOF-MIXED-P2L-CSR.                                01700014
017100     PERFORM 9000-EOJ-ROUTINE.                                    01710014
017200/                                                                 01720014
017300******************************************************************01730014
017400 1000-INITIALIZE.                                                 01740014
017500******************************************************************01750014
017600     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           01760014
017700                                                                  01770014
017800     ACCEPT PV-CURRENT-DATE FROM DATE YYYYMMDD.                   01780019
017900                                                                  01781019
017900     MOVE PV-CURRENT-CCYY         TO PV-CURRENT-CCYY-DISP.        01790019
017900     MOVE PV-CURRENT-MONTH        TO PV-CURRENT-MONTH-DISP.       01791019
017900     MOVE PV-CURRENT-DAY          TO PV-CURRENT-DAY-DISP.         01792019
017900                                                                  01793019
018000     IF CC-START-DATE = '9999-09-09' OR                           01800014
018100        CC-END-DATE   = '9999-09-09'                              01810014
018200        PERFORM 1100-FETCH-BEGIN-END-DATE                         01820014
019100        DISPLAY '** PROGRAM SUKUT058 PROCESSING DATE : **'        01821024
019200            DTATTR-KY-DTE                                         01822024
018300     ELSE                                                         01830014
018400        DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD            01840014
018500        MOVE CC-START-DATE        TO PV-BEGIN-CCYY-MM-DD          01850014
018500                                     SU032-FROM-DATE              01851022
018600        MOVE '-00.00.00.000000'   TO PV-BEGIN-MM-SS-SSSSSS        01860014
018700        MOVE CC-END-DATE          TO PV-END-CCYY-MM-DD            01870014
018500                                     SU032-TO-DATE                01871022
018800        MOVE '-23.59.59.999999'   TO PV-END-MM-SS-SSSSSS          01880014
018800        MOVE CC-WEEKLY-OR-MONTHLY-RUN                             01881022
018800                                  TO SU032-RPT-TYPE               01882022
018900     END-IF                                                       01890014
019000*                                                                 01900014
019100     DISPLAY '** PROGRAM SUKUT058 CURRENT DATE    : **'           01910024
019200     PV-CURRENT-DATE-DISP.                                        01920019
019300     DISPLAY '** PROGRAM SUKUT058 START TMST      : **'           01930014
019400             PV-BEGIN-CRE-TMST.                                   01940014
019500     DISPLAY '** PROGRAM SUKUT058 END   TMST      : **'           01950014
019600             PV-END-CRE-TMST.                                     01960014
019700*                                                                 01970014
019700     OPEN OUTPUT CONTROL-FILE.                                    01971022
019700     PERFORM 8000-WRITE-CONTROL-REC.                              01972022
019500     DISPLAY '** PROGRAM SUKUT058 DATE CONTROL REC: **'           01973027
019600             SU032-DATE-CONTROL-REC.                              01973127
019700*                                                                 01974022
019800     OPEN OUTPUT SUT-MIXED-P2L-TOTE-EXT.                          01980014
019900     PERFORM 8100-OPEN-MIXED-P2L-TOTR-CSR.                        01990014
020000     PERFORM 8200-FETCH-MIXED-P2L-TOTE-CSR.                       02000014
020100*                                                                 02010016
020100*                                                                 02011016
020200 1100-FETCH-BEGIN-END-DATE.                                       02020014
020300                                                                  02030014
020400     EXEC SQL                                                     02040014
020500         SELECT                                                   02050014
021570             DTE.KY_DTE                                           02157024
021570         ,   DTE.FSCL_MN_BEG_DTE                                  02157124
021580         ,   DTE.FSCL_MN_END_DTE                                  02158014
021592         ,   DTE.FSCL_WK_BEG_DTE                                  02159214
021593         ,   DTE.FSCL_WK_END_DTE                                  02159314
021596         INTO                                                     02159614
021599             :DTATTR-KY-DTE                                       02159924
021599         ,   :DTATTR-FSCL-MN-BEG-DTE                              02160024
021600         ,   :DTATTR-FSCL-MN-END-DTE                              02160124
021603         ,   :DTATTR-FSCL-WK-BEG-DTE                              02160314
021604         ,   :DTATTR-FSCL-WK-END-DTE                              02160414
021607         FROM                                                     02160714
021609             TDTATTR DTE                                          02160915
021610         WHERE                                                    02161014
021611             DTE.KY_DTE = CURRENT DATE - 7 DAYS                   02161126
021613         WITH UR                                                  02161314
021614     END-EXEC.                                                    02161414
021615                                                                  02161514
021616     EVALUATE TRUE                                                02161614
021617         WHEN SQLCODE = ZERO                                      02161714
018500             IF  CC-MONTHLY-RUN                                   02161815
018500                 MOVE DTATTR-FSCL-MN-BEG-DTE                      02161916
018500                                          TO PV-BEGIN-CCYY-MM-DD  02162016
018500                                             SU032-FROM-DATE      02162122
018600                 MOVE '-00.00.00.000000'  TO PV-BEGIN-MM-SS-SSSSSS02162222
018700                 MOVE DTATTR-FSCL-MN-END-DTE                      02162322
018700                                          TO PV-END-CCYY-MM-DD    02162422
018500                                             SU032-TO-DATE        02162522
018800                 MOVE '-23.59.59.999999'  TO PV-END-MM-SS-SSSSSS  02162622
018500             ELSE                                                 02162722
018500                 IF  CC-WEEKLY-RUN                                02162822
018500                     MOVE DTATTR-FSCL-WK-BEG-DTE                  02162922
018500                                          TO PV-BEGIN-CCYY-MM-DD  02163022
018500                                             SU032-FROM-DATE      02163122
018600                     MOVE '-00.00.00.000000'                      02163322
018600                                          TO PV-BEGIN-MM-SS-SSSSSS02163422
018700                     MOVE DTATTR-FSCL-WK-END-DTE                  02163522
018700                                          TO PV-END-CCYY-MM-DD    02163622
018500                                             SU032-TO-DATE        02163722
018800                     MOVE '-23.59.59.999999'                      02163822
018800                                          TO PV-END-MM-SS-SSSSSS  02163922
018500                 END-IF                                           02164022
018500             END-IF                                               02164122
018800             MOVE CC-WEEKLY-OR-MONTHLY-RUN                        02164222
018800                                          TO SU032-RPT-TYPE       02164322
021622         WHEN SQLWARN0 NOT = SPACE                                02164422
021623         WHEN SQLCODE  NOT = ZERO                                 02164522
021624             MOVE '1100-FETCH-BEGIN-END-DATE'                     02164622
029900                                 TO PV-PARAGRAPH-NAME             02164722
030000             MOVE 'FETCH BEGIN AND END DATES          '           02164822
030100                                 TO PV-DB2-OPERATION-ATTEMPTED    02164922
030200             PERFORM 9100-SQL-ABEND                               02165022
021631     END-EVALUATE.                                                02165122
021640******************************************************************02166000
021700 2000-PROCESS-MIXED-P2L-TOTES.                                    02170000
021800******************************************************************02180000
021900     PERFORM 8400-WRITE-MIXED-P2L-TOTE-REC.                       02190022
022000     PERFORM 8200-FETCH-MIXED-P2L-TOTE-CSR.                       02200000
022100/                                                                 02210000
022200******************************************************************02220022
022300 8000-WRITE-CONTROL-REC.                                          02230022
022400******************************************************************02240022
022500      INITIALIZE CONTROL-FILE-REC.                                02250022
022600      WRITE CONTROL-FILE-REC                                      02260022
022700          FROM SU032-DATE-CONTROL-REC.                            02270022
022800      ADD +1 TO PV-WRITE-CONTROL-COUNTER.                         02280022
022900/                                                                 02290022
023000******************************************************************02300000
023100 8100-OPEN-MIXED-P2L-TOTR-CSR.                                    02310000
023200******************************************************************02320000
023300                                                                  02330000
023400         EXEC SQL                                                 02340000
023500              OPEN MIXED-P2L-TOTE-CSR                             02350000
023600         END-EXEC                                                 02360000
023700                                                                  02370000
023800         EVALUATE TRUE                                            02380000
023900*            WHEN SQLCODE = -904                                  02390000
024000*            WHEN SQLCODE = -911                                  02400000
024100*                CONTINUE                                         02410000
024200             WHEN SQLWARN0 NOT = SPACES                           02420000
024300             WHEN SQLCODE < ZERO                                  02430000
024400             WHEN SQLCODE > ZERO                                  02440000
024500                 MOVE '8100-OPEN-MIXED-P2L-TOTR-CSR'              02450000
024600                                 TO PV-PARAGRAPH-NAME             02460000
024700                 MOVE 'OPEN THE MIXED-P2L-TOTE-CSR '              02470000
024800                                 TO PV-DB2-OPERATION-ATTEMPTED    02480000
024900                 PERFORM 9100-SQL-ABEND                           02490000
025000             WHEN SQLCODE = ZERO                                  02500000
025100                 CONTINUE                                         02510000
025200         END-EVALUATE.                                            02520000
025300/                                                                 02530000
025400******************************************************************02540000
025500 8200-FETCH-MIXED-P2L-TOTE-CSR.                                   02550000
025600******************************************************************02560000
025700     EXEC SQL                                                     02570000
025800         FETCH MIXED-P2L-TOTE-CSR                                 02580000
025900         INTO   :SUT00024-SHIPT-UNT-ID                            02590000
026000              , :SUT00024-ORGN-LOC-NBR                            02600000
026100              , :XLT00002-STR-ZN-CDE                              02610000
026110              , :SUT00028-TRN-NBR                                 02611005
026120              , :SUT00028-RCVR-SEQ-NBR                            02612005
026200              , :PV-COUNT                                         02620000
026300     END-EXEC.                                                    02630000
026400                                                                  02640000
026500     EVALUATE TRUE                                                02650000
026600         WHEN SQLCODE = ZERO                                      02660000
026700           INITIALIZE SU110-P2L-MIXED-TOTE-DTL                    02670017
026710           MOVE SUT00024-SHIPT-UNT-ID  TO  SU110-SHIPT-UNT-ID     02671007
026800           MOVE SUT00024-ORGN-LOC-NBR  TO  SU110-ORGN-LOC-NBR     02680007
026900           MOVE XLT00002-STR-ZN-CDE    TO  SU110-STR-ZN-CDE       02690007
026910           MOVE SUT00028-TRN-NBR       TO  SU110-ORD-NBR          02691007
026920           MOVE SUT00028-RCVR-SEQ-NBR  TO  SU110-REC-SEQ-NBR      02692007
027000           MOVE PV-COUNT               TO  SU110-COUNT-NBR        02700007
027100         WHEN SQLCODE = +100                                      02710000
027200             SET PS-EOF-MIXED-P2L-CSR TO TRUE                     02720000
027300         WHEN SQLWARN0 NOT = SPACES                               02730000
027400         WHEN SQLCODE < ZERO                                      02740000
027500         WHEN SQLCODE > ZERO                                      02750000
027600             MOVE '8200-FETCH-MIXED-P2L-TOTE-CSR     '            02760000
027700                                 TO PV-PARAGRAPH-NAME             02770000
027800             MOVE 'FETCH-MIXED-P2L-TOTE-CSR          '            02780000
027900                                 TO PV-DB2-OPERATION-ATTEMPTED    02790000
028000             PERFORM 9100-SQL-ABEND                               02800000
028100     END-EVALUATE.                                                02810000
028200/                                                                 02820000
028300******************************************************************02830000
028400 8300-CLOSE-MIXED-P2L-TOTE-CSR.                                   02840000
028500******************************************************************02850000
028600                                                                  02860000
028700         EXEC SQL                                                 02870000
028800              CLOSE MIXED-P2L-TOTE-CSR                            02880000
028900         END-EXEC                                                 02890000
029000                                                                  02900000
029100         EVALUATE TRUE                                            02910000
029200*            WHEN SQLCODE = -904                                  02920000
029300*            WHEN SQLCODE = -911                                  02930000
029400*                CONTINUE                                         02940000
029500             WHEN SQLWARN0 NOT = SPACES                           02950000
029600             WHEN SQLCODE < ZERO                                  02960000
029700             WHEN SQLCODE > ZERO                                  02970000
029800                 MOVE '8300-CLOSE-MIXED-P2L-TOTE-CSR     '        02980000
029900                                 TO PV-PARAGRAPH-NAME             02990000
030000                 MOVE 'CLOSE THE MIXED-P2L-TOTE-CSR       '       03000000
030100                                 TO PV-DB2-OPERATION-ATTEMPTED    03010000
030200                 PERFORM 9100-SQL-ABEND                           03020000
030300             WHEN SQLCODE = ZERO                                  03030000
030400                 CONTINUE                                         03040000
030500         END-EVALUATE.                                            03050000
030600/                                                                 03060000
022200******************************************************************03060122
022300 8400-WRITE-MIXED-P2L-TOTE-REC.                                   03060222
022400******************************************************************03060322
022500      INITIALIZE SUT-MIXED-P2L-TOTE-REC.                          03060422
022600      WRITE SUT-MIXED-P2L-TOTE-REC                                03060522
022700          FROM SU110-P2L-MIXED-TOTE-DTL.                          03060622
022800      ADD +1 TO PV-WRITE-COUNTER.                                 03060722
022900/                                                                 03060822
030700******************************************************************03070000
030800 9000-EOJ-ROUTINE.                                                03080000
030900******************************************************************03090000
031000                                                                  03100000
031100     DISPLAY ' CONTROL RECS WRITTEN = ' PV-WRITE-CONTROL-COUNTER. 03110022
031100     DISPLAY ' EXTRACTS WRITTEN     = ' PV-WRITE-COUNTER.         03111022
031200                                                                  03120000
031300     CLOSE SUT-MIXED-P2L-TOTE-EXT                                 03130022
031300           CONTROL-FILE.                                          03131022
031400     PERFORM 8300-CLOSE-MIXED-P2L-TOTE-CSR.                       03140000
031500     GOBACK.                                                      03150000
031600/                                                                 03160000
031700******************************************************************03170000
031800 9100-SQL-ABEND.                                                  03180000
031900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    03190000
032000*  ERROR OR WARNING CODE OCCURS.                                  03200000
032100******************************************************************03210000
032200     DISPLAY '9100-SQL-ABEND'.                                    03220000
032300     DISPLAY '** ABEND     **'.                                   03230000
032400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        03240000
032500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03250000
032600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     03260000
032700                                                                  03270000
032800*    ABEND COPYBOOK                                               03280000
032900     COPY DPPD004.                                                03290000
033000                                                                  03300000
033100     MOVE +4013                  TO ABEND-CODE.                   03310000
033200     CALL 'ILBOABN0' USING ABEND-CODE.                            03320000
033300/                                                                 03330000
