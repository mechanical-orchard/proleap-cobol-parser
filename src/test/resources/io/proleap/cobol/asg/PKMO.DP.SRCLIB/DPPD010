00001 ******************************************************************01/06/93
00002 *  THIS MEMBER IS USED AS THE BULK OF THE PROCEDURE DIVISION IN   DPPD010 
00003 *  TWO KOHL'S 'UTILITY' PROGRAMS.  THEY ARE:                         LV006
00004 *      'DPKUT038' IS A CICS PROGRAM THAT CAN BE LINKED TO AS IF      CL**5
00005 *                 IT WERE A SUBROUTINE.                              CL**5
00006 *      'DPKUT039' IS A BATCH SUBROUTINE                              CL**5
00007 *                                                                    CL**5
00008 *  BOTH PROGRAMS PERFORM THE SAME FUNCTIONS (GET MBS INFORMATION)    CL**5
00009 *  SO THEY SHARE THIS MEMBER FOR MOST OF THE PROCEDURE DIVISION.     CL**5
00010 *  THE SEPARATE PROGRAMS ARE NEEDED BECAUSE THE BATCH INTERFACE      CL**5
00011 *  AND THE CICS INTERFACE TO DB2 ARE DIFFERENT.                      CL**5
00012 *                                                                    CL**5
00013 *  IF ANY CHANGES ARE MADE TO THIS MEMBER, BOTH PROGRAMS LISTED      CL**5
00014 *  ABOVE SHOULD BE RECOMPILED.                                       CL**5
00015 ******************************************************************   CL**5
00016 *                                                                    CL**5
00017 *                                                                    CL**5
00018  1100-VALIDATE-INPUT-REQUEST.                                     DPPD010 
00019 ******************************************************************DPPD010 
00020 *  -- VALIDATE THE FOLLOWING INPUT FIELDS:                        DPPD010 
00021 *       -- THE INPUT REQUEST FIELDS (ONE VALID REQUEST MINIMUM)   DPPD010 
00022 *       -- THE SYSTEM CODE (CANNOT BE SPACES)                     DPPD010 
00023 *       -- THE OPERATING COMPANY (CANNOT BE SPACES)               DPPD010 
00024 *       -- THE EFFECTIVE DATE (MUST BE VALID DATE)                DPPD010 
00025 *       -- THE DEPARTMENT (MUST BE NUMERIC)                       DPPD010 
00026 ******************************************************************DPPD010 
00027      EVALUATE TRUE                                                DPPD010 
00028          WHEN DP003-SCL-LOOKUP                                    DPPD010 
00029          WHEN DP003-MCL-LOOKUP                                    DPPD010 
00030          WHEN DP003-DPT-LOOKUP                                    DPPD010 
00031          WHEN DP003-DPT-SEARCH                                    DPPD010 
00032          WHEN DP003-BYR-LOOKUP-NMBR                               DPPD010 
00033          WHEN DP003-BYR-LOOKUP-NAME                               DPPD010 
00034          WHEN DP003-DMM-LOOKUP-NMBR                               DPPD010 
00035          WHEN DP003-DMM-LOOKUP-NAME                               DPPD010 
00036          WHEN DP003-GMM-LOOKUP-NMBR                               DPPD010 
00037          WHEN DP003-GMM-LOOKUP-NAME                               DPPD010 
00038          WHEN DP003-ANL-LOOKUP-NAME                               DPPD010 
00039          WHEN DP003-ANM-LOOKUP-NAME                               DPPD010 
00040               CONTINUE                                            DPPD010 
00041          WHEN OTHER                                               DPPD010 
00042               MOVE PRV-01            TO DP003-RETURN-DATA         DPPD010 
00043      END-EVALUATE.                                                DPPD010 
00044 *                                                                 DPPD010 
00045 *-----------------------------------------------------------------DPPD010 
00046 *  VALIDATE THE SYSTEM CODE                                       DPPD010 
00047 *-----------------------------------------------------------------DPPD010 
00048      IF  DP003-SUCCESSFUL                                         DPPD010 
00049          IF  DP003-SYSTEM-CODE = SPACES                           DPPD010 
00050              MOVE PRV-02             TO DP003-RETURN-DATA         DPPD010 
00051          END-IF                                                   DPPD010 
00052      END-IF.                                                      DPPD010 
00053 *                                                                 DPPD010 
00054 *-----------------------------------------------------------------DPPD010 
00055 *  VALIDATE THE OPERATING COMPANY                                 DPPD010 
00056 *-----------------------------------------------------------------DPPD010 
00057      IF  DP003-SUCCESSFUL                                         DPPD010 
00058          IF  DP003-OP-CO-NMBR = SPACES                            DPPD010 
00059              MOVE PRV-39             TO DP003-RETURN-DATA         DPPD010 
00060          END-IF                                                   DPPD010 
00061      END-IF.                                                      DPPD010 
00062 *                                                                 DPPD010 
00063 *-----------------------------------------------------------------DPPD010 
00064 *  VALIDATE THE CURRENT DATE                                      DPPD010 
00065 *-----------------------------------------------------------------DPPD010 
00066      IF  DP003-SUCCESSFUL                                         DPPD010 
00067          IF  DP003-CURRENT-DATE = SPACES                          DPPD010 
00068              MOVE PRV-03             TO DP003-RETURN-DATA         DPPD010 
00069          END-IF                                                   DPPD010 
00070      END-IF.                                                      DPPD010 
00071 *                                                                 DPPD010 
00072 *-----------------------------------------------------------------DPPD010 
00073 *  VALIDATE THE EFFECTIVE DATE                                    DPPD010 
00074 *-----------------------------------------------------------------DPPD010 
00075      IF  DP003-SUCCESSFUL                                         DPPD010 
00076          IF  DP003-EFF-DATE = SPACES                              DPPD010 
00077              MOVE PRV-04             TO DP003-RETURN-DATA         DPPD010 
00078          ELSE                                                     DPPD010 
00079              PERFORM 1100-VALIDATE-EFF-DATE                       DPPD010 
00080          END-IF                                                   DPPD010 
00081      END-IF.                                                      DPPD010 
00082 *                                                                 DPPD010 
00083 *-----------------------------------------------------------------DPPD010 
00084 *  VALIDATE THE DEPARTMENT INPUT                                  DPPD010 
00085 *-----------------------------------------------------------------DPPD010 
00086      IF  DP003-SUCCESSFUL                                         DPPD010 
00087          IF  DP003-DPT-INPUT NUMERIC                              DPPD010 
00088              CONTINUE                                             DPPD010 
00089          ELSE                                                     DPPD010 
00090              MOVE PRV-13             TO DP003-RETURN-DATA         DPPD010 
00091          END-IF                                                   DPPD010 
00092      END-IF.                                                      DPPD010 
00093 *                                                                 DPPD010 
00094 *                                                                 DPPD010 
00095  1100-VALIDATE-EFF-DATE.                                          DPPD010 
00096 ******************************************************************DPPD010 
00097 *  VALIDATE THE EFFECTIVE DATE USING THE DATE SUBROUTINE.         DPPD010 
00098 ******************************************************************DPPD010 
00099      INITIALIZE DPG51                                             DPPD010 
00100                 DPG52                                             DPPD010 
00101                 DPG53                                             DPPD010 
00102                 DPG54                                             DPPD010 
00103                 DPG55                                             DPPD010 
00104                 DPG56.                                            DPPD010 
00105 *                                                                 DPPD010 
00106      SET DPG51-ACTUAL-CALENDAR-ONLY                               DPPD010 
00107          DPG51-DO-NOT-INCR-DECR-DATE                              DPPD010 
00108          DPG52-LK-DTE-GREG           TO TRUE.                     DPPD010 
00109 *                                                                 DPPD010 
00110      MOVE DP003-CURRENT-DATE         TO DPG51-SYSTEM-DATE.        DPPD010 
00111      MOVE DP003-EFF-DATE-YY          TO DPG52-GREG-DATE-YR-X.     DPPD010 
00112      MOVE DP003-EFF-DATE-MM          TO DPG52-GREG-DATE-MO-X.     DPPD010 
00113      MOVE DP003-EFF-DATE-DD          TO DPG52-GREG-DATE-DY-X.     DPPD010 
00114 *                                                                 DPPD010 
00115      CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                        
00116                                   DPG52                           DPPD010 
00117                                   DPG53                           DPPD010 
00118                                   DPG54                           DPPD010 
00119                                   DPG55                           DPPD010 
00120                                   DPG56.                          DPPD010 
00121 *                                                                 DPPD010 
00122      IF  DPG54-SEVERE-ERROR                                       DPPD010 
00123       OR DPG54-WARNING-ERROR                                      DPPD010 
00124          MOVE PRV-04                 TO DP003-RETURN-DATA         DPPD010 
00125      ELSE                                                         DPPD010 
00126          MOVE DPG55-DB2-ISO-DATE-FMT TO PV-EFF-DATE               DPPD010 
00127      END-IF.                                                      DPPD010 
00128 *                                                                 DPPD010 
00129 *                                                                 DPPD010 
00130  2000-MAIN-PROCESS.                                               DPPD010 
00131 ******************************************************************DPPD010 
00132 *  THIS PROGRAM CHECKS THE INPUT REQUESTS PASSED TO THIS PROGRAM  DPPD010 
00133 *  AND PERFORMS SEPARATE PARAGRAPHS FOR EACH REQUEST.             DPPD010 
00134 ******************************************************************DPPD010 
00135      IF  DP003-SCL-LOOKUP                                         DPPD010 
00136          PERFORM 3000-SCL-LOOKUP                                  DPPD010 
00137      END-IF.                                                      DPPD010 
00138 *                                                                 DPPD010 
00139      IF  DP003-MCL-LOOKUP                                         DPPD010 
00140          PERFORM 3100-MCL-LOOKUP                                  DPPD010 
00141      END-IF.                                                      DPPD010 
00142 *                                                                 DPPD010 
00143      IF  DP003-DPT-LOOKUP                                         DPPD010 
00144          PERFORM 3200-DPT-LOOKUP                                  DPPD010 
00145      END-IF.                                                      DPPD010 
00146 *                                                                 DPPD010 
00147      IF  DP003-DPT-SEARCH                                         DPPD010 
00148          PERFORM 3300-DPT-SEARCH                                  DPPD010 
00149      END-IF.                                                      DPPD010 
00150 *                                                                 DPPD010 
00151      IF  DP003-BYR-LOOKUP-NMBR                                    DPPD010 
00152       OR DP003-BYR-LOOKUP-NAME                                    DPPD010 
00153          PERFORM 3400-BYR-LOOKUP                                  DPPD010 
00154      END-IF.                                                      DPPD010 
00155 *                                                                 DPPD010 
00156      IF  DP003-DMM-LOOKUP-NMBR                                    DPPD010 
00157       OR DP003-DMM-LOOKUP-NAME                                    DPPD010 
00158          PERFORM 3500-DMM-LOOKUP                                  DPPD010 
00159      END-IF.                                                      DPPD010 
00160 *                                                                 DPPD010 
00161      IF  DP003-GMM-LOOKUP-NMBR                                    DPPD010 
00162       OR DP003-GMM-LOOKUP-NAME                                    DPPD010 
00163          PERFORM 3600-GMM-LOOKUP                                  DPPD010 
00164      END-IF.                                                      DPPD010 
00165 *                                                                 DPPD010 
00166      IF  DP003-ANL-LOOKUP-NAME                                    DPPD010 
00167          PERFORM 3700-ANL-LOOKUP                                  DPPD010 
00168      END-IF.                                                      DPPD010 
00169 *                                                                 DPPD010 
00170      IF  DP003-ANM-LOOKUP-NAME                                    DPPD010 
00171          PERFORM 3800-ANM-LOOKUP                                  DPPD010 
00172      END-IF.                                                      DPPD010 
00173 *                                                                 DPPD010 
00174      SET PS-DONE-PROCESSING          TO TRUE.                     DPPD010 
00175 *                                                                 DPPD010 
00176 *                                                                 DPPD010 
00177  3000-SCL-LOOKUP.                                                 DPPD010 
00178 ******************************************************************DPPD010 
00179 *  IF THE SUBCLASS (SCL) IS NUMERIC, SET UP THE FIELDS FOR THE    DPPD010 
00180 *  DB2 CALL AND PERFORM THE CALL.                                 DPPD010 
00181 ******************************************************************DPPD010 
00182      IF  DP003-SCL-INPUT NUMERIC                                  DPPD010 
00183          IF  DP003-MCL-INPUT NUMERIC                              DPPD010 
00184              MOVE DP003-OP-CO-NMBR   TO MDSEAR-OPERCO-NBR         DPPD010 
00185              MOVE DP003-DPT-INPUT    TO MDSEAR-DEPT-NBR           DPPD010 
00186              MOVE DP003-SCL-INPUT    TO MDSEAR-SUB-CL-NBR         DPPD010 
00187              MOVE PC-MDSELV-SCL      TO MDSEAR-MDSELV-CDE         DPPD010 
00188              MOVE DP003-SYSTEM-CODE  TO APLAVL-APLSYS-CDE         DPPD010 
00189              PERFORM 3010-GET-SCL-DESC                            DPPD010 
00190          ELSE                                                     DPPD010 
00191              MOVE PRV-09             TO DP003-RETURN-DATA         DPPD010 
00192          END-IF                                                   DPPD010 
00193      ELSE                                                         DPPD010 
00194          MOVE PRV-05                 TO DP003-RETURN-DATA         DPPD010 
00195      END-IF.                                                      DPPD010 
00196 *                                                                 DPPD010 
00197 *                                                                 DPPD010 
00198  3010-GET-SCL-DESC.                                               DPPD010 
00199 ******************************************************************DPPD010 
00200 *  GET THE SUBCLASS (SCL) DESCRIPTION                             DPPD010 
00201 ******************************************************************DPPD010 
00202      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00203 *                                                                 DPPD010 
00204      PERFORM                                                      DPPD010 
00205         WITH TEST AFTER                                           DPPD010 
00206           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00207             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00208                OR PS-DB2-CALL-DONE                                DPPD010 
00209                                                                   DPPD010 
00210         EXEC SQL                                                  DPPD010 
00211              SELECT MDSEAR_DESC                                   DPPD010 
00212                INTO :MDSEAR-DESC                                  DPPD010 
00213                FROM TMDSEAR A,                                    DPPD010 
00214                     TAPLAVL B                                     DPPD010 
00215               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00216                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00217                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR              DPPD010 
00218                 AND SUB_CL_NBR    = :MDSEAR-SUB-CL-NBR            DPPD010 
00219                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00220                 AND (:PV-EFF-DATE                                 DPPD010 
00221                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00222                                  AND CHAR(END_DTE,ISO))           DPPD010 
00223                 AND (:PV-EFF-DATE                                 DPPD010 
00224                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00225                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00226                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00227         END-EXEC                                                  DPPD010 
00228                                                                   DPPD010 
00229         EVALUATE TRUE                                             DPPD010 
00230             WHEN SQLCODE = ZERO                                   DPPD010 
00231                  MOVE MDSEAR-DESC    TO DP003-SCL-DESCRIPTION     DPPD010 
00232                  SET PS-DB2-CALL-DONE                             DPPD010 
00233                                      TO TRUE                      DPPD010 
00234             WHEN SQLCODE = +100                                   DPPD010 
00235                  MOVE PRV-06         TO DP003-RETURN-DATA         DPPD010 
00236                  SET PS-DB2-CALL-DONE                             DPPD010 
00237                                      TO TRUE                      DPPD010 
00238             WHEN SQLCODE = -904                                   DPPD010 
00239             WHEN SQLCODE = -911                                   DPPD010 
00240                  CONTINUE                                         DPPD010 
00241             WHEN OTHER                                            DPPD010 
00242                  MOVE PRV-07         TO DP003-RETURN-DATA         DPPD010 
00243                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00244                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00245                  SET PS-DB2-CALL-DONE                             DPPD010 
00246                                      TO TRUE                      DPPD010 
00247         END-EVALUATE                                              DPPD010 
00248      END-PERFORM.                                                 DPPD010 
00249 *                                                                 DPPD010 
00250      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00251          MOVE PRV-08                 TO DP003-RETURN-DATA         DPPD010 
00252          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00253          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00254      END-IF.                                                      DPPD010 
00255 *                                                                 DPPD010 
00256 *                                                                 DPPD010 
00257  3100-MCL-LOOKUP.                                                 DPPD010 
00258 ******************************************************************DPPD010 
00259 *  IF THE MAJOR CLASS (MCL) IS NUMERIC, SET UP THE FIELDS FOR     DPPD010 
00260 *  THE DB2 CALL AND PERFORM THE CALL.                             DPPD010 
00261 ******************************************************************DPPD010 
00262      IF  DP003-MCL-INPUT NUMERIC                                  DPPD010 
00263          MOVE DP003-OP-CO-NMBR       TO MDSEAR-OPERCO-NBR         DPPD010 
00264          MOVE DP003-DPT-INPUT        TO MDSEAR-DEPT-NBR           DPPD010 
00265          MOVE DP003-MCL-INPUT        TO MDSEAR-MAJ-CL-NBR         DPPD010 
00266          MOVE PC-MDSELV-MCL          TO MDSEAR-MDSELV-CDE         DPPD010 
00267          MOVE DP003-SYSTEM-CODE      TO APLAVL-APLSYS-CDE         DPPD010 
00268          PERFORM 3110-GET-MCL-DESC                                DPPD010 
00269      ELSE                                                         DPPD010 
00270          MOVE PRV-09                 TO DP003-RETURN-DATA         DPPD010 
00271      END-IF.                                                      DPPD010 
00272 *                                                                 DPPD010 
00273 *                                                                 DPPD010 
00274  3110-GET-MCL-DESC.                                               DPPD010 
00275 ******************************************************************DPPD010 
00276 *  GET THE MAJOR CLASS (MCL) DESCRIPTION                          DPPD010 
00277 ******************************************************************DPPD010 
00278      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00279 *                                                                 DPPD010 
00280      PERFORM                                                      DPPD010 
00281         WITH TEST AFTER                                           DPPD010 
00282           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00283             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00284                OR PS-DB2-CALL-DONE                                DPPD010 
00285                                                                   DPPD010 
00286         EXEC SQL                                                  DPPD010 
00287              SELECT MDSEAR_DESC                                   DPPD010 
00288                INTO :MDSEAR-DESC                                  DPPD010 
00289                FROM TMDSEAR A,                                    DPPD010 
00290                     TAPLAVL B                                     DPPD010 
00291               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00292                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00293                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR              DPPD010 
00294                 AND MAJ_CL_NBR    = :MDSEAR-MAJ-CL-NBR            DPPD010 
00295                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00296                 AND (:PV-EFF-DATE                                 DPPD010 
00297                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00298                                  AND CHAR(END_DTE,ISO))           DPPD010 
00299                 AND (:PV-EFF-DATE                                 DPPD010 
00300                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00301                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00302                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00303         END-EXEC                                                  DPPD010 
00304                                                                   DPPD010 
00305         EVALUATE TRUE                                             DPPD010 
00306             WHEN SQLCODE = ZERO                                   DPPD010 
00307                  MOVE MDSEAR-DESC    TO DP003-MCL-DESCRIPTION     DPPD010 
00308                  SET PS-DB2-CALL-DONE                             DPPD010 
00309                                      TO TRUE                      DPPD010 
00310             WHEN SQLCODE = +100                                   DPPD010 
00311                  MOVE PRV-10         TO DP003-RETURN-DATA         DPPD010 
00312                  SET PS-DB2-CALL-DONE                             DPPD010 
00313                                      TO TRUE                      DPPD010 
00314             WHEN SQLCODE = -904                                   DPPD010 
00315             WHEN SQLCODE = -911                                   DPPD010 
00316                  CONTINUE                                         DPPD010 
00317             WHEN OTHER                                            DPPD010 
00318                  MOVE PRV-11         TO DP003-RETURN-DATA         DPPD010 
00319                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00320                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00321                  SET PS-DB2-CALL-DONE                             DPPD010 
00322                                      TO TRUE                      DPPD010 
00323         END-EVALUATE                                              DPPD010 
00324      END-PERFORM.                                                 DPPD010 
00325 *                                                                 DPPD010 
00326      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00327          MOVE PRV-12                 TO DP003-RETURN-DATA         DPPD010 
00328          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00329          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00330      END-IF.                                                      DPPD010 
00331 *                                                                 DPPD010 
00332 *                                                                 DPPD010 
00333  3200-DPT-LOOKUP.                                                 DPPD010 
00334 ******************************************************************DPPD010 
00335 *  SET UP THE FIELDS FOR THE DB2 CALL AND PERFORM THE CALL.       DPPD010 
00336 ******************************************************************DPPD010 
00337      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR.        DPPD010 
00338      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR.          DPPD010 
00339      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE.        DPPD010 
00340      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE.        DPPD010 
00341 *                                                                 DPPD010 
00342      PERFORM 3210-GET-DPT-DESC.                                   DPPD010 
00343 *                                                                 DPPD010 
00344 *                                                                 DPPD010 
00345  3210-GET-DPT-DESC.                                               DPPD010 
00346 ******************************************************************DPPD010 
00347 *  GET THE DEPARTMENT (DPT) DESCRIPTION                           DPPD010 
00348 ******************************************************************DPPD010 
00349      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00350 *                                                                 DPPD010 
00351      PERFORM                                                      DPPD010 
00352         WITH TEST AFTER                                           DPPD010 
00353           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00354             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00355                OR PS-DB2-CALL-DONE                                DPPD010 
00356                                                                   DPPD010 
00357         EXEC SQL                                                  DPPD010 
00358              SELECT MDSEAR_DESC                                   DPPD010 
00359                INTO :MDSEAR-DESC                                  DPPD010 
00360                FROM TMDSEAR A,                                    DPPD010 
00361                     TAPLAVL B                                     DPPD010 
00362               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00363                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00364                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR              DPPD010 
00365                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00366                 AND (:PV-EFF-DATE                                 DPPD010 
00367                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00368                                  AND CHAR(END_DTE,ISO))           DPPD010 
00369                 AND (:PV-EFF-DATE                                 DPPD010 
00370                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00371                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00372                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00373         END-EXEC                                                  DPPD010 
00374                                                                   DPPD010 
00375         EVALUATE TRUE                                             DPPD010 
00376             WHEN SQLCODE = ZERO                                   DPPD010 
00377                  MOVE MDSEAR-DESC    TO DP003-DPT-DESCRIPTION     DPPD010 
00378                  SET PS-DB2-CALL-DONE                             DPPD010 
00379                                      TO TRUE                      DPPD010 
00380             WHEN SQLCODE = +100                                   DPPD010 
00381                  MOVE PRV-14         TO DP003-RETURN-DATA         DPPD010 
00382                  SET PS-DB2-CALL-DONE                             DPPD010 
00383                                      TO TRUE                      DPPD010 
00384             WHEN SQLCODE = -904                                   DPPD010 
00385             WHEN SQLCODE = -911                                   DPPD010 
00386                  CONTINUE                                         DPPD010 
00387             WHEN OTHER                                            DPPD010 
00388                  MOVE PRV-15         TO DP003-RETURN-DATA         DPPD010 
00389                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00390                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00391                  SET PS-DB2-CALL-DONE                             DPPD010 
00392                                      TO TRUE                      DPPD010 
00393         END-EVALUATE                                              DPPD010 
00394      END-PERFORM.                                                 DPPD010 
00395 *                                                                 DPPD010 
00396      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00397          MOVE PRV-16                 TO DP003-RETURN-DATA         DPPD010 
00398          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00399          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00400      END-IF.                                                      DPPD010 
00401 *                                                                 DPPD010 
00402 *                                                                 DPPD010 
00403  3300-DPT-SEARCH.                                                 DPPD010 
00404 ******************************************************************DPPD010 
00405 *  GET ALL THE DEPARTMENTS FOR A BUYER.  THE INPUT TO THIS        DPPD010 
00406 *  SECTION WILL BE A DEPARTMENT NUMBER, NOT A BUYER NUMBER, SO    DPPD010 
00407 *          -----------------------------------------------        DPPD010 
00408 *  THIS SECTION MUST FIRST DETERMINE WHAT BUYER IS RESPONSIBLE    DPPD010 
00409 *  FOR THE DEPARTMENT INPUT, THEN GO GET ALL THE DEPARTMENTS      DPPD010 
00410 *  FOR THE BUYER.                                                 DPPD010 
00411 ******************************************************************DPPD010 
00412      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR.        DPPD010 
00413      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR.          DPPD010 
00414      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE.        DPPD010 
00415      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE.        DPPD010 
00416 *                                                                 DPPD010 
00417      IF  DP003-BYR-NMBR = SPACES                                  DPPD010 
00418          PERFORM 3420-GET-BYR-NMBR                                DPPD010 
00419      END-IF.                                                      DPPD010 
00420 *                                                                 DPPD010 
00421      IF  DP003-BYR-NMBR = SPACES                                  DPPD010 
00422          CONTINUE                                                 DPPD010 
00423      ELSE                                                         DPPD010 
00424          MOVE DP003-BYR-NMBR         TO MDSEAR-BYR-NBR            DPPD010 
00425          PERFORM 3310-OPEN-DPT-CSR                                DPPD010 
00426          IF  PS-OPEN-OK                                           DPPD010 
00427              INITIALIZE PS-FETCH-DONE-SW                          DPPD010 
00428              SET DP003-DPTX          TO 1                         DPPD010 
00429              PERFORM 3320-FETCH-DPT-CSR                           DPPD010 
00430                UNTIL PS-FETCH-DONE                                DPPD010 
00431              PERFORM 3330-CLOSE-DPT-CSR                           DPPD010 
00432          END-IF                                                   DPPD010 
00433      END-IF.                                                      DPPD010 
00434 *                                                                 DPPD010 
00435 *                                                                 DPPD010 
00436  3310-OPEN-DPT-CSR.                                               DPPD010 
00437 ******************************************************************DPPD010 
00438 *  OPEN THE DPT_CSR.                                              DPPD010 
00439 ******************************************************************DPPD010 
00440      EXEC SQL                                                     DPPD010 
00441           OPEN DPT_CSR                                            DPPD010 
00442      END-EXEC.                                                    DPPD010 
00443 *                                                                 DPPD010 
00444      EVALUATE TRUE                                                DPPD010 
00445          WHEN SQLCODE = ZERO                                      DPPD010 
00446               SET PS-OPEN-OK         TO TRUE                      DPPD010 
00447          WHEN OTHER                                               DPPD010 
00448               SET PS-OPEN-NOT-OK     TO TRUE                      DPPD010 
00449               MOVE PRV-17            TO DP003-RETURN-DATA         DPPD010 
00450               MOVE SQLCA             TO DP003-SQLCA               DPPD010 
00451               MOVE SQLCODE           TO DP003-SQLCODE             DPPD010 
00452      END-EVALUATE.                                                DPPD010 
00453 *                                                                 DPPD010 
00454 *                                                                 DPPD010 
00455  3320-FETCH-DPT-CSR.                                              DPPD010 
00456 ******************************************************************DPPD010 
00457 *  FETCH THE NEXT ROW ON THE RESULTS TABLE USING THE DPT_CSR      DPPD010 
00458 ******************************************************************DPPD010 
00459      EXEC SQL                                                     DPPD010 
00460           FETCH DPT_CSR                                           DPPD010 
00461            INTO :MDSEAR-DEPT-NBR                                  DPPD010 
00462      END-EXEC.                                                    DPPD010 
00463 *                                                                 DPPD010 
00464      EVALUATE TRUE                                                DPPD010 
00465          WHEN SQLCODE = ZERO                                      DPPD010 
00466               IF  DP003-DPTX > 20                                 DPPD010 
00467                   SET PS-FETCH-DONE  TO TRUE                      DPPD010 
00468                   MOVE PRV-18        TO DP003-RETURN-DATA         DPPD010 
00469               ELSE                                                DPPD010 
00470                   MOVE MDSEAR-DEPT-NBR                            DPPD010 
00471                                      TO DP003-DPT (DP003-DPTX)    DPPD010 
00472                   ADD 1              TO DP003-DPT-COUNT           DPPD010 
00473                   SET DP003-DPTX UP BY 1                          DPPD010 
00474               END-IF                                              DPPD010 
00475          WHEN SQLCODE = +100                                      DPPD010 
00476               SET PS-FETCH-DONE      TO TRUE                      DPPD010 
00477          WHEN OTHER                                               DPPD010 
00478               SET PS-FETCH-DONE      TO TRUE                      DPPD010 
00479               MOVE PRV-19            TO DP003-RETURN-DATA         DPPD010 
00480               MOVE SQLCA             TO DP003-SQLCA               DPPD010 
00481               MOVE SQLCODE           TO DP003-SQLCODE             DPPD010 
00482      END-EVALUATE.                                                DPPD010 
00483 *                                                                 DPPD010 
00484 *                                                                 DPPD010 
00485  3330-CLOSE-DPT-CSR.                                              DPPD010 
00486 ******************************************************************DPPD010 
00487 *  CLOSE THE DPT_CSR.                                             DPPD010 
00488 ******************************************************************DPPD010 
00489      EXEC SQL                                                     DPPD010 
00490           CLOSE DPT_CSR                                           DPPD010 
00491      END-EXEC.                                                    DPPD010 
00492 *                                                                 DPPD010 
00493      EVALUATE TRUE                                                DPPD010 
00494          WHEN SQLCODE = ZERO                                      DPPD010 
00495               CONTINUE                                            DPPD010 
00496          WHEN OTHER                                               DPPD010 
00497               MOVE PRV-20            TO DP003-RETURN-DATA         DPPD010 
00498               MOVE SQLCA             TO DP003-SQLCA               DPPD010 
00499               MOVE SQLCODE           TO DP003-SQLCODE             DPPD010 
00500      END-EVALUATE.                                                DPPD010 
00501 *                                                                 DPPD010 
00502 *                                                                 DPPD010 
00503  3400-BYR-LOOKUP.                                                 DPPD010 
00504 ******************************************************************DPPD010 
00505 *  GET THE BUYER (BYR) NAME AND/OR NUMBER                         DPPD010 
00506 ******************************************************************DPPD010 
00507      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR         DPPD010 
00508      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR           DPPD010 
00509      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE         DPPD010 
00510      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE         DPPD010 
00511      MOVE PC-RSPLVL-CDE-BYR          TO RSPBAR-RSPLVL-CDE         DPPD010 
00512 *                                                                 DPPD010 
00513      IF  DP003-BYR-LOOKUP-NAME                                    DPPD010 
00514          PERFORM 3410-GET-BYR-NAME                                DPPD010 
00515      ELSE                                                         DPPD010 
00516          PERFORM 3420-GET-BYR-NMBR                                DPPD010 
00517      END-IF.                                                      DPPD010 
00518 *                                                                 DPPD010 
00519 *                                                                 DPPD010 
00520  3410-GET-BYR-NAME.                                               DPPD010 
00521 ******************************************************************DPPD010 
00522 *  GET THE BUYER (BYR) NAME AND NUMBER                            DPPD010 
00523 ******************************************************************DPPD010 
00524      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00525 *                                                                 DPPD010 
00526      PERFORM                                                      DPPD010 
00527         WITH TEST AFTER                                           DPPD010 
00528           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00529             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00530                OR PS-DB2-CALL-DONE                                DPPD010 
00531                                                                   DPPD010 
00532         EXEC SQL                                                  DPPD010 
00533              SELECT BYR_NBR,                                      DPPD010 
00534                     WORKER_FIR_NAME,                              DPPD010 
00535                     WORKER_LAST_NAME                              DPPD010 
00536                INTO :MDSEAR-BYR-NBR,                              DPPD010 
00537                     :RSPBAR-WORKER-FIR-NAME,                      DPPD010 
00538                     :RSPBAR-WORKER-LAST-NAME                      DPPD010 
00539                FROM TMDSEAR A,                                    DPPD010 
00540                     TAPLAVL B,                                    DPPD010 
00541                     TRSPBAR C                                     DPPD010 
00542               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00543                 AND A.MDSEAR_DKEY = C.MDSEAR_DKEY                 DPPD010 
00544                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00545                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR              DPPD010 
00546                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00547                 AND (:PV-EFF-DATE                                 DPPD010 
00548                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00549                                  AND CHAR(END_DTE,ISO))           DPPD010 
00550                 AND (:PV-EFF-DATE                                 DPPD010 
00551                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00552                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00553                 AND (:PV-EFF-DATE                                 DPPD010 
00554                              BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)  DPPD010 
00555                                  AND CHAR(C.WORKER_END_DTE,ISO))  DPPD010 
00556                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00557                 AND C.RSPLVL_CDE  = :RSPBAR-RSPLVL-CDE            DPPD010 
00558         END-EXEC                                                  DPPD010 
00559                                                                   DPPD010 
00560         EVALUATE TRUE                                             DPPD010 
00561             WHEN SQLCODE = ZERO                                   DPPD010 
00562                  MOVE MDSEAR-BYR-NBR TO DP003-BYR-NMBR            DPPD010 
00563                  PERFORM 3415-STRING-BYR-NAME                     DPPD010 
00564                  SET PS-DB2-CALL-DONE                             DPPD010 
00565                                      TO TRUE                      DPPD010 
00566             WHEN SQLCODE = +100                                   DPPD010 
00567                  MOVE PRV-21         TO DP003-RETURN-DATA         DPPD010 
00568                  SET PS-DB2-CALL-DONE                             DPPD010 
00569                                      TO TRUE                      DPPD010 
00570             WHEN SQLCODE = -904                                   DPPD010 
00571             WHEN SQLCODE = -911                                   DPPD010 
00572                  CONTINUE                                         DPPD010 
00573             WHEN OTHER                                            DPPD010 
00574                  MOVE PRV-22         TO DP003-RETURN-DATA         DPPD010 
00575                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00576                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00577                  SET PS-DB2-CALL-DONE                             DPPD010 
00578                                      TO TRUE                      DPPD010 
00579         END-EVALUATE                                              DPPD010 
00580      END-PERFORM.                                                 DPPD010 
00581 *                                                                 DPPD010 
00582      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00583          MOVE PRV-23                 TO DP003-RETURN-DATA         DPPD010 
00584          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00585          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00586      END-IF.                                                      DPPD010 
00587 *                                                                 DPPD010 
00588 *                                                                 DPPD010 
00589  3415-STRING-BYR-NAME.                                            DPPD010 
00590 ******************************************************************DPPD010 
00591 *  STRING THE BUYER NAME                                          DPPD010 
00592 ******************************************************************DPPD010 
00593      EVALUATE TRUE                                                DPPD010 
00594          WHEN DP003-BYR-NAME-LAST-ONLY                            DPPD010 
00595               MOVE RSPBAR-WORKER-LAST-NAME                        DPPD010 
00596                                      TO DP003-BYR-NAME            DPPD010 
00597          WHEN DP003-BYR-NAME-LAST-FIRST                           DPPD010 
00598               STRING RSPBAR-WORKER-LAST-NAME DELIMITED BY '  '    DPPD010 
00599                      ', '                    DELIMITED BY SIZE    DPPD010 
00600                      RSPBAR-WORKER-FIR-NAME  DELIMITED BY SIZE    DPPD010 
00601                 INTO DP003-BYR-NAME                               DPPD010 
00602               END-STRING                                          DPPD010 
00603          WHEN OTHER                                               DPPD010 
00604               STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY '  '    DPPD010 
00605                      SPACE                   DELIMITED BY SIZE    DPPD010 
00606                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE    DPPD010 
00607                 INTO DP003-BYR-NAME                               DPPD010 
00608               END-STRING                                          DPPD010 
00609      END-EVALUATE.                                                DPPD010 
00610 *                                                                 DPPD010 
00611 *                                                                 DPPD010 
00612  3420-GET-BYR-NMBR.                                               DPPD010 
00613 ******************************************************************DPPD010 
00614 *  GET THE BUYER (BYR) NUMBER                                     DPPD010 
00615 ******************************************************************DPPD010 
00616      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00617 *                                                                 DPPD010 
00618      PERFORM                                                      DPPD010 
00619         WITH TEST AFTER                                           DPPD010 
00620           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00621             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00622                OR PS-DB2-CALL-DONE                                DPPD010 
00623                                                                   DPPD010 
00624         EXEC SQL                                                  DPPD010 
00625              SELECT BYR_NBR                                       DPPD010 
00626                INTO :MDSEAR-BYR-NBR                               DPPD010 
00627                FROM TMDSEAR A,                                    DPPD010 
00628                     TAPLAVL B                                     DPPD010 
00629               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00630                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00631                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR              DPPD010 
00632                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00633                 AND (:PV-EFF-DATE                                 DPPD010 
00634                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00635                                  AND CHAR(END_DTE,ISO))           DPPD010 
00636                 AND (:PV-EFF-DATE                                 DPPD010 
00637                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00638                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00639                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00640         END-EXEC                                                  DPPD010 
00641                                                                   DPPD010 
00642         EVALUATE TRUE                                             DPPD010 
00643             WHEN SQLCODE = ZERO                                   DPPD010 
00644                  MOVE MDSEAR-BYR-NBR TO DP003-BYR-NMBR            DPPD010 
00645                  SET PS-DB2-CALL-DONE                             DPPD010 
00646                                      TO TRUE                      DPPD010 
00647             WHEN SQLCODE = +100                                   DPPD010 
00648                  MOVE PRV-24         TO DP003-RETURN-DATA         DPPD010 
00649                  SET PS-DB2-CALL-DONE                             DPPD010 
00650                                      TO TRUE                      DPPD010 
00651             WHEN SQLCODE = -904                                   DPPD010 
00652             WHEN SQLCODE = -911                                   DPPD010 
00653                  CONTINUE                                         DPPD010 
00654             WHEN OTHER                                            DPPD010 
00655                  MOVE PRV-25         TO DP003-RETURN-DATA         DPPD010 
00656                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00657                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00658                  SET PS-DB2-CALL-DONE                             DPPD010 
00659                                      TO TRUE                      DPPD010 
00660         END-EVALUATE                                              DPPD010 
00661      END-PERFORM.                                                 DPPD010 
00662 *                                                                 DPPD010 
00663      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00664          MOVE PRV-26                 TO DP003-RETURN-DATA         DPPD010 
00665          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00666          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00667      END-IF.                                                      DPPD010 
00668 *                                                                 DPPD010 
00669 *                                                                 DPPD010 
00670  3500-DMM-LOOKUP.                                                 DPPD010 
00671 ******************************************************************DPPD010 
00672 *  GET THE DMM NAME AND/OR NUMBER                                 DPPD010 
00673 ******************************************************************DPPD010 
00674      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR.        DPPD010 
00675      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR.          DPPD010 
00676      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE.        DPPD010 
00677      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE.        DPPD010 
00678 *                                                                 DPPD010 
00679      PERFORM 3510-GET-DMM-FOR-DPT.                                DPPD010 
00680 *                                                                    CL**4
00681      IF  SQLCODE = ZERO                                              CL**4
00682          MOVE MDSEAR-DMA-NBR         TO DP003-DMM-NMBR               CL**4
00683          IF  DP003-DMM-LOOKUP-NAME                                   CL**4
00684              MOVE PC-MDSELV-DMA      TO MDSEAR-MDSELV-CDE            CL**4
00685              MOVE PC-RSPLVL-CDE-DMM  TO RSPBAR-RSPLVL-CDE            CL**4
00686              PERFORM 3520-GET-DMM-NAME                               CL**4
00687          END-IF                                                      CL**4
00688      END-IF.                                                         CL**4
00689 *                                                                 DPPD010 
00690 *                                                                 DPPD010 
00691  3510-GET-DMM-FOR-DPT.                                            DPPD010 
00692 ******************************************************************DPPD010 
00693 *  GET THE DMM NMBR FOR THE DEPARTMENT                            DPPD010 
00694 ******************************************************************DPPD010 
00695      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00696 *                                                                 DPPD010 
00697      PERFORM                                                      DPPD010 
00698         WITH TEST AFTER                                           DPPD010 
00699           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00700             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00701                OR PS-DB2-CALL-DONE                                DPPD010 
00702                                                                   DPPD010 
00703         EXEC SQL                                                  DPPD010 
00704              SELECT DMA_NBR                                       DPPD010 
00705                INTO :MDSEAR-DMA-NBR                               DPPD010 
00706                FROM TMDSEAR A,                                    DPPD010 
00707                     TAPLAVL B                                     DPPD010 
00708               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00709                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00710                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR              DPPD010 
00711                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00712                 AND (:PV-EFF-DATE                                 DPPD010 
00713                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00714                                  AND CHAR(END_DTE,ISO))           DPPD010 
00715                 AND (:PV-EFF-DATE                                 DPPD010 
00716                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00717                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00718                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00719         END-EXEC                                                  DPPD010 
00720                                                                   DPPD010 
00721         EVALUATE TRUE                                             DPPD010 
00722             WHEN SQLCODE = ZERO                                   DPPD010 
00723                  SET PS-DB2-CALL-DONE                             DPPD010 
00724                                      TO TRUE                      DPPD010 
00725             WHEN SQLCODE = +100                                   DPPD010 
00726                  MOVE PRV-27         TO DP003-RETURN-DATA         DPPD010 
00727                  SET PS-DB2-CALL-DONE                             DPPD010 
00728                                      TO TRUE                      DPPD010 
00729             WHEN SQLCODE = -904                                   DPPD010 
00730             WHEN SQLCODE = -911                                   DPPD010 
00731                  CONTINUE                                         DPPD010 
00732             WHEN OTHER                                            DPPD010 
00733                  MOVE PRV-28         TO DP003-RETURN-DATA         DPPD010 
00734                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00735                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00736                  SET PS-DB2-CALL-DONE                             DPPD010 
00737                                      TO TRUE                      DPPD010 
00738         END-EVALUATE                                              DPPD010 
00739      END-PERFORM.                                                 DPPD010 
00740 *                                                                 DPPD010 
00741      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00742          MOVE PRV-29                 TO DP003-RETURN-DATA         DPPD010 
00743          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00744          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00745      END-IF.                                                      DPPD010 
00746 *                                                                 DPPD010 
00747 *                                                                 DPPD010 
00748  3520-GET-DMM-NAME.                                               DPPD010 
00749 ******************************************************************DPPD010 
00750 *  GET THE DMM NAME AND NUMBER                                    DPPD010 
00751 ******************************************************************DPPD010 
00752      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00753 *                                                                 DPPD010 
00754      PERFORM                                                      DPPD010 
00755         WITH TEST AFTER                                           DPPD010 
00756           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00757             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00758                OR PS-DB2-CALL-DONE                                DPPD010 
00759                                                                   DPPD010 
00760         EXEC SQL                                                  DPPD010 
00761              SELECT WORKER_FIR_NAME,                              DPPD010 
00762                     WORKER_LAST_NAME                              DPPD010 
00763                INTO :RSPBAR-WORKER-FIR-NAME,                      DPPD010 
00764                     :RSPBAR-WORKER-LAST-NAME                      DPPD010 
00765                FROM TMDSEAR A,                                    DPPD010 
00766                     TAPLAVL B,                                    DPPD010 
00767                     TRSPBAR C                                     DPPD010 
00768               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00769                 AND A.MDSEAR_DKEY = C.MDSEAR_DKEY                 DPPD010 
00770                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00771                 AND DMA_NBR       = :MDSEAR-DMA-NBR               DPPD010 
00772                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00773                 AND (:PV-EFF-DATE                                 DPPD010 
00774                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00775                                  AND CHAR(END_DTE,ISO))           DPPD010 
00776                 AND (:PV-EFF-DATE                                 DPPD010 
00777                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00778                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00779                 AND (:PV-EFF-DATE                                 DPPD010 
00780                              BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)  DPPD010 
00781                                  AND CHAR(C.WORKER_END_DTE,ISO))  DPPD010 
00782                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00783                 AND C.RSPLVL_CDE  = :RSPBAR-RSPLVL-CDE            DPPD010 
00784         END-EXEC                                                  DPPD010 
00785                                                                   DPPD010 
00786         EVALUATE TRUE                                             DPPD010 
00787             WHEN SQLCODE = ZERO                                   DPPD010 
00788                  PERFORM 3525-STRING-DMM-NAME                     DPPD010 
00789                  SET PS-DB2-CALL-DONE                             DPPD010 
00790                                      TO TRUE                      DPPD010 
00791             WHEN SQLCODE = +100                                   DPPD010 
00792                  MOVE PRV-30         TO DP003-RETURN-DATA         DPPD010 
00793                  SET PS-DB2-CALL-DONE                             DPPD010 
00794                                      TO TRUE                      DPPD010 
00795             WHEN SQLCODE = -904                                   DPPD010 
00796             WHEN SQLCODE = -911                                   DPPD010 
00797                  CONTINUE                                         DPPD010 
00798             WHEN OTHER                                            DPPD010 
00799                  MOVE PRV-31         TO DP003-RETURN-DATA         DPPD010 
00800                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00801                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00802                  SET PS-DB2-CALL-DONE                             DPPD010 
00803                                      TO TRUE                      DPPD010 
00804         END-EVALUATE                                              DPPD010 
00805      END-PERFORM.                                                 DPPD010 
00806 *                                                                 DPPD010 
00807      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00808          MOVE PRV-32                 TO DP003-RETURN-DATA         DPPD010 
00809          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00810          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00811      END-IF.                                                      DPPD010 
00812 *                                                                 DPPD010 
00813 *                                                                 DPPD010 
00814  3525-STRING-DMM-NAME.                                            DPPD010 
00815 ******************************************************************DPPD010 
00816 *  STRING THE DMM NAME                                            DPPD010 
00817 ******************************************************************DPPD010 
00818      EVALUATE TRUE                                                DPPD010 
00819          WHEN DP003-DMM-NAME-LAST-ONLY                            DPPD010 
00820               MOVE RSPBAR-WORKER-LAST-NAME                        DPPD010 
00821                                      TO DP003-DMM-NAME            DPPD010 
00822          WHEN DP003-DMM-NAME-LAST-FIRST                           DPPD010 
00823               STRING RSPBAR-WORKER-LAST-NAME DELIMITED BY '  '    DPPD010 
00824                      ', '                    DELIMITED BY SIZE    DPPD010 
00825                      RSPBAR-WORKER-FIR-NAME  DELIMITED BY SIZE    DPPD010 
00826                 INTO DP003-DMM-NAME                               DPPD010 
00827               END-STRING                                          DPPD010 
00828          WHEN OTHER                                               DPPD010 
00829               STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY '  '    DPPD010 
00830                      SPACE                   DELIMITED BY SIZE    DPPD010 
00831                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE    DPPD010 
00832                 INTO DP003-DMM-NAME                               DPPD010 
00833               END-STRING                                          DPPD010 
00834      END-EVALUATE.                                                DPPD010 
00835 *                                                                 DPPD010 
00836 *                                                                 DPPD010 
00837  3600-GMM-LOOKUP.                                                 DPPD010 
00838 ******************************************************************DPPD010 
00839 *  GET THE GMM NAME AND/OR NUMBER                                 DPPD010 
00840 ******************************************************************DPPD010 
00841      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR.        DPPD010 
00842      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR.          DPPD010 
00843      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE.        DPPD010 
00844      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE.        DPPD010 
00845 *                                                                 DPPD010 
00846      PERFORM 3610-GET-GMA-FOR-DPT.                                   CL**4
00847 *                                                                    CL**4
00848      IF  SQLCODE = ZERO                                              CL**4
00849          MOVE MDSEAR-GMA-NBR         TO DP003-GMM-NMBR               CL**4
00850          IF  DP003-GMM-LOOKUP-NAME                                   CL**4
00851              MOVE PC-MDSELV-GMA      TO MDSEAR-MDSELV-CDE            CL**4
00852              MOVE PC-RSPLVL-CDE-GMM  TO RSPBAR-RSPLVL-CDE            CL**4
00853              PERFORM 3620-GET-GMM-NAME                               CL**4
00854          END-IF                                                      CL**4
00855      END-IF.                                                         CL**4
00856 *                                                                 DPPD010 
00857 *                                                                 DPPD010 
00858  3610-GET-GMA-FOR-DPT.                                               CL**4
00859 ******************************************************************DPPD010 
00860 *  GET THE GMM NMBR FOR THE DEPARTMENT                            DPPD010 
00861 ******************************************************************DPPD010 
00862      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00863 *                                                                 DPPD010 
00864      PERFORM                                                      DPPD010 
00865         WITH TEST AFTER                                           DPPD010 
00866           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00867             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00868                OR PS-DB2-CALL-DONE                                DPPD010 
00869                                                                   DPPD010 
00870         EXEC SQL                                                  DPPD010 
00871              SELECT GMA_NBR                                       DPPD010 
00872                INTO :MDSEAR-GMA-NBR                               DPPD010 
00873                FROM TMDSEAR A,                                    DPPD010 
00874                     TAPLAVL B                                     DPPD010 
00875               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00876                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00877                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR              DPPD010 
00878                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00879                 AND (:PV-EFF-DATE                                 DPPD010 
00880                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00881                                  AND CHAR(END_DTE,ISO))           DPPD010 
00882                 AND (:PV-EFF-DATE                                 DPPD010 
00883                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00884                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00885                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00886         END-EXEC                                                  DPPD010 
00887                                                                   DPPD010 
00888         EVALUATE TRUE                                             DPPD010 
00889             WHEN SQLCODE = ZERO                                   DPPD010 
00890                  SET PS-DB2-CALL-DONE                             DPPD010 
00891                                      TO TRUE                      DPPD010 
00892             WHEN SQLCODE = +100                                   DPPD010 
00893                  MOVE PRV-33         TO DP003-RETURN-DATA         DPPD010 
00894                  SET PS-DB2-CALL-DONE                             DPPD010 
00895                                      TO TRUE                      DPPD010 
00896             WHEN SQLCODE = -904                                   DPPD010 
00897             WHEN SQLCODE = -911                                   DPPD010 
00898                  CONTINUE                                         DPPD010 
00899             WHEN OTHER                                            DPPD010 
00900                  MOVE PRV-34         TO DP003-RETURN-DATA         DPPD010 
00901                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00902                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00903                  SET PS-DB2-CALL-DONE                             DPPD010 
00904                                      TO TRUE                      DPPD010 
00905         END-EVALUATE                                              DPPD010 
00906      END-PERFORM.                                                 DPPD010 
00907 *                                                                 DPPD010 
00908      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00909          MOVE PRV-35                 TO DP003-RETURN-DATA         DPPD010 
00910          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00911          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00912      END-IF.                                                      DPPD010 
00913 *                                                                 DPPD010 
00914 *                                                                 DPPD010 
00915  3620-GET-GMM-NAME.                                               DPPD010 
00916 ******************************************************************DPPD010 
00917 *  GET THE GMM NAME AND NUMBER                                    DPPD010 
00918 ******************************************************************DPPD010 
00919      INITIALIZE PS-DB2-CALL-DONE-SW.                              DPPD010 
00920 *                                                                 DPPD010 
00921      PERFORM                                                      DPPD010 
00922         WITH TEST AFTER                                           DPPD010 
00923           VARYING PV-RETRY-COUNT FROM 1 BY 1                      DPPD010 
00924             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                 DPPD010 
00925                OR PS-DB2-CALL-DONE                                DPPD010 
00926                                                                   DPPD010 
00927         EXEC SQL                                                  DPPD010 
00928              SELECT WORKER_FIR_NAME,                              DPPD010 
00929                     WORKER_LAST_NAME                              DPPD010 
00930                INTO :RSPBAR-WORKER-FIR-NAME,                      DPPD010 
00931                     :RSPBAR-WORKER-LAST-NAME                      DPPD010 
00932                FROM TMDSEAR A,                                    DPPD010 
00933                     TAPLAVL B,                                    DPPD010 
00934                     TRSPBAR C                                     DPPD010 
00935               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                 DPPD010 
00936                 AND A.MDSEAR_DKEY = C.MDSEAR_DKEY                 DPPD010 
00937                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR            DPPD010 
00938                 AND GMA_NBR       = :MDSEAR-GMA-NBR               DPPD010 
00939                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE            DPPD010 
00940                 AND (:PV-EFF-DATE                                 DPPD010 
00941                              BETWEEN CHAR(STRT_DTE,ISO)           DPPD010 
00942                                  AND CHAR(END_DTE,ISO))           DPPD010 
00943                 AND (:PV-EFF-DATE                                 DPPD010 
00944                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)  DPPD010 
00945                                  AND CHAR(B.MDSEAR_END_DTE,ISO))  DPPD010 
00946                 AND (:PV-EFF-DATE                                 DPPD010 
00947                              BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)  DPPD010 
00948                                  AND CHAR(C.WORKER_END_DTE,ISO))  DPPD010 
00949                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE            DPPD010 
00950                 AND C.RSPLVL_CDE  = :RSPBAR-RSPLVL-CDE            DPPD010 
00951         END-EXEC                                                  DPPD010 
00952                                                                   DPPD010 
00953         EVALUATE TRUE                                             DPPD010 
00954             WHEN SQLCODE = ZERO                                   DPPD010 
00955                  PERFORM 3625-STRING-GMM-NAME                     DPPD010 
00956                  SET PS-DB2-CALL-DONE                             DPPD010 
00957                                      TO TRUE                      DPPD010 
00958             WHEN SQLCODE = +100                                   DPPD010 
00959                  MOVE PRV-36         TO DP003-RETURN-DATA         DPPD010 
00960                  SET PS-DB2-CALL-DONE                             DPPD010 
00961                                      TO TRUE                      DPPD010 
00962             WHEN SQLCODE = -904                                   DPPD010 
00963             WHEN SQLCODE = -911                                   DPPD010 
00964                  CONTINUE                                         DPPD010 
00965             WHEN OTHER                                            DPPD010 
00966                  MOVE PRV-37         TO DP003-RETURN-DATA         DPPD010 
00967                  MOVE SQLCA          TO DP003-SQLCA               DPPD010 
00968                  MOVE SQLCODE        TO DP003-SQLCODE             DPPD010 
00969                  SET PS-DB2-CALL-DONE                             DPPD010 
00970                                      TO TRUE                      DPPD010 
00971         END-EVALUATE                                              DPPD010 
00972      END-PERFORM.                                                 DPPD010 
00973 *                                                                 DPPD010 
00974      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          DPPD010 
00975          MOVE PRV-38                 TO DP003-RETURN-DATA         DPPD010 
00976          MOVE SQLCA                  TO DP003-SQLCA               DPPD010 
00977          MOVE SQLCODE                TO DP003-SQLCODE             DPPD010 
00978      END-IF.                                                      DPPD010 
00979 *                                                                 DPPD010 
00980 *                                                                 DPPD010 
00981  3625-STRING-GMM-NAME.                                            DPPD010 
00982 ******************************************************************DPPD010 
00983 *  STRING THE GMM NAME                                            DPPD010 
00984 ******************************************************************DPPD010 
00985      EVALUATE TRUE                                                DPPD010 
00986          WHEN DP003-GMM-NAME-LAST-ONLY                            DPPD010 
00987               MOVE RSPBAR-WORKER-LAST-NAME                        DPPD010 
00988                                      TO DP003-GMM-NAME            DPPD010 
00989          WHEN DP003-GMM-NAME-LAST-FIRST                           DPPD010 
00990               STRING RSPBAR-WORKER-LAST-NAME DELIMITED BY '  '    DPPD010 
00991                      ', '                    DELIMITED BY SIZE    DPPD010 
00992                      RSPBAR-WORKER-FIR-NAME  DELIMITED BY SIZE    DPPD010 
00993                 INTO DP003-GMM-NAME                               DPPD010 
00994               END-STRING                                          DPPD010 
00995          WHEN OTHER                                               DPPD010 
00996               STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY '  '    DPPD010 
00997                      SPACE                   DELIMITED BY SIZE    DPPD010 
00998                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE    DPPD010 
00999                 INTO DP003-GMM-NAME                               DPPD010 
01000               END-STRING                                          DPPD010 
01001      END-EVALUATE.                                                DPPD010 
01002 *                                                                 DPPD010 
01003 *                                                                 DPPD010 
01004  3700-ANL-LOOKUP.                                                 DPPD010 
01005 ******************************************************************DPPD010 
01006 *  GET ALL THE ANALYST NAMES FOR THE DEPARTMENT                   DPPD010 
01007 ******************************************************************DPPD010 
01008      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR         DPPD010 
01009      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR           DPPD010 
01010      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE         DPPD010 
01011      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE         DPPD010 
01012      MOVE PC-RSPLVL-CDE-ANL          TO RSPBAR-RSPLVL-CDE         DPPD010 
01013 *                                                                 DPPD010 
01014      PERFORM 3710-OPEN-ANL-CSR                                    DPPD010 
01015 *                                                                 DPPD010 
01016      IF  PS-OPEN-OK                                               DPPD010 
01017          INITIALIZE PS-FETCH-DONE-SW                              DPPD010 
01018          SET DP003-ANLX              TO 1                         DPPD010 
01019          PERFORM 3720-FETCH-ANL-CSR                               DPPD010 
01020            UNTIL PS-FETCH-DONE                                    DPPD010 
01021          PERFORM 3730-CLOSE-ANL-CSR                               DPPD010 
01022      END-IF.                                                      DPPD010 
01023 *                                                                 DPPD010 
01024 *                                                                 DPPD010 
01025  3710-OPEN-ANL-CSR.                                               DPPD010 
01026 ******************************************************************DPPD010 
01027 *  OPEN THE ANL_CSR.                                              DPPD010 
01028 ******************************************************************DPPD010 
01029      EXEC SQL                                                     DPPD010 
01030           OPEN ANL_CSR                                            DPPD010 
01031      END-EXEC.                                                    DPPD010 
01032 *                                                                 DPPD010 
01033      EVALUATE TRUE                                                DPPD010 
01034          WHEN SQLCODE = ZERO                                      DPPD010 
01035               SET PS-OPEN-OK         TO TRUE                      DPPD010 
01036          WHEN OTHER                                               DPPD010 
01037               SET PS-OPEN-NOT-OK     TO TRUE                      DPPD010 
01038               MOVE PRV-40            TO DP003-RETURN-DATA         DPPD010 
01039               MOVE SQLCA             TO DP003-SQLCA               DPPD010 
01040               MOVE SQLCODE           TO DP003-SQLCODE             DPPD010 
01041      END-EVALUATE.                                                DPPD010 
01042 *                                                                 DPPD010 
01043 *                                                                 DPPD010 
01044  3720-FETCH-ANL-CSR.                                              DPPD010 
01045 ******************************************************************DPPD010 
01046 *  FETCH THE NEXT ROW ON THE RESULTS TABLE USING THE ANL_CSR      DPPD010 
01047 ******************************************************************DPPD010 
01048      EXEC SQL                                                     DPPD010 
01049           FETCH ANL_CSR                                           DPPD010 
01050            INTO :RSPBAR-WORKER-FIR-NAME,                          DPPD010 
01051                 :RSPBAR-WORKER-LAST-NAME                          DPPD010 
01052      END-EXEC.                                                    DPPD010 
01053 *                                                                 DPPD010 
01054      EVALUATE TRUE                                                DPPD010 
01055          WHEN SQLCODE = ZERO                                      DPPD010 
01056               IF  DP003-ANLX > 19                                 DPPD010 
01057                   SET PS-FETCH-DONE  TO TRUE                      DPPD010 
01058                   MOVE PRV-41        TO DP003-RETURN-DATA         DPPD010 
01059               ELSE                                                DPPD010 
01060                   PERFORM 3725-STRING-ANL-NAME                    DPPD010 
01061                   ADD 1              TO DP003-ANL-COUNT           DPPD010 
01062                   SET DP003-ANLX UP BY 1                          DPPD010 
01063               END-IF                                              DPPD010 
01064          WHEN SQLCODE = +100                                      DPPD010 
01065               SET PS-FETCH-DONE      TO TRUE                      DPPD010 
01066          WHEN OTHER                                               DPPD010 
01067               SET PS-FETCH-DONE      TO TRUE                      DPPD010 
01068               MOVE PRV-42            TO DP003-RETURN-DATA         DPPD010 
01069               MOVE SQLCA             TO DP003-SQLCA               DPPD010 
01070               MOVE SQLCODE           TO DP003-SQLCODE             DPPD010 
01071      END-EVALUATE.                                                DPPD010 
01072 *                                                                 DPPD010 
01073 *                                                                 DPPD010 
01074  3725-STRING-ANL-NAME.                                            DPPD010 
01075 ******************************************************************DPPD010 
01076 *  STRING THE ANL NAME                                            DPPD010 
01077 ******************************************************************DPPD010 
01078      EVALUATE TRUE                                                DPPD010 
01079          WHEN DP003-ANL-NAME-LAST-ONLY                            DPPD010 
01080               MOVE RSPBAR-WORKER-LAST-NAME                        DPPD010 
01081                 TO DP003-ANL-NAME (DP003-ANLX)                    DPPD010 
01082          WHEN DP003-ANL-NAME-LAST-FIRST                           DPPD010 
01083               STRING RSPBAR-WORKER-LAST-NAME DELIMITED BY '  '    DPPD010 
01084                      ', '                    DELIMITED BY SIZE    DPPD010 
01085                      RSPBAR-WORKER-FIR-NAME  DELIMITED BY SIZE    DPPD010 
01086                 INTO DP003-ANL-NAME (DP003-ANLX)                  DPPD010 
01087               END-STRING                                          DPPD010 
01088          WHEN OTHER                                               DPPD010 
01089               STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY '  '    DPPD010 
01090                      SPACE                   DELIMITED BY SIZE    DPPD010 
01091                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE    DPPD010 
01092                 INTO DP003-ANL-NAME (DP003-ANLX)                  DPPD010 
01093               END-STRING                                          DPPD010 
01094      END-EVALUATE.                                                DPPD010 
01095 *                                                                 DPPD010 
01096 *                                                                 DPPD010 
01097  3730-CLOSE-ANL-CSR.                                              DPPD010 
01098 ******************************************************************DPPD010 
01099 *  CLOSE THE ANL_CSR.                                             DPPD010 
01100 ******************************************************************DPPD010 
01101      EXEC SQL                                                     DPPD010 
01102           CLOSE ANL_CSR                                           DPPD010 
01103      END-EXEC.                                                    DPPD010 
01104 *                                                                 DPPD010 
01105      EVALUATE TRUE                                                DPPD010 
01106          WHEN SQLCODE = ZERO                                      DPPD010 
01107               CONTINUE                                            DPPD010 
01108          WHEN OTHER                                               DPPD010 
01109               MOVE PRV-43            TO DP003-RETURN-DATA         DPPD010 
01110               MOVE SQLCA             TO DP003-SQLCA               DPPD010 
01111               MOVE SQLCODE           TO DP003-SQLCODE             DPPD010 
01112      END-EVALUATE.                                                DPPD010 
01113 *                                                                 DPPD010 
01114 *                                                                 DPPD010 
01115  3800-ANM-LOOKUP.                                                 DPPD010 
01116 ******************************************************************DPPD010 
01117 *  THIS GROUP OF PARAGRAPHS TO GET THE ANM NAME IS A LITTLE MORE     CL**2
01118 *  INVOLVED THAN THE OTHER FUNTIONS.  THE ANM (ANALYST MANAGER)      CL**2
01119 *  CAN BE DEFINED AT ANY OF THREE LEVELS (THEY ARE, FROM LOWEST      CL**2
01120 *  TO HIGHEST LEVEL:  DPT, DMM OR GMM).  TO GET THE ANM NAME,        CL**2
01121 *  START AT THE LOWEST LEVEL.  IF AN ANM IS NOT FOUND AT THE DPT     CL**2
01122 *  LEVEL, A CALL IS MADE TO GET THE DMA AND GMA NUMBERS FOR THE      CL**2
01123 *  DEPARTMENT.  THE PROGRAM NEEDS THE DMA AND GMA NUMBERS TO CHECK   CL**2
01124 *  THE NEXT HIGHER LEVELS BECAUSE THE DMA AND (POSSIBLY) THE GMA     CL**2
01125 *  RECORDS MAY BE USED IN A CALL TO GET THE ANM NAME.  THE JOIN      CL**2
01126 *  TO GET THE ANM NAME USES THE 'DATALESS KEY' FROM THE DMA OR       CL**2
01127 *  THE GMA RECORD, SO THE PROGRAM MUST KNOW THE DMA OR GMA NUMBER    CL**2
01128 *  FOR THE DEPARTMENT.                                               CL**2
01129 ******************************************************************DPPD010 
01130      INITIALIZE PS-ANM-FOUND-SW.                                     CL**2
01131 *                                                                    CL**2
01132      PERFORM 3810-GET-ANM-FOR-DPT.                                   CL**2
01133 *                                                                    CL**2
01134      IF  PS-ANM-FOUND                                                CL**2
01135          CONTINUE                                                    CL**2
01136      ELSE                                                            CL**2
01137          PERFORM 3820-GET-GMA-DMA-FOR-DPT                            CL**2
01138          IF  SQLCODE = ZERO                                          CL**2
01139              PERFORM 3830-GET-ANM-FOR-DMA                            CL**2
01140              IF  PS-ANM-FOUND                                        CL**2
01141                  CONTINUE                                            CL**2
01142              ELSE                                                    CL**2
01143                  PERFORM 3840-GET-ANM-FOR-GMA                        CL**4
01144                  IF  PS-ANM-FOUND                                    CL**2
01145                      CONTINUE                                        CL**2
01146                  ELSE                                                CL**2
01147                      MOVE PRV-46     TO DP003-RETURN-DATA            CL**2
01148                  END-IF                                              CL**2
01149              END-IF                                                  CL**2
01150          END-IF                                                      CL**2
01151      END-IF.                                                         CL**2
01152 *                                                                    CL**2
01153      IF  PS-ANM-FOUND                                                CL**2
01154          PERFORM 3850-STRING-ANM-NAME                                CL**2
01155      END-IF.                                                         CL**2
01156 *                                                                    CL**2
01157 *                                                                    CL**2
01158  3810-GET-ANM-FOR-DPT.                                               CL**2
01159 ******************************************************************   CL**2
01160 *  GET THE ANM NAME FOR THE DEPARTMENT                               CL**2
01161 ******************************************************************   CL**2
01162      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR            CL**2
01163      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR              CL**2
01164      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE            CL**2
01165      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE            CL**2
01166      MOVE PC-RSPLVL-CDE-ANM          TO RSPBAR-RSPLVL-CDE            CL**2
01167 *                                                                    CL**2
01168      INITIALIZE PS-DB2-CALL-DONE-SW.                                 CL**2
01169 *                                                                    CL**2
01170      PERFORM                                                         CL**2
01171         WITH TEST AFTER                                              CL**2
01172           VARYING PV-RETRY-COUNT FROM 1 BY 1                         CL**2
01173             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    CL**2
01174                OR PS-DB2-CALL-DONE                                   CL**2
01175                                                                      CL**2
01176         EXEC SQL                                                     CL**2
01177              SELECT WORKER_FIR_NAME,                                 CL**2
01178                     WORKER_LAST_NAME                                 CL**2
01179                INTO :RSPBAR-WORKER-FIR-NAME,                         CL**2
01180                     :RSPBAR-WORKER-LAST-NAME                         CL**2
01181                FROM TMDSEAR A,                                       CL**2
01182                     TAPLAVL B,                                       CL**2
01183                     TRSPBAR C                                        CL**2
01184               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                    CL**2
01185                 AND A.MDSEAR_DKEY = C.MDSEAR_DKEY                    CL**2
01186                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR               CL**2
01187                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR                 CL**6
01188                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE               CL**2
01189                 AND (:PV-EFF-DATE                                    CL**2
01190                              BETWEEN CHAR(STRT_DTE,ISO)              CL**2
01191                                  AND CHAR(END_DTE,ISO))              CL**2
01192                 AND (:PV-EFF-DATE                                    CL**2
01193                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)     CL**2
01194                                  AND CHAR(B.MDSEAR_END_DTE,ISO))     CL**2
01195                 AND (:PV-EFF-DATE                                    CL**2
01196                              BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)     CL**2
01197                                  AND CHAR(C.WORKER_END_DTE,ISO))     CL**2
01198                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE               CL**2
01199                 AND C.RSPLVL_CDE  = :RSPBAR-RSPLVL-CDE               CL**2
01200         END-EXEC                                                     CL**2
01201                                                                      CL**2
01202         EVALUATE TRUE                                                CL**2
01203             WHEN SQLCODE = ZERO                                      CL**2
01204                  SET PS-ANM-FOUND                                    CL**6
01205                      PS-DB2-CALL-DONE                                CL**6
01206                                      TO TRUE                         CL**6
01207             WHEN SQLCODE = +100                                      CL**2
01208                  SET PS-DB2-CALL-DONE                                CL**2
01209                                      TO TRUE                         CL**2
01210             WHEN SQLCODE = -904                                      CL**2
01211             WHEN SQLCODE = -911                                      CL**2
01212                  CONTINUE                                            CL**2
01213             WHEN OTHER                                               CL**2
01214                  MOVE MDSEAR-MDSELV-CDE                              CL**2
01215                                      TO PRV-44-CALL-TYPE             CL**2
01216                  MOVE PRV-44         TO DP003-RETURN-DATA            CL**2
01217                  MOVE SQLCA          TO DP003-SQLCA                  CL**2
01218                  MOVE SQLCODE        TO DP003-SQLCODE                CL**2
01219                  SET PS-DB2-CALL-DONE                                CL**2
01220                                      TO TRUE                         CL**2
01221         END-EVALUATE                                                 CL**2
01222      END-PERFORM.                                                    CL**2
01223 *                                                                    CL**2
01224      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                             CL**2
01225          MOVE MDSEAR-MDSELV-CDE      TO PRV-45-CALL-TYPE             CL**2
01226          MOVE PRV-45                 TO DP003-RETURN-DATA            CL**2
01227          MOVE SQLCA                  TO DP003-SQLCA                  CL**2
01228          MOVE SQLCODE                TO DP003-SQLCODE                CL**2
01229      END-IF.                                                         CL**2
01230 *                                                                    CL**2
01231 *                                                                    CL**2
01232  3820-GET-GMA-DMA-FOR-DPT.                                           CL**2
01233 ******************************************************************   CL**2
01234 *  GET THE ANM NAME FOR THE DEPARTMENT                               CL**2
01235 ******************************************************************   CL**2
01236      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR            CL**2
01237      MOVE DP003-DPT-INPUT            TO MDSEAR-DEPT-NBR              CL**2
01238      MOVE PC-MDSELV-DPT              TO MDSEAR-MDSELV-CDE            CL**2
01239      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE            CL**2
01240 *                                                                    CL**2
01241      INITIALIZE PS-DB2-CALL-DONE-SW.                                 CL**2
01242 *                                                                    CL**2
01243      PERFORM                                                         CL**2
01244         WITH TEST AFTER                                              CL**2
01245           VARYING PV-RETRY-COUNT FROM 1 BY 1                         CL**2
01246             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    CL**2
01247                OR PS-DB2-CALL-DONE                                   CL**2
01248                                                                      CL**2
01249         EXEC SQL                                                     CL**2
01250              SELECT DMA_NBR,                                         CL**2
01251                     GMA_NBR                                          CL**2
01252                INTO :MDSEAR-DMA-NBR,                                 CL**3
01253                     :MDSEAR-GMA-NBR                                  CL**3
01254                FROM TMDSEAR A,                                       CL**2
01255                     TAPLAVL B                                        CL**2
01256               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                    CL**2
01257                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR               CL**2
01258                 AND DEPT_NBR      = :MDSEAR-DEPT-NBR                 CL**2
01259                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE               CL**2
01260                 AND (:PV-EFF-DATE                                    CL**2
01261                              BETWEEN CHAR(STRT_DTE,ISO)              CL**2
01262                                  AND CHAR(END_DTE,ISO))              CL**2
01263                 AND (:PV-EFF-DATE                                    CL**2
01264                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)     CL**2
01265                                  AND CHAR(B.MDSEAR_END_DTE,ISO))     CL**2
01266                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE               CL**2
01267         END-EXEC                                                     CL**2
01268                                                                      CL**2
01269         EVALUATE TRUE                                                CL**2
01270             WHEN SQLCODE = ZERO                                      CL**2
01271                  MOVE MDSEAR-DMA-NBR TO PV-DPT-DMA                   CL**3
01272                  MOVE MDSEAR-GMA-NBR TO PV-DPT-GMA                   CL**3
01273                  SET PS-DB2-CALL-DONE                                CL**2
01274                                      TO TRUE                         CL**2
01275             WHEN SQLCODE = +100                                      CL**2
01276                  MOVE PRV-14         TO DP003-RETURN-DATA            CL**2
01277                  SET PS-DB2-CALL-DONE                                CL**2
01278                                      TO TRUE                         CL**2
01279             WHEN SQLCODE = -904                                      CL**2
01280             WHEN SQLCODE = -911                                      CL**2
01281                  CONTINUE                                            CL**2
01282             WHEN OTHER                                               CL**2
01283                  MOVE PRV-15         TO DP003-RETURN-DATA            CL**2
01284                  MOVE SQLCA          TO DP003-SQLCA                  CL**2
01285                  MOVE SQLCODE        TO DP003-SQLCODE                CL**2
01286                  SET PS-DB2-CALL-DONE                                CL**2
01287                                      TO TRUE                         CL**2
01288         END-EVALUATE                                                 CL**2
01289      END-PERFORM.                                                    CL**2
01290 *                                                                    CL**2
01291      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                             CL**2
01292          MOVE PRV-16                 TO DP003-RETURN-DATA            CL**2
01293          MOVE SQLCA                  TO DP003-SQLCA                  CL**2
01294          MOVE SQLCODE                TO DP003-SQLCODE                CL**2
01295      END-IF.                                                         CL**2
01296 *                                                                    CL**2
01297 *                                                                    CL**2
01298  3830-GET-ANM-FOR-DMA.                                               CL**2
01299 ******************************************************************   CL**2
01300 *  GET THE ANM NAME FOR THE INPUT DEPARTMENT'S DMA.                  CL**2
01301 ******************************************************************   CL**2
01302      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR            CL**2
01303      MOVE PV-DPT-GMA                 TO MDSEAR-GMA-NBR.              CL**6
01304      MOVE PV-DPT-DMA                 TO MDSEAR-DMA-NBR.              CL**6
01305      MOVE PC-MDSELV-DMA              TO MDSEAR-MDSELV-CDE            CL**2
01306      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE            CL**2
01307      MOVE PC-RSPLVL-CDE-ANM          TO RSPBAR-RSPLVL-CDE            CL**2
01308 *                                                                    CL**2
01309      INITIALIZE PS-DB2-CALL-DONE-SW.                                 CL**2
01310 *                                                                    CL**2
01311      PERFORM                                                         CL**2
01312         WITH TEST AFTER                                              CL**2
01313           VARYING PV-RETRY-COUNT FROM 1 BY 1                         CL**2
01314             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    CL**2
01315                OR PS-DB2-CALL-DONE                                   CL**2
01316                                                                      CL**2
01317         EXEC SQL                                                     CL**2
01318              SELECT WORKER_FIR_NAME,                                 CL**2
01319                     WORKER_LAST_NAME                                 CL**2
01320                INTO :RSPBAR-WORKER-FIR-NAME,                         CL**2
01321                     :RSPBAR-WORKER-LAST-NAME                         CL**2
01322                FROM TMDSEAR A,                                       CL**2
01323                     TAPLAVL B,                                       CL**2
01324                     TRSPBAR C                                        CL**2
01325               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                    CL**2
01326                 AND A.MDSEAR_DKEY = C.MDSEAR_DKEY                    CL**2
01327                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR               CL**2
01328                 AND GMA_NBR       = :MDSEAR-GMA-NBR                  CL**6
01329                 AND DMA_NBR       = :MDSEAR-DMA-NBR                  CL**6
01330                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE               CL**2
01331                 AND (:PV-EFF-DATE                                    CL**2
01332                              BETWEEN CHAR(STRT_DTE,ISO)              CL**2
01333                                  AND CHAR(END_DTE,ISO))              CL**2
01334                 AND (:PV-EFF-DATE                                    CL**2
01335                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)     CL**2
01336                                  AND CHAR(B.MDSEAR_END_DTE,ISO))     CL**2
01337                 AND (:PV-EFF-DATE                                    CL**2
01338                              BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)     CL**2
01339                                  AND CHAR(C.WORKER_END_DTE,ISO))     CL**2
01340                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE               CL**2
01341                 AND C.RSPLVL_CDE  = :RSPBAR-RSPLVL-CDE               CL**2
01342         END-EXEC                                                     CL**2
01343                                                                      CL**2
01344         EVALUATE TRUE                                                CL**2
01345             WHEN SQLCODE = ZERO                                      CL**2
01346                  SET PS-ANM-FOUND                                    CL**6
01347                      PS-DB2-CALL-DONE                                CL**6
01348                                      TO TRUE                         CL**5
01349             WHEN SQLCODE = +100                                      CL**2
01350                  SET PS-DB2-CALL-DONE                                CL**2
01351                                      TO TRUE                         CL**2
01352             WHEN SQLCODE = -904                                      CL**2
01353             WHEN SQLCODE = -911                                      CL**2
01354                  CONTINUE                                            CL**2
01355             WHEN OTHER                                               CL**2
01356                  MOVE MDSEAR-MDSELV-CDE                              CL**2
01357                                      TO PRV-44-CALL-TYPE             CL**2
01358                  MOVE PRV-44         TO DP003-RETURN-DATA            CL**2
01359                  MOVE SQLCA          TO DP003-SQLCA                  CL**2
01360                  MOVE SQLCODE        TO DP003-SQLCODE                CL**2
01361                  SET PS-DB2-CALL-DONE                                CL**2
01362                                      TO TRUE                         CL**2
01363         END-EVALUATE                                                 CL**2
01364      END-PERFORM.                                                    CL**2
01365 *                                                                    CL**2
01366      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                             CL**2
01367          MOVE MDSEAR-MDSELV-CDE      TO PRV-45-CALL-TYPE             CL**2
01368          MOVE PRV-45                 TO DP003-RETURN-DATA            CL**2
01369          MOVE SQLCA                  TO DP003-SQLCA                  CL**2
01370          MOVE SQLCODE                TO DP003-SQLCODE                CL**2
01371      END-IF.                                                         CL**2
01372 *                                                                    CL**2
01373 *                                                                    CL**2
01374  3840-GET-ANM-FOR-GMA.                                               CL**2
01375 ******************************************************************   CL**2
01376 *  GET THE ANM NAME FOR THE INPUT DEPARTMENT'S GMA.                  CL**2
01377 ******************************************************************   CL**2
01378      MOVE DP003-OP-CO-NMBR           TO MDSEAR-OPERCO-NBR            CL**2
01379      MOVE PV-DPT-GMA                 TO MDSEAR-GMA-NBR.              CL**2
01380      MOVE PC-MDSELV-GMA              TO MDSEAR-MDSELV-CDE            CL**2
01381      MOVE DP003-SYSTEM-CODE          TO APLAVL-APLSYS-CDE            CL**2
01382      MOVE PC-RSPLVL-CDE-ANM          TO RSPBAR-RSPLVL-CDE            CL**2
01383 *                                                                    CL**2
01384      INITIALIZE PS-DB2-CALL-DONE-SW.                                 CL**2
01385 *                                                                    CL**2
01386      PERFORM                                                         CL**2
01387         WITH TEST AFTER                                              CL**2
01388           VARYING PV-RETRY-COUNT FROM 1 BY 1                         CL**2
01389             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                    CL**2
01390                OR PS-DB2-CALL-DONE                                   CL**2
01391                                                                      CL**2
01392         EXEC SQL                                                     CL**2
01393              SELECT WORKER_FIR_NAME,                                 CL**2
01394                     WORKER_LAST_NAME                                 CL**2
01395                INTO :RSPBAR-WORKER-FIR-NAME,                         CL**2
01396                     :RSPBAR-WORKER-LAST-NAME                         CL**2
01397                FROM TMDSEAR A,                                       CL**2
01398                     TAPLAVL B,                                       CL**2
01399                     TRSPBAR C                                        CL**2
01400               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                    CL**2
01401                 AND A.MDSEAR_DKEY = C.MDSEAR_DKEY                    CL**2
01402                 AND A.OPERCO_NBR  = :MDSEAR-OPERCO-NBR               CL**2
01403                 AND GMA_NBR       = :MDSEAR-GMA-NBR                  CL**2
01404                 AND MDSELV_CDE    = :MDSEAR-MDSELV-CDE               CL**2
01405                 AND (:PV-EFF-DATE                                    CL**2
01406                              BETWEEN CHAR(STRT_DTE,ISO)              CL**2
01407                                  AND CHAR(END_DTE,ISO))              CL**2
01408                 AND (:PV-EFF-DATE                                    CL**2
01409                              BETWEEN CHAR(B.MDSEAR_STRT_DTE,ISO)     CL**2
01410                                  AND CHAR(B.MDSEAR_END_DTE,ISO))     CL**2
01411                 AND (:PV-EFF-DATE                                    CL**2
01412                              BETWEEN CHAR(C.WORKER_STRT_DTE,ISO)     CL**2
01413                                  AND CHAR(C.WORKER_END_DTE,ISO))     CL**2
01414                 AND B.APLSYS_CDE  = :APLAVL-APLSYS-CDE               CL**2
01415                 AND C.RSPLVL_CDE  = :RSPBAR-RSPLVL-CDE               CL**2
01416         END-EXEC                                                     CL**2
01417                                                                      CL**2
01418         EVALUATE TRUE                                                CL**2
01419             WHEN SQLCODE = ZERO                                      CL**2
01420                  SET PS-ANM-FOUND                                    CL**6
01421                      PS-DB2-CALL-DONE                                CL**6
01422                                      TO TRUE                         CL**6
01423             WHEN SQLCODE = +100                                      CL**2
01424                  SET PS-DB2-CALL-DONE                                CL**2
01425                                      TO TRUE                         CL**2
01426             WHEN SQLCODE = -904                                      CL**2
01427             WHEN SQLCODE = -911                                      CL**2
01428                  CONTINUE                                            CL**2
01429             WHEN OTHER                                               CL**2
01430                  MOVE MDSEAR-MDSELV-CDE                              CL**2
01431                                      TO PRV-44-CALL-TYPE             CL**2
01432                  MOVE PRV-44         TO DP003-RETURN-DATA            CL**2
01433                  MOVE SQLCA          TO DP003-SQLCA                  CL**2
01434                  MOVE SQLCODE        TO DP003-SQLCODE                CL**2
01435                  SET PS-DB2-CALL-DONE                                CL**2
01436                                      TO TRUE                         CL**2
01437         END-EVALUATE                                                 CL**2
01438      END-PERFORM.                                                    CL**2
01439 *                                                                    CL**2
01440      IF  PV-RETRY-COUNT > PC-MAX-RETRIES                             CL**2
01441          MOVE MDSEAR-MDSELV-CDE      TO PRV-45-CALL-TYPE             CL**2
01442          MOVE PRV-45                 TO DP003-RETURN-DATA            CL**2
01443          MOVE SQLCA                  TO DP003-SQLCA                  CL**2
01444          MOVE SQLCODE                TO DP003-SQLCODE                CL**2
01445      END-IF.                                                         CL**2
01446 *                                                                    CL**2
01447 *                                                                    CL**2
01448  3850-STRING-ANM-NAME.                                               CL**2
01449 ******************************************************************   CL**2
01450 *  STRING THE ANM NAME                                               CL**2
01451 ******************************************************************   CL**2
01452      EVALUATE TRUE                                                   CL**2
01453          WHEN DP003-ANM-NAME-LAST-ONLY                               CL**2
01454               MOVE RSPBAR-WORKER-LAST-NAME                           CL**2
01455                                      TO DP003-ANM-NAME               CL**2
01456          WHEN DP003-ANM-NAME-LAST-FIRST                              CL**2
01457               STRING RSPBAR-WORKER-LAST-NAME DELIMITED BY '  '       CL**2
01458                      ', '                    DELIMITED BY SIZE       CL**2
01459                      RSPBAR-WORKER-FIR-NAME  DELIMITED BY SIZE       CL**2
01460                 INTO DP003-ANM-NAME                                  CL**2
01461               END-STRING                                             CL**2
01462          WHEN OTHER                                                  CL**2
01463               STRING RSPBAR-WORKER-FIR-NAME  DELIMITED BY '  '       CL**2
01464                      SPACE                   DELIMITED BY SIZE       CL**2
01465                      RSPBAR-WORKER-LAST-NAME DELIMITED BY SIZE       CL**2
01466                 INTO DP003-ANM-NAME                                  CL**2
01467               END-STRING                                             CL**2
01468      END-EVALUATE.                                                   CL**2
