000100*------------------------*                                        00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------*                                        00030000
000400 PROGRAM-ID.     APKUT363.                                        00040000
000500 AUTHOR.         NANCY EILBES.                                    00050000
000600 DATE-WRITTEN.   NOVEMBER 2012.                                   00060000
000700 DATE-COMPILED.                                                   00070000
000800*---------------------------------------------------------------* 00080000
000900*                      SALES TAX AUDIT                          * 00090000
001000*---------------------------------------------------------------* 00100000
001100*    COBOL 2 WITH SQL                                           * 00110000
001200*---------------------------------------------------------------* 00120000
001300*                                                               * 00130000
001400*  PURPOSE:  TO CREATE A SALES TAX AUDIT FILE, EXTRACTING DATA  * 00140000
001500*  FROM PEOPLESOFT ARCHIVE TABLES.                              * 00150000
001600*                                                               * 00160000
001700*---------------------------------------------------------------* 00170000
001800*                                                               * 00180000
001900* PEOPLESOFT TABLES:                     DCLGENS:               * 00190000
002000*  1. PS_AP_ARC_PYM_TB_H                   FIT00279             * 00200000
002100*  2. PS_AP_ARC_PYM_XR_H                   FIT00280             * 00210000
002200*  3. PS_AP_ARC_VOUCH_H                    FIT00281             * 00220000
002300*  4. PS_AP_ARC_VCH_LN_H                   FIT00282             * 00230000
002400*  5. PS_AP_ARC_DIST_L_H                   FIT00283             * 00240000
002500*  6. PS_VENDOR                            FIT00236             * 00250000
002600*  7. PS_PROJ_ACTIVITY                     FIT00288             * 00260000
002700*  8. PS_GL_ACCOUNT_TBL                    FIT00170             * 00270000
002800*                                                               * 00280000
002900* INPUT:                                                        * 00290000
003000*                                                               * 00300000
003100*  1. CONTROL CARD.                        APCC066              * 00310000
003200*  2. DEPTID SELECTION FILE                 NONE                * 00320000
003300*                                                               * 00330000
003400* OUTPUT:                                                       * 00340000
003500*                                                               * 00350000
003600*  1. SALES TAX AUDIT FILE                 APRD216              * 00360000
003700*                                                               * 00370000
003800*---------------------------------------------------------------* 00380000
003900* CHANGE LOG:                                                   * 00390000
004000* DATE  06/14/2013                                              * 00400000
004100*     CHANGE MADE: INITIAL IMPLEMENTATION.  THIS PROGRAM IS A   * 00410000
004200*     REWRITE OF APKUT237.  LOCATION SELECTION IS NOW DRIVEN BY * 00420000
004300*     AN INPUT LIST OF DEPTIDS RATHER THAN BUILDING THE STORE   * 00430000
004400*     FROM THE LOCATION DATABASE.  FIELDS BEING SELECTED HAS    * 00440000
004500*     BEEN ENHANCED TO CAPTURE NEW FIELDS APPROPRIATE TO THE    * 00450000
004600*     PS UPGRADE TO V9.1 AND OBSOLETE FIELDS ELIMINATED.        * 00460000
004700*     MADE BY: NANCY EILBES            WR/IR #: CHG0055677      * 00470000
004800*                                                               * 00480000
004900* DATE  10/04/2013                                              * 00490000
005000*     CHANGE MADE: ADDED TRIRIGA CODES                          * 00500000
005100*     MADE BY: STEVE KRIEG             WR/IR #:CHG00SJK???      * 00510000
005200*                                                               * 00520000
005300* DATE  11/11/2013                                              * 00530000
005400*     CHANGE MADE: CHANGES MADE FOR INCLUDING BASE INTERFACE    * 00540000
005500*     FILE. THE CHANGES INCLUDE READING OF THE NEW ORIGIN CODE  * 00550000
005600*     MADE BY: VIKRAM V                WR/IR #: CHG0070953      * 00560000
005610*                                                               * 00561028
005620* DATE  04/25/2014                                              * 00562028
005630*     CHANGE MADE: DELETED THE FIELD C.DESCR FROM BOTH          * 00563028
005640*     AUDIT_CSR AND XPEDX_FEED_CSR TO FETCH THE SAME DATA.      * 00564028
005650*     MADE BY: COGNIZANT               WR/IR #: CHG0079948      * 00565028
005660*                                                               * 00566028
005670* DATE  10/01/2014                                              * 00567028
005680*     CHANGE MADE: ADDED NEW ORIGINS FOR ARIBA TRANSACTIONS     * 00568028
005690*     IN THE AUDIT_CSR AND THE XPEDX_FEED_CSR.                  * 00569028
005691*     MADE BY: MARK BURNSIDE           WR/IR #: CHG0093763      * 00569128
005692*---------------------------------------------------------------* 00569228
005800                                                                  00580000
005900*---------------------*                                           00590000
006000 ENVIRONMENT DIVISION.                                            00600000
006100*---------------------*                                           00610000
006200 CONFIGURATION SECTION.                                           00620000
006300 SOURCE-COMPUTER.        IBM-370.                                 00630000
006400 OBJECT-COMPUTER.        IBM-370.                                 00640000
006500                                                                  00650000
006600 INPUT-OUTPUT SECTION.                                            00660000
006700                                                                  00670000
006800 FILE-CONTROL.                                                    00680000
006900                                                                  00690000
007000     SELECT ORACLE-LOGIN-FILE         ASSIGN TO ORALOGON.         00700000
007100     SELECT DEPTID-SELECTION-FILE     ASSIGN TO UT-S-INP01.       00710000
007200     SELECT STATE-TAX-AUDIT-HST-FILE  ASSIGN TO OUT01.            00720000
007300                                                                  00730000
007400*--------------*                                                  00740000
007500 DATA DIVISION.                                                   00750000
007600*--------------*                                                  00760000
007700 FILE SECTION.                                                    00770000
007800                                                                  00780000
007900 FD  ORACLE-LOGIN-FILE                                            00790000
008000     RECORDING MODE IS F                                          00800000
008100     LABEL RECORDS ARE STANDARD                                   00810000
008200     BLOCK CONTAINS 0 RECORDS                                     00820000
008300     DATA RECORD IS ORACLE-LOGIN-REC.                             00830000
008400 01  ORACLE-LOGIN-REC.                                            00840000
008500     05  FILLER                         PIC X(080).               00850000
008600                                                                  00860000
008700 FD  DEPTID-SELECTION-FILE                                        00870000
008800     RECORDING MODE IS F                                          00880000
008900     LABEL RECORDS ARE STANDARD                                   00890000
009000     BLOCK CONTAINS 0 RECORDS                                     00900000
009100     RECORD CONTAINS 80 CHARACTERS                                00910000
009200     DATA RECORD IS DEPTID-SELECTION-RECORD.                      00920000
009300                                                                  00930000
009400 01  DEPTID-SELECTION-RECORD            PIC X(80).                00940000
009500                                                                  00950000
009600 FD  STATE-TAX-AUDIT-HST-FILE                                     00960000
009700     RECORDING MODE IS F                                          00970000
009800     LABEL RECORDS ARE STANDARD                                   00980000
009900     BLOCK CONTAINS 0 RECORDS                                     00990000
010000     RECORD CONTAINS 325 CHARACTERS                               01000000
010100     DATA RECORD IS STATE-TAX-AUDIT-HST-REC.                      01010000
010200 01  STATE-TAX-AUDIT-HST-REC            PIC X(325).               01020000
010300                                                                  01030000
010400 EJECT                                                            01040000
010500                                                                  01050000
010600 WORKING-STORAGE SECTION.                                         01060000
010700 01  PROGRAM-CONSTANTS.                                           01070000
010800     05  FILLER                         PIC X.                    01080000
010900                                                                  01090000
011000 01  PROGRAM-SWITCHES.                                            01100000
011100     05  PS-END-OF-DEPTID-FILE          PIC X  VALUE 'N'.         01110000
011200         88  END-OF-DEPTID-FILE                VALUE 'Y'.         01120000
011300     05  PS-AUDIT-END-OF-CSR            PIC X  VALUE 'N'.         01130000
011400         88  AUDIT-END-OF-CSR                  VALUE 'Y'.         01140000
011500     05  PS-ORACLE-LOGIN-EOF-SW         PIC X  VALUE 'N'.         01150000
011600         88  ORACLE-LOGIN-EOF                  VALUE 'Y'.         01160000
011700                                                                  01170000
011800 01  SI-DEPTID-RECORD.                                            01180000
011900     05  SI-DEPTID                      PIC X(10).                01190000
012000     05  FILLER                         PIC X(70).                01200000
012100                                                                  01210000
012200 01  CC-CONTROL-CARD.                                             01220000
012300     05  FILLER                         PIC X(07).                01230000
012400     05  CC-STATE-CD                    PIC X(02).                01240000
012500     05  FILLER                         PIC X(08).                01250000
012600     05  CC-BEGIN-DATE                  PIC X(10).                01260000
012700     05  FILLER REDEFINES CC-BEGIN-DATE.                          01270000
012800         10 CC-BEGIN-DATE-CCYY          PIC X(04).                01280000
012900         10 FILLER                      PIC X(01).                01290000
013000         10 CC-BEGIN-DATE-MM            PIC X(02).                01300000
013100         10 FILLER                      PIC X(01).                01310000
013200         10 CC-BEGIN-DATE-DD            PIC X(02).                01320000
013300     05  FILLER                         PIC X(06).                01330000
013400     05  CC-END-DATE                    PIC X(10).                01340000
013500     05  FILLER REDEFINES CC-END-DATE.                            01350000
013600         10 CC-END-DATE-CCYY            PIC X(04).                01360000
013700         10 FILLER                      PIC X(01).                01370000
013800         10 CC-END-DATE-MM              PIC X(02).                01380000
013900         10 FILLER                      PIC X(01).                01390000
014000         10 CC-END-DATE-DD              PIC X(02).                01400000
014100     05  FILLER                         PIC X(37).                01410000
014200                                                                  01420000
014300 01  PROGRAM-COUNTERS.                                            01430000
014400     05  DEPTID-COUNT                   PIC S9(09) COMP VALUE 0.  01440000
014500     05  AUDIT-CSR-COUNT                PIC S9(09) COMP VALUE 0.  01450000
014600     05  AUDIT-OUT-COUNT                PIC S9(09) COMP VALUE 0.  01460000
014700     05  STATE-STORE-SUB                PIC  9(04) VALUE 0.       01470000
014800                                                                  01480000
014900 01  PROGRAM-VARIABLES.                                           01490000
015000     05  PV-STATE-STORE-TOTAL           PIC 9(04) VALUE 0.        01500000
015100     05  PV-STORE-NBR                   PIC 9(04) VALUE 0.        01510000
015200     05  PV-PROGRAM-NAME                PIC X(08) VALUE           01520000
015300                                                    'APKUT363'.   01530000
015400     05  PV-PYMNT-ID-REF                PIC X(20)  VALUE SPACES.  01540000
015500     05  PV-DEPTID                      PIC X(10)  VALUE SPACES.  01550000
015600     05  PV-ORACLE-USERID-LEN           PIC S9(04) VALUE ZEROS.   01560000
015700     05  PV-ORACLE-PASSWORD-LEN         PIC S9(04) VALUE ZEROS.   01570000
015800                                                                  01580000
015900 01  STATE-STORE-TABLE.                                           01590000
016000     05  STATE-DEPTID                   PIC X(10) OCCURS 9999.    01600000
016100                                                                  01610000
016200 01  ABEND-CODE                         PIC S9(04) VALUE ZEROS    01620000
016300                                                   COMP SYNC.     01630000
016400     88  AC-BAD-WRITE                   VALUE  +4001.             01640000
016500     88  AC-CONTROL-CARD-ERROR          VALUE  +4003.             01650000
016600     88  AC-OPEN-ERROR                  VALUE  +4005.             01660000
016700     88  AC-CLOSE-ERROR                 VALUE  +4006.             01670000
016800     88  AC-BAD-DATA                    VALUE  +4008.             01680000
016900     88  AC-ORA-ERROR                   VALUE  +4013.             01690000
017000     88  AC-UNSUCCESSFUL-SELECT         VALUE  +4015.             01700000
017100     88  AC-MAX-RETRIES-EXCEEDED        VALUE  +4016.             01710000
017200     88  AC-DATE-ERROR                  VALUE  +4019.             01720000
017300                                                                  01730000
017400 01  ABEND-AREAS.                                                 01740000
017500     05  AA-ABEND-LIT                   PIC  X(40)  VALUE         01750000
017600             '*****       ABEND'.                                 01760000
017700     05  AA-PROGRAM-LIT                 PIC  X(40)  VALUE         01770000
017800             '*****   PROGRAM: APKUT363'.                         01780000
017900     05  AA-PARAGRAPH-LIT.                                        01790000
018000         10  FILLER                     PIC  X(17)  VALUE         01800000
018100             '***** PARAGRAPH: '.                                 01810000
018200         10  AA-PARAGRAPH-NAME          PIC  X(35)  VALUE SPACES. 01820000
018300     05  AA-MESSAGE-LINE.                                         01830000
018400         10  FILLER                     PIC  X(06)  VALUE         01840000
018500             '*****'.                                             01850000
018600         10  AA-MESSAGE                 PIC  X(127) VALUE SPACES. 01860000
018700         10  FILLER REDEFINES AA-MESSAGE.                         01870000
018800             15 AA-MESSAGE-1     PIC  X(45).                      01880000
018900             15 AA-MESSAGE-2     PIC  X(45).                      01890000
019000             15 AA-MESSAGE-3     PIC  X(37).                      01900000
019100     05  AA-ORA-ERROR-LIT               PIC  X(40)  VALUE         01910000
019200             '*****    ORACLE ERROR'.                             01920000
019300     05  AA-ORA-OPERATION-LIT.                                    01930000
019400         10  FILLER                     PIC  X(17)  VALUE         01940000
019500             '***** OPERATION: '.                                 01950000
019600         10  AA-ORA-OPERATION.                                    01960000
019700             15  AA-ORA-OP-1            PIC  X(25)  VALUE SPACES. 01970000
019800             15  AA-ORA-OP-2            PIC  X(25)  VALUE SPACES. 01980000
019900     05  AA-ORA-TABLE-1                 PIC  X(18)  VALUE SPACES. 01990000
020000     05  AA-ORA-TABLE-2                 PIC  X(18)  VALUE SPACES. 02000000
020100     05  AA-ORA-TABLE-3                 PIC  X(18)  VALUE SPACES. 02010000
020200     05  AA-ORA-TABLE-4                 PIC  X(18)  VALUE SPACES. 02020000
020300     05  AA-ORA-TABLE-5                 PIC  X(18)  VALUE SPACES. 02030000
020400 EJECT                                                            02040000
020500                                                                  02050000
020600*--------------------------------------------------------------*  02060000
020700*   THIS IS THE RECORD LAYOUT FOR THE STATE TAX AUDIT FILE     *  02070000
020800*--------------------------------------------------------------*  02080000
020900     COPY APRD216.                                                02090000
021000 EJECT                                                            02100000
021100                                                                  02110000
021200*--------------------------------------------------------------*  02120000
021300* WORKING STORAGE FOR CALENDAR ROUTINE                         *  02130000
021400*--------------------------------------------------------------*  02140000
021500     COPY DPWS500.                                                02150000
021600 EJECT                                                            02160000
021700                                                                  02170000
021800*--------------------------------------------------------------*  02180000
021900*  DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA     *  02190000
022000*  MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS. *  02200000
022100*--------------------------------------------------------------*  02210000
022200     COPY DPWS004.                                                02220000
022300 EJECT                                                            02230000
022400                                                                  02240000
022500 01  CC-ORACLE-CONNECTION.                                        02250000
022600     05  CC-ORACLE-USERID               PIC X(40).                02260000
022700         88 CC-AUTO-SIGNON-IND                     VALUE '/'.     02270000
022800     05  CC-ORACLE-PASSWORD             PIC X(40).                02280000
022900******************************************************************02290000
023000*                      O  R  A  C  L  E                          *02300000
023100*=================================================================02310000
023200* ORACLE DECLARE SECTION                                         *02320000
023300* ORACLE USED AND RETURNED VARIABLES                             *02330000
023400******************************************************************02340000
023500     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02350000
023600                                                                  02360000
023700     EXEC ORACLE OPTION (PREFETCH=5000) END-EXEC.                 02370000
023800                                                                  02380000
023900*----------------------------------------------------------------*02390000
024000* ORACLE LOGON WORKING STORAGE COPYBOOK                          *02400000
024100*----------------------------------------------------------------*02410000
024200 01  PC-ENT01-TYPE-CDE                  PIC X(02)  VALUE '01'.    02420000
024300 01  PV-ORACLE-ID                       PIC X(01)  VALUE '/'.     02430000
024400                                                                  02440000
024500 01  USERNAME                           PIC X(10)  VARYING.       02450000
024600 01  PASSWD                             PIC X(10)  VARYING.       02460000
024700                                                                  02470000
024800 01  ORACLE-RETURN                      PIC X(200) VALUE SPACES.  02480000
024900*--------------------------------------------------------------*  02490000
025000*  PEOPLESOFT VENDOR TABLE                                     *  02500000
025100*--------------------------------------------------------------*  02510000
025200     EXEC SQL                                                     02520000
025300          INCLUDE FIT00236                                        02530000
025400     END-EXEC.                                                    02540000
025500 EJECT                                                            02550000
025600*--------------------------------------------------------------*  02560000
025700*  PEOPLESOFT PS_AP_ARC_PYM_TB_H TABLE                         *  02570000
025800*--------------------------------------------------------------*  02580000
025900     EXEC SQL                                                     02590000
026000          INCLUDE FIT00279                                        02600000
026100     END-EXEC.                                                    02610000
026200 EJECT                                                            02620000
026300*--------------------------------------------------------------*  02630000
026400*  PEOPLESOFT PS_AP_ARC_PYM_XR_H TABLE                         *  02640000
026500*--------------------------------------------------------------*  02650000
026600     EXEC SQL                                                     02660000
026700          INCLUDE FIT00280                                        02670000
026800     END-EXEC.                                                    02680000
026900 EJECT                                                            02690000
027000*--------------------------------------------------------------*  02700000
027100*  PEOPLESOFT PS_AP_ARC_VOUCH_H TABLE                          *  02710000
027200*--------------------------------------------------------------*  02720000
027300     EXEC SQL                                                     02730000
027400          INCLUDE FIT00281                                        02740000
027500     END-EXEC.                                                    02750000
027600 EJECT                                                            02760000
027700*--------------------------------------------------------------*  02770000
027800*  PEOPLESOFT PS_AP_ARC_VCH_LN_H TABLE                         *  02780000
027900*--------------------------------------------------------------*  02790000
028000     EXEC SQL                                                     02800000
028100          INCLUDE FIT00282                                        02810000
028200     END-EXEC.                                                    02820000
028300 EJECT                                                            02830000
028400*--------------------------------------------------------------*  02840000
028500*  PEOPLESOFT PS_AP_ARC_DIST_L_H TABLE                         *  02850000
028600*--------------------------------------------------------------*  02860000
028700     EXEC SQL                                                     02870000
028800          INCLUDE FIT00283                                        02880000
028900     END-EXEC.                                                    02890000
029000 EJECT                                                            02900000
029100*--------------------------------------------------------------*  02910000
029200*LOCATION TABLE PS_XFT_LOC                                     *  02920000
029300*--------------------------------------------------------------*  02930000
029400*    EXEC SQL                                                     02940000
029500*         INCLUDE FIT00264                                        02950000
029600*    END-EXEC.                                                    02960000
029700*EJECT                                                            02970000
029800*--------------------------------------------------------------*  02980000
029900*ATTRIBUTE TABLE PS_XFT_LOC_ATTR                               *  02990000
030000*--------------------------------------------------------------*  03000000
030100     EXEC SQL                                                     03010000
030200          INCLUDE FIT00266                                        03020000
030300     END-EXEC.                                                    03030000
030400 EJECT                                                            03040000
030500*--------------------------------------------------------------*  03050000
030600* PROJECT ACTIVITY TABLE PS_PROJ_ACTIVITY                      *  03060000
030700*--------------------------------------------------------------*  03070000
030800     EXEC SQL                                                     03080000
030900          INCLUDE FIT00288                                        03090000
031000     END-EXEC.                                                    03100000
031100                                                                  03110000
031200*--------------------------------------------------------------*  03120000
031300* GL ACCOUNT TABLE  PS_GL_ACCOUNT_TBL                          *  03130000
031400*--------------------------------------------------------------*  03140000
031500     EXEC SQL                                                     03150000
031600          INCLUDE FIT00170                                        03160000
031700     END-EXEC.                                                    03170000
031800                                                                  03180000
031900 EJECT                                                            03190000
032000                                                                  03200000
032100     EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       03210000
032200     EXEC SQL END DECLARE SECTION END-EXEC.                       03220000
032300*--------------------------------------------------------------*  03230000
032400*  AUDIT_CSR                                                   *  03240000
032500*--------------------------------------------------------------*  03250000
032600     EXEC SQL                                                     03260000
032700       DECLARE AUDIT_CSR CURSOR FOR                               03270000
032800          SELECT A.VOUCHER_ID                                     03280000
032900               , A.VENDOR_ID                                      03290000
033000               , A.INVOICE_ID                                     03300000
033100               , TO_CHAR(A.INVOICE_DT, 'YYYY-MM-DD')              03310000
033200               , TO_CHAR(A.ACCOUNTING_DT, 'YYYY-MM-DD')           03320000
033300               , A.ORIGIN                                         03330000
033400               , A.VOUCHER_STYLE                                  03340000
033500               , C.ACCOUNT                                        03350000
033600               , C.MONETARY_AMOUNT                                03360000
033700               , C.FREIGHT_AMT                                    03370000
033800               , C.SALETX_AMT                                     03380000
033900               , C.MERCHANDISE_AMT                                03390000
034000               , C.DSCNT_AMT                                      03400000
034100               , C.DEPTID                                         03410000
034200               , C.PROJECT_ID                                     03420000
034300               , C.ACTIVITY_ID                                    03430000
034400               , C.PROFILE_ID                                     03440000
034500               , C.BUSINESS_UNIT_PC                               03450000
034600               , E.PYMNT_ID_REF                                   03460000
034700               , E.REMIT_VENDOR                                   03470000
034800               , E.NAME1                                          03480000
034900               , TO_CHAR(E.PYMNT_DT,'YYYY-MM-DD')                 03490000
035000               , G.DESCR                                          03500000
035100            FROM PS_AP_ARC_VOUCH_H A                              03510000
035200               , PS_AP_ARC_DIST_L_H C                             03520000
035300               , PS_AP_ARC_PYM_XR_H D                             03530000
035400               , PS_AP_ARC_PYM_TB_H E                             03540000
035500               , PS_GL_ACCOUNT_TBL G                              03550000
035600           WHERE A.BUSINESS_UNIT      = 'KDS'                     03560000
035700             AND A.ORIGIN IN ('ONL','E98','E99','EPM','EPL',      03570000
035800                              'E8L','E8M','E8S','E8T','E8U',      03580000
035900                              'E8V','E8W','E8X','E9U','E9V',      03590000
036000                              'EPA','EPB','EPC','EPD','EPE',      03600000
036100                              'EPF','EBA','EBB','EPN','EPP',      03610028
036110                              'EPQ','EPR','EPS','EPT','EPU',      03611028
036120                              'EPV','EPW','EPX','EPY','EPZ',      03612028
036130                              'EQA','EQB')                        03613028
036200             AND A.BUSINESS_UNIT      = C.BUSINESS_UNIT           03620000
036300             AND A.VOUCHER_ID         = C.VOUCHER_ID              03630000
036400             AND A.PSARCH_ID          = C.PSARCH_ID               03640000
036500             AND A.PSARCH_ID          = D.PSARCH_ID               03650000
036600             AND C.ACCOUNT            NOT IN ('50000')            03660000
036700             AND D.PYMNT_SELCT_STATUS = 'P'                       03670000
036800             AND D.BUSINESS_UNIT      = A.BUSINESS_UNIT           03680000
036900             AND D.VOUCHER_ID         = A.VOUCHER_ID              03690000
037000             AND A.ACCOUNTING_DT BETWEEN TO_DATE(:CC-BEGIN-DATE,  03700000
037100                                                   'YYYY-MM-DD')  03710000
037200                                     AND TO_DATE(:CC-END-DATE,    03720000
037300                                                 'YYYY-MM-DD')    03730000
037400             AND E.BANK_SETID         = D.BANK_SETID              03740000
037500             AND E.BANK_CD            = D.BANK_CD                 03750000
037600             AND E.BANK_ACCT_KEY      = D.BANK_ACCT_KEY           03760000
037700             AND E.PYMNT_ID           = D.PYMNT_ID                03770000
037800             AND E.PYMNT_METHOD       = D.PYMNT_METHOD            03780000
037900             AND E.PAY_CYCLE          = D.PAY_CYCLE               03790000
038000             AND E.PAY_CYCLE_SEQ_NUM  = D.PAY_CYCLE_SEQ_NUM       03800000
038100             AND E.REMIT_VENDOR       = D.REMIT_VENDOR            03810000
038200             AND G.EFFDT =                                        03820000
038300                 (SELECT MAX(G_ED.EFFDT)                          03830000
038400                    FROM PS_GL_ACCOUNT_TBL G_ED                   03840000
038500                   WHERE G.SETID = G_ED.SETID                     03850000
038600                     AND G.ACCOUNT = G_ED.ACCOUNT                 03860000
038700                     AND G_ED.EFFDT <= A.ACCOUNTING_DT)           03870000
038800             AND G.SETID = 'SHARE'                                03880000
038900             AND G.ACCOUNT = C.ACCOUNT                            03890000
039000     END-EXEC.                                                    03900000
039100                                                                  03910000
039200*--------------------------------------------------------------*  03920000
039300*  XPEDX_FEED_CSR                                              *  03930000
039400*--------------------------------------------------------------*  03940000
039500     EXEC SQL                                                     03950000
039600       DECLARE XPEDX_FEED_CSR CURSOR FOR                          03960000
039700          SELECT A.VOUCHER_ID                                     03970000
039800               , A.VENDOR_ID                                      03980000
039900               , A.INVOICE_ID                                     03990000
040000               , TO_CHAR(A.INVOICE_DT, 'YYYY-MM-DD')              04000000
040100               , TO_CHAR(A.ACCOUNTING_DT, 'YYYY-MM-DD')           04010000
040200               , A.ORIGIN                                         04020000
040300               , A.VOUCHER_STYLE                                  04030000
040400               , C.ACCOUNT                                        04040000
040500               , C.MONETARY_AMOUNT                                04050000
040600               , C.FREIGHT_AMT                                    04060000
040700               , C.SALETX_AMT                                     04070000
040800               , C.MERCHANDISE_AMT                                04080000
040900               , C.DSCNT_AMT                                      04090000
041000               , C.DEPTID                                         04100000
041200               , C.PROJECT_ID                                     04120000
041300               , C.ACTIVITY_ID                                    04130000
041400               , C.PROFILE_ID                                     04140000
041500               , C.BUSINESS_UNIT_PC                               04150000
041600               , E.PYMNT_ID_REF                                   04160000
041700               , E.REMIT_VENDOR                                   04170000
041800               , E.NAME1                                          04180000
041900               , TO_CHAR(E.PYMNT_DT,'YYYY-MM-DD')                 04190000
042000               , G.DESCR                                          04200000
042100            FROM PS_AP_ARC_VOUCH_H A                              04210000
042200               , PS_AP_ARC_DIST_L_H C                             04220000
042300               , PS_AP_ARC_PYM_XR_H D                             04230000
042400               , PS_AP_ARC_PYM_TB_H E                             04240000
042500               , PS_GL_ACCOUNT_TBL G                              04250000
042600           WHERE A.BUSINESS_UNIT      = 'KDS'                     04260000
042700             AND A.ORIGIN IN ('ONL','E98','E99','EPM','EPL',      04270000
042800                              'E8L','E8M','E8S','E8T','E8U',      04280000
042900                              'E8V','E8W','E8X','E9U','E9V',      04290000
043000                              'EPA','EPB','EPC','EPD','EPE',      04300000
043100                              'EPF','E83','E84','EBA','EBB',      04310028
043110                              'EPN','EPP','EPQ','EPR','EPS',      04311028
043120                              'EPT','EPU','EPV','EPW','EPX',      04312028
043130                              'EPY','EPZ','EQA','EQB')            04313028
043200             AND C.BUSINESS_UNIT   =  A.BUSINESS_UNIT             04320000
043300             AND C.VOUCHER_ID         = A.VOUCHER_ID              04330000
043400             AND A.PSARCH_ID          = C.PSARCH_ID               04340000
043500             AND A.PSARCH_ID          = D.PSARCH_ID               04350000
043600             AND C.ACCOUNT            NOT IN ('50000')            04360000
043700             AND D.PYMNT_SELCT_STATUS = 'P'                       04370000
043800             AND D.BUSINESS_UNIT      = A.BUSINESS_UNIT           04380000
043900             AND D.VOUCHER_ID         = A.VOUCHER_ID              04390000
044000             AND A.ACCOUNTING_DT BETWEEN TO_DATE(:CC-BEGIN-DATE,  04400000
044100                                                   'YYYY-MM-DD')  04410000
044200                                     AND TO_DATE(:CC-END-DATE,    04420000
044300                                                 'YYYY-MM-DD')    04430000
044400             AND E.BANK_SETID         = D.BANK_SETID              04440000
044500             AND E.BANK_CD            = D.BANK_CD                 04450000
044600             AND E.BANK_ACCT_KEY      = D.BANK_ACCT_KEY           04460000
044700             AND E.PYMNT_ID           = D.PYMNT_ID                04470000
044800             AND E.PYMNT_METHOD       = D.PYMNT_METHOD            04480000
044900             AND E.PAY_CYCLE          = D.PAY_CYCLE               04490000
045000             AND E.PAY_CYCLE_SEQ_NUM  = D.PAY_CYCLE_SEQ_NUM       04500000
045100             AND E.REMIT_VENDOR       = D.REMIT_VENDOR            04510000
045200             AND G.EFFDT =                                        04520000
045300                 (SELECT MAX(G_ED.EFFDT)                          04530000
045400                    FROM PS_GL_ACCOUNT_TBL G_ED                   04540000
045500                   WHERE G.SETID = G_ED.SETID                     04550000
045600                     AND G.ACCOUNT = G_ED.ACCOUNT                 04560000
045700                     AND G_ED.EFFDT <= A.ACCOUNTING_DT)           04570000
045800             AND G.SETID = 'SHARE'                                04580000
045900             AND G.ACCOUNT = C.ACCOUNT                            04590000
046000         ORDER BY A.VOUCHER_ID                                    04600000
046100     END-EXEC.                                                    04610000
046200                                                                  04620000
046300 PROCEDURE DIVISION.                                              04630000
046400 A100-MAINLINE-ROUTINE.                                           04640000
046500                                                                  04650000
046600     PERFORM B100-INITIALIZATION.                                 04660000
046700                                                                  04670000
046800     PERFORM B200-PROCESS-AUDIT-CSR                               04680000
046900       UNTIL AUDIT-END-OF-CSR.                                    04690000
047000                                                                  04700000
047100     PERFORM B300-TERMINATION.                                    04710000
047200     GOBACK.                                                      04720000
047300                                                                  04730000
047400*--------------------------------------------------------------*  04740000
047500*  INITIALIZATION PROCESSING                                   *  04750000
047600*--------------------------------------------------------------*  04760000
047700 B100-INITIALIZATION.                                             04770000
047800                                                                  04780000
047900     DISPLAY ' '.                                                 04790000
048000     DISPLAY '**----------- APKUT363 BEGINS -------------**'.     04800000
048100     DISPLAY '**-------  ACCOUNTING DATE VERSION  -------**'.     04810000
048200     DISPLAY 'SYSTEM DATE ' FUNCTION CURRENT-DATE(1:8)            04820000
048300     DISPLAY 'SYSTEM TIME ' FUNCTION CURRENT-DATE(9:6)            04830000
048400                                                                  04840000
048500     ACCEPT CC-CONTROL-CARD.                                      04850000
048600     DISPLAY ' '.                                                 04860000
048700     DISPLAY 'STATE CODE = ' CC-STATE-CD.                         04870000
048800     DISPLAY 'BEGIN DATE = ' CC-BEGIN-DATE.                       04880000
048900     DISPLAY 'END   DATE = ' CC-END-DATE.                         04890000
049000     DISPLAY ' '.                                                 04900000
049100                                                                  04910000
049200** THIS VERIFIES THE CONTROL CARD DATE, CC-BEGIN-DATE             04920000
049300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04930000
049400     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      04940000
049500     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            04950000
049600     MOVE CC-BEGIN-DATE TO DPG52-DB2-ISO-DATE-FMT                 04960000
049700     PERFORM Z900-CALENDAR-ROUTINE.                               04970000
049800     IF (DPG54-SEVERE-ERROR) OR                                   04980000
049900        (DPG54-WARNING-ERROR)                                     04990000
050000         SET AC-DATE-ERROR TO TRUE                                05000000
050100         MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-NAME          05010000
050200         MOVE DPG54-ERROR-MESSAGE   TO AA-MESSAGE                 05020000
050300         PERFORM Z999-ABEND                                       05030000
050400     END-IF.                                                      05040000
050500                                                                  05050000
050600** THIS VERIFIES THE CONTROL CARD DATE, CC-END-DATE               05060000
050700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05070000
050800     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      05080000
050900     SET DPG52-LK-DTE-ISO-FMT TO TRUE.                            05090000
051000     MOVE CC-END-DATE TO DPG52-DB2-ISO-DATE-FMT                   05100000
051100     PERFORM Z900-CALENDAR-ROUTINE.                               05110000
051200     IF (DPG54-SEVERE-ERROR) OR                                   05120000
051300        (DPG54-WARNING-ERROR)                                     05130000
051400         SET AC-DATE-ERROR TO TRUE                                05140000
051500         MOVE 'B100-INITIALIZATION' TO AA-PARAGRAPH-NAME          05150000
051600         MOVE DPG54-ERROR-MESSAGE   TO AA-MESSAGE                 05160000
051700         PERFORM Z999-ABEND                                       05170000
051800     END-IF.                                                      05180000
051900                                                                  05190000
052000     INITIALIZE AP216-STATE-TAX-AUDIT-RECORD.                     05200000
052100     OPEN INPUT  ORACLE-LOGIN-FILE                                05210000
052200                 DEPTID-SELECTION-FILE                            05220000
052300          OUTPUT STATE-TAX-AUDIT-HST-FILE.                        05230000
052400                                                                  05240000
052500     PERFORM B150-CONNECT-TO-ORACLE.                              05250000
052600                                                                  05260000
052700***  DISPLAY 'OPEN STORE CURSOR'                                  05270000
052800***  PERFORM Y100-OPEN-STORE-CSR.                                 05280000
052900**   LOAD STORE TABLE                                             05290000
053000     DISPLAY 'LOAD STORE TABLE'                                   05300000
053100     INITIALIZE STATE-STORE-TABLE.                                05310000
053200     PERFORM UNTIL STATE-STORE-SUB > 9998                         05320000
053300             OR END-OF-DEPTID-FILE                                05330000
053400        PERFORM R100-READ-DEPTID-FILE                             05340000
053500        DISPLAY 'DEPTID=>' SI-DEPTID                              05350000
053600        ADD 1 TO STATE-STORE-SUB                                  05360000
053700        MOVE SI-DEPTID TO STATE-DEPTID(STATE-STORE-SUB)           05370000
053800     END-PERFORM.                                                 05380000
053900     MOVE STATE-STORE-SUB TO PV-STATE-STORE-TOTAL                 05390000
054000**   PERFORM Y200-CLOSE-STORE-CSR.                                05400000
054100                                                                  05410000
054200                                                                  05420000
054300     DISPLAY 'OPEN AUDIT CURSOR'                                  05430000
054400     PERFORM Y300-OPEN-AUDIT-CSR.                                 05440000
054500     DISPLAY 'TIME ' FUNCTION CURRENT-DATE(9:6)                   05450000
054600     PERFORM F200-FETCH-AUDIT-CSR.                                05460000
054700 EJECT.                                                           05470000
054800*--------------------------------------------------------------*  05480000
054900****************************************************************  05490000
055000*    LOGON TO ORACLE                                           *  05500000
055100*    - THIS PARA READS ORACLE-LOGIN-FILE TO ACCEPT ORACLE      *  05510000
055200*      CREDENTIALS                                             *  05520000
055300****************************************************************  05530000
055400 B150-CONNECT-TO-ORACLE.                                          05540000
055500                                                                  05550000
055600     READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION             05560000
055700        AT END                                                    05570000
055800             SET ORACLE-LOGIN-EOF TO TRUE.                        05580000
055900                                                                  05590000
056000     IF NOT ORACLE-LOGIN-EOF                                      05600000
056100        INITIALIZE PV-ORACLE-USERID-LEN                           05610000
056200                   PV-ORACLE-PASSWORD-LEN                         05620000
056300        INSPECT CC-ORACLE-USERID                                  05630000
056400            TALLYING PV-ORACLE-USERID-LEN                         05640000
056500            FOR CHARACTERS BEFORE INITIAL SPACE                   05650000
056600        INSPECT CC-ORACLE-PASSWORD                                05660000
056700            TALLYING PV-ORACLE-PASSWORD-LEN                       05670000
056800            FOR CHARACTERS BEFORE INITIAL SPACE                   05680000
056900        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         05690000
057000                   USERNAME-ARR                                   05700000
057100        MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                 05710000
057200        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     05720000
057300                   PASSWD-ARR                                     05730000
057400        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 05740000
057500                                                                  05750000
057600     IF CC-AUTO-SIGNON-IND                                        05760000
057700         DISPLAY PV-PROGRAM-NAME ' - AUTO SIGN-ON TO ORACLE'      05770000
057800         EXEC SQL                                                 05780000
057900              CONNECT :USERNAME                                   05790000
058000         END-EXEC                                                 05800000
058100     ELSE                                                         05810000
058200         DISPLAY PV-PROGRAM-NAME ' - SIGN-ON TO ORACLE AS USER '  05820000
058300                   USERNAME-ARR                                   05830000
058400         EXEC SQL                                                 05840000
058500              CONNECT :USERNAME IDENTIFIED BY :PASSWD             05850000
058600         END-EXEC                                                 05860000
058700     END-IF                                                       05870000
058800                                                                  05880000
058900     INITIALIZE CC-ORACLE-PASSWORD                                05890000
059000                PASSWD                                            05900000
059100                PV-ORACLE-PASSWORD-LEN                            05910000
059200                PASSWD-LEN                                        05920000
059300                                                                  05930000
059400     IF (SQLCODE NOT = 0)                                         05940000
059500         MOVE 'B150-CONNECT-TO-ORACLE' TO AA-PARAGRAPH-NAME       05950000
059600         DISPLAY PV-PROGRAM-NAME ' - ERROR SIGNING ON TO ORACLE'  05960000
059700         PERFORM Z998-ORA-ABEND                                   05970000
059800     END-IF.                                                      05980000
059900*                                                                 05990000
060000*                                                                 06000000
060100                                                                  06010000
060200*--------------------------------------------------------------*  06020000
060300*  THIS ROUTINE HOLDS THE MAIN LOGIC FOR CREATING THE STATE    *  06030000
060400*  TAX AUDIT FILE.                                             *  06040000
060500*--------------------------------------------------------------*  06050000
060600 B200-PROCESS-AUDIT-CSR.                                          06060000
060700                                                                  06070000
060800      MOVE PYMNT-ID-REF OF FIT00279 TO PV-PYMNT-ID-REF            06080000
060900      MOVE PV-PYMNT-ID-REF(1:10)    TO AP216-CHECK-NBR.           06090000
061000                                                                  06100000
061100**    GET THE VENDOR NAME FROM THE VENDOR TABLE                   06110000
061200      IF REMIT-VENDOR OF FIT00279 = VENDOR-ID OF FIT00281         06120000
061300         MOVE REMIT-VENDOR OF FIT00279   TO AP216-VENDOR-NBR      06130000
061400         MOVE NAME1        OF FIT00279   TO AP216-VENDOR-NAME     06140000
061500      ELSE                                                        06150000
061600         MOVE VENDOR-ID    OF FIT00281   TO AP216-VENDOR-NBR      06160000
061700         PERFORM S100-SELECT-VENDOR-NAME                          06170000
061800         MOVE NAME1        OF FIT00236   TO AP216-VENDOR-NAME     06180000
061900      END-IF.                                                     06190000
062000                                                                  06200000
062100      MOVE PYMNT-DT   OF FIT00279     TO AP216-PAID-DT.           06210000
062200      MOVE INVOICE-ID OF FIT00281     TO AP216-INVOICE-ID.        06220000
062300      MOVE INVOICE-DT OF FIT00281     TO AP216-INVOICE-DT.        06230000
062400      MOVE ACCOUNTING-DT OF FIT00281  TO AP216-ACCOUNTING-DT.     06240000
062500      MOVE ORIGIN     OF FIT00281     TO AP216-ORIGIN.            06250000
062600      MOVE ACCOUNT    OF FIT00283     TO AP216-ACCOUNT.           06260000
062700      MOVE MONETARY-AMOUNT            TO AP216-AMOUNT-PAID.       06270000
062800      MOVE FREIGHT-AMT OF FIT00283    TO AP216-FREIGHT-AMT.       06280000
062900      MOVE SALETX-AMT OF FIT00283     TO AP216-SALETX-AMT.        06290000
063000      MOVE DSCNT-AMT    OF FIT00283   TO AP216-DISCOUNT-AMT.      06300000
063100      MOVE PROJECT-ID   OF FIT00283   TO AP216-PROJECT-ID.        06310000
063200      MOVE DESCR        OF FIT00170   TO AP216-ACCT-DESCR.        06320000
063300                                                                  06330000
063400** NOTE: THIRD PARTY VOUCHERS WILL HAVE A VALUE IN THE MERCHANDISE06340000
063500**       AMOUNT FIELD THAT WAS COPIED FROM THE PO AND IS USED FOR 06350000
063600**       DISTRIBUTING THE FREIGHT AMOUNT ON VOUCHER ENTRY.  IT IS 06360000
063700**       NOT INCLUDED IN THE MONETARY AMOUNT CALCULATION ON THE   06370000
063800**       DISTRIB LINE.  WE ARE MOVING ZEROES TO THIS FIELD SO THAT06380000
063900**       THIS AMOUNT IS NOT SHOWN ON THE SALESTAX EXTRACT FILE    06390000
064000**       WHERE THE DETAIL AMOUNTS APPEAR.                         06400000
064100      IF VOUCHER-STYLE OF FIT00281 = 'THRD'                       06410000
064200         MOVE ZERO TO AP216-MERCHANDISE-AMT                       06420000
064300      ELSE                                                        06430000
064400         MOVE MERCHANDISE-AMT OF FIT00283 TO AP216-MERCHANDISE-AMT06440000
064500      END-IF.                                                     06450000
064600                                                                  06460000
064700      IF  ACTIVITY-ID OF FIT00283 = SPACE                         06470000
064800      OR  PROJECT-ID OF FIT00283 = SPACE                          06480000
064900          MOVE SPACES TO AP216-ACTIVITY-ID                        06490000
065000                         AP216-ACTIVITY-DESCR                     06500000
065100                         AP216-ACTIVITY-TYPE                      06510000
065200                         AP216-ASSET-PROFILE                      06520000
065300      ELSE                                                        06530000
065400          MOVE ACTIVITY-ID OF FIT00283   TO AP216-ACTIVITY-ID     06540000
065500          MOVE PROFILE-ID OF FIT00283    TO AP216-ASSET-PROFILE   06550000
065600          PERFORM S300-SELECT-ACTIVITY-INFO                       06560000
065700          MOVE DESCR OF FIT00288         TO AP216-ACTIVITY-DESCR  06570000
065800          MOVE ACTIVITY-TYPE OF FIT00288 TO AP216-ACTIVITY-TYPE   06580000
065900      END-IF.                                                     06590000
066000                                                                  06600000
066100      MOVE DEPTID OF FIT00283 TO PV-DEPTID                        06610000
066200                                                                  06620000
066300**    CHECK TO SEE IF DEPTID IS IN LIST TO BE AUDITED.            06630000
066400      PERFORM VARYING STATE-STORE-SUB FROM 1 BY 1                 06640000
066500        UNTIL STATE-DEPTID(STATE-STORE-SUB) = PV-DEPTID           06650000
066600           OR STATE-DEPTID(STATE-STORE-SUB) > PV-DEPTID           06660000
066700           OR STATE-DEPTID(STATE-STORE-SUB) = 0                   06670000
066800           OR STATE-STORE-SUB > 9998                              06680000
066900      END-PERFORM.                                                06690000
067000                                                                  06700000
067100      IF STATE-DEPTID(STATE-STORE-SUB) = PV-DEPTID                06710000
067200         MOVE PV-DEPTID(1:5) TO AP216-DEPTID                      06720000
067300         PERFORM W100-WRITE-STATE-TAX-AUDIT                       06730000
067400      END-IF.                                                     06740000
067500                                                                  06750000
067600      PERFORM F200-FETCH-AUDIT-CSR.                               06760000
067700 EJECT.                                                           06770000
067800                                                                  06780000
067900*--------------------------------------------------------------*  06790000
068000*  END OF PROGRAM PROCESSING                                   *  06800000
068100*--------------------------------------------------------------*  06810000
068200 B300-TERMINATION.                                                06820000
068300                                                                  06830000
068400     DISPLAY '*********************************************'.     06840000
068500     DISPLAY '**      RECORD COUNTS                      **'.     06850000
068600     DISPLAY '*********************************************'.     06860000
068700     DISPLAY 'TOTAL STORES FOR STATE ' PV-STATE-STORE-TOTAL.      06870000
068800     DISPLAY 'AUDIT CURSOR COUNT     ' AUDIT-CSR-COUNT.           06880000
068900     DISPLAY 'AUDIT RECORDS WRITTEN  ' AUDIT-OUT-COUNT.           06890000
069000     DISPLAY '*********************************************'.     06900000
069100     DISPLAY '********  END OF PROGRAM APKUT363  **********'.     06910000
069200     DISPLAY '*********************************************'.     06920000
069300                                                                  06930000
069400     PERFORM Y400-CLOSE-AUDIT-CSR.                                06940000
069500                                                                  06950000
069600     CLOSE ORACLE-LOGIN-FILE                                      06960000
069700           STATE-TAX-AUDIT-HST-FILE.                              06970000
069800                                                                  06980000
069900     DISPLAY '**----------- APKUT363 ENDS ---------------**'.     06990000
070000 EJECT.                                                           07000000
070100                                                                  07010000
070200 F200-FETCH-AUDIT-CSR.                                            07020000
070300                                                                  07030000
070400     EXEC SQL                                                     07040000
070500         FETCH AUDIT_CSR                                          07050000
070600          INTO :FIT00281.VOUCHER-ID                               07060000
070700             , :FIT00281.VENDOR-ID                                07070000
070800             , :FIT00281.INVOICE-ID                               07080000
070900             , :FIT00281.INVOICE-DT                               07090000
071000             , :FIT00281.ACCOUNTING-DT                            07100000
071100             , :FIT00281.ORIGIN                                   07110000
071200             , :FIT00281.VOUCHER-STYLE                            07120000
071300             , :FIT00283.ACCOUNT                                  07130000
071400             , :FIT00283.MONETARY-AMOUNT                          07140000
071500             , :FIT00283.FREIGHT-AMT                              07150000
071600             , :FIT00283.SALETX-AMT                               07160000
071700             , :FIT00283.MERCHANDISE-AMT                          07170000
071800             , :FIT00283.DSCNT-AMT                                07180000
071900             , :FIT00283.DEPTID                                   07190000
072000             , :FIT00283.PROJECT-ID                               07200000
072100             , :FIT00283.ACTIVITY-ID                              07210000
072200             , :FIT00283.PROFILE-ID                               07220000
072300             , :FIT00283.BUSINESS-UNIT-PC                         07230000
072400             , :FIT00279.PYMNT-ID-REF                             07240000
072500             , :FIT00279.REMIT-VENDOR                             07250000
072600             , :FIT00279.NAME1                                    07260000
072700             , :FIT00279.PYMNT-DT                                 07270000
072800             , :FIT00170.DESCR                                    07280000
072900     END-EXEC.                                                    07290000
073000                                                                  07300000
073100     EVALUATE TRUE                                                07310000
073200         WHEN SQLCODE = ZERO                                      07320000
073300             ADD 1 TO AUDIT-CSR-COUNT                             07330000
073400         WHEN SQLCODE = +01403                                    07340000
073500             SET AUDIT-END-OF-CSR TO TRUE                         07350000
073600         WHEN OTHER                                               07360000
073700             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                07370000
073800             MOVE 'F200-FETCH-AUDIT-CSR'   TO AA-PARAGRAPH-NAME   07380000
073900             MOVE 'UNSUCCESSFUL FETCH '    TO AA-ORA-OPERATION    07390000
074000             MOVE 'PS_AP_ARC_VOUCH_H'      TO AA-ORA-TABLE-1      07400000
074100             MOVE 'PS_VCHR_LN_HST'         TO AA-ORA-TABLE-2      07410000
074200             MOVE 'PS_AP_ARC_DIST_L_H'     TO AA-ORA-TABLE-3      07420000
074300             MOVE 'PS_AP_ARC_PYM_XR_H'     TO AA-ORA-TABLE-4      07430000
074400             MOVE 'PS_AP_ARC_PYM_TB_H'     TO AA-ORA-TABLE-5      07440000
074500             PERFORM Z998-ORA-ABEND                               07450000
074600     END-EVALUATE.                                                07460000
074700 EJECT.                                                           07470000
074800*--------------------------------------------------------------*  07480000
074900* READ THE STATE TAX AUDIT DEPTID LIST FILE                    *  07490000
075000*--------------------------------------------------------------*  07500000
075100 R100-READ-DEPTID-FILE.                                           07510000
075200                                                                  07520000
075300     READ DEPTID-SELECTION-FILE INTO SI-DEPTID-RECORD             07530000
075400       AT END                                                     07540000
075500          SET END-OF-DEPTID-FILE TO TRUE                          07550000
075600       NOT AT END                                                 07560000
075700          ADD 1                  TO DEPTID-COUNT                  07570000
075800     END-READ.                                                    07580000
075900                                                                  07590000
076000 EJECT.                                                           07600000
076100                                                                  07610000
076200*--------------------------------------------------------------*  07620000
076300*  THIS SELECTS THE THE VENDOR NAME FROM THE VENDOR TABLE      *  07630000
076400*  WHEN THE MERCHANDISE CAME FROM A DIFFERENT VENDOR THAN      *  07640000
076500*  THE VENDOR BEING PAID.                                      *  07650000
076600*--------------------------------------------------------------*  07660000
076700 S100-SELECT-VENDOR-NAME.                                         07670000
076800                                                                  07680000
076900     EXEC SQL                                                     07690000
077000         SELECT NAME1                                             07700000
077100           INTO :FIT00236.NAME1                                   07710000
077200           FROM PS_VENDOR                                         07720000
077300          WHERE VENDOR_ID = :FIT00281.VENDOR-ID                   07730000
077400            AND SETID     = 'SHARE'                               07740000
077500     END-EXEC.                                                    07750000
077600                                                                  07760000
077700     EVALUATE TRUE                                                07770000
077800         WHEN SQLCODE = ZERO                                      07780000
077900             CONTINUE                                             07790000
078000         WHEN OTHER                                               07800000
078100             DISPLAY 'REMIT VENDOR ' REMIT-VENDOR OF FIT00279     07810000
078200             DISPLAY 'VENDOR       ' VENDOR-ID    OF FIT00281     07820000
078300             SET AC-UNSUCCESSFUL-SELECT     TO TRUE               07830000
078400             MOVE 'S100-SELECT-VENDOR-NAME' TO AA-PARAGRAPH-NAME  07840000
078500             MOVE 'UNSUCCESSFUL SELECT'     TO AA-ORA-OPERATION   07850000
078600             MOVE 'PS_VENDOR'               TO AA-ORA-TABLE-1     07860000
078700             MOVE SPACES                    TO AA-ORA-TABLE-2     07870000
078800                                               AA-ORA-TABLE-3     07880000
078900                                               AA-ORA-TABLE-4     07890000
079000                                               AA-ORA-TABLE-5     07900000
079100             PERFORM Z998-ORA-ABEND                               07910000
079200     END-EVALUATE.                                                07920000
079300 EJECT.                                                           07930000
079400                                                                  07940000
079500                                                                  07950000
079600*--------------------------------------------------------------*  07960000
079700*  THIS SELECTS THE ACTIVITY DESC AND TYPE FROM THE PROJECT    *  07970000
079800*  ACTIVITY TABLE FOR VOUCHERS WHERE THE PROJECT AND ACTIVITY  *  07980000
079900*  ID WERE NOT BLANK.                                          *  07990000
080000*--------------------------------------------------------------*  08000000
080100 S300-SELECT-ACTIVITY-INFO.                                       08010000
080200                                                                  08020000
080300     EXEC SQL                                                     08030000
080400         SELECT DESCR                                             08040000
080500              , ACTIVITY_TYPE                                     08050000
080600           INTO :FIT00288.DESCR                                   08060000
080700              , :FIT00288.ACTIVITY-TYPE                           08070000
080800           FROM PS_PROJ_ACTIVITY                                  08080000
080900          WHERE BUSINESS_UNIT = :FIT00283.BUSINESS-UNIT-PC        08090000
081000            AND PROJECT_ID = :FIT00283.PROJECT-ID                 08100000
081100            AND ACTIVITY_ID = :FIT00283.ACTIVITY-ID               08110000
081200     END-EXEC.                                                    08120000
081300                                                                  08130000
081400     EVALUATE TRUE                                                08140000
081500         WHEN SQLCODE = ZERO                                      08150000
081600             CONTINUE                                             08160000
081700         WHEN SQLCODE = +01403                                    08170000
081800             MOVE SPACE TO DESCR OF FIT00288                      08180000
081900                           ACTIVITY-TYPE OF FIT00288              08190000
082000         WHEN OTHER                                               08200000
082100             DISPLAY 'VOUCHER = ' VOUCHER-ID OF FIT00281          08210000
082200             DISPLAY 'ACTIVITY-ID = '  ACTIVITY-ID OF FIT00283    08220000
082300             DISPLAY 'PROJECT-ID = '  PROJECT-ID OF FIT00283      08230000
082400             SET AC-UNSUCCESSFUL-SELECT     TO TRUE               08240000
082500             MOVE 'S300-SELECT-ACTIVITY-INFO' TO AA-PARAGRAPH-NAME08250000
082600             MOVE 'UNSUCCESSFUL SELECT'     TO AA-ORA-OPERATION   08260000
082700             MOVE 'PS_PROJ_ACTIVITY'        TO AA-ORA-TABLE-1     08270000
082800             MOVE SPACES                    TO AA-ORA-TABLE-2     08280000
082900             MOVE SPACES                    TO AA-ORA-TABLE-3     08290000
083000             PERFORM Z998-ORA-ABEND                               08300000
083100     END-EVALUATE.                                                08310000
083200                                                                  08320000
083300*--------------------------------------------------------------*  08330000
083400*  THIS ROUTINE WRITES A RECORD TO UPDATE THE INVOICE TABLE    *  08340000
083500*--------------------------------------------------------------*  08350000
083600 W100-WRITE-STATE-TAX-AUDIT.                                      08360000
083700                                                                  08370000
083800     WRITE STATE-TAX-AUDIT-HST-REC                                08380000
083900           FROM AP216-STATE-TAX-AUDIT-RECORD.                     08390000
084000     ADD 1 TO AUDIT-OUT-COUNT.                                    08400000
084100 EJECT.                                                           08410000
084200                                                                  08420000
084300*--------------------------------------------------------------*  08430000
084400*  THIS ROUTINE OPENS THE STATE TAX AUDIT CURSOR               *  08440000
084500*--------------------------------------------------------------*  08450000
084600 Y300-OPEN-AUDIT-CSR.                                             08460000
084700                                                                  08470000
084800     EXEC SQL                                                     08480000
084900         OPEN AUDIT_CSR                                           08490000
085000     END-EXEC.                                                    08500000
085100                                                                  08510000
085200     EVALUATE TRUE                                                08520000
085300         WHEN SQLCODE = ZERO                                      08530000
085400             CONTINUE                                             08540000
085500         WHEN OTHER                                               08550000
085600             SET AC-OPEN-ERROR TO TRUE                            08560000
085700             MOVE 'Y300-OPEN-AUDIT-CSR'  TO AA-PARAGRAPH-NAME     08570000
085800             MOVE 'UNSUCCESSFUL OPEN'    TO AA-ORA-OPERATION      08580000
085900             MOVE 'PS_AP_ARC_VOUCH_H'    TO AA-ORA-TABLE-1        08590000
086000             MOVE 'PS_VCHR_LN_HST'       TO AA-ORA-TABLE-2        08600000
086100             MOVE 'PS_AP_ARC_DIST_L_H'   TO AA-ORA-TABLE-3        08610000
086200             MOVE 'PS_AP_ARC_PYM_XR_H'   TO AA-ORA-TABLE-4        08620000
086300             MOVE 'PS_AP_ARC_PYM_TB_H'   TO AA-ORA-TABLE-5        08630000
086400             PERFORM Z998-ORA-ABEND                               08640000
086500     END-EVALUATE.                                                08650000
086600                                                                  08660000
086700*--------------------------------------------------------------*  08670000
086800*  THIS ROUTINE CLOSES THE CHECK CURSOR                        *  08680000
086900*--------------------------------------------------------------*  08690000
087000 Y400-CLOSE-AUDIT-CSR.                                            08700000
087100                                                                  08710000
087200     EXEC SQL                                                     08720000
087300         CLOSE AUDIT_CSR                                          08730000
087400     END-EXEC.                                                    08740000
087500                                                                  08750000
087600     EVALUATE TRUE                                                08760000
087700         WHEN SQLCODE = ZERO                                      08770000
087800             CONTINUE                                             08780000
087900         WHEN OTHER                                               08790000
088000             SET AC-CLOSE-ERROR TO TRUE                           08800000
088100             MOVE 'Y400-CLOSE-AUDIT-CSR'  TO AA-PARAGRAPH-NAME    08810000
088200             MOVE 'UNSUCCESSFUL CLOSE'    TO AA-ORA-OPERATION     08820000
088300             MOVE 'PS_AP_ARC_VOUCH_H'     TO AA-ORA-TABLE-1       08830000
088400             MOVE 'PS_VCHR_LN_HST'        TO AA-ORA-TABLE-2       08840000
088500             MOVE 'PS_AP_ARC_DIST_L_H'    TO AA-ORA-TABLE-3       08850000
088600             MOVE 'PS_AP_ARC_PYM_XR_H'    TO AA-ORA-TABLE-4       08860000
088700             MOVE 'PS_AP_ARC_PYM_TB_H'    TO AA-ORA-TABLE-5       08870000
088800             PERFORM Z998-ORA-ABEND                               08880000
088900     END-EVALUATE.                                                08890000
089000 EJECT.                                                           08900000
089100                                                                  08910000
089200*--------------------------------------------------------------*  08920000
089300*  THIS ROUTINE CALLS THE NEW FISCAL CALENDAR SUBROUTINE       *  08930000
089400*  TO OBTAIN DATE, PROGRAM NAME DPKUT500                       *  08940000
089500*--------------------------------------------------------------*  08950000
089600 Z900-CALENDAR-ROUTINE.                                           08960000
089700                                                                  08970000
089800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                08980000
089900                                             DPG52                08990000
090000                                             DPG53                09000000
090100                                             DPG54                09010000
090200                                             DPG55                09020000
090300                                             DPG56.               09030000
090400 EJECT.                                                           09040000
090500*--------------------------------------------------------------*  09050000
090600*  ORACLE ABEND ROUTINE                                        *  09060000
090700*--------------------------------------------------------------*  09070000
090800 Z998-ORA-ABEND.                                                  09080000
090900                                                                  09090000
091000     DISPLAY '*********************************************'.     09100000
091100     DISPLAY '!!!!!!!!  PROGRAM APKUT363 ABENDING  !!!!!!!!'.     09110000
091200     DISPLAY '*********************************************'.     09120000
091300     DISPLAY 'TOTAL STORES FOR STATE ' STATE-STORE-SUB.           09130000
091400     DISPLAY 'AUDIT CURSOR COUNT     ' AUDIT-CSR-COUNT.           09140000
091500     DISPLAY 'AUDIT RECORDS WRITTEN  ' AUDIT-OUT-COUNT.           09150000
091600     DISPLAY '*********************************************'.     09160000
091700     DISPLAY '!!!!!!!!  PROGRAM APKUT363 ABENDING  !!!!!!!!'.     09170000
091800     DISPLAY '*********************************************'.     09180000
091900                                                                  09190000
092000     CLOSE ORACLE-LOGIN-FILE                                      09200000
092100           STATE-TAX-AUDIT-HST-FILE.                              09210000
092200                                                                  09220000
092300     DISPLAY AA-ABEND-LIT.                                        09230000
092400     DISPLAY AA-ORA-ERROR-LIT.                                    09240000
092500     DISPLAY AA-PROGRAM-LIT.                                      09250000
092600     DISPLAY AA-PARAGRAPH-LIT.                                    09260000
092700     DISPLAY AA-ORA-OPERATION-LIT.                                09270000
092800     DISPLAY AA-ORA-TABLE-1.                                      09280000
092900     DISPLAY AA-ORA-TABLE-2.                                      09290000
093000     DISPLAY AA-ORA-TABLE-3.                                      09300000
093100     SET AC-ORA-ERROR TO TRUE.                                    09310000
093200                                                                  09320000
093300     COPY DPPD004.                                                09330000
093400                                                                  09340000
093500     CALL 'ILBOABN0' USING ABEND-CODE.                            09350000
093600                                                                  09360000
093700*--------------------------------------------------------------*  09370000
093800*  ABEND ROUTINE                                               *  09380000
093900*--------------------------------------------------------------*  09390000
094000 Z999-ABEND.                                                      09400000
094100                                                                  09410000
094200     DISPLAY '*********************************************'.     09420000
094300     DISPLAY '!!!!!!!!  PROGRAM APKUT363 ABENDING  !!!!!!!!'.     09430000
094400     DISPLAY '*********************************************'.     09440000
094500     DISPLAY 'TOTAL STORES FOR STATE ' STATE-STORE-SUB.           09450000
094600     DISPLAY 'AUDIT CURSOR COUNT     ' AUDIT-CSR-COUNT.           09460000
094700     DISPLAY 'AUDIT RECORDS WRITTEN  ' AUDIT-OUT-COUNT.           09470000
094800     DISPLAY '*********************************************'.     09480000
094900     DISPLAY '!!!!!!!!  PROGRAM APKUT363 ABENDING  !!!!!!!!'.     09490000
095000     DISPLAY '*********************************************'.     09500000
095100                                                                  09510000
095200                                                                  09520000
095300     CLOSE ORACLE-LOGIN-FILE                                      09530000
095400           STATE-TAX-AUDIT-HST-FILE.                              09540000
095500                                                                  09550000
095600     DISPLAY AA-ABEND-LIT.                                        09560000
095700     DISPLAY AA-PROGRAM-LIT.                                      09570000
095800     DISPLAY AA-PARAGRAPH-LIT.                                    09580000
095900     DISPLAY AA-MESSAGE-LINE.                                     09590000
096000                                                                  09600000
096100     CALL 'ILBOABN0' USING ABEND-CODE.                            09610000
096200                                                                  09620000
