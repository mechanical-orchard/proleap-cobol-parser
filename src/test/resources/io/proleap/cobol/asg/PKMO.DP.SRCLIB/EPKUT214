000100*------------------------------------------------------------     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------------------------------------------     00030000
000400 PROGRAM-ID.    EPKUT214.                                         00040001
000500 AUTHOR.        MEDHA CHOUDHURY.                                  00050000
000600 DATE-WRITTEN.  FEB 05, 2009.                                     00060002
000700                                                                  00070000
000800*-------------------------------------------------------------*   00080003
000900*    CUSTOMER INCENTIVE DATA SPLITTER                         *   00090003
001000*-------------------------------------------------------------*   00100003
001100*    THIS PROGRAM WILL READ IN THE NEW CUSTOMER INCENTIVE     *   00110003
001200*    (PROMOTIONS) DATA FILE AND WILL SPLIT INTO FOUR FILES    *   00120003
001300*    EACH MAPPING TO ONE OF THE CUSTOMER INCENTIVE TABLES AT  *   00130003
001310*    THE POS SIDE.                                            *   00131003
001400*    POS 2009 FALL - PRICING INFRASTRUCTURE PROJECT WR# 35484 *   00140003
001500*                                                             *   00150003
001600*------------------------------------------------------------ *   00160003
001700*  INPUT:                                                     *   00170003
001800*        CUST-INCTV-EXTRACT-FILE          EPRD216             *   00180003
001900*                                                             *   00190003
002000*  OUTPUT:                                                    *   00200003
002100*        CUST-INCTV-FILE                  EPRD212             *   00210003
002200*                                                             *   00220003
002210*        CUST-INCTV-SECT-FL               EPRD213             *   00221003
002220*                                                             *   00222003
002230*        CUST-INCTV-PARM-FL               EPRD214             *   00223003
002240*                                                             *   00224003
002250*        CUST-INCTV-MDSE-FL               EPRD215             *   00225003
002260*                                                             *   00226003
002300*-------------------------------------------------------------*   00230003
002400* HISTORY LOG:                                                *   00240003
002500*                                                             *   00250003
002600*-------------------------------------------------------------*   00260003
002700* DATE: FEB 05 2009                                           *   00270003
002800* WR/IR#: WR #35484                                           *   00280003
002900* PROGRAMMER: MEDHA CHOUDHURY                                 *   00290003
003000* DESCRIPTION: INITIAL PROGRAM CREATION                       *   00300003
003100*-------------------------------------------------------------*   00310003
003200* DATE:                                                       *   00320003
003300* WR/IR#:                                                     *   00330003
003400* PROGRAMMER:                                                 *   00340003
003500* DESCRIPTION:                                                *   00350003
003600*                                                             *   00360003
003700****************************************************************  00370004
003800 ENVIRONMENT DIVISION.                                            00380004
003900****************************************************************  00390004
004000 CONFIGURATION SECTION.                                           00400004
004100 SOURCE-COMPUTER. IBM-3090.                                       00410004
004200 OBJECT-COMPUTER. IBM-3090.                                       00420004
004300                                                                  00430004
004400 INPUT-OUTPUT SECTION.                                            00440004
004500                                                                  00450004
004600 FILE-CONTROL.                                                    00460004
004700     SELECT CUST-INCTV-EXTRACT-FILE                               00470004
004800       ASSIGN TO INP01.                                           00480004
004900                                                                  00490004
005300     SELECT CUST-INCTV-FILE                                       00530004
005400       ASSIGN TO OUT01.                                           00540004
005500                                                                  00550004
005600     SELECT CUST-INCTV-SECT-FILE                                  00560004
005700       ASSIGN TO OUT02.                                           00570004
005800                                                                  00580004
005900     SELECT CUST-INCTV-PARM-FILE                                  00590004
006000       ASSIGN TO OUT03.                                           00600004
006100                                                                  00610004
006200     SELECT CUST-INCTV-MDSE-FILE                                  00620004
006300       ASSIGN TO OUT04.                                           00630004
006400                                                                  00640004
006800****************************************************************  00680004
006900 DATA DIVISION.                                                   00690004
007000****************************************************************  00700004
007100 FILE SECTION.                                                    00710004
007200                                                                  00720004
007300 FD  CUST-INCTV-EXTRACT-FILE                                      00730004
007400     RECORDING MODE IS F                                          00740004
007500     LABEL RECORDS ARE STANDARD                                   00750004
007600     DATA RECORD IS OFFERS-DATA-RECORD.                           00760004
007700                                                                  00770004
007800 01  OFFERS-DATA-RECORD                            PIC X(350).    00780004
007900*  COPYBOOK IS EPRD216                                            00790004
008000                                                                  00800004
008900 FD  CUST-INCTV-FILE                                              00890004
009000     RECORDING MODE IS F                                          00900004
009100     LABEL RECORDS ARE STANDARD                                   00910004
009200     DATA RECORD IS CUST-INCTV-REC.                               00920006
009300                                                                  00930004
009400 01  CUST-INCTV-REC                                PIC X(130).    00940009
009500*  COPYBOOK IS EPRD212                                            00950004
009600                                                                  00960004
009700 FD  CUST-INCTV-SECT-FILE                                         00970004
009800     RECORDING MODE IS F                                          00980004
009900     LABEL RECORDS ARE STANDARD                                   00990004
010000     DATA RECORD IS CUST-INCTV-SECT-REC.                          01000004
010100                                                                  01010004
010200 01  CUST-INCTV-SECT-REC                           PIC X(130).    01020009
010300*  COPYBOOK IS EPRD213                                            01030004
010400                                                                  01040004
010500 FD  CUST-INCTV-PARM-FILE                                         01050004
010600     RECORDING MODE IS F                                          01060004
010700     LABEL RECORDS ARE STANDARD                                   01070004
010800     DATA RECORD IS CUST-INCTV-PARM-REC.                          01080006
010900                                                                  01090004
011000 01  CUST-INCTV-PARM-REC                           PIC X(130).    01100009
011100*  COPYBOOK IS EPRD214                                            01110004
011200                                                                  01120004
011300 FD  CUST-INCTV-MDSE-FILE                                         01130004
011400     RECORDING MODE IS F                                          01140004
011500     LABEL RECORDS ARE STANDARD                                   01150004
011600     DATA RECORD IS CUST-INCTV-MDSE-REC.                          01160006
011700                                                                  01170004
011800 01  CUST-INCTV-MDSE-REC                           PIC X(120).    01180009
011900*  COPYBOOK IS EPRD215                                            01190004
012000                                                                  01200004
012100*-------------------------------------------------------------    01210004
012200 WORKING-STORAGE SECTION.                                         01220004
012300*-------------------------------------------------------------    01230004
012400 01  AC-ABEND-CODE                  PIC S9(04) VALUE ZERO         01240004
012500                                               COMP SYNC.         01250004
012800     88  AC-4004-TABLE-OVERFLOW                VALUE +4004.       01280004
013200                                                                  01320004
013300*-------------------------------------------------------------    01330004
013400* PC- PROGRAM CONSTANTS                                           01340004
013500*-------------------------------------------------------------    01350004
013600 01  PC-PROGRAM-CONSTANTS.                                        01360004
013700     05  PC-PROGRAM-NAME            PIC  X(08) VALUE 'EPKUT214'.  01370004
013800     05  PC-MAX-RETRIES             PIC S9(04) VALUE +5 COMP.     01380004
014200     05  PC-NULL-VALUE              PIC X(01) VALUE '~'.          01420004
014410     05  PC-TABL-IDX-MAX            PIC S9(02) VALUE +10 COMP.    01441021
014500                                                                  01450004
014600*-------------------------------------------------------------    01460004
014700* PS- PROGRAM SWITCHES                                            01470004
014800*-------------------------------------------------------------    01480004
014900 01  PS-PROGRAM-SWITCHES.                                         01490004
015000     05  PS-END-OF-CINC-SW            PIC  X(01) VALUE 'N'.       01500004
015100         88  PS-END-OF-CINC-FILE                 VALUE 'Y'.       01510004
015200         88  PS-NOT-END-CINC-FILE                VALUE 'N'.       01520004
015300     05  PS-END-OF-PROCES-SW          PIC  X(01) VALUE 'N'.       01530004
015400         88  PS-END-OF-PROCESSING                VALUE 'Y'.       01540004
015500         88  PS-NOT-END-OF-PROCESSING            VALUE 'N'.       01550004
015501     05  PS-TABLE-SEARCH-SW          PIC X(01) VALUE 'N'.         01550112
015502         88  PS-NOT-END-OF-TABLE               VALUE 'N'.         01550212
015503         88  PS-END-OF-TABLE                   VALUE 'Y'.         01550312
015504     05  PS-TBL-ENTRY-SW             PIC X(01) VALUE 'N'.         01550412
015505         88  PS-ENTRY-NOT-FOUND                VALUE 'N'.         01550512
015506         88  PS-ENTRY-FOUND                    VALUE 'Y'.         01550612
015510                                                                  01551004
015520* ------------------------------------------------------------    01552004
015530*  COUNTERS                                                       01553004
015540* ------------------------------------------------------------    01554004
015550 01  PV-COUNTERS.                                                 01555004
015560     05  PV-CINC-RECS-READ            PIC  9(09) VALUE ZERO.      01556004
015570     05  PV-CINC-REC-WRITEN           PIC  9(09) VALUE ZERO.      01557004
015580     05  PV-CINC-SECT-REC-WRITEN      PIC  9(09) VALUE ZERO.      01558004
015590     05  PV-CINC-PARM-REC-WRITEN      PIC  9(09) VALUE ZERO.      01559004
015591     05  PV-CINC-MDSE-REC-WRITEN      PIC  9(09) VALUE ZERO.      01559104
015592                                                                  01559204
015600*-------------------------------------------------------------    01560004
015700* PV- PROGRAM VARIABLES                                           01570004
015800*-------------------------------------------------------------    01580004
015900 01  PV-PROGRAM-VARIABLES.                                        01590004
016000     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01600004
016100     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACES.    01610004
016200     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACES.    01620004
016410                                                                  01641004
016420     05  PV-CUST-INCTV-SPLIT-KEY.                                 01642004
016430         10  PV-CUR-SYS-OF-REC-ID     PIC 9(10) VALUE ZERO.       01643004
016440         10  PV-CUR-STR-GRP-TYP       PIC 9(05) VALUE ZERO.       01644004
016450         10  PV-CUR-STR-GRP-ID        PIC 9(10) VALUE ZERO.       01645004
016460         10  PV-CUR-SYS-SUB-ID        PIC 9(10) VALUE ZERO.       01646004
016470         10  PV-CUR-MDSE-ID           PIC 9(10) VALUE ZERO.       01647004
016471         10  PV-CUR-REC-ACTION        PIC X(01) VALUE SPACES.     01647116
016472                                                                  01647216
016473*-------------------------------------------------------------    01647316
016474*  TEMPORARY TABLE TO HOLD THE ROWS IN THE PARM TABLE FOR A UNIQUE01647416
016475*  INTFC_ID                                                       01647516
016476*-------------------------------------------------------------    01647616
016480 01  PV-CST-INCTV-TIER-TBL.                                       01648010
016490     05  PV-CST-INCTV-PARM-REC        OCCURS 10 TIMES             01649010
016500                                      INDEXED BY PV-CIP-IDX,      01650010
016600                                                 PV-CIP-IDX2.     01660010
016700         10 PV-CINC-INTFC-ID          PIC  9(10) VALUE 0.         01670010
016800         10 PV-CINC-INTFC-SUB-ID      PIC  9(10) VALUE 0.         01680010
016900         10 PV-CINC-INTFC-TIER-LVL    PIC  9(05) VALUE 0.         01690010
017500*-------------------------------------------------------------    01750004
017600*  COPY BOOK FOR CUSTOMER INCENTIVE EXTRACT FILE                  01760004
017700*-------------------------------------------------------------    01770004
017800     COPY EPRD216.                                                01780004
017900                                                                  01790004
018000*-------------------------------------------------------------    01800004
018100*  COPYBOOK FOR WRITING DATA IN THE FORMAT OF XST_CUST_INCTV      01810004
018200*-------------------------------------------------------------    01820004
018300     COPY EPRD212.                                                01830004
018400                                                                  01840004
018500*-------------------------------------------------------------    01850004
018600*  COPYBOOK FOR WRITING DATA IN THE FORMAT OF XST_CUST_INCTV_SECT 01860004
018700*-------------------------------------------------------------    01870004
018800     COPY EPRD213.                                                01880004
018900                                                                  01890004
019000*-------------------------------------------------------------    01900004
019100*  COPYBOOK FOR WRITING DATA IN THE FORMAT OF XST_CUST_INCTV_PARM 01910004
019200*-------------------------------------------------------------    01920004
019300     COPY EPRD214.                                                01930004
019400                                                                  01940004
019500*-------------------------------------------------------------    01950004
019600*  COPYBOOK FOR WRITNG DATA IN THE FRMT OF XST_CUST_INCTV_MDSE_SET01960004
019700*-------------------------------------------------------------    01970004
019800     COPY EPRD215.                                                01980004
019900                                                                  01990004
021700                                                                  02170004
021800****************************************************************  02180004
021900 PROCEDURE DIVISION.                                              02190004
022000****************************************************************  02200004
022100 0000-MAINLINE.                                                   02210004
022200                                                                  02220004
022300     PERFORM 1000-INITIALIZATION.                                 02230004
022400                                                                  02240004
022500     PERFORM 2000-PROCESS-CINCTV-FILE                             02250004
022600       UNTIL PS-END-OF-PROCESSING.                                02260004
023000                                                                  02300004
023100     PERFORM 9200-WRAPUP.                                         02310004
023200                                                                  02320004
023300     GOBACK.                                                      02330004
023400                                                                  02340004
023500*0000-EXIT.                                                       02350004
023520                                                                  02352004
023530*----------------------------------------------------------       02353004
023540* 1000-INITIALIZATION.                                            02354004
023550*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           02355004
023560*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      02356004
023570*     FILES.                                                      02357004
023580*----------------------------------------------------------       02358004
023590 1000-INITIALIZATION.                                             02359004
023592                                                                  02359204
023593     INITIALIZE PS-PROGRAM-SWITCHES.                              02359304
023594     INITIALIZE PV-PROGRAM-VARIABLES.                             02359404
023595     INITIALIZE PV-COUNTERS.                                      02359504
023596     SET PS-NOT-END-CINC-FILE TO TRUE.                            02359620
023597                                                                  02359720
023598     DISPLAY '****************************************'.          02359820
023599     DISPLAY '**          EPKUT214 STARTED          **'.          02359920
023600     DISPLAY '****************************************'.          02360020
023601                                                                  02360120
023602     PERFORM 1100-OPEN-FILES.                                     02360220
023603                                                                  02360320
023604     PERFORM 6000-READ-CUST-INCTV-EXT.                            02360420
023605                                                                  02360520
023606     IF PS-END-OF-CINC-FILE                                       02360620
023608        DISPLAY '                                    '            02360804
023609        DISPLAY '***    NO INPUT RECORDS TO PROCESS     ***'      02360904
023610        DISPLAY '                                    '            02361004
023611        SET PS-END-OF-PROCESSING TO TRUE                          02361104
023612     END-IF.                                                      02361204
023613                                                                  02361304
023615*1000-EXIT.                                                       02361504
023616                                                                  02361622
023618*----------------------------------------------------------       02361804
023619* 1100-OPEN-FILES.                                                02361904
023620*     OPEN THE INPUT AND OUTPUT FILES                             02362004
023621*----------------------------------------------------------       02362104
023622 1100-OPEN-FILES.                                                 02362204
023623                                                                  02362304
023624     OPEN INPUT CUST-INCTV-EXTRACT-FILE.                          02362404
023625                                                                  02362504
023626     OPEN OUTPUT CUST-INCTV-FILE                                  02362604
023627                 CUST-INCTV-SECT-FILE                             02362704
023628                 CUST-INCTV-PARM-FILE                             02362804
023629                 CUST-INCTV-MDSE-FILE.                            02362904
023630                                                                  02363004
023631*1100-EXIT.                                                       02363104
023633                                                                  02363304
023634*----------------------------------------------------------       02363404
023635* 2000-PROCESS-CINCTV-FILE                                        02363504
023636*     PROCESS THE INPUT RECORDS AND BASED ON THE CONDITIONS       02363616
023637*     WRITE THE DATA OUT TO EACH OF THE FOUR FILES                02363716
023638*     BUSINESS EVENT ID '110' MARKS CHANGES TO THE EXCLUDE        02363818
023639*     MERCHANDISE TABLE, AND IN THAT CASE WRITE THE DATA ONLY     02363918
023640*     TO MERCHANDISE FILE                                         02364018
023641*----------------------------------------------------------       02364116
023642 2000-PROCESS-CINCTV-FILE.                                        02364216
023705                                                                  02370516
023706     EVALUATE TRUE                                                02370617
023707**-- THIS CONDITION ONLY FOR MDSE EXCLUSION ADD / DELETES         02370719
023708         WHEN EP216-BUSINESS-EVENT-ID  = '110'                    02370819
023709             DISPLAY '   WITHIN WHEN 110'                         02370919
023710             PERFORM 2200-PROCESS-DEL-RECORDS                     02371018
023711         WHEN EP216-RECORD-ADD                                    02371118
023712          AND EP216-BUSINESS-EVENT-ID NOT = '110'                 02371218
023713             PERFORM 2100-PROCESS-ADD-RECORDS                     02371318
023714         WHEN EP216-RECORD-DELETE                                 02371418
023715             PERFORM 2200-PROCESS-DEL-RECORDS                     02371518
023716     END-EVALUATE.                                                02371618
023717                                                                  02371718
023718     PERFORM 6000-READ-CUST-INCTV-EXT.                            02371818
023719                                                                  02371918
023720     IF PS-END-OF-CINC-FILE                                       02372018
023721        SET PS-END-OF-PROCESSING TO TRUE                          02372118
023722     END-IF.                                                      02372218
023723                                                                  02372318
023724*2000-EXIT.                                                       02372418
023726                                                                  02372618
023727*----------------------------------------------------------       02372718
023728* 2100-PROCESS-ADD-RECORDS                                        02372818
023729*     PROCESS THE RECORDS WITH ACTION CODE 'A'                    02372918
023730*----------------------------------------------------------       02373018
023731 2100-PROCESS-ADD-RECORDS.                                        02373118
023732                                                                  02373218
023733     EVALUATE TRUE                                                02373318
023734*-- FIRST TIME                                                    02373418
023735         WHEN PV-CUR-SYS-OF-REC-ID = ZERO                         02373518
023736          AND PV-CUR-STR-GRP-TYP   = ZERO                         02373618
023737          AND PV-CUR-STR-GRP-ID    = ZERO                         02373718
023738          AND PV-CUR-SYS-SUB-ID    = ZERO                         02373818
023739          AND PV-CUR-MDSE-ID       = ZERO                         02373918
023740          AND PV-CUR-REC-ACTION    = SPACES                       02374018
023741              PERFORM 2300-UPDATE-KEY-VALUES                      02374118
023742              PERFORM 2400-POPULATE-CINCTV                        02374218
023743              PERFORM 2500-POPULATE-CINCTV-SECT                   02374318
023744              PERFORM 2600-POPULATE-CINCTV-PARM                   02374418
023745              PERFORM 2700-POPULATE-CINCTV-MDSE                   02374518
023746                                                                  02374618
023747*-- INTFC_ID CHANGES, NEED TO WRITE THE RECORDS TO ALL THE FILES  02374718
023748         WHEN PV-CUR-SYS-OF-REC-ID NOT = EP216-SYS-OF-REC-ID      02374818
023749              PERFORM 2300-UPDATE-KEY-VALUES                      02374918
023750              PERFORM 2400-POPULATE-CINCTV                        02375018
023751              PERFORM 2500-POPULATE-CINCTV-SECT                   02375118
023752              PERFORM 2600-POPULATE-CINCTV-PARM                   02375218
023753              PERFORM 2700-POPULATE-CINCTV-MDSE                   02375318
023754                                                                  02375418
023755*-- INTFC_ID REMAIN SAME, BUT STORE GROUP VALUE CHANGES           02375518
023756         WHEN PV-CUR-SYS-OF-REC-ID = EP216-SYS-OF-REC-ID          02375617
023757          AND (PV-CUR-STR-GRP-TYP NOT = EP216-STR-GRP-TYP-CDE     02375717
023758            OR PV-CUR-STR-GRP-ID NOT = EP216-STR-GRP-ID)          02375817
023759              PERFORM 2300-UPDATE-KEY-VALUES                      02375917
023760              PERFORM 2400-POPULATE-CINCTV                        02376017
023761              PERFORM 2500-POPULATE-CINCTV-SECT                   02376117
023762              PERFORM 2600-POPULATE-CINCTV-PARM                   02376217
023763              PERFORM 2700-POPULATE-CINCTV-MDSE                   02376317
023764                                                                  02376417
023765         WHEN PV-CUR-SYS-OF-REC-ID = EP216-SYS-OF-REC-ID          02376517
023766          AND PV-CUR-STR-GRP-TYP  = EP216-STR-GRP-TYP-CDE         02376617
023767          AND PV-CUR-STR-GRP-ID = EP216-STR-GRP-ID                02376717
023768          AND EP216-SYS-REC-SUB-ID NOT = PV-CUR-SYS-SUB-ID        02376817
023769          AND EP216-SYS-REC-SUB-ID > 100                          02376917
023770**  TIERED                                                        02377017
023771              PERFORM 2300-UPDATE-KEY-VALUES                      02377117
023772              IF PS-ENTRY-NOT-FOUND                               02377217
023773                 PERFORM 2600-POPULATE-CINCTV-PARM                02377317
023774              END-IF                                              02377417
023775              PERFORM 2700-POPULATE-CINCTV-MDSE                   02377517
023776                                                                  02377617
023777*-- FOLLOWING CASE IS FOR MULTIPLE MERCHANDISE ROWS               02377717
023778         WHEN PV-CUR-SYS-OF-REC-ID = EP216-SYS-OF-REC-ID          02377817
023779          AND PV-CUR-STR-GRP-TYP  = EP216-STR-GRP-TYP-CDE         02377917
023780          AND PV-CUR-STR-GRP-ID = EP216-STR-GRP-ID                02378017
023781          AND EP216-SYS-REC-SUB-ID = PV-CUR-SYS-SUB-ID            02378117
023782          AND PV-CUR-MDSE-ID NOT = EP216-INCTV-MDSE-SET-ID        02378217
023783              PERFORM 2300-UPDATE-KEY-VALUES                      02378317
023784              PERFORM 2700-POPULATE-CINCTV-MDSE                   02378417
023785     END-EVALUATE.                                                02378517
023786                                                                  02378617
023787*2100-EXIT.                                                       02378717
023789                                                                  02378917
023790*----------------------------------------------------------       02379017
023791* 2200-PROCESS-DEL-RECORDS                                        02379117
023792*     PROCESS THE RECORDS WITH ACTION CODE 'D'/ BUSINESS CODE 110 02379220
023793*----------------------------------------------------------       02379317
023794 2200-PROCESS-DEL-RECORDS.                                        02379417
023795                                                                  02379517
023796     PERFORM 2300-UPDATE-KEY-VALUES.                              02379617
023797     PERFORM 2700-POPULATE-CINCTV-MDSE.                           02379717
023798                                                                  02379817
023799*2200-EXIT.                                                       02379917
023801                                                                  02380117
023802*----------------------------------------------------------       02380217
023803* 2300-UPDATE-KEY-VALUES.                                         02380317
023804*   UPDATE THE KEY VALUES IN THE TEMPORARY VARIABLES.             02380417
023805*----------------------------------------------------------       02380517
023806 2300-UPDATE-KEY-VALUES.                                          02380617
023807                                                                  02380717
023808     IF EP216-INCTV-TYP-CDE = 'TR'                                02380817
023809        PERFORM 2800-LOAD-TIERED-TABLE                            02380917
023810     END-IF.                                                      02381017
023811                                                                  02381117
023812     MOVE EP216-SYS-OF-REC-ID     TO PV-CUR-SYS-OF-REC-ID.        02381217
023813     MOVE EP216-STR-GRP-TYP-CDE   TO PV-CUR-STR-GRP-TYP.          02381317
023814     MOVE EP216-STR-GRP-ID        TO PV-CUR-STR-GRP-ID.           02381417
023815     MOVE EP216-SYS-REC-SUB-ID    TO PV-CUR-SYS-SUB-ID.           02381517
023816     MOVE EP216-INCTV-MDSE-SET-ID TO PV-CUR-MDSE-ID.              02381617
023817                                                                  02381717
023818*2300-EXIT.                                                       02381817
023820                                                                  02382017
023821*----------------------------------------------------------       02382117
023822* 2400-POPULATE-CINCTV                                            02382217
023823*     POPULATE THE  CUSTOMER INCENTIVE EXTRACT FILE VARIABLE      02382320
023824*     AND WRITE THE FILES.                                        02382420
023825*----------------------------------------------------------       02382520
023826 2400-POPULATE-CINCTV.                                            02382620
023827                                                                  02382720
023828     MOVE EP216-FILE-ACT-TYP    TO EP212-FILE-ACT-TYP.            02382820
023829     MOVE EP216-STR-HIER-CDE    TO EP212-STR-HIER-CDE.            02382920
023830     MOVE EP216-STR-GRP-TYP-CDE TO EP212-STR-GRP-TYP-CDE.         02383020
023831     MOVE EP216-STR-GRP-ID      TO EP212-STR-GRP-ID               02383120
023832     MOVE EP216-STR-FILE-LIST-DTE TO EP212-STR-FILE-LIST-DTE.     02383220
023833     MOVE EP216-APPLY-IND         TO EP212-APPLY-IND.             02383320
023834     MOVE EP216-RECORD-ACTION     TO EP212-RECORD-ACTION.         02383420
023835                                                                  02383520
023836     MOVE EP216-SYS-OF-REC-ID     TO EP212-SYS-OF-REC-ID.         02383620
023837     MOVE EP216-SYS-IDENTIFIER    TO EP212-SYS-IDENTIFIER.        02383720
023838     MOVE EP216-PROMO-SCHEME-CDE  TO EP212-PROMO-SCHEME-CDE.      02383820
023839     MOVE EP216-INCTV-TYP-CDE     TO EP212-INCTV-TYP-CDE.         02383920
023840     MOVE EP216-INCTV-NM          TO EP212-INCTV-NM.              02384020
023841     MOVE EP216-INCTV-TRGR-TYP-CDE TO EP212-INCTV-TRGR-TYP-CDE.   02384120
023842     MOVE EP216-SYS-OF-REC-GP-ID   TO EP212-SYS-OF-REC-GP-ID.     02384220
023843                                                                  02384320
023844     PERFORM 6100-WRITE-CUST-INCTV-REC.                           02384420
023845                                                                  02384520
023846*2400-EXIT.                                                       02384620
023848                                                                  02384820
023849*----------------------------------------------------------       02384920
023850* 2500-POPULATE-CINCTV-SECT                                       02385020
023851*    POPULATE THE EPRD213 COPYBOOK AND WRITE THE SECTION FILE     02385120
023852*----------------------------------------------------------       02385220
023853 2500-POPULATE-CINCTV-SECT.                                       02385320
023854                                                                  02385420
023855     MOVE EP216-FILE-ACT-TYP    TO EP213-FILE-ACT-TYP.            02385520
023856     MOVE EP216-STR-HIER-CDE    TO EP213-STR-HIER-CDE.            02385620
023857     MOVE EP216-STR-GRP-TYP-CDE TO EP213-STR-GRP-TYP-CDE.         02385720
023858     MOVE EP216-STR-GRP-ID         TO EP213-STR-GRP-ID            02385820
023859     MOVE EP216-STR-FILE-LIST-DTE  TO EP213-STR-FILE-LIST-DTE.    02385920
023860     MOVE EP216-APPLY-IND          TO EP213-APPLY-IND.            02386020
023861     MOVE EP216-RECORD-ACTION     TO EP213-RECORD-ACTION.         02386120
023862                                                                  02386220
023863     MOVE EP216-SYS-OF-REC-ID      TO EP213-SYS-OF-REC-ID.        02386320
023864     MOVE EP216-SYS-IDENTIFIER     TO EP213-SYS-IDENTIFIER.       02386420
023865     MOVE EP216-INCTV-SECT-TYP-CDE TO EP213-INCTV-SECT-TYP-CDE.   02386520
023866     MOVE EP216-INCTV-BEG-TMST     TO EP213-INCTV-BEG-TMST.       02386620
023867     MOVE EP216-INCTV-END-TMST     TO EP213-INCTV-END-TMST.       02386720
023868     MOVE EP216-BUY-CNCTR-CDE      TO EP213-BUY-CNCTR-CDE.        02386820
023869     MOVE EP216-GET-CNCTR-CDE      TO EP213-GET-CNCTR-CDE.        02386920
023870     MOVE EP216-CUST-SHRT-DESC     TO EP213-CUST-SHRT-DESC.       02387020
023871     MOVE EP216-LMT-PER-TRN-QTY    TO EP213-LMT-PER-TRN-QTY.      02387120
023872                                                                  02387220
023873     PERFORM 6200-WRITE-CINCTV-SECT-REC.                          02387320
023874                                                                  02387420
023875*2500-EXIT.                                                       02387520
023877                                                                  02387720
023878*----------------------------------------------------------       02387820
023879* 2600-POPULATE-CINCTV-PARM                                       02387920
023880*   POPULATE THE EPRD214 COPYBOOK AND WRITE THE PARM FILE         02388020
023881*----------------------------------------------------------       02388120
023882 2600-POPULATE-CINCTV-PARM.                                       02388220
023883                                                                  02388320
023884     MOVE EP216-FILE-ACT-TYP        TO EP214-FILE-ACT-TYP.        02388420
023885     MOVE EP216-STR-HIER-CDE        TO EP214-STR-HIER-CDE.        02388520
023886     MOVE EP216-STR-GRP-TYP-CDE     TO EP214-STR-GRP-TYP-CDE.     02388620
023887     MOVE EP216-STR-GRP-ID          TO EP214-STR-GRP-ID           02388720
023888     MOVE EP216-STR-FILE-LIST-DTE   TO EP214-STR-FILE-LIST-DTE.   02388820
023889     MOVE EP216-APPLY-IND           TO EP214-APPLY-IND.           02388920
023890     MOVE EP216-RECORD-ACTION     TO EP214-RECORD-ACTION.         02389020
023891                                                                  02389120
023892     MOVE EP216-SYS-OF-REC-ID       TO EP214-SYS-OF-REC-ID.       02389220
023893     MOVE EP216-SYS-IDENTIFIER      TO EP214-SYS-IDENTIFIER.      02389320
023894     MOVE EP216-INCTV-SECT-TYP-CDE  TO EP214-INCTV-SECT-TYP-CDE.  02389420
023895     MOVE EP216-SYS-REC-SUB-ID      TO EP214-SYS-REC-SUB-ID.      02389520
023896     MOVE EP216-SELN-TYP-CDE        TO EP214-SELN-TYP-CDE.        02389620
023897     MOVE EP216-TIER-LVL-NBR        TO EP214-TIER-LVL-NBR.        02389720
023898                                                                  02389820
023899     IF EP216-INCTV-BUY-QTY-NL = PC-NULL-VALUE                    02389922
023900        MOVE SPACES TO EP214-INCTV-BUY-QTY-NL                     02390020
023901        MOVE PC-NULL-VALUE TO EP214-INCTV-BUY-QTY-NL              02390120
023902     ELSE                                                         02390220
023903        MOVE EP216-INCTV-BUY-QTY TO EP214-INCTV-BUY-QTY           02390320
023904     END-IF.                                                      02390420
023905                                                                  02390520
023906     IF EP216-INCTV-BUY-AMT-NL = PC-NULL-VALUE                    02390622
023907        MOVE SPACES TO EP214-INCTV-BUY-AMT-NL                     02390720
023908        MOVE PC-NULL-VALUE TO EP214-INCTV-BUY-AMT-NL              02390820
023909     ELSE                                                         02390920
023910        MOVE EP216-INCTV-BUY-AMT TO EP214-INCTV-BUY-AMT           02391020
023911     END-IF.                                                      02391120
023912                                                                  02391220
023913     IF EP216-INCTV-BUY-TOL-AMT-NL = PC-NULL-VALUE                02391322
023914        MOVE SPACES TO EP214-INCTV-BUY-TOL-AMT-NL                 02391420
023915        MOVE PC-NULL-VALUE TO EP214-INCTV-BUY-TOL-AMT-NL          02391520
023916     ELSE                                                         02391620
023917        MOVE EP216-INCTV-BUY-TOL-AMT TO EP214-INCTV-BUY-TOL-AMT   02391720
023918     END-IF.                                                      02391820
023919                                                                  02391920
023920     IF EP216-INCTV-GET-QTY-NL = PC-NULL-VALUE                    02392022
023921        MOVE SPACES TO EP214-INCTV-GET-QTY-NL                     02392120
023922        MOVE PC-NULL-VALUE TO EP214-INCTV-GET-QTY-NL              02392220
023923     ELSE                                                         02392320
023924        MOVE EP216-INCTV-GET-QTY  TO EP214-INCTV-GET-QTY          02392420
023925     END-IF.                                                      02392520
023926                                                                  02392620
023927     IF EP216-INCTV-PCT-OFF-NL = PC-NULL-VALUE                    02392722
023928        MOVE SPACES TO EP214-INCTV-PCT-OFF-NL                     02392820
023929        MOVE PC-NULL-VALUE TO EP214-INCTV-PCT-OFF-NL              02392920
023930     ELSE                                                         02393020
023931        MOVE EP216-INCTV-PCT-OFF  TO EP214-INCTV-PCT-OFF          02393120
023932     END-IF.                                                      02393220
023933                                                                  02393320
023934     IF EP216-INCTV-DOL-OFF-AMT-NL = PC-NULL-VALUE                02393422
023935        MOVE SPACES TO EP214-INCTV-DOL-OFF-AMT-NL                 02393520
023936        MOVE PC-NULL-VALUE TO EP214-INCTV-DOL-OFF-AMT-NL          02393620
023937     ELSE                                                         02393720
023938        MOVE EP216-INCTV-DOL-OFF-AMT  TO EP214-INCTV-DOL-OFF-AMT  02393820
023939     END-IF.                                                      02393920
023940                                                                  02394020
023941     IF EP216-INCTV-PRC-PNT-AMT-NL = PC-NULL-VALUE                02394122
023942        MOVE SPACES TO EP214-INCTV-PRC-PNT-AMT-NL                 02394220
023943        MOVE PC-NULL-VALUE TO EP214-INCTV-PRC-PNT-AMT-NL          02394320
023944     ELSE                                                         02394420
023945        MOVE EP216-INCTV-PRC-PNT-AMT  TO EP214-INCTV-PRC-PNT-AMT  02394520
023946     END-IF.                                                      02394620
023947                                                                  02394720
023948     PERFORM 6300-WRITE-CINCTV-PARM-REC.                          02394820
023949                                                                  02394920
023950*2600-EXIT.                                                       02395020
023952                                                                  02395220
023953*----------------------------------------------------------       02395320
023954* 2700-POPULATE-CINCTV-MDSE                                       02395420
023955*    POPULATE THE EPRD215 COPYBOOK WRITE THE MDSE FILE            02395520
023956*----------------------------------------------------------       02395620
023957 2700-POPULATE-CINCTV-MDSE.                                       02395720
023958                                                                  02395820
023959     MOVE EP216-FILE-ACT-TYP        TO EP215-FILE-ACT-TYP.        02395920
023960     MOVE EP216-STR-HIER-CDE        TO EP215-STR-HIER-CDE.        02396020
023961     MOVE EP216-STR-GRP-TYP-CDE     TO EP215-STR-GRP-TYP-CDE.     02396120
023962     MOVE EP216-STR-GRP-ID          TO EP215-STR-GRP-ID           02396220
023963     MOVE EP216-STR-FILE-LIST-DTE   TO EP215-STR-FILE-LIST-DTE.   02396320
023964     MOVE EP216-APPLY-IND           TO EP215-APPLY-IND.           02396420
023965     MOVE EP216-RECORD-ACTION       TO EP215-RECORD-ACTION.       02396520
023966                                                                  02396620
023967     MOVE EP216-INCTV-MDSE-SET-ID   TO EP215-INCTV-MDSE-SET-ID.   02396720
023968     MOVE EP216-SYS-OF-REC-ID       TO EP215-SYS-OF-REC-ID.       02396820
023969     MOVE EP216-SYS-IDENTIFIER      TO EP215-SYS-IDENTIFIER.      02396920
023970     MOVE EP216-INCTV-SECT-TYP-CDE  TO EP215-INCTV-SECT-TYP-CDE.  02397020
023971     MOVE EP216-SYS-REC-SUB-ID      TO EP215-SYS-REC-SUB-ID.      02397120
023972     MOVE EP216-MDSE-HIER-CDE       TO EP215-MDSE-HIER-CDE.       02397220
023973                                                                  02397320
023974     IF EP216-DEPT-NBR-NL = PC-NULL-VALUE                         02397422
023975       MOVE SPACES TO EP215-DEPT-NBR-NL                           02397520
023976       MOVE EP216-DEPT-NBR-NL TO EP215-DEPT-NBR-NL                02397620
023977     ELSE                                                         02397720
023978       MOVE EP216-DEPT-NBR    TO EP215-DEPT-NBR                   02397820
023979     END-IF.                                                      02397920
023980                                                                  02398020
023981     IF EP216-MAJ-CL-NBR-NL = PC-NULL-VALUE                       02398122
023982       MOVE SPACES TO EP215-MAJ-CL-NBR-NL                         02398220
023983       MOVE EP216-MAJ-CL-NBR-NL TO EP215-MAJ-CL-NBR-NL            02398320
023984     ELSE                                                         02398420
023985       MOVE EP216-MAJ-CL-NBR TO EP215-MAJ-CL-NBR                  02398520
023986     END-IF.                                                      02398620
023987                                                                  02398720
023988     IF EP216-SUB-CL-NBR-NL = PC-NULL-VALUE                       02398822
023989       MOVE SPACES TO EP215-SUB-CL-NBR-NL                         02398920
023990       MOVE EP216-SUB-CL-NBR-NL TO EP215-SUB-CL-NBR-NL            02399020
023991     ELSE                                                         02399120
023992       MOVE EP216-SUB-CL-NBR TO EP215-SUB-CL-NBR                  02399220
023993     END-IF.                                                      02399320
023994                                                                  02399420
023995     IF EP216-STYLE-ID-NL = PC-NULL-VALUE                         02399522
023996       MOVE SPACES TO EP215-STYLE-ID-NL                           02399620
023997       MOVE EP216-STYLE-ID-NL TO EP215-STYLE-ID-NL                02399720
023998     ELSE                                                         02399820
023999       MOVE EP216-STYLE-ID   TO EP215-STYLE-ID                    02399920
024000     END-IF.                                                      02400020
024001                                                                  02400120
024002     IF EP216-SKU-NBR-NL = PC-NULL-VALUE                          02400222
024003       MOVE SPACES TO EP215-SKU-NBR-NL                            02400320
024004       MOVE EP216-SKU-NBR-NL TO EP215-SKU-NBR-NL                  02400420
024005     ELSE                                                         02400520
024006       MOVE EP216-SKU-NBR    TO EP215-SKU-NBR                     02400620
024007     END-IF.                                                      02400720
024008                                                                  02400820
024009     MOVE EP216-MDSE-IE-IND TO EP215-MDSE-IE-IND.                 02400920
024010     MOVE EP216-TKT-CLOR-CDE  TO EP215-TKT-CLOR-CDE.              02401020
024011     MOVE EP216-ELECT-SLF-TOPR-CD TO EP215-ELECT-SLF-TOPR-CD.     02401120
024012                                                                  02401220
024013     PERFORM 6400-WRITE-CINCTV-MDSE-REC.                          02401320
024014                                                                  02401420
024015*2700-EXIT.                                                       02401520
024017                                                                  02401720
024018*----------------------------------------------------------       02401820
024019* 2800-LOAD-TIERED-TABLE                                          02401920
024020*    LOADS THE TEMPORARY TIERED TABLE WITH DATA, FOR TIERED       02402020
024021*    PROMOTIONS WITH MERCHANDISE EXCLUSION, THIS TABLE WILL BE    02402120
024022*    CHECKED IF THE PARM RECORD HAS ALREADY BEEN WRITEN AND THE   02402220
024023*    RECORD IS NOT WRITEN AGAIN.                                  02402320
024024*----------------------------------------------------------       02402420
024025 2800-LOAD-TIERED-TABLE.                                          02402520
024026                                                                  02402620
024027*--  NEW PROMO_INTFC_ID, INITIALIZE THE TABLE AND LOAD            02402720
024028     IF PV-CUR-SYS-OF-REC-ID = 0 OR                               02402820
024029        PV-CUR-SYS-OF-REC-ID NOT = EP216-SYS-OF-REC-ID OR         02402920
024030        PV-CUR-STR-GRP-TYP NOT = EP216-STR-GRP-TYP-CDE OR         02403020
024031        PV-CUR-STR-GRP-ID NOT = EP216-STR-GRP-ID                  02403120
024032          INITIALIZE PV-CST-INCTV-TIER-TBL                        02403220
024033     END-IF.                                                      02403320
024034                                                                  02403420
024035     EVALUATE TRUE                                                02403520
024036         WHEN PV-CUR-SYS-OF-REC-ID NOT = EP216-SYS-OF-REC-ID OR   02403620
024037              PV-CUR-STR-GRP-TYP NOT = EP216-STR-GRP-TYP-CDE OR   02403720
024038              PV-CUR-STR-GRP-ID NOT = EP216-STR-GRP-ID            02403820
024039                SET PV-CIP-IDX TO +1                              02403920
024040                MOVE EP216-SYS-OF-REC-ID  TO                      02404020
024041                                    PV-CINC-INTFC-ID(PV-CIP-IDX)  02404120
024042                MOVE EP216-SYS-REC-SUB-ID TO                      02404220
024043                                 PV-CINC-INTFC-SUB-ID(PV-CIP-IDX) 02404320
024044                MOVE EP216-TIER-LVL-NBR TO                        02404420
024045                                PV-CINC-INTFC-TIER-LVL(PV-CIP-IDX)02404520
024046                                                                  02404620
024047         WHEN PV-CUR-SYS-OF-REC-ID  = EP216-SYS-OF-REC-ID         02404720
024048          AND PV-CUR-STR-GRP-TYP  = EP216-STR-GRP-TYP-CDE         02404820
024049          AND PV-CUR-STR-GRP-ID = EP216-STR-GRP-ID                02404920
024050          AND EP216-SYS-REC-SUB-ID NOT = PV-CUR-SYS-SUB-ID        02405020
024051          AND EP216-SYS-REC-SUB-ID > 100                          02405120
024052             PERFORM 2900-CHECK-IF-IN-TABLE                       02405220
024053             IF PS-ENTRY-NOT-FOUND                                02405320
024054                SET PV-CIP-IDX UP BY +1                           02405420
024055                MOVE EP216-SYS-OF-REC-ID  TO                      02405520
024056                                    PV-CINC-INTFC-ID(PV-CIP-IDX)  02405620
024057                MOVE EP216-SYS-REC-SUB-ID TO                      02405720
024058                                 PV-CINC-INTFC-SUB-ID(PV-CIP-IDX) 02405820
024059                MOVE EP216-TIER-LVL-NBR TO                        02405920
024060                                PV-CINC-INTFC-TIER-LVL(PV-CIP-IDX)02406020
024061             END-IF                                               02406120
024062                                                                  02406220
024063     END-EVALUATE.                                                02406320
024064                                                                  02406420
024065     IF PV-CIP-IDX > PC-TABL-IDX-MAX                              02406521
024066        DISPLAY 'LIMIT OF PV-CST-INCTV-TIER-TBL REACHED'          02406621
024067        MOVE '2800-LOAD-TIERED-TABLE'  TO                         02406721
024068                               PV-PARAGRAPH-NAME                  02406821
024069        MOVE 'TABLE LIMIT REACHED FOR PV-CST-INCTV-TIER-TBL' TO   02406921
024070                             PV-OPERATION-MSG-1                   02407021
024071        SET AC-4004-TABLE-OVERFLOW        TO TRUE                 02407121
024072        PERFORM 9910-ABEND                                        02407221
024073     END-IF.                                                      02407321
024076                                                                  02407621
024077*2800-EXIT.                                                       02407721
024079                                                                  02407921
024080*----------------------------------------------------------       02408021
024081* 2900-CHECK-IF-IN-TABLE                                          02408121
024082*     THE TABLE IS CHECKED IF THE PARTICULAR SUB ID IS ALREADY    02408221
024083*     PROCESSED, IF IT IS PROCESSED THE DATA IS NOT WRITEN IN     02408321
024084*     THE PARM FILE AGAIN.                                        02408421
024085*----------------------------------------------------------       02408521
024086 2900-CHECK-IF-IN-TABLE.                                          02408621
024087                                                                  02408721
024088     SET PV-CIP-IDX2 TO +1.                                       02408821
024089     SET PS-ENTRY-NOT-FOUND TO TRUE.                              02408921
024090                                                                  02409021
024091     SEARCH PV-CST-INCTV-PARM-REC                                 02409121
024092         VARYING PV-CIP-IDX2                                      02409221
024093        AT END                                                    02409321
024094           SET PS-ENTRY-NOT-FOUND TO TRUE                         02409421
024095        WHEN EP216-SYS-REC-SUB-ID =                               02409521
024096                                PV-CINC-INTFC-SUB-ID(PV-CIP-IDX2) 02409621
024097         AND EP216-SYS-OF-REC-ID =                                02409721
024098                                PV-CINC-INTFC-ID(PV-CIP-IDX2)     02409821
024099              SET PS-ENTRY-FOUND  TO TRUE                         02409921
024100     END-SEARCH.                                                  02410021
024101                                                                  02410121
024102*2900-EXIT.                                                       02410221
024104                                                                  02410421
024107*----------------------------------------------------------       02410721
024108* 6000-READ-CUST-INCTV-EXT.                                       02410821
024109*     READ THE INPUT CUSTOMER INCENTIVE EXTRACT FILE.             02410921
024110*----------------------------------------------------------       02411021
024111 6000-READ-CUST-INCTV-EXT.                                        02411121
024112                                                                  02411221
024113     READ CUST-INCTV-EXTRACT-FILE                                 02411321
024114         INTO EP216-CUST-INCTV-RECORD                             02411421
024115       AT END                                                     02411521
024116          SET PS-END-OF-CINC-FILE TO TRUE                         02411621
024117     END-READ                                                     02411721
024118                                                                  02411821
024119     IF PS-NOT-END-CINC-FILE                                      02411921
024120        ADD +1 TO PV-CINC-RECS-READ                               02412021
024121     END-IF.                                                      02412121
024122                                                                  02412221
024123*6000-EXIT.                                                       02412321
024125                                                                  02412521
024126*----------------------------------------------------------       02412621
024127* 6100-WRITE-CUST-INCTV-REC.                                      02412721
024128*   WRITE THE DATA TO THE INCENTIVE FILE                          02412821
024129*----------------------------------------------------------       02412921
024130 6100-WRITE-CUST-INCTV-REC.                                       02413021
024131                                                                  02413121
024132     WRITE CUST-INCTV-REC                                         02413221
024133      FROM EP212-XST-CUST-INCTV.                                  02413321
024134                                                                  02413421
024135     ADD +1 TO PV-CINC-REC-WRITEN.                                02413521
024136                                                                  02413621
024137*6100-EXIT.                                                       02413721
024139                                                                  02413921
024140*----------------------------------------------------------       02414021
024141* 6200-WRITE-CINCTV-SECT-REC.                                     02414121
024142*     WRITE THE DATA INTO OUT02 (FORMAT OF XST_CUST_INCTV_SECT)   02414221
024143*----------------------------------------------------------       02414321
024144 6200-WRITE-CINCTV-SECT-REC.                                      02414421
024145                                                                  02414521
024146     WRITE CUST-INCTV-SECT-REC                                    02414621
024147      FROM EP213-XST-CUST-INCTV-SECT-RCD.                         02414721
024148                                                                  02414821
024149     ADD +1 TO PV-CINC-SECT-REC-WRITEN.                           02414921
024150                                                                  02415021
024151*6200-EXIT.                                                       02415121
024153                                                                  02415321
024154*----------------------------------------------------------       02415421
024155* 6300-WRITE-CINCTV-PARM-REC.                                     02415521
024156*     WRITE THE DATA IN OUT03 (FORMAT OF XST_CUST_INCTV_PARM)     02415621
024157*----------------------------------------------------------       02415721
024158 6300-WRITE-CINCTV-PARM-REC.                                      02415821
024159                                                                  02415921
024160     WRITE CUST-INCTV-PARM-REC                                    02416021
024161      FROM EP214-XST-CUST-INCTV-PARM-RCD.                         02416121
024162                                                                  02416221
024163     ADD +1 TO PV-CINC-PARM-REC-WRITEN.                           02416321
024164                                                                  02416421
024165*6300-EXIT.                                                       02416521
024167                                                                  02416721
024168*----------------------------------------------------------       02416821
024169* 6400-WRITE-CINCTV-MDSE-REC.                                     02416921
024170*     WRITE THE DATA IN OUT04 (FORMAT OF XST_CUST_INCTV_MDSE_SET) 02417021
024171*----------------------------------------------------------       02417121
024172 6400-WRITE-CINCTV-MDSE-REC.                                      02417221
024173                                                                  02417321
024174     WRITE CUST-INCTV-MDSE-REC                                    02417421
024175      FROM EP215-XST-CUST-INCTV-MDSE-RCD.                         02417521
024176                                                                  02417621
024177     ADD +1 TO PV-CINC-MDSE-REC-WRITEN.                           02417721
024178                                                                  02417821
024179*6400-EXIT.                                                       02417921
024181                                                                  02418121
024182******************************************************************02418221
024183*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *02418321
024184******************************************************************02418421
024185 9200-WRAPUP.                                                     02418521
024186     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.02418621
024190                                                                  02419021
024200     PERFORM 9920-DISPLAY-TOTALS.                                 02420004
024300                                                                  02430004
024400     DISPLAY '****************************************'.          02440004
024500     DISPLAY '**          EPKUT214 END              **'.          02450004
024600     DISPLAY '****************************************'.          02460004
024700                                                                  02470004
024710     CLOSE CUST-INCTV-EXTRACT-FILE.                               02471004
024720                                                                  02472004
024730     CLOSE CUST-INCTV-FILE                                        02473004
024740           CUST-INCTV-SECT-FILE                                   02474004
024750           CUST-INCTV-PARM-FILE                                   02475004
024760           CUST-INCTV-MDSE-FILE.                                  02476004
024770                                                                  02477004
025200*9200-EXIT.  EXIT.                                                02520004
027200******************************************************************02720004
027300*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   02730004
027400******************************************************************02740004
027500 9910-ABEND.                                                      02750004
027800                                                                  02780004
027900     DISPLAY '** ABEND           **'.                             02790004
028000     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02800004
028100     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02810004
028200     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       02820004
028300     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       02830004
028301                                                                  02830122
028310     PERFORM 9920-DISPLAY-TOTALS.                                 02831022
028400                                                                  02840004
028500     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         02850004
028600                                                                  02860004
028700*9910-EXIT.  EXIT.                                                02870004
028800******************************************************************02880004
028900*     DISPLAY END OF JOB TOTALS                                  *02890004
029000******************************************************************02900004
029100 9920-DISPLAY-TOTALS.                                             02910004
029200                                                                  02920004
029300     DISPLAY '****************************************'.          02930004
029400     DISPLAY '**     STATISTICS  FOR  CINCTV FILE   **'.          02940004
029500     DISPLAY '****************************************'.          02950004
029600                                                                  02960004
029700     DISPLAY '** CINCTV EXTRACT RECORDS READ  ====> '             02970004
029800             PV-CINC-RECS-READ                                    02980004
029900             ' **'.                                               02990004
030000     DISPLAY '** CINCTV RECORDS WRITEN ====> '                    03000004
030100             PV-CINC-REC-WRITEN                                   03010004
030200             ' **'.                                               03020004
030300     DISPLAY '** CINCTV SECT RECORDS WRITEN ====> '               03030004
030400             PV-CINC-SECT-REC-WRITEN                              03040004
030500             ' **'.                                               03050004
030510     DISPLAY '** CINCTV PARM RECORDS WRITEN ====> '               03051004
030520             PV-CINC-PARM-REC-WRITEN                              03052004
030530             ' **'.                                               03053004
030540     DISPLAY '** CINCTV MDSE RECORDS WRITEN ====> '               03054004
030550             PV-CINC-MDSE-REC-WRITEN                              03055004
030560             ' **'.                                               03056004
030600     DISPLAY '****************************************'.          03060004
030700                                                                  03070004
030800*9920-EXIT.  EXIT.                                                03080004
030900                                                                  03090004
