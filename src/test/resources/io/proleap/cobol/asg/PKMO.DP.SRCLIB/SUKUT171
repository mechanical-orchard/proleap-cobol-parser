000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SUKUT171.                                00050001
000600 AUTHOR.                 GERMAN BANDA.                            00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            JUNE  , 2020.                            00080001
000900 DATE-COMPILED.                                                   00090001
001000***************************************************************** 00100001
001100***************************************************************** 00110001
001200*  THIS PROGRAM WILL PROCESS A FILE OF CARTON DETAILS FROM PACK   00120001
001300*  HOLD PROCESSING AGAINST A FILE OF SEASONAL SET CODES TO BE     00130001
001400*  ARCHIVED FROM THE CARTON DETAIL FILE.  OUTPUT FILES WILL       00140001
001500*  BE AN ARCHIVE FILE AND A NEW UPDATED CARTON DETAIL DAILY FILE  00150001
001510*  WITH THE OLD RECORDS REMOVED                                   00151001
001600***************************************************************** 00160001
001700*  06/30/2020 GERMAN BANDA    INTIAL DEPLOYMENT                   00170001
002100*                             CHG: CHG0000000                     00210001
002200***************************************************************** 00220001
002300 ENVIRONMENT DIVISION.                                            00230001
002400***************************************************************** 00240001
002500                                                                  00250001
002600 CONFIGURATION SECTION.                                           00260001
002700                                                                  00270001
002800 SOURCE-COMPUTER.        IBM-3090.                                00280001
002900 OBJECT-COMPUTER.        IBM-3090.                                00290001
003000                                                                  00300001
003100 INPUT-OUTPUT SECTION.                                            00310001
003200                                                                  00320001
003300 FILE-CONTROL.                                                    00330001
003400*                                                                 00340001
003500     SELECT SEASET-PURGE-FILE                                     00350001
003600         ASSIGN TO INP01.                                         00360001
003700                                                                  00370001
003800     SELECT CARTON-DETAIL-FILE                                    00380001
003900         ASSIGN TO INP02.                                         00390001
004000                                                                  00400001
004010     SELECT NEW-CARTON-DTL-FILE                                   00401010
004020         ASSIGN TO OUT01.                                         00402010
004030                                                                  00403010
004100     SELECT CARTON-ARCHIVE-FILE                                   00410001
004200         ASSIGN TO OUT02.                                         00420010
004300                                                                  00430001
004600***************************************************************** 00460001
004700 DATA DIVISION.                                                   00470001
004800***************************************************************** 00480001
004900*                                                                 00490001
005000 FILE SECTION.                                                    00500001
005100*                                                                 00510001
005200 FD  SEASET-PURGE-FILE                                            00520001
005300     RECORDING MODE IS F                                          00530001
005400     BLOCK CONTAINS 0  RECORDS.                                   00540001
005500 01  SEASET-PURGE-RECORD             PIC  X(30).                  00550001
005600                                                                  00560001
005700 FD  CARTON-DETAIL-FILE                                           00570001
005800     RECORDING MODE IS F                                          00580001
005900     BLOCK CONTAINS 0  RECORDS.                                   00590001
006000 01  CARTON-DETAIL-RECORD            PIC  X(130).                 00600001
006100                                                                  00610001
006200 FD  CARTON-ARCHIVE-FILE                                          00620001
006300     RECORDING MODE IS F                                          00630001
006400     BLOCK CONTAINS 0  RECORDS.                                   00640001
006500 01  CARTON-ARCHIVE-RECORD           PIC  X(130).                 00650002
006600                                                                  00660001
006700 FD  NEW-CARTON-DTL-FILE                                          00670001
006800     RECORDING MODE IS F                                          00680001
006900     BLOCK CONTAINS 0  RECORDS.                                   00690001
007100 01  NEW-CARTON-DTL-RECORD           PIC  X(130).                 00710002
007200*                                                                 00720001
007300                                                                  00730001
007400 WORKING-STORAGE SECTION.                                         00740001
007500*                                                                 00750001
007600 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00760001
007700                                                   COMP SYNC.     00770001
007800*                                                                 00780001
007900 01  PROGRAM-SWITCHES.                                            00790001
008000     05  PS-EOF-SEASET-PURGE-SW     PIC  X(01)    VALUE 'N'.      00800001
008100         88  PS-EOF-SEASET-PURGE                  VALUE 'Y'.      00810001
008200         88  PS-NOT-EOF-SEASET-PURGE             VALUE 'N'.       00820001
008300     05  PS-EOF-CARTON-DETAIL-SW   PIC  X(01)    VALUE 'N'.       00830001
008400         88  PS-EOF-CARTON-DETAIL                VALUE 'Y'.       00840001
008500         88  PS-NOT-EOF-CARTON-DETAIL            VALUE 'N'.       00850001
008600     05  PS-FIRST-TIME-SW          PIC  X(01)    VALUE 'Y'.       00860001
008700         88  PS-FIRST-TIME                       VALUE 'Y'.       00870001
008800         88  PS-NOT-FIRST-TIME                   VALUE 'N'.       00880001
008900*                                                                 00890001
009000 01  PC-CONSTANTS.                                                00900001
009100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00910001
009200         'SUKUT171'.                                              00920001
009300     05  PC-ASN                      PIC  X(03)    VALUE 'ASN'.   00930001
009400     05  PC-CKN                      PIC  X(03)    VALUE 'CKN'.   00940001
009500     05  PC-MST                      PIC  X(03)    VALUE 'MST'.   00950001
009600*                                                                 00960001
009700 01  PV-MISC-FIELDS.                                              00970001
009800     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00980001
009900                                                   COMP SYNC.     00990001
010000     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01000001
010100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01010001
010200     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01020001
010300     05  PV-CRTN-DTL-READ                PIC S9(09)  VALUE +0     01030024
010400                                                     COMP-3.      01040001
010500     05  PV-SEASET-REC-COUNT             PIC S9(09)  VALUE +0     01050003
010600                                                     COMP-3.      01060001
010700     05  PV-ARCHIVE-COUNT                PIC S9(09)  VALUE +0     01070003
010800                                                     COMP-3.      01080001
010900     05  PV-NEW-RECS-COUNT               PIC S9(09)  VALUE +0     01090003
011000                                                     COMP-3.      01100001
011100     05  PV-MSTR-OUT-COUNT               PIC S9(09)  VALUE +0     01110001
011200                                                     COMP-3.      01120001
011300     05  PV-CRTN-SEASET-KEY.                                      01130003
011400         10  PV-CRTN-SEASET-YR        PIC X(04).                  01140003
011500         10  PV-CRTN-SEASET-NME       PIC X(05).                  01150003
011600     05  PV-SEASET-KEY.                                           01160003
011700         10  PV-SEASET-YR             PIC   X(4).                 01170003
011800         10  PV-SEASET-SHRT-NM        PIC   X(5).                 01180003
011900                                                                  01190001
012000     05  PV-HOLD-DEST-LOC-NBR         PIC  S9(04)  VALUE 0 COMP.  01200001
012100     05  PV-HOLD-OTBND-TRIP-ID        PIC  S9(09)  VALUE 0 COMP.  01210001
012200     05  PV-HOLD-SHIPPED-TMST         PIC   X(26)  VALUE SPACES.  01220001
012300     05  PV-HOLD-TRLR-SEAL-ID         PIC   X(20)  VALUE SPACES.  01230001
012400     05  PV-HOLD-SML-TYPE             PIC   X(03)  VALUE SPACES.  01240001
012500     05  PV-HOLD-MSTR-UNT-ID          PIC 9(18)      VALUE 0.     01250001
012600     05  PV-HOLD-SHIPT-UNT-ID         PIC 9(18)      VALUE 0.     01260001
012700*                                                                 01270001
012800******************************************************************01280001
012900*  RECORD LAYOUT FOR THE SEASONAL SET ARCHIVE FILE                01290002
013000******************************************************************01300001
013100     COPY SURD170.                                                01310002
013200                                                                  01320001
013300*                                                                 01330001
013400******************************************************************01340001
013500*  RECORD LAYOUT FOR THE CARTON DETAIL FILE                       01350002
013600******************************************************************01360001
013700     COPY SURD171.                                                01370002
013800                                                                  01380001
015100 EJECT                                                            01510001
015200*                                                                 01520001
015300 PROCEDURE DIVISION.                                              01530001
015400*                                                                 01540001
015500 0000-MAINLINE-PROCESSING.                                        01550001
015600******************************************************************01560001
015700**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      01570001
015800******************************************************************01580001
015900*                                                                 01590001
016000     PERFORM 1000-INITIALIZATION.                                 01600001
016100*                                                                 01610001
016200     IF PS-NOT-EOF-CARTON-DETAIL                                  01620001
016300         PERFORM 2000-BUMP-FILES                                  01630001
016400***          UNTIL PS-EOF-SEASET-PURGE                            01640012
016500             UNTIL PS-EOF-CARTON-DETAIL                           01650012
017000     END-IF.                                                      01700001
017100                                                                  01710001
017200     PERFORM 9000-EOJ-ROUTINE.                                    01720001
017300*                                                                 01730001
017400     GOBACK.                                                      01740001
017500*                                                                 01750001
017600*                                                                 01760001
017700 1000-INITIALIZATION.                                             01770001
017800******************************************************************01780001
017900**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               01790001
018000******************************************************************01800001
018100                                                                  01810001
018200     DISPLAY ' **** START SUKUT171 ****'.                         01820001
018300                                                                  01830001
018400     OPEN INPUT  SEASET-PURGE-FILE                                01840001
018500                 CARTON-DETAIL-FILE                               01850001
018600          OUTPUT CARTON-ARCHIVE-FILE                              01860001
018700          OUTPUT NEW-CARTON-DTL-FILE.                             01870001
018800                                                                  01880001
018900     SET PS-NOT-EOF-SEASET-PURGE                                  01890001
019000         PS-NOT-EOF-CARTON-DETAIL   TO TRUE                       01900001
019100                                                                  01910001
019110     PERFORM 6000-READ-SEASET-PURGE-FILE.                         01911002
019200     PERFORM 6001-READ-CRTN-DETAIL-FILE.                          01920003
019400                                                                  01940001
019500     IF PS-EOF-CARTON-DETAIL                                      01950001
019600         DISPLAY '** CARTON DETAIL IS EMPTY **'                   01960003
019700     END-IF.                                                      01970001
019800                                                                  01980001
019900     IF PS-EOF-SEASET-PURGE                                       01990001
020000         DISPLAY '** SET ARCHIVE  IS EMPTY **'                    02000003
020100     END-IF.                                                      02010001
020200                                                                  02020001
020300*                                                                 02030001
020400****************************************************************  02040001
020500*  2000-BUMP-FILES.                                               02050001
020600*  MATCH THE RECORDS OF WHAT IS ON THE ARCHIVE SET FILE WITH      02060003
020700*  THE CARTON DETAIL FILE RECORDS                                 02070003
021000****************************************************************  02100001
021100 2000-BUMP-FILES.                                                 02110001
021200                                                                  02120001
021300*    SURD170 - SET RECORDS    SURD171 - CARTON DETAIL             02130003
021400                                                                  02140001
021500     IF PV-CRTN-SEASET-KEY < PV-SEASET-KEY                        02150004
021502            PERFORM 8100-WRITE-NEW-CARTON-DTL-FILE                02150204
021503            PERFORM 6001-READ-CRTN-DETAIL-FILE                    02150304
021700     ELSE                                                         02170001
021800         IF PV-CRTN-SEASET-KEY > PV-SEASET-KEY                    02180021
021803            IF PS-NOT-EOF-SEASET-PURGE                            02180323
021804               PERFORM 6000-READ-SEASET-PURGE-FILE                02180423
021805            END-IF                                                02180523
021821            IF PV-CRTN-SEASET-KEY = PV-SEASET-KEY                 02182121
021822               PERFORM 8000-WRITE-CARTON-ARCHIVE-FILE             02182221
021823            ELSE                                                  02182321
021824               PERFORM 8100-WRITE-NEW-CARTON-DTL-FILE             02182421
021825            END-IF                                                02182521
021826            PERFORM 6001-READ-CRTN-DETAIL-FILE                    02182621
022000         ELSE                                                     02200004
022001            IF PV-CRTN-SEASET-KEY = PV-SEASET-KEY                 02200120
022100               PERFORM 8000-WRITE-CARTON-ARCHIVE-FILE             02210020
022110               PERFORM 6001-READ-CRTN-DETAIL-FILE                 02211020
024800            END-IF                                                02480020
024810         END-IF                                                   02481020
024900     END-IF.                                                      02490003
025000                                                                  02500001
025100****************************************************************  02510001
025200* 6000-READ-SEASET-PURGE-FILE                                  *  02520001
025300* READ THE NEXT RECORD OF THE TRIP EXTRACT FILE                *  02530001
025400****************************************************************  02540001
025500 6000-READ-SEASET-PURGE-FILE.                                     02550001
025600                                                                  02560001
025700     READ SEASET-PURGE-FILE                                       02570001
025800     INTO SU171-EXTRACT-RECORD                                    02580009
025900        AT END                                                    02590001
026000           SET PS-EOF-SEASET-PURGE TO TRUE                        02600001
026100     END-READ.                                                    02610001
026200     IF PS-NOT-EOF-SEASET-PURGE                                   02620001
026300         MOVE SU171-SEASET-YR      TO PV-SEASET-YR                02630003
026400         MOVE SU171-SEASET-SHRT-NM TO PV-SEASET-SHRT-NM           02640003
026500         ADD 1 TO PV-SEASET-REC-COUNT                             02650003
026600     END-IF.                                                      02660001
026601     DISPLAY 'PROCESSING SEASONAL SET'                            02660125
026610     DISPLAY  PV-SEASET-YR ' ' PV-SEASET-SHRT-NM.                 02661027
026700                                                                  02670001
026800****************************************************************  02680001
026900* 6001-READ-CRTN-DETAIL-FILE                                   *  02690003
027000* READ THE NEXT RECORD OF THE MASTER EXTRACT FILE              *  02700001
027100****************************************************************  02710001
027200 6001-READ-CRTN-DETAIL-FILE.                                      02720003
027300                                                                  02730001
027400     READ CARTON-DETAIL-FILE                                      02740001
027500     INTO SU170-EXTRACT-RECORD                                    02750003
027600        AT END                                                    02760001
028000           SET PS-EOF-CARTON-DETAIL TO TRUE                       02800001
028100     END-READ.                                                    02810001
028200     IF PS-NOT-EOF-CARTON-DETAIL                                  02820001
028300         MOVE SU170-SEASET-YR      TO PV-CRTN-SEASET-YR           02830005
028400         MOVE SU170-SEASET-SHRT-NM TO PV-CRTN-SEASET-NME          02840005
028600         ADD 1 TO PV-CRTN-DTL-READ                                02860024
028700     END-IF.                                                      02870001
028800*                                                                 02880001
041700****************************************************************  04170001
041800* 8000-WRITE-CARTON-ARCHIVE-FILE                               *  04180001
041900* WRITE THE NEXT RECORD OF THE OMS MERGE FILE                  *  04190001
042000****************************************************************  04200001
042100 8000-WRITE-CARTON-ARCHIVE-FILE.                                  04210001
042200     WRITE CARTON-ARCHIVE-RECORD                                  04220001
042300       FROM SU170-EXTRACT-RECORD.                                 04230003
042400     ADD 1 TO PV-ARCHIVE-COUNT.                                   04240003
042500*                                                                 04250001
042600****************************************************************  04260001
042700* 8100-WRITE-NEW-CARTON-DTL-FILE                               *  04270001
042800* WRITE THE NEXT RECORD OF THE MLS MERGE FILE                  *  04280001
042900****************************************************************  04290001
043000 8100-WRITE-NEW-CARTON-DTL-FILE.                                  04300001
043100                                                                  04310001
043200     WRITE NEW-CARTON-DTL-RECORD                                  04320001
043300       FROM SU170-EXTRACT-RECORD.                                 04330007
043400     ADD 1 TO PV-NEW-RECS-COUNT.                                  04340003
043500                                                                  04350001
043600 9000-EOJ-ROUTINE.                                                04360001
043700                                                                  04370001
043710     DISPLAY 'SEASET RECORDS READ  = ' PV-SEASET-REC-COUNT.       04371028
043800     DISPLAY 'CRTN DTL REC IN READ = ' PV-CRTN-DTL-READ.          04380024
043900     DISPLAY 'CRTN DTL REC WRITTEN = ' PV-NEW-RECS-COUNT.         04390028
044000     DISPLAY 'ARCHIVE RECS WRITTEN = ' PV-ARCHIVE-COUNT.          04400024
044300                                                                  04430001
044400     CLOSE SEASET-PURGE-FILE                                      04440001
044500           CARTON-DETAIL-FILE                                     04450001
044600           CARTON-ARCHIVE-FILE                                    04460001
044700           NEW-CARTON-DTL-FILE.                                   04470001
044800                                                                  04480001
