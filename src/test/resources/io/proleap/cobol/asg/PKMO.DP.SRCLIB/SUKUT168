000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'CHECK FOR INVENTORY STORES'.                              00020000
000300                                                                  00030000
000400 PROGRAM-ID.             SUKUT168.                                00040000
000500 AUTHOR.                 GERMAN BANDA.                            00050000
000600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00060000
000700 DATE-WRITTEN            JUNE 2020.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000 ENVIRONMENT DIVISION.                                            00100000
001100 CONFIGURATION SECTION.                                           00110000
001200                                                                  00120000
001300 SOURCE-COMPUTER.        IBM-3090.                                00130000
001400 OBJECT-COMPUTER.        IBM-3090.                                00140000
001500 INPUT-OUTPUT SECTION.                                            00150000
001600 FILE-CONTROL.                                                    00160000
001700                                                                  00170000
001710     SELECT BATCH-DATE-IN                                         00171000
001720         ASSIGN TO INP01.                                         00172000
001721                                                                  00172100
001722     SELECT CARTON-DTL-INPUT-FILE                                 00172200
001723         ASSIGN TO INP02.                                         00172300
001724                                                                  00172400
001725     SELECT STORE-INV-OUTPUT-FILE                                 00172500
001726         ASSIGN TO OUT01.                                         00172600
001727                                                                  00172700
001728 DATA DIVISION.                                                   00172800
001729 FILE SECTION.                                                    00172900
001730 FD  BATCH-DATE-IN                                                00173000
001740     RECORDING MODE IS F                                          00174000
001750     LABEL RECORDS ARE STANDARD                                   00175000
001751     BLOCK CONTAINS 0 RECORDS.                                    00175100
001752                                                                  00175200
001753 01  BATCH-DATE-RECORD-IN               PIC  X(80).               00175300
001754*                                                                 00175400
001755                                                                  00175500
001756 FD  CARTON-DTL-INPUT-FILE                                        00175600
001757     RECORDING MODE IS F                                          00175700
001758     LABEL RECORDS ARE STANDARD                                   00175800
001759     BLOCK CONTAINS 0 RECORDS.                                    00175900
001760                                                                  00176000
001770 01  CARTON-DTL-INPUT-RECORD        PIC X(130).                   00177000
001780                                                                  00178000
001790 FD  STORE-INV-OUTPUT-FILE                                        00179000
001800     RECORDING MODE IS F                                          00180000
001900     LABEL RECORDS ARE STANDARD                                   00190000
002000     BLOCK CONTAINS 0 RECORDS.                                    00200000
002010                                                                  00201000
002011 01  STORE-INV-OUTPUT-RECORD        PIC X(58).                    00201100
002012                                                                  00201200
002013 WORKING-STORAGE SECTION.                                         00201300
002014*                                                                 00201400
002015******************************************************************00201500
002016*  CARTON DETAIL INPUT LAYOUT                                     00201600
002017******************************************************************00201700
002018     COPY SURD170.                                                00201800
002019******************************************************************00201900
002020*  INVENTORY COUNT OUTPUT LAYOUT                                  00202000
002030******************************************************************00203000
002031     COPY INWS018.                                                00203100
002032                                                                  00203200
002033******************************************************************00203300
002034                                                                  00203400
002035 01  PV-INPUT-FILE.                                               00203500
002036     05  BTCH-RUN-DATE               PIC  X(10)    VALUE SPACES.  00203600
002037     05  FILLER                      PIC  X(70)    VALUE SPACES.  00203700
002038                                                                  00203800
002039                                                                  00203900
002040 01  PS-SWITCHES.                                                 00204000
002050     05  PS-END-OF-CONTROL-SW        PIC  X(01)    VALUE 'N'.     00205000
002060         88  PS-END-OF-CONTROL                     VALUE 'Y'.     00206000
002070         88  PS-NOT-END-OF-CONTROL                 VALUE 'N'.     00207000
002080     05  PS-END-OF-FILE-SW             PIC  X(01)  VALUE 'N'.     00208000
002081         88  PS-END-OF-FILE                        VALUE 'Y'.     00208100
002082         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00208200
002083     05  PS-END-CSR-SW                PIC X(01) VALUE 'N'.        00208300
002084         88  PS-END-CSR-YES                     VALUE 'Y'.        00208400
002085         88  PS-END-CSR-NO                      VALUE 'N'.        00208500
002086     05  PS-FIRST-RECORD-SW           PIC X(01) VALUE 'Y'.        00208600
002087         88  PS-FIRST-RECORD-YES                VALUE 'Y'.        00208700
002088         88  PS-FIRST-RECORD-NO                 VALUE 'N'.        00208800
002089     05  PS-INVENTORY-SW              PIC X(01) VALUE 'N'.        00208900
002090         88  PS-INVENTORY-YES                   VALUE 'Y'.        00209000
002100         88  PS-INVENTORY-NO                    VALUE 'N'.        00210000
002200     05  PS-WRITE-CRTN-SKU-SW         PIC X(01) VALUE 'Y'.        00220000
002300         88  PS-WRITE-CRTN-SKU-YES              VALUE 'Y'.        00230000
002400         88  PS-WRITE-CRTN-SKU-NO               VALUE 'N'.        00240000
002500                                                                  00250000
002600                                                                  00260000
002700 01  PC-CONSTANTS.                                                00270000
002800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00280000
002900                                                   'SUKUT168'.    00290000
003000     05  PC-ILBOABN0                 PIC  X(08)    VALUE          00300000
003100                                                   'ILBOABN0'.    00310000
003200                                                                  00320000
003300 01  PV-MISC-STUFF.                                               00330000
003400     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.    00340000
003500     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.     00350000
003600     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.      00360000
003700     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO       00370000
003800                                                   COMP SYNC.     00380000
003900     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.            00390000
004000     05  PV-DISP-STORE-FILE           PIC 9(04) VALUE ZERO.       00400000
004100     05  PV-DISP-STORE-DB             PIC 9(04) VALUE ZERO.       00410000
004200     05  PV-CARTON-SRCE-CDE           PIC X(3)  VALUE SPACES.     00420000
004300     05  PV-CARTON-SRCE-CDE-HOLD      PIC X(3)  VALUE SPACES.     00430000
004301     05  PV-BATCH-DATE                PIC X(10) VALUE SPACES.     00430100
004302     05  PV-BATCH-DATE-R REDEFINES PV-BATCH-DATE.                 00430200
004303          10 PV-CURRENT-CCYY              PIC  X(04).             00430300
004304          10 FILLER                       PIC  X(01).             00430400
004305          10 PV-CURRENT-MM                PIC  X(02).             00430500
004306          10 FILLER                       PIC  X(01).             00430600
004307          10 PV-CURRENT-DD                PIC  X(02).             00430700
004308     05  PV-SCAN-DATE.                                            00430800
004309          10 PV-SCAN-MM                   PIC  X(02).             00430900
004310          10 PV-SCAN-DD                   PIC  X(02).             00431000
004320     05  PV-INV-STORES-FETCHED        PIC 9(04) VALUE ZERO.       00432009
004330     05  PV-READ-COUNTER              PIC 9(09) VALUE ZERO.       00433004
004340     05  PV-INV-RECORDS-WRITTEN       PIC 9(09) VALUE ZERO.       00434004
004341     05  PV-DISPLAY                   PIC ZZZ,ZZ9,999.            00434108
004350     05  PV-STORE-NBR-N               PIC 9(04) VALUE ZERO.       00435001
004360     05  PV-STORE-NBR-HOLD            PIC 9(04) VALUE ZERO.       00436000
004370     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.     00437000
004380     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.     00438000
004390                                                                  00439000
004400***************************************************************** 00440000
004500*    OUTPUT FILE RECORD                                           00450000
004600***************************************************************** 00460000
004700 01  OUT-OUTPUT-FILE-RECORD.                                      00470000
004800     05  FILLER                       PIC X(17) VALUE SPACES.     00480000
004900     05  OUT-STORE-NBR                PIC X(05) VALUE SPACES.     00490000
005000     05  FILLER                       PIC X(58) VALUE SPACES.     00500000
005100                                                                  00510000
005110 01  ABEND-CODE                       PIC S9(04)     VALUE +0     00511000
005120                                                     COMP SYNC.   00512000
005130     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 00513000
005140     88  ABEND-4002-READ-ERROR                       VALUE +4002. 00514000
005150     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 00515000
005160     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 00516000
005170     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00517000
005180     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 00518000
005190     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 00519000
005200     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 00520000
005300     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 00530000
005400     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00540000
005500                                                                  00550000
005600     COPY DPWS004.                                                00560000
005700                                                                  00570000
005800*    XLT_MDSE_INV_PARM                                            00580000
005900     EXEC SQL                                                     00590000
006000         INCLUDE XLT00025                                         00600000
006100     END-EXEC.                                                    00610000
006200                                                                  00620000
006300*    XLT_LOC                                                      00630000
006400     EXEC SQL                                                     00640000
006500         INCLUDE XLT00010                                         00650000
006600     END-EXEC.                                                    00660000
006700******************************************************************00670000
006800*     WST_INTGRTN_TYP TABLE                                       00680000
006900******************************************************************00690000
007000     EXEC SQL                                                     00700000
007100          INCLUDE WST00008                                        00710000
007200     END-EXEC.                                                    00720000
007300                                                                  00730000
007310******************************************************************00731000
007320*     WST_ATTR_DEFN TABLE                                         00732000
007330******************************************************************00733000
007340     EXEC SQL                                                     00734000
007350          INCLUDE WST00009                                        00735000
007360     END-EXEC.                                                    00736000
007370                                                                  00737000
007380******************************************************************00738000
007390*    WST_ATTR_ELEM TABLE                                          00739000
007391******************************************************************00739100
007392     EXEC SQL                                                     00739200
007393          INCLUDE WST00010                                        00739300
007394     END-EXEC.                                                    00739400
007395******************************************************************00739500
007396                                                                  00739600
007397     EXEC SQL                                                     00739700
007398         INCLUDE SQLCA                                            00739800
007399     END-EXEC.                                                    00739900
007400                                                                  00740000
007500     COPY SQLCA2.                                                 00750000
007600                                                                  00760000
007700     EXEC SQL                                                     00770000
007800         DECLARE INV-LOC-CSR CURSOR FOR                           00780000
007900         SELECT                                                   00790000
008000              P.LOC_NBR                                           00800000
008010         FROM                                                     00801000
008020              XLT_MDSE_INV_PARM P                                 00802000
008030            , XLT_LOC           L                                 00803000
008040         WHERE                                                    00804000
008050              PLND_INV_DTE       = :XLT00025-PLND-INV-DTE         00805000
008060          AND P.LOC_NBR          = L.LOC_NBR                      00806000
008070          AND P.ACTV_IND         = 'Y'                            00807000
008080          AND P.LOC_INV_STAT_CDE = 'IN'                           00808000
008090          AND P.FIN_BK_DTE       = '9999-09-09'                   00809000
008091          AND L.LOC_TYP_CDE      = 'DS'                           00809100
008092          AND SCHD_PHY_CNT_CDE   = 'PI'                           00809200
008093          AND SCN_INV_IND    = 'Y'                                00809300
008094         ORDER BY                                                 00809400
008095              LOC_NBR                                             00809500
008096     END-EXEC.                                                    00809600
008097/                                                                 00809700
008098 PROCEDURE DIVISION.                                              00809800
008099                                                                  00809900
008100     PERFORM 1000-INITIALIZE.                                     00810000
008110                                                                  00811000
008120     PERFORM 2000-PROCESS-STORE-RECS                              00812000
008130         UNTIL PS-END-CSR-YES                                     00813000
008140         OR    PS-END-OF-FILE                                     00814000
008150                                                                  00815000
008160     PERFORM 3020-CLOSE-CSR                                       00816000
008170                                                                  00817000
008180     IF PS-INVENTORY-NO                                           00818000
008190         DISPLAY '**** NO STORES DOING INVENTORY TODAY ****'      00819000
008200     ELSE                                                         00820000
008300         DISPLAY '**** STORES ARE DOING INVENTORY TODAY ****'     00830000
008400     END-IF.                                                      00840000
008500                                                                  00850000
008600     PERFORM 9000-TERMINATE.                                      00860000
008610                                                                  00861000
008620     GOBACK.                                                      00862000
008630/                                                                 00863000
008640 1000-INITIALIZE.                                                 00864000
008650     MOVE '1000-INITIALIZE'               TO PV-ABEND-PARAGRAPH.  00865000
008660                                                                  00866000
008670     OPEN INPUT  BATCH-DATE-IN                                    00867000
008680                 CARTON-DTL-INPUT-FILE.                           00868000
008690     OPEN OUTPUT STORE-INV-OUTPUT-FILE.                           00869000
008700                                                                  00870000
008800     PERFORM 1200-READ-CONTROL-CARD.                              00880000
008900                                                                  00890000
009000                                                                  00900000
009100     IF PS-NOT-END-OF-CONTROL                                     00910000
009200        MOVE BTCH-RUN-DATE TO  XLT00025-PLND-INV-DTE              00920000
009300                               PV-BATCH-DATE                      00930000
009400        MOVE PV-CURRENT-MM TO  PV-SCAN-MM                         00940000
009500        MOVE PV-CURRENT-DD TO  PV-SCAN-DD                         00950000
009600        SET PS-END-CSR-NO TO TRUE                                 00960000
009700        PERFORM 3000-OPEN-CSR                                     00970000
009800        PERFORM 3010-FETCH-CSR                                    00980000
009810     END-IF                                                       00981000
009811                                                                  00981100
009812     IF PS-END-CSR-NO                                             00981200
009813        SET PS-INVENTORY-YES     TO TRUE                          00981300
009814     END-IF                                                       00981400
009815                                                                  00981500
009816     PERFORM 7000-READ-CRTN-DTL-FILE-IN.                          00981600
009817                                                                  00981700
009818                                                                  00981800
009819******************************************************************00981900
009820*  READ INPUT CONTROL CARD TO GET THE CURRENT BATCH PROCESSING    00982000
009830*  DATE.                                                          00983000
009840******************************************************************00984000
009850 1200-READ-CONTROL-CARD.                                          00985000
009860                                                                  00986000
009870     READ BATCH-DATE-IN                                           00987000
009880         INTO PV-INPUT-FILE                                       00988000
009890             AT END                                               00989000
009900                 MOVE 'Y' TO PS-END-OF-CONTROL-SW.                00990000
009910                                                                  00991000
009920     IF PS-END-OF-CONTROL                                         00992000
009930         DISPLAY ' '                                              00993000
009940         DISPLAY ' *** NO CONTROL CARD FOUND TO PROCESS ***'      00994000
009950         DISPLAY ' '                                              00995000
009960     ELSE                                                         00996000
009970         DISPLAY 'BATCH PROCESSING CONTROL CARD DATE  = '         00997000
009980                 BTCH-RUN-DATE                                    00998000
009990     END-IF.                                                      00999000
010000                                                                  01000000
010010/                                                                 01001000
010020 2000-PROCESS-STORE-RECS.                                         01002000
010030                                                                  01003000
010040     MOVE '2000-PROCESS-STORE-RECS'   TO PV-ABEND-PARAGRAPH.      01004000
010050                                                                  01005000
010060     INITIALIZE OUT-OUTPUT-FILE-RECORD.                           01006000
010070                                                                  01007000
010080     IF  XLT00025-LOC-NBR   > SU170-SCN-LOC-NBR                   01008000
010090         PERFORM 7000-READ-CRTN-DTL-FILE-IN                       01009000
010100     ELSE                                                         01010000
010200       IF XLT00025-LOC-NBR < SU170-SCN-LOC-NBR                    01020000
010300          PERFORM 3010-FETCH-CSR                                  01030000
010400       ELSE                                                       01040000
010500         PERFORM 2100-PROCESS-RCVR-FILE                           01050000
010600     END-IF.                                                      01060000
010700                                                                  01070000
010800/                                                                 01080000
010900 2100-PROCESS-RCVR-FILE.                                          01090000
011000                                                                  01100000
011100       MOVE PV-SCAN-DATE            TO IN018-SCAN-DTE.            01110000
011200       MOVE SU170-SCN-LOC-NBR       TO IN018-STORE-NUMBER.        01120000
011300       MOVE SU170-SKU-NBR           TO IN018-SKU.                 01130000
011400       MOVE SU170-SKU-QTY           TO IN018-QUANTITY.            01140000
011500       MOVE +0                      TO IN018-UPC-CODE.            01150000
011600                                                                  01160000
011700       PERFORM 4000-CHECK-CARTON-SOURCE.                          01170000
011800       IF PS-WRITE-CRTN-SKU-YES                                   01180000
011900          PERFORM 8000-WRITE-STORE-OUTPUT                         01190000
012000       END-IF.                                                    01200000
012100                                                                  01210000
012200       PERFORM 7000-READ-CRTN-DTL-FILE-IN.                        01220000
012300                                                                  01230000
012400 3000-OPEN-CSR.                                                   01240000
012500                                                                  01250000
012600     MOVE '3000-OPEN-CSR'             TO PV-ABEND-PARAGRAPH.      01260000
012700                                                                  01270000
012800     EXEC SQL                                                     01280000
012900         OPEN INV-LOC-CSR                                         01290000
013000     END-EXEC                                                     01300000
013100                                                                  01310000
013200     EVALUATE TRUE                                                01320000
013300         WHEN SQLCODE = ZERO                                      01330000
013400                 CONTINUE                                         01340000
013500         WHEN SQLCODE = -904                                      01350000
013600         WHEN SQLCODE = -911                                      01360000
013700         WHEN SQLCODE = -913                                      01370000
013800             PERFORM 9900-SQL-ERROR                               01380000
013900                                                                  01390000
014000         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  01400000
014100             DISPLAY '**************************************'     01410000
014200             DISPLAY 'WARNING ISSUED '                            01420000
014300             DISPLAY 'OPEN CURSOR                           '     01430000
014400             DISPLAY '**************************************'     01440000
014500             PERFORM 9800-SQL-WARNING                             01450000
014600                                                                  01460000
014700         WHEN SQLCODE < ZERO                                      01470000
014800             DISPLAY '**************************************'     01480000
014900             DISPLAY 'ERROR ISSUED ON                       '     01490000
015000             DISPLAY 'OPEN CURSOR                           '     01500000
015100             DISPLAY '**************************************'     01510000
015200             PERFORM 9900-SQL-ERROR                               01520000
015300                                                                  01530000
015400     END-EVALUATE.                                                01540000
015500                                                                  01550000
015600 3010-FETCH-CSR.                                                  01560000
015700                                                                  01570000
015800     MOVE '3010-FETCH-CSR'          TO PV-ABEND-PARAGRAPH.        01580000
015900                                                                  01590000
016000     EXEC SQL                                                     01600000
016100         FETCH INV-LOC-CSR                                        01610000
016200         INTO                                                     01620000
016300             :XLT00025-LOC-NBR                                    01630000
016400     END-EXEC                                                     01640000
016500                                                                  01650000
016600     EVALUATE TRUE                                                01660000
016700         WHEN SQLCODE = ZERO                                      01670000
016800             ADD 1                    TO PV-INV-STORES-FETCHED    01680000
016900         WHEN SQLCODE = +100                                      01690000
017000             SET PS-END-CSR-YES       TO TRUE                     01700000
017100         WHEN SQLCODE = -904                                      01710000
017200         WHEN SQLCODE = -911                                      01720000
017300         WHEN SQLCODE = -913                                      01730000
017310             PERFORM 9900-SQL-ERROR                               01731000
017320                                                                  01732000
017330         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  01733000
017331             DISPLAY '**************************************'     01733100
017332             DISPLAY 'WARNING ISSUED '                            01733200
017333             DISPLAY 'FETCH CURSOR                          '     01733300
017334             DISPLAY 'XLT_MDSE_INV_PARM                     '     01733400
017335             DISPLAY '**************************************'     01733500
017336             PERFORM 9800-SQL-WARNING                             01733600
017337                                                                  01733700
017338         WHEN SQLCODE < ZERO                                      01733800
017339             DISPLAY '**************************************'     01733900
017340             DISPLAY 'ERROR ISSUED ON                       '     01734000
017341             DISPLAY 'FETCH CURSOR                          '     01734100
017342             DISPLAY 'XLT_MDSE_INV_PARM                     '     01734200
017343             DISPLAY '**************************************'     01734300
017344             PERFORM 9900-SQL-ERROR                               01734400
017345                                                                  01734500
017346     END-EVALUATE.                                                01734600
017347                                                                  01734700
017348 3020-CLOSE-CSR.                                                  01734800
017349                                                                  01734900
017350     MOVE '3020-CLOSE-CSR'          TO PV-ABEND-PARAGRAPH.        01735000
017351                                                                  01735100
017352     EXEC SQL                                                     01735200
017353         CLOSE INV-LOC-CSR                                        01735300
017354     END-EXEC                                                     01735400
017355                                                                  01735500
017356     EVALUATE TRUE                                                01735600
017357         WHEN SQLCODE = ZERO                                      01735700
017358                 CONTINUE                                         01735800
017359         WHEN SQLCODE = -904                                      01735900
017360         WHEN SQLCODE = -911                                      01736000
017361         WHEN SQLCODE = -913                                      01736100
017362             PERFORM 9900-SQL-ERROR                               01736200
017363                                                                  01736300
017364         WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                  01736400
017365             DISPLAY '**************************************'     01736500
017366             DISPLAY 'WARNING ISSUED '                            01736600
017367             DISPLAY 'CLOSE CURSOR                          '     01736700
017368             DISPLAY '**************************************'     01736800
017369             PERFORM 9800-SQL-WARNING                             01736900
017370                                                                  01737000
017371         WHEN SQLCODE < ZERO                                      01737100
017372             DISPLAY '**************************************'     01737200
017373             DISPLAY 'ERROR ISSUED ON                       '     01737300
017374             DISPLAY 'CLOSE CURSOR                          '     01737400
017375             DISPLAY '**************************************'     01737500
017376             PERFORM 9900-SQL-ERROR                               01737600
017377                                                                  01737700
017378     END-EVALUATE.                                                01737800
017379                                                                  01737900
017380 4000-CHECK-CARTON-SOURCE.                                        01738000
017390*                                                                 01739000
017391        EXEC SQL                                                  01739100
017392         SELECT G.ATTR_ELEM_TXT                                   01739200
017393           INTO :PV-CARTON-SRCE-CDE                               01739300
017394           FROM  WST_INTGRTN_TYP  A                               01739400
017395                ,WST_ATTR_DEFN    B                               01739500
017396                ,WST_ATTR_ELEM    C                               01739600
017397                ,WST_ATTR_ELEM    D                               01739700
017398                ,WST_ATTR_ELEM    E                               01739800
017399                ,WST_ATTR_ELEM    F                               01739900
017400                ,WST_ATTR_ELEM    G                               01740000
017401                ,WST_ATTR_ELEM    H                               01740100
017402            WHERE A.INTGRTN_TYP_CDE   = 'PKHLDINV'                01740200
017403              AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE         01740300
017404              AND B.ATTR_DEFN_SEQ_NBR = 1                         01740400
017405              AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE         01740500
017406              AND C.ATTR_DEFN_SEQ_NBR = 1                         01740600
017407              AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE         01740700
017408              AND D.ATTR_DEFN_SEQ_NBR = 2                         01740800
017409              AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE         01740900
017410              AND E.ATTR_DEFN_SEQ_NBR = 3                         01741000
017411              AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE         01741100
017412              AND F.ATTR_DEFN_SEQ_NBR = 4                         01741200
017413              AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE         01741300
017414              AND G.ATTR_DEFN_SEQ_NBR = 5                         01741400
017415              AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE         01741500
017416              AND H.ATTR_DEFN_SEQ_NBR = 6                         01741600
017417              AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR       01741700
017418              AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR       01741800
017419              AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR       01741900
017420              AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR       01742000
017421              AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR       01742100
017422              AND H.ATTR_ELEM_TXT     = 'Y'                       01742200
017423              AND E.ATTR_ELEM_TMST   <= CURRENT TIMESTAMP         01742300
017424              AND F.ATTR_ELEM_TMST   >= CURRENT TIMESTAMP         01742400
017425              AND G.ATTR_ELEM_TXT     = :SU170-CART-SRC-CDE       01742500
017426              AND C.ATTR_ELEM_TXT     = :SU170-SEASET-YR          01742600
017427              AND D.ATTR_ELEM_TXT     = :SU170-SEASET-SHRT-NM     01742700
017428           WITH UR                                                01742800
017429        END-EXEC.                                                 01742900
017430                                                                  01743000
017431       EVALUATE TRUE                                              01743100
017432           WHEN SQLCODE = ZERO                                    01743200
017433               SET PS-WRITE-CRTN-SKU-YES TO TRUE                  01743300
017434           WHEN SQLCODE = +100                                    01743400
017435               SET PS-WRITE-CRTN-SKU-NO  TO  TRUE                 01743500
017436           WHEN SQLCODE = -904                                    01743600
017437           WHEN SQLCODE = -911                                    01743700
017438           WHEN SQLCODE = -913                                    01743800
017439               PERFORM 9900-SQL-ERROR                             01743900
017440                                                                  01744000
017441           WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')                01744100
017442               DISPLAY '**************************************'   01744200
017443               DISPLAY 'WARNING ISSUED '                          01744300
017444               DISPLAY '4000-CHECK-CARTON-SOURCE              '   01744400
017445               DISPLAY 'WST_ATTR_ELEM                         '   01744500
017446               DISPLAY '**************************************'   01744600
017447               PERFORM 9800-SQL-WARNING                           01744700
017448                                                                  01744800
017449           WHEN SQLCODE < ZERO                                    01744900
017450               DISPLAY '**************************************'   01745000
017451               DISPLAY 'ERROR ISSUED ON                       '   01745100
017452               DISPLAY '4000-CHECK-CARTON-SOURCE              '   01745200
017453               DISPLAY 'WST_ATTR_ELEM                         '   01745300
017454               DISPLAY '**************************************'   01745400
017455               PERFORM 9900-SQL-ERROR                             01745500
017456                                                                  01745600
017457       END-EVALUATE.                                              01745700
017458                                                                  01745800
017459******************************************************************01745900
017460 7000-READ-CRTN-DTL-FILE-IN.                                      01746000
017461                                                                  01746100
017462      INITIALIZE SU170-EXTRACT-RECORD.                            01746200
017463                                                                  01746300
017464      READ CARTON-DTL-INPUT-FILE INTO                             01746400
017465           SU170-EXTRACT-RECORD                                   01746500
017466            AT END SET PS-END-OF-FILE TO TRUE.                    01746600
017467                                                                  01746700
017468      IF PS-END-OF-FILE                                           01746800
017469         CONTINUE                                                 01746900
017470      ELSE                                                        01747000
017471         ADD +1 TO PV-READ-COUNTER                                01747100
017472      END-IF.                                                     01747200
017473                                                                  01747300
017474***************************************************************** 01747400
017475*  WRITE A RECORD TO THE STORE NUMBER OUTPUT FILE                 01747500
017476***************************************************************** 01747600
017477 8000-WRITE-STORE-OUTPUT.                                         01747700
017478                                                                  01747800
017479     WRITE STORE-INV-OUTPUT-RECORD                                01747900
017480         FROM IN018-INVENTORY-COUNT-RECORD                        01748000
017481                                                                  01748100
017482     ADD 1                TO PV-INV-RECORDS-WRITTEN.              01748200
017483                                                                  01748300
017484******************************************************************01748400
017485*  CLOSE FILES AND DISPLAY TOTALS OF RECORDS PROCESSED           *01748500
017486******************************************************************01748600
017487 9000-TERMINATE.                                                  01748700
017488                                                                  01748800
017489     CLOSE BATCH-DATE-IN                                          01748900
017490           CARTON-DTL-INPUT-FILE                                  01749000
017491           STORE-INV-OUTPUT-FILE.                                 01749100
017492                                                                  01749200
017493     IF  PS-INVENTORY-YES                                         01749300
017497         DISPLAY '**'                                             01749704
017498         DISPLAY '** STORE RECORDS READ....: '                    01749807
017499                 PV-INV-STORES-FETCHED                            01749909
017500         MOVE  PV-READ-COUNTER       TO PV-DISPLAY                01750005
017501         DISPLAY '**'                                             01750104
017502         DISPLAY '** CARTON DETAILS READ...: '                    01750207
017503                 PV-DISPLAY                                       01750305
017504         DISPLAY '**'                                             01750404
017505         MOVE  PV-INV-RECORDS-WRITTEN TO PV-DISPLAY               01750505
017506         DISPLAY '** INVENTORY RECS WRITTEN: '                    01750606
017507                 PV-DISPLAY                                       01750705
017508     END-IF.                                                      01750804
017509                                                                  01750904
017510/                                                                 01751004
017511 9100-SQL-ABEND.                                                  01751104
017512******************************************************************01751204
017513*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    01751304
017514*  ERROR OR WARNING CODE OCCURS.                                  01751404
017515******************************************************************01751504
017520     CLOSE STORE-INV-OUTPUT-FILE.                                 01752000
017530                                                                  01753000
017540     DISPLAY '9100-SQL-ABEND'.                                    01754000
017550     DISPLAY '** ABEND     **'.                                   01755000
017560     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01756000
017570     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             01757000
017580     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     01758000
017590     DISPLAY '**              ** = '                              01759000
017600     MOVE SQLCODE TO PV-SQL-CODE.                                 01760000
017700     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    01770000
017800     MOVE +4013 TO PV-ABEND-CODE.                                 01780000
017900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         01790000
018000                                                                  01800000
018100 9200-ABEND.                                                      01810000
018200******************************************************************01820000
018300*  PERFORMS THE ABEND FOR THE PROGRAM                             01830000
018400******************************************************************01840000
018500     CLOSE STORE-INV-OUTPUT-FILE.                                 01850000
018600                                                                  01860000
018700     DISPLAY '9200-ABEND'.                                        01870000
018800     DISPLAY '** ABEND     **'.                                   01880000
018900     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01890000
019000     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             01900000
019100     DISPLAY '**              ** = '                              01910000
019200     MOVE +4013 TO PV-ABEND-CODE.                                 01920000
019300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         01930000
019400                                                                  01940000
019500******************************************************************01950000
019600*  THIS MODULE PERFORMS THE SQL WARNING.                         *01960000
019700******************************************************************01970000
019800                                                                  01980000
019900 9800-SQL-WARNING.                                                01990000
020000                                                                  02000000
020100     CLOSE STORE-INV-OUTPUT-FILE.                                 02010000
020200                                                                  02020000
020300     MOVE SQLCODE               TO SQLCODE2.                      02030000
020400     MOVE SQLERRD(3)            TO SQLERRD3.                      02040000
020500     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02050000
020600     DISPLAY '** PROGRAM        ** = SUKUT168'.                   02060000
020700     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        02070000
020800     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02080000
020900     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02090000
021000                                                                  02100000
021100     COPY DPPD004.                                                02110000
021200     SET ABEND-4013-DB2-ERROR   TO TRUE                           02120000
021300     CALL 'ILBOABN0' USING ABEND-CODE.                            02130000
021400/                                                                 02140000
021500******************************************************************02150000
021600* THIS MODULE PERFORMS THE SQL ERROR.                            *02160000
021700******************************************************************02170000
021800                                                                  02180000
021900 9900-SQL-ERROR.                                                  02190000
022000                                                                  02200000
022100     CLOSE STORE-INV-OUTPUT-FILE.                                 02210000
022200                                                                  02220000
022300     MOVE SQLCODE               TO SQLCODE2.                      02230000
022400     MOVE SQLERRD(3)            TO SQLERRD3.                      02240000
022500     DISPLAY '** ABEND **       ** = SQLERROR'.                   02250000
022600     DISPLAY '** PROGRAM        ** = SUKUT168'.                   02260000
022700     DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.        02270000
022800     DISPLAY '** OPERATION      ** = ' PV-ABEND-OPERATION         02280000
022900     DISPLAY '** TABLE          ** = ' PV-ABEND-STRUCTURE-1       02290000
023000     DISPLAY SPACES                                               02300000
023100                                                                  02310000
023200     COPY DPPD004.                                                02320000
023300     SET ABEND-4013-DB2-ERROR   TO TRUE                           02330000
023400     CALL 'ILBOABN0' USING ABEND-CODE.                            02340000
