000200******************************************************************00020001
000300*  I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES00030001
000400*  SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.       00040001
000500*  THIS PROGRAM USES MQSERIES.                                    00050001
000600*                                                                 00060019
000700*  THIS IS A CICS PROGRAM THAT MONITORS AN MQSERIES QUEUE.  AFTER 00070011
000800*  PROCESSING A RECORD, IT WILL WAIT FOR UP TO 30 MINUTES BEFORE  00080011
000810*  SHUTTING DOWN.                                                 00081011
000900*                                                                 00090001
000910*  THIS PROGRAM COMPILES WITH A RET CODE OF 4. THE LOOP WARNING   00091011
000920*  IS RELATED TO THE CODE FOR THE STARTED TASK PROCESSING.        00092011
000930*                                                                 00093011
001000******************************************************************00100001
001100                                                                  00110001
001200 IDENTIFICATION DIVISION.                                         00120001
001300 PROGRAM-ID.             WSKCS307.                                00130001
001400 AUTHOR.                 JEAN KURKOWSKI.                          00140001
001500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00150001
001600 DATE-WRITTEN.           FEBRUARY 2007.                           00160001
001700 DATE-COMPILED.                                                   00170001
001800                                                                  00180001
001900******************************************************************00190001
002000*      I T E M   M E S S A G E   Q U E U E   D O W N L O AD       00200001
002100*                                                                 00210001
002200* THIS PROGRAM WILL READ THE PIX RECORDS FROM WMS AND PROCESS     00220001
002300* THE RECEIVING TRANSACTIONS.  THE APPROPRIATE MODULE WILL BE     00230001
002400* CALLED, BASED ON THE TRANSACTION TYPE.                          00240001
002500*                                                                 00250001
002600* GENERAL PROCESSING:                                             00260001
002700* -------------------                                             00270001
002800* 1) INITIALIZE VARIABLES, SET SWITCHES, OPEN ITEM QUEUE.         00280001
002900*                                                                 00290001
003000* 2) WHEN A MESSAGE APPEARS, IF AN ERROR IS FOUND, THE            00300001
003100*    ENTIRE MESSAGE WILL BE PUT TO THE ERROR QUEUE.               00310001
003200*                                                                 00320001
003300* 3) WHEN A MESSAGE HAS BEEN PROCESSED, THE ITEM WILL BE          00330001
003400*    INSERTED TO THE TRAILER TRIP STATUS TABLE TSUOBTS.           00340001
003500*                                                                 00350001
003600* 4) EVERYTHING WILL GET INITIALIZED AND RESET - READY FOR THE    00360001
003700*    NEXT MESSAGE WHEN IT IS ENCOUNTERED.                         00370001
003800*                                                                 00380001
003900* UNITS OF WORK AND COMMITS:                                      00390001
004000* --------------------------                                      00400001
004100* A UNIT OF WORK FOR A DB2 COMMIT WILL BE COMPLETE WHEN A         00410001
004200* MESSAGE FOR A ITEM HAS BEEN READ FROM THE QUEUE,                00420001
004300* AND INSERTED OR DELETED TO THE TSOUBTS TABLE.                   00430001
004400* THE DB2 COMMIT IS PERFORMED.                                    00440001
004500* THEN AN MQ COMMIT WILL BE PERFORMED TO PERMANENTLY 'REMOVE' THE 00450001
004600* MESSAGES FROM THE ITEM QUEUE.                                   00460001
004700* MQ COMMITS ARE ALSO PERFORMED AFTER AN ERROR MESSAGE HAS BEEN   00470001
004800* WRITTEN TO THE ERROR QUEUE.                                     00480001
004900*                                                                 00490001
005000*                                                                 00500001
005100******************************************************************00510001
005200 ENVIRONMENT DIVISION.                                            00520001
005300******************************************************************00530001
005400                                                                  00540001
005500 CONFIGURATION SECTION.                                           00550001
005600                                                                  00560001
005700 SOURCE-COMPUTER.        IBM-3090.                                00570001
005800 OBJECT-COMPUTER.        IBM-3090.                                00580001
005900                                                                  00590001
006400******************************************************************00640001
006500 DATA DIVISION.                                                   00650001
006600******************************************************************00660001
007000******************************************************************00700001
007100 WORKING-STORAGE SECTION.                                         00710001
007200******************************************************************00720001
007300                                                                  00730001
007400******************************************************************00740001
007500*  COMMUNICATIONS AREA FOR DB2                                    00750001
007600******************************************************************00760001
007700     EXEC SQL                                                     00770001
007800          INCLUDE SQLCA                                           00780001
007900     END-EXEC.                                                    00790001
008000                                                                  00800001
008100******************************************************************00810001
008300* * *  (WSV_CNSMR_QUE)         CONSUMER QUEUE INFO (GET/READ)     00830004
008500     EXEC SQL                                                     00850001
008600          INCLUDE WSV00006                                        00860001
008700     END-EXEC.                                                    00870001
008800                                                                  00880001
009100* * *  (WSV_PRVDR_QUE)         PROVIDER QUEUE INFO (PUT/WRITE)    00910004
009300     EXEC SQL                                                     00930001
009400          INCLUDE WSV00005                                        00940001
009500     END-EXEC.                                                    00950001
009600                                                                  00960001
009610* * * WST_INTGRTN_TYP VIEW                                        00961004
009620     EXEC SQL                                                     00962004
009630         INCLUDE WST00008                                         00963004
009640     END-EXEC.                                                    00964004
009641                                                                  00964104
009650* * * WST_ATTR_DEFN VIEW                                          00965004
009660     EXEC SQL                                                     00966004
009670         INCLUDE WST00009                                         00967004
009680     END-EXEC.                                                    00968004
009681                                                                  00968104
009690* * * WST_ATTR_ELEM VIEW                                          00969004
009691     EXEC SQL                                                     00969104
009692         INCLUDE WST00010                                         00969204
009693     END-EXEC.                                                    00969305
009694* * * TRIP STATUS TABLE                                           00969449
009695     EXEC SQL                                                     00969549
009696         INCLUDE TTRIPST                                          00969649
009697     END-EXEC.                                                    00969749
009698* * * WST_SHPMT_XREF_HDR VIEW                                     00969850
009699     EXEC SQL                                                     00969950
009700         INCLUDE WST00001                                         00970050
009701     END-EXEC.                                                    00970150
009702                                                                  00970249
009710******************************************************************00971001
009800* INPUT LAYOUT - RECEIPT PIX TRANSACTIONS FROM WMOS               00980001
009900******************************************************************00990001
010000     COPY WSRD014.                                                01000001
010100                                                                  01010001
010200******************************************************************01020001
010300* OUTPUT LAYOUT - ERROR RECORD FOR RECEIPT PIX TRAN WMS PROCESS   01030001
010400******************************************************************01040001
010500     COPY WSRD020.                                                01050001
010600                                                                  01060001
010700******************************************************************01070001
010800* CALLED MODULES RECORD LAYOUT                                    01080001
010900******************************************************************01090001
011000     COPY WSWS007.                                                01100001
011100                                                                  01110001
011200******************************************************************01120001
011300*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                     01130001
011400******************************************************************01140001
011500     COPY DPWS004.                                                01150001
011600                                                                  01160001
011601******************************************************************01160101
011610*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       01161001
011611******************************************************************01161101
011620     COPY DPWS013.                                                01162001
011630                                                                  01163001
011640                                                                  01164001
011700 01  PA-PROGRAM-ACCUMULATORS.                                     01170001
011800     05  PA-TOTALS.                                               01180001
011900         10 PA-TOTAL-GETS             PIC S9(09) VALUE +0 COMP-3. 01190001
012000         10 PA-TOTAL-ERRORQ-RECS      PIC S9(09) VALUE +0 COMP-3. 01200001
012100         10 PA-TOTAL-MQ-COMMITS       PIC S9(09) VALUE +0 COMP-3. 01210001
012200                                                                  01220001
012300 01  PS-PROGRAM-SWITCHES.                                         01230001
012400     05  PS-GOOD-MSG-SW                PIC  X(01)    VALUE 'N'.   01240001
012500         88  PS-GOOD-MSG-YES                         VALUE 'Y'.   01250001
012600         88  PS-GOOD-MSG-NO                          VALUE 'N'.   01260001
012700     05  PS-TIME-TO-END-PROGRAM-SW     PIC  X(01)    VALUE 'N'.   01270001
012800         88  PS-TIME-TO-END-PROGRAM-YES              VALUE 'Y'.   01280001
012900         88  PS-TIME-TO-END-PROGRAM-NO               VALUE 'N'.   01290001
013000     05  PS-END-OF-MSG-SW              PIC  X(01)    VALUE 'N'.   01300001
013100         88  PS-END-OF-MSG-YES                       VALUE 'Y'.   01310001
013200         88  PS-END-OF-MSG-NO                        VALUE 'N'.   01320001
013300     05  PS-ERROR-SW                   PIC  X(01)    VALUE 'N'.   01330001
013400         88  PS-ERROR-YES                            VALUE 'Y'.   01340001
013500         88  PS-ERROR-NO                             VALUE 'N'.   01350001
013600     05  PS-ERROR-QUEUE-IS-OPEN-SW     PIC  X(01)    VALUE 'N'.   01360001
013700         88  PS-ERROR-QUEUE-IS-OPEN-YES              VALUE 'Y'.   01370001
013800         88  PS-ERROR-QUEUE-IS-OPEN-NO               VALUE 'N'.   01380001
013810     05  PS-CICS-SWITCH-IND          PIC X(01)  VALUE 'N'.        01381003
013820         88  PS-CICS-SWITCH-NO                  VALUE 'N'.        01382003
013830         88  PS-CICS-SWITCH-YES                 VALUE 'Y'.        01383003
013840     05  PS-TRIP-ARRIVED-SW          PIC X(01)  VALUE 'N'.        01384047
013850         88  PS-TRIP-ARRIVED-YES                VALUE 'Y'.        01385047
013860         88  PS-TRIP-ARRIVED-NO                 VALUE 'N'.        01386047
013900                                                                  01390001
014000 01  PC-PROGRAM-CONSTANTS.                                        01400001
014100     05  PC-MAX-RETRIES             PIC S9(03) VALUE +5 COMP-3.   01410001
014200     05  PC-CURRENT-PROGRAM-NAME    PIC X(08)  VALUE 'WSKCS307'.  01420009
014300     05  PC-TRLR-CHECKIN-MOD        PIC X(08)  VALUE 'WSKCS308'.  01430009
014400     05  PC-CASE-RECEIPT-MOD        PIC X(08)  VALUE 'WSKCS309'.  01440009
014500     05  PC-VERIFY-SHPMT-MOD        PIC X(08)  VALUE 'WSKCS310'.  01450009
014501* JAK 08/2007 - CHG ASJUST TO ADJUST                              01450146
014510     05  PC-STORE-UNIT-ADJUST       PIC X(08)  VALUE 'WSKCS317'.  01451043
014600     05  PC-MQPUT-RETRY-COUNTER     PIC 9(3)   VALUE ZERO.        01460001
014700                                                                  01470001
014800 01  DK-DB2-KEYS.                                                 01480001
014900     05  DK-INTRGTN-TYP-CDE         PIC X(10)  VALUE SPACES.      01490001
015000     05  DK-APPL-FUNC-DESC          PIC X(10)  VALUE SPACES.      01500001
015010     05  DK-SHIPT-ID                PIC X(20).                    01501047
015100                                                                  01510001
015200 01  PV-PROGRAM-VARIABLES.                                        01520001
015300     05  PV-RETRY-COUNTER           PIC S9(04) VALUE +0 COMP SYNC.01530001
015400     05  PV-ITEM-COUNTER            PIC S9(04) VALUE +0 COMP SYNC.01540001
015500     05  PV-PARAGRAPH               PIC X(48)  VALUE SPACES.      01550001
015600     05  PV-MSG-LENGTH              PIC S9(9)  BINARY.            01560001
015700     05  PV-DATA-LENGTH             PIC S9(9) BINARY.             01570001
015800     05  PV-HOLD-COMPLETION-CODE    PIC S9(9)  BINARY.            01580001
015900     05  PV-HOLD-REASON             PIC S9(9)  BINARY.            01590001
016000     05  PV-CALLED-MODULE           PIC X(08)  VALUE SPACES.      01600001
016100     05  PV-DISPLAY-SQL             PIC -Z(08)9.                  01610002
016110     05  PV-DISPLAY-CNT             PIC Z(08)9.                   01611002
016111     05  PV-DISPLAY-CDE             PIC 9(04).                    01611108
016120     05  PV-SQL-RETURN-CD           PIC -9(04).                   01612017
016121     05  PV-TASK-NBR                PIC  9(07).                   01612117
016130                                                                  01613006
016140     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01614006
016150                                                     COMP SYNC.   01615006
016160     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     01616006
016170                                                     COMP SYNC.   01617006
016180     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 01618006
016190     05  PV-SYSID                        PIC X(4).                01619012
016200                                                                  01620001
016300*PV-MSG IS THE INPUT MESSAGE                                      01630001
016400 01  PV-MSG                         PIC X(450).                   01640001
016500                                                                  01650001
016600 01  PV-ABEND-VARIABLES.                                          01660001
016700     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.01670001
016800     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01680001
016900     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01690001
017000     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01700001
017100     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01710001
017200     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01720001
017300     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01730001
017400     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01740001
017500     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 01750001
017600     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 01760001
017700     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01770001
017800     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 01780001
017900     88  ABEND-4020-MQ-ERROR                         VALUE +4020. 01790001
018000     88  ABEND-4444-FORCED-ABEND                     VALUE +4444. 01800001
018100                                                                  01810001
018200 01  PE-MQ-ABEND-VARIABLES.                                       01820001
018300     10  PE-MQ-QMANAGER             PIC X(05) VALUE SPACES.       01830001
018400     10  PE-MQ-QNAME                PIC X(30) VALUE SPACES.       01840001
018500     10  PE-MQ-COMPLETION-CODE      PIC 9(04) VALUE ZEROS.        01850001
018600     10  PE-MQ-REASON-CODE          PIC 9(04) VALUE ZEROS.        01860001
018700                                                                  01870001
018800****************************************************************  01880001
018900**     M Q   S E R I E S    W O R K I N G   S T O R A G E     *   01890001
019000**                  M  Q    C O P Y B O O K S                     01900001
019100****************************************************************  01910001
019200 01  MQM-OBJECT-DESCRIPTOR.                                       01920001
019300     COPY CMQODV.                                                 01930001
019400                                                                  01940001
019500 01  MQM-MESSAGE-DESCRIPTOR.                                      01950001
019600     COPY CMQMDV.                                                 01960001
019700                                                                  01970001
019800 01  MQM-GET-MESSAGE-OPTIONS.                                     01980001
019900     COPY CMQGMOV.                                                01990001
020000                                                                  02000001
020100 01  MQM-PUT-MESSAGE-OPTIONS.                                     02010001
020200     COPY CMQPMOV.                                                02020001
020300                                                                  02030001
020400 01  MQM-CONSTANTS.                                               02040001
020500     COPY CMQV.                                                   02050001
020600                                                                  02060001
020700** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS PUT AND    **  02070001
020800*  OPEN, CONNECT, DISCONNECT.                                     02080001
020900****************************************************************  02090001
021000 01  MQ-WORKING-STORAGE.                                          02100001
021100     05  PC-MQCONN                PIC X(08)   VALUE 'CSQCCONN'.   02110011
021200     05  PC-MQOPEN                PIC X(08)   VALUE 'CSQCOPEN'.   02120011
021300     05  PC-MQINQ                 PIC X(08)   VALUE 'CSQCINQ'.    02130011
021400     05  PC-MQPUT                 PIC X(8)    VALUE 'CSQCPUT'.    02140011
021500     05  PC-MQGET                 PIC X(08)   VALUE 'CSQCGET'.    02150011
021600     05  PC-MQCMIT                PIC X(8)    VALUE 'CSQCCOMM'.   02160011
021700     05  PC-MQBACK                PIC X(8)    VALUE 'CSQCBACK'.   02170011
021800     05  PC-MQCLOSE               PIC X(08)   VALUE 'CSQCCLOS'.   02180011
021900     05  PC-MQDISC                PIC X(08)   VALUE 'CSQCDISC'.   02190011
023000                                                                  02300001
023100****************************************************************  02310001
023200** QUEUE MANAGER HANDLE                                           02320001
023300*  QUEUE HANDLES                                                  02330001
023400****************************************************************  02340001
023500 01 PV-MQ-PROGRAM-HANDLES.                                        02350001
023600     05  PV-QMGR-NAME                 PIC X(48).                  02360001
023700     05  PV-HCONN                     PIC S9(9) BINARY VALUE 0.   02370001
023800     05  PV-GQ-HANDLE                 PIC S9(9) BINARY VALUE 0.   02380001
023900     05  PV-PQ-HANDLE                 PIC S9(9) BINARY VALUE 0.   02390001
023910     05  PV-EQ-HANDLE                 PIC S9(9) BINARY VALUE 0.   02391027
024000     05  PV-QUE-NM-INPUT            PIC X(50)  VALUE SPACES.      02400001
024100     05  PV-QUE-NM-OUTPUT           PIC X(50)  VALUE SPACES.      02410001
024200****************************************************************  02420001
024300*                                                                 02430001
024400* ERROR PROCESSING VARIABLES                                      02440001
024500* CODES FROM CALLS ARE STORED HERE                                02450001
024600****************************************************************  02460001
024700 01 PV-MQ-PROGRAM-VARIABLES.                                      02470001
024800     05  PV-COMPLETION-CODE           PIC S9(9) BINARY.           02480001
024900     05  PV-REASON                    PIC S9(9) BINARY.           02490001
025000     05  PV-CON-REASON                PIC S9(9) BINARY.           02500001
025100     05  PV-ERROR-MESSAGE             PIC X(48) VALUE SPACES.     02510001
025200     05  PV-OPEN-OPTIONS              PIC S9(9) BINARY.           02520001
025300     05  PV-MSGBUFFER                 PIC X(203) VALUE SPACES.    02530001
025400     05  PV-ERRMSGBUF                 PIC X(226) VALUE SPACES.    02540001
025500     05  PV-MQCHECK                   PIC X(8)  VALUE 'MQR2C'.    02550001
025600     05  PV-MQ-REASON-TEXT            PIC X(30) VALUE SPACES.     02560001
025700                                                                  02570001
025800****************************************************************  02580001
025900**                     E N D   O F   M Q                          02590001
026000****************************************************************  02600001
026100                                                                  02610001
026110****************************************************************  02611001
026120 LINKAGE SECTION.                                                 02612001
026130                                                                  02613001
026140 01  DFHCOMMAREA.                                                 02614001
026150     05  FILLER                       OCCURS  1 TO 4072 TIMES     02615001
026160                                      DEPENDING ON EIBCALEN.      02616001
026170         10 FILLER                    PIC X.                      02617001
026180                                                                  02618001
026190****************************************************************  02619001
026200****************************************************************  02620001
026300 PROCEDURE DIVISION.                                              02630001
026400******************************************************************02640001
026500 0000-PROGRAM-MAINLINE.                                           02650001
026700                                                                  02670001
026800*INIT VARIBLES, SET SWITHCES.                                     02680001
026900     PERFORM 1000-INITIALIZE.                                     02690001
027000     PERFORM 1200-GET-INPUT-QUEUE-INFO.                           02700001
027100     PERFORM 1250-GET-OUTPUT-QUEUE-INFO.                          02710001
027200                                                                  02720001
027300*CONNECT TO QUEUE MANAGER.                                        02730001
027400     PERFORM 3100-MQ-CONNECT-TO-QMGR.                             02740001
027500                                                                  02750001
027600*OPEN THE QUEUE FOR GETS.                                         02760001
027700     PERFORM 3200-MQ-QUEUE-OPEN.                                  02770001
027800                                                                  02780001
027900*GET FIRST MSG FROM QUEUE.                                        02790001
028000     PERFORM 3300-MQ-GET-MSG.                                     02800001
028100                                                                  02810001
028101*IF THERE ARE NO MESSAGES IN THE QUEUE, AND THE WAIT TIME HAS     02810125
028102*EXPIRED, THEN SHUT DOWN THE PROGRAM.                             02810223
028103     IF PS-TIME-TO-END-PROGRAM-YES                                02810323
028110         PERFORM 5000-END-RUN-ROUTINE                             02811023
028120     END-IF.                                                      02812023
028130                                                                  02813023
028200*PROCESS THE ITEM MESSAGES.                                       02820001
028300     PERFORM 2000-PROCESS-MSGS                                    02830001
028400         UNTIL PS-TIME-TO-END-PROGRAM-YES.                        02840001
028401                                                                  02840138
028410     PERFORM 5000-END-RUN-ROUTINE.                                02841035
028500                                                                  02850001
028600******************************************************************02860001
028700* INITIALIZE VARIABLES.                                           02870001
028800* SET SWITCHES.                                                   02880001
028900******************************************************************02890001
029000 1000-INITIALIZE.                                                 02900001
029100                                                                  02910001
029200     INITIALIZE                                                   02920001
029300                  PA-TOTAL-GETS                                   02930001
029400                  PA-TOTAL-MQ-COMMITS                             02940001
029500                  PV-MSG-LENGTH                                   02950001
029600                  PV-DATA-LENGTH.                                 02960001
029700                                                                  02970001
029800*INIT SWITCHES USED FOR EDITING EACH MSG, CONTINUING RUN OF       02980001
029900*PROGRAM AND OPENING OF THE ERROR QUEUE. ERROR QUEUE IS           02990001
030000*ONLY OPENED IF ERROR IS ENCOUNTERED, AND THEN REMAINS OPEN.      03000001
030010                                                                  03001001
030100     SET PS-TIME-TO-END-PROGRAM-NO                                03010001
030200         PS-ERROR-QUEUE-IS-OPEN-NO  TO TRUE.                      03020001
030300                                                                  03030001
030311     PERFORM 1100-CICS-LOGGING.                                   03031101
030320                                                                  03032001
030321     EXEC CICS ASSIGN                                             03032112
030322         SYSID (PV-SYSID)                                         03032212
030323     END-EXEC.                                                    03032312
030324                                                                  03032412
030325     MOVE EIBTASKN                 TO PV-TASK-NBR.                03032517
030326                                                                  03032617
030327     IF PS-CICS-SWITCH-YES                                        03032712
030328         INITIALIZE PV-CICS-MSG-AREA                              03032817
030329         STRING   ' ' PV-TASK-NBR                                 03032917
030331                  ' WSKCS307-1000:'                               03033117
030332                  ' RUNNING IN SYSID=' PV-SYSID                   03033217
030333                   DELIMITED BY SIZE                              03033317
030334                                INTO PV-CICS-MSG-AREA             03033417
030335         PERFORM 7000-WRITE-TO-CICS-LOG                           03033517
030336     END-IF.                                                      03033617
030337                                                                  03033717
030340 1100-CICS-LOGGING.                                               03034001
030350* READ PARM TO DETERMINE CICS LOGGING                             03035001
030360                                                                  03036001
030370     EXEC SQL                                                     03037001
030380         SELECT  D.ATTR_ELEM_TXT                                  03038001
030390         INTO  :PS-CICS-SWITCH-IND                                03039001
030391         FROM   WST_INTGRTN_TYP A                                 03039101
030392              , WST_ATTR_DEFN   B                                 03039201
030393              , WST_ATTR_ELEM   C                                 03039301
030394              , WST_ATTR_ELEM   D                                 03039401
030395         WHERE  A.INTGRTN_TYP_CDE   = 'CSSLLOG'                   03039501
030396           AND  A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE           03039601
030397           AND  B.ATTR_DEFN_SEQ_NBR = 1                           03039701
030398           AND  B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE           03039801
030399           AND  C.ATTR_DEFN_SEQ_NBR = 1                           03039901
030400           AND  B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE           03040001
030401           AND  D.ATTR_DEFN_SEQ_NBR = 2                           03040101
030402           AND  C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR         03040201
030403           AND  C.ATTR_ELEM_TXT     = 'WSKCS307'                  03040301
030404     END-EXEC.                                                    03040401
030405                                                                  03040525
030406     EVALUATE TRUE                                                03040601
030407         WHEN SQLCODE = ZERO                                      03040701
030408             IF PS-CICS-SWITCH-YES                                03040801
030409                 INITIALIZE PV-CICS-MSG-AREA                      03040917
030410                 STRING   ' ' PV-TASK-NBR                         03041017
030417                          ' WSKCS307-1100:'                       03041717
030420                          ' CICS LOGGING TURNED ON'               03042001
030421                          DELIMITED BY SIZE                       03042101
030422                          INTO PV-CICS-MSG-AREA                   03042201
030423                 PERFORM 7000-WRITE-TO-CICS-LOG                   03042301
030424             END-IF                                               03042401
030425         WHEN SQLCODE = -904                                      03042501
030426         WHEN SQLCODE = -913                                      03042601
030427         WHEN SQLCODE = -911                                      03042701
030428         WHEN SQLCODE = -803                                      03042801
030429             CONTINUE                                             03042901
030430         WHEN SQLWARN0 NOT = SPACES                               03043001
030431         WHEN SQLCODE NOT = ZERO                                  03043101
030432             MOVE SQLCODE              TO PV-SQL-RETURN-CD        03043201
030433             INITIALIZE PV-CICS-MSG-AREA                          03043317
030434             STRING   ' ' PV-TASK-NBR                             03043417
030435                      ' WSKCS307-1100 ERROR:'                     03043517
030436                      ' SQL='                                     03043601
030437                      PV-SQL-RETURN-CD                            03043701
030438                      DELIMITED BY SIZE                           03043801
030439                      INTO PV-CICS-MSG-AREA                       03043901
030440             PERFORM 7000-WRITE-TO-CICS-LOG                       03044001
030441             MOVE '1100-CICS-LOGGING'  TO DP013-PARAGRAPH         03044101
030442             MOVE 'WST_INTGRTN_TYP'    TO                         03044201
030443                                       DP013-DB2-TABLE-NAME (1)   03044301
030444             MOVE 'WST_ATTR_DEFN'      TO                         03044401
030445                                       DP013-DB2-TABLE-NAME (2)   03044501
030446             MOVE 'WST_ATTR_ELEM'      TO                         03044601
030447                                       DP013-DB2-TABLE-NAME (3)   03044701
030448             MOVE SQLCA                TO DP013-SQLCA             03044801
030449             MOVE 'SELECT ATTR_ELEM_TXT'                          03044901
030450                                       TO DP013-MESSAGE-TEXT (1)  03045001
030451             SET DP013-DB2-ABEND  TO TRUE                         03045101
030452     END-EVALUATE.                                                03045201
030453                                                                  03045301
030454                                                                  03045401
030460******************************************************************03046001
030500 1200-GET-INPUT-QUEUE-INFO.                                       03050001
030600******************************************************************03060001
030700                                                                  03070001
030800* SELECT QUEUE MANAGER AND INPUT QUEUE NAME                       03080001
030900                                                                  03090001
031000     MOVE 'PIXRC'            TO DK-INTRGTN-TYP-CDE.               03100001
031100     MOVE 'PIXLEGACYQ'       TO DK-APPL-FUNC-DESC.                03110001
031200                                                                  03120001
031300     EXEC SQL                                                     03130001
031400         SELECT                                                   03140001
031500               QUE_MGR,                                           03150001
031600               QUE_NM                                             03160001
031700         INTO                                                     03170001
031800              :WSV00006-QUE-MGR,                                  03180001
031900              :WSV00006-QUE-NM                                    03190001
032000         FROM WSV_CNSMR_QUE                                       03200001
032100         WHERE INTGRTN_TYP_CDE = :DK-INTRGTN-TYP-CDE              03210001
032200         AND   APPL_FUNC_DESC  = :DK-APPL-FUNC-DESC               03220001
032300     END-EXEC.                                                    03230001
032400                                                                  03240001
032500     EVALUATE TRUE                                                03250001
032600         WHEN SQLCODE = +0                                        03260001
032700             MOVE WSV00006-QUE-MGR-TEXT TO PV-QMGR-NAME           03270001
032800             MOVE WSV00006-QUE-NM-TEXT  TO PV-QUE-NM-INPUT        03280001
032810             IF PS-CICS-SWITCH-YES                                03281001
032811                 INITIALIZE PV-CICS-MSG-AREA                      03281117
032812                 STRING   ' ' PV-TASK-NBR                         03281217
032820                          ' WSKCS307-1200:'                       03282017
032830                          ' QUE MGR=' PV-QMGR-NAME                03283001
032831                          ' INPUT QUE=' PV-QUE-NM-INPUT           03283101
032840                          DELIMITED BY SIZE                       03284001
032850                          INTO PV-CICS-MSG-AREA                   03285001
032860                 PERFORM 7000-WRITE-TO-CICS-LOG                   03286001
032870             END-IF                                               03287001
032900                                                                  03290001
033000         WHEN SQLCODE = +100                                      03300001
033100         WHEN SQLWARN0 NOT = SPACES                               03310001
033200         WHEN SQLCODE  NOT = ZERO                                 03320001
033201             MOVE SQLCODE              TO PV-SQL-RETURN-CD        03320101
033202             INITIALIZE PV-CICS-MSG-AREA                          03320217
033203             STRING   ' ' PV-TASK-NBR                             03320317
033204                      ' WSKCS307-1200 ERROR:'                     03320417
033205                      ' SQL='                                     03320501
033206                      PV-SQL-RETURN-CD                            03320601
033207                      DELIMITED BY SIZE                           03320701
033208                      INTO PV-CICS-MSG-AREA                       03320801
033209             PERFORM 7000-WRITE-TO-CICS-LOG                       03320901
033210             MOVE '1200-GET-INPUT-QUEUE-INFO' TO DP013-PARAGRAPH  03321001
033211             MOVE 'WSV_CNSMR_QUE'      TO                         03321101
033212                                       DP013-DB2-TABLE-NAME (1)   03321201
033218             MOVE SQLCA                TO DP013-SQLCA             03321801
033219             MOVE 'SELECT INPUT QUEUE NAME'                       03321901
033220                                       TO DP013-MESSAGE-TEXT (1)  03322001
033221             SET DP013-DB2-ABEND  TO TRUE                         03322101
033294             PERFORM 9999-ABEND                                   03329401
034100     END-EVALUATE.                                                03410001
034200                                                                  03420001
034300******************************************************************03430001
034400                                                                  03440001
034500******************************************************************03450001
034600 1250-GET-OUTPUT-QUEUE-INFO.                                      03460001
034700******************************************************************03470001
034800                                                                  03480001
034900* SELECT OUTPUT QUEUE NAME                                        03490001
035000                                                                  03500001
035100     MOVE 'PIXLGCYERR'       TO DK-INTRGTN-TYP-CDE.               03510001
035200     MOVE 'PIXLEGACYQ'       TO DK-APPL-FUNC-DESC.                03520001
035300                                                                  03530001
035400     EXEC SQL                                                     03540001
035500         SELECT                                                   03550001
035600               QUE_NM                                             03560001
035700         INTO                                                     03570001
035800              :WSV00005-QUE-NM                                    03580001
035900         FROM WSV_PRVDR_QUE                                       03590001
036000         WHERE INTGRTN_TYP_CDE = :DK-INTRGTN-TYP-CDE              03600001
036100         AND   APPL_FUNC_DESC  = :DK-APPL-FUNC-DESC               03610001
036200     END-EXEC.                                                    03620001
036300                                                                  03630001
036400     EVALUATE TRUE                                                03640001
036500         WHEN SQLCODE = +0                                        03650001
036600             MOVE WSV00005-QUE-NM-TEXT  TO PV-QUE-NM-OUTPUT       03660001
036610             IF PS-CICS-SWITCH-YES                                03661001
036611                 INITIALIZE PV-CICS-MSG-AREA                      03661117
036612                 STRING   ' ' PV-TASK-NBR                         03661217
036620                          ' WSKCS307-1250:'                       03662017
036640                          ' OUTPUT QUE=' PV-QUE-NM-OUTPUT         03664001
036650                          DELIMITED BY SIZE                       03665001
036660                          INTO PV-CICS-MSG-AREA                   03666001
036670                 PERFORM 7000-WRITE-TO-CICS-LOG                   03667001
036680             END-IF                                               03668001
036700                                                                  03670001
036800         WHEN SQLCODE = +100                                      03680001
036900         WHEN SQLWARN0 NOT = SPACES                               03690001
037000         WHEN SQLCODE  NOT = ZERO                                 03700001
037001             MOVE SQLCODE              TO PV-SQL-RETURN-CD        03700101
037002             INITIALIZE PV-CICS-MSG-AREA                          03700217
037003             STRING   ' ' PV-TASK-NBR                             03700317
037004                      ' WSKCS307-1250 ERROR:'                     03700417
037005                      ' SQL='                                     03700501
037006                      PV-SQL-RETURN-CD                            03700601
037007                      DELIMITED BY SIZE                           03700701
037008                      INTO PV-CICS-MSG-AREA                       03700801
037009             PERFORM 7000-WRITE-TO-CICS-LOG                       03700901
037010             MOVE '1250-GET-OUTPUT-QUEUE-INFO' TO DP013-PARAGRAPH 03701001
037011             MOVE 'WSV_PRVDR_QUE'      TO                         03701101
037012                                       DP013-DB2-TABLE-NAME (1)   03701201
037013             MOVE SQLCA                TO DP013-SQLCA             03701301
037014             MOVE 'SELECT OUTPUT QUEUE NAME'                      03701401
037015                                       TO DP013-MESSAGE-TEXT (1)  03701501
037016             SET DP013-DB2-ABEND  TO TRUE                         03701601
037017             PERFORM 9999-ABEND                                   03701701
037900     END-EVALUATE.                                                03790001
038000                                                                  03800001
038100******************************************************************03810001
038200                                                                  03820001
038300******************************************************************03830001
038400* BREAKDOWN AND EDIT A MSG.                                       03840001
038500* CALL MODULE -OR- PUT A MSG IN ERROR TO ERROR QUEUE.             03850001
038600* GET THE NEXT MSG.                                               03860001
038700******************************************************************03870001
038800 2000-PROCESS-MSGS.                                               03880001
038900                                                                  03890001
039410     IF PS-CICS-SWITCH-YES                                        03941009
039411         INITIALIZE PV-CICS-MSG-AREA                              03941117
039412         STRING   ' ' PV-TASK-NBR                                 03941217
039420                  ' WSKCS307-2000:'                               03942017
039430                  ' TRANS TYPE CODE=' WS014-TRANS-TYPE-CODE       03943009
039440                    DELIMITED BY SIZE                             03944009
039450                                     INTO PV-CICS-MSG-AREA        03945009
039460         PERFORM 7000-WRITE-TO-CICS-LOG                           03946009
039461         INITIALIZE PV-CICS-MSG-AREA                              03946117
039462         STRING   ' ' PV-TASK-NBR                                 03946217
039463                  ' WSKCS307-2000:'                               03946317
039464                  ' RCVNG TRANS TYP=' WS014-RCVNG-TRANS-TYPE      03946409
039465                    DELIMITED BY SIZE                             03946509
039466                                     INTO PV-CICS-MSG-AREA        03946609
039467         INITIALIZE PV-CICS-MSG-AREA                              03946717
039468         STRING   ' ' PV-TASK-NBR                                 03946817
039469                  ' WSKCS307-2000:'                               03946917
039470                  ' CASE NUMBER=' WS014-CASE-NUMBER               03947009
039471                    DELIMITED BY SIZE                             03947109
039472                                     INTO PV-CICS-MSG-AREA        03947209
039473         PERFORM 7000-WRITE-TO-CICS-LOG                           03947309
039480     END-IF.                                                      03948009
039500                                                                  03950001
039600     INITIALIZE WS007-RECEIPT-PIX-RECORD.                         03960001
039700     MOVE WS014-RECEIPT-PIX-RECORD TO WS007-WSRD014-RECORD.       03970001
039800     MOVE PC-CURRENT-PROGRAM-NAME  TO WS007-CALLING-PROGRAM-NAME. 03980001
039810     MOVE PV-TASK-NBR              TO WS007-SRC-TASK-NUMBER.      03981017
039900                                                                  03990001
040000     EVALUATE TRUE                                                04000001
040100         WHEN WS014-TRLR-CHECK-IN                                 04010001
040200* CALL TRAILER CHECK IN MODULE - WSKCS308                         04020009
040300             MOVE PC-TRLR-CHECKIN-MOD TO PV-CALLED-MODULE         04030001
040400             PERFORM 3000-CALL-MODULE                             04040018
040500         WHEN WS014-CASE-RECEIPT                                  04050001
040600* CALL CASE RECEIPT MODULE - WSCKS309                             04060009
040700             MOVE PC-CASE-RECEIPT-MOD TO PV-CALLED-MODULE         04070001
040800             PERFORM 3000-CALL-MODULE                             04080001
040900         WHEN WS014-VERIFY-SHIPMT                                 04090001
040910**GB/SH 9/18/07 FIRST CHECKED THAT SHIPMENT HAS BEEN ARRIVED      04091055
040920             PERFORM 2100-CHECK-TRIP-STATUS                       04092047
040930             IF PS-TRIP-ARRIVED-NO                                04093047
040931                MOVE 'CI' TO WS014-RCVNG-TRANS-TYPE               04093147
040932                MOVE WS014-RECEIPT-PIX-RECORD                     04093251
040933                          TO WS007-WSRD014-RECORD                 04093347
040940                MOVE PC-TRLR-CHECKIN-MOD TO PV-CALLED-MODULE      04094047
041000* CALL THE TRAILER MAINT.MOD TO ARRIVE TRAILER - WSKCS308         04094155
040950                PERFORM 3000-CALL-MODULE                          04095054
040951                IF WS007-SUCCESSFUL                               04095147
040952                   MOVE 'VS' TO WS014-RCVNG-TRANS-TYPE            04095247
040953                   MOVE WS014-RECEIPT-PIX-RECORD TO               04095347
040954                                         WS007-WSRD014-RECORD     04095447
040955                END-IF                                            04095547
040960             END-IF                                               04096047
041000* CALL VERIFY SHIPMENT MODULE - WSKCS310                          04100009
041010             IF WS007-SUCCESSFUL                                  04101047
041100                MOVE PC-VERIFY-SHPMT-MOD TO PV-CALLED-MODULE      04110047
041200                PERFORM 3000-CALL-MODULE                          04120047
041210             END-IF                                               04121047
041300* THEN CALL TRAILER CHECK IN MODULE TO UNLOAD TRAILER- WSKCS308   04130055
041400             IF WS007-SUCCESSFUL                                  04140040
041500                 MOVE PC-TRLR-CHECKIN-MOD TO PV-CALLED-MODULE     04150040
041600                 PERFORM 3000-CALL-MODULE                         04160056
041700             END-IF                                               04170040
041800* JAK 08/2007 CHANGE FROM VERIFY-SHPMT TO CASE-ADJUSTMT           04180043
041801*        WHEN WS014-VERIFY-SHIPMT                                 04180147
041810         WHEN WS014-CASE-ADJUSTMT                                 04181043
041900* CALL STORE UNIT ADJUSTMENT MODULE WSKCS317                      04190042
042000             MOVE PC-STORE-UNIT-ADJUST TO PV-CALLED-MODULE        04200043
042100             PERFORM 3000-CALL-MODULE                             04210042
042200         WHEN OTHER                                               04220001
042300             SET PS-ERROR-YES      TO TRUE                        04230001
042400             SET WS020-INVALID-REC TO TRUE                        04240001
042500             MOVE '2000-'          TO WS020-ERROR-PARA-NBR        04250001
042600             MOVE 0                TO WS020-SQLCODE               04260001
042601* JAK 08/2007 - LOAD PROGRAM NAME                                 04260143
042602             MOVE PC-CURRENT-PROGRAM-NAME                         04260243
042603                                   TO WS020-ERROR-PGM-NAME        04260345
042610             IF PS-CICS-SWITCH-YES                                04261016
042611                 INITIALIZE PV-CICS-MSG-AREA                      04261117
042612                 STRING   ' ' PV-TASK-NBR                         04261217
042620                          ' WSKCS307-2000:'                       04262017
042630                          ' INVALID TRANS TYPE CODE='             04263016
042631                          WS014-TRANS-TYPE-CODE                   04263116
042640                          DELIMITED BY SIZE                       04264016
042650                                     INTO PV-CICS-MSG-AREA        04265016
042660                 PERFORM 7000-WRITE-TO-CICS-LOG                   04266016
042670             END-IF                                               04267016
042700                                                                  04270001
042800     END-EVALUATE.                                                04280001
042930                                                                  04293041
043000*IF NO ERRORS, JUST CONTINUE,                                     04300001
043100*ELSE REINIT AND RESET SWITCHES AND GO AFTER THE NEXT MSG         04310001
043200*(NEW ITEM) ON THE QUEUE.                                         04320001
043300     IF PS-ERROR-YES                                              04330001
043400        PERFORM 7100-ERROR-ROUTINE                                04340001
043500        PERFORM 3800-PUT-MSG-TO-ERROR-Q                           04350001
043600        PERFORM 3600-MQ-COMMIT                                    04360029
043700     END-IF.                                                      04370001
043800                                                                  04380001
043900     INITIALIZE PV-MSG                                            04390001
044000                PV-MSGBUFFER                                      04400001
044100                PV-ERRMSGBUF.                                     04410001
044200                                                                  04420001
044300*GET NEXT MESSAGE FROM QUEUE.                                     04430001
044310     IF PS-TIME-TO-END-PROGRAM-NO                                 04431032
044400        SET PS-ERROR-NO TO TRUE                                   04440032
044500        PERFORM 3300-MQ-GET-MSG                                   04450032
044600     END-IF.                                                      04460032
044700                                                                  04470001
044710 2100-CHECK-TRIP-STATUS.                                          04471047
044711                                                                  04471147
044712     MOVE WS014-ORIG-SHIPMT-NBR      TO DK-SHIPT-ID.              04471247
044713                                                                  04471347
044720     EXEC SQL                                                     04472047
044730         SELECT TRIP_STATUS_CDE                                   04473047
044731         INTO  :TRIPST-TRIP-STATUS-CDE                            04473148
044740         FROM WST_SHPMT_XREF_HDR  A                               04474047
044750            , TTRIPST B                                           04475047
044760         WHERE EXT_SHP_ID         = :DK-SHIPT-ID                  04476047
044770         AND   A.INTR_TRIP_ID     = B.TRIP_ID                     04477047
044780         AND   B.TRIP_STATUS_CDE  = 'AR'                          04478047
044793     END-EXEC.                                                    04479347
044794                                                                  04479447
044795     EVALUATE TRUE                                                04479547
044796         WHEN SQLCODE = +0                                        04479647
044797             SET PS-TRIP-ARRIVED-YES TO TRUE                      04479747
044810         WHEN SQLCODE = +100                                      04481047
044811             SET PS-TRIP-ARRIVED-NO  TO TRUE                      04481147
044812         WHEN SQLWARN0 NOT = SPACES                               04481247
044813         WHEN SQLCODE  NOT = ZERO                                 04481347
044814             MOVE SQLCODE              TO PV-SQL-RETURN-CD        04481447
044815             INITIALIZE PV-CICS-MSG-AREA                          04481547
044816             STRING   ' ' PV-TASK-NBR                             04481647
044817                      ' WSKCS307-2100 ERROR:'                     04481747
044818                      ' SQL='                                     04481847
044819                      PV-SQL-RETURN-CD                            04481947
044820                      DELIMITED BY SIZE                           04482047
044821                      INTO PV-CICS-MSG-AREA                       04482147
044822             PERFORM 7000-WRITE-TO-CICS-LOG                       04482247
044823             MOVE '2100-CHECK-TRIP-STATUS ' TO DP013-PARAGRAPH    04482347
044824             MOVE 'TTRIPST '      TO                              04482447
044825                                       DP013-DB2-TABLE-NAME (1)   04482547
044826             MOVE SQLCA                TO DP013-SQLCA             04482647
044827             MOVE 'SELECT TRIP STATUS OF ARRIVED '                04482747
044828                                       TO DP013-MESSAGE-TEXT (1)  04482847
044829             SET DP013-DB2-ABEND  TO TRUE                         04482947
044830             PERFORM 9999-ABEND                                   04483047
044831     END-EVALUATE.                                                04483147
044832                                                                  04483247
044840******************************************************************04484001
044900 3000-CALL-MODULE.                                                04490001
045000******************************************************************04500001
045100                                                                  04510001
045310     IF PS-CICS-SWITCH-YES                                        04531009
045311         INITIALIZE PV-CICS-MSG-AREA                              04531117
045312         STRING   ' ' PV-TASK-NBR                                 04531217
045320                  ' WSKCS307-3000:'                               04532017
045330                  ' CALLING PROGRAM=' PV-CALLED-MODULE            04533009
045340                    DELIMITED BY SIZE                             04534009
045350                                     INTO PV-CICS-MSG-AREA        04535009
045360         PERFORM 7000-WRITE-TO-CICS-LOG                           04536009
045397     END-IF.                                                      04539709
045398                                                                  04539809
045500     MOVE LENGTH OF WS007-RECEIPT-PIX-RECORD                      04550014
045501                                  TO  PV-COMMAREA-LENGTH.         04550114
045510     EXEC CICS                                                    04551014
045520         LINK PROGRAM  (PV-CALLED-MODULE)                         04552014
045530              COMMAREA (WS007-RECEIPT-PIX-RECORD)                 04553014
045540              LENGTH   (PV-COMMAREA-LENGTH)                       04554014
045550     END-EXEC.                                                    04555014
045600                                                                  04560001
045680                                                                  04568009
046300     EVALUATE TRUE                                                04630010
046400         WHEN WS007-SUCCESSFUL                                    04640010
046401** COMMIT AFTER PROCESSING EACH MESSAGE GB 6/7/07                 04640141
046403             PERFORM 3600-MQ-COMMIT                               04640341
046410             IF PS-CICS-SWITCH-YES                                04641010
046411                 INITIALIZE PV-CICS-MSG-AREA                      04641117
046412                 STRING   ' ' PV-TASK-NBR                         04641217
046420                          ' WSKCS307-3000:'                       04642017
046430                       ' RETURNED FROM PGM=' PV-CALLED-MODULE     04643009
046440                       DELIMITED BY SIZE                          04644009
046450                                     INTO PV-CICS-MSG-AREA        04645009
046460                 PERFORM 7000-WRITE-TO-CICS-LOG                   04646010
046461                 INITIALIZE PV-CICS-MSG-AREA                      04646117
046462                 STRING   ' ' PV-TASK-NBR                         04646217
046470                          ' WSKCS307-3000:'                       04647017
046480                       ' SUCCESS IND=' WS007-SUCCESS-IND          04648009
046490                       DELIMITED BY SIZE                          04649009
046491                                     INTO PV-CICS-MSG-AREA        04649109
046492                 PERFORM 7000-WRITE-TO-CICS-LOG                   04649210
046493             END-IF                                               04649310
046600         WHEN OTHER                                               04660010
046700             SET PS-ERROR-YES TO TRUE                             04670010
046701* JAK 08/2007 - LOAD WS020 FIELDS                                 04670143
046702             MOVE PV-CALLED-MODULE TO WS020-ERROR-PGM-NAME        04670245
046703             MOVE WS007-SQL-ERROR-PARA TO WS020-ERROR-PARA-NBR    04670343
046704             MOVE WS007-SQLCODE    TO WS020-SQLCODE               04670443
046712             IF WS007-INVALID-SQL                                 04671244
046713                 SET WS020-SQL-ERROR TO TRUE                      04671344
046714             ELSE                                                 04671444
046715                 MOVE WS007-SUCCESS-IND TO WS020-ERROR-TYPE-CDE   04671544
046716             END-IF                                               04671644
046718             IF PS-CICS-SWITCH-YES                                04671843
046719                 INITIALIZE PV-CICS-MSG-AREA                      04671943
046720                 STRING   ' ' PV-TASK-NBR                         04672043
046721                          ' WSKCS307-3000:'                       04672143
046722                          ' CALL NOT SUCCESSFUL'                  04672216
046723                          ' MESSAGE=' WS007-CRA-RET-MSG           04672316
046730                          DELIMITED BY SIZE                       04673016
046740                                     INTO PV-CICS-MSG-AREA        04674009
046750                 PERFORM 7000-WRITE-TO-CICS-LOG                   04675016
046751                 INITIALIZE PV-CICS-MSG-AREA                      04675117
046752                 STRING   ' ' PV-TASK-NBR                         04675217
046753                          ' WSKCS307-3000:'                       04675317
046754                          ' SUCCESS IND=' WS007-SUCCESS-IND       04675416
046755                          DELIMITED BY SIZE                       04675516
046756                                     INTO PV-CICS-MSG-AREA        04675609
046757                 PERFORM 7000-WRITE-TO-CICS-LOG                   04675716
046759                 MOVE WS007-SQLCODE  TO PV-DISPLAY-SQL            04675916
046760                 INITIALIZE PV-CICS-MSG-AREA                      04676017
046761                 STRING   ' ' PV-TASK-NBR                         04676117
046762                          ' WSKCS307-3000:'                       04676217
046770                          ' SQLCODE=' PV-DISPLAY-SQL              04677016
046780                          ' PARAGRAPH=' WS007-SQL-ERROR-PARA      04678016
046790                          DELIMITED BY SIZE                       04679016
046791                                     INTO PV-CICS-MSG-AREA        04679109
046792                 PERFORM 7000-WRITE-TO-CICS-LOG                   04679216
046793             END-IF                                               04679316
046800     END-EVALUATE.                                                04680010
046900                                                                  04690001
047000****************************************************************  04700001
047100**   B E G I N     M Q    S E R I E S     P A R A G R A P H S **  04710001
047200****************************************************************  04720001
047300                                                                  04730001
047400****************************************************************  04740001
047500** CONNECT TO THE QUEUE MANAGER                                   04750001
047600** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                 04760001
047700****************************************************************  04770001
047800 3100-MQ-CONNECT-TO-QMGR.                                         04780001
047900                                                                  04790001
048000     MOVE '3100-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.              04800001
048100*                                                                 04810001
048200* CONNECT TO THE QUEUE                                            04820001
048300                                                                  04830001
048400     CALL PC-MQCONN USING PV-QMGR-NAME                            04840001
048500                          PV-HCONN                                04850001
048600                          PV-COMPLETION-CODE                      04860001
048700                          PV-REASON.                              04870001
048800                                                                  04880001
048900*IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE AND EXIT         04890001
049000     MOVE PV-REASON TO PV-CON-REASON.                             04900001
049100     IF PV-COMPLETION-CODE = MQCC-OK THEN                         04910001
049210         IF PS-CICS-SWITCH-YES                                    04921001
049211             INITIALIZE PV-CICS-MSG-AREA                          04921117
049212             STRING   ' ' PV-TASK-NBR                             04921217
049213                      ' WSKCS307-3100:'                           04921317
049214                      ' CONNECTED TO QUE MGR='                    04921401
049230                      PV-QMGR-NAME                                04923001
049250                      DELIMITED BY SIZE                           04925001
049260                                 INTO PV-CICS-MSG-AREA            04926001
049270             PERFORM 7000-WRITE-TO-CICS-LOG                       04927001
049280         END-IF                                                   04928001
049300     ELSE                                                         04930001
049400         CALL PV-MQCHECK USING PV-REASON                          04940001
049500                               PV-MQ-REASON-TEXT                  04950001
049600         MOVE PV-QMGR-NAME         TO PE-MQ-QMANAGER              04960001
049700         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       04970001
049800         MOVE PV-REASON            TO PE-MQ-REASON-CODE           04980001
049900         MOVE 'CONNECT TO QMGR'    TO PV-ERROR-MESSAGE            04990001
050000         PERFORM 9200-MQ-ABEND                                    05000001
050010                                                                  05001001
050011         INITIALIZE PV-CICS-MSG-AREA                              05001117
050012         STRING   ' ' PV-TASK-NBR                                 05001217
050013                  ' WSKCS307-3100:'                               05001317
050014                  ' INVALID CONNECT TO QUE MGR'                   05001402
050015                  DELIMITED BY SIZE                               05001502
050016                                 INTO PV-CICS-MSG-AREA            05001602
050017         PERFORM 7000-WRITE-TO-CICS-LOG                           05001702
050020         MOVE '3100-MQ-CONNECT-TO-QMGR'                           05002001
050021                                   TO DP013-PARAGRAPH             05002101
050050         STRING ' DID NOT CONNECT TO QUE MGR '                    05005001
050060                PV-QMGR-NAME                                      05006001
050070                DELIMITED BY SIZE                                 05007001
050080                                 INTO DP013-MESSAGE-TEXT (1)      05008001
050090         SET DP013-DB2-ABEND       TO TRUE                        05009001
050091         PERFORM 9999-ABEND                                       05009101
050100     END-IF.                                                      05010001
050200                                                                  05020001
050300****************************************************************  05030001
050400** OPEN THE ITEM QUEUE FOR GETS.                                  05040001
050500****************************************************************  05050001
050600 3200-MQ-QUEUE-OPEN.                                              05060001
050700                                                                  05070001
050800     MOVE '3200-MQ-QUEUE-OPEN'     TO PV-PARAGRAPH.               05080001
050900*                                                                 05090001
051000     MOVE PV-QUE-NM-INPUT          TO MQOD-OBJECTNAME.            05100025
051100     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        05110001
051200                                                                  05120001
051300     COMPUTE PV-OPEN-OPTIONS       = MQOO-INPUT-SHARED            05130001
051400                                   + MQOO-OUTPUT                  05140001
051500                                   + MQOO-SET-IDENTITY-CONTEXT    05150001
051600                                   + MQOO-FAIL-IF-QUIESCING.      05160001
051700                                                                  05170001
051800     CALL PC-MQOPEN USING PV-HCONN                                05180001
051900                          MQM-OBJECT-DESCRIPTOR                   05190001
052000                          PV-OPEN-OPTIONS                         05200001
052100                          PV-GQ-HANDLE                            05210001
052200                          PV-COMPLETION-CODE                      05220001
052300                          PV-REASON.                              05230001
052400                                                                  05240001
052500     IF PV-COMPLETION-CODE = MQCC-OK THEN                         05250001
052610         IF PS-CICS-SWITCH-YES                                    05261001
052611             INITIALIZE PV-CICS-MSG-AREA                          05261117
052612             STRING   ' ' PV-TASK-NBR                             05261217
052620                      ' WSKCS307-3200:'                           05262017
052630                      ' OPENED QUEUE='                            05263002
052640                      PV-QUE-NM-INPUT                             05264002
052650                      DELIMITED BY SIZE                           05265001
052660                                 INTO PV-CICS-MSG-AREA            05266001
052670             PERFORM 7000-WRITE-TO-CICS-LOG                       05267001
052680         END-IF                                                   05268001
052700     ELSE                                                         05270001
052800         CALL PV-MQCHECK USING PV-REASON                          05280001
052900                               PV-MQ-REASON-TEXT                  05290001
053000         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           05300001
053100         MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME              05310001
053200         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    05320001
053300         MOVE PV-REASON               TO PE-MQ-REASON-CODE        05330001
053400         MOVE 'OPEN ITEM QUEUE'       TO PV-ERROR-MESSAGE         05340001
053500         PERFORM 9200-MQ-ABEND                                    05350001
053501                                                                  05350102
053502         INITIALIZE PV-CICS-MSG-AREA                              05350217
053503         STRING   ' ' PV-TASK-NBR                                 05350317
053510                  ' WSKCS307-3200:'                               05351017
053520                  ' COULD NOT OPEN QUEUE= ' PV-QUE-NM-INPUT       05352002
053530                  DELIMITED BY SIZE                               05353001
053540                                 INTO PV-CICS-MSG-AREA            05354001
053550         PERFORM 7000-WRITE-TO-CICS-LOG                           05355001
053594                                                                  05359401
053595         MOVE '3200-MQ-QUEUE-OPEN'                                05359502
053596                                   TO DP013-PARAGRAPH             05359601
053597         STRING ' DID NOT OPEN QUEUE='                            05359702
053598                PV-QUE-NM-INPUT                                   05359802
053599                DELIMITED BY SIZE                                 05359901
053600                                 INTO DP013-MESSAGE-TEXT (1)      05360001
053601         SET DP013-DB2-ABEND       TO TRUE                        05360101
053602         PERFORM 9999-ABEND                                       05360201
053610     END-IF.                                                      05361001
053700                                                                  05370001
053800****************************************************************  05380001
053900** OPEN THE ITEM QUEUE FOR PUTS.                                  05390001
054000****************************************************************  05400001
054100 3205-MQ-ERROR-QUEUE-OPEN.                                        05410001
054200                                                                  05420001
054300     MOVE '3205-MQ-ERROR-QUEUE-OPEN' TO PV-PARAGRAPH.             05430001
054400*                                                                 05440001
054500                                                                  05450001
054600     MOVE PV-QUE-NM-OUTPUT         TO MQOD-OBJECTNAME.            05460001
054700     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        05470001
054800                                                                  05480001
054900     COMPUTE PV-OPEN-OPTIONS       = MQOO-OUTPUT                  05490001
055000                                   + MQOO-SET-IDENTITY-CONTEXT    05500001
055100                                   + MQOO-FAIL-IF-QUIESCING.      05510001
055200                                                                  05520001
055300     CALL PC-MQOPEN USING PV-HCONN                                05530001
055400                          MQM-OBJECT-DESCRIPTOR                   05540001
055500                          PV-OPEN-OPTIONS                         05550001
055600                          PV-PQ-HANDLE                            05560001
055700                          PV-COMPLETION-CODE                      05570001
055800                          PV-REASON.                              05580001
055900                                                                  05590001
056000     IF PV-COMPLETION-CODE = MQCC-OK THEN                         05600001
056100         SET PS-ERROR-QUEUE-IS-OPEN-YES TO TRUE                   05610001
056110         IF PS-CICS-SWITCH-YES                                    05611002
056111             INITIALIZE PV-CICS-MSG-AREA                          05611117
056112             STRING   ' ' PV-TASK-NBR                             05611217
056120                      ' WSKCS307-3205:'                           05612017
056130                      ' OPENED QUEUE='                            05613002
056140                      PV-QUE-NM-OUTPUT                            05614002
056150                      DELIMITED BY SIZE                           05615002
056160                                 INTO PV-CICS-MSG-AREA            05616002
056170             PERFORM 7000-WRITE-TO-CICS-LOG                       05617002
056180         END-IF                                                   05618002
056200     ELSE                                                         05620001
056300         CALL PV-MQCHECK USING PV-REASON                          05630001
056400                               PV-MQ-REASON-TEXT                  05640001
056500         MOVE PV-QMGR-NAME         TO PE-MQ-QMANAGER              05650001
056600         MOVE PV-QUE-NM-OUTPUT     TO PE-MQ-QNAME                 05660001
056700         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       05670001
056800         MOVE PV-REASON            TO PE-MQ-REASON-CODE           05680001
056900         MOVE 'OPEN ERROR QUEUE'   TO PV-ERROR-MESSAGE            05690001
057000         PERFORM 9200-MQ-ABEND                                    05700001
057001                                                                  05700102
057002         INITIALIZE PV-CICS-MSG-AREA                              05700217
057003         STRING   ' ' PV-TASK-NBR                                 05700317
057010                  ' WSKCS307-3205:'                               05701017
057020                  ' COULD NOT OPEN QUEUE= ' PV-QUE-NM-OUTPUT      05702002
057030                  DELIMITED BY SIZE                               05703002
057040                                 INTO PV-CICS-MSG-AREA            05704002
057050         PERFORM 7000-WRITE-TO-CICS-LOG                           05705002
057060                                                                  05706002
057095         MOVE '3205-MQ-ERROR-QUEUE-OPEN'                          05709502
057096                                   TO DP013-PARAGRAPH             05709602
057097         STRING ' DID NOT OPEN QUEUE='                            05709702
057098                PV-QUE-NM-OUTPUT                                  05709802
057099                DELIMITED BY SIZE                                 05709902
057100                                 INTO DP013-MESSAGE-TEXT (1)      05710002
057101         SET DP013-DB2-ABEND       TO TRUE                        05710102
057102         PERFORM 9999-ABEND                                       05710202
057110     END-IF.                                                      05711001
057200                                                                  05720001
057300                                                                  05730001
057400                                                                  05740001
057500****************************************************************  05750001
057600** GET THE FIRST MESSAGE (ITEM) FROM THE QUEUE.                   05760001
057700** THE QUEUE IS SET UP SO MSGS ARE RETRIEVED IN FIFO ORDER.       05770001
057800****************************************************************  05780001
057900 3300-MQ-GET-MSG.                                                 05790001
058000                                                                  05800001
058100     INITIALIZE PV-MSGBUFFER                                      05810001
058200                PV-ERRMSGBUF                                      05820001
058300                WS014-RECEIPT-PIX-RECORD                          05830001
058400                PV-MSG.                                           05840001
058500                                                                  05850001
058600*MSG ID IS NOT POPULATED IN THIS PGM.                             05860001
058700     MOVE MQMI-NONE TO MQMD-MSGID.                                05870001
058800                                                                  05880001
058900*MSGS ARE UNQUALIFIED IN THIS PGM.                                05890001
059000     MOVE MQCI-NONE         TO MQMD-CORRELID.                     05900001
059100                                                                  05910001
059200*FORMAT TRANSLATES THE DATA ACROSS PLATFORMS, 4K IS THE           05920001
059300*MAX LENGTH FOR MSGS IN THE PGM.                                  05930001
059400     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    05940001
059500     MOVE +203                 TO PV-MSG-LENGTH.                  05950001
059600                                                                  05960001
059700*THE UNLIMITED WAIT INTERVAL MEANS THAT PROCESSING WILL JUST      05970001
059800* 'WAIT' UNTIL A MESSAGE APPEARS ON THE Q.                        05980001
059900*    MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.             05990011
059901                                                                  05990113
059910* WAIT FOR 30 MINUTES (1,800,000 MILLISECONDS) IN PROD...         05991011
059920* WAIT FOR 30 SECONDS (   30,000 MILLISECONDS) EVERYWHERE ELSE... 05992011
059930     IF PV-SYSID (3:1) = 'P'                                      05993011
059940         MOVE 1800000     TO MQGMO-WAITINTERVAL                   05994011
059950     ELSE                                                         05995011
059960         MOVE   30000     TO MQGMO-WAITINTERVAL                   05996025
059961     END-IF.                                                      05996125
059962                                                                  05996225
059970*    MOVE 1000            TO PV-MSG-LENGTH.                       05997020
059980     COMPUTE MQGMO-OPTIONS = MQGMO-NO-SYNCPOINT                   05998011
059990                           + MQGMO-WAIT                           05999011
059991                           + MQGMO-CONVERT                        05999111
059992                           + MQGMO-FAIL-IF-QUIESCING.             05999211
060000                                                                  06000001
060100*    COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  06010011
060200*                              MQGMO-CONVERT   +                  06020011
060300*                              MQGMO-ACCEPT-TRUNCATED-MSG +       06030011
060400*                              MQGMO-WAIT.                        06040011
060500                                                                  06050001
060600     CALL PC-MQGET USING PV-HCONN                                 06060001
060700                         PV-GQ-HANDLE                             06070001
060800                         MQM-MESSAGE-DESCRIPTOR                   06080001
060900                         MQM-GET-MESSAGE-OPTIONS                  06090001
061000                         PV-MSG-LENGTH                            06100001
061100                         PV-MSGBUFFER                             06110001
061200                         PV-DATA-LENGTH                           06120001
061300                         PV-COMPLETION-CODE                       06130001
061400                         PV-REASON.                               06140001
061500                                                                  06150001
061600*IF GET FAILED THEN DISPLAY ERROR MESSAGE                         06160001
061700*AND BREAK OUT OF LOOP                                            06170001
061800     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        06180001
061900         IF ((PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)              06190001
062000          AND (PV-REASON NOT = MQRC-TRUNCATED-MSG-ACCEPTED))      06200001
062100             CALL PV-MQCHECK USING PV-REASON                      06210001
062200                                   PV-MQ-REASON-TEXT              06220001
062300           MOVE 'MQGET ERROR'          TO PV-ERROR-MESSAGE        06230001
062400           MOVE '3300-MQ-GET-MSG'      TO PV-PARAGRAPH            06240001
062500           MOVE PV-COMPLETION-CODE     TO PV-HOLD-COMPLETION-CODE 06250001
062600           MOVE PV-REASON              TO PV-HOLD-REASON          06260001
062700*          PERFORM 3700-BACK-OUT-MQ                               06270033
062800           MOVE PV-HOLD-COMPLETION-CODE  TO PV-COMPLETION-CODE    06280001
062900                                            PE-MQ-COMPLETION-CODE 06290001
063000           MOVE PV-HOLD-REASON           TO PV-REASON             06300001
063100                                            PE-MQ-REASON-CODE     06310001
063200           PERFORM 9200-MQ-ABEND                                  06320001
063210           STRING ' MQ GET ERROR'                                 06321002
063230                   DELIMITED BY SIZE                              06323002
063240                                INTO DP013-MESSAGE-TEXT (1)       06324002
063250            SET DP013-DB2-ABEND       TO TRUE                     06325002
063260            PERFORM 9999-ABEND                                    06326002
063300         END-IF                                                   06330001
063400*THIS MEANS A MSG WAS TRUNCATED                                   06340001
063500         IF PV-COMPLETION-CODE = MQCC-WARNING                     06350023
063600          AND PV-REASON = MQRC-TRUNCATED-MSG-ACCEPTED             06360023
063760            SET PS-ERROR-YES                                      06376002
063770                PS-END-OF-MSG-YES TO TRUE                         06377002
063800            ADD +1                       TO PA-TOTAL-GETS         06380001
063810            STRING ' MESSAGE WAS TRUNCATED='                      06381002
063820                    PV-QUE-NM-INPUT                               06382002
063830                    DELIMITED BY SIZE                             06383002
063840                                 INTO DP013-MESSAGE-TEXT (1)      06384002
063850             SET DP013-DB2-ABEND       TO TRUE                    06385002
063860             PERFORM 9999-ABEND                                   06386002
063900         END-IF                                                   06390001
063910         IF PV-REASON = MQRC-NO-MSG-AVAILABLE                     06391023
063921             SET PS-TIME-TO-END-PROGRAM-YES TO TRUE               06392123
063930         END-IF                                                   06393023
064000     ELSE                                                         06400001
064100        SET PS-GOOD-MSG-YES              TO TRUE                  06410001
064200        ADD +1                           TO PA-TOTAL-GETS         06420001
064300*PV-MSG IS USED TO PARSE THE DATA, ITS AN ELEMENT THAT JUST       06430001
064400*HOLDS THE ENTIRE ITEM UNTIL                                      06440001
064500*IT IS EITHER PROCESSED OR PUT TO THE ERROR QUEUE.                06450002
064600        MOVE PV-MSGBUFFER            TO PV-MSG                    06460001
064700        MOVE PV-MSGBUFFER            TO WS014-RECEIPT-PIX-RECORD  06470002
064710        IF PS-CICS-SWITCH-YES                                     06471002
064711            INITIALIZE PV-CICS-MSG-AREA                           06471117
064712            STRING   ' ' PV-TASK-NBR                              06471217
064720                     ' WSKCS307-3300:'                            06472017
064730                     ' READ MSG='                                 06473002
064740                     WS014-RECEIPT-PIX-RECORD (1:23)              06474002
064750                     DELIMITED BY SIZE                            06475002
064760                                INTO PV-CICS-MSG-AREA             06476002
064770            PERFORM 7000-WRITE-TO-CICS-LOG                        06477002
064780        END-IF                                                    06478023
064790     END-IF.                                                      06479024
064800                                                                  06480001
064900****************************************************************  06490001
065000** CLOSES THE TRANS QUEUE.                                        06500001
065100****************************************************************  06510001
065200 3400-MQ-QUEUE-CLOSE.                                             06520001
065300                                                                  06530001
065400     MOVE '3400-MQ-QUEUE-CLOSE'    TO PV-PARAGRAPH.               06540001
065500                                                                  06550001
065600     MOVE PV-QUE-NM-INPUT          TO MQOD-OBJECTNAME.            06560001
065700     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        06570001
065800     CALL PC-MQCLOSE USING PV-HCONN                               06580001
065900                           PV-GQ-HANDLE                           06590001
066000                           MQCO-NONE                              06600001
066100                           PV-COMPLETION-CODE                     06610001
066200                           PV-REASON.                             06620001
066300                                                                  06630001
066400     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06640001
066510         IF PS-CICS-SWITCH-YES                                    06651002
066511             INITIALIZE PV-CICS-MSG-AREA                          06651117
066512             STRING   ' ' PV-TASK-NBR                             06651217
066520                      ' WSKCS307-3400:'                           06652017
066530                      ' CLOSED QUEUE='                            06653002
066540                      PV-QUE-NM-INPUT                             06654002
066550                      DELIMITED BY SIZE                           06655002
066560                                 INTO PV-CICS-MSG-AREA            06656002
066570             PERFORM 7000-WRITE-TO-CICS-LOG                       06657002
066580         END-IF                                                   06658002
066600     ELSE                                                         06660001
066700         CALL PV-MQCHECK USING PV-REASON                          06670001
066800                               PV-MQ-REASON-TEXT                  06680001
066900         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           06690001
067000         MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME              06700001
067100         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    06710001
067200         MOVE PV-REASON               TO PE-MQ-REASON-CODE        06720001
067300         MOVE 'PE-MQ-CLOSE'           TO PV-ERROR-MESSAGE         06730001
067400         PERFORM 9200-MQ-ABEND                                    06740001
067410                                                                  06741002
067411         INITIALIZE PV-CICS-MSG-AREA                              06741117
067412         STRING   ' ' PV-TASK-NBR                                 06741217
067420                  ' WSKCS307-3400:'                               06742017
067430                  ' COULD NOT CLOSE QUEUE= ' PV-QUE-NM-INPUT      06743002
067440                  DELIMITED BY SIZE                               06744002
067450                                 INTO PV-CICS-MSG-AREA            06745002
067460         PERFORM 7000-WRITE-TO-CICS-LOG                           06746002
067470                                                                  06747002
067480         MOVE '3400-MQ-QUEUE-CLOSE'                               06748002
067490                                   TO DP013-PARAGRAPH             06749002
067491         STRING ' DID NOT CLOSE QUEUE='                           06749102
067492                PV-QUE-NM-INPUT                                   06749202
067493                DELIMITED BY SIZE                                 06749302
067494                                 INTO DP013-MESSAGE-TEXT (1)      06749402
067495         SET DP013-DB2-ABEND       TO TRUE                        06749502
067496         PERFORM 9999-ABEND                                       06749602
067500     END-IF.                                                      06750001
067600                                                                  06760001
067700****************************************************************  06770001
067800** CLOSES THE ERROR QUEUE.                                        06780001
067900****************************************************************  06790001
068000 3405-MQ-ERROR-QUEUE-CLOSE.                                       06800001
068100                                                                  06810001
068200     MOVE '3405-MQ-ERROR-QUEUE-CLOSE'  TO PV-PARAGRAPH.           06820001
068300                                                                  06830001
068400     MOVE PV-QUE-NM-OUTPUT         TO MQOD-OBJECTNAME.            06840001
068500     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        06850001
068600                                                                  06860001
068700     CALL PC-MQCLOSE USING PV-HCONN                               06870001
068800                           PV-PQ-HANDLE                           06880001
068900                           MQCO-NONE                              06890001
069000                           PV-COMPLETION-CODE                     06900001
069100                           PV-REASON.                             06910001
069200                                                                  06920001
069300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         06930001
069400         SET PS-ERROR-QUEUE-IS-OPEN-NO TO TRUE                    06940001
069410         IF PS-CICS-SWITCH-YES                                    06941002
069411             INITIALIZE PV-CICS-MSG-AREA                          06941117
069412             STRING   ' ' PV-TASK-NBR                             06941217
069420                      ' WSKCS307-3405:'                           06942017
069430                      ' CLOSED QUEUE='                            06943002
069440                      PV-QUE-NM-OUTPUT                            06944002
069450                      DELIMITED BY SIZE                           06945002
069460                                 INTO PV-CICS-MSG-AREA            06946002
069470             PERFORM 7000-WRITE-TO-CICS-LOG                       06947002
069480         END-IF                                                   06948002
069500     ELSE                                                         06950001
069600         CALL PV-MQCHECK USING PV-REASON                          06960001
069700                               PV-MQ-REASON-TEXT                  06970001
069800         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           06980001
069900         MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME              06990001
070000         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    07000001
070100         MOVE PV-REASON               TO PE-MQ-REASON-CODE        07010001
070200         MOVE 'PE-ERROR-Q-CLOSE'      TO PV-ERROR-MESSAGE         07020001
070300         PERFORM 9200-MQ-ABEND                                    07030001
070310                                                                  07031002
070311         INITIALIZE PV-CICS-MSG-AREA                              07031117
070312         STRING   ' ' PV-TASK-NBR                                 07031217
070320                  ' WSKCS307-3405:'                               07032017
070330                  ' COULD NOT CLOSE QUEUE= ' PV-QUE-NM-OUTPUT     07033002
070340                  DELIMITED BY SIZE                               07034002
070350                                 INTO PV-CICS-MSG-AREA            07035002
070360         PERFORM 7000-WRITE-TO-CICS-LOG                           07036002
070370                                                                  07037002
070380         MOVE '3405-MQ-ERROR-QUEUE-CLOSE'                         07038002
070390                                   TO DP013-PARAGRAPH             07039002
070391         STRING ' DID NOT CLOSE QUEUE='                           07039102
070392                PV-QUE-NM-OUTPUT                                  07039202
070393                DELIMITED BY SIZE                                 07039302
070394                                 INTO DP013-MESSAGE-TEXT (1)      07039402
070395         SET DP013-DB2-ABEND       TO TRUE                        07039502
070396         PERFORM 9999-ABEND                                       07039602
070400     END-IF.                                                      07040001
070500                                                                  07050001
070600****************************************************************  07060001
070700** DISCONNECT FROM THE QUEUE MANAGER                              07070001
070800****************************************************************  07080001
070900 3500-DISCONNECT-QMGR.                                            07090001
071000                                                                  07100001
071100     MOVE '3500-DISCONNECT-QMGR'    TO PV-PARAGRAPH.              07110001
071200     CALL PC-MQDISC USING PV-HCONN                                07120001
071300                          PV-COMPLETION-CODE                      07130001
071400                          PV-REASON.                              07140025
071500                                                                  07150001
071600     IF PV-COMPLETION-CODE = MQCC-OK THEN                         07160001
071710         IF PS-CICS-SWITCH-YES                                    07171002
071711             INITIALIZE PV-CICS-MSG-AREA                          07171117
071712             STRING   ' ' PV-TASK-NBR                             07171217
071720                      ' WSKCS307-3500:'                           07172017
071730                      ' DISCONNECTED FROM QUE MGR='               07173002
071740                      PV-QMGR-NAME                                07174002
071750                      DELIMITED BY SIZE                           07175002
071760                                 INTO PV-CICS-MSG-AREA            07176002
071770             PERFORM 7000-WRITE-TO-CICS-LOG                       07177002
071780         END-IF                                                   07178002
071800     ELSE                                                         07180001
071900         CALL PV-MQCHECK USING PV-REASON                          07190001
072000                               PV-MQ-REASON-TEXT                  07200001
072100         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           07210002
072200         MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME              07220002
072300         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    07230002
072400         MOVE PV-REASON               TO PE-MQ-REASON-CODE        07240002
072500         MOVE '3500-DISCONNECT-QMGR'  TO PV-ERROR-MESSAGE         07250002
072600         PERFORM 9200-MQ-ABEND                                    07260002
072601                                                                  07260102
072602         INITIALIZE PV-CICS-MSG-AREA                              07260217
072603         STRING   ' ' PV-TASK-NBR                                 07260317
072610                  ' WSKCS307-3500:'                               07261017
072620                  ' INVALID DISCONNECT TO QUE MGR'                07262002
072630                  DELIMITED BY SIZE                               07263002
072640                                 INTO PV-CICS-MSG-AREA            07264002
072650         PERFORM 7000-WRITE-TO-CICS-LOG                           07265002
072660         MOVE '3500-DISCONNECT-QMGR'                              07266002
072670                                   TO DP013-PARAGRAPH             07267002
072680         STRING ' DID NOT DISCONNECT FROM QUE MGR '               07268002
072690                PV-QMGR-NAME                                      07269002
072691                DELIMITED BY SIZE                                 07269102
072692                                 INTO DP013-MESSAGE-TEXT (1)      07269202
072693         SET DP013-DB2-ABEND       TO TRUE                        07269302
072694         PERFORM 9999-ABEND                                       07269402
072700     END-IF.                                                      07270001
072800                                                                  07280001
072900******************************************************************07290001
073000*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        07300001
073100******************************************************************07310001
073200 3600-MQ-COMMIT.                                                  07320001
073300                                                                  07330001
073310     EXEC CICS                                                    07331030
073320         SYNCPOINT                                                07332030
073330     END-EXEC.                                                    07333030
073340                                                                  07334030
073400*    CALL PC-MQCMIT USING PV-HCONN                                07340030
073500*                         PV-COMPLETION-CODE                      07350030
073600*                         PV-REASON.                              07360030
073700*                                                                 07370030
073800*    IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        07380030
073900*        CALL PV-MQCHECK USING PV-REASON                          07390030
074000*                              PV-MQ-REASON-TEXT                  07400030
074100*        MOVE '3600-MQ-COMMIT'   TO PV-PARAGRAPH                  07410030
074200*        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE              07420030
074300*        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE       07430030
074400*        MOVE PV-REASON          TO PV-HOLD-REASON                07440030
074500*        PERFORM 3700-BACK-OUT-MQ                                 07450030
074600*        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE       07460030
074700*                                        PE-MQ-COMPLETION-CODE    07470030
074800*        MOVE PV-HOLD-REASON          TO PV-REASON                07480030
074900*                                        PE-MQ-REASON-CODE        07490030
075000*        PERFORM 9200-MQ-ABEND                                    07500030
075010*                                                                 07501030
075011*        INITIALIZE PV-CICS-MSG-AREA                              07501130
075012*        STRING   ' ' PV-TASK-NBR                                 07501230
075020*                 ' WSKCS307-3600:'                               07502030
075030*                 ' INVALID COMMIT'                               07503030
075040*                 DELIMITED BY SIZE                               07504030
075050*                                INTO PV-CICS-MSG-AREA            07505030
075060*        PERFORM 7000-WRITE-TO-CICS-LOG                           07506030
075070*        MOVE '3600-MQ-COMMIT'                                    07507030
075080*                                  TO DP013-PARAGRAPH             07508030
075090*        STRING ' DID NOT COMMIT THE MESSAGE'                     07509030
075092*               DELIMITED BY SIZE                                 07509230
075093*                                INTO DP013-MESSAGE-TEXT (1)      07509330
075094*        SET DP013-DB2-ABEND       TO TRUE                        07509430
075095*        PERFORM 9999-ABEND                                       07509530
075100*    ELSE                                                         07510030
075200         ADD +1 TO PA-TOTAL-MQ-COMMITS                            07520030
075210         IF PS-CICS-SWITCH-YES                                    07521030
075211             INITIALIZE PV-CICS-MSG-AREA                          07521130
075212             STRING   ' ' PV-TASK-NBR                             07521230
075220                      ' WSKCS307-3600:'                           07522030
075230                      ' MQ COMMIT'                                07523030
075250                      DELIMITED BY SIZE                           07525030
075260                                 INTO PV-CICS-MSG-AREA            07526030
075270             PERFORM 7000-WRITE-TO-CICS-LOG                       07527030
075280         END-IF.                                                  07528031
075300*    END-IF.                                                      07530030
075400                                                                  07540001
075500******************************************************************07550001
075600* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       07560001
075700******************************************************************07570001
075800*3700-BACK-OUT-MQ.                                                07580034
075900*                                                                 07590034
076000*    CALL PC-MQBACK USING PV-HCONN                                07600034
076100*                         PV-COMPLETION-CODE                      07610034
076200*                         PV-REASON.                              07620034
076300*                                                                 07630034
076400*    IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   07640034
076500*        CALL PV-MQCHECK USING PV-REASON                          07650034
076600*                              PV-MQ-REASON-TEXT                  07660034
076700*        MOVE '3700-BACK-OUT-MQ'  TO PV-PARAGRAPH                 07670034
076800*        MOVE 'MQBACK ERROR'      TO PV-ERROR-MESSAGE             07680034
076900*        PERFORM 9200-MQ-ABEND                                    07690034
076901*                                                                 07690134
076902*        INITIALIZE PV-CICS-MSG-AREA                              07690234
076903*        STRING   ' ' PV-TASK-NBR                                 07690334
076904*                 ' WSKCS307-3700:'                               07690434
076905*                 ' INVALID BACK OUT'                             07690534
076906*                 DELIMITED BY SIZE                               07690634
076907*                                INTO PV-CICS-MSG-AREA            07690734
076908*        PERFORM 7000-WRITE-TO-CICS-LOG                           07690834
076909*        MOVE '3700-BACK-OUT-MQ'                                  07690934
076910*                                  TO DP013-PARAGRAPH             07691034
076911*        STRING ' DID NOT COMMIT THE MESSAGE'                     07691134
076912*               DELIMITED BY SIZE                                 07691234
076913*                                INTO DP013-MESSAGE-TEXT (1)      07691334
076914*        SET DP013-DB2-ABEND       TO TRUE                        07691434
076915*        PERFORM 9999-ABEND                                       07691534
076920*    ELSE                                                         07692034
076930*        IF PS-CICS-SWITCH-YES                                    07693034
076931*            INITIALIZE PV-CICS-MSG-AREA                          07693134
076932*            STRING   ' ' PV-TASK-NBR                             07693234
076940*                     ' WSKCS307-3700:'                           07694034
076950*                     ' BACKOUT SUCCESSFUL'                       07695034
076960*                     DELIMITED BY SIZE                           07696034
076970*                                INTO PV-CICS-MSG-AREA            07697034
076980*            PERFORM 7000-WRITE-TO-CICS-LOG                       07698034
076990*        END-IF                                                   07699034
077000*    END-IF.                                                      07700034
077100*                                                                 07710034
077200****************************************************************  07720001
077300* PUT MESSAGE IN ERROR TO THE ITEM ERROR QUEUE                    07730001
077400****************************************************************  07740001
077500 3800-PUT-MSG-TO-ERROR-Q.                                         07750001
077600                                                                  07760001
077610* JAK 08/2007 - DO NOT LOAD PGM NAME HERE                         07761043
077700*    MOVE PC-CURRENT-PROGRAM-NAME  TO WS020-ERROR-PGM-NAME.       07770043
077800     MOVE WS014-RECEIPT-PIX-RECORD TO WS020-WSRD014-RECORD.       07780001
077900                                                                  07790001
078000     ADD +1 TO PA-TOTAL-ERRORQ-RECS.                              07800001
078100                                                                  07810001
078200*MSGID IS NOT POPULATED AT ALL IN THIS PGM.                       07820001
078300     MOVE MQMI-NONE        TO MQMD-MSGID.                         07830001
078400                                                                  07840001
078500*MSGS ARE UNQUALIFIED IN THIS PGM.                                07850001
078600     MOVE MQCI-NONE            TO MQMD-CORRELID.                  07860001
078700                                                                  07870001
078800     MOVE WS020-RECEIPT-PIX-ERROR-REC TO PV-ERRMSGBUF.            07880001
078900     MOVE +226 TO PV-MSG-LENGTH.                                  07890001
079000                                                                  07900001
079100*SET OPTIONS.                                                     07910001
079200     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        07920001
079300     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   07930001
079400     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  07940001
079500                               MQPMO-SET-IDENTITY-CONTEXT.        07950001
079600                                                                  07960001
079700*PUT MSG.                                                         07970001
079800     CALL PC-MQPUT USING PV-HCONN                                 07980001
079900                         PV-PQ-HANDLE                             07990001
080000                         MQM-MESSAGE-DESCRIPTOR                   08000001
080100                         MQM-PUT-MESSAGE-OPTIONS                  08010001
080200                         PV-MSG-LENGTH                            08020001
080300                         PV-ERRMSGBUF                             08030001
080400                         PV-COMPLETION-CODE                       08040001
080500                         PV-REASON.                               08050001
080600                                                                  08060001
080700*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         08070001
080800*AND BREAK OUT OF LOOP                                            08080001
080900     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        08090001
081000         CALL PV-MQCHECK USING PV-REASON                          08100001
081100                               PV-MQ-REASON-TEXT                  08110001
081300         MOVE '3800-PUT-MSG-TO-ERROR-Q' TO PV-PARAGRAPH           08130001
081400         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         08140001
081500         MOVE PV-COMPLETION-CODE      TO PV-HOLD-COMPLETION-CODE  08150001
081600         MOVE PV-REASON               TO PV-HOLD-REASON           08160001
081700*        PERFORM 3700-BACK-OUT-MQ                                 08170033
081800         MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE       08180001
081900                                         PE-MQ-COMPLETION-CODE    08190001
082000         MOVE PV-HOLD-REASON          TO PV-REASON                08200001
082100                                         PE-MQ-REASON-CODE        08210001
082200         PERFORM 9200-MQ-ABEND                                    08220001
082201                                                                  08220102
082202         INITIALIZE PV-CICS-MSG-AREA                              08220217
082203         STRING   ' ' PV-TASK-NBR                                 08220317
082204                  ' WSKCS307-3800:'                               08220417
082205                  ' ERROR WRITING TO ERROR QUE'                   08220502
082206                  DELIMITED BY SIZE                               08220602
082207                                 INTO PV-CICS-MSG-AREA            08220702
082208         PERFORM 7000-WRITE-TO-CICS-LOG                           08220802
082209         MOVE '3800-PUT-MSG-TO-ERROR-Q'                           08220902
082210                                   TO DP013-PARAGRAPH             08221002
082211         STRING ' ERROR WRITING TO ' PV-QUE-NM-OUTPUT             08221102
082212                DELIMITED BY SIZE                                 08221202
082213                                 INTO DP013-MESSAGE-TEXT (1)      08221302
082214         SET DP013-DB2-ABEND       TO TRUE                        08221402
082215         PERFORM 9999-ABEND                                       08221502
082216     ELSE                                                         08221602
082217         IF PS-CICS-SWITCH-YES                                    08221702
082218             INITIALIZE PV-CICS-MSG-AREA                          08221817
082219             STRING   ' ' PV-TASK-NBR                             08221917
082220                      ' WSKCS307-3800:'                           08222017
082230                      ' WRITE TO ERROR QUEUE SUCCESSFUL'          08223019
082240                      DELIMITED BY SIZE                           08224002
082250                                 INTO PV-CICS-MSG-AREA            08225002
082260             PERFORM 7000-WRITE-TO-CICS-LOG                       08226002
082270         END-IF                                                   08227002
082300     END-IF.                                                      08230001
082400                                                                  08240001
083300******************************************************************08330001
083400* END RUN OF PROGRAM ROUTINE:                                     08340001
083500* CLOSE QUEUE(S)                                                  08350001
083600* DISCONNECT FROM QMGR                                            08360001
083700* DISPLAY SUMMARY STATISTICS                                      08370001
083800****************************************************************  08380001
083900 5000-END-RUN-ROUTINE.                                            08390001
084000                                                                  08400001
084100*CLOSE THE TRANS QUEUE.                                           08410001
084200     PERFORM 3400-MQ-QUEUE-CLOSE.                                 08420001
084300                                                                  08430001
084400*CLOSE THE ERROR QUEUE IF OPEN.                                   08440001
084500     IF PS-ERROR-QUEUE-IS-OPEN-YES                                08450001
084600        PERFORM 3405-MQ-ERROR-QUEUE-CLOSE                         08460001
084700     END-IF.                                                      08470001
084800                                                                  08480001
084900*DISCONNECT FROM THE QMGR.                                        08490001
085000     PERFORM 3500-DISCONNECT-QMGR.                                08500001
085100                                                                  08510001
085200*END OF JOB ROUTINE.                                              08520001
085300     PERFORM 8000-EOJ-ROUTINE.                                    08530001
085400                                                                  08540001
085500*END PROGRAM.                                                     08550001
085710     EXEC CICS                                                    08571002
085720         RETURN                                                   08572002
085730     END-EXEC.                                                    08573002
085740                                                                  08574002
085800                                                                  08580001
085801****************************************************************  08580102
085802* WRITE MESSAGES TO THE CICS LOG                                  08580202
085803****************************************************************  08580302
085810 7000-WRITE-TO-CICS-LOG.                                          08581001
085820                                                                  08582001
085830     MOVE LENGTH PV-CICS-MSG-AREA TO                              08583001
085840                                     PV-COMMAREA-LENGTH.          08584001
085850     EXEC CICS                                                    08585001
085860          WRITEQ TD                                               08586001
085870          QUEUE  ('CSSL')                                         08587001
085880          FROM  (PV-CICS-MSG-AREA)                                08588001
085890          LENGTH  (PV-COMMAREA-LENGTH)                            08589001
085891          RESP  (PV-CICS-RESP)                                    08589101
085892     END-EXEC.                                                    08589201
085893                                                                  08589301
085894     MOVE SPACES TO PV-CICS-MSG-AREA.                             08589401
085895                                                                  08589501
085896/                                                                 08589601
085900****************************************************************  08590001
086000* OPEN THE ERROR QUEUE IF IT HAS NOT BEEN ALREADY.                08600001
086100****************************************************************  08610001
086200 7100-ERROR-ROUTINE.                                              08620001
086300                                                                  08630001
086400*OPEN ERROR QUEUE                                                 08640001
086500     IF PS-ERROR-QUEUE-IS-OPEN-NO                                 08650001
086600        PERFORM 3205-MQ-ERROR-QUEUE-OPEN                          08660001
086700     END-IF.                                                      08670001
086800                                                                  08680001
086900****************************************************************  08690001
087300                                                                  08730001
087400******************************************************************08740001
087500* UPDATE CHECKPOINT STATUS CODE WITH 0 FOR COMPLETION.            08750001
087600* DISPLAY STATISTICS FOR THE PROGRAM                              08760001
087700******************************************************************08770001
087800 8000-EOJ-ROUTINE.                                                08780001
087900                                                                  08790001
087910     IF PS-CICS-SWITCH-YES                                        08791006
087911         INITIALIZE PV-CICS-MSG-AREA                              08791117
087912         STRING   ' ' PV-TASK-NBR                                 08791217
087920                  ' WSKCS307-8000:'                               08792017
087930                  ' SUMMARY STATISTICS'                           08793006
087940                  DELIMITED BY SIZE                               08794006
087950                             INTO PV-CICS-MSG-AREA                08795006
087960         PERFORM 7000-WRITE-TO-CICS-LOG                           08796006
087961                                                                  08796102
087962         MOVE PA-TOTAL-GETS TO PV-DISPLAY-CNT                     08796206
087963         INITIALIZE PV-CICS-MSG-AREA                              08796317
087964         STRING   ' ' PV-TASK-NBR                                 08796417
087965                  ' WSKCS307-8000:'                               08796517
087966                  ' TOTAL MESSAGES READ=' PV-DISPLAY-CNT          08796606
087967                  DELIMITED BY SIZE                               08796706
087968                             INTO PV-CICS-MSG-AREA                08796806
087969         PERFORM 7000-WRITE-TO-CICS-LOG                           08796906
087970                                                                  08797002
087971         MOVE PA-TOTAL-ERRORQ-RECS TO PV-DISPLAY-CNT              08797106
087972         INITIALIZE PV-CICS-MSG-AREA                              08797217
087973         STRING   ' ' PV-TASK-NBR                                 08797317
087974                  ' WSKCS307-8000:'                               08797417
087975                  ' TOTAL MESSAGES IN ERROR='                     08797506
087976                                          PV-DISPLAY-CNT          08797606
087977                  DELIMITED BY SIZE                               08797706
087978                             INTO PV-CICS-MSG-AREA                08797806
087979         PERFORM 7000-WRITE-TO-CICS-LOG                           08797906
087980                                                                  08798002
087981         MOVE PA-TOTAL-MQ-COMMITS TO PV-DISPLAY-CNT               08798106
087982         INITIALIZE PV-CICS-MSG-AREA                              08798217
087983         STRING   ' ' PV-TASK-NBR                                 08798317
087984                  ' WSKCS307-8000:'                               08798417
087985                  ' TOTAL MQ COMMITS=' PV-DISPLAY-CNT             08798506
087986                  DELIMITED BY SIZE                               08798606
087987                             INTO PV-CICS-MSG-AREA                08798706
087988         PERFORM 7000-WRITE-TO-CICS-LOG                           08798806
087990     END-IF.                                                      08799006
089000                                                                  08900001
091800****************************************************************  09180001
091900** PERFORM MQ-SERIES ABEND PROCESSING                             09190001
092000****************************************************************  09200001
092100 9200-MQ-ABEND.                                                   09210001
092200                                                                  09220001
092201     MOVE PV-ABEND-CODE TO PV-DISPLAY-CDE.                        09220108
092202     INITIALIZE PV-CICS-MSG-AREA.                                 09220217
092203     STRING   ' ' PV-TASK-NBR                                     09220317
092210              ' WSKCS307-9200:'                                   09221017
092220                  ' ABEND CODE=' PV-DISPLAY-CDE                   09222008
092230                  DELIMITED BY SIZE                               09223001
092240                                 INTO PV-CICS-MSG-AREA.           09224007
092250     PERFORM 7000-WRITE-TO-CICS-LOG.                              09225007
092251                                                                  09225125
092252     INITIALIZE PV-CICS-MSG-AREA.                                 09225217
092253     STRING   ' ' PV-TASK-NBR                                     09225317
092260              ' WSKCS307-9200:'                                   09226017
092270                  ' MESSAGE=' PV-ERROR-MESSAGE                    09227001
092280                  DELIMITED BY SIZE                               09228001
092290                                 INTO PV-CICS-MSG-AREA.           09229007
092300     PERFORM 7000-WRITE-TO-CICS-LOG.                              09230007
092301                                                                  09230125
092310     INITIALIZE PV-CICS-MSG-AREA.                                 09231017
092320     STRING   ' ' PV-TASK-NBR                                     09232017
092400              ' WSKCS307-9200:'                                   09240017
092500                  ' COMP CODE=' PE-MQ-COMPLETION-CODE             09250007
092600                  DELIMITED BY SIZE                               09260001
092700                                 INTO PV-CICS-MSG-AREA.           09270007
092800     PERFORM 7000-WRITE-TO-CICS-LOG.                              09280007
092801                                                                  09280125
092802     INITIALIZE PV-CICS-MSG-AREA.                                 09280217
092803     STRING   ' ' PV-TASK-NBR                                     09280317
092810              ' WSKCS307-9200:'                                   09281017
092820                  ' RSN CODE=' PE-MQ-REASON-CODE                  09282007
092830                  DELIMITED BY SIZE                               09283001
092840                                 INTO PV-CICS-MSG-AREA.           09284007
092850     PERFORM 7000-WRITE-TO-CICS-LOG.                              09285007
092851                                                                  09285125
092852     INITIALIZE PV-CICS-MSG-AREA.                                 09285217
092853     STRING   ' ' PV-TASK-NBR                                     09285317
092860              ' WSKCS307-9200:'                                   09286017
092870                  ' RSN TEXT=' PV-MQ-REASON-TEXT                  09287008
092880                  DELIMITED BY SIZE                               09288001
092890                                 INTO PV-CICS-MSG-AREA.           09289007
092900     PERFORM 7000-WRITE-TO-CICS-LOG.                              09290007
093500                                                                  09350001
093510***************************************************************   09351001
093520*   STANDARD ABEND ROUTINE                                        09352001
093530* ==> PROCESSES:                                                  09353001
093540*   - ISSUES THE ABEND.                                           09354001
093550***************************************************************   09355001
093560 9999-ABEND.                                                      09356001
093570     MOVE 'WSKCS307'                  TO DP013-PROGRAM.           09357001
093580     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          09358001
093590     INITIALIZE DP013-SRC-TASK-NUMBER                             09359001
093591                DP013-STACK.                                      09359101
093592     SET DP013-LINK-RETURN TO TRUE.                               09359201
093593     SET DP013-ROLLBACK    TO TRUE.                               09359301
093594                                                                  09359401
093595     EXEC CICS                                                    09359501
093596         LINK                                                     09359601
093597             PROGRAM  (DP013-NAME)                                09359701
093598             COMMAREA (DP013-PARAMETERS)                          09359801
093599             LENGTH   (DP013-LENGTH)                              09359901
093600     END-EXEC.                                                    09360001
093601                                                                  09360101
093602                                                                  09360201
093603     EXEC CICS                                                    09360301
093604         RETURN                                                   09360401
093605     END-EXEC.                                                    09360501
093606                                                                  09360601
093610******************************************************************09361001
093700**                      END OF PROGRAM                            09370001
093800******************************************************************09380001
