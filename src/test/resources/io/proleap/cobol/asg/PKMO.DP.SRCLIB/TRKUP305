000100*************************                                         00010064
000200 IDENTIFICATION DIVISION.                                         00020064
000300*************************                                         00030064
000400                                                                  00040064
000500 PROGRAM-ID.      TRKUP305.                                       00050064
000600 AUTHOR.          ABRAHAM IVERSON.                                00060064
000700 DATE-WRITTEN.    03/13/02.                                       00070064
000800                                                                  00080064
000900******************************************************************00090064
001000* THIS PROGRAM WILL CREATE A FLAT FILE OF PO HEADER/DETAIL        00100064
001100* INFORMATION.  IT WILL BE WRITEN TO A FLAT FILE WHICH IS THE     00110064
001200* INPUT FOR PROGRAM TRKUT320 WHICH WILL SEND THE RECORDS VIA      00120064
001300* MQ SERIES TO TMS PROCUREMENT.                                   00130064
001400******************************************************************00140064
001500*  CHANGE LOG                                                     00150064
001600*  DATE       CHANGED BY    DESC                                  00160064
001700*  ---------- ------------- --------------------------------------00170064
001800*  11/10/2011 CHRISTINE TWIEHAUS                                  00180064
001900*                       TMS YMS (WR40574)                         00190064
002000*                       ADD DEPT AND MIN CLASS                    00200064
002100*  03/27/2012 CHRISTINE TWIEHAUS                                  00210064
002200*                       TMS YMS (WR40574)                         00220064
002300*                       SPLIT MU FROM TP                          00230064
002400*  03/27/2012 CHRISTINE TWIEHAUS                                  00240064
002500*                       TMS YMS (WR40574)                         00250064
002600*                       REMOVE SPLIT AND ONLY WRITE TO OUT01      00260064
002700*  06/08/2012 MIKE FRIESS (TKMA508)                               00270065
002800*                       CRQ26711 - FIX CODE TO BYPASS RECS THAT   00280068
002900*                       HAVE BEEN PURGED OFF OF TPURCHS           00290065
BARB  *  01/15/2018 BARB SCHULTZ                                        00291099
BARB  *                       ADDED PO TYPES 'RE' - REPLEN ECOMM        00292099
BARB  *                                      'VE' - VENDOR GEN ECOMM    00294099
003000******************************************************************00300065
003100                                                                  00310065
003200 ENVIRONMENT DIVISION.                                            00320065
003300 CONFIGURATION SECTION.                                           00330065
003400                                                                  00340064
003500 SOURCE-COMPUTER. IBM-3090.                                       00350064
003600 OBJECT-COMPUTER. IBM-3090.                                       00360064
003700                                                                  00370064
003800 INPUT-OUTPUT SECTION.                                            00380064
003900 FILE-CONTROL.                                                    00390064
004000                                                                  00400064
004100     SELECT CONTROL-PROCESS-ENT-IDS                               00410064
004200         ASSIGN                  TO INP01.                        00420064
004300     SELECT TMS-ENT-ID-FILE                                       00430064
004400         ASSIGN                  TO INP02.                        00440064
004500     SELECT TMS-PO-HDR-DTL-FILE                                   00450064
004600         ASSIGN                  TO OUT01.                        00460064
004700                                                                  00470064
004800***************                                                   00480064
004900 DATA DIVISION.                                                   00490064
005000***************                                                   00500064
005100 FILE SECTION.                                                    00510064
005200                                                                  00520064
005300 FD  CONTROL-PROCESS-ENT-IDS                                      00530064
005400     RECORDING MODE F                                             00540064
005500     BLOCK CONTAINS 0 RECORDS                                     00550064
005600     LABEL RECORDS ARE OMITTED.                                   00560064
005700 01  CONTROL-PROCESS-ENT-IDS-REC           PIC  X(80).            00570064
005800                                                                  00580064
005900 FD  TMS-ENT-ID-FILE                                              00590064
006000     RECORDING MODE F                                             00600064
006100     BLOCK CONTAINS 0 RECORDS                                     00610064
006200*    RECORD CONTAINS 9 CHARACTERS                                 00620082
006300     RECORD CONTAINS 80 CHARACTERS                                00630082
006400     LABEL RECORDS ARE STANDARD                                   00640064
006500     DATA RECORD IS TMS-ENT-ID-RECORD.                            00650064
006600*01  TMS-ENT-ID-RECORD                     PIC  X(09).            00660082
006700 01  TMS-ENT-ID-RECORD                     PIC  X(80).            00670082
006800                                                                  00680064
006900 FD  TMS-PO-HDR-DTL-FILE                                          00690064
007000     RECORDING MODE F                                             00700064
007100     BLOCK CONTAINS 0 RECORDS                                     00710064
007200     RECORD CONTAINS 300 CHARACTERS                               00720064
007300     LABEL RECORDS ARE STANDARD                                   00730064
007400     DATA RECORD IS TMS-PO-HDR-DTL-RECORD.                        00740064
007500 01  TMS-PO-HDR-DTL-RECORD                 PIC X(300).            00750064
007600                                                                  00760064
007700                                                                  00770064
007800************************                                          00780064
007900 WORKING-STORAGE SECTION.                                         00790064
008000************************                                          00800064
008100                                                                  00810064
008200 01  PS-PROGRAM-SWITCHES.                                         00820064
008300     05  PS-END-OF-INPUT-SW          PIC  X(01)    VALUE 'N'.     00830064
008400         88  PS-END-OF-INPUT                       VALUE 'Y'.     00840064
008500     05  PS-END-OF-PO-SW             PIC  X(01)    VALUE 'N'.     00850064
008600         88  PS-END-OF-POS                         VALUE 'Y'.     00860064
008700     05  PS-END-OF-PO-EXTR-OUT-SW    PIC  X(01)    VALUE 'N'.     00870064
008800         88  PS-END-OF-PO-EXTR-OUT                 VALUE 'Y'.     00880064
008900     05  PS-END-OF-PO-EXTR-DROP-SW   PIC  X(01)    VALUE 'N'.     00890064
009000         88  PS-END-OF-PO-EXTR-DROP                VALUE 'Y'.     00900064
009100     05  PS-END-OF-PO-EXTR-DEL-SW    PIC  X(01)    VALUE 'N'.     00910064
009200         88  PS-END-OF-PO-EXTR-DEL                 VALUE 'Y'.     00920064
009300     05  PS-PO-EXTR-SW               PIC  X(01)    VALUE 'Y'.     00930064
009400         88  PS-PO-EXTR-FOUND                      VALUE 'Y'.     00940064
009500         88  PS-PO-EXTR-NOT-FOUND                  VALUE 'N'.     00950064
009600     05  PS-PO-HIST-SW               PIC  X(01)    VALUE 'Y'.     00960064
009700         88  PS-PO-HIST-FOUND                      VALUE 'Y'.     00970064
009800         88  PS-PO-HIST-NOT-FOUND                  VALUE 'N'.     00980064
009900     05  PS-DC-DROP-HIST-SW          PIC  X(01)    VALUE 'N'.     00990064
010000         88  PS-NO-DC-DROP-HIST                    VALUE 'Y'.     01000064
010100         88  PS-DC-DROP-HIST                       VALUE 'N'.     01010064
010200     05  PS-ENT-ID-SW                PIC  X(01)    VALUE 'Y'.     01020064
010300         88  PS-ENT-ID-VALID                       VALUE 'Y'.     01030064
010400         88  PS-ENT-ID-NOT-VALID                   VALUE 'N'.     01040064
010500     05  PS-DROP-DC-SW               PIC  X(01)    VALUE 'Y'.     01050064
010600         88  PS-DROP-DC                            VALUE 'Y'.     01060064
010700         88  PS-DONT-DROP-DC                       VALUE 'N'.     01070064
010800     05  PS-UPDATE-SW                PIC  X(01)    VALUE 'Y'.     01080064
010900         88  PS-DO-UPDATE                          VALUE 'N'.     01090064
011000         88  PS-DONT-DO-UPDATE                     VALUE 'Y'.     01100064
011100     05  PS-COMMITS-TAKEN-SW         PIC  X(01)    VALUE 'N'.     01110064
011200         88  PS-COMMITS-TAKEN                      VALUE 'T'.     01120064
011300         88  PS-NO-COMMITS-TAKEN                   VALUE 'N'.     01130064
011400     05  PS-RUN-TYPE-SW              PIC  X(01)    VALUE ' '.     01140064
011500         88  PS-NORMAL-RUN                         VALUE '0'.     01150064
011600         88  PS-RESTART-STEP-1                     VALUE '1'.     01160064
011700         88  PS-RESTART-STEP-2                     VALUE '2'.     01170064
011800         88  PS-RESTART-STEP-3                     VALUE '3'.     01180064
011900*    **** CRQ26711 START                                          01190068
012000     05  PS-BYPASS-SEND-SW           PIC  X(01)    VALUE 'N'.     01200064
012100         88  PS-BYPASS-SEND                        VALUE 'Y'.     01210064
012200         88  PS-BYPASS-SEND-NO                     VALUE 'N'.     01220064
012300*    **** CRQ26711 END                                            01230068
012400*                                                                 01240086
012500     05  PS-REC-LIMIT-CRSD-SW        PIC  X(01)    VALUE 'N'.     01250086
012600         88  PS-REC-LIMIT-CRSD                     VALUE 'Y'.     01260086
012700         88  PS-REC-LIMIT-CRSD-NO                  VALUE 'N'.     01270086
012800                                                                  01280064
012900 01  PC-PROGRAM-CONSTANTS.                                        01290064
013000     05  PC-PGM-NAME                  PIC X(08)  VALUE            01300064
013100                                                 'TRKUP305'.      01310064
013200     05  PC-MAX-RETRIES               PIC S9(04) COMP VALUE +3.   01320064
013300     05  PC-DEFAULT-DATE              PIC X(10)  VALUE            01330064
013400                                                 '0001-01-01'.    01340064
013500     05  PC-DC                        PIC X(02)  VALUE 'DC'.      01350064
013600     05  PC-RESTART-STEP              PIC X(01).                  01360064
013700         88  PC-RESTART-STEP-1                   VALUE '1'.       01370064
013800         88  PC-RESTART-STEP-2                   VALUE '2'.       01380064
013900         88  PC-RESTART-STEP-3                   VALUE '3'.       01390064
014000         88  PC-RUN-COMPLETE-CODE                VALUE '0'.       01400064
014100     05  PC-ERROR-MESSAGE-1            PIC  X(60)  VALUE          01410082
014200         'INTERNAL COBOL TABLE MAXIMUM SIZE(10000) EXCEEDED'.     01420082
014300     05  PC-ERROR-MESSAGE-2            PIC  X(60)  VALUE          01430082
014400         'I.E. MORE THAN 10000 ENT-ID PRESENT IN INPUT I02 FILE'. 01440082
014500     05  PC-MAX-ENT-IDS                PIC 9(5)    VALUE 10000.   01450082
014600     05  PC-FORMAT1                    PIC X(56)   VALUE ALL '!'. 01460082
014700     05  PC-FORMAT2                    PIC X(56)   VALUE ALL '*'. 01470082
014800     05  PC-REC-LIMIT                  PIC 9(09) VALUE 4000.      01480088
014900                                                                  01490064
015000 01  PV-PROGRAM-VARIABLES.                                        01500064
015100     05  PV-CURRENT-TMST               PIC X(26)  VALUE SPACES.   01510064
015200     05  PV-BACK-DATE                  PIC X(10)  VALUE SPACES.   01520064
015300     05  PV-FORWARD-DATE               PIC X(10)  VALUE SPACES.   01530064
015400     05  PV-BACK-DAYS                  PIC S9(3)  COMP VALUE 0.   01540064
015500     05  PV-FORWARD-DAYS               PIC S9(3)  COMP VALUE 0.   01550064
015600     05  PV-SUM-TALLPLN-SPLITS         PIC S9(9)  COMP VALUE 0.   01560064
015700     05  PV-SAVE-PO-NBR                PIC S9(9)  COMP VALUE 0.   01570064
015800     05  PV-CMIT-PO-NBR                PIC S9(9)  COMP VALUE 0.   01580064
015900     05  PV-SAVE-ENT-ID                PIC 9(09)  VALUE ZEROES.   01590064
016000     05  PV-SAVE-VEND-ID               PIC 9(09)  VALUE ZEROES.   01600064
016100     05  PV-SAVE-DC-NBR                PIC 9(04)  VALUE ZEROES.   01610064
016200     05  PV-DUMMY                      PIC S9(4)  COMP VALUE 0.   01620064
016300     05  PV-CKPT-STAT-CODE             PIC X(01)  VALUE SPACE.    01630064
016400     05  PV-PARAGRAPH-NAME             PIC X(30)  VALUE SPACES.   01640064
016500     05  PV-RETRY-COUNTER              PIC S9(4)  COMP VALUE 0.   01650064
016600     05  PV-DB2-OPERATION-MESSAGE      PIC X(79)  VALUE SPACES.   01660064
016700     05  PV-DB2-TABLE-NAME-1           PIC X(18)  VALUE SPACES.   01670064
016800     05  PV-DB2-TABLE-NAME-2           PIC X(18)  VALUE SPACES.   01680064
016900     05  PV-DB2-TABLE-NAME-3           PIC X(18)  VALUE SPACES.   01690064
017000     05  PV-TOTAL-FILE-REC-COUNT       PIC S9(9)  COMP VALUE 0.   01700064
017100     05  PV-TOTAL-MANU-PO-COUNT        PIC S9(9)  COMP VALUE 0.   01710064
017200     05  PV-TOTAL-KOHL-PO-COUNT        PIC S9(9)  COMP VALUE 0.   01720064
017300     05  PV-TOTAL-VENDORS              PIC S9(9)  COMP VALUE 0.   01730064
017400     05  PV-FINAL-HDR-DTL-COUNT        PIC S9(9)  COMP VALUE 0.   01740064
017500     05  PV-NBR-OF-ADDS                PIC S9(9)  COMP VALUE 0.   01750064
017600     05  PV-NBR-OF-CHANGES             PIC S9(9)  COMP VALUE 0.   01760064
017700     05  PV-ADDS-PLUS-CHANGES          PIC S9(9)  COMP VALUE 0.   01770064
017800     05  PV-TABLE-STORE-COUNT          PIC S9(05) VALUE ZERO      01780064
017900                                                  COMP-3.         01790064
018000     05  PV-REQ-LATE-DELY-DTE          PIC X(10)  VALUE SPACES.   01800064
018100     05  PV-ERROR-MESSAGE-1            PIC X(60)  VALUE SPACES.   01810087
018200     05  PV-ERROR-MESSAGE-2            PIC X(60)  VALUE SPACES.   01820087
018300     05  PV-ENTID-LEFT                 PIC 9(05)  VALUE ZEROES.   01830087
018400     05  PV-TOT-ENT-ID-COUNT           PIC 9(05)  VALUE ZEROES.   01840087
018500     05  PV-DISP-ENT-ID                PIC Z(4)9  VALUE ZEROES.   01850087
018600     05  PV-REC-COUNT                  PIC 9(09)  VALUE ZEROS.    01860087
018700     05  PV-REC-COUNT-HOLD             PIC 9(09)  VALUE ZEROS.    01870087
018800     05  PV-PO-NBR-HOLD                PIC 9(09)  VALUE ZEROS.    01880087
018900                                                                  01890064
019000 01  PV-UPDATE-VARIABLES.                                         01900064
019100     05 PV-UPDATE-PO-NBR               PIC  S9(09) COMP.          01910064
019200     05 PV-UPDATE-DC-NBR               PIC  S9(04) COMP.          01920064
019300     05 PV-UPDATE-ENT-ID               PIC  S9(09) COMP.          01930064
019400     05 PV-UPDATE-STRT-SHIP-DTE        PIC   X(10) VALUE SPACES.  01940064
019500     05 PV-UPDATE-CNCL-DTE             PIC   X(10) VALUE SPACES.  01950064
019600     05 PV-UPDATE-NW-STR-PO-IND        PIC   X(01) VALUE SPACES.  01960064
019700     05 PV-UPDATE-DC-ALLOC-QTY         PIC  S9(09) COMP.          01970064
019800     05 PV-UPDATE-STR-ALLOC-PO-IND     PIC   X(01) VALUE SPACES.  01980064
019900     05 PV-UPDATE-PO-STAT-CDE          PIC   X(02) VALUE SPACES.  01990064
020000     05 PV-UPDATE-DC-QTY-CHGD-CDE      PIC   X(01) VALUE SPACES.  02000064
020100     05 PV-UPDATE-PO-STAT-CHGD-IND     PIC   X(01) VALUE SPACES.  02010064
020200     05 PV-UPDATE-DC-DROP-IND          PIC   X(01) VALUE SPACES.  02020064
020300     05 PV-UPDATE-MANU-DAT-LOD-TMST    PIC   X(26) VALUE SPACES.  02030064
020400     05 PV-UPDATE-LAST-UPD-TMST        PIC   X(26) VALUE SPACES.  02040064
020500     05 PV-UPDATE-ENT-NM               PIC   X(30) VALUE SPACES.  02050064
020600     05 PV-UPDATE-SEASET-SHRT-NM       PIC   X(05) VALUE SPACES.  02060064
020700     05 PV-UPDATE-DTE-CHGD-IND         PIC   X(01) VALUE SPACES.  02070064
020800     05 PV-UPDATE-NW-STR-CHGD-IND      PIC   X(01) VALUE SPACES.  02080064
020900     05 PV-UPDATE-SEASET-CHGD-IND      PIC   X(01) VALUE SPACES.  02090064
021000     05 PV-UPDATE-STR-ALLOC-CHGD-IND   PIC   X(01) VALUE SPACES.  02100064
021100     05 PV-UPDATE-INIT-PO-LOD-IND      PIC   X(01) VALUE SPACES.  02110064
021200* WR40574 START                                                   02120064
021300     05 PV-UPDATE-DEPT-NBR-PACKED      PIC   S9(4)V COMP-3.       02130064
021400     05 PV-UPDATE-DEPT-NBR             PIC   X(03) VALUE ZEROS.   02140064
021500     05 PV-UPDATE-DEPT-NBR-N REDEFINES                            02150064
021600        PV-UPDATE-DEPT-NBR             PIC   9(03)V.              02160064
021700     05 PV-UPDATE-DEPT-NBR-CHGD-IND    PIC   X(01) VALUE SPACES.  02170064
021800     05 PV-UPDATE-MIN-CL-NBR-PACKED    PIC   S9(4)V COMP-3.       02180064
021900     05 PV-UPDATE-MIN-CL-NBR           PIC   X(04) VALUE ZEROS.   02190064
022000     05 PV-UPDATE-MIN-CL-NBR-N REDEFINES                          02200064
022100        PV-UPDATE-MIN-CL-NBR           PIC   9(04)V.              02210064
022200     05 PV-UPDATE-MIN-CL-NBR-CHGD-IND  PIC   X(01) VALUE SPACES.  02220064
022300* WR40574 END                                                     02230064
022400                                                                  02240064
022500 01  CC-CONTROL-PROCESS-ENT-IDS.                                  02250064
022600     05  CC-DAYS-FORWARD               PIC X(03)  VALUE SPACES.   02260064
022700     05  CC-DAYS-BACK                  PIC X(03)  VALUE SPACES.   02270064
022800     05  CC-ENT-ID-PROCESS-IND         PIC X(01).                 02280064
022900         88  CC-INCLUDE-ENT-IDS                   VALUE 'I'.      02290064
023000         88  CC-EXCLUDE-ENT-IDS                   VALUE 'E'.      02300064
023100     05  FILLER                        PIC X(73)  VALUE SPACES.   02310064
023200                                                                  02320064
023300 01  VALID-ENT-ID-TABLE.                                          02330064
023400*    05  VALID-ENT-IDS             OCCURS 3000 TIMES              02340082
023500     05  VALID-ENT-IDS             OCCURS 10000 TIMES             02350082
023600                                      DEPENDING ON                02360064
023700                                      PV-TABLE-STORE-COUNT        02370064
023800                                      ASCENDING KEY IS ENT-ID     02380064
023900                                      INDEXED BY ENT-IDX.         02390064
024000         10  ENT-ID                      PIC 9(09)  VALUE ZEROES. 02400064
024100         10  FILLER                      PIC X(291) VALUE SPACE.  02410064
024200                                                                  02420064
024300 01  PV-REFORMATED-DATE.                                          02430064
024400     05  PV-REFORMAT-MONTH             PIC X(02)  VALUE SPACES.   02440064
024500     05  FILLER                        PIC X(01)  VALUE '/'.      02450064
024600     05  PV-REFORMAT-DAY               PIC X(02)  VALUE SPACES.   02460064
024700     05  FILLER                        PIC X(01)  VALUE '/'.      02470064
024800     05  PV-REFORMAT-YEAR              PIC X(04)  VALUE SPACES.   02480064
024900                                                                  02490064
025000 01  PV-NUM-DATE.                                                 02500064
025100     05  PV-YEAR                       PIC 9(04)  VALUE ZEROS.    02510064
025200     05  PV-MONTH                      PIC 9(02)  VALUE ZEROS.    02520064
025300     05  PV-DAY                        PIC 9(02)  VALUE ZEROS.    02530064
025400                                                                  02540064
025500 01  WS-COUNTER.                                                  02550064
025600     05  WS-HOLD-TMST                  PIC X(26)  VALUE SPACES.   02560064
025700     05  WS-TMST                       PIC X(26)  VALUE SPACES.   02570064
025800                                                                  02580064
025900 01  CKPT-RESTART-INFO.                                           02590064
026000     05  CR-LAST-RUN-TIMESTAMP         PIC X(26)  VALUE ZERO.     02600064
026100     05  CR-LAST-RUN-RECS-PRCD         PIC 9(09)  VALUE ZEROS.    02610087
026200                                                                  02620064
026300 01  ABEND-CODE                        PIC S9(04) VALUE ZEROS     02630064
026400                                                  COMP SYNC.      02640064
026500     88  PC-CONTROL-CARD-ERROR                    VALUE +4001.    02650064
026600     88  PC-TABLESIZE-WARNING                     VALUE +4008.    02660082
026700     88  PC-DB2-ERROR                             VALUE +4013.    02670064
026800     88  PC-OTHER-ERROR                           VALUE +4014.    02680082
026900                                                                  02690064
027000*---------------------------------------------------------------* 02700064
027100*  PO HEADER AND PO/DC DETAIL FILE LAYOUT                         02710064
027200*---------------------------------------------------------------* 02720064
027300     COPY TRRD302.                                                02730064
027400*---------------------------------------------------------------* 02740064
027500*    DB2 AREA FOR TRT_MANU_PO_EXTR                              * 02750064
027600*---------------------------------------------------------------* 02760064
027700     EXEC SQL                                                     02770064
027800          INCLUDE TRT00000                                        02780064
027900     END-EXEC.                                                    02790064
028000*---------------------------------------------------------------* 02800064
028100*    DB2 AREA FOR TRT_MANU_PO_HIST                              * 02810064
028200*---------------------------------------------------------------* 02820064
028300     EXEC SQL                                                     02830064
028400          INCLUDE TRT00001                                        02840064
028500     END-EXEC.                                                    02850064
028600*----------------------------------------------------------------*02860064
028700*      TCKRSTCNTL TABLE LAYOUT                                    02870064
028800*----------------------------------------------------------------*02880064
028900     EXEC SQL                                                     02890064
029000          INCLUDE TCKRSTCN                                        02900064
029100     END-EXEC.                                                    02910064
029200*----------------------------------------------------------------*02920064
029300*      TCKRSTINF TABLE LAYOUT                                     02930064
029400*----------------------------------------------------------------*02940064
029500     EXEC SQL                                                     02950064
029600          INCLUDE TCKRSTIN                                        02960064
029700     END-EXEC.                                                    02970064
029800*---------------------------------------------------------------* 02980064
029900*    DB2 AREA FOR TPURCHS                                       * 02990064
030000*---------------------------------------------------------------* 03000064
030100     EXEC SQL                                                     03010064
030200          INCLUDE TPURCHS                                         03020064
030300     END-EXEC.                                                    03030064
030400*---------------------------------------------------------------* 03040064
030500*    DB2 AREA FOR TPLNSHP                                       * 03050064
030600*---------------------------------------------------------------* 03060064
030700     EXEC SQL                                                     03070064
030800          INCLUDE TPLNSHP                                         03080064
030900     END-EXEC.                                                    03090064
031000*---------------------------------------------------------------* 03100064
031100*    DB2 AREA FOR TALLPLN                                       * 03110064
031200*---------------------------------------------------------------* 03120064
031300     EXEC SQL                                                     03130064
031400          INCLUDE TALLPLN                                         03140064
031500     END-EXEC.                                                    03150064
031600*---------------------------------------------------------------* 03160064
031700*    DB2 AREA FOR TIMCNTL                                       * 03170064
031800*---------------------------------------------------------------* 03180064
031900     EXEC SQL                                                     03190064
032000          INCLUDE TIMCNTL                                         03200064
032100     END-EXEC.                                                    03210064
032200*---------------------------------------------------------------* 03220064
032300*    DB2 AREA FOR TENTNME                                       * 03230064
032400*---------------------------------------------------------------* 03240064
032500     EXEC SQL                                                     03250064
032600          INCLUDE TENTNME                                         03260064
032700     END-EXEC.                                                    03270064
032800*---------------------------------------------------------------* 03280064
032900*    DB2 AREA FOR TMESTDS                                       * 03290064
033000*---------------------------------------------------------------* 03300064
033100     EXEC SQL                                                     03310064
033200          INCLUDE TMESTDS                                         03320064
033300     END-EXEC.                                                    03330064
033400*---------------------------------------------------------------* 03340064
033500*    DB2 AREA FOR TPURITM                                       * 03350064
033600*---------------------------------------------------------------* 03360064
033700     EXEC SQL                                                     03370064
033800          INCLUDE TPURITM                                         03380064
033900     END-EXEC.                                                    03390064
034000* WR40574 START                                                   03400064
034100*---------------------------------------------------------------* 03410064
034200*    DB2 AREA FOR XLT_VND_STYL                                  * 03420064
034300*---------------------------------------------------------------* 03430064
034400     EXEC SQL                                                     03440064
034500          INCLUDE XLT00004                                        03450064
034600     END-EXEC.                                                    03460064
034700*---------------------------------------------------------------* 03470064
034800*    DB2 AREA FOR XLT_SKU                                       * 03480064
034900*---------------------------------------------------------------* 03490064
035000     EXEC SQL                                                     03500064
035100          INCLUDE XLT00003                                        03510064
035200     END-EXEC.                                                    03520064
035300* WR40574 END                                                     03530064
035400*---------------------------------------------------------------* 03540064
035500*  ABEND PROCESSING COPYBOOK.                                    *03550064
035600*---------------------------------------------------------------* 03560064
035700     COPY DPWS004.                                                03570064
035800*---------------------------------------------------------------* 03580064
035900*  DB2 COMMUNICATION AREA.                                        03590064
036000*---------------------------------------------------------------* 03600064
036100     EXEC SQL                                                     03610064
036200         INCLUDE SQLCA                                            03620064
036300     END-EXEC.                                                    03630064
036400                                                                  03640064
036500*---------------------------------------------------------------* 03650064
036600* THE PURPOSE OF THIS CURSOR IS TO BRING BACK THE VENDOR ID'S     03660064
036700* AND PO INFORAMTION WHERE THERE HAS BEEN AN ADD OR A CHANGE MADE 03670064
036800* TO A PO WITHIN THE START AND END TIMESTAMP RANGE AND ALSO       03680064
036900* WITHIN A 35 DAY WINDOW.                                         03690064
037000*---------------------------------------------------------------* 03700064
037100* WR40574 ADDED A.DEPT_NBR AND MIN(F.MAJ_CL_NBR) BELOW            03710064
037200     EXEC SQL                                                     03720064
037300          DECLARE PO-ENT-ID-CSR CURSOR WITH HOLD FOR              03730064
037400           SELECT A.PO_NBR                                        03740064
037500                 ,C.DEST_NBR                                      03750064
037600                 ,A.STATUS_CDE                                    03760064
037700                 ,A.NEW_STR_PO_IND                                03770064
037800                 ,A.SEASET_SHRT_NM                                03780064
037900                 ,B.DONT_SHIP_BEF_DTE                             03790064
038000                 ,B.CAN_IFNOT_SHIP_DTE                            03800064
038100                 ,B.EXT_CAN_DTE                                   03810064
038200                 ,A.ENT_ID                                        03820064
038300                 ,A.DEPT_NBR                                      03830064
038400                 ,MIN(F.MAJ_CL_NBR)                               03840064
038500                 ,SUM(C.CURR_SPLIT_QTY)                           03850064
038600           FROM                                                   03860064
038700                  TPURCHS A,                                      03870064
038800                  TPLNSHP B,                                      03880064
038900                  TALLPLN C,                                      03890064
039000                  TPURITM D,                                      03900064
039100                  XLT_SKU E,                                      03910064
039200                  XLT_VND_STYL F                                  03920064
039300           WHERE                                                  03930064
039400                  A.PO_NBR         = B.PO_NBR                     03940064
039500             AND  A.PO_NBR         = C.PO_NBR                     03950064
039600             AND  A.PO_NBR         = D.PO_NBR                     03960064
039700             AND  A.VER_STATUS_CDE = 'A'                          03970064
039800             AND  B.VER_STATUS_CDE = 'A'                          03980064
039900             AND  D.VER_STATUS_CDE = 'A'                          03990064
                   AND B.FOB_POINT_TXT = B.FOB_POINT_TXT                03991099
                   AND A.PO_NBR = A.PO_NBR                              03992099
040000             AND  A.PO_TYP_CDE      IN ('IN','SM','SP','ST',      04000064
BARB                                'VN','EC','FB','CD','RE','VE')      04010099
040200             AND  A.STATUS_CDE      IN ('AC','AP','CA','CM')      04020064
040300             AND  D.STATUS_CDE      IN ('AC','AP','CM','CB','CA') 04030064
040400             AND  C.PO_LNE_NBR     = D.PO_LNE_NBR                 04040064
040500             AND  D.ITM_NBR        = E.ITM_NBR                    04050064
040600             AND  E.STYL_ID        = F.STYL_ID                    04060064
040700             AND                                                  04070064
040800             (    B.DONT_SHIP_BEF_DTE  BETWEEN                    04080064
040900                                       DATE(:PV-BACK-DATE) AND    04090064
041000                                       DATE(:PV-FORWARD-DATE)     04100064
041100                OR                                                04110064
041200                  B.EXT_CAN_DTE        BETWEEN                    04120064
041300                                       DATE(:PV-BACK-DATE) AND    04130064
041400                                       DATE(:PV-FORWARD-DATE)     04140064
041500                OR                                                04150064
041600                 (B.EXT_CAN_DTE      = :PC-DEFAULT-DATE           04160064
041700                    AND                                           04170064
041800                  B.CAN_IFNOT_SHIP_DTE BETWEEN                    04180064
041900                                       DATE(:PV-BACK-DATE) AND    04190064
042000                                       DATE(:PV-FORWARD-DATE))    04200064
042100             )                                                    04210064
042200                                                                  04220064
042300             GROUP BY  A.PO_NBR                                   04230064
042400                      ,C.DEST_NBR                                 04240064
042500                      ,A.STATUS_CDE                               04250064
042600                      ,A.NEW_STR_PO_IND                           04260064
042700                      ,A.SEASET_SHRT_NM                           04270064
042800                      ,B.DONT_SHIP_BEF_DTE                        04280064
042900                      ,B.CAN_IFNOT_SHIP_DTE                       04290064
043000                      ,B.EXT_CAN_DTE                              04300064
043100                      ,A.ENT_ID                                   04310064
043200                      ,A.DEPT_NBR                                 04320064
043300             ORDER BY 1, 2                                        04330064
043400             WITH UR                                              04340064
043500     END-EXEC.                                                    04350064
043600                                                                  04360064
043700*---------------------------------------------------------------* 04370064
043800*                                                                 04380064
043900*---------------------------------------------------------------* 04390064
044000* WR40574 ADDED A.DEPT_NBR AND MIN(D.CL_NBR) BELOW                04400064
044100     EXEC SQL                                                     04410064
044200          DECLARE DC-DROP-CSR CURSOR WITH HOLD FOR                04420064
044300           SELECT PO_NBR                                          04430064
044400                 ,DC_NBR                                          04440064
044500                 ,ENT_ID                                          04450064
044600                 ,STRT_SHIP_DTE                                   04460064
044700                 ,CNCL_DTE                                        04470064
044800                 ,NW_STR_PO_IND                                   04480064
044900                 ,DC_ALLOC_QTY                                    04490064
045000                 ,STR_ALLOC_PO_IND                                04500064
045100                 ,PO_STAT_CDE                                     04510064
045200                 ,DC_QTY_CHGD_CDE                                 04520064
045300                 ,PO_STAT_CHGD_IND                                04530064
045400                 ,DC_DROP_IND                                     04540064
045500                 ,MANU_DAT_LOD_TMST                               04550064
045600                 ,LAST_UPD_TMST                                   04560064
045700                 ,ENT_NM                                          04570064
045800                 ,SEASET_SHRT_NM                                  04580064
045900                 ,DTE_CHGD_IND                                    04590064
046000                 ,NW_STR_PO_CHGD_IND                              04600064
046100                 ,SEASET_CHGD_IND                                 04610064
046200                 ,STR_ALLOC_CHGD_IND                              04620064
046300                 ,INIT_PO_LOD_IND                                 04630064
046400                 ,(CNCL_DTE + 1 YEARS)                            04640064
046500                 ,DEPT_NBR                                        04650064
046600                 ,DEPT_NBR_CHGD_IND                               04660064
046700                 ,MIN_CL_NBR                                      04670064
046800                 ,MIN_CL_NBR_CHGD_IND                             04680064
046900           FROM   TRT_MANU_PO_EXTR                                04690064
047000     END-EXEC.                                                    04700064
047100                                                                  04710064
047200*---------------------------------------------------------------* 04720064
047300*                                                                 04730064
047400*---------------------------------------------------------------* 04740064
047500* WR40574 ADDED A.DEPT_NBR AND MIN(D.CL_NBR) BELOW                04750064
047600     EXEC SQL                                                     04760064
047700          DECLARE CREATE-OUTPUT-CSR CURSOR WITH HOLD FOR          04770064
047800           SELECT PO_NBR                                          04780064
047900                 ,DC_NBR                                          04790064
048000                 ,ENT_ID                                          04800064
048100                 ,STRT_SHIP_DTE                                   04810064
048200                 ,CNCL_DTE                                        04820064
048300                 ,NW_STR_PO_IND                                   04830064
048400                 ,DC_ALLOC_QTY                                    04840064
048500                 ,STR_ALLOC_PO_IND                                04850064
048600                 ,PO_STAT_CDE                                     04860064
048700                 ,DC_QTY_CHGD_CDE                                 04870064
048800                 ,PO_STAT_CHGD_IND                                04880064
048900                 ,DC_DROP_IND                                     04890064
049000                 ,MANU_DAT_LOD_TMST                               04900064
049100                 ,LAST_UPD_TMST                                   04910064
049200                 ,ENT_NM                                          04920064
049300                 ,SEASET_SHRT_NM                                  04930064
049400                 ,DTE_CHGD_IND                                    04940064
049500                 ,NW_STR_PO_CHGD_IND                              04950064
049600                 ,SEASET_CHGD_IND                                 04960064
049700                 ,STR_ALLOC_CHGD_IND                              04970064
049800                 ,INIT_PO_LOD_IND                                 04980064
049900                 ,(CNCL_DTE + 1 YEARS)                            04990064
050000                 ,DEPT_NBR                                        05000064
050100                 ,DEPT_NBR_CHGD_IND                               05010064
050200                 ,MIN_CL_NBR                                      05020064
050300                 ,MIN_CL_NBR_CHGD_IND                             05030064
050400           FROM                                                   05040064
050500                  TRT_MANU_PO_EXTR                                05050064
050600           WHERE                                                  05060064
050700                  MANU_DAT_LOD_TMST = :PV-CURRENT-TMST            05070064
050800           ORDER BY PO_NBR, DC_NBR, ENT_NM,                       05080064
050900                    DEPT_NBR, MIN_CL_NBR                          05090064
051000     END-EXEC.                                                    05100064
051100                                                                  05110064
051200***************************************************************** 05120064
051300 PROCEDURE DIVISION.                                              05130064
051400***************************************************************** 05140064
051500                                                                  05150064
051600*--------------------------------------------------------------*  05160064
051700* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE  *  05170064
051800* PROGRAM.                                                     *  05180064
051900*--------------------------------------------------------------*  05190064
052000 0000-PROGRAM-MAINLINE.                                           05200064
052100                                                                  05210064
052200     PERFORM 1000-INITIALIZE.                                     05220064
052300                                                                  05230064
052400* SET 1                                                           05240064
052500     IF PS-NORMAL-RUN                                             05250064
052600     OR PS-RESTART-STEP-1                                         05260064
052700         PERFORM 3000-OPEN-PO-ENT-ID-CSR                          05270064
052800         PERFORM 2000-PROCESS-PO-CURSOR                           05280064
052900             UNTIL PS-END-OF-POS                                  05290064
053000         PERFORM 3200-CLOSE-PO-ENT-ID-CSR                         05300064
053100     END-IF.                                                      05310064
053200                                                                  05320064
053300* SET 2                                                           05330064
053400     IF PS-NORMAL-RUN                                             05340064
053500     OR PS-RESTART-STEP-1                                         05350064
053600     OR PS-RESTART-STEP-2                                         05360064
053700         PERFORM 4100-OPEN-DC-DROP-CSR                            05370064
053800         PERFORM 4000-PROCESS-DC-DROP-CSR                         05380064
053900             UNTIL PS-END-OF-PO-EXTR-DROP                         05390064
054000         PERFORM 4300-CLOSE-DC-DROP-CSR                           05400064
054100     END-IF.                                                      05410064
054200                                                                  05420064
054300* SET 3                                                           05430064
054400     PERFORM 5100-OPEN-CREATE-OUTPUT-CSR                          05440064
054500     PERFORM 5000-CREATE-OUTPUT-FILE                              05450064
054600         UNTIL PS-END-OF-PO-EXTR-OUT                              05460064
054700     PERFORM 5300-CLOSE-CREATE-OUTPUT-CSR                         05470064
054800                                                                  05480064
054900     PERFORM 6000-EOP-PROCESSING                                  05490064
055000                                                                  05500064
055100     CLOSE TMS-PO-HDR-DTL-FILE                                    05510064
055200           TMS-ENT-ID-FILE                                        05520064
055300           CONTROL-PROCESS-ENT-IDS.                               05530064
055400                                                                  05540085
055500     IF PC-TABLESIZE-WARNING                                      05550085
055600        MOVE ABEND-CODE             TO RETURN-CODE                05560085
055700     END-IF.                                                      05570085
055800                                                                  05580064
055900     GOBACK.                                                      05590064
056000*--------------------------------------------------------------*  05600064
056100 1000-INITIALIZE.                                                 05610064
056200                                                                  05620064
056300     OPEN INPUT  TMS-ENT-ID-FILE                                  05630064
056400          OUTPUT TMS-PO-HDR-DTL-FILE.                             05640064
056500                                                                  05650064
056600*  OPEN AND READ ENT ID CONTROL FILE.                          *  05660064
056700*  IF THE FILE IS EMPTY, ISSUE MESSAGE AND ABEND.              *  05670064
056800     OPEN INPUT CONTROL-PROCESS-ENT-IDS.                          05680064
056900     READ CONTROL-PROCESS-ENT-IDS INTO CC-CONTROL-PROCESS-ENT-IDS 05690064
057000         AT END                                                   05700064
057100           DISPLAY PC-PGM-NAME                                    05710064
057200             ' CONTROL CARD MISSING - FOR ERROR QUEUE NAME'       05720064
057300           SET PC-CONTROL-CARD-ERROR TO TRUE                      05730064
057400           CALL 'ILBOABN0' USING ABEND-CODE.                      05740064
057500                                                                  05750064
057600     MOVE CC-DAYS-FORWARD TO PV-FORWARD-DAYS.                     05760064
057700     MOVE CC-DAYS-BACK    TO PV-BACK-DAYS.                        05770064
057800                                                                  05780064
057900* GET CURRENT TIMESTAMP AND DATE                                  05790064
058000     EXEC SQL                                                     05800064
058100       SET :PV-CURRENT-TMST = CURRENT TIMESTAMP,                  05810099
058200           :PV-BACK-DATE    =                                     05820099
058300                         (CURRENT DATE - :PV-BACK-DAYS DAYS),     05830099
058400           :PV-FORWARD-DATE =                                     05840099
058500                         (CURRENT DATE + :PV-FORWARD-DAYS DAYS)   05850099
058600     END-EXEC.                                                    05860064
058700                                                                  05870064
058800* CHECK TO SEE IF PROGRAM IS RESTARTED                            05880064
058900     PERFORM X300-GET-CHECKPOINT-CNTL.                            05890064
059000     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    05900064
059100     IF PS-NORMAL-RUN                                             05910064
059200         PERFORM 1300-RESET-CHG-INDICATORS                        05920064
059300     ELSE                                                         05930064
059400         PERFORM X200-CHECKPOINT-RESTART                          05940064
059500     END-IF.                                                      05950064
059600                                                                  05960064
059700     PERFORM 1200-FILL-ENT-ID-TABLE.                              05970064
059800                                                                  05980064
059900                                                                  05990064
060000*--------------------------------------------------------------*  06000064
060100* GET THE START TIMESTAMP FOR THE DATE RANGE USED IN THE          06010064
060200* PO-ENT-ID-CSR CURSOR                                            06020064
060300*--------------------------------------------------------------*  06030064
060400 1200-FILL-ENT-ID-TABLE.                                          06040064
060500                                                                  06050064
060600     PERFORM WITH TEST AFTER                                      06060064
060700     VARYING ENT-IDX FROM 1 BY 1                                  06070064
060800     UNTIL PS-END-OF-INPUT                                        06080064
060900         READ TMS-ENT-ID-FILE                                     06090064
061000         INTO VALID-ENT-IDS (ENT-IDX)                             06100064
061100            AT END                                                06110064
061200               SET PS-END-OF-INPUT TO TRUE                        06120064
061300               SET ENT-IDX DOWN BY 1                              06130064
061400         END-READ                                                 06140064
061500         ADD +1 TO PV-TABLE-STORE-COUNT                           06150064
061600         IF ENT-IDX > 10000                                       06160082
061700            MOVE '1200-FILL-ENT-ID-TABLE'                         06170084
061800                                    TO PV-PARAGRAPH-NAME          06180084
061900            MOVE PC-ERROR-MESSAGE-1 TO PV-ERROR-MESSAGE-1         06190082
062000            MOVE PC-ERROR-MESSAGE-2 TO PV-ERROR-MESSAGE-2         06200082
062100            SET PC-OTHER-ERROR      TO TRUE                       06210082
062200            PERFORM 9200-ABEND                                    06220082
062300         END-IF                                                   06230082
062400     END-PERFORM.                                                 06240064
062500     SUBTRACT +1 FROM PV-TABLE-STORE-COUNT.                       06250064
062600     IF ENT-IDX > 9500                                            06260082
062700        MOVE PV-TABLE-STORE-COUNT   TO PV-TOT-ENT-ID-COUNT        06270084
062800        COMPUTE PV-ENTID-LEFT =                                   06280082
062900               (PC-MAX-ENT-IDS) - (PV-TABLE-STORE-COUNT)          06290082
063000        MOVE PV-TOT-ENT-ID-COUNT    TO PV-DISP-ENT-ID             06300084
063100        DISPLAY PC-FORMAT1                                        06310082
063200        DISPLAY 'WARNING! MAX TABLE SIZE IS ABOUT TO REACH'       06320082
063300        DISPLAY PC-FORMAT2                                        06330082
063400        DISPLAY 'MAX NUMBER OF ENT-IDS THAT CAN BE PROCESSED   : '06340082
063500                PC-MAX-ENT-IDS                                    06350082
063600        DISPLAY 'NO OF ENT-IDS PRESENT IN THE INPUT I02 FILE   :' 06360082
063700                PV-DISP-ENT-ID                                    06370082
063800        MOVE PV-ENTID-LEFT          TO PV-DISP-ENT-ID             06380084
063900        DISPLAY 'NO OF ENT-IDS LEFT OUT TO REACH MAX TABLE SIZE:' 06390082
064000             PV-DISP-ENT-ID                                       06400082
064100        DISPLAY PC-FORMAT2                                        06410082
064200        DISPLAY PC-FORMAT1                                        06420082
064300        SET PC-TABLESIZE-WARNING    TO TRUE                       06430084
064400     END-IF.                                                      06440082
064500                                                                  06450064
064600*--------------------------------------------------------------*  06460064
064700* INITIALIZE ALL CHANGE INDICATOR TO N (NO CHANGE) ON EXISTING    06470064
064800* EXTRACT ROW                                                     06480064
064900*--------------------------------------------------------------*  06490064
065000 1300-RESET-CHG-INDICATORS.                                       06500064
065100                                                                  06510099
065200* WR40574 ADDED DEPT_NBR_CHGD_IND AND MIN_CL_NBR_CHGD_IND BELOW   06520064
065300     PERFORM WITH TEST AFTER                                      06530064
065400             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 06540064
065500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         06550064
065600                     SQLCODE = ZERO OR                            06560064
065700                     SQLCODE = +100                               06570064
065800                                                                  06580064
065900         EXEC SQL                                                 06590064
066000            UPDATE TRT_MANU_PO_EXTR                               06600064
066100            SET                                                   06610064
066200                   DC_QTY_CHGD_CDE      = 'N',                    06620064
066300                   PO_STAT_CHGD_IND     = 'N',                    06630064
066400                   DTE_CHGD_IND         = 'N',                    06640064
066500                   NW_STR_PO_CHGD_IND   = 'N',                    06650064
066600                   SEASET_CHGD_IND      = 'N',                    06660064
066700                   STR_ALLOC_CHGD_IND   = 'N',                    06670064
066800                   INIT_PO_LOD_IND      = 'N',                    06680064
066900                   DEPT_NBR_CHGD_IND    = 'N',                    06690064
067000                   MIN_CL_NBR_CHGD_IND  = 'N'                     06700064
067100            WHERE                                                 06710064
067200                   DC_QTY_CHGD_CDE      IN ('I','D')              06720064
067300               OR  PO_STAT_CHGD_IND     = 'Y'                     06730064
067400               OR  DTE_CHGD_IND         = 'Y'                     06740064
067500               OR  NW_STR_PO_CHGD_IND   = 'Y'                     06750064
067600               OR  SEASET_CHGD_IND      = 'Y'                     06760064
067700               OR  STR_ALLOC_CHGD_IND   = 'Y'                     06770064
067800               OR  INIT_PO_LOD_IND      = 'Y'                     06780064
067900               OR  DEPT_NBR_CHGD_IND    = 'Y'                     06790064
068000               OR  MIN_CL_NBR_CHGD_IND  = 'Y'                     06800064
068100         END-EXEC                                                 06810064
068200                                                                  06820064
068300         EVALUATE TRUE                                            06830064
068400             WHEN SQLCODE = ZERO                                  06840064
068500             WHEN SQLCODE = +100                                  06850064
068600                 CONTINUE                                         06860064
068700             WHEN SQLCODE = -904                                  06870064
068800             WHEN SQLCODE = -913                                  06880064
068900                 CONTINUE                                         06890064
069000             WHEN SQLWARN0 NOT = SPACES                           06900064
069100             WHEN SQLCODE < ZERO                                  06910064
069200             WHEN SQLCODE > ZERO                                  06920064
069300                 MOVE '1300-RESET-CHG-INDICATORS'                 06930064
069400                                      TO  PV-PARAGRAPH-NAME       06940064
069500                 MOVE 'ERROR ISSUED ON UPDATE'                    06950064
069600                                      TO  PV-DB2-OPERATION-MESSAGE06960064
069700                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  06970064
069800                 PERFORM 9100-DB2-ABEND                           06980064
069900         END-EVALUATE                                             06990064
070000     END-PERFORM.                                                 07000064
070100                                                                  07010064
070200     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 07020064
070300         MOVE '1300-RESET-CHG-INDICATORS'                         07030064
070400                                 TO  PV-PARAGRAPH-NAME            07040064
070500         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    07050064
070600                                 TO  PV-DB2-OPERATION-MESSAGE     07060064
070700         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          07070064
070800         PERFORM 9100-DB2-ABEND                                   07080064
070900     END-IF.                                                      07090064
071000                                                                  07100064
071100*--------------------------------------------------------------*  07110064
071200* LOOP THROUGH CURSOR GETTING EACH CHANGED PO AND ALL THE DC      07120064
071300* INFORMATION THAT APPLIES TO THAT PO.                            07130064
071400*--------------------------------------------------------------*  07140064
071500 2000-PROCESS-PO-CURSOR.                                          07150064
071600                                                                  07160064
071700                                                                  07170064
071800* GET PO INFO                                                     07180064
071900     PERFORM 3100-FETCH-PO-ENT-ID-CSR.                            07190064
072000*                                                                 07200087
072100* PROCESS IF RECORD LIMIT HAS NOT CROSSED                         07210087
072200     IF PV-REC-COUNT >= PC-REC-LIMIT                              07220087
072300        AND PURCHS-PO-NBR NOT = PV-PO-NBR-HOLD                    07230087
072400             SET PC-RESTART-STEP-2   TO TRUE                      07240087
072500             MOVE PC-RESTART-STEP    TO PV-CKPT-STAT-CODE         07250087
072600             PERFORM X600-UPDATE-TCKRSTCNTL                       07260087
072700             PERFORM X700-UPDATE-TCKRSTINF                        07270087
072800             PERFORM Y100-COMMIT                                  07280087
072900             PERFORM X500-SET-CHECKPOINT-TIME                     07290087
073000     ELSE                                                         07300087
073100             MOVE PURCHS-PO-NBR      TO PV-PO-NBR-HOLD            07310087
073200* VALIDATE ENT ID                                                 07320064
073300     IF PV-TABLE-STORE-COUNT GREATER THAN ZERO                    07330064
073400         IF PURCHS-ENT-ID = PV-SAVE-ENT-ID                        07340064
073500             CONTINUE                                             07350064
073600         ELSE                                                     07360064
073700             PERFORM 2100-VALIDATE-ENT-ID                         07370064
073800         END-IF                                                   07380064
073900     END-IF                                                       07390087
074000                                                                  07400064
074100* CHECK IF COMMIT IS TO BE TAKEN                                  07410064
074200     IF  PURCHS-PO-NBR = PV-CMIT-PO-NBR                           07420064
074300         CONTINUE                                                 07430064
074400     ELSE                                                         07440064
074500         IF PS-END-OF-POS                                         07450064
074600             SET PC-RESTART-STEP-2   TO TRUE                      07460064
074700             MOVE PC-RESTART-STEP    TO PV-CKPT-STAT-CODE         07470064
074800             PERFORM X600-UPDATE-TCKRSTCNTL                       07480064
074900             PERFORM X700-UPDATE-TCKRSTINF                        07490064
075000             PERFORM Y100-COMMIT                                  07500064
075100             PERFORM X500-SET-CHECKPOINT-TIME                     07510064
075200         ELSE                                                     07520064
075300             IF PS-ENT-ID-VALID                                   07530064
075400                 PERFORM X100-CHECKPOINT-CHECK                    07540064
075500                 MOVE PURCHS-PO-NBR TO PV-CMIT-PO-NBR             07550064
075600             END-IF                                               07560064
075700         END-IF                                                   07570064
075800     END-IF                                                       07580087
075900                                                                  07590064
076000* IF ENT ID IS VALID PROCESS PO INFO                              07600064
076100     IF PS-ENT-ID-VALID                                           07610064
076200         PERFORM 2200-GET-MANU-CHANGES                            07620064
076300         IF  PS-PO-EXTR-NOT-FOUND                                 07630064
076400         AND PURCHS-STATUS-CDE = ('AC' OR 'AP')                   07640064
076500              PERFORM 2210-CHECK-HIST-TABLE                       07650064
076600              IF PS-PO-HIST-FOUND                                 07660064
076700                  PERFORM 2220-MOVE-HIST-TO-EXTR                  07670064
076800                  PERFORM 2200-GET-MANU-CHANGES                   07680064
076900              END-IF                                              07690064
077000         END-IF                                                   07700064
077100                                                                  07710064
077200         IF PS-PO-EXTR-FOUND                                      07720064
077300             MOVE DCLTRT00000      TO PV-UPDATE-VARIABLES         07730064
077400             SET PS-DONT-DO-UPDATE TO TRUE                        07740064
077500             PERFORM 2300-PO-STATUS-CHANGES                       07750064
077600             PERFORM 2400-PO-DATE-CHANGES                         07760064
077700             PERFORM 2500-DC-ADDED-OR-DROPPED                     07770064
077800             IF PS-DO-UPDATE                                      07780064
077900                 PERFORM 2600-UPDATE-EXTR-TABLES                  07790064
078000             END-IF                                               07800064
078100         ELSE                                                     07810064
078200             IF PURCHS-STATUS-CDE = ('AC' OR 'AP')                07820064
078300                 PERFORM 2700-INSERT-TO-EXTR-TABLE                07830064
078400             END-IF                                               07840064
078500         END-IF                                                   07850064
078600     END-IF                                                       07860087
078700     END-IF.                                                      07870087
078800                                                                  07880064
078900*--------------------------------------------------------------*  07890064
079000*                                                                 07900064
079100*--------------------------------------------------------------*  07910064
079200 2100-VALIDATE-ENT-ID.                                            07920064
079300                                                                  07930064
079400     MOVE PURCHS-ENT-ID TO PV-SAVE-ENT-ID.                        07940064
079500                                                                  07950064
079600     SEARCH ALL VALID-ENT-IDS                                     07960064
079700       AT END                                                     07970064
079800           IF CC-INCLUDE-ENT-IDS                                  07980064
079900               SET PS-ENT-ID-NOT-VALID TO TRUE                    07990064
080000           ELSE                                                   08000064
080100               SET PS-ENT-ID-VALID TO TRUE                        08010064
080200           END-IF                                                 08020064
080300       WHEN ENT-ID (ENT-IDX) = PV-SAVE-ENT-ID                     08030064
080400           IF CC-INCLUDE-ENT-IDS                                  08040064
080500               SET PS-ENT-ID-VALID TO TRUE                        08050064
080600           ELSE                                                   08060064
080700               SET PS-ENT-ID-NOT-VALID TO TRUE                    08070064
080800           END-IF.                                                08080064
080900                                                                  08090064
081000*--------------------------------------------------------------*  08100064
081100* GET EXISTING EXTRACT ROW THAT WILL BE USED TO COMPARE TO INPUT  08110064
081200*--------------------------------------------------------------*  08120064
081300 2200-GET-MANU-CHANGES.                                           08130064
081400                                                                  08140064
081500* WR40574 ADDED DEPT_NBR AND MIN_CL_NBR BELOW                     08150064
081600     MOVE PURCHS-DEPT-NBR        TO PV-UPDATE-DEPT-NBR.           08160064
081700     MOVE +0                     TO PV-UPDATE-DEPT-NBR-PACKED.    08170064
081800     ADD  PV-UPDATE-DEPT-NBR-N   TO PV-UPDATE-DEPT-NBR-PACKED.    08180064
081900                                                                  08190064
082000     IF XLT00004-MAJ-CL-NBR = ZERO                                08200064
082100         DISPLAY 'ZERO MAJ CLASS FOR ' PURCHS-PO-NBR              08210064
082200                 ' '                   ALLPLN-DEST-NBR            08220064
082300     END-IF.                                                      08230064
082400     MOVE XLT00004-MAJ-CL-NBR     TO PV-UPDATE-MIN-CL-NBR.        08240064
082500     MOVE +0                      TO PV-UPDATE-MIN-CL-NBR-PACKED. 08250064
082600     ADD  PV-UPDATE-MIN-CL-NBR-N  TO PV-UPDATE-MIN-CL-NBR-PACKED. 08260064
082700                                                                  08270064
082800     PERFORM WITH TEST AFTER                                      08280064
082900             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 08290064
083000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         08300064
083100                     SQLCODE = ZERO OR                            08310064
083200                     SQLCODE = +100                               08320064
083300                                                                  08330064
083400         EXEC SQL                                                 08340064
083500            SELECT PO_NBR                                         08350064
083600                  ,DC_NBR                                         08360064
083700                  ,ENT_ID                                         08370064
083800                  ,STRT_SHIP_DTE                                  08380064
083900                  ,CNCL_DTE                                       08390064
084000                  ,NW_STR_PO_IND                                  08400064
084100                  ,DC_ALLOC_QTY                                   08410064
084200                  ,STR_ALLOC_PO_IND                               08420064
084300                  ,PO_STAT_CDE                                    08430064
084400                  ,DC_QTY_CHGD_CDE                                08440064
084500                  ,PO_STAT_CHGD_IND                               08450064
084600                  ,DC_DROP_IND                                    08460064
084700                  ,MANU_DAT_LOD_TMST                              08470064
084800                  ,LAST_UPD_TMST                                  08480064
084900                  ,ENT_NM                                         08490064
085000                  ,SEASET_SHRT_NM                                 08500064
085100                  ,DTE_CHGD_IND                                   08510064
085200                  ,NW_STR_PO_CHGD_IND                             08520064
085300                  ,SEASET_CHGD_IND                                08530064
085400                  ,STR_ALLOC_CHGD_IND                             08540064
085500                  ,INIT_PO_LOD_IND                                08550064
085600                  ,(CNCL_DTE + 1 YEARS)                           08560064
085700                  ,DEPT_NBR                                       08570064
085800                  ,DEPT_NBR_CHGD_IND                              08580064
085900                  ,MIN_CL_NBR                                     08590064
086000                  ,MIN_CL_NBR_CHGD_IND                            08600064
086100            INTO   :TRT00000-PO-NBR                               08610064
086200                  ,:TRT00000-DC-NBR                               08620064
086300                  ,:TRT00000-ENT-ID                               08630064
086400                  ,:TRT00000-STRT-SHIP-DTE                        08640064
086500                  ,:TRT00000-CNCL-DTE                             08650064
086600                  ,:TRT00000-NW-STR-PO-IND                        08660064
086700                  ,:TRT00000-DC-ALLOC-QTY                         08670064
086800                  ,:TRT00000-STR-ALLOC-PO-IND                     08680064
086900                  ,:TRT00000-PO-STAT-CDE                          08690064
087000                  ,:TRT00000-DC-QTY-CHGD-CDE                      08700064
087100                  ,:TRT00000-PO-STAT-CHGD-IND                     08710064
087200                  ,:TRT00000-DC-DROP-IND                          08720064
087300                  ,:TRT00000-MANU-DAT-LOD-TMST                    08730064
087400                  ,:TRT00000-LAST-UPD-TMST                        08740064
087500                  ,:TRT00000-ENT-NM                               08750064
087600                  ,:TRT00000-SEASET-SHRT-NM                       08760064
087700                  ,:TRT00000-DTE-CHGD-IND                         08770064
087800                  ,:TRT00000-NW-STR-PO-CHGD-IND                   08780064
087900                  ,:TRT00000-SEASET-CHGD-IND                      08790064
088000                  ,:TRT00000-STR-ALLOC-CHGD-IND                   08800064
088100                  ,:TRT00000-INIT-PO-LOD-IND                      08810064
088200                  ,:PV-REQ-LATE-DELY-DTE                          08820064
088300                  ,:TRT00000-DEPT-NBR                             08830064
088400                  ,:TRT00000-DEPT-NBR-CHGD-IND                    08840064
088500                  ,:TRT00000-MIN-CL-NBR                           08850064
088600                  ,:TRT00000-MIN-CL-NBR-CHGD-IND                  08860064
088700            FROM   TRT_MANU_PO_EXTR                               08870064
088800            WHERE  PO_NBR     = :PURCHS-PO-NBR                    08880064
088900              AND  DC_NBR     = :ALLPLN-DEST-NBR                  08890064
089000         END-EXEC                                                 08900064
089100                                                                  08910064
089200         EVALUATE TRUE                                            08920064
089300             WHEN SQLCODE = ZERO                                  08930064
089400                 SET PS-PO-EXTR-FOUND TO TRUE                     08940064
089500             WHEN SQLCODE = +100                                  08950064
089600                 SET PS-PO-EXTR-NOT-FOUND TO TRUE                 08960064
089700             WHEN SQLCODE = -904                                  08970064
089800             WHEN SQLCODE = -913                                  08980064
089900                 CONTINUE                                         08990064
090000             WHEN SQLWARN0 NOT = SPACES                           09000064
090100             WHEN SQLCODE < ZERO                                  09010064
090200             WHEN SQLCODE > ZERO                                  09020064
090300                 MOVE '2200-GET-MANU-CHANGES'                     09030064
090400                                      TO  PV-PARAGRAPH-NAME       09040064
090500                 MOVE 'ERROR ISSUED ON SELECT'                    09050064
090600                                      TO  PV-DB2-OPERATION-MESSAGE09060064
090700                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  09070064
090800                 PERFORM 9100-DB2-ABEND                           09080064
090900         END-EVALUATE                                             09090064
091000     END-PERFORM.                                                 09100064
091100                                                                  09110064
091200     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 09120064
091300         MOVE '2200-GET-MANU-CHANGES'                             09130064
091400                                 TO  PV-PARAGRAPH-NAME            09140064
091500         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    09150064
091600                                 TO  PV-DB2-OPERATION-MESSAGE     09160064
091700         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          09170064
091800         PERFORM 9100-DB2-ABEND                                   09180064
091900     END-IF.                                                      09190064
092000                                                                  09200064
092100     SET PS-PO-HIST-NOT-FOUND TO TRUE.                            09210064
092200                                                                  09220064
092300*--------------------------------------------------------------*  09230064
092400*                                                                 09240064
092500*--------------------------------------------------------------*  09250064
092600 2210-CHECK-HIST-TABLE.                                           09260064
092700* WR40574 ADDED DEPT_NBR AND MIN_CL_NBR BELOW                     09270064
092800                                                                  09280064
092900     PERFORM WITH TEST AFTER                                      09290064
093000             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 09300064
093100             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         09310064
093200                     SQLCODE = ZERO OR                            09320064
093300                     SQLCODE = +100 OR                            09330064
093400                     SQLCODE = -811                               09340064
093500                                                                  09350064
093600         EXEC SQL                                                 09360064
093700            SELECT PO_NBR                                         09370064
093800                  ,DC_NBR                                         09380064
093900                  ,ENT_ID                                         09390064
094000                  ,STRT_SHIP_DTE                                  09400064
094100                  ,CNCL_DTE                                       09410064
094200                  ,NW_STR_PO_IND                                  09420064
094300                  ,DC_ALLOC_QTY                                   09430064
094400                  ,STR_ALLOC_PO_IND                               09440064
094500                  ,PO_STAT_CDE                                    09450064
094600                  ,DC_QTY_CHGD_CDE                                09460064
094700                  ,PO_STAT_CHGD_IND                               09470064
094800                  ,DC_DROP_IND                                    09480064
094900                  ,MANU_DAT_LOD_TMST                              09490064
095000                  ,ENT_NM                                         09500064
095100                  ,SEASET_SHRT_NM                                 09510064
095200                  ,DTE_CHGD_IND                                   09520064
095300                  ,NW_STR_PO_CHGD_IND                             09530064
095400                  ,SEASET_CHGD_IND                                09540064
095500                  ,STR_ALLOC_CHGD_IND                             09550064
095600                  ,INIT_PO_LOD_IND                                09560064
095700                  ,DEPT_NBR                                       09570064
095800                  ,DEPT_NBR_CHGD_IND                              09580064
095900                  ,MIN_CL_NBR                                     09590064
096000                  ,MIN_CL_NBR_CHGD_IND                            09600064
096100            INTO   :TRT00001-PO-NBR                               09610064
096200                  ,:TRT00001-DC-NBR                               09620064
096300                  ,:TRT00001-ENT-ID                               09630064
096400                  ,:TRT00001-STRT-SHIP-DTE                        09640064
096500                  ,:TRT00001-CNCL-DTE                             09650064
096600                  ,:TRT00001-NW-STR-PO-IND                        09660064
096700                  ,:TRT00001-DC-ALLOC-QTY                         09670064
096800                  ,:TRT00001-STR-ALLOC-PO-IND                     09680064
096900                  ,:TRT00001-PO-STAT-CDE                          09690064
097000                  ,:TRT00001-DC-QTY-CHGD-CDE                      09700064
097100                  ,:TRT00001-PO-STAT-CHGD-IND                     09710064
097200                  ,:TRT00001-DC-DROP-IND                          09720064
097300                  ,:TRT00001-MANU-DAT-LOD-TMST                    09730064
097400                  ,:TRT00001-ENT-NM                               09740064
097500                  ,:TRT00001-SEASET-SHRT-NM                       09750064
097600                  ,:TRT00001-DTE-CHGD-IND                         09760064
097700                  ,:TRT00001-NW-STR-PO-CHGD-IND                   09770064
097800                  ,:TRT00001-SEASET-CHGD-IND                      09780064
097900                  ,:TRT00001-STR-ALLOC-CHGD-IND                   09790064
098000                  ,:TRT00001-INIT-PO-LOD-IND                      09800064
098100                  ,:TRT00001-DEPT-NBR                             09810064
098200                  ,:TRT00001-DEPT-NBR-CHGD-IND                    09820064
098300                  ,:TRT00001-MIN-CL-NBR                           09830064
098400                  ,:TRT00001-MIN-CL-NBR-CHGD-IND                  09840064
098500            FROM   TRT_MANU_PO_HIST                               09850064
098600            WHERE  PO_NBR     = :PURCHS-PO-NBR                    09860064
098700            AND    DC_NBR     = :ALLPLN-DEST-NBR                  09870064
098800            AND    ENT_ID     = :PURCHS-ENT-ID                    09880070
098900            AND    MANU_DAT_LOD_TMST =                            09890064
099000                               (SELECT MAX(MANU_DAT_LOD_TMST)     09900064
099100                                 FROM  TRT_MANU_PO_HIST           09910064
099200                                 WHERE PO_NBR = :PURCHS-PO-NBR    09920064
099300                                 AND   ENT_ID = :PURCHS-ENT-ID    09930070
099400                                 AND   DC_NBR = :ALLPLN-DEST-NBR) 09940064
099500         END-EXEC                                                 09950064
099600                                                                  09960064
099700         EVALUATE TRUE                                            09970064
099800             WHEN SQLCODE = ZERO                                  09980064
099900             WHEN SQLCODE = -811                                  09990064
100000                 SET PS-PO-HIST-FOUND TO TRUE                     10000064
100100             WHEN SQLCODE = +100                                  10010064
100200                 SET PS-PO-HIST-NOT-FOUND TO TRUE                 10020064
100300             WHEN SQLCODE = -904                                  10030064
100400             WHEN SQLCODE = -913                                  10040064
100500                 CONTINUE                                         10050064
100600             WHEN SQLWARN0 NOT = SPACES                           10060064
100700             WHEN SQLCODE < ZERO                                  10070064
100800             WHEN SQLCODE > ZERO                                  10080064
100900                 MOVE '2210-CHECK-HIST-TABLE'                     10090064
101000                                      TO  PV-PARAGRAPH-NAME       10100064
101100                 MOVE 'ERROR ISSUED ON SELECT'                    10110064
101200                                      TO  PV-DB2-OPERATION-MESSAGE10120064
101300                 MOVE 'TRT_MANU_PO_HIST' TO  PV-DB2-TABLE-NAME-1  10130064
101400                 PERFORM 9100-DB2-ABEND                           10140064
101500         END-EVALUATE                                             10150064
101600     END-PERFORM.                                                 10160064
101700                                                                  10170064
101800     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 10180064
101900         MOVE '2210-CHECK-HIST-TABLE'                             10190064
102000                                 TO  PV-PARAGRAPH-NAME            10200064
102100         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    10210064
102200                                 TO  PV-DB2-OPERATION-MESSAGE     10220064
102300         MOVE 'TRT_MANU_PO_HIST' TO  PV-DB2-TABLE-NAME-1          10230064
102400         PERFORM 9100-DB2-ABEND                                   10240064
102500     END-IF.                                                      10250064
102600                                                                  10260064
102700*--------------------------------------------------------------*  10270064
102800*                                                                 10280064
102900*--------------------------------------------------------------*  10290064
103000 2220-MOVE-HIST-TO-EXTR.                                          10300064
103100* WR40574 ADDED A.DEPT_NBR AND MIN(D.CL_NBR) BELOW                10310064
103200                                                                  10320099
103300     PERFORM WITH TEST AFTER                                      10330064
103400             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 10340064
103500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         10350064
103600                     SQLCODE = ZERO                               10360064
103700                                                                  10370064
103800         EXEC SQL                                                 10380064
103900              INSERT INTO TRT_MANU_PO_EXTR                        10390064
104000                     (PO_NBR                                      10400064
104100                     ,DC_NBR                                      10410064
104200                     ,ENT_ID                                      10420064
104300                     ,STRT_SHIP_DTE                               10430064
104400                     ,CNCL_DTE                                    10440064
104500                     ,NW_STR_PO_IND                               10450064
104600                     ,DC_ALLOC_QTY                                10460064
104700                     ,STR_ALLOC_PO_IND                            10470064
104800                     ,PO_STAT_CDE                                 10480064
104900                     ,DC_QTY_CHGD_CDE                             10490064
105000                     ,PO_STAT_CHGD_IND                            10500064
105100                     ,DC_DROP_IND                                 10510064
105200                     ,MANU_DAT_LOD_TMST                           10520064
105300                     ,LAST_UPD_TMST                               10530064
105400                     ,ENT_NM                                      10540064
105500                     ,SEASET_SHRT_NM                              10550064
105600                     ,DTE_CHGD_IND                                10560064
105700                     ,NW_STR_PO_CHGD_IND                          10570064
105800                     ,SEASET_CHGD_IND                             10580064
105900                     ,STR_ALLOC_CHGD_IND                          10590064
106000                     ,INIT_PO_LOD_IND                             10600064
106100                     ,DEPT_NBR                                    10610064
106200                     ,DEPT_NBR_CHGD_IND                           10620064
106300                     ,MIN_CL_NBR                                  10630064
106400                     ,MIN_CL_NBR_CHGD_IND )                       10640064
106500              VALUES                                              10650064
106600                     (:TRT00001-PO-NBR                            10660064
106700                     ,:TRT00001-DC-NBR                            10670064
106800                     ,:TRT00001-ENT-ID                            10680064
106900                     ,:TRT00001-STRT-SHIP-DTE                     10690064
107000                     ,:TRT00001-CNCL-DTE                          10700064
107100                     ,:TRT00001-NW-STR-PO-IND                     10710064
107200                     ,:TRT00001-DC-ALLOC-QTY                      10720064
107300                     ,:TRT00001-STR-ALLOC-PO-IND                  10730064
107400                     ,:TRT00001-PO-STAT-CDE                       10740064
107500                     ,'I'                                         10750064
107600                     ,'N'                                         10760064
107700                     ,'N'                                         10770064
107800                     ,:PV-CURRENT-TMST                            10780064
107900                     ,:PV-CURRENT-TMST                            10790064
108000                     ,:TRT00001-ENT-NM                            10800064
108100                     ,:TRT00001-SEASET-SHRT-NM                    10810064
108200                     ,'N'                                         10820064
108300                     ,'N'                                         10830064
108400                     ,'N'                                         10840064
108500                     ,'N'                                         10850064
108600                     ,'N'                                         10860064
108700                     ,:TRT00001-DEPT-NBR                          10870064
108800                     ,'N'                                         10880064
108900                     ,:TRT00001-MIN-CL-NBR                        10890064
109000                     ,'N')                                        10900064
109100         END-EXEC                                                 10910064
109200                                                                  10920064
109300         EVALUATE TRUE                                            10930064
109400             WHEN SQLCODE = ZERO                                  10940064
109500                 CONTINUE                                         10950064
109600             WHEN SQLCODE = -904                                  10960064
109700             WHEN SQLCODE = -913                                  10970064
109800                 CONTINUE                                         10980064
109900             WHEN SQLWARN0 NOT = SPACES                           10990064
110000             WHEN SQLCODE < ZERO                                  11000064
110100             WHEN SQLCODE > ZERO                                  11010064
110200                 MOVE '2220-MOVE-HIST-TO-EXTR'                    11020064
110300                                      TO  PV-PARAGRAPH-NAME       11030064
110400                 MOVE 'ERROR ISSUED ON INSERT'                    11040064
110500                                      TO  PV-DB2-OPERATION-MESSAGE11050064
110600                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  11060064
110700                 PERFORM 9100-DB2-ABEND                           11070064
110800                 DISPLAY 'PO NUMBER = ' TRT00001-PO-NBR           11080064
110900                 DISPLAY 'DC NUMBER = ' TRT00001-DC-NBR           11090064
111000                 DISPLAY 'MIN CLASS = ' TRT00001-MIN-CL-NBR       11100064
111100                 DISPLAY 'DEPT      = ' TRT00001-DEPT-NBR         11110064
111200         END-EVALUATE                                             11120064
111300     END-PERFORM.                                                 11130064
111400                                                                  11140064
111500     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 11150064
111600         MOVE '2220-MOVE-HIST-TO-EXTR'                            11160064
111700                                 TO  PV-PARAGRAPH-NAME            11170064
111800         MOVE 'MAX RETRIES EXCEEDED ON INSERT'                    11180064
111900                                 TO  PV-DB2-OPERATION-MESSAGE     11190064
112000         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          11200064
112100         PERFORM 9100-DB2-ABEND                                   11210064
112200     END-IF.                                                      11220064
112300                                                                  11230064
112400*--------------------------------------------------------------*  11240064
112500*                                                                 11250064
112600*--------------------------------------------------------------*  11260064
112700 2300-PO-STATUS-CHANGES.                                          11270064
112800                                                                  11280064
112900     IF TRT00000-PO-STAT-CDE = PURCHS-STATUS-CDE                  11290064
113000         CONTINUE                                                 11300064
113100     ELSE                                                         11310064
113200        SET  PS-DO-UPDATE      TO TRUE                            11320064
113300        MOVE PURCHS-STATUS-CDE TO PV-UPDATE-PO-STAT-CDE           11330064
113400        MOVE 'Y'               TO PV-UPDATE-PO-STAT-CHGD-IND      11340064
113500     END-IF.                                                      11350064
113600                                                                  11360064
113700*--------------------------------------------------------------*  11370064
113800*                                                                 11380064
113900*--------------------------------------------------------------*  11390064
114000 2400-PO-DATE-CHANGES.                                            11400064
114100                                                                  11410064
114200* DONT-SHIP-DEF-DTE                                               11420064
114300     IF TRT00000-STRT-SHIP-DTE = PLNSHP-DONT-SHIP-BEF-DTE         11430064
114400         CONTINUE                                                 11440064
114500     ELSE                                                         11450064
114600        SET PS-DO-UPDATE              TO TRUE                     11460064
114700        MOVE 'Y'                      TO PV-UPDATE-DTE-CHGD-IND   11470064
114800        MOVE PLNSHP-DONT-SHIP-BEF-DTE TO PV-UPDATE-STRT-SHIP-DTE  11480064
114900     END-IF.                                                      11490064
115000                                                                  11500064
115100* EXT-CAN-DTE OR CAN-IFNOT-SHIP-DTE                               11510064
115200     IF PLNSHP-EXT-CAN-DTE = PC-DEFAULT-DATE                      11520064
115300        IF TRT00000-CNCL-DTE = PLNSHP-CAN-IFNOT-SHIP-DTE          11530064
115400            CONTINUE                                              11540064
115500        ELSE                                                      11550064
115600            SET  PS-DO-UPDATE          TO TRUE                    11560064
115700            MOVE 'Y'                   TO PV-UPDATE-DTE-CHGD-IND  11570064
115800            MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-UPDATE-CNCL-DTE  11580064
115900        END-IF                                                    11590064
116000     ELSE                                                         11600064
116100        IF TRT00000-CNCL-DTE = PLNSHP-EXT-CAN-DTE                 11610064
116200            CONTINUE                                              11620064
116300        ELSE                                                      11630064
116400            SET  PS-DO-UPDATE          TO TRUE                    11640064
116500            MOVE 'Y'                   TO PV-UPDATE-DTE-CHGD-IND  11650064
116600            MOVE PLNSHP-EXT-CAN-DTE    TO PV-UPDATE-CNCL-DTE      11660064
116700        END-IF                                                    11670064
116800     END-IF.                                                      11680064
116900                                                                  11690064
117000* CHECK NEW STORE IND                                             11700064
117100**   IF TRT00000-NW-STR-PO-IND = PURCHS-NEW-STR-PO-IND            11710081
117200**       CONTINUE                                                 11720081
117300**   ELSE                                                         11730081
117400**       SET  PS-DO-UPDATE          TO TRUE                       11740081
117500**       MOVE 'Y'                   TO PV-UPDATE-NW-STR-CHGD-IND  11750081
117600**       MOVE PURCHS-NEW-STR-PO-IND TO PV-UPDATE-NW-STR-PO-IND    11760081
117700**   END-IF.                                                      11770081
117800                                                                  11780064
117900* CHECK SEASET SHORT NAME                                         11790064
118000     IF TRT00000-SEASET-SHRT-NM = PURCHS-SEASET-SHRT-NM           11800064
118100         CONTINUE                                                 11810064
118200     ELSE                                                         11820064
118300         SET  PS-DO-UPDATE          TO TRUE                       11830064
118400         MOVE 'Y'                   TO PV-UPDATE-SEASET-CHGD-IND  11840064
118500         MOVE PURCHS-SEASET-SHRT-NM TO PV-UPDATE-SEASET-SHRT-NM   11850064
118600     END-IF.                                                      11860064
118700                                                                  11870064
118800* CHECK FOR STORE ALLOCATION CHANGE                               11880064
118900**   PERFORM 2410-CHECK-STR-ALLOC.                                11890081
119000**   IF TRT00000-STR-ALLOC-PO-IND = PV-UPDATE-STR-ALLOC-PO-IND    11900081
119100**       CONTINUE                                                 11910081
119200**   ELSE                                                         11920081
119300**       SET  PS-DO-UPDATE TO TRUE                                11930081
119400**       MOVE 'Y'          TO PV-UPDATE-STR-ALLOC-CHGD-IND        11940081
119500**   END-IF.                                                      11950081
119600                                                                  11960064
119700* WR40574 START                                                   11970064
119800                                                                  11980064
119900* CHECK FOR DEPT NUMBER CHANGE                                    11990064
120000     MOVE PURCHS-DEPT-NBR TO PV-UPDATE-DEPT-NBR.                  12000064
120100     MOVE +0                   TO PV-UPDATE-DEPT-NBR-PACKED.      12010064
120200     ADD  PV-UPDATE-DEPT-NBR-N TO PV-UPDATE-DEPT-NBR-PACKED.      12020064
120300     IF TRT00000-DEPT-NBR =  PV-UPDATE-DEPT-NBR-PACKED            12030064
120400         MOVE 'N'             TO PV-UPDATE-DEPT-NBR-CHGD-IND      12040064
120500     ELSE                                                         12050064
120600         SET  PS-DO-UPDATE    TO TRUE                             12060064
120700         MOVE 'Y'             TO PV-UPDATE-DEPT-NBR-CHGD-IND      12070064
120800     END-IF.                                                      12080064
120900                                                                  12090064
121000* CHECK FOR LOWEST CLASS NUMBER CHANGE                            12100064
121100     MOVE XLT00004-MAJ-CL-NBR TO PV-UPDATE-MIN-CL-NBR             12110064
121200     MOVE +0                   TO PV-UPDATE-MIN-CL-NBR-PACKED.    12120064
121300     ADD  PV-UPDATE-MIN-CL-NBR-N TO PV-UPDATE-MIN-CL-NBR-PACKED.  12130064
121400     IF TRT00000-MIN-CL-NBR =  XLT00004-MAJ-CL-NBR                12140064
121500         MOVE 'N'               TO PV-UPDATE-MIN-CL-NBR-CHGD-IND  12150064
121600     ELSE                                                         12160064
121700         SET  PS-DO-UPDATE      TO TRUE                           12170064
121800         MOVE 'Y'               TO PV-UPDATE-MIN-CL-NBR-CHGD-IND  12180064
121900     END-IF.                                                      12190064
122000                                                                  12200064
122100* WR40574 END                                                     12210064
122200                                                                  12220064
122300*--------------------------------------------------------------*  12230064
122400*                                                                 12240064
122500*--------------------------------------------------------------*  12250064
122600 2410-CHECK-STR-ALLOC.                                            12260064
122700                                                                  12270064
122800     PERFORM WITH TEST AFTER                                      12280064
122900             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 12290064
123000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         12300064
123100                     SQLCODE = ZERO OR                            12310064
123200                     SQLCODE = +100 OR                            12320064
123300                     SQLCODE = -811                               12330064
123400                                                                  12340064
123500         EXEC SQL                                                 12350064
123600              SELECT 1                                            12360064
123700              INTO   :PV-DUMMY                                    12370064
123800              FROM   TPURITM A                                    12380064
123900              WHERE  A.VER_STATUS_CDE = 'A'                       12390064
124000                AND  A.STATUS_CDE IN ('AC','AP')                  12400064
124100                AND  A.PO_NBR = :PURCHS-PO-NBR                    12410064
124200                AND  NOT EXISTS                                   12420064
124300                        (SELECT 1                                 12430064
124400                         FROM   TMESTDS B                         12440064
124500                         WHERE  A.PO_NBR = B.PO_NBR               12450064
124600                           AND  A.PO_LNE_NBR = B.PO_LNE_NBR)      12460064
124700              FETCH  FIRST 1 ROW ONLY                             12470064
124800         END-EXEC                                                 12480064
124900                                                                  12490064
125000         EVALUATE TRUE                                            12500064
125100             WHEN SQLCODE = ZERO                                  12510064
125200             WHEN SQLCODE = -811                                  12520064
125300                 MOVE 'N' TO PV-UPDATE-STR-ALLOC-PO-IND           12530064
125400             WHEN SQLCODE = +100                                  12540064
125500                 MOVE 'Y' TO PV-UPDATE-STR-ALLOC-PO-IND           12550064
125600             WHEN SQLCODE = -904                                  12560064
125700             WHEN SQLCODE = -913                                  12570064
125800                 CONTINUE                                         12580064
125900             WHEN SQLWARN0 NOT = SPACES                           12590064
126000             WHEN SQLCODE < ZERO                                  12600064
126100             WHEN SQLCODE > ZERO                                  12610064
126200                 MOVE '2410-CHECK-STR-ALLOC'                      12620064
126300                                      TO  PV-PARAGRAPH-NAME       12630064
126400                 MOVE 'ERROR ISSUED ON SELECT'                    12640064
126500                                      TO  PV-DB2-OPERATION-MESSAGE12650064
126600                 MOVE 'TPURITM'       TO  PV-DB2-TABLE-NAME-1     12660064
126700                 MOVE 'TMESTDS'       TO  PV-DB2-TABLE-NAME-2     12670064
126800                 PERFORM 9100-DB2-ABEND                           12680064
126900         END-EVALUATE                                             12690064
127000     END-PERFORM.                                                 12700064
127100                                                                  12710064
127200     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 12720064
127300         MOVE '2410-CHECK-STR-ALLOC'                              12730064
127400                                 TO  PV-PARAGRAPH-NAME            12740064
127500         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    12750064
127600                                 TO  PV-DB2-OPERATION-MESSAGE     12760064
127700         MOVE 'TPURITM'          TO  PV-DB2-TABLE-NAME-1          12770064
127800         MOVE 'TMESTDS'          TO  PV-DB2-TABLE-NAME-2          12780064
127900         PERFORM 9100-DB2-ABEND                                   12790064
128000     END-IF.                                                      12800064
128100                                                                  12810064
128200*--------------------------------------------------------------*  12820064
128300*                                                                 12830064
128400*--------------------------------------------------------------*  12840064
128500 2500-DC-ADDED-OR-DROPPED.                                        12850064
128600                                                                  12860064
128700     IF  PV-SUM-TALLPLN-SPLITS = TRT00000-DC-ALLOC-QTY            12870064
128800         CONTINUE                                                 12880064
128900     ELSE                                                         12890064
129000         IF PV-SUM-TALLPLN-SPLITS > TRT00000-DC-ALLOC-QTY         12900064
129100             PERFORM 2510-SPLIT-QTY-INCREASES                     12910064
129200         ELSE                                                     12920064
129300             PERFORM 2520-SPLIT-QTY-DECREASES                     12930064
129400         END-IF                                                   12940064
129500     END-IF.                                                      12950064
129600                                                                  12960064
129700*--------------------------------------------------------------*  12970064
129800*                                                                 12980064
129900*--------------------------------------------------------------*  12990064
130000 2510-SPLIT-QTY-INCREASES.                                        13000064
130100                                                                  13010064
130200     SET PS-DO-UPDATE           TO TRUE.                          13020064
130300     MOVE PV-SUM-TALLPLN-SPLITS TO PV-UPDATE-DC-ALLOC-QTY.        13030064
130400     MOVE 'I'                   TO PV-UPDATE-DC-QTY-CHGD-CDE.     13040064
130500                                                                  13050064
130600*--------------------------------------------------------------*  13060064
130700*                                                                 13070064
130800*--------------------------------------------------------------*  13080064
130900 2520-SPLIT-QTY-DECREASES.                                        13090064
131000                                                                  13100064
131100     SET PS-DO-UPDATE           TO TRUE.                          13110064
131200     MOVE PV-SUM-TALLPLN-SPLITS TO PV-UPDATE-DC-ALLOC-QTY.        13120064
131300     MOVE 'D'                   TO PV-UPDATE-DC-QTY-CHGD-CDE.     13130064
131400                                                                  13140064
131500*--------------------------------------------------------------*  13150064
131600*                                                                 13160064
131700*--------------------------------------------------------------*  13170064
131800 2600-UPDATE-EXTR-TABLES.                                         13180064
131900                                                                  13190064
132000     ADD +1 TO PV-NBR-OF-CHANGES.                                 13200064
132100                                                                  13210064
132200* WR40574 START                                                   13220064
132300     MOVE +0                     TO PV-UPDATE-DEPT-NBR-PACKED.    13230064
132400     ADD  PV-UPDATE-DEPT-NBR-N   TO PV-UPDATE-DEPT-NBR-PACKED.    13240064
132500                                                                  13250064
132600     MOVE +0                     TO PV-UPDATE-MIN-CL-NBR-PACKED.  13260064
132700     ADD  PV-UPDATE-MIN-CL-NBR-N TO PV-UPDATE-MIN-CL-NBR-PACKED.  13270064
132800* WR40574 END                                                     13280064
132900                                                                  13290064
133000     IF PS-PO-HIST-FOUND                                          13300064
133100         SET PS-PO-HIST-NOT-FOUND TO TRUE                         13310064
133200     ELSE                                                         13320064
133300         PERFORM 2610-HISTORY-UPDATE                              13330064
133400     END-IF.                                                      13340064
133500                                                                  13350064
133600* WR40574 ADDED DEPT_NBR AND MIN_CL_NBR) BELOW                    13360064
133700     PERFORM WITH TEST AFTER                                      13371099
133800             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 13380064
133900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         13390064
134000                     SQLCODE = ZERO                               13400064
134100                                                                  13410064
134200         EXEC SQL                                                 13420064
134300            UPDATE TRT_MANU_PO_EXTR                               13430064
134400            SET STRT_SHIP_DTE      = :PV-UPDATE-STRT-SHIP-DTE,    13440064
134500                CNCL_DTE           = :PV-UPDATE-CNCL-DTE,         13450064
134600                DC_ALLOC_QTY       = :PV-UPDATE-DC-ALLOC-QTY,     13460064
134700                STR_ALLOC_PO_IND   = :PV-UPDATE-STR-ALLOC-PO-IND, 13470064
134800                PO_STAT_CDE        = :PV-UPDATE-PO-STAT-CDE,      13480064
134900                DC_QTY_CHGD_CDE    = :PV-UPDATE-DC-QTY-CHGD-CDE,  13490064
135000                PO_STAT_CHGD_IND   = :PV-UPDATE-PO-STAT-CHGD-IND, 13500064
135100                DC_DROP_IND        = :PV-UPDATE-DC-DROP-IND,      13510064
135200                NW_STR_PO_IND      = :PV-UPDATE-NW-STR-PO-IND,    13520064
135300                MANU_DAT_LOD_TMST  = :PV-CURRENT-TMST,            13530064
135400                LAST_UPD_TMST      = CURRENT TIMESTAMP,           13540064
135500                SEASET_SHRT_NM     = :PV-UPDATE-SEASET-SHRT-NM,   13550064
135600                DTE_CHGD_IND       = :PV-UPDATE-DTE-CHGD-IND,     13560064
135700                NW_STR_PO_CHGD_IND = :PV-UPDATE-NW-STR-CHGD-IND,  13570064
135800                SEASET_CHGD_IND    = :PV-UPDATE-SEASET-CHGD-IND,  13580064
135900                STR_ALLOC_CHGD_IND = :PV-UPDATE-STR-ALLOC-CHGD-IND13590064
136000               ,DEPT_NBR           = :PV-UPDATE-DEPT-NBR-PACKED   13600064
136100               ,DEPT_NBR_CHGD_IND  = :PV-UPDATE-DEPT-NBR-CHGD-IND 13610064
136200               ,MIN_CL_NBR         = :PV-UPDATE-MIN-CL-NBR-PACKED 13620064
136300               ,MIN_CL_NBR_CHGD_IND =                             13630064
136400                                   :PV-UPDATE-MIN-CL-NBR-CHGD-IND 13640064
136500            WHERE PO_NBR            = :TRT00000-PO-NBR            13650064
136600              AND DC_NBR            = :TRT00000-DC-NBR            13660064
136700         END-EXEC                                                 13670064
136800                                                                  13680064
136900         EVALUATE TRUE                                            13690064
137000             WHEN SQLCODE = ZERO                                  13700064
137100                 ADD +1               TO PV-REC-COUNT             13710087
137200                 CONTINUE                                         13720064
137300             WHEN SQLCODE = -904                                  13730064
137400             WHEN SQLCODE = -913                                  13740064
137500                 CONTINUE                                         13750064
137600             WHEN SQLWARN0 NOT = SPACES                           13760064
137700             WHEN SQLCODE < ZERO                                  13770064
137800             WHEN SQLCODE > ZERO                                  13780064
137900                 MOVE '2600-UPDATE-EXTR-TABLES'                   13790064
138000                                      TO  PV-PARAGRAPH-NAME       13800064
138100                 MOVE 'ERROR ISSUED ON UPDATE'                    13810064
138200                                      TO  PV-DB2-OPERATION-MESSAGE13820064
138300                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  13830064
138400                 PERFORM 9100-DB2-ABEND                           13840064
138500         END-EVALUATE                                             13850064
138600     END-PERFORM.                                                 13860064
138700                                                                  13870064
138800     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 13880064
138900         MOVE '2600-UPDATE-EXTR-TABLES'                           13890064
139000                                 TO  PV-PARAGRAPH-NAME            13900064
139100         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    13910064
139200                                 TO  PV-DB2-OPERATION-MESSAGE     13920064
139300         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          13930064
139400         PERFORM 9100-DB2-ABEND                                   13940064
139500     END-IF.                                                      13950064
139600                                                                  13960064
139700*--------------------------------------------------------------*  13970064
139800*                                                                 13980064
139900*--------------------------------------------------------------*  13990064
140000 2610-HISTORY-UPDATE.                                             14000064
140100* WR40574 ADDED DEPT_NBR AND MIN_CL_NBR) BELOW                    14010064
140200                                                                  14020064
140300     PERFORM WITH TEST AFTER                                      14030064
140400             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 14040064
140500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         14050064
140600                     SQLCODE = ZERO                               14060064
140700                                                                  14070064
140800         EXEC SQL                                                 14080064
140900              INSERT INTO TRT_MANU_PO_HIST                        14090064
141000                     (PO_NBR                                      14100064
141100                     ,DC_NBR                                      14110064
141200                     ,CRE_TMST                                    14120064
141300                     ,ENT_ID                                      14130064
141400                     ,STRT_SHIP_DTE                               14140064
141500                     ,CNCL_DTE                                    14150064
141600                     ,NW_STR_PO_IND                               14160064
141700                     ,DC_ALLOC_QTY                                14170064
141800                     ,STR_ALLOC_PO_IND                            14180064
141900                     ,PO_STAT_CDE                                 14190064
142000                     ,DC_QTY_CHGD_CDE                             14200064
142100                     ,PO_STAT_CHGD_IND                            14210064
142200                     ,DC_DROP_IND                                 14220064
142300                     ,MANU_DAT_LOD_TMST                           14230064
142400                     ,ENT_NM                                      14240064
142500                     ,SEASET_SHRT_NM                              14250064
142600                     ,DTE_CHGD_IND                                14260064
142700                     ,NW_STR_PO_CHGD_IND                          14270064
142800                     ,SEASET_CHGD_IND                             14280064
142900                     ,STR_ALLOC_CHGD_IND                          14290064
143000                     ,INIT_PO_LOD_IND                             14300064
143100                     ,DEPT_NBR                                    14310064
143200                     ,DEPT_NBR_CHGD_IND                           14320064
143300                     ,MIN_CL_NBR                                  14330064
143400                     ,MIN_CL_NBR_CHGD_IND)                        14340064
143500                 VALUES                                           14350064
143600                      (:TRT00000-PO-NBR                           14360064
143700                      ,:TRT00000-DC-NBR                           14370064
143800                      ,CURRENT TIMESTAMP                          14380064
143900                      ,:TRT00000-ENT-ID                           14390064
144000                      ,:TRT00000-STRT-SHIP-DTE                    14400064
144100                      ,:TRT00000-CNCL-DTE                         14410064
144200                      ,:TRT00000-NW-STR-PO-IND                    14420064
144300                      ,:TRT00000-DC-ALLOC-QTY                     14430064
144400                      ,:TRT00000-STR-ALLOC-PO-IND                 14440064
144500                      ,:TRT00000-PO-STAT-CDE                      14450064
144600                      ,:TRT00000-DC-QTY-CHGD-CDE                  14460064
144700                      ,:TRT00000-PO-STAT-CHGD-IND                 14470064
144800                      ,:TRT00000-DC-DROP-IND                      14480064
144900                      ,:TRT00000-MANU-DAT-LOD-TMST                14490064
145000                      ,:TRT00000-ENT-NM                           14500064
145100                      ,:TRT00000-SEASET-SHRT-NM                   14510064
145200                      ,:TRT00000-DTE-CHGD-IND                     14520064
145300                      ,:TRT00000-NW-STR-PO-CHGD-IND               14530064
145400                      ,:TRT00000-SEASET-CHGD-IND                  14540064
145500                      ,:TRT00000-STR-ALLOC-CHGD-IND               14550064
145600                      ,:TRT00000-INIT-PO-LOD-IND                  14560064
145700                      ,:TRT00000-DEPT-NBR                         14570064
145800                      ,:TRT00000-DEPT-NBR-CHGD-IND                14580064
145900                      ,:TRT00000-MIN-CL-NBR                       14590064
146000                      ,:TRT00000-MIN-CL-NBR-CHGD-IND)             14600064
146100         END-EXEC                                                 14610064
146200                                                                  14620064
146300         EVALUATE TRUE                                            14630064
146400             WHEN SQLCODE = ZERO                                  14640064
146500                 CONTINUE                                         14650064
146600             WHEN SQLCODE = -904                                  14660064
146700             WHEN SQLCODE = -913                                  14670064
146800                 CONTINUE                                         14680064
146900             WHEN SQLWARN0 NOT = SPACES                           14690064
147000             WHEN SQLCODE < ZERO                                  14700064
147100             WHEN SQLCODE > ZERO                                  14710064
147200                 MOVE '2610-HISTORY-UPDATE'                       14720064
147300                                      TO  PV-PARAGRAPH-NAME       14730064
147400                 MOVE 'ERROR ISSUED ON INSERT'                    14740064
147500                                      TO  PV-DB2-OPERATION-MESSAGE14750064
147600                 MOVE 'TRT_MANU_PO_HIST' TO  PV-DB2-TABLE-NAME-1  14760064
147700                 PERFORM 9100-DB2-ABEND                           14770064
147800         END-EVALUATE                                             14780064
147900     END-PERFORM.                                                 14790064
148000                                                                  14800064
148100     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 14810064
148200         MOVE '2610-HISTORY-UPDATE'                               14820064
148300                                 TO  PV-PARAGRAPH-NAME            14830064
148400         MOVE 'MAX RETRIES EXCEEDED ON INSERT'                    14840064
148500                                 TO  PV-DB2-OPERATION-MESSAGE     14850064
148600         MOVE 'TRT_MANU_PO_HIST' TO  PV-DB2-TABLE-NAME-1          14860064
148700         PERFORM 9100-DB2-ABEND                                   14870064
148800     END-IF.                                                      14880064
148900                                                                  14890064
149000*--------------------------------------------------------------*  14900064
149100*                                                                 14910064
149200*--------------------------------------------------------------*  14920064
149300 2700-INSERT-TO-EXTR-TABLE.                                       14930064
149400                                                                  14940064
149500     ADD +1 TO PV-NBR-OF-ADDS.                                    14950064
149600                                                                  14960064
149700     IF PLNSHP-EXT-CAN-DTE = PC-DEFAULT-DATE                      14970064
149800         MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO TRT00000-CNCL-DTE      14980064
149900     ELSE                                                         14990064
150000         MOVE PLNSHP-EXT-CAN-DTE        TO TRT00000-CNCL-DTE      15000064
150100     END-IF.                                                      15010064
150200                                                                  15020064
150300     PERFORM 2410-CHECK-STR-ALLOC.                                15030064
150400                                                                  15040064
150500     PERFORM 2710-GET-ENT-NAME.                                   15050064
150600                                                                  15060064
150700* WR40574 START                                                   15070064
150800     MOVE PURCHS-DEPT-NBR TO PV-UPDATE-DEPT-NBR-N.                15080064
150900     MOVE +0              TO PV-UPDATE-DEPT-NBR-PACKED.           15090064
151000     ADD  PV-UPDATE-DEPT-NBR-N TO PV-UPDATE-DEPT-NBR-PACKED.      15100064
151100     MOVE XLT00004-MAJ-CL-NBR TO PV-UPDATE-MIN-CL-NBR-N.          15110064
151200     MOVE +0              TO PV-UPDATE-MIN-CL-NBR-PACKED.         15120064
151300     ADD  PV-UPDATE-MIN-CL-NBR-N TO PV-UPDATE-MIN-CL-NBR-PACKED.  15130064
151400* WR40574 END                                                     15140064
151500                                                                  15150064
151600* WR40574 ADDED DEPT_NBR AND MIN_CL_NBR BELOW                     15160064
151700     PERFORM WITH TEST AFTER                                      15170064
151800             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 15180064
151900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         15190064
152000                     SQLCODE = ZERO                               15200064
152100                                                                  15210064
152200         EXEC SQL                                                 15220064
152300              INSERT INTO TRT_MANU_PO_EXTR                        15230064
152400                     (PO_NBR                                      15240064
152500                     ,DC_NBR                                      15250064
152600                     ,ENT_ID                                      15260064
152700                     ,STRT_SHIP_DTE                               15270064
152800                     ,CNCL_DTE                                    15280064
152900                     ,NW_STR_PO_IND                               15290064
153000                     ,DC_ALLOC_QTY                                15300064
153100                     ,STR_ALLOC_PO_IND                            15310064
153200                     ,PO_STAT_CDE                                 15320064
153300                     ,DC_QTY_CHGD_CDE                             15330064
153400                     ,PO_STAT_CHGD_IND                            15340064
153500                     ,DC_DROP_IND                                 15350064
153600                     ,MANU_DAT_LOD_TMST                           15360064
153700                     ,LAST_UPD_TMST                               15370064
153800                     ,ENT_NM                                      15380064
153900                     ,SEASET_SHRT_NM                              15390064
154000                     ,DTE_CHGD_IND                                15400064
154100                     ,NW_STR_PO_CHGD_IND                          15410064
154200                     ,SEASET_CHGD_IND                             15420064
154300                     ,STR_ALLOC_CHGD_IND                          15430064
154400                     ,INIT_PO_LOD_IND                             15440064
154500                     ,DEPT_NBR                                    15450064
154600                     ,DEPT_NBR_CHGD_IND                           15460064
154700                     ,MIN_CL_NBR                                  15470064
154800                     ,MIN_CL_NBR_CHGD_IND)                        15480064
154900              VALUES                                              15490064
155000                     (:PURCHS-PO-NBR                              15500064
155100                     ,:ALLPLN-DEST-NBR                            15510064
155200                     ,:PURCHS-ENT-ID                              15520064
155300                     ,:PLNSHP-DONT-SHIP-BEF-DTE                   15530064
155400                     ,:TRT00000-CNCL-DTE                          15540064
155500                     ,:PURCHS-NEW-STR-PO-IND                      15550064
155600                     ,:PV-SUM-TALLPLN-SPLITS                      15560064
155700                     ,:PV-UPDATE-STR-ALLOC-PO-IND                 15570064
155800                     ,:PURCHS-STATUS-CDE                          15580064
155900                     ,'N'                                         15590064
156000                     ,'N'                                         15600064
156100                     ,'N'                                         15610064
156200                     ,:PV-CURRENT-TMST                            15620064
156300                     ,:PV-CURRENT-TMST                            15630064
156400                     ,:TRT00000-ENT-NM                            15640064
156500                     ,:PURCHS-SEASET-SHRT-NM                      15650064
156600                     ,'N'                                         15660064
156700                     ,'N'                                         15670064
156800                     ,'N'                                         15680064
156900                     ,'N'                                         15690064
157000                     ,'Y'                                         15700064
157100                     ,:PV-UPDATE-DEPT-NBR-PACKED                  15710064
157200                     ,'N'                                         15720064
157300                     ,:PV-UPDATE-MIN-CL-NBR-PACKED                15730064
157400                     ,'N')                                        15740064
157500         END-EXEC                                                 15750064
157600                                                                  15760064
157700         EVALUATE TRUE                                            15770064
157800             WHEN SQLCODE = ZERO                                  15780064
157900                 ADD +1             TO PV-REC-COUNT               15790087
158000                 CONTINUE                                         15800064
158100             WHEN SQLCODE = -904                                  15810064
158200             WHEN SQLCODE = -913                                  15820064
158300                 CONTINUE                                         15830064
158400             WHEN SQLWARN0 NOT = SPACES                           15840064
158500             WHEN SQLCODE < ZERO                                  15850064
158600             WHEN SQLCODE > ZERO                                  15860064
158700                 MOVE '2700-INSERT-TO-EXTR-TABLE'                 15870064
158800                                      TO  PV-PARAGRAPH-NAME       15880064
158900                 MOVE 'ERROR ISSUED ON INSERT'                    15890064
159000                                      TO  PV-DB2-OPERATION-MESSAGE15900064
159100                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  15910064
159200                 PERFORM 9100-DB2-ABEND                           15920064
159300         END-EVALUATE                                             15930064
159400     END-PERFORM.                                                 15940064
159500                                                                  15950064
159600     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 15960064
159700         MOVE '2700-INSERT-TO-EXTR-TABLE'                         15970064
159800                                 TO  PV-PARAGRAPH-NAME            15980064
159900         MOVE 'MAX RETRIES EXCEEDED ON INSERT'                    15990064
160000                                 TO  PV-DB2-OPERATION-MESSAGE     16000064
160100         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          16010064
160200         PERFORM 9100-DB2-ABEND                                   16020064
160300     END-IF.                                                      16030064
160400                                                                  16040064
160500     MOVE PURCHS-PO-NBR   TO TRT00000-PO-NBR.                     16050064
160600     MOVE PURCHS-ENT-ID   TO TRT00000-ENT-ID.                     16060064
160700     MOVE ALLPLN-DEST-NBR TO TRT00000-DC-NBR.                     16070064
160800                                                                  16080064
160900* WR40574 START                                                   16090064
161000     MOVE PV-UPDATE-MIN-CL-NBR-PACKED TO TRT00000-MIN-CL-NBR.     16100064
161100     MOVE PV-UPDATE-DEPT-NBR-PACKED   TO TRT00000-DEPT-NBR.       16110064
161200* WR40574 END                                                     16120064
161300                                                                  16130064
161400*--------------------------------------------------------------*  16140064
161500* GET THE VENDOR NAME FOR PO                                      16150064
161600*--------------------------------------------------------------*  16160064
161700 2710-GET-ENT-NAME.                                               16170064
161800                                                                  16180064
161900     PERFORM WITH TEST AFTER                                      16190064
162000             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 16200064
162100             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         16210064
162200                     SQLCODE = ZERO OR                            16220064
162300                     SQLCODE = +100                               16230064
162400                                                                  16240064
162500         EXEC SQL                                                 16250064
162600             SELECT ENT_NAME_DESC                                 16260064
162700             INTO   :ENTNME-ENT-NAME-DESC                         16270064
162800             FROM   TENTNME                                       16280064
162900             WHERE  ENT_ID    = :PURCHS-ENT-ID                    16290064
163000               AND  TYPE_CDE  = '01'                              16300064
163100         END-EXEC                                                 16310064
163200                                                                  16320064
163300         EVALUATE TRUE                                            16330064
163400             WHEN SQLCODE = ZERO                                  16340064
163500                 MOVE ENTNME-ENT-NAME-DESC TO TRT00000-ENT-NM     16350064
163600             WHEN SQLCODE = +100                                  16360064
163700                 MOVE SPACES TO TRT00000-ENT-NM                   16370064
163800             WHEN SQLCODE = -904                                  16380064
163900             WHEN SQLCODE = -913                                  16390064
164000                 CONTINUE                                         16400064
164100             WHEN SQLWARN0 NOT = SPACES                           16410064
164200             WHEN SQLCODE < ZERO                                  16420064
164300             WHEN SQLCODE > ZERO                                  16430064
164400                 MOVE '2112-GET-ENT-NAME'                         16440064
164500                                      TO  PV-PARAGRAPH-NAME       16450064
164600                 MOVE 'ERROR ISSUED ON SELECT'                    16460064
164700                                      TO  PV-DB2-OPERATION-MESSAGE16470064
164800                 MOVE 'TENTNME'       TO  PV-DB2-TABLE-NAME-1     16480064
164900                 PERFORM 9100-DB2-ABEND                           16490064
165000         END-EVALUATE                                             16500064
165100     END-PERFORM.                                                 16510064
165200                                                                  16520064
165300     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 16530064
165400         MOVE '2112-GET-ENT-NAME'                                 16540064
165500                               TO  PV-PARAGRAPH-NAME              16550064
165600         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    16560064
165700                               TO  PV-DB2-OPERATION-MESSAGE       16570064
165800         MOVE 'TENTNME'        TO  PV-DB2-TABLE-NAME-1            16580064
165900         PERFORM 9100-DB2-ABEND                                   16590064
166000     END-IF.                                                      16600064
166100                                                                  16610064
166200*--------------------------------------------------------------*  16620064
166300* OPEN PO/VENDOR INFORMATION CURSOR                               16630064
166400*--------------------------------------------------------------*  16640064
166500 3000-OPEN-PO-ENT-ID-CSR.                                         16650064
166600                                                                  16660064
166700*    SET CHECKPOINT RESTART INFO FOR PO/ENT ID PROCESSING         16670064
166800     SET PS-NO-COMMITS-TAKEN TO TRUE.                             16680064
166900     SET PC-RESTART-STEP-1   TO TRUE.                             16690064
167000                                                                  16700064
167100     EXEC SQL                                                     16710064
167200          OPEN PO-ENT-ID-CSR                                      16720064
167300     END-EXEC.                                                    16730064
167400                                                                  16740064
167500     EVALUATE TRUE                                                16750064
167600         WHEN SQLCODE = ZERO                                      16760064
167700             CONTINUE                                             16770064
167800         WHEN SQLWARN0 NOT = SPACES                               16780064
167900         WHEN SQLCODE < ZERO                                      16790064
168000         WHEN SQLCODE > ZERO                                      16800064
168100             MOVE '3000-OPEN-PO-ENT-ID-CSR'                       16810064
168200                             TO PV-PARAGRAPH-NAME                 16820064
168300             MOVE 'ATTEMPTING TO OPEN THE PO-ENT-ID-CSR'          16830064
168400                             TO PV-DB2-OPERATION-MESSAGE          16840064
168500             MOVE 'TPURCHS'  TO PV-DB2-TABLE-NAME-1               16850064
168600             MOVE 'TALLPLN'  TO PV-DB2-TABLE-NAME-2               16860064
168700             MOVE 'TPLNSHP'  TO PV-DB2-TABLE-NAME-3               16870064
168800             PERFORM 9100-DB2-ABEND                               16880064
168900     END-EVALUATE.                                                16890064
169000                                                                  16900064
169100*--------------------------------------------------------------*  16910064
169200* FETCH PO/VENDOR INFORMATION                                     16920064
169300*--------------------------------------------------------------*  16930064
169400 3100-FETCH-PO-ENT-ID-CSR.                                        16940064
169500* WR40574 ADDED PURCHS-DEPT-NBR AND XLT00004-MAJ-CL-NBR BELOW     16950064
169600                                                                  16960064
169700     EXEC SQL                                                     16970064
169800         FETCH PO-ENT-ID-CSR                                      16980064
169900          INTO  :PURCHS-PO-NBR                                    16990064
170000               ,:ALLPLN-DEST-NBR                                  17000064
170100               ,:PURCHS-STATUS-CDE                                17010064
170200               ,:PURCHS-NEW-STR-PO-IND                            17020064
170300               ,:PURCHS-SEASET-SHRT-NM                            17030064
170400               ,:PLNSHP-DONT-SHIP-BEF-DTE                         17040064
170500               ,:PLNSHP-CAN-IFNOT-SHIP-DTE                        17050064
170600               ,:PLNSHP-EXT-CAN-DTE                               17060064
170700               ,:PURCHS-ENT-ID                                    17070064
170800               ,:PURCHS-DEPT-NBR                                  17080064
170900               ,:XLT00004-MAJ-CL-NBR                              17090064
171000               ,:PV-SUM-TALLPLN-SPLITS                            17100064
171100     END-EXEC.                                                    17110064
171200                                                                  17120064
171300     EVALUATE TRUE                                                17130064
171400         WHEN SQLCODE = ZERO                                      17140064
171500               CONTINUE                                           17150064
171600         WHEN SQLCODE = +100                                      17160064
171700              SET PS-END-OF-POS TO TRUE                           17170064
171800              MOVE ZEROES TO PV-CMIT-PO-NBR                       17180064
171900         WHEN SQLWARN0 NOT = SPACES                               17190064
172000         WHEN SQLCODE < ZERO                                      17200064
172100         WHEN SQLCODE > ZERO                                      17210064
172200             MOVE '3100-FETCH-PO-ENT-ID-CSR'                      17220064
172300                                 TO PV-PARAGRAPH-NAME             17230064
172400             MOVE 'ERROR FETCHING WITH THE PO-ENT-ID-CSR'         17240064
172500                                 TO PV-DB2-OPERATION-MESSAGE      17250064
172600             MOVE 'TPURCHS'      TO PV-DB2-TABLE-NAME-1           17260064
172700             MOVE 'TALLPLN'      TO PV-DB2-TABLE-NAME-2           17270064
172800             MOVE 'TPLNSHP'      TO PV-DB2-TABLE-NAME-3           17280064
172900             PERFORM 9100-DB2-ABEND                               17290064
173000     END-EVALUATE.                                                17300064
173100 EJECT                                                            17310064
173200                                                                  17320064
173300*--------------------------------------------------------------*  17330064
173400* CLOSE PO/VENDOR CURSOR                                          17340064
173500*--------------------------------------------------------------*  17350064
173600 3200-CLOSE-PO-ENT-ID-CSR.                                        17360064
173700                                                                  17370064
173800         EXEC SQL                                                 17380064
173900              CLOSE PO-ENT-ID-CSR                                 17390064
174000         END-EXEC.                                                17400064
174100                                                                  17410064
174200     EVALUATE TRUE                                                17420064
174300         WHEN SQLCODE = ZERO                                      17430064
174400             CONTINUE                                             17440064
174500         WHEN SQLWARN0 NOT = SPACES                               17450064
174600         WHEN SQLCODE < ZERO                                      17460064
174700         WHEN SQLCODE > ZERO                                      17470064
174800             MOVE '3300-CLOSE-PO-ENT-ID-CSR'                      17480064
174900                             TO PV-PARAGRAPH-NAME                 17490064
175000             MOVE 'ATTEMPTING TO CLOSE THE ENT-ID-CSR'            17500064
175100                             TO PV-DB2-OPERATION-MESSAGE          17510064
175200             MOVE 'TPURCHS'  TO PV-DB2-TABLE-NAME-1               17520064
175300             MOVE 'TALLPLN'  TO PV-DB2-TABLE-NAME-2               17530064
175400             MOVE 'TPLNSHP'  TO PV-DB2-TABLE-NAME-3               17540064
175500             PERFORM 9100-DB2-ABEND                               17550064
175600     END-EVALUATE.                                                17560064
175700                                                                  17570064
175800*--------------------------------------------------------------*  17580064
175900* OPEN DC-DROP-CSR INFORMATION CURSOR                             17590064
176000*--------------------------------------------------------------*  17600064
176100 4000-PROCESS-DC-DROP-CSR.                                        17610064
176200                                                                  17620064
176300     PERFORM 4200-FETCH-DC-DROP-CSR.                              17630064
176400                                                                  17640064
176500* CHECK IF COMMIT IS TO BE TAKEN                                  17650064
176600     IF TRT00000-PO-NBR = PV-CMIT-PO-NBR                          17660064
176700         CONTINUE                                                 17670064
176800     ELSE                                                         17680064
176900         PERFORM X100-CHECKPOINT-CHECK                            17690064
177000         MOVE TRT00000-PO-NBR TO PV-CMIT-PO-NBR                   17700064
177100     END-IF.                                                      17710064
177200                                                                  17720064
177300     IF PS-END-OF-PO-EXTR-DROP                                    17730064
177400         SET PC-RESTART-STEP-3   TO TRUE                          17740064
177500         MOVE PC-RESTART-STEP    TO PV-CKPT-STAT-CODE             17750064
177600         PERFORM X600-UPDATE-TCKRSTCNTL                           17760064
177700         PERFORM X700-UPDATE-TCKRSTINF                            17770064
177800         PERFORM Y100-COMMIT                                      17780064
177900         PERFORM X500-SET-CHECKPOINT-TIME                         17790064
178000     ELSE                                                         17800064
178100         PERFORM 4400-CHECK-FOR-TALLPLN-ROW                       17810064
178200         PERFORM 4500-DO-HISTORY-UPDATES                          17820064
178300     END-IF.                                                      17830064
178400                                                                  17840064
178500*--------------------------------------------------------------*  17850064
178600* OPEN DC-DROP-CSR CURSOR                                         17860064
178700*--------------------------------------------------------------*  17870064
178800 4100-OPEN-DC-DROP-CSR.                                           17880064
178900                                                                  17890064
179000*    SET CHECKPOINT RESTART INFO FOR DC DROP PROCESSING           17900064
179100     SET PS-NO-COMMITS-TAKEN TO TRUE.                             17910064
179200     SET PC-RESTART-STEP-2   TO TRUE.                             17920064
179300                                                                  17930064
179400     EXEC SQL                                                     17940064
179500          OPEN DC-DROP-CSR                                        17950064
179600     END-EXEC.                                                    17960064
179700                                                                  17970064
179800     EVALUATE TRUE                                                17980064
179900         WHEN SQLCODE = ZERO                                      17990064
180000             CONTINUE                                             18000064
180100         WHEN SQLWARN0 NOT = SPACES                               18010064
180200         WHEN SQLCODE < ZERO                                      18020064
180300         WHEN SQLCODE > ZERO                                      18030064
180400             MOVE '4100-OPEN-DC-DROP-CSR'                         18040064
180500                                     TO PV-PARAGRAPH-NAME         18050064
180600             MOVE 'ATTEMPTING TO OPEN THE DC-DROP-CSR'            18060064
180700                                     TO PV-DB2-OPERATION-MESSAGE  18070064
180800             MOVE 'TRT_MANU_PO_CSR'  TO PV-DB2-TABLE-NAME-1       18080064
180900             PERFORM 9100-DB2-ABEND                               18090064
181000     END-EVALUATE.                                                18100064
181100                                                                  18110064
181200*--------------------------------------------------------------*  18120064
181300*                                                                 18130064
181400*--------------------------------------------------------------*  18140064
181500 4200-FETCH-DC-DROP-CSR.                                          18150064
181600* WR40574 ADDED DEPT-NBR AND MIN-CL-NBR BELOW                     18160064
181700                                                                  18170064
181800     EXEC SQL                                                     18180064
181900         FETCH DC-DROP-CSR                                        18190064
182000          INTO :TRT00000-PO-NBR                                   18200064
182100              ,:TRT00000-DC-NBR                                   18210064
182200              ,:TRT00000-ENT-ID                                   18220064
182300              ,:TRT00000-STRT-SHIP-DTE                            18230064
182400              ,:TRT00000-CNCL-DTE                                 18240064
182500              ,:TRT00000-NW-STR-PO-IND                            18250064
182600              ,:TRT00000-DC-ALLOC-QTY                             18260064
182700              ,:TRT00000-STR-ALLOC-PO-IND                         18270064
182800              ,:TRT00000-PO-STAT-CDE                              18280064
182900              ,:TRT00000-DC-QTY-CHGD-CDE                          18290064
183000              ,:TRT00000-PO-STAT-CHGD-IND                         18300064
183100              ,:TRT00000-DC-DROP-IND                              18310064
183200              ,:TRT00000-MANU-DAT-LOD-TMST                        18320064
183300              ,:TRT00000-LAST-UPD-TMST                            18330064
183400              ,:TRT00000-ENT-NM                                   18340064
183500              ,:TRT00000-SEASET-SHRT-NM                           18350064
183600              ,:TRT00000-DTE-CHGD-IND                             18360064
183700              ,:TRT00000-NW-STR-PO-CHGD-IND                       18370064
183800              ,:TRT00000-SEASET-CHGD-IND                          18380064
183900              ,:TRT00000-STR-ALLOC-CHGD-IND                       18390064
184000              ,:TRT00000-INIT-PO-LOD-IND                          18400064
184100              ,:PV-REQ-LATE-DELY-DTE                              18410064
184200              ,:TRT00000-DEPT-NBR                                 18420064
184300              ,:TRT00000-DEPT-NBR-CHGD-IND                        18430064
184400              ,:TRT00000-MIN-CL-NBR                               18440064
184500              ,:TRT00000-MIN-CL-NBR-CHGD-IND                      18450064
184600     END-EXEC.                                                    18460064
184700                                                                  18470064
184800     EVALUATE TRUE                                                18480064
184900         WHEN SQLCODE = ZERO                                      18490064
185000               CONTINUE                                           18500064
185100         WHEN SQLCODE = +100                                      18510064
185200              SET PS-END-OF-PO-EXTR-DROP TO TRUE                  18520064
185300              MOVE ZEROES TO PV-CMIT-PO-NBR                       18530064
185400         WHEN SQLWARN0 NOT = SPACES                               18540064
185500         WHEN SQLCODE < ZERO                                      18550064
185600         WHEN SQLCODE > ZERO                                      18560064
185700             MOVE '4200-FETCH-DC-DROP-CSR'                        18570064
185800                                     TO PV-PARAGRAPH-NAME         18580064
185900             MOVE 'ERROR FETCHING WITH THE DC-DROP-CSR'           18590064
186000                                     TO PV-DB2-OPERATION-MESSAGE  18600064
186100             MOVE 'TRT_MANU_PO_CSR'  TO PV-DB2-TABLE-NAME-1       18610064
186200             PERFORM 9100-DB2-ABEND                               18620064
186300     END-EVALUATE.                                                18630064
186400 EJECT                                                            18640064
186500                                                                  18650064
186600*--------------------------------------------------------------*  18660064
186700*                                                                 18670064
186800*--------------------------------------------------------------*  18680064
186900 4300-CLOSE-DC-DROP-CSR.                                          18690064
187000                                                                  18700064
187100         EXEC SQL                                                 18710064
187200              CLOSE DC-DROP-CSR                                   18720064
187300         END-EXEC.                                                18730064
187400                                                                  18740064
187500     EVALUATE TRUE                                                18750064
187600         WHEN SQLCODE = ZERO                                      18760064
187700             CONTINUE                                             18770064
187800         WHEN SQLWARN0 NOT = SPACES                               18780064
187900         WHEN SQLCODE < ZERO                                      18790064
188000         WHEN SQLCODE > ZERO                                      18800064
188100             MOVE '4300-CLOSE-DC-DROP-CSR'                        18810064
188200                                     TO PV-PARAGRAPH-NAME         18820064
188300             MOVE 'ATTEMPTING TO CLOSE THE DC-DROP-CSR'           18830064
188400                                     TO PV-DB2-OPERATION-MESSAGE  18840064
188500             MOVE 'DC-DROP-CSR'      TO PV-DB2-TABLE-NAME-1       18850064
188600             PERFORM 9100-DB2-ABEND                               18860064
188700     END-EVALUATE.                                                18870064
188800                                                                  18880064
188900*----------------------------------------------------------------*18890064
189000*                                                                 18900064
189100*----------------------------------------------------------------*18910064
189200 4400-CHECK-FOR-TALLPLN-ROW.                                      18920064
189300                                                                  18930064
189400     PERFORM WITH TEST AFTER                                      18940064
189500             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 18950064
189600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES            18960064
189700                 OR  SQLCODE = ZERO                               18970064
189800                 OR  SQLCODE = +100                               18980064
189900                                                                  18990064
190000         EXEC SQL                                                 19000064
190100             SELECT 1                                             19010064
190200             INTO   :PV-DUMMY                                     19020064
190300             FROM   TALLPLN                                       19030064
190400             WHERE  (    PO_NBR   = :TRT00000-PO-NBR              19040064
190500                     AND DEST_NBR = :TRT00000-DC-NBR)             19050064
190600             FETCH  FIRST 1 ROW ONLY                              19060064
190700         END-EXEC                                                 19070064
190800                                                                  19080064
190900         EVALUATE TRUE                                            19090064
191000             WHEN SQLCODE = ZERO                                  19100064
191100                 SET PS-NO-DC-DROP-HIST TO TRUE                   19110064
191200             WHEN SQLCODE = +100                                  19120064
191300                 SET PS-DC-DROP-HIST    TO TRUE                   19130064
191400                 PERFORM 4410-UPDATE-DC-DROP-IND                  19140064
191500             WHEN SQLCODE = -904                                  19150064
191600             WHEN SQLCODE = -913                                  19160064
191700                 CONTINUE                                         19170064
191800             WHEN SQLWARN0 NOT = SPACES                           19180064
191900             WHEN SQLCODE < ZERO                                  19190064
192000             WHEN SQLCODE > ZERO                                  19200064
192100                 MOVE '4400-CHECK-FOR-TALLPLN-ROW'                19210064
192200                                      TO  PV-PARAGRAPH-NAME       19220064
192300                 MOVE 'ERROR ISSUED ON SELECT'                    19230064
192400                                      TO  PV-DB2-OPERATION-MESSAGE19240064
192500                 MOVE 'TRT_MAN_PO_EXTR' TO  PV-DB2-TABLE-NAME-1   19250064
192600                 PERFORM 9100-DB2-ABEND                           19260064
192700         END-EVALUATE                                             19270064
192800     END-PERFORM.                                                 19280064
192900                                                                  19290064
193000     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 19300064
193100         MOVE '4400-CHECK-FOR-TALLPLN-ROW'                        19310064
193200                                 TO  PV-PARAGRAPH-NAME            19320064
193300         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    19330064
193400                                 TO  PV-DB2-OPERATION-MESSAGE     19340064
193500         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          19350064
193600         PERFORM 9100-DB2-ABEND                                   19360064
193700     END-IF.                                                      19370064
193800                                                                  19380064
193900*----------------------------------------------------------------*19390064
194000*                                                                 19400064
194100*----------------------------------------------------------------*19410064
194200 4410-UPDATE-DC-DROP-IND.                                         19420064
194300                                                                  19430099
194400     ADD +1 TO PV-NBR-OF-CHANGES.                                 19440064
194500                                                                  19450064
194600     PERFORM WITH TEST AFTER                                      19460064
194700             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 19470064
194800             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         19480064
194900                     SQLCODE = ZERO                               19490064
195000                                                                  19500064
195100         EXEC SQL                                                 19510064
195200              UPDATE  TRT_MANU_PO_EXTR                            19520064
195300                 SET  DC_DROP_IND        = 'Y',                   19530064
195400                      MANU_DAT_LOD_TMST  = :PV-CURRENT-TMST,      19540064
195500                      LAST_UPD_TMST      = CURRENT TIMESTAMP      19550064
195600               WHERE  PO_NBR         = :TRT00000-PO-NBR           19560064
195700                 AND  DC_NBR         = :TRT00000-DC-NBR           19570064
195800         END-EXEC                                                 19580064
195900                                                                  19590064
196000         EVALUATE TRUE                                            19600064
196100             WHEN SQLCODE = ZERO                                  19610064
196200                 MOVE 'Y' TO TRT00000-DC-DROP-IND                 19620064
196300             WHEN SQLCODE = -904                                  19630064
196400             WHEN SQLCODE = -913                                  19640064
196500                 CONTINUE                                         19650064
196600             WHEN SQLWARN0 NOT = SPACES                           19660064
196700             WHEN SQLCODE < ZERO                                  19670064
196800             WHEN SQLCODE > ZERO                                  19680064
196900                 MOVE '4410-UPDATE-DC-DROP-IND'                   19690064
197000                                      TO  PV-PARAGRAPH-NAME       19700064
197100                 MOVE 'ERROR ISSUED ON UPDATE'                    19710064
197200                                      TO  PV-DB2-OPERATION-MESSAGE19720064
197300                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  19730064
197400                 PERFORM 9100-DB2-ABEND                           19740064
197500         END-EVALUATE                                             19750064
197600     END-PERFORM.                                                 19760064
197700                                                                  19770064
197800     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 19780064
197900         MOVE '4410-UPDATE-DC-DROP-IND'                           19790064
198000                                 TO  PV-PARAGRAPH-NAME            19800064
198100         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    19810064
198200                                 TO  PV-DB2-OPERATION-MESSAGE     19820064
198300         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          19830064
198400         PERFORM 9100-DB2-ABEND                                   19840064
198500     END-IF.                                                      19850064
198600                                                                  19860064
198700*----------------------------------------------------------------*19870064
198800*                                                                 19880064
198900*----------------------------------------------------------------*19890064
199000 4500-DO-HISTORY-UPDATES.                                         19900064
199100                                                                  19910064
199200     IF TRT00000-PO-STAT-CDE = ('CA' OR 'CM')                     19920064
199300     OR PS-DC-DROP-HIST                                           19930064
199400         PERFORM 2610-HISTORY-UPDATE                              19940064
199500     END-IF.                                                      19950064
199600                                                                  19960064
199700*--------------------------------------------------------------*  19970064
199800*                                                                 19980064
199900*--------------------------------------------------------------*  19990064
200000 5000-CREATE-OUTPUT-FILE.                                         20000064
200100                                                                  20010064
200200     PERFORM 5200-FETCH-CREATE-OUTPUT-CSR.                        20020064
200300                                                                  20030064
200400     IF PS-END-OF-PO-EXTR-OUT                                     20040064
200500         CONTINUE                                                 20050064
200600     ELSE                                                         20060064
200700* IF BREAK IN PO DC CHECK IF DC SHOULD BE DROPED                  20070064
200800         IF TRT00000-PO-NBR = PV-SAVE-PO-NBR                      20080064
200900***      IF  TRT00000-ENT-ID = PV-SAVE-VEND-ID                    20090064
201000         AND TRT00000-DC-NBR = PV-SAVE-DC-NBR                     20100064
201100             CONTINUE                                             20110064
201200         ELSE                                                     20120064
201300             PERFORM 5500-CHECK-DC-DROP-IND                       20130064
201400***          MOVE TRT00000-ENT-ID TO PV-SAVE-VEND-ID              20140064
201500             MOVE TRT00000-PO-NBR TO PV-SAVE-PO-NBR               20150064
201600             MOVE TRT00000-DC-NBR TO PV-SAVE-DC-NBR               20160064
201700         END-IF                                                   20170064
201800                                                                  20180064
201900* IF DC SHOULD BE DROPED WRITE ONE RECORD AND SKIP THE REST       20190064
202000         IF PS-DROP-DC                                            20200064
202100*PRB0052099 START                                                 20210096
202200             MOVE 0              TO TRT00000-DC-ALLOC-QTY         20220099
202300*PRB0052099 END                                                   20230096
202400             PERFORM 5400-POPULATE-FIELDS                         20240064
202500             PERFORM 8000-WRITE-RECORD                            20250064
202600             SET PS-DONT-DROP-DC TO TRUE                          20260064
202700         ELSE                                                     20270064
202800             IF TRT00000-DC-DROP-IND = 'N'                        20280064
202900                 PERFORM 5400-POPULATE-FIELDS                     20290064
203000                 PERFORM 8000-WRITE-RECORD                        20300064
203100             END-IF                                               20310064
203200         END-IF                                                   20320064
203300     END-IF.                                                      20330064
203400                                                                  20340064
203500*--------------------------------------------------------------*  20350064
203600*                                                                 20360064
203700*--------------------------------------------------------------*  20370064
203800 5100-OPEN-CREATE-OUTPUT-CSR.                                     20380064
203900                                                                  20390064
204000     EXEC SQL                                                     20400064
204100          OPEN CREATE-OUTPUT-CSR                                  20410064
204200     END-EXEC.                                                    20420064
204300                                                                  20430064
204400     EVALUATE TRUE                                                20440064
204500         WHEN SQLCODE = ZERO                                      20450064
204600             CONTINUE                                             20460064
204700         WHEN SQLWARN0 NOT = SPACES                               20470064
204800         WHEN SQLCODE < ZERO                                      20480064
204900         WHEN SQLCODE > ZERO                                      20490064
205000             MOVE '5100-OPEN-CREATE-OUTPUT-CSR'                   20500064
205100                             TO PV-PARAGRAPH-NAME                 20510064
205200             MOVE 'ATTEMPTING TO OPEN THE CREATE-OUTPUT-CSR'      20520064
205300                             TO PV-DB2-OPERATION-MESSAGE          20530064
205400             MOVE 'TRT_MANU_PO_EXTR'  TO PV-DB2-TABLE-NAME-1      20540064
205500             PERFORM 9100-DB2-ABEND                               20550064
205600     END-EVALUATE.                                                20560064
205700                                                                  20570064
205800*--------------------------------------------------------------*  20580064
205900*                                                                 20590064
206000*--------------------------------------------------------------*  20600064
206100 5200-FETCH-CREATE-OUTPUT-CSR.                                    20610064
206200                                                                  20620064
206300* WR40574 ADDED DEPT-NBR AND MIN-CL-NBR BELOW                     20630064
206400     EXEC SQL                                                     20640064
206500         FETCH CREATE-OUTPUT-CSR                                  20650064
206600          INTO :TRT00000-PO-NBR                                   20660064
206700              ,:TRT00000-DC-NBR                                   20670064
206800              ,:TRT00000-ENT-ID                                   20680064
206900              ,:TRT00000-STRT-SHIP-DTE                            20690064
207000              ,:TRT00000-CNCL-DTE                                 20700064
207100              ,:TRT00000-NW-STR-PO-IND                            20710064
207200              ,:TRT00000-DC-ALLOC-QTY                             20720064
207300              ,:TRT00000-STR-ALLOC-PO-IND                         20730064
207400              ,:TRT00000-PO-STAT-CDE                              20740064
207500              ,:TRT00000-DC-QTY-CHGD-CDE                          20750064
207600              ,:TRT00000-PO-STAT-CHGD-IND                         20760064
207700              ,:TRT00000-DC-DROP-IND                              20770064
207800              ,:TRT00000-MANU-DAT-LOD-TMST                        20780064
207900              ,:TRT00000-LAST-UPD-TMST                            20790064
208000              ,:TRT00000-ENT-NM                                   20800064
208100              ,:TRT00000-SEASET-SHRT-NM                           20810064
208200              ,:TRT00000-DTE-CHGD-IND                             20820064
208300              ,:TRT00000-NW-STR-PO-CHGD-IND                       20830064
208400              ,:TRT00000-SEASET-CHGD-IND                          20840064
208500              ,:TRT00000-STR-ALLOC-CHGD-IND                       20850064
208600              ,:TRT00000-INIT-PO-LOD-IND                          20860064
208700              ,:PV-REQ-LATE-DELY-DTE                              20870064
208800              ,:TRT00000-DEPT-NBR                                 20880064
208900              ,:TRT00000-DEPT-NBR-CHGD-IND                        20890064
209000              ,:TRT00000-MIN-CL-NBR                               20900064
209100              ,:TRT00000-MIN-CL-NBR-CHGD-IND                      20910064
209200     END-EXEC.                                                    20920064
209300                                                                  20930064
209400     EVALUATE TRUE                                                20940064
209500         WHEN SQLCODE = ZERO                                      20950064
209600               CONTINUE                                           20960064
209700         WHEN SQLCODE = +100                                      20970064
209800              SET PS-END-OF-PO-EXTR-OUT TO TRUE                   20980064
209900         WHEN SQLWARN0 NOT = SPACES                               20990064
210000         WHEN SQLCODE < ZERO                                      21000064
210100         WHEN SQLCODE > ZERO                                      21010064
210200             MOVE '5200-FETCH-CREATE-OUTPUT-CSR'                  21020064
210300                                 TO PV-PARAGRAPH-NAME             21030064
210400             MOVE 'ERROR FETCHING WITH THE CREATE-OUTPUT-CSR'     21040064
210500                                 TO PV-DB2-OPERATION-MESSAGE      21050064
210600             MOVE 'TRT-MANU-PO-CSR' TO PV-DB2-TABLE-NAME-1        21060064
210700             PERFORM 9100-DB2-ABEND                               21070064
210800     END-EVALUATE.                                                21080064
210900 EJECT                                                            21090064
211000                                                                  21100064
211100*--------------------------------------------------------------*  21110064
211200*                                                                 21120064
211300*--------------------------------------------------------------*  21130064
211400 5300-CLOSE-CREATE-OUTPUT-CSR.                                    21140064
211500                                                                  21150064
211600         EXEC SQL                                                 21160064
211700              CLOSE CREATE-OUTPUT-CSR                             21170064
211800         END-EXEC.                                                21180064
211900                                                                  21190064
212000     EVALUATE TRUE                                                21200064
212100         WHEN SQLCODE = ZERO                                      21210064
212200             CONTINUE                                             21220064
212300         WHEN SQLWARN0 NOT = SPACES                               21230064
212400         WHEN SQLCODE < ZERO                                      21240064
212500         WHEN SQLCODE > ZERO                                      21250064
212600             MOVE '5300-CLOSE-CREATE-OUTPUT-CSR'                  21260064
212700                             TO PV-PARAGRAPH-NAME                 21270064
212800             MOVE 'ATTEMPTING TO CLOSE THE CREATE-OUTPUT-CSR'     21280064
212900                             TO PV-DB2-OPERATION-MESSAGE          21290064
213000             MOVE 'TRT-MANU-PO-EXTR'  TO PV-DB2-TABLE-NAME-1      21300064
213100             PERFORM 9100-DB2-ABEND                               21310064
213200     END-EVALUATE.                                                21320064
213300                                                                  21330064
213400*--------------------------------------------------------------*  21340064
213500* POPULATE COPYBOOK TRRD302 THAT IS WRITEN TO THE OUTPUT FILE     21350064
213600*--------------------------------------------------------------*  21360064
213700 5400-POPULATE-FIELDS.                                            21370064
213800                                                                  21380064
213900     MOVE SPACES TO TR302-TMS-PO-HDR-DTL-RECORD.                  21390064
214000                                                                  21400064
214100     MOVE TRT00000-ENT-NM            TO TR302-ENT-NAME.           21410064
214200     MOVE TRT00000-DC-NBR            TO TR302-DC-NBR              21420064
214300                                        TR302-DEST-NAME-NBR.      21430064
214400     SET  TR302-OPERATION-TYPE-MOD   TO TRUE.                     21440064
214500     MOVE PC-DC                      TO TR302-DC-PREFIX           21450064
214600                                       TR302-DEST-NAME-PREFIX.    21460064
214700     MOVE TRT00000-ENT-ID            TO TR302-ORIGIN-ENT-ID       21470064
214800                                        TR302-SUPPLIER-ENT-ID.    21480064
214900     MOVE TRT00000-PO-NBR            TO TR302-LINE-NBR            21490064
215000                                        TR302-PO-NBR              21500064
215100                                        TR302-PRODUCT-NAME.       21510064
215200* WR40574 START                                                   21520064
215300     MOVE TRT00000-DEPT-NBR          TO TR302-DEPT-NBR.           21530064
215400     MOVE TRT00000-DEPT-NBR-CHGD-IND TO TR302-DEPT-NBR-CHGD-IND.  21540064
215500     MOVE TRT00000-MIN-CL-NBR        TO TR302-MIN-CL-NBR.         21550064
215600     MOVE TRT00000-MIN-CL-NBR-CHGD-IND                            21560064
215700                                     TO TR302-MIN-CL-NBR-CHGD-IND.21570064
215800* WR40574 END                                                     21580064
215900     MOVE TRT00000-DC-ALLOC-QTY      TO TR302-REQ-ITEM-QTY.       21590064
216000                                                                  21600064
216100***  MOVE '01/01/2999'               TO TR302-REQ-LATE-DELY-DTE.  21610064
216200     MOVE PV-REQ-LATE-DELY-DTE(1:4)  TO PV-REFORMAT-YEAR.         21620064
216300     MOVE PV-REQ-LATE-DELY-DTE(6:2)  TO PV-REFORMAT-MONTH.        21630064
216400     MOVE PV-REQ-LATE-DELY-DTE(9:2)  TO PV-REFORMAT-DAY.          21640064
216500     MOVE PV-REFORMATED-DATE         TO TR302-REQ-LATE-DELY-DTE.  21650064
216600                                                                  21660064
216700     MOVE TRT00000-PO-STAT-CDE       TO TR302-PO-STATUS-CDE.      21670064
216800     MOVE TRT00000-NW-STR-PO-IND     TO TR302-NEW-STORE-PO-IND.   21680064
216900     MOVE TRT00000-STR-ALLOC-PO-IND  TO                           21690064
217000                                     TR302-STORE-PO-ALLOCATED-IND.21700064
217100     MOVE TRT00000-SEASET-SHRT-NM    TO TR302-SEASET-SHRT-NM.     21710064
217200     MOVE TRT00000-MANU-DAT-LOD-TMST TO TR302-LOAD-TIMESTAMP.     21720064
217300                                                                  21730064
217400* CHANGE INDICATORS                                               21740064
217500     MOVE TRT00000-DC-QTY-CHGD-CDE    TO TR302-DC-QTY-CHG-IND.    21750064
217600     MOVE TRT00000-PO-STAT-CHGD-IND   TO TR302-PO-STATUS-CHG-IND. 21760064
217700     MOVE TRT00000-DC-DROP-IND        TO TR302-DC-DROP-IND.       21770064
217800     MOVE TRT00000-DTE-CHGD-IND       TO TR302-DATE-CHGD-IND.     21780064
217900     MOVE TRT00000-NW-STR-PO-CHGD-IND TO TR302-NW-STR-CHGD-IND.   21790064
218000     MOVE TRT00000-SEASET-CHGD-IND    TO TR302-SEASET-CHGD-IND.   21800064
218100     MOVE TRT00000-STR-ALLOC-CHGD-IND TO TR302-STR-ALLOC-CHGD-IND.21810064
218200     MOVE TRT00000-INIT-PO-LOD-IND    TO TR302-INIT-PO-LOD-IND.   21820064
218300                                                                  21830064
218400* SET SWITCH IF ANY CHANGE INDICATORS HAVE BEEN SET TO TRUE       21840064
218500     IF TR302-DC-QTY-CHG-INCREASE                                 21850064
218600     OR TR302-DC-QTY-CHG-DECREASE                                 21860064
218700     OR TR302-PO-STATUS-CHG-YES                                   21870064
218800     OR TR302-DC-DROP-IND-YES                                     21880064
218900     OR TR302-INIT-PO-LOD-YES                                     21890064
219000     OR TR302-DATE-CHGD-YES                                       21900064
219100     OR TR302-STR-ALLOC-CHGD-YES                                  21910064
219200          SET TR302-CHANGES-YES TO TRUE                           21920064
219300     ELSE                                                         21930064
219400          SET TR302-CHANGES-NO  TO TRUE                           21940064
219500     END-IF.                                                      21950064
219600                                                                  21960064
219700* IF DATE CHANGE, SET PO-LOD SWITCH TO TRUE SO PLANNING ITEM IS   21970064
219800* CREATED.  THIS IS A CHANGE FOR THE ARCHIVE PROCESS.             21980064
219900     IF TR302-DATE-CHGD-YES                                       21990064
220000          SET TR302-INIT-PO-LOD-YES TO TRUE                       22000064
220100     END-IF.                                                      22010064
220200                                                                  22020064
220300* REFORMAT DATES TO MM/DD/CCYY                                    22030064
220400     MOVE TRT00000-STRT-SHIP-DTE(1:4) TO PV-REFORMAT-YEAR.        22040064
220500     MOVE TRT00000-STRT-SHIP-DTE(6:2) TO PV-REFORMAT-MONTH.       22050064
220600     MOVE TRT00000-STRT-SHIP-DTE(9:2) TO PV-REFORMAT-DAY.         22060064
220700     MOVE PV-REFORMATED-DATE   TO TR302-REQ-EARLY-AVAIL-DTE.      22070064
220800* 2012-01-31 CLT 40574 START                                      22080064
220900     PERFORM 6700-ADD-7DAYS-EARLY-DEL-DTE.                        22090064
221000     MOVE PLNSHP-DONT-SHIP-BEF-DTE(1:4)                           22100064
221100                                      TO PV-REFORMAT-YEAR.        22110064
221200     MOVE PLNSHP-DONT-SHIP-BEF-DTE(6:2)                           22120064
221300                                      TO PV-REFORMAT-MONTH.       22130064
221400     MOVE PLNSHP-DONT-SHIP-BEF-DTE(9:2)                           22140064
221500                                      TO PV-REFORMAT-DAY.         22150064
221600     MOVE PV-REFORMATED-DATE   TO TR302-REQ-EARLY-DELY-DTE.       22160064
221700* 2012-01-31 CLT 40574 END                                        22170064
221800     MOVE TRT00000-CNCL-DTE(1:4)      TO PV-REFORMAT-YEAR.        22180064
221900     MOVE TRT00000-CNCL-DTE(6:2)      TO PV-REFORMAT-MONTH.       22190064
222000     MOVE TRT00000-CNCL-DTE(9:2)      TO PV-REFORMAT-DAY.         22200064
222100     MOVE PV-REFORMATED-DATE          TO TR302-REQ-LATE-AVAIL-DTE.22210064
222200                                                                  22220064
222300* SET CORRECT E-MAIL ADDRESS                                      22230064
222400     IF TR302-DC-NBR = '0085'                                     22240064
222500         MOVE '085COC@KOHLS.COM'      TO TR302-E-MAIL-ADDRESS     22250064
222600     ELSE                                                         22260064
222700         MOVE 'COC@KOHLS.COM'         TO TR302-E-MAIL-ADDRESS     22270064
222800     END-IF.                                                      22280064
222900                                                                  22290064
223000*--------------------------------------------------------------*  22300064
223100*                                                                 22310064
223200*--------------------------------------------------------------*  22320064
223300 5500-CHECK-DC-DROP-IND.                                          22330096
223400                                                                  22340064
223500     PERFORM WITH TEST AFTER                                      22350064
223600             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 22360064
223700             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         22370064
223800                     SQLCODE = ZERO OR                            22380064
223900                     SQLCODE = +100                               22390064
224000                                                                  22400064
224100         EXEC SQL                                                 22410064
224200             SELECT 1                                             22420064
224300             INTO   :PV-DUMMY                                     22430064
224400             FROM   TRT_MANU_PO_EXTR                              22440064
224800             WHERE  (     PO_NBR      = :TRT00000-PO-NBR          22450099
224900                     AND  DC_NBR      = :TRT00000-DC-NBR          22460099
225100                     AND  DC_DROP_IND = 'Y')                      22470064
225200             FETCH  FIRST 1 ROW ONLY                              22480064
225300         END-EXEC                                                 22490064
225400                                                                  22500064
225500         EVALUATE TRUE                                            22510064
225600             WHEN SQLCODE = ZERO                                  22520064
225700                 SET PS-DROP-DC TO TRUE                           22530064
225800             WHEN SQLCODE = +100                                  22540064
225900                 SET PS-DONT-DROP-DC TO TRUE                      22550064
226000             WHEN SQLCODE = -904                                  22560064
226100             WHEN SQLCODE = -913                                  22570064
226200                 CONTINUE                                         22580064
226300             WHEN SQLWARN0 NOT = SPACES                           22590064
226400             WHEN SQLCODE < ZERO                                  22600064
226500             WHEN SQLCODE > ZERO                                  22610064
226600                 MOVE '5500-CHECK-DC-DROP-IND'                    22620064
226700                                      TO  PV-PARAGRAPH-NAME       22630064
226800                 MOVE 'ERROR ISSUED ON SELECT'                    22640064
226900                                      TO  PV-DB2-OPERATION-MESSAGE22650064
227000                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  22660064
227100                 PERFORM 9100-DB2-ABEND                           22670064
227200         END-EVALUATE                                             22680064
227300     END-PERFORM.                                                 22690064
227400                                                                  22700064
227500     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 22710064
227600         MOVE '5500-CHECK-DC-DROP-IND'                            22720064
227700                                 TO  PV-PARAGRAPH-NAME            22730064
227800         MOVE 'MAX RETRIES EXCEEDED ON DELETE'                    22740064
227900                                 TO  PV-DB2-OPERATION-MESSAGE     22750064
228000         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          22760064
228100         PERFORM 9100-DB2-ABEND                                   22770064
228200     END-IF.                                                      22780064
228300                                                                  22790064
228400     PERFORM WITH TEST AFTER                                      22800064
228500             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 22810064
228600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         22820064
228700                     SQLCODE = ZERO OR                            22830064
228800                     SQLCODE = +100                               22840064
228900                                                                  22850064
229000         EXEC SQL                                                 22860064
229100             SELECT 1                                             22870064
229200             INTO   :PV-DUMMY                                     22880064
229300             FROM   TRT_MANU_PO_EXTR                              22890064
229700             WHERE  (     PO_NBR      = :TRT00000-PO-NBR          22900099
229800                     AND  DC_NBR      = :TRT00000-DC-NBR          22910099
230000                     AND  DC_DROP_IND = 'N')                      22920064
230100             FETCH  FIRST 1 ROW ONLY                              22930064
230200         END-EXEC                                                 22940064
230300                                                                  22950064
230400         EVALUATE TRUE                                            22960064
230500             WHEN SQLCODE = ZERO                                  22970064
230600                 SET PS-DONT-DROP-DC TO TRUE                      22980064
230700             WHEN SQLCODE = +100                                  22990064
230800                 CONTINUE                                         23000064
230900             WHEN SQLCODE = -904                                  23010064
231000             WHEN SQLCODE = -913                                  23020064
231100                 CONTINUE                                         23030064
231200             WHEN SQLWARN0 NOT = SPACES                           23040064
231300             WHEN SQLCODE < ZERO                                  23050064
231400             WHEN SQLCODE > ZERO                                  23060064
231500                 MOVE '5500-CHECK-DC-DROP-IND'                    23070064
231600                                      TO  PV-PARAGRAPH-NAME       23080064
231700                 MOVE 'ERROR ISSUED ON SELECT'                    23090064
231800                                      TO  PV-DB2-OPERATION-MESSAGE23100064
231900                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  23110064
232000                 PERFORM 9100-DB2-ABEND                           23120064
232100         END-EVALUATE                                             23130064
232200     END-PERFORM.                                                 23140064
232300                                                                  23150064
232400     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 23160064
232500         MOVE '5500-CHECK-DC-DROP-IND'                            23170064
232600                                 TO  PV-PARAGRAPH-NAME            23180064
232700         MOVE 'MAX RETRIES EXCEEDED ON DELETE'                    23190064
232800                                 TO  PV-DB2-OPERATION-MESSAGE     23200064
232900         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          23210064
233000         PERFORM 9100-DB2-ABEND                                   23220064
233100     END-IF.                                                      23230064
233200                                                                  23240064
233300*----------------------------------------------------------------*23250064
233400*                                                                 23260064
233500*----------------------------------------------------------------*23270064
233600 6000-EOP-PROCESSING.                                             23280064
233700                                                                  23290064
233800     PERFORM 6100-COUNT-RECORDS-TO-FILE.                          23300064
233900***  PERFORM 6200-COUNT-MANU-PO.                                  23310064
234000     PERFORM 6300-COUNT-KOHL-PO.                                  23320064
234100     PERFORM 6400-COUNT-VENDORS.                                  23330064
234200                                                                  23340064
234300***  COMPUTE PV-FINAL-HDR-DTL-COUNT =                             23350064
234400***      PV-TOTAL-FILE-REC-COUNT + PV-TOTAL-MANU-PO-COUNT.        23360064
234500                                                                  23370064
234600     COMPUTE PV-ADDS-PLUS-CHANGES =                               23380064
234700         PV-NBR-OF-ADDS + PV-NBR-OF-CHANGES + PV-REC-COUNT-HOLD.  23390090
234800                                                                  23400064
234900     PERFORM 6500-DISPLAY-INFO-MESSAGES.                          23410064
235000     PERFORM 6600-DELETE-FROM-PO-EXTR.                            23420097
235100                                                                  23430064
235200* SET CHECKPOINT RESTART TO COMPLETE RUN                          23440064
235300     SET PC-RUN-COMPLETE-CODE   TO TRUE.                          23450064
235400     MOVE PC-RESTART-STEP       TO PV-CKPT-STAT-CODE.             23460064
235500     PERFORM X600-UPDATE-TCKRSTCNTL.                              23470064
235600                                                                  23480064
235700*----------------------------------------------------------------*23490064
235800*                                                                 23500064
235900*----------------------------------------------------------------*23510064
236000 6100-COUNT-RECORDS-TO-FILE.                                      23520064
236100                                                                  23530064
236200     PERFORM WITH TEST AFTER                                      23540064
236300             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 23550064
236400             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         23560064
236500                     SQLCODE = ZERO                               23570064
236600                                                                  23580064
236700         EXEC SQL                                                 23590064
236800             SELECT COUNT(*)                                      23600064
236900             INTO   :PV-TOTAL-FILE-REC-COUNT                      23610064
237000             FROM   TRT_MANU_PO_EXTR                              23620064
237100             WHERE  MANU_DAT_LOD_TMST = :PV-CURRENT-TMST          23630064
237200         END-EXEC                                                 23640064
237300                                                                  23650064
237400         EVALUATE TRUE                                            23660064
237500             WHEN SQLCODE = ZERO                                  23670064
237600                 CONTINUE                                         23680064
237700             WHEN SQLCODE = -904                                  23690064
237800             WHEN SQLCODE = -913                                  23700064
237900                 CONTINUE                                         23710064
238000             WHEN SQLWARN0 NOT = SPACES                           23720064
238100             WHEN SQLCODE < ZERO                                  23730064
238200             WHEN SQLCODE > ZERO                                  23740064
238300                 MOVE '6100-COUNT-RECORDS-TO-FILE'                23750064
238400                                      TO  PV-PARAGRAPH-NAME       23760064
238500                 MOVE 'ERROR ISSUED ON SELECT'                    23770064
238600                                      TO  PV-DB2-OPERATION-MESSAGE23780064
238700                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  23790064
238800                 PERFORM 9100-DB2-ABEND                           23800064
238900         END-EVALUATE                                             23810064
239000     END-PERFORM.                                                 23820064
239100                                                                  23830064
239200     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 23840064
239300         MOVE '6100-COUNT-RECORDS-TO-FILE'                        23850064
239400                                 TO  PV-PARAGRAPH-NAME            23860064
239500         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    23870064
239600                                 TO  PV-DB2-OPERATION-MESSAGE     23880064
239700         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          23890064
239800         PERFORM 9100-DB2-ABEND                                   23900064
239900     END-IF.                                                      23910064
240000                                                                  23920064
240100*----------------------------------------------------------------*23930064
240200*                                                                 23940064
240300*----------------------------------------------------------------*23950064
240400 6200-COUNT-MANU-PO.                                              23960064
240500                                                                  23970064
240600     PERFORM WITH TEST AFTER                                      23980064
240700             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 23990064
240800             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         24000064
240900                     SQLCODE = ZERO OR                            24010064
241000                     SQLCODE = -305                               24020064
241100                                                                  24030064
241200         EXEC SQL                                                 24040064
241300            SELECT SUM(MANU_PO)                                   24050064
241400            INTO   :PV-TOTAL-MANU-PO-COUNT                        24060064
241500            FROM   (SELECT DISTINCT ENT_ID, DC_NBR, 1 AS MANU_PO  24070064
241600                    FROM   TRT_MANU_PO_EXTR                       24080064
241700                    WHERE  MANU_DAT_LOD_TMST = :PV-CURRENT-TMST) B24090064
241800         END-EXEC                                                 24100064
241900                                                                  24110064
242000         EVALUATE TRUE                                            24120064
242100             WHEN SQLCODE = ZERO                                  24130064
242200             WHEN SQLCODE = -305                                  24140064
242300                 CONTINUE                                         24150064
242400             WHEN SQLCODE = -904                                  24160064
242500             WHEN SQLCODE = -913                                  24170064
242600                 CONTINUE                                         24180064
242700             WHEN SQLWARN0 NOT = SPACES                           24190064
242800             WHEN SQLCODE < ZERO                                  24200064
242900             WHEN SQLCODE > ZERO                                  24210064
243000                 MOVE '6200-COUNT-MANU-PO'                        24220064
243100                                      TO  PV-PARAGRAPH-NAME       24230064
243200                 MOVE 'ERROR ISSUED ON SELECT'                    24240064
243300                                      TO  PV-DB2-OPERATION-MESSAGE24250064
243400                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  24260064
243500                 PERFORM 9100-DB2-ABEND                           24270064
243600         END-EVALUATE                                             24280064
243700     END-PERFORM.                                                 24290064
243800                                                                  24300064
243900     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 24310064
244000         MOVE '6200-COUNT-MANU-PO'                                24320064
244100                                 TO  PV-PARAGRAPH-NAME            24330064
244200         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    24340064
244300                                 TO  PV-DB2-OPERATION-MESSAGE     24350064
244400         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          24360064
244500         PERFORM 9100-DB2-ABEND                                   24370064
244600     END-IF.                                                      24380064
244700                                                                  24390064
244800*----------------------------------------------------------------*24400064
244900*                                                                 24410064
245000*----------------------------------------------------------------*24420064
245100 6300-COUNT-KOHL-PO.                                              24430064
245200                                                                  24440064
245300     PERFORM WITH TEST AFTER                                      24450064
245400             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 24460064
245500             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         24470064
245600                     SQLCODE = ZERO                               24480064
245700                                                                  24490064
245800         EXEC SQL                                                 24500064
245900             SELECT COUNT(DISTINCT PO_NBR)                        24510064
246000             INTO   :PV-TOTAL-KOHL-PO-COUNT                       24520064
246100             FROM   TRT_MANU_PO_EXTR                              24530064
246200             WHERE  MANU_DAT_LOD_TMST = :PV-CURRENT-TMST          24540064
246300               AND  INIT_PO_LOD_IND = 'Y'                         24550064
246400         END-EXEC                                                 24560064
246500                                                                  24570064
246600         EVALUATE TRUE                                            24580064
246700             WHEN SQLCODE = ZERO                                  24590064
246800                 CONTINUE                                         24600064
246900             WHEN SQLCODE = -904                                  24610064
247000             WHEN SQLCODE = -913                                  24620064
247100                 CONTINUE                                         24630064
247200             WHEN SQLWARN0 NOT = SPACES                           24640064
247300             WHEN SQLCODE < ZERO                                  24650064
247400             WHEN SQLCODE > ZERO                                  24660064
247500                 MOVE '6300-COUNT-KOHL-PO'                        24670064
247600                                      TO  PV-PARAGRAPH-NAME       24680064
247700                 MOVE 'ERROR ISSUED ON SELECT'                    24690064
247800                                      TO  PV-DB2-OPERATION-MESSAGE24700064
247900                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  24710064
248000                 PERFORM 9100-DB2-ABEND                           24720064
248100         END-EVALUATE                                             24730064
248200     END-PERFORM.                                                 24740064
248300                                                                  24750064
248400     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 24760064
248500         MOVE '6300-COUNT-KOHL-PO'                                24770064
248600                                 TO  PV-PARAGRAPH-NAME            24780064
248700         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    24790064
248800                                 TO  PV-DB2-OPERATION-MESSAGE     24800064
248900         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          24810064
249000         PERFORM 9100-DB2-ABEND                                   24820064
249100     END-IF.                                                      24830064
249200                                                                  24840064
249300*----------------------------------------------------------------*24850064
249400*                                                                 24860064
249500*----------------------------------------------------------------*24870064
249600 6400-COUNT-VENDORS.                                              24880064
249700                                                                  24890064
249800     PERFORM WITH TEST AFTER                                      24900064
249900             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 24910064
250000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         24920064
250100                     SQLCODE = ZERO                               24930064
250200                                                                  24940064
250300         EXEC SQL                                                 24950064
250400             SELECT COUNT(DISTINCT ENT_ID)                        24960064
250500             INTO   :PV-TOTAL-VENDORS                             24970064
250600             FROM   TRT_MANU_PO_EXTR                              24980064
250700             WHERE  MANU_DAT_LOD_TMST = :PV-CURRENT-TMST          24990064
250800         END-EXEC                                                 25000064
250900                                                                  25010064
251000         EVALUATE TRUE                                            25020064
251100             WHEN SQLCODE = ZERO                                  25030064
251200                 CONTINUE                                         25040064
251300             WHEN SQLCODE = -904                                  25050064
251400             WHEN SQLCODE = -913                                  25060064
251500                 CONTINUE                                         25070064
251600             WHEN SQLWARN0 NOT = SPACES                           25080064
251700             WHEN SQLCODE < ZERO                                  25090064
251800             WHEN SQLCODE > ZERO                                  25100064
251900                 MOVE '6400-COUNT-VENDORS'                        25110064
252000                                      TO  PV-PARAGRAPH-NAME       25120064
252100                 MOVE 'ERROR ISSUED ON SELECT'                    25130064
252200                                      TO  PV-DB2-OPERATION-MESSAGE25140064
252300                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  25150064
252400                 PERFORM 9100-DB2-ABEND                           25160064
252500         END-EVALUATE                                             25170064
252600     END-PERFORM.                                                 25180064
252700                                                                  25190064
252800     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 25200064
252900         MOVE '6400-COUNT-VENDORS'                                25210064
253000                                 TO  PV-PARAGRAPH-NAME            25220064
253100         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    25230064
253200                                 TO  PV-DB2-OPERATION-MESSAGE     25240064
253300         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          25250064
253400         PERFORM 9100-DB2-ABEND                                   25260064
253500     END-IF.                                                      25270064
253600                                                                  25280064
253700*----------------------------------------------------------------*25290064
253800*                                                                 25300064
253900*----------------------------------------------------------------*25310064
254000 6500-DISPLAY-INFO-MESSAGES.                                      25320064
254100                                                                  25330064
254200     DISPLAY '**************************************************'.25340064
254300     DISPLAY '*** TOTAL RECORDS ON FILE               '           25350064
254400        PV-TOTAL-FILE-REC-COUNT ' (ONE FOR EACH PO/DC)'.          25360064
254500***  DISPLAY '*** TOTAL DISTINCT PO/DC (MANU PO)  '               25370064
254600***     PV-TOTAL-MANU-PO-COUNT.                                   25380064
254700     DISPLAY '***                                     ---------'  25390064
254800     COMPUTE PV-FINAL-HDR-DTL-COUNT =                             25400064
254900               (PV-TOTAL-FILE-REC-COUNT * 2)                      25410064
255000     DISPLAY '*** TOTAL NWIMPORT RECS TO BE PROCESSED '           25420064
255100        PV-FINAL-HDR-DTL-COUNT.                                   25430064
255200     DISPLAY '***   (OUTPUT FROM TRUT010 WEBCONNECT)'.            25440064
255300     DISPLAY '***'.                                               25450064
255400     DISPLAY '*** TOTAL INITIAL LOADS                 '           25460064
255500        PV-TOTAL-KOHL-PO-COUNT ' (DISTINCT KOHLS PO)'.            25470064
255600     DISPLAY '*** TOTAL DISTINCT VENDORDS             '           25480064
255700        PV-TOTAL-VENDORS.                                         25490064
255800     DISPLAY '**************************************************'.25500064
255900     DISPLAY '*** TOTAL NUMBER OF ADDS                '           25510064
256000        PV-NBR-OF-ADDS.                                           25520064
256100     DISPLAY '*** TOTAL NUMBER OF CHANGES             '           25530064
256200        PV-NBR-OF-CHANGES.                                        25540064
256300     DISPLAY '*** TOTAL RECORDS - FAILED RUN          '           25550090
256400        PV-REC-COUNT-HOLD.                                        25560090
256500     DISPLAY '***                                     ---------'  25570064
256600     DISPLAY '*** TOTAL ADDS PLUS CHANGES             '           25580064
256700        PV-ADDS-PLUS-CHANGES ' (EQUAL TOTAL RECORDS ON FILE)'.    25590064
256800     DISPLAY '**************************************************'.25600064
256900     DISPLAY ' '.                                                 25610064
257000                                                                  25620064
257100                                                                  25630064
257200     DISPLAY '**************************************************'.25640064
257300     DISPLAY '*** TIMESTAMP SET AT BEGINING OF JOB (LOAD TMST)'.  25650064
257400     DISPLAY '*** --------------------------------'.              25660064
257500     DISPLAY '*** ' PV-CURRENT-TMST.                              25670064
257600     DISPLAY '*** --------------------------------'.              25680064
257700     DISPLAY '*** '.                                              25690064
257800     DISPLAY '*** NUMBER OF DAYS FORWARD '                        25700064
257900                  CC-DAYS-FORWARD ' DATE - ' PV-FORWARD-DATE.     25710064
258000     DISPLAY '*** NUMBER OF DAYS BACK    '                        25720064
258100                  CC-DAYS-BACK    ' DATE - ' PV-BACK-DATE.        25730064
258200     DISPLAY '**************************************************'.25740064
258300*----------------------------------------------------------------*25750064
258400*                                                                 25760064
258500*----------------------------------------------------------------*25770064
258600 6600-DELETE-FROM-PO-EXTR.                                        25780064
258700                                                                  25790064
258800     PERFORM WITH TEST AFTER                                      25800064
258900             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 25810064
259000             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES            25820064
259100                  OR SQLCODE = ZERO                               25830064
259200                  OR SQLCODE = +100                               25840064
259300                                                                  25850064
259400         EXEC SQL                                                 25860064
259500             DELETE FROM TRT_MANU_PO_EXTR                         25870064
259600             WHERE (PO_STAT_CDE      IN ('CA', 'CM')              25880064
259700                      AND                                         25890064
259800                    PO_STAT_CHGD_IND = 'Y')                       25900064
259900                OR  DC_DROP_IND      = 'Y'                        25910064
260000         END-EXEC                                                 25920064
260100                                                                  25930064
260200         EVALUATE TRUE                                            25940064
260300             WHEN SQLCODE = ZERO                                  25950064
260400             WHEN SQLCODE = +100                                  25960064
260500                 CONTINUE                                         25970064
260600             WHEN SQLCODE = -904                                  25980064
260700             WHEN SQLCODE = -913                                  25990064
260800                 CONTINUE                                         26000064
260900             WHEN SQLWARN0 NOT = SPACES                           26010064
261000             WHEN SQLCODE < ZERO                                  26020064
261100             WHEN SQLCODE > ZERO                                  26030064
261200                 MOVE '6600-DELETE-FROM-PO-EXTR'                  26040064
261300                                      TO  PV-PARAGRAPH-NAME       26050064
261400                 MOVE 'ERROR ISSUED ON DELETE'                    26060064
261500                                      TO  PV-DB2-OPERATION-MESSAGE26070064
261600                 MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1  26080064
261700                 PERFORM 9100-DB2-ABEND                           26090064
261800         END-EVALUATE                                             26100064
261900     END-PERFORM.                                                 26110064
262000                                                                  26120064
262100     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 26130064
262200         MOVE '6600-DELETE-FROM-PO-EXTR'                          26140064
262300                                 TO  PV-PARAGRAPH-NAME            26150064
262400         MOVE 'MAX RETRIES EXCEEDED ON DELETE'                    26160064
262500                                 TO  PV-DB2-OPERATION-MESSAGE     26170064
262600         MOVE 'TRT_MANU_PO_EXTR' TO  PV-DB2-TABLE-NAME-1          26180064
262700         PERFORM 9100-DB2-ABEND                                   26190064
262800     END-IF.                                                      26200064
262900* 2012-01-31 CLT 40574 START                                      26210064
263000*----------------------------------------------------------------*26220064
263100* GET EARLY DELIVERY DATE, WHICH CAN'T OVERLAP WITH SHIP DATE     26230064
263200*----------------------------------------------------------------*26240064
263300 6700-ADD-7DAYS-EARLY-DEL-DTE.                                    26250064
263400                                                                  26260064
263500         EXEC SQL                                                 26270064
263600           SELECT B.DONT_SHIP_BEF_DTE + 7 DAYS                    26280064
263700             INTO :PLNSHP-DONT-SHIP-BEF-DTE                       26290064
263800             FROM TPURCHS A,                                      26300064
263900                  TPLNSHP B                                       26310064
264000            WHERE A.PO_NBR         = :TRT00000-PO-NBR             26320064
264100              AND A.PO_NBR         = B.PO_NBR                     26330064
264200              AND A.VER_STATUS_CDE = 'A'                          26340064
264300              AND B.VER_STATUS_CDE = 'A'                          26350064
264400              AND A.PO_TYP_CDE      IN ('IN','SM','SP','ST',      26360064
BARB                             'VN','EC','FB','CD','RE','VE')         26370099
264600              AND A.STATUS_CDE      IN ('AC','AP','CA','CM')      26380064
264700             WITH UR                                              26390064
264800         END-EXEC                                                 26400064
264900                                                                  26410064
265000         EVALUATE TRUE                                            26420064
265100             WHEN SQLCODE = ZERO                                  26430064
265200                 CONTINUE                                         26440064
265300*            ***** CRQ26711 START                                 26450068
265400             WHEN SQLCODE = +100                                  26460064
265500                 SET PS-BYPASS-SEND TO TRUE                       26470064
265600*            ***** CRQ26711 END                                   26480068
265700             WHEN SQLWARN0 NOT = SPACES                           26490064
265800             WHEN SQLCODE < ZERO                                  26500064
265900             WHEN SQLCODE > ZERO                                  26510064
266000                 MOVE '6700-ADD-7DAYS-EARLY-DEL-DTE'              26520064
266100                                      TO  PV-PARAGRAPH-NAME       26530064
266200                 MOVE SQLCODE                                     26540064
266300                                      TO  PV-DB2-OPERATION-MESSAGE26550064
266400                 MOVE 'TPLNSHP'       TO  PV-DB2-TABLE-NAME-1     26560064
266500*                ***** CRQ26711 START                             26570068
266600                 MOVE TRT00000-PO-NBR  TO PURCHS-PO-NBR           26580065
266700                 MOVE TRT00000-DC-NBR  TO ALLPLN-DEST-NBR         26590065
266800                 MOVE TRT00000-ENT-ID  TO PURCHS-ENT-ID           26600065
266900*                ***** CRQ26711 END                               26610068
267000                 PERFORM 9100-DB2-ABEND                           26620064
267100         END-EVALUATE.                                            26630064
267200                                                                  26640064
267300* 2012-01-31 CLT 40574 END                                        26650064
267400*----------------------------------------------------------------*26660064
267500*    CHECK TO SEE IF A CHECKPOINT SHOULD BE TAKEN.               *26670064
267600*----------------------------------------------------------------*26680064
267700 X100-CHECKPOINT-CHECK.                                           26690064
267800                                                                  26700064
267900     EXEC SQL                                                     26710064
268000       SET :WS-TMST = CURRENT TIMESTAMP                           26720064
268100     END-EXEC.                                                    26730064
268200                                                                  26740064
268300     IF SQLCODE = +0                                              26750064
268400         CONTINUE                                                 26760064
268500     ELSE                                                         26770064
268600         MOVE 'X100-CHECKPOINT-CHECK' TO  PV-PARAGRAPH-NAME       26780064
268700         MOVE 'ERROR ISSUED ON SET'   TO  PV-DB2-OPERATION-MESSAGE26790064
268800         MOVE 'TRT_MANU_PO_EXTR'      TO  PV-DB2-TABLE-NAME-1     26800064
268900         PERFORM 9100-DB2-ABEND                                   26810064
269000     END-IF.                                                      26820064
269100                                                                  26830064
269200     IF WS-TMST > WS-HOLD-TMST                                    26840064
269300         IF PS-NO-COMMITS-TAKEN                                   26850064
269400             MOVE PC-RESTART-STEP TO PV-CKPT-STAT-CODE            26860064
269500             PERFORM X600-UPDATE-TCKRSTCNTL                       26870064
269600             PERFORM X700-UPDATE-TCKRSTINF                        26880064
269700             SET PS-COMMITS-TAKEN TO TRUE                         26890064
269800         ELSE                                                     26900089
269900             PERFORM X700-UPDATE-TCKRSTINF                        26910089
270000         END-IF                                                   26920064
270100         PERFORM Y100-COMMIT                                      26930064
270200         PERFORM X500-SET-CHECKPOINT-TIME                         26940064
270300     END-IF.                                                      26950064
270400                                                                  26960064
270500 EJECT                                                            26970064
270600*----------------------------------------------------------------*26980064
270700*    CHECK TO SEE IF A CHECKPOINT SHOULD BE TAKEN.               *26990064
270800*----------------------------------------------------------------*27000064
270900 X200-CHECKPOINT-RESTART.                                         27010064
271000                                                                  27020064
271100     PERFORM X400-GET-CHECKPOINT-INFO.                            27030064
271200     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     27040064
271300                                                                  27050064
271400     DISPLAY '** TRKUP305 CHECKPOINT RESTART **'.                 27060064
271500     DISPLAY '** TIMESTAMP USED FROM LAST RUN = '                 27070064
271600              CR-LAST-RUN-TIMESTAMP.                              27080064
271700     DISPLAY '***********************************************'.   27090064
271800                                                                  27100064
271900     MOVE CR-LAST-RUN-TIMESTAMP TO PV-CURRENT-TMST.               27110064
272000     MOVE CR-LAST-RUN-RECS-PRCD TO PV-REC-COUNT-HOLD              27120087
272100                                   PV-REC-COUNT.                  27130087
272200                                                                  27140064
272300 EJECT                                                            27150064
272400*----------------------------------------------------------------*27160064
272500*    SELECT CHECKPOINT RESTART CONTROL INFO.                     *27170064
272600*----------------------------------------------------------------*27180064
272700 X300-GET-CHECKPOINT-CNTL.                                        27190064
272800                                                                  27200064
272900     PERFORM WITH TEST AFTER                                      27210064
273000             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 27220064
273100             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         27230064
273200                     SQLCODE = ZERO                               27240064
273300                                                                  27250064
273400             EXEC SQL                                             27260064
273500              SELECT CKPT_STAT_CODE                               27270064
273600               INTO :PV-CKPT-STAT-CODE                            27280064
273700               FROM TCKRSTCNTL                                    27290064
273800               WHERE PLAN_NAME = :PC-PGM-NAME                     27300064
273900             END-EXEC                                             27310064
274000                                                                  27320064
274100         EVALUATE TRUE                                            27330064
274200             WHEN SQLCODE = ZERO                                  27340064
274300                 CONTINUE                                         27350064
274400             WHEN SQLCODE = -904                                  27360064
274500             WHEN SQLCODE = -913                                  27370064
274600                 CONTINUE                                         27380064
274700             WHEN SQLWARN0 NOT = SPACES                           27390064
274800             WHEN SQLCODE < ZERO                                  27400064
274900             WHEN SQLCODE > ZERO                                  27410064
275000                 MOVE 'X300-GET-CHECKPOINT-CNTL'                  27420064
275100                                      TO  PV-PARAGRAPH-NAME       27430064
275200                 MOVE 'ERROR ISSUED ON SELECT'                    27440064
275300                                      TO  PV-DB2-OPERATION-MESSAGE27450064
275400                 MOVE 'TCKRSTCNTL'    TO  PV-DB2-TABLE-NAME-1     27460064
275500                 PERFORM 9100-DB2-ABEND                           27470064
275600         END-EVALUATE                                             27480064
275700     END-PERFORM.                                                 27490064
275800                                                                  27500064
275900     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 27510064
276000         MOVE 'X300-GET-CHECKPOINT-CNTL'                          27520064
276100                                 TO  PV-PARAGRAPH-NAME            27530064
276200         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    27540064
276300                                 TO  PV-DB2-OPERATION-MESSAGE     27550064
276400         MOVE 'TCKRSTCNTL'       TO  PV-DB2-TABLE-NAME-1          27560064
276500         PERFORM 9100-DB2-ABEND                                   27570064
276600     END-IF.                                                      27580064
276700                                                                  27590064
276800 EJECT                                                            27600064
276900*----------------------------------------------------------------*27610064
277000*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO  *27620064
277100*----------------------------------------------------------------*27630064
277200 X400-GET-CHECKPOINT-INFO.                                        27640064
277300                                                                  27650064
277400     PERFORM WITH TEST AFTER                                      27660064
277500             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 27670064
277600             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         27680064
277700                     SQLCODE = ZERO                               27690064
277800                                                                  27700064
277900             EXEC SQL                                             27710064
278000              SELECT WORK_STRG_DESC                               27720064
278100               INTO :TCKRSTINF-WORK-STRG-DESC                     27730064
278200               FROM TCKRSTINF                                     27740064
278300               WHERE PLAN_NAME = :PC-PGM-NAME                     27750064
278400             END-EXEC                                             27760064
278500                                                                  27770064
278600         EVALUATE TRUE                                            27780064
278700             WHEN SQLCODE = ZERO                                  27790064
278800             WHEN SQLCODE = +100                                  27800064
278900                 CONTINUE                                         27810064
279000             WHEN SQLCODE = -904                                  27820064
279100             WHEN SQLCODE = -913                                  27830064
279200                 CONTINUE                                         27840064
279300             WHEN SQLWARN0 NOT = SPACES                           27850064
279400             WHEN SQLCODE < ZERO                                  27860064
279500             WHEN SQLCODE > ZERO                                  27870064
279600                 MOVE 'X400-GET-CHECKPOINT-INFO'                  27880064
279700                                      TO  PV-PARAGRAPH-NAME       27890064
279800                 MOVE 'ERROR ISSUED ON SELECT'                    27900064
279900                                      TO  PV-DB2-OPERATION-MESSAGE27910064
280000                 MOVE 'TCKRSTINF'     TO  PV-DB2-TABLE-NAME-1     27920064
280100                 PERFORM 9100-DB2-ABEND                           27930064
280200         END-EVALUATE                                             27940064
280300     END-PERFORM.                                                 27950064
280400                                                                  27960064
280500     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 27970064
280600         MOVE 'X400-GET-CHECKPOINT-INFO'                          27980064
280700                                 TO  PV-PARAGRAPH-NAME            27990064
280800         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    28000064
280900                                 TO  PV-DB2-OPERATION-MESSAGE     28010064
281000         MOVE 'TCKRSTINF'        TO  PV-DB2-TABLE-NAME-1          28020064
281100         PERFORM 9100-DB2-ABEND                                   28030064
281200     END-IF.                                                      28040064
281300                                                                  28050064
281400 EJECT                                                            28060064
281500*----------------------------------------------------------------*28070064
281600*    SET THE TIME FOR THE NEXT CHECKPOINT.                       *28080064
281700*----------------------------------------------------------------*28090064
281800 X500-SET-CHECKPOINT-TIME.                                        28100064
281900                                                                  28110064
282000     PERFORM WITH TEST AFTER                                      28120064
282100             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 28130064
282200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         28140064
282300                     SQLCODE = ZERO                               28150064
282400                                                                  28160064
282500             EXEC SQL                                             28170064
282600              SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)28180064
282700               INTO :WS-HOLD-TMST                                 28190064
282800               FROM TCKRSTCNTL                                    28200064
282900               WHERE PLAN_NAME = :PC-PGM-NAME                     28210064
283000             END-EXEC                                             28220064
283100                                                                  28230064
283200         EVALUATE TRUE                                            28240064
283300             WHEN SQLCODE = ZERO                                  28250064
283400             WHEN SQLCODE = +100                                  28260064
283500                 CONTINUE                                         28270064
283600             WHEN SQLCODE = -904                                  28280064
283700             WHEN SQLCODE = -913                                  28290064
283800                 CONTINUE                                         28300064
283900             WHEN SQLWARN0 NOT = SPACES                           28310064
284000             WHEN SQLCODE < ZERO                                  28320064
284100             WHEN SQLCODE > ZERO                                  28330064
284200                 MOVE 'X500-SET-CHECKPOINT-TIME'                  28340064
284300                                      TO  PV-PARAGRAPH-NAME       28350064
284400                 MOVE 'ERROR ISSUED ON SELECT'                    28360064
284500                                      TO  PV-DB2-OPERATION-MESSAGE28370064
284600                 MOVE 'TCKRSTCNTL'    TO  PV-DB2-TABLE-NAME-1     28380064
284700                 PERFORM 9100-DB2-ABEND                           28390064
284800         END-EVALUATE                                             28400064
284900     END-PERFORM.                                                 28410064
285000                                                                  28420064
285100     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 28430064
285200         MOVE 'X500-SET-CHECKPOINT-TIME'                          28440064
285300                                 TO  PV-PARAGRAPH-NAME            28450064
285400         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    28460064
285500                                 TO  PV-DB2-OPERATION-MESSAGE     28470064
285600         MOVE 'TCKRSTCNTL'       TO  PV-DB2-TABLE-NAME-1          28480064
285700         PERFORM 9100-DB2-ABEND                                   28490064
285800     END-IF.                                                      28500064
285900                                                                  28510064
286000 EJECT                                                            28520064
286100*----------------------------------------------------------------*28530064
286200*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *28540064
286300*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *28550064
286400*----------------------------------------------------------------*28560064
286500 X600-UPDATE-TCKRSTCNTL.                                          28570064
286600                                                                  28580064
286700     PERFORM WITH TEST AFTER                                      28590064
286800             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 28600064
286900             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         28610064
287000                     SQLCODE = ZERO                               28620064
287100                                                                  28630064
287200             EXEC SQL                                             28640064
287300                 UPDATE TCKRSTCNTL                                28650064
287400                 SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE          28660064
287500                 WHERE PLAN_NAME      = :PC-PGM-NAME              28670064
287600             END-EXEC                                             28680064
287700                                                                  28690064
287800         EVALUATE TRUE                                            28700064
287900             WHEN SQLCODE = ZERO                                  28710064
288000             WHEN SQLCODE = +100                                  28720064
288100                 CONTINUE                                         28730064
288200             WHEN SQLCODE = -904                                  28740064
288300             WHEN SQLCODE = -913                                  28750064
288400                 CONTINUE                                         28760064
288500             WHEN SQLWARN0 NOT = SPACES                           28770064
288600             WHEN SQLCODE < ZERO                                  28780064
288700             WHEN SQLCODE > ZERO                                  28790064
288800                 MOVE 'X600-UPDATE-TCKRSTCNTL'                    28800064
288900                                      TO  PV-PARAGRAPH-NAME       28810064
289000                 MOVE 'ERROR ISSUED ON UPDATE'                    28820064
289100                                      TO  PV-DB2-OPERATION-MESSAGE28830064
289200                 MOVE 'TCKRSTCNTL'    TO  PV-DB2-TABLE-NAME-1     28840064
289300                 PERFORM 9100-DB2-ABEND                           28850064
289400         END-EVALUATE                                             28860064
289500     END-PERFORM.                                                 28870064
289600                                                                  28880064
289700     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 28890064
289800         MOVE 'X600-UPDATE-TCKRSTCNTL'                            28900064
289900                                 TO  PV-PARAGRAPH-NAME            28910064
290000         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    28920064
290100                                 TO  PV-DB2-OPERATION-MESSAGE     28930064
290200         MOVE 'TCKRSTCNTL'       TO  PV-DB2-TABLE-NAME-1          28940064
290300         PERFORM 9100-DB2-ABEND                                   28950064
290400     END-IF.                                                      28960064
290500                                                                  28970064
290600     EJECT                                                        28980064
290700*----------------------------------------------------------------*28990064
290800*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *29000064
290900*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *29010064
291000*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *29020064
291100*----------------------------------------------------------------*29030064
291200 X700-UPDATE-TCKRSTINF.                                           29040064
291300                                                                  29050064
291400*    MOVE PV-CURRENT-TMST       TO CKPT-RESTART-INFO              29060087
291500     MOVE PV-CURRENT-TMST       TO CR-LAST-RUN-TIMESTAMP          29070087
291600     MOVE PV-REC-COUNT          TO CR-LAST-RUN-RECS-PRCD          29080087
291700     MOVE CKPT-RESTART-INFO     TO TCKRSTINF-WORK-STRG-DESC-TEXT. 29090064
291800     MOVE 4022                  TO TCKRSTINF-WORK-STRG-DESC-LEN.  29100064
291900                                                                  29110064
292000     PERFORM WITH TEST AFTER                                      29120064
292100             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 29130064
292200             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR         29140064
292300                     SQLCODE = ZERO                               29150064
292400                                                                  29160064
292500             EXEC SQL                                             29170064
292600                 UPDATE TCKRSTINF                                 29180064
292700                 SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC 29190064
292800                 WHERE PLAN_NAME      = :PC-PGM-NAME              29200064
292900             END-EXEC                                             29210064
293000                                                                  29220064
293100         EVALUATE TRUE                                            29230064
293200             WHEN SQLCODE = ZERO                                  29240064
293300             WHEN SQLCODE = +100                                  29250064
293400                 CONTINUE                                         29260064
293500             WHEN SQLCODE = -904                                  29270064
293600             WHEN SQLCODE = -913                                  29280064
293700                 CONTINUE                                         29290064
293800             WHEN SQLWARN0 NOT = SPACES                           29300064
293900             WHEN SQLCODE < ZERO                                  29310064
294000             WHEN SQLCODE > ZERO                                  29320064
294100                 MOVE 'X700-UPDATE-TCKRSTINF'                     29330064
294200                                      TO  PV-PARAGRAPH-NAME       29340064
294300                 MOVE 'ERROR ISSUED ON UPDATE'                    29350064
294400                                      TO  PV-DB2-OPERATION-MESSAGE29360064
294500                 MOVE 'TCKRSTINF'     TO  PV-DB2-TABLE-NAME-1     29370064
294600                 PERFORM 9100-DB2-ABEND                           29380064
294700         END-EVALUATE                                             29390064
294800     END-PERFORM.                                                 29400064
294900                                                                  29410064
295000     IF  PV-RETRY-COUNTER GREATER  PC-MAX-RETRIES                 29420064
295100         MOVE 'X700-UPDATE-TCKRSTINF'                             29430064
295200                                 TO  PV-PARAGRAPH-NAME            29440064
295300         MOVE 'MAX RETRIES EXCEEDED ON UPDATE'                    29450064
295400                                 TO  PV-DB2-OPERATION-MESSAGE     29460064
295500         MOVE 'TCKRSTINF'        TO  PV-DB2-TABLE-NAME-1          29470064
295600         PERFORM 9100-DB2-ABEND                                   29480064
295700     END-IF.                                                      29490064
295800                                                                  29500064
295900 EJECT                                                            29510064
296000                                                                  29520064
296100*----------------------------------------------------------------*29530064
296200*    ISSUES AN SQL COMMIT WORK AFTER A LUW HAS BEEN COMPLETED.   *29540064
296300*----------------------------------------------------------------*29550064
296400 Y100-COMMIT.                                                     29560064
296500                                                                  29570064
296600     EXEC SQL                                                     29580064
296700         COMMIT                                                   29590064
296800     END-EXEC.                                                    29600064
296900                                                                  29610064
297000         EVALUATE TRUE                                            29620064
297100             WHEN SQLCODE = ZERO                                  29630064
297200             WHEN SQLCODE = +100                                  29640064
297300                 DISPLAY '**************************************' 29650064
297400                 DISPLAY 'SUCCESSFUL COMMIT AT STEP '             29660064
297500                          PC-RESTART-STEP                         29670064
297600                 DISPLAY '**************************************' 29680064
297700             WHEN SQLCODE = -904                                  29690064
297800             WHEN SQLCODE = -913                                  29700064
297900                 CONTINUE                                         29710064
298000             WHEN SQLWARN0 NOT = SPACES                           29720064
298100             WHEN SQLCODE < ZERO                                  29730064
298200             WHEN SQLCODE > ZERO                                  29740064
298300                 MOVE 'Y100-COMMIT'   TO  PV-PARAGRAPH-NAME       29750064
298400                 MOVE 'UNSUCCESSFUL COMMIT'                       29760064
298500                                      TO  PV-DB2-OPERATION-MESSAGE29770064
298600                 MOVE 'DB2'           TO  PV-DB2-TABLE-NAME-1     29780064
298700                 PERFORM 9100-DB2-ABEND                           29790064
298800         END-EVALUATE.                                            29800064
298900                                                                  29810064
299000*----------------------------------------------------------------*29820064
299100* WRITE RECORD TO FILE                                            29830064
299200*----------------------------------------------------------------*29840064
299300 8000-WRITE-RECORD.                                               29850064
299400                                                                  29860064
299500     MOVE TR302-REQ-EARLY-AVAIL-DTE TO PV-REFORMATED-DATE.        29870064
299600     MOVE PV-REFORMAT-YEAR          TO PV-YEAR.                   29880064
299700     MOVE PV-REFORMAT-MONTH         TO PV-MONTH.                  29890064
299800     MOVE PV-REFORMAT-DAY           TO PV-DAY.                    29900064
299900                                                                  29910064
300000*    ***** CRQ26711 START                                         29920068
300100     IF PS-BYPASS-SEND                                            29930064
300200       SET PS-BYPASS-SEND-NO TO TRUE                              29940064
300300       DISPLAY '*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!'                29950064
300400       DISPLAY ' WARNING!  DID NOT SEND THIS PO'                  29960064
300500       DISPLAY '    PO/DC - ' TR302-PO-NBR ' ' TR302-DC-NBR       29970064
300600       DISPLAY '    ENTID - ' TR302-ORIGIN-ENT-ID                 29980064
300700       DISPLAY ' EARLY DT - ' TR302-REQ-EARLY-AVAIL-DTE           29990064
300800       DISPLAY '  LATE DT - ' TR302-REQ-LATE-AVAIL-DTE            30000064
300900       DISPLAY '  DT LOAD - ' TRT00000-MANU-DAT-LOD-TMST          30010064
301000       DISPLAY ' LST UPDT - ' TRT00000-LAST-UPD-TMST              30020064
301100     ELSE                                                         30030064
301200       WRITE TMS-PO-HDR-DTL-RECORD                                30040064
301300          FROM TR302-TMS-PO-HDR-DTL-RECORD                        30050064
301400     END-IF.                                                      30060064
301500*    ***** CRQ26711 END                                           30070068
301600                                                                  30080064
301700*----------------------------------------------------------------*30090064
301800*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    30100064
301900*  ERROR OR WARNING CODE OCCURS.                                  30110064
302000*----------------------------------------------------------------*30120064
302100 9100-DB2-ABEND.                                                  30130064
302200                                                                  30140064
302300     DISPLAY '9100-DB2-ABEND'.                                    30150064
302400     DISPLAY '** ABEND           **'.                             30160064
302500     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              30170064
302600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        30180064
302700     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.      30190064
302800     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-2.      30200064
302900     DISPLAY '**                 ** = ' PV-DB2-TABLE-NAME-3.      30210064
303000     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MESSAGE. 30220064
303100*    **** CRQ26711 START                                          30230068
303200*    *****************************************************        30240065
303300*    * THE NEXT 3 FIELDS MAY NOT BE FROM THE TABLES THEY *        30250065
303400*    * INDICATE.  CHECK THE CALLING PARAGRAPH WHICH MAY  *        30260065
303500*    * MOVED DATA FROM ANOTHER SOURCE OR NOTHING AT ALL. *        30270065
303600*    *****************************************************        30280065
303700     DISPLAY '** PO NUMBER       ** = ' PURCHS-PO-NBR.            30290064
303800     DISPLAY '** DC NUMBER       ** = ' ALLPLN-DEST-NBR.          30300064
303900     DISPLAY '** ENT ID          ** = ' PURCHS-ENT-ID.            30310064
304000*    **** CRQ26711 END                                            30320068
304100* WR40574 START                                                   30330064
304200     DISPLAY '** MIN DEPT NBR    ** = ' PURCHS-DEPT-NBR.          30340064
304300     DISPLAY '** MIN CL NBR      ** = ' XLT00004-MAJ-CL-NBR.      30350064
304400* WR40574 END                                                     30360064
304500                                                                  30370064
304600*----------------------------------------------------------------*30380064
304700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    30390064
304800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         30400064
304900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     30410064
305000* FORMAT.                                                         30420064
305100*----------------------------------------------------------------*30430064
305200     COPY DPPD004.                                                30440064
305300                                                                  30450064
305400     SET PC-DB2-ERROR TO TRUE.                                    30460064
305500     CALL 'ILBOABN0' USING ABEND-CODE.                            30470064
305600*                                                                 30480064
305700 9200-ABEND.                                                      30490082
305800******************************************************************30500082
305900*  PERFORMS A NON-SQL ABEND FOR THE PROGRAM                       30510082
306000******************************************************************30520082
306100     DISPLAY '***************************'.                       30530082
306200     DISPLAY '**       ABEND           **'.                       30540082
306300     DISPLAY '**  IN PROGRAM TRKUP305  **'.                       30550082
306400     DISPLAY '***************************'.                       30560082
306500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        30570082
306600     DISPLAY '** ERROR           ** = ' PV-ERROR-MESSAGE-1.       30580082
306700     DISPLAY '**                 ** = ' PV-ERROR-MESSAGE-2.       30590082
306800     CALL 'ILBOABN0' USING ABEND-CODE.                            30600083
