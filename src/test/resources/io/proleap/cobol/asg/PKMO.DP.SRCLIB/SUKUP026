000100 TITLE 'DELETE CARTON DIRECTIVES'.                                00010001
000200 IDENTIFICATION DIVISION.                                                 
000300 PROGRAM-ID.    SUKUP026.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN   DECEMBER 2008.                                            
000700 DATE-COMPILED.                                                           
000800 ENVIRONMENT DIVISION.                                                    
000900 CONFIGURATION SECTION.                                                   
001000 SOURCE-COMPUTER.        IBM-3090.                                        
001100 OBJECT-COMPUTER.        IBM-3090.                                        
001200                                                                          
001300 INPUT-OUTPUT SECTION.                                                    
001400 FILE-CONTROL.                                                            
001500                                                                          
001600     SELECT UNLOAD-FILE                                                   
001700         ASSIGN TO INP01.                                                 
001800                                                                          
001900                                                                          
002000******************************************************************        
002100 DATA DIVISION.                                                           
002200 FILE SECTION.                                                            
002300                                                                          
002400 FD  UNLOAD-FILE                                                          
002500     RECORDING MODE IS F                                                  
002600     LABEL RECORDS ARE STANDARD                                           
002700     BLOCK CONTAINS 0 RECORDS.                                            
002800                                                                          
002900*    FROM SUKUT136                                                        
003000 01  UNLOAD-REC   PIC X(168).                                             
003100/                                                                         
003200 WORKING-STORAGE SECTION.                                                 
003300                                                                          
003400     COPY SURD095.                                                        
003500                                                                          
003600     COPY DPWS004.                                                        
003700*                                                                         
003800     EXEC SQL                                                             
003900         INCLUDE SUT00102                                                 
004000     END-EXEC.                                                            
004100                                                                          
004200     EXEC SQL                                                             
004300          INCLUDE SQLCA                                                   
004400     END-EXEC.                                                            
004500                                                                          
004600 01  ABEND-CODE                      PIC S9(04)    VALUE +0               
004700                                                   COMP SYNC.             
004800                                                                          
004900 01  PS-PROGRAM-SWITCHES.                                                 
005000     05  PS-END-OF-DRIVE              PIC  X(01) VALUE 'N'.               
005100         88  PS-END-DRIVE-YES                    VALUE 'Y'.               
005200         88  PS-END-DRIVE-NO                     VALUE 'N'.               
005300                                                                          
005400 01  PC-PROGRAM-CONSTANTS.                                                
005500     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08) VALUE 'SUKUP026'.         
005600                                                                          
005700 01  DK-DB2-VARIABLES.                                                    
005800     05  DK-PURGE-DATE                PIC X(10).                          
005900                                                                          
006000 01  PV-PROGRAM-VARIABLES.                                                
006100                                                                          
006200     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.          
006300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.          
006400     05  PV-READ-COUNTER             PIC  S9(9) COMP VALUE ZERO.          
006500     05  PV-COMMIT-COUNTER           PIC  S9(9) COMP VALUE ZERO.          
006600     05  PV-DELETE-COUNT             PIC  S9(9) COMP VALUE ZERO.          
006700     05  PV-NOTFND-COUNTER           PIC  S9(9) COMP VALUE ZERO.          
006800     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.                     
006900     05  PV-FUNC-QTY                 PIC  S9(4) COMP VALUE ZERO.          
007000/                                                                         
007100 PROCEDURE DIVISION.                                                      
007200                                                                          
007300     PERFORM 1000-INITIALIZE.                                             
007400                                                                          
007500     PERFORM 2000-PROCESS                                                 
007600             UNTIL PS-END-DRIVE-YES                                       
007700                                                                          
007800     PERFORM 9000-EOJ-ROUTINE.                                            
007900                                                                          
008000     GOBACK.                                                              
008100/                                                                         
008200 1000-INITIALIZE.                                                         
008300                                                                          
008400     DISPLAY '* * * * * * * * * * * '.                                    
008500     DISPLAY 'CURRENT PROGRAM ' PC-CURRENT-PROGRAM-NAME.                  
008600                                                                          
008700     OPEN INPUT UNLOAD-FILE                                               
008800     PERFORM 8000-READ-SU095-REC.                                         
008900                                                                          
009000 2000-PROCESS.                                                            
009100                                                                          
009200     PERFORM 7000-DELETE-ASGMT.                                           
009300     IF PV-COMMIT-COUNTER > 50                                            
009400         MOVE ZERO                    TO PV-COMMIT-COUNTER                
009500         PERFORM 7900-COMMIT                                              
009600     END-IF.                                                              
009700                                                                          
009800     PERFORM 8000-READ-SU095-REC.                                         
009900                                                                          
010000 7000-DELETE-ASGMT.                                                       
010100                                                                          
010200     MOVE '7000-DELETE-ASGMT'         TO PV-PARAGRAPH-NAME.               
010300                                                                          
010400     MOVE  SU095-BRCDE-NBR            TO SUT00102-BRCDE-NBR               
010500     MOVE  SU095-CRE-TMST             TO SUT00102-CRE-TMST.               
010600                                                                          
010700     EXEC SQL                                                             
010800         DELETE                                                           
010900         FROM                                                             
011000             SUT_CART_DIRV_TRKG                                           
011100         WHERE                                                            
011200             BRCDE_NBR             = :SUT00102-BRCDE-NBR                  
011300         AND CRE_TMST              = :SUT00102-CRE-TMST                   
011400     END-EXEC.                                                            
011500                                                                          
011600     EVALUATE TRUE                                                        
011700         WHEN SQLCODE = ZERO                                              
011800             ADD SQLERRD(3)           TO PV-DELETE-COUNT                  
011900             ADD 1                    TO PV-COMMIT-COUNTER                
012000         WHEN SQLCODE = +100                                              
012100             ADD 1                    TO PV-NOTFND-COUNTER                
012200         WHEN SQLWARN0 NOT = SPACES                                       
012300         WHEN SQLCODE < ZERO                                              
012400         WHEN SQLCODE > ZERO                                              
012500             DISPLAY 'DELETE FAILED '                                     
012600             'BRCDE_NBR =' SUT00102-BRCDE-NBR                             
012700             ' CRE_TMST=' SUT00102-CRE-TMST                               
012800             MOVE 'DELETE'        TO PV-DB2-OPERATION-ATTEMPTED           
012900             PERFORM 9100-SQL-ABEND                                       
013000     END-EVALUATE.                                                        
013100                                                                          
013200 7900-COMMIT.                                                             
013300     MOVE '7900-COMMIT'               TO PV-PARAGRAPH-NAME.               
013400                                                                          
013500     EXEC SQL                                                             
013600         COMMIT                                                           
013700     END-EXEC.                                                            
013800                                                                          
013900     EVALUATE TRUE                                                        
014000         WHEN SQLCODE = ZERO                                              
014100             ADD SQLERRD(3)           TO PV-DELETE-COUNT                  
014200         WHEN SQLWARN0 NOT = SPACES                                       
014300         WHEN SQLCODE < ZERO                                              
014400         WHEN SQLCODE > ZERO                                              
014500             MOVE 'DELETE'        TO PV-DB2-OPERATION-ATTEMPTED           
014600             PERFORM 9100-SQL-ABEND                                       
014700     END-EVALUATE.                                                        
014800/                                                                         
014900 8000-READ-SU095-REC.                                                     
015000     READ UNLOAD-FILE INTO                                                
015100         SU095-RECORD                                                     
015200     AT END                                                               
015300         SET PS-END-DRIVE-YES         TO TRUE                             
015400     NOT AT END                                                           
015500         ADD +1                       TO PV-READ-COUNTER                  
015600     END-READ.                                                            
015700/                                                                         
015800 9000-EOJ-ROUTINE.                                                        
015900                                                                          
016000     CLOSE UNLOAD-FILE                                                    
016100                                                                          
016200     MOVE PV-READ-COUNTER             TO PV-DISPLAY-COUNT.                
016300     DISPLAY 'TOTAL RECORDS READ             = ' PV-DISPLAY-COUNT.        
016400                                                                          
016500                                                                          
016600     MOVE PV-DELETE-COUNT             TO PV-DISPLAY-COUNT.                
016700     DISPLAY 'ROWS DELETED                   = ' PV-DISPLAY-COUNT.        
016800                                                                          
016900     MOVE PV-NOTFND-COUNTER           TO PV-DISPLAY-COUNT.                
017000     DISPLAY 'ROWS NOT FOUND FOR DELETION    = ' PV-DISPLAY-COUNT.        
017100                                                                          
017200     DISPLAY '* * * * * * * * * * * '.                                    
017300                                                                          
017400 9100-SQL-ABEND.                                                          
017500     DISPLAY '9100-SQL-ABEND'.                                            
017600     DISPLAY '** ABEND     **'.                                           
017700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
017800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.                      
017900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
018000                                                                          
018100     COPY DPPD004.                                                        
018200                                                                          
018300     MOVE +4013                  TO ABEND-CODE.                           
018400     CALL 'ILBOABN0' USING ABEND-CODE.                                    
018500                                                                          
