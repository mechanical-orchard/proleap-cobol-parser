000100*----------------------------------------------------------------*00010013
000200 IDENTIFICATION DIVISION.                                         00020003
000300*----------------------------------------------------------------*00030003
000400 PROGRAM-ID.           SAKUT008.                                  00040003
000500 AUTHOR.               BARB ERTL - SAFENET CONSULTING.            00050003
000600 INSTALLATION.         KOHLS DEPARTMENT STORES.                   00060003
000700 DATE-WRITTEN          DECEMBER 1999.                             00070003
000800 DATE-COMPILED.                                                   00080003
000900                                                                  00090003
001000******************************************************************00100003
001100*     THIS PROGRAM REPLACES PSKUT080 AND WILL CREATE TWO EXTRACT *00110003
001200*     FILES IN FORMAT KDU1806.                                   *00120003
001300*                                                                *00130003
001400*     THE NEW PROGRAM PRODUCES A SINGLE EXTRACT FILE FOR         *00140003
001500*     POSTING TO THE MERCHANDISE LEDGER.  THE INPUT IS FROM      *00150003
001600*     THE TEPTRN TABLE.  THE TEPTRN TABLE IS READ SEQUENTIALLY.  *00160003
001700******************************************************************00170003
001800                                                                  00180003
001900***************************************************************** 00190003
002000*                                                                 00200003
002100*  CHANGED 09/11/00 BY DOUG JONES                                 00210003
002200*   PITTS #                                                       00220003
002300*   MODIFIED PROGRAM TO NOT USE QUAL CODE AND USE TRAN TYPE IN    00230003
002400*   ITS PLACE.                                                    00240003
002500*                                                                 00250003
002600******************************************************************00260003
002700*  LIHUA LIANG   9/14/2000                                        00270003
002800*  MODIFIED CODE TO ACCESS TEPEID FOR OTR 2.                      00280003
002900***************************************************************** 00290003
003000*  CHANGES MADE:                                                  00300003
003100*     BY GAYLE HAUPT                           WR: 21711          00310003
003200*           01/12/2001                                            00320003
003300*  INCLUDED 98300 THROUGH 98399 IN THE 88 LEVEL VARIABLE          00330003
003400*  BOTH-GIFT-DEPT-CLASS.                                          00340003
003500***************************************************************** 00350005
003600*  CHANGES MADE:                                                  00360003
003700*     BY ALEXIS KEIKER                         WR: 23433          00370003
003800*           04/16/2002                                            00380003
003900*  CHANGED THE SKU FIELD THAT IT WOULD NO LONGER INCLUDE SEQ NBR, 00390003
004000*  DEPT NBR, AND SUB CLASS NBR.  ALSO INCLUDED A MAJOR CLASS      00400003
004100*  FIELD THAT WAS ADDED TO THE TEPITM TABLE.  SKU WILL NOW BE     00410003
004200*  NON INTELLIGENT INSTEAD OF INTELLIGENT.                        00420003
004300***************************************************************** 00430005
004400*  CHANGES MADE:                                                  00440005
004500*     BY ALEXIS KEIKER                       PITS: PM00490796     00450005
004600*           08/29/2002                                            00460005
004700*  CHANGED THE FACT THAT IF THE RECORD HAD A DEPT/CLASS ERROR     00470005
004800*  CODE THAT NOT ONLY THE DEPT/CLASS WOULD BE CHANGED TO A 09910, 00480005
004900*  BUT THAT ALSO THE SKU WOULD BE CHANGED TO 09910000 AND         00490005
005000*  MAJOR CLASS WOULD BE CHANGED TO A 10.                          00500005
005100******************************************************************00510003
005200*  CHANGES MADE:                                                 *00520046
005300*     BY JIM HUNTER                          WR: 33714           *00530047
005400*           03/25/2008                                           *00540047
005500*     EXCLUDE THIRD PARTY CARD SALES (DEPARTMENTS 833 AND 834)   *00550047
005600******************************************************************00560047
005700*  CHANGES MADE:                                                 *00570047
005800*     BY COGNIZANT                           WR: CHG0092405      *00580047
005900*           08/28/2014                                           *00590047
006000*     EXCLUDE MARKET PLACE DEPARTMENTS 070 AND WAYFAIR CLASS 91  *00600047
006100******************************************************************00610047
006200*  CHANGES MADE:                                                 *00620047
006300*     BY JIM HUNTER                          WR: CHG0207210      *00630047
006400*           08/24/2018                                           *00640047
006500*     REPLACE COPYBOOK KDU1806 WITH PSWS010                      *00650047
12386A******************************************************************00661056
12386A*  CHANGES MADE:                                                 *00662056
12386A*     BY COGNIZANT                           WR:12386A           *00663056
12386A*           11/30/2018                                           *00664056
12386A*                                                                *00665056
MKTPLC******************************************************************00665163
MKTPLC*  CHANGES MADE:                                                  00665263
MKTPLC*     BY JIM HUNTER     07/29/2020           CHG0246098           00665365
MKTPLC*     REPLACE WAYFAIR DEPT 070 CHECK WITH MARKETPLACE DEPT 985    00665463
MKTPLC*     CHECK TO PREVENT MARKETPLACE ITEMS FROM GOING TO ML.        00665563
MKTPLC*     ADDED MANY DISPLAYS AT THE END OF THE PROGRAM TO SHOW THE   00665668
MKTPLC*     TOTAL SALES, ML SALES AND EXCLUDED UNITS AND AMOUNTS.       00665768
SEPHOR******************************************************************00666074
SEPHOR*  CHANGES MADE:                                                  00667074
SEPHOR*     BY JIM HUNTER     04/19/2022           CHG0268920           00668074
SEPHOR*     ADDED SEPHORA GIFT CARDS (DEPT 712) TO THE LIST OF DEPTS    00669074
SEPHOR*     (KOHL'S GIFT CARDS, BLACKHAWK GIFT CARDS, MARKETPLACE, ETC.)00669174
SEPHOR*     THAT ARE NOT SENT TO ML.                                    00669274
006600******************************************************************00669574
006700 ENVIRONMENT DIVISION.                                            00670017
006800******************************************************************00680017
006900                                                                  00690003
007000 CONFIGURATION SECTION.                                           00700003
007100 INPUT-OUTPUT SECTION.                                            00710003
007200 FILE-CONTROL.                                                    00720003
007300                                                                  00730003
007400     SELECT POS-DATE-FILE                                         00740003
007500         ASSIGN TO INP01.                                         00750003
007600                                                                  00760003
007700     SELECT SALES-EXTRACT-FILE                                    00770003
007800         ASSIGN TO OUT01.                                         00780003
007900                                                                  00790003
008000     SELECT CORRECTIONS-FILE                                      00800003
008100         ASSIGN TO OUT02.                                         00810003
008200                                                                  00820003
008300     SELECT SALES-EXTRACT-INVNTRY-FILE                            00830007
008400         ASSIGN TO OUT03.                                         00840007
008500                                                                  00850007
008600     SELECT CORRECTIONS-INVNTRY-FILE                              00860007
008700         ASSIGN TO OUT04.                                         00870007
008800                                                                  00880007
008900     SELECT ML-REPORT                                             00890003
009000         ASSIGN TO RPT01.                                         00900003
009100                                                                  00910003
009200                                                                  00920048
009300                                                                  00930003
009400*----------------------------------------------------------------*00940003
009500 DATA DIVISION.                                                   00950003
009600*----------------------------------------------------------------*00960003
009700                                                                  00970003
009800 FILE SECTION.                                                    00980003
009900                                                                  00990003
010000 FD POS-DATE-FILE                                                 01000003
010100     RECORDING MODE IS F                                          01010003
010200     LABEL RECORDS ARE STANDARD                                   01020003
010300     RECORD CONTAINS 80 CHARACTERS                                01030003
010400     BLOCK CONTAINS 0 RECORDS                                     01040003
010500     DATA RECORD IS POS-DATE-RECORD.                              01050003
010600                                                                  01060003
010700 01 POS-DATE-RECORD        PIC X(80).                             01070003
010800                                                                  01080003
010900 FD  SALES-EXTRACT-FILE                                           01090003
011000     RECORDING MODE IS F                                          01100003
011100     LABEL RECORDS ARE STANDARD                                   01110003
011200     BLOCK CONTAINS 0 RECORDS                                     01120003
011300     RECORD CONTAINS 065 CHARACTERS                               01130003
011400     DATA RECORD IS SALES-EXTRACT-RECORD.                         01140003
011500                                                                  01150003
011600 01  SALES-EXTRACT-RECORD             PIC X(65).                  01160003
011700                                                                  01170003
011800 FD  SALES-EXTRACT-INVNTRY-FILE                                   01180008
011900     RECORDING MODE IS F                                          01190006
012000     LABEL RECORDS ARE STANDARD                                   01200006
012100     BLOCK CONTAINS 0 RECORDS                                     01210006
012200     RECORD CONTAINS 070 CHARACTERS                               01220006
012300     DATA RECORD IS SALES-EXTRACT-INVNTRY-RECORD.                 01230006
012400                                                                  01240006
012500 01  SALES-EXTRACT-INVNTRY-RECORD     PIC X(70).                  01250006
012600                                                                  01260006
012700 FD  CORRECTIONS-FILE                                             01270003
012800     RECORDING MODE IS F                                          01280003
012900     LABEL RECORDS ARE STANDARD                                   01290003
013000     BLOCK CONTAINS 0 RECORDS                                     01300003
013100     RECORD CONTAINS 065 CHARACTERS                               01310003
013200     DATA RECORD IS CORRECTIONS-RECORD.                           01320003
013300                                                                  01330003
013400 01  CORRECTIONS-RECORD               PIC X(65).                  01340003
013500                                                                  01350003
013600 FD  CORRECTIONS-INVNTRY-FILE                                     01360006
013700     RECORDING MODE IS F                                          01370006
013800     LABEL RECORDS ARE STANDARD                                   01380006
013900     BLOCK CONTAINS 0 RECORDS                                     01390006
014000     RECORD CONTAINS 070 CHARACTERS                               01400006
014100     DATA RECORD IS CORRECTIONS-INVNTRY-RECORD.                   01410006
014200                                                                  01420006
014300 01  CORRECTIONS-INVNTRY-RECORD       PIC X(70).                  01430006
014400                                                                  01440006
014500 FD  ML-REPORT                                                    01450003
014600     RECORDING MODE IS F                                          01460003
014700     BLOCK CONTAINS 0 RECORDS.                                    01470003
014800                                                                  01480003
014900 01  ML-REPORT-RECORD                 PIC X(132).                 01490003
015000                                                                  01500048
015100 WORKING-STORAGE SECTION.                                         01510003
015200                                                                  01520003
015300 01  FILLER                           PIC X(32)      VALUE        01530003
015400     '   WORKING STORAGE STARTS HERE  '.                          01540003
015500                                                                  01550003
015600                                                                  01560003
015700 01  PC-PROGRAM-CONSTANTS.                                        01570003
015800     05  PC-ROW-NOT-FOUND             PIC S9(04)     VALUE +100   01580003
015900                                                     COMP SYNC.   01590003
016000     05  PC-SALES-RECORD-CODE         PIC 9(01)      VALUE 2.     01600003
016100     05  PC-CASH-SALE-TRN-TYPE-CODE   PIC 9(01)      VALUE 1.     01610003
016200     05  PC-MISC-CLASS-10             PIC 9(02)      VALUE 10.    01620003
016300     05  PC-MISC-DEPT-CLASS-09910     PIC 9(05)      VALUE 09910. 01630004
016400     05  PC-MISC-SKU-09910000         PIC 9(08)      VALUE        01640004
016500                                                     09910000.    01650004
016600     05  PC-TAX-SKU-09970000          PIC 9(08)      VALUE        01660003
016700                                                     09970000.    01670003
016800     05  PC-TAX-DEPT-CLASS-09970      PIC 9(05)      VALUE 09970. 01680003
016900     05  PC-TAX-CLASS-70              PIC 9(02)      VALUE 70.    01690003
017000     05  PC-EMP-DISC-SKU-09990000     PIC 9(08)      VALUE        01700003
017100                                                     09990000.    01710003
017200     05  PC-EMP-DISC-DEPT-CLASS-09990 PIC 9(05)      VALUE 09990. 01720003
017300     05  PC-EMP-DISC-CLASS-90         PIC 9(02)      VALUE 90.    01730003
017400     05  PC-LITERAL-PROGRAM-NO        PIC X(08)      VALUE        01740003
017500         'SAKUT008'.                                              01750003
017600     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)      VALUE        01760003
017700                                                     'SAKUT008'.  01770003
017800     05  PC-REPORT-NBR-1              PIC 9          VALUE 1.     01780003
017900     05  PC-OP-CO-NMBR                PIC XX         VALUE '03'.  01790003
018000     05  PC-MDSE-SUB-CLASS-LEVEL      PIC XXX        VALUE 'SCL'. 01800003
018100                                                                  01810003
018200                                                                  01820003
018300 01  PV-PROGRAM-VARIABLES.                                        01830003
018400     05  PV-PAGE-CNT                  PIC S9(5)      VALUE 0      01840003
018500                                                     COMP-3.      01850003
018600     05  PV-SAVE-FIRST-TERML          PIC 9(04)      VALUE 0000.  01860003
018700     05  PV-SAVE-SALES-DATE           PIC X(10)      VALUE SPACES.01870003
018800     05  PV-DISPLAY-NBR-4             PIC 9(04)      VALUE ZERO.  01880003
018900     05  PV-DISPLAY-SIGNED-4          PIC ----9      VALUE ZERO.  01890003
019000     05  PV-DISPLAY-NBR-15            PIC 9(15)      VALUE ZERO.  01900003
019100     05  PV-EDIT-DATE.                                            01910003
019200         10  PV-EDIT-DATE-MM          PIC 9(02).                  01920003
019300         10  PV-EDIT-DATE-DD          PIC 9(02).                  01930003
019400         10  PV-EDIT-DATE-YY          PIC 9(02).                  01940003
019500     05  PV-POS-DATE-YMD         PIC X(10).                       01950003
019600     05  FILLER                  REDEFINES PV-POS-DATE-YMD.       01960003
019700         10  FILLER              PIC X(2).                        01970003
019800         10  PV-POS-DATE-YEAR    PIC X(2).                        01980003
019900         10  FILLER              PIC X.                           01990003
020000         10  PV-POS-DATE-MONTH-DAY.                               02000003
020100             15  PV-POS-DATE-MONTH                                02010003
020200                                 PIC X(2).                        02020003
020300             15  FILLER          PIC X.                           02030003
020400             15  PV-POS-DATE-DAY PIC X(2).                        02040003
020500     05  PV-DB2-CCYY-MM-DD       PIC X(10)    VALUE SPACES.       02050003
020600     05  FILLER                  REDEFINES PV-DB2-CCYY-MM-DD.     02060003
020700         10  PV-DB2-CCYY         PIC X(4).                        02070003
020800         10  FILLER              PIC X.                           02080003
020900         10  PV-DB2-MM           PIC X(2).                        02090003
021000         10  FILLER              PIC X.                           02100003
021100         10  PV-DB2-DD           PIC X(2).                        02110003
021200     05  PV-GREG-DATE.                                            02120003
021300         10  PV-GREG-MONTH            PIC  9(02)     VALUE ZERO.  02130003
021400         10  PV-GREG-DAY              PIC  9(02)     VALUE ZERO.  02140003
021500         10  PV-GREG-YEAR             PIC  9(02)     VALUE ZERO.  02150003
021600     05  PV-CURR-DATE-CCYYMMDD.                                   02160003
021700         10  PV-CURR-DATE-CCYY        PIC  9(04).                 02170003
021800         10  PV-CURR-DATE-MM          PIC  9(02).                 02180003
021900         10  PV-CURR-DATE-DD          PIC  9(02).                 02190003
022000     05  PV-CURR-TIME.                                            02200003
022100         10  PV-CURR-TIME-HH          PIC  9(02).                 02210003
022200         10  PV-CURR-TIME-MM          PIC  9(02).                 02220003
022300         10  PV-CURR-TIME-SSHH        PIC  9(04).                 02230003
022400     05  PV-TIME-HHMM                 PIC  9(04)     VALUE ZERO.  02240003
022500     05  FILLER REDEFINES PV-TIME-HHMM.                           02250003
022600         10  PV-TIME-HH               PIC  99.                    02260003
022700         10  PV-TIME-MM               PIC  99.                    02270003
022800                                                                  02280003
022900     05  PV-DEPT-NBR                  PIC X(3)       VALUE SPACES.02290003
023000     05  PV-SUB-CL-NBR                PIC X(3)       VALUE '0  '. 02300003
023100     05  FILLER REDEFINES PV-SUB-CL-NBR.                          02310003
023200         10  FILLER                   PIC X.                      02320003
023300         10  PV-SUB-CL-NBR-2          PIC XX.                     02330003
023400     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.02340003
023500     05  PV-DB2-OPERATION             PIC  X(30)     VALUE SPACES.02350003
023600     05  PV-OPERATION-MSG-1           PIC  X(40)     VALUE SPACES.02360003
023700     05  PV-OPERATION-MSG-2           PIC  X(40)     VALUE SPACES.02370003
023800     05  PV-DEPT-CLASS-ERROR-IND      PIC 9          VALUE ZERO.  02380003
023900         88  NO-DEPT-CLASS-ERROR                     VALUE 0, 1,  02390003
024000                                                           2, 3.  02400003
024100                                                                  02410003
024200     05  PV-UPC-SKU-ERROR-IND         PIC 9          VALUE ZERO.  02420003
024300         88  NON-MDSE-UPC-SKU                        VALUE 2.     02430003
024400                                                                  02440003
024500     05  PV-KOHLS-ACCT-WEEK           PIC 99         VALUE ZERO.  02450003
024600     05  PV-DAY-OF-WEEK               PIC 9          VALUE ZERO.  02460003
024700     05  PV-SKU-NUMBER                PIC 9(8)       VALUE ZERO.  02470003
024800     05  PV-DEPT-CLASS                PIC 9(5).                   02480003
024900         88  MISC-DEPT-CLASS                     VALUE 09910.     02490003
025000         88  COUPON-DEPT-CLASS                   VALUE 09920.     02500003
025100         88  KEYED-TAX-DEPT-CLASS                VALUE 09970.     02510003
025200         88  SCN-PNLTY-DEPT-CLASS                VALUE 80011.     02520003
025300         88  BOTH-GIFT-DEPT-CLASS     VALUE 98100 THRU 98199,     02530017
025400                                            98300 THRU 98399.     02540017
025500         88  BOTH-TPC-DEPT-CLASS      VALUE 83300 THRU 83399,     02550019
025600                                            83400 THRU 83499.     02560019
12386A         88  CHARDNT-DEPT-CLASS                  VALUE 81710.     02571055
025800     05  FILLER REDEFINES PV-DEPT-CLASS.                          02580003
025900         10  PV-DEPARTMENT            PIC X(3).                   02590003
MKTPLC             88  MKTPLACE-DEPT-985               VALUE '985'.     02591063
SEPHOR             88  SEPHORA-DEPT-712                VALUE '712'.     02592073
026000         10  PV-CLASS                 PIC X(2).                   02600003
026100                                                                  02610003
026200                                                                  02620003
026300 01  PV-INVENTORY-LAYOUT.                                         02630006
026400     05  PV-ML-RECORD            PIC  X(65)         VALUE SPACES. 02640006
026500     05  PV-SALES-RET-CODE       PIC  X(01)         VALUE SPACES. 02650006
026600     05  PV-OWNED-UNIT-RTL-AMT   PIC  S9(05)V9(2)   COMP-3        02660006
026700                                                    VALUE ZEROS.  02670006
026800 01  PV-RUN-DATE-CCYY-MM-DD      PIC X(10).                       02680003
026900                                                                  02690003
027000 01  PV-CUT-OFF-CCYY-MM-DD       PIC X(10).                       02700003
027100                                                                  02710003
027200 01  PS-PROGRAM-SWITCHES.                                         02720003
027300     05  PS-END-OF-CARD-FILE-SW       PIC X(1)       VALUE 'N'.   02730003
027400         88  PS-END-OF-CARD-FILE                     VALUE 'Y'.   02740003
027500     05  PS-END-OF-TEPTRN-CSR-SW      PIC X(1)       VALUE 'N'.   02750003
027600         88  PS-END-OF-TEPTRN-CSR                    VALUE 'Y'.   02760003
027700         88  PS-NOT-END-OF-TEPTRN-CSR                VALUE 'N'.   02770003
027800     05  PS-END-OF-TEPITM-CSR-SW      PIC X(1)       VALUE 'N'.   02780003
027900         88  PS-END-OF-TEPITM-CSR                    VALUE 'Y'.   02790003
028000         88  PS-NOT-END-OF-TEPITM-CSR                VALUE 'N'.   02800003
028100     05  PS-END-OF-TEPDKEY-CSR-SW     PIC X(1)       VALUE 'N'.   02810003
028200         88  PS-END-OF-TEPDKEY-CSR                   VALUE 'Y'.   02820003
028300         88  PS-NOT-END-OF-TEPDKEY-CSR               VALUE 'N'.   02830003
028400     05  PS-DATA-PRESENT-SW           PIC X(1)       VALUE 'N'.   02840003
028500         88  PS-DATA-PRESENT                         VALUE 'Y'.   02850003
028600         88  PS-DATA-NOT-PRESENT                     VALUE 'N'.   02860003
028700     05  PS-PROCESS-SW                PIC X(1)       VALUE 'T'.   02870003
028800         88  PS-PROCESS-TEPTRN                       VALUE 'T'.   02880003
028900         88  PS-PROCESS-TEPDKEY                      VALUE 'D'.   02890003
029000                                                                  02900003
029100                                                                  02910003
029200 01  PA-PROGRAM-ACCUMULATORS.                                     02920003
029300     05  PA-INPUT-RECORD-CNT  COMP-3  PIC S9(7)      VALUE ZEROES.02930003
029400     05  PA-VALID-SALE-PROCD  COMP-3  PIC S9(7)      VALUE ZEROES.02940003
029500     05  PA-ALL-TRANSACTIONS  COMP-3  PIC S9(7)      VALUE ZEROES.02950003
029600     05  PA-COUPONS-BYPASSED  COMP-3  PIC S9(7)      VALUE ZEROES.02960003
MKTPLC     05  PA-COUPONS-BYPASSED-D        PIC  9(7)-     VALUE ZEROES.02961068
029700     05  PA-EMP-DISC-WRITTEN  COMP-3  PIC S9(7)      VALUE ZEROES.02970003
029800     05  PA-MERCHAND-WRITTEN  COMP-3  PIC S9(7)      VALUE ZEROES.02980003
029900     05  PA-TAX-RCDS-WRITTEN  COMP-3  PIC S9(7)      VALUE ZEROES.02990003
030000     05  PA-TOT-SALE-RCDS-WRITTEN                                 03000003
030100                              COMP-3  PIC S9(7)      VALUE ZEROES.03010003
030200     05  PA-TOT-CORRECTIONS-WRITTEN                               03020003
030300                              COMP-3  PIC S9(7)      VALUE ZEROES.03030003
030400     05  PA-MDSE-RCDS-CNVRTD  COMP-3  PIC S9(7)      VALUE ZEROES.03040003
030500     05  PA-ACCUM-TAX-AMOUNT  COMP-3  PIC S9(9)V99   VALUE ZEROES.03050003
MKTPLC     05  PA-MKTPLACE-TX-AMT   COMP-3  PIC S9(9)V99   VALUE ZEROES.03060063
MKTPLC     05  PA-TOTAL-MKTPLACE-TX-AMT     PIC S9(9)V99   VALUE ZEROES.03061070
MKTPLC     05  PA-TOTAL-MKTPLACE-TX-AMT-D   PIC  9(9).99-  VALUE ZEROES.03062070
MKTPLC     05  PA-TOTAL-EMP-DISC-AMT        PIC S9(9)V99   VALUE ZEROES.03063070
MKTPLC     05  PA-TOTAL-EMP-DISC-AMT-D      PIC  9(9).99-  VALUE ZEROES.03064070
MKTPLC     05  PA-TOTAL-NET-CHRG-AMT        PIC S9(9)V99   VALUE ZEROES.03065070
MKTPLC     05  PA-TOTAL-NET-CHRG-AMT-D      PIC  9(9).99-  VALUE ZEROES.03066070
MKTPLC     05  PA-TOTAL-ACCUM-TAX-AMT       PIC S9(9)V99   VALUE ZEROES.03067070
MKTPLC     05  PA-TOTAL-ACCUM-TAX-AMT-D     PIC  9(9).99-  VALUE ZEROES.03068070
030700     05  PA-TOTAL-ML-AMT              PIC S9(9)V99   VALUE ZEROES.03070003
030700     05  PA-TOTAL-ML-AMT-D            PIC  9(9).99-  VALUE ZEROES.03071071
030800     05  PA-TOTAL-ML-UNITS            PIC S9(7)      VALUE ZEROES.03080003
030800     05  PA-TOTAL-ML-UNITS-D          PIC  9(7)-     VALUE ZEROES.03081071
030900     05  PA-TOTAL-09910-AMT           PIC S9(9)V99   VALUE ZEROES.03090003
031000     05  PA-TOTAL-09910-UNITS         PIC S9(7)      VALUE ZEROES.03100003
031100     05  PA-TOTAL-09970-AMT           PIC S9(9)V99   VALUE ZEROES.03110003
031200     05  PA-TOTAL-09990-AMT           PIC S9(9)V99   VALUE ZEROES.03120003
MKTPLC     05  PA-TOTAL-EXCLUDED-AMT        PIC S9(9)V99   VALUE ZEROES.03130066
MKTPLC     05  PA-TOTAL-EXCLUDED-AMT-D      PIC  9(9).99-  VALUE ZEROES.03131066
MKTPLC     05  PA-TOTAL-EXCLUDED-UNITS      PIC S9(7)      VALUE ZEROES.03132066
MKTPLC     05  PA-TOTAL-EXCLUDED-UNITS-D    PIC  9(7)-     VALUE ZEROES.03133066
MKTPLC     05  PA-DEPT098-UNITS             PIC S9(7)      VALUE ZEROES.03133170
MKTPLC     05  PA-DEPT098-UNITS-D           PIC  9(7)-     VALUE ZEROES.03133270
MKTPLC     05  PA-DEPT098-AMT               PIC S9(9)V99   VALUE ZEROES.03133370
MKTPLC     05  PA-DEPT098-AMT-D             PIC  9(9).99-  VALUE ZEROES.03133470
MKTPLC     05  PA-COUPON-DEPT-CLASS-AMT     PIC S9(9)V99   VALUE ZEROES.03134370
MKTPLC     05  PA-COUPON-DEPT-CLASS-AMT-D   PIC  9(9).99-  VALUE ZEROES.03134470
MKTPLC     05  PA-BOTH-GIFT-DEPT-CLASS-UN   PIC S9(7)      VALUE ZEROES.03134671
MKTPLC     05  PA-BOTH-GIFT-DEPT-CLASS-UN-D PIC  9(7)-     VALUE ZEROES.03134771
MKTPLC     05  PA-BOTH-GIFT-DEPT-CLASS-AMT  PIC S9(9)V99   VALUE ZEROES.03134871
MKTPLC     05  PA-BOTH-GIFT-DEPT-CLASS-AMT-D PIC 9(9).99-  VALUE ZEROES.03134971
MKTPLC     05  PA-TPC-DEPT-CLASS-UNITS      PIC S9(7)      VALUE ZEROES.03135071
MKTPLC     05  PA-TPC-DEPT-CLASS-UNITS-D    PIC  9(7)-     VALUE ZEROES.03135171
MKTPLC     05  PA-TPC-DEPT-CLASS-AMT        PIC S9(9)V99   VALUE ZEROES.03135271
MKTPLC     05  PA-TPC-DEPT-CLASS-AMT-D      PIC  9(9).99-  VALUE ZEROES.03135371
MKTPLC     05  PA-KEYED-TAX-DEPT-CLASS-UN   PIC S9(7)      VALUE ZEROES.03135471
MKTPLC     05  PA-KEYED-TAX-DEPT-CLASS-UN-D PIC  9(7)-     VALUE ZEROES.03135571
MKTPLC     05  PA-KEYED-TAX-DEPT-CLASS-AMT  PIC S9(9)V99   VALUE ZEROES.03135671
MKTPLC     05  PA-KEYED-TAX-DEPT-CLASS-AMT-D PIC 9(9).99-  VALUE ZEROES.03135771
MKTPLC     05  PA-MKTPLACE-DEPT-985-UNITS   PIC S9(7)      VALUE ZEROES.03135871
MKTPLC     05  PA-MKTPLACE-DEPT-985-UNITS-D PIC  9(7)-     VALUE ZEROES.03135971
MKTPLC     05  PA-MKTPLACE-DEPT-985-AMT     PIC S9(9)V99   VALUE ZEROES.03136071
MKTPLC     05  PA-MKTPLACE-DEPT-985-AMT-D   PIC  9(9).99-  VALUE ZEROES.03136171
SEPHOR     05  PA-SEPHORA-DEPT-712-UNITS    PIC S9(7)      VALUE ZEROES.03136273
SEPHOR     05  PA-SEPHORA-DEPT-712-UNITS-D  PIC  9(7)-     VALUE ZEROES.03136373
SEPHOR     05  PA-SEPHORA-DEPT-712-AMT      PIC S9(9)V99   VALUE ZEROES.03136473
SEPHOR     05  PA-SEPHORA-DEPT-712-AMT-D    PIC  9(9).99-  VALUE ZEROES.03136573
MKTPLC     05  PA-TOTAL-SALES-UNITS         PIC S9(7)      VALUE ZEROES.03136673
MKTPLC     05  PA-TOTAL-SALES-UNITS-D       PIC  9(7)-     VALUE ZEROES.03136773
MKTPLC     05  PA-TOTAL-SALES-AMT           PIC S9(9)V99   VALUE ZEROES.03137070
MKTPLC     05  PA-TOTAL-SALES-AMT-D         PIC  9(9).99-  VALUE ZEROES.03140070
                                                                        03141070
031500 01  PV-ABEND-CODE   COMP  SYNC       PIC S9(04)     VALUE +0000. 03150003
031600     88  PV-ABEND-4009-CARD-ERROR                    VALUE +4009. 03160003
031700     88  PV-ABEND-4013-DB2-ERROR                     VALUE +4013. 03170014
031800     88  PV-ABEND-4019-CALENDAR-ERROR                VALUE +4019. 03180015
031900******************************************************************03190003
032000* BREAK KEY                                                       03200003
032100******************************************************************03210003
032200 01  BREAK-KEY.                                                   03220003
032300     05  BK-STORE-NO                  PIC 9(4).                   03230003
032400     05  BK-REGISTER-ID               PIC 9(4).                   03240003
032500     05  BK-TRANS-NO                  PIC 9(5).                   03250052
032600******************************************************************03260003
032700* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    03270003
032800******************************************************************03280003
032900 01  CC-CONTROL-CARD.                                             03290003
033000     05  CC-CONTROL-CARD-DISPLAY.                                 03300003
033100         10  CC-CONTROL-NAME     PIC X(14)   VALUE SPACE.         03310003
033200             88  CC-VALID-CONTROL-NAME       VALUE                03320003
033300                                 'P.O.S. DATE = '.                03330003
033400         10  CC-POS-DATE-MMDDYY  PIC 9(6)    VALUE ZERO.          03340003
033500         10  FILLER REDEFINES CC-POS-DATE-MMDDYY.                 03350003
033600             15  CC-POS-DATE-MM  PIC 99.                          03360003
033700             15  CC-POS-DATE-DD  PIC 99.                          03370003
033800             15  CC-POS-DATE-YY  PIC 99.                          03380003
033900     05 FILLER                   PIC X(60)   VALUE SPACE.         03390003
034000                                                                  03400048
034100*----------------------------------------------------------------*03410003
034200* HEADING LINES FOR 132 COLUMN REPORT                            *03420003
034300*----------------------------------------------------------------*03430003
034400     COPY DPWS132.                                                03440003
034500                                                                  03450003
034600 01  HEADING-LINE-2.                                              03460003
034700     05  FILLER             PIC X(50) VALUE SPACES.               03470003
034800     05  FILLER             PIC X(40) VALUE                       03480003
034900           'TOTALS FOR MERCHANDISE LEDGER INTERFACE'.             03490003
035000     05  FILLER             PIC X(42) VALUE SPACES.               03500003
035100                                                                  03510003
035200 01  HEADING-LINE-3.                                              03520003
035300     05  FILLER             PIC XX    VALUE SPACES.               03530003
035400     05  FILLER             PIC X(20) VALUE                       03540003
035500           'TOTAL DESCRIPTION'.                                   03550003
035600     05  FILLER             PIC X(11) VALUE SPACES.               03560003
035700     05  FILLER             PIC X(5)  VALUE 'UNITS'.              03570003
035800     05  FILLER             PIC X(11) VALUE SPACES.               03580003
035900     05  FILLER             PIC X(6)  VALUE 'AMOUNT'.             03590003
036000     05  FILLER             PIC X(77) VALUE SPACES.               03600003
036100                                                                  03610003
036200 01  DETAIL-LINE.                                                 03620003
036300     05  FILLER             PIC XX    VALUE SPACES.               03630003
036400     05  DL-DESCRIPTION     PIC X(20).                            03640003
036500     05  FILLER             PIC XXX   VALUE SPACES.               03650003
036600     05  DL-UNITS           PIC ---,---,---.                      03660003
036700     05  FILLER             PIC X(6)  VALUE SPACES.               03670003
036800     05  DL-AMOUNT          PIC ---,---,---.99.                   03680003
036900     05  FILLER             PIC X(76) VALUE SPACES.               03690003
037000*----------------------------------------------------------------*03700003
037100* PSWS010 OUTPUT SALES EXTRACT RECORD                            *03710046
037200*----------------------------------------------------------------*03720003
037300                                                                  03730003
037400     COPY PSWS010.                                                03740046
037500                                                                  03750048
037600*----------------------------------------------------------------*03760003
037700* DPWS004 VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004*03770003
037800*----------------------------------------------------------------*03780003
037900                                                                  03790003
038000     COPY DPWS004.                                                03800003
038100                                                                  03810003
038200*----------------------------------------------------------------*03820003
038300* PARAMETER LIST FOR THE CALENDAR ROUTINE                        *03830003
038400*----------------------------------------------------------------*03840003
038500                                                                  03850003
038600     COPY DPWS500.                                                03860003
038700*----------------------------------------------------------------*03870003
038800* DB2 TABLE DB2PDBA.TEPPART - PARTITION CONTROL TABLE            *03880003
038900*----------------------------------------------------------------*03890003
039000                                                                  03900003
039100     EXEC SQL                                                     03910003
039200         INCLUDE TEPPART                                          03920003
039300     END-EXEC.                                                    03930003
039400                                                                  03940003
039500*----------------------------------------------------------------*03950003
039600* DB2 TABLE DB2PDBA.TEPDKEY - CURRENT PROCESSING DAY KEY TABLE   *03960003
039700*----------------------------------------------------------------*03970003
039800                                                                  03980003
039900     EXEC SQL                                                     03990003
040000         INCLUDE TEPDKEY                                          04000003
040100     END-EXEC.                                                    04010003
040200                                                                  04020003
040300*----------------------------------------------------------------*04030003
040400* DB2 TABLE DB2PDBA.TEPTRN - TRANSACTION TABLE                   *04040003
040500*----------------------------------------------------------------*04050003
040600                                                                  04060003
040700     EXEC SQL                                                     04070003
040800         INCLUDE TEPTRN                                           04080003
040900     END-EXEC.                                                    04090003
041000                                                                  04100003
041100*----------------------------------------------------------------*04110003
041200* DB2 TABLE DB2PDBA.TEPITM - ITEM TABLE                          *04120003
041300*----------------------------------------------------------------*04130003
041400                                                                  04140003
041500     EXEC SQL                                                     04150003
041600         INCLUDE TEPITM                                           04160003
041700     END-EXEC.                                                    04170003
041800                                                                  04180003
041900*----------------------------------------------------------------*04190003
042000* DB2 TABLE DB2PDBA.TMDSEAR - MERCHANDISE AREA TABLE             *04200003
042100*----------------------------------------------------------------*04210003
042200                                                                  04220003
042300     EXEC SQL                                                     04230003
042400         INCLUDE TMDSEAR                                          04240003
042500     END-EXEC.                                                    04250003
042600                                                                  04260003
042700*----------------------------------------------------------------*04270003
042800* DB2 TABLE DB2PDBA.TEPEID - EMPLOYEE ITEM DISCOUNT TABLE        *04280003
042900*----------------------------------------------------------------*04290003
043000                                                                  04300003
043100     EXEC SQL                                                     04310003
043200         INCLUDE TEPEID                                           04320003
043300     END-EXEC.                                                    04330003
043400                                                                  04340003
043500*----------------------------------------------------------------*04350044
043600*  ITEM PLANNED SHIPMENT TABLE                                    04360044
043700*----------------------------------------------------------------*04370044
043800     EXEC SQL                                                     04380044
043900         INCLUDE TEPIPS                                           04390044
044000     END-EXEC.                                                    04400044
044100                                                                  04410044
044200*----------------------------------------------------------------*04420044
044300*   SHIPPING INFORMATION TABLE                                    04430044
044400*----------------------------------------------------------------*04440044
044500     EXEC SQL                                                     04450044
044600         INCLUDE TEPSHP                                           04460044
044700     END-EXEC.                                                    04470044
044800                                                                  04480044
044900*----------------------------------------------------------------*04490003
045000* STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                *04500003
045100*----------------------------------------------------------------*04510003
045200                                                                  04520003
045300     EXEC SQL                                                     04530003
045400         INCLUDE SQLCA                                            04540003
045500     END-EXEC.                                                    04550003
045600                                                                  04560003
045700     COPY SQLCA2.                                                 04570003
045800                                                                  04580003
045900*----------------------------------------------------------------*04590003
046000* MAIN CURSOR THAT DRIVES THE CREATION OF THE DAILY SALES FILE   *04600003
046100*----------------------------------------------------------------*04610003
046200     EXEC SQL                                                     04620003
046300         DECLARE TEPTRN-CURSOR CURSOR FOR                         04630003
046400             SELECT  PARTN_NBR                                    04640003
046500                    ,STR_NBR                                      04650003
046600                    ,RGST_ID                                      04660003
046700                    ,TRN_NBR                                      04670003
046800                    ,STRT_TM                                      04680003
046900                    ,SLS_CORR_SEQ_NBR                             04690003
047000                    ,VOID_ABRT_CDE                                04700003
047100                    ,TRN_STAT_CDE                                 04710003
047200                    ,TRN_TYP_CDE                                  04720003
047300                    ,SLS_DTE                                      04730003
047400                    ,SLS_TX_AMT                                   04740003
047500                    ,ASSOC_ID                                     04750003
047600              FROM TEPTRN                                         04760003
047700              WHERE PARTN_NBR = :EPPART-PARTN-NBR                 04770003
047800                AND VOID_ABRT_CDE = 'N'                           04780014
047900                AND TRN_STAT_CDE = 'Z'                            04790015
048000                AND TRN_TYP_CDE IN ('01','02','11','12',          04800003
048100                                    '21','22','23','24','25')     04810003
048200                ORDER BY 2                                        04820003
048300                        ,3                                        04830003
048400                        ,4                                        04840003
048500                        ,5                                        04850003
048600                        ,6                                        04860003
048700                WITH UR                                           04870003
048800     END-EXEC.                                                    04880003
048900*----------------------------------------------------------------*04890003
049000* ITEM CURSOR                                                    *04900003
049100*----------------------------------------------------------------*04910003
049200     EXEC SQL                                                     04920003
049300         DECLARE TEPITM-CURSOR CURSOR FOR                         04930003
049400             SELECT  LNE_ITM_SEQ_NBR                              04940003
049500                    ,DEPT_NBR                                     04950003
049600                    ,SUB_CL_NBR                                   04960003
049700                    ,SLD_QTY                                      04970003
049800                    ,NET_CHRGD_AMT                                04980003
049900                    ,UPC_NBR                                      04990003
050000                    ,SAL_TYP_CDE                                  05000003
050100                    ,SAL_RET_CDE                                  05010010
050200                    ,DEPT_CL_ERR_CDE                              05020003
050300                    ,SKU_ERR_CDE                                  05030003
050400                    ,REG_RTL_AMT                                  05040003
050500                    ,OWND_UNT_RTL_AMT                             05050010
050600                    ,REG_RTL_ORGN_CDE                             05060003
050700                    ,MAJ_CL_NBR                                   05070003
050800                    ,SKU_NBR                                      05080003
050900                    ,TX_AMT                                       05090039
051000               FROM TEPITM                                        05100003
051100               WHERE PARTN_NBR        = :EPTRN-PARTN-NBR          05110003
051200                 AND STR_NBR          = :EPTRN-STR-NBR            05120003
051300                 AND RGST_ID          = :EPTRN-RGST-ID            05130003
051400                 AND TRN_NBR          = :EPTRN-TRN-NBR            05140003
051500                 AND STRT_TM          = :EPTRN-STRT-TM            05150003
051600                 AND SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR   05160003
051700                 AND LIV_RSLU_CDE IN ('+','-')                    05170003
051800                 ORDER BY 1                                       05180003
051900               WITH UR                                            05190003
052000     END-EXEC.                                                    05200003
052100******************************************************************05210003
052200* SECONDARY CURSOR DRIVING THE CREATION OF THE DAILY SALES FILE. *05220003
052300******************************************************************05230003
052400     EXEC SQL                                                     05240003
052500         DECLARE TEPDKEY-CURSOR CURSOR FOR                        05250003
052600             SELECT  B.PARTN_NBR                                  05260003
052700                    ,B.STR_NBR                                    05270003
052800                    ,B.RGST_ID                                    05280003
052900                    ,B.TRN_NBR                                    05290003
053000                    ,B.STRT_TM                                    05300003
053100                    ,B.SLS_CORR_SEQ_NBR                           05310003
053200                    ,B.VOID_ABRT_CDE                              05320003
053300                    ,B.TRN_STAT_CDE                               05330003
053400                    ,B.TRN_TYP_CDE                                05340003
053500                    ,B.SLS_DTE                                    05350003
053600                    ,B.SLS_TX_AMT                                 05360003
053700                    ,B.ASSOC_ID                                   05370003
053800               FROM TEPDKEY A                                     05380003
053900                   ,TEPTRN  B                                     05390003
054000                   ,TEPPART C                                     05400003
054100               WHERE A.PRCG_DTE         = :EPDKEY-PRCG-DTE        05410003
054200                 AND A.SLS_DTE          = C.SLS_DTE               05420003
054300                 AND B.PARTN_NBR        = C.PARTN_NBR             05430003
054400                 AND A.STR_NBR          = B.STR_NBR               05440003
054500                 AND A.RGST_ID          = B.RGST_ID               05450003
054600                 AND A.TRN_NBR          = B.TRN_NBR               05460003
054700                 AND A.STRT_TM          = B.STRT_TM               05470003
054800                 AND A.SLS_CORR_SEQ_NBR = B.SLS_CORR_SEQ_NBR      05480003
054900                 AND B.VOID_ABRT_CDE = 'N'                        05490003
055000                 AND B.TRN_STAT_CDE IN ('V','R','L')              05500016
055100                 AND B.TRN_TYP_CDE IN ('01','02','11','12',       05510003
055200                                    '21','22','23','24','25')     05520003
055300                 ORDER BY 1                                       05530003
055400                         ,2                                       05540003
055500                         ,3                                       05550003
055600                         ,4                                       05560003
055700                         ,5                                       05570003
055800                         ,6                                       05580003
055900               WITH UR                                            05590003
056000     END-EXEC.                                                    05600003
056100*----------------------------------------------------------------*05610003
056200                                                                  05620003
056300 01  EW-END-WORKING-STORAGE           PIC X(32)      VALUE        05630003
056400     ' END OF WORKING STORAGE SECTION '.                          05640003
056500                                                                  05650003
056600*----------------------------------------------------------------*05660003
056700                                                                  05670048
056800 PROCEDURE DIVISION.                                              05680003
056900                                                                  05690003
057000*----------------------------------------------------------------*05700003
057100*    MAINLINE-LOGIC                                              *05710003
057200*    THE PARAGRAPH IS NOT PERFORMED ANYWHERE ELSE. THIS IS       *05720003
057300*    ENTRY POINT INTO PROGRAM,  AND THIS PARAGRAPH DIRECTS       *05730003
057400*    ALL ACTIVITY FROM CONTROL CARD VALIDATION, OPENING FILES,   *05740003
057500*    OPENING THE CURSOR AND FETCHING THE FIRST RECORD, CLOSING   *05750003
057600*    FILES AND THEN FINALLY RETURNING CONTROL TO THE SYSTEM VIA  *05760003
057700*    THE GOBACK.                                                 *05770003
057800*----------------------------------------------------------------*05780003
057900                                                                  05790003
058000 0000-MAINLINE-LOGIC.                                             05800003
058100                                                                  05810003
058200     OPEN INPUT POS-DATE-FILE                                     05820003
058300          OUTPUT SALES-EXTRACT-FILE                               05830003
058400                 SALES-EXTRACT-INVNTRY-FILE                       05840006
058500                 CORRECTIONS-FILE                                 05850003
058600                 CORRECTIONS-INVNTRY-FILE                         05860006
058700                 ML-REPORT.                                       05870003
058800                                                                  05880003
058900     PERFORM 9000-FIRST-TIME-CHECK.                               05890003
059000                                                                  05900003
059100     PERFORM 1000-PROCESS-STORE-LEVEL                             05910003
059200         UNTIL PS-END-OF-TEPTRN-CSR.                              05920003
059300                                                                  05930003
059400     PERFORM 9430-CLOSE-TEPTRN-CURSOR.                            05940003
059500                                                                  05950003
059600     PERFORM 2100-PROCESS-TEPDKEY-CSR.                            05960003
059700                                                                  05970003
059800     PERFORM 9200-END-PROCESSING.                                 05980003
059900                                                                  05990003
060000     CLOSE SALES-EXTRACT-FILE                                     06000003
060100           SALES-EXTRACT-INVNTRY-FILE                             06010006
060200           CORRECTIONS-FILE                                       06020003
060300           CORRECTIONS-INVNTRY-FILE                               06030006
060400           ML-REPORT.                                             06040003
060500                                                                  06050003
060600     GOBACK.                                                      06060003
060700                                                                  06070003
060800                                                                  06080048
060900*----------------------------------------------------------------*06090003
061000*    PROCESS-STORE-SALES                                         *06100003
061100*      THIS IS PERFORMED ONLY VIA THE 0000-MAINLINE-LOGIC        *06110003
061200*      PURPOSE: HANDLE PROCESSING SALES FILE AT STORE AND        *06120003
061300*         FILE LEVELS.                                           *06130003
061400*----------------------------------------------------------------*06140003
061500                                                                  06150003
061600 1000-PROCESS-STORE-LEVEL.                                        06160003
061700                                                                  06170003
061800     INITIALIZE                      PA-ACCUM-TAX-AMOUNT          06180039
MKTPLC                                     PA-MKTPLACE-TX-AMT.          06190063
062000                                                                  06200003
062100     MOVE EPTRN-STR-NBR               TO BK-STORE-NO.             06210003
062200     MOVE EPTRN-RGST-ID               TO PV-SAVE-FIRST-TERML.     06220003
062300                                                                  06230003
062400     PERFORM 1500-PROCESS-TERM-TRANS-LEVEL                        06240003
062500         UNTIL                                                    06250003
062600             ((EPTRN-STR-NBR NOT EQUAL BK-STORE-NO)               06260003
062700                                       OR                         06270003
062800              (PS-END-OF-TEPTRN-CSR)).                            06280003
062900                                                                  06290003
063000     COMPUTE PA-ACCUM-TAX-AMOUNT = PA-ACCUM-TAX-AMOUNT  -         06300039
MKTPLC                                   PA-MKTPLACE-TX-AMT.            06310063
063200                                                                  06320039
MKTPLC     COMPUTE PA-TOTAL-MKTPLACE-TX-AMT =                           06321072
MKTPLC        PA-TOTAL-MKTPLACE-TX-AMT + PA-MKTPLACE-TX-AMT.            06322072
MKTPLC     MOVE PA-TOTAL-MKTPLACE-TX-AMT TO PA-TOTAL-MKTPLACE-TX-AMT-D. 06323072
MKTPLC                                                                  06324072
063300     IF PA-ACCUM-TAX-AMOUNT NOT EQUAL TO ZEROS                    06330003
063400         PERFORM 4400-BUILD-TAX-RECORD                            06340003
063500     END-IF.                                                      06350003
063600                                                                  06360047
063700*----------------------------------------------------------------*06370003
063800*    PROCESS-TERM-TRANS-LEVEL                                    *06380003
063900*      THIS IS PERFORMED ONLY VIA THE 1000-PROCESS-SALES-FILE    *06390003
064000*      PURPOSE: DIRECT THE PROCESSING AT A TRANSACTION/TERMINAL  *06400003
064100*          LEVEL.                                                *06410003
064200*----------------------------------------------------------------*06420003
064300                                                                  06430003
064400 1500-PROCESS-TERM-TRANS-LEVEL.                                   06440003
064500                                                                  06450003
064600     MOVE EPTRN-TRN-NBR       TO BK-TRANS-NO.                     06460003
064700     MOVE EPTRN-RGST-ID       TO BK-REGISTER-ID.                  06470003
064800                                                                  06480003
064900                                                                  06490047
065000     ADD 1                            TO PA-ALL-TRANSACTIONS.     06500003
065100                                                                  06510003
065200     ADD 1                    TO PA-VALID-SALE-PROCD.             06520003
065300     ADD  EPTRN-SLS-TX-AMT    TO PA-ACCUM-TAX-AMOUNT.             06530003
065400                                                                  06540003
065500     PERFORM 2000-PROCESS-RECORD-LEVEL                            06550003
065600         UNTIL ((EPTRN-TRN-NBR NOT EQUAL TO                       06560003
065700                 BK-TRANS-NO) OR                                  06570003
065800                (EPTRN-RGST-ID NOT EQUAL TO                       06580003
065900                 BK-REGISTER-ID) OR                               06590003
066000                (EPTRN-STR-NBR NOT EQUAL TO                       06600003
066100                 BK-STORE-NO) OR                                  06610003
066200                (PS-END-OF-TEPTRN-CSR)).                          06620003
066300                                                                  06630048
066400*----------------------------------------------------------------*06640003
066500*    PROCESS-RECORD-LEVEL                                        *06650003
066600*      PURPOSE: EXAMINE THE SALES RECORD TYPE AND DETERMINE      *06660003
066700*          CORRECT PROCESSING PATH.                              *06670003
066800*----------------------------------------------------------------*06680003
066900 2000-PROCESS-RECORD-LEVEL.                                       06690003
067000*----------------------------------------------------------------*06700003
067100                                                                  06710003
067200         SET PS-NOT-END-OF-TEPITM-CSR TO TRUE.                    06720003
067300                                                                  06730003
067400         PERFORM 7100-OPEN-TEPITM-CURSOR.                         06740003
067500                                                                  06750003
067600         PERFORM 7110-FETCH-TEPITM-CURSOR.                        06760003
067700                                                                  06770003
067800         PERFORM 3200-PROCESS-LINE-ITEMS                          06780003
067900             UNTIL PS-END-OF-TEPITM-CSR.                          06790003
068000                                                                  06800003
068100                                                                  06810048
068200         PERFORM 7120-CLOSE-TEPITM-CURSOR.                        06820003
068300                                                                  06830003
068400*----------------------------------------------------------------*06840003
068500*    FOLLOWING PERFORMED READ MODULE READS THE NEXT RECORD       *06850003
068600*      FROM THE TEPTRN CURSOR, ADDS 1 TO INPUT COUNT,            *06860003
068700*      UNPACKS THE SORT KEY AND MOVES THE CURRENT STORE,         *06870003
068800*      TERMINAL AND TRANSACTION TO CURRENT-KEY FIELDS, AND       *06880003
068900*      SETS E-O-F SWITCH AT END OF FILE CONDITION.               *06890003
069000*----------------------------------------------------------------*06900003
069100                                                                  06910003
069200     IF PS-PROCESS-TEPTRN                                         06920003
069300         PERFORM 9420-FETCH-TEPTRN-CURSOR                         06930003
069400     ELSE                                                         06940003
069500         PERFORM 7040-FETCH-TEPDKEY-CURSOR.                       06950003
069600                                                                  06960048
069700*----------------------------------------------------------------*06970003
069800*    PROCESS-TEPDKEY-CSR                                         *06980003
069900*      DO FIRST FETCH OF TEPDKEY-CURSOR                          *06990003
070000*      PROCESS ALL TEPDKEY                                       *07000003
070100*----------------------------------------------------------------*07010003
070200 2100-PROCESS-TEPDKEY-CSR.                                        07020003
070300                                                                  07030003
070400                                                                  07040048
070500     SET PS-NOT-END-OF-TEPDKEY-CSR TO TRUE.                       07050003
070600     SET PS-PROCESS-TEPDKEY        TO TRUE.                       07060003
070700                                                                  07070003
070800     PERFORM 7030-OPEN-TEPDKEY-CURSOR.                            07080003
070900     PERFORM 7040-FETCH-TEPDKEY-CURSOR                            07090003
071000                                                                  07100003
071100     IF PS-END-OF-TEPDKEY-CSR                                     07110003
071200         DISPLAY '*** NO TRANSACTION DATA PRESENT ON TEPDKEY ***' 07120003
071300     END-IF.                                                      07130003
071400                                                                  07140003
071500     PERFORM                                                      07150003
071600         UNTIL PS-END-OF-TEPDKEY-CSR                              07160003
071700             IF EPTRN-PARTN-NBR = EPPART-PARTN-NBR                07170003
071800                 PERFORM 7040-FETCH-TEPDKEY-CURSOR                07180003
071900             ELSE                                                 07190003
072000                 PERFORM 2200-PROCESS-TEPDKEY                     07200003
072100             END-IF                                               07210003
072200     END-PERFORM.                                                 07220003
072300                                                                  07230003
072400     PERFORM 7050-CLOSE-TEPDKEY-CURSOR.                           07240003
072500                                                                  07250003
072600*----------------------------------------------------------------*07260003
072700*    PROCESS-TEPDKEY                                             *07270003
072800*      THIS IS PERFORMED ONLY VIA THE 0000-MAINLINE-LOGIC        *07280003
072900*      PURPOSE: HANDLE PROCESSING SALES FILE AT STORE AND        *07290003
073000*         FILE LEVELS.                                           *07300003
073100*----------------------------------------------------------------*07310003
073200                                                                  07320003
073300 2200-PROCESS-TEPDKEY.                                            07330003
073400                                                                  07340003
073500     INITIALIZE                      PA-ACCUM-TAX-AMOUNT          07350039
MKTPLC                                     PA-MKTPLACE-TX-AMT.          07360063
073700                                                                  07370003
073800     MOVE EPTRN-STR-NBR               TO BK-STORE-NO.             07380003
073900     MOVE EPTRN-RGST-ID               TO PV-SAVE-FIRST-TERML.     07390003
074000                                                                  07400003
074100                                                                  07410048
074200     IF EPTRN-SLS-DTE = PV-SAVE-SALES-DATE                        07420003
074300         CONTINUE                                                 07430003
074400     ELSE                                                         07440003
074500         PERFORM 5050-GET-KOHLS-DATE-FIELDS.                      07450003
074600                                                                  07460003
074700     PERFORM 2500-PROCESS-TERM-TRANS-LEVEL                        07470003
074800         UNTIL                                                    07480003
074900             ((EPTRN-STR-NBR NOT EQUAL BK-STORE-NO)               07490003
075000                                       OR                         07500003
075100              (EPTRN-SLS-DTE NOT EQUAL PV-SAVE-SALES-DATE)        07510003
075200                                       OR                         07520003
075300              (PS-END-OF-TEPDKEY-CSR)).                           07530003
075400                                                                  07540003
075500     COMPUTE PA-ACCUM-TAX-AMOUNT = PA-ACCUM-TAX-AMOUNT  -         07550039
MKTPLC                                   PA-MKTPLACE-TX-AMT.            07560063
075700                                                                  07570039
MKTPLC     COMPUTE PA-TOTAL-MKTPLACE-TX-AMT =                           07571072
MKTPLC        PA-TOTAL-MKTPLACE-TX-AMT + PA-MKTPLACE-TX-AMT.            07572072
MKTPLC     MOVE PA-TOTAL-MKTPLACE-TX-AMT TO PA-TOTAL-MKTPLACE-TX-AMT-D. 07573072
075700                                                                  07575072
075800     IF PA-ACCUM-TAX-AMOUNT NOT EQUAL TO ZEROS                    07580003
075900         PERFORM 4400-BUILD-TAX-RECORD                            07590003
076000     END-IF.                                                      07600003
076100                                                                  07610048
076200*----------------------------------------------------------------*07620003
076300*    PROCESS-TERM-TRANS-LEVEL                                    *07630003
076400*      THIS IS PERFORMED ONLY VIA THE 2200-PROCESS-TEPDKEY       *07640003
076500*      PURPOSE: DIRECT THE PROCESSING AT A TRANSACTION/TERMINAL  *07650003
076600*          LEVEL.                                                *07660003
076700*----------------------------------------------------------------*07670003
076800                                                                  07680003
076900 2500-PROCESS-TERM-TRANS-LEVEL.                                   07690003
077000                                                                  07700003
077100     MOVE EPTRN-TRN-NBR       TO BK-TRANS-NO.                     07710003
077200     MOVE EPTRN-RGST-ID       TO BK-REGISTER-ID.                  07720003
077300                                                                  07730003
077400                                                                  07740048
077500     ADD 1                    TO PA-ALL-TRANSACTIONS.             07750003
077600                                                                  07760003
077700     ADD 1                    TO PA-VALID-SALE-PROCD.             07770003
077800     ADD  EPTRN-SLS-TX-AMT    TO PA-ACCUM-TAX-AMOUNT.             07780003
077900                                                                  07790003
078000     PERFORM 2000-PROCESS-RECORD-LEVEL                            07800003
078100         UNTIL ((EPTRN-TRN-NBR NOT EQUAL TO                       07810003
078200                 BK-TRANS-NO) OR                                  07820003
078300                (EPTRN-RGST-ID NOT EQUAL TO                       07830003
078400                 BK-REGISTER-ID) OR                               07840003
078500                (EPTRN-STR-NBR NOT EQUAL TO                       07850003
078600                 BK-STORE-NO) OR                                  07860003
078700                (PS-END-OF-TEPDKEY-CSR)).                         07870003
078800                                                                  07880048
078900*----------------------------------------------------------------*07890003
079000*    PROCESS-LINE-ITEMS                                          *07900003
079100*      THIS IS PERFORMED ONLY VIA THE 2000-PROCESS-RECORD-LEVEL  *07910003
079200*      PURPOSE: HANDLE THE LINE-ITEM CONDITIONS                  *07920003
079300*----------------------------------------------------------------*07930003
079400                                                                  07940003
079500 3200-PROCESS-LINE-ITEMS.                                         07950003
079600                                                                  07960003
079700     MOVE EPITM-DEPT-NBR        TO PV-DEPARTMENT.                 07970003
079800     MOVE EPITM-SUB-CL-NBR      TO PV-CLASS.                      07980003
079900     MOVE EPITM-SKU-NBR         TO PV-SKU-NUMBER.                 07990003
080000                                                                  08000003
080100     MOVE EPITM-DEPT-CL-ERR-CDE TO PV-DEPT-CLASS-ERROR-IND.       08010003
080200     MOVE EPITM-SKU-ERR-CDE     TO PV-UPC-SKU-ERROR-IND.          08020003
080300                                                                  08030003
MKTPLC     ADD EPITM-NET-CHRGD-AMT    TO PA-TOTAL-SALES-AMT.            08031070
MKTPLC     MOVE PA-TOTAL-SALES-AMT    TO PA-TOTAL-SALES-AMT-D.          08032070
MKTPLC     ADD 1                      TO PA-TOTAL-SALES-UNITS.          08033070
MKTPLC     MOVE PA-TOTAL-SALES-UNITS  TO PA-TOTAL-SALES-UNITS-D.        08034070
080300                                                                  08035070
080400     EVALUATE TRUE                                                08040003
080500*----------------------------------------------------------------*08050003
080600*    CHECK FOR A DEPARTMENT/CLASS IDENTIFYING A COUPON AND       *08060003
080700*    ADD 1 TO THE COUPONS-BYPASSED COUNTER AND BYPASS RECORD     *08070003
080800*----------------------------------------------------------------*08080003
080900                                                                  08090003
081000         WHEN    ((COUPON-DEPT-CLASS)                             08100003
081100             AND (NO-DEPT-CLASS-ERROR))                           08110003
081200                 ADD 1                TO PA-COUPONS-BYPASSED      08120003
MKTPLC                 MOVE PA-COUPONS-BYPASSED                         08130070
MKTPLC                                  TO PA-COUPONS-BYPASSED-D        08130170
MKTPLC                 ADD EPITM-NET-CHRGD-AMT                          08130270
MKTPLC                                  TO PA-COUPON-DEPT-CLASS-AMT     08130370
MKTPLC                 MOVE PA-COUPON-DEPT-CLASS-AMT                    08131070
MKTPLC                                  TO PA-COUPON-DEPT-CLASS-AMT-D   08131170
081300                                                                  08132068
081400*----------------------------------------------------------------*08140003
081500*    CHECK FOR A DEPARTMENT/CLASS IDENTIFYING TAX AND ADD TO     *08150003
081600*    ACCUMULATED-TAX                                             *08160003
081700*----------------------------------------------------------------*08170003
081800                                                                  08180003
081900         WHEN   ((KEYED-TAX-DEPT-CLASS)                           08190003
082000             AND (NO-DEPT-CLASS-ERROR))                           08200003
082100               ADD EPITM-NET-CHRGD-AMT                            08210003
082200                                      TO PA-ACCUM-TAX-AMOUNT      08220003
082300                                                                  08230003
082400*----------------------------------------------------------------*08240003
082500*    CATCH ALL TO ELIMINATE ALL OTHER RECORD TYPES, ETC.         *08250003
082600*----------------------------------------------------------------*08260003
082700                                                                  08270003
082800         WHEN OTHER                                               08280003
082900           CONTINUE                                               08290003
083000                                                                  08300003
083100     END-EVALUATE.                                                08310003
083200*----------------------------------------------------------------*08320003
083300*    CONVERT DEPARTMENT/CLASS ERRORS TO MISCELLANEOUS DEPT./     *08330003
083400*    CLASS TO ALLOW POSTING TO LEDGER.  ANY SKUS WITH A BEAUTY   *08340003
083500*    SALON DEPARTMENT MUST NOW BE REGISTER OPER. KEYING ERRORS,  *08350003
083600*    SINCE TRUE BEAUTY SALON SALES ARE NO LONGER PART OF INPUT.  *08360003
083700*----------------------------------------------------------------*08370003
083800                                                                  08380003
083900     EVALUATE TRUE                                                08390003
MKTPLC         WHEN PV-DEPARTMENT = '098'                               08400070
MKTPLC             ADD 1            TO PA-DEPT098-UNITS                 08401070
MKTPLC             MOVE PA-DEPT098-UNITS TO PA-DEPT098-UNITS-D          08402070
MKTPLC             ADD EPITM-NET-CHRGD-AMT                              08403070
MKTPLC                                  TO PA-DEPT098-AMT               08404070
MKTPLC             MOVE PA-DEPT098-AMT  TO PA-DEPT098-AMT-D             08405070
084000         WHEN BOTH-GIFT-DEPT-CLASS                                08406070
MKTPLC             ADD 1            TO PA-BOTH-GIFT-DEPT-CLASS-UN       08406170
MKTPLC             MOVE PA-BOTH-GIFT-DEPT-CLASS-UN                      08406270
MKTPLC                              TO PA-BOTH-GIFT-DEPT-CLASS-UN-D     08406370
MKTPLC             ADD EPITM-NET-CHRGD-AMT                              08406470
MKTPLC                                  TO PA-BOTH-GIFT-DEPT-CLASS-AMT  08406570
MKTPLC             MOVE PA-BOTH-GIFT-DEPT-CLASS-AMT                     08406670
MKTPLC                                TO PA-BOTH-GIFT-DEPT-CLASS-AMT-D  08406770
084000         WHEN BOTH-TPC-DEPT-CLASS                                 08407070
MKTPLC             ADD 1            TO PA-TPC-DEPT-CLASS-UNITS          08408070
MKTPLC             MOVE PA-TPC-DEPT-CLASS-UNITS                         08408170
MKTPLC                              TO PA-TPC-DEPT-CLASS-UNITS-D        08408270
MKTPLC             ADD EPITM-NET-CHRGD-AMT                              08409070
MKTPLC                                  TO PA-TPC-DEPT-CLASS-AMT        08409170
MKTPLC             MOVE PA-TPC-DEPT-CLASS-AMT                           08409270
MKTPLC                                  TO PA-TPC-DEPT-CLASS-AMT-D      08409370
084200         WHEN KEYED-TAX-DEPT-CLASS                                08420018
MKTPLC             ADD 1            TO PA-KEYED-TAX-DEPT-CLASS-UN       08421070
MKTPLC             MOVE PA-KEYED-TAX-DEPT-CLASS-UN                      08422070
MKTPLC                              TO PA-KEYED-TAX-DEPT-CLASS-UN-D     08423070
MKTPLC             ADD EPITM-NET-CHRGD-AMT                              08424070
MKTPLC                              TO PA-KEYED-TAX-DEPT-CLASS-AMT      08425070
MKTPLC             MOVE PA-KEYED-TAX-DEPT-CLASS-AMT                     08426070
MKTPLC                              TO PA-KEYED-TAX-DEPT-CLASS-AMT-D    08427070
MKTPLC         WHEN MKTPLACE-DEPT-985                                   08430063
MKTPLC             ADD 1            TO PA-MKTPLACE-DEPT-985-UNITS       08431070
MKTPLC             MOVE PA-MKTPLACE-DEPT-985-UNITS                      08431170
MKTPLC                              TO PA-MKTPLACE-DEPT-985-UNITS-D     08431270
MKTPLC             ADD EPITM-NET-CHRGD-AMT                              08431370
MKTPLC                                  TO PA-MKTPLACE-DEPT-985-AMT     08431470
MKTPLC             MOVE PA-MKTPLACE-DEPT-985-AMT                        08431570
MKTPLC                                  TO PA-MKTPLACE-DEPT-985-AMT-D   08431670
SEPHOR         WHEN SEPHORA-DEPT-712                                    08431773
SEPHOR             ADD 1            TO PA-SEPHORA-DEPT-712-UNITS        08431873
SEPHOR             MOVE PA-SEPHORA-DEPT-712-UNITS                       08431973
SEPHOR                              TO PA-SEPHORA-DEPT-712-UNITS-D      08432073
SEPHOR             ADD EPITM-NET-CHRGD-AMT                              08432173
SEPHOR                                  TO PA-SEPHORA-DEPT-712-AMT      08432273
SEPHOR             MOVE PA-SEPHORA-DEPT-712-AMT                         08432373
SEPHOR                                  TO PA-SEPHORA-DEPT-712-AMT-D    08432473
12386A         WHEN CHARDNT-DEPT-CLASS                                  08433073
084400             CONTINUE                                             08440018
084500         WHEN (NOT NO-DEPT-CLASS-ERROR)                           08450003
084600             ADD 1            TO PA-MDSE-RCDS-CNVRTD              08460003
084700             SET MISC-DEPT-CLASS TO TRUE                          08470003
084800             ADD 1            TO PA-MERCHAND-WRITTEN              08480003
084900         WHEN ((NON-MDSE-UPC-SKU) AND                             08490003
085000                 (NOT SCN-PNLTY-DEPT-CLASS))                      08500003
085100             ADD 1            TO PA-MDSE-RCDS-CNVRTD              08510003
085200             SET MISC-DEPT-CLASS TO TRUE                          08520003
085300             ADD 1            TO PA-MERCHAND-WRITTEN              08530003
085400         WHEN OTHER                                               08540003
085500             ADD 1            TO PA-MERCHAND-WRITTEN              08550003
085600     END-EVALUATE                                                 08560003
085700                                                                  08570003
MKTPLC     IF MKTPLACE-DEPT-985                                         08580063
MKTPLC        ADD EPITM-TX-AMT      TO PA-MKTPLACE-TX-AMT               08590063
MKTPLC        PERFORM 7320-GET-MKTPLACE-SHIPPING-TAX                    08600063
MKTPLC        ADD EPSHP-TX-AMT      TO PA-MKTPLACE-TX-AMT               08610063
086200     END-IF                                                       08620039
086300                                                                  08630039
086400     IF (BOTH-GIFT-DEPT-CLASS                                     08640003
086500      OR BOTH-TPC-DEPT-CLASS                                      08650019
MKTPLC      OR MKTPLACE-DEPT-985                                        08660063
SEPHOR      OR SEPHORA-DEPT-712                                         08660173
12386A      OR CHARDNT-DEPT-CLASS                                       08661055
086700      OR KEYED-TAX-DEPT-CLASS                                     08670003
086800      OR COUPON-DEPT-CLASS                                        08680003
086900      OR PV-DEPARTMENT = '098')                                   08690003
MKTPLC        COMPUTE PA-TOTAL-EXCLUDED-UNITS = PA-TOTAL-EXCLUDED-UNITS 08691066
MKTPLC                                 + EPITM-SLD-QTY                  08692066
MKTPLC        MOVE PA-TOTAL-EXCLUDED-UNITS TO PA-TOTAL-EXCLUDED-UNITS-D 08693066
MKTPLC        COMPUTE PA-TOTAL-EXCLUDED-AMT = PA-TOTAL-EXCLUDED-AMT     08694066
MKTPLC                                 + EPITM-NET-CHRGD-AMT            08695066
MKTPLC        MOVE PA-TOTAL-EXCLUDED-AMT TO PA-TOTAL-EXCLUDED-AMT-D     08696066
087100     ELSE                                                         08710003
087200         PERFORM 4000-BUILD-MDSE-RECORD                           08720003
087300         PERFORM 7130-BUILD-EMP-DISC-RECS                         08730003
087400     END-IF                                                       08740003
087500                                                                  08750003
087600     PERFORM 7110-FETCH-TEPITM-CURSOR.                            08760003
087700                                                                  08770048
087800*----------------------------------------------------------------*08780003
087900*    BUILD-MDSE-RECORD                                           *08790003
088000*      THIS IS PERFORMED ONLY VIA THE 3200-PROCESS-LINE-ITEMS    *08800003
088100*      PURPOSE: BUILD THE OUTPUT EXTRACT RECORD FOR ALL TYPES    *08810003
088200*               OF VALID MERCHANDISE RECORDS                     *08820003
088300*----------------------------------------------------------------*08830003
088400                                                                  08840003
088500 4000-BUILD-MDSE-RECORD.                                          08850003
088600                                                                  08860003
088700     MOVE SPACES                         TO D040-RECORD.          08870003
088800     MOVE PC-SALES-RECORD-CODE           TO D040-CODE.            08880003
088900     MOVE EPTRN-STR-NBR                  TO D040-STORENO.         08890003
089000     MOVE EPTRN-RGST-ID                  TO D040-TERMINAL.        08900003
089100     MOVE EPTRN-TRN-NBR                  TO D040-TRANSNO.         08910003
089200     MOVE EPITM-LNE-ITM-SEQ-NBR         TO D040-ITEMNO.           08920003
089300     MOVE EPTRN-ASSOC-ID                 TO D040-OPERATOR.        08930003
089400     MOVE EPTRN-SLS-DTE(6:2)             TO PV-EDIT-DATE-MM       08940003
089500     MOVE EPTRN-SLS-DTE(9:2)             TO PV-EDIT-DATE-DD       08950003
089600     MOVE EPTRN-SLS-DTE(3:2)             TO PV-EDIT-DATE-YY       08960003
089700     MOVE PV-EDIT-DATE                   TO D040-DATE.            08970003
089800     MOVE EPTRN-STRT-TM(1:2)             TO PV-TIME-HH.           08980003
089900     MOVE EPTRN-STRT-TM(4:2)             TO PV-TIME-MM.           08990003
090000     MOVE PV-TIME-HHMM                   TO D040-TIME.            09000003
090100     MOVE PV-KOHLS-ACCT-WEEK             TO D040-KOHLS-WK.        09010003
090200     MOVE PV-SKU-NUMBER                  TO D040-SKU.             09020003
090300     MOVE PV-DEPT-CLASS                  TO D040-DEPT-CLASS.      09030003
090400     MOVE EPITM-MAJ-CL-NBR              TO D040-MAJOR-CLASS.      09040003
090500                                                                  09050003
090600     IF MISC-DEPT-CLASS                                           09060003
090700         MOVE PC-MISC-CLASS-10         TO D040-MAJOR-CLASS        09070004
090800         MOVE PC-MISC-DEPT-CLASS-09910 TO D040-DEPT-CLASS         09080004
090900         MOVE PC-MISC-SKU-09910000     TO D040-SKU                09090004
091000         COMPUTE PA-TOTAL-09910-UNITS = PA-TOTAL-09910-UNITS      09100003
091100                                      + EPITM-SLD-QTY             09110003
091200         COMPUTE PA-TOTAL-09910-AMT   = PA-TOTAL-09910-AMT        09120003
091300                                      + EPITM-NET-CHRGD-AMT       09130003
091400     END-IF.                                                      09140003
091500                                                                  09150003
091600     MOVE EPITM-SAL-TYP-CDE              TO D040-SALE-TYPE-2.     09160003
091700     MOVE EPITM-SLD-QTY                  TO D040-SALE-UNITS.      09170003
091800     MOVE EPITM-NET-CHRGD-AMT            TO D040-SALE-AMT.        09180003
091900     MOVE EPTRN-TRN-TYP-CDE              TO D040-SALE-TYPE.       09190003
092000                                                                  09200003
092100     COMPUTE PA-TOTAL-ML-UNITS = PA-TOTAL-ML-UNITS                09210003
092200                               + EPITM-SLD-QTY.                   09220003
MKTPLC     MOVE PA-TOTAL-ML-UNITS TO PA-TOTAL-ML-UNITS-D.               09221069
092300     COMPUTE PA-TOTAL-ML-AMT = PA-TOTAL-ML-AMT                    09230003
092400                             + EPITM-NET-CHRGD-AMT.               09240003
MKTPLC     COMPUTE PA-TOTAL-NET-CHRG-AMT = PA-TOTAL-NET-CHRG-AMT        09250070
MKTPLC                             + EPITM-NET-CHRGD-AMT.               09251070
MKTPLC     MOVE PA-TOTAL-NET-CHRG-AMT TO PA-TOTAL-NET-CHRG-AMT-D.       09252070
092500                                                                  09253070
092600     IF EPITM-DEPT-NBR = PV-DEPT-NBR                              09260003
092700      AND EPITM-SUB-CL-NBR = PV-SUB-CL-NBR-2                      09270003
092800      AND EPTRN-SLS-DTE = PV-DB2-CCYY-MM-DD                       09280003
092900         CONTINUE                                                 09290003
093000     ELSE                                                         09300003
093100         MOVE EPITM-DEPT-NBR          TO PV-DEPT-NBR              09310003
093200         MOVE EPITM-SUB-CL-NBR        TO PV-SUB-CL-NBR-2          09320003
093300         MOVE EPTRN-SLS-DTE           TO PV-DB2-CCYY-MM-DD        09330003
093400         PERFORM 7310-SELECT-TMDSEAR-ROW                          09340003
093500     END-IF.                                                      09350003
093600                                                                  09360003
093700     IF PS-DATA-NOT-PRESENT                                       09370003
093800         MOVE 9                       TO D040-DIV                 09380003
093900         MOVE 99                      TO D040-BUYER               09390003
094000     ELSE                                                         09400003
094100         MOVE MDSEAR-GMA-NBR(2:1)     TO D040-DIV                 09410003
094200         MOVE MDSEAR-BYR-NBR(2:2)     TO D040-BUYER.              09420003
094300                                                                  09430003
094400     MOVE PV-DAY-OF-WEEK              TO D040-DAY.                09440003
094500                                                                  09450003
094600     IF EPTRN-TRN-STAT-CDE = 'V' OR 'R'                           09460003
094700         SET D040-SALES-AUDIT-CORR TO TRUE                        09470003
094800     ELSE                                                         09480003
094900         IF EPTRN-TRN-STAT-CDE = 'L'                              09490003
095000             SET D040-SYSTEM-LATE-CORR TO TRUE                    09500003
095100         END-IF                                                   09510003
095200     END-IF                                                       09520003
095300                                                                  09530003
095400     IF EPITM-REG-RTL-ORGN-CDE = 'C'                              09540003
095500         IF EPITM-SAL-TYP-CDE = 'P'                               09550003
095600             MOVE EPITM-REG-RTL-AMT      TO D040-REG-AMT          09560003
095700         ELSE                                                     09570003
095800             MOVE 0                      TO D040-REG-AMT          09580003
095900         END-IF                                                   09590003
096000     ELSE                                                         09600003
096100         MOVE EPITM-REG-RTL-AMT          TO D040-REG-AMT.         09610003
096200                                                                  09620003
096300     IF EPTRN-SLS-DTE NOT EQUAL PV-POS-DATE-YMD                   09630003
096400         MOVE EPTRN-SLS-DTE TO PV-POS-DATE-YMD                    09640003
096500         PERFORM 5000-VALIDATE-DATE                               09650003
096600     END-IF.                                                      09660003
096700                                                                  09670003
096800     IF DPG55-DB2-ISO-DATE-FMT LESS THAN PV-CUT-OFF-CCYY-MM-DD    09680003
096900         PERFORM 8300-WRITE-CORRECTIONS                           09690003
097000**** THIS PART WRITES THE RECORD TO ANOTHER FILE FOR INVENTORY    09700011
097100**** PROCESSING, BUT ADDS ON OWNED UNIT RETAIL AMOUNT AND THE     09710011
097200**** SALE-RETURN CODE                                             09720011
097300         MOVE D040-RECORD            TO  PV-ML-RECORD             09730011
097400         MOVE EPITM-SAL-RET-CDE      TO  PV-SALES-RET-CODE        09740011
097500         MOVE EPITM-OWND-UNT-RTL-AMT TO  PV-OWNED-UNIT-RTL-AMT    09750011
097600         PERFORM 8350-WRITE-CORRECTIONS-INVNTRY                   09760012
097700     ELSE                                                         09770003
097800         PERFORM 8000-WRITE-EXTRACT-RECORD                        09780003
097900**** THIS PART WRITES THE RECORD TO ANOTHER FILE FOR INVENTORY    09790011
098000**** PROCESSING, BUT ADDS ON OWNED UNIT RETAIL AMOUNT AND THE     09800006
098100**** SALE-RETURN CODE                                             09810006
098200         MOVE D040-RECORD            TO  PV-ML-RECORD             09820011
098300         MOVE EPITM-SAL-RET-CDE      TO  PV-SALES-RET-CODE        09830011
098400         MOVE EPITM-OWND-UNT-RTL-AMT TO  PV-OWNED-UNIT-RTL-AMT    09840011
098500         PERFORM 8050-WRITE-EXTRACT-INVTRY-REC                    09850011
098600     END-IF.                                                      09860003
098700                                                                  09870003
098800                                                                  09880048
098900*----------------------------------------------------------------*09890003
099000*    BUILD-TAX-RECORD                                            *09900003
099100*      THIS IS PERFORMED ONLY VIA THE 1000-PROCESS-STORE-LEVEL   *09910003
099200*      PURPOSE: DIRECT THE PROCESSING REQUIRED WHEN A CHANGE     *09920003
099300*         IN STORE IS ENCOUNTERED, I.E. CREATE ONE TAX RECORD    *09930003
099400*         PER STORE WHICH IS THE SUM OF ALL TYPE-18 TAX RECORDS  *09940003
099500*         FROM THE INPUT SALES FILE, PLUS THE SUMS FROM ALL      *09950003
099600*         MERCHANDISE (TYPE-07) RECORDS HAVING A TAX DEPT/CLASS  *09960003
099700*         OF 09970.                                              *09970003
099800*----------------------------------------------------------------*09980003
099900                                                                  09990003
100000 4400-BUILD-TAX-RECORD.                                           10000003
100100                                                                  10010003
100200     MOVE SPACES                      TO D040-RECORD.             10020003
100300     MOVE PC-SALES-RECORD-CODE        TO D040-CODE.               10030003
100400     MOVE BK-STORE-NO                 TO D040-STORENO.            10040003
100500     MOVE PV-SAVE-FIRST-TERML         TO D040-TERMINAL.           10050003
100600     MOVE ZEROS                       TO D040-TRANSNO             10060003
100700                                         D040-ITEMNO              10070003
100800                                         D040-OPERATOR.           10080003
100900     MOVE PV-EDIT-DATE                TO D040-DATE.               10090003
101000     MOVE ZEROS                       TO D040-TIME.               10100003
101100     MOVE PV-KOHLS-ACCT-WEEK          TO D040-KOHLS-WK.           10110003
101200     MOVE PC-TAX-DEPT-CLASS-09970     TO D040-DEPT-CLASS          10120003
101300     MOVE PC-TAX-SKU-09970000         TO D040-SKU.                10130003
101400     MOVE PC-TAX-CLASS-70             TO D040-MAJOR-CLASS.        10140003
101500     MOVE ZEROS                       TO D040-SALE-UNITS.         10150003
101600     MOVE PA-ACCUM-TAX-AMOUNT         TO D040-SALE-AMT.           10160003
101700     MOVE PC-CASH-SALE-TRN-TYPE-CODE  TO D040-SALE-TYPE.          10170003
101800     MOVE ZEROS                       TO D040-DIV                 10180003
101900                                         D040-BUYER.              10190003
102000     MOVE PV-DAY-OF-WEEK              TO D040-DAY.                10200003
102100     MOVE ZEROS                       TO D040-REG-AMT.            10210003
102200     COMPUTE PA-TOTAL-ML-AMT = PA-TOTAL-ML-AMT                    10220003
102300                             + PA-ACCUM-TAX-AMOUNT.               10230003
MKTPLC     COMPUTE PA-TOTAL-ACCUM-TAX-AMT = PA-TOTAL-ACCUM-TAX-AMT      10231070
MKTPLC                                    + PA-ACCUM-TAX-AMOUNT.        10232070
102400     COMPUTE PA-TOTAL-09970-AMT = PA-TOTAL-09970-AMT              10240003
102500                             + PA-ACCUM-TAX-AMOUNT.               10250003
102600                                                                  10260003
102700     ADD 1                            TO PA-TAX-RCDS-WRITTEN.     10270003
102800                                                                  10280003
102900     IF PV-SAVE-SALES-DATE NOT EQUAL PV-POS-DATE-YMD              10290003
103000         MOVE PV-SAVE-SALES-DATE TO PV-POS-DATE-YMD               10300003
103100         PERFORM 5000-VALIDATE-DATE                               10310003
103200     END-IF.                                                      10320003
103300                                                                  10330003
103400     IF DPG55-DB2-ISO-DATE-FMT LESS THAN PV-CUT-OFF-CCYY-MM-DD    10340003
103500         PERFORM 8300-WRITE-CORRECTIONS                           10350003
103600     ELSE                                                         10360003
103700         PERFORM 8000-WRITE-EXTRACT-RECORD                        10370003
103800     END-IF.                                                      10380003
103900                                                                  10390003
104000******************************************************************10400003
104100 4600-BUILD-DISC-RECORD.                                          10410003
104200*    EMPLOYEE DISCOUNT RECORD PROCESSING. THIS COMPUTES THE       10420003
104300*    PROPER AMOUNT AND BRANCHES TO THE RECORD BUILDING ROUTINE.   10430003
104400*    BUILD REMAINDER OF DISCOUNT RECORD FOR THOSE NOT FAILING     10440003
104500*    AS ERRORS.                                                   10450003
104600******************************************************************10460003
104700                                                                  10470003
104800     MOVE SPACES                         TO D040-RECORD.          10480003
104900     MOVE PC-SALES-RECORD-CODE           TO D040-CODE.            10490003
105000     MOVE EPTRN-STR-NBR                  TO D040-STORENO.         10500003
105100     MOVE EPTRN-RGST-ID                  TO D040-TERMINAL.        10510003
105200     MOVE EPTRN-TRN-NBR                  TO D040-TRANSNO.         10520003
105300     MOVE ZEROS                          TO D040-ITEMNO.          10530003
105400     MOVE EPTRN-ASSOC-ID                 TO D040-OPERATOR.        10540003
105500     MOVE EPTRN-SLS-DTE(6:2)             TO PV-EDIT-DATE-MM       10550003
105600     MOVE EPTRN-SLS-DTE(9:2)             TO PV-EDIT-DATE-DD       10560003
105700     MOVE EPTRN-SLS-DTE(3:2)             TO PV-EDIT-DATE-YY       10570003
105800     MOVE PV-EDIT-DATE                   TO D040-DATE.            10580003
105900     MOVE EPTRN-STRT-TM(1:2)             TO PV-TIME-HH.           10590003
106000     MOVE EPTRN-STRT-TM(4:2)             TO PV-TIME-MM.           10600003
106100     MOVE PV-TIME-HHMM                   TO D040-TIME.            10610003
106200     MOVE PV-KOHLS-ACCT-WEEK             TO D040-KOHLS-WK.        10620003
106300     MOVE PC-EMP-DISC-DEPT-CLASS-09990   TO D040-DEPT-CLASS       10630003
106400     MOVE PC-EMP-DISC-SKU-09990000       TO D040-SKU.             10640003
106500     MOVE PC-EMP-DISC-CLASS-90           TO D040-MAJOR-CLASS.     10650003
106600     MOVE ZEROS                          TO D040-SALE-UNITS.      10660003
106700     MOVE EPEID-EMP-DISC-AMT             TO D040-SALE-AMT.        10670003
106800     MOVE EPTRN-TRN-TYP-CDE              TO D040-SALE-TYPE.       10680003
106900                                                                  10690003
107000     IF EPITM-DEPT-NBR = PV-DEPT-NBR                              10700003
107100      AND EPITM-SUB-CL-NBR = PV-SUB-CL-NBR-2                      10710003
107200      AND EPTRN-SLS-DTE = PV-DB2-CCYY-MM-DD                       10720003
107300         CONTINUE                                                 10730003
107400     ELSE                                                         10740003
107500         MOVE EPITM-DEPT-NBR          TO PV-DEPT-NBR              10750003
107600         MOVE EPITM-SUB-CL-NBR        TO PV-SUB-CL-NBR-2          10760003
107700         MOVE EPTRN-SLS-DTE           TO PV-DB2-CCYY-MM-DD        10770003
107800         PERFORM 7310-SELECT-TMDSEAR-ROW                          10780003
107900     END-IF.                                                      10790003
108000                                                                  10800003
108100     IF PS-DATA-NOT-PRESENT                                       10810003
108200         MOVE 9                       TO D040-DIV                 10820003
108300         MOVE 99                      TO D040-BUYER               10830003
108400     ELSE                                                         10840003
108500         MOVE MDSEAR-GMA-NBR(2:1)     TO D040-DIV                 10850003
108600         MOVE MDSEAR-BYR-NBR(2:2)     TO D040-BUYER.              10860003
108700                                                                  10870003
108800     MOVE PV-DAY-OF-WEEK                 TO D040-DAY.             10880003
108900                                                                  10890003
109000     COMPUTE PA-TOTAL-09990-AMT = PA-TOTAL-09990-AMT              10900003
109100                                + EPEID-EMP-DISC-AMT.             10910003
109200     COMPUTE PA-TOTAL-ML-AMT    = PA-TOTAL-ML-AMT                 10920003
109300                                + EPEID-EMP-DISC-AMT.             10930003
MKTPLC     COMPUTE PA-TOTAL-EMP-DISC-AMT =                              10940070
MKTPLC             PA-TOTAL-EMP-DISC-AMT +  EPEID-EMP-DISC-AMT.         10941070
109400                                                                  10942070
109500     IF EPTRN-TRN-STAT-CDE = 'V' OR 'R'                           10950003
109600         SET D040-SALES-AUDIT-CORR TO TRUE                        10960003
109700     ELSE                                                         10970003
109800         IF EPTRN-TRN-STAT-CDE = 'L'                              10980003
109900             SET D040-SYSTEM-LATE-CORR TO TRUE                    10990003
110000         END-IF                                                   11000003
110100     END-IF                                                       11010003
110200                                                                  11020003
110300     MOVE ZEROS                          TO D040-REG-AMT.         11030003
110400                                                                  11040003
110500     IF EPTRN-SLS-DTE NOT EQUAL PV-POS-DATE-YMD                   11050003
110600         MOVE EPTRN-SLS-DTE TO PV-POS-DATE-YMD                    11060003
110700         PERFORM 5000-VALIDATE-DATE                               11070003
110800     END-IF.                                                      11080003
110900                                                                  11090003
111000     IF DPG55-DB2-ISO-DATE-FMT LESS THAN PV-CUT-OFF-CCYY-MM-DD    11100003
111100         PERFORM 8300-WRITE-CORRECTIONS                           11110003
111200     ELSE                                                         11120003
111300         PERFORM 8000-WRITE-EXTRACT-RECORD                        11130003
111400     END-IF.                                                      11140003
111500     ADD 1                               TO PA-EMP-DISC-WRITTEN.  11150003
111600                                                                  11160048
111700 5000-VALIDATE-DATE.                                              11170003
111800                                                                  11180003
111900     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   11190003
112000     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   11200003
112100     SET  DPG52-LK-DTE-GREG            TO TRUE.                   11210003
112200                                                                  11220003
112300     MOVE PV-POS-DATE-MONTH      TO PV-GREG-MONTH.                11230003
112400     MOVE PV-POS-DATE-DAY        TO PV-GREG-DAY.                  11240003
112500     MOVE PV-POS-DATE-YEAR       TO PV-GREG-YEAR.                 11250003
112600     MOVE PV-GREG-DATE           TO DPG52-LK-DATE-INPUT.          11260003
112700                                                                  11270003
112800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11280003
112900                                             DPG54 DPG55 DPG56.   11290003
113000                                                                  11300003
113100     EVALUATE TRUE                                                11310003
113200         WHEN DPG54-SEVERE-ERROR                                  11320003
113300         WHEN DPG54-DATE-INVALID                                  11330003
113400             MOVE '4000-BUILD-MDSE-RECORD' TO PV-PARAGRAPH-NAME   11340003
113500             MOVE 'ERROR CONVERTING POS DATE'                     11350003
113600                                           TO PV-OPERATION-MSG-1  11360003
113700             SET PV-ABEND-4019-CALENDAR-ERROR TO TRUE             11370015
113800             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  11380003
113900             DISPLAY 'INVALID DATE IS ' DPG52-LK-DATE-INPUT       11390003
114000             PERFORM 9999-ABEND                                   11400003
114100     END-EVALUATE.                                                11410003
114200                                                                  11420048
114300*----------------------------------------------------------------*11430003
114400*     5050-GET-KOHLS-DATE-FIELDS                                 *11440003
114500*         CALL KOHLS CALENDAR ROUTINE:                           *11450003
114600*             PASS:  EPTRN-SLS-DTE(CCYY-MM-DD FORMAT)            *11460003
114700*           RETURN:  FISCAL 454 CALENDAR FIELDS (YEAR,MONTH,WEEK)*11470003
114800*----------------------------------------------------------------*11480003
114900 5050-GET-KOHLS-DATE-FIELDS.                                      11490003
115000                                                                  11500003
115100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11510003
115200                                                                  11520003
115300     SET DPG51-FISCAL-454-CALENDAR    TO TRUE.                    11530003
115400     SET DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                    11540003
115500     SET DPG52-LK-DTE-ISO-FMT         TO TRUE.                    11550003
115600     MOVE EPTRN-SLS-DTE               TO DPG52-LK-DATE-INPUT.     11560003
115700     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    11570003
115800                                             DPG54 DPG55 DPG56.   11580003
115900     EVALUATE TRUE                                                11590003
116000         WHEN DPG54-SEVERE-ERROR                                  11600003
116100         WHEN DPG54-DATE-INVALID                                  11610003
116200             MOVE '5050-GET-KOHLS-FISCAL-DATE'                    11620003
116300                                      TO PV-PARAGRAPH-NAME        11630003
116400             MOVE 'ERROR ON ATTEMPT TO GET FISCAL DATE'           11640003
116500                                      TO PV-OPERATION-MSG-1       11650003
116600             SET PV-ABEND-4019-CALENDAR-ERROR TO TRUE             11660015
116700             MOVE DPG54-ERROR-MESSAGE TO PV-OPERATION-MSG-2       11670003
116800             PERFORM 9999-ABEND                                   11680003
116900     END-EVALUATE.                                                11690003
117000                                                                  11700003
117100     MOVE DPG56-FISCAL-WEEK-NBR   TO PV-KOHLS-ACCT-WEEK.          11710003
117200     MOVE DPG55-NUMERIC-WEEK-DAY  TO PV-DAY-OF-WEEK.              11720003
117300     MOVE EPTRN-SLS-DTE           TO PV-SAVE-SALES-DATE.          11730003
117400                                                                  11740003
117500*----------------------------------------------------------------*11750003
117600* 7030-OPEN-TEPDKEY-CURSOR                                       *11760003
117700*----------------------------------------------------------------*11770003
117800 7030-OPEN-TEPDKEY-CURSOR.                                        11780003
117900                                                                  11790003
118000     EXEC SQL                                                     11800003
118100         OPEN TEPDKEY-CURSOR                                      11810003
118200     END-EXEC.                                                    11820003
118300                                                                  11830003
118400     EVALUATE TRUE                                                11840003
118500         WHEN SQLCODE = ZERO                                      11850003
118600             CONTINUE                                             11860003
118700         WHEN SQLWARN0 NOT EQUAL SPACE                            11870003
118800         WHEN SQLCODE NOT EQUAL ZERO                              11880003
118900             MOVE '7030-OPEN-TEPDKEY-CURSOR'                      11890003
119000                             TO PV-PARAGRAPH-NAME                 11900003
119100             MOVE 'ERROR ON OPEN OF TEPDKEY-CURSOR'               11910003
119200                             TO PV-DB2-OPERATION                  11920003
119300             PERFORM 9900-SQL-ABEND                               11930003
119400     END-EVALUATE.                                                11940003
119500*----------------------------------------------------------------*11950003
119600* 7040-FETCH-TEPDKEY-CURSOR                                      *11960003
119700*----------------------------------------------------------------*11970003
119800 7040-FETCH-TEPDKEY-CURSOR.                                       11980003
119900                                                                  11990003
120000     EXEC SQL                                                     12000003
120100         FETCH TEPDKEY-CURSOR                                     12010003
120200          INTO  :EPTRN-PARTN-NBR                                  12020003
120300               ,:EPTRN-STR-NBR                                    12030003
120400               ,:EPTRN-RGST-ID                                    12040003
120500               ,:EPTRN-TRN-NBR                                    12050003
120600               ,:EPTRN-STRT-TM                                    12060003
120700               ,:EPTRN-SLS-CORR-SEQ-NBR                           12070003
120800               ,:EPTRN-VOID-ABRT-CDE                              12080003
120900               ,:EPTRN-TRN-STAT-CDE                               12090003
121000               ,:EPTRN-TRN-TYP-CDE                                12100003
121100               ,:EPTRN-SLS-DTE                                    12110003
121200               ,:EPTRN-SLS-TX-AMT                                 12120003
121300               ,:EPTRN-ASSOC-ID                                   12130003
121400      END-EXEC.                                                   12140003
121500                                                                  12150003
121600      EVALUATE TRUE                                               12160003
121700          WHEN SQLCODE = ZERO                                     12170003
121800              CONTINUE                                            12180052
121900          WHEN SQLCODE = PC-ROW-NOT-FOUND                         12190003
122000              SET PS-END-OF-TEPDKEY-CSR TO TRUE                   12200003
122100          WHEN SQLWARN0 NOT EQUAL SPACE                           12210003
122200          WHEN SQLCODE NOT EQUAL ZERO                             12220003
122300              MOVE '7040-FETCH-TEPDKEY-CURSOR'                    12230003
122400                                  TO PV-PARAGRAPH-NAME            12240003
122500              MOVE 'ERROR ON FETCH OF TEPDKEY-CURSOR'             12250003
122600                                  TO PV-DB2-OPERATION             12260003
122700              PERFORM 9900-SQL-ABEND                              12270003
122800      END-EVALUATE.                                               12280003
122900*----------------------------------------------------------------*12290003
123000* 7050-CLOSE-TEPDKEY-CURSOR                                      *12300003
123100*----------------------------------------------------------------*12310003
123200 7050-CLOSE-TEPDKEY-CURSOR.                                       12320003
123300                                                                  12330003
123400     EXEC SQL                                                     12340003
123500         CLOSE TEPDKEY-CURSOR                                     12350003
123600     END-EXEC.                                                    12360003
123700                                                                  12370003
123800     EVALUATE TRUE                                                12380003
123900         WHEN SQLCODE = ZERO                                      12390003
124000             CONTINUE                                             12400003
124100         WHEN SQLWARN0 NOT EQUAL SPACE                            12410003
124200         WHEN SQLCODE NOT EQUAL ZERO                              12420003
124300             MOVE '7050-CLOSE TEPDKEY-CURSOR'                     12430003
124400                                       TO PV-PARAGRAPH-NAME       12440003
124500             MOVE 'ERROR ON CLOSE OF TEPDKEY-CURSOR'              12450003
124600                                       TO PV-DB2-OPERATION        12460003
124700             PERFORM 9900-SQL-ABEND                               12470003
124800     END-EVALUATE.                                                12480003
124900*----------------------------------------------------------------*12490003
125000* 7100-OPEN-TEPITM-CURSOR                                        *12500003
125100*----------------------------------------------------------------*12510003
125200 7100-OPEN-TEPITM-CURSOR.                                         12520003
125300                                                                  12530003
125400     EXEC SQL                                                     12540003
125500         OPEN TEPITM-CURSOR                                       12550003
125600     END-EXEC.                                                    12560003
125700                                                                  12570003
125800     EVALUATE TRUE                                                12580003
125900         WHEN SQLCODE = ZERO                                      12590003
126000             CONTINUE                                             12600003
126100         WHEN SQLWARN0 NOT EQUAL SPACE                            12610003
126200         WHEN SQLCODE NOT EQUAL ZERO                              12620003
126300             MOVE '7100-OPEN-TEPITM-CURSOR' TO PV-PARAGRAPH-NAME  12630003
126400             MOVE 'ERROR ON OPEN OF TEPITM-CURSOR'                12640003
126500                                            TO PV-DB2-OPERATION   12650003
126600             PERFORM 9900-SQL-ABEND                               12660003
126700     END-EVALUATE.                                                12670003
126800                                                                  12680003
126900*----------------------------------------------------------------*12690003
127000* 7110-FETCH-TEPITM-CURSOR                                       *12700003
127100*----------------------------------------------------------------*12710003
127200 7110-FETCH-TEPITM-CURSOR.                                        12720003
127300                                                                  12730003
127400     EXEC SQL                                                     12740003
127500         FETCH TEPITM-CURSOR                                      12750003
127600          INTO  :EPITM-LNE-ITM-SEQ-NBR                            12760003
127700               ,:EPITM-DEPT-NBR                                   12770003
127800               ,:EPITM-SUB-CL-NBR                                 12780003
127900               ,:EPITM-SLD-QTY                                    12790003
128000               ,:EPITM-NET-CHRGD-AMT                              12800003
128100               ,:EPITM-UPC-NBR                                    12810003
128200               ,:EPITM-SAL-TYP-CDE                                12820003
128300               ,:EPITM-SAL-RET-CDE                                12830010
128400               ,:EPITM-DEPT-CL-ERR-CDE                            12840003
128500               ,:EPITM-SKU-ERR-CDE                                12850003
128600               ,:EPITM-REG-RTL-AMT                                12860003
128700               ,:EPITM-OWND-UNT-RTL-AMT                           12870010
128800               ,:EPITM-REG-RTL-ORGN-CDE                           12880003
128900               ,:EPITM-MAJ-CL-NBR                                 12890003
129000               ,:EPITM-SKU-NBR                                    12900003
129100               ,:EPITM-TX-AMT                                     12910039
129200     END-EXEC.                                                    12920003
129300                                                                  12930003
129400     EVALUATE TRUE                                                12940003
129500         WHEN SQLCODE = ZERO                                      12950003
129600             ADD 1 TO PA-INPUT-RECORD-CNT                         12960003
129700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          12970003
129800             SET PS-END-OF-TEPITM-CSR TO TRUE                     12980003
129900         WHEN SQLWARN0 NOT EQUAL SPACE                            12990003
130000         WHEN SQLCODE NOT EQUAL ZERO                              13000003
130100             MOVE '7110-FETCH-TEPITM-CURSOR'                      13010003
130200                                      TO PV-PARAGRAPH-NAME        13020003
130300             MOVE 'ERROR ON FETCH OF TEPITM-CURSOR'               13030003
130400                                      TO PV-DB2-OPERATION         13040003
130500             PERFORM 9900-SQL-ABEND                               13050003
130600     END-EVALUATE.                                                13060003
130700*----------------------------------------------------------------*13070003
130800* 7120-CLOSE-TEPITM-CURSOR                                       *13080003
130900*----------------------------------------------------------------*13090003
131000 7120-CLOSE-TEPITM-CURSOR.                                        13100003
131100                                                                  13110003
131200     EXEC SQL                                                     13120003
131300         CLOSE TEPITM-CURSOR                                      13130003
131400     END-EXEC.                                                    13140003
131500                                                                  13150003
131600     EVALUATE TRUE                                                13160003
131700         WHEN SQLCODE = ZERO                                      13170003
131800             CONTINUE                                             13180003
131900         WHEN SQLWARN0 NOT EQUAL SPACE                            13190003
132000         WHEN SQLCODE NOT EQUAL ZERO                              13200003
132100             MOVE '7120-CLOSE TEPITM-CURSOR'                      13210003
132200                                       TO PV-PARAGRAPH-NAME       13220003
132300             MOVE 'ERROR ON CLOSE OF TEPITM-CURSOR'               13230003
132400                                       TO PV-DB2-OPERATION        13240003
132500             PERFORM 9900-SQL-ABEND                               13250003
132600     END-EVALUATE.                                                13260003
132700                                                                  13270003
132800******************************************************************13280003
132900 7130-BUILD-EMP-DISC-RECS.                                        13290003
133000******************************************************************13300003
133100                                                                  13310003
133200     EXEC SQL                                                     13320003
133300          SELECT EMP_DISC_AMT                                     13330003
133400            INTO :EPEID-EMP-DISC-AMT                              13340003
133500            FROM TEPEID                                           13350003
133600           WHERE PARTN_NBR        = :EPTRN-PARTN-NBR              13360003
133700             AND STR_NBR          = :EPTRN-STR-NBR                13370003
133800             AND RGST_ID          = :EPTRN-RGST-ID                13380003
133900             AND TRN_NBR          = :EPTRN-TRN-NBR                13390003
134000             AND STRT_TM          = :EPTRN-STRT-TM                13400003
134100             AND SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR       13410003
134200             AND LNE_ITM_SEQ_NBR  = :EPITM-LNE-ITM-SEQ-NBR        13420003
134300             AND EMP_DISC_CTG_CDE = 'C'                           13430003
134400                 WITH UR                                          13440003
134500     END-EXEC.                                                    13450003
134600                                                                  13460003
134700     EVALUATE TRUE                                                13470003
134800        WHEN SQLCODE = ZERO                                       13480003
134900           ADD 1 TO PA-INPUT-RECORD-CNT                           13490003
135000           PERFORM 4600-BUILD-DISC-RECORD                         13500003
135100        WHEN SQLCODE = PC-ROW-NOT-FOUND                           13510003
135200           CONTINUE                                               13520003
135300        WHEN OTHER                                                13530003
135400           MOVE '7130-BUILD-EMP-DISC-RECS'                        13540003
135500                                      TO PV-PARAGRAPH-NAME        13550003
135600           MOVE 'ERROR ON SELECT TEPEID'                          13560003
135700                                      TO PV-DB2-OPERATION         13570003
135800           PERFORM 9900-SQL-ABEND                                 13580003
135900     END-EVALUATE.                                                13590003
136000                                                                  13600003
136100*----------------------------------------------------------------*13610003
136200* 7310-SELECT-TMDSEAR-ROW                                        *13620003
136300*----------------------------------------------------------------*13630003
136400 7310-SELECT-TMDSEAR-ROW.                                         13640003
136500                                                                  13650003
136600     SET PS-DATA-NOT-PRESENT TO TRUE.                             13660003
136700                                                                  13670003
136800     EXEC SQL                                                     13680003
136900         SELECT GMA_NBR                                           13690003
137000               ,BYR_NBR                                           13700003
137100         INTO  :MDSEAR-GMA-NBR                                    13710003
137200              ,:MDSEAR-BYR-NBR                                    13720003
137300         FROM  TMDSEAR                                            13730003
137400         WHERE OPERCO_NBR = :PC-OP-CO-NMBR                        13740003
137500           AND DEPT_NBR   = :PV-DEPT-NBR                          13750003
137600           AND SUB_CL_NBR = :PV-SUB-CL-NBR                        13760003
137700           AND MDSELV_CDE = :PC-MDSE-SUB-CLASS-LEVEL              13770003
137800           AND :PV-DB2-CCYY-MM-DD BETWEEN STRT_DTE AND END_DTE    13780003
137900         WITH UR                                                  13790003
138000     END-EXEC.                                                    13800003
138100                                                                  13810003
138200     EVALUATE TRUE                                                13820003
138300         WHEN SQLCODE = ZERO                                      13830003
138400             SET PS-DATA-PRESENT TO TRUE                          13840003
138500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          13850003
138600             MOVE '7310-SELECT-TMDSEAR-ROW'                       13860003
138700                     TO PV-PARAGRAPH-NAME                         13870003
138800             MOVE 'ITEM NOT FOUND ON TMDSEAR '                    13880003
138900                     TO PV-DB2-OPERATION                          13890003
139000             PERFORM 9005-DISPLAY-SQL-MSG                         13900003
139100         WHEN SQLWARN0 NOT EQUAL SPACE                            13910003
139200         WHEN SQLCODE NOT EQUAL ZERO                              13920003
139300             MOVE '7310-SELECT-TMDSEAR-ROW'                       13930003
139400                      TO PV-PARAGRAPH-NAME                        13940003
139500             MOVE 'ERROR ON SELECT FROM TMDSEAR '                 13950003
139600                      TO PV-DB2-OPERATION                         13960003
139700             PERFORM 9900-SQL-ABEND                               13970003
139800     END-EVALUATE.                                                13980003
139900*----------------------------------------------------------------*13990042
MKTPLC* 7320-GET-MKTPLACE-SHIPPING-TAX.                                *14000063
140100*----------------------------------------------------------------*14010042
MKTPLC 7320-GET-MKTPLACE-SHIPPING-TAX.                                  14020063
140300                                                                  14030042
140400     MOVE ZEROES           TO EPSHP-TX-AMT.                       14040042
140500                                                                  14050042
140600     EXEC SQL                                                     14060042
140700         SELECT TX_AMT                                            14070042
140800           INTO  :EPSHP-TX-AMT                                    14080042
140900           FROM  TEPIPS A                                         14090042
141000                ,TEPSHP B                                         14100042
141100         WHERE A.PARTN_NBR         =  B.PARTN_NBR                 14110042
141200           AND A.STR_NBR           =  B.STR_NBR                   14120042
141300           AND A.RGST_ID           =  B.RGST_ID                   14130042
141400           AND A.TRN_NBR           =  B.TRN_NBR                   14140042
141500           AND A.STRT_TM           =  B.STRT_TM                   14150042
141600           AND A.SLS_CORR_SEQ_NBR  =  B.SLS_CORR_SEQ_NBR          14160042
141700           AND A.PLND_SHIPT_NBR    =  B.PLND_SHIPT_NBR            14170042
141800           AND A.PARTN_NBR         = :EPTRN-PARTN-NBR             14180042
141900           AND A.STR_NBR           = :EPTRN-STR-NBR               14190042
142000           AND A.RGST_ID           = :EPTRN-RGST-ID               14200042
142100           AND A.TRN_NBR           = :EPTRN-TRN-NBR               14210042
142200           AND A.STRT_TM           = :EPTRN-STRT-TM               14220042
142300           AND A.SLS_CORR_SEQ_NBR  = :EPTRN-SLS-CORR-SEQ-NBR      14230042
142400           AND A.LNE_ITM_SEQ_NBR   = :EPITM-LNE-ITM-SEQ-NBR       14240042
142500         WITH UR                                                  14250042
142600     END-EXEC.                                                    14260042
142700                                                                  14270042
142800     EVALUATE TRUE                                                14280042
142900         WHEN SQLCODE = ZERO                                      14290042
143000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          14300042
143100             CONTINUE                                             14310042
143200         WHEN SQLWARN0 NOT EQUAL SPACE                            14320042
143300         WHEN SQLCODE NOT EQUAL ZERO                              14330042
MKTPLC             MOVE '7320-GET-MKTPLACE-SHIPPING-TAX'                14340063
143500                      TO PV-PARAGRAPH-NAME                        14350042
143600             MOVE 'ERROR ON SELECT FROM TEPIPS & TEPSHP'          14360042
143700                      TO PV-DB2-OPERATION                         14370042
143800             PERFORM 9900-SQL-ABEND                               14380042
143900     END-EVALUATE.                                                14390042
144000*----------------------------------------------------------------*14400041
144100*     R E A D     A N D     W R I T E     M O D U L E S          *14410003
144200*----------------------------------------------------------------*14420003
144300                                                                  14430003
144400*----------------------------------------------------------------*14440003
144500*    WRITE-EXTRACT-RECORD.                                       *14450003
144600*      THIS IS PERFORMED ONLY VIA THE 4000-BUILD-MDSE-RECORD     *14460003
144700*                          OR VIA THE 4400-BUILD-TAX-RECORD      *14470003
144800*                          OR VIA THE 4600-BUILD-DISC-RECORD     *14480003
144900*      PURPOSE: DO THE ACTUAL WRITE TO THE OUTPUT EXTRACT FILE   *14490003
145000*----------------------------------------------------------------*14500003
145100                                                                  14510003
145200 8000-WRITE-EXTRACT-RECORD.                                       14520003
145300                                                                  14530003
145400     WRITE SALES-EXTRACT-RECORD FROM D040-RECORD.                 14540003
145500     ADD 1                            TO PA-TOT-SALE-RCDS-WRITTEN.14550003
145600                                                                  14560003
145700                                                                  14570003
145800                                                                  14580048
145900                                                                  14590011
146000 8050-WRITE-EXTRACT-INVTRY-REC.                                   14600011
146100                                                                  14610011
146200     WRITE SALES-EXTRACT-INVNTRY-RECORD  FROM PV-INVENTORY-LAYOUT.14620011
146300                                                                  14630011
146400                                                                  14640048
146500*----------------------------------------------------------------*14650003
146600*    WRITE-CORRECTIONS                                           *14660003
146700*      THIS IS PERFORMED ONLY VIA THE 4000-BUILD-MDSE-RECORD     *14670003
146800*                          OR VIA THE 4600-BUILD-DISC-RECORD     *14680003
146900*      PURPOSE: DO THE ACTUAL WRITE TO THE OUTPUT CORRECTIONS    *14690003
147000*----------------------------------------------------------------*14700003
147100                                                                  14710003
147200 8300-WRITE-CORRECTIONS.                                          14720003
147300                                                                  14730003
147400     WRITE CORRECTIONS-RECORD FROM D040-RECORD.                   14740003
147500     ADD 1                       TO PA-TOT-CORRECTIONS-WRITTEN.   14750003
147600                                                                  14760003
147700                                                                  14770003
147800                                                                  14780048
147900                                                                  14790011
148000 8350-WRITE-CORRECTIONS-INVNTRY.                                  14800011
148100                                                                  14810011
148200     WRITE CORRECTIONS-INVNTRY-RECORD FROM PV-INVENTORY-LAYOUT.   14820011
148300                                                                  14830011
148400                                                                  14840048
148500*----------------------------------------------------------------*14850003
148600*    FIRST-TIME-CHECK                                            *14860003
148700*      THIS IS PERFORMED ONLY VIA THE 0000-MAINLINE-ROUTINE      *14870003
148800*      PURPOSE: READ THE FIRST RECORD TO DETERMINE END OF FILE   *14880003
148900*----------------------------------------------------------------*14890003
149000 9000-FIRST-TIME-CHECK.                                           14900003
149100                                                                  14910003
149200     PERFORM 9010-READ-POS-DATE-FILE.                             14920003
149300                                                                  14930003
149400     CLOSE POS-DATE-FILE.                                         14940003
149500                                                                  14950003
149600     IF PS-END-OF-CARD-FILE                                       14960003
149700         MOVE '9000-FIRST-TIME-CHECK' TO PV-PARAGRAPH-NAME        14970003
149800         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  14980003
149900         SET PV-ABEND-4009-CARD-ERROR TO TRUE                     14990003
150000         PERFORM 9999-ABEND                                       15000003
150100     END-IF.                                                      15010003
150200                                                                  15020003
150300     DISPLAY PC-LITERAL-PROGRAM-NO                                15030003
150400             ' - CONTROL CARD = (' CC-CONTROL-CARD-DISPLAY ')'.   15040003
150500                                                                  15050003
150600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              15060003
150700                                                                  15070003
150800     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      15080003
150900     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     15090003
151000     SET DPG52-LK-DTE-GREG       TO TRUE.                         15100003
151100                                                                  15110003
151200     MOVE CC-POS-DATE-MMDDYY     TO DPG52-LK-DATE-INPUT.          15120003
151300                                                                  15130003
151400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    15140003
151500                                             DPG54 DPG55 DPG56.   15150003
151600                                                                  15160003
151700     EVALUATE TRUE                                                15170003
151800         WHEN DPG54-SEVERE-ERROR                                  15180003
151900         WHEN DPG54-DATE-INVALID                                  15190003
152000             MOVE '9000-FIRST-TIME-CHECK' TO PV-PARAGRAPH-NAME    15200003
152100             MOVE 'ERROR CONVERTING INPUT CARD DATE'              15210003
152200                                           TO PV-OPERATION-MSG-1  15220003
152300             SET PV-ABEND-4019-CALENDAR-ERROR TO TRUE             15230015
152400             MOVE DPG54-ERROR-MESSAGE TO PV-OPERATION-MSG-2       15240003
152500             PERFORM 9999-ABEND                                   15250003
152600     END-EVALUATE.                                                15260003
152700                                                                  15270003
152800     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-RUN-DATE-CCYY-MM-DD        15280003
152900                                    EPDKEY-PRCG-DTE.              15290003
153000     DISPLAY 'PV-RUN-DATE-CCYY-MM-DD - ' PV-RUN-DATE-CCYY-MM-DD.  15300003
153100                                                                  15310003
153200     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              15320003
153300                                                                  15330003
153400     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       15340003
153500     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     15350003
153600     SET DPG52-LK-DTE-GREG       TO TRUE.                         15360003
153700                                                                  15370003
153800     MOVE CC-POS-DATE-MMDDYY     TO DPG52-LK-DATE-INPUT.          15380003
153900                                                                  15390003
154000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    15400003
154100                                             DPG54 DPG55 DPG56.   15410003
154200                                                                  15420003
154300     EVALUATE TRUE                                                15430003
154400         WHEN DPG54-SEVERE-ERROR                                  15440003
154500         WHEN DPG54-DATE-INVALID                                  15450003
154600             MOVE '9000-FIRST-TIME-CHECK' TO PV-PARAGRAPH-NAME    15460003
154700             MOVE 'ERROR CONVERTING INPUT CARD DATE'              15470003
154800                                           TO PV-OPERATION-MSG-1  15480003
154900             SET PV-ABEND-4019-CALENDAR-ERROR TO TRUE             15490015
155000             MOVE DPG54-ERROR-MESSAGE TO PV-OPERATION-MSG-2       15500003
155100             PERFORM 9999-ABEND                                   15510003
155200     END-EVALUATE.                                                15520003
155300                                                                  15530003
155400     MOVE DPG56-FIRST-FP-DB2-ISO-FMT                              15540003
155500                                 TO PV-CUT-OFF-CCYY-MM-DD.        15550003
155600     DISPLAY 'PV-CUT-OFF-CCYY-MM-DD - ' PV-CUT-OFF-CCYY-MM-DD     15560003
155700                                                                  15570003
155800     DISPLAY 'DPG56-FISCAL-PERIOD-NBR ------- '                   15580003
155900              DPG56-FISCAL-PERIOD-NBR                             15590003
156000     DISPLAY 'DPG56-FIRST-FISCAL-PERIOD-DAY - '                   15600003
156100              DPG56-FIRST-FISCAL-PERIOD-DAY                       15610003
156200     DISPLAY 'DPG56-LAST-FISCAL-PERIOD-DAY -- '                   15620003
156300              DPG56-LAST-FISCAL-PERIOD-DAY.                       15630003
156400                                                                  15640003
156500     PERFORM 9100-GET-DB2-PARTITION-NBR.                          15650003
156600                                                                  15660003
156700     PERFORM 9400-GET-FIRST-TRANSACTION.                          15670003
156800                                                                  15680003
156900     IF PS-NOT-END-OF-TEPTRN-CSR                                  15690003
157000         PERFORM 5050-GET-KOHLS-DATE-FIELDS.                      15700003
157100                                                                  15710003
157200******************************************************************15720003
157300* 9005-DISPLAY-SQL-MSG.                                           15730003
157400*     DISPLAY MESSAGES WHEN SQL NOT ZERO AND ABEND NOT NEEDED.    15740003
157500******************************************************************15750003
157600 9005-DISPLAY-SQL-MSG.                                            15760003
157700     CONTINUE.                                                    15770003
157800*    DISPLAY '** SAKUT008 WARNING **'.                            15780003
157900*    DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       15790003
158000*    DISPLAY '** OPERATION        ** = ' PV-DB2-OPERATION.        15800003
158100*    PERFORM 9110-DISPLAY-KEY-FIELDS.                             15810003
158200******************************************************************15820003
158300* 9010-READ-POS-DATE-FILE                                         15830003
158400*     READ DATE CONTROL CARD.                                     15840003
158500******************************************************************15850003
158600 9010-READ-POS-DATE-FILE.                                         15860003
158700                                                                  15870003
158800     READ POS-DATE-FILE INTO CC-CONTROL-CARD                      15880003
158900        AT END                                                    15890003
159000           SET PS-END-OF-CARD-FILE TO TRUE.                       15900003
159100                                                                  15910003
159200                                                                  15920048
159300*----------------------------------------------------------------*15930003
159400*    GET-DB2-PARTITION-NBR                                       *15940003
159500*      USING CONVERTED POS DATE, SELECT PARTN-NBR FROM TEPPART.  *15950003
159600*----------------------------------------------------------------*15960003
159700 9100-GET-DB2-PARTITION-NBR.                                      15970003
159800                                                                  15980003
159900     EXEC SQL                                                     15990003
160000         SELECT PARTN_NBR                                         16000003
160100           INTO :EPPART-PARTN-NBR                                 16010003
160200           FROM TEPPART                                           16020003
160300          WHERE SLS_DTE      = :PV-RUN-DATE-CCYY-MM-DD            16030003
160400            AND DB_STRUC_CDE = 'O'                                16040003
160500          WITH UR                                                 16050003
160600     END-EXEC.                                                    16060003
160700     EVALUATE TRUE                                                16070003
160800         WHEN SQLCODE = ZERO                                      16080003
160900             CONTINUE                                             16090003
161000         WHEN SQLWARN0 NOT EQUAL SPACE                            16100003
161100         WHEN SQLCODE NOT EQUAL ZERO                              16110003
161200             MOVE '9100-GET-DB2-PARTITION-NBR'                    16120003
161300                                 TO PV-PARAGRAPH-NAME             16130003
161400             MOVE 'ERROR ON SELECT FROM TEPPART '                 16140003
161500                                 TO PV-DB2-OPERATION              16150003
161600             PERFORM 9900-SQL-ABEND                               16160003
161700     END-EVALUATE.                                                16170003
161800*----------------------------------------------------------------*16180003
161900* 9110-DISPLAY-KEY-FIELDS.                                       *16190003
162000*----------------------------------------------------------------*16200003
162100 9110-DISPLAY-KEY-FIELDS.                                         16210003
162200     DISPLAY ' '.                                                 16220003
162300     DISPLAY '** KEY FIELDS:  **   '.                             16230003
162400                                                                  16240003
162500     DISPLAY 'OPERCO_NBR = ' PC-OP-CO-NMBR.                       16250003
162600     DISPLAY 'DEPT_NBR   = ' PV-DEPT-NBR.                         16260003
162700     DISPLAY 'SUB_CL_NBR = ' PV-SUB-CL-NBR.                       16270003
162800     DISPLAY 'MDSELV_CDE = ' PC-MDSE-SUB-CLASS-LEVEL.             16280003
162900     DISPLAY 'DATE       = ' PV-DB2-CCYY-MM-DD.                   16290003
163000     DISPLAY '** CURRENT TRAN: **   '                             16300003
163100     DISPLAY 'PARTN-NBR  = ' EPTRN-PARTN-NBR                      16310003
163200     DISPLAY 'STR-NBR    = ' EPTRN-STR-NBR                        16320003
163300     DISPLAY 'RGST-ID    = ' EPTRN-RGST-ID                        16330003
163400     DISPLAY 'TRN-NBR    = ' EPTRN-TRN-NBR                        16340003
163500     DISPLAY 'STRT-TM    = ' EPTRN-STRT-TM                        16350003
163600     MOVE EPTRN-SLS-CORR-SEQ-NBR TO PV-DISPLAY-SIGNED-4.          16360003
163700     DISPLAY 'SLS_CORR_SEQ_NBR = ' PV-DISPLAY-SIGNED-4.           16370003
163800     DISPLAY '** CURRENT ITEM: **   '                             16380003
163900     MOVE EPITM-UPC-NBR TO PV-DISPLAY-NBR-15.                     16390003
164000     DISPLAY '    EPITM-UPC-NBR = ' PV-DISPLAY-NBR-15.            16400003
164100     DISPLAY '   EPITM-DEPT-NBR = ' EPITM-DEPT-NBR.               16410003
164200     DISPLAY ' EPITM-MAJ-CL-NBR = ' EPITM-MAJ-CL-NBR.             16420003
164300     DISPLAY ' EPITM-SKU-NBR    = ' EPITM-SKU-NBR.                16430003
164400     DISPLAY ' EPITM-SUB-CL-NBR = ' EPITM-SUB-CL-NBR.             16440003
164500*----------------------------------------------------------------*16450003
164600*    DISPLAY-FINAL-COUNTS                                        *16460003
164700*      THIS IS PERFORMED ONLY VIA THE 0000-MAINLINE-LOGIC        *16470003
164800*      PURPOSE: DISPLAY THE COUNTS ACCUMULATED DURING PROCESSING *16480003
164900*----------------------------------------------------------------*16490003
165000                                                                  16500003
165100 9200-END-PROCESSING.                                             16510003
165200                                                                  16520003
MKTPLC     MOVE PA-TOTAL-ML-AMT   TO PA-TOTAL-ML-AMT-D.                 16521070
MKTPLC     MOVE PA-TOTAL-ACCUM-TAX-AMT TO PA-TOTAL-ACCUM-TAX-AMT-D.     16521170
MKTPLC     MOVE PA-TOTAL-EMP-DISC-AMT TO PA-TOTAL-EMP-DISC-AMT-D.       16522070
165200                                                                  16523070
165300     DISPLAY ' '.                                                 16530003
165400     DISPLAY 'PROGRAM SAKUT008 ENDED / SAKUT008 RECORD TOTALS'.   16540003
165500     DISPLAY '-----------------------------------------------'.   16550003
165600                                                                  16560003
165700     DISPLAY ' '.                                                 16570003
165800     DISPLAY '** TOTAL INPUT RECORDS READ......... = '            16580003
165900         PA-INPUT-RECORD-CNT.                                     16590003
166000     DISPLAY ' '.                                                 16600003
166100                                                                  16610003
166200     DISPLAY '** VALID SALE TRAN CODES PROCESSED.. = '            16620003
166300         PA-VALID-SALE-PROCD.                                     16630003
166400     DISPLAY '** TOTAL ALL INPUT TRANSACTIONS..... = '            16640003
166500         PA-ALL-TRANSACTIONS.                                     16650003
166600     DISPLAY ' '.                                                 16660003
166700                                                                  16670003
166800     DISPLAY '** COUPON RECORDS DROPPED........... = '            16680003
166900         PA-COUPONS-BYPASSED.                                     16690003
167000     DISPLAY ' '.                                                 16700003
167100                                                                  16710003
167200     DISPLAY '** EMPLOYEE DISCOUNT RCDS WRITTEN... = '            16720003
167300         PA-EMP-DISC-WRITTEN.                                     16730003
167400     DISPLAY '** MERCHANDISE RECORDS WRITTEN...... = '            16740003
167500         PA-MERCHAND-WRITTEN.                                     16750003
167600     DISPLAY '** TAX RECORDS WRITTEN.............. = '            16760003
167700         PA-TAX-RCDS-WRITTEN.                                     16770003
167800     DISPLAY '** TOTAL SALES EXTRACT RECORDS WRITTEN.... = '      16780003
167900         PA-TOT-SALE-RCDS-WRITTEN.                                16790003
168000     DISPLAY '** TOTAL CORRECTION RECORDS WRITTEN.......= '       16800003
168100         PA-TOT-CORRECTIONS-WRITTEN.                              16810003
168200     DISPLAY ' '.                                                 16820003
168300                                                                  16830003
168400     DISPLAY '** MDSE RECORDS CONVERTED........... = '            16840003
168500         PA-MDSE-RCDS-CNVRTD.                                     16850003
                                                                        16851070
MKTPLC     DISPLAY ' '.                                                 16851170
MKTPLC     DISPLAY '** TOTAL SALES UNITS................ = '            16852070
MKTPLC         PA-TOTAL-SALES-UNITS-D.                                  16853070
MKTPLC     DISPLAY '** TOTAL SALES AMOUNT............... = '            16854070
MKTPLC         PA-TOTAL-SALES-AMT-D.                                    16855070
MKTPLC     DISPLAY ' '.                                                 16856070
MKTPLC     DISPLAY '** TOTAL ML UNITS................... = '            16857070
MKTPLC         PA-TOTAL-ML-UNITS-D.                                     16858070
MKTPLC     DISPLAY '** TOTAL ML AMOUNT.................. = '            16859070
MKTPLC         PA-TOTAL-ML-AMT-D.                                       16859170
MKTPLC     DISPLAY '** TOTAL EMP DISC AMT............... = '            16859270
MKTPLC         PA-TOTAL-EMP-DISC-AMT-D.                                 16859370
MKTPLC     DISPLAY '** TOTAL NET CHRGD AMT.............. = '            16859470
MKTPLC         PA-TOTAL-NET-CHRG-AMT-D.                                 16859570
MKTPLC     DISPLAY '** TOTAL ACCUM TAX AMT.............. = '            16859670
MKTPLC         PA-TOTAL-ACCUM-TAX-AMT-D.                                16859770
MKTPLC     DISPLAY ' '.                                                 16859870
MKTPLC     DISPLAY '** MDSE UNITS EXCLUDED.............. = '            16859970
MKTPLC         PA-TOTAL-EXCLUDED-UNITS-D.                               16860070
MKTPLC     DISPLAY '** MDSE AMOUNTS EXCLUDED............ = '            16860170
MKTPLC         PA-TOTAL-EXCLUDED-AMT-D.                                 16860270
MKTPLC     DISPLAY '** TOTAL DEPT 098 UNITS EXCLUDED.... = '            16860370
MKTPLC         PA-DEPT098-UNITS-D.                                      16860470
MKTPLC     DISPLAY '** TOTAL DEPT 098 AMOUNT EXCLUDED... = '            16860570
MKTPLC         PA-DEPT098-AMT-D.                                        16860670
MKTPLC     DISPLAY '** TOTAL GIFT DEPT CLASS UNIT EXCLUD = '            16860770
MKTPLC         PA-BOTH-GIFT-DEPT-CLASS-UN-D.                            16860870
MKTPLC     DISPLAY '** TOTAL GIFT DEPT CLASS AMT EXCLUDE = '            16860970
MKTPLC         PA-BOTH-GIFT-DEPT-CLASS-AMT-D.                           16861070
MKTPLC     DISPLAY '** TOTAL TPC DEPT CLASS UNIT EXCLUDE = '            16861170
MKTPLC         PA-TPC-DEPT-CLASS-UNITS-D.                               16861270
MKTPLC     DISPLAY '** TOTAL TPC DEPT CLASS AMT EXCLUDED = '            16861370
MKTPLC         PA-TPC-DEPT-CLASS-AMT-D.                                 16861470
MKTPLC     DISPLAY '** TOTAL KEYED TAX DEPT CLASS UN EXC = '            16861570
MKTPLC         PA-KEYED-TAX-DEPT-CLASS-UN-D.                            16861670
MKTPLC     DISPLAY '** TOTAL KEYED TAX DEPT CLASS AMT EX = '            16861770
MKTPLC         PA-KEYED-TAX-DEPT-CLASS-AMT-D.                           16861870
MKTPLC     DISPLAY '** TOTAL MKTPLC DEPT 985 UNITS EXCLU = '            16861970
MKTPLC         PA-MKTPLACE-DEPT-985-UNITS-D.                            16862070
MKTPLC     DISPLAY '** TOTAL MKTPLC DEPT 985 AMT EXCLUDE = '            16862170
MKTPLC         PA-MKTPLACE-DEPT-985-AMT-D.                              16862270
MKTPLC     DISPLAY '** TOTAL COUPON DEPT CLASS UNIT EXCL = '            16862370
MKTPLC             PA-COUPONS-BYPASSED-D.                               16862470
MKTPLC     DISPLAY '** TOTAL COUPON DEPT CLASS AMT EXCLU = '            16862570
MKTPLC             PA-COUPON-DEPT-CLASS-AMT-D.                          16862670
MKTPLC     DISPLAY '** TOTAL MKTPLC TAX AMT EXCLUDED.... = '            16862770
MKTPLC             PA-TOTAL-MKTPLACE-TX-AMT-D.                          16862870
SEPHOR     DISPLAY '** TOTAL SEPHOR DEPT 712 UNITS EXCLU = '            16863373
SEPHOR         PA-SEPHORA-DEPT-712-UNITS-D.                             16863473
SEPHOR     DISPLAY '** TOTAL SEPHOR DEPT 712 AMT EXCLUDE = '            16863573
SEPHOR         PA-SEPHORA-DEPT-712-AMT-D.                               16863673
166600                                                                  16866066
168700     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   16870003
168800     ACCEPT PV-CURR-TIME FROM TIME.                               16880003
168900                                                                  16890003
169000     MOVE PV-CURR-DATE-MM         TO DP132-RUN-MONTH.             16900003
169100     MOVE PV-CURR-DATE-DD         TO DP132-RUN-DAY.               16910003
169200     MOVE PV-CURR-DATE-CCYY       TO DP132-RUN-YEAR.              16920003
169300                                                                  16930003
169400     MOVE PV-CURR-TIME-HH         TO DP132-RUN-HOUR.              16940003
169500     MOVE PV-CURR-TIME-MM         TO DP132-RUN-MINUTE.            16950003
169600     MOVE PC-CURRENT-PROGRAM-NAME TO DP132-PROGRAM-NAME.          16960003
169700     MOVE PC-REPORT-NBR-1         TO DP132-REPORT-NUMBER.         16970003
169800                                                                  16980003
169900     ADD +1 TO PV-PAGE-CNT.                                       16990003
170000     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       17000003
170100     WRITE ML-REPORT-RECORD FROM DP132-STANDRD-HEADER-132-COLS    17010003
170200         AFTER ADVANCING PAGE.                                    17020003
170300                                                                  17030003
170400     WRITE ML-REPORT-RECORD FROM HEADING-LINE-2                   17040003
170500         AFTER ADVANCING 1.                                       17050003
170600                                                                  17060003
170700     WRITE ML-REPORT-RECORD FROM HEADING-LINE-3                   17070003
170800         AFTER ADVANCING 2.                                       17080003
170900                                                                  17090003
171000     MOVE 'MISC. DEPT/CLASS '        TO DL-DESCRIPTION.           17100003
171100     MOVE PA-TOTAL-09910-AMT         TO DL-AMOUNT.                17110003
171200     MOVE PA-TOTAL-09910-UNITS       TO DL-UNITS.                 17120003
171300     WRITE ML-REPORT-RECORD FROM DETAIL-LINE                      17130003
171400         AFTER ADVANCING 2.                                       17140003
171500                                                                  17150003
171600     MOVE 'TAX DEPT/CLASS'           TO DL-DESCRIPTION.           17160003
171700     MOVE PA-TOTAL-09970-AMT         TO DL-AMOUNT.                17170003
171800     MOVE ZERO                       TO DL-UNITS.                 17180003
171900     WRITE ML-REPORT-RECORD FROM DETAIL-LINE                      17190003
172000         AFTER ADVANCING 2.                                       17200003
172100                                                                  17210003
172200     MOVE 'DISCOUNT DEPT/CLASS'      TO DL-DESCRIPTION.           17220003
172300     MOVE PA-TOTAL-09990-AMT         TO DL-AMOUNT.                17230003
172400     MOVE ZERO                       TO DL-UNITS.                 17240003
172500     WRITE ML-REPORT-RECORD FROM DETAIL-LINE                      17250003
172600         AFTER ADVANCING 2.                                       17260003
172700                                                                  17270003
172800     MOVE 'TOTAL ALL RECORDS       ' TO DL-DESCRIPTION.           17280003
172900     MOVE PA-TOTAL-ML-AMT            TO DL-AMOUNT.                17290003
173000     MOVE PA-TOTAL-ML-UNITS          TO DL-UNITS.                 17300003
173100     WRITE ML-REPORT-RECORD FROM DETAIL-LINE                      17310003
173200         AFTER ADVANCING 2.                                       17320003
173300                                                                  17330003
173400                                                                  17340003
173500*----------------------------------------------------------------*17350003
173600*     9400-GET-FIRST-TRANSACTION.                                *17360003
173700*         DO FIRST FETCH OF TEPTRN-CURSOR.                       *17370003
173800*     NOTE:  IF CURSOR DATA NOT PRESENT, NO FILE WILL BE PRODUCED*17380003
173900*----------------------------------------------------------------*17390003
174000 9400-GET-FIRST-TRANSACTION.                                      17400003
174100                                                                  17410003
174200     SET PS-NOT-END-OF-TEPTRN-CSR TO TRUE.                        17420003
174300                                                                  17430003
174400     PERFORM 9410-OPEN-TEPTRN-CURSOR.                             17440003
174500     PERFORM 9420-FETCH-TEPTRN-CURSOR                             17450003
174600                                                                  17460003
174700     IF PS-END-OF-TEPTRN-CSR                                      17470003
174800         MOVE EPPART-PARTN-NBR TO PV-DISPLAY-NBR-4                17480003
174900         DISPLAY '*** NO TRANSACTION DATA PRESENT ON TEPTRN FOR ' 17490003
175000                 'PARTN-NBR = ' PV-DISPLAY-NBR-4 ' ***'           17500003
175100     END-IF.                                                      17510003
175200*----------------------------------------------------------------*17520003
175300*     9410-OPEN TEPTRN-CURSOR.                                   *17530003
175400*----------------------------------------------------------------*17540003
175500 9410-OPEN-TEPTRN-CURSOR.                                         17550003
175600                                                                  17560003
175700     EXEC SQL                                                     17570003
175800         OPEN TEPTRN-CURSOR                                       17580003
175900     END-EXEC.                                                    17590003
176000                                                                  17600003
176100     EVALUATE TRUE                                                17610003
176200         WHEN SQLCODE = ZERO                                      17620003
176300             CONTINUE                                             17630003
176400         WHEN SQLWARN0 NOT EQUAL SPACE                            17640003
176500         WHEN SQLCODE NOT EQUAL ZERO                              17650003
176600             MOVE '9410-OPEN-TEPTRN-CURSOR'                       17660003
176700                                 TO PV-PARAGRAPH-NAME             17670003
176800             MOVE 'ERROR ON OPEN OF TEPTRN-CURSOR'                17680003
176900                                 TO PV-DB2-OPERATION              17690003
177000             PERFORM 9900-SQL-ABEND                               17700003
177100     END-EVALUATE.                                                17710003
177200*----------------------------------------------------------------*17720003
177300*     9420-FETCH-TEPTRN-CURSOR.                                  *17730003
177400*----------------------------------------------------------------*17740003
177500 9420-FETCH-TEPTRN-CURSOR.                                        17750003
177600                                                                  17760003
177700     EXEC SQL                                                     17770003
177800         FETCH TEPTRN-CURSOR                                      17780003
177900          INTO :EPTRN-PARTN-NBR                                   17790003
178000              ,:EPTRN-STR-NBR                                     17800003
178100              ,:EPTRN-RGST-ID                                     17810003
178200              ,:EPTRN-TRN-NBR                                     17820003
178300              ,:EPTRN-STRT-TM                                     17830003
178400              ,:EPTRN-SLS-CORR-SEQ-NBR                            17840003
178500              ,:EPTRN-VOID-ABRT-CDE                               17850003
178600              ,:EPTRN-TRN-STAT-CDE                                17860003
178700              ,:EPTRN-TRN-TYP-CDE                                 17870003
178800              ,:EPTRN-SLS-DTE                                     17880003
178900              ,:EPTRN-SLS-TX-AMT                                  17890003
179000              ,:EPTRN-ASSOC-ID                                    17900003
179100      END-EXEC.                                                   17910003
179200                                                                  17920003
179300      EVALUATE TRUE                                               17930003
179400          WHEN SQLCODE = ZERO                                     17940003
179500              CONTINUE                                            17950052
179600          WHEN SQLCODE = PC-ROW-NOT-FOUND                         17960003
179700              SET PS-END-OF-TEPTRN-CSR TO TRUE                    17970003
179800          WHEN SQLWARN0 NOT EQUAL SPACE                           17980003
179900          WHEN SQLCODE NOT EQUAL ZERO                             17990003
180000              MOVE '9420-FETCH-TEPTRN-CURSOR'                     18000003
180100                                  TO PV-PARAGRAPH-NAME            18010003
180200              MOVE 'ERROR ON FETCH OF TEPTRN-CURSOR'              18020003
180300                                  TO PV-DB2-OPERATION             18030003
180400              PERFORM 9900-SQL-ABEND                              18040003
180500      END-EVALUATE.                                               18050003
180600*----------------------------------------------------------------*18060003
180700*     9430-CLOSE-TEPTRN-CURSOR.                                  *18070003
180800*----------------------------------------------------------------*18080003
180900  9430-CLOSE-TEPTRN-CURSOR.                                       18090003
181000                                                                  18100003
181100      EXEC SQL                                                    18110003
181200          CLOSE TEPTRN-CURSOR                                     18120003
181300      END-EXEC.                                                   18130003
181400                                                                  18140003
181500      EVALUATE TRUE                                               18150003
181600          WHEN SQLCODE = ZERO                                     18160003
181700              CONTINUE                                            18170003
181800          WHEN SQLWARN0 NOT EQUAL SPACE                           18180003
181900          WHEN SQLCODE NOT EQUAL ZERO                             18190003
182000              MOVE '9430-CLOSE-TEPTRN-CURSOR'                     18200003
182100                                 TO PV-PARAGRAPH-NAME             18210003
182200              MOVE 'ERROR ON CLOSE OF TEPTRN-CURSOR'              18220003
182300                                 TO PV-DB2-OPERATION              18230003
182400              PERFORM 9900-SQL-ABEND                              18240003
182500      END-EVALUATE.                                               18250003
182600                                                                  18260003
182700*----------------------------------------------------------------*18270003
182800*     9900-SQL-ABEND                                             *18280003
182900* ==> PROCESSES:                                                 *18290003
183000*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *18300003
183100* ==> PERFORMED FROM:                                            *18310003
183200*----------------------------------------------------------------*18320003
183300 9900-SQL-ABEND.                                                  18330003
183400                                                                  18340003
183500     DISPLAY '9900-SQL-ABEND'.                                    18350003
183600     DISPLAY '**  ABEND     **'.                                  18360003
183700     DISPLAY '**  PROGRAM   ** = ' PC-LITERAL-PROGRAM-NO.         18370003
183800     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             18380003
183900     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION.              18390003
184000                                                                  18400003
184100*----------------------------------------------------------------*18410003
184200* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *18420003
184300* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *18430003
184400* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *18440003
184500* FORMAT.                                                        *18450003
184600*----------------------------------------------------------------*18460003
184700     COPY DPPD004.                                                18470003
184800                                                                  18480003
184900     SET PV-ABEND-4013-DB2-ERROR TO TRUE.                         18490003
185000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         18500045
185100*    END OF SOURCE CODE FOR SAKUT008                              18510003
185200*---------------------------------------------------------------* 18520003
185300*----------------------------------------------------------------*18530003
185400*     9999-ABEND                                                 *18540003
185500* ==> PROCESSES:                                                 *18550003
185600*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *18560003
185700* ==> PERFORMED FROM:                                            *18570003
185800*----------------------------------------------------------------*18580003
185900 9999-ABEND.                                                      18590003
186000                                                                  18600003
186100     DISPLAY '9999-ABEND'.                                        18610003
186200     DISPLAY '**  ABEND     **'.                                  18620003
186300     DISPLAY '**  PROGRAM   ** ' PC-LITERAL-PROGRAM-NO.           18630003
186400     DISPLAY '**  PARAGRAPH ** ' PV-PARAGRAPH-NAME.               18640003
186500     DISPLAY '**  OPERATION ** ' PV-OPERATION-MSG-1.              18650003
186600     DISPLAY '**            ** ' PV-OPERATION-MSG-2.              18660003
186700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         18670003
186800                                                                  18680003
