       IDENTIFICATION DIVISION.                                         00010067
       PROGRAM-ID.    TFKCS456.                                         00020067
       AUTHOR.        JACK KRAMER.                                      00030067
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040067
       DATE-WRITTEN.  JUNE 1997.                                        00050067
       DATE-COMPILED.                                                   00060067
      *---------------------------------------------------------------* 00070067
      *    P456 - ADD TRANSFER ITEMS.                                 * 00080067
      *                                                               * 00090067
      *    THIS PROGRAM ALLOWS THE USER TO ADD ITEMS TO A TRANSFER    * 00100067
      *    AFTER THE TRANSFER HAS BEEN POSITIVELY RECEIVED. ROWS ARE  * 00110067
      *    INSERTED INTO TTFITEM, TTFITRC, AND TTFITPS.               * 00120067
      *---------------------------------------------------------------* 00130067
      *  1/20/2003 - RAY GRAF                                           00140067
      *   PROCESS NONINTELLIGENT SKU.                                   00150067
      ******************************************************************00160067
051203**DATE:05/12/2003 CHANGED BY: JULIE TEWES  DUMMY UPC CHANGES      00170067
      ******************************************************************00180067
111703* 11/17/2003 - RAY GRAF                                           00181079
111703*   SORT1/SORT2 TRANSFER TYPES.                                   00182080
      ******************************************************************00183079
080204**DATE:08/02/2004 CHANGED BY: RAY GRAF                            00184082
080204**     ACCESS TINVPAR USING LOC_NBR, NOT STORE_NBR.               00185082
      ***************************************************************** 00186082
100404**DATE:10/04/2004 CHANGED BY: RAY GRAF                            00187083
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00188083
      ***************************************************************** 00189083
051705*  DATE 05/17/05 RAY GRAF                                         00189188
051705*  REMOVE PHYSICAL INVENTORY LOGIC                                00189288
051705******************************************************************00189388
SR3403*  DATE 03/02/12 JALAJ KUMAR                WR#SR3403             00189590
SR3403*  PRICE FIELD EXPANSIONS FOR LARGE RETAIL PROJECT                00189690
SR3403******************************************************************00189790
      * DATE:        09/24/2021                                         00189894
      * WR/IR#:      CHG0261678                                         00189996
      * PROGRAMMER:  GERMAN BANDA                                       00190094
      * DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00190194
      *              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00190294
      *              MAKING THE CALL DYNAMIC VS STATIC                  00190394
      *----------------------------------------------------------------*00190494
CICS  * CHANGED 11/16/2022    BY JIM HUNTER      WR: CHG0278345         00190597
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00190697
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00190797
CICS  *-----------------------------------------------------------------00190897
      * CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281369         00190998
      *    CHANGE CALL OF UPC CHECK DIGIT ROUTINE TO BE DYNAMIC         00191099
      *-----------------------------------------------------------------00191298
       ENVIRONMENT DIVISION.                                            00192067
       DATA DIVISION.                                                   00200067
       WORKING-STORAGE SECTION.                                         00210067
                                                                        00220067
       01  DK-DB2-KEYS.                                                 00230067
           05  DK-XFER-DKEY-ID                PIC  S9(9)  VALUE ZERO    00240067
                                                          COMP.         00250067
           05  DK-STORE-NBR                   PIC  S9(4)  VALUE ZERO    00260067
                                                          COMP.         00270067
051705*    05  DK-STORE-NBR-9                 PIC S9(04)  VALUE ZEROS   00280088
051705*                                                   COMP.         00281088
           05  DK-UPC-NBR                     PIC S9(15)  VALUE ZERO    00300067
                                                          COMP-3.       00310067
           05  DK-ITEM-NBR                    PIC S9(15)  VALUE ZEROS   00320067
                                                           COMP-3.      00330067
           05  DK-SKU-STATUS-CODE             PIC S9(03)  VALUE ZEROS   00331085
                                                           COMP-3.      00332085
      ******************************************************************00340067
      **PROGRAM CONSTANTS                                               00350067
      ******************************************************************00360067
       01  PC-PROGRAM-CONSTANTS.                                        00370067
           05  PC-COMPLETE-STATUS             PIC  X(02)  VALUE 'CM'.   00380067
           05  PC-POSITIVE-RECEIPT            PIC  X(02)  VALUE 'PR'.   00390067
           05  PC-ONE                         PIC  S9(04) VALUE +1      00400067
                                                          COMP.         00410067
           05  PC-ZERO                        PIC S9(04)  VALUE ZERO    00420067
                                                          COMP.         00430067
           05  PC-SCL                         PIC  X(03)  VALUE 'SCL'.  00440067
           05  PC-ADJUSTMENT-CODE              PIC  X(02)  VALUE 'IA'.  00450067
           05  PC-FASHION-SALES                PIC  X(02)  VALUE 'FS'.  00460067
           05  PC-MERCHANDISE-LEDGER           PIC  X(02)  VALUE 'ML'.  00470067
           05  PC-KOHLS-OPERATING-COMPANY     PIC  X(02)  VALUE '03'.   00480067
           05  PC-CLEARANCE                   PIC  9(02)  VALUE 30.     00490067
           05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00500067
                                                          'TF456A  '.   00510067
           05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00520067
                                                          'TFKM456 '.   00530067
           05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00540067
                                                          'TFKCS456'.   00550067
           05  PC-COMMON-HEADER-MAP-NAME      PIC  X(08)  VALUE         00560067
                                                          'TF456A  '.   00570067
           05  PC-RTL-DETAIL-MAP-NAME         PIC  X(08)  VALUE         00580067
                                                          'TF456B  '.   00590067
           05  PC-NRTL-DETAIL-MAP-NAME        PIC  X(08)  VALUE         00600067
                                                          'TF456C  '.   00610067
           05  PC-YES                         PIC  X(01)  VALUE 'Y'.    00620067
111703*    05  PC-DEFECTIVE-DAMAGE            PIC  X(02)  VALUE '01'.   00630079
111703     05  PC-DEFECTIVE-DAMAGE-SORT1      PIC  X(02)  VALUE '00'.   00631080
111703     05  PC-DEFECTIVE-DAMAGE-SORT2      PIC  X(02)  VALUE '01'.   00632080
           05  PC-CALLBACK                    PIC  X(02)  VALUE '02'.   00640067
           05  PC-STOCK-BAL-CORP              PIC  X(02)  VALUE '03'.   00650067
           05  PC-STOCK-BAL-STORE             PIC  X(02)  VALUE '04'.   00660067
           05  PC-CUSTOMER                    PIC  X(02)  VALUE '05'.   00670067
           05  PC-NON-RETAIL                  PIC  X(02)  VALUE '06'.   00680067
           05  PC-OFFSITE-STORAGE             PIC  X(02)  VALUE '07'.   00690067
           05  PC-HAND-CARRY                  PIC  X(02)  VALUE '05'.   00700067
           05  PC-SETUP-FORMAT                PIC  X(01)  VALUE '1'.    00710067
           05  PC-FR-STR-FORMAT               PIC  X(01)  VALUE '5'.    00720067
           05  PC-MAX-QTY                     PIC S9(03)  VALUE +999    00730067
                                                          COMP-3.       00740067
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +8      00750067
                                                          COMP SYNC.    00760067
           05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00770067
                                                          COMP-3.       00780067
051705*    05  PC-MAX-DATE                 PIC X(10) VALUE '9999-09-09'.00790088
051705*    05  PC-MIN-DATE                 PIC X(10) VALUE '0001-01-01'.00800088
      ******************************************************************00810067
      **CICS MESSAGES                                                   00820067
      ******************************************************************00830067
           05  PC-TSYMSG-NUMBERS.                                       00840067
               10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00850067
               10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00860067
               10  PC-TSYMSG-00073            PIC  9(05)  VALUE 00073.  00870067
               10  PC-TSYMSG-00100            PIC  9(05)  VALUE 00100.  00880067
               10  PC-TSYMSG-00110            PIC  9(05)  VALUE 00110.  00890067
               10  PC-TSYMSG-00308            PIC  9(05)  VALUE 00308.  00900067
               10  PC-TSYMSG-00342            PIC  9(05)  VALUE 00342.  00910067
               10  PC-TSYMSG-00413            PIC  9(05)  VALUE 00413.  00920067
               10  PC-TSYMSG-01271            PIC  9(05)  VALUE 01271.  00930067
               10  PC-TSYMSG-01403            PIC  9(05)  VALUE 01403.  00940067
               10  PC-TSYMSG-01486            PIC  9(05)  VALUE 01486.  00950067
               10  PC-TSYMSG-01489            PIC  9(05)  VALUE 01489.  00960067
               10  PC-TSYMSG-01543            PIC  9(05)  VALUE 01543.  00970067
               10  PC-TSYMSG-01591            PIC  9(05)  VALUE 01591.  00980067
               10  PC-TSYMSG-01615            PIC  9(05)  VALUE 01615.  00990067
               10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01000067
               10  PC-TSYMSG-01659            PIC  9(05)  VALUE 01659.  01010067
      ******************************************************************01020067
      **PROGRAM SWITCHES                                                01030067
      ******************************************************************01040067
       01  PS-PROGRAM-SWITCHES.                                         01050067
           05  PS-CONTROL-FOUND-SW            PIC  X(01)  VALUE 'Y'.    01060067
               88  PS-CONTROL-FOUND                       VALUE 'Y'.    01070067
               88  PS-CONTROL-NOT-FOUND                   VALUE 'N'.    01080067
           05  PS-VALID-PRICE-SW              PIC  X(01)  VALUE 'N'.    01090067
               88  PS-VALID-PRICE                         VALUE 'Y'.    01100067
               88  PS-INVALID-PRICE                       VALUE 'N'.    01110067
           05  PS-VALID-UPC-SW                PIC  X(01)  VALUE 'N'.    01120067
               88  PS-VALID-UPC                           VALUE 'Y'.    01130067
               88  PS-INVALID-UPC                         VALUE 'N'.    01140067
           05  PS-VALID-CHECK-DIGIT-SW        PIC  X(01)  VALUE 'N'.    01150067
               88  PS-VALID-CHECK-DIGIT                   VALUE 'Y'.    01160067
               88  PS-INVALID-CHECK-DIGIT                 VALUE 'N'.    01170067
           05  PS-ITEM-ON-TRANSFER-SW         PIC  X(01)  VALUE 'N'.    01180067
               88  PS-ITEM-ON-TRANSFER                    VALUE 'Y'.    01190067
               88  PS-ITEM-NOT-ON-TRANSFER                VALUE 'N'.    01200067
           05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01210067
               88  PS-COMMAREA-VALID                      VALUE 'Y'.    01220067
               88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01230067
           05  PS-QTY-ERROR-FOUND-SW          PIC  X(01)  VALUE 'N'.    01240067
               88  PS-QTY-ERROR-FOUND                     VALUE 'Y'.    01250067
               88  PS-QTY-ERROR-NOT-FOUND                 VALUE 'N'.    01260067
051705*    05  PS-INVENTORY-ERROR-SW          PIC X.                    01270088
051705*        88  PS-INVENTORY-ERROR                     VALUE 'Y'.    01280088
051705*        88  PS-NO-INVENTORY-ERROR                  VALUE 'N'.    01290088
051203     05  PS-VALID-DEPT-CL-SW            PIC  X(01)  VALUE 'N'.    01300068
051203         88  PS-VALID-DEPT-CL                       VALUE 'Y'.    01310068
051203         88  PS-INVALID-DEPT-CL                     VALUE 'N'.    01320068
051203     05  PS-FOUND-DUMMY-UPC             PIC  X(01)  VALUE 'N'.    01330068
051203         88  PS-FOUND-DUMMY-UPC-Y                   VALUE 'Y'.    01340068
051203         88  PS-FOUND-DUMMY-UPC-N                   VALUE 'N'.    01350068
      ******************************************************************01360067
      **PROGRAM VARIABLES                                               01370067
      ******************************************************************01380067
       01  PV-PROGRAM-VARIABLES.                                        01390067
100404*****HOLD FOR REGIONAL AND NONREGIONAL FIELDS                     01391084
100404     05  PV-NREGN-UNT-RTL-AMT          PIC S9(7)V9(2) VALUE ZERO. 01392084
100404     05  PV-NREGN-UPC-STAT-CHG-DTE     PIC  X(10)     VALUE SPACE.01393084
100404     05  PV-NREGN-UNT-RTL-CHG-DTE      PIC  X(10)     VALUE SPACE.01394084
100404     05  PV-NREGN-LOC-SKU-STAT-CDE     PIC  X(02)     VALUE SPACE.01395084
100404     05  PV-NREGN-LOC-SKU-STAT-CDE-9 REDEFINES                    01396084
100404             PV-NREGN-LOC-SKU-STAT-CDE PIC  9(02).                01397084
100404     05  PV-REGN-LOC-SKU-STAT-CDE      PIC  X(02)     VALUE SPACE.01398084
100404     05  PV-GP-RTL-QTY-NULL-IND        PIC S9(04)     VALUE +0    01399084
100404                                                      COMP SYNC.  01399184
100404     05  PV-GP-RTL-AMT-NULL-IND        PIC S9(04)     VALUE +0    01399284
100404                                                      COMP SYNC.  01399384
           05  PV-NULL-IND                    PIC S9(04)  VALUE +0      01400067
                                                          COMP SYNC.    01410068
           05  PV-SUB                         PIC S9(04)  VALUE +0      01420067
                                                          COMP SYNC.    01430068
           05  PV-HOLD-ITEM                   PIC S9(04)  VALUE +0      01440067
                                                          COMP SYNC.    01450068
           05  PV-ITEM                        PIC S9(04)  VALUE +0      01460067
                                                          COMP SYNC.    01470068
           05  PV-ITEM2                       PIC S9(04)  VALUE +0      01480067
                                                          COMP SYNC.    01490068
           05  PV-RETRY-COUNT                 PIC S9(04)  VALUE +0      01500067
                                                          COMP SYNC.    01510068
100404*    05  PV-XFER-NBR                    PIC 9(09).                01520083
100404     05  PV-XFER-NBR                    PIC 9(10).                01521086
           05  FILLER REDEFINES PV-XFER-NBR.                            01530067
100404*        10  PV-FROM-STORE-NBR          PIC 9(03).                01540083
100404         10  PV-FROM-STORE-NBR          PIC 9(04).                01541086
               10  PV-SEQ-NBR                 PIC 9(06).                01550067
           05  PV-DISP-XFER-NBR.                                        01560067
100404*        10  PV-DISP-FROM-STORE-NBR     PIC X(03).                01570083
100404         10  PV-DISP-FROM-STORE-NBR     PIC X(04).                01571086
               10                             PIC X(01)   VALUE '-'.    01580068
               10  PV-DISP-SEQ-NBR            PIC 9(06).                01590067
           05  PV-DISPLAY-ITM-NBR             PIC 9(15)  VALUE ZEROS.   01600068
           05  PV-DISPLAY-XFER-LNE-NBR        PIC 9(04)  VALUE ZEROS.   01610068
           05  PV-XFER-SEQ-NBR                PIC S9(09)  VALUE ZERO    01620068
                                                          COMP SYNC.    01630067
           05  PV-UPC-CODE                    PIC S9(15)  VALUE ZERO    01640068
                                                          COMP-3.       01650068
           05  PV-UPC-CODE-DISPLAY            PIC 9(15)   VALUE ZERO.   01660068
           05  PV-MAP-START-BYTE              PIC S9(04)  VALUE ZERO    01670067
                                                          COMP SYNC.    01680067
           05  PV-DISPLAY-XFER-DKEY-ID        PIC 9(09)  VALUE ZEROS.   01690068
           05  PV-HOLD-QTY                    PIC S9(04)  COMP.         01700067
           05  PV-LINE-NBR                    PIC S9(04)  COMP.         01710067
SR3403*    05  PV-PRICE                       PIC ZZZZ.99.              01720090
           05  PV-QUANTITY                    PIC ZZZ.                  01730067
SR3403     05  PV-EDIT-PRICE                  PIC S9(07)V9(2)           01751091
SR3403                                              VALUE ZEROS COMP-3. 01752090
SR3403     05  PV-EDIT-PRICE-4-DEC REDEFINES PV-EDIT-PRICE              01780090
SR3403                                        PIC S9(05)V9(4)   COMP-3. 01790091
           05  PV-ABSTIME                     PIC S9(16)  VALUE +0      01810068
                                                           COMP SYNC.   01820067
           05  PV-DB2-TIMESTAMP               PIC X(26).                01830067
           05  PV-DISPLAY-UPC-NBR             PIC 9(13)  VALUE ZEROS.   01840068
           05  PV-DISPLAY-INTR-UPC-ID         PIC 9(10)  VALUE ZEROS.   01850070
051705*    05  PV-MAX-FINCL-BK-DTE            PIC X(10)  VALUE SPACE.   01860088
051705*    05  PV-FR-STR-INV-DTE              PIC X(10)  VALUE SPACE.   01870088
051705*    05  PV-TO-STR-INV-DTE              PIC X(10)  VALUE SPACE.   01880088
051705*    05  PV-XFER-INV-CTOFF-DTE          PIC X(10)  VALUE SPACE.   01890088
051705*    05  PV-LY-INV-CTOFF-DTE            PIC X(10)  VALUE SPACE.   01900088
051705*    05  PV-MAX-PLND-INV-DTE            PIC X(10)  VALUE SPACE.   01910088
051705*    05  PV-PHY-INV-PERD-IND            PIC X(10)  VALUE SPACE.   01920088
051705*    05  PV-CURRENT-DATE                PIC X(10).                01930088
051705*    05  PV-CMPLT-DATE                  PIC X(10).                01940088
051705*    05  PV-COMPARE-DATE                PIC X(10).                01950088
051705*    05  PV-HOLD-INVENTORY-IND          PIC X(01)   VALUE 'N'.    01960088
051705*        88  PV-HOLD-PHYSICAL-COUNT                  VALUE 'Y'.   01970088
051705*        88  PV-HOLD-FAKE-INVENTORY                  VALUE 'F'.   01980088
051705*        88  PV-HOLD-NO-INVENTORY                    VALUE 'N'.   01990088
051705*    05  PV-FR-INVENTORY-IND            PIC X(01)   VALUE 'N'.    02000088
051705*        88  PV-FR-PHYSICAL-COUNT                    VALUE 'Y'.   02010088
051705*        88  PV-FR-FAKE-INVENTORY                    VALUE 'F'.   02020088
051705*        88  PV-FR-NO-INVENTORY                      VALUE 'N'.   02030088
051705*    05  PV-TO-INVENTORY-IND            PIC X(01)   VALUE 'N'.    02040088
051705*        88  PV-TO-PHYSICAL-COUNT                    VALUE 'Y'.   02050088
051705*        88  PV-TO-FAKE-INVENTORY                    VALUE 'F'.   02060088
051705*        88  PV-TO-NO-INVENTORY                      VALUE 'N'.   02070088
           05  PV-CUR-RTL-AMT                 PIC S9(7)V9(2) COMP-3.    02080068
           05  PV-GP-RTL-AMT                  PIC S9(7)V9(2) COMP-3.    02090068
           05  PV-GP-QTY                      PIC S9(3)V COMP-3.        02100068
051203     05  PV-CHECK-DUMMY-SKU-DEPT-CL.                              02110067
051203         10  PV-DUMMY-SKU-DEPT          PIC 9(03) VALUE ZEROS.    02120068
051203         10  PV-DUMMY-SKU-CL.                                     02130067
051203             15  PV-DUMMY-SKU-CL-1      PIC 9(01) VALUE ZEROS.    02140068
051203             15  PV-DUMMY-SKU-CL-2      PIC 9(01) VALUE ZEROS.    02150068
051203         10  PV-DUMMY-SKU-CL-9 REDEFINES PV-DUMMY-SKU-CL          02160067
051203                                        PIC 9(02).                02170068
051203         10  PV-DUMMY-SKU-000           PIC 9(03) VALUE ZEROS.    02180068
051203     05  PV-HOLD-UPC-NBR.                                         02190068
051203         10  PV-KOHLS-UPC-DIGITS         PIC X(04).               02200068
051203         10  PV-KOHLS-DEPT               PIC X(03).               02210068
051203         10  PV-KOHLS-CL.                                         02220068
051203             15  PV-KOHLS-CL-1           PIC X(01).               02230068
051203             15  PV-KOHLS-CL-2           PIC X(01).               02240068
051203         10  PV-KOHLS-CL-9 REDEFINES PV-KOHLS-CL                  02250068
051203                                         PIC 9(02).               02260068
051203         10  PV-KOHLS-DUMMY-SKU          PIC X(03).               02270068
051203         10  PV-KOHLS-CHECKDIGIT         PIC X(01).               02280068
051203     05  PV-HOLD-UPC-NBR-9 REDEFINES PV-HOLD-UPC-NBR              02290068
051203                                         PIC 9(13).               02300068
051203     05  PV-READ-COUNT                  PIC S9(04) VALUE +0       02310068
051203                                                    COMP SYNC.    02320068
SR3403     05  PV-XFER-PRIC-AMT               PIC  S9(5)V9(2) COMP-3.   02321092
       01  PWT-PROGRAM-WORK-TABLE.                                      02330067
           05  PWT-TABLE.                                               02340067
               10  PWT-ITEM-ENTRIES  OCCURS 8 TIMES.                    02350067
                   15  PWT-QTY-CHECKED-SW     PIC X  VALUE ' '.         02360067
                       88  PWT-QTY-NOT-CHECKED       VALUE ' '.         02370068
                       88  PWT-QTY-CHECKED           VALUE 'Y'.         02380068
                   15  PWT-QTY-ERROR-SW       PIC X  VALUE ' '.         02390067
                       88  PWT-NO-QTY-ERROR          VALUE ' '.         02400068
                       88  PWT-QTY-ERROR             VALUE 'Y'.         02410068
       01  VF-VARCHAR-FIELDS.                                           02420067
           05  VF-VARCHAR-SW                  PIC X(01)  VALUE ' '.     02430067
               88  VF-VARCHAR-BEGIN                      VALUE 'B'.     02440067
               88  VF-VARCHAR-END                        VALUE 'E'.     02450067
           05  VF-VARCHAR-WORK-FIELD.                                   02460067
               10  VF-VARCHAR OCCURS 320 TIMES INDEXED BY VF-IND        02470067
                                              PIC X.                    02480067
      ***************************************************************** 02490067
      **                  SYMBOLIC MAP DESCRIPTION                   ** 02500067
      **                                                             ** 02510067
      **  THE MAPSET FOR THIS PROGRAM CONSISTS OF 3 SEPERATE MAPS.   ** 02520067
      **  2 MAPS WILL BE DISPLAYED AT ONE TIME; THE SPECIFIC MAPS    ** 02530067
      **  DISPLAYED WILL DEPEND ON THE TRANSFER TYPE BEING           ** 02540067
      **  PROCESSED.                                                 ** 02550067
      **  THE MAPS CONTAIN DATA AS FOLLOWS:                          ** 02560067
      **                                                             ** 02570067
      **  A)  COMMON HEADER INFO FOR ALL TRANSFER TYPES.             ** 02580067
      **  B)  DETAIL INFORMATION FOR RETAIL TRANSFERS.               ** 02590067
      **  C)  DETAIL INFORMATION FOR NON-RETAIL TRANSFERS.           ** 02600067
      ***************************************************************** 02610067
       01  MR-MAPSET-REDEFINITION.                                      02620067
           05  MR-A-HEADER.                                             02630067
               10  FILLER                       PIC X(12).              02640068
               10  MR-A-XFER-NBR-L              PIC S9(04)  COMP.       02650067
               10  MR-A-XFER-NBR-A              PIC X(01).              02660068
               10  MR-A-XFER-NBR-C              PIC X(01).              02670068
               10  MR-A-XFER-NBR-H              PIC X(01).              02680068
100404*        10  MR-A-XFER-NBR                PIC X(10).              02690083
100404         10  MR-A-XFER-NBR                PIC X(11).              02691086
                                                                        02700067
           05  MR-B-RTL-DETAIL.                                         02710067
               10  FILLER                       PIC X(12).              02720068
               10  MR-B-SCROLL-AREA OCCURS 8 TIMES.                     02730068
                   15  MR-B-LINE-NBR-L          PIC S9(04) COMP.        02740068
                   15  MR-B-LINE-NBR-A          PIC X(01).              02750068
                   15  MR-B-LINE-NBR-C          PIC X(01).              02760068
                   15  MR-B-LINE-NBR-H          PIC X(01).              02770068
                   15  MR-B-LINE-NBR.                                   02780067
                       20  MR-B-LINE-NBR-N      PIC ZZ9.                02790068
                                                                        02800067
                   15  MR-B-UPC-L               PIC S9(04) COMP.        02810068
                   15  MR-B-UPC-A               PIC X(01).              02820068
                   15  MR-B-UPC-C               PIC X(01).              02830068
                   15  MR-B-UPC-H               PIC X(01).              02840068
                   15  MR-B-UPC.                                        02850067
                       20  MR-B-UPC-N           PIC 9(13).              02860070
                                                                        02870067
                   15  MR-B-QTY-L               PIC S9(04) COMP.        02880068
                   15  MR-B-QTY-A               PIC X(01).              02890068
                   15  MR-B-QTY-C               PIC X(01).              02900068
                   15  MR-B-QTY-H               PIC X(01).              02910068
                   15  MR-B-QTY.                                        02920067
                       20  MR-B-QTY-N           PIC Z(03).              02930068
                                                                        02940067
                   15  MR-B-PRICE-L             PIC S9(04) COMP.        02950068
                   15  MR-B-PRICE-A             PIC X(01).              02960068
                   15  MR-B-PRICE-C             PIC X(01).              02970068
                   15  MR-B-PRICE-H             PIC X(01).              02980068
                   15  MR-B-PRICE.                                      02990067
SR3403                 20  MR-B-PRICE-N         PIC ZZZZZ.99.           03001091
                                                                        03010067
               10  MR-B-USERID-L                PIC S9(04) COMP.        03020068
               10  MR-B-USERID-A                PIC X(01).              03030068
               10  MR-B-USERID-C                PIC X(01).              03040068
               10  MR-B-USERID-H                PIC X(01).              03050068
               10  MR-B-USERID                  PIC X(08).              03060068
                                                                        03070067
               10  MR-B-COMMENTS-AREA OCCURS 4 TIMES.                   03080067
                   15  MR-B-COMMENT-L           PIC S9(04) COMP.        03090068
                   15  MR-B-COMMENT-A           PIC X(01).              03100068
                   15  MR-B-COMMENT-C           PIC X(01).              03110068
                   15  MR-B-COMMENT-H           PIC X(01).              03120068
                   15  MR-B-COMMENT             PIC X(79).              03130068
                                                                        03140067
           05  MR-C-NRTL-DETAIL.                                        03150067
               10  FILLER                       PIC X(12).              03160068
               10  MR-C-SCROLL-AREA OCCURS 8 TIMES.                     03170068
                   15  MR-C-LINE-NBR-L          PIC S9(04) COMP.        03180068
                   15  MR-C-LINE-NBR-A          PIC X(01).              03190068
                   15  MR-C-LINE-NBR-C          PIC X(01).              03200068
                   15  MR-C-LINE-NBR-H          PIC X(01).              03210068
                   15  MR-C-LINE-NBR.                                   03220067
                       20  MR-C-LINE-NBR-N      PIC ZZ9.                03230068
                                                                        03240067
                   15  MR-C-DESC-L              PIC S9(04) COMP.        03250068
                   15  MR-C-DESC-A              PIC X(01).              03260068
                   15  MR-C-DESC-C              PIC X(01).              03270068
                   15  MR-C-DESC-H              PIC X(01).              03280068
                   15  MR-C-DESC                PIC X(40).              03290068
                                                                        03300067
                   15  MR-C-FIXTURE-L           PIC S9(04) COMP.        03310068
                   15  MR-C-FIXTURE-A           PIC X(01).              03320068
                   15  MR-C-FIXTURE-C           PIC X(01).              03330068
                   15  MR-C-FIXTURE-H           PIC X(01).              03340068
                   15  MR-C-FIXTURE             PIC X(20).              03350068
                                                                        03360067
                   15  MR-C-DEPT-L              PIC S9(04) COMP.        03370068
                   15  MR-C-DEPT-A              PIC X(01).              03380068
                   15  MR-C-DEPT-C              PIC X(01).              03390068
                   15  MR-C-DEPT-H              PIC X(01).              03400068
                   15  MR-C-DEPT                PIC X(03).              03410068
                                                                        03420067
                   15  MR-C-QTY-L               PIC S9(04) COMP.        03430068
                   15  MR-C-QTY-A               PIC X(01).              03440068
                   15  MR-C-QTY-C               PIC X(01).              03450068
                   15  MR-C-QTY-H               PIC X(01).              03460068
                   15  MR-C-QTY.                                        03470067
                       20  MR-C-QTY-N           PIC  9(03).             03480068
                                                                        03490067
       01  MD-MAP-DATA-AREA                     PIC X(3000).            03500068
      ***************************************************************** 03510067
      **COPYBOOKS                                                       03520067
      ***************************************************************** 03530067
      **ATTRIBUTE SETTINGS COPYBOOK                                     03540067
           COPY DPWS015.                                                03550079
      **FUNCTION KEYS COPYBOOK                                          03560067
           COPY DPWS016.                                                03570079
      **NUMERIC EDIT LAYOUT                                             03580067
           COPY DPWS010I.                                               03590079
      **PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.               03600097
           COPY DPWS030.                                                03610079
CICS       COPY DPWS930.                                                03611097
      **STANDARD COMMAREA                                               03620067
           COPY DPWS020.                                                03630079
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03640067
      *---------------------------------------------------------------* 03650067
      * INTER-APPLICATION COMMAREA.                                   * 03660067
      *   TFWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE          * 03670067
      *             ITEM INQUIRY SCREEN.                              * 03680067
      *---------------------------------------------------------------* 03690067
               10  INTER-APPL-COMM-AREA       PIC X(200).               03700067
           COPY TFWS001.                                                03710079
      *---------------------------------------------------------------* 03720067
      *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03730067
      *---------------------------------------------------------------* 03740067
               10  ASC-SPECIFIC-COMMAREA.                               03750067
                   15  ASC-XFER-SEQ-NBR                    PIC  S9(09)  03760067
                                                                COMP.   03770067
                   15  ASC-XFER-DKEY-ID                    PIC  S9(09)  03780067
                                                                COMP.   03790067
                   15  ASC-XFER-TYPE                       PIC  X(02).  03800067
                       88  ASC-NON-RETAIL-XFER             VALUE '06'.  03810067
                       88  ASC-RETAIL-XFER                 VALUE        03820067
111703*                                          '01' THRU '05', '07'.  03830079
111703                                           '00' THRU '05', '07'.  03831079
100404*            15  ASC-FR-STORE-NBR                    PIC  9(03).  03840083
100404             15  ASC-FR-STORE-NBR                    PIC  9(04).  03841086
100404*            15  ASC-TO-STORE-NBR                    PIC  9(03).  03850083
100404             15  ASC-TO-STORE-NBR                    PIC  9(04).  03851086
                   15  ASC-CONTNR-TYP-CDE                  PIC  X(02).  03860067
                   15  ASC-MAX-LINE-NBR               PIC S9(04)  COMP. 03870067
                   15  ASC-ERROR-SW                      PIC  X(01).    03880067
                       88  ASC-NO-ERROR                   VALUE 'N'.    03890067
                       88  ASC-ERROR                      VALUE 'Y'.    03900067
                   15  ASC-ADD-REQUEST-SW                  PIC  X(01).  03910067
                       88  ASC-ADD-REQUEST                 VALUE 'Y'.   03920067
                       88  ASC-NO-ADD-REQUEST              VALUE 'N'.   03930067
                   15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03940067
                       88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03950067
                       88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03960067
                   15  ASC-NBR-OF-LINES-ENTERED          PIC S9(03)     03970067
                                                              COMP-3.   03980067
                   15  ASC-ITEM-SUB                      PIC S9(04)     03990067
                                                         COMP SYNC.     04000067
                   15  ASC-RCV-STR-NBR                   PIC S9(04)     04010067
                                                         COMP SYNC.     04020067
                   15  ASC-RECEIPT-TIMESTAMP             PIC X(26).     04030067
                   15  ASC-COMMENT-ARRAY.                               04040067
                       20  ASC-COMMENT OCCURS 4 TIMES  PIC X(79).       04050067
                   15  ASC-NON-RETAIL-ITEM-ARRAY.                       04060067
                       20  ASC-NON-RETAIL-ENTRIES OCCURS 8 TIMES.       04070067
                           25  ASC-ITEM-DESC.                           04080067
                               30  ASC-ITEM-DESC1        PIC X(20).     04090067
                               30  ASC-ITEM-DESC2        PIC X(20).     04100067
                           25  ASC-NRTL-DEPT             PIC  X(03).    04110067
                           25  ASC-FIXTURE               PIC  X(20).    04120067
                           25  ASC-NRTL-QTY              PIC X(03).     04130067
                           25  ASC-NRTL-QTY-N REDEFINES     ASC-NRTL-QTY04140067
                                                         PIC 9(03).     04150067
                           25  ASC-NRTL-ITEM-UPDATED-SW PIC X(01).      04160067
                               88  ASC-NRTL-ITEM-UPDATED    VALUE 'Y'.  04170067
                               88  ASC-NRTL-ITEM-NOT-UPDATED VALUE ' '. 04180067
                   15  ASC-RETAIL-ITEM-ARRAY                            04190067
                           REDEFINES ASC-NON-RETAIL-ITEM-ARRAY.         04200067
                       20  ASC-RETAIL-ENTRIES OCCURS 8 TIMES.           04210067
                           25  FILLER                    PIC  X(16).    04220067
                           25  ASC-UPC                   PIC  X(13).    04230067
051203                     25  ASC-UPC-X REDEFINES ASC-UPC.             04240068
051203                         30  ASC-UPC-DIGITS-1-8  PIC X(08).       04250068
051203                         30  ASC-UPC-DIGITS-9-13 PIC X(05).       04260068
051203                     25  ASC-UPC-XX REDEFINES ASC-UPC.            04270068
051203                         30  ASC-UPC-DIGITS-1-5  PIC X(05).       04280068
051203                         30  ASC-UPC-DIGITS-6-13 PIC X(08).       04290068
                           25  ASC-UPC-XXX REDEFINES ASC-UPC.           04291078
                               30  ASC-KOHLS-UPC-DIGITS PIC X(04).      04292078
                               30  ASC-KOHLS-DEPT       PIC X(03).      04293078
                               30  FILLER               PIC X(02).      04294078
                               30  ASC-KOHLS-DUMMY-SKU  PIC X(03).      04295078
                               30  FILLER               PIC X(01).      04296078
                           25  ASC-UPC-N REDEFINES ASC-UPC              04300067
                                                         PIC  9(13).    04310067
                           25  ASC-KOHLS-UPC             PIC S9(15)     04320067
                                                         COMP-3.        04330067
                           25  ASC-ITEM-NBR              PIC S9(15)     04340067
                                                         COMP-3.        04350067
SR3403                     25  ASC-PRICE                 PIC X(08).     04361090
SR3403                     25  ASC-PRICE-N REDEFINES ASC-PRICE          04381090
SR3403                                                   PIC  9(06)V99. 04382090
                           25  ASC-FILE-PRICE            PIC S9(05)V99  04390067
                                                         COMP-3.        04400067
                           25  ASC-RTL-QTY               PIC X(03).     04410067
                           25  ASC-RTL-QTY-N REDEFINES ASC-RTL-QTY      04420067
                                                         PIC  9(03).    04430067
                           25  ASC-CALLBACK-PRICE-SW PIC X(01).         04440067
                               88  ASC-VALID-PRICE          VALUE 'Y'.  04450067
                               88  ASC-INVALID-PRICE        VALUE 'N'.  04460067
                           25  ASC-RTL-ITEM-UPDATED-SW PIC X(01).       04470067
                               88  ASC-RTL-ITEM-UPDATED     VALUE 'Y'.  04480067
                               88  ASC-RTL-ITEM-NOT-UPDATED VALUE ' '.  04490067
                           25  ASC-GROUP-PRICED-SW         PIC X(01).   04500067
                               88  ASC-GROUP-PRICED-ITEM    VALUE 'Y'.  04510067
                               88  ASC-NOT-GROUP-PRICED-ITEM            04520067
                                                            VALUE 'N'.  04530067
                                                                        04540067
      **ABEND PROCESSING COPYBOOK                                       04550067
           COPY DPWS013.                                                04560079
      **UPC PARAMETER LIST FOR CALLING THE UPC CHECK DIGIT ROUTINE.     04570067
           COPY DPWS040I.                                               04580079
      ***************************************************************** 04590067
      **TABLE INCLUSIONS                                                04600067
      ***************************************************************** 04610067
      **DB2 AREA FOR TRANSFER TABLE                                     04620067
           EXEC SQL                                                     04630067
                INCLUDE TTFMSTR                                         04640067
           END-EXEC.                                                    04650067
      **DB2 AREA FOR TRANSFER RECEIPT TABLE                             04660067
           EXEC SQL                                                     04670067
                INCLUDE TTFRCPT                                         04680067
           END-EXEC.                                                    04690067
      **DB2 AREA FOR TRANSFER ITEM TABLE                                04700067
           EXEC SQL                                                     04710067
                INCLUDE TTFITEM                                         04720067
           END-EXEC.                                                    04730067
      **DB2 AREA FOR TRANSFER ITEM RECEIPT                              04740067
           EXEC SQL                                                     04750067
                INCLUDE TTFITRC                                         04760067
           END-EXEC.                                                    04770067
      **DB2 AREA FOR TRANSFER ITEM POSTING TABLE                        04780067
           EXEC SQL                                                     04790067
                INCLUDE TTFITPS                                         04800067
           END-EXEC.                                                    04810067
      **DB2 AREA FOR TRANSFER STATUS TABLE                              04820067
           EXEC SQL                                                     04830067
                INCLUDE TTFSTAT                                         04840067
           END-EXEC.                                                    04850067
      **DB2 AREA FOR TRANSFER TYPE TABLE                                04860067
           EXEC SQL                                                     04870067
                INCLUDE TTFTYCD                                         04880067
           END-EXEC.                                                    04890067
      **DB2 AREA FOR TRANSFER CONTAINER TYPE TABLE                      04900067
           EXEC SQL                                                     04910067
                INCLUDE TTFSHCT                                         04920067
           END-EXEC.                                                    04930067
      **DB2 AREA FOR XST_SKU_LOC TABLE                                  04975084
           EXEC SQL                                                     04976084
                INCLUDE XST00008                                        04977084
           END-EXEC.                                                    04978084
      **DB2 AREA FOR XST_SKU TABLE                                      04978184
           EXEC SQL                                                     04978284
                INCLUDE XST00010                                        04978384
           END-EXEC.                                                    04978484
      **DB2 AREA FOR XST_UPC TABLE                                      04979084
           EXEC SQL                                                     04979184
                INCLUDE XST00012                                        04979284
           END-EXEC.                                                    04979384
      **DB2 AREA FOR PERMANENT PRICE CHANGE HISTORY TABLE               05140067
           EXEC SQL                                                     05150067
               INCLUDE TPPCPRC                                          05160067
           END-EXEC.                                                    05170067
051705**DB2 AREA FOR TRANSFER CONTROL TABLE                             05220088
051705*    EXEC SQL                                                     05230088
051705*         INCLUDE TTFCNTL                                         05240088
051705*    END-EXEC.                                                    05250088
051705**DB2 AREA FOR INVENTORY PARAMETERS TABLE                         05260088
051705*    EXEC SQL                                                     05270088
051705*         INCLUDE TINVPAR                                         05280088
051705*    END-EXEC.                                                    05290088
051203**DB2 AREA FOR SKU CROSS REFERENCE TABLE                          05300068
051203     EXEC SQL                                                     05310068
051203          INCLUDE TSKXREF                                         05320068
051203     END-EXEC.                                                    05330068
      **DB2 AREA FOR COMMUNICATIONS                                     05340067
           EXEC SQL                                                     05350067
                INCLUDE SQLCA                                           05360067
           END-EXEC.                                                    05370067
                                                                        05380067
       LINKAGE SECTION.                                                 05390067
      ******************************************************************05400067
       01  DFHCOMMAREA.                                                 05410067
           05  FILLER OCCURS  1 TO 4072 TIMES DEPENDING ON EIBCALEN.    05420067
               10  FILLER                     PIC X.                    05430067
                                                                        05440067
       PROCEDURE DIVISION.                                              05450067
      ******************************************************************05460067
      **  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05470067
      **  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05480067
      **  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05490067
      ******************************************************************05500067
       0000-MAIN-MODULE.                                                05510067
                                                                        05520067
           INITIALIZE DP030-CICS-API-FIELDS.                            05530067
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05540067
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05550067
           MOVE +2                       TO DP030-NUMBER-OF-MAPS.       05560067
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05570067
           PERFORM 0001-CALL-CICS-ARCH-API.                             05580067
                                                                        05590067
           MOVE 1                      TO PV-MAP-START-BYTE.            05600067
           MOVE LENGTH OF MR-A-HEADER  TO DP030-MAP-LENGTH (1).         05610067
           MOVE MD-MAP-DATA-AREA                                        05620067
                          (PV-MAP-START-BYTE:DP030-MAP-LENGTH (1))      05630067
                                       TO MR-A-HEADER.                  05640067
           ADD DP030-MAP-LENGTH (1)    TO PV-MAP-START-BYTE.            05650067
                                                                        05660067
           IF  ASC-XFER-TYPE NOT = PC-NON-RETAIL                        05670067
               MOVE LENGTH OF MR-B-RTL-DETAIL TO DP030-MAP-LENGTH (2)   05680067
               MOVE MD-MAP-DATA-AREA                                    05690067
                   (PV-MAP-START-BYTE:DP030-MAP-LENGTH (2))             05700067
                                              TO MR-B-RTL-DETAIL        05710067
               ADD DP030-MAP-LENGTH (2)       TO PV-MAP-START-BYTE      05720067
           ELSE                                                         05730067
               MOVE LENGTH OF MR-C-NRTL-DETAIL TO DP030-MAP-LENGTH (2)  05740067
               MOVE MD-MAP-DATA-AREA                                    05750067
                      (PV-MAP-START-BYTE:DP030-MAP-LENGTH (2))          05760067
                                               TO MR-C-NRTL-DETAIL      05770067
               ADD DP030-MAP-LENGTH (2)        TO PV-MAP-START-BYTE     05780067
           END-IF.                                                      05790067
                                                                        05800067
           PERFORM 1000-CONTROL-PROCESSING                              05810067
                                                                        05820067
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05830067
           PERFORM 0001-CALL-CICS-ARCH-API.                             05840067
                                                                        05850067
       EJECT.                                                           05860067
      ******************************************************************05870067
      **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05880067
      **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05890067
      ******************************************************************05900067
       0001-CALL-CICS-ARCH-API.                                         05910067
                                                                        05920067
           MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH.           05930067
                                                                        05940067
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05950097
                                          DFHCOMMAREA                   05960097
                                          DP030-CICS-API-FIELDS         05970097
                                          DP020-STANDARD-COMMAREA       05980097
                                          MD-MAP-DATA-AREA.             05990097
                                                                        06000067
           IF  DP030-RC-CALL-SUCCESSFUL                                 06010067
               CONTINUE                                                 06020067
           ELSE                                                         06030067
               SET DP013-NO-ROLLBACK                                    06040067
                   DP013-XCTL-DISPLAY-RESTART                           06050067
                   DP013-CICS-ABEND      TO TRUE                        06060067
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06061097
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06062097
               MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06090067
               PERFORM DP013-0000-PROCESS-ABEND                         06100067
           END-IF.                                                      06110067
                                                                        06120067
       EJECT.                                                           06130067
      *----------------------------------------------------------------*06140067
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06150067
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06160067
      *----------------------------------------------------------------*06170067
       1000-CONTROL-PROCESSING.                                         06180067
                                                                        06190067
           MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH.           06200067
                                                                        06210067
           EVALUATE TRUE                                                06220067
               WHEN DP020-NEXT-ACT-INITIAL                              06230067
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     06240067
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                 06250067
                   PERFORM 7100-SELECT-RCPT-TMST                        06260067
                   INITIALIZE TF001-INTER-APPL-COMMAREA                 06270067
      ***-----$TEMPLATE NOTE$-------------------------------------------06280067
      *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06290067
      *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06300067
      *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06310067
      ***---------------------------------------------------------------06320067
                   IF  PS-COMMAREA-NOT-VALID                            06330067
                       SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            06340067
                   ELSE                                                 06350067
051705*                SET PS-NO-INVENTORY-ERROR  TO TRUE               06360088
051705*                IF ASC-XFER-TYPE NOT = PC-NON-RETAIL  AND        06370088
051705*                   ASC-XFER-TYPE NOT = PC-OFFSITE-STORAGE        06380088
051705*                    PERFORM 4300-CHECK-INVENTORY-CUTOFF          06390088
051705*                END-IF                                           06400088
051705*                IF PS-NO-INVENTORY-ERROR                         06410088
                           PERFORM 4000-BUILD-INITIAL-PANEL             06420067
051705*                END-IF                                           06430088
                   END-IF                                               06440067
               WHEN DP020-NEXT-ACT-READ-MAP                             06450067
                   PERFORM 2000-PROCESS-PANEL                           06460067
               WHEN DP020-NEXT-ACT-RETURN                               06470067
                   SET ASC-NO-ADD-REQUEST TO TRUE                       06480067
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06490067
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06500067
               WHEN OTHER                                               06510067
                   SET DP013-LOGIC-ABEND TO TRUE                        06520067
                   SET DP013-NO-ROLLBACK TO TRUE                        06530067
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06540067
                                         TO DP013-MESSAGE-TEXT(1)       06550067
                   PERFORM DP013-0000-PROCESS-ABEND                     06560067
           END-EVALUATE.                                                06570067
                                                                        06580067
       EJECT.                                                           06590067
      *----------------------------------------------------------------*06600067
      * DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA FROM  *06610067
      * THE WORKSHEET SETUP PROGRAM OR FROM THE CRITERIA SPEC.         *06620067
      *----------------------------------------------------------------*06630067
       1100-PROCESS-INTER-APPL-COMM.                                    06640067
                                                                        06650067
           SET PS-COMMAREA-VALID         TO TRUE.                       06660067
           MOVE TF001-DKEY-ID            TO DK-XFER-DKEY-ID             06670067
                                            ASC-XFER-DKEY-ID.           06680067
           PERFORM 6000-GET-TRANSFER-INFO.                              06690067
                                                                        06700067
       EJECT.                                                           06710067
      *----------------------------------------------------------------*06720067
      * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06730067
      * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06740067
      * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06750067
      * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06760067
      * FUNCTION KEYS CAN GET THIS FAR.                                *06770067
      *----------------------------------------------------------------*06780067
       2000-PROCESS-PANEL.                                              06790067
                                                                        06800067
           EVALUATE TRUE                                                06810067
               WHEN DP020-SRC-AID = DP016-ENTER                         06820067
                   SET ASC-NO-ADD-REQUEST TO TRUE                       06830067
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06840067
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06850067
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06860067
               WHEN DP020-SRC-AID = DP016-CLEAR                         06870067
                   SET ASC-NO-ADD-REQUEST TO TRUE                       06880067
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06890067
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06900067
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06910067
                   SET ASC-NO-ADD-REQUEST TO TRUE                       06920067
                   PERFORM 4000-BUILD-INITIAL-PANEL                     06930067
               WHEN OTHER                                               06940067
                   PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06950067
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06960067
                   IF  ASC-NO-ERROR                                     06970067
                       SET DP030-CONTINUE-GO TO TRUE                    06980067
                       PERFORM 2100-CHECK-FUNCTION-KEY                  06990067
                   ELSE                                                 07000067
                       SET DP030-OVERRIDE-GO TO TRUE                    07010067
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07020067
                   END-IF                                               07030067
           END-EVALUATE.                                                07040067
                                                                        07050067
       EJECT.                                                           07060067
      *----------------------------------------------------------------*07070067
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07080067
      * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07090067
      * CICS ARCHITECTURE API.                                         *07100067
      *----------------------------------------------------------------*07110067
       2100-CHECK-FUNCTION-KEY.                                         07120067
                                                                        07130067
           MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH.           07140067
                                                                        07150067
           EVALUATE TRUE                                                07160067
      *---  ADD ITM  -----------------------------------------------*   07170067
               WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07180067
                   IF ASC-ADD-REQUEST                                   07190067
                       PERFORM 7000-ADD-ITEMS                           07200067
                       INITIALIZE TF001-INTER-APPL-COMMAREA             07210067
                       SET TF001-ADD-ITEM    TO TRUE                    07220067
                   ELSE                                                 07230067
                       SET ASC-ADD-REQUEST TO TRUE                      07240067
                       MOVE PC-TSYMSG-01403  TO DP020-MSG-NUMBER        07250067
                       MOVE 'F13-ADD ITM'    TO DP020-MSG-TEXT          07260067
                       SET DP020-MSG-INFORMATIONAL TO TRUE              07270067
                       SET DP030-SET-CURSOR-APPL-2   TO TRUE            07280067
                       SET DP030-OVERRIDE-GO      TO TRUE               07290067
                       IF ASC-XFER-TYPE NOT = PC-NON-RETAIL             07300067
                           MOVE -1           TO MR-B-UPC-L (1)          07310067
                       ELSE                                             07320067
                           MOVE -1           TO MR-C-DESC-L (1)         07330067
                       END-IF                                           07340067
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07350067
                   END-IF                                               07360067
               WHEN OTHER                                               07370067
                   SET DP013-NO-ROLLBACK                                07380067
                       DP013-XCTL-DISPLAY-RESTART                       07390067
                       DP013-CICS-ABEND  TO TRUE                        07400067
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07410067
                                         TO DP013-MESSAGE-TEXT (1)      07420067
                   PERFORM DP013-0000-PROCESS-ABEND                     07430067
           END-EVALUATE.                                                07440067
                                                                        07450067
       EJECT.                                                           07460067
      ******************************************************************07470067
      ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **07480067
      ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **07490067
      ******************************************************************07500067
       2200-MOVE-SCREEN-TO-COMMAREA.                                    07510067
                                                                        07520067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                         07530067
               PERFORM VARYING PV-SUB                                   07540067
                       FROM 1 BY 1                                      07550067
                       UNTIL PV-SUB > 4                                 07560067
                    IF  MR-B-COMMENT-L (PV-SUB) > ZERO                  07570067
                        MOVE MR-B-COMMENT (PV-SUB)                      07580067
                                              TO ASC-COMMENT (PV-SUB)   07590067
                    ELSE                                                07600067
                        IF  MR-B-COMMENT-A (PV-SUB) = DP015-ERASE-EOF   07610067
                            MOVE SPACE        TO ASC-COMMENT (PV-SUB)   07620067
                        END-IF                                          07630067
                    END-IF                                              07640067
               END-PERFORM                                              07650067
               PERFORM 2210-MOVE-RTL-TO-COMMAREA                        07660067
                       VARYING ASC-ITEM-SUB                             07670067
                       FROM 1 BY 1                                      07680067
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07690067
           ELSE                                                         07700067
               PERFORM 2220-MOVE-NRTL-TO-COMMAREA                       07710067
                       VARYING ASC-ITEM-SUB                             07720067
                       FROM 1 BY 1                                      07730067
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          07740067
           END-IF.                                                      07750067
                                                                        07760067
       EJECT.                                                           07770067
      ******************************************************************07780067
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**07790067
      ** FOR RETAIL TRANSFER TYPES.                                   **07800067
      ******************************************************************07810067
       2210-MOVE-RTL-TO-COMMAREA.                                       07820067
                                                                        07830067
           IF  MR-B-UPC-L (ASC-ITEM-SUB) > ZERO                         07840067
               MOVE MR-B-UPC-N (ASC-ITEM-SUB) TO ASC-UPC (ASC-ITEM-SUB) 07850067
           ELSE                                                         07860067
               IF  MR-B-UPC-A (ASC-ITEM-SUB) = DP015-ERASE-EOF          07870067
                       MOVE SPACE        TO ASC-UPC (ASC-ITEM-SUB)      07880067
               END-IF                                                   07890067
           END-IF.                                                      07900067
           IF  MR-B-PRICE-L (ASC-ITEM-SUB) > ZERO                       07910067
               MOVE MR-B-PRICE (ASC-ITEM-SUB)                           07920067
                                         TO ASC-PRICE (ASC-ITEM-SUB)    07930067
           ELSE                                                         07940067
               IF  MR-B-PRICE-A (ASC-ITEM-SUB) = DP015-ERASE-EOF        07950067
                       MOVE LOW-VALUES   TO ASC-PRICE (ASC-ITEM-SUB)    07960067
               END-IF                                                   07970067
           END-IF.                                                      07980067
           IF  MR-B-QTY-L (ASC-ITEM-SUB) > ZERO                         07990067
               MOVE MR-B-QTY (ASC-ITEM-SUB)                             08000067
                                         TO ASC-RTL-QTY (ASC-ITEM-SUB)  08010067
           ELSE                                                         08020067
               IF  MR-B-QTY-A (ASC-ITEM-SUB) = DP015-ERASE-EOF          08030067
                       MOVE LOW-VALUES   TO ASC-RTL-QTY (ASC-ITEM-SUB)  08040067
               END-IF                                                   08050067
           END-IF.                                                      08060067
                                                                        08070067
       EJECT.                                                           08080067
      ******************************************************************08090067
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**08100067
      ** FOR NON-RETAIL TRANSFER TYPES.                               **08110067
      ******************************************************************08120067
       2220-MOVE-NRTL-TO-COMMAREA.                                      08130067
                                                                        08140067
           IF  MR-C-DESC-L (ASC-ITEM-SUB) > ZERO                        08150067
               MOVE MR-C-DESC (ASC-ITEM-SUB)                            08160067
                                         TO ASC-ITEM-DESC (ASC-ITEM-SUB)08170067
           ELSE                                                         08180067
               IF  MR-C-DESC-A (ASC-ITEM-SUB) = DP015-ERASE-EOF         08190067
                       MOVE SPACE        TO ASC-ITEM-DESC (ASC-ITEM-SUB)08200067
               END-IF                                                   08210067
           END-IF.                                                      08220067
                                                                        08230067
           IF  MR-C-FIXTURE-L (ASC-ITEM-SUB) > ZERO                     08240067
               MOVE MR-C-FIXTURE (ASC-ITEM-SUB)                         08250067
                                         TO ASC-FIXTURE (ASC-ITEM-SUB)  08260067
           ELSE                                                         08270067
               IF  MR-C-FIXTURE-A (ASC-ITEM-SUB) = DP015-ERASE-EOF      08280067
                       MOVE SPACE        TO ASC-FIXTURE (ASC-ITEM-SUB)  08290067
               END-IF                                                   08300067
           END-IF.                                                      08310067
                                                                        08320067
           IF  MR-C-DEPT-L (ASC-ITEM-SUB) > ZERO                        08330067
               MOVE MR-C-DEPT (ASC-ITEM-SUB)                            08340067
                                         TO ASC-NRTL-DEPT (ASC-ITEM-SUB)08350067
           ELSE                                                         08360067
               IF  MR-C-DEPT-A (ASC-ITEM-SUB) = DP015-ERASE-EOF         08370067
                       MOVE SPACE        TO ASC-NRTL-DEPT (ASC-ITEM-SUB)08380067
               END-IF                                                   08390067
           END-IF.                                                      08400067
                                                                        08410067
           IF  MR-C-QTY-L (ASC-ITEM-SUB) > ZERO                         08420067
               MOVE MR-C-QTY (ASC-ITEM-SUB)                             08430067
                                         TO ASC-NRTL-QTY (ASC-ITEM-SUB) 08440067
           ELSE                                                         08450067
               IF  MR-C-QTY-A (ASC-ITEM-SUB) = DP015-ERASE-EOF          08460067
                       MOVE SPACE        TO ASC-NRTL-QTY (ASC-ITEM-SUB) 08470067
               END-IF                                                   08480067
           END-IF.                                                      08490067
                                                                        08500067
       EJECT.                                                           08510067
      ******************************************************************08520067
      ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **08530067
      ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **08540067
      ******************************************************************08550067
       3000-EDIT-DATA-IN-COMMAREA.                                      08560067
                                                                        08570067
           SET ASC-NO-ERROR              TO TRUE.                       08580067
           MOVE +0                       TO ASC-NBR-OF-LINES-ENTERED.   08590067
           PERFORM 3200-RESET-ATTRIBUTES.                               08600067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                         08610067
               PERFORM 3400-EDIT-RTL-DETAIL-INFO                        08620067
                       VARYING ASC-ITEM-SUB                             08630067
                       FROM 1 BY 1                                      08640067
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08650067
           ELSE                                                         08660067
               PERFORM 3450-EDIT-NRTL-DETAIL-INFO                       08670067
                       VARYING ASC-ITEM-SUB                             08680067
                       FROM 1 BY 1                                      08690067
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          08700067
           END-IF.                                                      08710067
                                                                        08720067
           IF ASC-NBR-OF-LINES-ENTERED = 0 AND ASC-NO-ERROR             08730067
                MOVE PC-TSYMSG-00308       TO DP020-MSG-NUMBER          08740067
                SET DP020-MSG-FATAL                                     08750067
                    ASC-ERROR              TO TRUE                      08760067
                SET DP030-SET-CURSOR-APPL-2   TO TRUE                   08770067
                IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                    08780067
                    MOVE -1                TO MR-B-UPC-L (1)            08790067
                ELSE                                                    08800067
                    MOVE -1                TO MR-C-DESC-L (1)           08810067
                END-IF                                                  08820067
           END-IF.                                                      08830067
      ******************************************************************08840067
      ** IF NO OTHER EDIT ERRORS, CHECK FOR MAXIMUM QTY EXCEEDED.     **08850067
      ******************************************************************08860067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL AND ASC-NO-ERROR        08870067
               INITIALIZE PWT-PROGRAM-WORK-TABLE                        08880067
               PERFORM 3460-EDIT-RTL-QTY                                08890067
                       VARYING PV-ITEM                                  08900067
                       FROM 1 BY 1 UNTIL PV-ITEM > PC-ITEMS-PER-PANEL   08910067
      ******************************************************************08920067
      ** IF THERE ARE MAXIMUM QTY ERRORS, FIND THE FIRST OCCURANCE    **08930067
      ** SO THE PROPER SCREEN CAN BE DISPLAYED WITH ERRORS.           **08940067
      ******************************************************************08950067
               IF ASC-ERROR                                             08960067
                   SET PS-QTY-ERROR-NOT-FOUND     TO TRUE               08970067
                   PERFORM 3480-CHECK-FOR-QTY-ERROR                     08980067
                           VARYING PV-ITEM                              08990067
                           FROM 1 BY 1 UNTIL                            09000067
                           (PV-ITEM > PC-ITEMS-PER-PANEL OR             09010067
                             PS-QTY-ERROR-FOUND)                        09020067
                   IF PS-QTY-ERROR-FOUND                                09030067
                       MOVE DP015-RED             TO MR-B-QTY-C         09040067
                                        (PV-HOLD-ITEM)                  09050067
                       MOVE DP015-REVERSE         TO MR-B-QTY-H         09060067
                                        (PV-HOLD-ITEM)                  09070067
                       MOVE PC-TSYMSG-01543   TO DP020-MSG-NUMBER       09080067
                       SET DP020-MSG-FATAL    TO TRUE                   09090067
                       MOVE -1                TO MR-B-QTY-L             09100067
                                        (PV-HOLD-ITEM)                  09110067
                       SET DP030-SET-CURSOR-APPL-2   TO TRUE            09120067
      ******************************************************************09130067
      ** TEST THE REST OF THE ITEMS TO HIGHLIGHT ANY ADDITIONAL QTY   **09140067
      ** ERROR FIELDS.                                                **09150067
      ******************************************************************09160067
                       PERFORM VARYING PV-ITEM2                         09170067
                               FROM PV-HOLD-ITEM BY 1 UNTIL             09180067
                               PV-ITEM2 > PC-ITEMS-PER-PANEL            09190067
                           IF PWT-QTY-ERROR (PV-ITEM2)                  09200067
                               MOVE DP015-RED TO MR-B-QTY-C (PV-ITEM2)  09210067
                               MOVE DP015-REVERSE TO MR-B-QTY-H         09220067
                                                            (PV-ITEM2)  09230067
                           END-IF                                       09240067
                       END-PERFORM                                      09250067
                   END-IF                                               09260067
               END-IF                                                   09270067
           END-IF.                                                      09280067
                                                                        09290067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL AND ASC-NO-ERROR        09300067
               IF ASC-COMMENT-ARRAY NOT > SPACES                        09310067
                   MOVE -1                     TO MR-B-COMMENT-L (1)    09320067
                   MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      09330067
                   SET DP020-MSG-FATAL                                  09340067
                       ASC-ERROR                                        09350067
                       DP030-SET-CURSOR-APPL-2 TO TRUE                  09360067
               END-IF                                                   09370067
           END-IF.                                                      09380067
                                                                        09390067
           IF ASC-NO-ERROR                                              09400067
               SET PS-VALID-PRICE               TO TRUE                 09410067
               PERFORM VARYING ASC-ITEM-SUB                             09420067
                       FROM 1 BY 1 UNTIL                                09430067
                     ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  09440067
                   IF ASC-INVALID-PRICE    (ASC-ITEM-SUB)               09450067
                       SET PS-INVALID-PRICE     TO TRUE                 09460067
                       MOVE DP015-YELLOW  TO MR-B-UPC-C (ASC-ITEM-SUB)  09470067
                                             MR-B-PRICE-C (ASC-ITEM-SUB)09480067
                       MOVE DP015-REVERSE TO MR-B-UPC-H (ASC-ITEM-SUB)  09490067
                                             MR-B-PRICE-H (ASC-ITEM-SUB)09500067
                   END-IF                                               09510067
               END-PERFORM                                              09520067
                                                                        09530067
               IF PS-INVALID-PRICE                                      09540067
                   MOVE PC-TSYMSG-01486         TO DP020-MSG-NUMBER     09550067
                   SET DP020-MSG-INFORMATIONAL  TO TRUE                 09560067
               END-IF                                                   09570067
           END-IF.                                                      09580067
                                                                        09590067
       EJECT.                                                           09600067
      ******************************************************************09610067
      ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **09620067
      ******************************************************************09630067
       3200-RESET-ATTRIBUTES.                                           09640067
                                                                        09650067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                         09660067
               MOVE DP015-UNP-ALP-NOR-OFF  TO MR-B-COMMENT-A (1)        09670067
                                              MR-B-COMMENT-A (2)        09680067
                                              MR-B-COMMENT-A (3)        09690067
                                              MR-B-COMMENT-A (4)        09700067
               MOVE DP015-GREEN            TO MR-B-COMMENT-C (1)        09710067
                                              MR-B-COMMENT-C (2)        09720067
                                              MR-B-COMMENT-C (3)        09730067
                                              MR-B-COMMENT-C (4)        09740067
               MOVE DP015-UNDERLINE        TO MR-B-COMMENT-H (1)        09750067
                                              MR-B-COMMENT-H (2)        09760067
                                              MR-B-COMMENT-H (3)        09770067
                                              MR-B-COMMENT-H (4)        09780067
             PERFORM VARYING PV-SUB                                     09790067
                     FROM 1 BY 1                                        09800067
                     UNTIL PV-SUB > PC-ITEMS-PER-PANEL                  09810067
               MOVE DP015-UNP-NUM-NOR-OFF TO  MR-B-UPC-A    (PV-SUB)    09820067
                                              MR-B-PRICE-A  (PV-SUB)    09830067
                                              MR-B-QTY-A    (PV-SUB)    09840067
               MOVE DP015-GREEN TO            MR-B-UPC-C    (PV-SUB)    09850067
                                              MR-B-PRICE-C  (PV-SUB)    09860067
                                              MR-B-QTY-C    (PV-SUB)    09870067
               MOVE DP015-UNDERLINE TO        MR-B-UPC-H    (PV-SUB)    09880067
                                              MR-B-PRICE-H  (PV-SUB)    09890067
                                              MR-B-QTY-H    (PV-SUB)    09900067
             END-PERFORM                                                09910067
           ELSE                                                         09920067
             PERFORM VARYING PV-SUB                                     09930067
                     FROM 1 BY 1                                        09940067
                     UNTIL PV-SUB > PC-ITEMS-PER-PANEL                  09950067
               MOVE DP015-UNP-NUM-NOR-OFF  TO MR-C-QTY-A    (PV-SUB)    09960067
               MOVE DP015-UNP-ALP-NOR-OFF  TO MR-C-DESC-A   (PV-SUB)    09970067
                                              MR-C-FIXTURE-A (PV-SUB)   09980067
                                              MR-C-DEPT-A   (PV-SUB)    09990067
               MOVE DP015-GREEN            TO MR-C-DESC-C   (PV-SUB)    10000067
                                              MR-C-FIXTURE-C (PV-SUB)   10010067
                                              MR-C-DEPT-C   (PV-SUB)    10020067
                                              MR-C-QTY-C    (PV-SUB)    10030067
               MOVE DP015-UNDERLINE        TO MR-C-DESC-H   (PV-SUB)    10040067
                                              MR-C-FIXTURE-H (PV-SUB)   10050067
                                              MR-C-DEPT-H   (PV-SUB)    10060067
                                              MR-C-QTY-H    (PV-SUB)    10070067
             END-PERFORM                                                10080067
           END-IF.                                                      10090067
                                                                        10100067
       EJECT.                                                           10110067
      ******************************************************************10120067
      ** EDIT THE RETAIL TRANSFER DETAIL INFORMATION.                 **10130067
      ******************************************************************10140067
       3400-EDIT-RTL-DETAIL-INFO.                                       10150067
                                                                        10160067
           SET ASC-VALID-PRICE (ASC-ITEM-SUB)                           10170067
051203         PS-INVALID-DEPT-CL                                       10180067
051203         PS-FOUND-DUMMY-UPC-N                                     10190067
               PS-INVALID-UPC                   TO TRUE.                10200067
                                                                        10210067
           IF ASC-UPC (ASC-ITEM-SUB) > SPACES                           10220067
              EVALUATE TRUE                                             10230067
051203           WHEN ASC-UPC-DIGITS-9-13 (ASC-ITEM-SUB) = SPACES       10240068
051203                MOVE ASC-UPC-DIGITS-1-8 (ASC-ITEM-SUB)            10250068
051203                      TO PV-CHECK-DUMMY-SKU-DEPT-CL               10260067
051203                         DP040I-SKU-NUMBER                        10270067
051203                PERFORM 3410-PROCESS-DUMMY-SKU                    10280067
051203           WHEN ASC-UPC-DIGITS-1-5 (ASC-ITEM-SUB) = ZEROS         10290068
051203                MOVE ASC-UPC-DIGITS-6-13 (ASC-ITEM-SUB)           10300068
051203                                     TO PV-CHECK-DUMMY-SKU-DEPT-CL10310067
051203                                        DP040I-SKU-NUMBER         10320067
051203                PERFORM 3410-PROCESS-DUMMY-SKU                    10330067
051203           WHEN OTHER                                             10340067
051203             MOVE ASC-UPC-N (ASC-ITEM-SUB) TO PV-HOLD-UPC-NBR     10350068
051203                IF   PV-KOHLS-UPC-DIGITS = '0400'                 10360067
051203                 AND PV-KOHLS-DUMMY-SKU = '000'                   10370067
051203                     PERFORM 3905-VALIDATE-UPC-DEPT-CLASS         10380067
051203                ELSE                                              10390067
051203                     PERFORM 3420-PROCESS-UPC                     10400067
051203                END-IF                                            10410068
051203        END-EVALUATE                                              10420068
051203      END-IF.                                                     10430068
                                                                        10440067
      *- IF A QTY OR PRICE IS ENTERED, THEN A UPC MUST BE ENTERED       10450067
           IF (ASC-RTL-QTY (ASC-ITEM-SUB) > SPACES                      10460067
            OR ASC-PRICE (ASC-ITEM-SUB) > SPACES)                       10470067
               IF (ASC-UPC (ASC-ITEM-SUB) = SPACES)                     10480067
                   MOVE DP015-RED     TO MR-B-UPC-C (ASC-ITEM-SUB)      10490067
                   MOVE DP015-REVERSE TO MR-B-UPC-H (ASC-ITEM-SUB)      10500067
      *            -- MUST ENTER UPC --                                 10510067
                   IF ASC-NO-ERROR                                      10520067
                       MOVE PC-TSYMSG-00413   TO DP020-MSG-NUMBER       10530067
                       SET DP020-MSG-FATAL    TO TRUE                   10540067
                       MOVE -1                TO MR-B-UPC-L             10550067
                                        (ASC-ITEM-SUB)                  10560067
                       SET DP030-SET-CURSOR-APPL-2                      10570067
                           ASC-ERROR          TO TRUE                   10580067
                   END-IF                                               10590067
              END-IF                                                    10600067
           END-IF.                                                      10610067
                                                                        10620067
           IF ASC-RTL-QTY (ASC-ITEM-SUB) > SPACES                       10630067
      *- USE ENTERED QTY AS AN INDICATOR OF THE NUMBER OF LINES ENTERED 10640067
               ADD +1                    TO ASC-NBR-OF-LINES-ENTERED    10650067
               MOVE ASC-RTL-QTY (ASC-ITEM-SUB)                          10660067
                                          TO DP010I-UNEDITED-FIELD      10670067
               MOVE +3                    TO DP010I-MAXIMUM-DIGITS      10680067
               MOVE +0                    TO DP010I-MAXIMUM-DECIMALS    10690067
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         10700067
                                          TO TRUE                       10710067
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         10721095
                         USING DP010I-NUMERIC-EDIT-AREA                 10722095
               IF DP010I-ERROR-DETECTED OR DP010I-DECIMAL-POINT-FOUND   10730067
      *        -- MUST BE NUMERIC --                                    10740067
                   SET DP020-MSG-FATAL  TO TRUE                         10750067
                   MOVE DP015-RED       TO MR-B-QTY-C (ASC-ITEM-SUB)    10760067
                   MOVE DP015-REVERSE   TO MR-B-QTY-H (ASC-ITEM-SUB)    10770067
                   IF ASC-NO-ERROR                                      10780067
                       MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       10790067
                       SET DP020-MSG-FATAL    TO TRUE                   10800067
                       MOVE -1          TO MR-B-QTY-L (ASC-ITEM-SUB)    10810067
                       SET DP030-SET-CURSOR-APPL-2                      10820067
                           ASC-ERROR          TO TRUE                   10830067
                   END-IF                                               10840067
               ELSE                                                     10850067
                   MOVE DP010I-NUMERIC-FIELD  TO PV-QUANTITY            10860067
                   MOVE PV-QUANTITY           TO                        10870067
                              ASC-RTL-QTY (ASC-ITEM-SUB)                10880067
                   IF DP010I-NUMERIC-FIELD = 0                          10890067
                       SET DP020-MSG-FATAL    TO TRUE                   10900067
      *            -- MUST BE GREATER THAN ZERO --                      10910067
                       MOVE DP015-RED     TO MR-B-QTY-C (ASC-ITEM-SUB)  10920067
                       MOVE DP015-REVERSE TO MR-B-QTY-H (ASC-ITEM-SUB)  10930067
                       IF ASC-NO-ERROR                                  10940067
                           MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER   10950067
                           SET DP020-MSG-FATAL    TO TRUE               10960067
                           MOVE -1                TO MR-B-QTY-L         10970067
                                        (ASC-ITEM-SUB)                  10980067
                           SET DP030-SET-CURSOR-APPL-2                  10990067
                               ASC-ERROR          TO TRUE               11000067
                       END-IF                                           11010067
                   END-IF                                               11020067
               END-IF                                                   11030067
      *- IF UPC OR PRICE WAS ENTERED, QTY IS REQUIRED                   11040067
           ELSE                                                         11050067
               IF (ASC-UPC   (ASC-ITEM-SUB) > SPACES                    11060067
                OR ASC-PRICE (ASC-ITEM-SUB) > SPACES)                   11070067
                   SET DP020-MSG-FATAL    TO TRUE                       11080067
                   MOVE DP015-RED         TO MR-B-QTY-C (ASC-ITEM-SUB)  11090067
                   MOVE DP015-REVERSE     TO MR-B-QTY-H (ASC-ITEM-SUB)  11100067
      *            -- REQUIRED FIELD --                                 11110067
                   IF ASC-NO-ERROR                                      11120067
                       MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       11130067
                       SET DP020-MSG-FATAL    TO TRUE                   11140067
                       MOVE -1                TO MR-B-QTY-L             11150067
                                        (ASC-ITEM-SUB)                  11160067
                       SET DP030-SET-CURSOR-APPL-2                      11170067
                           ASC-ERROR          TO TRUE                   11180067
                   END-IF                                               11190067
               END-IF                                                   11200067
           END-IF.                                                      11210067
                                                                        11220067
           IF ASC-PRICE (ASC-ITEM-SUB) > SPACES                         11230067
               MOVE ASC-PRICE (ASC-ITEM-SUB) TO DP010I-UNEDITED-FIELD   11240067
SR3403         MOVE +8                    TO DP010I-MAXIMUM-DIGITS      11251091
               MOVE +2                    TO DP010I-MAXIMUM-DECIMALS    11260067
               SET  DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                 11270067
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         11281095
                         USING DP010I-NUMERIC-EDIT-AREA                 11282095
               IF DP010I-ERROR-DETECTED                                 11290067
                   MOVE DP015-RED     TO MR-B-PRICE-C (ASC-ITEM-SUB)    11300067
                   MOVE DP015-REVERSE TO MR-B-PRICE-H (ASC-ITEM-SUB)    11310067
                   IF ASC-NO-ERROR                                      11320067
                       MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER       11330067
                       SET DP020-MSG-FATAL    TO TRUE                   11340067
                       MOVE -1        TO MR-B-PRICE-L (ASC-ITEM-SUB)    11350067
                       SET DP030-SET-CURSOR-APPL-2                      11360067
                           ASC-ERROR          TO TRUE                   11370067
                   END-IF                                               11380067
               ELSE                                                     11390067
      *- USER MAY ENTER THE PRICE WITH OR WITHOUT A DECIMAL POINT       11400067
      *- IF ENTERED WITHOUT A DECIMAL POINT, 2 DECIMAL POSITIONS ARE    11410067
      *- ASSUMED.                                                       11420067
                   MOVE DP010I-NUMERIC-FIELD      TO PV-EDIT-PRICE      11430067
                   IF DP010I-DECIMAL-POINT-FOUND                        11440067
                       MOVE PV-EDIT-PRICE  TO ASC-PRICE-N (ASC-ITEM-SUB)11450067
                   ELSE                                                 11460067
                       MOVE PV-EDIT-PRICE-4-DEC   TO ASC-PRICE-N        11470067
                                         (ASC-ITEM-SUB)                 11480067
                   END-IF                                               11490067
                   IF (PS-VALID-UPC)                                    11500067
                       PERFORM 4600-VALIDATE-PRICE                      11510067
                   END-IF                                               11520067
               END-IF                                                   11530067
           ELSE                                                         11540067
      *- IF UPC OR QTY WAS ENTERED, PRICE IS REQUIRED                   11550067
               IF (ASC-UPC   (ASC-ITEM-SUB) > SPACES              OR    11560067
                   ASC-RTL-QTY (ASC-ITEM-SUB) > SPACES)                 11570067
                   SET DP020-MSG-FATAL    TO TRUE                       11580067
                   MOVE DP015-RED         TO MR-B-PRICE-C (ASC-ITEM-SUB)11590067
                   MOVE DP015-REVERSE     TO MR-B-PRICE-H (ASC-ITEM-SUB)11600067
      *            -- REQUIRED FIELD --                                 11610067
                   IF ASC-NO-ERROR                                      11620067
                       MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       11630067
                       SET DP020-MSG-FATAL    TO TRUE                   11640067
                       MOVE -1                TO MR-B-PRICE-L           11650067
                                        (ASC-ITEM-SUB)                  11660067
                       SET DP030-SET-CURSOR-APPL-2                      11670067
                           ASC-ERROR          TO TRUE                   11680067
                   END-IF                                               11690067
               END-IF                                                   11700067
           END-IF.                                                      11710067
                                                                        11720067
051203     IF  PS-FOUND-DUMMY-UPC-Y AND ASC-NO-ERROR                    11730077
051203         PERFORM 7420-DUMMY-ON-TRANSFER                           11740077
051203     END-IF.                                                      11750077
                                                                        11760077
       EJECT.                                                           11770067
051203******************************************************************11780067
051203**PROCESS UPC THAT IS NOT A DUMMY UPC/SKU                         11790068
051203******************************************************************11800067
051203 3420-PROCESS-UPC.                                                11810068
                                                                        11820067
           MOVE ASC-UPC (ASC-ITEM-SUB) TO DP010I-UNEDITED-FIELD.        11830068
           MOVE +13                    TO DP010I-MAXIMUM-DIGITS.        11840068
           MOVE +0                     TO DP010I-MAXIMUM-DECIMALS.      11850068
           SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     11860068
                                                                        11870068
           CALL DP010I-NUMERIC-EDIT-ROUTINE                             11881095
                         USING DP010I-NUMERIC-EDIT-AREA                 11882095
                                                                        11890068
           IF DP010I-ERROR-DETECTED                                     11900068
               MOVE DP015-RED           TO MR-B-UPC-C (ASC-ITEM-SUB)    11910068
               MOVE DP015-REVERSE       TO MR-B-UPC-H (ASC-ITEM-SUB)    11920068
               IF ASC-NO-ERROR                                          11930068
                   MOVE PC-TSYMSG-00342 TO DP020-MSG-NUMBER             11940068
                   SET DP020-MSG-FATAL  TO TRUE                         11950068
                   MOVE -1              TO MR-B-UPC-L (ASC-ITEM-SUB)    11960068
                   SET DP030-SET-CURSOR-APPL-2                          11970068
                       ASC-ERROR        TO TRUE                         11980068
               END-IF                                                   11990068
           ELSE                                                         12000068
               MOVE DP010I-NUM-FIELD-13-DIG-4-DEC TO DK-UPC-NBR         12010068
                                                ASC-UPC-N (ASC-ITEM-SUB)12020068
               PERFORM 3700-SELECT-UPC-NBR                              12030068
               IF PS-INVALID-UPC                                        12040068
                   MOVE DP015-RED           TO MR-B-UPC-C (ASC-ITEM-SUB)12050068
                   MOVE DP015-REVERSE       TO MR-B-UPC-H (ASC-ITEM-SUB)12060068
                   IF ASC-NO-ERROR                                      12070068
                       MOVE PC-TSYMSG-00100 TO DP020-MSG-NUMBER         12080068
                       SET DP020-MSG-FATAL  TO TRUE                     12090068
                       MOVE -1              TO MR-B-UPC-L (ASC-ITEM-SUB)12100068
                       SET DP030-SET-CURSOR-APPL-2                      12110068
                           ASC-ERROR        TO TRUE                     12120068
                   END-IF                                               12130068
               ELSE                                                     12140068
                   PERFORM 7410-SELECT-ITM-BY-ITMNBR                    12150068
                   IF PS-ITEM-ON-TRANSFER                               12160068
                       MOVE DP015-RED     TO MR-B-UPC-C (ASC-ITEM-SUB)  12170068
                       MOVE DP015-REVERSE TO MR-B-UPC-H (ASC-ITEM-SUB)  12180068
                       IF ASC-NO-ERROR                                  12190068
                           MOVE PC-TSYMSG-01591    TO DP020-MSG-NUMBER  12200068
                           SET DP020-MSG-FATAL     TO TRUE              12210068
                           MOVE -1        TO MR-B-UPC-L (ASC-ITEM-SUB)  12220068
                           SET DP030-SET-CURSOR-APPL-2                  12230068
                               ASC-ERROR           TO TRUE              12240068
                       END-IF                                           12250068
                   END-IF                                               12260068
               END-IF                                                   12270068
           END-IF.                                                      12280068
                                                                        12290068
051203 EJECT.                                                           12300068
051203******************************************************************12310068
051203**VALIDATE THAT SKU IS A DUMMY                                    12320068
051203******************************************************************12330068
051203 3410-PROCESS-DUMMY-SKU.                                          12340068
                                                                        12350068
051203     PERFORM 3900-VALIDATE-SKU-DEPT-CLASS                         12360067
                                                                        12370067
051203     IF  PS-INVALID-DEPT-CL                                       12380067
051203         MOVE DP015-RED     TO MR-B-UPC-C (ASC-ITEM-SUB)          12390067
051203         MOVE DP015-REVERSE TO MR-B-UPC-H (ASC-ITEM-SUB)          12400067
051203         IF ASC-NO-ERROR                                          12410067
051203             MOVE PC-TSYMSG-00110 TO DP020-MSG-NUMBER             12420067
051203             SET DP020-MSG-FATAL  TO TRUE                         12430067
051203             MOVE -1              TO MR-B-UPC-L (ASC-ITEM-SUB)    12440067
051203             SET DP030-SET-CURSOR-APPL-4                          12450067
051203                 ASC-ERROR        TO TRUE                         12460067
051203         END-IF                                                   12470067
051203     ELSE                                                         12480067
051203          PERFORM 3910-SELECT-DUMMY-UPC                           12490067
051203          IF PS-FOUND-DUMMY-UPC-N                                 12500067
051203              MOVE DP015-RED     TO MR-B-UPC-C (ASC-ITEM-SUB)     12510067
051203              MOVE DP015-REVERSE TO MR-B-UPC-H (ASC-ITEM-SUB)     12520067
051203              IF ASC-NO-ERROR                                     12530067
051203                  MOVE PC-TSYMSG-00110  TO DP020-MSG-NUMBER       12540067
051203                  MOVE 'SKU 000 NOT FORMATTED CORRECTLY'          12550068
051203                                        TO DP020-MSG-TEXT         12560067
051203                  SET DP020-MSG-FATAL   TO TRUE                   12570067
051203                  MOVE -1            TO MR-B-UPC-L (ASC-ITEM-SUB) 12580067
051203                  SET DP030-SET-CURSOR-APPL-4                     12590067
051203                      ASC-ERROR         TO TRUE                   12600067
051203              END-IF                                              12610067
051203          END-IF                                                  12620067
051203      END-IF.                                                     12630067
                                                                        12640067
051203 EJECT.                                                           12650067
051203******************************************************************12660068
051203** CONVERT DUMMY SKU TO DUMMY UPC                               **12670068
051203******************************************************************12680068
051203 3910-SELECT-DUMMY-UPC.                                           12690068
                                                                        12700068
051203     SET DP040I-GEN-INTERNAL-UPC-OPTION TO TRUE.                  12710068
                                                                        12720068
051203     CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                          12730098
051203                     USING DP040I-UPC-CHECK-DIGIT-PARMS           12731098
                                                                        12740068
051203     IF DP040I-NO-ERROR-DETECTED                                  12750068
051203         SET PS-FOUND-DUMMY-UPC-Y TO TRUE                         12760068
051203         MOVE DP040I-UPC-CODE TO DK-UPC-NBR                       12770068
051203                                 ASC-UPC-N (ASC-ITEM-SUB)         12780068
051203                                 ASC-KOHLS-UPC (ASC-ITEM-SUB)     12790068
051203     ELSE                                                         12800068
051203         SET PS-FOUND-DUMMY-UPC-N TO TRUE                         12810068
051203     END-IF.                                                      12820068
                                                                        12830068
051203 EJECT.                                                           12840068
      ******************************************************************12850067
      ** EDIT THE NON-RETAIL TRANSFER DETAIL INFORMATION.             **12860067
      ******************************************************************12870067
       3450-EDIT-NRTL-DETAIL-INFO.                                      12880067
                                                                        12890067
      *- IF DEPT OR QTY OR FIXTURE WAS ENTERED, DESCRIPTION IS REQUIRED 12900067
           IF (ASC-NRTL-DEPT (ASC-ITEM-SUB) > SPACES                    12910067
            OR ASC-NRTL-QTY (ASC-ITEM-SUB) > SPACES                     12920067
            OR ASC-FIXTURE (ASC-ITEM-SUB) > SPACES)                     12930067
               IF ASC-ITEM-DESC (ASC-ITEM-SUB) NOT > SPACES             12940067
                   SET DP020-MSG-FATAL    TO TRUE                       12950067
                   MOVE DP015-RED      TO MR-C-DESC-C (ASC-ITEM-SUB)    12960067
                   MOVE DP015-REVERSE  TO MR-C-DESC-H (ASC-ITEM-SUB)    12970067
      *            -- REQUIRED FIELD --                                 12980067
                   IF ASC-NO-ERROR                                      12990067
                       MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       13000067
                       SET DP020-MSG-FATAL    TO TRUE                   13010067
                       MOVE -1                TO MR-C-DESC-L            13020067
                                        (ASC-ITEM-SUB)                  13030067
                       SET DP030-SET-CURSOR-APPL-2                      13040067
                           ASC-ERROR          TO TRUE                   13050067
                   END-IF                                               13060067
               END-IF                                                   13070067
           END-IF.                                                      13080067
                                                                        13090067
           IF ASC-NRTL-QTY (ASC-ITEM-SUB) > SPACES                      13100067
      *- USE ENTERED QTY AS AN INDICATOR OF THE NUMBER OF LINES ENTERED 13110067
               ADD +1                    TO ASC-NBR-OF-LINES-ENTERED    13120067
               MOVE ASC-NRTL-QTY (ASC-ITEM-SUB)                         13130067
                                          TO DP010I-UNEDITED-FIELD      13140067
               MOVE +3                    TO DP010I-MAXIMUM-DIGITS      13150067
               MOVE +0                    TO DP010I-MAXIMUM-DECIMALS    13160067
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         13170067
                                          TO TRUE                       13180067
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         13191095
                         USING DP010I-NUMERIC-EDIT-AREA                 13192095
               IF DP010I-ERROR-DETECTED OR DP010I-DECIMAL-POINT-FOUND   13200067
      *        -- MUST BE NUMERIC --                                    13210067
                   SET DP020-MSG-FATAL    TO TRUE                       13220067
                   MOVE DP015-RED         TO MR-C-QTY-C (ASC-ITEM-SUB)  13230067
                   MOVE DP015-REVERSE     TO MR-C-QTY-H (ASC-ITEM-SUB)  13240067
                   IF ASC-NO-ERROR                                      13250067
                       MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       13260067
                       SET DP020-MSG-FATAL    TO TRUE                   13270067
                       MOVE -1            TO MR-C-QTY-L (ASC-ITEM-SUB)  13280067
                       SET DP030-SET-CURSOR-APPL-2                      13290067
                           ASC-ERROR          TO TRUE                   13300067
                   END-IF                                               13310067
               ELSE                                                     13320067
                   MOVE DP010I-NUMERIC-FIELD  TO PV-QUANTITY            13330067
                   MOVE PV-QUANTITY TO ASC-NRTL-QTY (ASC-ITEM-SUB)      13340067
                   IF DP010I-NUMERIC-FIELD = 0                          13350067
                       SET DP020-MSG-FATAL    TO TRUE                   13360067
      *            -- MUST BE GREATER THAN ZERO --                      13370067
                       MOVE DP015-RED     TO MR-C-QTY-C (ASC-ITEM-SUB)  13380067
                       MOVE DP015-REVERSE TO MR-C-QTY-H (ASC-ITEM-SUB)  13390067
                       IF ASC-NO-ERROR                                  13400067
                           MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER   13410067
                           SET DP020-MSG-FATAL    TO TRUE               13420067
                           MOVE -1        TO MR-C-QTY-L (ASC-ITEM-SUB)  13430067
                           SET DP030-SET-CURSOR-APPL-2                  13440067
                               ASC-ERROR          TO TRUE               13450067
                       END-IF                                           13460067
                   END-IF                                               13470067
               END-IF                                                   13480067
      *- IF DEPT OR DESCRIPTION OR FIXTURE WAS ENTERED, QTY IS REQUIRED 13490067
           ELSE                                                         13500067
               IF (ASC-NRTL-DEPT (ASC-ITEM-SUB) > SPACES OR             13510067
                   ASC-ITEM-DESC (ASC-ITEM-SUB) > SPACES OR             13520067
                   ASC-FIXTURE (ASC-ITEM-SUB) > SPACES)                 13530067
                   SET DP020-MSG-FATAL    TO TRUE                       13540067
                   MOVE DP015-RED         TO MR-C-QTY-C (ASC-ITEM-SUB)  13550067
                   MOVE DP015-REVERSE     TO MR-C-QTY-H (ASC-ITEM-SUB)  13560067
      *            -- REQUIRED FIELD --                                 13570067
                   IF ASC-NO-ERROR                                      13580067
                       MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       13590067
                       SET DP020-MSG-FATAL    TO TRUE                   13600067
                       MOVE -1                TO MR-C-QTY-L             13610067
                                        (ASC-ITEM-SUB)                  13620067
                       SET DP030-SET-CURSOR-APPL-2                      13630067
                           ASC-ERROR          TO TRUE                   13640067
                   END-IF                                               13650067
               END-IF                                                   13660067
           END-IF.                                                      13670067
                                                                        13680067
       EJECT.                                                           13690067
      ******************************************************************13700067
      ** WALK THROUGH THE ARRAY AND CHECK FOR THE TOTAL ACCUMULATED    *13710067
      ** QUANTITY FOR A UPC/PRICE COMBINATION - MAXIMUM ALLOWABLE      *13720067
      ** TOTAL IS 999.                                                 *13730067
      ******************************************************************13740067
       3460-EDIT-RTL-QTY.                                               13750067
                                                                        13760067
           IF PWT-QTY-NOT-CHECKED (PV-ITEM)                             13770067
               IF ASC-RTL-QTY (PV-ITEM) > SPACES                        13780067
                   MOVE ASC-RTL-QTY-N (PV-ITEM)TO PV-HOLD-QTY           13790067
                   SET PWT-QTY-CHECKED (PV-ITEM) TO TRUE                13800067
                   PERFORM 3470-ACCUM-QTY                               13810067
                           VARYING PV-ITEM2                             13820067
                           FROM 1 BY 1                                  13830067
                           UNTIL PV-ITEM2 >  PC-ITEMS-PER-PANEL         13840067
                ELSE                                                    13850067
                   SET PWT-QTY-CHECKED (PV-ITEM) TO TRUE                13860067
                END-IF                                                  13870067
           END-IF.                                                      13880067
                                                                        13890067
       EJECT.                                                           13900067
      ******************************************************************13910067
      ** FOR THE SAME UPC/PRICE COMBINATION, ACCUMULATE TOTAL QTY.     *13920067
      ******************************************************************13930067
       3470-ACCUM-QTY.                                                  13940067
151000     IF PWT-QTY-NOT-CHECKED (PV-ITEM2)                            13950078
151100         IF ASC-RTL-QTY (PV-ITEM2) > SPACES                       13960078
151200             IF ASC-KOHLS-UPC-DIGITS (PV-ITEM2) = '0400' AND      13970078
                      ASC-KOHLS-DUMMY-SKU  (PV-ITEM2) = '000'           13971078
151300                 IF (ASC-KOHLS-UPC   (PV-ITEM2) =                 13980078
151400                     ASC-KOHLS-UPC   (PV-ITEM)) AND               13990078
151500                    (ASC-PRICE (PV-ITEM2) =                       14000078
151600                     ASC-PRICE (PV-ITEM))                         14010078
151700                      ADD ASC-RTL-QTY-N (PV-ITEM2)                14020078
151800                                      TO PV-HOLD-QTY              14030078
151900                      SET PWT-QTY-CHECKED (PV-ITEM2)              14040078
152000                                      TO TRUE                     14050078
152100                      IF PV-HOLD-QTY > PC-MAX-QTY                 14060078
152200                          SET PWT-QTY-ERROR (PV-ITEM2)            14070078
152300                          ASC-ERROR                  TO TRUE      14080078
152400                      END-IF                                      14090078
152500                 END-IF                                           14100078
152600             ELSE                                                 14110078
152700                 IF (ASC-ITEM-NBR  (PV-ITEM2) =                   14120078
152800                     ASC-ITEM-NBR  (PV-ITEM)) AND                 14121078
152900                    (ASC-PRICE (PV-ITEM2) =                       14122078
153000                     ASC-PRICE (PV-ITEM))                         14123078
153100                      ADD ASC-RTL-QTY-N (PV-ITEM2)                14124078
153200                                      TO PV-HOLD-QTY              14125078
153300                      SET PWT-QTY-CHECKED (PV-ITEM2)              14126078
153400                                      TO TRUE                     14127078
153500                      IF PV-HOLD-QTY > PC-MAX-QTY                 14128078
153600                          SET PWT-QTY-ERROR (PV-ITEM2)            14129078
153700                          ASC-ERROR                  TO TRUE      14129178
153800                      END-IF                                      14129278
153900                 END-IF                                           14129378
154000             END-IF                                               14129478
154100         ELSE                                                     14129578
154200             SET PWT-QTY-CHECKED (PV-ITEM2)                       14129678
154300                                     TO TRUE                      14129778
154400         END-IF                                                   14129878
154500     END-IF.                                                      14129978
154600 EJECT                                                            14130078
      ******************************************************************14131067
      ** AFTER TESTING FOR MAXIMUM ACCUMULATED QTY ERROR, FIND THE     *14140067
      ** FIRST FIELD IN ERROR AND SAVE THE BLOCK AND ITEM SO THE       *14150067
      ** CORRECT SCREEN CAN BE DISPLAYED WITH ERRORS HIGHLIGHTED.      *14160067
      ******************************************************************14170067
       3480-CHECK-FOR-QTY-ERROR.                                        14180067
                                                                        14190067
           IF PWT-QTY-ERROR (PV-ITEM)                                   14200067
               SET PS-QTY-ERROR-FOUND   TO TRUE                         14210067
               MOVE PV-ITEM           TO PV-HOLD-ITEM                   14220067
           END-IF.                                                      14230067
                                                                        14240067
       EJECT.                                                           14250067
      *----------------------------------------------------------------*14260067
100404*    READ XST_UPC USING THE ENTERED UPC NUMBER                    14270084
      *----------------------------------------------------------------*14280067
       3700-SELECT-UPC-NBR.                                             14290067
                                                                        14300067
           MOVE '3700-SELECT-UPC-NBR' TO DP013-PARAGRAPH.               14310067
                                                                        14320067
100404     INITIALIZE DCLXST00008.                                      14321084
100404     INITIALIZE DCLXST00010.                                      14322084
                                                                        14340067
           PERFORM WITH TEST AFTER                                      14350067
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   14360067
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                14370067
                   OR SQLCODE = ZERO OR SQLCODE = +100                  14380067
                                                                        14390067
               EXEC SQL                                                 14400067
100404             SELECT B.UNT_RTL_AMT                                 14660184
100404                   ,B.UPC_STAT_CHG_DTE                            14660284
100404                   ,B.UNT_RTL_CHG_DTE                             14660384
100404                   ,B.LOC_SKU_STAT_CDE                            14660484
100404                   ,B.GP_RTL_AMT                                  14660684
100404                   ,B.GP_RTL_QTY                                  14660784
100404                   ,B.INTR_UPC_ID                                 14660884
100404                   ,C.ITM_NBR                                     14660984
100404                   ,D.REGN_PRIC_IND                               14661084
100404               INTO :XST00008-UNT-RTL-AMT                         14661284
100404                   ,:PV-NREGN-UPC-STAT-CHG-DTE                    14661384
100404                   ,:PV-NREGN-UNT-RTL-CHG-DTE                     14661484
100404                   ,:PV-NREGN-LOC-SKU-STAT-CDE                    14661584
100404                   ,:XST00008-GP-RTL-AMT                          14661684
100404                    :PV-GP-RTL-AMT-NULL-IND                       14661784
100404                   ,:XST00008-GP-RTL-QTY                          14661884
100404                    :PV-GP-RTL-QTY-NULL-IND                       14661984
100404                   ,:XST00008-INTR-UPC-ID                         14662084
100404                   ,:SKXREF-ITM-NBR                               14662184
100404                   ,:XST00010-REGN-PRIC-IND                       14662284
100404                FROM XST_UPC     A                                14662484
100404                    ,XST_SKU_LOC B                                14662584
100404                    ,TSKXREF     C                                14662684
100404                    ,XST_SKU     D                                14662784
100404          WHERE  (A.UPC_NBR               =  :DK-UPC-NBR   AND    14662884
100404                  A.LAST_ACTN_CDE        IN ('A', 'U')     AND    14662984
100404                  A.INTR_UPC_ID           = B.INTR_UPC_ID  AND    14663084
100404                  B.LOC_NBR               = 0              AND    14663184
100404                  B.END_TMST             IS NULL           AND    14663284
100404                  B.LOC_SKU_STAT_CDE NOT IN ('98')         AND    14663384
100404                  B.INTR_UPC_ID           = C.INTR_UPC_ID  AND    14663484
100404                  C.SKU_STAT_CDE     NOT IN ('98')         AND    14663584
100404                  A.INTR_UPC_ID           = D.INTR_UPC_ID)        14663684
               END-EXEC                                                 14663784
                                                                        14663884
               EVALUATE TRUE                                            14670067
                   WHEN SQLCODE = ZERO                                  14680067
                       SET PS-VALID-UPC          TO TRUE                14690067
100404                 MOVE SKXREF-ITM-NBR       TO ASC-ITEM-NBR        14700084
                                        (ASC-ITEM-SUB)                  14710067
100404                 MOVE XST00008-UNT-RTL-AMT   TO PV-CUR-RTL-AMT    14720087
100404                 IF PV-GP-RTL-QTY-NULL-IND < 0                    14721084
100404                     MOVE ZEROS TO XST00008-GP-RTL-QTY            14722084
100404                 END-IF                                           14723084
100404                 IF PV-GP-RTL-AMT-NULL-IND < 0                    14724084
100404                     MOVE ZEROS TO XST00008-GP-RTL-AMT            14725084
100404                 END-IF                                           14726084
100404                 MOVE XST00008-GP-RTL-QTY   TO PV-GP-QTY          14727084
100404                 MOVE XST00008-GP-RTL-AMT   TO PV-GP-RTL-AMT      14728084
100404                 IF XST00010-REGN-PRIC-IND = PC-YES               14751084
                           EVALUATE ASC-XFER-TYPE                       14760067
111703*                        WHEN  PC-DEFECTIVE-DAMAGE                14770079
111703                         WHEN  PC-DEFECTIVE-DAMAGE-SORT1          14771080
111703                         WHEN  PC-DEFECTIVE-DAMAGE-SORT2          14772080
                               WHEN  PC-CALLBACK                        14780067
                                  MOVE ASC-FR-STORE-NBR TO DK-STORE-NBR 14790067
                                  PERFORM 7900-CHECK-REGN-PRC           14800067
                               WHEN  PC-STOCK-BAL-CORP                  14810067
                               WHEN  PC-STOCK-BAL-STORE                 14820067
                               WHEN  PC-CUSTOMER                        14830067
                                  MOVE ASC-RCV-STR-NBR TO DK-STORE-NBR  14840067
                                  PERFORM 7900-CHECK-REGN-PRC           14850067
                           END-EVALUATE                                 14860067
                       END-IF                                           14870067
                       MOVE PV-CUR-RTL-AMT TO ASC-FILE-PRICE            14880067
                                          (ASC-ITEM-SUB)                14890067
                       IF PV-GP-QTY > +1                                14900067
                           COMPUTE PV-CUR-RTL-AMT =                     14910067
                                        PV-GP-RTL-AMT / PV-GP-QTY       14920067
                           SET ASC-GROUP-PRICED-ITEM (ASC-ITEM-SUB)     14930067
                                                 TO TRUE                14940067
                       ELSE                                             14950067
                           SET ASC-NOT-GROUP-PRICED-ITEM (ASC-ITEM-SUB) 14960067
                                                 TO TRUE                14970067
                       END-IF                                           14980067
                   WHEN SQLCODE = +100                                  14990067
                       SET PS-INVALID-UPC          TO TRUE              15000067
                   WHEN SQLCODE = -904                                  15010067
                   WHEN SQLCODE = -913                                  15020067
                       CONTINUE                                         15030067
                   WHEN OTHER                                           15040067
100404                 MOVE 'READ A ROW FROM XST_SKU_LOC'               15050084
                                           TO DP013-MESSAGE-TEXT (1)    15060067
                       MOVE SQLCA          TO DP013-SQLCA               15070067
100404                 MOVE 'XST_SKU_LOC'  TO DP013-DB2-TABLE-NAME (1)  15080084
100404                 MOVE 'XST_SKU'      TO DP013-DB2-TABLE-NAME (2)  15090084
                       SET DP013-DB2-ABEND TO TRUE                      15100067
                       PERFORM DP013-0000-PROCESS-ABEND                 15110067
               END-EVALUATE                                             15120067
           END-PERFORM.                                                 15130067
                                                                        15140067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          15150067
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT '    15160067
                                           TO DP013-MESSAGE-TEXT (1)    15170067
100404         MOVE 'DATA FROM XST_SKU_LOC & XST_SKU'                   15180084
                                           TO DP013-MESSAGE-TEXT (2)    15190067
               MOVE SQLCA                  TO DP013-SQLCA               15200067
100404         MOVE 'XST_SKU_LOC'          TO DP013-DB2-TABLE-NAME (1)  15210084
100404         MOVE 'XST_SKU'              TO DP013-DB2-TABLE-NAME (2)  15220084
               SET DP013-DB2-ABEND         TO TRUE                      15230067
               PERFORM DP013-0000-PROCESS-ABEND                         15240067
           END-IF.                                                      15250067
                                                                        15260067
           IF PS-VALID-UPC                                              15270067
               PERFORM 3800-GENERATE-INTERNAL-UPC                       15280067
               IF PS-INVALID-CHECK-DIGIT                                15290067
                   SET PS-INVALID-UPC      TO TRUE                      15300067
               END-IF                                                   15310067
           END-IF.                                                      15320067
                                                                        15330067
       EJECT.                                                           15340067
      ******************************************************************15350067
      *  GENERATE THE KOHL'S INTERNAL UPC NUMBER                        15360067
      ******************************************************************15370067
       3800-GENERATE-INTERNAL-UPC.                                      15380067
                                                                        15390067
           MOVE '3800-GENERATE-INTERNAL-UPC' TO DP013-PARAGRAPH.        15400067
                                                                        15410067
           SET PS-VALID-CHECK-DIGIT        TO TRUE.                     15420067
                                                                        15430067
           EXEC SQL                                                     15440067
100404         SELECT UPC_NBR                                           15450084
100404           INTO :XST00012-UPC-NBR                                 15460084
100404           FROM XST_UPC                                           15470084
100404          WHERE UPC_ID         =  :XST00008-INTR-UPC-ID           15480084
100404            AND LAST_ACTN_CDE IN ('A', 'U')                       15490084
           END-EXEC.                                                    15500067
                                                                        15510067
           EVALUATE TRUE                                                15520067
               WHEN SQLCODE = ZERO                                      15530067
100404             MOVE XST00012-UPC-NBR TO DK-UPC-NBR                  15540084
                                       ASC-KOHLS-UPC (ASC-ITEM-SUB)     15550067
               WHEN SQLCODE = +100                                      15560067
                   SET PS-INVALID-CHECK-DIGIT  TO TRUE                  15570067
               WHEN OTHER                                               15580067
                    MOVE 'GENERATE INTERNAL UPC NUMBER'                 15590067
                                       TO DP013-MESSAGE-TEXT (1)        15600067
                    MOVE SQLCA         TO DP013-SQLCA                   15610067
100404              MOVE 'XST_UPC'     TO DP013-DB2-TABLE-NAME (1)      15620084
                    SET DP013-DB2-ABEND                                 15630067
                        DP013-XCTL-DISPLAY-RESTART                      15640067
                                       TO TRUE                          15650067
                    PERFORM DP013-0000-PROCESS-ABEND                    15660067
           END-EVALUATE.                                                15670067
                                                                        15680067
       EJECT.                                                           15690067
051203******************************************************************15700068
051203** VALIDATE EMBEDDED DEPT AND CLASS IN DUMMY SKU                **15710068
051203******************************************************************15720068
051203 3900-VALIDATE-SKU-DEPT-CLASS.                                    15730068
                                                                        15740068
051203     MOVE '3900-VALIDATE-SKU-DEPT-CLASS' TO DP013-PARAGRAPH.      15750068
                                                                        15760068
051203     MOVE PV-DUMMY-SKU-DEPT TO SKXREF-DEPT.                       15770068
051203     MOVE PV-DUMMY-SKU-CL-9 TO SKXREF-SUBCLASS.                   15780068
051203     MOVE ZERO              TO PV-DUMMY-SKU-CL-2.                 15790068
051203     MOVE PV-DUMMY-SKU-CL-9 TO SKXREF-CLASS.                      15800072
                                                                        15810068
051203     PERFORM 3910-VALIDATE-DEPT-CLASS.                            15820068
                                                                        15830068
051203 EJECT.                                                           15840068
051203******************************************************************15850068
051203**VALIDATE EMBEDDED DEPT AND CLASS IN UPC                         15860068
051203******************************************************************15870068
051203 3905-VALIDATE-UPC-DEPT-CLASS.                                    15880068
                                                                        15890068
051203     MOVE PV-KOHLS-DEPT     TO SKXREF-DEPT.                       15900068
051203     MOVE PV-KOHLS-CL-9     TO SKXREF-SUBCLASS.                   15910068
051203     MOVE ZERO              TO PV-KOHLS-CL-2.                     15920068
051203     MOVE PV-KOHLS-CL-9     TO SKXREF-CLASS.                      15930072
                                                                        15940068
051203     PERFORM 3910-VALIDATE-DEPT-CLASS.                            15950068
                                                                        15960068
051203     IF PS-INVALID-DEPT-CL                                        15970075
051203        MOVE DP015-RED TO MR-B-UPC-C (ASC-ITEM-SUB)               15980075
051203        MOVE DP015-REVERSE      TO MR-B-UPC-H (ASC-ITEM-SUB)      15990075
051203        IF ASC-NO-ERROR                                           16000075
051203           MOVE PC-TSYMSG-00110 TO DP020-MSG-NUMBER               16010075
051203           SET DP020-MSG-FATAL  TO TRUE                           16020075
051203           MOVE -1              TO MR-B-UPC-L (ASC-ITEM-SUB)      16030075
051203           SET DP030-SET-CURSOR-APPL-4                            16040075
051203               ASC-ERROR        TO TRUE                           16050075
051203        END-IF                                                    16060075
051203     END-IF.                                                      16070075
                                                                        16080075
051203 EJECT.                                                           16090068
051203******************************************************************16100068
051203**VALIDATE DEPT AND CLASS                                         16110068
051203******************************************************************16120068
051203 3910-VALIDATE-DEPT-CLASS.                                        16130068
                                                                        16140068
051203     MOVE '3910-VALIDATE-DEPT-CLASS' TO DP013-PARAGRAPH.          16150068
                                                                        16160068
051203     PERFORM WITH TEST AFTER                                      16170068
051203             VARYING PV-RETRY-COUNT FROM 1 BY 1                   16180068
051203             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                16190068
051203                OR SQLCODE = ZERO                                 16200068
051203                OR SQLCODE = +100                                 16210068
                                                                        16220068
051203         EXEC SQL                                                 16230068
051203              SELECT COUNT(*)                                     16240068
051203              INTO  :PV-READ-COUNT                                16250068
051203              FROM   TSKXREF                                      16260068
051203              WHERE  DEPT     = :SKXREF-DEPT                      16270068
051203                 AND CLASS    = :SKXREF-CLASS                     16280072
051203                 AND SUBCLASS = :SKXREF-SUBCLASS                  16290068
051203         END-EXEC                                                 16300068
                                                                        16310068
051203         EVALUATE TRUE                                            16320068
051203             WHEN SQLCODE = ZERO                                  16330068
051203                 IF PV-READ-COUNT > +0                            16340068
051203                     SET PS-VALID-DEPT-CL    TO TRUE              16350068
051203                 ELSE                                             16360068
051203                     SET PS-INVALID-DEPT-CL  TO TRUE              16370068
051203                 END-IF                                           16380068
051203             WHEN SQLCODE = +100                                  16390068
051203                 SET PS-INVALID-DEPT-CL      TO TRUE              16400068
051203             WHEN SQLCODE = -904                                  16410068
051203             WHEN SQLCODE = -913                                  16420068
051203                 CONTINUE                                         16430068
051203             WHEN OTHER                                           16440068
051203                 MOVE 'READ A ROW FROM TSKXREF'                   16450068
051203                                     TO DP013-MESSAGE-TEXT (1)    16460068
051203                 MOVE SQLCA          TO DP013-SQLCA               16470068
051203                 MOVE 'TSKXREF'      TO DP013-DB2-TABLE-NAME (1)  16480068
051203                 SET DP013-DB2-ABEND TO TRUE                      16490068
051203                 PERFORM DP013-0000-PROCESS-ABEND                 16500068
051203         END-EVALUATE                                             16510068
051203     END-PERFORM.                                                 16520068
                                                                        16530068
051203     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          16540068
051203         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT '    16550068
051203                                     TO DP013-MESSAGE-TEXT (1)    16560068
051203         MOVE 'DATA FROM TSKXREF'    TO DP013-MESSAGE-TEXT (2)    16570068
051203         MOVE SQLCA                  TO DP013-SQLCA               16580068
051203         MOVE 'TSKXREF'              TO DP013-DB2-TABLE-NAME (1)  16590068
051203         SET DP013-DB2-ABEND         TO TRUE                      16600068
051203         PERFORM DP013-0000-PROCESS-ABEND                         16610068
051203     END-IF.                                                      16620068
                                                                        16630068
051203 EJECT.                                                           16640068
      *----------------------------------------------------------------*16650067
      *    INITIALIZE BLOCK & ITEM COUNTERS. GET TRANSFER TYPE         *16660067
      *    DESCRIPTION AND CONTAINER TYPE DESCRIPTION.                 *16670067
      *    DISPLAY THE PANEL TO USER.                                  *16680067
      *----------------------------------------------------------------*16690067
       4000-BUILD-INITIAL-PANEL.                                        16700067
                                                                        16710067
           MOVE +0                 TO ASC-ITEM-SUB.                     16720067
                                                                        16730067
           SET DP030-SET-CURSOR-APPL-2   TO TRUE.                       16740067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                         16750067
               MOVE -1                TO MR-B-UPC-L (1)                 16760067
               INITIALIZE ASC-RETAIL-ITEM-ARRAY                         16770067
           ELSE                                                         16780067
               MOVE -1                TO MR-C-DESC-L (1)                16790067
               INITIALIZE ASC-NON-RETAIL-ITEM-ARRAY                     16800067
           END-IF.                                                      16810067
                                                                        16820067
           PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16830067
                                                                        16840067
       EJECT.                                                           16850067
051705*----------------------------------------------------------------*16860088
051705*  CHECK IF PHYSICAL INVENTORY IS ACTIVE.                         16870088
051705*----------------------------------------------------------------*16880088
051705*4300-CHECK-INVENTORY-CUTOFF.                                     16890088
                                                                        16900067
051705*    MOVE '4300-CHECK-INVENTORY-CUTOFF' TO DP013-PARAGRAPH.       16910088
                                                                        16920067
051705*    EXEC SQL                                                     16930088
051705*        SET  :PV-CURRENT-DATE       =  CURRENT DATE              16940088
051705*    END-EXEC.                                                    16950088
                                                                        16960067
051705*    EVALUATE TRUE                                                16970088
051705*        WHEN SQLWARN0 NOT = SPACES                               16980088
051705*        WHEN SQLCODE < ZERO                                      16990088
051705*        WHEN SQLCODE > ZERO                                      17000088
051705*            MOVE 'SELECT THE CURRENT DATE'                       17010088
051705*                                      TO DP013-MESSAGE-TEXT (1)  17020088
051705*            MOVE SQLCA                TO DP013-SQLCA             17030088
051705*            SET DP013-DB2-ABEND                                  17040088
051705*                DP013-NO-ROLLBACK     TO TRUE                    17050088
051705*            PERFORM DP013-0000-PROCESS-ABEND                     17060088
051705*    END-EVALUATE.                                                17070088
                                                                        17080067
051705*    MOVE ASC-FR-STORE-NBR TO DK-STORE-NBR-9.                     17090088
051705*    PERFORM 7800-GET-STORE-XFER-CTOFF-DTE.                       17100088
051705*    MOVE INVPAR-XFER-INV-CTOFF-DTE TO PV-LY-INV-CTOFF-DTE.       17110088
051705*    MOVE ASC-TO-STORE-NBR          TO DK-STORE-NBR-9.            17120088
051705*    PERFORM 7800-GET-STORE-XFER-CTOFF-DTE.                       17130088
                                                                        17140067
051705*    IF INVPAR-XFER-INV-CTOFF-DTE > PV-LY-INV-CTOFF-DTE           17150088
051705*        MOVE INVPAR-XFER-INV-CTOFF-DTE                           17160088
051705*                                   TO PV-LY-INV-CTOFF-DTE        17170088
051705*    END-IF.                                                      17180088
                                                                        17190067
051705*    IF PV-CMPLT-DATE <= PV-LY-INV-CTOFF-DTE                      17200088
051705*        SET DP020-MSG-FATAL                                      17210088
051705*            PS-INVENTORY-ERROR                                   17220088
051705*            DP020-NEXT-ACT-APPL-ERROR  TO TRUE                   17230088
051705* -- CANNOT PROCESS BEFORE INVENTORY TRANSFER - CALL INV CONTROL  17240088
051705*        MOVE PC-TSYMSG-01615   TO DP020-MSG-NUMBER               17250088
051705*    ELSE                                                         17260088
051705*        PERFORM 7500-READ-CONTROL-TABLE                          17270088
051705*        IF PV-PHY-INV-PERD-IND = PC-YES                          17280088
051705*            MOVE ASC-FR-STORE-NBR      TO DK-STORE-NBR-9         17290088
051705*            PERFORM 7600-GET-STR-PLND-INV-DTE                    17300088
051705*            MOVE INVPAR-PLND-INV-DTE   TO PV-FR-STR-INV-DTE      17310088
051705*            MOVE PV-HOLD-INVENTORY-IND TO PV-FR-INVENTORY-IND    17320088
051705*            MOVE ASC-XFER-DKEY-ID      TO DK-XFER-DKEY-ID        17330088
051705*            MOVE ASC-RCV-STR-NBR       TO DK-STORE-NBR-9         17340088
051705*            PERFORM 7600-GET-STR-PLND-INV-DTE                    17350088
051705*            MOVE INVPAR-PLND-INV-DTE   TO PV-TO-STR-INV-DTE      17360088
051705*            MOVE PV-HOLD-INVENTORY-IND TO PV-TO-INVENTORY-IND    17370088
051705*            IF PV-FR-NO-INVENTORY  AND PV-TO-NO-INVENTORY        17380088
051705*                CONTINUE                                         17390088
051705*            ELSE                                                 17400088
051705*                IF PV-FR-NO-INVENTORY                            17410088
051705*                   MOVE PV-TO-STR-INV-DTE TO PV-FR-STR-INV-DTE   17420088
051705*                ELSE                                             17430088
051705*                    IF PV-TO-NO-INVENTORY                        17440088
051705*                       MOVE PV-FR-STR-INV-DTE                    17450088
051705*                                          TO PV-TO-STR-INV-DTE   17460088
051705*                    END-IF                                       17470088
051705*                END-IF                                           17480088
051705*                IF ASC-CONTNR-TYP-CDE = PC-HAND-CARRY            17490088
051705*                    MOVE PV-FR-STR-INV-DTE    TO PV-COMPARE-DATE 17500088
051705*                ELSE                                             17510088
051705*                    MOVE PV-XFER-INV-CTOFF-DTE                   17520088
051705*                                              TO PV-COMPARE-DATE 17530088
051705*                END-IF                                           17540088
051705*                PERFORM 4310-INVENTORY-LOGIC                     17550088
051705*            END-IF                                               17560088
051705*        END-IF                                                   17570088
051705*    END-IF.                                                      17580088
051705*                                                                 17590088
051705*EJECT.                                                           17600088
051705*----------------------------------------------------------------*17610088
051705* PERFORM PHYSICAL INVENTORY LOGIC                               *17620088
051705*----------------------------------------------------------------*17630088
051705*4310-INVENTORY-LOGIC.                                            17640088
                                                                        17650067
051705*    IF PV-CMPLT-DATE <= PV-COMPARE-DATE                          17660088
051705*        IF PV-CURRENT-DATE > PV-MAX-FINCL-BK-DTE                 17670088
051705*            SET DP020-MSG-FATAL                                  17680088
051705*                PS-INVENTORY-ERROR                               17690088
051705*                DP020-NEXT-ACT-APPL-ERROR  TO TRUE               17700088
051705* -- CANNOT PROCESS BEFORE INVENTORY TRANSFER - CALL INV CONTROL  17710088
051705*            MOVE PC-TSYMSG-01615   TO DP020-MSG-NUMBER           17720088
051705*        END-IF                                                   17730088
051705*    ELSE                                                         17740088
051705*        EVALUATE TRUE                                            17750088
051705*            WHEN PV-CURRENT-DATE > PV-MAX-PLND-INV-DTE           17760088
051705*            WHEN PV-FR-STR-INV-DTE <  PV-CURRENT-DATE   AND      17770088
051705*                 PV-TO-STR-INV-DTE <  PV-CURRENT-DATE            17780088
051705*                CONTINUE                                         17790088
051705*            WHEN OTHER                                           17800088
051705*                SET DP020-MSG-FATAL                              17810088
051705*                    PS-INVENTORY-ERROR                           17820088
051705*                    DP020-NEXT-ACT-APPL-ERROR  TO TRUE           17830088
051705* -- WAIT 'TIL BOTH STORES FINISH PHYSICAL INVENTORY              17840088
051705*                    MOVE PC-TSYMSG-01659    TO DP020-MSG-NUMBER  17850088
051705*        END-EVALUATE                                             17860088
051705*    END-IF.                                                      17870088
051705*                                                                 17880088
051705*EJECT.                                                           17890088
      *----------------------------------------------------------------*17900067
      * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *17910067
      *----------------------------------------------------------------*17920067
       4400-MOVE-COMMAREA-TO-SCREEN.                                    17930067
                                                                        17940067
           MOVE ASC-FR-STORE-NBR              TO PV-DISP-FROM-STORE-NBR.17950067
           MOVE ASC-XFER-SEQ-NBR              TO PV-DISP-SEQ-NBR.       17960067
           MOVE PV-DISP-XFER-NBR              TO MR-A-XFER-NBR.         17970067
           MOVE DP020-USERID                  TO MR-B-USERID.           17980067
                                                                        17990067
           PERFORM VARYING PV-SUB                                       18000067
                   FROM 1 BY 1                                          18010067
                   UNTIL PV-SUB > 4                                     18020067
               MOVE ASC-COMMENT (PV-SUB) TO MR-B-COMMENT (PV-SUB)       18030067
           END-PERFORM.                                                 18040067
                                                                        18050067
           IF ASC-NO-ERROR                                              18060067
               SET DP030-SET-CURSOR-APPL-2 TO TRUE                      18070067
               IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                     18080067
                   MOVE -1                TO MR-B-UPC-L (1)             18090067
               ELSE                                                     18100067
                   MOVE -1                TO MR-C-DESC-L (1)            18110067
               END-IF                                                   18120067
           END-IF.                                                      18130067
                                                                        18140067
           SET DP030-ERASE                                              18150067
               DP030-SEND-MAP-AND-DATA (1)                              18160067
               DP030-SEND-MAP-AND-DATA (2) TO TRUE.                     18170067
           MOVE PC-COMMON-HEADER-MAP-NAME      TO DP030-MAP-NAME (1).   18180067
           MOVE 1                              TO PV-MAP-START-BYTE.    18190067
           MOVE MR-A-HEADER                    TO MD-MAP-DATA-AREA.     18200067
           MOVE LENGTH OF MR-A-HEADER          TO DP030-MAP-LENGTH (1). 18210067
           ADD DP030-MAP-LENGTH (1)            TO PV-MAP-START-BYTE.    18220067
           MOVE ASC-MAX-LINE-NBR               TO PV-LINE-NBR.          18230067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                         18240067
               PERFORM 4420-FORMAT-RTL-LIST-LINES                       18250067
                       VARYING ASC-ITEM-SUB                             18260067
                       FROM 1 BY 1                                      18270067
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18280067
                   MOVE PC-RTL-DETAIL-MAP-NAME TO DP030-MAP-NAME (2)    18290067
                   MOVE LENGTH OF MR-B-RTL-DETAIL                       18300067
                                               TO DP030-MAP-LENGTH (2)  18310067
                   MOVE MR-B-RTL-DETAIL        TO MD-MAP-DATA-AREA      18320067
                             (PV-MAP-START-BYTE:DP030-MAP-LENGTH (2))   18330067
                   ADD DP030-MAP-LENGTH (2)    TO PV-MAP-START-BYTE     18340067
           ELSE                                                         18350067
               PERFORM 4430-FORMAT-NRTL-LIST-LINES                      18360067
                       VARYING ASC-ITEM-SUB                             18370067
                       FROM 1 BY 1                                      18380067
                       UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18390067
                   MOVE PC-NRTL-DETAIL-MAP-NAME TO DP030-MAP-NAME (2)   18400067
                   MOVE LENGTH OF MR-C-NRTL-DETAIL                      18410067
                                               TO DP030-MAP-LENGTH (2)  18420067
                   MOVE MR-C-NRTL-DETAIL       TO MD-MAP-DATA-AREA      18430067
                             (PV-MAP-START-BYTE:DP030-MAP-LENGTH (2))   18440067
                   ADD DP030-MAP-LENGTH (2)    TO PV-MAP-START-BYTE     18450067
           END-IF.                                                      18460067
                                                                        18470067
       EJECT.                                                           18480067
      *----------------------------------------------------------------*18490067
      *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP FOR *18500067
      *    RETAIL TRANSFER TYPES.                                      *18510067
      *----------------------------------------------------------------*18520067
       4420-FORMAT-RTL-LIST-LINES.                                      18530067
                                                                        18540067
           ADD +1                  TO PV-LINE-NBR.                      18550067
           MOVE PV-LINE-NBR        TO MR-B-LINE-NBR-N (ASC-ITEM-SUB).   18560067
           MOVE ASC-UPC    (ASC-ITEM-SUB)TO MR-B-UPC   (ASC-ITEM-SUB).  18570067
                                                                        18580067
           IF ASC-PRICE (ASC-ITEM-SUB) > SPACES                         18590067
               INSPECT ASC-PRICE (ASC-ITEM-SUB)                         18600067
                 REPLACING LEADING ' ' BY '0'                           18610067
               MOVE ASC-PRICE-N (ASC-ITEM-SUB)                          18620067
                                       TO MR-B-PRICE-N (ASC-ITEM-SUB)   18630067
           ELSE                                                         18640067
               MOVE SPACES             TO MR-B-PRICE   (ASC-ITEM-SUB)   18650067
           END-IF.                                                      18660067
           MOVE ASC-RTL-QTY (ASC-ITEM-SUB)                              18670067
                                       TO MR-B-QTY   (ASC-ITEM-SUB).    18680067
                                                                        18690067
       EJECT.                                                           18700067
      *----------------------------------------------------------------*18710067
      *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP FOR *18720067
      *    NON-RETAIL TRANSFER TYPES.                                  *18730067
      *----------------------------------------------------------------*18740067
       4430-FORMAT-NRTL-LIST-LINES.                                     18750067
                                                                        18760067
           ADD +1                  TO PV-LINE-NBR.                      18770067
           MOVE PV-LINE-NBR        TO MR-C-LINE-NBR-N (ASC-ITEM-SUB).   18780067
           MOVE ASC-ITEM-DESC (ASC-ITEM-SUB)                            18790067
                                       TO MR-C-DESC  (ASC-ITEM-SUB).    18800067
           MOVE ASC-FIXTURE (ASC-ITEM-SUB)                              18810067
                                       TO MR-C-FIXTURE (ASC-ITEM-SUB).  18820067
           MOVE ASC-NRTL-DEPT (ASC-ITEM-SUB)                            18830067
                                       TO MR-C-DEPT (ASC-ITEM-SUB).     18840067
           MOVE ASC-NRTL-QTY (ASC-ITEM-SUB)                             18850067
                                       TO MR-C-QTY   (ASC-ITEM-SUB).    18860067
                                                                        18870067
       EJECT.                                                           18880067
      *----------------------------------------------------------------*18890067
       4600-VALIDATE-PRICE.                                             18900067
                                                                        18910067
           IF ASC-GROUP-PRICED-ITEM   (ASC-ITEM-SUB)                    18920067
               IF ASC-PRICE-N (ASC-ITEM-SUB) NOT = PV-CUR-RTL-AMT       18930067
                   SET ASC-INVALID-PRICE (ASC-ITEM-SUB) TO TRUE         18940067
               END-IF                                                   18950067
           ELSE                                                         18960067
             EVALUATE ASC-XFER-TYPE                                     18970067
111703*         WHEN PC-DEFECTIVE-DAMAGE                                18980079
111703          WHEN PC-DEFECTIVE-DAMAGE-SORT1                          18981080
111703          WHEN PC-DEFECTIVE-DAMAGE-SORT2                          18982080
                   IF ASC-PRICE-N (ASC-ITEM-SUB) < PV-CUR-RTL-AMT       18990067
                          SET ASC-INVALID-PRICE (ASC-ITEM-SUB) TO TRUE  19000067
                   END-IF                                               19010067
                 WHEN PC-CALLBACK                                       19020067
                   IF ASC-PRICE-N (ASC-ITEM-SUB) NOT = PV-CUR-RTL-AMT   19030067
                       SET ASC-INVALID-PRICE (ASC-ITEM-SUB) TO TRUE     19040067
                   END-IF                                               19050067
                 WHEN PC-STOCK-BAL-STORE                                19060067
                 WHEN PC-STOCK-BAL-CORP                                 19070067
                 WHEN PC-CUSTOMER                                       19080067
100404             IF PV-NREGN-LOC-SKU-STAT-CDE = PC-CLEARANCE  AND     19081084
100404             XST00010-REGN-PRIC-IND NOT = PC-YES          AND     19082084
100404             PV-NREGN-UPC-STAT-CHG-DTE < PV-NREGN-UNT-RTL-CHG-DTE 19082184
                      PERFORM 7750-GET-CLR-ITM-1ST-MKDN-PRIC            19120067
                      IF ASC-PRICE-N (ASC-ITEM-SUB) >  PPCPRC-RTL-AMT   19130067
                        SET ASC-INVALID-PRICE (ASC-ITEM-SUB) TO TRUE    19140084
                      END-IF                                            19150067
                   ELSE                                                 19160067
                      IF ASC-PRICE-N (ASC-ITEM-SUB) NOT = PV-CUR-RTL-AMT19170067
                          SET ASC-INVALID-PRICE (ASC-ITEM-SUB) TO TRUE  19180067
                      END-IF                                            19190067
                  END-IF                                                19200067
              END-EVALUATE                                              19210067
           END-IF.                                                      19220067
                                                                        19230067
       EJECT.                                                           19240067
      *----------------------------------------------------------------*19250067
      * SELECT DATA FROM THE TRANSFER TABLES WHEN PROCESSING AN         19260067
      * EXISTING WORKSHEET FROM THE CRITERIA SPEC SCREEN.              *19270067
      *----------------------------------------------------------------*19280067
       6000-GET-TRANSFER-INFO.                                          19290067
                                                                        19300067
           MOVE '6000-GET-TRANSFER-INFO' TO DP013-PARAGRAPH.            19310067
                                                                        19320067
           PERFORM WITH TEST AFTER                                      19330067
                   VARYING PV-RETRY-COUNT                               19340067
                   FROM 1 BY 1                                          19350067
                   UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)             19360067
                         OR (SQLCODE = ZERO) OR (SQLCODE = +100))       19370067
                                                                        19380067
               EXEC SQL                                                 19390067
                  SELECT  XFER_TYP_CDE                                  19400067
                         ,FR_STR_NBR                                    19410067
                         ,CONTNR_TYP_CDE                                19420067
                         ,TO_STR_NBR                                    19430067
                         ,XFER_SEQ_NBR                                  19440067
051705*                  ,CMPT_XFER_END_TMST                            19450089
                  INTO   :TFMSTR-XFER-TYP-CDE                           19460067
                         ,:TFMSTR-FR-STR-NBR                            19470067
                         ,:TFMSTR-CONTNR-TYP-CDE                        19480067
                         ,:TFMSTR-TO-STR-NBR                            19490067
                         ,:TFMSTR-XFER-SEQ-NBR                          19500067
051705*                  ,:TFMSTR-CMPT-XFER-END-TMST                    19510088
                  FROM     TTFMSTR                                      19520067
                  WHERE    XFER_DKEY_ID   = :DK-XFER-DKEY-ID            19530067
               END-EXEC                                                 19540067
                                                                        19550067
               EVALUATE TRUE                                            19560067
                   WHEN SQLCODE = ZERO                                  19570067
                      MOVE TFMSTR-XFER-TYP-CDE  TO ASC-XFER-TYPE        19580067
                      MOVE TFMSTR-XFER-SEQ-NBR  TO ASC-XFER-SEQ-NBR     19590067
                      MOVE TFMSTR-FR-STR-NBR    TO ASC-FR-STORE-NBR     19600067
                      MOVE TFMSTR-CONTNR-TYP-CDE                        19610067
                                                TO ASC-CONTNR-TYP-CDE   19620067
                      MOVE TFMSTR-TO-STR-NBR    TO ASC-TO-STORE-NBR     19630067
051705*               MOVE TFMSTR-CMPT-XFER-END-TMST                    19640088
051705*                                          TO PV-CMPLT-DATE       19650088
                      PERFORM 6100-SELECT-MAX-XFER-LINE-NBR             19660067
                   WHEN SQLCODE = +100                                  19670067
                   WHEN SQLCODE = -904                                  19680067
                   WHEN SQLCODE = -913                                  19690067
                       CONTINUE                                         19700067
                   WHEN OTHER                                           19710067
                       MOVE 'SELECT TRANSFER DATA'                      19720067
                                         TO DP013-MESSAGE-TEXT (1)      19730067
                       MOVE SQLCA        TO DP013-SQLCA                 19740067
                       MOVE 'TTFMSTR'    TO DP013-DB2-TABLE-NAME (1)    19750067
                       SET DP013-DB2-ABEND                              19760067
                           DP013-XCTL-DISPLAY-RESTART                   19770067
                                         TO TRUE                        19780067
                       PERFORM DP013-0000-PROCESS-ABEND                 19790067
               END-EVALUATE                                             19800067
           END-PERFORM.                                                 19810067
                                                                        19820067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          19830067
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     19840067
                                         TO DP013-MESSAGE-TEXT (1)      19850067
               MOVE 'TRANSFER DATA'      TO DP013-MESSAGE-TEXT (2)      19860067
               MOVE SQLCA                TO DP013-SQLCA                 19870067
               MOVE 'TTFMSTR'            TO DP013-DB2-TABLE-NAME (1)    19880067
               SET DP013-DB2-ABEND                                      19890067
                   DP013-XCTL-DISPLAY-RESTART                           19900067
                                         TO TRUE                        19910067
               PERFORM DP013-0000-PROCESS-ABEND                         19920067
           END-IF.                                                      19930067
                                                                        19940067
       EJECT.                                                           19950067
      *----------------------------------------------------------------*19960067
      *  GET THE MAX LINE NUMBER FOR THIS TRANSFER TO PREPARE FOR      *19970067
      *  ADDING A NEW LINE.                                            *19980067
      *----------------------------------------------------------------*19990067
       6100-SELECT-MAX-XFER-LINE-NBR.                                   20000067
                                                                        20010067
           MOVE '6100-SELECT-MAX-XFER-LINE-NBR' TO DP013-PARAGRAPH.     20020067
                                                                        20030067
           INITIALIZE DCLTTFITEM.                                       20040067
                                                                        20050067
           PERFORM WITH TEST AFTER                                      20060067
                   VARYING PV-RETRY-COUNT                               20070067
                   FROM 1 BY 1                                          20080067
                   UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)             20090067
                       OR (SQLCODE = +0))                               20100067
                                                                        20110067
               EXEC SQL                                                 20120067
                   SELECT MAX(XFER_LNE_NBR)                             20130067
                   INTO  :PV-LINE-NBR:PV-NULL-IND                       20140067
                   FROM   TTFITEM                                       20150067
                   WHERE  XFER_DKEY_ID  =  :DK-XFER-DKEY-ID             20160067
               END-EXEC                                                 20170067
                                                                        20180067
               EVALUATE TRUE                                            20190067
                   WHEN SQLCODE = ZERO                                  20200067
                        MOVE PV-LINE-NBR         TO ASC-MAX-LINE-NBR    20210067
                   WHEN SQLCODE = -904                                  20220067
                   WHEN SQLCODE = -913                                  20230067
                       CONTINUE                                         20240067
                   WHEN OTHER                                           20250067
                       MOVE 'SELECT MAX(XFER_LNE_NBR) FOR XFER_DKEY_ID:'20260067
                                             TO DP013-MESSAGE-TEXT (1)  20270067
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 20280067
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     20290067
                                             TO DP013-MESSAGE-TEXT (2)  20300067
                       MOVE SQLCA            TO DP013-SQLCA             20310067
                       MOVE 'TTFITEM'       TO DP013-DB2-TABLE-NAME (1) 20320067
                       MOVE SQLCA            TO DP013-SQLCA             20330067
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)20340067
                       SET DP013-DB2-ABEND                              20350067
                       DP013-XCTL-DISPLAY-RESTART                       20360067
                                            TO TRUE                     20370067
                       PERFORM DP013-0000-PROCESS-ABEND                 20380067
               END-EVALUATE                                             20390067
           END-PERFORM.                                                 20400067
                                                                        20410067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          20420067
                   MOVE 'SELECT MAX(XFER_LNE_NBR) FOR XFER_DKEY_ID: '   20430067
                                             TO DP013-MESSAGE-TEXT (1)  20440067
                   MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID 20450067
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         20460067
                                             TO DP013-MESSAGE-TEXT (2)  20470067
                   MOVE SQLCA                TO DP013-SQLCA             20480067
                   MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)20490067
                   SET DP013-DB2-ABEND                                  20500067
                       DP013-XCTL-DISPLAY-RESTART                       20510067
                                            TO TRUE                     20520067
                   PERFORM DP013-0000-PROCESS-ABEND                     20530067
           END-IF.                                                      20540067
                                                                        20550067
       EJECT.                                                           20560067
      *----------------------------------------------------------------*20570067
      *  UPDATE AND INSERT ROWS IN THE APPROPRIATE TABLES WHEN THE     *20580067
      *  COMPLETE TRANSFER FUNCTION IS SELECTED.                       *20590067
      *----------------------------------------------------------------*20600067
       7000-ADD-ITEMS.                                                  20610067
                                                                        20620067
           MOVE ASC-XFER-DKEY-ID           TO DK-XFER-DKEY-ID.          20630067
                                                                        20640067
           EXEC SQL                                                     20650067
               SET :PV-DB2-TIMESTAMP = CURRENT TIMESTAMP                20660067
           END-EXEC.                                                    20670067
                                                                        20680067
           MOVE ASC-MAX-LINE-NBR               TO PV-LINE-NBR.          20690067
           IF ASC-XFER-TYPE NOT = PC-NON-RETAIL                         20700067
               PERFORM 9000-CHECK-RETAIL-ITEMS                          20710067
                 VARYING ASC-ITEM-SUB                                   20720067
                   FROM 1 BY 1 UNTIL                                    20730067
                         ASC-ITEM-SUB > PC-ITEMS-PER-PANEL              20740067
           ELSE                                                         20750067
               PERFORM 9200-CHECK-NON-RETAIL-ITEMS                      20760067
                 VARYING ASC-ITEM-SUB                                   20770067
                   FROM 1 BY 1 UNTIL                                    20780067
                         ASC-ITEM-SUB > PC-ITEMS-PER-PANEL              20790067
           END-IF.                                                      20800067
                                                                        20810067
       EJECT.                                                           20820067
      *----------------------------------------------------------------*20830067
      *  GET THE TIMESTAMP FOR THE POSITIVE RECEIPT.                   *20840067
      *----------------------------------------------------------------*20850067
       7100-SELECT-RCPT-TMST.                                           20860067
                                                                        20870067
           MOVE '7100-SELECT-RCPT-TMST'      TO DP013-PARAGRAPH.        20880067
                                                                        20890067
           PERFORM WITH TEST AFTER                                      20900067
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   20910067
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                20920067
                      OR SQLCODE = ZERO                                 20930067
                                                                        20940067
               EXEC SQL                                                 20950067
                   SELECT  RCV_XFER_BEG_TMST                            20960067
                          ,STR_NBR                                      20970067
                   INTO   :TFRCPT-RCV-XFER-BEG-TMST                     20980067
                         ,:TFRCPT-STR-NBR                               20990067
                   FROM    TTFRCPT R                                    21000067
                          ,TTFSTAT S                                    21010067
                   WHERE  S.XFER_DKEY_ID      =  :DK-XFER-DKEY-ID       21020067
                      AND R.XFER_DKEY_ID      =  :DK-XFER-DKEY-ID       21030067
                      AND R.RCV_XFER_BEG_TMST = S.XFER_STAT_TMST        21040067
                      AND S.XFER_STAT_CDE     = :PC-POSITIVE-RECEIPT    21050067
               END-EXEC                                                 21060067
                                                                        21070067
               EVALUATE TRUE                                            21080067
                   WHEN SQLCODE = ZERO                                  21090067
                       MOVE TFRCPT-RCV-XFER-BEG-TMST                    21100067
                                          TO ASC-RECEIPT-TIMESTAMP      21110067
                       MOVE TFRCPT-STR-NBR   TO ASC-RCV-STR-NBR         21120067
                   WHEN SQLCODE = -904                                  21130067
                   WHEN SQLCODE = -913                                  21140067
                       CONTINUE                                         21150067
                   WHEN OTHER                                           21160067
                       MOVE 'SELECT MAX TIMESTAMP FOR XFER_DKEY_ID: '   21170067
                                             TO DP013-MESSAGE-TEXT (1)  21180067
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 21190067
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     21200067
                                             TO DP013-MESSAGE-TEXT (2)  21210067
                       MOVE SQLCA            TO DP013-SQLCA             21220067
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)21230067
                       SET DP013-DB2-ABEND                              21240067
                           DP013-XCTL-DISPLAY-RESTART                   21250067
                                         TO TRUE                        21260067
                       PERFORM DP013-0000-PROCESS-ABEND                 21270067
               END-EVALUATE                                             21280067
           END-PERFORM.                                                 21290067
                                                                        21300067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          21310067
               MOVE 'SELECT MAX TIMESTAMP FOR XFER_DKEY_ID: '           21320067
                                             TO DP013-MESSAGE-TEXT (1)  21330067
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     21340067
               MOVE PV-DISPLAY-XFER-DKEY-ID                             21350067
                                             TO DP013-MESSAGE-TEXT (2)  21360067
               MOVE SQLCA                TO DP013-SQLCA                 21370067
               MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)    21380067
               SET DP013-DB2-ABEND                                      21390067
                   DP013-XCTL-DISPLAY-RESTART                           21400067
                                         TO TRUE                        21410067
               PERFORM DP013-0000-PROCESS-ABEND                         21420067
           END-IF.                                                      21430067
                                                                        21440067
       EJECT.                                                           21450067
      *----------------------------------------------------------------*21460067
      *  INSERT A ROW IN THE ITEM POSTING TABLE.                       *21470067
      *----------------------------------------------------------------*21480067
       7300-INSERT-ADJUSTMENT-ROW.                                      21490067
                                                                        21500067
           MOVE '7300-INSERT-ADJUSTMENT-ROW' TO DP013-PARAGRAPH.        21510067
                                                                        21520074
111703*    IF (ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE                    21531079
111703     IF (ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT1              21532080
111703      OR ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT2              21533080
            OR ASC-XFER-TYPE  =  PC-CALLBACK)                           21540074
            OR (ASC-XFER-TYPE NOT = PC-NON-RETAIL                       21550074
           AND TFITEM-ITM-NBR = ZEROS)                                  21560074
              MOVE PC-MERCHANDISE-LEDGER TO TFITPS-EXTL-SYS-PRCG-CDE    21570067
           ELSE                                                         21580067
              MOVE PC-FASHION-SALES      TO TFITPS-EXTL-SYS-PRCG-CDE    21590067
           END-IF.                                                      21600067
                                                                        21610067
           MOVE ASC-FR-STORE-NBR         TO TFITPS-FRM-PSTG-STR-NBR.    21620067
           MOVE DP020-USERID             TO TFITPS-ADJ-BY-USR-ID.       21630067
           MOVE ASC-COMMENT-ARRAY          TO TFITPS-ADJ-CMNT-TXT-TEXT  21640067
                                              VF-VARCHAR-WORK-FIELD.    21650067
           SET VF-IND                      TO +320.                     21660067
           PERFORM 7310-PROCESS-VARCHAR.                                21670067
           SET TFITPS-ADJ-CMNT-TXT-LEN     TO VF-IND.                   21680067
SR3403     MOVE TFITEM-XFER-PRIC-AMT TO PV-XFER-PRIC-AMT                21681092
                                                                        21690067
           PERFORM WITH TEST AFTER                                      21700067
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   21710067
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                21720067
                    OR SQLCODE = ZERO                                   21730067
                                                                        21740067
               EXEC SQL                                                 21750067
                   INSERT INTO TTFITPS                                  21760067
                       (XFER_DKEY_ID,                                   21770067
                        XFER_LNE_NBR,                                   21780067
                        PSTG_SEQ_NBR,                                   21790067
                        XFER_RCPT_TMST,                                 21800067
                        ADJ_RSN_CDE,                                    21810067
                        FRM_PSTG_STR_NBR,                               21820067
                        TO_PSTG_STR_NBR,                                21830067
                        ITM_RTL_PRCE_AMT,                               21840067
                        ITM_QTY,                                        21850067
                        EXTL_SYS_PRCG_CDE,                              21860067
                        ADJ_BY_USR_ID,                                  21870067
                        ADJ_CMNT_TXT)                                   21880067
                   VALUES                                               21890067
                       (:DK-XFER-DKEY-ID,                               21900067
                        :TFITEM-XFER-LNE-NBR,                           21910067
                        :PC-ONE,                                        21920067
                        :ASC-RECEIPT-TIMESTAMP,                         21930067
                        :PC-ADJUSTMENT-CODE,                            21940067
                        :TFITPS-FRM-PSTG-STR-NBR,                       21950067
                        :ASC-RCV-STR-NBR,                               21960067
SR3403                  :PV-XFER-PRIC-AMT,                              21971092
                        :TFITEM-XFER-QTY,                               21980067
                        :TFITPS-EXTL-SYS-PRCG-CDE,                      21990067
                        :TFITPS-ADJ-BY-USR-ID,                          22000067
                        :TFITPS-ADJ-CMNT-TXT)                           22010067
               END-EXEC                                                 22020067
                                                                        22030067
               EVALUATE TRUE                                            22040067
                   WHEN SQLCODE = -904                                  22050067
                   WHEN SQLCODE = -913                                  22060067
                   WHEN SQLCODE = ZERO                                  22070067
                       CONTINUE                                         22080067
                   WHEN OTHER                                           22090067
                       MOVE 'INSERT ADJUSTMENT FOR XFER_DKEY_ID/XFER_LNE22100067
      -                '_NBR: '              TO DP013-MESSAGE-TEXT (1)  22110067
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 22120067
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     22130067
                                             TO DP013-MESSAGE-TEXT (2)  22140067
                       MOVE TFITEM-XFER-LNE-NBR                         22150067
                                             TO PV-DISPLAY-XFER-LNE-NBR 22160067
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     22170067
                                             TO DP013-MESSAGE-TEXT (3)  22180067
                       MOVE SQLCA            TO DP013-SQLCA             22190067
                       MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)22200067
                       SET DP013-DB2-ABEND                              22210067
                           DP013-XCTL-DISPLAY-RESTART                   22220067
                                         TO TRUE                        22230067
                       PERFORM DP013-0000-PROCESS-ABEND                 22240067
               END-EVALUATE                                             22250067
           END-PERFORM.                                                 22260067
                                                                        22270067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          22280067
                   MOVE 'INSERT ADJUSTMENT FOR XFER_DKEY_ID/XFER_LNE_NBR22290067
      -                 '/PSTG_SEQ_NBR: '    TO DP013-MESSAGE-TEXT (1)  22300067
                   MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID 22310067
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         22320067
                                             TO DP013-MESSAGE-TEXT (2)  22330067
                   MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR 22340067
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         22350067
                                             TO DP013-MESSAGE-TEXT (3)  22360067
                   MOVE SQLCA                TO DP013-SQLCA             22370067
                   MOVE 'TTFITPS'            TO DP013-DB2-TABLE-NAME (1)22380067
               SET DP013-DB2-ABEND                                      22390067
                   DP013-XCTL-DISPLAY-RESTART                           22400067
                                         TO TRUE                        22410067
               PERFORM DP013-0000-PROCESS-ABEND                         22420067
           END-IF.                                                      22430067
                                                                        22440067
       EJECT.                                                           22450067
      *----------------------------------------------------------------*22460067
      *  DETERMINE THE LENGTH OF THE VARCHAR FIELD.                    *22470067
      *----------------------------------------------------------------*22480067
       7310-PROCESS-VARCHAR.                                            22490067
                                                                        22500067
           IF VF-VARCHAR-WORK-FIELD = SPACES                            22510067
               SET VF-IND                     TO +1                     22520067
               SET VF-IND                     DOWN BY +1                22530067
           ELSE                                                         22540067
               SET VF-VARCHAR-BEGIN           TO TRUE                   22550067
               PERFORM UNTIL VF-VARCHAR-END                             22560067
                    IF VF-VARCHAR (VF-IND) = ' '                        22570067
                       IF VF-IND > +0                                   22580067
                           SET VF-IND         DOWN BY +1                22590067
                       ELSE                                             22600067
                           SET VF-VARCHAR-END TO TRUE                   22610067
                       END-IF                                           22620067
                   ELSE                                                 22630067
                       SET VF-VARCHAR-END     TO TRUE                   22640067
                   END-IF                                               22650067
               END-PERFORM                                              22660067
           END-IF.                                                      22670067
                                                                        22680067
       EJECT.                                                           22690067
      *----------------------------------------------------------------*22700067
      *  INSERT A ROW IN THE ITEM RECEIPT TABLE FOR A RETAIL TRANSFER. *22710067
      *----------------------------------------------------------------*22720067
       7350-INSERT-RTL-ITM-RCPT.                                        22730067
                                                                        22740067
           MOVE '7350-INSERT-RTL-ITM-RCPT'  TO DP013-PARAGRAPH.         22750067
                                                                        22760067
           PERFORM WITH TEST AFTER                                      22770067
                   VARYING PV-RETRY-COUNT                               22780067
                   FROM 1 BY 1                                          22790067
                   UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)             22800067
                       OR (SQLCODE = +0))                               22810067
                                                                        22820067
               EXEC SQL                                                 22830067
                   INSERT INTO TTFITRC                                  22840067
                       (XFER_DKEY_ID,                                   22850067
                        XFER_LNE_NBR,                                   22860067
                        XFER_LNE_SEQ_NBR,                               22870067
                        XFER_RCPT_TMST,                                 22880067
                        RCVD_XFER_QTY,                                  22890067
                        RCVD_XFER_PRIC_AMT,                             22900067
                        RCVD_RTL_PRIC_AMT,                              22910067
                        XFER_ITM_DSCRP_IND)                             22920067
                   VALUES                                               22930067
                       (:DK-XFER-DKEY-ID,                               22940067
                        :TFITEM-XFER-LNE-NBR,                           22950067
                        :PC-ONE,                                        22960067
                        :ASC-RECEIPT-TIMESTAMP,                         22970067
                        :TFITEM-XFER-QTY,                               22980067
                        :TFITEM-XFER-PRIC-AMT,                          22990067
                        :TFITEM-CPLD-RTL-PRIC-AMT,                      23000067
                        'N')                                            23010067
               END-EXEC                                                 23020067
                                                                        23030067
               EVALUATE TRUE                                            23040067
                   WHEN SQLCODE = ZERO                                  23050067
                   WHEN SQLCODE = -904                                  23060067
                   WHEN SQLCODE = -913                                  23070067
                       CONTINUE                                         23080067
                   WHEN OTHER                                           23090067
                       MOVE 'INSERT XFER ITM RECEIPT FOR XFER_DKEY_ID/XF23100067
      -                 'ER_LNE_NBR/XFER_RCPT_TMST: '                   23110067
                                             TO DP013-MESSAGE-TEXT (1)  23120067
                       MOVE DK-XFER-DKEY-ID TO PV-DISPLAY-XFER-DKEY-ID  23130067
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     23140067
                                             TO DP013-MESSAGE-TEXT (2)  23150067
                       MOVE TFITEM-XFER-LNE-NBR                         23160067
                                             TO PV-DISPLAY-XFER-LNE-NBR 23170067
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     23180067
                                             TO DP013-MESSAGE-TEXT (3)  23190067
                       MOVE ASC-RECEIPT-TIMESTAMP                       23200067
                                             TO DP013-MESSAGE-TEXT (4)  23210067
                       MOVE SQLCA            TO DP013-SQLCA             23220067
                       MOVE 'TTFITRC'       TO DP013-DB2-TABLE-NAME (1) 23230067
                       SET DP013-DB2-ABEND                              23240067
                       DP013-XCTL-DISPLAY-RESTART                       23250067
                                            TO TRUE                     23260067
                       PERFORM DP013-0000-PROCESS-ABEND                 23270067
               END-EVALUATE                                             23280067
           END-PERFORM.                                                 23290067
                                                                        23300067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          23310067
                   MOVE 'INSERT XFER ITM RECEIPT FOR XFER_DKEY_ID/XFER_L23320067
      -                 'NE_NBR/XFER_RCPT_TMST: '                       23330067
                                             TO DP013-MESSAGE-TEXT (1)  23340067
                   MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID 23350067
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         23360067
                                             TO DP013-MESSAGE-TEXT (2)  23370067
                   MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR 23380067
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         23390067
                                             TO DP013-MESSAGE-TEXT (3)  23400067
                   MOVE ASC-RECEIPT-TIMESTAMP                           23410067
                                             TO DP013-MESSAGE-TEXT (4)  23420067
                   MOVE SQLCA                TO DP013-SQLCA             23430067
                   MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)23440067
                   SET DP013-DB2-ABEND                                  23450067
                       DP013-XCTL-DISPLAY-RESTART                       23460067
                                            TO TRUE                     23470067
                   PERFORM DP013-0000-PROCESS-ABEND                     23480067
           END-IF.                                                      23490067
                                                                        23500067
       EJECT.                                                           23510067
      *----------------------------------------------------------------*23520067
      *  INSERT A ROW IN THE ITEM RECEIPT TABLE FOR A NON-RETAIL XFER. *23530067
      *----------------------------------------------------------------*23540067
       7360-INSERT-NON-RTL-ITM-RCPT.                                    23550067
                                                                        23560067
           MOVE '7360-INSERT-NON-RTL-ITM-RCPT' TO DP013-PARAGRAPH.      23570067
                                                                        23580067
           PERFORM WITH TEST AFTER                                      23590067
                   VARYING PV-RETRY-COUNT                               23600067
                   FROM 1 BY 1                                          23610067
                   UNTIL ((PV-RETRY-COUNT > PC-MAX-RETRIES)             23620067
                       OR (SQLCODE = +0))                               23630067
                                                                        23640067
               EXEC SQL                                                 23650067
                   INSERT INTO TTFITRC                                  23660067
                       (XFER_DKEY_ID,                                   23670067
                        XFER_LNE_NBR,                                   23680067
                        XFER_LNE_SEQ_NBR,                               23690067
                        XFER_RCPT_TMST,                                 23700067
                        RCVD_XFER_QTY,                                  23710067
                        XFER_ITM_DSCRP_IND)                             23720067
                   VALUES                                               23730067
                       (:DK-XFER-DKEY-ID,                               23740067
                        :TFITEM-XFER-LNE-NBR,                           23750067
                        :PC-ONE,                                        23760067
                        :ASC-RECEIPT-TIMESTAMP,                         23770067
                        :TFITEM-XFER-QTY,                               23780067
                        'N')                                            23790067
               END-EXEC                                                 23800067
                                                                        23810067
               EVALUATE TRUE                                            23820067
                   WHEN SQLCODE = ZERO                                  23830067
                   WHEN SQLCODE = -904                                  23840067
                   WHEN SQLCODE = -913                                  23850067
                       CONTINUE                                         23860067
                   WHEN OTHER                                           23870067
                       MOVE 'INSERT XFER ITM RECEIPT FOR XFER_DKEY_ID/XF23880067
      -                 'ER_LNE_NBR/XFER_RCPT_TMST: '                   23890067
                                             TO DP013-MESSAGE-TEXT (1)  23900067
                       MOVE DK-XFER-DKEY-ID TO PV-DISPLAY-XFER-DKEY-ID  23910067
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     23920067
                                             TO DP013-MESSAGE-TEXT (2)  23930067
                       MOVE TFITEM-XFER-LNE-NBR                         23940067
                                             TO PV-DISPLAY-XFER-LNE-NBR 23950067
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     23960067
                                             TO DP013-MESSAGE-TEXT (3)  23970067
                       MOVE ASC-RECEIPT-TIMESTAMP                       23980067
                                             TO DP013-MESSAGE-TEXT (4)  23990067
                       MOVE SQLCA            TO DP013-SQLCA             24000067
                       MOVE 'TTFITRC'       TO DP013-DB2-TABLE-NAME (1) 24010067
                       SET DP013-DB2-ABEND                              24020067
                       DP013-XCTL-DISPLAY-RESTART                       24030067
                                            TO TRUE                     24040067
                       PERFORM DP013-0000-PROCESS-ABEND                 24050067
               END-EVALUATE                                             24060067
           END-PERFORM.                                                 24070067
                                                                        24080067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          24090067
                   MOVE 'INSERT XFER ITM RECEIPT FOR XFER_DKEY_ID/XFER_L24100067
      -                 'NE_NBR/XFER_RCPT_TMST: '                       24110067
                                             TO DP013-MESSAGE-TEXT (1)  24120067
                   MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID 24130067
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         24140067
                                             TO DP013-MESSAGE-TEXT (2)  24150067
                   MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR 24160067
                   MOVE PV-DISPLAY-XFER-LNE-NBR                         24170067
                                             TO DP013-MESSAGE-TEXT (3)  24180067
                   MOVE ASC-RECEIPT-TIMESTAMP                           24190067
                                             TO DP013-MESSAGE-TEXT (4)  24200067
                   MOVE SQLCA                TO DP013-SQLCA             24210067
                   MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)24220067
                   SET DP013-DB2-ABEND                                  24230067
                       DP013-XCTL-DISPLAY-RESTART                       24240067
                                            TO TRUE                     24250067
                   PERFORM DP013-0000-PROCESS-ABEND                     24260067
           END-IF.                                                      24270067
                                                                        24280067
       EJECT.                                                           24290067
      *----------------------------------------------------------------*24300067
      *  SELECT A TRANSFER ITEM BY THE ITEM NUMBER.                    *24310067
      *----------------------------------------------------------------*24320067
       7410-SELECT-ITM-BY-ITMNBR.                                       24330067
                                                                        24340067
           MOVE '7410-SELECT-ITM-BY-ITMNBR' TO DP013-PARAGRAPH.         24350067
                                                                        24360067
           INITIALIZE DCLTTFITEM.                                       24370067
           MOVE ASC-XFER-DKEY-ID              TO DK-XFER-DKEY-ID.       24380067
           MOVE ASC-ITEM-NBR (ASC-ITEM-SUB)   TO DK-ITEM-NBR.           24390067
                                                                        24400067
           PERFORM                                                      24410067
                   WITH TEST AFTER                                      24420067
                   VARYING PV-RETRY-COUNT                               24430067
                   FROM 1 BY 1                                          24440067
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                24450067
                      OR SQLCODE = +0                                   24460067
                      OR SQLCODE = +100                                 24470067
                      OR SQLCODE = -811                                 24480067
                                                                        24490067
               EXEC SQL                                                 24500067
                   SELECT  XFER_LNE_NBR                                 24510067
                   INTO   :TFITEM-XFER-LNE-NBR                          24520067
                   FROM    TTFITEM                                      24530067
                   WHERE  XFER_DKEY_ID  =  :DK-XFER-DKEY-ID             24540067
                     AND  ITM_NBR       =  :DK-ITEM-NBR                 24550067
               END-EXEC                                                 24560067
                                                                        24570067
               EVALUATE TRUE                                            24580067
                   WHEN SQLCODE = ZERO                                  24590067
                   WHEN SQLCODE = -811                                  24600067
                        SET PS-ITEM-ON-TRANSFER       TO TRUE           24610067
                   WHEN SQLCODE = +100                                  24620067
                        SET PS-ITEM-NOT-ON-TRANSFER   TO TRUE           24630067
                   WHEN SQLCODE = -904                                  24640067
                   WHEN SQLCODE = -913                                  24650067
                       CONTINUE                                         24660067
                   WHEN OTHER                                           24670067
                      MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR: '24680067
                                             TO DP013-MESSAGE-TEXT (1)  24690067
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 24700067
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     24710067
                                             TO DP013-MESSAGE-TEXT (2)  24720067
                       MOVE DK-ITEM-NBR TO PV-DISPLAY-ITM-NBR           24730067
                       MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (3)24740067
                       MOVE SQLCA            TO DP013-SQLCA             24750067
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)24760067
                       SET DP013-DB2-ABEND                              24770067
                       DP013-XCTL-DISPLAY-RESTART                       24780067
                                            TO TRUE                     24790067
                       PERFORM DP013-0000-PROCESS-ABEND                 24800067
               END-EVALUATE                                             24810067
           END-PERFORM.                                                 24820067
                                                                        24830067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          24840067
               MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR: '       24850067
                                           TO DP013-MESSAGE-TEXT (1)    24860067
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     24870067
               MOVE PV-DISPLAY-XFER-DKEY-ID  TO DP013-MESSAGE-TEXT (2)  24880067
               MOVE DK-ITEM-NBR     TO PV-DISPLAY-ITM-NBR               24890067
               MOVE PV-DISPLAY-ITM-NBR   TO DP013-MESSAGE-TEXT (3)      24900067
               MOVE SQLCA                TO DP013-SQLCA                 24910067
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    24920067
               SET DP013-DB2-ABEND                                      24930067
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   24940067
               PERFORM DP013-0000-PROCESS-ABEND                         24950067
           END-IF.                                                      24960067
                                                                        24970067
       EJECT.                                                           24980067
051203*----------------------------------------------------------------*24990075
051203*SELECT A TRANSFER ITEM BY THE KOHLS UPC, SCAN UPC AND ITEM      *25000075
051203*----------------------------------------------------------------*25010075
051203 7420-DUMMY-ON-TRANSFER.                                          25020075
                                                                        25030075
051203     MOVE '7420-DUMMY-ON-TRANSFER' TO DP013-PARAGRAPH.            25040075
                                                                        25050075
051203     MOVE ASC-XFER-DKEY-ID             TO DK-XFER-DKEY-ID.        25060075
051203     MOVE ASC-UPC-N     (ASC-ITEM-SUB) TO TFITEM-SCN-UPC-NBR.     25070075
051203     MOVE ASC-UPC-N     (ASC-ITEM-SUB) TO TFITEM-KOHLS-UPC-NBR.   25080077
051203     MOVE ASC-PRICE-N   (ASC-ITEM-SUB) TO TFITEM-XFER-PRIC-AMT.   25090076
                                                                        25100075
051203     PERFORM WITH TEST AFTER                                      25110075
051203             VARYING PV-RETRY-COUNT                               25120075
051203             FROM 1 BY 1                                          25130075
051203             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                25140075
051203                OR SQLCODE = +0                                   25150075
051203                OR SQLCODE = +100                                 25160075
051203                OR SQLCODE = -811                                 25170075
                                                                        25180075
051203         EXEC SQL                                                 25190075
051203             SELECT XFER_LNE_NBR                                  25200075
051203             INTO  :TFITEM-XFER-LNE-NBR                           25210075
051203             FROM   TTFITEM                                       25220075
051203             WHERE  XFER_DKEY_ID  = :DK-XFER-DKEY-ID              25230075
051203                AND ITM_NBR       = 0                             25240075
051203                AND SCN_UPC_NBR   = :TFITEM-SCN-UPC-NBR           25250075
051203                AND KOHLS_UPC_NBR = :TFITEM-KOHLS-UPC-NBR         25260075
051203                AND XFER_PRIC_AMT = :TFITEM-XFER-PRIC-AMT         25270076
051203         END-EXEC                                                 25280075
                                                                        25290075
051203         EVALUATE TRUE                                            25300075
051203             WHEN SQLCODE = ZERO                                  25310075
051203             WHEN SQLCODE = -811                                  25320075
051203                  SET PS-ITEM-ON-TRANSFER       TO TRUE           25330075
051203             WHEN SQLCODE = +100                                  25340075
051203                  SET PS-ITEM-NOT-ON-TRANSFER   TO TRUE           25350075
051203             WHEN SQLCODE = -904                                  25360075
051203             WHEN SQLCODE = -913                                  25370075
051203                 CONTINUE                                         25380075
051203             WHEN OTHER                                           25390075
051203                MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR: '25400075
051203                                       TO DP013-MESSAGE-TEXT (1)  25410075
051203                 MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 25420075
051203                 MOVE PV-DISPLAY-XFER-DKEY-ID                     25430075
051203                                       TO DP013-MESSAGE-TEXT (2)  25440075
051203                 MOVE DK-ITEM-NBR TO PV-DISPLAY-ITM-NBR           25450075
051203                 MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (3)25460075
051203                 MOVE SQLCA            TO DP013-SQLCA             25470075
051203                 MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)25480075
051203                 SET DP013-DB2-ABEND                              25490075
051203                 DP013-XCTL-DISPLAY-RESTART  TO TRUE              25500075
051203                 PERFORM DP013-0000-PROCESS-ABEND                 25510075
051203         END-EVALUATE                                             25520075
051203     END-PERFORM.                                                 25530075
                                                                        25540075
051203     IF PS-ITEM-ON-TRANSFER                                       25550075
051203         MOVE DP015-RED     TO MR-B-UPC-C (ASC-ITEM-SUB)          25560075
051203         MOVE DP015-REVERSE TO MR-B-UPC-H (ASC-ITEM-SUB)          25570075
051203         IF ASC-NO-ERROR                                          25580075
051203             MOVE PC-TSYMSG-01591    TO DP020-MSG-NUMBER          25590075
051203             SET DP020-MSG-FATAL     TO TRUE                      25600075
051203             MOVE -1        TO MR-B-UPC-L (ASC-ITEM-SUB)          25610075
051203             SET DP030-SET-CURSOR-APPL-2                          25620075
051203                 ASC-ERROR           TO TRUE                      25630075
051203         END-IF                                                   25640075
051203     END-IF.                                                      25650075
                                                                        25660075
051203 EJECT.                                                           25670075
051705*----------------------------------------------------------------*25680088
051705*    GET THE PHYSICAL INVENTORY PERIOD INDICATOR FROM TTFCNTL    *25690088
051705*----------------------------------------------------------------*25700088
051705*7500-READ-CONTROL-TABLE.                                         25710088
051705*                                                                 25720088
051705*    MOVE '7500-READ-CONTROL-TABLE' TO DP013-PARAGRAPH.           25730088
051705*                                                                 25740088
051705*    PERFORM WITH TEST AFTER                                      25750088
051705*            VARYING PV-RETRY-COUNT                               25760088
051705*            FROM 1 BY 1                                          25770088
051705*            UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                25780088
051705*               OR SQLCODE = +0                                   25790088
051705*                                                                 25800088
051705*        EXEC SQL                                                 25810088
051705*            SELECT PHY_INV_PERD_IND                              25820088
051705*                  ,XFER_INV_CTOFF_DTE                            25830088
051705*                  ,MAX_PLND_INV_DTE                              25840088
051705*                  ,MAX_FINCL_BK_DTE                              25850088
051705*             INTO :TFCNTL-PHY-INV-PERD-IND                       25860088
051705*                 ,:TFCNTL-XFER-INV-CTOFF-DTE                     25870088
051705*                 ,:TFCNTL-MAX-PLND-INV-DTE                       25880088
051705*                 ,:TFCNTL-MAX-FINCL-BK-DTE                       25890088
051705*             FROM TTFCNTL                                        25900088
051705*        END-EXEC                                                 25910088
051705*                                                                 25920088
051705*        EVALUATE TRUE                                            25930088
051705*            WHEN SQLCODE = ZERO                                  25940088
051705*                  MOVE TFCNTL-PHY-INV-PERD-IND                   25950088
051705*                                    TO PV-PHY-INV-PERD-IND       25960088
051705*                  MOVE TFCNTL-XFER-INV-CTOFF-DTE                 25970088
051705*                                    TO PV-XFER-INV-CTOFF-DTE     25980088
051705*                  MOVE TFCNTL-MAX-PLND-INV-DTE                   25990088
051705*                                    TO PV-MAX-PLND-INV-DTE       26000088
051705*                  MOVE TFCNTL-MAX-FINCL-BK-DTE                   26010088
051705*                                    TO PV-MAX-FINCL-BK-DTE       26020088
051705*            WHEN SQLCODE = -904                                  26030088
051705*            WHEN SQLCODE = -913                                  26040088
051705*                CONTINUE                                         26050088
051705*            WHEN OTHER                                           26060088
051705*                MOVE 'GET THE PHYSICAL INV. PERIOD INDICATOR'    26070088
051705*                                      TO DP013-MESSAGE-TEXT (1)  26080088
051705*                MOVE SQLCA            TO DP013-SQLCA             26090088
051705*                MOVE 'TTFCNTL'        TO DP013-DB2-TABLE-NAME (1)26100088
051705*                SET DP013-DB2-ABEND                              26110088
051705*                DP013-XCTL-DISPLAY-RESTART                       26120088
051705*                                     TO TRUE                     26130088
051705*                PERFORM DP013-0000-PROCESS-ABEND                 26140088
051705*        END-EVALUATE                                             26150088
051705*    END-PERFORM.                                                 26160088
051705*                                                                 26170088
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          26180088
051705*        MOVE 'MAX RETRIES EXCEEDED READING '                     26190088
051705*                                     TO DP013-MESSAGE-TEXT (1)   26200088
051705*        MOVE SQLCA            TO DP013-SQLCA                     26210088
051705*        MOVE 'TTFCNTL'        TO DP013-DB2-TABLE-NAME (1)        26220088
051705*        SET DP013-DB2-ABEND                                      26230088
051705*            DP013-XCTL-DISPLAY-RESTART TO TRUE                   26240088
051705*        PERFORM DP013-0000-PROCESS-ABEND                         26250088
051705*    END-IF.                                                      26260088
051705*                                                                 26270088
051705*EJECT.                                                           26280088
051705*----------------------------------------------------------------*26290088
051705*    GET THE MAX PLANNED INVENTORY DATE FOR THIS STORE           *26300088
051705*----------------------------------------------------------------*26310088
051705*7600-GET-STR-PLND-INV-DTE.                                       26320088
051705*                                                                 26330088
051705*    MOVE '7600-GET-STR-PLND-INV-DTE' TO DP013-PARAGRAPH.         26340088
051705*                                                                 26350088
051705*    PERFORM WITH TEST AFTER                                      26360088
051705*            VARYING PV-RETRY-COUNT                               26370088
051705*            FROM 1 BY 1                                          26380088
051705*            UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                26390088
051705*               OR SQLCODE = +0                                   26400088
051705*               OR SQLCODE = +100                                 26410088
051705*                                                                 26420088
051705*        EXEC SQL                                                 26430088
051705*            SELECT A.PLND_INV_DTE                                26440088
051705*                  ,A.ACTL_FIN_BK_DTE                             26450088
051705*                  ,A.SCHD_PHY_CNT_IND                            26460088
051705*            INTO :INVPAR-PLND-INV-DTE                            26470088
051705*                 ,:INVPAR-ACTL-FIN-BK-DTE                        26480088
051705*                 ,:INVPAR-SCHD-PHY-CNT-IND                       26490088
051705*            FROM TINVPAR A                                       26500088
051705*            WHERE  A.LOC_NBR    = :DK-STORE-NBR-9                26510088
051705*              AND  A.PLND_INV_DTE < :PC-MAX-DATE                 26520088
051705*              AND  A.PLND_INV_DTE =                              26530088
051705*                   (SELECT MAX(PLND_INV_DTE)                     26540088
051705*                    FROM   TINVPAR B                             26550088
051705*                    WHERE  B.LOC_NBR         = :DK-STORE-NBR-9   26560088
051705*                       AND B.ACTL_FIN_BK_DTE = :PC-MAX-DATE      26570088
051705*                       AND PLND_INV_DTE      < :PC-MAX-DATE)     26580088
051705*        END-EXEC                                                 26590088
051705*                                                                 26600088
051705*        EVALUATE TRUE                                            26610088
051705*            WHEN SQLCODE = ZERO                                  26620088
051705*                IF INVPAR-SCHD-PHY-CNT-IND = PC-YES              26630088
051705*                    SET PV-HOLD-PHYSICAL-COUNT TO TRUE           26640088
051705*                ELSE                                             26650088
051705*                    IF INVPAR-ACTL-FIN-BK-DTE = PC-MAX-DATE      26660088
051705*                        SET PV-HOLD-FAKE-INVENTORY   TO TRUE     26670088
051705*                    ELSE                                         26680088
051705*                        SET PV-HOLD-NO-INVENTORY   TO TRUE       26690088
051705*                    END-IF                                       26700088
051705*                END-IF                                           26710088
051705*            WHEN SQLCODE = +100                                  26720088
051705*                MOVE PV-CURRENT-DATE TO INVPAR-PLND-INV-DTE      26730088
051705*                SET PV-HOLD-NO-INVENTORY   TO TRUE               26740088
051705*            WHEN SQLCODE = -904                                  26750088
051705*            WHEN SQLCODE = -913                                  26760088
051705*                CONTINUE                                         26770088
051705*            WHEN OTHER                                           26780088
051705*                MOVE 'GET THE PLANNED INVENTORY DATE FOR STORE:' 26790088
051705*                                      TO DP013-MESSAGE-TEXT (1)  26800088
051705*                MOVE DK-STORE-NBR-9                              26810088
051705*                                      TO DP013-MESSAGE-TEXT (2)  26820088
051705*                MOVE SQLCA            TO DP013-SQLCA             26830088
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)26840088
051705*                SET DP013-DB2-ABEND                              26850088
051705*                DP013-XCTL-DISPLAY-RESTART                       26860088
051705*                                     TO TRUE                     26870088
051705*                PERFORM DP013-0000-PROCESS-ABEND                 26880088
051705*        END-EVALUATE                                             26890088
051705*    END-PERFORM.                                                 26900088
051705*                                                                 26910088
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          26920088
051705*        MOVE 'MAX RETRIES EXCEEDED READING FOR STORE:'           26930088
051705*                                     TO DP013-MESSAGE-TEXT (1)   26940088
051705*        MOVE DK-STORE-NBR-9                                      26950088
051705*                                     TO DP013-MESSAGE-TEXT (2)   26960088
051705*        MOVE SQLCA            TO DP013-SQLCA                     26970088
051705*        MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)        26980088
051705*        SET DP013-DB2-ABEND                                      26990088
051705*            DP013-XCTL-DISPLAY-RESTART TO TRUE                   27000088
051705*        PERFORM DP013-0000-PROCESS-ABEND                         27010088
051705*    END-IF.                                                      27020088
051705*                                                                 27030088
051705*EJECT.                                                           27040088
      *----------------------------------------------------------------*27050067
      *  SELECT THE CLEARANCE ITEM FIRST MARKDOWN PRICE.               *27060067
      *----------------------------------------------------------------*27070067
       7750-GET-CLR-ITM-1ST-MKDN-PRIC.                                  27080067
                                                                        27090067
           MOVE '7750-GET-CLR-ITM-1ST-MKDN-PRIC' TO DP013-PARAGRAPH.    27100067
                                                                        27110067
           INITIALIZE DCLTPPCPRC.                                       27120067
           MOVE ASC-ITEM-NBR (ASC-ITEM-SUB) TO DK-ITEM-NBR.             27130067
100404     MOVE PV-NREGN-LOC-SKU-STAT-CDE-9 TO DK-SKU-STATUS-CODE.      27131084
                                                                        27140067
           PERFORM                                                      27150067
                   WITH TEST AFTER                                      27160067
                   VARYING PV-RETRY-COUNT                               27170067
                   FROM 1 BY 1                                          27180067
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                27190067
                      OR SQLCODE = +0                                   27200067
                      OR SQLCODE = +100                                 27210067
                                                                        27220067
               EXEC SQL                                                 27230067
                   SELECT  MAX(RTL_AMT)                                 27240067
                   INTO   :PPCPRC-RTL-AMT :PV-NULL-IND                  27250067
                   FROM    TPPCPRC                                      27260067
                   WHERE   TSK_ITM_NBR  =  :DK-ITEM-NBR                 27270067
                       AND STR_NBR      =  :PC-ZERO                     27280067
100404                 AND STATUS_CDE   =  :DK-SKU-STATUS-CODE          27290084
               END-EXEC                                                 27300067
                                                                        27310067
               EVALUATE TRUE                                            27320067
                   WHEN SQLCODE = ZERO                                  27330067
                   WHEN SQLCODE = -904                                  27340067
                   WHEN SQLCODE = -913                                  27350067
                       CONTINUE                                         27360067
                   WHEN SQLCODE = +100                                  27370067
100404                 MOVE XST00008-UNT-RTL-AMT TO PPCPRC-RTL-AMT      27380084
                   WHEN OTHER                                           27390067
                       MOVE 'SELECT THE 1ST MARKDOWN PRICE FOR A CLEARAN27400067
100404-                 'CE ITEM.  SKXREF-ITM-NBR:'                     27410084
                                             TO DP013-MESSAGE-TEXT (1)  27420067
                       MOVE DK-ITEM-NBR  TO PV-DISPLAY-ITM-NBR          27430067
                       MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (2)27440067
                       MOVE SQLCA            TO DP013-SQLCA             27450067
                       MOVE 'TPPCPRC'        TO DP013-DB2-TABLE-NAME (1)27460067
                       SET DP013-DB2-ABEND                              27470067
                       DP013-XCTL-DISPLAY-RESTART                       27480067
                                            TO TRUE                     27490067
                       PERFORM DP013-0000-PROCESS-ABEND                 27500067
               END-EVALUATE                                             27510067
           END-PERFORM.                                                 27520067
                                                                        27530067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          27540067
               MOVE 'SELECT THE 1ST MARKDOWN PRICE FOR A CLEARANCE I    27550067
100404-                 'TEM.  SKXREF-ITM-NBR:'                         27560084
                                         TO DP013-MESSAGE-TEXT (1)      27570084
               MOVE DK-ITEM-NBR          TO PV-DISPLAY-ITM-NBR          27580084
               MOVE PV-DISPLAY-ITM-NBR   TO DP013-MESSAGE-TEXT (2)      27590067
               MOVE SQLCA                TO DP013-SQLCA                 27600067
               MOVE 'TPPCPRC'            TO DP013-DB2-TABLE-NAME (1)    27610067
               SET DP013-DB2-ABEND                                      27620067
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   27630067
                   PERFORM DP013-0000-PROCESS-ABEND                     27640067
           END-IF.                                                      27650067
           IF PV-NULL-IND IS NEGATIVE                                   27660067
100404         MOVE XST00008-UNT-RTL-AMT TO PPCPRC-RTL-AMT              27661084
           END-IF.                                                      27680067
                                                                        27690067
       EJECT.                                                           27700067
051705*----------------------------------------------------------------*27710088
051705*    GET THE MAX XFER INVENTORY CUTOFF DATE FOR THIS STORE       *27720088
051705*----------------------------------------------------------------*27730088
051705*7800-GET-STORE-XFER-CTOFF-DTE.                                   27740088
051705*                                                                 27750088
051705*    MOVE '7800-GET-STORE-XFER-CTOFF-DTE' TO DP013-PARAGRAPH.     27760088
051705*                                                                 27770088
051705*    PERFORM                                                      27780088
051705*            WITH TEST AFTER                                      27790088
051705*            VARYING PV-RETRY-COUNT                               27800088
051705*            FROM 1 BY 1                                          27810088
051705*            UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                27820088
051705*               OR SQLCODE = +0                                   27830088
051705*               OR SQLCODE = +100                                 27840088
051705*                                                                 27850088
051705*        EXEC SQL                                                 27860088
051705*            SELECT MAX(XFER_INV_CTOFF_DTE)                       27870088
051705*            INTO  :INVPAR-XFER-INV-CTOFF-DTE :PV-NULL-IND        27880088
051705*            FROM   TINVPAR                                       27890088
051705*            WHERE  LOC_NBR    = :DK-STORE-NBR-9                  27900088
051705*        END-EXEC                                                 27910088
051705*                                                                 27920088
051705*        EVALUATE TRUE                                            27930088
051705*            WHEN SQLCODE = ZERO                                  27940088
051705*            WHEN SQLCODE = -904                                  27950088
051705*            WHEN SQLCODE = -913                                  27960088
051705*                CONTINUE                                         27970088
051705*            WHEN SQLCODE = +100                                  27980088
051705*                MOVE PC-MIN-DATE   TO INVPAR-XFER-INV-CTOFF-DTE  27990088
051705*            WHEN OTHER                                           28000088
051705*                MOVE 'GET THE TRANSFER CUTOFF DATE FOR STORE:'   28010088
051705*                                      TO DP013-MESSAGE-TEXT (1)  28020088
051705*                MOVE DK-STORE-NBR-9                              28030088
051705*                                      TO DP013-MESSAGE-TEXT (2)  28040088
051705*                MOVE SQLCA            TO DP013-SQLCA             28050088
051705*                MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)28060088
051705*                SET DP013-DB2-ABEND                              28070088
051705*                DP013-XCTL-DISPLAY-RESTART                       28080088
051705*                                     TO TRUE                     28090088
051705*                PERFORM DP013-0000-PROCESS-ABEND                 28100088
051705*        END-EVALUATE                                             28110088
051705*    END-PERFORM.                                                 28120088
051705*                                                                 28130088
051705*    IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          28140088
051705*        MOVE 'MAX RETRIES EXCEEDED READING FOR STORE:'           28150088
051705*                                     TO DP013-MESSAGE-TEXT (1)   28160088
051705*        MOVE DK-STORE-NBR-9                                      28170088
051705*                                     TO DP013-MESSAGE-TEXT (2)   28180088
051705*        MOVE SQLCA            TO DP013-SQLCA                     28190088
051705*        MOVE 'TINVPAR'        TO DP013-DB2-TABLE-NAME (1)        28200088
051705*        SET DP013-DB2-ABEND                                      28210088
051705*           DP013-XCTL-DISPLAY-RESTART TO TRUE                    28220088
051705*        PERFORM DP013-0000-PROCESS-ABEND                         28230088
051705*    END-IF.                                                      28240088
051705*                                                                 28250088
051705*    IF PV-NULL-IND < 0                                           28260088
051705*        MOVE PC-MIN-DATE             TO INVPAR-XFER-INV-CTOFF-DTE28270088
051705*    END-IF.                                                      28280088
051705*                                                                 28290088
051705*EJECT.                                                           28300088
      ******************************************************************28310067
       7900-CHECK-REGN-PRC.                                             28320067
                                                                        28330067
           MOVE '7900-CHECK-REGN-PRC' TO DP013-PARAGRAPH.               28340067
                                                                        28350067
           PERFORM WITH TEST AFTER                                      28380067
                   VARYING PV-RETRY-COUNT                               28390067
                   FROM 1 BY 1                                          28400067
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                28410067
                      OR SQLCODE = +0                                   28420067
                      OR SQLCODE = +100                                 28430067
                                                                        28440067
               EXEC SQL                                                 28450067
100404             SELECT  LOC_SKU_STAT_CDE                             28451084
100404                    ,UNT_RTL_AMT                                  28452084
100404               INTO :PV-REGN-LOC-SKU-STAT-CDE                     28453084
100404                   ,:XST00008-UNT-RTL-AMT                         28454084
100404               FROM  XST_SKU_LOC A                                28455084
100404              WHERE  A.INTR_UPC_ID  = :XST00008-INTR-UPC-ID       28456084
100404                AND  A.LOC_NBR      = :DK-STORE-NBR               28457084
100404                AND  A.BEG_TMST    <= CURRENT TIMESTAMP           28458084
100404                AND  (A.END_TMST    > CURRENT TIMESTAMP           28459084
100404                 OR  A.END_TMST IS NULL)                          28459184
               END-EXEC                                                 28560067
                                                                        28570067
               EVALUATE TRUE                                            28580067
                   WHEN SQLCODE = ZERO                                  28590067
100404                 IF PV-REGN-LOC-SKU-STAT-CDE = PC-CLEARANCE       28591084
100404                     MOVE XST00008-UNT-RTL-AMT TO PV-CUR-RTL-AMT  28592084
                                                        PV-GP-RTL-AMT   28620084
                           MOVE +1                   TO PV-GP-QTY       28630084
                       END-IF                                           28640067
                   WHEN SQLCODE = -904                                  28650067
                   WHEN SQLCODE = -913                                  28660067
                   WHEN SQLCODE = +100                                  28670067
                       CONTINUE                                         28680067
                   WHEN OTHER                                           28690067
100404                 MOVE 'SELECT DATA FROM XST_SKU_LOC'              28700084
                                             TO DP013-MESSAGE-TEXT (1)  28710067
                       MOVE SQLCA            TO DP013-SQLCA             28720067
100404                 MOVE 'XST_SKU_LOC'    TO DP013-DB2-TABLE-NAME (1)28730084
100404                 MOVE SKXREF-ITM-NBR   TO PV-DISPLAY-ITM-NBR      28740084
                       MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (2)28750067
                       SET DP013-DB2-ABEND                              28760067
                           DP013-XCTL-DISPLAY-RESTART                   28770067
                                         TO TRUE                        28780067
                       PERFORM DP013-0000-PROCESS-ABEND                 28790067
               END-EVALUATE                                             28800067
           END-PERFORM.                                                 28810067
                                                                        28820067
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          28830067
100404         MOVE 'SELECT DATA FROM XST_SKU_LOC'                      28840084
                                     TO DP013-MESSAGE-TEXT (1)          28850067
               MOVE SQLCA            TO DP013-SQLCA                     28860067
100404         MOVE 'XST_SKU_LOC'    TO DP013-DB2-TABLE-NAME (1)        28870084
100404         MOVE SKXREF-ITM-NBR   TO PV-DISPLAY-ITM-NBR              28880084
               MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (2)        28890067
               SET DP013-DB2-ABEND                                      28900067
                   DP013-XCTL-DISPLAY-RESTART                           28910067
                                 TO TRUE                                28920067
               PERFORM DP013-0000-PROCESS-ABEND                         28930067
           END-IF.                                                      28940067
                                                                        28950067
       EJECT.                                                           28960067
      ***************************************************************** 28970067
       9000-CHECK-RETAIL-ITEMS.                                         28980067
                                                                        28990067
           IF  ASC-RTL-ITEM-NOT-UPDATED (ASC-ITEM-SUB)                  29000074
           AND ASC-RTL-QTY (ASC-ITEM-SUB) > SPACES                      29010074
               MOVE ASC-RTL-QTY-N (ASC-ITEM-SUB) TO PV-HOLD-QTY         29020067
               SET ASC-RTL-ITEM-UPDATED (ASC-ITEM-SUB) TO TRUE          29030067
               PERFORM 9050-COMPLETE-RETAIL-ITEMS                       29040067
                       VARYING PV-ITEM                                  29050067
                       FROM 1 BY 1                                      29060067
                       UNTIL PV-ITEM >  PC-ITEMS-PER-PANEL              29070067
               PERFORM 9100-INSERT-RETAIL-ITEMS                         29080067
               PERFORM 7350-INSERT-RTL-ITM-RCPT                         29090067
               PERFORM 7300-INSERT-ADJUSTMENT-ROW                       29100067
           END-IF.                                                      29110067
                                                                        29120067
       EJECT.                                                           29130067
      ***************************************************************** 29140067
       9050-COMPLETE-RETAIL-ITEMS.                                      29150067
           IF ASC-RTL-ITEM-NOT-UPDATED (PV-ITEM)                        29151078
               IF ASC-KOHLS-UPC-DIGITS (PV-ITEM) = '0400' AND           29152078
                  ASC-KOHLS-DUMMY-SKU  (PV-ITEM) = '000'                29152178
                   IF (ASC-KOHLS-UPC   (PV-ITEM) =                      29153078
                       ASC-KOHLS-UPC   (ASC-ITEM-SUB)) AND              29154078
                      (ASC-PRICE (PV-ITEM) =                            29155078
                       ASC-PRICE (ASC-ITEM-SUB))                        29156078
                        ADD ASC-RTL-QTY-N (PV-ITEM)                     29157078
                                        TO PV-HOLD-QTY                  29158078
                        SET ASC-RTL-ITEM-UPDATED (PV-ITEM)              29159078
                                        TO TRUE                         29159178
                   END-IF                                               29159278
               ELSE                                                     29159378
                   IF (ASC-ITEM-NBR  (PV-ITEM) =                        29159478
                       ASC-ITEM-NBR  (ASC-ITEM-SUB)) AND                29159578
                      (ASC-PRICE (PV-ITEM) =                            29159678
                       ASC-PRICE (ASC-ITEM-SUB))                        29159778
                        ADD ASC-RTL-QTY-N (PV-ITEM)                     29159878
                                        TO PV-HOLD-QTY                  29159978
                        SET ASC-RTL-ITEM-UPDATED (PV-ITEM)              29160078
                                        TO TRUE                         29161078
                   END-IF                                               29162078
               END-IF                                                   29163078
           END-IF.                                                      29164078
       EJECT                                                            29165078
                                                                        29170074
      ******************************************************************29260067
       9100-INSERT-RETAIL-ITEMS.                                        29270067
                                                                        29280067
           MOVE '9100-INSERT-RETAIL-ITEMS' TO DP013-PARAGRAPH.          29290067
                                                                        29300067
           INITIALIZE DCLTTFITEM.                                       29310067
           MOVE ASC-XFER-DKEY-ID           TO DK-XFER-DKEY-ID.          29320067
           ADD +1                          TO PV-LINE-NBR.              29330067
           MOVE PV-LINE-NBR                TO TFITEM-XFER-LNE-NBR.      29340067
                                                                        29350067
           IF  ASC-UPC (ASC-ITEM-SUB) > SPACES                          29360074
               MOVE ASC-UPC-N (ASC-ITEM-SUB)  TO TFITEM-SCN-UPC-NBR     29370074
           END-IF.                                                      29380067
                                                                        29390067
           MOVE ASC-KOHLS-UPC (ASC-ITEM-SUB) TO TFITEM-KOHLS-UPC-NBR.   29400067
           MOVE ASC-ITEM-NBR  (ASC-ITEM-SUB) TO TFITEM-ITM-NBR.         29410067
           MOVE ASC-PRICE-N (ASC-ITEM-SUB)   TO TFITEM-XFER-PRIC-AMT.   29420067
           MOVE ASC-FILE-PRICE (ASC-ITEM-SUB)                           29430067
                                            TO TFITEM-CPLD-RTL-PRIC-AMT.29440067
           MOVE ASC-GROUP-PRICED-SW (ASC-ITEM-SUB)                      29450067
                                            TO TFITEM-ITM-PRIC-MLT-IND. 29460067
           MOVE PV-HOLD-QTY                  TO TFITEM-XFER-QTY.        29470067
           PERFORM WITH TEST AFTER                                      29480067
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   29490067
                   UNTIL SQLCODE = 0                                    29500067
                      OR PV-RETRY-COUNT > PC-MAX-RETRIES                29510067
                                                                        29520067
               EXEC SQL                                                 29530067
                    INSERT                                              29540067
                      INTO TTFITEM                                      29550067
                          (XFER_DKEY_ID                                 29560067
                         , XFER_LNE_NBR                                 29570067
                         , CPLD_RTL_PRIC_AMT                            29580067
                         , SCN_UPC_NBR                                  29590067
                         , KOHLS_UPC_NBR                                29600067
                         , ITM_NBR                                      29610067
                         , XFER_PRIC_AMT                                29620067
                         , ITM_PRIC_MLT_IND                             29630067
                         , XFER_QTY)                                    29640067
                    VALUES                                              29650067
                          (:DK-XFER-DKEY-ID                             29660067
                         , :TFITEM-XFER-LNE-NBR                         29670067
                         , :TFITEM-CPLD-RTL-PRIC-AMT                    29680067
                         , :TFITEM-SCN-UPC-NBR                          29690067
                         , :TFITEM-KOHLS-UPC-NBR                        29700067
                         , :TFITEM-ITM-NBR                              29710067
                         , :TFITEM-XFER-PRIC-AMT                        29720067
                         , :TFITEM-ITM-PRIC-MLT-IND                     29730067
                         , :TFITEM-XFER-QTY)                            29740067
               END-EXEC                                                 29750067
                                                                        29760067
               EVALUATE TRUE                                            29770067
                   WHEN SQLCODE = 0                                     29780067
                   WHEN SQLCODE = -904                                  29790067
                   WHEN SQLCODE = -913                                  29800067
                        CONTINUE                                        29810067
                   WHEN OTHER                                           29820067
                        MOVE 'INSERT A ROW INTO THE TTFITEM TABLE'      29830067
                                          TO DP013-MESSAGE-TEXT(1)      29840067
                        MOVE SQLCA        TO DP013-SQLCA                29850067
                        MOVE 'TTFITEM'    TO DP013-DB2-TABLE-NAME (1)   29860067
                        SET DP013-DB2-ABEND                             29870067
                            DP013-XCTL-DISPLAY-RESTART TO TRUE          29880067
                        PERFORM DP013-0000-PROCESS-ABEND                29890067
               END-EVALUATE                                             29900067
           END-PERFORM.                                                 29910067
                                                                        29920067
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           29930067
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT'     29940067
                                          TO DP013-MESSAGE-TEXT (1)     29950067
               MOVE 'A TRANSFER ITEM'     TO DP013-MESSAGE-TEXT (2)     29960067
               MOVE SQLCA                 TO DP013-SQLCA                29970067
               MOVE 'TTFITEM'             TO DP013-DB2-TABLE-NAME (1)   29980067
               SET DP013-DB2-ABEND                                      29990067
                   DP013-XCTL-DISPLAY-RESTART                           30000067
                                          TO TRUE                       30010067
               PERFORM DP013-0000-PROCESS-ABEND                         30020067
           END-IF.                                                      30030067
                                                                        30040067
       EJECT.                                                           30050067
      ***************************************************************** 30060067
       9200-CHECK-NON-RETAIL-ITEMS.                                     30070067
           IF ASC-NRTL-QTY (ASC-ITEM-SUB) > SPACES                      30080067
               PERFORM 9300-INSERT-NON-RETAIL-ITEMS                     30090067
               PERFORM 7360-INSERT-NON-RTL-ITM-RCPT                     30100067
           END-IF.                                                      30110067
                                                                        30120067
       EJECT.                                                           30130067
      ***************************************************************** 30140067
       9300-INSERT-NON-RETAIL-ITEMS.                                    30150067
                                                                        30160067
           MOVE '9300-INSERT-NON-RETAIL-ITEMS' TO DP013-PARAGRAPH.      30170067
                                                                        30180067
           INITIALIZE DCLTTFITEM.                                       30190067
           MOVE ASC-XFER-DKEY-ID           TO DK-XFER-DKEY-ID.          30200067
           ADD +1                          TO PV-LINE-NBR.              30210067
           MOVE PV-LINE-NBR                TO TFITEM-XFER-LNE-NBR.      30220067
           MOVE ASC-ITEM-DESC1 (ASC-ITEM-SUB)                           30230067
                                            TO TFITEM-NRTL-1ST-LNE-DESC.30240067
           MOVE ASC-ITEM-DESC2 (ASC-ITEM-SUB)                           30250067
                                            TO TFITEM-NRTL-2ND-LNE-DESC.30260067
           MOVE ASC-NRTL-QTY-N (ASC-ITEM-SUB) TO TFITEM-XFER-QTY.       30270067
           MOVE ASC-NRTL-DEPT (ASC-ITEM-SUB)  TO TFITEM-NRTL-DEPT-NBR   30280067
           MOVE ASC-FIXTURE  (ASC-ITEM-SUB)   TO TFITEM-NRTL-FIXT-ID.   30290067
                                                                        30300067
           PERFORM WITH TEST AFTER                                      30310067
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   30320067
                   UNTIL SQLCODE = 0                                    30330067
                     OR PV-RETRY-COUNT > PC-MAX-RETRIES                 30340067
                                                                        30350067
               EXEC SQL                                                 30360067
                    INSERT                                              30370067
                      INTO TTFITEM                                      30380067
                          (XFER_DKEY_ID                                 30390067
                         , XFER_LNE_NBR                                 30400067
                         , NRTL_1ST_LNE_DESC                            30410067
                         , NRTL_2ND_LNE_DESC                            30420067
                         , NRTL_FIXT_ID                                 30430067
                         , NRTL_DEPT_NBR                                30440067
                         , XFER_QTY)                                    30450067
                    VALUES                                              30460067
                          (:DK-XFER-DKEY-ID                             30470067
                         , :TFITEM-XFER-LNE-NBR                         30480067
                         , :TFITEM-NRTL-1ST-LNE-DESC                    30490067
                         , :TFITEM-NRTL-2ND-LNE-DESC                    30500067
                         , :TFITEM-NRTL-FIXT-ID                         30510067
                         , :TFITEM-NRTL-DEPT-NBR                        30520067
                         , :TFITEM-XFER-QTY)                            30530067
               END-EXEC                                                 30540067
                                                                        30550067
               EVALUATE TRUE                                            30560067
                   WHEN SQLCODE = 0                                     30570067
                   WHEN SQLCODE = -904                                  30580067
                   WHEN SQLCODE = -913                                  30590067
                        CONTINUE                                        30600067
                   WHEN OTHER                                           30610067
                        MOVE 'INSERT A ROW INTO THE TTFITEM TABLE'      30620067
                                          TO DP013-MESSAGE-TEXT(1)      30630067
                        MOVE SQLCA        TO DP013-SQLCA                30640067
                        MOVE 'TTFITEM'    TO DP013-DB2-TABLE-NAME (1)   30650067
                        SET DP013-DB2-ABEND                             30660067
                            DP013-XCTL-DISPLAY-RESTART TO TRUE          30670067
                        PERFORM DP013-0000-PROCESS-ABEND                30680067
               END-EVALUATE                                             30690067
           END-PERFORM.                                                 30700067
                                                                        30710067
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           30720067
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT'     30730067
                                          TO DP013-MESSAGE-TEXT (1)     30740067
               MOVE 'A TRANSFER ITEM'     TO DP013-MESSAGE-TEXT (2)     30750067
               MOVE SQLCA                 TO DP013-SQLCA                30760067
               MOVE 'TTFITEM'             TO DP013-DB2-TABLE-NAME (1)   30770067
               SET DP013-DB2-ABEND                                      30780067
                   DP013-XCTL-DISPLAY-RESTART                           30790067
                                          TO TRUE                       30800067
               PERFORM DP013-0000-PROCESS-ABEND                         30810067
           END-IF.                                                      30820067
                                                                        30830067
       EJECT.                                                           30840067
      *----------------------------------------------------------------*30850067
      *    ABEND PROCESSOR MODULE                                      *30860067
      *----------------------------------------------------------------*30870067
           COPY DPPD013.                                                30880079
