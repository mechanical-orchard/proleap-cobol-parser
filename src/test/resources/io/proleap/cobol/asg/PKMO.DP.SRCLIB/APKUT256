000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.    APKUT256.                                         00030000
000400                                                                  00040000
000500 AUTHOR.        CRAIG VOSKUIL - STRATAGEM.                        00050000
000600                                                                  00060000
000700 DATE-WRITTEN.  JUNE 1994.                                        00070000
000800                                                                  00080000
000900 DATE-COMPILED.                                                   00090000
001000******************************************************************00100000
001100*                                                                *00110000
001200*               UNJOURNALIZED RECEIPT EXTRACT                    *00120000
001300*                                                                *00130000
001400******************************************************************00140000
001500*                                                                *00150000
001600*  DB2:                                                          *00160000
001700* 1) PURCHASE TABLE                                  (TPURCHS)   *00170000
001800* 2) PURCHASE ITEM TABLE                             (TPURITM)   *00180000
001900* 3) RECEIVER TABLE                                  (TRECEIV)   *00190000
002000* 4) RECEIVER DISTRIBUTION TABLE                     (TRECDIS)   *00200000
002100* 5) RECEIVER ITEM TABLE                             (TRECITM)   *00210000
002200* 6) MERCHANDISE AREA TABLE                          (TMDSEAR)   *00220000
002300* 7) EXTERNAL ENTERPRISE TABLE                       (TEXTENT)   *00230000
002400* 8) EXTERNAL ENTERPRISE NAME TABLE                  (TENTNME)   *00240000
002500*                                                                *00250006
002600*  OUTPUT:                                                       *00260007
002700* 1) UNJOURNALED-RECEIPTS-EXTRACT                    (APRD042)   *00270007
002800* 2) UNJOURNALED-RECEIPTS-ERRORS (REMOVED 9/30/04)   (DPWS133O)  *00280007
002900* 3) UNJOURNALED-RECEIPTS PRIVATE LABEL-EXTRACT      (APRD075)   *00290007
003000*                                                                *00300000
003100******************************************************************00310000
003200*    THIS MODULE WILL CREATE AN EXTRACT OF UNJOURNALIZED         *00320000
003300*    RECEIPTS. THIS EXTRACT WILL BE USED FOR WEEKLY REPORTING    *00330000
003400*    OF AGED DEBITS AND OPEN-TO-PAY AS WELL AS REPORTING         *00340000
003500*    UNJOURNALIZED RECEIPTS TO THE ACCOUNTS PAYABLE DEPARTMENT   *00350000
003600*    AND MERCHANDISE LEDGER. THE UNJOURNALIZED RECEIPTS ARE      *00360000
003700*    REPORTED BY PURCHASE ORDER, STORE AND CLASS.                *00370000
003800*                                                                *00380000
003900*    THERE IS ONE SOURCE OF UNJOURNALIZED RECEPITS, THE RECEIVING*00390000
004000*    SYSTEM TABLES.  THE RECEIVER IS PROCESSED BY A FETCH.  AS   *00400000
004100*    EACH ROW IS FETCHED, A CURSOR IS OPENED FOR THE RECEIVING   *00410000
004200*    DISTRIBUTION TABLE.  AT THIS POINT, VENDOR AND PURCHASE     *00420000
004300*    ORDER INFORMATION IS SELECTED AND MOVED TO THE EXTRACT      *00430000
004400*    RECORD.                                                     *00440000
004500*    AT THE END OF THE JOB, TOTALS ARE DISPLAYED.                *00450000
004600******************************************************************00460000
004700*   DATE   *           D E S C R I P T I O N            * CHANGE *00470000
004800*   10/27/94       MIKE GILL - GREENBRIER & RUSSEL      * CHANGE *00480000
004900*                  CHANGED REFERANCES TO PO-LNE-NBR     * CHANGE *00490000
005000*                  TO APP-PO-LNE-NBR                    * CHANGE *00500000
005100*                                                                *00510000
005200*   03/15/95   ADDED CONDITION TO RECEIVER_CURSOR TO CHECK FOR   *00520000
005300*   MKK        THE FASHION SALES POSTING TIMESTAMP.              *00530000
005400*   10/10/96   ADDED CHECK FOR SQLCODE TO OPEN/CLOSE CURSORS     *00540000
005500*   MJW                                                          *00550000
005600*   11/06/96   CHANGED TO SUPPORT AUTOMATIC WRITE-OFF OF         *00560000
005700*              UNJOURNALIZED RECEIPTS                            *00570000
005800*              - UPDATED RECEIVER CURSOR AND RECP-DIST CURSOR TO *00580000
005900*                INCLUDE RECEIVERS THAT WERE WRITTEN OFF         *00590000
006000*              - POPULATE NEW FIELD ON THE EXTRACT               *00600000
006100*                INT-RC2-MKDATE-REFMT                            *00610000
006200*   PDV                                            WR#3803       *00620000
006300*   04/??/97   CHANGED LOGIC TO EVALUATE THE TSTR000 STORE TYPE  *00630000
006400*              TO DETERMINE IF TO BE CODED AS 'DS' OR 'DC'       *00640000
006500*   MJW                                                          *00650000
006600*                                                                 00660000
006700*   02/05/98                                        WR#3974      *00670000
006800*               CHANGED THE LOGIC TO RETRIEVE THE INHOUSE NUMBER *00680000
006900*               OFF THE DB2 TABLES WHEN THE SELECT VENDOR IS     *00690000
007000*               PERFORMED.  ALSO CHANGED THE COPY BOOK INTRANEX  *00700000
007100*               TO HOLD THE INHOUSE NUMBER THAT IS PASSED ON TO  *00710000
007200*               ML.                                              *00720000
007300*   ECB                                                          *00730000
007400*                                                                *00740000
007500* 02/03/98   ROBIN BERNOSKI                  WR/IR #: WR5703     *00750000
007600*            - MODIFIED THE MANNER IN WHICH THE STANDARD DATE    *00760000
007700*              ROUTINE, DPKUT500, IS TO BE CALLED WITHIN A       *00770000
007800*              PROGRAM SO THAT THE CALL IS DYNAMIC.              *00780000
007900*                                                                *00790000
008000* 08/17/98   CAROLYN GIFFORD                 WR/IR #: 10199      *00800000
008100*            - REMOVE CONSIGNMENT PROCESSING FOR DEPARTMENT      *00810000
008200*              #127.                                             *00820000
008300*                                                                *00830000
008400* 09/01/98    Y2K. EXPAND JULIAN DATE WS-JULIAN-CUTOFF-DATE TO   *00840000
008500*             PIC 9(07). ADD CENTURY TO WS-PRINT-DATE AND        *00850000
008600*             RECEIPT-DATE.                                      *00860000
008700*   MADE BY:  CAROLYN GIFFORD                    WR# 6041        *00870000
008800*                                                                *00880000
008900* 08/03/99    Y2K. REPLACED THE INTRANEX COPYBOOK WITH THE       *00890000
009000*             APRD042 COPYBOOK.                                  *00900000
009100*   MADE BY:  ROBIN BERNOSKI                     WR# 6041        *00910000
009200*                                                               * 00920000
009300* 12/08/1999 JILL JUEL                   WR/IR #: WR6041        * 00930000
009400*            - MODIFIED THE CHECK ON THE DATE ROUTINE TO        * 00940000
009500*              CONFORM WITH Y2K STANDARDS BY ADDING             * 00950000
009600*              DPG54-WARNING-ERROR.                             * 00960000
009700*                                                               * 00970000
009800* 03/03/2000 ROBIN BERNOSKI              WR/IR #: 20875         * 00980000
009900*            - ADDED AP042-PO-TYP-CDE AND AP042-COLBY-IND TO    * 00990000
010000*              THE APRD042 COPYBOOK AND MODIFIED PROGRAM TO     * 01000000
010100*              POPULATE THE FIELDS EACH TIME A NEW RECORD IS    * 01010000
010200*              RETRIEVED.  THIS WAS ADDED TO DEVELOP THE NEW    * 01020000
010300*              REPORT PROGRAM TO PRODUCE THE IMPORT             * 01030000
010400*              UNJOURNALIZED RECEIPT REPORT.                    * 01040000
010500*                                                               * 01050000
010600* 07/11/2000 ROBIN BERNOSKI              WR/IR #: 20704         * 01060000
010700*            - REMOVED PARAGRAPH 9040-SELECT-STORE AND REPLACED * 01070000
010800*              IT WITH A MOVE OF RECDIS-STR-NBR TO WS-DECIMAL-  * 01080000
010900*              STR-NBR.                                         * 01090000
011000*                                                               * 01100000
011100* 01/24/2002 MIKE BESKE                  WR/IR #: 23005         * 01110000
011200*            - ADDED CODE TO UNPACK AND STRIP OFF THE SIGN FOR  * 01120000
011300*              THE REC-SEQ-NBR BEING MOVED TO THE AP042-REC-SEQ-* 01130000
011400*              NBR.                                             * 01140000
011500*                                                               * 01150000
011600* 02/07/2003                                                    * 01160000
011700*    CHANGE MADE: ARKPO PHASE3 PROJECT.                         * 01170000
011800*    ADDED PGM TITLE TO MATCH SPEC TITLE.                       * 01180000
011900*    ADDED PGM COMMENT BLOCK WITH THE FILENAMES AND DB2 TABLES. * 01190000
012000*    RECOMPILED TO PICK UP MODIFIED COPYBOOK.                   * 01200000
012100* MADE BY:  MIKE BESKE                          WR#: 23500      * 01210000
012200*                                                               * 01220000
012300*  DATE  05/05/2003                                             * 01230000
012400*      CHANGE MADE: CHANGE NEEDED FOR ARK PO NI-SKU.            * 01240000
012500*      REMOVED ALL REFERENCES FOR PV-SKU-NBR. REMOVED REFERENCE * 01250000
012600*      TO SKU-SEQ-NBR IN 9050-SELECT-CON-DIS-PO.                * 01260000
012700*      MADE BY: ROLLIN KRING            WR/IR #: WR22557        * 01270000
012800*                                                               * 01280000
012900*  DATE  04/01/2004                                             * 01290000
013000*      CHANGE MADE: CLEANED UP/INCREASED W/S STORE FIELDS FROM  * 01300000
013100*      3 TO 4 CHARS.  REMOVED TSTR000 AND REPLACED IT WITH      * 01310000
013200*      XFT00003 (FI_XFT_LOC).  RECODED PARA 9041- TO USE THE    * 01320000
013300*      NEW LOCATION TABLE INSTEAD OF THE STORE TABLE.           * 01330000
013400*      MADE BY: MIKE BESKE              WR/IR #: WR25805        * 01340000
013500*                                                               * 01350000
013600*  DATE  09/30/2004                                             * 01360007
013700*      CHANGE MADE: REMOVED XFT00003 (FI_XFT_LOC) AFTER MORE    * 01370000
013800*      ANALYSIS IT WAS FOUND THAT THIS CALL WAS NOT NECESSARY   * 01380000
013900*      TO THE PROCESSING.  NO DATA WAS USED FROM THIS CALL IT   * 01390000
014000*      WAS DOING EXISTANCE CHECKING ON THE OPER-UNT-ID, WHICH   * 01400000
014100*      IS NO LONGER REQUIRED. ALSO REMOVED ERROR REPORT SINCE   * 01410000
014200*      THERE WAS NO REPORT ID THE REPORT COULD NOT BE VIEWED.   * 01420000
014300*      MADE BY: L SCHALLHORN            WR/IR #: P000690867     * 01430000
014400*                                                               * 01440000
014500*  DATE  03/27/2007                                             * 01450000
014600*      CHANGE MADE: RECOMPILE FROM PRODUCTION TO INCORPORATE    * 01460000
014700*      CHANGES TO PS_XFT_LOC TABLE FOR STORE DEMOGRAPHICS.      * 01470000
014800*      MADE BY: KEVIN CATLIN            WR/IR #: WR31452        * 01480000
014900*                                                               * 01490000
015000*  DATE  02/04/2008                                             * 01500000
015100*      CHANGE MADE: WHEN PO IS DOMESTIC USE FIRST COST FOR UNIT * 01510000
015200*      COST - WHEN IMPORT USE UNIT COST                         * 01520000
015300*      ALSO REMOVED ALL REFERENCES TO XFT00003.                 * 01530000
015400*      MADE BY: CHRISTINE TWIEHAUS      WR/IR #: WR32664        * 01540000
015500*                                                               * 01550000
015600*  DATE  05/28/2008                                             * 01560000
015700*      CHANGE MADE: ADD OUTPUT FILE FOR DOMESTIC PRIVATE LABEL  * 01570000
015800*      POS - NEW COPYBOOK APRD075.  REMOVED SOME DEAD CODE      * 01580000
015900*      MADE BY: GREG WISIALOWSKI        WR/IR #: WR34309        * 01590000
016000*                                                               * 01600000
016100*  DATE  03/25/2009                                             * 01610000
016200*      CHANGE MADE: THIS WAS ORIGINALLY AN ISSUE WITH REBINDING * 01620000
016300*      TO THE UPDATED DB2 TABLES AND EXPANDED COLUMN LENGTHS.   * 01630000
016400*      RECOMPLING RESOLVED THE ISSUE, BUT I ALSO ADDED A        * 01640000
016500*      DISPLAY TO SHOW US WHICH PO IS HAVING AN ISSUE AND       * 01650000
016600*      REMOVED THE 'WHENEVER SQLWARNING' CODE IN THE BEGINNING  * 01660000
016700*      OF THE PROCEDURE DIVISION.  IT'S NOT NEEDED.             * 01670000
016800*      MADE BY: SCOTT KRUSCHKA          WR/IR #: INC000000747699* 01680000
016900*                                                               * 01690000
017000*  DATE  08/29/2011                                             * 01700003
017100*     CHANGE MADE: DETERMINE IF NON LI&FUNG POS ARE EITHER      * 01710000
017200*     OPEN ACCOUNT OR LETTER OF CREDIT.  PARAGRAPH 9075-SELECT- * 01720003
017300*     PAYTRM-INFO WAS ADDED TO SELECT THE PAY-TRM-ID FOR THE    * 01730003
017400*     PO. IF THE PAY-TRM-ID = 238, THEN IT IS OPEN ACCOUNT AND  * 01740003
017500*     'O' WAS MOVED TO THE COLBY-IND.                           * 01750003
017600*     MADE BY: TOM MARTIN              WR/IR #: WR39735         * 01760003
017700*                                                               * 01770003
017800*  DATE  09/18/2018                                             * 01780005
017900*     CHANGE MADE: MAINFRAME REFACTORING - REMOVED CGU040MC     * 01790006
018000*     AND CGU042MC.                                             * 01800006
018100*     MADE BY: JIM HUNTER              WR/IR #: CHG0208819      * 01810005
018200*                                                               * 01820005
018210*  DATE  09/07/2021                                             * 01821008
018230*     CHANGE MADE: RECOMPILE FOR NEW VERSION OF APRD042         * 01823008
018250*     MADE BY: JEAN KURK               WR/IR #: CHG0260549      * 01825008
018260*                                                               * 01826010
018270*  DATE  10/29/2021                                             * 01827010
018280*     CHANGE MADE: ADDED LOGIC TO HANDLE EXCLUSIVE BRAND POS    * 01828010
018281*     JUST LIKE PRIVATE BRAND POS.  ADDED THE DERVD-LBL-TYP-CDE * 01828110
018282*     TO THE APRD075 COPYBOOK AND ADDED LOGIC TO MOVE THAT FLAG * 01828210
018283*     FROM THE PO TO THE OUTPUT FILE.                           * 01828310
018290*     MADE BY: NANCY EILBES            WR/IR #: CHG0263376      * 01829010
018260*                                                               * 01829114
018270*  DATE  09/27/2023                                             * 01829214
018280*     CHANGE MADE: REPLACE AP042-COLBY-IND WITH                 * 01829314
018281*     AP042-IMPRT-PYMT-TYP.  ADD NEW VALUE OF 'I' FOR           * 01829414
018282*     INFOR NEXUS                                               * 01829514
018290*     MADE BY: JEAN KURK               WR/IR #: CHG0294227      * 01829714
018300***************************************************************** 01830004
018400     EJECT                                                        01840004
018500 ENVIRONMENT DIVISION.                                            01850004
018600                                                                  01860004
018700 INPUT-OUTPUT SECTION.                                            01870004
018800                                                                  01880004
018900 FILE-CONTROL.                                                    01890004
019000                                                                  01900004
019100     SELECT UNJOURNALED-RECEIPTS-EXTRACT ASSIGN TO UT-S-OUT01.    01910004
019200     SELECT PRIVATE-LABEL-EXTRACT        ASSIGN TO UT-S-OUT02.    01920004
019300                                                                  01930004
019400 DATA DIVISION.                                                   01940004
019500                                                                  01950004
019600 FILE SECTION.                                                    01960004
019700                                                                  01970004
019800 FD  UNJOURNALED-RECEIPTS-EXTRACT                                 01980004
019900     RECORDING MODE IS F                                          01990004
020000     LABEL RECORDS ARE STANDARD                                   02000004
020100     BLOCK CONTAINS 0 CHARACTERS.                                 02010004
020200                                                                  02020004
020300 01  UNJOURNALED-RECORD          PIC X(120).                      02030004
020400                                                                  02040004
020500 FD  PRIVATE-LABEL-EXTRACT                                        02050004
020600     RECORDING MODE IS F                                          02060004
020700     LABEL RECORDS ARE STANDARD                                   02070004
020800     BLOCK CONTAINS 0 CHARACTERS.                                 02080004
020900                                                                  02090004
021000 01  PRIVLAB-RECORD              PIC X(160).                      02100004
021100                                                                  02110004
021200 EJECT                                                            02120004
021300 WORKING-STORAGE SECTION.                                         02130004
021400                                                                  02140004
021500 01  ABEND-CODE                  PIC S9(04)  COMP SYNC            02150004
021600                                             VALUE +0.            02160004
021700     88 AP-DB2-ERROR               VALUE +4013.                   02170004
021800                                                                  02180004
021900 01  WS-ABEND-FIELDS.                                             02190004
022000     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT256'. 02200004
022100     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     02210004
022200     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     02220004
022300     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     02230004
022400     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     02240004
022500     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     02250004
022600     05  WS-ABEND-SSA-1               PIC X(50) VALUE SPACES.     02260004
022700     05  WS-ABEND-SSA-2               PIC X(50) VALUE SPACES.     02270004
022800     05  WS-ABEND-SSA-3               PIC X(50) VALUE SPACES.     02280004
022900     05  WS-ABEND-SSA-4               PIC X(50) VALUE SPACES.     02290004
023000                                                                  02300004
023100 01  WS-RETRY-COUNTER              PIC S9(4) COMP VALUE ZERO.     02310004
023200 01  WORK-AREAS.                                                  02320004
023300     05  WS-ONE-HUNDRED          PIC S9(3) COMP-3 VALUE +100.     02330004
023400     05  WS-TABLE-NAME           PIC X(7).                        02340004
023500     05  WS-PARAGRAPH-NAME       PIC X(30).                       02350004
023600                                                                  02360004
023700 01  WS-PRINT-DATE.                                               02370004
023800     05  WS-PRINT-MONTH      PIC Z9.                              02380004
023900     05  FILLER              PIC X       VALUE '/'.               02390004
024000     05  WS-PRINT-DAY        PIC 99.                              02400004
024100     05  FILLER              PIC X       VALUE '/'.               02410004
024200     05  WS-PRINT-CENTURY    PIC 99.                              02420004
024300     05  WS-PRINT-YEAR       PIC 99.                              02430004
024400                                                                  02440004
024500 01  WS-REC-SEQ-NBR              PIC S9(9) VALUE ZEROS.           02450004
024600                                                                  02460004
024700 01  SYSIN-DATA.                                                  02470004
024800     05  RECEIPT-DATE.                                            02480004
024900         10  RECEIPT-MM      PIC  9(02)  VALUE ZERO.              02490004
025000         10  RECEIPT-DD      PIC  9(02)  VALUE ZERO.              02500004
025100         10  RECEIPT-CC      PIC  9(02)  VALUE ZERO.              02510004
025200         10  RECEIPT-YY      PIC  9(02)  VALUE ZERO.              02520004
025300     05  RUN-TYPE-CODE       PIC  X(01)  VALUE SPACE.             02530004
025400     05  FILLER              PIC  X(73)  VALUE SPACE.             02540004
025500                                                                  02550004
025600                                                                  02560004
025700 01  WS-JULIAN-CUTOFF-DATE       PIC  9(07)  VALUE ZERO.          02570004
025800                                                                  02580004
025900 01  WS-DB2-STRT-DATE-GROUP.                                      02590004
026000     05  WS-DB2-CENTURY-START    PIC 99.                          02600004
026100     05  WS-DB2-YEAR-START       PIC 99.                          02610004
026200     05  WS-DASH-1-START         PIC X.                           02620004
026300     05  WS-DB2-MONTH-START      PIC 99.                          02630004
026400     05  WS-DASH-2-START         PIC X.                           02640004
026500     05  WS-DB2-DAY-START        PIC 99.                          02650004
026600 01  FILLER REDEFINES WS-DB2-STRT-DATE-GROUP.                     02660004
026700     05  WS-DB2-STRT-DATE        PIC X(10).                       02670004
026800                                                                  02680004
026900                                                                  02690004
027000 01  WS-DB2-END-DATE-GROUP.                                       02700004
027100     05  WS-DB2-CENTURY          PIC 99.                          02710004
027200     05  WS-DB2-YEAR             PIC 99.                          02720004
027300     05  WS-DASH-1               PIC X.                           02730004
027400     05  WS-DB2-MONTH            PIC 99.                          02740004
027500     05  WS-DASH-2               PIC X.                           02750004
027600     05  WS-DB2-DAY              PIC 99.                          02760004
027700                                                                  02770004
027800 01  FILLER REDEFINES WS-DB2-END-DATE-GROUP.                      02780004
027900     05  WS-DB2-END-DATE         PIC X(10).                       02790004
028000                                                                  02800004
028100 01  WS-STR-NBR                  PIC S9(4).                       02810004
028200                                                                  02820004
028300 01  WS-DECIMAL-STR-NBR          PIC 9(4).                        02830004
028400                                                                  02840004
028500 01  FILLER REDEFINES WS-DECIMAL-STR-NBR.                         02850004
028600     05  WS-DECIMAL-STR-NBR-CHAR PIC X(4).                        02860004
028700                                                                  02870004
028800 01  PV-PROGRAM-VARIABLES.                                        02880004
028900     05  PV-DEFAULT-TMST         PIC X(26)   VALUE                02890004
029000                                 '9999-09-09-09.09.09.999999'.    02900004
029100     05  PV-RTL-EXT              PIC 9(07)V99   COMP-3            02910004
029200                                             VALUE ZERO.          02920004
029300     05  PV-COST-EXT             PIC 9(07)V99   COMP-3            02930004
029400                                             VALUE ZERO.          02940004
029500     05  PV-CLASS-NBR            PIC 99      VALUE ZERO.          02950004
029600     05  PV-VMDUNN               PIC 9(09)   VALUE ZEROES.        02960004
029700     05  PV-VMNAME               PIC X(35)   VALUE SPACES.        02970004
029800     05  PV-RCVR-NBR             PIC 9(08)   VALUE ZEROES.        02980004
029900     05  PV-INVLINE              PIC 9(03)V  COMP-3               02990004
030000                                             VALUE ZERO.          03000004
030100     05  PV-PREV-RCVR-NBR        PIC S9(9)   COMP VALUE ZERO.     03010004
030200     05  PV-DISPLAY-RCVR-NBR     PIC  9(15).                      03020004
030300     05  PV-DISPLAY-OPER-UNT-ID  PIC  9(5).                       03030004
030400     05  PV-DISPLAY-ORD-NBR      PIC  9(15).                      03040004
030500     05  PV-EXTRACT-WRITTEN      PIC S9(9)   COMP-3 VALUE ZERO.   03050004
030600     05  PV-PRIVLAB-WRITTEN      PIC S9(9)   COMP-3 VALUE ZERO.   03060004
030700     05  PV-RECEIPT-COUNT        PIC S9(9)   COMP-3 VALUE ZERO.   03070004
030800     05  PV-NON-INV-COUNT        PIC S9(9)   COMP-3 VALUE ZERO.   03080004
030810     05  PV-RCV-INCOM-COUNT      PIC S9(9)   COMP-3 VALUE ZERO.   03081011
030900     05  PV-EDIT-MASK            PIC ZZZ,ZZZ,ZZ9.                 03090004
031000                                                                  03100004
031100 01  PS-PROGRAM-SWITCHES.                                         03110004
031200     05  PS-RECEIPTS-SWITCH             PIC  X(01)  VALUE 'Y'.    03120004
031300         88  PS-MORE-RECEIPTS                       VALUE 'Y'.    03130004
031400         88  PS-NO-MORE-RECEIPTS                    VALUE 'N'.    03140004
031500     05  PS-NINRECS-SWITCH              PIC  X(01)  VALUE 'Y'.    03150004
031600         88  PS-MORE-NINRECS                        VALUE 'Y'.    03160004
031700         88  PS-NO-MORE-NINRECS                     VALUE 'N'.    03170004
031800     05  PS-EOC-RECP-ITEM-SWITCH        PIC  X(01)  VALUE 'Y'.    03180004
031900         88  PS-EOC-RECP-ITEM                       VALUE 'Y'.    03190004
032000         88  PS-NEOC-RECP-ITEM                      VALUE 'N'.    03200004
032010     05  PS-RCV-INCOM-IND               PIC  X(01)  VALUE 'Y'.    03201011
032020         88  PS-RCV-INCOM                           VALUE 'Y'.    03202011
032030         88  PS-RCV-NOT-INCOM                       VALUE 'N'.    03203011
032100                                                                  03210004
032200 01  PV-CHECKDIGIT-FIELDS.                                        03220004
032300     05  TSSTYLE                      PIC 9(5)  VALUE ZERO.       03230004
032400     05  TSSX  REDEFINES TSSTYLE.                                 03240004
032500         10  TS-S1.                                               03250004
032600             15  TS-STYLE-EXTRA       PIC 9.                      03260004
032700             15  TS-STYLE-KOHLS       PIC 999.                    03270004
032800         10  TS-S2                    PIC 9.                      03280004
032900     05  WS-GSTYLE                    PIC 9(5)  VALUE ZERO.       03290004
033000     05  WS-GSR  REDEFINES WS-GSTYLE.                             03300004
033100         10  WS-S1                    PIC 9(4).                   03310004
033200         10  WS-S2                    PIC 9.                      03320004
033300     05  WS-PASS.                                                 03330004
033400         10  FILLER                   PIC 9(10) VALUE ZERO.       03340004
033500         10  WS-P1                    PIC 999   VALUE ZERO.       03350004
033600         10  WS-RETURN.                                           03360004
033700             15  WS-P2                PIC 9(4)  VALUE ZERO.       03370004
033800             15  WS-P3                PIC 9     VALUE ZERO.       03380004
033900     EJECT                                                        03390004
034000     COPY DPWS004.                                                03400004
034100     EJECT                                                        03410004
034200******************************************************************03420004
034300**                   DATE MODULE INCLUDES                       **03430004
034400******************************************************************03440004
034500     COPY DPWS500.                                                03450004
034600     EJECT                                                        03460004
034700******************************************************************03470004
034800**                   EXTRACT RECORD LAYOUT                      **03480004
034900******************************************************************03490004
035000     COPY APRD042.                                                03500004
035100     EJECT                                                        03510004
035200******************************************************************03520004
035300**  PRIVATE LABEL    EXTRACT RECORD LAYOUT                      **03530004
035400******************************************************************03540004
035500     COPY APRD075.                                                03550004
035600     EJECT                                                        03560004
035700******************************************************************03570004
035800**                      DB2 WORK AREAS                          **03580004
035900******************************************************************03590004
036000**                  LOCATION TABLE LAYOUT                       **03600004
036100******************************************************************03610004
036200******************************************************************03620004
036300**                    PO HEADER    TABLE LAYOUT                 **03630004
036400******************************************************************03640004
036500     EXEC SQL                                                     03650004
036600         INCLUDE TPURCHS                                          03660004
036700     END-EXEC.                                                    03670004
036800     EJECT                                                        03680004
036900******************************************************************03690004
037000**                    PO LINE ITEM TABLE LAYOUT                 **03700004
037100******************************************************************03710004
037200     EXEC SQL                                                     03720004
037300         INCLUDE TPURITM                                          03730004
037400     END-EXEC.                                                    03740004
037500     EJECT                                                        03750004
037600******************************************************************03760004
037700**        RECEIVING HEADER TABLE LAYOUT                         **03770004
037800******************************************************************03780004
037900     EXEC SQL                                                     03790004
038000         INCLUDE TRECEIV                                          03800004
038100     END-EXEC.                                                    03810004
038200     EJECT                                                        03820004
038300******************************************************************03830004
038400**        RECEIVING ITEM               TABLE LAYOUT             **03840004
038500******************************************************************03850004
038600     EXEC SQL                                                     03860004
038700         INCLUDE TRECITM                                          03870004
038800     END-EXEC.                                                    03880004
038900     EJECT                                                        03890004
039000******************************************************************03900004
039100**                    DEPT         TABLE LAYOUT                 **03910000
039200******************************************************************03920000
039300     EXEC SQL                                                     03930000
039400         INCLUDE TMDSEAR                                          03940000
039500     END-EXEC.                                                    03950000
039600     EJECT                                                        03960000
039700******************************************************************03970000
039800**        RECEIVING STORE DISTRIBUTION TABLE LAYOUT             **03980000
039900******************************************************************03990000
040000     EXEC SQL                                                     04000000
040100         INCLUDE TRECDIS                                          04010000
040200     END-EXEC.                                                    04020000
040300     EJECT                                                        04030000
040400******************************************************************04040000
040500**                                                              **04050000
040600******************************************************************04060000
040700     EXEC SQL                                                     04070000
040800         INCLUDE TEXTENT                                          04080000
040900     END-EXEC.                                                    04090000
041000     EJECT                                                        04100000
041100******************************************************************04110000
041200**                                                              **04120000
041300******************************************************************04130000
041400     EXEC SQL                                                     04140000
041500         INCLUDE TENTNME                                          04150000
041600     END-EXEC.                                                    04160000
041700     EJECT                                                        04170000
041800******************************************************************04180000
041900**  PURCHASE ORDER AGREEMENT                                    **04190000
042000******************************************************************04200000
042100     EXEC SQL                                                     04210000
042200         INCLUDE TPOAGMT                                          04220000
042300     END-EXEC.                                                    04230000
042400     EJECT                                                        04240000
042500******************************************************************04250000
042600**  PAYMENT TERMS                                               **04260000
042700******************************************************************04270000
042800     EXEC SQL                                                     04280000
042900         INCLUDE TPAYTRM                                          04290000
043000     END-EXEC.                                                    04300000
043100     EJECT                                                        04310000
043200**                  DB2 COMMUNICATION AREA                      **04320000
043300******************************************************************04330000
043400     EXEC SQL                                                     04340000
043500         INCLUDE SQLCA                                            04350000
043600     END-EXEC.                                                    04360000
043700******************************************************************04370000
043800**                  DB2 COMMUNICATION AREA  2                   **04380000
043900******************************************************************04390000
044000     COPY SQLCA2.                                                 04400000
044100     EJECT                                                        04410000
044200******************************************************************04420000
044300**   CURSOR USED TO FETCH THE NEXT RECEIVER IN THE TABLE        **04430000
044400******************************************************************04440000
044500     EXEC SQL                                                     04450000
044600         DECLARE RECEIVER_CURSOR CURSOR FOR                       04460000
044700             SELECT   ORD_NBR,                                    04470000
044800                      REC_SEQ_NBR,                                04480000
044900                      PO_VER_NBR,                                 04490000
045000                      OPER_UNT_ID,                                04500000
045100                      FCLTY_ID,                                   04510000
045200                      STATUS_CDE,                                 04520000
045300                      VER_STATUS_CDE,                             04530000
045400                      PACK_BY_ST_IND,                             04540000
045500                      REC_TMST,                                   04550000
045600                      VERFYD_TMST,                                04560000
045700                      AP_PRC_CDE                                  04570000
045800             FROM     TRECEIV                                     04580000
045900             WHERE    STATUS_CDE = 'VE'                           04590000
046000             AND      VER_STATUS_CDE = 'A'                        04600000
046100             AND     (DATE(VERFYD_TMST) >= :WS-DB2-STRT-DATE AND  04610000
046200                      DATE(VERFYD_TMST) <= :WS-DB2-END-DATE)      04620000
046300             AND    ((AP_PRC_CDE = ' ') OR                        04630000
046400                     (AP_PRC_CDE IN ('W','J','M') AND             04640000
046500                      AP_PRC_DTE  > :WS-DB2-END-DATE))            04650000
046600             AND FS_POST_TMST NOT IN                              04660000
046700                                 ('9999-09-09-09.09.09.999999')   04670000
046800             ORDER BY ORD_NBR                                     04680000
046900     END-EXEC.                                                    04690000
047000     EJECT                                                        04700000
047100******************************************************************04710000
047200**   CURSOR USED TO FETCH THE NEXT RECEIPT DISTRIBUTION         **04720000
047300**   FOR RECEIVING PROCESSING                                   **04730000
047400******************************************************************04740000
047500     EXEC SQL                                                     04750000
047600         DECLARE RECP_DIST_CURSOR CURSOR FOR                      04760000
047700             SELECT   A.ORD_NBR                                   04770000
047800                   ,  A.ORD_LNE_NBR                               04780000
047900                   ,  A.REC_SEQ_NBR                               04790000
048000                   ,  A.OPER_UNT_ID                               04800000
048100                   ,  A.FCLTY_ID                                  04810000
048200                   ,  A.AP_VERIFY_ITM_QTY                         04820000
048300                   ,  A.STR_NBR                                   04830000
048400                   ,  A.AP_PRC_CDE                                04840000
048500                   ,  A.AP_PRC_DTE                                04850000
048600                   ,  B.VERFYD_TMST                               04860000
048700                   ,  B.STATUS_CDE                                04870000
048800                   ,  B.PO_VER_NBR                                04880000
048900             FROM     TRECDIS A                                   04890000
049000                    , TRECITM B                                   04900000
049100             WHERE    A.ORD_NBR = :RECEIV-ORD-NBR                 04910000
049200             AND      A.ORD_NBR     = B.ORD_NBR                   04920000
049300                                                                  04930000
049400             AND      A.ORD_LNE_NBR = B.ORD_LNE_NBR               04940000
049500                                                                  04950000
049600             AND      A.REC_SEQ_NBR = :RECEIV-REC-SEQ-NBR         04960000
049700             AND      A.REC_SEQ_NBR = B.REC_SEQ_NBR               04970000
049800                                                                  04980000
049900             AND      A.VER_STATUS_CDE = 'A'                      04990000
050000             AND      B.VER_STATUS_CDE = 'A'                      05000000
050100             AND    ((AP_PRC_CDE = ' ') OR                        05010000
050200                     (AP_PRC_CDE IN ('W','J','M') AND             05020000
050300                      AP_PRC_DTE  > :WS-DB2-END-DATE))            05030000
050400                                                                  05040000
050500             AND      A.OPER_UNT_ID = B.OPER_UNT_ID               05050000
050600             AND      A.FCLTY_ID    = B.FCLTY_ID                  05060000
050700             ORDER BY                                             05070000
050800                      A.ORD_NBR                                   05080000
050900                    , A.ORD_LNE_NBR                               05090000
051000                    , A.REC_SEQ_NBR                               05100000
051100                    , A.OPER_UNT_ID                               05110000
051200                    , A.FCLTY_ID                                  05120000
051300     END-EXEC.                                                    05130000
051400     EJECT                                                        05140000
051500 PROCEDURE DIVISION.                                              05150000
051600                                                                  05160000
051700     PERFORM 1000-ACCEPT-DATES THRU 1000-EXIT.                    05170000
051800                                                                  05180000
051900     OPEN OUTPUT UNJOURNALED-RECEIPTS-EXTRACT.                    05190000
052000     OPEN OUTPUT PRIVATE-LABEL-EXTRACT.                           05200000
052100                                                                  05210000
052200     PERFORM WITH TEST AFTER                                      05220000
052300             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 05230000
052400             UNTIL   WS-RETRY-COUNTER > 3  OR                     05240000
052500                     SQLCODE = ZERO OR                            05250000
052600                     SQLCODE = -913 OR                            05260000
052700                     SQLCODE = -904                               05270000
052800        EXEC SQL                                                  05280000
052900            OPEN RECEIVER_CURSOR                                  05290000
053000        END-EXEC                                                  05300000
053100                                                                  05310000
053200        EVALUATE TRUE                                             05320000
053300            WHEN SQLCODE = ZERO                                   05330000
053400            WHEN SQLCODE = -904                                   05340000
053500            WHEN SQLCODE = -913                                   05350000
053600                 CONTINUE                                         05360000
053700                                                                  05370000
053800            WHEN SQLWARN0 NOT = SPACES                            05380000
053900            WHEN SQLCODE  NOT = ZERO                              05390000
054000                 MOVE '                              '            05400000
054100                               TO WS-ABEND-PARAGRAPH              05410000
054200                 MOVE 'UNSUCCESSFUL OPEN   RECEIV'                05420000
054300                               TO WS-ABEND-OPERATION              05430000
054400                 MOVE 'TRECEIV ' TO WS-ABEND-STRUCTURE-1          05440000
054500                 MOVE SPACES     TO WS-ABEND-STRUCTURE-2          05450000
054600                 PERFORM 9999-SQL-ERROR                           05460000
054700        END-EVALUATE                                              05470000
054800     END-PERFORM.                                                 05480000
054900                                                                  05490000
055000     IF WS-RETRY-COUNTER > 3                                      05500000
055100         MOVE '                              '                    05510000
055200                       TO WS-ABEND-PARAGRAPH                      05520000
055300         MOVE 'MAX RETRIES EXCEEDED ON OPEN  TRECEIV'             05530000
055400                         TO WS-ABEND-OPERATION                    05540000
055500         PERFORM 9999-SQL-ERROR                                   05550000
055600     END-IF.                                                      05560000
055700                                                                  05570000
055800     PERFORM 9000-FETCH-RECEIVER-CURSOR.                          05580000
055900                                                                  05590000
056000     PERFORM 2000-PROCESS-RECEIPTS                                05600000
056100            UNTIL PS-NO-MORE-RECEIPTS.                            05610000
056200                                                                  05620000
056300     PERFORM WITH TEST AFTER                                      05630000
056400             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 05640000
056500             UNTIL   WS-RETRY-COUNTER > 3  OR                     05650000
056600                     SQLCODE = ZERO OR                            05660000
056700                     SQLCODE = -913 OR                            05670000
056800                     SQLCODE = -904                               05680000
056900        EXEC SQL                                                  05690000
057000            CLOSE RECEIVER_CURSOR                                 05700000
057100        END-EXEC                                                  05710000
057200                                                                  05720000
057300        EVALUATE TRUE                                             05730000
057400            WHEN SQLCODE = ZERO                                   05740000
057500            WHEN SQLCODE = -904                                   05750000
057600            WHEN SQLCODE = -913                                   05760000
057700                 CONTINUE                                         05770000
057800                                                                  05780000
057900            WHEN SQLWARN0 NOT = SPACES                            05790000
058000            WHEN SQLCODE  NOT = ZERO                              05800000
058100                 MOVE '                              '            05810000
058200                               TO WS-ABEND-PARAGRAPH              05820000
058300                 MOVE 'UNSUCCESSFUL CLOSE  RECEIV'                05830000
058400                               TO WS-ABEND-OPERATION              05840000
058500                 MOVE 'TRECEIV ' TO WS-ABEND-STRUCTURE-1          05850000
058600                 MOVE SPACES     TO WS-ABEND-STRUCTURE-2          05860000
058700                 PERFORM 9999-SQL-ERROR                           05870000
058800        END-EVALUATE                                              05880000
058900     END-PERFORM.                                                 05890000
059000                                                                  05900000
059100     IF WS-RETRY-COUNTER > 3                                      05910000
059200         MOVE '                              '                    05920000
059300                       TO WS-ABEND-PARAGRAPH                      05930000
059400         MOVE 'MAX RETRIES EXCEEDED ON CLOSE TRECEIV'             05940000
059500                         TO WS-ABEND-OPERATION                    05950000
059600         PERFORM 9999-SQL-ERROR                                   05960000
059700     END-IF.                                                      05970000
059800                                                                  05980000
059900     DISPLAY '****************************************'           05990000
060000     DISPLAY '*************** APKUT256 ***************'           06000000
060100     DISPLAY '****************************************'           06010000
060200     MOVE RECEIPT-MM             TO WS-PRINT-MONTH                06020000
060300     MOVE RECEIPT-DD             TO WS-PRINT-DAY                  06030000
060400     MOVE RECEIPT-CC             TO WS-PRINT-CENTURY              06040000
060500     MOVE RECEIPT-YY             TO WS-PRINT-YEAR                 06050000
060600     INSPECT WS-PRINT-DATE REPLACING LEADING SPACES               06060000
060700         BY '.'                                                   06070000
060800     DISPLAY 'CUTOFF DATE...................'                     06080000
060900         WS-PRINT-DATE                                            06090000
061000     MOVE PV-RECEIPT-COUNT       TO PV-EDIT-MASK                  06100000
061100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACES                06110000
061200         BY '.'                                                   06120000
061300     DISPLAY 'RECEIVER ROWS SELECTED.......'                      06130000
061400         PV-EDIT-MASK                                             06140000
061500     MOVE PV-NON-INV-COUNT       TO PV-EDIT-MASK                  06150000
061600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACES                06160000
061700         BY '.'                                                   06170000
061800     DISPLAY 'NON-INV RECORDS WRITTEN......'                      06180000
061900         PV-EDIT-MASK                                             06190000
062000     MOVE PV-EXTRACT-WRITTEN     TO PV-EDIT-MASK                  06200000
062100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACES                06210000
062200         BY '.'                                                   06220000
062300     DISPLAY 'EXTRACT RECORDS WRITTEN......'                      06230000
062400         PV-EDIT-MASK                                             06240000
062500     MOVE PV-PRIVLAB-WRITTEN     TO PV-EDIT-MASK                  06250000
062600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACES                06260000
062700         BY '.'                                                   06270000
062800     DISPLAY 'PRIVATE LABEL REC WRITTEN....'                      06280000
062900         PV-EDIT-MASK                                             06290000
063000     DISPLAY '****************************************'           06300000
063100     DISPLAY '****************************************'           06310000
063200     DISPLAY '****************************************'           06320000
063300                                                                  06330000
063400     CLOSE UNJOURNALED-RECEIPTS-EXTRACT.                          06340000
063500     CLOSE PRIVATE-LABEL-EXTRACT.                                 06350000
063600                                                                  06360000
063700     GOBACK.                                                      06370000
063800     EJECT                                                        06380000
063900 1000-ACCEPT-DATES.                                               06390000
064000                                                                  06400000
064100     ACCEPT SYSIN-DATA FROM SYSIN.                                06410000
064200                                                                  06420000
064300     IF  RUN-TYPE-CODE = 'D' OR 'W'                               06430000
064400         CONTINUE                                                 06440000
064500     ELSE                                                         06450000
064600         DISPLAY '*** ABEND ***'                                  06460000
064700         DISPLAY '*** PROGRAM APKUT256'                           06470000
064800         DISPLAY '*** RUN TYPE CODE SHOULD BE  D OR W'            06480000
064900         DISPLAY '*** RUN TYPE CODE = ' RUN-TYPE-CODE             06490000
065000         MOVE +4003      TO ABEND-CODE                            06500000
065100         CALL 'ILBOABN0' USING ABEND-CODE.                        06510000
065200                                                                  06520000
065300     IF  RECEIPT-DATE = '99999999'                                06530000
065400         IF RUN-TYPE-CODE = 'D'                                   06540000
065500            DISPLAY '*** ABEND ***'                               06550000
065600            DISPLAY '*** PROGRAM APKUT256'                        06560000
065700            DISPLAY '*** CONTROL CARD DATE INVALID - D RUN-TYPE'  06570000
065800            DISPLAY '*** SHOULD BE IN MMDDCCYY FORMAT'            06580000
065900            DISPLAY '*** AND CANNOT BE ALL NINES   '              06590000
066000            DISPLAY '*** DATE = ' RECEIPT-DATE                    06600000
066100            MOVE +4003      TO ABEND-CODE                         06610000
066200            CALL 'ILBOABN0' USING ABEND-CODE                      06620000
066300         END-IF                                                   06630000
066400     ELSE                                                         06640000
066500         SET DPG51-ACTUAL-CALENDAR-ONLY                           06650000
066600                                 TO TRUE                          06660000
066700         SET DPG52-LK-DTE-GREG-CC   TO TRUE                       06670000
066800         MOVE RECEIPT-DATE       TO DPG52-GREG-CC-DATE            06680000
066900         CALL DP500-KOHLS-CALENDAR-ROUTINE                        06690000
067000                                 USING DPG51 DPG52 DPG53          06700000
067100                                       DPG54 DPG55 DPG56          06710000
067200         EVALUATE TRUE                                            06720000
067300             WHEN DPG54-DATE-INVALID                              06730000
067400                 DISPLAY '*** ABEND ***'                          06740000
067500                 DISPLAY '*** PROGRAM APKUT256'                   06750000
067600                 DISPLAY '*** CONTROL CARD DATE INVALID'          06760000
067700                 DISPLAY '*** SHOULD BE IN MMDDYY FORMAT'         06770000
067800                 DISPLAY '*** DATE = ' RECEIPT-DATE               06780000
067900                 DISPLAY '*** DATE MODULE ERROR MSG = '           06790000
068000                                 DPG54-ERROR-MESSAGE              06800000
068100                 MOVE +4003      TO ABEND-CODE                    06810000
068200                 CALL 'ILBOABN0' USING ABEND-CODE                 06820000
068300             WHEN DPG54-SEVERE-ERROR                              06830000
068400                 DISPLAY '*** ABEND ***'                          06840000
068500                 DISPLAY '*** PROGRAM APKUT256'                   06850000
068600                 DISPLAY '*** DATE MODULE ERROR'                  06860000
068700                 DISPLAY '*** DATE MODULE ERROR MSG = '           06870000
068800                                 DPG54-ERROR-MESSAGE              06880000
068900                 MOVE +4003      TO ABEND-CODE                    06890000
069000                 CALL 'ILBOABN0' USING ABEND-CODE                 06900000
069100             WHEN DPG54-WARNING-ERROR                             06910000
069200                 DISPLAY '*** ABEND ***'                          06920000
069300                 DISPLAY '*** PROGRAM APKUT256'                   06930000
069400                 DISPLAY '*** DATE MODULE ERROR'                  06940000
069500                 DISPLAY '*** DATE MODULE ERROR MSG = '           06950000
069600                                 DPG54-ERROR-MESSAGE              06960000
069700                 MOVE +4003      TO ABEND-CODE                    06970000
069800                 CALL 'ILBOABN0' USING ABEND-CODE                 06980000
069900             WHEN OTHER                                           06990000
070000                 MOVE DPG55-JULIAN-DATE-CCYYDDD                   07000000
070100                                 TO WS-JULIAN-CUTOFF-DATE         07010000
070200         END-EVALUATE                                             07020000
070300     END-IF.                                                      07030000
070400                                                                  07040000
070500     MOVE RECEIPT-YY             TO WS-DB2-YEAR.                  07050000
070600     MOVE '-'                    TO WS-DASH-1                     07060000
070700                                    WS-DASH-1-START.              07070000
070800     MOVE '-'                    TO WS-DASH-2                     07080000
070900                                    WS-DASH-2-START.              07090000
071000                                                                  07100000
071100****************************************************************  07110000
071200*** Y2K. MOVE ALL RECEIPT- FIELDS TO WS-DB2 AND WS-DB2-START ***  07120000
071300*** FIELDS. INCREASE SIZE OF DATE IN CONDITIONAL STATEMENT   ***  07130000
071400*** TO LENGTH OF 8.                                          ***  07140000
071500****************************************************************  07150000
071600     MOVE RECEIPT-CC             TO WS-DB2-CENTURY                07160000
071700                                    WS-DB2-CENTURY-START.         07170000
071800     MOVE RECEIPT-YY             TO WS-DB2-YEAR-START.            07180000
071900     MOVE RECEIPT-MM             TO WS-DB2-MONTH                  07190000
072000                                    WS-DB2-MONTH-START.           07200000
072100     MOVE RECEIPT-DD             TO WS-DB2-DAY                    07210000
072200                                    WS-DB2-DAY-START.             07220000
072300                                                                  07230000
072400     IF RECEIPT-DATE = '99999999'                                 07240000
072500        MOVE 12                     TO WS-DB2-MONTH               07250000
072600        MOVE 31                     TO WS-DB2-DAY.                07260000
072700                                                                  07270000
072800     IF RUN-TYPE-CODE NOT = 'D'                                   07280000
072900        MOVE 00                     TO WS-DB2-CENTURY-START       07290000
073000        MOVE 01                     TO WS-DB2-YEAR-START          07300000
073100                                       WS-DB2-MONTH-START         07310000
073200                                       WS-DB2-DAY-START.          07320000
073300                                                                  07330000
073400     DISPLAY 'WS-DB2-STRT-DATE =' WS-DB2-STRT-DATE.               07340000
073500     DISPLAY 'WS-DB2-END-DATE =' WS-DB2-END-DATE.                 07350000
073600     EJECT                                                        07360000
073700 1000-EXIT.                                                       07370000
073800     EXIT.                                                        07380000
073900                                                                  07390000
074000     EJECT                                                        07400000
074100******************************************************************07410000
074200**                    2000-PROCESS-RECEIPTS                     **07420000
074300**  CONTROLS PROCESSING FOR EACH RECORD READ IN THE RECEIPTS    **07430000
074400**  DATABASE.  BYPASS RECORDS WITH A MARKING DATE GREATER THAN  **07440000
074500**  THE CUTOFF DATE READ IN.                                    **07450000
074600******************************************************************07460000
074700                                                                  07470000
074800 2000-PROCESS-RECEIPTS.                                           07480000
074900                                                                  07490000
075000     MOVE 'N'                    TO PS-EOC-RECP-ITEM-SWITCH.      07500000
075100                                                                  07510000
075200     IF PURCHS-PO-NBR NOT = RECEIV-ORD-NBR                        07520000
075300        PERFORM 9020-SELECT-PO                                    07530000
075400        PERFORM 9025-SELECT-DMA                                   07540011
075410        PERFORM 9030-SELECT-RCV-INCOMPLETE.                       07541011
075500                                                                  07550000
075600     PERFORM WITH TEST AFTER                                      07560000
075700             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 07570000
075800             UNTIL   WS-RETRY-COUNTER > 3  OR                     07580000
075900                     SQLCODE = ZERO OR                            07590000
076000                     SQLCODE = -913 OR                            07600000
076100                     SQLCODE = -904                               07610000
076200        EXEC SQL                                                  07620000
076300            OPEN RECP_DIST_CURSOR                                 07630000
076400        END-EXEC                                                  07640000
076500                                                                  07650000
076600        EVALUATE TRUE                                             07660000
076700            WHEN SQLCODE = ZERO                                   07670000
076800            WHEN SQLCODE = -904                                   07680000
076900            WHEN SQLCODE = -913                                   07690000
077000                 CONTINUE                                         07700000
077100                                                                  07710000
077200            WHEN SQLWARN0 NOT = SPACES                            07720000
077300            WHEN SQLCODE  NOT = ZERO                              07730000
077400                 MOVE '2000-PROCESS-RECEIPTS         '            07740000
077500                               TO WS-ABEND-PARAGRAPH              07750000
077600                 MOVE 'UNSUCCESSFUL OPEN   RECDIS'                07760000
077700                               TO WS-ABEND-OPERATION              07770000
077800                 MOVE 'TRECDIS ' TO WS-ABEND-STRUCTURE-1          07780000
077900                 MOVE 'TRECITM ' TO WS-ABEND-STRUCTURE-2          07790000
078000                 PERFORM 9999-SQL-ERROR                           07800000
078100        END-EVALUATE                                              07810000
078200     END-PERFORM.                                                 07820000
078300                                                                  07830000
078400     IF WS-RETRY-COUNTER > 3                                      07840000
078500         MOVE '                              '                    07850000
078600                      TO WS-ABEND-PARAGRAPH                       07860000
078700         MOVE 'MAX RETRIES EXCEEDED ON OPEN  TRECDIS'             07870000
078800                        TO WS-ABEND-OPERATION                     07880000
078900         PERFORM 9999-SQL-ERROR                                   07890000
079000     END-IF.                                                      07900000
079100                                                                  07910000
079200     PERFORM 9010-FETCH-RECP-DIST-CURSOR.                         07920000
079300                                                                  07930000
079400     MOVE ZERO                TO PURITM-APP-PO-LNE-NBR.           07940000
079500                                                                  07950000
079600     PERFORM 3000-PROCESS-RECP-DIST                               07960000
079700         UNTIL PS-EOC-RECP-ITEM.                                  07970000
079800                                                                  07980000
079900     PERFORM WITH TEST AFTER                                      07990000
080000             VARYING WS-RETRY-COUNTER FROM 1 BY 1                 08000000
080100             UNTIL   WS-RETRY-COUNTER > 3  OR                     08010000
080200                     SQLCODE = ZERO OR                            08020000
080300                     SQLCODE = -913 OR                            08030000
080400                     SQLCODE = -904                               08040000
080500        EXEC SQL                                                  08050000
080600            CLOSE RECP_DIST_CURSOR                                08060000
080700        END-EXEC                                                  08070000
080800                                                                  08080000
080900        EVALUATE TRUE                                             08090000
081000            WHEN SQLCODE = ZERO                                   08100000
081100            WHEN SQLCODE = -904                                   08110000
081200            WHEN SQLCODE = -913                                   08120000
081300                CONTINUE                                          08130000
081400                                                                  08140000
081500            WHEN SQLWARN0 NOT = SPACES                            08150000
081600            WHEN SQLCODE  NOT = ZERO                              08160000
081700                 MOVE '2000-PROCESS-RECEIPTS         '            08170000
081800                               TO WS-ABEND-PARAGRAPH              08180000
081900                 MOVE 'UNSUCCESSFUL CLOSE  RECDIS'                08190000
082000                               TO WS-ABEND-OPERATION              08200000
082100                 MOVE 'TRECDIS ' TO WS-ABEND-STRUCTURE-1          08210000
082200                 MOVE 'TRECITM ' TO WS-ABEND-STRUCTURE-2          08220000
082300                 PERFORM 9999-SQL-ERROR                           08230000
082400        END-EVALUATE                                              08240000
082500     END-PERFORM.                                                 08250000
082600                                                                  08260000
082700     IF WS-RETRY-COUNTER > 3                                      08270000
082800         MOVE '                              '                    08280000
082900                       TO WS-ABEND-PARAGRAPH                      08290000
083000         MOVE 'MAX RETRIES EXCEEDED ON CLOSE TRECDIS'             08300000
083100                         TO WS-ABEND-OPERATION                    08310000
083200         PERFORM 9999-SQL-ERROR                                   08320000
083300     END-IF.                                                      08330000
083400                                                                  08340000
083500     PERFORM 9000-FETCH-RECEIVER-CURSOR.                          08350000
083600     EJECT                                                        08360000
083700 3000-PROCESS-RECP-DIST.                                          08370000
083800                                                                  08380000
083900     PERFORM 4000-EXTRACT-DATA                                    08390000
084000         THRU 4000-EXIT.                                          08400000
084100     PERFORM 9010-FETCH-RECP-DIST-CURSOR.                         08410000
084200                                                                  08420000
084300 4000-EXTRACT-DATA.                                               08430000
084400                                                                  08440000
084500     SET AP042-ORIG-RCVR TO TRUE.                                 08450000
084600                                                                  08460000
084700     MOVE RECDIS-STR-NBR         TO WS-STR-NBR.                   08470000
084800     MOVE WS-STR-NBR             TO WS-DECIMAL-STR-NBR.           08480000
084900                                                                  08490000
085000     IF RECDIS-ORD-LNE-NBR NOT = PURITM-APP-PO-LNE-NBR            08500000
085100        PERFORM 9050-SELECT-PO-ITEM-DETAIL                        08510000
085200        IF SQLCODE NOT EQUAL ZERO                                 08520000
085300            GO TO 4000-EXIT                                       08530000
085400        END-IF.                                                   08540000
085500                                                                  08550000
085600     MOVE ZEROS                  TO WS-REC-SEQ-NBR.               08560000
085700     MOVE RECEIV-REC-SEQ-NBR     TO WS-REC-SEQ-NBR.               08570000
085800     MOVE WS-REC-SEQ-NBR         TO AP042-REC-SEQ-NBR             08580000
085900                                    AP075-REC-SEQ-NBR.            08590000
086000                                                                  08600000
086100     MOVE PS-RCV-INCOM-IND       TO AP042-RCV-INCOM-IND.          08610011
086110                                                                  08611011
086120     MOVE PURCHS-PO-TYP-CDE      TO AP042-PO-TYP-CDE              08612011
086200                                    AP075-PO-TYP-CDE.             08620000
086300                                                                  08630000
086310     MOVE PURCHS-DERVD-LBL-TYP-CDE TO AP075-DERVD-LBL-TYP-CDE.    08631009
086330                                                                  08633009
086400     MOVE RECEIV-REC-TMST (1:10) TO AP042-REC-DTE.                08640000
086500                                                                  08650000
086600     MOVE PURCHS-PO-NBR          TO AP042-PO-NBR                  08660000
086700                                    AP075-PO-NBR.                 08670000
086800                                                                  08680000
086900     MOVE WS-DECIMAL-STR-NBR-CHAR TO AP042-STR-NBR                08690000
087000                                     AP075-STR-NBR.               08700000
087100                                                                  08710000
087200     IF PURITM-GP-QTY GREATER THAN +1                             08720000
087300         IF PURITM-GP-RTL-AMT GREATER THAN ZERO                   08730000
087400             COMPUTE AP042-CALCD-VRFD-RTL-AMT =                   08740000
087500                                   RECDIS-AP-VERIFY-ITM-QTY *     08750000
087600                 (PURITM-GP-RTL-AMT / PURITM-GP-QTY)              08760000
087700         ELSE                                                     08770000
087800             COMPUTE AP042-CALCD-VRFD-RTL-AMT =                   08780000
087900                 RECDIS-AP-VERIFY-ITM-QTY * PURITM-UNT-RTL-PR-AMT 08790000
088000         END-IF                                                   08800000
088100     ELSE                                                         08810000
088200         COMPUTE AP042-CALCD-VRFD-RTL-AMT =                       08820000
088300             RECDIS-AP-VERIFY-ITM-QTY * PURITM-UNT-RTL-PR-AMT     08830000
088400     END-IF                                                       08840000
088500                                                                  08850000
088600     IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'                  08860007
088610***  IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF' OR 'CD'          08861007
088700         COMPUTE AP042-CALCD-VRFD-COST-AMT =                      08870000
088800             PURITM-UNT-COST-AMT     * RECDIS-AP-VERIFY-ITM-QTY   08880000
088900     ELSE                                                         08890000
089000         COMPUTE AP042-CALCD-VRFD-COST-AMT =                      08900000
089100             PURITM-PRD-1ST-COST-AMT * RECDIS-AP-VERIFY-ITM-QTY   08910000
089200     END-IF.                                                      08920000
089300                                                                  08930000
089400     COMPUTE AP075-EXTD-1ST-COST-AMT =                            08940000
089500           PURITM-PRD-1ST-COST-AMT * RECDIS-AP-VERIFY-ITM-QTY.    08950000
089600                                                                  08960000
089700     COMPUTE AP075-EXTD-UNIT-COST-AMT =                           08970000
089800             PURITM-UNT-COST-AMT     * RECDIS-AP-VERIFY-ITM-QTY.  08980000
089900                                                                  08990000
090000     MOVE PURITM-CL-NBR(1:1)       TO AP042-CL-NBR(1:1)           09000000
090100                                      AP075-CL-NBR(1:1).          09010000
090200     MOVE '00'                     TO AP042-CL-NBR(2:2)           09020000
090300                                      AP075-CL-NBR(2:2).          09030000
090400                                                                  09040000
090500     MOVE PURITM-CL-NBR          TO PV-CLASS-NBR.                 09050000
090600                                                                  09060000
090700     MOVE MDSEAR-DMA-NBR         TO AP042-DMM-NBR                 09070000
090800                                    AP075-DMM-NBR.                09080000
090900                                                                  09090000
091000     MOVE PURCHS-DEPT-NBR        TO AP042-DEPT-NBR                09100000
091100                                    AP075-DEPT-NBR.               09110000
091200                                                                  09120000
091300     MOVE EXTENT-DUN-NBR         TO AP042-VND-NBR                 09130000
091400                                    AP075-VND-NBR.                09140000
091500                                                                  09150000
091600     IF AP042-VND-NBR             = '009206194'                   09160000
091700        MOVE 'C'                 TO AP042-IMPRT-PYMT-TYP          09170014
091700*       MOVE 'C'                 TO AP042-COLBY-IND               09171014
091800     ELSE                                                         09180000
091900        PERFORM 9075-SELECT-PAYTRM-INFO                           09190000
092000     END-IF.                                                      09200000
092100                                                                  09210000
092200     MOVE ENTNME-ENT-NAME-DESC   TO AP042-ENT-NM-DESC             09220000
092300                                    AP075-ENT-NM-DESC.            09230000
092400                                                                  09240000
092500     MOVE RECEIV-VERFYD-TMST (1:10) TO AP042-VRFD-DTE             09250000
092600                                       AP075-VRFD-DTE.            09260000
092700                                                                  09270000
092800                                                                  09280000
092900                                                                  09290000
093000*WINCHESTER - WHEN 'DS' USE THE TYPE AS IS OTHERWISE SEND         09300000
093100*             THRU AS 'DC'                                        09310000
093200                                                                  09320000
093300     MOVE PURITM-APP-PO-LNE-NBR      TO AP042-PO-LNE-NBR.         09330000
093400                                                                  09340000
093500     MOVE PURITM-RMS-PO-SKU-NBR      TO AP075-SKU-NBR.            09350000
093600                                                                  09360000
093700     MOVE RECDIS-AP-VERIFY-ITM-QTY                                09370000
093800                                 TO AP042-PO-VRFD-QTY             09380000
093900                                    AP075-AP-VERIFY-ITM-QTY.      09390000
094000                                                                  09400000
094100     WRITE UNJOURNALED-RECORD FROM AP042-EXTRACT-FILE.            09410000
094200                                                                  09420000
094300     ADD +1 TO PV-EXTRACT-WRITTEN.                                09430000
094400                                                                  09440000
094500     IF (PURCHS-PO-TYP-CDE NOT = 'IM' AND 'IE' AND 'IF' AND 'CD') 09450000
094600        AND PURCHS-OTB-PER-NBR > '200801'                         09460000
094700        AND (PURCHS-DERVD-LBL-TYP-CDE = 'P'                       09470009
094710          OR PURCHS-DERVD-LBL-TYP-CDE = 'E')                      09471009
094800                                                                  09480000
094900         PERFORM 5000-WRITE-PRIV-LABEL-EXTRACT THRU 5000-EXIT     09490000
095000     ELSE                                                         09500000
095100         NEXT SENTENCE                                            09510000
095200     END-IF.                                                      09520000
095300                                                                  09530000
095400 4000-EXIT.                                                       09540000
095500                                                                  09550000
095600     EXIT.                                                        09560000
095700     EJECT                                                        09570000
095800 5000-WRITE-PRIV-LABEL-EXTRACT.                                   09580000
095900                                                                  09590000
096000                                                                  09600000
096100     WRITE PRIVLAB-RECORD FROM AP075-EXTRACT-FILE.                09610000
096200                                                                  09620000
096300     ADD +1 TO PV-PRIVLAB-WRITTEN.                                09630000
096400                                                                  09640000
096500 5000-EXIT.                                                       09650000
096600                                                                  09660000
096700     EXIT.                                                        09670000
096800     EJECT                                                        09680000
096900 9000-FETCH-RECEIVER-CURSOR.                                      09690000
097000                                                                  09700000
097100     EXEC SQL                                                     09710000
097200        FETCH RECEIVER_CURSOR                                     09720000
097300            INTO   :RECEIV-ORD-NBR                                09730000
097400                 , :RECEIV-REC-SEQ-NBR                            09740000
097500                 , :RECEIV-PO-VER-NBR                             09750000
097600                 , :RECEIV-OPER-UNT-ID                            09760000
097700                 , :RECEIV-FCLTY-ID                               09770000
097800                 , :RECEIV-STATUS-CDE                             09780000
097900                 , :RECEIV-VER-STATUS-CDE                         09790000
098000                 , :RECEIV-PACK-BY-ST-IND                         09800000
098100                 , :RECEIV-REC-TMST                               09810000
098200                 , :RECEIV-VERFYD-TMST                            09820000
098300                 , :RECEIV-AP-PRC-CDE                             09830000
098400     END-EXEC.                                                    09840000
098500                                                                  09850000
098600     EVALUATE TRUE                                                09860000
098700         WHEN SQLCODE = ZERO                                      09870000
098800             IF RECEIV-VERFYD-TMST NOT = PV-DEFAULT-TMST          09880000
098900                ADD 1 TO PV-RECEIPT-COUNT                         09890000
099000             END-IF                                               09900000
099100         WHEN SQLCODE = WS-ONE-HUNDRED                            09910000
099200             MOVE 'N'            TO PS-RECEIPTS-SWITCH            09920000
099300         WHEN OTHER                                               09930000
099400             MOVE '9000-FETCH-RECEIVER-CURSOR    '                09940000
099500                           TO WS-ABEND-PARAGRAPH                  09950000
099600             MOVE 'UNSUCCESSFUL FETCH  RECEIV'                    09960000
099700                           TO WS-ABEND-OPERATION                  09970000
099800             MOVE 'TRECEIV ' TO WS-ABEND-STRUCTURE-1              09980000
099900             MOVE '        ' TO WS-ABEND-STRUCTURE-2              09990000
100000             PERFORM 9999-SQL-ERROR                               10000000
100100     END-EVALUATE.                                                10010000
100200     EJECT                                                        10020000
100300 9010-FETCH-RECP-DIST-CURSOR.                                     10030000
100400                                                                  10040000
100500     EXEC SQL                                                     10050000
100600        FETCH RECP_DIST_CURSOR                                    10060000
100700            INTO   :RECDIS-ORD-NBR                                10070000
100800                 , :RECDIS-ORD-LNE-NBR                            10080000
100900                 , :RECDIS-REC-SEQ-NBR                            10090000
101000                 , :RECDIS-OPER-UNT-ID                            10100000
101100                 , :RECDIS-FCLTY-ID                               10110000
101200                 , :RECDIS-AP-VERIFY-ITM-QTY                      10120000
101300                 , :RECDIS-STR-NBR                                10130000
101400                 , :RECDIS-AP-PRC-CDE                             10140000
101500                 , :RECDIS-AP-PRC-DTE                             10150000
101600                 , :RECITM-VERFYD-TMST                            10160000
101700                 , :RECITM-STATUS-CDE                             10170000
101800                 , :RECITM-PO-VER-NBR                             10180000
101900     END-EXEC.                                                    10190000
102000                                                                  10200000
102100     EVALUATE TRUE                                                10210000
102200         WHEN SQLCODE = ZERO                                      10220000
102300             CONTINUE                                             10230000
102400         WHEN SQLCODE = WS-ONE-HUNDRED                            10240000
102500             MOVE 'Y'            TO PS-EOC-RECP-ITEM-SWITCH       10250000
102600         WHEN OTHER                                               10260000
102700             MOVE '9010-FETCH-RECP-DIST-CURSOR   '                10270000
102800                           TO WS-ABEND-PARAGRAPH                  10280000
102900             MOVE 'UNSUCCESSFUL FETCH  RECDIS'                    10290000
103000                           TO WS-ABEND-OPERATION                  10300000
103100             MOVE 'TRECDIS ' TO WS-ABEND-STRUCTURE-1              10310000
103200             MOVE '        ' TO WS-ABEND-STRUCTURE-2              10320000
103300             PERFORM 9999-SQL-ERROR                               10330000
103400     END-EVALUATE.                                                10340000
103500     EJECT                                                        10350000
103600 9020-SELECT-PO.                                                  10360000
103700                                                                  10370000
103800     EXEC SQL                                                     10380000
103900         SELECT A.PO_NBR                                          10390000
104000              , A.DEPT_NBR                                        10400000
104100              , A.ENT_ID                                          10410000
104200              , A.PO_TYP_CDE                                      10420000
104300              , A.DERVD_LBL_TYP_CDE                               10430000
104400              , A.OTB_PER_NBR                                     10440000
104500              , B.DUN_NBR                                         10450000
104600              , C.ENT_NAME_DESC                                   10460000
104700         INTO   :PURCHS-PO-NBR                                    10470000
104800              , :PURCHS-DEPT-NBR                                  10480000
104900              , :PURCHS-ENT-ID                                    10490000
105000              , :PURCHS-PO-TYP-CDE                                10500000
105100              , :PURCHS-DERVD-LBL-TYP-CDE                         10510000
105200              , :PURCHS-OTB-PER-NBR                               10520000
105300              , :EXTENT-DUN-NBR                                   10530000
105400              , :ENTNME-ENT-NAME-DESC                             10540000
105500         FROM   TPURCHS A                                         10550000
105600              , TEXTENT B                                         10560000
105700              , TENTNME C                                         10570000
105800         WHERE PO_NBR       = :RECEIV-ORD-NBR                     10580000
105900         AND VER_STATUS_CDE = 'A'                                 10590000
106000         AND A.ENT_ID   = B.ENT_ID                                10600000
106100         AND B.ENT_ID   = C.ENT_ID                                10610000
106200         AND C.TYPE_CDE = '01'                                    10620000
106300         ORDER BY PO_NBR                                          10630001
106400                , VER_NBR DESC                                    10640001
106500     END-EXEC.                                                    10650000
106600                                                                  10660000
106700     EVALUATE TRUE                                                10670000
106800         WHEN SQLCODE = ZERO                                      10680000
106900             CONTINUE                                             10690000
107000         WHEN SQLCODE = WS-ONE-HUNDRED                            10700000
107100             CONTINUE                                             10710000
107200         WHEN OTHER                                               10720000
107300             DISPLAY 'PO NBR = ' RECEIV-ORD-NBR                   10730000
107400             MOVE '9020-SELECT-PO                '                10740000
107500                           TO WS-ABEND-PARAGRAPH                  10750000
107600             MOVE 'UNSUCCESSFUL SELECT PURCHS'                    10760000
107700                           TO WS-ABEND-OPERATION                  10770000
107800             MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1              10780000
107900             MOVE '        ' TO WS-ABEND-STRUCTURE-2              10790000
108000             PERFORM 9999-SQL-ERROR                               10800000
108100     END-EVALUATE.                                                10810000
108200     EJECT                                                        10820000
108300 9025-SELECT-DMA.                                                 10830000
108400                                                                  10840000
108500     EXEC SQL                                                     10850000
108600         SELECT DMA_NBR                                           10860000
108700         INTO :MDSEAR-DMA-NBR                                     10870000
108800         FROM TMDSEAR                                             10880000
108900         WHERE DEPT_NBR     = :PURCHS-DEPT-NBR                    10890000
109000           AND MDSELV_CDE   = 'DPT'                               10900000
109100           AND STRT_DTE    <= CURRENT DATE                        10910000
109200           AND END_DTE     >= CURRENT DATE                        10920000
109300     END-EXEC.                                                    10930000
109400                                                                  10940000
109500     EVALUATE TRUE                                                10950000
109600         WHEN SQLCODE = -811                                      10960000
109700             DISPLAY 'PO = ' PURCHS-PO-NBR                        10970000
109800             DISPLAY 'DEPT = ' PURCHS-DEPT-NBR                    10980000
109900             MOVE '9025-SELECT-DMA               '                10990000
110000                           TO WS-ABEND-PARAGRAPH                  11000000
110100             MOVE 'UNSUCCESSFUL SELECT MDSEAR'                    11010000
110200                           TO WS-ABEND-OPERATION                  11020000
110300             MOVE 'TMDSEAR ' TO WS-ABEND-STRUCTURE-1              11030000
110400             MOVE '        ' TO WS-ABEND-STRUCTURE-2              11040000
110500             PERFORM 9999-SQL-ERROR                               11050000
110600         WHEN SQLCODE = ZERO                                      11060000
110700             CONTINUE                                             11070000
110800         WHEN SQLCODE = WS-ONE-HUNDRED                            11080000
110900             MOVE '99'           TO MDSEAR-DMA-NBR                11090000
111000         WHEN OTHER                                               11100000
111100             MOVE '9025-SELECT-DMA               '                11110000
111200                           TO WS-ABEND-PARAGRAPH                  11120000
111300             MOVE 'UNSUCCESSFUL SELECT MDSEAR'                    11130000
111400                           TO WS-ABEND-OPERATION                  11140000
111500             MOVE 'TMDSEAR ' TO WS-ABEND-STRUCTURE-1              11150000
111600             MOVE '        ' TO WS-ABEND-STRUCTURE-2              11160000
111700             PERFORM 9999-SQL-ERROR                               11170000
111800     END-EVALUATE.                                                11180000
111810     EJECT                                                        11181011
111820 9030-SELECT-RCV-INCOMPLETE.                                      11182011
111830                                                                  11183011
111831     MOVE +0 TO PV-RCV-INCOM-COUNT.                               11183111
111832                                                                  11183211
111833     EXEC SQL                                                     11183311
111834         SELECT COUNT(*)                                          11183411
111835           INTO :PV-RCV-INCOM-COUNT                               11183511
111836           FROM TRECEIV                                           11183611
111837          WHERE ORD_NBR        = :RECEIV-ORD-NBR                  11183711
111838            AND STATUS_CDE    ^= 'VE'                             11183811
111839            AND VER_STATUS_CDE = 'A'                              11183911
111840     END-EXEC.                                                    11184011
111841                                                                  11184111
111842     EVALUATE TRUE                                                11184211
111843         WHEN PV-RCV-INCOM-COUNT = +0                             11184311
111844             MOVE 'N'         TO PS-RCV-INCOM-IND                 11184411
111845         WHEN PV-RCV-INCOM-COUNT > +0                             11184511
111846             MOVE 'Y'         TO PS-RCV-INCOM-IND                 11184611
111906         WHEN SQLCODE NOT EQUAL ZERO                              11190612
111911             MOVE '9030-SELECT-RCV-INCOMPLETE    '                11191111
111912                           TO WS-ABEND-PARAGRAPH                  11191211
111913             MOVE 'UNSUCCESSFUL SELECT TRECEIV'                   11191311
111914                           TO WS-ABEND-OPERATION                  11191411
111915             MOVE 'TRECEIV ' TO WS-ABEND-STRUCTURE-1              11191511
111916             MOVE '        ' TO WS-ABEND-STRUCTURE-2              11191611
111917             PERFORM 9999-SQL-ERROR                               11191711
111918     END-EVALUATE.                                                11191811
111920     EJECT                                                        11192011
112000                                                                  11200000
112100 9050-SELECT-PO-ITEM-DETAIL.                                      11210000
112200                                                                  11220000
112300     EXEC SQL                                                     11230000
112400         SELECT  APP_PO_LNE_NBR                                   11240000
112500              ,  CL_NBR                                           11250000
112600              ,  RMS_PO_SKU_NBR                                   11260000
112700              ,  UNT_RTL_PR_AMT                                   11270000
112800              ,  UNT_COST_AMT                                     11280000
112900              ,  PRD_1ST_COST_AMT                                 11290000
113000              ,  GP_RTL_AMT                                       11300000
113100              ,  GP_QTY                                           11310000
113200         INTO   :PURITM-APP-PO-LNE-NBR                            11320000
113300              , :PURITM-CL-NBR                                    11330000
113400              , :PURITM-RMS-PO-SKU-NBR                            11340000
113500              , :PURITM-UNT-RTL-PR-AMT                            11350000
113600              , :PURITM-UNT-COST-AMT                              11360000
113700              , :PURITM-PRD-1ST-COST-AMT                          11370000
113800              , :PURITM-GP-RTL-AMT                                11380000
113900              , :PURITM-GP-QTY                                    11390000
114000         FROM   TPURITM                                           11400000
114100         WHERE PO_NBR           = :RECEIV-ORD-NBR                 11410000
114200         AND   APP_PO_LNE_NBR   = :RECDIS-ORD-LNE-NBR             11420000
114300         AND   VER_NBR          = :RECITM-PO-VER-NBR              11430000
114400     END-EXEC.                                                    11440000
114500     EJECT                                                        11450000
114600     EVALUATE TRUE                                                11460000
114700         WHEN SQLCODE = ZERO                                      11470000
114800         WHEN SQLCODE = WS-ONE-HUNDRED                            11480000
114900             CONTINUE                                             11490000
115000         WHEN OTHER                                               11500000
115100              DISPLAY 'RECEIVER NBR = ' RECEIV-ORD-NBR            11510000
115200              DISPLAY 'RECDIS-ORD-LNE = ' RECDIS-ORD-LNE-NBR      11520000
115300              DISPLAY 'RECIDS-REC-SEQ-NBR = ' RECDIS-REC-SEQ-NBR  11530000
115400              DISPLAY 'RECDIS-OPER-UNT-ID = '                     11540000
115500                                   RECDIS-OPER-UNT-ID             11550000
115600              DISPLAY 'RECDIS-FCLTY-ID = '                        11560000
115700                                   RECDIS-FCLTY-ID                11570000
115800              DISPLAY 'RECDIS-STR-NBR = '                         11580000
115900                                   RECDIS-STR-NBR                 11590000
116000             MOVE '9050-SELECT-CON-DIS-PO        '                11600000
116100                           TO WS-ABEND-PARAGRAPH                  11610000
116200             MOVE 'UNSUCCESSFUL SELECT PURITM'                    11620000
116300                           TO WS-ABEND-OPERATION                  11630000
116400             MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1              11640000
116500             MOVE '        ' TO WS-ABEND-STRUCTURE-2              11650000
116600             PERFORM 9999-SQL-ERROR                               11660000
116700     END-EVALUATE.                                                11670000
116800                                                                  11680000
116900     EJECT                                                        11690000
117000                                                                  11700000
117100 9075-SELECT-PAYTRM-INFO.                                         11710000
117200                                                                  11720000
117300     EXEC SQL                                                     11730000
117400        SELECT PT.PAY_TERM_ID                                     11740000
117500          INTO :PAYTRM-PAY-TERM-ID                                11750000
117600        FROM TPOAGMT PA                                           11760000
117700           , TPAYTRM PT                                           11770000
117800        WHERE PA.PO_NBR = :PURCHS-PO-NBR                          11780000
117900          AND PA.PAYT_TERM_ID = PT.PAY_TERM_ID                    11790000
118000          AND PA.AGRMT_TYP_ID = '2'                               11800000
118100          AND PA.VER_STATUS_CDE = 'A'                             11810000
118200     END-EXEC.                                                    11820000
118300                                                                  11830000
118400     EVALUATE TRUE                                                11840000
118500       WHEN SQLCODE = ZERO                                        11850000
118600         IF PAYTRM-PAY-TERM-ID = 238                              11860000
118700            MOVE 'O'             TO AP042-IMPRT-PYMT-TYP          11870014
118700*           MOVE 'O'             TO AP042-COLBY-IND               11871014
118800         ELSE                                                     11880013
118800            IF PAYTRM-PAY-TERM-ID = 247                           11881013
118900              MOVE 'I'           TO AP042-IMPRT-PYMT-TYP          11890014
118800            ELSE                                                  11891013
118900              MOVE 'L'           TO AP042-IMPRT-PYMT-TYP          11892014
119000            END-IF                                                11892214
118800*        ELSE                                                     11893013
118900*           MOVE 'L'             TO AP042-COLBY-IND               11894013
119000         END-IF                                                   11900000
119100       WHEN SQLCODE = +100                                        11910000
119200         MOVE 'L'                TO AP042-IMPRT-PYMT-TYP          11920014
119200*        MOVE 'L'                TO AP042-COLBY-IND               11921014
119300       WHEN SQLWARN0 NOT = SPACES                                 11930000
119400       WHEN SQLCODE NOT = ZERO                                    11940000
119500         DISPLAY 'PO NUMBER: ' PURCHS-PO-NBR                      11950000
119600         MOVE '9075-SELECT-PAYTRM-INFO'    TO WS-ABEND-PARAGRAPH  11960000
119700         MOVE 'UNSUCCESSFUL SELECT'        TO WS-ABEND-OPERATION  11970000
119800         MOVE 'TPOAGMT'                    TO WS-ABEND-STRUCTURE-111980000
119900         MOVE 'TPAYTRM'                    TO WS-ABEND-STRUCTURE-211990000
120000         PERFORM 9999-SQL-ERROR                                   12000000
120100     END-EVALUATE.                                                12010000
120200                                                                  12020000
120300 9999-SQL-ERROR.                                                  12030000
120400                                                                  12040000
120500     DISPLAY '*** DB2 ERROR '.                                    12050000
120600     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 12060000
120700     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               12070000
120800     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               12080000
120900     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             12090000
121000     IF WS-ABEND-STRUCTURE-2 > SPACES                             12100000
121100         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         12110000
121200                                                                  12120000
121300     MOVE +4013                    TO ABEND-CODE.                 12130000
121400     COPY DPPD004.                                                12140000
121500     CALL 'ILBOABN0' USING ABEND-CODE.                            12150000
121600                                                                  12160000
