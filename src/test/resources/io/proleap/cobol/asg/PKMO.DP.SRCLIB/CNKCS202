000100*-----------------------*                                         00010003
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    CNKCS202.                                         00040002
000500 AUTHOR.        ANNE YEKO.                                        00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  04-23-93.                                         00070002
000800 DATE-COMPILED.                                                   00080002
000900                                                                  00090002
001000*---------------------------------------------------------------* 00100002
001100*    Y202 - FACILITY LOCATION LIST.                             * 00110002
001200*                                                               * 00120002
001300*    THIS PROGRAM GENERATES A LIST OF FACILITY LOCATIONS, TYPES,* 00130002
001400*    DESCRIPTIONS, SUBAREAS, AND DEPARTMENT INDICATIORS.        * 00140002
001500*    RECORDS CAN BE SELECTED FOR UPDATE AND DELETE.  ADD IS ALSO* 00150002
001600*    ALLOWED.  THE APPROPRIATE PROGRAM IS INVOKED WHEN THE      * 00160002
001700*    OPERATOR SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION  * 00170002
001800*    KEY.  NO SELECTION IS NECESSARY TO ADD A LOCATION.         * 00180002
001900*                                                               * 00190002
002000*---------------------------------------------------------------* 00200002
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00201007
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00202006
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00203006
263455*----------------------------------------------------------------*00204006
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00205008
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00206008
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00207008
CICS  *-----------------------------------------------------------------00208008
002100                                                                  00210002
002200 ENVIRONMENT DIVISION.                                            00220002
002300 DATA DIVISION.                                                   00230002
002400/                                                                 00240002
002500 WORKING-STORAGE SECTION.                                         00250002
002600                                                                  00260002
002700 01  DK-DB2-KEYS.                                                 00270002
002800     05  DK-OPER-UNT-ID                 PIC  S9(04) COMP.         00280003
002900     05  DK-FCLTY-ID                    PIC  S9(04) COMP.         00290003
003000     05  DK-FCLTY-ID-LOW                PIC  S9(04) COMP.         00300003
003100     05  DK-FCLTY-ID-HIGH               PIC  S9(04) COMP.         00310003
003200     05  DK-AREA-ID-LOW                 PIC  X(06).               00320003
003300     05  DK-AREA-ID-HIGH                PIC  X(06).               00330003
003400     05  DK-TYPE-LOW                    PIC  X(02).               00340002
003500     05  DK-TYPE-HIGH                   PIC  X(02).               00350002
003600                                                                  00360002
003700 01  DN-DB2-NULL-INDICATORS.                                      00370002
003800     05  DN-SUBAREA-OF-ID               PIC S9(04) VALUE +0       00380002
003900                                                    COMP.         00390002
004000 01  PC-PROGRAM-CONSTANTS.                                        00400002
004100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00410002
004200                                                    'CN202A  '.   00420002
004300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00430002
004400                                                    'CNKM202 '.   00440002
004500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00450002
004600                                                    'CNKCS202'.   00460002
004700     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00470002
004800     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00480002
004900     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00490002
005000     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00500002
005100                                                    COMP SYNC.    00510002
005200     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00520002
005300                                                    COMP SYNC.    00530002
005400     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00540002
005500                                                    +1000000      00550002
005600                                                    COMP-3.       00560002
005700     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00570002
005800                                                    COMP SYNC.    00580002
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00590002
006000                                                    COMP-3.       00600002
006100     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00610002
006200     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  00620002
006300     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00630002
006400     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00640002
006500     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00650002
006600     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00660002
006700                                                                  00670002
006800     05  PC-TSYMSG-NUMBERS.                                       00680002
006900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00690002
007000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00700002
007100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00710002
007200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00720002
007300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00730002
007400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00740002
007500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00750002
007600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00760002
007700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00770002
007800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00780002
007900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00790002
008000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00800002
008100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00810002
008200                                                                  00820002
008300 01  PS-PROGRAM-SWITCHES.                                         00830002
008400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00840002
008500         88  PS-NO-ERROR                            VALUE 'Y'.    00850002
008600         88  PS-ERROR                               VALUE 'N'.    00860002
008700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00870002
008800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00880002
008900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00890002
009000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00900002
009100         88  PS-DONE                                VALUE 'Y'.    00910002
009200         88  PS-NOT-DONE                            VALUE 'N'.    00920002
009300                                                                  00930002
009400 01  PV-PROGRAM-VARIABLES.                                        00940002
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      00950002
009600                                                    COMP SYNC.    00960002
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00970002
009800                                                    COMP SYNC.    00980002
009900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00990002
010000                                                    COMP-3.       01000002
010100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01010002
010200                                                    COMP-3.       01020002
010300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01030002
010400                                                    COMP-3.       01040002
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01050002
010600                                                    COMP-3.       01060002
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01070002
010800                                                    COMP-3.       01080002
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01090002
011000                                                    COMP-3.       01100002
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01110002
011200                                                    COMP-3.       01120002
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01130002
011400                                                    COMP SYNC.    01140002
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01150002
011600                                                    COMP SYNC.    01160002
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01170002
011800                                                    COMP SYNC.    01180002
011900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01190002
012000                                                    COMP SYNC.    01200002
012100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01210002
012200                                                    COMP SYNC.    01220002
012300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01230002
012400                                                    COMP SYNC.    01240002
012500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01250002
012600                                                    COMP SYNC.    01260002
012700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01270002
012800                                                    COMP SYNC.    01280002
012900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290002
013000                                                    COMP SYNC.    01300002
013100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01310002
013200                                                    COMP SYNC.    01320002
013300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01330002
013400                                                    COMP SYNC.    01340002
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01350002
013600                                                    COMP SYNC.    01360002
013700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01370002
013800                                                    COMP SYNC.    01380002
013900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01390002
014000                                                    COMP SYNC.    01400002
014100     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01410002
014200                                                    COMP SYNC.    01420002
014300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01430002
014400                                                    COMP SYNC.    01440002
014500                                                                  01450002
014600*---------------------------------------------------------------* 01460002
014700*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01470002
014800*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01480002
014900*   APPLICATION-SPECIFIC COMMAREA.                              * 01490002
015000*---------------------------------------------------------------* 01500002
015100 01  LQW-LIST-QUEUE-WORK-AREA.                                    01510002
015200     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  01520002
015300     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           01530002
015400                                        INDEXED BY LQW-IDX.       01540002
015500         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01550002
015600         10  LQW-TEMP-SELECTED-SW       PIC X(01).                01560002
015700         10  LQW-SELECTED-SW            PIC X(01).                01570002
015800             88  LQW-SELECT                         VALUE 'S'.    01580002
015900             88  LQW-DESELECT                       VALUE ' '.    01590002
016000         10  LQW-ACTION                 PIC X(03).                01600002
016100         10  LQW-FCLTY-ID               PIC 9(04).                01610003
016200         10  LQW-AREA-ID                PIC X(06).                01620003
016300         10  LQW-TYPE                   PIC X(02).                01630002
016400         10  LQW-DESC                   PIC X(27).                01640003
016500         10  LQW-SUBAREA                PIC X(06).                01650002
016600         10  LQW-DEPT-CL-IND            PIC X(01).                01660003
016700         10  LQW-OPER-UNT-ID            PIC 9(04).                01670003
016800                                                                  01680002
016900/                                                                 01690002
017000*---------------------------------------------------------------* 01700002
017100*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01710002
017200*---------------------------------------------------------------* 01720002
017300     COPY CNWS005.                                                01730003
017400                                                                  01740002
017500/                                                                 01750002
017600*---------------------------------------------------------------* 01760002
017700*    MAP LAYOUT                                                 * 01770002
017800*---------------------------------------------------------------* 01780002
017900                                                                  01790002
018000     COPY CNKM202.                                                01800002
018100                                                                  01810002
018200 01  MR-OCCURS-LAYOUT                   REDEFINES  CN202AO.       01820002
018300     05  FILLER                         PIC X(48).                01830002
018400                                                                  01840002
018500     05  MR-OPERL                       PIC S9(04) COMP.          01850003
018600     05  MR-OPERA                       PIC X(01).                01860003
018700     05  MR-OPERC                       PIC X(01).                01870003
018800     05  MR-OPERH                       PIC X(01).                01880003
018900     05  MR-OPER                        PIC X(04).                01890003
019000                                                                  01900002
019100     05  MR-FCLTYL                      PIC S9(04) COMP.          01910003
019200     05  MR-FCLTYA                      PIC X(01).                01920003
019300     05  MR-FCLTYC                      PIC X(01).                01930003
019400     05  MR-FCLTYH                      PIC X(01).                01940003
019500     05  MR-FCLTY                       PIC X(04).                01950003
019600                                                                  01960003
019700     05  MR-FDESCL                      PIC S9(04) COMP.          01970002
019800     05  MR-FDESCA                      PIC X(01).                01980002
019900     05  MR-FDESCC                      PIC X(01).                01990002
020000     05  MR-FDESCH                      PIC X(01).                02000002
020100     05  MR-FDESC                       PIC X(25).                02010002
020200                                                                  02020002
020300     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          02030002
020400         10  MR-SELECTL                 PIC S9(04) COMP.          02040002
020500         10  MR-SELECTA                 PIC X(01).                02050002
020600         10  MR-SELECTC                 PIC X(01).                02060002
020700         10  MR-SELECTH                 PIC X(01).                02070002
020800         10  MR-SELECT                  PIC X(01).                02080002
020900                                                                  02090002
021000         10  MR-ACTIONL                 PIC S9(04) COMP.          02100002
021100         10  MR-ACTIONA                 PIC X(01).                02110002
021200         10  MR-ACTIONC                 PIC X(01).                02120002
021300         10  MR-ACTIONH                 PIC X(01).                02130002
021400         10  MR-ACTION                  PIC X(03).                02140002
021500                                                                  02150002
021600         10  MR-FACL                    PIC S9(04) COMP.          02160003
021700         10  MR-FACA                    PIC X(01).                02170003
021800         10  MR-FACC                    PIC X(01).                02180003
021900         10  MR-FACH                    PIC X(01).                02190003
022000         10  MR-FCLTY-ID                PIC X(04).                02200003
022100                                                                  02210002
022200         10  MR-LOCL                    PIC S9(04) COMP.          02220003
022300         10  MR-LOCA                    PIC X(01).                02230003
022400         10  MR-LOCC                    PIC X(01).                02240003
022500         10  MR-LOCH                    PIC X(01).                02250003
022600         10  MR-AREA-ID                 PIC X(06).                02260003
022700                                                                  02270003
022800         10  MR-TYPEL                   PIC S9(04) COMP.          02280002
022900         10  MR-TYPEA                   PIC X(01).                02290002
023000         10  MR-TYPEC                   PIC X(01).                02300002
023100         10  MR-TYPEH                   PIC X(01).                02310002
023200         10  MR-TYPE                    PIC X(02).                02320002
023300                                                                  02330002
023400         10  MR-DESCL                   PIC S9(04) COMP.          02340002
023500         10  MR-DESCA                   PIC X(01).                02350002
023600         10  MR-DESCC                   PIC X(01).                02360002
023700         10  MR-DESCH                   PIC X(01).                02370002
023800         10  MR-DESC                    PIC X(27).                02380003
023900                                                                  02390002
024000         10  MR-SUBAREAL                PIC S9(04) COMP.          02400002
024100         10  MR-SUBAREAA                PIC X(01).                02410002
024200         10  MR-SUBAREAC                PIC X(01).                02420002
024300         10  MR-SUBAREAH                PIC X(01).                02430002
024400         10  MR-SUBAREA                 PIC X(06).                02440002
024500                                                                  02450002
024600         10  MR-DEPT-CL-INDL            PIC S9(04) COMP.          02460003
024700         10  MR-DEPT-CL-INDA            PIC X(01).                02470003
024800         10  MR-DEPT-CL-INDC            PIC X(01).                02480003
024900         10  MR-DEPT-CL-INDH            PIC X(01).                02490003
025000         10  MR-DEPT-CL-IND             PIC X(01).                02500003
025100                                                                  02510002
025200/                                                                 02520002
025300*---------------------------------------------------------------* 02530002
025400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02540002
025500*---------------------------------------------------------------* 02550002
025600     COPY DPWS015.                                                02560002
025700                                                                  02570002
025800/                                                                 02580002
025900*---------------------------------------------------------------* 02590002
026000*    FUNCTION KEYS COPYBOOK.                                    * 02600002
026100*---------------------------------------------------------------* 02610002
026200     COPY DPWS016.                                                02620002
026300                                                                  02630002
026400/                                                                 02640002
026500*---------------------------------------------------------------* 02650002
026600*    NUMERIC EDIT LAYOUT.                                       * 02660002
026700*---------------------------------------------------------------* 02670002
026800     COPY DPWS010I.                                               02680002
026900                                                                  02690002
027000/                                                                 02700002
027100*---------------------------------------------------------------* 02710002
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02720008
027300*---------------------------------------------------------------* 02730002
027400     COPY DPWS030.                                                02740002
CICS       COPY DPWS930.                                                02741008
027500                                                                  02750002
027600/                                                                 02760002
027700*---------------------------------------------------------------* 02770002
027800*    STANDARD COMMAREA.                                         * 02780002
027900*---------------------------------------------------------------* 02790002
028000                                                                  02800002
028100     COPY DPWS020.                                                02810002
028200     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02820002
028300                                                                  02830002
028400*---------------------------------------------------------------* 02840002
028500* INTER-APPLICATION COMMAREA.                                   * 02850002
028600*   CNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02860002
028700*             SPEC SCREEN.                                      * 02870002
028800*   CNWS003 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02880002
028900*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * 02890002
029000*---------------------------------------------------------------* 02900002
029100                                                                  02910002
029200         10  INTER-APPL-COMM-AREA       PIC X(200).               02920002
029300     COPY CNWS001.                                                02930003
029400     COPY CNWS003.                                                02940003
029500*---------------------------------------------------------------* 02950002
029600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02960002
029700*---------------------------------------------------------------* 02970002
029800         10  ASC-SPECIFIC-COMMAREA.                               02980002
029900             15  ASC-LIST-KEYS.                                   02990002
030000                 20  ASC-KEY-FCLTY-ID      PIC S9(04) COMP.       03000003
030100                 20  ASC-KEY-OPER-UNT-ID   PIC S9(04) COMP.       03010003
030200                 20  ASC-KEY-FCLTY-ID-LOW  PIC S9(04) COMP.       03020003
030300                 20  ASC-KEY-FCLTY-ID-HIGH PIC S9(04) COMP.       03030003
030400                 20  ASC-KEY-AREA-ID-LOW   PIC X(06).             03040003
030500                 20  ASC-KEY-AREA-ID-HIGH  PIC X(06).             03050003
030600                 20  ASC-KEY-TYPE-LOW      PIC X(02).             03060003
030700                 20  ASC-KEY-TYPE-HIGH     PIC X(02).             03070003
030800             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           03080002
030900                 20  ASC-BLOCK-MODIFIED-SW                        03090002
031000                                        PIC  X(01).               03100002
031100                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     03110002
031200                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     03120002
031300                                                                  03130002
031400                 20  ASC-ITEM-ARRAY.                              03140002
031500                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03150002
031600                         30  ASC-LIST-ITEM-NUMBER                 03160002
031700                                        PIC S9(09) COMP-3.        03170002
031800                         30  ASC-TEMP-SELECTED-SW                 03180002
031900                                        PIC X(01).                03190002
032000                             88  ASC-VALID-SELECT  VALUE ' '      03200002
032100                                                         'S'      03210002
032200                                                         'B'      03220002
032300                                                         'E'.     03230002
032400                             88  ASC-TEMP-NO-SELECT               03240002
032500                                                   VALUE ' '.     03250002
032600                             88  ASC-TEMP-SELECT   VALUE 'S'.     03260002
032700                             88  ASC-TEMP-BEGIN    VALUE 'B'.     03270002
032800                             88  ASC-TEMP-END      VALUE 'E'.     03280002
032900                         30  ASC-SELECTED-SW                      03290002
033000                                        PIC X(01).                03300002
033100                             88  ASC-NO-SELECT     VALUE ' '.     03310002
033200                             88  ASC-SELECT        VALUE 'S'.     03320002
033300                             88  ASC-BEGIN         VALUE 'B'.     03330002
033400                             88  ASC-END           VALUE 'E'.     03340002
033500                         30  ASC-ACTION PIC X(03).                03350002
033600                         30  ASC-FCLTY-ID                         03360003
033700                                        PIC X(04).                03370003
033800                         30  ASC-AREA-ID PIC X(06).               03380003
033900                         30  ASC-TYPE   PIC X(02).                03390002
034000                         30  ASC-DESC   PIC X(27).                03400003
034100                         30  ASC-SUBAREA                          03410002
034200                                        PIC X(06).                03420002
034300                         30  ASC-DEPT-CL-IND                      03430003
034400                                        PIC X(01).                03440002
034500                         30  ASC-OPER-UNT-ID                      03450003
034600                                        PIC 9(04).                03460003
034700                                                                  03470002
034800             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03480002
034900             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03490002
035000             15  ASC-NUMBER-OF-ITEMS-READ                         03500002
035100                                        PIC S9(09) COMP-3.        03510002
035200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03520002
035300                                        PIC S9(09) COMP-3.        03530002
035400             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03540002
035500             15  ASC-ITEM-AT-TOP-OF-PANEL                         03550002
035600                                        PIC S9(09) COMP-3.        03560002
035700             15  ASC-ITEM-AT-BOT-OF-PANEL                         03570002
035800                                        PIC S9(09) COMP-3.        03580002
035900             15  ASC-HIGHEST-BLOCK-WRITTEN                        03590002
036000                                        PIC S9(04) COMP SYNC.     03600002
036100             15  ASC-START-OF-SELECTED-RANGE                      03610002
036200                                        PIC S9(09) COMP-3.        03620002
036300             15  ASC-END-OF-SELECTED-RANGE                        03630002
036400                                        PIC S9(09) COMP-3.        03640002
036500             15  ASC-ITEMS-LEFT-INDICATOR                         03650002
036600                                        PIC X(01).                03660002
036700                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03670002
036800                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03680002
036900             15  ASC-TEMP-QUEUE-UPDATE-SW                         03690002
037000                                        PIC X(01).                03700002
037100                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03710002
037200                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03720002
037300             15  ASC-LIST-QUEUE-NAME.                             03730002
037400                 20  ASC-LIST-TERM-ID   PIC X(04).                03740002
037500                 20  ASC-LIST-TASK-NUMBER                         03750002
037600                                        PIC S9(05) COMP-3.        03760002
037700                 20  ASC-LIST-SEQ       PIC 9(01).                03770002
037800             15  ASC-SEL-QUEUE-NAME.                              03780002
037900                 20  ASC-SEL-TERM-ID    PIC X(04).                03790002
038000                 20  ASC-SEL-TASK-NUMBER                          03800002
038100                                        PIC S9(05) COMP-3.        03810002
038200                 20  ASC-SEL-SEQ        PIC 9(01).                03820002
038300                                                                  03830002
038400             15  ASC-CURSOR-SW          PIC X(01).                03840002
038500                 88  ASC-NO-CURSOR                 VALUE 'Z'.     03850002
038600                 88  ASC-TYPE-CURSOR               VALUE 'S'.     03860002
038700                 88  ASC-LOC-CURSOR                VALUE 'N'.     03870002
038800                 88  ASC-DESC-CURSOR               VALUE 'T'.     03880002
038900             15  ASC-START-ITEM-REQUEST.                          03890002
039000                 20  ASC-START-ITEM-REQUEST-N                     03900002
039100                                        PIC 9(07).                03910002
039200             15  ASC-FCLTY-NME          PIC X(25).                03920003
039300                                                                  03930002
039400/                                                                 03940002
039500*---------------------------------------------------------------* 03950002
039600*    ABEND PROCESSING COPYBOOK.                                 * 03960002
039700*---------------------------------------------------------------* 03970002
039800     COPY DPWS013.                                                03980002
039900                                                                  03990002
040000/                                                                 04000002
040100*---------------------------------------------------------------* 04010002
040200*    DB2 AREA FOR THE FACILITY LOCATION TYPE TABLE              * 04020002
040300*---------------------------------------------------------------* 04030002
040400     EXEC SQL                                                     04040002
040500          INCLUDE TFLAREA                                         04050003
040600     END-EXEC.                                                    04060002
040700                                                                  04070002
040800/                                                                 04080002
040900*---------------------------------------------------------------* 04090002
041000*    COMMAREA USED TO CALL XLKUT071                             * 04100002
041100*---------------------------------------------------------------* 04110002
041200     COPY XLWS071.                                                04120002
041300                                                                  04130002
041400/                                                                 04140002
041500*---------------------------------------------------------------* 04150002
041600*    DB2 AREA FOR COMMUNICATIONS                                * 04160002
041700*---------------------------------------------------------------* 04170002
041800     EXEC SQL                                                     04180002
041900          INCLUDE SQLCA                                           04190002
042000     END-EXEC.                                                    04200002
042100                                                                  04210002
042200/                                                                 04220002
042300*---------------------------------------------------------------* 04230002
042400*    FCLTY-CSR FOR SELECT OF ALL LOCATIONS WITHIN STORE         * 04240002
042500*---------------------------------------------------------------* 04250002
042600                                                                  04260002
042700     EXEC SQL                                                     04270002
042800          DECLARE FCLTY-CSR CURSOR FOR                            04280002
042900           SELECT FCLTY_ID                                        04290003
043000                 ,FCLTY_AREA_ID                                   04300003
043100                 ,SUBAREA_OF_ID                                   04310002
043200                 ,FCLTY_LOC_TYP_CDE                               04320002
043300                 ,FCLTY_AREA_DESC                                 04330003
043400                 ,DEPT_CL_IND                                     04340003
043500             FROM TFLAREA                                         04350003
043600            WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                   04360003
043700              AND FCLTY_ID           BETWEEN :DK-FCLTY-ID-LOW     04370003
043800                                         AND :DK-FCLTY-ID-HIGH    04380003
043900              AND FCLTY_AREA_ID      BETWEEN :DK-AREA-ID-LOW      04390003
044000                                         AND :DK-AREA-ID-HIGH     04400003
044100              AND FCLTY_LOC_TYP_CDE  BETWEEN :DK-TYPE-LOW         04410002
044200                                         AND :DK-TYPE-HIGH        04420002
044300         ORDER BY FCLTY_ID                                        04430003
044400                 ,FCLTY_AREA_ID                                   04440003
044500                 ,FCLTY_LOC_TYP_CDE                               04450002
044600     END-EXEC.                                                    04460002
044700                                                                  04470002
044800                                                                  04480002
044900/                                                                 04490002
045000 LINKAGE SECTION.                                                 04500002
045100                                                                  04510002
045200 01  DFHCOMMAREA.                                                 04520002
045300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04530002
045400                                        DEPENDING ON EIBCALEN.    04540002
045500         10  FILLER                     PIC X.                    04550002
045600                                                                  04560002
045700/                                                                 04570002
045800 PROCEDURE DIVISION.                                              04580002
045900*---------------------------------------------------------------* 04590002
046000*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04600002
046100*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04610002
046200*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04620002
046300*---------------------------------------------------------------* 04630002
046400 0000-MAIN-MODULE.                                                04640002
046500                                                                  04650002
046600     INITIALIZE DP030-CICS-API-FIELDS.                            04660002
046700                                                                  04670002
046800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04680002
046900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04690002
047000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04700002
047100                                                                  04710002
047200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04720002
047300                                                                  04730002
047400     MOVE LENGTH OF CN202AI        TO DP030-MAP-LENGTH (1).       04740002
047500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04750002
047600                                                                  04760002
047700     PERFORM 0001-CALL-CICS-ARCH-API.                             04770002
047800     PERFORM 1000-CONTROL-PROCESSING                              04780002
047900                                                                  04790002
048000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04800002
048100     PERFORM 0001-CALL-CICS-ARCH-API.                             04810002
048200                                                                  04820002
048300*---------------------------------------------------------------* 04830002
048400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 04840002
048500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 04850002
048600*---------------------------------------------------------------* 04860002
048700 0001-CALL-CICS-ARCH-API.                                         04870002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04871008
048900                                    DFHCOMMAREA                   04890008
049000                                    DP030-CICS-API-FIELDS         04900008
049100                                    DP020-STANDARD-COMMAREA       04910008
049200                                    CN202AI.                      04920008
049300                                                                  04930002
049400     IF  DP030-RC-CALL-SUCCESSFUL                                 04940002
049500         CONTINUE                                                 04950002
049600     ELSE                                                         04960002
049700         SET DP013-NO-ROLLBACK                                    04970002
049800             DP013-XCTL-DISPLAY-RESTART                           04980002
049900             DP013-CICS-ABEND      TO TRUE                        04990002
050000         MOVE '0001-CALL-CICS-ARCH-API'                           05000002
050100                                   TO DP013-PARAGRAPH             05010002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05011008
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05012008
050400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05040002
050500         PERFORM DP013-0000-PROCESS-ABEND                         05050002
050600     END-IF.                                                      05060002
050700                                                                  05070002
050800*----------------------------------------------------------------*05080002
050900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05090002
051000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05100002
051100*                                                                *05110002
051200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05120002
051300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05130002
051400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05140002
051500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05150002
051600*----------------------------------------------------------------*05160002
051700                                                                  05170002
051800 1000-CONTROL-PROCESSING.                                         05180002
051900                                                                  05190002
052000     EVALUATE TRUE                                                05200002
052100         WHEN DP020-NEXT-ACT-INITIAL                              05210002
052200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05220002
052300             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05230002
052400                                      ASC-SEL-TERM-ID             05240002
052500             MOVE DP020-SRC-TASK-NUMBER                           05250002
052600                                   TO ASC-LIST-TASK-NUMBER        05260002
052700                                      ASC-SEL-TASK-NUMBER         05270002
052800             MOVE PC-LIST-QUEUE-SEQ                               05280002
052900                                   TO ASC-LIST-SEQ                05290002
053000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05300002
053100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05310002
053200                                                                  05320002
053300***-----$TEMPLATE NOTE$-------------------------------------------05330002
053400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05340002
053500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05350002
053600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05360002
053700***---------------------------------------------------------------05370002
053800             IF  PS-COMMAREA-NOT-VALID                            05380002
053900***              MOVE PC-TSYMSG-99901                             05390002
054000***                                TO DP020-MSG-NUMBER            05400002
054100***              SET DP020-MSG-FATAL                              05410002
054200***                                TO TRUE                        05420002
054300                 SET DP020-NEXT-ACT-APPL-ERROR                    05430002
054400                                   TO TRUE                        05440002
054500             ELSE                                                 05450002
054600                 PERFORM 4000-BUILD-INITIAL-PANEL                 05460002
054700             END-IF                                               05470002
054800                                                                  05480002
054900         WHEN DP020-NEXT-ACT-READ-MAP                             05490002
055000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05500002
055100                                   TO PV-TOP-ITEM                 05510002
055200             PERFORM 2000-PROCESS-PANEL                           05520002
055300                                                                  05530002
055400         WHEN DP020-NEXT-ACT-RETURN                               05540002
055500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05550002
055600                                   TO PV-TOP-ITEM                 05560002
055700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05570002
055800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05580002
055900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05590002
056000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05600002
056100                                                                  05610002
056200         WHEN OTHER                                               05620002
056300             SET DP013-LOGIC-ABEND TO TRUE                        05630002
056400             SET DP013-NO-ROLLBACK TO TRUE                        05640002
056500             MOVE '1000-CONTROL-PROCESSING'                       05650002
056600                                   TO DP013-PARAGRAPH             05660002
056700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05670002
056800                                   TO DP013-MESSAGE-TEXT(1)       05680002
056900             PERFORM DP013-0000-PROCESS-ABEND                     05690002
057000     END-EVALUATE.                                                05700002
057100                                                                  05710002
057200/                                                                 05720002
057300*----------------------------------------------------------------*05730002
057400* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *05740002
057500*----------------------------------------------------------------*05750002
057600                                                                  05760002
057700 1100-PROCESS-INTER-APPL-COMM.                                    05770002
057800                                                                  05780002
057900     SET PS-COMMAREA-VALID         TO TRUE.                       05790002
058000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05800002
058100                                                                  05810002
058200     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           05820002
058300        MOVE CN001-OPER-UNT-ID     TO DK-OPER-UNT-ID              05830003
058400                                      ASC-KEY-OPER-UNT-ID         05840003
058500        MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID-LOW             05850003
058600                                      DK-FCLTY-ID-HIGH            05860003
058700                                      DK-FCLTY-ID                 05870003
058800                                      ASC-KEY-FCLTY-ID-LOW        05880003
058900                                      ASC-KEY-FCLTY-ID-HIGH       05890003
059000                                      ASC-KEY-FCLTY-ID            05900003
059100        MOVE CN001-AREA-ID         TO DK-AREA-ID-LOW              05910003
059200                                      DK-AREA-ID-HIGH             05920003
059300                                      ASC-KEY-AREA-ID-LOW         05930003
059400                                      ASC-KEY-AREA-ID-HIGH        05940003
059500        MOVE CN001-LOC-TYPE        TO DK-TYPE-LOW                 05950002
059600                                      DK-TYPE-HIGH                05960002
059700                                      ASC-KEY-TYPE-LOW            05970002
059800                                      ASC-KEY-TYPE-HIGH           05980002
059900     END-IF.                                                      05990002
060000                                                                  06000002
060100/                                                                 06010002
060200*----------------------------------------------------------------*06020002
060300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06030002
060400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06040002
060500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06050002
060600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06060002
060700* FUNCTION KEYS CAN GET THIS FAR.                                *06070002
060800*----------------------------------------------------------------*06080002
060900                                                                  06090002
061000 2000-PROCESS-PANEL.                                              06100002
061100     EVALUATE TRUE                                                06110002
061200         WHEN DP020-SRC-AID = DP016-CLEAR                         06120002
061300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06130002
061400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06140002
061500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06150002
061600                                                                  06160002
061700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06170002
061800             MOVE ASC-KEY-OPER-UNT-ID                             06180003
061900                                   TO DK-OPER-UNT-ID              06190003
062000             MOVE ASC-KEY-FCLTY-ID-LOW                            06200003
062100                                   TO DK-FCLTY-ID-LOW             06210003
062200             MOVE ASC-KEY-FCLTY-ID-HIGH                           06220003
062300                                   TO DK-FCLTY-ID-HIGH            06230003
062400             MOVE ASC-KEY-FCLTY-ID TO DK-FCLTY-ID                 06240003
062500             MOVE ASC-KEY-AREA-ID-LOW                             06250003
062600                                   TO DK-AREA-ID-LOW              06260003
062700             MOVE ASC-KEY-AREA-ID-HIGH                            06270003
062800                                   TO DK-AREA-ID-HIGH             06280003
062900             MOVE ASC-KEY-TYPE-LOW TO DK-TYPE-LOW                 06290002
063000             MOVE ASC-KEY-TYPE-HIGH                               06300002
063100                                   TO DK-TYPE-HIGH                06310002
063200             PERFORM 2050-DELETE-LIST-QUEUE                       06320002
063300             PERFORM 4000-BUILD-INITIAL-PANEL                     06330002
063400                                                                  06340002
063500         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06350002
063600             PERFORM 2140-DESELECT-ALL-ITEMS                      06360002
063700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06370002
063800                                                                  06380002
063900         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06390002
064000             PERFORM 2150-SELECT-ALL-ITEMS                        06400002
064100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06410002
064200                                                                  06420002
064300         WHEN OTHER                                               06430002
064400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06440002
064500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06450002
064600             IF  PS-NO-ERROR                                      06460002
064700                 SET DP030-CONTINUE-GO TO TRUE                    06470002
064800                 PERFORM 2100-CHECK-FUNCTION-KEY                  06480002
064900             ELSE                                                 06490002
065000                 SET DP030-OVERRIDE-GO TO TRUE                    06500002
065100             END-IF                                               06510002
065200     END-EVALUATE.                                                06520002
065300                                                                  06530002
065400/                                                                 06540002
065500*----------------------------------------------------------------*06550002
065600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06560002
065700*----------------------------------------------------------------*06570002
065800 2050-DELETE-LIST-QUEUE.                                          06580002
065900                                                                  06590002
066000     EXEC CICS                                                    06600002
066100         DELETEQ TS                                               06610002
066200           QUEUE (ASC-LIST-QUEUE-NAME)                            06620002
066300            RESP (PV-CICS-RESP)                                   06630002
066400     END-EXEC.                                                    06640002
066500                                                                  06650002
066600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06660002
066700        (PV-CICS-RESP = DFHRESP(QIDERR))                          06670002
066800         CONTINUE                                                 06680002
066900     ELSE                                                         06690002
067000         SET DP013-CICS-ABEND      TO TRUE                        06700002
067100         SET DP013-NO-ROLLBACK     TO TRUE                        06710002
067200                                                                  06720002
067300         MOVE '2050-DELETE-LIST-QUEUE'                            06730002
067400                                   TO DP013-PARAGRAPH             06740002
067500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06750002
067600                                   TO DP013-MESSAGE-TEXT (1)      06760002
067700         PERFORM DP013-0000-PROCESS-ABEND                         06770002
067800     END-IF.                                                      06780002
067900                                                                  06790002
068000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  06800002
068100                                                                  06810002
068200/                                                                 06820002
068300*----------------------------------------------------------------*06830002
068400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06840002
068500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06850002
068600* CICS ARCHITECTURE API.                                         *06860002
068700*----------------------------------------------------------------*06870002
068800 2100-CHECK-FUNCTION-KEY.                                         06880002
068900                                                                  06890002
069000     EVALUATE TRUE                                                06900002
069100         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  06910002
069200             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              06920002
069300                 SET ASC-NO-TSQ-UPDATE TO TRUE                    06930002
069400             END-IF                                               06940002
069500             INITIALIZE CN003-INTER-APPL-COMMAREA                 06950002
069600             MOVE ASC-KEY-OPER-UNT-ID                             06960003
069700                                 TO CN003-OPER-UNT-ID             06970003
069800             MOVE ASC-KEY-FCLTY-ID                                06980003
069900                                 TO CN003-FCLTY-ID                06990003
070000             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    07000002
070100                                 TO CN003-NUMBER-OF-SELECTED-ITEMS07010002
070200             PERFORM 5000-PREPARE-SEL-QUEUE                       07020002
070300                                                                  07030002
070400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07040002
070500             MOVE +1               TO PV-TOP-ITEM                 07050002
070600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07060002
070700             PERFORM 3200-RESET-ATTRIBUTES                        07070003
070800                                                                  07080002
070900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07090002
071000             PERFORM 2110-BROWSE-BACKWARD                         07100002
071100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07110002
071200             PERFORM 3200-RESET-ATTRIBUTES                        07120003
071300                                                                  07130002
071400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07140002
071500             PERFORM 2120-BROWSE-FORWARD                          07150002
071600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07160002
071700             PERFORM 3200-RESET-ATTRIBUTES                        07170003
071800                                                                  07180002
071900         WHEN DP020-SRC-AID = DP016-ENTER                         07190002
072000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07200002
072100             IF  PS-ERROR                                         07210002
072200                 CONTINUE                                         07220002
072300             ELSE                                                 07230002
072400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07240002
072500             END-IF                                               07250002
072600                                                                  07260002
072700         WHEN OTHER                                               07270002
072800             SET DP013-NO-ROLLBACK                                07280002
072900                 DP013-XCTL-DISPLAY-RESTART                       07290002
073000                 DP013-CICS-ABEND  TO TRUE                        07300002
073100             MOVE '2100-CHECK-FUNCTION-KEY'                       07310002
073200                                   TO DP013-PARAGRAPH             07320002
073300             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07330002
073400                                   TO DP013-MESSAGE-TEXT (1)      07340002
073500             PERFORM DP013-0000-PROCESS-ABEND                     07350002
073600     END-EVALUATE.                                                07360002
073700                                                                  07370002
073800/                                                                 07380002
073900*----------------------------------------------------------------*07390002
074000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07400002
074100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07410002
074200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07420002
074300*    MESSAGE.                                                    *07430002
074400*----------------------------------------------------------------*07440002
074500                                                                  07450002
074600 2110-BROWSE-BACKWARD.                                            07460002
074700                                                                  07470002
074800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07480002
074900         GIVING PV-TOP-ITEM.                                      07490002
075000                                                                  07500002
075100     IF  ((PV-TOP-ITEM < +1)                                      07510002
075200       OR (PV-TOP-ITEM = +1))                                     07520002
075300         MOVE +1                   TO PV-TOP-ITEM                 07530002
075400*        -- TOP OF LIST --                                        07540002
075500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07550002
075600         SET DP020-MSG-INFORMATIONAL                              07560002
075700                                   TO TRUE                        07570002
075800     END-IF.                                                      07580002
075900                                                                  07590002
076000/                                                                 07600002
076100*----------------------------------------------------------------*07610002
076200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07620002
076300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07630002
076400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07640002
076500*----------------------------------------------------------------*07650002
076600                                                                  07660002
076700 2120-BROWSE-FORWARD.                                             07670002
076800                                                                  07680002
076900     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07690002
077000         GIVING PV-TOP-ITEM.                                      07700002
077100                                                                  07710002
077200     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07720002
077300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07730002
077400                                   TO PV-TOP-ITEM                 07740002
077500*        -- BOTTOM OF LIST --                                     07750002
077600         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07760002
077700         SET DP020-MSG-INFORMATIONAL                              07770002
077800                                   TO TRUE                        07780002
077900     ELSE                                                         07790002
078000         COMPUTE PV-BOTTOM-ITEM =                                 07800002
078100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07810002
078200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07820002
078300*            -- BOTTOM OF LIST --                                 07830002
078400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07840002
078500             SET DP020-MSG-INFORMATIONAL                          07850002
078600                                   TO TRUE                        07860002
078700         END-IF                                                   07870002
078800     END-IF.                                                      07880002
078900                                                                  07890002
079000/                                                                 07900002
079100*----------------------------------------------------------------*07910002
079200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07920002
079300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07930002
079400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07940002
079500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07950002
079600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07960002
079700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07970002
079800*----------------------------------------------------------------*07980002
079900                                                                  07990002
080000 2130-CHECK-FOR-JUMP-BROWSE.                                      08000002
080100                                                                  08010002
080200     SET PS-NO-ERROR               TO TRUE.                       08020002
080300     IF (ASC-START-ITEM-REQUEST = SPACE)                          08030002
080400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08040002
080500                                   TO PV-TOP-ITEM                 08050002
080600     ELSE                                                         08060002
080700         MOVE ASC-START-ITEM-REQUEST                              08070002
080800                                   TO DP010I-UNEDITED-FIELD       08080002
080900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08090002
081000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08100002
081100         SET DP010I-NEGATIVE-NOT-ALLOWED                          08110002
081200                                   TO TRUE                        08120002
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08131006
263455              USING DP010I-NUMERIC-EDIT-AREA                      08132006
081400                                                                  08140002
081500         IF  NOT DP010I-ERROR-DETECTED                            08150002
081600             MOVE DP010I-NUMERIC-FIELD                            08160002
081700                                   TO ASC-START-ITEM-REQUEST-N    08170002
081800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08180002
081900                 IF  ASC-START-ITEM-REQUEST-N >                   08190002
082000                                          ASC-NUMBER-OF-ITEMS-READ08200002
082100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08210002
082200                     COMPUTE PV-TOP-ITEM =                        08220002
082300                             ASC-NUMBER-OF-ITEMS-READ             08230002
082400                             - PC-ITEMS-PER-PANEL + 1             08240002
082500                     IF  PV-TOP-ITEM < +1                         08250002
082600                         MOVE +1   TO PV-TOP-ITEM                 08260002
082700                         MOVE PC-TSYMSG-00070                     08270002
082800                                   TO DP020-MSG-NUMBER            08280002
082900                         SET DP020-MSG-INFORMATIONAL              08290002
083000                                   TO TRUE                        08300002
083100                     END-IF                                       08310002
083200                 ELSE                                             08320002
083300                     MOVE ASC-START-ITEM-REQUEST-N                08330002
083400                                   TO PV-TOP-ITEM                 08340002
083500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08350002
083600                     COMPUTE PV-BOTTOM-ITEM =                     08360002
083700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08370002
083800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08380002
083900*                        -- BOTTOM OF LIST --                     08390002
084000                         MOVE PC-TSYMSG-00070                     08400002
084100                                   TO DP020-MSG-NUMBER            08410002
084200                         SET DP020-MSG-INFORMATIONAL              08420002
084300                                   TO TRUE                        08430002
084400                     END-IF                                       08440002
084500                 END-IF                                           08450002
084600             ELSE                                                 08460002
084700*                --- VALUE OUT OF RANGE ----                      08470002
084800                 MOVE PC-TSYMSG-00101                             08480002
084900                                   TO DP020-MSG-NUMBER            08490002
085000                 MOVE -1           TO ASTRTITL                    08500002
085100                 SET DP030-SET-CURSOR-APPL-1                      08510002
085200                                   TO TRUE                        08520002
085300                 MOVE DP015-REVERSE                               08530002
085400                                   TO ASTRTITH                    08540002
085500                 MOVE DP015-RED    TO ASTRTITC                    08550002
085600                 MOVE DP015-UNP-NUM-BRT-MDT                       08560002
085700                                   TO ASTRTITA                    08570002
085800                 SET DP020-MSG-FATAL                              08580002
085900                                   TO TRUE                        08590002
086000                 SET PS-ERROR      TO TRUE                        08600002
086100             END-IF                                               08610002
086200                                                                  08620002
086300         ELSE                                                     08630002
086400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08640002
086500             MOVE -1               TO ASTRTITL                    08650002
086600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08660002
086700             MOVE DP015-REVERSE    TO ASTRTITH                    08670002
086800             MOVE DP015-RED        TO ASTRTITC                    08680002
086900             MOVE DP015-UNP-NUM-BRT-MDT                           08690002
087000                                   TO ASTRTITA                    08700002
087100             SET DP020-MSG-FATAL   TO TRUE                        08710002
087200             SET PS-ERROR          TO TRUE                        08720002
087300         END-IF                                                   08730002
087400     END-IF.                                                      08740002
087500                                                                  08750002
087600/                                                                 08760002
087700*----------------------------------------------------------------*08770002
087800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *08780002
087900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *08790002
088000*----------------------------------------------------------------*08800002
088100 2140-DESELECT-ALL-ITEMS.                                         08810002
088200                                                                  08820002
088300     MOVE +1                       TO ASC-BLK-SUB.                08830002
088400                                                                  08840002
088500     PERFORM 2141-CLEAR-SELECTED-INDS                             08850002
088600         VARYING ASC-ITEM-SUB                                     08860002
088700         FROM 1 BY 1                                              08870002
088800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08880002
088900                                                                  08890002
089000     ADD +1                        TO ASC-BLK-SUB.                08900002
089100                                                                  08910002
089200     PERFORM 2141-CLEAR-SELECTED-INDS                             08920002
089300         VARYING ASC-ITEM-SUB                                     08930002
089400         FROM 1 BY 1                                              08940002
089500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 08950002
089600                                                                  08960002
089700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               08970002
089800                                   TO PV-LIST-ITEM-NUMBER.        08980002
089900                                                                  08990002
090000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09000002
090100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09010002
090200                                                                  09020002
090300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09030002
090400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09040002
090500         MOVE +1                   TO ASC-BLK-SUB                 09050002
090600                                                                  09060002
090700         PERFORM 5100-WRITE-TEMP-STORAGE                          09070002
090800                                                                  09080002
090900         MOVE +1                   TO PV-BLOCK-NUMBER             09090002
091000                                                                  09100002
091100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09110002
091200             PV-FIRST-BLOCK-IN-ARRAY - 1                          09120002
091300                                                                  09130002
091400         PERFORM                                                  09140002
091500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09150002
091600                                                                  09160002
091700             PERFORM 4410-READ-TEMP-STORAGE                       09170002
091800                                                                  09180002
091900             PERFORM 2141-CLEAR-SELECTED-INDS                     09190002
092000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09200002
092100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09210002
092200                                                                  09220002
092300             PERFORM 5100-WRITE-TEMP-STORAGE                      09230002
092400                                                                  09240002
092500             ADD +1                TO PV-BLOCK-NUMBER             09250002
092600                                                                  09260002
092700         END-PERFORM                                              09270002
092800                                                                  09280002
092900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09290002
093000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09300002
093100                                                                  09310002
093200         PERFORM                                                  09320002
093300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09330002
093400                   ASC-HIGHEST-BLOCK-WRITTEN                      09340002
093500                                                                  09350002
093600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09360002
093700                                   TO PV-BLOCK-NUMBER             09370002
093800                                                                  09380002
093900             PERFORM 4410-READ-TEMP-STORAGE                       09390002
094000                                                                  09400002
094100             PERFORM 2141-CLEAR-SELECTED-INDS                     09410002
094200                 VARYING ASC-ITEM-SUB                             09420002
094300                 FROM 1 BY 1                                      09430002
094400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09440002
094500                                                                  09450002
094600             PERFORM 5100-WRITE-TEMP-STORAGE                      09460002
094700                                                                  09470002
094800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09480002
094900                                                                  09490002
095000         END-PERFORM                                              09500002
095100                                                                  09510002
095200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09520002
095300                                   TO PV-BLOCK-NUMBER             09530002
095400                                                                  09540002
095500         PERFORM 4410-READ-TEMP-STORAGE                           09550002
095600     END-IF.                                                      09560002
095700                                                                  09570002
095800                                                                  09580002
095900     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS09590002
096000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09600002
096100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09610002
096200                                                                  09620002
096300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09630002
096400                                                                  09640002
096500/                                                                 09650002
096600*----------------------------------------------------------------*09660002
096700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09670002
096800*----------------------------------------------------------------*09680002
096900                                                                  09690002
097000 2141-CLEAR-SELECTED-INDS.                                        09700002
097100                                                                  09710002
097200     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          09720002
097300             NOT EQUAL ZERO                                       09730002
097400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09740002
097500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09750002
097600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09760002
097700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  09770002
097800                                   TO TRUE                        09780002
097900         END-IF                                                   09790002
098000     END-IF.                                                      09800002
098100                                                                  09810002
098200/                                                                 09820002
098300*----------------------------------------------------------------*09830002
098400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *09840002
098500*  FOR ALL ITEMS.                                                *09850002
098600*----------------------------------------------------------------*09860002
098700                                                                  09870002
098800 2150-SELECT-ALL-ITEMS.                                           09880002
098900                                                                  09890002
099000     MOVE +1                       TO ASC-BLK-SUB.                09900002
099100                                                                  09910002
099200     PERFORM 2151-SET-SELECTED-INDS                               09920002
099300         VARYING ASC-ITEM-SUB                                     09930002
099400         FROM 1 BY 1                                              09940002
099500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09950002
099600                                                                  09960002
099700     ADD +1                        TO ASC-BLK-SUB.                09970002
099800                                                                  09980002
099900     PERFORM 2151-SET-SELECTED-INDS                               09990002
100000         VARYING ASC-ITEM-SUB                                     10000002
100100         FROM 1 BY 1                                              10010002
100200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10020002
100300                                                                  10030002
100400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10040002
100500                                   TO PV-LIST-ITEM-NUMBER.        10050002
100600                                                                  10060002
100700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10070002
100800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10080002
100900                                                                  10090002
101000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10100002
101100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10110002
101200         MOVE +1                   TO ASC-BLK-SUB                 10120002
101300                                                                  10130002
101400         PERFORM 5100-WRITE-TEMP-STORAGE                          10140002
101500                                                                  10150002
101600         MOVE +1                   TO PV-BLOCK-NUMBER             10160002
101700                                                                  10170002
101800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10180002
101900             PV-FIRST-BLOCK-IN-ARRAY - 1                          10190002
102000                                                                  10200002
102100         PERFORM                                                  10210002
102200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10220002
102300                                                                  10230002
102400             PERFORM 4410-READ-TEMP-STORAGE                       10240002
102500                                                                  10250002
102600             PERFORM 2151-SET-SELECTED-INDS                       10260002
102700                 VARYING ASC-ITEM-SUB                             10270002
102800                 FROM 1 BY 1                                      10280002
102900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10290002
103000                                                                  10300002
103100             PERFORM 5100-WRITE-TEMP-STORAGE                      10310002
103200                                                                  10320002
103300             ADD +1                TO PV-BLOCK-NUMBER             10330002
103400         END-PERFORM                                              10340002
103500                                                                  10350002
103600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10360002
103700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10370002
103800                                                                  10380002
103900         PERFORM                                                  10390002
104000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10400002
104100                   ASC-HIGHEST-BLOCK-WRITTEN                      10410002
104200                                                                  10420002
104300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10430002
104400                                   TO PV-BLOCK-NUMBER             10440002
104500                                                                  10450002
104600             PERFORM 4410-READ-TEMP-STORAGE                       10460002
104700                                                                  10470002
104800             PERFORM 2151-SET-SELECTED-INDS                       10480002
104900                 VARYING ASC-ITEM-SUB                             10490002
105000                 FROM 1 BY 1                                      10500002
105100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10510002
105200                                                                  10520002
105300             PERFORM 5100-WRITE-TEMP-STORAGE                      10530002
105400                                                                  10540002
105500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10550002
105600         END-PERFORM                                              10560002
105700                                                                  10570002
105800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10580002
105900                                   TO PV-BLOCK-NUMBER             10590002
106000                                                                  10600002
106100         PERFORM 4410-READ-TEMP-STORAGE                           10610002
106200     END-IF.                                                      10620002
106300                                                                  10630002
106400                                                                  10640002
106500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10650002
106600          ASC-NUMBER-OF-SELECTED-ITEMS.                           10660002
106700                                                                  10670002
106800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10680002
106900                                                                  10690002
107000/                                                                 10700002
107100*----------------------------------------------------------------*10710002
107200*    MARK EACH ITEM AS BEING SELECTED.                           *10720002
107300*----------------------------------------------------------------*10730002
107400                                                                  10740002
107500 2151-SET-SELECTED-INDS.                                          10750002
107600                                                                  10760002
107700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10770002
107800             NOT EQUAL ZERO                                       10780002
107900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10790002
108000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             10800002
108100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        10810002
108200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10820002
108300                                   TO TRUE                        10830002
108400         END-IF                                                   10840002
108500     END-IF.                                                      10850002
108600                                                                  10860002
108700/                                                                 10870002
108800*----------------------------------------------------------------*10880002
108900*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *10890002
109000*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *10900002
109100*----------------------------------------------------------------*10910002
109200 2200-MOVE-SCREEN-TO-COMMAREA.                                    10920002
109300                                                                  10930002
109400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10940002
109500     MOVE +1                       TO PV-SUB.                     10950002
109600                                                                  10960002
109700     PERFORM 3100-SET-SUBSCRIPTS.                                 10970002
109800                                                                  10980002
109900     IF  ASTRTITL > ZERO                                          10990002
110000         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      11000002
110100     ELSE                                                         11010002
110200         IF  ASTRTITF = DP015-ERASE-EOF                           11020002
110300             INITIALIZE ASC-START-ITEM-REQUEST                    11030002
110400         END-IF                                                   11040002
110500     END-IF.                                                      11050002
110600                                                                  11060002
110700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11070002
110800         VARYING PV-SUB                                           11080002
110900         FROM 1 BY 1                                              11090002
111000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11100002
111100                                                                  11110002
111200/                                                                 11120002
111300*----------------------------------------------------------------*11130002
111400*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *11140002
111500*----------------------------------------------------------------*11150002
111600 2210-MOVE-LINES-TO-COMMAREA.                                     11160002
111700                                                                  11170002
111800     IF  MR-SELECTL (PV-SUB) > ZERO                               11180002
111900         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     11190002
112000                                   TO TRUE                        11200002
112100         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        11210002
112200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11220002
112300     ELSE                                                         11230002
112400         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11240002
112500             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         11250002
112600             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        11260002
112700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11270002
112800         END-IF                                                   11280002
112900     END-IF.                                                      11290002
113000                                                                  11300002
113100     ADD +1                        TO ASC-ITEM-SUB.               11310002
113200                                                                  11320002
113300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11330002
113400         ADD +1                    TO ASC-BLK-SUB                 11340002
113500         MOVE +1                   TO ASC-ITEM-SUB                11350002
113600     END-IF.                                                      11360002
113700                                                                  11370002
113800/                                                                 11380002
113900*----------------------------------------------------------------*11390002
114000*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *11400002
114100*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *11410002
114200*----------------------------------------------------------------*11420002
114300 3000-EDIT-DATA-IN-COMMAREA.                                      11430002
114400                                                                  11440002
114500     SET PS-NO-ERROR               TO TRUE.                       11450002
114600                                                                  11460002
114700     PERFORM 3200-RESET-ATTRIBUTES.                               11470002
114800                                                                  11480002
114900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     11490002
115000**                                                                11500002
115100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              11510002
115200* EDITTING IS DONE FROM THE BOTTOM UP.                            11520002
115300**                                                                11530002
115400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       11540002
115500         ASC-ITEMS-DISPLAYED - 1.                                 11550002
115600                                                                  11560002
115700     PERFORM 3100-SET-SUBSCRIPTS.                                 11570002
115800     PERFORM 3300-EDIT-SELECTIONS                                 11580002
115900         VARYING PV-SUB                                           11590002
116000         FROM PV-SUB BY -1                                        11600002
116100         UNTIL PV-SUB < +1                                        11610002
116200                                                                  11620002
116300     IF  PS-NO-ERROR                                              11630002
116400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        11640002
116500     END-IF.                                                      11650002
116600                                                                  11660002
116700     IF  ((PS-NO-ERROR)                                           11670002
116800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11680002
116900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11690002
117000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11700002
117100     END-IF.                                                      11710002
117200                                                                  11720002
117300/                                                                 11730002
117400*----------------------------------------------------------------*11740002
117500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *11750002
117600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*11760002
117700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *11770002
117800*                                                                *11780002
117900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *11790002
118000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *11800002
118100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *11810002
118200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *11820002
118300*----------------------------------------------------------------*11830002
118400                                                                  11840002
118500 3100-SET-SUBSCRIPTS.                                             11850002
118600                                                                  11860002
118700     COMPUTE ASC-ITEM-SUB =                                       11870002
118800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        11880002
118900                                                                  11890002
119000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         11900002
119100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11910002
119200                                                                  11920002
119300         MOVE PC-MAX-BLOCKS-IN-ARRAY                              11930002
119400                                   TO ASC-BLK-SUB                 11940002
119500     ELSE                                                         11950002
119600         MOVE +1                   TO ASC-BLK-SUB                 11960002
119700     END-IF.                                                      11970002
119800                                                                  11980002
119900*----------------------------------------------------------------*11990002
120000*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *12000002
120100*----------------------------------------------------------------*12010002
120200                                                                  12020002
120300 3200-RESET-ATTRIBUTES.                                           12030002
120400                                                                  12040002
120500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12050002
120600     MOVE DP015-GREEN              TO ASTRTITC.                   12060002
120700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12070002
120800                                                                  12080002
120900     IF DP020-NEXT-ACT-RETURN                                     12090002
121000     OR DP020-NEXT-ACT-READ-MAP                                   12100003
121100         PERFORM                                                  12110002
121200             VARYING PV-SUB                                       12120002
121300             FROM 1 BY 1                                          12130002
121400             UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                   12140002
121500             MOVE DP015-UNP-ALP-NOR-OFF                           12150002
121600                                   TO MR-SELECTA (PV-SUB)         12160002
121700             MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)         12170002
121800             MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)         12180002
121900         END-PERFORM                                              12190002
122000     ELSE                                                         12200002
122100         PERFORM                                                  12210002
122200             VARYING PV-SUB                                       12220002
122300             FROM 1 BY 1                                          12230002
122400             UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    12240002
122500             MOVE DP015-UNP-ALP-NOR-OFF                           12250002
122600                                   TO MR-SELECTA (PV-SUB)         12260002
122700             MOVE DP015-GREEN      TO MR-SELECTC (PV-SUB)         12270002
122800             MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)         12280002
122900         END-PERFORM                                              12290002
123000     END-IF.                                                      12300002
123100                                                                  12310002
123200*----------------------------------------------------------------*12320002
123300*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *12330002
123400*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *12340002
123500*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *12350002
123600*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *12360002
123700*----------------------------------------------------------------*12370002
123800 3300-EDIT-SELECTIONS.                                            12380002
123900                                                                  12390002
124000     EVALUATE TRUE                                                12400002
124100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12410002
124200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12420002
124300                 CONTINUE                                         12430002
124400                                                                  12440002
124500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12450002
124600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12460002
124700                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS12470002
124800                 MOVE ASC-TEMP-SELECTED-SW                        12480002
124900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12490002
125000                                   TO ASC-SELECTED-SW             12500002
125100                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12510002
125200             END-IF                                               12520002
125300                                                                  12530002
125400         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12540002
125500                 = SPACE                                          12550002
125600             EVALUATE TRUE                                        12560002
125700                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12570002
125800                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12580002
125900                     MOVE SPACE    TO ASC-SELECTED-SW             12590002
126000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12600002
126100                                                                  12610002
126200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12620002
126300                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 12630002
126400                     MOVE SPACE    TO ASC-SELECTED-SW             12640002
126500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12650002
126600                                                                  12660002
126700                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          12670002
126800                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   12680002
126900                     MOVE SPACE    TO ASC-SELECTED-SW             12690002
127000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12700002
127100             END-EVALUATE                                         12710002
127200                                                                  12720002
127300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           12730002
127400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12740002
127500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12750002
127600             END-IF                                               12760002
127700             PERFORM 3310-EDIT-RANGE                              12770002
127800                                                                  12780002
127900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             12790002
128000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12800002
128100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    12810002
128200             END-IF                                               12820002
128300             PERFORM 3310-EDIT-RANGE                              12830002
128400                                                                  12840002
128500         WHEN OTHER                                               12850002
128600             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            12860002
128700             SET DP020-MSG-FATAL   TO TRUE                        12870002
128800             MOVE -1               TO MR-SELECTL (PV-SUB)         12880002
128900             SET DP030-SET-CURSOR-APPL-1                          12890002
129000                                   TO TRUE                        12900002
129100             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         12910002
129200             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         12920002
129300             SET PS-ERROR          TO TRUE                        12930002
129400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            12940002
129500                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     12950002
129600                 MOVE SPACE        TO ASC-SELECTED-SW             12960002
129700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   12970002
129800             END-IF                                               12980002
129900     END-EVALUATE.                                                12990002
130000                                                                  13000002
130100     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             13010002
130200     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13020002
130300                                                                  13030002
130400     IF  ASC-ITEM-SUB < 1                                         13040002
130500         SUBTRACT +1 FROM ASC-BLK-SUB                             13050002
130600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13060002
130700     END-IF.                                                      13070002
130800                                                                  13080002
130900*----------------------------------------------------------------*13090002
131000*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *13100002
131100*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *13110002
131200*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *13120002
131300*  THE ENDING.                                                   *13130002
131400*----------------------------------------------------------------*13140002
131500 3310-EDIT-RANGE.                                                 13150002
131600                                                                  13160002
131700     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13170002
131800         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13180002
131900             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13190002
132000                                   TO ASC-SELECTED-SW             13200002
132100                                        (ASC-BLK-SUB ASC-ITEM-SUB)13210002
132200             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13220002
132300         ELSE                                                     13230002
132400             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13240002
132500                 CONTINUE                                         13250002
132600             ELSE                                                 13260002
132700*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13270002
132800                 MOVE PC-TSYMSG-00054                             13280002
132900                                   TO DP020-MSG-NUMBER            13290002
133000                 SET DP020-MSG-FATAL                              13300002
133100                                   TO TRUE                        13310002
133200                 MOVE -1           TO MR-SELECTL (PV-SUB)         13320002
133300                 SET DP030-SET-CURSOR-APPL-1                      13330002
133400                                   TO TRUE                        13340002
133500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13350002
133600                 MOVE DP015-UNDERLINE                             13360002
133700                                   TO MR-SELECTH (PV-SUB)         13370002
133800                 SET PS-ERROR      TO TRUE                        13380002
133900             END-IF                                               13390002
134000         END-IF                                                   13400002
134100     ELSE                                                         13410002
134200         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13420002
134300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13430002
134400                                   TO ASC-SELECTED-SW             13440002
134500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13450002
134600             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13460002
134700         ELSE                                                     13470002
134800             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13480002
134900                 CONTINUE                                         13490002
135000             ELSE                                                 13500002
135100*                -- ONLY ONE END-OF-RANGE ALLOWED --              13510002
135200                 MOVE PC-TSYMSG-00055                             13520002
135300                                   TO DP020-MSG-NUMBER            13530002
135400                 SET DP020-MSG-FATAL                              13540002
135500                                   TO TRUE                        13550002
135600                 MOVE -1           TO MR-SELECTL (PV-SUB)         13560002
135700                 SET DP030-SET-CURSOR-APPL-1                      13570002
135800                                   TO TRUE                        13580002
135900                 SET PS-ERROR      TO TRUE                        13590002
136000             END-IF                                               13600002
136100         END-IF                                                   13610002
136200     END-IF.                                                      13620002
136300                                                                  13630002
136400*----------------------------------------------------------------*13640002
136500*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *13650002
136600*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *13660002
136700*----------------------------------------------------------------*13670002
136800 3400-CHECK-RANGE-SEQUENCE.                                       13680002
136900                                                                  13690002
137000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13700002
137100       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13710002
137200       AND  ASC-START-OF-SELECTED-RANGE >                         13720002
137300                                         ASC-END-OF-SELECTED-RANGE13730002
137400*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                13740002
137500         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            13750002
137600         SET DP020-MSG-FATAL       TO TRUE                        13760002
137700         SET PS-ERROR              TO TRUE                        13770002
137800         PERFORM 3410-POSITION-AT-ERROR                           13780002
137900     END-IF.                                                      13790002
138000                                                                  13800002
138100*----------------------------------------------------------------*13810002
138200*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *13820002
138300*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *13830002
138400*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *13840002
138500*----------------------------------------------------------------*13850002
138600 3410-POSITION-AT-ERROR.                                          13860002
138700                                                                  13870002
138800     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       13880002
138900                                                                  13890002
139000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 13900002
139100                    - PV-TOP-ITEM + 1.                            13910002
139200                                                                  13920002
139300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      13930002
139400         CONTINUE                                                 13940002
139500     ELSE                                                         13950002
139600         MOVE -1                   TO MR-SELECTL (PV-SUB)         13960002
139700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         13970002
139800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         13980002
139900     END-IF.                                                      13990002
140000                                                                  14000002
140100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14010002
140200                    - PV-TOP-ITEM + 1.                            14020002
140300                                                                  14030002
140400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14040002
140500         CONTINUE                                                 14050002
140600     ELSE                                                         14060002
140700         MOVE -1                   TO MR-SELECTL (PV-SUB)         14070002
140800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14080002
140900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14090002
141000     END-IF.                                                      14100002
141100                                                                  14110002
141200/                                                                 14120002
141300*----------------------------------------------------------------*14130002
141400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14140002
141500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14150002
141600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14160002
141700*----------------------------------------------------------------*14170002
141800                                                                  14180002
141900 3500-MARK-RANGE-AS-SELECTED.                                     14190002
142000                                                                  14200002
142100     MOVE +1                       TO ASC-BLK-SUB.                14210002
142200                                                                  14220002
142300     PERFORM 3510-MARK-SELECTED-INDS                              14230002
142400         VARYING ASC-ITEM-SUB                                     14240002
142500         FROM 1 BY 1                                              14250002
142600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14260002
142700                                                                  14270002
142800     ADD +1                        TO ASC-BLK-SUB.                14280002
142900                                                                  14290002
143000     PERFORM 3510-MARK-SELECTED-INDS                              14300002
143100         VARYING ASC-ITEM-SUB                                     14310002
143200         FROM 1 BY 1                                              14320002
143300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14330002
143400                                                                  14340002
143500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14350002
143600                                   TO PV-LIST-ITEM-NUMBER.        14360002
143700                                                                  14370002
143800     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14380002
143900         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14390002
144000               PC-ITEMS-PER-PANEL).                               14400002
144100                                                                  14410002
144200     MOVE ASC-START-OF-SELECTED-RANGE                             14420002
144300                                   TO PV-START-OF-SELECTED-RANGE. 14430002
144400                                                                  14440002
144500     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14450002
144600         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14460002
144700               PC-ITEMS-PER-PANEL).                               14470002
144800                                                                  14480002
144900     MOVE ASC-END-OF-SELECTED-RANGE                               14490002
145000                                   TO PV-END-OF-SELECTED-RANGE.   14500002
145100                                                                  14510002
145200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14520002
145300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14530002
145400               PC-ITEMS-PER-PANEL).                               14540002
145500                                                                  14550002
145600     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14560002
145700         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14570002
145800                                                                  14580002
145900     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14590002
146000        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14600002
146100         MOVE +1                   TO ASC-BLK-SUB                 14610002
146200         PERFORM 5100-WRITE-TEMP-STORAGE                          14620002
146300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14630002
146400             PV-FIRST-BLOCK-IN-ARRAY - 1                          14640002
146500                                                                  14650002
146600         PERFORM                                                  14660002
146700             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14670002
146800                   PV-PREV-BLOCK-IN-ARRAY                         14680002
146900             MOVE PV-FIRST-BLOCK-IN-RANGE                         14690002
147000                                   TO PV-BLOCK-NUMBER             14700002
147100             PERFORM 4410-READ-TEMP-STORAGE                       14710002
147200             PERFORM 3510-MARK-SELECTED-INDS                      14720002
147300                 VARYING ASC-ITEM-SUB                             14730002
147400                 FROM 1 BY 1                                      14740002
147500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14750002
147600             PERFORM 5100-WRITE-TEMP-STORAGE                      14760002
147700             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14770002
147800         END-PERFORM                                              14780002
147900                                                                  14790002
148000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14800002
148100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14810002
148200         PERFORM                                                  14820002
148300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14830002
148400                   PV-LAST-BLOCK-IN-RANGE                         14840002
148500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14850002
148600                                   TO PV-BLOCK-NUMBER             14860002
148700             PERFORM 4410-READ-TEMP-STORAGE                       14870002
148800             PERFORM 3510-MARK-SELECTED-INDS                      14880002
148900                 VARYING ASC-ITEM-SUB                             14890002
149000                 FROM 1 BY 1                                      14900002
149100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14910002
149200             PERFORM 5100-WRITE-TEMP-STORAGE                      14920002
149300             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14930002
149400         END-PERFORM                                              14940002
149500                                                                  14950002
149600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14960002
149700                                   TO PV-BLOCK-NUMBER             14970002
149800         PERFORM 4410-READ-TEMP-STORAGE                           14980002
149900     END-IF.                                                      14990002
150000                                                                  15000002
150100     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15010002
150200                                      ASC-END-OF-SELECTED-RANGE.  15020002
150300                                                                  15030002
150400/                                                                 15040002
150500*----------------------------------------------------------------*15050002
150600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15060002
150700*----------------------------------------------------------------*15070002
150800                                                                  15080002
150900 3510-MARK-SELECTED-INDS.                                         15090002
151000                                                                  15100002
151100     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         15110002
151200         ASC-START-OF-SELECTED-RANGE)                             15120002
151300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         15130002
151400         ASC-START-OF-SELECTED-RANGE)                             15140002
151500                                                                  15150002
151600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     15160002
151700             ASC-END-OF-SELECTED-RANGE)                           15170002
151800         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     15180002
151900             ASC-END-OF-SELECTED-RANGE)                           15190002
152000                                                                  15200002
152100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15210002
152200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15220002
152300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15230002
152400                                   TO TRUE                        15240002
152500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15250002
152600                                   TO TRUE                        15260002
152700                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS15270002
152800             END-IF                                               15280002
152900         END-IF                                                   15290002
153000     END-IF.                                                      15300002
153100                                                                  15310002
153200/                                                                 15320002
153300*----------------------------------------------------------------*15330002
153400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15340002
153500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15350002
153600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15360002
153700*    DISPLAY THE PANEL TO USER.                                  *15370002
153800*----------------------------------------------------------------*15380002
153900                                                                  15390002
154000 4000-BUILD-INITIAL-PANEL.                                        15400002
154100                                                                  15410002
154200     INITIALIZE ASC-BLOCK-ENTRIES (1)                             15420002
154300                ASC-BLOCK-ENTRIES (2).                            15430002
154400                                                                  15440002
154500     MOVE +1                       TO ASC-BLK-SUB.                15450002
154600                                                                  15460002
154700     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       15470002
154800                                                                  15480002
154900     MOVE +0                       TO ASC-ITEM-SUB                15490002
155000                                      ASC-NUMBER-OF-ITEMS-READ    15500002
155100                                      ASC-NUMBER-OF-SELECTED-ITEMS15510002
155200                                      ASC-HIGHEST-BLOCK-WRITTEN   15520002
155300                                      ASC-START-OF-SELECTED-RANGE 15530002
155400                                      ASC-END-OF-SELECTED-RANGE   15540002
155500                                      ASC-ITEM-AT-TOP-OF-PANEL.   15550002
155600                                                                  15560002
155700     PERFORM 4100-PREPARE-CURSOR.                                 15570002
155800                                                                  15580002
155900     PERFORM 4010-OPEN-CURSOR.                                    15590002
156000                                                                  15600002
156100     PERFORM 4300-READ-ITEMS-FROM-DB.                             15610002
156200                                                                  15620002
156300     PERFORM 4020-CLOSE-CURSOR.                                   15630002
156400                                                                  15640002
156500     MOVE +1                       TO PV-TOP-ITEM.                15650002
156600                                                                  15660002
156700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15670002
156800         SET DP020-NEXT-ACT-APPL-ERROR                            15680002
156900                                   TO TRUE                        15690002
157000         SET DP020-MSG-FATAL       TO TRUE                        15700002
157100         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            15710002
157200     ELSE                                                         15720002
157300         MOVE -1                   TO MR-SELECTL (1)              15730002
157400         SET DP030-SET-CURSOR-APPL-1                              15740002
157500                                   TO TRUE                        15750002
157600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15760002
157700     END-IF.                                                      15770002
157800                                                                  15780002
157900/                                                                 15790002
158000*----------------------------------------------------------------*15800002
158100* OPEN THE FACILITY CURSOR.                                      *15810002
158200*----------------------------------------------------------------*15820002
158300                                                                  15830002
158400 4010-OPEN-CURSOR.                                                15840002
158500                                                                  15850002
158600     PERFORM                                                      15860002
158700         WITH TEST AFTER                                          15870002
158800         VARYING PV-RETRY-COUNTER                                 15880002
158900         FROM 1 BY 1                                              15890002
159000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15900002
159100            OR (SQLCODE = +0))                                    15910002
159200                                                                  15920002
159300         EXEC SQL                                                 15930002
159400             OPEN FCLTY-CSR                                       15940002
159500         END-EXEC                                                 15950002
159600                                                                  15960002
159700         EVALUATE TRUE                                            15970002
159800             WHEN SQLCODE = +0                                    15980002
159900                  CONTINUE                                        15990002
160000             WHEN SQLCODE = -904                                  16000002
160100             WHEN SQLCODE = -913                                  16010002
160200                  CONTINUE                                        16020002
160300             WHEN SQLWARN0 NOT = SPACE                            16030002
160400             WHEN SQLCODE  NOT = +0                               16040002
160500                  MOVE '4010-OPEN-CURSOR'                         16050002
160600                                   TO DP013-PARAGRAPH             16060002
160700                  MOVE 'OPEN FCLTY-CSR CURSOR'                    16070002
160800                                   TO DP013-MESSAGE-TEXT (1)      16080002
160900                  MOVE SQLCA       TO DP013-SQLCA                 16090002
161000                  MOVE 'TFLAREA'   TO DP013-DB2-TABLE-NAME (1)    16100003
161100                  SET DP013-DB2-ABEND                             16110002
161200                                   TO TRUE                        16120002
161300                  PERFORM DP013-0000-PROCESS-ABEND                16130002
161400         END-EVALUATE                                             16140002
161500     END-PERFORM.                                                 16150002
161600                                                                  16160002
161700     IF  PV-SQL-SUB > PC-MAX-RETRIES                              16170002
161800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16180002
161900         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              16190002
162000                                   TO DP013-MESSAGE-TEXT (1)      16200002
162100         MOVE SQLCA                TO DP013-SQLCA                 16210002
162200         SET DP013-DB2-ABEND       TO TRUE                        16220002
162300         PERFORM DP013-0000-PROCESS-ABEND                         16230002
162400     END-IF.                                                      16240002
162500                                                                  16250002
162600/                                                                 16260002
162700*----------------------------------------------------------------*16270002
162800* CLOSE THE FACILITY CURSOR.                                     *16280002
162900*----------------------------------------------------------------*16290002
163000                                                                  16300002
163100 4020-CLOSE-CURSOR.                                               16310002
163200                                                                  16320002
163300     EXEC SQL                                                     16330002
163400         CLOSE FCLTY-CSR                                          16340002
163500     END-EXEC.                                                    16350002
163600                                                                  16360002
163700     EVALUATE TRUE                                                16370002
163800         WHEN SQLCODE = +0                                        16380002
163900              CONTINUE                                            16390002
164000         WHEN SQLWARN0 NOT = SPACE                                16400002
164100         WHEN SQLCODE  NOT = +0                                   16410002
164200              MOVE '4020-CLOSE-CURSOR'                            16420002
164300                                   TO DP013-PARAGRAPH             16430002
164400              MOVE 'CLOSE FCLTY-CSR CURSOR'                       16440002
164500                                   TO DP013-MESSAGE-TEXT (1)      16450002
164600              MOVE SQLCA           TO DP013-SQLCA                 16460002
164700              MOVE 'TFLAREA'       TO DP013-DB2-TABLE-NAME (1)    16470003
164800              SET DP013-DB2-ABEND  TO TRUE                        16480002
164900              PERFORM DP013-0000-PROCESS-ABEND                    16490002
165000     END-EVALUATE.                                                16500002
165100                                                                  16510002
165200/                                                                 16520002
165300*----------------------------------------------------------------*16530002
165400*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *16540002
165500*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *16550002
165600*----------------------------------------------------------------*16560002
165700                                                                  16570002
165800 4100-PREPARE-CURSOR.                                             16580002
165900                                                                  16590002
166000     IF DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT           16600002
166100        IF CN001-FCLTY-ID > ZEROES                                16610003
166200           MOVE CN001-FCLTY-ID        TO DK-FCLTY-ID-LOW          16620003
166300                                         DK-FCLTY-ID-HIGH         16630003
166400                                         DK-FCLTY-ID              16640003
166500        ELSE                                                      16650002
166600           MOVE ZEROES                TO DK-FCLTY-ID-LOW          16660003
166700                                         DK-FCLTY-ID              16670003
166800           MOVE 9999                  TO DK-FCLTY-ID-HIGH         16680003
166900        END-IF                                                    16690002
167000        IF CN001-AREA-ID > SPACES                                 16700003
167100           MOVE CN001-AREA-ID         TO DK-AREA-ID-LOW           16710003
167200                                         DK-AREA-ID-HIGH          16720003
167300        ELSE                                                      16730003
167400           MOVE SPACES                TO DK-AREA-ID-LOW           16740003
167500           MOVE '999999'              TO DK-AREA-ID-HIGH          16750003
167600        END-IF                                                    16760003
167700        IF CN001-LOC-TYPE > SPACES                                16770002
167800           MOVE CN001-LOC-TYPE        TO DK-TYPE-LOW              16780002
167900                                         DK-TYPE-HIGH             16790002
168000        ELSE                                                      16800002
168100           MOVE SPACES                TO DK-TYPE-LOW              16810002
168200           MOVE '99'                  TO DK-TYPE-HIGH             16820002
168300        END-IF                                                    16830002
168400     ELSE                                                         16840002
168500        IF ASC-KEY-FCLTY-ID-LOW > ZEROES                          16850003
168600           MOVE ASC-KEY-FCLTY-ID-LOW  TO DK-FCLTY-ID-LOW          16860003
168700        ELSE                                                      16870002
168800           MOVE ZEROES                TO DK-FCLTY-ID-LOW          16880003
168900        END-IF                                                    16890002
169000        IF ASC-KEY-FCLTY-ID-HIGH > ZEROES                         16900003
169100           MOVE ASC-KEY-FCLTY-ID-HIGH TO DK-FCLTY-ID-HIGH         16910003
169200        ELSE                                                      16920002
169300           MOVE 9999                  TO DK-FCLTY-ID-HIGH         16930003
169400        END-IF                                                    16940002
169500        IF ASC-KEY-AREA-ID-LOW > SPACES                           16950003
169600           MOVE ASC-KEY-AREA-ID-LOW   TO DK-AREA-ID-LOW           16960003
169700        ELSE                                                      16970003
169800           MOVE SPACES                TO DK-AREA-ID-LOW           16980003
169900        END-IF                                                    16990003
170000        IF ASC-KEY-AREA-ID-HIGH > SPACES                          17000003
170100           MOVE ASC-KEY-AREA-ID-HIGH TO DK-AREA-ID-HIGH           17010003
170200        ELSE                                                      17020003
170300           MOVE '999999'              TO DK-AREA-ID-HIGH          17030003
170400        END-IF                                                    17040003
170500        IF ASC-KEY-TYPE-LOW > SPACES                              17050002
170600           MOVE ASC-KEY-TYPE-LOW      TO DK-TYPE-LOW              17060002
170700        ELSE                                                      17070002
170800           MOVE SPACES                TO DK-TYPE-LOW              17080002
170900        END-IF                                                    17090002
171000        IF ASC-KEY-TYPE-HIGH > SPACES                             17100002
171100           MOVE ASC-KEY-TYPE-HIGH     TO DK-TYPE-HIGH             17110002
171200        ELSE                                                      17120002
171300           MOVE '99'                  TO DK-TYPE-HIGH             17130002
171400        END-IF                                                    17140002
171500     END-IF.                                                      17150002
171600                                                                  17160002
171700/                                                                 17170002
171800*----------------------------------------------------------------*17180002
171900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17190002
172000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17200002
172100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17210002
172200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17220002
172300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17230002
172400*                                                                *17240002
172500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17250002
172600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17260002
172700*    UPON INITIALIZATION.                                        *17270002
172800*----------------------------------------------------------------*17280002
172900                                                                  17290002
173000 4300-READ-ITEMS-FROM-DB.                                         17300002
173100                                                                  17310002
173200     PERFORM 4320-GET-STORE-INFORMATION.                          17320003
173300                                                                  17330002
173400     PERFORM                                                      17340002
173500         VARYING PV-READ-COUNT                                    17350002
173600         FROM 1 BY 1                                              17360002
173700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17370002
173800            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17380002
173900                                                                  17390002
174000         PERFORM 4310-FETCH                                       17400002
174100                                                                  17410002
174200         IF  ASC-ITEMS-LEFT-ON-DB                                 17420002
174300             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17430002
174400                 ADD +1            TO ASC-ITEM-SUB                17440002
174500             ELSE                                                 17450002
174600                 ADD +1            TO ASC-BLK-SUB                 17460002
174700                 MOVE +1           TO ASC-ITEM-SUB                17470002
174800                                                                  17480002
174900                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17490002
175000                     MOVE +1       TO ASC-BLK-SUB                 17500002
175100                     SET ASC-BLOCK-MODIFIED (1)                   17510002
175200                                   TO TRUE                        17520002
175300                     PERFORM 5100-WRITE-TEMP-STORAGE              17530002
175400                     MOVE ASC-BLOCK-ENTRIES                       17540002
175500                               (PC-MAX-BLOCKS-IN-ARRAY)           17550002
175600                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17560002
175700                     ADD +1        TO ASC-BLK-SUB                 17570002
175800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17580002
175900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17590002
176000                                   TO TRUE                        17600002
176100                 END-IF                                           17610002
176200             END-IF                                               17620002
176300             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17630002
176400             MOVE ASC-NUMBER-OF-ITEMS-READ                        17640002
176500                                   TO ASC-LIST-ITEM-NUMBER        17650002
176600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17660002
176700             MOVE FLAREA-FCLTY-ID  TO ASC-FCLTY-ID                17670003
176800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17680003
176900             MOVE FLAREA-FCLTY-AREA-ID                            17690003
177000                                   TO ASC-AREA-ID                 17700003
177100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17710002
177200             MOVE FLAREA-FCLTY-LOC-TYP-CDE                        17720003
177300                                   TO ASC-TYPE                    17730002
177400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17740002
177500             IF DN-SUBAREA-OF-ID = -1                             17750002
177600                MOVE SPACES        TO ASC-SUBAREA                 17760002
177700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17770002
177800             ELSE                                                 17780002
177900                MOVE FLAREA-SUBAREA-OF-ID                         17790003
178000                                   TO ASC-SUBAREA                 17800002
178100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17810002
178200             END-IF                                               17820002
178300             MOVE FLAREA-FCLTY-AREA-DESC                          17830003
178400                                   TO ASC-DESC                    17840002
178500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17850002
178600             MOVE FLAREA-DEPT-CL-IND                              17860003
178700                                   TO ASC-DEPT-CL-IND             17870003
178800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17880002
178900         END-IF                                                   17890002
179000         MOVE ASC-KEY-OPER-UNT-ID  TO ASC-OPER-UNT-ID             17900003
179100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17910002
179200     END-PERFORM.                                                 17920002
179300                                                                  17930002
179400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17940002
179500         MOVE +1                   TO ASC-BLK-SUB                 17950002
179600         PERFORM 5100-WRITE-TEMP-STORAGE                          17960002
179700         ADD +1                    TO ASC-BLK-SUB                 17970002
179800         PERFORM 5100-WRITE-TEMP-STORAGE                          17980002
179900                                                                  17990002
180000         MOVE 1                    TO ASC-BLK-SUB                 18000002
180100                                      PV-BLOCK-NUMBER             18010002
180200         PERFORM 4410-READ-TEMP-STORAGE                           18020002
180300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             18030002
180400             MOVE 2                TO ASC-BLK-SUB                 18040002
180500                                      PV-BLOCK-NUMBER             18050002
180600             PERFORM 4410-READ-TEMP-STORAGE                       18060002
180700         END-IF                                                   18070002
180800     END-IF.                                                      18080002
180900                                                                  18090002
181000/                                                                 18100002
181100*----------------------------------------------------------------*18110002
181200*    FETCH THE FACILITY LOCATION CURSOR.                         *18120002
181300*----------------------------------------------------------------*18130002
181400                                                                  18140002
181500 4310-FETCH.                                                      18150002
181600                                                                  18160002
181700     EXEC SQL                                                     18170002
181800         FETCH FCLTY-CSR                                          18180002
181900          INTO :FLAREA-FCLTY-ID                                   18190003
182000              ,:FLAREA-FCLTY-AREA-ID                              18200003
182100              ,:FLAREA-SUBAREA-OF-ID                              18210003
182200                 :DN-SUBAREA-OF-ID                                18220002
182300              ,:FLAREA-FCLTY-LOC-TYP-CDE                          18230003
182400              ,:FLAREA-FCLTY-AREA-DESC                            18240003
182500              ,:FLAREA-DEPT-CL-IND                                18250003
182600     END-EXEC.                                                    18260002
182700                                                                  18270002
182800     EVALUATE TRUE                                                18280002
182900         WHEN SQLCODE = +0                                        18290002
183000              CONTINUE                                            18300002
183100         WHEN SQLCODE = +100                                      18310002
183200              SET ASC-NO-ITEMS-LEFT-ON-DB                         18320002
183300                                   TO TRUE                        18330002
183400         WHEN SQLWARN0 NOT = SPACE                                18340002
183500         WHEN SQLCODE < +0                                        18350002
183600         WHEN SQLCODE > +0                                        18360002
183700              MOVE '4310-FETCH-CURSOR'                            18370002
183800                                   TO DP013-PARAGRAPH             18380002
183900              MOVE 'FETCH FACILITY CURSOR'                        18390002
184000                                   TO DP013-MESSAGE-TEXT (1)      18400002
184100              MOVE SQLCA           TO DP013-SQLCA                 18410002
184200              MOVE 'TFLAREA'       TO DP013-DB2-TABLE-NAME (1)    18420003
184300              SET DP013-DB2-ABEND  TO TRUE                        18430002
184400              PERFORM DP013-0000-PROCESS-ABEND                    18440002
184500     END-EVALUATE.                                                18450002
184600                                                                  18460002
184700                                                                  18470003
184800****************************************************************  18480003
184900*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  18490003
185000*                                                              *  18500003
185100****************************************************************  18510003
185200                                                                  18520003
185300 4320-GET-STORE-INFORMATION.                                      18530003
185400                                                                  18540003
185500     INITIALIZE XL071-COMMAREA.                                   18550003
185600     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                18560003
185700                                                                  18570003
185800     CALL XL071-LOCATION-MODULE USING                             18580003
185900                                DFHEIBLK                          18590003
186000                                XL071-COMMAREA                    18600003
186100                                XL071-COMMAREA-REC.               18610003
186200                                                                  18620003
186300     EVALUATE TRUE                                                18630003
186400         WHEN XL071-NO-ERRORS                                     18640003
186500         WHEN XL071-DC-ASGMT-NOT-FND                              18650003
186600              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  18660003
186700                                                                  18670003
186800         WHEN XL071-LOC-NOT-FOUND                                 18680003
186900              MOVE SPACES       TO ASC-FCLTY-NME                  18690003
187000                                                                  18700003
187100         WHEN OTHER                                               18710003
187200              MOVE '4320-GET-STORE-INFORMATION'                   18720003
187300                                  TO DP013-PARAGRAPH              18730003
187310              STRING 'SELECT STORE NUMBER - '                     18731005
187320                      XL071-LOCATION-NUMBER                       18732005
187330                     ' - BAD RETURN CODE FROM XLKUT071 - '        18733005
187340                      XL071-RETURN-CODE                           18734005
187350                      DELIMITED BY SIZE                           18735005
187360                      INTO DP013-MESSAGE-TEXT (1)                 18736005
187370              STRING 'BAD SQLCODE - '                             18737005
187380                      XL071-SQLCODE                               18738005
187390                     ' - '                                        18739005
187391                      XL071-DB2-TABLE                             18739105
187392                      DELIMITED BY SIZE                           18739205
187393                      INTO DP013-MESSAGE-TEXT (2)                 18739305
187394              MOVE XL071-SQLCA     TO DP013-SQLCA                 18739405
187395              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)    18739505
188000              MOVE XL071-SQLCODE TO SQLCODE                       18800003
188300              SET DP013-DB2-ABEND                                 18830003
188400                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18840003
188500              PERFORM DP013-0000-PROCESS-ABEND                    18850003
188600                                                                  18860003
188700     END-EVALUATE.                                                18870003
188800                                                                  18880003
188900                                                                  18890002
189000/                                                                 18900002
189100*----------------------------------------------------------------*18910002
189200* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18920002
189300*----------------------------------------------------------------*18930002
189400                                                                  18940002
189500 4400-MOVE-COMMAREA-TO-SCREEN.                                    18950002
189600                                                                  18960002
189700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18970002
189800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18980002
189900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18990002
190000             MOVE +1               TO ASC-BLK-SUB                 19000002
190100             PERFORM 5100-WRITE-TEMP-STORAGE                      19010002
190200             ADD +1                TO ASC-BLK-SUB                 19020002
190300             PERFORM 5100-WRITE-TEMP-STORAGE                      19030002
190400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19040002
190500                 GIVING PV-BLOCK-NUMBER                           19050002
190600                 REMAINDER PV-REMAINDER                           19060002
190700             IF  PV-REMAINDER > ZERO                              19070002
190800                 ADD +1            TO PV-BLOCK-NUMBER             19080002
190900             END-IF                                               19090002
191000             MOVE +1               TO ASC-BLK-SUB                 19100002
191100             PERFORM 4410-READ-TEMP-STORAGE                       19110002
191200             ADD +1                TO ASC-BLK-SUB                 19120002
191300                                      PV-BLOCK-NUMBER             19130002
191400             PERFORM 4410-READ-TEMP-STORAGE                       19140002
191500     END-IF.                                                      19150002
191600                                                                  19160002
191700     MOVE +1                       TO ASC-BLK-SUB.                19170002
191800                                                                  19180002
191900     COMPUTE ASC-ITEM-SUB =                                       19190002
192000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19200002
192100         + PC-ITEMS-PER-PANEL).                                   19210002
192200                                                                  19220002
192300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19230002
192400         ADD +1                    TO ASC-BLK-SUB                 19240002
192500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19250002
192600     END-IF.                                                      19260002
192700                                                                  19270002
192800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19280002
192900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19290002
193000                                                                  19300002
193100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19310002
193200     PERFORM 4420-FORMAT-LIST-LINES                               19320002
193300         VARYING PV-SUB                                           19330002
193400         FROM PC-ITEMS-PER-PANEL BY -1                            19340002
193500         UNTIL PV-SUB < +1.                                       19350002
193600                                                                  19360002
193700     COMPUTE ASC-ITEMS-DISPLAYED =                                19370002
193800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19380002
193900                                                                  19390002
194000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19400002
194100                                      ASTRTITO.                   19410002
194200                                                                  19420002
194300     MOVE ASC-KEY-OPER-UNT-ID      TO MR-OPER.                    19430003
194400     MOVE ASC-KEY-FCLTY-ID         TO MR-FCLTY.                   19440003
194500     MOVE ASC-FCLTY-NME            TO MR-FDESC.                   19450003
194600                                                                  19460002
194700     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19470002
194800     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19480002
194900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19490002
195000                                   TO ASELITO.                    19500002
195100                                                                  19510002
195200     IF  DP020-MSG-NUMBER-X = SPACE                               19520002
195300         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19530002
195400*            --- MORE ITEMS TO DISPLAY ----                       19540002
195500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19550002
195600             SET DP020-MSG-INFORMATIONAL                          19560002
195700                                   TO TRUE                        19570002
195800         END-IF                                                   19580002
195900     END-IF.                                                      19590002
196000                                                                  19600002
196100*----------------------------------------------------------------*19610002
196200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19620002
196300*----------------------------------------------------------------*19630002
196400                                                                  19640002
196500 4410-READ-TEMP-STORAGE.                                          19650002
196600                                                                  19660002
196700     EXEC CICS                                                    19670002
196800         READQ TS                                                 19680002
196900             QUEUE (ASC-LIST-QUEUE-NAME)                          19690002
197000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19700002
197100             ITEM  (PV-BLOCK-NUMBER)                              19710002
197200             RESP  (PV-CICS-RESP)                                 19720002
197300     END-EXEC.                                                    19730002
197400                                                                  19740002
197500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19750002
197600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19760002
197700         CONTINUE                                                 19770002
197800     ELSE                                                         19780002
197900         SET DP013-CICS-ABEND      TO TRUE                        19790002
198000         SET DP013-NO-ROLLBACK     TO TRUE                        19800002
198100         MOVE '4410-READ-TEMP-STORAGE'                            19810002
198200                                   TO DP013-PARAGRAPH             19820002
198300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19830002
198400                                   TO DP013-MESSAGE-TEXT(1)       19840002
198500         PERFORM DP013-0000-PROCESS-ABEND                         19850002
198600     END-IF.                                                      19860002
198700                                                                  19870002
198800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      19880002
198900                                   TO TRUE.                       19890002
199000                                                                  19900002
199100     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19910002
199200         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19920002
199300     END-IF.                                                      19930002
199400                                                                  19940002
199500/                                                                 19950002
199600*----------------------------------------------------------------*19960002
199700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19970002
199800*----------------------------------------------------------------*19980002
199900                                                                  19990002
200000 4420-FORMAT-LIST-LINES.                                          20000002
200100                                                                  20010002
200200     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20020002
200300         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20030002
200400         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         20040002
200500         MOVE SPACES               TO MR-OPER                     20050003
200600                                      MR-FCLTY                    20060003
200700                                      MR-FDESC                    20070002
200800         MOVE SPACE                TO MR-SELECT  (PV-SUB)         20080002
200900                                      MR-ACTION  (PV-SUB)         20090002
201000                                      MR-FCLTY-ID (PV-SUB)        20100003
201100                                      MR-AREA-ID  (PV-SUB)        20110003
201200                                      MR-TYPE    (PV-SUB)         20120002
201300                                      MR-DESC    (PV-SUB)         20130002
201400                                      MR-SUBAREA (PV-SUB)         20140002
201500                                      MR-DEPT-CL-IND(PV-SUB)      20150003
201600     ELSE                                                         20160002
201700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20170002
201800                                                   > SPACE        20180002
201900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 20190002
202000                                   TO MR-SELECT  (PV-SUB)         20200002
202100         ELSE                                                     20210002
202200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20220002
202300                                   TO MR-SELECT  (PV-SUB)         20230002
202400         END-IF                                                   20240002
202500                                                                  20250002
202600         IF  DP030-SET-CURSOR-TRAILER                             20260002
202700             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20270002
202800                 > SPACE)                                         20280002
202900               OR (PV-SUB = 1))                                   20290002
203000                SET DP030-SET-CURSOR-APPL-1 TO TRUE               20300002
203100                MOVE -1            TO MR-SELECTL (PV-SUB)         20310002
203200             END-IF                                               20320002
203300         END-IF                                                   20330002
203400                                                                  20340002
203500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           20350002
203600             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           20360002
203700                                   TO MR-ACTION (PV-SUB)          20370002
203800             MOVE ASC-FCLTY-ID (ASC-BLK-SUB ASC-ITEM-SUB)         20380003
203900                                   TO MR-FCLTY-ID (PV-SUB)        20390003
204000             MOVE ASC-AREA-ID (ASC-BLK-SUB ASC-ITEM-SUB)          20400003
204100                                   TO MR-AREA-ID (PV-SUB)         20410003
204200             MOVE ASC-TYPE (ASC-BLK-SUB ASC-ITEM-SUB)             20420002
204300                                   TO MR-TYPE (PV-SUB)            20430002
204400             MOVE ASC-DESC (ASC-BLK-SUB ASC-ITEM-SUB)             20440002
204500                                   TO MR-DESC (PV-SUB)            20450002
204600             MOVE ASC-SUBAREA (ASC-BLK-SUB ASC-ITEM-SUB)          20460002
204700                                   TO MR-SUBAREA (PV-SUB)         20470002
204800             MOVE ASC-DEPT-CL-IND (ASC-BLK-SUB ASC-ITEM-SUB)      20480003
204900                                   TO MR-DEPT-CL-IND (PV-SUB)     20490003
205000         END-IF                                                   20500002
205100     END-IF.                                                      20510002
205200                                                                  20520002
205300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               20530002
205400                                                                  20540002
205500     IF  ASC-ITEM-SUB < + 1                                       20550002
205600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                20560002
205700         MOVE +1                   TO ASC-BLK-SUB                 20570002
205800     END-IF.                                                      20580002
205900                                                                  20590002
206000/                                                                 20600002
206100*----------------------------------------------------------------*20610002
206200*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *20620002
206300*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *20630002
206400*  ISSUE A WARNING.                                              *20640002
206500*----------------------------------------------------------------*20650002
206600 4430-CHECK-FOR-BEGIN-AND-END.                                    20660002
206700                                                                  20670002
206800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20680002
206900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20690002
207000*            -- NO END-OF-RANGE SPECFIED ---                      20700002
207100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20710002
207200             SET DP020-MSG-WARNING TO TRUE                        20720002
207300             PERFORM 4431-POSITION-AT-WARNING                     20730002
207400         END-IF                                                   20740002
207500     ELSE                                                         20750002
207600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20760002
207700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20770002
207800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20780002
207900             SET DP020-MSG-WARNING TO TRUE                        20790002
208000             PERFORM 4431-POSITION-AT-WARNING                     20800002
208100         END-IF                                                   20810002
208200     END-IF.                                                      20820002
208300                                                                  20830002
208400/                                                                 20840002
208500*----------------------------------------------------------------*20850002
208600*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *20860002
208700*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *20870002
208800*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *20880002
208900*  POSITION THE CURSOR THERE.                                    *20890002
209000*----------------------------------------------------------------*20900002
209100 4431-POSITION-AT-WARNING.                                        20910002
209200                                                                  20920002
209300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20930002
209400                    - PV-TOP-ITEM + 1.                            20940002
209500                                                                  20950002
209600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20960002
209700         CONTINUE                                                 20970002
209800     ELSE                                                         20980002
209900         SET DP030-SET-CURSOR-APPL-1                              20990002
210000                                   TO TRUE                        21000002
210100         MOVE -1                   TO MR-SELECTL (PV-SUB)         21010002
210200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21020002
210300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21030002
210400     END-IF.                                                      21040002
210500                                                                  21050002
210600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21060002
210700                    - PV-TOP-ITEM + 1.                            21070002
210800                                                                  21080002
210900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21090002
211000         CONTINUE                                                 21100002
211100     ELSE                                                         21110002
211200         SET DP030-SET-CURSOR-APPL-1                              21120002
211300                                   TO TRUE                        21130002
211400         MOVE -1                   TO MR-SELECTL (PV-SUB)         21140002
211500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21150002
211600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         21160002
211700     END-IF.                                                      21170002
211800                                                                  21180002
211900/                                                                 21190002
212000*----------------------------------------------------------------*21200002
212100* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21210002
212200* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21220002
212300* FOR THE SELECTED ITEMS QUEUE.                                  *21230002
212400*                                                                *21240002
212500* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21250002
212600* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21260002
212700* THE ARRAY IS FULL.                                             *21270002
212800*----------------------------------------------------------------*21280002
212900                                                                  21290002
213000 5000-PREPARE-SEL-QUEUE.                                          21300002
213100                                                                  21310002
213200     MOVE +1                       TO ASC-BLK-SUB.                21320002
213300     PERFORM 5100-WRITE-TEMP-STORAGE.                             21330002
213400     ADD +1                        TO ASC-BLK-SUB.                21340002
213500     PERFORM 5100-WRITE-TEMP-STORAGE.                             21350002
213600                                                                  21360002
213700     MOVE ASC-SEL-QUEUE-NAME       TO CN003-SEL-QUEUE-NAME.       21370002
213800     PERFORM 6010-DELETE-SEL-QUEUE.                               21380002
213900                                                                  21390002
214000     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      21400002
214100         SET ASC-UPDATE-TSQ        TO TRUE                        21410002
214200     END-IF.                                                      21420002
214300                                                                  21430002
214400     SET CN005-IDX                 TO 1.                          21440002
214500     MOVE ZERO                     TO CN003-NUMBER-OF-TS-ITEMS.   21450002
214600     INITIALIZE CN005-SELECTED-ITEM-ARRAY.                        21460002
214700                                                                  21470002
214800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21480002
214900             VARYING PV-ITEM                                      21490002
215000             FROM 1 BY 1                                          21500002
215100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     21510002
215200                                                                  21520002
215300     IF  CN005-IDX > 1                                            21530002
215400         PERFORM 5205-WRITE-SEL-QUEUE                             21540002
215500         ADD +1                    TO CN003-NUMBER-OF-TS-ITEMS    21550002
215600     END-IF.                                                      21560002
215700                                                                  21570002
215800/                                                                 21580002
215900*----------------------------------------------------------------*21590002
216000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *21600002
216100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *21610002
216200*----------------------------------------------------------------*21620002
216300                                                                  21630002
216400 5100-WRITE-TEMP-STORAGE.                                         21640002
216500                                                                  21650002
216600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     21660002
216700                                   TO PV-LIST-ITEM-NUMBER.        21670002
216800     COMPUTE PV-BLOCK-NUMBER =                                    21680002
216900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    21690002
217000                                                                  21700002
217100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             21710002
217200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             21720002
217300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      21730002
217400             PERFORM 5105-REWRITE-ASC-LISTQ                       21740002
217500         END-IF                                                   21750002
217600     ELSE                                                         21760002
217700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       21770002
217800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            21780002
217900         PERFORM 5110-WRITE-ASC-LISTQ                             21790002
218000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   21800002
218100     END-IF.                                                      21810002
218200                                                                  21820002
218300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      21830002
218400                                   TO TRUE.                       21840002
218500                                                                  21850002
218600/                                                                 21860002
218700*----------------------------------------------------------------*21870002
218800*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *21880002
218900*  SPECIFIC COMMAREA.                                            *21890002
219000*----------------------------------------------------------------*21900002
219100 5105-REWRITE-ASC-LISTQ.                                          21910002
219200                                                                  21920002
219300     EXEC CICS                                                    21930002
219400         WRITEQ TS                                                21940002
219500             QUEUE (ASC-LIST-QUEUE-NAME)                          21950002
219600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21960002
219700             ITEM  (PV-BLOCK-NUMBER)                              21970002
219800             REWRITE                                              21980002
219900             RESP  (PV-CICS-RESP)                                 21990002
220000     END-EXEC.                                                    22000002
220100                                                                  22010002
220200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22020002
220300         CONTINUE                                                 22030002
220400     ELSE                                                         22040002
220500         SET DP013-CICS-ABEND      TO TRUE                        22050002
220600         SET DP013-NO-ROLLBACK     TO TRUE                        22060002
220700         MOVE '5105-REWRITE-ASC-LISTQ'                            22070002
220800                                   TO DP013-PARAGRAPH             22080002
220900         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22090002
221000                                   TO DP013-MESSAGE-TEXT(1)       22100002
221100         PERFORM DP013-0000-PROCESS-ABEND                         22110002
221200     END-IF.                                                      22120002
221300                                                                  22130002
221400/                                                                 22140002
221500*----------------------------------------------------------------*22150002
221600*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *22160002
221700*  SPECIFIC COMMAREA.                                            *22170002
221800*----------------------------------------------------------------*22180002
221900 5110-WRITE-ASC-LISTQ.                                            22190002
222000                                                                  22200002
222100     EXEC CICS                                                    22210002
222200         WRITEQ TS                                                22220002
222300             QUEUE (ASC-LIST-QUEUE-NAME)                          22230002
222400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22240002
222500             ITEM  (PV-BLOCK-NUMBER)                              22250002
222600             RESP  (PV-CICS-RESP)                                 22260002
222700     END-EXEC.                                                    22270002
222800                                                                  22280002
222900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22290002
223000         SET DP013-CICS-ABEND      TO TRUE                        22300002
223100         SET DP013-NO-ROLLBACK     TO TRUE                        22310002
223200         MOVE '5110-WRITE-ASC-LISTQ'                              22320002
223300                                   TO DP013-PARAGRAPH             22330002
223400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22340002
223500                                   TO DP013-MESSAGE-TEXT(1)       22350002
223600         PERFORM DP013-0000-PROCESS-ABEND                         22360002
223700     END-IF.                                                      22370002
223800                                                                  22380002
223900/                                                                 22390002
224000*----------------------------------------------------------------*22400002
224100* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22410002
224200* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22420002
224300*----------------------------------------------------------------*22430002
224400                                                                  22440002
224500 5200-FILL-SEL-QUEUE-RECORD.                                      22450002
224600                                                                  22460002
224700     PERFORM 6112-READ-LIST-QUEUE.                                22470002
224800                                                                  22480002
224900     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       22490002
225000         PERFORM                                                  22500002
225100         VARYING LQW-IDX                                          22510002
225200         FROM 1 BY 1                                              22520002
225300         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            22530002
225400           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          22540002
225500                                                                  22550002
225600             IF  LQW-SELECT (LQW-IDX)                             22560002
225700                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              22570002
225800                                   TO CN005-ITEM      (CN005-IDX) 22580002
225900                 MOVE LQW-AREA-ID  (LQW-IDX)                      22590003
226000                                   TO CN005-AREA-ID   (CN005-IDX) 22600003
226100                 MOVE LQW-TYPE    (LQW-IDX)                       22610002
226200                                   TO CN005-TYPE      (CN005-IDX) 22620002
226300                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   22630003
226400                                 TO CN005-OPER-UNT-ID (CN005-IDX) 22640003
226500                 MOVE LQW-FCLTY-ID (LQW-IDX)                      22650003
226600                                   TO CN005-FCLTY-ID  (CN005-IDX) 22660003
226700                 MOVE SPACE        TO CN005-ACTION-SW (CN005-IDX) 22670002
226800                 SET CN005-IDX UP BY 1                            22680002
226900                 IF  CN005-IDX > CN005-MAX-ITEMS                  22690002
227000                     PERFORM 5205-WRITE-SEL-QUEUE                 22700002
227100                     ADD +1        TO CN003-NUMBER-OF-TS-ITEMS    22710002
227200                     INITIALIZE CN005-SELECTED-ITEM-ARRAY         22720002
227300                     SET CN005-IDX TO 1                           22730002
227400                 END-IF                                           22740002
227500             END-IF                                               22750002
227600         END-PERFORM                                              22760002
227700     END-IF.                                                      22770002
227800                                                                  22780002
227900/                                                                 22790002
228000*----------------------------------------------------------------*22800002
228100*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *22810002
228200*----------------------------------------------------------------*22820002
228300                                                                  22830002
228400 5205-WRITE-SEL-QUEUE.                                            22840002
228500                                                                  22850002
228600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22860002
228700                                   TO CN005-SELECTED-ITEMS.       22870002
228800                                                                  22880002
228900     EXEC CICS                                                    22890002
229000          WRITEQ TS                                               22900002
229100              QUEUE (ASC-SEL-QUEUE-NAME)                          22910002
229200              FROM  (CN005-TS-SEL-REC)                            22920002
229300              ITEM  (PV-SEL-QUEUE-ITEM)                           22930002
229400              RESP  (PV-CICS-RESP)                                22940002
229500     END-EXEC.                                                    22950002
229600                                                                  22960002
229700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22970002
229800         CONTINUE                                                 22980002
229900     ELSE                                                         22990002
230000         SET DP013-CICS-ABEND      TO TRUE                        23000002
230100         SET DP013-NO-ROLLBACK     TO TRUE                        23010002
230200         MOVE '5205-WRITE-SEL-QUEUE'                              23020002
230300                                   TO DP013-PARAGRAPH             23030002
230400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23040002
230500                                   TO DP013-MESSAGE-TEXT(1)       23050002
230600         PERFORM DP013-0000-PROCESS-ABEND                         23060002
230700     END-IF.                                                      23070002
230800                                                                  23080002
230900/                                                                 23090002
231000*----------------------------------------------------------------*23100002
231100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *23110002
231200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *23120002
231300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *23130002
231400*  THE USER.                                                     *23140002
231500*----------------------------------------------------------------*23150002
231600 6000-REFRESH-PANEL-FROM-TEMP.                                    23160002
231700                                                                  23170002
231800     IF  ASC-UPDATE-TSQ                                           23180002
231900         SET ASC-NO-TSQ-UPDATE     TO TRUE                        23190002
232000         MOVE ZERO                 TO PV-SAVE-ITEM                23200002
232100                                      PV-SEL-QUEUE-ITEM           23210002
232200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23220002
232300                                   TO PV-HOLD-SELECTED-ITEMS      23230002
232400         PERFORM 6100-UPDATE-TSQ                                  23240002
232500             UNTIL PV-ITEMS-PROCESSED >                           23250002
232600                                     ASC-NUMBER-OF-SELECTED-ITEMS 23260002
232700         PERFORM 6010-DELETE-SEL-QUEUE                            23270002
232800         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23280002
232900                    ASC-BLOCK-ENTRIES (2)                         23290002
233000     END-IF.                                                      23300002
233100                                                                  23310002
233200/                                                                 23320002
233300*----------------------------------------------------------------*23330002
233400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23340002
233500*----------------------------------------------------------------*23350002
233600 6010-DELETE-SEL-QUEUE.                                           23360002
233700                                                                  23370002
233800     EXEC CICS                                                    23380002
233900         DELETEQ TS                                               23390002
234000             QUEUE (ASC-SEL-QUEUE-NAME)                           23400002
234100             RESP  (PV-CICS-RESP)                                 23410002
234200     END-EXEC.                                                    23420002
234300                                                                  23430002
234400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23440002
234500         (PV-CICS-RESP = DFHRESP(QIDERR)))                        23450002
234600         CONTINUE                                                 23460002
234700     ELSE                                                         23470002
234800         SET DP013-CICS-ABEND      TO TRUE                        23480002
234900         SET DP013-NO-ROLLBACK     TO TRUE                        23490002
235000         MOVE '6010-DELETE-SEL-QUEUE'                             23500002
235100                                   TO DP013-PARAGRAPH             23510002
235200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         23520002
235300                                   TO DP013-MESSAGE-TEXT (1)      23530002
235400         PERFORM DP013-0000-PROCESS-ABEND                         23540002
235500     END-IF.                                                      23550002
235600                                                                  23560002
235700/                                                                 23570002
235800*----------------------------------------------------------------*23580002
235900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *23590002
236000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *23600002
236100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *23610002
236200*    THE TEMP QUEUE.                                             *23620002
236300*----------------------------------------------------------------*23630002
236400                                                                  23640002
236500 6100-UPDATE-TSQ.                                                 23650002
236600                                                                  23660002
236700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          23670002
236800     PERFORM 6105-READ-SEL-QUEUE.                                 23680002
236900                                                                  23690002
237000     PERFORM                                                      23700002
237100         VARYING CN005-IDX                                        23710002
237200         FROM 1 BY 1                                              23720002
237300         UNTIL ((PV-ITEMS-PROCESSED >                             23730002
237400                              PV-HOLD-SELECTED-ITEMS)             23740002
237500         OR (CN005-IDX GREATER THAN CN005-MAX-ITEMS))             23750002
237600         IF  CN005-ACTION-SW (CN005-IDX) > SPACE                  23760002
237700             PERFORM 6110-PROCESS-ITEMS                           23770002
237800         END-IF                                                   23780002
237900         ADD +1                    TO PV-ITEMS-PROCESSED          23790002
238000     END-PERFORM.                                                 23800002
238100                                                                  23810002
238200     PERFORM 6111-WRITE-LIST-QUEUE.                               23820002
238300                                                                  23830002
238400/                                                                 23840002
238500*----------------------------------------------------------------*23850002
238600*    READ THE LIST QUEUE RECORD.                                 *23860002
238700*----------------------------------------------------------------*23870002
238800                                                                  23880002
238900 6105-READ-SEL-QUEUE.                                             23890002
239000                                                                  23900002
239100     EXEC CICS                                                    23910002
239200          READQ TS                                                23920002
239300              QUEUE (ASC-SEL-QUEUE-NAME)                          23930002
239400              INTO  (CN005-TS-SEL-REC)                            23940002
239500              ITEM  (PV-SEL-QUEUE-ITEM)                           23950002
239600              RESP  (PV-CICS-RESP)                                23960002
239700     END-EXEC.                                                    23970002
239800                                                                  23980002
239900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23990002
240000         CONTINUE                                                 24000002
240100     ELSE                                                         24010002
240200         SET DP013-CICS-ABEND      TO TRUE                        24020002
240300         SET DP013-NO-ROLLBACK     TO TRUE                        24030002
240400         MOVE '6105-READ-SEL-QUEUE'                               24040002
240500                                   TO DP013-PARAGRAPH             24050002
240600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24060002
240700                                   TO DP013-MESSAGE-TEXT(1)       24070002
240800         PERFORM DP013-0000-PROCESS-ABEND                         24080002
240900     END-IF.                                                      24090002
241000                                                                  24100002
241100/                                                                 24110002
241200*----------------------------------------------------------------*24120002
241300*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24130002
241400*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24140002
241500*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24150002
241600*----------------------------------------------------------------*24160002
241700                                                                  24170002
241800 6110-PROCESS-ITEMS.                                              24180002
241900                                                                  24190002
242000     COMPUTE PV-ITEM = 1 + ((CN005-ITEM (CN005-IDX) - 1)          24200002
242100                     / PC-ITEMS-PER-PANEL).                       24210002
242200                                                                  24220002
242300     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24230002
242400         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24240002
242500             PERFORM 6111-WRITE-LIST-QUEUE                        24250002
242600         END-IF                                                   24260002
242700         MOVE PV-ITEM              TO PV-SAVE-ITEM                24270002
242800                                                                  24280002
242900         PERFORM 6112-READ-LIST-QUEUE                             24290002
243000         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24300002
243100             CONTINUE                                             24310002
243200         END-IF                                                   24320002
243300     END-IF.                                                      24330002
243400                                                                  24340002
243500     COMPUTE PV-SUB = (CN005-ITEM (CN005-IDX)                     24350002
243600                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24360002
243700                                                                  24370002
243800     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       24380002
243900     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        24390002
244000                                     (PV-SUB).                    24400002
244100     EVALUATE TRUE                                                24410002
244200         WHEN CN005-INQ (CN005-IDX)                               24420002
244300              MOVE PC-INQ          TO LQW-ACTION (PV-SUB)         24430002
244400                                                                  24440002
244500         WHEN CN005-UPD (CN005-IDX)                               24450002
244600              MOVE PC-UPD          TO LQW-ACTION (PV-SUB)         24460002
244700                                                                  24470002
244800         WHEN CN005-DEL (CN005-IDX)                               24480002
244900              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         24490002
245000                                                                  24500002
245100         WHEN CN005-ERR (CN005-IDX)                               24510002
245200              MOVE PC-ERR          TO LQW-ACTION (PV-SUB)         24520002
245300     END-EVALUATE.                                                24530002
245400                                                                  24540002
245500     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                24550002
245600                                                                  24560002
245700/                                                                 24570002
245800*----------------------------------------------------------------*24580002
245900*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *24590002
246000*----------------------------------------------------------------*24600002
246100                                                                  24610002
246200 6111-WRITE-LIST-QUEUE.                                           24620002
246300                                                                  24630002
246400     EXEC CICS                                                    24640002
246500         WRITEQ TS                                                24650002
246600             QUEUE (ASC-LIST-QUEUE-NAME)                          24660002
246700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     24670002
246800             ITEM  (PV-SAVE-ITEM)                                 24680002
246900             REWRITE                                              24690002
247000             RESP  (PV-CICS-RESP)                                 24700002
247100     END-EXEC.                                                    24710002
247200                                                                  24720002
247300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24730002
247400         CONTINUE                                                 24740002
247500     ELSE                                                         24750002
247600         SET DP013-CICS-ABEND      TO TRUE                        24760002
247700         SET DP013-NO-ROLLBACK     TO TRUE                        24770002
247800         MOVE '6111-WRITE-LIST-QUEUE'                             24780002
247900                                   TO DP013-PARAGRAPH             24790002
248000         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  24800002
248100                                   TO DP013-MESSAGE-TEXT(1)       24810002
248200         PERFORM DP013-0000-PROCESS-ABEND                         24820002
248300     END-IF.                                                      24830002
248400                                                                  24840002
248500/                                                                 24850002
248600*----------------------------------------------------------------*24860002
248700*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*24870002
248800*----------------------------------------------------------------*24880002
248900                                                                  24890002
249000 6112-READ-LIST-QUEUE.                                            24900002
249100                                                                  24910002
249200     EXEC CICS                                                    24920002
249300         READQ TS                                                 24930002
249400             QUEUE (ASC-LIST-QUEUE-NAME)                          24940002
249500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     24950002
249600             ITEM  (PV-ITEM)                                      24960002
249700             RESP  (PV-CICS-RESP)                                 24970002
249800     END-EXEC.                                                    24980002
249900                                                                  24990002
250000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25000002
250100         CONTINUE                                                 25010002
250200     ELSE                                                         25020002
250300         SET DP013-CICS-ABEND      TO TRUE                        25030002
250400         SET DP013-NO-ROLLBACK     TO TRUE                        25040002
250500         MOVE '6112-READ-LIST-QUEUE'                              25050002
250600                                   TO DP013-PARAGRAPH             25060002
250700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25070002
250800                                   TO DP013-MESSAGE-TEXT(1)       25080002
250900         PERFORM DP013-0000-PROCESS-ABEND                         25090002
251000     END-IF.                                                      25100002
251100                                                                  25110002
251200/                                                                 25120002
251300*----------------------------------------------------------------*25130002
251400*    ABEND PROCESSOR MODULE                                      *25140002
251500*----------------------------------------------------------------*25150002
251600                                                                  25160002
251700     COPY DPPD013.                                                25170002
