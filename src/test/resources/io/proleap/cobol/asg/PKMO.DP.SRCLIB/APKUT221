000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT221.                                        00020000
000300 AUTHOR.         MIKE BESKE.                                      00030000
000400 DATE-WRITTEN.   NOVEMBER 2000.                                   00040000
000500******************************************************************00050000
000600*    COBOL WITH DB2                                              *00060000
000700*                                                                *00070000
000800* THIS PROGRAM READS THE EDI MDS INVOICE ADD FILE SCANNING       *00080000
000900* FOR LI & FUNG INVOICES AND FOR INVOICES FOR DIRECT IMPORT      *00090014
000900* VENDORS THAT WORK WITH AGENTS.  WHEN 1 IS FOUND, AN IMPORT EXP *00090114
001000* INVOICE LOAD RECORD WILL BE CREATED.  THIS IS AUTOMATING       *00100000
001100* THE COMMISSION INVOICE CREATION BY CALCULATING A PERCENT OF    *00110014
001200* THE GROSS INVOICE AMOUNT.                                      *00120014
001300*                                                                *00130000
001300* FOR LI & FUNG, A TRUE UP ENTRY CAN ALSO BE CREATED.            *00131028
001400******************************************************************00140000
001500*                                                                *00150000
001600* INPUT:                                                         *00160000
001700*  1. EDI MDS INVOICE ADD FILE         (APRD052)                 *00170000
001700*  2. VENDOR LIST (APCC035)            (APRD026)                 *00180064
001900*                                                                *00190000
002000* DB2:                                                           *00200000
002100*  1. PURCHASE ORDER TABLE             (TPURCHS)                 *00210000
002200*  2. PURCHASE ORDER AGREEMENTS TABLE  (TPOAGMT)                 *00220000
002300*  3. PAYMENT TERMS TABLE              (TPAYTRM)                 *00230000
002400*  4. EXTERNAL ENTERPRISE TABLE        (TEXTENT)                 *00240000
002500*  5. EXTERNAL ENTERPRISE NAME TABLE   (TENTNME)                 *00250000
002600*  6. AP PAYMENT CONTROL TABLE         (TAPCNTL)                 *00260000
002700*  7. TAPVNDS TABLE                    (TAPVNDS)                 *00270000
002800*                                                                *00280000
002900* OUTPUT:                                                        *00290000
003000*  1. COMMISSION IMPORT EXPENSE (APRD016)                        *00300028
003100*     INVOICE LOAD FILE                                          *00310000
003200*  2. ADJUSTMENT JOURNAL TRANSACTION FILE (APRD045)              *00320000
003300*                                                                *00330000
003400******************************************************************00340000
003500* CHANGE LOG:                                                    *00350000
003600*                                                                *00360000
003700* 07/06/01                                                       *00370000
003800*       CHANGED THE SIZE OF OUTPUT RECORD FROM 360 TO            *00380000
003900*       435.  CHANGED THE VALUE OF THE AP016-ENTR-MTHD-CDE       *00390000
004000*       FROM 'ED' TO 'EE'.  ALSO, ADDED A NEW FIELD CALLED       *00400000
004100*       AP016-STATUS-CDE AND ASSIGNED VALUE 'EN' TO IT.          *00410000
004200*       BY: ALEXIS KEIKER          WR/IR: WR20530                *00420000
004300*                                                                *00430000
004400* 11/29/01                                                       *00440000
004500*        ADDED LOGIC TO SKIP FORMATTING AND WRITING AN           *00450000
004600*        OUTPUT RECORD FOR A COLBY INVOICE IF THE DEPT           *00460000
004700*        NUMBER IS 830.  THIS DEPARTMENT IS FOR CHARITABLE       *00470000
004800*        PURCHASES, AND COLBY WAIVES THEIR COMMISSION ON         *00480000
004900*        CHARITABLE PURCHASES.                                   *00490000
005000*    MADE BY: NANCY EILBES            WR/IR #: WR20530           *00500000
005100*                                                                *00510000
005200* 08/08/2002                                                     *00520000
005300*        COLBY HANGER EXPENSE PROCESSING.  MODIFIED PROGRAM      *00530000
005400*        TO USE THE DISCOUNTED AMOUNT DUE TO CALCULATE THE       *00540000
005500*        COMMISSION AMOUNT INSTEAD OF USING THE INVOICE NET      *00550000
005600*        COST.  THIS IS NEEDED BECAUSE THE INVOICE NET COST      *00560000
005700*        WILL INCLUDE THE HANGER CHARGE AND WE DO NOT WANT       *00570000
005800*        TO CALCULATE COMMISSION ON THE HANGER CHARGES.          *00580000
005900*        PARAGRAPH MODIFIED IS M400.                             *00590000
006000*    MADE BY: KEVIN CATLIN            WR/IR #: WR23254           *00600000
006100*                                                                *00610000
006200* 11/04/2002                                                     *00620000
006300*        COLBY DATING.  IN PARAGRAPH M350, CHANGED HARD          *00630000
006400*        CODING OF NET-DUE-DAY-QTY FROM +10 TO +25.              *00640000
006500*    MADE BY: KEVIN CATLIN            WR/IR #: WR23750           *00650000
006600*                                                                *00660000
006700* DATE  05/15/2003                                               *00670000
006800*     CHANGE MADE: NI-SKU PROJECT.                               *00680000
006900*     RECOMPILED TO PICK UP CHANGED COPYBOOK(S).                 *00690000
007000*     MADE BY: MIKE BESKE              WR/IR #: WR22557          *00700000
007100*                                                                *00710000
007200* DATE  07/22/2003                                               *00720000
007300*     CHANGE MADE: COMPOUND PREPACK EDI PROJECT                  *00730000
007400*     RECOMPILED TO PICK UP CHANGED COPYBOOK(S).                 *00740000
007500*     MADE BY: MIKE BESKE              WR/IR #: WR24685          *00750000
007600*                                                                *00760000
007700* DATE  01/20/2004                                               *00770000
007800*     CHANGE MADE: ADDED HARD-CODING FOR LAURA ASHLEY POS        *00780000
007900*     TO USE 3% INSTEAD OF 5% WHEN CREATING THE COMMISSION       *00790000
008000*     INVOICE.                                                   *00800000
008100*     MADE BY: NANCY EILBES            WR/IR #: WR26434          *00810000
008200*                                                                *00820000
008300* DATE  01/22/2004                                               *00830000
008400*     CHANGE MADE: CHANGED HARD-CODING FOR LAURA ASHLEY POS      *00840000
008500*     TO USE 2% INSTEAD OF 3% WHEN CREATING THE COMMISSION       *00850000
008600*     INVOICE.                                                   *00860000
008700*     MADE BY: NANCY EILBES            WR/IR #: WR26434          *00870000
008800*                                                                *00880000
008900* DATE  02/26/2004                                               *00890000
009000*     CHANGE MADE: ADDED THIRD COLUMN OF PO NUMBERS TO THE       *00900000
009100*     LIST OF 2 PERCENT POS.                                     *00910000
009200*     MADE BY: NANCY EILBES            WR/IR #: WR26434          *00920000
009300*                                                                *00930000
009400* DATE  03/05/2004                                               *00940000
009500*     CHANGE MADE: ADDED 12 MORE PO NUMBERS TO THE LIST OF       *00950000
009600*     2 PERCENT POS.  TOTAL IS NOW 49 POS.                       *00960000
009700*     MADE BY: NANCY EILBES            WR/IR #: P000638605       *00970000
009800*                                                                *00980000
009900* DATE  03/16/2004                                               *00990000
010000*     CHANGE MADE: ADDED 8  MORE PO NUMBERS TO THE LIST OF       *01000000
010100*     2 PERCENT POS.  TOTAL IS NOW 57 POS.                       *01010000
010200*     MADE BY: NANCY EILBES            WR/IR #: P000638605       *01020000
010300*                                                                *01030000
010400* DATE  06/30/2004                                               *01040000
010500*     CHANGE MADE: ADDED 28 MORE PO NUMBERS TO THE LIST OF       *01050000
010600*     2 PERCENT POS.  TOTAL IS NOW 85 POS.                       *01060000
010700*     MADE BY: NANCY EILBES            WR/IR #: P000638605       *01070000
010800*                                                                *01080000
010900* DATE  07/01/2004                                               *01090000
011000*     CHANGED MADE: STORE CONSTRAINTS PROJECT                    *01100000
011100*     RECOMPILED THIS PROGRAM TO PICK UP THE APRD052             *01110000
011200*     COPYBOOK MODIFICATIONS.                                    *01120000
011300*     MADE BY: MIKE BESKE              WR/IR #: WR25805          *01130000
011400*                                                                *01140000
011500* DATE  07/22/2004                                               *01150000
011600*     CHANGE MADE: ADDED 34 MORE PO NUMBERS TO THE LIST OF       *01160000
011700*     2 PERCENT POS.  TOTAL IS NOW 119 POS. THESE 34 POS         *01170000
011800*     ARE FOR VENDOR SHARADHA TERRY MILLS.                       *01180000
011900*     MADE BY: MIKE BESKE              WR/IR #: P000638605       *01190000
012000*                                                                *01200000
012100* DATE  09/16/2004                                               *01210000
012200*     CHANGE MADE: ADDED 27 MORE PO NUMBERS TO THE LIST OF       *01220000
012300*     2 PERCENT POS.  TOTAL IS NOW 146 POS. THESE 27 POS         *01230000
012400*     ARE FOR VENDOR SHARADHA TERRY MILLS.                       *01240000
012500*     MADE BY: MARK BURNSIDE           WR/IR #: P000638605       *01250000
012600*                                                                *01260000
012700* DATE  10/12/2004                                               *01270000
012800*     CHANGE MADE: ADDED 35 MORE PO NUMBERS TO THE LIST OF       *01280000
012900*     2 PERCENT POS.  TOTAL IS NOW 181 POS. THESE 35 POS         *01290000
013000*     ARE FOR VENDOR SHARADHA TERRY MILLS.                       *01300000
013100*     MADE BY: MIKE BESKE              WR/IR #: P000638605       *01310000
013200*                                                                *01320000
013300* DATE  12/08/2004                                               *01330000
013400*     CHANGE MADE: ADDED 17 MORE PO NUMBERS TO THE LIST OF       *01340000
013500*     2 PERCENT POS.  TOTAL IS NOW 198 POS. THESE 17 POS         *01350000
013600*     ARE FOR VENDOR SHARADHA TERRY MILLS.                       *01360000
013700*     MADE BY: KEVIN CATLIN            WR/IR #: P000638605       *01370000
013800*                                                                *01380000
013900* DATE  12/13/2004                                               *01390000
014000*     CHANGE MADE: ADDED 4 MORE PO NUMBERS TO THE LIST OF        *01400000
014100*     2 PERCENT POS.  TOTAL IS NOW 202 POS. THESE 4 POS          *01410000
014200*     ARE FOR VENDOR SHARADHA TERRY MILLS.                       *01420000
014300*     MADE BY: MARK BURNSIDE           WR/IR #: P000638605       *01430000
014400*                                                                *01440000
014500* DATE  12/20/2004                                               *01450000
014600*     CHANGE MADE: ADDED 4 MORE PO NUMBERS TO THE LIST OF        *01460000
014700*     2 PERCENT POS.  REMOVED DUPLICATES - TOTAL IS NOW          *01470000
014800*     143 POS. THESE POS ARE FOR VENDOR SHARADHA TERRY MILLS.    *01480000
014900*     MADE BY: NANCY EILBES            WR/IR #: P000638605       *01490000
015000*                                                                *01500000
015100* DATE  12/27/2004                                               *01510000
015200*     CHANGE MADE: ADDED 4 MORE PO NUMBERS TO THE LIST OF        *01520000
015300*     2 PERCENT POS.                                             *01530000
015400*     MADE BY: TIGHE BRONAUGH          WR/IR #: PM00722530       *01540000
015500*                                                                *01550000
015600* DATE  01/03/2005                                               *01560000
015700*     CHANGE MADE: ADDED 6 MORE PO NUMBERS TO THE LIST OF        *01570000
015800*     2 PERCENT POS.  THESE ARE FOR SHARADHA TERRY MILLS.        *01580000
015900*     MADE BY: MIKE BESKE              WR/IR #: P000723977       *01590000
016000*                                                                *01600000
016100* DATE  01/17/2005                                               *01610000
016200*     CHANGE MADE: ADDED 2 MORE PO NUMBERS TO THE LIST OF        *01620000
016300*     2 PERCENT POS.                                             *01630000
016400*     MADE BY: MARK BURNSIDE           WR/IR #: P000638605       *01640000
016500*                                                                *01650000
016600*                                                                *01660000
016700* DATE  01/24/2005                                               *01670000
016800*     CHANGE MADE: ADDED 4 MORE PO NUMBERS TO THE LIST OF        *01680000
016900*     2 PERCENT POS.                                             *01690000
017000*     MADE BY: L SCHALLHORN            WR/IR #: P000638605       *01700000
017100*                                                                *01710000
017200* DATE  01/24/2005                                               *01720000
017300*     CHANGE MADE: RENAMED ALL REFERENCES OF 'COLBY' TO 'LI &    *01730000
017400*     FUNG'.  LI & FUNG IS THE PARENT COMPANY OF COLBY.          *01740000
017500*     MADE BY: MIKE BESKE              WR/IR #: WR28114          *01750000
017600*                                                                *01760000
017700* DATE  02/15/2005                                             *  01770000
017800*     CHANGE MADE: ADDED 2 MORE PO NUMBERS TO THE LIST OF        *01780000
017900*     2 PERCENT POS.                                             *01790000
018000*     MADE BY: BRONAUGH                WR/IR #: P000737326       *01800000
018100*                                                                *01810000
018200* DATE  02/21/2005                                               *01820000
018300*     CHANGE MADE: ADDED 5 MORE PO NUMBERS TO THE LIST OF        *01830000
018400*     2 PERCENT POS.                                             *01840000
018500*     MADE BY: MARK BURNSIDE           WR/IR #: P000737326       *01850000
018600*                                                                *01860000
018700* DATE  02/28/2005                                               *01870000
018800*     CHANGE MADE: ADDED 2 MORE PO NUMBERS TO THE LIST OF        *01880000
018900*     2 PERCENT POS.                                             *01890000
019000*     MADE BY: L SCHALLHORN            WR/IR #: P000737326       *01900000
019100*                                                                *01910000
019200* DATE  03/23/2005                                               *01920000
019300*     CHANGE MADE: ADDED 10 MORE PO NUMBERS TO THE LIST OF       *01930000
019400*     2 PERCENT POS.  REMOVED OVER 100 POS WHERE THE COMMISSION  *01940000
019500*     INVOICE HAD ALREADY BEEN LOADED AND THE PO HAD ALREADY     *01950000
019600*     BEEN JOURNALIZED - PER AGREEMENT WITH BETH STELLMACHER.    *01960000
019700*     MADE BY: NANCY EILBES            WR/IR #: P000737326       *01970000
019800*                                                                *01980000
019900* DATE  03/28/2005                                               *01990000
020000*     CHANGE MADE: ADDED 7 MORE PO NUMBERS TO THE LIST OF        *02000000
020100*     2 PERCENT POS.                                             *02010000
020200*     MADE BY: MARK BURNSIDE           WR/IR #: P000737326       *02020000
020300*                                                                *02030000
020400* DATE  04/04/2005                                               *02040000
020500*     CHANGE MADE: ADDED 5 MORE PO NUMBERS TO THE LIST OF        *02050000
020600*     2 PERCENT POS.                                             *02060000
020700*     MADE BY: L SCHALLHORN            WR/IR #: P000737326       *02070000
020800*                                                                *02080000
020900* DATE  04/18/2005                                               *02090000
021000*     CHANGE MADE: ADDED 2 MORE PO NUMBERS TO THE LIST OF        *02100000
021100*     2 PERCENT POS.  THESE ARE FOR LI AND FUNG.                 *02110000
021200*     MADE BY: MIKE BESKE              WR/IR #: P000737326       *02120000
021300*                                                                *02130000
021400* DATE  04/25/2005                                               *02140000
021500*     CHANGE MADE: ADDED 2 MORE PO NUMBERS TO THE LIST OF        *02150000
021600*     2 PERCENT POS.                                             *02160000
021700*     MADE BY: NANCY EILBES            WR/IR #: P000737326       *02170000
021800*                                                                *02180000
021900* DATE  05/02/2005                                               *02190000
022000*     CHANGE MADE: ADDED 6 MORE PO NUMBERS TO THE LIST OF        *02200000
022100*     2 PERCENT POS.                                             *02210000
022200*     MADE BY: KRYSTEN LEARY           WR/IR #: P000737326       *02220000
022300*                                                                *02230000
022400* DATE  05/09/2005                                               *02240000
022500*     CHANGE MADE: ADDED 5 MORE PO NUMBERS TO THE LIST OF        *02250000
022600*     2 PERCENT POS.                                             *02260000
022700*     MADE BY: MIKE BESKE              WR/IR #: P000737326       *02270000
022800*                                                                *02280000
022900* DATE  05/16/2005                                               *02290000
023000*     CHANGE MADE: ADDED 2 MORE PO NUMBERS TO THE LIST OF        *02300000
023100*     2 PERCENT POS.                                             *02310000
023200*     MADE BY: TIGHE BRONAUGH          WR/IR #: P000737326       *02320000
023300*                                                                *02330000
023400* DATE  05/23/2005                                               *02340000
023500*     CHANGE MADE: ADDED 3 MORE PO NUMBERS TO THE LIST OF        *02350000
023600*     2 PERCENT POS.                                             *02360000
023700*     MADE BY: L SCHALLHORN            WR/IR #: P000737326       *02370000
023800*                                                                *02380000
023900* DATE  06/13/2005                                               *02390000
024000*     CHANGE MADE: ADDED 10 MORE PO NUMBERS TO THE LIST OF       *02400000
024100*     2 PERCENT POS.                                             *02410000
024200*     MADE BY: MIKE BESKE              WR/IR #: P000737326       *02420000
024300*                                                                *02430000
024400* DATE  06/20/2005                                               *02440000
024500*     CHANGE MADE: ADDED 3 MORE PO NUMBERS TO THE LIST OF        *02450000
024600*     2 PERCENT POS.                                             *02460000
024700*     MADE BY: KRYSTEN LEARY           WR/IR #: P000737326       *02470000
024800*                                                                *02480000
024900* DATE  06/27/2005                                               *02490000
025000*     CHANGE MADE: ADDED 03 MORE PO NUMBERS TO THE LIST OF       *02500000
025100*     2 PERCENT POS.                                             *02510000
025200*     MADE BY: MIKE BESKE              WR/IR #: P000737326       *02520000
025300*                                                                *02530000
025400* DATE  07/06/2005                                               *02540000
025500*     CHANGE MADE: ADDED 03 MORE PO NUMBERS TO THE LIST OF       *02550000
025600*     2 PERCENT POS.                                             *02560000
025700*     MADE BY: NANCY EILBES            WR/IR #: P000737326       *02570000
025800*                                                                *02580000
025900* DATE  07/18/2005                                               *02590000
026000*     CHANGE MADE: ADDED 07 MORE PO NUMBERS TO THE LIST OF       *02600000
026100*     2 PERCENT POS.                                             *02610000
026200*     MADE BY: L SCHALLHORN            WR/IR #: P000737326       *02620000
026300*                                                                *02630000
026400* DATE  08/01/2005                                               *02640000
026500*     CHANGE MADE: ADDED 06 MORE PO NUMBERS TO THE LIST OF       *02650000
026600*     2 PERCENT POS.                                             *02660000
026700*     MADE BY: MIKE BESKE              WR/IR #: P000737326       *02670000
026800*                                                                *02680000
026900* DATE  08/15/2005                                               *02690000
027000*     CHANGE MADE: ADDED 03 MORE PO NUMBERS TO THE LIST OF       *02700000
027100*     2 PERCENT POS.                                             *02710000
027200*     MADE BY: MIKE BESKE              WR/IR #: P000737326       *02720000
027300*                                                                *02730000
027400* DATE  08/22/2005                                               *02740000
027500*     CHANGE MADE: ADDED 02 MORE PO NUMBERS TO THE LIST OF       *02750000
027600*     2 PERCENT POS.                                             *02760000
027700*     MADE BY: L SCHALLHORN            WR/IR #: P000737326       *02770000
027800*                                                                *02780000
027900* DATE  08/29/2005                                               *02790000
028000*     CHANGE MADE: ADDED 08 MORE PO NUMBERS TO THE LIST OF       *02800000
028100*     2 PERCENT POS.                                             *02810000
028200*     MADE BY: NANCY EILBES            WR/IR #: P000737326       *02820000
028300*                                                                *02830000
028400* DATE  09/06/2005                                               *02840000
028500*     CHANGE MADE: ADDED 03 MORE PO NUMBERS TO THE LIST OF       *02850000
028600*     2 PERCENT POS.                                             *02860000
028700*     MADE BY: MIKE BESKE              WR/IR #: P000737326       *02870000
028800*                                                                *02880000
028900* DATE  09/12/2005                                               *02890000
029000*     CHANGE MADE: ADDED 03 MORE PO NUMBERS TO THE LIST OF       *02900000
029100*     2 PERCENT POS.  ALSO REMOVED 44 PO NUMBERS THAT HAD        *02910000
029200*     BEEN JOURNALIZED AT LEAST 60 DAYS AGO - PER BETH S.        *02920000
029300*     MADE BY: NANCY EILBES            WR/IR #: P000737326       *02930000
029400*                                                                *02940000
029500* DATE  09/19/2005                                               *02950000
029600*     CHANGE MADE: REMOVED 19 PO NUMBERS FROM THE LIST OF        *02960000
029700*     2 PERCENT POS - THIS PROGRAM IS ENDING AND THESE POS       *02970000
029800*     NEED TO GO BACK TO THE NORMAL 5% COMMISSION.               *02980000
029900*     MADE BY: NANCY EILBES            WR/IR #: P000737326       *02990000
030000*                                                                *03000000
030100* DATE  10/03/2007                                               *03010000
030200*     CHANGE MADE: MOVED SPACES TO WORKING STORAGE FIELD         *03020000
030300*     PV-VENDOR-INVOICE-NBR TO RESOLVE ISSUE WITH DATES BEING    *03030000
030400*     APPENDED TO INVOICES WHEN THE WORKING STORAGE FIELD ISN'T  *03040000
030500*     BEING RESET.                                               *03050000
030600*     MADE BY: SCOTT KRUSCHKA          WR/IR #: INC000000093665  *03060000
030700*                                                                *03070000
030800* DATE  01/05/2009                                               *03080000
030900*     CHANGE MADE: ADD LOGIC TO PREVENT COMMISSION INVOICES FROM *03090000
031000*     BEING CREATED FOR PARENT COMPANIES THAT ARE LI & FUNG      *03100000
031100*     RELATED PARTIES.  ADDED DB2 PROCESSING TO THE PROGRAM, AND *03110000
031200*     A SELECT FROM TPURCHS TO OBTAIN THE IMPORT PARENT ID.      *03120000
031300*     MADE BY: GREG WISIALOWSKI        WR/IR #: WR34381          *03130000
031400*                                                                *03140000
031500* DATE  01/06/2009                                               *03150000
031600*     CHANGE MADE: REPLACE PAYMENT TERMS HARD-CODING WITH A LOOK *03160000
031700*     UP ON THE PO PAYMENT TERMS DATABASE.                       *03170000
031800*     MADE BY: NANCY EILBES            WR/IR #: WR35659          *03180000
031900*                                                                *03190000
032000* DATE  10/20/2009                                               *03200000
032100*     CHANGE MADE:  RECOMPILE FOR 310 EDI PROJECT.               *03210000
032200*     COPYBOOK APRD016 WENT FROM 335 TO 361 BYTES.               *03220000
032300*     MADE BY: PAUL STROEDE            WR/IR #: WR23145          *03230000
032400* DATE  09/02/2010                                               *03240000
032500*     CHANGE MADE:  ADD DEPT 836 TO CHARITY DEPT FLAG.           *03250000
032600*     MADE BY: TOM MARTIN              WR/IR #: WR38253          *03260000
032700* DATE  01/30/2012                                               *03270000
032800*     CHANGE MADE:  CHANGES WERE MADE FOR THE LI & FUNG          *03280000
032900*     COMMISSION PAYMENT - REFLECT BLENDED CONTRACT RATE WORK    *03290000
033000*     REQUEST.  ADDED AN INPUT FILE THAT HOLDS THE BLENDED RATES.*03300000
033100*     ADDED 4 TABLES TEXTENT, TENTNME, TAPCNTL, AND TAPVNDS TO   *03310000
033200*     GET THE CORRECT DATA FOR THE NEW OUTPUT FILE - ADJUSTMENT  *03320000
033300*     JOURNAL TRANSACTION FILE (APRD045).  THIS WAS ALL DONE SO  *03330000
033400*     THAT WE CAN PAY LI & FUNG A "BLENDED" COMMISSION RATE.     *03340000
033500*     APRD045 IS WRITTEN OUT FROM THIS PROGRAM IN ORDER TO GET   *03350000
033600*     THE ADJUSTMENT OF THE DIFFERENCE BETWEEN THE BLENDED RATE  *03360000
033700*     AND 5% SENT TO GL.                                          03370000
033800*     MADE BY: BARB SCHULTZ            WR/IR #: WR40026           03380000
033900* DATE  10/05/2012                                               *03390000
034000*     CHANGE MADE:  INCREASED PV-ADJ-AMT TO S9(7)V9999 TO        *03400000
034100*     PREVENT TRUNCATION OF AMOUNTS OVER 9999.9999.              *03410000
034200*     MADE BY: NANCY EILBES            WR/IR #: CRQ000000033795  *03420000
034300*                                                                *03430000
034400* DATE  03/17/2014                                               *03440000
034500*     CHANGE MADE:  ADDED NEW VALUES FOR IMPORT PARENT COMPANIES *03450000
034600*     TO PREVENT COMMISSION INVOICES FROM BEING CREATED.         *03460000
034700*     MADE BY: NANCY EILBES            WR/IR #: CHG0076793       *03470000
034800*                                                                *03480000
034900* DATE  11/13/2014                                               *03490000
035000*     CHANGE MADE: REMOVED PV-SPECIAL-PO-CHECK VAIRIABLE AND     *03500000
035100*     CORRESPONDING 88 CONDITION CHECK (PV-TWO-PCNT-PO) IN       *03510000
035200*     M400-MOVE-TALCHRG-FIELDS PARA. I.E., TWO PERCENT POS       *03520000
035300*     VALIDATION REMOVED. ALL POS NEED TO HAVE 5% COMMISSION.    *03530003
035400*     MADE BY: COGNIZANT               WR/IR #: CHG0094517       *03540000
035410*                                                                *03541003
035420* DATE  01/28/2019                                               *03542003
035430*   CHANGE MADE: PROGRAM APKUT221 RUNS IN JOB APK022 AND HAS THE *03543003
035440*   COMMISSION RATE OF 5% HARD CODED IN PARAGRAPH M400.  BASED ON*03544003
035450*   THE REQUIREMENTS IN INC7320297, THE PROGRAM HAS BEEN MODIFIED*03545003
035460*   TO ADD TABLE TPLNSHP AND JOIN THIS WITH TPURCHS IN PARAGRAPH *03546003
035470*   S100-CHECK-VND-ID AND SELECT THE COLUMN STRT_FCTRY_DTE. IN   *03547003
035480*   M400, CONDITIONAL LOGIC HAS BEEN ADDED TO THE COMPUTE OF     *03548003
035490*   AP016-ALW-CHRG-AMT. IF THE START X-FACTORY DATE IS GREATER   *03549003
035491*   THAN 2019-02-02, THEN USE 3.5% IN THE CALCULATION, OTHERWISE,*03549103
035492*   CONTINUE TO USE 5%.                                          *03549203
035494*   MADE BY: SRINATH(COGNIZANT)      WR/IR #: CHG0216724         *03549403
035495*                                                                *03549503
035496* DATE  03/05/2019                                                03549603
035497*     CHANGE MADE: BUSINESS REQUESTED THAT THE COMMISSION        *03549703
035498*     CALCULATION CHANGES DONE EARLIER BE CHANGED TO USE         *03549803
035499*     LAST_FCTRY_DTE INSTEAD OF STRT_FCTRY_DTE.                  *03549903
035502*     MADE BY: SRINATH(COGNIZANT)      WR/IR #: CHG0219116       *03550203
035503*                                                                *03550303
035504* DATE  03/14/2019                                               *03550403
035505*     CHANGE MADE: ALL REBATE CALCULATION LOGIC WAS REMOVED FROM *03550503
035506*     PROGRAM APKUT221. AS A RESULT, THERE WAS NO NEED TO        *03550603
035507*     KEEP THE ADJUSTMENT FILE OUT02. THE INP02 FILE WAS ALSO    *03550703
035508*     NOT NEEDED ANYMORE, SO IT WAS REMOVED. THIS WAS DONE PER   *03550803
035509*     REQUEST FROM THE BUSINESS.                                 *03550903
035510*     MADE BY: SRINATH(COGNIZANT)      WR/IR #: CHG0219727       *03551003
035511*                                                                *03551103
035532* DATE 07/23/2021                                                *03553203
035533*     CHANGE MADE: ADDED COMMISSION TRUE-UP PROCESS. RECOVERED   *03553303
035534*     THE REBATE LOGIC THAT WAS REMOVED IN 2019 AND MODIFIED TO  *03553403
035535*     MEET THE NEW BUSINESS RULES FOR TRUE-UP TRANSACTIONS.  WE  *03553503
035536*     ARE USING THE SAME AP TRANCODE - 9T.  THE DOC NUMBER AND   *03553603
035537*     COMMENTS MODIFIED TO REFLECT THE TERMINOLOGY TRUEUP INSTEAD*03553703
035538*     OF REBATE.  THE CONTROL CARD FILE WAS NOT ADDED, THE RATE  *03553803
035539*     OF .6% AND THE EFFECTIVE DATES HARD-CODED.  THESE WILL BE  *03553903
035540*     IN EFFECT UNTIL 2023 AT MINIMUM. PAYMENT TERMS ARE HARD-   *03554003
035541*     CODED AT NET30 FOR BOTH THE COMMISSION INVOICE AND THE     *03554103
035542*     TRUEUP TRANSACTION RATHER THAN USING THE PO TERMS.  THE    *03554203
035543*     TRUEUP AMOUNT IS CALCULATED AS 0.006 * 1ST COST.  NEW GL   *03554303
035544*     ACCOUNT NUMBER IS BEING ASSIGNED FOR TRUE UP ACCOUNT.      *03554403
035545*     MADE BY: NANCY EILBES            WR/IR #: CHG0259283       *03554508
035511*                                                                *03554609
035532* DATE 05/02/2022                                                *03554709
035533*     CHANGE MADE: ADD 2ND VALUE TO TRUE UP ARRAY                *03554809
035545*     MADE BY: JEAN KURK               WR/IR #: CHG0269436       *03556009
035511*                                                                *03556164
035532* DATE 08/09/2022                                                *03556264
035533*     CHANGE MADE: ADD INPUT FILE OF VENDORS TO BE PROCESSED.    *03556364
035533*     THIS FILE INCLUDES DIRECT IMPORTERS AND LI & FUNG.         *03556464
035533*     DIRECT IMPORTERS WILL RECEIVE COMMISSION INVOICES BUT NOT  *03556564
035533*     TRUE UP TRANSACTIONS.                                      *03556664
035545*     MADE BY: JEAN KURK               WR/IR #: CHG0272874       *03556764
030001*                                                               * 03556866
029700*   DATE  03/16/2023                                            * 03556967
029800*   CHANGE MADE: RECOMPILE FOR UPDATED COPYBOOK APRD052         * 03557066
030000*      MADE BY: JEAN KURK               WR/IR #: CHG0285404     * 03557167
035550******************************************************************03558003
035600                                                                  03560000
035700 ENVIRONMENT DIVISION.                                            03570000
035800                                                                  03580000
035900 INPUT-OUTPUT SECTION.                                            03590000
036000                                                                  03600000
036100 FILE-CONTROL.                                                    03610000
036200     SELECT INPUT-FILE              ASSIGN TO INP01.              03620000
036200     SELECT VENDOR-FILE             ASSIGN TO INP02.              03630018
036400     SELECT OUTPUT-FILE             ASSIGN TO OUT01.              03640000
036500     SELECT OUTPUT-ADJ-FILE         ASSIGN TO OUT02.              03650000
036600*                                                                 03660000
036700                                                                  03670000
036800 DATA DIVISION.                                                   03680000
036900                                                                  03690000
037000 FILE SECTION.                                                    03700000
037100*                                                                 03710000
037200 FD  INPUT-FILE                                                   03720000
037300     RECORDING MODE IS F                                          03730000
037400     LABEL RECORDS ARE STANDARD                                   03740000
037500     RECORD CONTAINS 350 CHARACTERS                               03750000
037600     BLOCK CONTAINS 0  RECORDS                                    03760000
037700     DATA RECORD IS INPUT-RECORD.                                 03770000
037800 01  INPUT-RECORD                  PIC  X(350).                   03780000
037900*                                                                 03790000
037200 FD  VENDOR-FILE                                                  03800018
037300     RECORDING MODE IS F                                          03810018
037400     LABEL RECORDS ARE STANDARD                                   03820018
037500     RECORD CONTAINS 80 CHARACTERS                                03830018
037600     BLOCK CONTAINS 0  RECORDS                                    03840018
037700     DATA RECORD IS VNDR-RECORD.                                  03850018
037800 01  VNDR-RECORD                   PIC  X(80).                    03860018
037900*                                                                 03870018
038800 FD  OUTPUT-FILE                                                  03880000
038900     RECORDING MODE IS F                                          03890000
039000     LABEL RECORDS ARE STANDARD                                   03900000
039100     RECORD CONTAINS 476 CHARACTERS                               03910000
039200     BLOCK CONTAINS 0  RECORDS                                    03920000
039300     DATA RECORD IS OUTPUT-RECORD.                                03930000
039400 01  OUTPUT-RECORD                 PIC  X(476).                   03940000
039500*                                                                 03950000
039600 FD  OUTPUT-ADJ-FILE                                              03960000
039700     RECORDING MODE IS F                                          03970000
039800     LABEL RECORDS ARE STANDARD                                   03980000
039900     RECORD CONTAINS 500 CHARACTERS                               03990000
040000     BLOCK CONTAINS 0  RECORDS                                    04000000
040100     DATA RECORD IS OUTPUT-RECORD.                                04010000
040200 01  OUTPUT-ADJ-RECORD             PIC  X(500).                   04020000
040300*                                                                 04030000
040400                                                                  04040000
040500/                                                                 04050000
040600 WORKING-STORAGE SECTION.                                         04060000
040700                                                                  04070000
040800 01  FILLER                        PIC X(25)  VALUE               04080000
040900                             'WS FOR APKUT221 BEGINS==>'.         04090000
041000*                                                                 04100000
041100******************************************************************04110000
041200** INPUT FILE - EDI MDS INVOICE ADD FILE                          04120000
041300******************************************************************04130000
041400 01  WS-INPUT-REC.                                                04140000
041500     COPY APRD052.                                                04150000
041600*                                                                 04160000
042300******************************************************************04230000
042400** OUTPUT FILE - COMMISSION IMPORT EXPENSE INVOICE                04240028
042500**               LOAD FILE                                        04250000
042600******************************************************************04260000
042700     COPY APRD016.                                                04270000
042800*                                                                 04280000
042900******************************************************************04290000
043000** OUTPUT ADJUSTMENT FILE                                         04300000
043100******************************************************************04310000
043200     COPY APRD045.                                                04320000
043300*                                                                 04330000
043400***************************************************************** 04340000
043500*  WORKING STORAGE AREA FOR APPD051                               04350000
043600***************************************************************** 04360000
043700     COPY APWS051.                                                04370000
043800*                                                                 04380000
043400***************************************************************** 04381015
043500*  CONTROL CARD INPUT RECORD STRUCTURE                            04382015
043600***************************************************************** 04383015
043700     COPY APRD026.                                                04384015
043800*                                                                 04385015
043900*    DATE ROUTINE NEEDED IN APPD051                               04390000
044000*                                                                 04400000
044100     COPY DPWS500.                                                04410000
044500                                                                  04450000
044600 01  WS-RETRY-COUNTER              PIC S9(4)  COMP VALUE ZERO.    04460000
044700 01  WS-RETRY-MAX                  PIC S9(4)  COMP VALUE 3.       04470000
044800                                                                  04480000
044900 01  WS-SWITCH-AREA.                                              04490000
045000     05  WS-END-OF-INPUT-SW        PIC X(03)  VALUE 'NO '.        04500000
045100         88  WS-END-OF-INPUT                  VALUE 'YES'.        04510000
045200         88  WS-NOT-END-OF-INPUT              VALUE 'NO '.        04520000
045000     05  WS-END-OF-VNDR-SW         PIC X(03)  VALUE 'NO '.        04530018
045100         88  WS-END-OF-VNDR                   VALUE 'YES'.        04540018
045200         88  WS-NOT-END-OF-VNDR               VALUE 'NO '.        04550018
045600     05  WS-INV-TERMS-CREATED-SW   PIC X(03)  VALUE 'NO '.        04560000
045700         88  WS-INV-TERMS-CREATED             VALUE 'YES'.        04570000
045800         88  WS-INV-TERMS-NOT-CREATED         VALUE 'NO '.        04580000
045900*    05  WS-LIFUNG-OR-NOT-SW       PIC X(03)  VALUE 'NO '.        04590021
046000*        88  WS-LIFUNG                        VALUE 'YES'.        04600021
046100*        88  WS-NOT-LIFUNG                    VALUE 'NO '.        04610021
045900     05  WS-VENDOR-STATUS          PIC X(03)  VALUE 'NO '.        04620021
046000         88  WS-IMPORT-VNDR                   VALUE 'IMP'.        04630029
046100         88  WS-VNDR-AGENT                    VALUE 'VWA'.        04640014
046100         88  WS-GOOD-VNDR                     VALUES 'IMP', 'VWA'.04641025
046100         88  WS-NOT-GOOD-VNDR                 VALUE 'NO '.        04642021
046500     05  WS-VENDOR-FND-SW          PIC X(01)  VALUE 'N'.          04650000
046600         88  WS-VENDOR-FND                    VALUE 'Y'.          04660000
046700         88  WS-VENDOR-NOT-FND                VALUE 'N'.          04670000
046500     05  WS-VNDR-TBL-SW            PIC X(01)  VALUE 'N'.          04671039
046600         88  WS-VNDR-IN-TABLE                 VALUE 'Y'.          04672039
046700         88  WS-VNDR-NOT-IN-TABLE             VALUE 'N'.          04673039
046800     05  WS-FLOAT-DAY-SW         PIC  X(01)  VALUE ' '.           04680000
046900         88  TAPVNDS-FLOAT-DAY-FOUND         VALUE 'Y'.           04690000
047000         88  TAPVNDS-FLOAT-DAY-NOT-FOUND     VALUE ' '.           04700000
047100     05  WS-END-MONTH-SW         PIC  X(01)  VALUE ' '.           04710000
047200         88  WS-END-MONTH                    VALUE 'Y'.           04720000
047300         88  WS-NOT-END-MONTH                VALUE ' '.           04730000
047310     05  WS-TRUEUP-RATE-SW         PIC X(01)  VALUE 'N'.          04731008
047320         88  WS-TRUEUP-FND                    VALUE 'Y'.          04732003
047330         88  WS-TRUEUP-NOT-FND                VALUE 'N'.          04733003
047400                                                                  04740000
047500*                                                                 04750000
047600 01  WS-PROGRAM-COUNTERS.                                         04760000
047700     05  WS-INPUT-COUNT            PIC  9(09) VALUE ZEROS.        04770000
047700     05  WS-VNDR-COUNT             PIC  9(09) VALUE ZEROS.        04771018
047800     05  WS-INPUT-CONTROL-COUNT    PIC  9(09) VALUE ZEROS.        04780000
047900     05  WS-OUTPUT-COUNT           PIC  9(09) VALUE ZEROS.        04790000
048000     05  WS-ADJ-OUTPUT-COUNT       PIC  9(09) VALUE ZEROS.        04800000
048100     05  WS-HDCODE4-COUNT          PIC  9(09) VALUE ZEROS.        04810000
048200     05  WS-RECORD4-COUNT          PIC  9(09) VALUE ZEROS.        04820000
048300     05  WS-NOCOMM-COUNT           PIC  9(09) VALUE ZEROS.        04830000
048400                                                                  04840000
048500 01  PC-PROGRAM-CONSTANTS.                                        04850000
048600     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                04860000
048700         '**** WORKING STORAGE ** APKUT221 ****'.                 04870000
048800     05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUT221'.    04880000
048900     05  PC-STORNO               PIC  X(05)  VALUE '00090'.       04890000
048900     05  PC-MAX-VNDR             PIC  999    VALUE 20.            04891018
049000                                                                  04900000
049100 01  PV-WORKING-STORAGE.                                          04910000
049200     05  PV-VENDOR-INVOICE-NBR     PIC X(22)  VALUE SPACES.       04920000
049300     05  PV-SPEC-PER               PIC S9V9(04) VALUE ZEROES.     04930000
049300     05  PV-CALC-PCT               PIC 9V9999   VALUE ZEROES.     04931062
049400*    05  PV-LIFUNG                 PIC X(09)  VALUE '009206194'.  04940022
049400     05  PV-VNDR-NBR               PIC X(09)  VALUE SPACES.       04941022
049500     05  PV-STRING                 PIC X(22)  VALUE SPACES.       04950000
049600     05  PV-START                  PIC S9(04) VALUE ZEROS         04960000
049700                                              COMP.               04970000
049800     05  PV-START2                 PIC S9(04) VALUE ZEROS         04980000
049900                                               COMP.              04990000
050000     05  PV-CURRENT-DATE           PIC X(10)  VALUE SPACES.       05000000
050100     05  PV-WEEK-BEGIN-DATE        PIC X(10)  VALUE SPACES.       05010000
050200     05  PV-WEEK-END-DATE          PIC X(10)  VALUE SPACES.       05020000
050300     05  PV-BTCH-DTE               PIC X(10)  VALUE SPACES.       05030000
050400     05  PV-DUE-DATE-CCYY-MM-DD    PIC X(10)  VALUE SPACES.       05040000
050500     05  PV-ADJ-AMT                PIC S9(7)V9999 VALUE ZEROES.   05050000
050510     05  PV-ADJ-AMT-DISP           PIC 9(7).9999 VALUE ZEROES.    05051003
050600     05  PV-ALW-CHRG-AMT           PIC S9(4)V99   VALUE ZEROES.   05060000
050700     05  PV-REASON-DESC.                                          05070000
050800         10 PV-RSN-INV-NBR         PIC X(13)  VALUE SPACES.       05080000
050900         10 PV-RSN-COMM-TRUEUP     PIC X(20)                      05090003
051000                            VALUE ' COMMISSION TRUE UP '.         05100003
051100         10 PV-RSN-PO-NBR          PIC 9(09)  VALUE ZEROES.       05110000
051200     05  PV-TIME-OF-DAY            PIC X(06)  VALUE SPACES.       05120000
051300     05  FILLER REDEFINES PV-TIME-OF-DAY.                         05130000
051400         10  PV-DAY-HOUR           PIC X(02).                     05140000
051500         10  PV-DAY-MINUTE         PIC X(02).                     05150000
051600         10  PV-DAY-SECOND         PIC X(02).                     05160000
051700     05  PV-TIME.                                                 05170000
051800         10  FILLER                PIC X(01)  VALUE '-'.          05180000
051900         10  PV-TIME-HOUR          PIC 9(02)  VALUE ZEROS.        05190000
052000         10  FILLER                PIC X(01)  VALUE '.'.          05200000
052100         10  PV-TIME-MINUTE        PIC 9(02)  VALUE ZEROS.        05210000
052200         10  FILLER                PIC X(01)  VALUE '.'.          05220000
052300         10  PV-TIME-SECOND        PIC 9(02)  VALUE ZEROS.        05230000
052400         10  FILLER                PIC X(01)  VALUE '.'.          05240000
052500         10  PV-TIME-MIL           PIC X(06)  VALUE '999999'.     05250000
052600                                                                  05260000
052700 01  PV-DEPT-NBR                   PIC X(3)   VALUE SPACES.       05270000
052800     88  PV-CHARITY-DEPT                                          05280000
052900         VALUES '830', '836'.                                     05290000
053000 01  PV-PARENT                     PIC X(9)   VALUE SPACES.       05300000
053100     88  PV-RELATED-PARTY                     VALUE '000059694',  05310000
053200                                                    '000070509',  05320000
053300                                                    '000116356'.  05330000
053400***  PARENT COMPANIES THAT HAVE NO COMMISSION PAYMENT             05340000
053500***  ROSETTI ASIA LIMITED    59694   000824219                    05350000
053600***  HOMEWORKS ASIA LTD      70509   000978494                    05360000
053700***  GSCM (HK) LIMITED      116356   001070187                    05370000
053800***                                                               05380000
052700 01  PV-PO-TYPE                    PIC X(2)   VALUE SPACES.       05381042
052800     88  PV-VALID-PO-TYPE                                         05382042
052900         VALUES 'IM', 'IE', 'IF'.                                 05383042
053900                                                                  05390000
054000 01  PV-INVOICE-DATE               PIC X(6)   VALUE SPACES.       05400000
054100 01  PV-INVOICE-DATE-RED REDEFINES PV-INVOICE-DATE.               05410000
054200     05  PV-INVOICE-DATE-YY        PIC X(2).                      05420000
054300     05  PV-INVOICE-DATE-MM        PIC X(2).                      05430000
054400     05  PV-INVOICE-DATE-DD        PIC X(2).                      05440000
054500                                                                  05450000
054600 01  PV-INVC-DTE                   PIC X(10).                     05460000
054700 01  PV-INVC-DTE-RED REDEFINES PV-INVC-DTE.                       05470000
054800     05  PV-INVC-DTE-CC            PIC X(2).                      05480000
054900     05  PV-INVC-DTE-YY            PIC X(2).                      05490000
055000     05  PV-DASH-1                 PIC X(1).                      05500000
055100     05  PV-INVC-DTE-MM            PIC X(2).                      05510000
055200     05  PV-DASH-2                 PIC X(1).                      05520000
055300     05  PV-INVC-DTE-DD            PIC X(2).                      05530000
055400                                                                  05540000
055500 01  PV-PO-COMPARE-DTE.                                           05550000
055600     05  PV-COMP-CCYY              PIC 9(4).                      05560000
055700     05  PV-FILLER-1               PIC X(1).                      05570000
055800     05  PV-COMP-MM                PIC 9(2).                      05580000
055900     05  PV-FILLER-2               PIC X(1).                      05590000
056000     05  PV-COMP-DD                PIC 9(2).                      05600000
056100                                                                  05610000
056200 01  PV-PO-COMP-DTE.                                              05620000
056300     05  PV-CP-CCYY                PIC 9(4).                      05630000
056400     05  PV-CP-MM                  PIC 9(2).                      05640000
056500     05  PV-CP-DD                  PIC 9(2).                      05650000
056600                                                                  05660000
056700 01  PV-TRUEUP-RATE-TABLE.                                        05670003
056800     05  PV-TRUEUP-RATE OCCURS 2 TIMES                            05680003
056900                        INDEXED BY PV-PER-IDX.                    05690003
057000         10  PV-EFF-BEG-DTE.                                      05700000
057100             15  PV-EFF-BEG-CCYY   PIC X(4).                      05710000
057200             15  PV-EFF-BEG-MM     PIC X(2).                      05720000
057300             15  PV-EFF-BEG-DD     PIC X(2).                      05730000
057400         10  PV-EFF-END-DTE.                                      05740000
057500             15  PV-EFF-END-CCYY   PIC X(4).                      05750000
057600             15  PV-EFF-END-MM     PIC X(2).                      05760000
057700             15  PV-EFF-END-DD     PIC X(2).                      05770000
057800         10  PV-TRUEUP-PERCENT     PIC S9V9(4).                   05780003
057900                                                                  05790000
056700 01  PV-VENDOR-TABLE.                                             05791018
056800     05  PV-VENDOR-TBL OCCURS 20 TIMES                            05792018
056900                        INDEXED BY PV-VND-IDX.                    05793018
057000         10  PV-VENDOR-ID          PIC X(9).                      05794018
057000         10  PV-PAY-VENDOR         PIC X(9).                      05795018
057400         10  PV-COMM-PCT           PIC 999V99.                    05798018
057400         10  PV-VNDR-TYP           PIC X(1).                      05799021
057400         10  PV-ENT-ID             PIC S9(9) COMP.                05799123
057400         10  PV-ENT-NAME           PIC X(30).                     05799223
057400         10  PV-FLOAT-IND          PIC X(01).                     05799327
057400         10  PV-FLOAT-DAYS         PIC S9(4) COMP.                05799427
057900                                                                  05799527
058000*----------------------------------------------------------------*05800000
058100*    SQL COMMUNICATIONS AREA DCLGEN                               05810000
058200*----------------------------------------------------------------*05820000
058300     EXEC SQL                                                     05830000
058400         INCLUDE SQLCA                                            05840000
058500     END-EXEC.                                                    05850000
058600                                                                  05860000
058700*----------------------------------------------------------------*05870000
058800*    PO-PURCHASE TABLE                                            05880000
058900*----------------------------------------------------------------*05890000
059000     EXEC SQL                                                     05900000
059100         INCLUDE TPURCHS                                          05910000
059200     END-EXEC.                                                    05920000
059300                                                                  05930000
059400*----------------------------------------------------------------*05940000
059500*    DB2 AREA FOR PURCHASE ORDER AGREEMENT TABLE                  05950000
059600*----------------------------------------------------------------*05960000
059700*    EXEC SQL                                                     05970003
059800*         INCLUDE TPOAGMT                                         05980003
059900*    END-EXEC.                                                    05990003
060000*                                                                 06000003
060100*----------------------------------------------------------------*06010000
060200*    DB2 AREA FOR PAYMENT TERMS TABLE                             06020000
060300*----------------------------------------------------------------*06030000
060400*    EXEC SQL                                                     06040003
060500*         INCLUDE TPAYTRM                                         06050003
060600*    END-EXEC.                                                    06060003
060700*----------------------------------------------------------------*06070000
060800*    EXTERNAL ENTERPRISE TABLE                                    06080000
060900*----------------------------------------------------------------*06090000
061000     EXEC SQL                                                     06100000
061100         INCLUDE TEXTENT                                          06110000
061200     END-EXEC.                                                    06120000
061300                                                                  06130000
061400*----------------------------------------------------------------*06140000
061500*    EXTERNAL ENTERPRISE NAME TABLE                               06150000
061600*----------------------------------------------------------------*06160000
061700     EXEC SQL                                                     06170000
061800         INCLUDE TENTNME                                          06180000
061900     END-EXEC.                                                    06190000
062000                                                                  06200000
062100*----------------------------------------------------------------*06210000
062200*    AP-PAYMENT CONTROL TABLE                                     06220000
062300*----------------------------------------------------------------*06230000
062400     EXEC SQL                                                     06240000
062500         INCLUDE TAPCNTL                                          06250000
062600     END-EXEC.                                                    06260000
062700                                                                  06270000
062800*----------------------------------------------------------------*06280000
062900*    TAPVNDS TABLE LAYOUT                                         06290000
063000*----------------------------------------------------------------*06300000
063100     EXEC SQL                                                     06310000
063200         INCLUDE TAPVNDS                                          06320000
063300     END-EXEC.                                                    06330000
063400                                                                  06340000
063500*----------------------------------------------------------------*06350000
063600*    TPLNSHP TABLE LAYOUT                                         06360000
063700*----------------------------------------------------------------*06370000
063800     EXEC SQL                                                     06380000
063900         INCLUDE TPLNSHP                                          06390000
064000     END-EXEC.                                                    06400000
064100                                                                  06410000
064200*----------------------------------------------------------------*06420000
064300*    ABEND DATA AREAS                                             06430000
064400*----------------------------------------------------------------*06440000
064500 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      06450000
064600                                   COMP         SYNC.             06460000
064700                                                                  06470000
064800     88  AC-ANY-ERROR                           VALUE  +4001      06480000
064900                                                THRU   +4019.     06490000
065000     88  AC-OPEN-ERROR                          VALUE  +4005.     06500000
065100     88  AC-CLOSE-ERROR                         VALUE  +4006.     06510000
065200     88  AC-INVALID-DATA                        VALUE  +4008.     06520000
065300     88  AC-DB2-ERROR                           VALUE  +4013.     06530000
065400     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     06540000
065500     88  AC-MAX-RETRIES-EXCEEDED                VALUE  +4016.     06550000
065600                                                                  06560000
065700                                                                  06570000
065800 01  ABEND-AREAS.                                                 06580000
065900     05  AA-ABEND-LIT              PIC  X(40)   VALUE             06590000
066000             '*****       ABEND'.                                 06600000
066100     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             06610000
066200             '*****   PROGRAM: APKUT221'.                         06620000
066300     05  AA-PARAGRAPH-LIT.                                        06630000
066400         10  FILLER                PIC  X(17)   VALUE             06640000
066500             '***** PARAGRAPH: '.                                 06650000
066600         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     06660000
066700     05  AA-MESSAGE-LINE-1.                                       06670000
066800         10  FILLER                PIC  X(06)   VALUE '*****'.    06680000
066900         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     06690000
067000     05  AA-MESSAGE-LINE-2.                                       06700000
067100         10  FILLER                PIC  X(06)   VALUE '*****'.    06710000
067200         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     06720000
067300     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             06730000
067400             '*****    DB2 ERROR'.                                06740000
067500     05  AA-DB2-OPERATION-LIT.                                    06750000
067600         10  FILLER                PIC  X(17)   VALUE             06760000
067700             '***** OPERATION: '.                                 06770000
067800         10  AA-DB2-OPERATION.                                    06780000
067900             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     06790000
068000             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     06800000
068100     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     06810000
068200     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     06820000
068300                                                                  06830000
068400*----------------------------------------------------------------*06840000
068500*    SQLCA FORMATTED MESSAGE AREA                                 06850000
068600*----------------------------------------------------------------*06860000
068700     COPY DPWS004.                                                06870000
068800                                                                  06880000
068900*----------------------------------------------------------------*06890000
069000* COMMUNICATIONS AREA FOR DB2                                    *06900000
069100*----------------------------------------------------------------*06910000
069200     COPY SQLCA2.                                                 06920000
069300                                                                  06930000
069400 01  FILLER                        PIC X(25) VALUE                06940000
069500          '<====WS FOR APKUT221 ENDS'.                            06950000
069600                                                                  06960000
069700 PROCEDURE DIVISION.                                              06970000
069800                                                                  06980000
069900*                                                                 06990000
070000***************************************************************** 07000000
070100*  MAIN DRIVER FOR THE PROGRAM.                                   07010000
070200***************************************************************** 07020000
070300*                                                                 07030000
070400 A100-MAINLINE.                                                   07040000
070500                                                                  07050000
070600     PERFORM B100-HOUSEKEEPING.                                   07060000
070700                                                                  07070000
070800     PERFORM B200-CREATE-EXPENSE-LOAD-REC                         07080000
070900       UNTIL WS-END-OF-INPUT.                                     07090000
071000                                                                  07100000
071100     PERFORM B300-END-OF-JOB.                                     07110000
071200                                                                  07120000
071300     GOBACK.                                                      07130000
071400        EJECT                                                     07140000
071500                                                                  07150000
071600*                                                                 07160000
071700***************************************************************** 07170000
071800*  INITIALIZATION.                                                07180000
071900***************************************************************** 07190000
072000*                                                                 07200000
072100 B100-HOUSEKEEPING.                                               07210000
072200                                                                  07220000
072300                                                                  07230000
072400     OPEN INPUT INPUT-FILE                                        07240000
072400                VENDOR-FILE                                       07250020
072600         OUTPUT OUTPUT-FILE                                       07260000
072700                OUTPUT-ADJ-FILE.                                  07270000
072700                                                                  07271015
072700     INITIALIZE PV-VENDOR-TABLE.                                  07272018
075301     SET PV-VND-IDX TO 1.                                         07272118
073500     PERFORM R200-READ-VNDR                                       07273018
073500         UNTIL WS-END-OF-VNDR.                                    07274018
072800                                                                  07280000
072900     INITIALIZE  DCLTPURCHS                                       07290000
073200                 DCLTAPCNTL                                       07320000
073300                 DCLTAPVNDS.                                      07330000
073310*                DCLTPOAGMT                                       07331003
073320*                DCLTPAYTRM                                       07332003
073400                                                                  07340000
073500*    PERFORM R100-READ-INPUT UNTIL WS-LIFUNG OR WS-END-OF-INPUT.  07350021
073500     PERFORM R100-READ-INPUT                                      07351021
073500        UNTIL WS-GOOD-VNDR OR WS-END-OF-INPUT.                    07352021
073600                                                                  07360000
073700     IF WS-END-OF-INPUT                                           07370000
073800        DISPLAY '***********************************************' 07380000
073900        DISPLAY '* NO MERCHANDISE INVOICES WERE FOUND          *' 07390028
074000        DISPLAY '* TO CREATE COMMISSION EXPENSE INVCS          *' 07390128
073900*       DISPLAY '* NO LI & FUNG MERCHANDISE INVOICES WERE FOUND*' 07391028
074000*       DISPLAY '* TO CREATE LI & FUNG COMMISSION EXPENSE INVCS*' 07400028
074100        DISPLAY '* WITH FOR THIS JOB RUN.                      *' 07410000
074200        DISPLAY '***********************************************' 07420000
074300     END-IF.                                                      07430000
074400                                                                  07440000
074500*    PERFORM R300-READ-TENTNME.                                   07450022
074600                                                                  07460000
074700     PERFORM R400-READ-TAPCNTL.                                   07470000
074800     DISPLAY '*** BATCH PRC DATE: ' APCNTL-BTCH-PRC-DTE.          07480003
074900     DISPLAY '*** POSTING YEAR:' APCNTL-CURR-PSTG-FYR-NBR.        07490003
074910     DISPLAY '*** POSTING MONTH:' APCNTL-CURR-PSTG-FMN-NBR.       07491003
074920     DISPLAY '*** POSTING WEEK:' APCNTL-CURR-PSTG-FWK-NBR.        07492003
075000     DISPLAY '*** NEXT PRC DATE: ' APCNTL-NEXT-BTCH-PRC-DTE.      07500000
075100                                                                  07510000
075200*    PERFORM R410-GET-VND-FLOAT-DAY.                              07520023
075300                                                                  07530000
075301     SET PV-PER-IDX TO 1.                                         07530103
075310     INITIALIZE PV-TRUEUP-RATE(PV-PER-IDX).                       07531003
075311     SET PV-PER-IDX TO 2.                                         07531103
075312     INITIALIZE PV-TRUEUP-RATE(PV-PER-IDX).                       07531203
075320                                                                  07532003
075400     SET PV-PER-IDX TO 1.                                         07540001
075500                                                                  07550001
075560     MOVE '20210701' TO PV-EFF-BEG-DTE(PV-PER-IDX).               07556001
075570     MOVE '20220531' TO PV-EFF-END-DTE(PV-PER-IDX).               07557009
075580     MOVE 0.0060     TO PV-TRUEUP-PERCENT(PV-PER-IDX).            07558003
075593     DISPLAY '*** TRUEUP PERCENT ***'                             07559303
075594     DISPLAY '1 - BEG '  PV-EFF-BEG-DTE(PV-PER-IDX).              07559409
075595     DISPLAY '1 - END '  PV-EFF-END-DTE(PV-PER-IDX).              07559509
075596     DISPLAY '1 - RATE ' PV-TRUEUP-PERCENT(PV-PER-IDX).           07559609
075600                                                                  07560000
075400     SET PV-PER-IDX TO 2.                                         07561009
075500                                                                  07562009
075560     MOVE '20220601' TO PV-EFF-BEG-DTE(PV-PER-IDX).               07563009
075570     MOVE '99990909' TO PV-EFF-END-DTE(PV-PER-IDX).               07564009
075580     MOVE 0.0100     TO PV-TRUEUP-PERCENT(PV-PER-IDX).            07565009
075593     DISPLAY '*** TRUEUP PERCENT ***'                             07566009
075594     DISPLAY '2 - BEG '  PV-EFF-BEG-DTE(PV-PER-IDX).              07567009
075595     DISPLAY '2 - END '  PV-EFF-END-DTE(PV-PER-IDX).              07568009
075596     DISPLAY '2 - RATE ' PV-TRUEUP-PERCENT(PV-PER-IDX).           07569009
075600                                                                  07569109
075700*                                                                 07570000
075800***************************************************************** 07580000
075900*  CREATE THE PARTS THAT MAKE UP THE EXPENSE LOAD RECORD.         07590000
076000***************************************************************** 07600000
076100*                                                                 07610000
076200 B200-CREATE-EXPENSE-LOAD-REC.                                    07620000
076300                                                                  07630000
076400                                                                  07640000
076500     PERFORM C100-CHECK-RECORD-TYPES                              07650000
076600       UNTIL WS-NOT-GOOD-VNDR                                     07661026
076600*      UNTIL WS-NOT-LIFUNG                                        07662026
076700          OR WS-END-OF-INPUT.                                     07670000
076800                                                                  07680000
076900     PERFORM R100-READ-INPUT                                      07690000
077000       UNTIL WS-GOOD-VNDR                                         07701021
077000*      UNTIL WS-LIFUNG                                            07702026
077100          OR WS-END-OF-INPUT.                                     07710000
077200                                                                  07720000
077300*                                                                 07730000
077400***************************************************************** 07740000
077500*  END OF PROGRAM PROCESSING.                                     07750000
077600***************************************************************** 07760000
077700*                                                                 07770000
077800 B300-END-OF-JOB.                                                 07780000
077900                                                                  07790000
078000                                                                  07800000
078100     CLOSE INPUT-FILE                                             07810000
078100           VENDOR-FILE                                            07811020
078200           OUTPUT-FILE                                            07820003
078210           OUTPUT-ADJ-FILE.                                       07821003
078300                                                                  07830000
078400     DISPLAY '---- APKUT221 RECORD COUNTS ----'                   07840000
078500     DISPLAY 'RECORDS READ         = ' WS-INPUT-COUNT.            07850000
078600     DISPLAY 'RECORDS WRITTEN      = ' WS-OUTPUT-COUNT.           07860000
078700     DISPLAY 'ADJ RECORDS WRITTEN  = ' WS-ADJ-OUTPUT-COUNT.       07870000
078800*    DISPLAY 'FOUND INVC TERMS     = ' WS-RECORD4-COUNT.          07880003
078900     DISPLAY 'HARDCODED INVC TERMS = ' WS-HDCODE4-COUNT.          07890003
079000     DISPLAY 'COMM INV NOT WRITTEN = ' WS-NOCOMM-COUNT.           07900000
079100                                                                  07910000
079200*                                                                 07920000
079300***************************************************************** 07930000
079400*  PROCESS THE DIFFERENT RECORD TYPES PER PO/INVOICE.             07940000
079500***************************************************************** 07950000
079600*                                                                 07960000
079700 C100-CHECK-RECORD-TYPES.                                         07970000
079800                                                                  07980000
079900     PERFORM S100-CHECK-VND-ID.                                   07990000
080000                                                                  08000000
080100     IF PV-CHARITY-DEPT OR PV-RELATED-PARTY                       08010000
080100        OR NOT PV-VALID-PO-TYPE                                   08011040
080200*       DISPLAY 'VND-ID C100  ' PV-PARENT                         08020012
080300*       DISPLAY 'DEPT C100    ' PV-DEPT-NBR                       08030012
080400*       DISPLAY 'PO NBR       ' AP052-KOHLS-PO-NBR                08040012
080500*       DISPLAY 'INVC NBR     ' PV-VENDOR-INVOICE-NBR             08050012
080600        IF PV-CHARITY-DEPT OR PV-RELATED-PARTY                    08060050
080600            ADD +1 TO WS-NOCOMM-COUNT                             08060148
080600        END-IF                                                    08060249
080600*       ADD +1 TO WS-NOCOMM-COUNT                                 08060348
080700        CONTINUE                                                  08070000
080800     ELSE                                                         08080000
080900         EVALUATE TRUE                                            08090000
081000         WHEN AP052-INV-INTRCHG                                   08100000
081100              PERFORM M100-MOVE-TPAYREQ-FIELDS                    08110000
081200         WHEN AP052-INV-INVOICE-DATA                              08120000
081300              PERFORM M200-MOVE-TINVOIC-FIELDS                    08130000
081400*        WHEN AP052-INV-TERMS                                     08140000
081500*             PERFORM M300-MOVE-TINVCTM-FIELDS                    08150000
081600*             SET WS-INV-TERMS-CREATED TO TRUE                    08160000
081700         WHEN AP052-INV-SUMMARY                                   08170000
081800*             IF WS-INV-TERMS-NOT-CREATED                         08180003
081900*                PERFORM S200-SELECT-PO-TERMS                     08190003
082000*                PERFORM M300-MOVE-TINVCTM-FIELDS                 08200003
082200*             ELSE                                                08220003
082300*                SET WS-INV-TERMS-NOT-CREATED TO TRUE             08230003
082400*             END-IF                                              08240003
082500              PERFORM M350-HARDCODE-TINVCTM-FIELDS                08250003
082600              PERFORM M400-MOVE-TALCHRG-FIELDS                    08260000
082700*             TRUE UP IS ONLY FOR IMPORT VENDOR (LI & FUNG)       08270029
082700              IF WS-IMPORT-VNDR                                   08270129
082610                  PERFORM M390-SEARCH-TRUEUP-TABLE                08270244
082700                  IF WS-TRUEUP-FND                                08271029
082800                      PERFORM M410-MOVE-APRD045-FIELDS            08280029
082900                      PERFORM M420-WRITE-APRD045-ADJ-RECORD       08290029
083000                  END-IF                                          08300029
083000              END-IF                                              08300129
082610*             PERFORM M390-SEARCH-TRUEUP-TABLE                    08301029
082700*             IF WS-TRUEUP-FND                                    08302029
082800*                 PERFORM M410-MOVE-APRD045-FIELDS                08303029
082900*                 PERFORM M420-WRITE-APRD045-ADJ-RECORD           08304029
083000*             END-IF                                              08305029
083100              PERFORM W100-WRITE-OUTPUT                           08310000
083200         END-EVALUATE                                             08320000
083300     END-IF.                                                      08330000
083400                                                                  08340000
083500     PERFORM R100-READ-INPUT.                                     08350000
083600                                                                  08360000
083700*                                                                 08370000
083800*----------------------------------------------------------------*08380000
083900*  MOVE FIELDS TO THE TPAYREQ PORTION OF THE LOAD RECORD.         08390000
084000*----------------------------------------------------------------*08400000
084100*                                                                 08410000
084200 M100-MOVE-TPAYREQ-FIELDS.                                        08420000
084300                                                                  08430000
084400     INITIALIZE AP016-INVOICE-LOAD-RECORD.                        08440000
084500     MOVE PV-PAY-VENDOR (PV-VND-IDX)                              08450029
084500                                  TO AP016-REMIT-TO-DUN-NBR.      08450129
084500*    MOVE AP052-EXTENT-DUN-NBR    TO AP016-REMIT-TO-DUN-NBR.      08451029
084600     MOVE AP052-KOHLS-PO-NBR      TO AP016-PO-NBR.                08460000
084700                                                                  08470000
084800*                                                                 08480000
084900*----------------------------------------------------------------*08490000
085000*  MOVE FIELDS TO THE TINVOIC PORTION OF THE LOAD RECORD.         08500000
085100*----------------------------------------------------------------*08510000
085200*                                                                 08520000
085300 M200-MOVE-TINVOIC-FIELDS.                                        08530000
085400                                                                  08540000
085500     PERFORM N100-FORMAT-INVOICE-NBR.                             08550000
085600     MOVE PV-VENDOR-INVOICE-NBR    TO AP016-INVC-ID.              08560000
085700     MOVE AP052-INVOICE-DATE       TO PV-INVOICE-DATE.            08570000
085800     IF PV-INVOICE-DATE-YY > 80                                   08580000
085900        MOVE '19' TO PV-INVC-DTE-CC                               08590000
086000     ELSE                                                         08600000
086100        MOVE '20' TO PV-INVC-DTE-CC                               08610000
086200     END-IF.                                                      08620000
086300     MOVE PV-INVOICE-DATE-YY       TO PV-INVC-DTE-YY.             08630000
086400     MOVE PV-INVOICE-DATE-MM       TO PV-INVC-DTE-MM.             08640000
086500     MOVE PV-INVOICE-DATE-DD       TO PV-INVC-DTE-DD.             08650000
086600     MOVE '-'                      TO PV-DASH-1                   08660000
086700                                      PV-DASH-2.                  08670000
086800     MOVE PV-INVC-DTE              TO AP016-INVC-DTE              08680000
086900                                      APPD051-INVOICE-DATE.       08690000
087000     MOVE AP052-INVC-HOLD-IND      TO AP016-HOLD-IND.             08700000
087100     MOVE 'EE'                     TO AP016-ENTR-MTHD-CDE.        08710000
087200     MOVE 'EN'                     TO AP016-STATUS-CDE.           08720000
087300                                                                  08730000
087400*    IF AP016-TERM-TYP-CDE = '02'                                 08740003
087500*        SET WS-END-MONTH TO TRUE                                 08750003
087600*    ELSE                                                         08760003
087700*        SET WS-NOT-END-MONTH TO TRUE                             08770003
087800*    END-IF.                                                      08780003
087900*                                                                 08790003
088000*                                                                 08800000
088100*----------------------------------------------------------------*08810000
088200*  MOVE FIELDS TO THE TINVCTM PORTION OF THE LOAD RECORD.         08820000
088300*----------------------------------------------------------------*08830000
088400*                                                                 08840000
088500*M300-MOVE-TINVCTM-FIELDS.                                        08850003
088600*                                                                 08860003
088700*    MOVE '01'               TO AP016-TERM-TYP-CDE.               08870003
088800*    MOVE '03'               TO AP016-TERM-BASIS-DTE-CDE.         08880003
088900*    MOVE PAYTRM-DUE-DAY-QTY TO AP016-NET-DUE-DAY-QTY             08890003
089000*                               APPD051-DISCOUNT-DAYS.            08900003
089100*                                                                 08910003
089200*    ADD 1 TO WS-RECORD4-COUNT.                                   08920003
089300*                                                                 08930003
089400*                                                                 08940000
089500*----------------------------------------------------------------*08950000
089600*  MOVE HARDCODED VALUES TO THE TINVCTM PORTION OF THE LOAD       08960000
089700*  RECORD WHEN THERE IS NO INVOICE TERMS RECORD FOUND FOR THE     08970000
089800*  INVOICE IN THE INPUT FILE.                                     08980000
089900*                                                                 08990000
090010* REINSTATED FOR COMMISSION CHANGES 2021 - TERMS CHANGED TO NET30 09001003
090020*   AND THIS PARAGRAPH IS NOW USED FOR EVERY COMMISSION INVOICE.  09002003
090030*   INVOICES FOR POS PRIOR TO 7/1/21 STILL GET THE STANDARD L&F   09003007
090040*   TERMS OF NET 60.                                              09004007
090100*----------------------------------------------------------------*09010000
090200*                                                                 09020000
090300 M350-HARDCODE-TINVCTM-FIELDS.                                    09030003
090400                                                                  09040003
090500     MOVE '01' TO AP016-TERM-TYP-CDE.                             09050003
090600     MOVE '03' TO AP016-TERM-BASIS-DTE-CDE.                       09060003
090610     IF PLNSHP-LAST-FCTRY-DTE < '2021-07-01'                      09061007
090700        MOVE +60  TO AP016-NET-DUE-DAY-QTY                        09070007
090710                     APPD051-DISCOUNT-DAYS                        09071007
090711     ELSE                                                         09071107
090720        MOVE +30  TO AP016-NET-DUE-DAY-QTY                        09072007
090730                     APPD051-DISCOUNT-DAYS                        09073007
090740     END-IF.                                                      09074007
090711     IF WS-VNDR-AGENT                                             09075061
090720        MOVE +30  TO AP016-NET-DUE-DAY-QTY                        09076061
090730                     APPD051-DISCOUNT-DAYS                        09077061
090740     END-IF.                                                      09078061
090800     ADD 1 TO WS-HDCODE4-COUNT.                                   09080003
090900                                                                  09090003
091000                                                                  09100000
091100*----------------------------------------------------------------*09110000
091200*  SEE IF THERE IS A TRUE UP RATE BY COMPARING THE ORDER DATE     09120008
091300*  ON THE PO TABLE TO WHAT IS ON THE CONTROL FILE.  IF THE        09130000
091400*  DATE FROM THE PO IS BETWEEN THE BEG AND END DATE ON THE CONTROL09140000
091500*  FILE USE THE TRUE UP RATE.  A RECORD WILL BE WRITTEN OUT TO THE09150008
091600*  APRD045 FILE IF THE DATES ARE IN THE RATE TABLE.               09160008
091700*----------------------------------------------------------------*09170000
091800 M390-SEARCH-TRUEUP-TABLE.                                        09180003
091900                                                                  09190000
092000     SET PV-PER-IDX TO 1.                                         09200000
092100     SEARCH PV-TRUEUP-RATE                                        09210003
092200        AT END SET WS-TRUEUP-NOT-FND TO TRUE                      09220003
092300        WHEN PV-PO-COMP-DTE >= PV-EFF-BEG-DTE(PV-PER-IDX) AND     09230000
092400             PV-PO-COMP-DTE <= PV-EFF-END-DTE(PV-PER-IDX)         09240000
092500          SET WS-TRUEUP-FND TO TRUE                               09250003
092600          COMPUTE PV-ADJ-AMT = (AP052-DISCOUNTED-AMT-DUE *        09260004
092700                     PV-TRUEUP-PERCENT(PV-PER-IDX)) + .005        09270004
092900*         DISPLAY 'PO NUMBER ' AP052-KOHLS-PO-NBR                 09290065
093000*         DISPLAY 'DISC AMT ' AP052-DISCOUNTED-AMT-DUE            09300065
093100*         DISPLAY 'PERCENT ' PV-TRUEUP-PERCENT(PV-PER-IDX)        09310065
093110*         MOVE PV-ADJ-AMT TO PV-ADJ-AMT-DISP                      09311065
093120*         DISPLAY 'TRUE UP AMT ' PV-ADJ-AMT-DISP                  09312065
093200     END-SEARCH.                                                  09320000
093300                                                                  09330000
093400     IF PV-EFF-BEG-DTE (PV-PER-IDX) >                             09340000
093500        PV-EFF-END-DTE (PV-PER-IDX)                               09350000
093600        DISPLAY 'START DATE > END DATE '                          09360000
093700           PV-EFF-BEG-DTE (PV-PER-IDX) '  '                       09370000
093800           PV-EFF-END-DTE (PV-PER-IDX)                            09380000
093900     END-IF.                                                      09390000
094000                                                                  09400000
094100*----------------------------------------------------------------*09410000
094200*  MOVE FIELDS TO THE TALCHRG PORTION OF THE LOAD RECORD.         09420000
094300*----------------------------------------------------------------*09430000
094400*                                                                 09440000
094500 M400-MOVE-TALCHRG-FIELDS.                                        09450000
094600                                                                  09460000
094700                                                                  09470000
094800     MOVE 'C'                       TO AP016-ALW-CHRG-TYP-CDE(1). 09480000
094900     IF WS-IMPORT-VNDR                                            09490029
094900         MOVE 'IAC'                 TO AP016-ALW-CHRG-CDE(1)      09490129
095100         EVALUATE TRUE                                            09490246
095200            WHEN PLNSHP-LAST-FCTRY-DTE >= '2019-02-01'            09490346
095300                COMPUTE AP016-ALW-CHRG-AMT(1) =                   09490446
095400                    (AP052-DISCOUNTED-AMT-DUE * .035) + .005      09490546
095600            WHEN PLNSHP-LAST-FCTRY-DTE <  '2019-02-01'            09490746
095700                COMPUTE AP016-ALW-CHRG-AMT(1) =                   09490846
095800                    (AP052-DISCOUNTED-AMT-DUE * .05) + .005       09490946
094900         END-EVALUATE                                             09491046
094900     ELSE                                                         09491146
094900         MOVE 'LCC'                 TO AP016-ALW-CHRG-CDE(1)      09491246
094900         COMPUTE PV-CALC-PCT = PV-COMM-PCT(PV-VND-IDX) / 100      09491362
095700         COMPUTE AP016-ALW-CHRG-AMT(1) =                          09491462
095800             (AP052-DISCOUNTED-AMT-DUE * PV-CALC-PCT) + .005      09491562
094900     END-IF.                                                      09491762
096200     MOVE AP016-ALW-CHRG-AMT(1)     TO AP016-INVC-NET-COST-AMT.   09491862
095000                                                                  09491962
094900*    MOVE 'IAC'                     TO AP016-ALW-CHRG-CDE(1).     09492029
095100*    EVALUATE TRUE                                                09510046
095200*        WHEN PLNSHP-LAST-FCTRY-DTE >= '2019-02-01'               09520046
095300*     COMPUTE AP016-ALW-CHRG-AMT(1) =                             09530046
095400*            (AP052-DISCOUNTED-AMT-DUE * .035) + .005             09540046
095500*                                                                 09550046
095600*        WHEN PLNSHP-LAST-FCTRY-DTE <  '2019-02-01'               09560046
095700*     COMPUTE AP016-ALW-CHRG-AMT(1) =                             09570046
095800*            (AP052-DISCOUNTED-AMT-DUE * .05) + .005              09580046
095900*                                                                 09590046
096000*    END-EVALUATE.                                                09600046
096100                                                                  09610000
096300                                                                  09630000
096400*----------------------------------------------------------------*09640000
096500*  MOVE FIELDS TO LAYOUT APRD045 WHEN AN ADJUSTMENT ENTRY NEEDS   09650000
096600*  TO BE POSTED FOR THE TRUEUP AMOUNT                             09660003
096700*----------------------------------------------------------------*09670000
096800 M410-MOVE-APRD045-FIELDS.                                        09680000
096900                                                                  09690000
097000     INITIALIZE AP045-TRANSACTION-FILE.                           09700000
097100     INITIALIZE AP045-DETAIL-FIELDS.                              09710000
097200                                                                  09720000
097300     MOVE '9T'                       TO AP045-AP-TRN-CDE.         09730000
097400     SET AP045-DETAIL-RECORD         TO TRUE.                     09740000
097500     MOVE PV-VENDOR-ID (PV-VND-IDX)  TO AP045-VND-NBR.            09751036
097500*    MOVE PV-LIFUNG                  TO AP045-VND-NBR.            09752029
097600     MOVE 'CR'                       TO AP045-PSTG-TYP-CDE.       09760000
097700     MOVE 'EXP'                      TO AP045-TRN-TYP-CDE.        09770000
097800     PERFORM M500-FORMAT-DOC-NO.                                  09780000
097900     MOVE PV-INVC-DTE                TO AP045-DOC-DTE.            09790000
098000                                                                  09800000
098100* THE INVOICE NUMBER AND PO THAT IS RELATED TO THE ADJUSTMENT     09810000
098200* AND COMMISSION TRUEUP IS MOVED TO THE REASON TEXT IN APRD045.   09820003
098300* PV-STRING HOLDS THE INVOICE NUMBER THAT WAS MOVED THERE IN      09830000
098400* PARAGRAPH M500-FORMAT-DOC-NO. PV-START HOLDS THE BEGINNING      09840000
098500* COLUMN NUMBER AND PV-START2 HOLDS THE ENDING COLUMN OF THE      09850000
098600* INVOICE NUMBER.                                                 09860000
098700                                                                  09870000
098800     MOVE PV-STRING(PV-START:PV-START2) TO PV-RSN-INV-NBR.        09880000
098900     MOVE AP016-PO-NBR               TO PV-RSN-PO-NBR             09890000
099000                                        AP045-PO-NBR.             09900000
099100     MOVE PV-REASON-DESC             TO AP045-RSN-1ST-LNE-TXT.    09910000
099200                                                                  09920000
099300     MOVE PV-BTCH-DTE                TO AP045-PS-BTCH-DTE.        09930000
099400     MOVE 'IMP'                      TO AP045-PS-BTCH-SRC-CDE.    09940000
099500     MOVE '00'                       TO AP045-PS-BTCH-SEQ-NBR.    09950000
099600     MOVE 90                         TO AP045-STR-NBR.            09960000
099700     MOVE SPACES                     TO AP045-DEPT-NBR.           09970000
099800     MOVE '10448'                    TO AP045-GL-ACCT-NBR.        09980005
099900     MOVE 'APKUT221'                 TO AP045-ENTR-ID.            09990000
100000     MOVE 'A'                        TO AP045-ORGN-CDE.           10000000
100100     MOVE APCNTL-NEXT-BTCH-PRC-DTE   TO AP045-ENTR-DTE.           10010000
100200     ACCEPT PV-TIME-OF-DAY           FROM TIME.                   10020000
100300     MOVE PV-DAY-HOUR                TO PV-TIME-HOUR.             10030000
100400     MOVE PV-DAY-MINUTE              TO PV-TIME-MINUTE.           10040000
100500     MOVE PV-DAY-SECOND              TO PV-TIME-SECOND.           10050000
100600     MOVE PV-TIME                    TO AP045-ENTR-TME.           10060000
100700     MOVE SPACES                     TO AP045-BAR-CDE.            10070000
100800     MOVE ENTNME-ENT-NAME-DESC       TO AP045-ENT-NME-DESC.       10080000
100900     MOVE EXTENT-ENT-ID              TO AP045-ENT-ID.             10090000
101000     PERFORM M550-GET-PAYT-DUE-DATE.                              10100000
101100     MOVE PV-DUE-DATE-CCYY-MM-DD     TO AP045-PYMT-DUE-DTE.       10110000
101200     MOVE PV-CURRENT-DATE            TO AP045-INV-CUTOFF-DTE      10120000
101300     MOVE APCNTL-CURR-PSTG-FYR-NBR   TO AP045-PSTG-FYR-NBR.       10130000
101400     MOVE APCNTL-CURR-PSTG-FMN-NBR   TO AP045-PSTG-FMN-NBR.       10140000
101500     MOVE APCNTL-CURR-PSTG-FWK-NBR   TO AP045-PSTG-FWK-NBR.       10150000
101600                                                                  10160000
101700     MOVE PV-ADJ-AMT                 TO AP045-NET-COST-AMT        10170000
101800                                        AP045-GRO-COST-AMT.       10180000
101900     IF AP045-NET-COST-AMT > 0                                    10190000
102000        MULTIPLY -1 BY AP045-NET-COST-AMT                         10200000
102100     END-IF.                                                      10210000
102200     IF AP045-GRO-COST-AMT > 0                                    10220000
102300        MULTIPLY -1 BY AP045-GRO-COST-AMT                         10230000
102400     END-IF.                                                      10240000
102500                                                                  10250000
102600     MOVE ZEROS                      TO AP045-TERM-DISC-PCT       10260000
102700                                        AP045-NW-STR-DISC-PCT     10270000
102800                                        AP045-TRD-DISC-PCT        10280000
102900                                        AP045-FRGT-AMT            10290000
103000                                        AP045-MISC-CHRG-AMT       10300000
103100                                        AP045-MOS-DISC-PCT.       10310000
103200                                                                  10320000
103300*----------------------------------------------------------------*10330000
103400*  WRITE THE APRD045 RECORD FOR THE ADJUSTMENT ENTRY FOR THE      10340000
103500*  TRUEUP AMOUNT                                                  10350003
103600*----------------------------------------------------------------*10360000
103700 M420-WRITE-APRD045-ADJ-RECORD.                                   10370000
103800                                                                  10380000
103900     WRITE OUTPUT-ADJ-RECORD FROM AP045-TRANSACTION-FILE.         10390000
104000                                                                  10400000
104100     ADD 1 TO WS-ADJ-OUTPUT-COUNT.                                10410000
104200                                                                  10420000
104300*----------------------------------------------------------------*10430000
104400*  THIS PARAGRAPH FORMATS THE INVOICE ID TO BE THE PJ DOC NUMBER. 10440000
104500*----------------------------------------------------------------*10450000
104600 M500-FORMAT-DOC-NO.                                              10460000
104700                                                                  10470000
104800     MOVE ZEROES                   TO PV-START PV-START2.         10480000
104900     MOVE SPACES                   TO PV-STRING.                  10490000
105000     MOVE AP052-VENDOR-INVOICE-NBR TO PV-STRING.                  10500000
105100     MOVE LENGTH OF PV-STRING      TO PV-START.                   10510000
105200                                                                  10520000
105300     PERFORM                                                      10530000
105400        UNTIL PV-STRING(PV-START:1) > SPACES OR                   10540000
105500              PV-START = +0                                       10550000
105600        COMPUTE PV-START = PV-START - 1                           10560000
105700                                                                  10570000
105800     END-PERFORM.                                                 10580000
105900                                                                  10590000
106000     MOVE PV-START TO PV-START2.                                  10600000
106100                                                                  10610000
106200     IF PV-START < 13                                             10620000
106300        MOVE +1 TO PV-START                                       10630000
106400     ELSE                                                         10640000
106500        SUBTRACT +12 FROM PV-START                                10650000
106600     END-IF.                                                      10660000
106700                                                                  10670000
106800     IF PV-START2 = 22                                            10680000
106900        COMPUTE PV-START2 = PV-START2 - 9                         10690000
107000     END-IF.                                                      10700000
107100     IF PV-START2 = 21                                            10710000
107200        COMPUTE PV-START2 = PV-START2 - 8                         10720000
107300     END-IF.                                                      10730000
107400     IF PV-START2 = 20                                            10740000
107500        COMPUTE PV-START2 = PV-START2 - 7                         10750000
107600     END-IF.                                                      10760000
107700     IF PV-START2 = 19                                            10770000
107800        COMPUTE PV-START2 = PV-START2 - 6                         10780000
107900     END-IF.                                                      10790000
108000     IF PV-START2 = 18                                            10800000
108100        COMPUTE PV-START2 = PV-START2 - 5                         10810000
108200     END-IF.                                                      10820000
108300     IF PV-START2 = 17                                            10830000
108400        COMPUTE PV-START2 = PV-START2 - 4                         10840000
108500     END-IF.                                                      10850000
108600     IF PV-START2 = 16                                            10860000
108700        COMPUTE PV-START2 = PV-START2 - 3                         10870000
108800     END-IF.                                                      10880000
108900     IF PV-START2 = 15                                            10890000
109000        COMPUTE PV-START2 = PV-START2 - 2                         10900000
109100     END-IF.                                                      10910000
109200     IF PV-START2 = 14                                            10920000
109300        COMPUTE PV-START2 = PV-START2 - 1                         10930000
109400     END-IF.                                                      10940000
109500                                                                  10950000
109600     MOVE PV-STRING(PV-START:PV-START2) TO AP045-DOC-NBR.         10960000
109700     MOVE 'CTU'        TO AP045-DOC-NBR(PV-START2 + 1:3).         10970003
109800                                                                  10980000
109900***************************************************************** 10990000
110000*    CALLS ROUTINES TO CALCULATE THE PAYMENT DUE DATE AND         11000000
110100*   REFORMAT THE DATE INTO DB2 ISO DATE FORMAT                    11010000
110200***************************************************************** 11020000
110300 M550-GET-PAYT-DUE-DATE.                                          11030000
110400                                                                  11040000
110500     MOVE WS-END-MONTH-SW            TO APPD051-EOM-IND.          11050000
110600                                                                  11060000
110700     IF PV-FLOAT-IND (PV-VND-IDX) = 'Y'                           11070027
110800        MOVE PV-FLOAT-DAYS(PV-VND-IDX) TO APPD051-FLOAT-DAYS      11070163
110900     ELSE                                                         11070263
111100        MOVE APCNTL-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS      11070363
111300     END-IF.                                                      11070463
110700*    IF TAPVNDS-FLOAT-DAY-FOUND                                   11071027
110800*       MOVE APVNDS-PAYT-FLOAT-DAY-QTY TO APPD051-FLOAT-DAYS      11080063
110900*    ELSE                                                         11090063
111000*       IF TAPVNDS-FLOAT-DAY-NOT-FOUND                            11100027
111200*       END-IF                                                    11120027
111300*    END-IF.                                                      11130063
111400                                                                  11140000
111500     PERFORM M560-CALC-DUE-DATE.                                  11150000
111600                                                                  11160000
111700     MOVE APPD051-RETURN-DATE-CCYY-MM-DD TO                       11170000
111800           PV-DUE-DATE-CCYY-MM-DD.                                11180000
111900                                                                  11190000
112000***************************************************************** 11200000
112100*    CALCULATES THE PAYMENT DUE DATE.                             11210000
112200***************************************************************** 11220000
112300 M560-CALC-DUE-DATE.                                              11230000
112400                                                                  11240000
112500     PERFORM CALC-PAYMENT-DUE-DATE.                               11250000
112600                                                                  11260000
112700     COPY APPD051.                                                11270000
112800                                                                  11280000
112900*----------------------------------------------------------------*11290000
113000*  FORMAT THE INVOICE ID FOR THE LOAD RECORD.                     11300000
113100*----------------------------------------------------------------*11310000
113200*                                                                 11320000
113300 N100-FORMAT-INVOICE-NBR.                                         11330000
113400                                                                  11340000
113500     MOVE SPACES TO PV-VENDOR-INVOICE-NBR.                        11350000
113600     STRING AP052-VENDOR-INVOICE-NBR                              11360000
113700             DELIMITED BY '  '                                    11370000
113800            'C'                                                   11380000
113900             DELIMITED BY SIZE                                    11390000
114000            INTO PV-VENDOR-INVOICE-NBR.                           11400000
114100                                                                  11410000
114200*                                                                 11420000
114300***************************************************************** 11430000
114400*  READ THE INPUT FILE.                                           11440000
114500***************************************************************** 11450000
114600*                                                                 11460000
114700 R100-READ-INPUT.                                                 11470000
114800                                                                  11480000
114900     READ INPUT-FILE INTO WS-INPUT-REC                            11490000
115000          AT END                                                  11500000
115100             SET WS-END-OF-INPUT TO TRUE.                         11510000
115200                                                                  11520000
115300     IF WS-NOT-END-OF-INPUT                                       11530000
115400        ADD 1 TO WS-INPUT-COUNT                                   11540000
115500     END-IF.                                                      11550000
115600                                                                  11560000
115800     IF AP052-INV-INTRCHG                                         11671021
115700        SET WS-NOT-GOOD-VNDR     TO TRUE                          11672045
115700        SET WS-VNDR-NOT-IN-TABLE TO TRUE                          11672145
115900        PERFORM VARYING PV-VND-IDX FROM 1 BY 1                    11673058
115900*       PERFORM WITH TEST AFTER                                   11673158
115900*          VARYING PV-VND-IDX FROM 1 BY 1                         11673258
116000           UNTIL PV-VND-IDX > 20                                  11674021
116100           OR PV-VENDOR-ID(PV-VND-IDX) = SPACES                   11675021
116100           OR WS-VNDR-IN-TABLE                                    11675139
116200              IF AP052-EXTENT-DUN-NBR = PV-VENDOR-ID(PV-VND-IDX)  11676021
116200                  SET WS-VNDR-IN-TABLE     TO TRUE                11676139
116200                  IF PV-VNDR-TYP(PV-VND-IDX) = 'I'                11676239
116200                      SET WS-IMPORT-VNDR   TO TRUE                11676339
116300                  ELSE                                            11677021
116400                      SET WS-VNDR-AGENT    TO TRUE                11678029
116500                  END-IF                                          11679021
116000               MOVE AP052-PURCH-DEPT-NBR   TO PV-DEPT-NBR         11679129
116100               MOVE AP052-KOHLS-PO-NBR     TO PURCHS-PO-NBR       11679229
116500              END-IF                                              11679321
116500        END-PERFORM                                               11679521
116500        SET PV-VND-IDX DOWN BY 1                                  11679660
116600     END-IF.                                                      11679759
116700                                                                  11679859
115800*    IF AP052-INV-INTRCHG                                         11679959
      *       DISPLAY AP052-EXTENT-DUN-NBR ' ' AP052-KOHLS-PO-NBR       11680059
115900*       IF AP052-EXTENT-DUN-NBR = '009206194'                     11680159
116200*          SET WS-LIFUNG TO TRUE                                  11680259
116300*       ELSE                                                      11680359
116400*          SET WS-NOT-LIFUNG TO TRUE                              11680459
116500*       END-IF                                                    11680559
116600*    END-IF.                                                      11680659
116700                                                                  11680759
114300***************************************************************** 11681018
114400*  READ THE VENDOR FILE.                                          11690018
114500***************************************************************** 11700018
114600*                                                                 11710018
114700 R200-READ-VNDR.                                                  11720018
114800                                                                  11730018
114900     READ VENDOR-FILE INTO AP026-VENDORS-WITH-AGENTS              11740019
115000          AT END                                                  11750018
115100             SET WS-END-OF-VNDR TO TRUE.                          11760018
115200                                                                  11770018
115300     IF WS-NOT-END-OF-VNDR                                        11780018
115400        ADD 1 TO WS-VNDR-COUNT                                    11790018
115500        MOVE AP026-VENDOR-ID TO PV-VNDR-NBR                       11790122
074500        PERFORM R300-READ-TENTNME                                 11790222
074500        PERFORM R410-GET-VND-FLOAT-DAY                            11790323
115400        PERFORM R250-LOAD-VNDR-TBL                                11791018
115500     END-IF.                                                      11800018
115600                                                                  11810018
115700                                                                  11820018
119300***************************************************************** 11930000
119400*  LOAD THE VENDORS INTO AN INTERNAL TABLE                        11940018
119600***************************************************************** 11960000
119700*                                                                 11970000
119800 R250-LOAD-VNDR-TBL.                                              11980018
115500     MOVE AP026-VENDOR-ID        TO PV-VENDOR-ID (PV-VND-IDX).    11980636
115500     MOVE AP026-PAYABLE-VENDOR   TO PV-PAY-VENDOR(PV-VND-IDX).    11980736
115500     MOVE AP026-COMMISSION-PCT   TO PV-COMM-PCT  (PV-VND-IDX).    11980836
115500     MOVE AP026-VENDOR-TYPE      TO PV-VNDR-TYP  (PV-VND-IDX).    11980936
115500     MOVE EXTENT-ENT-ID          TO PV-ENT-ID    (PV-VND-IDX).    11981131
115500     MOVE ENTNME-ENT-NAME-DESC   TO PV-ENT-NAME  (PV-VND-IDX).    11981231
128500     IF TAPVNDS-FLOAT-DAY-FOUND                                   11981331
115500         MOVE APVNDS-PAYT-FLOAT-DAY-QTY                           11981431
115500                                 TO PV-FLOAT-DAYS(PV-VND-IDX)     11981531
115500         MOVE 'Y'                TO PV-FLOAT-IND (PV-VND-IDX)     11981631
128500     ELSE                                                         11981731
115500         MOVE 'N'                TO PV-FLOAT-IND (PV-VND-IDX)     11981827
128500     END-IF.                                                      11981927
115500     SET PV-VND-IDX UP BY 1.                                      11982027
115600                                                                  11982127
115700                                                                  11982218
119300***************************************************************** 11983018
119400*  RETREIVES THE VENDOR DUNN NUMBER, ENT ID,                      11984018
119500*  AND ENT NAME FOR THE VENDOR BEING PROCESSED                    11985023
119600***************************************************************** 11986018
119700*                                                                 11987018
119800 R300-READ-TENTNME.                                               11988018
119900     EXEC SQL                                                     11990000
120000         SELECT DISTINCT EE.DUN_NBR                               12000000
120100              , EE.ENT_ID                                         12010000
120200              , NE.ENT_NAME_DESC                                  12020000
120300           INTO :EXTENT-DUN-NBR                                   12030000
120400              , :EXTENT-ENT-ID                                    12040000
120500              , :ENTNME-ENT-NAME-DESC                             12050000
120600           FROM TEXTENT EE                                        12060000
120700              , TENTNME NE                                        12070000
120800*         WHERE EE.DUN_NBR = :PV-LIFUNG                           12080022
120800          WHERE EE.DUN_NBR = :PV-VNDR-NBR                         12081022
120900            AND NE.ENT_ID = EE.ENT_ID                             12090000
121000            AND NE.TYPE_CDE = '01'                                12100000
121100     END-EXEC.                                                    12110000
121200                                                                  12120000
121300     EVALUATE TRUE                                                12130000
121400        WHEN SQLCODE = ZERO                                       12140000
121500           SET WS-VENDOR-FND TO TRUE                              12150000
121600*          DISPLAY 'EXTENT-ENT-ID ' EXTENT-ENT-ID                 12160012
121700        WHEN SQLCODE = +100                                       12170000
121800            DISPLAY '*********************'                       12180000
121900            DISPLAY 'SQL +100 FOR TEXTENT '                       12190000
122000*           DISPLAY 'PV-LIFUNG ' PV-LIFUNG                        12200024
122000            DISPLAY 'VENDOR ' PV-VNDR-NBR                         12201024
122100            DISPLAY 'NO EXTENT-ENT-ID '                           12210000
122200            DISPLAY '*********************'                       12220000
122300        WHEN OTHER                                                12230000
122400            SET AC-UNSUCCESSFUL-SELECT TO TRUE                    12240000
122500            MOVE 'R300-READ-TENTNME'     TO AA-PARAGRAPH-NAME     12250000
122600            MOVE 'UNSUCCESSFUL SELECT'   TO AA-DB2-OPERATION      12260000
122700            MOVE 'TEXTENT'               TO AA-DB2-TABLE-1        12270000
122800            MOVE 'TENTNME'               TO AA-DB2-TABLE-2        12280000
122900            PERFORM Z999-DB2-ABEND                                12290000
123000     END-EVALUATE.                                                12300000
123100                                                                  12310000
123200*----------------------------------------------------------------*12320000
123300*    GET WEEKLY BEGIN AND END DATES.                             *12330000
123400*----------------------------------------------------------------*12340000
123500 R400-READ-TAPCNTL.                                               12350000
123600                                                                  12360000
123700     EXEC SQL                                                     12370000
123800         SELECT  BTCH_PRC_DTE                                     12380000
123900                ,CURR_PSTG_FYR_NBR                                12390000
124000                ,CURR_PSTG_FMN_NBR                                12400000
124100                ,CURR_PSTG_FWK_NBR                                12410000
124200                ,PAYT_FLOAT_DAY_QTY                               12420000
124300                ,NEXT_BTCH_PRC_DTE                                12430000
124400           INTO  :APCNTL-BTCH-PRC-DTE                             12440000
124500                ,:APCNTL-CURR-PSTG-FYR-NBR                        12450000
124600                ,:APCNTL-CURR-PSTG-FMN-NBR                        12460000
124700                ,:APCNTL-CURR-PSTG-FWK-NBR                        12470000
124800                ,:APCNTL-PAYT-FLOAT-DAY-QTY                       12480000
124900                ,:APCNTL-NEXT-BTCH-PRC-DTE                        12490000
125000           FROM  TAPCNTL                                          12500000
125100     END-EXEC.                                                    12510000
125200                                                                  12520000
125300     EVALUATE TRUE                                                12530000
125400         WHEN SQLCODE = ZERO                                      12540000
125500             MOVE APCNTL-BTCH-PRC-DTE    TO PV-CURRENT-DATE       12550000
125600                                            PV-BTCH-DTE           12560000
125700         WHEN SQLWARN0 NOT = SPACES                               12570000
125800         WHEN SQLCODE NOT  = ZERO                                 12580000
125900             MOVE 'R400-READ-TAPCNTL' TO AA-PARAGRAPH-NAME        12590003
126100             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       12610003
126300             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                12630000
126400             MOVE SPACES         TO AA-DB2-TABLE-2                12640000
126500             PERFORM Z999-DB2-ABEND                               12650000
126600     END-EVALUATE.                                                12660000
126700                                                                  12670000
126800*----------------------------------------------------------------*12680000
126900*    GET THE VENDOR FLOAT DAYS                                   *12690000
127000*----------------------------------------------------------------*12700000
127100 R410-GET-VND-FLOAT-DAY.                                          12710000
127200                                                                  12720000
127300     EXEC SQL                                                     12730000
127400         SELECT  PAYT_FLOAT_DAY_QTY                               12740000
127500           INTO  :APVNDS-PAYT-FLOAT-DAY-QTY                       12750000
127600           FROM  TAPVNDS                                          12760000
127700           WHERE ENT_ID          = :EXTENT-ENT-ID                 12770000
127800             AND VND_FLT_DAY_IND = 'V'                            12780000
127900     END-EXEC.                                                    12790000
128000                                                                  12800000
128100     EVALUATE TRUE                                                12810000
128200        WHEN SQLCODE = ZERO                                       12820000
128300             MOVE APCNTL-BTCH-PRC-DTE    TO PV-CURRENT-DATE       12830000
128400                                            PV-BTCH-DTE           12840000
128500             SET TAPVNDS-FLOAT-DAY-FOUND  TO TRUE                 12850000
128600         WHEN SQLCODE = +100                                      12860000
128500             SET TAPVNDS-FLOAT-DAY-NOT-FOUND TO TRUE              12861027
128700*            DISPLAY '+100 ON TAPVNDS ' EXTENT-ENT-ID             12870027
128800         WHEN OTHER                                               12880000
128900             MOVE 'R410-GET-VND-FLOAT-DAY' TO AA-PARAGRAPH-NAME   12890003
129100             MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION       12910003
129300             MOVE 'TAPVNDS'      TO AA-DB2-TABLE-1                12930000
129400             MOVE SPACES         TO AA-DB2-TABLE-2                12940000
129500             PERFORM Z999-DB2-ABEND                               12950000
129600     END-EVALUATE.                                                12960000
129700                                                                  12970000
129800*----------------------------------------------------------------*12980000
129900*    GETS IMPRT-VND-ID TO CHECK FOR PARENT COMPANY                12990000
130000*----------------------------------------------------------------*13000000
130100 S100-CHECK-VND-ID.                                               13010000
130200                                                                  13020000
130300     EXEC SQL                                                     13030000
130400         SELECT  IMPRT_VND_ID                                     13040000
130500              ,  ORD_DTE                                          13050000
130600              ,  COALESCE(LAST_FCTRY_DTE,'YYYY-MM-DD')            13060000
130600              ,  PUR.PO_TYP_CDE                                   13061021
130700           INTO  :PURCHS-IMPRT-VND-ID                             13070000
130800              ,  :PURCHS-ORD-DTE                                  13080000
130900              ,  :PLNSHP-LAST-FCTRY-DTE                           13090000
130900              ,  :PURCHS-PO-TYP-CDE                               13091021
131000           FROM  TPURCHS PUR                                      13100000
131100                ,TPLNSHP PLN                                      13110000
131200          WHERE  PUR.PO_NBR         = :PURCHS-PO-NBR              13120000
131300            AND  PUR.PO_NBR         = PLN.PO_NBR                  13130000
131400            AND  PUR.VER_STATUS_CDE = PLN.VER_STATUS_CDE          13140000
131500            AND  PUR.VER_STATUS_CDE = 'A'                         13150000
131600     END-EXEC.                                                    13160000
131700                                                                  13170000
131800     EVALUATE TRUE                                                13180000
131900         WHEN SQLCODE = ZERO                                      13190000
132000*           DISPLAY 'VND-ID ' PURCHS-IMPRT-VND-ID                 13200000
132100            MOVE PURCHS-IMPRT-VND-ID   TO PV-PARENT               13210003
132200            MOVE PLNSHP-LAST-FCTRY-DTE TO PV-PO-COMPARE-DTE       13220003
132200            MOVE PURCHS-PO-TYP-CDE     TO PV-PO-TYPE              13221042
132300            MOVE PV-COMP-CCYY          TO PV-CP-CCYY              13230003
132400            MOVE PV-COMP-MM          TO PV-CP-MM                  13240000
132500            MOVE PV-COMP-DD          TO PV-CP-DD                  13250000
132600                                                                  13260000
132700         WHEN SQLWARN0 NOT = SPACES                               13270000
132800         WHEN SQLCODE NOT  = ZERO                                 13280000
132900            MOVE 'S100-CHECK-VND-ID'   TO AA-PARAGRAPH-NAME       13290000
133000            MOVE 'UNSUCCESSFUL SELECT' TO AA-DB2-OPERATION        13300000
133100            MOVE 'TPURCHS'             TO AA-DB2-TABLE-1          13310000
133200            DISPLAY 'PO NUMBER: ' AP052-KOHLS-PO-NBR              13320000
133300            PERFORM Z999-DB2-ABEND                                13330000
133400                                                                  13340000
133500     END-EVALUATE.                                                13350000
133600                                                                  13360000
133700*----------------------------------------------------------------*13370000
133800*    GETS PAYMENT TERMS FROM THE PURCHASE ORDER TO COPY ONTO      13380000
133900*    THE COMMISSION INVOICE.                                      13390000
134000*----------------------------------------------------------------*13400000
134010*                                                                 13401003
134100*S200-SELECT-PO-TERMS.                                            13410003
134200*                                                                 13420003
134300*    EXEC SQL                                                     13430003
134400*        SELECT PT.DUE_DAY_QTY                                    13440003
134500*          INTO :PAYTRM-DUE-DAY-QTY                               13450003
134600*          FROM TPOAGMT PA                                        13460003
134700*             , TPAYTRM PT                                        13470003
134800*         WHERE PA.PO_NBR         = :PURCHS-PO-NBR                13480003
134900*           AND PA.PAYT_TERM_ID   = PT.PAY_TERM_ID                13490003
135000*           AND PA.AGRMT_TYP_ID   = '2'                           13500003
135100*           AND PA.VER_STATUS_CDE = 'A'                           13510003
135200*    END-EXEC.                                                    13520003
135300*                                                                 13530003
135400*    EVALUATE TRUE                                                13540003
135500*      WHEN SQLCODE = ZERO                                        13550003
135600*        CONTINUE                                                 13560003
135700*      WHEN SQLWARN0 NOT = SPACES                                 13570003
135800*      WHEN SQLCODE  NOT = ZERO                                   13580003
135900*        DISPLAY 'PO NUMBER: ' AP052-KOHLS-PO-NBR                 13590003
136000*        MOVE 'S200-SELECT-PO-TERMS'   TO AA-PARAGRAPH-NAME       13600003
136100*        MOVE 'UNSUCCESSFUL SELECT'    TO AA-DB2-OPERATION        13610003
136200*        MOVE 'TPOAGMT'                TO AA-DB2-TABLE-1          13620003
136300*        MOVE 'TPAYTRM'                TO AA-DB2-TABLE-2          13630003
136400*        PERFORM Z999-DB2-ABEND                                   13640003
136500*    END-EVALUATE.                                                13650003
136600*                                                                 13660003
136700***************************************************************** 13670000
136800*  WRITE THE LOAD RECORD TO THE OUTPUT FILE.                      13680000
136900***************************************************************** 13690000
137000*                                                                 13700000
137100 W100-WRITE-OUTPUT.                                               13710000
137200                                                                  13720000
137300     WRITE OUTPUT-RECORD FROM AP016-INVOICE-LOAD-RECORD.          13730000
137400                                                                  13740000
137500     ADD 1 TO WS-OUTPUT-COUNT.                                    13750000
137600                                                                  13760000
137700*----------------------------------------------------------------*13770000
137800*    DB2 ABEND ROUTINE                                            13780000
137900*----------------------------------------------------------------*13790000
138000 Z999-DB2-ABEND.                                                  13800000
138100                                                                  13810000
138200     CLOSE INPUT-FILE                                             13820000
138400           OUTPUT-FILE                                            13840000
138500           OUTPUT-ADJ-FILE.                                       13850000
138600                                                                  13860000
138700     DISPLAY AA-ABEND-LIT.                                        13870000
138800     DISPLAY AA-MESSAGE-LINE-1.                                   13880000
138900     DISPLAY AA-MESSAGE-LINE-2.                                   13890000
139000     DISPLAY AA-DB2-ERROR-LIT.                                    13900000
139100     DISPLAY AA-PROGRAM-LIT.                                      13910000
139200     DISPLAY AA-PARAGRAPH-LIT.                                    13920000
139300     DISPLAY AA-DB2-OPERATION-LIT.                                13930000
139400     DISPLAY AA-DB2-TABLE-1.                                      13940000
139500     DISPLAY AA-DB2-TABLE-2.                                      13950000
139600     SET AC-DB2-ERROR TO TRUE.                                    13960000
139700                                                                  13970000
139800     COPY DPPD004.                                                13980000
139900                                                                  13990000
140000     CALL 'ILBOABN0' USING ABEND-CODE.                            14000000
140100                                                                  14010000
