000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    SUKCS579.                                         00040000
000500 AUTHOR.        LARRY SCHLEICHER.                                 00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  DEC, 2001.                                        00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    S579 - VENDOR LIST PROGRAM.                                * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF VENDORS.  THE ASSOCIATED  * 00130000
001400*    VENDOR ID, VENDOR NAME AND RANKINGS WILL BE DISPLAYED.  THE* 00140000
001500*    APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR SELECTS   * 00150000
001600*    ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.  NO SELECTION* 00160000
001700*    IS NECESSARY TO ADD A NEW MESSAGE.                         * 00170000
001800*                                                               * 00180000
001900*---------------------------------------------------------------* 00190000
001500*    CHANGES                                                     *        
      *    MADE BY: CHERI PARMLEY        PR#5148D                      *        
      *    DATE:    10/01/2013                                         *        
      *                                                                *        
      *    NEW RANKING COLUMN 'RFID' WAS ADDED TO THE SCREEN FOR RFID  *        
      *    RANKING.  CHANGES CAN BE FOUND WITH *CLP 10/01/13           *        
      *                                                                *        
001600*----------------------------------------------------------------*        
263968* CHANGED 11/15/2021    BY JIM HUNTER      WR: CHG0263968                 
263968* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263968* MAKING THE CALL DYNAMIC VS STATIC.                                      
001130*                                                                         
001110* CHANGED 01/09/2023    BY JEAN KURK       WR: CHG0278099                 
001120* CHANGE CALL OF DPKCS030 TO BE DYNAMIC                                   
263968*---------------------------------------------------------------*         
002000 EJECT                                                            00200000
002100 ENVIRONMENT DIVISION.                                            00210000
002200                                                                  00220000
002300 DATA DIVISION.                                                   00230000
002400                                                                  00240000
002500 WORKING-STORAGE SECTION.                                         00250000
002600                                                                  00260000
002700 01  DK-DB2-KEYS.                                                 00270000
002800     05  DK-ENT-ID                      PIC S9(09)  VALUE ZERO    00280000
002900                                                    COMP.         00290000
003000     05  DK-DEPT-NBR                    PIC  X(04)  VALUE SPACE.  00300000
003100     05  DK-VENDOR-DESC                 PIC  X(30)  VALUE SPACES. 00310000
003200     05  DK-VEND-DESC-BYTE              REDEFINES DK-VENDOR-DESC  00320000
003300                                        OCCURS 30 TIMES           00330000
003400                                        PIC  X(01).               00340000
003500                                                                  00350000
003600 01  PC-PROGRAM-CONSTANTS.                                        00360000
003700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00370000
003800                                                    'SU579A  '.   00380000
003900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00390000
004000                                                    'SUKM579 '.   00400000
004100     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00410000
004200                                                    'SUKCS579'.   00420000
004300     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00430000
004400     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00440000
004500     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00450000
004600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     00460000
004700                                                    COMP SYNC.    00470000
004800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00480000
004900                                                    COMP SYNC.    00490000
005000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00500000
005100                                                    +1000000      00510000
005200                                                    COMP-3.       00520000
005300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00530000
005400                                                    COMP SYNC.    00540000
005500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00550000
005600                                                    COMP-3.       00560000
005700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00570000
005800     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00580000
005900     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00590000
006000     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00600000
006100     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00610000
006200     05  PC-01                          PIC  X(02)  VALUE '01'.   00620000
006300     05  PC-A                           PIC  X(01)  VALUE 'A'.    00630000
006400*                                                                 00640000
006500******************************************************************00650000
006600*          MESSAGE DESCRIPTIONS                                  *00660000
006700******************************************************************00670000
006800* 00005 - INVALID VALUE                                           00680000
006900* 00008 - MUST BE NUMERIC                                         00690000
007000* 00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED     00700000
007100* 00051 - NO END OF RANGE HAS BEEN SPECIFIED                      00710000
007200* 00052 - END OF RANGE PRECEDES START OF RANGE                    00720000
007300* 00053 - NO START OF RANGE HAS BEEN SPECIFIED                    00730000
007400* 00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED      00740000
007500* 00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED        00750000
007600* 00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION          00760000
007700* 00069 - TOP OF LIST                                             00770000
007800* 00070 - BOTTOM OF LIST                                          00780000
007900* 00101 - VALUE MUST BE GREATER THAN ZERO AND LESS THAN 100,000,0000790000
008000* 00279 - MORE ITEMS TO DISPLAY                                   00800000
008100* 02844 - YOU DO NOT HAVE THE AUTHORITY TO UPDATE RANK            00810000
008200* 02885 - CANNOT SELECT A VENDOR THAT HAS NO DEPT. ASSOCIATED IT  00820000
008300* 99901 - INVALID COMMAND WAS ENTERED                             00830000
008400******************************************************************00840000
008500     05  PC-TSYMSG-NUMBERS.                                       00850000
008600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00860000
008700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00870000
008800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00880000
008900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00890000
009000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00900000
009100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00910000
009200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00920000
009300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00930000
009400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00940000
009500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00950000
009600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00960000
009700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00970000
009800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00980000
009900         10  PC-TSYMSG-02844            PIC  9(05)  VALUE 02844.  00990000
010000         10  PC-TSYMSG-02885            PIC  9(05)  VALUE 02885.  01000000
010100         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01010000
010200*                                                                 01020000
010300******************************************************************01030000
010400*                                                                 01040000
010500 01  PS-PROGRAM-SWITCHES.                                         01050000
010600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01060000
010700         88  PS-NO-ERROR                            VALUE 'Y'.    01070000
010800         88  PS-ERROR                               VALUE 'N'.    01080000
010900     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01090000
011000         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01100000
011100         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01110000
011200     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01120000
011300         88  PS-DONE                                VALUE 'Y'.    01130000
011400         88  PS-NOT-DONE                            VALUE 'N'.    01140000
011500     05  PS-END-OF-RANKINGS-SW          PIC  X(01)  VALUE 'N'.    01150000
011600         88  PS-END-OF-RANKINGS                     VALUE 'Y'.    01160000
011700         88  PS-NOT-END-OF-RANKINGS                 VALUE 'N'.    01170000
011800     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.    01180000
011900         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.    01190000
012000         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.    01200000
012100*DMH 05  PS-VENDOR-HAS-NO-DEPTS-SW      PIC  X(01)  VALUE 'Y'.    01210000
012200*DMH     88  PS-VENDOR-HAS-NO-DEPTS                 VALUE 'N'.    01220000
012300*DMH     88  PS-VENDOR-HAS-DEPTS                    VALUE 'Y'.    01230000
012400     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE  'N'.   01240000
012500         88  PS-NO-BLOCK-ERROR                      VALUE  'N'.   01250000
012600         88  PS-BLOCK-ERROR                         VALUE  'Y'.   01260000
012700*                                                                 01270000
012800 01  PV-PROGRAM-VARIABLES.                                        01280000
012900     05  PV-SUB                         PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01330000
013400                                                    COMP-3.       01340000
013500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01350000
013600                                                    COMP-3.       01360000
013700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01370000
013800                                                    COMP-3.       01380000
013900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01390000
014000                                                    COMP-3.       01400000
014100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01410000
014200                                                    COMP-3.       01420000
014300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01430000
014400                                                    COMP-3.       01440000
014500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01450000
014600                                                    COMP-3.       01460000
014700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01470000
014800                                                    COMP SYNC.    01480000
014900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01490000
015000                                                    COMP SYNC.    01500000
015100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01510000
015200                                                    COMP SYNC.    01520000
015300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01530000
015400                                                    COMP SYNC.    01540000
015500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01550000
015600                                                    COMP SYNC.    01560000
015700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01570000
015800                                                    COMP SYNC.    01580000
015900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01590000
016000                                                    COMP SYNC.    01600000
016100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01610000
016200                                                    COMP SYNC.    01620000
016300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01630000
016400                                                    COMP SYNC.    01640000
016500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01650000
016600                                                    COMP SYNC.    01660000
016700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01670000
016800                                                    COMP SYNC.    01680000
016900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01690000
017000                                                    COMP SYNC.    01700000
017100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01710000
017200                                                    COMP SYNC.    01720000
017300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01730000
017400                                                    COMP SYNC.    01740000
017500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01750000
017600                                                    COMP SYNC.    01760000
017700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01770000
017800                                                    COMP SYNC.    01780000
017900     05  PV-BULK-VND-RNKG-CDE           PIC  X(06).               01790000
018000     05  PV-PREPACK-VND-RNKG-CDE        PIC  X(06).               01800000
018100     05  PV-PBS-VND-RNKG-CDE            PIC  X(06).               01810000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
018100     05  PV-RFID-VND-RNKG-CDE           PIC  X(06).               01810000
      *CLP 10/01/13 END   - PR# 5148D                                           
018200     05  PV-COUNT-DEPT-RANKGS           PIC S9(04)  COMP.         01820000
018300     05  PV-COUNT-VNDR-DEPTS            PIC S9(04)  COMP.         01830000
018400     05  PV-ORIGINAL-BLOCK              PIC S9(04)  VALUE +0      01840000
018500                                                    COMP SYNC.    01850000
018600     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01860000
018700     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01870000
018800******************************************************************01880000
018900**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01890000
019000**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01900000
019100**  APPLICATION-SPECIFIC COMMAREA.                              **01910000
019200******************************************************************01920000
019300 01  LQW-LIST-QUEUE-WORK-AREA.                                    01930000
019400     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01940000
019500     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           01950000
019600                                        INDEXED BY LQW-IDX.       01960000
019700         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01970000
019800         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01980000
019900         10  LQW-SELECTED-SW            PIC  X(01).               01990000
020000             88  LQW-SELECT                         VALUE 'S'.    02000000
020100             88  LQW-DESELECT                       VALUE ' '.    02010000
020200         10  LQW-ACTION                 PIC  X(03).               02020000
020300         10  LQW-LINE-ENT-ID            PIC S9(09)  COMP.         02030000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
020400         10  LQW-VENDOR-NAME            PIC  X(23).               02040000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
020500         10  LQW-BULK-RANKING           PIC  X(06).               02050000
020600         10  LQW-PREPACK-RANKING        PIC  X(06).               02060000
020700         10  LQW-PBS-RANKING            PIC  X(06).               02070000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
020700         10  LQW-RFID-RANKING           PIC  X(06).               02070000
      *CLP 10/01/13 END   - PR# 5148D                                           
020800         10  LQW-DEPT-RANKING           PIC  9(05)  COMP-3.       02080000
020900         10  LQW-NBR-OF-DEPTS           PIC  9(05)  COMP-3.       02090000
021000         10  LQW-ERROR-SW               PIC  X.                   02100000
021100             88  LQW-NO-ERROR                       VALUE ' '.    02110000
021200             88  LQW-NO-DEPT-ERR                    VALUE '1'.    02120000
021300                                                                  02130000
021400     EJECT                                                        02140000
021500*---------------------------------------------------------------* 02150000
021600*  RECORD LAYOUT FOR THE VENDOR SELECTION TEMP STORAGE QUEUE.   * 02160000
021700*---------------------------------------------------------------* 02170000
021800                                                                  02180000
021900     COPY SUWS019.                                                02190000
022000                                                                  02200000
022100*----------------------------------------------------------------*02210000
022200**  SECURITY SUBROUTINE PARAMETERS                                02220000
022300*----------------------------------------------------------------*02230000
022400     COPY DPWS008.                                                02240000
022500     EJECT                                                        02250000
022600*---------------------------------------------------------------* 02260000
022700*    MAP LAYOUT                                                 * 02270000
022800*---------------------------------------------------------------* 02280000
022900                                                                  02290000
023000     COPY SUKM579.                                                02300000
023100*                                                                 02310000
023200 01  MR-OCCURS-LAYOUT                   REDEFINES  SU579AO.       02320000
023300     05  FILLER                         PIC X(42).                02330000
023400     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          02340000
023500         10  MR-SELECTL                 PIC S9(04) COMP.          02350000
023600         10  MR-SELECTA                 PIC  X(01).               02360000
023700         10  MR-SELECTC                 PIC  X(01).               02370000
023800         10  MR-SELECTH                 PIC  X(01).               02380000
023900         10  MR-SELECTI                 PIC  X(01).               02390000
024000                                                                  02400000
024100         10  MR-ACTIONL                 PIC S9(04) COMP.          02410000
024200         10  MR-ACTIONA                 PIC  X(01).               02420000
024300         10  MR-ACTIONC                 PIC  X(01).               02430000
024400         10  MR-ACTIONH                 PIC  X(01).               02440000
024500         10  MR-ACTION                  PIC  X(03).               02450000
024600                                                                  02460000
024700         10  MR-VENDOR-IDL              PIC S9(04) COMP.          02470000
024800         10  MR-VENDOR-IDA              PIC  X(01).               02480000
024900         10  MR-VENDOR-IDC              PIC  X(01).               02490000
025000         10  MR-VENDOR-IDH              PIC  X(01).               02500000
025100         10  MR-VENDOR-ID-X.                                      02510000
025200             15  MR-VENDOR-ID           PIC ZZZZZZZZ9.            02520000
025300                                                                  02530000
025400         10  MR-VENDOR-NAMEL            PIC S9(04) COMP.          02540000
025500         10  MR-VENDOR-NAMEA            PIC  X(01).               02550000
025600         10  MR-VENDOR-NAMEC            PIC  X(01).               02560000
025700         10  MR-VENDOR-NAMEH            PIC  X(01).               02570000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
025800         10  MR-VENDOR-NAME             PIC  X(23).               02580000
      *CLP 10/01/13 END   - PR# 5148D                                           
025900                                                                  02590000
026000         10  MR-BULK-RANKINGL           PIC S9(04) COMP.          02600000
026100         10  MR-BULK-RANKINGA           PIC  X(01).               02610000
026200         10  MR-BULK-RANKINGC           PIC  X(01).               02620000
026300         10  MR-BULK-RANKINGH           PIC  X(01).               02630000
026400         10  MR-BULK-RANKING            PIC  X(06).               02640000
026500                                                                  02650000
026600         10  MR-PREPACK-RANKINGL        PIC S9(04) COMP.          02660000
026700         10  MR-PREPACK-RANKINGA        PIC  X(01).               02670000
026800         10  MR-PREPACK-RANKINGC        PIC  X(01).               02680000
026900         10  MR-PREPACK-RANKINGH        PIC  X(01).               02690000
027000         10  MR-PREPACK-RANKING         PIC X(06).                02700000
027100                                                                  02710000
027200         10  MR-PBS-RANKINGL            PIC S9(04) COMP.          02720000
027300         10  MR-PBS-RANKINGA            PIC  X(01).               02730000
027400         10  MR-PBS-RANKINGC            PIC  X(01).               02740000
027500         10  MR-PBS-RANKINGH            PIC  X(01).               02750000
027600         10  MR-PBS-RANKING             PIC  X(06).               02760000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
027200         10  MR-RFID-RANKINGL            PIC S9(04) COMP.         02720000
027300         10  MR-RFID-RANKINGA            PIC  X(01).              02730000
027400         10  MR-RFID-RANKINGC            PIC  X(01).              02740000
027500         10  MR-RFID-RANKINGH            PIC  X(01).              02750000
027600         10  MR-RFID-RANKING             PIC  X(06).              02760000
      *CLP 10/01/13 END   - PR# 5148D                                           
                                                                                
027800         10  MR-DEPT-RANKINGL           PIC S9(04) COMP.          02780000
027900         10  MR-DEPT-RANKINGA           PIC  X(01).               02790000
028000         10  MR-DEPT-RANKINGC           PIC  X(01).               02800000
028100         10  MR-DEPT-RANKINGH           PIC  X(01).               02810000
028200         10  MR-DEPT-RANKING-X.                                   02820000
028300             15  MR-DEPT-RANKING        PIC ZZZZZ.                02830000
028400                                                                  02840000
028500     EJECT                                                        02850000
028600*---------------------------------------------------------------* 02860000
028700*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02870000
028800*---------------------------------------------------------------* 02880000
028900                                                                  02890000
029000     COPY DPWS015.                                                02900000
029100                                                                  02910000
029200*---------------------------------------------------------------* 02920000
029300*    FUNCTION KEYS COPYBOOK.                                    * 02930000
029400*---------------------------------------------------------------* 02940000
029500                                                                  02950000
029600     COPY DPWS016.                                                02960000
029700                                                                  02970000
029800*---------------------------------------------------------------* 02980000
029900*    NUMERIC EDIT LAYOUT.                                       * 02990000
030000*---------------------------------------------------------------* 03000000
030100                                                                  03010000
030200     COPY DPWS010I.                                               03020000
030300 EJECT                                                            03030000
030400*---------------------------------------------------------------* 03040000
030500*    PARAMETERS FOR CALLING CICS ARCHITECTURE API               * 03050000
030600*---------------------------------------------------------------* 03060000
030700                                                                  03070000
030800     COPY DPWS030.                                                03080000
030800     COPY DPWS930.                                                03080000
030900 EJECT                                                            03090000
031000*---------------------------------------------------------------* 03100000
031100*    STANDARD COMMAREA.                                         * 03110000
031200*---------------------------------------------------------------* 03120000
031300                                                                  03130000
031400     COPY DPWS020.                                                03140000
031500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03150000
031600                                                                  03160000
031700*---------------------------------------------------------------* 03170000
031800* INTER-APPLICATION COMMAREA.                                   * 03180000
031900*   SUWS017 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 03190000
032000*             SPEC SCREEN.                                      * 03200000
032100*   SUWS018 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03210000
032200*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 03220000
032300*---------------------------------------------------------------* 03230000
032400                                                                  03240000
032500         10  INTER-APPL-COMM-AREA       PIC X(200).               03250000
032600     COPY SUWS017.                                                03260000
032700     COPY SUWS018.                                                03270000
032800*---------------------------------------------------------------* 03280000
032900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03290000
033000*---------------------------------------------------------------* 03300000
033100         10  ASC-SPECIFIC-COMMAREA.                               03310000
033200             15  ASC-LIST-KEYS.                                   03320000
033300                 20  ASC-ENT-ID                      PIC S9(09)   03330000
033400                                                     COMP.        03340000
033500                 20  ASC-VENDOR-DESC                 PIC  X(30).  03350000
033600                 20  ASC-DEPT-NBR                    PIC  9(04).  03360000
033700                 20  ASC-ENT-ID-SEL                  PIC S9(09)   03361000
033800                                                     COMP.        03362000
033900                 20  ASC-VENDOR-DESC-SEL             PIC  X(30).  03363000
034000             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03370000
034100                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03380000
034200                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03390000
034300                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03400000
034400                                                                  03410000
034500                 20  ASC-ITEM-ARRAY.                              03420000
034600                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        03430000
034700                         30  ASC-LIST-ITEM-NUMBER                 03440000
034800                                                     PIC S9(09)   03450000
034900                                                     COMP-3.      03460000
035000                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03470000
035100                             88  ASC-VALID-SELECT    VALUE ' '    03480000
035200                                                           'S'    03490000
035300                                                           'B'    03500000
035400                                                           'E'.   03510000
035500                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03520000
035600                             88  ASC-TEMP-SELECT     VALUE 'S'.   03530000
035700                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03540000
035800                             88  ASC-TEMP-END        VALUE 'E'.   03550000
035900                         30  ASC-SELECTED-SW         PIC  X(01).  03560000
036000                             88  ASC-NO-SELECT       VALUE ' '.   03570000
036100                             88  ASC-SELECT          VALUE 'S'.   03580000
036200                             88  ASC-BEGIN           VALUE 'B'.   03590000
036300                             88  ASC-END             VALUE 'E'.   03600000
036400                         30  ASC-ACTION              PIC  X(03).  03610000
036500                         30  ASC-LINE-ENT-ID         PIC S9(09)   03620000
036600                                                     COMP.        03630000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
036700                         30  ASC-VENDOR-NAME         PIC  X(23).  03640000
      *CLP 10/01/13 END   - PR# 5148D                                           
036800                         30  ASC-BULK-VND-RNKG-CDE   PIC  X(06).  03650000
036900                         30  ASC-PREPACK-VND-RNKG-CDE             03660000
037000                                                     PIC X(06).   03670000
037100                         30  ASC-PBS-VND-RNKG-CDE    PIC  X(06).  03680000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
                               30  ASC-RFID-VND-RNKG-CDE   PIC X(06).           
      *CLP 10/01/13 END   - PR# 5148D                                           
037200                         30  ASC-DEPT-RNKG-NBR       PIC S9(05)   03690000
037300                                                          COMP-3. 03700000
037400                         30  ASC-NBR-OF-DEPTS        PIC S9(05)   03710000
037500                                                          COMP-3. 03720000
037600                         30  ASC-ERROR-SW            PIC  X.      03730000
037700                             88  ASC-NO-ERROR        VALUE ' '.   03740000
037800                             88  ASC-NO-DEPT-ERR     VALUE '1'.   03750000
037900                                                                  03760000
038000             15  ASC-BLK-SUB                         PIC S9(04)   03770000
038100                                                          COMP    03780000
038200                                                          SYNC.   03790000
038300             15  ASC-ITEM-SUB                        PIC S9(04)   03800000
038400                                                          COMP    03810000
038500                                                          SYNC.   03820000
038600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03830000
038700                                                          COMP-3. 03840000
038800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03850000
038900                                                          COMP-3. 03860000
039000             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03870000
039100                                                          COMP-3. 03880000
039200             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03890000
039300                                                          COMP-3. 03900000
039400             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03910000
039500                                                          COMP-3. 03920000
039600             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03930000
039700                                                          COMP    03940000
039800                                                          SYNC.   03950000
039900             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03960000
040000                                                          COMP-3. 03970000
040100             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03980000
040200                                                          COMP-3. 03990000
040300             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04000000
040400                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04010000
040500                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04020000
040600             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04030000
040700                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04040000
040800                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04050000
040900             15  ASC-LIST-QUEUE-NAME.                             04060000
041000                 20  ASC-LIST-TERM-ID                PIC  X(04).  04070000
041100                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04080000
041200                                                          COMP-3. 04090000
041300                 20  ASC-LIST-SEQ                    PIC  9(01).  04100000
041400             15  ASC-SEL-QUEUE-NAME.                              04110000
041500                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04120000
041600                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04130000
041700                                                          COMP-3. 04140000
041800                 20  ASC-SEL-SEQ                     PIC  9(01).  04150000
041900                                                                  04160000
042000             15  ASC-CURSOR-SW                       PIC  X(01).  04170000
042100                 88  ASC-NO-CURSOR                   VALUE 'Z'.   04180000
042200                 88  ASC-VENDOR-NAME-CURSOR          VALUE 'N'.   04190000
042300                 88  ASC-VENDOR-CURSOR               VALUE 'V'.   04200000
042400                 88  ASC-VENDOR-ALL-CURSOR           VALUE 'A'.   04210000
042500                                                                  04220000
042600             15  ASC-VENDOR-HAS-NO-DEPTS-SW           PIC X(01).  04230000
042700                 88  ASC-VENDOR-HAS-NO-DEPTS          VALUE 'N'.  04240000
042800                 88  ASC-VENDOR-HAS-DEPTS             VALUE 'Y'.  04250000
042900                                                                  04260000
043000             15  ASC-START-ITEM-REQUEST.                          04270000
043100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04280000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
043200         10  FILLER                        PIC  X(0809).          04290000
      *CLP 10/01/13 END   - PR# 5148D                                           
043300     EJECT                                                        04300000
043400*---------------------------------------------------------------* 04310000
043500*    ABEND PROCESSING COPYBOOK.                                 * 04320000
043600*---------------------------------------------------------------* 04330000
043700                                                                  04340000
043800     COPY DPWS013.                                                04350000
043900                                                                  04360000
044000 EJECT                                                            04370000
044100*----------------------------------------------------------------*04380000
044200*    DB2 DCLGEN FOR THE VENDOR RANKING TABLE (SUT_VND_RNKG)       04390000
044300*----------------------------------------------------------------*04400000
044400     EXEC SQL                                                     04410000
044500          INCLUDE SUT00019                                        04420000
044600     END-EXEC.                                                    04430000
044700*----------------------------------------------------------------*04440000
044800*    DB2 DCLGEN FOR THE VENDOR DEPT RANKING TABLE                 04450000
044900*    (SUT_VND_DEPT_RNKG)                                          04460000
045000*----------------------------------------------------------------*04470000
045100     EXEC SQL                                                     04480000
045200          INCLUDE SUT00018                                        04490000
045300     END-EXEC.                                                    04500000
045400*----------------------------------------------------------------*04510000
045500*    DB2 DCLGEN FOR THE AUDIT PARM TABLE                          04520000
045600*    (SUT_PO_AUD_PARM)                                            04530000
045700*----------------------------------------------------------------*04540000
045800     EXEC SQL                                                     04550000
045900          INCLUDE SUT00017                                        04560000
046000     END-EXEC.                                                    04570000
046100*----------------------------------------------------------------*04580000
046200*    DB2 DCLGEN FOR THE EXTERNAL ENTERPRISE TABLE                 04590000
046300*----------------------------------------------------------------*04600000
046400     EXEC SQL                                                     04610000
046500          INCLUDE TEXTENT                                         04620000
046600     END-EXEC.                                                    04630000
046700*----------------------------------------------------------------*04640000
046800*    DB2 DCLGEN FOR THE ENTERPRISE NAME TABLE                     04650000
046900*----------------------------------------------------------------*04660000
047000     EXEC SQL                                                     04670000
047100          INCLUDE TENTNME                                         04680000
047200     END-EXEC.                                                    04690000
047300                                                                  04700000
047400*----------------------------------------------------------------*04710000
047500* VENDOR DEPARTMENT TABLE                                         04720000
047600*----------------------------------------------------------------*04730000
047700     EXEC SQL                                                     04740000
047800          INCLUDE TVNDDPT                                         04750000
047900     END-EXEC.                                                    04760000
048000                                                                  04770000
048100*----------------------------------------------------------------*04780000
048200*    MERCHANDISE AREA TABLE                                       04790000
048300*----------------------------------------------------------------*04800000
048400     EXEC SQL                                                     04810000
048500          INCLUDE TMDSEAR                                         04820000
048600     END-EXEC.                                                    04830000
048700                                                                  04840000
048800*----------------------------------------------------------------*04850000
048900*    MERCHANDISE DEPARTMENT                                       04860000
049000*----------------------------------------------------------------*04870000
049100     EXEC SQL                                                     04880000
049200          INCLUDE TMDSEDP                                         04890000
049300     END-EXEC.                                                    04900000
049400                                                                  04910000
049500*----------------------------------------------------------------*04920000
049600*    DB2 SQL COMMUNICATION AREA                                   04930000
049700*----------------------------------------------------------------*04940000
049800     EXEC SQL                                                     04950000
049900          INCLUDE SQLCA                                           04960000
050000     END-EXEC.                                                    04970000
050100                                                                  04980000
050200                                                                  04990000
050300*---------------------------------------------------------------* 05000000
050400*    CURSOR FOR ALL VENDORS WITH THE SPECIFIED ENT-ID           * 05010000
050500*---------------------------------------------------------------* 05020000
050600                                                                  05030000
050700     EXEC SQL                                                     05040000
050800          DECLARE VENDOR-CSR CURSOR                               05050000
050900          FOR SELECT                                              05060000
051000                A.ENT_ID                                          05070000
051100             ,  B.ENT_NAME_DESC                                   05080000
051200          FROM                                                    05090000
051300                TEXTENT A                                         05100000
051400             ,  TENTNME B                                         05110000
051500          WHERE                                                   05120000
051600                A.ENT_ID           = :DK-ENT-ID                   05130000
051700            AND A.MDSE_VENDOR_IND  = 'Y'                          05140000
051800            AND A.ENT_ID           = B.ENT_ID                     05150000
051900            AND A.STATUS_CDE       = :PC-A                        05160000
052000            AND B.TYPE_CDE         = :PC-01                       05170000
052010          WITH UR                                                         
052100     END-EXEC.                                                    05180000
052200                                                                  05190000
052300*---------------------------------------------------------------* 05200000
052400*    CURSOR FOR ALL VENDORS WITH THE SPECIFIED VENDOR DESCRIPTION 05210000
052500*---------------------------------------------------------------* 05220000
052600     EXEC SQL                                                     05230000
052700          DECLARE VENDOR-NAME-CSR CURSOR                          05240000
052800          FOR SELECT                                              05250000
052900                A.ENT_ID                                          05260000
053000             ,  B.ENT_NAME_DESC                                   05270000
053100          FROM                                                    05280000
053200                TEXTENT A                                         05290000
053300             ,  TENTNME B                                         05300000
053400          WHERE                                                   05310000
053500                B.ENT_NAME_DESC LIKE :DK-VENDOR-DESC              05320000
053600            AND B.TYPE_CDE         = :PC-01                       05330000
053700            AND A.STATUS_CDE       = :PC-A                        05340000
053800            AND A.ENT_ID           = B.ENT_ID                     05350000
053900            AND A.MDSE_VENDOR_IND  = 'Y'                          05360000
053910          WITH UR                                                         
054000     END-EXEC.                                                    05370000
054100                                                                  05380000
054200*---------------------------------------------------------------* 05390000
054300*    CURSOR FOR ALL VENDORS                                       05400000
054400*---------------------------------------------------------------* 05410000
054500     EXEC SQL                                                     05420000
054600          DECLARE ALL-VENDOR-CSR CURSOR                           05430000
054700          FOR SELECT                                              05440000
054800                A.ENT_ID                                          05450000
054900             ,  B.ENT_NAME_DESC                                   05460000
055000          FROM                                                    05470000
055100                TEXTENT A                                         05480000
055200             ,  TENTNME B                                         05490000
055300          WHERE                                                   05500000
055400                A.ENT_ID           = B.ENT_ID                     05510000
055500            AND A.MDSE_VENDOR_IND  = 'Y'                          05520000
055600            AND A.STATUS_CDE       = :PC-A                        05530000
055700            AND B.TYPE_CDE         = :PC-01                       05540000
055710          WITH UR                                                         
055800     END-EXEC.                                                    05550000
055900                                                                  05560000
056000*---------------------------------------------------------------* 05570000
056100*    CURSOR FOR ALL THE RANKINGS FOR VENDOR                       05580000
056200*---------------------------------------------------------------* 05590000
056300     EXEC SQL                                                     05600000
056400          DECLARE RANKINGS-CSR CURSOR                             05610000
056500          FOR SELECT                                              05620000
056600                B.VND_RNKG_CDE                                    05630000
056700             ,  B.PKGNG_TYP_CDE                                   05640000
056800          FROM                                                    05650000
056900                SUT_VND_RNKG A                                    05660000
057000             ,  SUT_PO_AUD_PARM B                                 05670000
057100          WHERE                                                   05680000
057200                A.ENT_ID         = :DK-ENT-ID                     05690000
057300            AND A.VND_RNKG_CDE   = B.VND_RNKG_CDE                 05700000
057400            AND A.PKGNG_TYP_CDE  = B.PKGNG_TYP_CDE                05710000
057500            AND B.EFF_BEG_TMST IN                                 05720000
057600            (SELECT MAX(C.EFF_BEG_TMST)                           05730000
057700              FROM SUT_PO_AUD_PARM C                              05740000
057800              WHERE C.VND_RNKG_CDE  = B.VND_RNKG_CDE              05750000
057900                AND C.PKGNG_TYP_CDE = B.PKGNG_TYP_CDE)            05760000
057910          WITH UR                                                         
058000     END-EXEC.                                                    05770000
058100                                                                  05780000
058200                                                                  05790000
058300 EJECT                                                            05800000
058400 LINKAGE SECTION.                                                 05810000
058500                                                                  05820000
058600 01  DFHCOMMAREA.                                                 05830000
058700     05  FILLER                         OCCURS  1 TO 4072 TIMES   05840000
058800                                        DEPENDING ON EIBCALEN.    05850000
058900         10  FILLER                     PIC X.                    05860000
059000                                                                  05870000
059100 EJECT                                                            05880000
059200 PROCEDURE DIVISION.                                              05890000
059300******************************************************************05900000
059400**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05910000
059500**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05920000
059600**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05930000
059700******************************************************************05940000
059800 0000-MAIN-MODULE.                                                05950000
059900     INITIALIZE DP030-CICS-API-FIELDS.                            05960000
060000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05970000
060100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05980000
060200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05990000
060300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06000000
060400     MOVE LENGTH OF SU579AI        TO DP030-MAP-LENGTH (1).       06010000
060500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06020000
060600     PERFORM 0001-CALL-CICS-ARCH-API.                             06030000
060700*                                                                 06040000
060800     PERFORM 1000-CONTROL-PROCESSING                              06050000
060900*                                                                 06060000
061000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06070000
061100     PERFORM 0001-CALL-CICS-ARCH-API.                             06080000
061200                                                                  06090000
061300******************************************************************06100000
061400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06110000
061500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06120000
061600******************************************************************06130000
061700 0001-CALL-CICS-ARCH-API.                                         06140000
061800*    CALL 'DPKCS030' USING DFHEIBLK                               06150000
061800     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06150000
061900                           DFHCOMMAREA                            06160000
062000                           DP030-CICS-API-FIELDS                  06170000
062100                           DP020-STANDARD-COMMAREA                06180000
062200                           SU579AI.                               06190000
062300*                                                                 06200000
062400     IF  DP030-RC-CALL-SUCCESSFUL                                 06210000
062500         CONTINUE                                                 06220000
062600     ELSE                                                         06230000
062700         SET DP013-NO-ROLLBACK                                    06240000
062800             DP013-XCTL-DISPLAY-RESTART                           06250000
062900             DP013-CICS-ABEND      TO TRUE                        06260000
063000         MOVE '0001-CALL-CICS-ARCH-API'                           06270000
063100                                   TO DP013-PARAGRAPH             06280000
063200*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06290000
063300*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06300000
063200         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL. RETURN-CODE O06290000
063300-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06300000
063400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06310000
063500         PERFORM DP013-0000-PROCESS-ABEND                         06320000
063600     END-IF.                                                      06330000
063700*----------------------------------------------------------------*06340000
063800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06350000
063900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06360000
064000*                                                                *06370000
064100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06380000
064200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06390000
064300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06400000
064400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06410000
064500*----------------------------------------------------------------*06420000
064600                                                                  06430000
064700 1000-CONTROL-PROCESSING.                                         06440000
064800                                                                  06450000
064900     EVALUATE TRUE                                                06460000
065000         WHEN DP020-NEXT-ACT-INITIAL                              06470000
065100             INITIALIZE ASC-SPECIFIC-COMMAREA                     06480000
065200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06490000
065300                                      ASC-SEL-TERM-ID             06500000
065400             MOVE DP020-SRC-TASK-NUMBER                           06510000
065500                                   TO ASC-LIST-TASK-NUMBER        06520000
065600                                      ASC-SEL-TASK-NUMBER         06530000
065700             MOVE PC-LIST-QUEUE-SEQ                               06540000
065800                                   TO ASC-LIST-SEQ                06550000
065900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06560000
066000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06570000
066100***-----$TEMPLATE NOTE$-------------------------------------------06580000
066200*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06590000
066300*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06600000
066400*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06610000
066500***---------------------------------------------------------------06620000
066600             IF  PS-COMMAREA-NOT-VALID                            06630000
066700***              MOVE PC-TSYMSG-99901                             06640000
066800***                                TO DP020-MSG-NUMBER            06650000
066900***              SET DP020-MSG-FATAL                              06660000
067000***                                TO TRUE                        06670000
067100                 SET DP020-NEXT-ACT-APPL-ERROR                    06680000
067200                                   TO TRUE                        06690000
067300             ELSE                                                 06700000
067400                 PERFORM 4000-BUILD-INITIAL-PANEL                 06710000
067500             END-IF                                               06720000
067600                                                                  06730000
067700         WHEN DP020-NEXT-ACT-READ-MAP                             06740000
067800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06750000
067900                                   TO PV-TOP-ITEM                 06760000
068000             PERFORM 2000-PROCESS-PANEL                           06770000
068100                                                                  06780000
068200         WHEN DP020-NEXT-ACT-RETURN                               06790000
068300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06800000
068400                                   TO PV-TOP-ITEM                 06810000
068500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06820000
068600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06830000
068700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06840000
068800                                                                  06850000
068900         WHEN OTHER                                               06860000
069000             SET DP013-LOGIC-ABEND TO TRUE                        06870000
069100             SET DP013-NO-ROLLBACK TO TRUE                        06880000
069200             MOVE '1000-CONTROL-PROCESSING'                       06890000
069300                                   TO DP013-PARAGRAPH             06900000
069400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06910000
069500                                   TO DP013-MESSAGE-TEXT(1)       06920000
069600             PERFORM DP013-0000-PROCESS-ABEND                     06930000
069700     END-EVALUATE.                                                06940000
069800                                                                  06950000
069900 EJECT                                                            06960000
070000*----------------------------------------------------------------*06970000
070100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06980000
070200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06990000
070300*----------------------------------------------------------------*07000000
070400                                                                  07010000
070500 1100-PROCESS-INTER-APPL-COMM.                                    07020000
070600                                                                  07030000
070700     SET PS-COMMAREA-VALID         TO TRUE.                       07040000
070800     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07050000
070900     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07060000
071000         MOVE SU017-ENT-ID         TO ASC-ENT-ID                  07070000
071100                                      DK-ENT-ID                   07080000
071200         MOVE SU017-VENDOR-DESC    TO ASC-VENDOR-DESC             07090000
071300                                      DK-VENDOR-DESC              07100000
071400         MOVE SU017-DEPT-NBR       TO ASC-DEPT-NBR                07110000
071500                                      DK-DEPT-NBR                 07120000
071600*        MOVE SU017-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME          07121000
071700*        PERFORM 1120-PREPARE-LIST-ENTRY                          07122000
071800     ELSE                                                         07130000
071900         MOVE SU019-ENT-ID(1)      TO ASC-ENT-ID                  07140000
072000                                      DK-ENT-ID                   07150000
072100         MOVE SU019-VENDOR-DESC(1) TO ASC-VENDOR-DESC             07160000
072200                                      DK-VENDOR-DESC              07170000
072300                                                                  07180000
072400*        IF  DP020-NAV-KEY-DATA > SPACE                           07190000
072500*            CONTINUE                                             07200000
072600*        END-IF                                                   07210000
072700     END-IF.                                                      07220000
072800                                                                  07230000
072900                                                                  07240000
073000*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*07241000
073100*1120-PREPARE-LIST-ENTRY.                                         07242000
073200*                                                                 07243000
073300*    MOVE ZERO                     TO ASC-SEL-ITEM.               07245000
073400*    PERFORM 1130-GET-NEXT-RECORD.                                07246000
073500                                                                  07247000
073600*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*07248000
073700*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*07249000
073800*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%*07249100
073900*1130-GET-NEXT-RECORD.                                            07249200
074000*                                                                 07249300
074100*        ADD +1                   TO ASC-SEL-ITEM                 07249700
074200*        MOVE +1                  TO ASC-SEL-SUB                  07249800
074300*                                                                 07250000
074400*        PERFORM 9100-READ-SEL-QUEUE                              07250200
074500                                                                  07255300
074600/                                                                 07255400
074700*----------------------------------------------------------------*07256000
074800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07260000
074900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07270000
075000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07280000
075100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07290000
075200* FUNCTION KEYS CAN GET THIS FAR.                                *07300000
075300*----------------------------------------------------------------*07310000
075400                                                                  07320000
075500 2000-PROCESS-PANEL.                                              07330000
075600     EVALUATE TRUE                                                07340000
075700         WHEN DP020-SRC-AID = DP016-CLEAR                         07350000
075800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07360000
075900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07370000
076000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07380000
076100                                                                  07390000
076200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07400000
076300             MOVE ASC-ENT-ID       TO DK-ENT-ID                   07410000
076400             MOVE ASC-VENDOR-DESC  TO DK-VENDOR-DESC              07420000
076500             MOVE ASC-DEPT-NBR     TO DK-DEPT-NBR                 07430000
076600             PERFORM 2050-DELETE-LIST-QUEUE                       07440000
076700             PERFORM 4000-BUILD-INITIAL-PANEL                     07450000
076800                                                                  07460000
076900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07470000
077000             PERFORM 2140-DESELECT-ALL-ITEMS                      07480000
077100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07490000
077200                                                                  07500000
077300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07510000
077400             PERFORM 2150-SELECT-ALL-ITEMS                        07520000
077500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07530000
077600                                                                  07540000
077700         WHEN OTHER                                               07550000
077800             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07560000
077900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07570000
078000             IF  PS-NO-ERROR                                      07580000
078100                 SET DP030-CONTINUE-GO                            07590000
078200                                 TO TRUE                          07600000
078300                 PERFORM 2100-CHECK-FUNCTION-KEY                  07610000
078400                 IF DP030-OVERRIDE-GO                             07620000
078500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07630000
078600                 END-IF                                           07640000
078700             ELSE                                                 07650000
078800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07660000
078900                 SET DP030-OVERRIDE-GO                            07670000
079000                                 TO TRUE                          07680000
079100             END-IF                                               07690000
079200     END-EVALUATE.                                                07700000
079300 EJECT                                                            07710000
079400*----------------------------------------------------------------*07720000
079500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07730000
079600*----------------------------------------------------------------*07740000
079700 2050-DELETE-LIST-QUEUE.                                          07750000
079800                                                                  07760000
079900     EXEC CICS                                                    07770000
080000         DELETEQ TS                                               07780000
080100             QUEUE (ASC-LIST-QUEUE-NAME)                          07790000
080200             RESP  (PV-CICS-RESP)                                 07800000
080300     END-EXEC.                                                    07810000
080400                                                                  07820000
080500     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07830000
080600        (PV-CICS-RESP = DFHRESP(QIDERR))                          07840000
080700         CONTINUE                                                 07850000
080800     ELSE                                                         07860000
080900         SET DP013-CICS-ABEND      TO TRUE                        07870000
081000         SET DP013-NO-ROLLBACK     TO TRUE                        07880000
081100                                                                  07890000
081200         MOVE '2050-DELETE-LIST-QUEUE'                            07900000
081300                                   TO DP013-PARAGRAPH             07910000
081400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07920000
081500                                   TO DP013-MESSAGE-TEXT (1)      07930000
081600         PERFORM DP013-0000-PROCESS-ABEND                         07940000
081700     END-IF.                                                      07950000
081800                                                                  07960000
081900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07970000
082000 EJECT                                                            07980000
082100*----------------------------------------------------------------*07990000
082200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08000000
082300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08010000
082400* CICS ARCHITECTURE API.                                         *08020000
082500*----------------------------------------------------------------*08030000
082600 2100-CHECK-FUNCTION-KEY.                                         08040000
082700     EVALUATE TRUE                                                08050000
082800                                                                  08060000
082900* F15 - UPDATE VENDOR RANK   (LOCAL-FUNC-01)                      08070000
083000*                                                                 08080000
083100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08090000
083200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08100000
083300                 MOVE 'SUVNDRKU' TO DP008-FUNCTION-NAME           08110000
083400                 PERFORM 2105-RACF-ACCESS                         08120000
083500                 IF  PS-ACCESS-NOT-ALLOWED                        08130000
083600                     SET  PS-ERROR                                08140000
083700                          DP020-MSG-FATAL TO TRUE                 08150000
083800                     MOVE PC-TSYMSG-02844 TO DP020-MSG-NUMBER     08160000
083900                     MOVE -1              TO MR-SELECTL (1)       08170000
084000                     SET  DP030-SET-CURSOR-APPL-1 TO TRUE         08180000
084100                     SET DP030-OVERRIDE-GO       TO TRUE          08190000
084200                 END-IF                                           08200000
084300                 IF PS-NO-ERROR                                   08210000
084400                     INITIALIZE SU018-INTER-APPL-COMMAREA         08220000
084500                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            08230000
084600                                TO SU018-NUMBER-OF-SELECTED-ITEMS 08240000
084700                     PERFORM 5000-PREPARE-SEL-QUEUE               08250000
084800                 END-IF                                           08260000
084900             ELSE                                                 08270000
085000                 SET DP030-OVERRIDE-GO                            08280000
085100                                   TO TRUE                        08290000
085200                 MOVE PC-TSYMSG-00057                             08300000
085300                                   TO DP020-MSG-NUMBER            08310000
085400                 SET DP020-MSG-WARNING                            08320000
085500                                   TO TRUE                        08330000
085600             END-IF                                               08340000
085700                                                                  08350000
085800* F19 - SELECT VENDOR LIST  (LOCAL-FUNC-03)                       08360000
085900* GETS VENDOR NAME & VENDOR ID FROM SELECT QUEUE AND SENDS BACK   08370000
086000* TO CRIT SPEC                                                    08380000
086100*                                                                 08390000
086200         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              08400000
086300             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08410000
086400                 INITIALIZE SU018-INTER-APPL-COMMAREA             08420000
086500                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08430000
086600                                TO SU018-NUMBER-OF-SELECTED-ITEMS 08440000
086700                 PERFORM 5000-PREPARE-SEL-QUEUE                   08450000
086800             ELSE                                                 08460000
086900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08470000
087000                 SET DP030-OVERRIDE-GO                            08480000
087100                                   TO TRUE                        08490000
087200                 MOVE PC-TSYMSG-00057                             08500000
087300                                   TO DP020-MSG-NUMBER            08510000
087400                 SET DP020-MSG-WARNING                            08520000
087500                                   TO TRUE                        08530000
087600             END-IF                                               08540000
087700                                                                  08550000
087800                                                                  08560000
087900* F24 - DEPARTMENT LIST (LOCAL-FUNC-02)                           08570000
088000*                                                                 08580000
088100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08590000
088200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              08600000
088300                 INITIALIZE SU018-INTER-APPL-COMMAREA             08610000
088400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08620000
088500                                TO SU018-NUMBER-OF-SELECTED-ITEMS 08630000
088600* DMH            SET PS-VENDOR-HAS-DEPTS TO TRUE                  08640000
088700                 PERFORM 5000-PREPARE-SEL-QUEUE                   08650000
088800* DMH            IF PS-VENDOR-HAS-NO-DEPTS                        08660000
088900* DMH                SET DP030-OVERRIDE-GO                        08670000
089000* DMH                                  TO TRUE                    08680000
089100* DMH                MOVE PC-TSYMSG-02885                         08690000
089200* DMH                                  TO DP020-MSG-NUMBER        08700000
089300* DMH                SET DP020-MSG-WARNING                        08710000
089400* DMH                                  TO TRUE                    08720000
089500* DMH            END-IF                                           08730000
089600             ELSE                                                 08740000
089700                 SET DP030-OVERRIDE-GO                            08750000
089800                                   TO TRUE                        08760000
089900                 MOVE PC-TSYMSG-00057                             08770000
090000                                   TO DP020-MSG-NUMBER            08780000
090100                 SET DP020-MSG-WARNING                            08790000
090200                                   TO TRUE                        08800000
090300             END-IF                                               08810000
090400                                                                  08820000
090500                                                                  08830000
090600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08840000
090700             MOVE +1               TO PV-TOP-ITEM                 08850000
090800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08860000
090900                                                                  08870000
091000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08880000
091100             PERFORM 2110-BROWSE-BACKWARD                         08890000
091200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08900000
091300                                                                  08910000
091400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08920000
091500             PERFORM 2120-BROWSE-FORWARD                          08930000
091600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08940000
091700                                                                  08950000
091800         WHEN DP020-SRC-AID = DP016-ENTER                         08960000
091900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08970000
092000             IF  PS-ERROR                                         08980000
092100                 CONTINUE                                         08990000
092200             ELSE                                                 09000000
092300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09010000
092400             END-IF                                               09020000
092500                                                                  09030000
092600         WHEN OTHER                                               09040000
092700             SET DP013-NO-ROLLBACK                                09050000
092800                 DP013-XCTL-DISPLAY-RESTART                       09060000
092900                 DP013-CICS-ABEND  TO TRUE                        09070000
093000             MOVE '2100-CHECK-FUNCTION-KEY'                       09080000
093100                                   TO DP013-PARAGRAPH             09090000
093200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09100000
093300                                   TO DP013-MESSAGE-TEXT (1)      09110000
093400             PERFORM DP013-0000-PROCESS-ABEND                     09120000
093500     END-EVALUATE.                                                09130000
093600                                                                  09140000
093700*----------------------------------------------------------------*09150000
093800* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                     09160000
093900*----------------------------------------------------------------*09170000
094000 2105-RACF-ACCESS.                                                09180000
094100                                                                  09190000
094200      SET DP008-RSRC-TYPE-FUNC           TO TRUE                  09200000
094300      SET DP008-ACCESS-TYPE-USE          TO TRUE                  09210000
094400                                                                  09220000
094500      EXEC CICS                                                   09230000
094600         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                 09240000
094700              COMMAREA (DP008-SECURITY-COMMAREA)                  09250000
094800              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)             09260000
094900      END-EXEC                                                    09270000
095000                                                                  09280000
095100      IF DP008-CALL-SUCCESSFUL                                    09290000
095200         IF DP008-ACCESS-ALLOWED                                  09300000
095300             SET PS-ACCESS-ALLOWED TO TRUE                        09310000
095400         ELSE                                                     09320000
095500             SET PS-ACCESS-NOT-ALLOWED TO TRUE                    09330000
095600         END-IF                                                   09340000
095700     ELSE                                                         09350000
095800         MOVE '2105-RACF-ACCESS'                                  09360000
095900                               TO DP013-PARAGRAPH                 09370000
096000          MOVE 'UNABLE TO ACCESS CICS'                            09380000
096100                               TO DP013-MESSAGE-TEXT (1)          09390000
096200          MOVE SQLCA                 TO DP013-SQLCA               09400000
096300          SET DP013-DB2-ABEND                                     09410000
096400              DP013-XCTL-DISPLAY-RESTART                          09420000
096500                               TO TRUE                            09430000
096600          PERFORM DP013-0000-PROCESS-ABEND                        09440000
096700      END-IF.                                                     09450000
096800                                                                  09460000
096900*                                                                 09470000
097000*----------------------------------------------------------------*09480000
097100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09490000
097200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09500000
097300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09510000
097400*    MESSAGE.                                                    *09520000
097500*----------------------------------------------------------------*09530000
097600                                                                  09540000
097700 2110-BROWSE-BACKWARD.                                            09550000
097800     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09560000
097900         GIVING PV-TOP-ITEM.                                      09570000
098000*                                                                 09580000
098100     IF  ((PV-TOP-ITEM < +1)                                      09590000
098200       OR (PV-TOP-ITEM = +1))                                     09600000
098300         MOVE +1                   TO PV-TOP-ITEM                 09610000
098400*        -- TOP OF LIST --                                        09620000
098500         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09630000
098600         SET DP020-MSG-INFORMATIONAL TO TRUE                      09640000
098700     END-IF.                                                      09650000
098800                                                                  09660000
098900 EJECT                                                            09670000
099000*----------------------------------------------------------------*09680000
099100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09690000
099200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09700000
099300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09710000
099400*----------------------------------------------------------------*09720000
099500                                                                  09730000
099600 2120-BROWSE-FORWARD.                                             09740000
099700                                                                  09750000
099800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09760000
099900         GIVING PV-TOP-ITEM.                                      09770000
100000     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09780000
100100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09790000
100200                                   TO PV-TOP-ITEM                 09800000
100300*        -- BOTTOM OF LIST --                                     09810000
100400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09820000
100500         SET DP020-MSG-INFORMATIONAL                              09830000
100600                                   TO TRUE                        09840000
100700     ELSE                                                         09850000
100800         COMPUTE PV-BOTTOM-ITEM =                                 09860000
100900             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09870000
101000         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09880000
101100*            -- BOTTOM OF LIST --                                 09890000
101200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09900000
101300             SET DP020-MSG-INFORMATIONAL                          09910000
101400                                   TO TRUE                        09920000
101500         END-IF                                                   09930000
101600     END-IF.                                                      09940000
101700 EJECT                                                            09950000
101800*----------------------------------------------------------------*09960000
101900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09970000
102000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09980000
102100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09990000
102200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *10000000
102300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *10010000
102400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *10020000
102500*----------------------------------------------------------------*10030000
102600                                                                  10040000
102700 2130-CHECK-FOR-JUMP-BROWSE.                                      10050000
102800     SET PS-NO-ERROR               TO TRUE.                       10060000
102900     IF (ASC-START-ITEM-REQUEST = SPACE)                          10070000
103000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10080000
103100                                   TO PV-TOP-ITEM                 10090000
103200     ELSE                                                         10100000
103300         MOVE ASC-START-ITEM-REQUEST                              10110000
103400                                   TO DP010I-UNEDITED-FIELD       10120000
103500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       10130000
103600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     10140000
103700         SET DP010I-NEGATIVE-NOT-ALLOWED                          10150000
103800                                   TO TRUE                        10160000
263968         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263968              USING DP010I-NUMERIC-EDIT-AREA                              
104000                                                                  10180000
104100         IF  NOT DP010I-ERROR-DETECTED                            10190000
104200             MOVE DP010I-NUMERIC-FIELD                            10200000
104300                                   TO  ASC-START-ITEM-REQUEST-N   10210000
104400             IF  ASC-START-ITEM-REQUEST-N > ZERO                  10220000
104500                 IF  ASC-START-ITEM-REQUEST-N >                   10230000
104600                                          ASC-NUMBER-OF-ITEMS-READ10240000
104700                     MOVE SPACE TO ASC-START-ITEM-REQUEST         10250000
104800                     COMPUTE PV-TOP-ITEM =                        10260000
104900                             ASC-NUMBER-OF-ITEMS-READ             10270000
105000                             - PC-ITEMS-PER-PANEL + 1             10280000
105100                     IF  PV-TOP-ITEM < +1                         10290000
105200                         MOVE +1   TO PV-TOP-ITEM                 10300000
105300                         MOVE PC-TSYMSG-00070                     10310000
105400                                   TO DP020-MSG-NUMBER            10320000
105500                         SET DP020-MSG-INFORMATIONAL              10330000
105600                                   TO TRUE                        10340000
105700                     END-IF                                       10350000
105800                 ELSE                                             10360000
105900                     MOVE ASC-START-ITEM-REQUEST-N                10370000
106000                                   TO PV-TOP-ITEM                 10380000
106100                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10390000
106200                     COMPUTE PV-BOTTOM-ITEM =                     10400000
106300                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10410000
106400                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10420000
106500*                        -- BOTTOM OF LIST --                     10430000
106600                         MOVE PC-TSYMSG-00070                     10440000
106700                                   TO DP020-MSG-NUMBER            10450000
106800                         SET DP020-MSG-INFORMATIONAL              10460000
106900                                   TO TRUE                        10470000
107000                     END-IF                                       10480000
107100                 END-IF                                           10490000
107200             ELSE                                                 10500000
107300*                --- VALUE OUT OF RANGE ----                      10510000
107400                 MOVE PC-TSYMSG-00101                             10520000
107500                                   TO DP020-MSG-NUMBER            10530000
107600                 MOVE -1           TO ASTRTITL                    10540000
107700                 SET DP030-SET-CURSOR-APPL-1                      10550000
107800                                   TO TRUE                        10560000
107900                 MOVE DP015-REVERSE                               10570000
108000                                   TO ASTRTITH                    10580000
108100                 MOVE DP015-RED    TO ASTRTITC                    10590000
108200                 MOVE DP015-UNP-NUM-BRT-MDT                       10600000
108300                                   TO ASTRTITA                    10610000
108400                 SET DP020-MSG-FATAL                              10620000
108500                                   TO TRUE                        10630000
108600                 SET PS-ERROR      TO TRUE                        10640000
108700             END-IF                                               10650000
108800                                                                  10660000
108900         ELSE                                                     10670000
109000             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10680000
109100             MOVE -1               TO ASTRTITL                    10690000
109200             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10700000
109300             MOVE DP015-REVERSE    TO ASTRTITH                    10710000
109400             MOVE DP015-RED        TO ASTRTITC                    10720000
109500             MOVE DP015-UNP-NUM-BRT-MDT                           10730000
109600                                   TO ASTRTITA                    10740000
109700             SET DP020-MSG-FATAL   TO TRUE                        10750000
109800             SET PS-ERROR          TO TRUE                        10760000
109900         END-IF                                                   10770000
110000     END-IF.                                                      10780000
110100 EJECT                                                            10790000
110200*----------------------------------------------------------------*10800000
110300*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10810000
110400*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10820000
110500*----------------------------------------------------------------*10830000
110600 2140-DESELECT-ALL-ITEMS.                                         10840000
110700     MOVE +1                       TO ASC-BLK-SUB.                10850000
110800                                                                  10860000
110900     PERFORM 2141-CLEAR-SELECTED-INDS                             10870000
111000         VARYING ASC-ITEM-SUB                                     10880000
111100         FROM 1 BY 1                                              10890000
111200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10900000
111300                                                                  10910000
111400     ADD +1                        TO ASC-BLK-SUB.                10920000
111500                                                                  10930000
111600     PERFORM 2141-CLEAR-SELECTED-INDS                             10940000
111700         VARYING ASC-ITEM-SUB                                     10950000
111800         FROM 1 BY 1                                              10960000
111900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10970000
112000                                                                  10980000
112100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10990000
112200                                   TO PV-LIST-ITEM-NUMBER.        11000000
112300                                                                  11010000
112400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11020000
112500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11030000
112600                                                                  11040000
112700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11050000
112800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      11060000
112900         MOVE +1                   TO ASC-BLK-SUB                 11070000
113000                                                                  11080000
113100         PERFORM 5100-WRITE-TEMP-STORAGE                          11090000
113200                                                                  11100000
113300         MOVE +1                   TO PV-BLOCK-NUMBER             11110000
113400                                                                  11120000
113500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11130000
113600             PV-FIRST-BLOCK-IN-ARRAY - 1                          11140000
113700                                                                  11150000
113800         PERFORM                                                  11160000
113900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11170000
114000                                                                  11180000
114100             PERFORM 4410-READ-TEMP-STORAGE                       11190000
114200                                                                  11200000
114300             PERFORM 2141-CLEAR-SELECTED-INDS                     11210000
114400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 11220000
114500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11230000
114600                                                                  11240000
114700             PERFORM 5100-WRITE-TEMP-STORAGE                      11250000
114800                                                                  11260000
114900             ADD +1                TO PV-BLOCK-NUMBER             11270000
115000                                                                  11280000
115100         END-PERFORM                                              11290000
115200                                                                  11300000
115300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11310000
115400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11320000
115500                                                                  11330000
115600         PERFORM                                                  11340000
115700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11350000
115800                   ASC-HIGHEST-BLOCK-WRITTEN                      11360000
115900                                                                  11370000
116000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11380000
116100                                   TO PV-BLOCK-NUMBER             11390000
116200                                                                  11400000
116300             PERFORM 4410-READ-TEMP-STORAGE                       11410000
116400                                                                  11420000
116500             PERFORM 2141-CLEAR-SELECTED-INDS                     11430000
116600                 VARYING ASC-ITEM-SUB                             11440000
116700                 FROM 1 BY 1                                      11450000
116800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11460000
116900                                                                  11470000
117000             PERFORM 5100-WRITE-TEMP-STORAGE                      11480000
117100                                                                  11490000
117200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11500000
117300                                                                  11510000
117400         END-PERFORM                                              11520000
117500                                                                  11530000
117600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11540000
117700                                   TO PV-BLOCK-NUMBER             11550000
117800                                                                  11560000
117900         PERFORM 4410-READ-TEMP-STORAGE                           11570000
118000     END-IF.                                                      11580000
118100                                                                  11590000
118200                                                                  11600000
118300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11610000
118400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11620000
118500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11630000
118600                                                                  11640000
118700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11650000
118800                                                                  11660000
118900 EJECT                                                            11670000
119000*----------------------------------------------------------------*11680000
119100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11690000
119200*----------------------------------------------------------------*11700000
119300                                                                  11710000
119400 2141-CLEAR-SELECTED-INDS.                                        11720000
119500                                                                  11730000
119600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11740000
119700             NOT EQUAL ZERO                                       11750000
119800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11760000
119900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11770000
120000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11780000
120100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11790000
120200                                   TO TRUE                        11800000
120300         END-IF                                                   11810000
120400     END-IF.                                                      11820000
120500                                                                  11830000
120600 EJECT                                                            11840000
120700*----------------------------------------------------------------*11850000
120800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11860000
120900*  FOR ALL ITEMS.                                                *11870000
121000*----------------------------------------------------------------*11880000
121100                                                                  11890000
121200 2150-SELECT-ALL-ITEMS.                                           11900000
121300                                                                  11910000
121400     MOVE +1                       TO ASC-BLK-SUB.                11920000
121500                                                                  11930000
121600     PERFORM 2151-SET-SELECTED-INDS                               11940000
121700         VARYING ASC-ITEM-SUB                                     11950000
121800         FROM 1 BY 1                                              11960000
121900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11970000
122000                                                                  11980000
122100     ADD +1                        TO ASC-BLK-SUB.                11990000
122200                                                                  12000000
122300     PERFORM 2151-SET-SELECTED-INDS                               12010000
122400         VARYING ASC-ITEM-SUB                                     12020000
122500         FROM 1 BY 1                                              12030000
122600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12040000
122700                                                                  12050000
122800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12060000
122900                                   TO PV-LIST-ITEM-NUMBER.        12070000
123000                                                                  12080000
123100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12090000
123200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12100000
123300                                                                  12110000
123400                                                                  12120000
123500     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            12130000
123600         MOVE +1                   TO ASC-BLK-SUB                 12140000
123700                                                                  12150000
123800         PERFORM 5100-WRITE-TEMP-STORAGE                          12160000
123900         MOVE +2                   TO ASC-BLK-SUB                 12170000
124000         PERFORM 5100-WRITE-TEMP-STORAGE                          12180000
124100         MOVE +1                   TO ASC-BLK-SUB                 12190000
124200         MOVE +1                   TO PV-BLOCK-NUMBER             12200000
124300     END-IF.                                                      12210000
124400                                                                  12220000
124500                                                                  12230000
124600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12240000
124700        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    12250000
124800         MOVE +1                   TO ASC-BLK-SUB                 12260000
124900                                                                  12270000
125000         PERFORM 5100-WRITE-TEMP-STORAGE                          12280000
125100         MOVE +2                   TO ASC-BLK-SUB                 12290000
125200         PERFORM 5100-WRITE-TEMP-STORAGE                          12300000
125300         MOVE +1                   TO ASC-BLK-SUB                 12310000
125400         MOVE +1                   TO PV-BLOCK-NUMBER             12320000
125500                                                                  12330000
125600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12340000
125700             PV-FIRST-BLOCK-IN-ARRAY - 1                          12350000
125800                                                                  12360000
125900         PERFORM                                                  12370000
126000             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12380000
126100                                                                  12390000
126200             PERFORM 4410-READ-TEMP-STORAGE                       12400000
126300                                                                  12410000
126400             PERFORM 2151-SET-SELECTED-INDS                       12420000
126500                 VARYING ASC-ITEM-SUB                             12430000
126600                 FROM 1 BY 1                                      12440000
126700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12450000
126800                                                                  12460000
126900             PERFORM 5100-WRITE-TEMP-STORAGE                      12470000
127000                                                                  12480000
127100             ADD +1                TO PV-BLOCK-NUMBER             12490000
127200                                                                  12500000
127300         END-PERFORM                                              12510000
127400                                                                  12520000
127500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12530000
127600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12540000
127700                                                                  12550000
127800         PERFORM                                                  12560000
127900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12570000
128000                   ASC-HIGHEST-BLOCK-WRITTEN                      12580000
128100                                                                  12590000
128200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12600000
128300                                   TO PV-BLOCK-NUMBER             12610000
128400                                                                  12620000
128500             PERFORM 4410-READ-TEMP-STORAGE                       12630000
128600                                                                  12640000
128700             PERFORM 2151-SET-SELECTED-INDS                       12650000
128800                 VARYING ASC-ITEM-SUB                             12660000
128900                 FROM 1 BY 1                                      12670000
129000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12680000
129100                                                                  12690000
129200             PERFORM 5100-WRITE-TEMP-STORAGE                      12700000
129300                                                                  12710000
129400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12720000
129500                                                                  12730000
129600         END-PERFORM                                              12740000
129700                                                                  12750000
129800         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12760000
129900                                   TO PV-BLOCK-NUMBER             12770000
130000                                                                  12780000
130100         PERFORM 4410-READ-TEMP-STORAGE                           12790000
130200     END-IF.                                                      12800000
130300                                                                  12810000
130400                                                                  12820000
130500     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12830000
130600                       ASC-NUMBER-OF-SELECTED-ITEMS.              12840000
130700                                                                  12850000
130800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12860000
130900                                                                  12870000
131000 EJECT                                                            12880000
131100*----------------------------------------------------------------*12890000
131200*    MARK EACH ITEM AS BEING SELECTED.                           *12900000
131300*----------------------------------------------------------------*12910000
131400                                                                  12920000
131500 2151-SET-SELECTED-INDS.                                          12930000
131600                                                                  12940000
131700     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12950000
131800             NOT EQUAL ZERO                                       12960000
131900         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12970000
132000             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12980000
132100                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12990000
132200                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13000000
132300                               TO  TRUE                           13010000
132400         END-IF                                                   13020000
132500     END-IF.                                                      13030000
132600******************************************************************13040000
132700** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **13050000
132800** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **13060000
132900******************************************************************13070000
133000 2200-MOVE-SCREEN-TO-COMMAREA.                                    13080000
133100                                                                  13090000
133200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13100000
133300     MOVE +1                       TO PV-SUB.                     13110000
133400*                                                                 13120000
133500     PERFORM 3100-SET-SUBSCRIPTS.                                 13130000
133600     IF  ASTRTITL > ZERO                                          13140000
133700         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          13150000
133800     ELSE                                                         13160000
133900         IF  ASTRTITF = DP015-ERASE-EOF                           13170000
134000             INITIALIZE ASC-START-ITEM-REQUEST                    13180000
134100         END-IF                                                   13190000
134200     END-IF.                                                      13200000
134300     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13210000
134400         VARYING PV-SUB                                           13220000
134500         FROM 1 BY 1                                              13230000
134600         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      13240000
134700******************************************************************13250000
134800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**13260000
134900******************************************************************13270000
135000 2210-MOVE-LINES-TO-COMMAREA.                                     13280000
135100     IF  MR-SELECTL (PV-SUB) > ZERO                               13290000
135200         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13300000
135300         MOVE MR-SELECTI (PV-SUB)                                 13310000
135400                                   TO ASC-TEMP-SELECTED-SW        13320000
135500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13330000
135600     ELSE                                                         13340000
135700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                13350000
135800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     13360000
135900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        13370000
136000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      13380000
136100         END-IF                                                   13390000
136200     END-IF.                                                      13400000
136300     ADD +1                        TO ASC-ITEM-SUB.               13410000
136400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        13420000
136500         ADD +1                    TO ASC-BLK-SUB                 13430000
136600         MOVE +1                   TO ASC-ITEM-SUB                13440000
136700     END-IF.                                                      13450000
136800******************************************************************13460000
136900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13470000
137000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13480000
137100******************************************************************13490000
137200 3000-EDIT-DATA-IN-COMMAREA.                                      13500000
137300     SET PS-NO-ERROR               TO TRUE.                       13510000
137400     PERFORM 3200-RESET-ATTRIBUTES.                               13520000
137500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13530000
137600                                                                  13540000
137700     EVALUATE TRUE                                                13550000
137800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              13560000
137900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    13570000
138000              SET ASC-VENDOR-HAS-DEPTS    TO TRUE                 13580000
138100     END-EVALUATE.                                                13590000
138200**                                                                13600000
138300* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13610000
138400* EDITTING IS DONE FROM THE BOTTOM UP.                            13620000
138500**                                                                13630000
138600     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13640000
138700         ASC-ITEMS-DISPLAYED - 1.                                 13650000
138800     PERFORM 3100-SET-SUBSCRIPTS.                                 13660000
138900*DMH PERFORM 3300-EDIT-SELECTIONS                                 13670000
139000*DMH     VARYING PV-SUB                                           13680000
139100*DMH     FROM PV-SUB BY -1                                        13690000
139200*DMH     UNTIL PV-SUB < +1                                        13700000
139300                                                                  13710000
139400     IF  PS-NO-ERROR                                              13720000
139500         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        13730000
139600     END-IF.                                                      13740000
139700*                                                                 13750000
139800     IF  PS-NO-ERROR                                              13760000
139900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13770000
140000     END-IF.                                                      13780000
140100*                                                                 13790000
140200     IF  ((PS-NO-ERROR)                                           13800000
140300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13810000
140400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13820000
140500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13830000
140600     END-IF.                                                      13840000
140700                                                                  13850000
140800                                                                  13860000
140900*----------------------------------------------------------------*13870000
141000*   3005-EDIT-COMMAREA-BLOCKS                                    *13880000
141100*----------------------------------------------------------------*13890000
141200 3005-EDIT-COMMAREA-BLOCKS.                                       13900000
141300     MOVE +1                       TO PV-BLOCK-NUMBER.            13910000
141400     MOVE +1                       TO ASC-BLK-SUB.                13920000
141500     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               13930000
141600                                                                  13940000
141700     COMPUTE PV-BLOCK-NUMBER  =                                   13950000
141800        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 13960000
141900            PC-ITEMS-PER-PANEL.                                   13970000
142000                                                                  13980000
142100     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          13990000
142200                                                                  14000000
142300             PERFORM                                              14010000
142400               UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN  14020000
142500                  OR PS-ERROR                                     14030000
142600                  OR PS-BLOCK-ERROR                               14040000
142700                                                                  14050000
142800                     COMPUTE PV-ITEMS-HOLD  =                     14060000
142900                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        14070000
143000                     PC-ITEMS-PER-PANEL - 1                       14080000
143100                                                                  14090000
143200                 IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ   14100000
143300                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           14110000
143400                         FROM  PV-ITEMS-HOLD                      14120000
143500                       GIVING  PV-ITEMS-DIFF                      14130000
143600                     SUBTRACT  PV-ITEMS-DIFF                      14140000
143700                         FROM  PC-ITEMS-PER-PANEL                 14150000
143800                       GIVING  PV-ITEMS-HOLD                      14160000
143900                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              14170000
144000                                              ASC-ITEM-SUB        14180000
144100                                              ASC-ITEMS-DISPLAYED 14190000
144200                 ELSE                                             14200000
144300                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          14210000
144400                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    14220000
144500                 END-IF                                           14230000
144600                 PERFORM 3300-EDIT-SELECTIONS                     14240000
144700                     VARYING PV-SUB                               14250000
144800                        FROM PV-SUB BY -1                         14260000
144900                       UNTIL PV-SUB < +1                          14270000
145000                                                                  14280000
145100                 MOVE +1               TO ASC-BLK-SUB             14290000
145200                                                                  14300000
145300                 PERFORM 5105-REWRITE-ASC-LISTQ                   14310000
145400                                                                  14320000
145500                 MOVE +1                TO ASC-BLK-SUB            14330000
145600                                                                  14340000
145700                 IF  PS-BLOCK-ERROR                               14350000
145800                     SET  PS-ERROR     TO TRUE                    14360000
145900                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    14370000
146000                                       TO PV-TOP-ITEM             14380000
146100                 ELSE                                             14390000
146200                     ADD  +1            TO PV-BLOCK-NUMBER        14400000
146300                     IF  PV-BLOCK-NUMBER >                        14410000
146400                         ASC-HIGHEST-BLOCK-WRITTEN                14420000
146500                         MOVE +2        TO ASC-BLK-SUB            14430000
146600                         PERFORM 4410-READ-TEMP-STORAGE           14440000
146700                         MOVE +1        TO ASC-BLK-SUB            14450000
146800                     ELSE                                         14460000
146900                         PERFORM 4410-READ-TEMP-STORAGE           14470000
147000                         ADD  +1        TO PV-BLOCK-NUMBER        14480000
147100                         MOVE +2        TO ASC-BLK-SUB            14490000
147200                         PERFORM 4410-READ-TEMP-STORAGE           14500000
147300                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        14510000
147400                         MOVE +1        TO ASC-BLK-SUB            14520000
147500                     END-IF                                       14530000
147600                 END-IF                                           14540000
147700             END-PERFORM.                                         14550000
147800                                                                  14560000
147900             IF  PV-ORIGINAL-BLOCK  = +1    OR                    14570000
148000                 PS-ERROR                   OR                    14580000
148100                 PS-BLOCK-ERROR                                   14590000
148200                 CONTINUE                                         14600000
148300             ELSE                                                 14610000
148400                 MOVE +1                 TO PV-BLOCK-NUMBER       14620000
148500                 MOVE +1                 TO ASC-BLK-SUB           14630000
148600                 MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB          14640000
148700                 MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED   14650000
148800                 PERFORM 4410-READ-TEMP-STORAGE                   14660000
148900                                                                  14670000
149000                 PERFORM                                          14680000
149100                     UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK    14690000
149200                        OR PS-ERROR                               14700000
149300                        OR PS-BLOCK-ERROR                         14710000
149400                                                                  14720000
149500                     COMPUTE PV-ITEMS-HOLD  =                     14730000
149600                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    14740000
149700                         PC-ITEMS-PER-PANEL - 1                   14750000
149800                                                                  14760000
149900                     IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ 14770000
150000                         SUBTRACT  ASC-NUMBER-OF-ITEMS-READ       14780000
150100                            FROM  PV-ITEMS-HOLD                   14790000
150200                           GIVING  PV-ITEMS-DIFF                  14800000
150300                         SUBTRACT  PV-ITEMS-DIFF                  14810000
150400                             FROM  PC-ITEMS-PER-PANEL             14820000
150500                           GIVING  PV-ITEMS-HOLD                  14830000
150600                         MOVE  PV-ITEMS-HOLD TO PV-SUB            14840000
150700                                                 ASC-ITEM-SUB     14850000
150800                                               ASC-ITEMS-DISPLAYED14860000
150900                     ELSE                                         14870000
151000                         MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB      14880000
151100                         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB14890000
151200                     END-IF                                       14900000
151300                     PERFORM 3300-EDIT-SELECTIONS                 14910000
151400                         VARYING PV-SUB                           14920000
151500                            FROM PV-SUB BY -1                     14930000
151600                           UNTIL PV-SUB < +1                      14940000
151700                                                                  14950000
151800                     MOVE +1               TO ASC-BLK-SUB         14960000
151900                                                                  14970000
152000                     PERFORM 5105-REWRITE-ASC-LISTQ               14980000
152100                                                                  14990000
152200                     MOVE +1                TO ASC-BLK-SUB        15000000
152300                                                                  15010000
152400                     IF  PS-BLOCK-ERROR                           15020000
152500                         SET  PS-ERROR     TO TRUE                15030000
152600                         MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)15040000
152700                                           TO PV-TOP-ITEM         15050000
152800                     ELSE                                         15060000
152900                         ADD  +1            TO PV-BLOCK-NUMBER    15070000
153000                         IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK  15080000
153100                             MOVE +2        TO ASC-BLK-SUB        15090000
153200                             PERFORM 4410-READ-TEMP-STORAGE       15100000
153300                             MOVE +1        TO ASC-BLK-SUB        15110000
153400                         ELSE                                     15120000
153500                             PERFORM 4410-READ-TEMP-STORAGE       15130000
153600                             ADD  +1        TO PV-BLOCK-NUMBER    15140000
153700                             MOVE +2        TO ASC-BLK-SUB        15150000
153800                             PERFORM 4410-READ-TEMP-STORAGE       15160000
153900                             SUBTRACT +1  FROM PV-BLOCK-NUMBER    15170000
154000                             MOVE +1        TO ASC-BLK-SUB        15180000
154100                         END-IF                                   15190000
154200                     END-IF                                       15200000
154300                 END-PERFORM.                                     15210000
154400                                                                  15220000
154500                                                                  15230000
154600*----------------------------------------------------------------*15240000
154700*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *15250000
154800*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*15260000
154900*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *15270000
155000*                                                                *15280000
155100*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *15290000
155200*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *15300000
155300*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *15310000
155400*    US IN THE 2ND BLOCK OF THE ARRAY.                           *15320000
155500*----------------------------------------------------------------*15330000
155600                                                                  15340000
155700 3100-SET-SUBSCRIPTS.                                             15350000
155800                                                                  15360000
155900     COMPUTE ASC-ITEM-SUB =                                       15370000
156000         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15380000
156100                                                                  15390000
156200     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15400000
156300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15410000
156400                                                                  15420000
156500         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               15430000
156600     ELSE                                                         15440000
156700         MOVE +1                     TO ASC-BLK-SUB               15450000
156800     END-IF.                                                      15460000
156900******************************************************************15470000
157000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **15480000
157100******************************************************************15490000
157200                                                                  15500000
157300 3200-RESET-ATTRIBUTES.                                           15510000
157400     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15520000
157500     MOVE DP015-GREEN              TO ASTRTITC.                   15530000
157600     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15540000
157700*                                                                 15550000
157800     PERFORM                                                      15560000
157900         VARYING PV-SUB                                           15570000
158000         FROM 1 BY 1                                              15580000
158100         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        15590000
158200         MOVE DP015-UNP-ALP-NOR-OFF                               15600000
158300                                   TO MR-SELECTA (PV-SUB)         15610000
158400         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         15620000
158500         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         15630000
158600         MOVE DP015-HL-OFF         TO MR-VENDOR-IDH (PV-SUB)      15640000
158700         MOVE DP015-BLUE           TO MR-VENDOR-IDC (PV-SUB)      15650000
158800     END-PERFORM.                                                 15660000
158900******************************************************************15670000
159000** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **15680000
159100** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **15690000
159200** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **15700000
159300** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **15710000
159400******************************************************************15720000
159500 3300-EDIT-SELECTIONS.                                            15730000
159600     EVALUATE TRUE                                                15740000
159700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15750000
159800             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15760000
159900                 CONTINUE                                         15770000
160000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15780000
160100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15790000
160200                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   15800000
160300                 MOVE ASC-TEMP-SELECTED-SW                        15810000
160400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15820000
160500                                TO ASC-SELECTED-SW                15830000
160600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15840000
160700             END-IF                                               15850000
160800         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15860000
160900                 = SPACE                                          15870000
161000             EVALUATE TRUE                                        15880000
161100                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       15890000
161200                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS15900000
161300                     MOVE SPACE TO ASC-SELECTED-SW                15910000
161400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15920000
161500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        15930000
161600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    15940000
161700                     MOVE SPACE TO ASC-SELECTED-SW                15950000
161800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  15960000
161900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          15970000
162000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      15980000
162100                     MOVE SPACE TO ASC-SELECTED-SW                15990000
162200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16000000
162300             END-EVALUATE                                         16010000
162400         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16020000
162500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16030000
162600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16040000
162700             END-IF                                               16050000
162800             PERFORM 3310-EDIT-RANGE                              16060000
162900         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             16070000
163000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16080000
163100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16090000
163200             END-IF                                               16100000
163300             PERFORM 3310-EDIT-RANGE                              16110000
163400         WHEN OTHER                                               16120000
163500             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           16130000
163600             SET DP020-MSG-FATAL    TO TRUE                       16140000
163700             MOVE -1                TO MR-SELECTL (PV-SUB)        16150000
163800             SET DP030-SET-CURSOR-APPL-1                          16160000
163900                                    TO TRUE                       16170000
164000             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        16180000
164100             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        16190000
164200             SET PS-ERROR TO TRUE                                 16200000
164300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16210000
164400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     16220000
164500                 MOVE SPACE         TO ASC-SELECTED-SW            16230000
164600                                        (ASC-BLK-SUB ASC-ITEM-SUB)16240000
164700             END-IF                                               16250000
164800     END-EVALUATE.                                                16260000
164900                                                                  16270000
165000     EVALUATE TRUE                                                16280000
165100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              16290000
165200              EVALUATE TRUE                                       16300000
165300                  WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)      16310000
165400                       IF  ASC-NBR-OF-DEPTS                       16320000
165500                              (ASC-BLK-SUB ASC-ITEM-SUB) > 0      16330000
165600                           SET  ASC-NO-ERROR                      16340000
165700                                (ASC-BLK-SUB ASC-ITEM-SUB)        16350000
165800                                TO  TRUE                          16360000
165900                       ELSE                                       16370000
166000                           SET  ASC-NO-DEPT-ERR                   16380000
166100                                (ASC-BLK-SUB ASC-ITEM-SUB)        16390000
166200                                ASC-VENDOR-HAS-NO-DEPTS           16400000
166300                                PS-ERROR                          16410000
166400                                PS-BLOCK-ERROR  TO  TRUE          16420000
166500                           SET DP030-OVERRIDE-GO                  16430000
166600                                           TO TRUE                16440000
166700                           MOVE -1    TO MR-SELECTL (1)           16450000
166800                           MOVE PC-TSYMSG-02885                   16460000
166900                                           TO DP020-MSG-NUMBER    16470000
167000                           SET DP020-MSG-WARNING                  16480000
167100                                            TO TRUE               16490000
167200                       END-IF                                     16500000
167300                                                                  16510000
167400                  WHEN OTHER                                      16520000
167500                       SET  ASC-NO-ERROR                          16530000
167600                            (ASC-BLK-SUB ASC-ITEM-SUB)            16540000
167700                                TO  TRUE                          16550000
167800              END-EVALUATE                                        16560000
167900     END-EVALUATE.                                                16570000
168000                                                                  16580000
168100                                                                  16590000
168200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 16600000
168300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16610000
168400     IF  ASC-ITEM-SUB < 1                                         16620000
168500         SUBTRACT +1 FROM ASC-BLK-SUB                             16630000
168600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16640000
168700     END-IF.                                                      16650000
168800                                                                  16660000
168900                                                                  16670000
169000                                                                  16680000
169100                                                                  16690000
169200******************************************************************16700000
169300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **16710000
169400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **16720000
169500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**16730000
169600** THE ENDING.                                                  **16740000
169700******************************************************************16750000
169800 3310-EDIT-RANGE.                                                 16760000
169900     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16770000
170000         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16780000
170100             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16790000
170200                                   TO ASC-SELECTED-SW             16800000
170300                                        (ASC-BLK-SUB ASC-ITEM-SUB)16810000
170400             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16820000
170500         ELSE                                                     16830000
170600             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16840000
170700                 CONTINUE                                         16850000
170800             ELSE                                                 16860000
170900*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16870000
171000                 MOVE PC-TSYMSG-00054                             16880000
171100                                   TO DP020-MSG-NUMBER            16890000
171200                 SET DP020-MSG-FATAL                              16900000
171300                                   TO TRUE                        16910000
171400                 MOVE -1           TO MR-SELECTL (PV-SUB)         16920000
171500                 SET DP030-SET-CURSOR-APPL-1                      16930000
171600                                   TO TRUE                        16940000
171700                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16950000
171800                 MOVE DP015-UNDERLINE                             16960000
171900                                   TO MR-SELECTH (PV-SUB)         16970000
172000                 SET PS-ERROR      TO TRUE                        16980000
172100             END-IF                                               16990000
172200         END-IF                                                   17000000
172300     ELSE                                                         17010000
172400         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17020000
172500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17030000
172600                                   TO ASC-SELECTED-SW             17040000
172700                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17050000
172800             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   17060000
172900         ELSE                                                     17070000
173000             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       17080000
173100                 CONTINUE                                         17090000
173200             ELSE                                                 17100000
173300*                -- ONLY ONE END-OF-RANGE ALLOWED --              17110000
173400                 MOVE PC-TSYMSG-00055                             17120000
173500                                   TO DP020-MSG-NUMBER            17130000
173600                 SET DP020-MSG-FATAL                              17140000
173700                                   TO TRUE                        17150000
173800                 MOVE -1           TO MR-SELECTL (PV-SUB)         17160000
173900                 SET DP030-SET-CURSOR-APPL-1                      17170000
174000                                   TO TRUE                        17180000
174100                 SET PS-ERROR      TO TRUE                        17190000
174200             END-IF                                               17200000
174300         END-IF                                                   17210000
174400     END-IF.                                                      17220000
174500*                                                                 17230000
174600******************************************************************17240000
174700** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **17250000
174800** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **17260000
174900******************************************************************17270000
175000 3400-CHECK-RANGE-SEQUENCE.                                       17280000
175100     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17290000
175200       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17300000
175300       AND  ASC-START-OF-SELECTED-RANGE >                         17310000
175400                                         ASC-END-OF-SELECTED-RANGE17320000
175500*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17330000
175600         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17340000
175700         SET DP020-MSG-FATAL TO TRUE                              17350000
175800         SET PS-ERROR TO TRUE                                     17360000
175900         PERFORM 3410-POSITION-AT-ERROR                           17370000
176000     END-IF.                                                      17380000
176100******************************************************************17390000
176200** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **17400000
176300** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **17410000
176400** SHOULD BE POSITIONED ON A RANGE ERROR.                       **17420000
176500******************************************************************17430000
176600 3410-POSITION-AT-ERROR.                                          17440000
176700     SET DP030-SET-CURSOR-APPL-1                                  17450000
176800                                   TO TRUE.                       17460000
176900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17470000
177000                    - PV-TOP-ITEM + 1.                            17480000
177100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17490000
177200         CONTINUE                                                 17500000
177300     ELSE                                                         17510000
177400         MOVE -1                   TO MR-SELECTL (PV-SUB)         17520000
177500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17530000
177600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17540000
177700     END-IF.                                                      17550000
177800*                                                                 17560000
177900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17570000
178000                    - PV-TOP-ITEM + 1.                            17580000
178100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17590000
178200         CONTINUE                                                 17600000
178300     ELSE                                                         17610000
178400         MOVE -1                   TO MR-SELECTL (PV-SUB)         17620000
178500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17630000
178600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17640000
178700     END-IF.                                                      17650000
178800 EJECT                                                            17660000
178900*----------------------------------------------------------------*17670000
179000*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17680000
179100*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17690000
179200*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17700000
179300*----------------------------------------------------------------*17710000
179400                                                                  17720000
179500 3500-MARK-RANGE-AS-SELECTED.                                     17730000
179600     MOVE +1                       TO  ASC-BLK-SUB.               17740000
179700     PERFORM 3510-MARK-SELECTED-INDS                              17750000
179800         VARYING ASC-ITEM-SUB                                     17760000
179900         FROM 1 BY 1                                              17770000
180000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17780000
180100                                                                  17790000
180200     ADD +1                        TO ASC-BLK-SUB.                17800000
180300     PERFORM 3510-MARK-SELECTED-INDS                              17810000
180400         VARYING ASC-ITEM-SUB                                     17820000
180500         FROM 1 BY 1                                              17830000
180600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17840000
180700                                                                  17850000
180800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17860000
180900                                   TO  PV-LIST-ITEM-NUMBER.       17870000
181000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17880000
181100         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17890000
181200               PC-ITEMS-PER-PANEL).                               17900000
181300                                                                  17910000
181400     MOVE ASC-START-OF-SELECTED-RANGE                             17920000
181500                                   TO PV-START-OF-SELECTED-RANGE. 17930000
181600     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17940000
181700         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17950000
181800               PC-ITEMS-PER-PANEL).                               17960000
181900                                                                  17970000
182000     MOVE ASC-END-OF-SELECTED-RANGE                               17980000
182100                                   TO  PV-END-OF-SELECTED-RANGE.  17990000
182200     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             18000000
182300         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    18010000
182400               PC-ITEMS-PER-PANEL).                               18020000
182500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             18030000
182600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             18040000
182700                                                                  18050000
182800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    18060000
182900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        18070000
183000         MOVE +1                   TO ASC-BLK-SUB                 18080000
183100         PERFORM 5100-WRITE-TEMP-STORAGE                          18090000
183200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18100000
183300             PV-FIRST-BLOCK-IN-ARRAY - 1                          18110000
183400                                                                  18120000
183500         PERFORM                                                  18130000
183600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18140000
183700                   PV-PREV-BLOCK-IN-ARRAY                         18150000
183800             MOVE PV-FIRST-BLOCK-IN-RANGE                         18160000
183900                                   TO PV-BLOCK-NUMBER             18170000
184000             PERFORM 4410-READ-TEMP-STORAGE                       18180000
184100             PERFORM 3510-MARK-SELECTED-INDS                      18190000
184200                 VARYING ASC-ITEM-SUB                             18200000
184300                 FROM 1 BY 1                                      18210000
184400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18220000
184500             PERFORM 5100-WRITE-TEMP-STORAGE                      18230000
184600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18240000
184700         END-PERFORM                                              18250000
184800                                                                  18260000
184900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18270000
185000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18280000
185100         PERFORM                                                  18290000
185200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18300000
185300                   PV-LAST-BLOCK-IN-RANGE                         18310000
185400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18320000
185500                                   TO PV-BLOCK-NUMBER             18330000
185600             PERFORM 4410-READ-TEMP-STORAGE                       18340000
185700             PERFORM 3510-MARK-SELECTED-INDS                      18350000
185800                 VARYING ASC-ITEM-SUB                             18360000
185900                 FROM 1 BY 1                                      18370000
186000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18380000
186100             PERFORM 5100-WRITE-TEMP-STORAGE                      18390000
186200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18400000
186300         END-PERFORM                                              18410000
186400                                                                  18420000
186500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18430000
186600                                   TO PV-BLOCK-NUMBER             18440000
186700         PERFORM 4410-READ-TEMP-STORAGE                           18450000
186800     END-IF.                                                      18460000
186900                                                                  18470000
187000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18480000
187100                                      ASC-END-OF-SELECTED-RANGE.  18490000
187200                                                                  18500000
187300 EJECT                                                            18510000
187400*----------------------------------------------------------------*18520000
187500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *18530000
187600*----------------------------------------------------------------*18540000
187700                                                                  18550000
187800 3510-MARK-SELECTED-INDS.                                         18560000
187900                                                                  18570000
188000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18580000
188100                                ASC-ITEM-SUB) >                   18590000
188200         ASC-START-OF-SELECTED-RANGE)                             18600000
188300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         18610000
188400                                ASC-ITEM-SUB) =                   18620000
188500         ASC-START-OF-SELECTED-RANGE)                             18630000
188600                                                                  18640000
188700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18650000
188800                                    ASC-ITEM-SUB) <               18660000
188900             ASC-END-OF-SELECTED-RANGE)                           18670000
189000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     18680000
189100                                    ASC-ITEM-SUB) =               18690000
189200             ASC-END-OF-SELECTED-RANGE)                           18700000
189300                                                                  18710000
189400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18720000
189500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18730000
189600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18740000
189700                               TO TRUE                            18750000
189800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18760000
189900                               TO TRUE                            18770000
190000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    18780000
190100             END-IF                                               18790000
190200         END-IF                                                   18800000
190300     END-IF.                                                      18810000
190400                                                                  18820000
190500 EJECT                                                            18830000
190600*----------------------------------------------------------------*18840000
190700*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18850000
190800*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18860000
190900*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18870000
191000*    DISPLAY THE PANEL TO USER.                                  *18880000
191100*----------------------------------------------------------------*18890000
191200                                                                  18900000
191300 4000-BUILD-INITIAL-PANEL.                                        18910000
191400                                                                  18920000
191500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            18930000
191600                                 ASC-BLOCK-ENTRIES (2).           18940000
191700     MOVE +1                 TO ASC-BLK-SUB.                      18950000
191800     SET ASC-ITEMS-LEFT-ON-DB                                     18960000
191900                             TO TRUE.                             18970000
192000                                                                  18980000
192100     MOVE +0                 TO ASC-ITEM-SUB                      18990000
192200                                ASC-NUMBER-OF-ITEMS-READ          19000000
192300                                ASC-NUMBER-OF-SELECTED-ITEMS      19010000
192400                                ASC-HIGHEST-BLOCK-WRITTEN         19020000
192500                                ASC-START-OF-SELECTED-RANGE       19030000
192600                                ASC-END-OF-SELECTED-RANGE         19040000
192700                                ASC-ITEM-AT-TOP-OF-PANEL.         19050000
192800     PERFORM 4100-PREPARE-CURSOR                                  19060000
192900                                                                  19070000
193000     PERFORM 4010-OPEN-CURSOR.                                    19080000
193100                                                                  19090000
193200     PERFORM 4300-READ-ITEMS-FROM-DB.                             19100000
193300                                                                  19110000
193400     PERFORM 4020-CLOSE-CURSOR.                                   19120000
193500                                                                  19130000
193600     MOVE +1                   TO  PV-TOP-ITEM.                   19140000
193700     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19150000
193800         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    19160000
193900         SET DP020-MSG-FATAL   TO  TRUE                           19170000
194000         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19180000
194100     ELSE                                                         19190000
194200         MOVE -1               TO MR-SELECTL (1)                  19200000
194300         SET DP030-SET-CURSOR-APPL-1                              19210000
194400                               TO TRUE                            19220000
194500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19230000
194600     END-IF.                                                      19240000
194700 EJECT                                                            19250000
194800*----------------------------------------------------------------*19260000
194900* OPEN THE TMESSAGE CURSOR.                                      *19270000
195000*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *19280000
195100*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *19290000
195200*   USER.                                                        *19300000
195300*----------------------------------------------------------------*19310000
195400                                                                  19320000
195500 4010-OPEN-CURSOR.                                                19330000
195600     PERFORM                                                      19340000
195700         WITH TEST AFTER                                          19350000
195800         VARYING PV-RETRY-COUNTER                                 19360000
195900         FROM 1 BY 1                                              19370000
196000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19380000
196100                   OR (SQLCODE = ZERO))                           19390000
196200         EVALUATE TRUE                                            19400000
196300             WHEN ASC-VENDOR-ALL-CURSOR                           19410000
196400                 MOVE 'CURSOR:  ALL-VENDOR-CSR'                   19420000
196500                                   TO DP013-MESSAGE-TEXT (2)      19430000
196600                 EXEC SQL                                         19440000
196700                      OPEN ALL-VENDOR-CSR                         19450000
196800                 END-EXEC                                         19460000
196900                                                                  19470000
197000             WHEN ASC-VENDOR-NAME-CURSOR                          19480000
197100                 MOVE 'CURSOR:  VENDOR-NAME-CSR'                  19490000
197200                                   TO DP013-MESSAGE-TEXT (2)      19500000
197300                 PERFORM 4050-PREPARE-CURSOR-KEY                  19510000
197400                 EXEC SQL                                         19520000
197500                      OPEN VENDOR-NAME-CSR                        19530000
197600                 END-EXEC                                         19540000
197700                                                                  19550000
197800             WHEN ASC-VENDOR-CURSOR                               19560000
197900                 MOVE 'CURSOR:  VENDOR-CSR'                       19570000
198000                                   TO DP013-MESSAGE-TEXT (2)      19580000
198100                 EXEC SQL                                         19590000
198200                      OPEN VENDOR-CSR                             19600000
198300                 END-EXEC                                         19610000
198400         END-EVALUATE                                             19620000
198500                                                                  19630000
198600         EVALUATE TRUE                                            19640000
198700             WHEN SQLCODE = ZERO                                  19650000
198800             WHEN SQLCODE = -904                                  19660000
198900             WHEN SQLCODE = -913                                  19670000
199000                 CONTINUE                                         19680000
199100             WHEN SQLWARN0 NOT = SPACES                           19690000
199200             WHEN SQLCODE < ZERO                                  19700000
199300             WHEN SQLCODE > ZERO                                  19710000
199400                 MOVE '4010-OPEN-CURSOR'                          19720000
199500                                   TO DP013-PARAGRAPH             19730000
199600                 MOVE 'OPEN SYSTEM MESSAGE CURSOR - '             19740000
199700                                   TO DP013-MESSAGE-TEXT (1)      19750000
199800                 MOVE SQLCA        TO DP013-SQLCA                 19760000
199900                 MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)    19770000
200000                 MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (2)    19780000
200100                 SET DP013-DB2-ABEND                              19790000
200200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19800000
200300                 PERFORM DP013-0000-PROCESS-ABEND                 19810000
200400         END-EVALUATE                                             19820000
200500     END-PERFORM.                                                 19830000
200600*                                                                 19840000
200700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19850000
200800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             19860000
200900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   19870000
201000                                   TO DP013-MESSAGE-TEXT (1)      19880000
201100         MOVE SQLCA                TO DP013-SQLCA                 19890000
201200         MOVE 'TEXTENT '           TO DP013-DB2-TABLE-NAME (1)    19900000
201300         MOVE 'TENTNME '           TO DP013-DB2-TABLE-NAME (2)    19910000
201400         SET DP013-DB2-ABEND                                      19920000
201500             DP013-XCTL-DISPLAY-RESTART                           19930000
201600                                   TO TRUE                        19940000
201700         PERFORM DP013-0000-PROCESS-ABEND                         19950000
201800     END-IF.                                                      19960000
201900                                                                  19970000
202000 EJECT                                                            19980000
202100*----------------------------------------------------------------*19990000
202200* CLOSE THE TMESSAGE CURSOR.                                     *20000000
202300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *20010000
202400*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *20020000
202500*   USER.                                                        *20030000
202600*----------------------------------------------------------------*20040000
202700                                                                  20050000
202800 4020-CLOSE-CURSOR.                                               20060000
202900     EVALUATE TRUE                                                20070000
203000         WHEN ASC-VENDOR-ALL-CURSOR                               20080000
203100             EXEC SQL                                             20090000
203200                 CLOSE ALL-VENDOR-CSR                             20100000
203300             END-EXEC                                             20110000
203400                                                                  20120000
203500         WHEN ASC-VENDOR-NAME-CURSOR                              20130000
203600             EXEC SQL                                             20140000
203700                 CLOSE VENDOR-NAME-CSR                            20150000
203800             END-EXEC                                             20160000
203900                                                                  20170000
204000         WHEN ASC-VENDOR-CURSOR                                   20180000
204100             EXEC SQL                                             20190000
204200                 CLOSE VENDOR-CSR                                 20200000
204300             END-EXEC                                             20210000
204400     END-EVALUATE.                                                20220000
204500*                                                                 20230000
204600     EVALUATE TRUE                                                20240000
204700         WHEN SQLCODE = ZERO                                      20250000
204800             CONTINUE                                             20260000
204900         WHEN SQLWARN0 NOT = SPACES                               20270000
205000         WHEN SQLCODE < ZERO                                      20280000
205100         WHEN SQLCODE > ZERO                                      20290000
205200             MOVE '4020-CLOSE-CURSOR'                             20300000
205300                               TO DP013-PARAGRAPH                 20310000
205400             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  20320000
205500                               TO DP013-MESSAGE-TEXT (1)          20330000
205600             MOVE SQLCA        TO DP013-SQLCA                     20340000
205700             MOVE 'TEXTENT '   TO DP013-DB2-TABLE-NAME (1)        20350000
205800             MOVE 'TENTNME '   TO DP013-DB2-TABLE-NAME (2)        20360000
205900             SET DP013-DB2-ABEND                                  20370000
206000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20380000
206100             PERFORM DP013-0000-PROCESS-ABEND                     20390000
206200     END-EVALUATE.                                                20400000
206300                                                                  20410000
206400*----------------------------------------------------------------*20420000
206500* PREPARE THE DB KEY BY REPLACING * WITH %                       *20430000
206600*----------------------------------------------------------------*20440000
206700 4050-PREPARE-CURSOR-KEY.                                         20450000
206800                                                                  20460000
206900     MOVE ASC-VENDOR-DESC      TO DK-VENDOR-DESC.                 20470000
207000     IF DK-VENDOR-DESC > SPACES                                   20480000
207100         IF DK-VEND-DESC-BYTE (1) = '*'                           20490000
207200             MOVE PC-PERCENT   TO DK-VEND-DESC-BYTE (1)           20500000
207300             INSPECT DK-VENDOR-DESC                               20510000
207400                 REPLACING FIRST '*' BY PC-PERCENT                20520000
207500         END-IF                                                   20530000
207600         SET PS-NOT-DONE TO TRUE                                  20540000
207700         PERFORM VARYING PV-SUB                                   20550000
207800             FROM LENGTH OF DK-VENDOR-DESC BY -1                  20560000
207900             UNTIL PV-SUB = 1                                     20570000
208000                OR PS-DONE                                        20580000
208100                 IF DK-VEND-DESC-BYTE (PV-SUB) = '*'              20590000
208200                     MOVE PC-PERCENT TO DK-VEND-DESC-BYTE (PV-SUB)20600000
208300                     SET PS-DONE TO TRUE                          20610000
208400                 END-IF                                           20620000
208500                 IF DK-VEND-DESC-BYTE (PV-SUB) > SPACES           20630000
208600                     SET PS-DONE TO TRUE                          20640000
208700                 ELSE                                             20650000
208800                     MOVE PC-PERCENT TO DK-VEND-DESC-BYTE (PV-SUB)20660000
208900                 END-IF                                           20670000
209000         END-PERFORM                                              20680000
209100     ELSE                                                         20690000
209200         MOVE ALL '%' TO DK-VENDOR-DESC.                          20700000
209300                                                                  20710000
209400 EJECT                                                            20720000
209500*----------------------------------------------------------------*20730000
209600*    SET UP THE HOST VARIABLES.                                  *20740000
209700*----------------------------------------------------------------*20750000
209800                                                                  20760000
209900 4100-PREPARE-CURSOR.                                             20770000
210000                                                                  20780000
210100     SET ASC-NO-CURSOR         TO TRUE.                           20790000
210200                                                                  20800000
210300     IF  DK-ENT-ID GREATER THAN ZERO                              20810000
210400         SET ASC-VENDOR-CURSOR                                    20820000
210500                               TO TRUE                            20830000
210600     ELSE                                                         20840000
210700         IF  DK-VENDOR-DESC GREATER THAN SPACES                   20850000
210800             SET                                                  20860000
210900                 ASC-VENDOR-NAME-CURSOR                           20870000
211000                                   TO TRUE                        20880000
211100         ELSE                                                     20890000
211200             SET ASC-VENDOR-ALL-CURSOR  TO TRUE                   20900000
211300         END-IF                                                   20910000
211400     END-IF.                                                      20920000
211500                                                                  20930000
211600                                                                  20940000
211700 EJECT                                                            20950000
211800*----------------------------------------------------------------*20960000
211900*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20970000
212000*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20980000
212100*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20990000
212200*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *21000000
212300*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *21010000
212400*                                                                *21020000
212500*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *21030000
212600*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *21040000
212700*    UPON INITIALIZATION.                                        *21050000
212800*----------------------------------------------------------------*21060000
212900                                                                  21070000
213000 4300-READ-ITEMS-FROM-DB.                                         21080000
213100                                                                  21090000
213200     PERFORM                                                      21100000
213300         VARYING PV-READ-COUNT                                    21110000
213400         FROM 1 BY 1                                              21120000
213500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    21130000
213600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21140000
213700                                                                  21150000
213800         PERFORM 4310-FETCH                                       21160000
213900                                                                  21170000
214000         IF  ASC-ITEMS-LEFT-ON-DB                                 21180000
214100             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                21190000
214200                 ADD +1            TO ASC-ITEM-SUB                21200000
214300             ELSE                                                 21210000
214400                 ADD +1            TO ASC-BLK-SUB                 21220000
214500                 MOVE +1           TO ASC-ITEM-SUB                21230000
214600                                                                  21240000
214700                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         21250000
214800                     MOVE +1       TO ASC-BLK-SUB                 21260000
214900                     SET ASC-BLOCK-MODIFIED (1)                   21270000
215000                                   TO TRUE                        21280000
215100                     PERFORM 5100-WRITE-TEMP-STORAGE              21290000
215200                     MOVE ASC-BLOCK-ENTRIES                       21300000
215300                               (PC-MAX-BLOCKS-IN-ARRAY)           21310000
215400                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21320000
215500                     ADD +1        TO ASC-BLK-SUB                 21330000
215600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   21340000
215700                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      21350000
215800                                   TO TRUE                        21360000
215900                 END-IF                                           21370000
216000             END-IF                                               21380000
216100             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21390000
216200             MOVE ASC-NUMBER-OF-ITEMS-READ                        21400000
216300                                   TO ASC-LIST-ITEM-NUMBER        21410000
216400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21420000
216500             MOVE EXTENT-ENT-ID    TO ASC-LINE-ENT-ID             21430000
216600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21440000
216700                                      DK-ENT-ID                   21450000
216800             MOVE ENTNME-ENT-NAME-DESC                            21460000
216900                                   TO ASC-VENDOR-NAME             21470000
217000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21480000
217100             PERFORM 4500-PROCESS-RANKINGS-CURSOR                 21490000
217200             MOVE PV-BULK-VND-RNKG-CDE                            21500000
217300                               TO  ASC-BULK-VND-RNKG-CDE          21510000
217400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21520000
217500             MOVE PV-PREPACK-VND-RNKG-CDE                         21530000
217600                               TO  ASC-PREPACK-VND-RNKG-CDE       21540000
217700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21550000
217800             MOVE PV-PBS-VND-RNKG-CDE                             21560000
217900                               TO  ASC-PBS-VND-RNKG-CDE           21570000
218000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21580000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
217800             MOVE PV-RFID-VND-RNKG-CDE                            21560000
217900                               TO  ASC-RFID-VND-RNKG-CDE          21570000
218000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21580000
      *CLP 10/01/13 END   - PR# 5148D                                           
218100             PERFORM 4570-COUNT-DEPARTMENTS                       21590000
218200             MOVE PV-COUNT-DEPT-RANKGS                            21600000
218300                               TO  ASC-DEPT-RNKG-NBR              21610000
218400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21620000
218500             PERFORM 4575-COUNT-VNDR-DEPTS                        21630000
218600             MOVE PV-COUNT-VNDR-DEPTS                             21640000
218700                               TO  ASC-NBR-OF-DEPTS               21650000
218800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21660000
218900         END-IF                                                   21670000
219000     END-PERFORM.                                                 21680000
219100                                                                  21690000
219200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          21700000
219300         MOVE +1               TO ASC-BLK-SUB                     21710000
219400         PERFORM 5100-WRITE-TEMP-STORAGE                          21720000
219500         ADD +1                TO ASC-BLK-SUB                     21730000
219600         PERFORM 5100-WRITE-TEMP-STORAGE                          21740000
219700                                                                  21750000
219800         MOVE 1                TO ASC-BLK-SUB                     21760000
219900                                  PV-BLOCK-NUMBER                 21770000
220000         PERFORM 4410-READ-TEMP-STORAGE                           21780000
220100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             21790000
220200             MOVE 2            TO ASC-BLK-SUB                     21800000
220300                                  PV-BLOCK-NUMBER                 21810000
220400             PERFORM 4410-READ-TEMP-STORAGE                       21820000
220500         END-IF                                                   21830000
220600     END-IF.                                                      21840000
220700 EJECT                                                            21850000
220800*----------------------------------------------------------------*21860000
220900*    FETCH THE MESSAGE CURSOR.                                   *21870000
221000*----------------------------------------------------------------*21880000
221100                                                                  21890000
221200 4310-FETCH.                                                      21900000
221300                                                                  21910000
221400     EVALUATE TRUE                                                21920000
221500         WHEN ASC-VENDOR-NAME-CURSOR                              21930000
221600              EXEC SQL                                            21940000
221700                   FETCH VENDOR-NAME-CSR                          21950000
221800                   INTO  :EXTENT-ENT-ID                           21960000
221900                       , :ENTNME-ENT-NAME-DESC                    21970000
222000              END-EXEC                                            21980000
222100                                                                  21990000
222200         WHEN ASC-VENDOR-ALL-CURSOR                               22000000
222300              EXEC SQL                                            22010000
222400                   FETCH ALL-VENDOR-CSR                           22020000
222500                   INTO  :EXTENT-ENT-ID                           22030000
222600                       , :ENTNME-ENT-NAME-DESC                    22040000
222700              END-EXEC                                            22050000
222800                                                                  22060000
222900         WHEN ASC-VENDOR-CURSOR                                   22070000
223000              EXEC SQL                                            22080000
223100                   FETCH VENDOR-CSR                               22090000
223200                   INTO  :EXTENT-ENT-ID                           22100000
223300                       , :ENTNME-ENT-NAME-DESC                    22110000
223400              END-EXEC                                            22120000
223500     END-EVALUATE.                                                22130000
223600                                                                  22140000
223700     EVALUATE TRUE                                                22150000
223800         WHEN SQLCODE = ZERO                                      22160000
223900         WHEN SQLCODE = +100                                      22170000
224000              CONTINUE                                            22180000
224100         WHEN SQLWARN0 NOT = SPACE                                22190000
224200         WHEN SQLCODE NOT = ZERO                                  22200000
224300              MOVE '4310-FETCH-CURSOR'                            22210000
224400                               TO DP013-PARAGRAPH                 22220000
224500              MOVE 'FETCH MESSAGE CURSOR'                         22230000
224600                               TO DP013-MESSAGE-TEXT (1)          22240000
224700              MOVE SQLCA       TO DP013-SQLCA                     22250000
224800              SET DP013-DB2-ABEND                                 22260000
224900                               TO TRUE                            22270000
225000              PERFORM DP013-0000-PROCESS-ABEND                    22280000
225100     END-EVALUATE.                                                22290000
225200                                                                  22300000
225300     IF  SQLCODE EQUAL +100                                       22310000
225400         SET ASC-NO-ITEMS-LEFT-ON-DB                              22320000
225500                                   TO TRUE                        22330000
225600     END-IF.                                                      22340000
225700                                                                  22350000
225800 EJECT                                                            22360000
225900*----------------------------------------------------------------*22370000
226000* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *22380000
226100*----------------------------------------------------------------*22390000
226200                                                                  22400000
226300 4400-MOVE-COMMAREA-TO-SCREEN.                                    22410000
226400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             22420000
226500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          22430000
226600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          22440000
226700             MOVE +1    TO ASC-BLK-SUB                            22450000
226800             PERFORM 5100-WRITE-TEMP-STORAGE                      22460000
226900             ADD +1     TO ASC-BLK-SUB                            22470000
227000             PERFORM 5100-WRITE-TEMP-STORAGE                      22480000
227100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             22490000
227200                 GIVING PV-BLOCK-NUMBER                           22500000
227300                 REMAINDER PV-REMAINDER                           22510000
227400             IF  PV-REMAINDER > ZERO                              22520000
227500                 ADD +1 TO PV-BLOCK-NUMBER                        22530000
227600             END-IF                                               22540000
227700             MOVE +1    TO ASC-BLK-SUB                            22550000
227800             PERFORM 4410-READ-TEMP-STORAGE                       22560000
227900             ADD +1     TO ASC-BLK-SUB                            22570000
228000                           PV-BLOCK-NUMBER                        22580000
228100             PERFORM 4410-READ-TEMP-STORAGE                       22590000
228200     END-IF.                                                      22600000
228300     MOVE +1            TO ASC-BLK-SUB.                           22610000
228400     COMPUTE ASC-ITEM-SUB =                                       22620000
228500         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22630000
228600         + PC-ITEMS-PER-PANEL).                                   22640000
228700*                                                                 22650000
228800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22660000
228900         ADD +1         TO ASC-BLK-SUB                            22670000
229000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22680000
229100     END-IF.                                                      22690000
229200*                                                                 22700000
229300     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22710000
229400         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22720000
229500     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22730000
229600     PERFORM 4420-FORMAT-LIST-LINES                               22740000
229700         VARYING PV-SUB                                           22750000
229800         FROM PC-ITEMS-PER-PANEL BY -1                            22760000
229900         UNTIL PV-SUB < +1.                                       22770000
230000*                                                                 22780000
230100     COMPUTE ASC-ITEMS-DISPLAYED =                                22790000
230200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22800000
230300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22810000
230400                                      ASTRTITO.                   22820000
230500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22830000
230600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22840000
230700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22850000
230800                                   TO ASELITO.                    22860000
230900*                                                                 22870000
231000     IF  DP020-MSG-NUMBER-X = SPACE                               22880000
231100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22890000
231200*            --- MORE ITEMS TO DISPLAY ----                       22900000
231300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22910000
231400             SET DP020-MSG-INFORMATIONAL TO TRUE                  22920000
231500         END-IF                                                   22930000
231600     END-IF.                                                      22940000
231700*----------------------------------------------------------------*22950000
231800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22960000
231900*----------------------------------------------------------------*22970000
232000                                                                  22980000
232100 4410-READ-TEMP-STORAGE.                                          22990000
232200                                                                  23000000
232300     EXEC CICS                                                    23010000
232400         READQ TS                                                 23020000
232500             QUEUE (ASC-LIST-QUEUE-NAME)                          23030000
232600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               23040000
232700             ITEM  (PV-BLOCK-NUMBER)                              23050000
232800             RESP  (PV-CICS-RESP)                                 23060000
232900     END-EXEC.                                                    23070000
233000                                                                  23080000
233100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       23090000
233200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     23100000
233300         CONTINUE                                                 23110000
233400     ELSE                                                         23120000
233500         SET DP013-CICS-ABEND     TO TRUE                         23130000
233600         SET DP013-NO-ROLLBACK    TO TRUE                         23140000
233700         MOVE '4410-READ-TEMP-STORAGE'                            23150000
233800                                  TO DP013-PARAGRAPH              23160000
233900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      23170000
234000                                  TO DP013-MESSAGE-TEXT(1)        23180000
234100         PERFORM DP013-0000-PROCESS-ABEND                         23190000
234200     END-IF.                                                      23200000
234300                                                                  23210000
234400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23220000
234500*                                                                 23230000
234600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         23240000
234700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               23250000
234800     END-IF.                                                      23260000
234900 EJECT                                                            23270000
235000*----------------------------------------------------------------*23280000
235100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *23290000
235200*----------------------------------------------------------------*23300000
235300                                                                  23310000
235400 4420-FORMAT-LIST-LINES.                                          23320000
235500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      23330000
235600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                23340000
235700         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           23350000
235800         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           23360000
235900         MOVE SPACE              TO MR-SELECTI (PV-SUB)           23370000
236000                                    MR-ACTION (PV-SUB)            23380000
236100                                    MR-VENDOR-ID-X (PV-SUB)       23390000
236200                                    MR-VENDOR-NAME (PV-SUB)       23400000
236300                                    MR-BULK-RANKING (PV-SUB)      23410000
236400                                    MR-PREPACK-RANKING (PV-SUB)   23420000
236500                                    MR-PBS-RANKING (PV-SUB)       23430000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
236500                                    MR-RFID-RANKING (PV-SUB)      23430000
      *CLP 10/01/13 END   - PR# 5148D                                           
236600                                    MR-DEPT-RANKING-X (PV-SUB)    23440000
236700     ELSE                                                         23450000
236800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23460000
236900                                                   > SPACE        23470000
237000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23480000
237100                                 TO MR-SELECTI (PV-SUB)           23490000
237200         ELSE                                                     23500000
237300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23510000
237400                                 TO MR-SELECTI (PV-SUB)           23520000
237500         END-IF                                                   23530000
237600*                                                                 23540000
237700         IF  DP030-SET-CURSOR-TRAILER                             23550000
237800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23560000
237900                 > SPACE)                                         23570000
238000               OR (PV-SUB = 1))                                   23580000
238100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23590000
238200                MOVE -1          TO MR-SELECTL (PV-SUB)           23600000
238300             END-IF                                               23610000
238400         END-IF                                                   23620000
238500*                                                                 23630000
238600         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           23640000
238700             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           23650000
238800                                 TO MR-ACTION (PV-SUB)            23660000
238900             MOVE ASC-LINE-ENT-ID (ASC-BLK-SUB ASC-ITEM-SUB)      23670000
239000                                 TO MR-VENDOR-ID (PV-SUB)         23680000
239100             MOVE ASC-VENDOR-NAME (ASC-BLK-SUB ASC-ITEM-SUB)      23690000
239200                                 TO MR-VENDOR-NAME (PV-SUB)       23700000
239300             MOVE ASC-BULK-VND-RNKG-CDE (ASC-BLK-SUB ASC-ITEM-SUB)23710000
239400                                 TO MR-BULK-RANKING (PV-SUB)      23720000
239500             MOVE ASC-PREPACK-VND-RNKG-CDE                        23730000
239600                                        (ASC-BLK-SUB ASC-ITEM-SUB)23740000
239700                                 TO MR-PREPACK-RANKING (PV-SUB)   23750000
239800             MOVE ASC-PBS-VND-RNKG-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)23760000
239900                                 TO MR-PBS-RANKING (PV-SUB)       23770000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
239800             MOVE ASC-RFID-VND-RNKG-CDE (ASC-BLK-SUB ASC-ITEM-SUB)23760000
239900                                 TO MR-RFID-RANKING (PV-SUB)      23770000
      *CLP 10/01/13 END   - PR# 5148D                                           
240000             MOVE ASC-DEPT-RNKG-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)23780000
240100                                 TO MR-DEPT-RANKING (PV-SUB)      23790000
240200         END-IF                                                   23800000
240300     END-IF.                                                      23810000
240400                                                                  23820000
240500     IF  ASC-VENDOR-HAS-NO-DEPTS  AND                             23830000
240600         ASC-NO-DEPT-ERR (ASC-BLK-SUB ASC-ITEM-SUB)               23840000
240700             MOVE DP015-REVERSE    TO MR-VENDOR-IDH (PV-SUB)      23850000
240800             MOVE DP015-RED        TO MR-VENDOR-IDC (PV-SUB)      23860000
240900     END-IF                                                       23870000
241000                                                                  23880000
241100     SUBTRACT +1 FROM ASC-ITEM-SUB                                23890000
241200     IF  ASC-ITEM-SUB < + 1                                       23900000
241300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  23910000
241400         MOVE +1                 TO ASC-BLK-SUB                   23920000
241500     END-IF.                                                      23930000
241600******************************************************************23940000
241700** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **23950000
241800** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **23960000
241900** ISSUE A WARNING.                                             **23970000
242000******************************************************************23980000
242100 4430-CHECK-FOR-BEGIN-AND-END.                                    23990000
242200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       24000000
242300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     24010000
242400*            -- NO END-OF-RANGE SPECFIED ---                      24020000
242500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            24030000
242600             SET DP020-MSG-WARNING TO TRUE                        24040000
242700             PERFORM 4431-POSITION-AT-WARNING                     24050000
242800         END-IF                                                   24060000
242900     ELSE                                                         24070000
243000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     24080000
243100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                24090000
243200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            24100000
243300             SET DP020-MSG-WARNING TO TRUE                        24110000
243400             PERFORM 4431-POSITION-AT-WARNING                     24120000
243500         END-IF                                                   24130000
243600     END-IF.                                                      24140000
243700******************************************************************24150000
243800** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **24160000
243900** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **24170000
244000** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **24180000
244100** POSITION THE CURSOR THERE.                                   **24190000
244200******************************************************************24200000
244300 4431-POSITION-AT-WARNING.                                        24210000
244400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 24220000
244500                    - PV-TOP-ITEM + 1.                            24230000
244600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24240000
244700         CONTINUE                                                 24250000
244800     ELSE                                                         24260000
244900         SET DP030-SET-CURSOR-APPL-1                              24270000
245000                                   TO TRUE                        24280000
245100         MOVE -1                   TO MR-SELECTL (PV-SUB)         24290000
245200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24300000
245300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24310000
245400     END-IF.                                                      24320000
245500*                                                                 24330000
245600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24340000
245700                    - PV-TOP-ITEM + 1.                            24350000
245800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24360000
245900         CONTINUE                                                 24370000
246000     ELSE                                                         24380000
246100         SET DP030-SET-CURSOR-APPL-1                              24390000
246200                                   TO TRUE                        24400000
246300         MOVE -1                   TO MR-SELECTL (PV-SUB)         24410000
246400         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24420000
246500         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24430000
246600     END-IF.                                                      24440000
246700 4500-PROCESS-RANKINGS-CURSOR.                                    24450000
246800     MOVE 'DEFALT'  TO PV-BULK-VND-RNKG-CDE                       24460000
246900                       PV-PREPACK-VND-RNKG-CDE                    24470000
247000                       PV-PBS-VND-RNKG-CDE                        24480000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
247000                       PV-RFID-VND-RNKG-CDE.                      24480000
      *CLP 10/01/13 END   - PR# 5148D                                           
247100      SET PS-NOT-END-OF-RANKINGS TO TRUE.                         24490000
247200      PERFORM 4510-OPEN-RANKINGS-CSR.                             24500000
247300      PERFORM 4530-FETCH-RANKINGS-CSR                             24510000
247400          UNTIL PS-END-OF-RANKINGS.                               24520000
247500      PERFORM 4550-CLOSE-RANKINGS-CSR.                            24530000
247600                                                                  24540000
247700 4510-OPEN-RANKINGS-CSR.                                          24550000
247800     PERFORM                                                      24560000
247900         WITH TEST AFTER                                          24570000
248000         VARYING PV-RETRY-COUNTER                                 24580000
248100         FROM 1 BY 1                                              24590000
248200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24600000
248300                   OR (SQLCODE = ZERO))                           24610000
248400                 MOVE 'CURSOR:  ALL-VENDOR-CSR'                   24620000
248500                                   TO DP013-MESSAGE-TEXT (2)      24630000
248600             EXEC SQL                                             24640000
248700                  OPEN RANKINGS-CSR                               24650000
248800             END-EXEC                                             24660000
248900                                                                  24670000
249000                                                                  24680000
249100         EVALUATE TRUE                                            24690000
249200             WHEN SQLCODE = ZERO                                  24700000
249300             WHEN SQLCODE = -904                                  24710000
249400             WHEN SQLCODE = -913                                  24720000
249500                 CONTINUE                                         24730000
249600             WHEN SQLWARN0 NOT = SPACES                           24740000
249700             WHEN SQLCODE < ZERO                                  24750000
249800             WHEN SQLCODE > ZERO                                  24760000
249900                 MOVE '4510-OPEN-RANKINGS-CSR'                    24770000
250000                                   TO DP013-PARAGRAPH             24780000
250100                 MOVE 'OPEN THE RANKINGS CURSOR - '               24790000
250200                                   TO DP013-MESSAGE-TEXT (1)      24800000
250300                 MOVE SQLCA        TO DP013-SQLCA                 24810000
250400                 MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)    24820000
250500                 SET DP013-DB2-ABEND                              24830000
250600                     DP013-XCTL-DISPLAY-RESTART TO TRUE           24840000
250700                 PERFORM DP013-0000-PROCESS-ABEND                 24850000
250800         END-EVALUATE                                             24860000
250900     END-PERFORM.                                                 24870000
251000*                                                                 24880000
251100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24890000
251200         MOVE '4510-OPEN-RANKINGS-CSR'                            24900000
251300                                   TO DP013-PARAGRAPH             24910000
251400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   24920000
251500                                   TO DP013-MESSAGE-TEXT (1)      24930000
251600         MOVE SQLCA                TO DP013-SQLCA                 24940000
251700         MOVE 'SUT00017'           TO DP013-DB2-TABLE-NAME (1)    24950000
251800         SET DP013-DB2-ABEND                                      24960000
251900             DP013-XCTL-DISPLAY-RESTART                           24970000
252000                                   TO TRUE                        24980000
252100         PERFORM DP013-0000-PROCESS-ABEND                         24990000
252200     END-IF.                                                      25000000
252300                                                                  25010000
252400 EJECT                                                            25020000
252500 4530-FETCH-RANKINGS-CSR.                                         25030000
252600                                                                  25040000
252700     EXEC SQL                                                     25050000
252800          FETCH RANKINGS-CSR                                      25060000
252900          INTO  :SUT00017-VND-RNKG-CDE                            25070000
253000             ,  :SUT00017-PKGNG-TYP-CDE                           25080000
253100     END-EXEC.                                                    25090000
253200                                                                  25100000
253300     EVALUATE TRUE                                                25110000
253400         WHEN SQLCODE = ZERO                                      25120000
253500             IF SUT00017-PKGNG-TYP-CDE = 'BC'                     25130000
253600                 MOVE SUT00017-VND-RNKG-CDE                       25140000
253700                              TO PV-BULK-VND-RNKG-CDE             25150000
253800             ELSE                                                 25160000
253900                 IF SUT00017-PKGNG-TYP-CDE = 'PP'                 25170000
254000                     MOVE SUT00017-VND-RNKG-CDE                   25180000
254100                                  TO PV-PREPACK-VND-RNKG-CDE      25190000
254200                 ELSE                                             25200000
254300                     IF SUT00017-PKGNG-TYP-CDE = 'PS'             25210000
254400                         MOVE SUT00017-VND-RNKG-CDE               25220000
254500                                      TO PV-PBS-VND-RNKG-CDE      25230000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
                           ELSE                                                 
254300                         IF SUT00017-PKGNG-TYP-CDE = 'RF'         25210000
254400                             MOVE SUT00017-VND-RNKG-CDE           25220000
254500                                          TO PV-RFID-VND-RNKG-CDE 25230000
254600                         END-IF                                   25240000
                           END-IF                                               
      *CLP 10/01/13 END   - PR# 5148D                                           
254700                 END-IF                                           25250000
254800             END-IF                                               25260000
254900         WHEN SQLCODE = +100                                      25270000
255000             SET PS-END-OF-RANKINGS TO TRUE                       25280000
255100         WHEN SQLWARN0 NOT = SPACE                                25290000
255200         WHEN SQLCODE NOT = ZERO                                  25300000
255300              MOVE '4530-FETCH-RANKINGS-CSR'                      25310000
255400                               TO DP013-PARAGRAPH                 25320000
255500              MOVE 'FETCH RANKINGS CURSOR'                        25330000
255600                               TO DP013-MESSAGE-TEXT (1)          25340000
255700              MOVE SQLCA       TO DP013-SQLCA                     25350000
255800              SET DP013-DB2-ABEND                                 25360000
255900                               TO TRUE                            25370000
256000              PERFORM DP013-0000-PROCESS-ABEND                    25380000
256100     END-EVALUATE.                                                25390000
256200                                                                  25400000
256300                                                                  25410000
256400*----------------------------------------------------------------*25420000
256500* CLOSE THE RANKINGS CURSOR                                      *25430000
256600*----------------------------------------------------------------*25440000
256700                                                                  25450000
256800 4550-CLOSE-RANKINGS-CSR.                                         25460000
256900     EXEC SQL                                                     25470000
257000         CLOSE RANKINGS-CSR                                       25480000
257100     END-EXEC.                                                    25490000
257200                                                                  25500000
257300*                                                                 25510000
257400     EVALUATE TRUE                                                25520000
257500         WHEN SQLCODE = ZERO                                      25530000
257600             CONTINUE                                             25540000
257700         WHEN SQLWARN0 NOT = SPACES                               25550000
257800         WHEN SQLCODE < ZERO                                      25560000
257900         WHEN SQLCODE > ZERO                                      25570000
258000             MOVE '4550-CLOSE-RANKINGS-CSR'                       25580000
258100                               TO DP013-PARAGRAPH                 25590000
258200             MOVE 'CLOSE THE RANKINGS CURSOR '                    25600000
258300                               TO DP013-MESSAGE-TEXT (1)          25610000
258400             MOVE SQLCA        TO DP013-SQLCA                     25620000
258500             MOVE 'SUT00017'   TO DP013-DB2-TABLE-NAME (1)        25630000
258600             SET DP013-DB2-ABEND                                  25640000
258700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25650000
258800             PERFORM DP013-0000-PROCESS-ABEND                     25660000
258900     END-EVALUATE.                                                25670000
259000                                                                  25680000
259100 4570-COUNT-DEPARTMENTS.                                          25690000
259200                                                                  25700000
259300     EXEC SQL                                                     25710000
259400          SELECT COUNT(*)                                         25720000
259500          INTO   :PV-COUNT-DEPT-RANKGS                            25730000
259600          FROM   SUT_VND_DEPT_RNKG                                25740000
259700          WHERE  ENT_ID      = :DK-ENT-ID                         25750000
259800     END-EXEC.                                                    25760000
259900                                                                  25770000
260000     EVALUATE TRUE                                                25780000
260100         WHEN SQLCODE = ZERO                                      25790000
260200             CONTINUE                                             25800000
260300         WHEN SQLCODE = +100                                      25810000
260400             MOVE +0 TO PV-COUNT-DEPT-RANKGS                      25820000
260500         WHEN SQLWARN0 NOT = SPACE                                25830000
260600         WHEN SQLCODE NOT = ZERO                                  25840000
260700              MOVE '4570-COUNT-DEPARTMENTS'                       25850000
260800                               TO DP013-PARAGRAPH                 25860000
260900              MOVE 'COUNT DEPARTMENTS'                            25870000
261000                               TO DP013-MESSAGE-TEXT (1)          25880000
261100              MOVE SQLCA       TO DP013-SQLCA                     25890000
261200              SET DP013-DB2-ABEND                                 25900000
261300                               TO TRUE                            25910000
261400              PERFORM DP013-0000-PROCESS-ABEND                    25920000
261500     END-EVALUATE.                                                25930000
261600                                                                  25940000
261700                                                                  25950000
261800******************************************************************25960000
261900*  COUNT THE NUMBER OF DEPARTMENTS ASSOCIATED TO THE VENDOR      *25970000
262000******************************************************************25980000
262100 4575-COUNT-VNDR-DEPTS.                                           25990000
262200                                                                  26000000
262300     EXEC SQL                                                     26010000
262400          SELECT COUNT(*)                                         26020000
262500          INTO   :PV-COUNT-VNDR-DEPTS                             26030000
262600          FROM  TVNDDPT A                                         26040000
262700             ,  TMDSEAR B                                         26050000
262800             ,  TMDSEDP C                                         26060000
262900          WHERE A.ENT_ID            = :DK-ENT-ID                  26070000
263000            AND A.VND_DEPT_STAT_CD  = 'A'                         26080000
263100            AND A.DEPT_NBR          = B.DEPT_NBR                  26090000
263200            AND B.MDSELV_CDE        = 'DPT'                       26100000
263300            AND B.OPERCO_NBR        = '03'                        26110000
263400            AND (B.STRT_DTE        <= CURRENT DATE AND            26120000
263500                 B.END_DTE          > CURRENT DATE)               26130000
263600            AND B.MDSEAR_DKEY       = C.MDSEAR_DKEY               26140000
263700     END-EXEC.                                                    26150000
263800                                                                  26160000
263900     EVALUATE TRUE                                                26170000
264000         WHEN SQLCODE = ZERO                                      26180000
264100             CONTINUE                                             26190000
264200         WHEN SQLCODE = +100                                      26200000
264300             MOVE +0 TO PV-COUNT-DEPT-RANKGS                      26210000
264400         WHEN SQLWARN0 NOT = SPACE                                26220000
264500         WHEN SQLCODE NOT = ZERO                                  26230000
264600              MOVE '4575-COUNT-VNDR-DEPTS '                       26240000
264700                               TO DP013-PARAGRAPH                 26250000
264800              MOVE 'COUNT VENDOR DEPTS'                           26260000
264900                               TO DP013-MESSAGE-TEXT (1)          26270000
265000              MOVE SQLCA       TO DP013-SQLCA                     26280000
265100              SET DP013-DB2-ABEND                                 26290000
265200                               TO TRUE                            26300000
265300              PERFORM DP013-0000-PROCESS-ABEND                    26310000
265400     END-EVALUATE.                                                26320000
265500                                                                  26330000
265600 EJECT                                                            26340000
265700*----------------------------------------------------------------*26350000
265800* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *26360000
265900* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *26370000
266000* FOR THE SELECTED ITEMS QUEUE.                                  *26380000
266100*                                                                *26390000
266200* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *26400000
266300* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *26410000
266400* THE ARRAY IS FULL.                                             *26420000
266500*----------------------------------------------------------------*26430000
266600                                                                  26440000
266700 5000-PREPARE-SEL-QUEUE.                                          26450000
266800                                                                  26460000
266900     MOVE +1                   TO  ASC-BLK-SUB.                   26470000
267000     PERFORM 5100-WRITE-TEMP-STORAGE.                             26480000
267100     ADD +1                    TO  ASC-BLK-SUB.                   26490000
267200     PERFORM 5100-WRITE-TEMP-STORAGE.                             26500000
267300                                                                  26510000
267400     MOVE ASC-SEL-QUEUE-NAME   TO  SU018-SEL-QUEUE-NAME.          26520000
267500     PERFORM 6010-DELETE-SEL-QUEUE.                               26530000
267600                                                                  26540000
267700     SET ASC-UPDATE-TSQ        TO  TRUE.                          26550000
267800                                                                  26560000
267900     SET SU019-IDX             TO  1.                             26570000
268000     MOVE ZERO                 TO SU018-NUMBER-OF-TS-ITEMS.       26580000
268100     INITIALIZE SU019-SELECTED-ITEM-ARRAY.                        26590000
268200                                                                  26600000
268300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           26610000
268400             VARYING PV-ITEM                                      26620000
268500             FROM 1 BY 1                                          26630000
268600             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     26640000
268700                                                                  26650000
268800     IF DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)                    08400000
268900         CONTINUE                                                         
269000     ELSE                                                                 
269100     IF  SU019-IDX > 1                                            26660000
269200         PERFORM 5205-WRITE-SEL-QUEUE                             26670000
269300         ADD +1                TO SU018-NUMBER-OF-TS-ITEMS        26680000
269400     END-IF                                                       26690000
269500     END-IF.                                                      26690000
269600 EJECT                                                            26700000
269700*----------------------------------------------------------------*26710000
269800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *26720000
269900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *26730000
270000*----------------------------------------------------------------*26740000
270100                                                                  26750000
270200 5100-WRITE-TEMP-STORAGE.                                         26760000
270300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     26770000
270400                                   TO PV-LIST-ITEM-NUMBER.        26780000
270500     COMPUTE PV-BLOCK-NUMBER =                                    26790000
270600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    26800000
270700                                                                  26810000
270800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             26820000
270900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             26830000
271000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      26840000
271100             PERFORM 5105-REWRITE-ASC-LISTQ                       26850000
271200         END-IF                                                   26860000
271300     ELSE                                                         26870000
271400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       26880000
271500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            26890000
271600         PERFORM 5110-WRITE-ASC-LISTQ                             26900000
271700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   26910000
271800     END-IF.                                                      26920000
271900                                                                  26930000
272000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26940000
272100******************************************************************26950000
272200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **26960000
272300** SPECIFIC COMMAREA.                                           **26970000
272400******************************************************************26980000
272500 5105-REWRITE-ASC-LISTQ.                                          26990000
272600     EXEC CICS                                                    27000000
272700         WRITEQ TS                                                27010000
272800             QUEUE (ASC-LIST-QUEUE-NAME)                          27020000
272900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               27030000
273000             ITEM  (PV-BLOCK-NUMBER)                              27040000
273100             REWRITE                                              27050000
273200             RESP  (PV-CICS-RESP)                                 27060000
273300     END-EXEC.                                                    27070000
273400                                                                  27080000
273500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           27090000
273600         CONTINUE                                                 27100000
273700     ELSE                                                         27110000
273800         SET DP013-CICS-ABEND            TO TRUE                  27120000
273900         SET DP013-NO-ROLLBACK           TO TRUE                  27130000
274000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       27140000
274100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     27150000
274200                                         TO DP013-MESSAGE-TEXT(1) 27160000
274300         PERFORM DP013-0000-PROCESS-ABEND                         27170000
274400     END-IF.                                                      27180000
274500                                                                  27190000
274600******************************************************************27200000
274700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **27210000
274800** SPECIFIC COMMAREA.                                           **27220000
274900******************************************************************27230000
275000 5110-WRITE-ASC-LISTQ.                                            27240000
275100     EXEC CICS                                                    27250000
275200         WRITEQ TS                                                27260000
275300             QUEUE (ASC-LIST-QUEUE-NAME)                          27270000
275400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               27280000
275500             ITEM  (PV-BLOCK-NUMBER)                              27290000
275600             RESP  (PV-CICS-RESP)                                 27300000
275700     END-EXEC.                                                    27310000
275800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      27320000
275900         SET DP013-CICS-ABEND      TO TRUE                        27330000
276000         SET DP013-NO-ROLLBACK     TO TRUE                        27340000
276100         MOVE '5110-WRITE-ASC-LISTQ'                              27350000
276200                                   TO DP013-PARAGRAPH             27360000
276300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           27370000
276400                                   TO DP013-MESSAGE-TEXT(1)       27380000
276500         PERFORM DP013-0000-PROCESS-ABEND                         27390000
276600     END-IF.                                                      27400000
276700 EJECT                                                            27410000
276800*----------------------------------------------------------------*27420000
276900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *27430000
277000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *27440000
277100*----------------------------------------------------------------*27450000
277200                                                                  27460000
277300 5200-FILL-SEL-QUEUE-RECORD.                                      27470000
277400                                                                  27480000
277500     PERFORM 6112-READ-LIST-QUEUE.                                27490000
277600                                                                  27500000
277700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       27510000
277800         PERFORM                                                  27520000
277900         VARYING LQW-IDX                                          27530000
278000         FROM 1 BY 1                                              27540000
278100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            27550000
278200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          27560000
278300                                                                  27570000
278400             IF  LQW-SELECT (LQW-IDX)                             27580000
279600                                                                  27700100
279700                 EVALUATE TRUE                                    27700200
279800                 WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)      27701000
279900                     MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)          27620000
280000                                   TO SU019-ITEM (SU019-IDX)      27630000
280100                     MOVE LQW-LINE-ENT-ID (LQW-IDX)               27640000
280200                                   TO SU017-ENT-ID                27641000
280210                     MOVE LQW-VENDOR-NAME (LQW-IDX)               27670000
280220                                   TO SU017-VENDOR-DESC           27671000
280230                 WHEN OTHER                                               
280240                     MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                  
280250                                         TO SU019-ITEM (SU019-IDX)        
280260                     MOVE LQW-LINE-ENT-ID (LQW-IDX)                       
280270                                         TO SU019-ENT-ID                  
280280                                              (SU019-IDX)                 
280290                     MOVE LQW-VENDOR-NAME (LQW-IDX)                       
280291                                         TO SU019-VENDOR-DESC             
280292                                              (SU019-IDX)                 
280293                     MOVE SPACE    TO SU019-ACTION-SW (SU019-IDX)         
280310                 END-EVALUATE                                     27702000
280400                                                                  27703000
280500                 SET SU019-IDX UP BY 1                            27710000
280600                 IF  SU019-IDX > SU019-MAX-ITEMS                  27720000
280700                     PERFORM 5205-WRITE-SEL-QUEUE                 27730000
280800                     ADD +1        TO SU018-NUMBER-OF-TS-ITEMS    27740000
280900                     INITIALIZE SU019-SELECTED-ITEM-ARRAY         27750000
281000                     SET SU019-IDX TO  1                          27760000
281100                 END-IF                                           27770000
281200             END-IF                                               27790000
281300         END-PERFORM                                              27800000
281400     END-IF.                                                      27810000
281500                                                                  27820000
281600*----------------------------------------------------------------*27830000
281700*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *27840000
281800*----------------------------------------------------------------*27850000
281900                                                                  27860000
282000 5205-WRITE-SEL-QUEUE.                                            27870000
282100                                                                  27880000
282200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27890000
282300                                   TO SU019-SELECTED-ITEMS.       27900000
282400                                                                  27910000
282500     EXEC CICS                                                    27920000
282600          WRITEQ TS                                               27930000
282700              QUEUE (ASC-SEL-QUEUE-NAME)                          27940000
282800              FROM  (SU019-SELECT-RECORD)                         27950000
282900              ITEM  (PV-SEL-QUEUE-ITEM)                           27960000
283000              RESP  (PV-CICS-RESP)                                27970000
283100     END-EXEC.                                                    27980000
283200                                                                  27990000
283300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28000000
283400         CONTINUE                                                 28010000
283500     ELSE                                                         28020000
283600         SET DP013-CICS-ABEND      TO TRUE                        28030000
283700         SET DP013-NO-ROLLBACK     TO TRUE                        28040000
283800         MOVE '5205-WRITE-SEL-QUEUE'                              28050000
283900                                   TO DP013-PARAGRAPH             28060000
284000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          28070000
284100                                   TO DP013-MESSAGE-TEXT(1)       28080000
284200         PERFORM DP013-0000-PROCESS-ABEND                         28090000
284300     END-IF.                                                      28100000
284400 EJECT                                                            28110000
284500******************************************************************28120000
284600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **28130000
284700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **28140000
284800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **28150000
284900** THE USER.                                                    **28160000
285000******************************************************************28170000
285100 6000-REFRESH-PANEL-FROM-TEMP.                                    28180000
285200     IF  ASC-UPDATE-TSQ                                           28190000
285300         SET ASC-NO-TSQ-UPDATE TO TRUE                            28200000
285400         MOVE ZERO                 TO PV-SAVE-ITEM                28210000
285500                                      PV-SEL-QUEUE-ITEM           28220000
285600         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        28230000
285700                                   TO PV-HOLD-SELECTED-ITEMS      28240000
285800         MOVE +1                   TO PV-ITEMS-PROCESSED          28250000
285900         PERFORM 6100-UPDATE-TSQ                                  28260000
286000             UNTIL PV-ITEMS-PROCESSED >                           28270000
286100                                     PV-HOLD-SELECTED-ITEMS       28280000
286200         PERFORM 6010-DELETE-SEL-QUEUE                            28290000
286300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         28300000
286400                    ASC-BLOCK-ENTRIES (2)                         28310000
286500     END-IF.                                                      28320000
286600                                                                  28330000
286700*----------------------------------------------------------------*28340000
286800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *28350000
286900*----------------------------------------------------------------*28360000
287000 6010-DELETE-SEL-QUEUE.                                           28370000
287100                                                                  28380000
287200     EXEC CICS                                                    28390000
287300         DELETEQ TS                                               28400000
287400             QUEUE (ASC-SEL-QUEUE-NAME)                           28410000
287500             RESP  (PV-CICS-RESP)                                 28420000
287600     END-EXEC.                                                    28430000
287700*                                                                 28440000
287800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      28450000
287900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         28460000
288000         CONTINUE                                                 28470000
288100     ELSE                                                         28480000
288200         SET DP013-CICS-ABEND TO TRUE                             28490000
288300         SET DP013-NO-ROLLBACK TO TRUE                            28500000
288400         MOVE '6010-DELETE-SEL-QUEUE'                             28510000
288500                        TO DP013-PARAGRAPH                        28520000
288600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         28530000
288700                        TO DP013-MESSAGE-TEXT (1)                 28540000
288800         PERFORM DP013-0000-PROCESS-ABEND                         28550000
288900     END-IF.                                                      28560000
289000                                                                  28570000
289100*----------------------------------------------------------------*28580000
289200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *28590000
289300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *28600000
289400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *28610000
289500*    THE TEMP QUEUE.                                             *28620000
289600*----------------------------------------------------------------*28630000
289700                                                                  28640000
289800 6100-UPDATE-TSQ.                                                 28650000
289900                                                                  28660000
290000     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             28670000
290100     PERFORM 6105-READ-SEL-QUEUE.                                 28680000
290200     PERFORM                                                      28690000
290300         VARYING SU019-IDX                                        28700000
290400         FROM 1 BY 1                                              28710000
290500         UNTIL ((PV-ITEMS-PROCESSED >                             28720000
290600                              PV-HOLD-SELECTED-ITEMS)             28730000
290700         OR (SU019-IDX GREATER THAN SU019-MAX-ITEMS))             28740000
290800         IF  SU019-ACTION-SW (SU019-IDX) > SPACE                  28750000
290900             PERFORM 6110-PROCESS-ITEMS                           28760000
291000         END-IF                                                   28770000
291100         ADD +1                TO PV-ITEMS-PROCESSED              28780000
291200     END-PERFORM.                                                 28790000
291300     PERFORM 6111-WRITE-LIST-QUEUE.                               28800000
291400*----------------------------------------------------------------*28810000
291500*    READ THE LIST QUEUE RECORD.                                 *28820000
291600*----------------------------------------------------------------*28830000
291700                                                                  28840000
291800 6105-READ-SEL-QUEUE.                                             28850000
291900                                                                  28860000
292000     EXEC CICS                                                    28870000
292100          READQ TS                                                28880000
292200              QUEUE (ASC-SEL-QUEUE-NAME)                          28890000
292300              INTO  (SU019-SELECT-RECORD)                         28900000
292400              ITEM  (PV-SEL-QUEUE-ITEM)                           28910000
292500              RESP  (PV-CICS-RESP)                                28920000
292600     END-EXEC.                                                    28930000
292700*                                                                 28940000
292800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          28950000
292900         CONTINUE                                                 28960000
293000     ELSE                                                         28970000
293100         SET DP013-CICS-ABEND      TO  TRUE                       28980000
293200         SET DP013-NO-ROLLBACK     TO  TRUE                       28990000
293300         MOVE '6105-READ-SEL-QUEUE'                               29000000
293400                                   TO  DP013-PARAGRAPH            29010000
293500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           29020000
293600                                   TO  DP013-MESSAGE-TEXT(1)      29030000
293700         PERFORM DP013-0000-PROCESS-ABEND                         29040000
293800     END-IF.                                                      29050000
293900 EJECT                                                            29060000
294000*----------------------------------------------------------------*29070000
294100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*29080000
294200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*29090000
294300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *29100000
294400*----------------------------------------------------------------*29110000
294500                                                                  29120000
294600 6110-PROCESS-ITEMS.                                              29130000
294700                                                                  29140000
294800     COMPUTE PV-ITEM = 1 + ((SU019-ITEM (SU019-IDX) - 1)          29150000
294900                     / PC-ITEMS-PER-PANEL).                       29160000
295000                                                                  29170000
295100     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           29180000
295200         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          29190000
295300             PERFORM 6111-WRITE-LIST-QUEUE                        29200000
295400         END-IF                                                   29210000
295500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    29220000
295600                                                                  29230000
295700         PERFORM 6112-READ-LIST-QUEUE                             29240000
295800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               29250000
295900             CONTINUE                                             29260000
296000         END-IF                                                   29270000
296100     END-IF.                                                      29280000
296200                                                                  29290000
296300     COMPUTE PV-SUB = (SU019-ITEM (SU019-IDX)                     29300000
296400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              29310000
296500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         29320000
296600     MOVE LQW-SELECTED-SW (PV-SUB)                                29330000
296700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  29340000
296800     MOVE LQW-LINE-ENT-ID (PV-SUB)  TO DK-ENT-ID.                 29350000
296900     PERFORM 4500-PROCESS-RANKINGS-CURSOR.                        29360000
297000     MOVE PV-BULK-VND-RNKG-CDE                                    29370000
297100                       TO  LQW-BULK-RANKING (PV-SUB).             29380000
297200     MOVE PV-PREPACK-VND-RNKG-CDE                                 29390000
297300                       TO  LQW-PREPACK-RANKING (PV-SUB).          29400000
297400     MOVE PV-PBS-VND-RNKG-CDE                                     29410000
297500                       TO  LQW-PBS-RANKING (PV-SUB).              29420000
      *CLP 10/01/13 BEGIN - PR# 5148D                                           
297400     MOVE PV-RFID-VND-RNKG-CDE                                    29410000
297500                       TO  LQW-RFID-RANKING (PV-SUB).             29420000
      *CLP 10/01/13 END   - PR# 5148D                                           
297600     PERFORM 4570-COUNT-DEPARTMENTS.                              29430000
297700     MOVE PV-COUNT-DEPT-RANKGS                                    29440000
297800                       TO  LQW-DEPT-RANKING (PV-SUB).             29450000
297900                                                                  29460000
298000     EVALUATE TRUE                                                29470000
298100         WHEN SU019-INQ (SU019-IDX)                               29480000
298200              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             29490000
298300                                                                  29500000
298400         WHEN SU019-UPD (SU019-IDX)                               29510000
298500              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             29520000
298600                                                                  29530000
298700         WHEN SU019-DEL (SU019-IDX)                               29540000
298800              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             29550000
298900                                                                  29560000
299000         WHEN SU019-ERR (SU019-IDX)                               29570000
299100              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             29580000
299200     END-EVALUATE.                                                29590000
299300                                                                  29600000
299400     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                29610000
299500                                                                  29620000
299600*----------------------------------------------------------------*29630000
299700*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *29640000
299800*----------------------------------------------------------------*29650000
299900                                                                  29660000
300000 6111-WRITE-LIST-QUEUE.                                           29670000
300100                                                                  29680000
300200     EXEC CICS                                                    29690000
300300         WRITEQ TS                                                29700000
300400             QUEUE (ASC-LIST-QUEUE-NAME)                          29710000
300500             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     29720000
300600             ITEM  (PV-SAVE-ITEM)                                 29730000
300700             REWRITE                                              29740000
300800             RESP  (PV-CICS-RESP)                                 29750000
300900     END-EXEC.                                                    29760000
301000*                                                                 29770000
301100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29780000
301200         CONTINUE                                                 29790000
301300     ELSE                                                         29800000
301400         SET DP013-CICS-ABEND  TO  TRUE                           29810000
301500         SET DP013-NO-ROLLBACK TO  TRUE                           29820000
301600         MOVE '6111-WRITE-LIST-QUEUE'                             29830000
301700                               TO  DP013-PARAGRAPH                29840000
301800         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  29850000
301900                               TO  DP013-MESSAGE-TEXT(1)          29860000
302000         PERFORM DP013-0000-PROCESS-ABEND                         29870000
302100     END-IF.                                                      29880000
302200                                                                  29890000
302300 EJECT                                                            29900000
302400*----------------------------------------------------------------*29910000
302500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*29920000
302600*----------------------------------------------------------------*29930000
302700                                                                  29940000
302800 6112-READ-LIST-QUEUE.                                            29950000
302900                                                                  29960000
303000     EXEC CICS                                                    29970000
303100         READQ TS                                                 29980000
303200             QUEUE (ASC-LIST-QUEUE-NAME)                          29990000
303300             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     30000000
303400             ITEM  (PV-ITEM)                                      30010000
303500             RESP  (PV-CICS-RESP)                                 30020000
303600     END-EXEC.                                                    30030000
303700*                                                                 30040000
303800     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30050000
303900         CONTINUE                                                 30060000
304000     ELSE                                                         30070000
304100         SET DP013-CICS-ABEND        TO TRUE                      30080000
304200         SET DP013-NO-ROLLBACK       TO TRUE                      30090000
304300         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           30100000
304400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    30110000
304500                                     TO DP013-MESSAGE-TEXT(1)     30120000
304600         PERFORM DP013-0000-PROCESS-ABEND                         30130000
304700     END-IF.                                                      30140000
304800                                                                  30150000
304900 EJECT                                                            30160000
305000*----------------------------------------------------------------*30170000
305100*    ABEND PROCESSOR MODULE                                      *30180000
305200*----------------------------------------------------------------*30190000
305300                                                                  30200000
305400     COPY DPPD013.                                                30210000
