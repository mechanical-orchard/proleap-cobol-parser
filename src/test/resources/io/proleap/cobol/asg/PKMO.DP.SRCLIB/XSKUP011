       IDENTIFICATION DIVISION.                                         00010099
       PROGRAM-ID.    XSKUP011.                                         00020099
       AUTHOR.        KOHLS DEPARTMENT STORES.                          00030099
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
       DATE-WRITTEN.  09/29/2002.                                       00050099
       DATE-COMPILED.                                                   00060099
      ******************************************************************00070099
      **       VSM ITEM MESSAGE - NUMBER 040 - SKU ADD                  00080099
      ******************************************************************00090099
      ***THIS PROGRAM IS CALLED FROM XSKUT012 TO ADD A NEW SKU.         00100099
      ***     A ROW IS INSERTED INTO EACH OF THE FOLLOWING TABLES:      00110099
      ***     1. XST_SKU                                                00120099
      ***     2. XST_UPC                                                00130099
      ***     3. XST_SKU_ATTR                                           00140099
      ***     4. XST_SKU_LOC                                            00150099
      ***     5. XST_SKU_LOC_ATTR                                       00160099
      ******************************************************************00170099
      **09/29/2002 CHANGED BY:JULIE SMITH          PROGRAM WRITE        00180099
121402**12/14/2002 CHANGED BY:JULIE SMITH  ADDITIONAL TIMESTAMP         00190099
      **02/17/2003 CHANGED BY:CHRIS CLARK ADDED INSERTS TO XST_SKU_ATTR,00200099
      **           XST_SKU_LOC AND XST_SKU_LOC_ATTR TABLES.             00210099
      **07/07/2003 CHANGED BY:SANDY POTTER INITIALIZE NULL INDICATORS  ,00220099
091004**09/10/2004 CHANGED BY:JULIE TEWES ADD CUSTFACG_CLOR_DESC AND    00230099
091004**                                  POG_IND                       00240099
      **09/13/2005 CHANGED BY:SANDY POTTER ADD MKDN_CDE AND             00241099
      **           ORIG_CLR_DTE TO XST_SKU_LOC.                         00242099
      ******************************************************************00243099
       ENVIRONMENT DIVISION.                                            00244099
       CONFIGURATION SECTION.                                           00245099
       SOURCE-COMPUTER.  IBM-3090.                                      00246099
       OBJECT-COMPUTER.  IBM-3090.                                      00247099
       DATA DIVISION.                                                   00248099
                                                                        00249099
       WORKING-STORAGE SECTION.                                         00250099
      ******************************************************************00260099
      **PROGRAM SWITCHES                                                00270099
      ******************************************************************00280099
       01  PS-PROGRAM-SWITCHES.                                         00290099
           05  PS-PROCESS-CONTINUE-SW      PIC X(01)  VALUE 'Y'.        00300099
               88  PS-PROCESS-CONTINUE                VALUE 'Y'.        00310099
               88  PS-PROCESS-COMPLETE                VALUE 'N'.        00320099
           05  PS-ACTION-IND               PIC 9(02)  VALUE 00.         00330099
               88  PS-ACTION-REVERSE                  VALUE 01.         00340099
      ***DUE TO A ROW ALREADY EXISTING ON TABLE                         00350099
               88  PS-ACTION-NOTHING                  VALUE 02.         00360099
      ******************************************************************00370099
      **PROGRAM COUNTERS                                                00380099
      ******************************************************************00390099
       01  PC-PROGRAM-COUNTERS.                                         00400099
           05  PC-RETRY-COUNTER            PIC 9(01)  VALUE ZEROS.      00410099
           05  PC-RETRY-COUNTER-2          PIC 9(01)  VALUE ZEROS.      00420099
           05  PC-RETRY-MAX                PIC 9(01)  VALUE 5.          00430099
      ******************************************************************00440099
      **NULL INDICATORS                                                 00450099
      ******************************************************************00460099
       01  PV-NULL-INDICATORS.                                          00470099
           05  PV-END-TMST-IND             PIC S9(4) COMP VALUE ZEROS.  00480099
           05  PV-GPPRIC-ID-IND            PIC S9(4) COMP VALUE ZEROS.  00490099
           05  PV-GPRTL-QTY-IND            PIC S9(4) COMP VALUE ZEROS.  00500099
           05  PV-GPRTL-AMT-IND            PIC S9(4) COMP VALUE ZEROS.  00510099
           05  PV-MKDN-CDE-IND             PIC S9(4) COMP VALUE ZEROS.  00520099
           05  PV-ORIG-CLR-DTE-IND         PIC S9(4) COMP VALUE ZEROS.  00530099
      ******************************************************************00540099
      **PROGRAM VARIABLES                                               00550099
      ******************************************************************00560099
       01  PV-PROGRAM-VARIABLES.                                        00570099
           05  PV-PARAGRAPH-NAME               PIC X(20)  VALUE SPACES. 00580099
           05  PV-TIME-EVALUATE-INSERT.                                 00590099
               10  PV-TIME-HOUR-IN             PIC  9(02) VALUE ZEROS.  00600099
               10  PV-TIME-MINUTE-IN           PIC  9(02) VALUE ZEROS.  00610099
               10  PV-TIME-SECOND-IN           PIC  9(02) VALUE ZEROS.  00620099
               10  PV-TIME-MICROSEC-IN         PIC  9(06) VALUE ZEROS.  00630099
           05  PV-TIME-EVALUATE-UPDATE.                                 00640099
               10  PV-TIME-HOUR-UP             PIC  9(02) VALUE ZEROS.  00650099
               10  PV-TIME-MINUTE-UP           PIC  9(02) VALUE ZEROS.  00660099
               10  PV-TIME-SECOND-UP           PIC  9(02) VALUE ZEROS.  00670099
               10  PV-TIME-MICROSEC-UP         PIC  9(06) VALUE ZEROS.  00680099
      ******************************************************************00690099
      **TIMESTAMP VARIABLES                                             00700099
      ******************************************************************00710099
       01  SD-TIMESTAMP                        PIC  X(26)  VALUE SPACES.00720099
       01  FILLER REDEFINES SD-TIMESTAMP.                               00730099
           05  SD-CURR-DTE                     PIC  X(10).              00740099
           05  FILLER                          PIC  X(01).              00750099
           05  SD-HOUR                         PIC  X(02).              00760099
           05  FILLER                          PIC  X(01).              00770099
           05  SD-MINUTE                       PIC  X(02).              00780099
           05  FILLER                          PIC  X(01).              00790099
           05  SD-SECOND                       PIC  X(02).              00800099
           05  FILLER                          PIC  X(01).              00810099
           05  SD-MICROSEC                     PIC  X(06).              00820099
      ******************************************************************00830099
      **PROGRAM CALCULATIONS                                            00840099
      ******************************************************************00850099
       01  PC-PROGRAM-CALCULATIONS.                                     00860099
           05  PC-10-DIGIT                 PIC 9(10)  VALUE ZEROS.      00870099
           05  PC-18-DIGIT                 PIC S9(18) COMP VALUE ZEROS. 00880099
           05  PC-09-DIGIT                 PIC S9(09) COMP VALUE ZEROS. 00890099
      ******************************************************************00900099
      **COPYBOOKS                                                       00910099
      ******************************************************************00920099
      ***DB2 MESSAGE AREA                                               00930099
           COPY SQLCA2.                                                 00940099
      ***MESSAGE COPYBOOK                                               00950099
           COPY IMRD008.                                                00960099
      ***DATE ROUTINE COPYBOOK                                          00970099
           COPY DPWS500.                                                00980099
      ******************************************************************00990099
      **TABLE INCLUSIONS                                                01000099
      ******************************************************************01010099
      ***DB2 COMMUNICATIONS AREA                                        01020099
           EXEC SQL                                                     01030099
                INCLUDE SQLCA                                           01040099
           END-EXEC.                                                    01050099
      ***XST_SKU TABLE                                                  01060099
           EXEC SQL                                                     01070099
                INCLUDE XST00010                                        01080099
           END-EXEC.                                                    01090099
      ***XST_UPC TABLE                                                  01100099
           EXEC SQL                                                     01110099
                INCLUDE XST00012                                        01120099
           END-EXEC.                                                    01130099
      ***XST_SKU_ATTR TABLE                                             01140099
           EXEC SQL                                                     01150099
                INCLUDE XST00011                                        01160099
           END-EXEC.                                                    01170099
      ***XST_SKU_LOC  TABLE                                             01180099
           EXEC SQL                                                     01190099
                INCLUDE XST00008                                        01200099
           END-EXEC.                                                    01210099
      ***XST_SKU_LOC_ATTR  TABLE                                        01220099
           EXEC SQL                                                     01230099
                INCLUDE XST00041                                        01240099
           END-EXEC.                                                    01250099
                                                                        01260099
       LINKAGE SECTION.                                                 01270099
      ******************************************************************01280099
      **LINKAGE VARIABLES                                               01290099
      ******************************************************************01300099
       01  LV-IMRD008-RECORD               PIC X(450).                  01310099
       01  LV-RETURN-CODE                  PIC S9(04).                  01320099
       01  LV-ACTION-IND                   PIC 9(02).                   01330099
       01  LV-CURRENT-TIMESTAMP            PIC X(26).                   01340099
                                                                        01350099
       PROCEDURE DIVISION USING LV-IMRD008-RECORD,                      01360099
                                LV-RETURN-CODE,                         01370099
                                LV-ACTION-IND,                          01380099
                                LV-CURRENT-TIMESTAMP.                   01390099
      ******************************************************************01400099
       0000-MAINLINE.                                                   01410099
                                                                        01420099
            PERFORM 1000-INITIALIZATION.                                01430099
            PERFORM 2000-PROCESS-MESSAGE                                01440099
                    UNTIL PS-PROCESS-COMPLETE.                          01450099
                                                                        01460099
            IF SQLCODE EQUAL ZEROS                                      01470099
               PERFORM 4000-FILL-SKU-ATTR-LOC-TBLS                      01480099
            END-IF.                                                     01490099
                                                                        01500099
            PERFORM 9999-WRAPUP.                                        01510099
                                                                        01520099
       EJECT.                                                           01530099
      ***************************************************************** 01540099
      **INITIALIZATION AREA - ALL MOVES TO UPDATE/INSERT                01550099
      ***************************************************************** 01560099
       1000-INITIALIZATION.                                             01570099
                                                                        01580099
           MOVE '1000-INITIALIZATION'      TO PV-PARAGRAPH-NAME.        01590099
                                                                        01600099
           SET PS-PROCESS-CONTINUE         TO TRUE.                     01610099
           INITIALIZE PC-RETRY-COUNTER.                                 01620099
           MOVE LV-IMRD008-RECORD          TO IMRD008-RECORD.           01630099
                                                                        01640099
      ***SET UP TIMESTAMP IN CASE DATE COMPARISON IS NEEDED             01650099
           MOVE IM008-CRE-TMST             TO SD-TIMESTAMP.             01660099
           MOVE SD-HOUR                    TO PV-TIME-HOUR-IN.          01670099
           MOVE SD-MINUTE                  TO PV-TIME-MINUTE-IN.        01680099
           MOVE SD-SECOND                  TO PV-TIME-SECOND-IN.        01690099
           MOVE SD-MICROSEC                TO PV-TIME-MICROSEC-IN.      01700099
           INITIALIZE SD-TIMESTAMP.                                     01710099
                                                                        01720099
      *THIS DONE BECAUSE OF A COMPILER LIMITATION WHEN DEALING WITH     01730099
      *     COMP FIELDS.                                                01740099
           MOVE IM008-ITEM-KEY-INTR-UPC-ID   TO PC-10-DIGIT.            01750099
           MOVE PC-10-DIGIT                  TO PC-18-DIGIT.            01760099
           MOVE PC-18-DIGIT                  TO PC-09-DIGIT.            01770099
           MOVE PC-09-DIGIT                  TO XST00010-INTR-UPC-ID.   01780099
                                                                        01790099
           MOVE IM008-ITEM-KEY-RMS-STYL-ID   TO XST00010-STYL-ID.       01800099
           MOVE IM008-ITEM-KEY-SKU           TO XST00010-SKU-NBR.       01810099
           MOVE IM008-SKU-ADD-SKU-DESC       TO XST00010-SKU-DESC.      01820099
                                                                        01830099
      *THIS DONE BECAUSE OF A COMPILER LIMITATION WHEN DEALING WITH     01840099
      *     COMP FIELDS.                                                01850099
           MOVE IM008-SKU-ADD-KOHLS-SIZE-CDE TO PC-10-DIGIT.            01860099
           MOVE PC-10-DIGIT                  TO PC-18-DIGIT.            01870099
           MOVE PC-18-DIGIT                  TO PC-09-DIGIT.            01880099
           MOVE PC-09-DIGIT                  TO XST00010-KOHLS-SIZE-CDE.01890099
                                                                        01900099
           MOVE IM008-SKU-ADD-SIZE-DESC      TO XST00010-SIZE-DESC.     01910099
           MOVE IM008-SKU-ADD-NRF-CLOR-CDE   TO XST00010-NRF-CLOR-CDE.  01920099
           MOVE IM008-SKU-ADD-CSTM-CLOR-DESC TO XST00010-CSTM-CLOR-DESC.01930099
           MOVE IM008-SKU-ADD-REGN-PRIC-IND  TO XST00010-REGN-PRIC-IND. 01940099
           MOVE IM008-SKU-ADD-WT-UM-CDE     TO XST00010-WT-UM-CDE.      01950099
           MOVE IM008-SKU-ADD-WT-UM-QTY     TO XST00010-WT-UM-QTY.      01960099
           MOVE IM008-SKU-ADD-SIZE-UM-CDE   TO XST00010-SIZE-UM-CDE.    01970099
           MOVE IM008-SKU-ADD-WD-UM-QTY     TO XST00010-WD-UM-QTY.      01980099
           MOVE IM008-SKU-ADD-HT-UM-QTY     TO XST00010-HT-UM-QTY.      01990099
           MOVE IM008-SKU-ADD-DPTH-UM-QTY   TO XST00010-DPTH-UM-QTY.    02000099
121402     MOVE LV-CURRENT-TIMESTAMP        TO XST00010-CRE-TMST.       02010099
121402     MOVE LV-CURRENT-TIMESTAMP        TO XST00010-LAST-UPD-TMST.  02020099
121402     MOVE IM008-CRE-TMST            TO XST00010-SOR-LAST-MSG-TMST.02030099
                                                                        02040099
      *THIS DONE BECAUSE OF A COMPILER LIMITATION WHEN DEALING WITH     02050099
      *     COMP FIELDS.                                                02060099
           MOVE IM008-ITEM-KEY-UPC-ID        TO PC-10-DIGIT.            02070099
           MOVE PC-10-DIGIT                  TO PC-18-DIGIT.            02080099
           MOVE PC-18-DIGIT                  TO PC-09-DIGIT.            02090099
           MOVE PC-09-DIGIT                  TO XST00012-UPC-ID.        02100099
                                                                        02110099
           MOVE 'I'                          TO XST00012-UPC-TYP-CDE.   02120099
           MOVE IM008-ITEM-KEY-UPC-NBR       TO XST00012-UPC-NBR.       02130099
121402     MOVE LV-CURRENT-TIMESTAMP         TO XST00012-LAST-UPD-TMST. 02140099
121402     MOVE IM008-CRE-TMST            TO XST00012-SOR-LAST-MSG-TMST.02150099
                                                                        02160099
091004     MOVE IM008-SKU-ADD-CUSTFACG-CLOR                             02170099
091004                                   TO XST00010-CUSTFACG-CLOR-DESC.02180099
091004     MOVE IM008-SKU-ADD-POG-IND        TO XST00010-POG-IND.       02190099
           MOVE IM008-SKU-ADD-GP-CDE     TO XST00010-GP-CDE.            02191099
                                                                        02200099
      *THIS DONE BECAUSE OF A COMPILER LIMITATION WHEN DEALING WITH     02210099
      *     COMP FIELDS.                                                02220099
           MOVE IM008-ITEM-KEY-INTR-UPC-ID   TO PC-10-DIGIT.            02230099
           MOVE PC-10-DIGIT                  TO PC-18-DIGIT.            02240099
           MOVE PC-18-DIGIT                  TO PC-09-DIGIT.            02250099
           MOVE PC-09-DIGIT                  TO XST00012-INTR-UPC-ID.   02260099
                                                                        02270099
       EJECT.                                                           02280099
      ***************************************************************** 02290099
      **INSERT NEW SKU IN TABLE XST_SKU                                 02300099
      ***************************************************************** 02310099
       2000-PROCESS-MESSAGE.                                            02320099
                                                                        02330099
           MOVE '2000-PROCESS-MESSAGE' TO PV-PARAGRAPH-NAME.            02340099
                                                                        02350099
           EXEC SQL                                                     02360099
                INSERT INTO XST_SKU ( INTR_UPC_ID                       02370099
                                    , STYL_ID                           02380099
                                    , SKU_NBR                           02390099
                                    , SKU_DESC                          02400099
                                    , REGN_PRIC_IND                     02410099
                                    , KOHLS_SIZE_CDE                    02420099
                                    , TX_PRD_CDE_DESC                   02430099
                                    , SIZE_DESC                         02440099
                                    , NRF_CLOR_CDE                      02450099
                                    , E_BUS_ITM_IND                     02460099
                                    , CSTM_CLOR_DESC                    02470099
                                    , E_BUS_PRD_GP_NBR                  02480099
                                    , WT_UM_CDE                         02490099
                                    , WT_UM_QTY                         02500099
                                    , SIZE_UM_CDE                       02510099
                                    , WD_UM_QTY                         02520099
                                    , HT_UM_QTY                         02530099
                                    , DPTH_UM_QTY                       02540099
                                    , CRE_TMST                          02550099
                                    , LAST_UPD_TMST                     02560099
                                    , NRF_CLOR_DESC                     02570099
                                    , SOR_LAST_MSG_TMST                 02580099
091004                              , CUSTFACG_CLOR_DESC                02590099
091004                              , POG_IND                           02600099
                                    , GP_CDE)                           02601099
                VALUES ( :XST00010-INTR-UPC-ID                          02610099
                       , :XST00010-STYL-ID                              02620099
                       , :XST00010-SKU-NBR                              02630099
                       , :XST00010-SKU-DESC                             02640099
                       , :XST00010-REGN-PRIC-IND                        02650099
                       , :XST00010-KOHLS-SIZE-CDE                       02660099
                       , 'NOT AVAILABLE'                                02670099
                       , :XST00010-SIZE-DESC                            02680099
                       , :XST00010-NRF-CLOR-CDE                         02690099
                       , 'N'                                            02700099
                       , :XST00010-CSTM-CLOR-DESC                       02710099
                       , 0                                              02720099
                       , :XST00010-WT-UM-CDE                            02730099
                       , :XST00010-WT-UM-QTY                            02740099
                       , :XST00010-SIZE-UM-CDE                          02750099
                       , :XST00010-WD-UM-QTY                            02760099
                       , :XST00010-HT-UM-QTY                            02770099
                       , :XST00010-DPTH-UM-QTY                          02780099
                       , :XST00010-CRE-TMST                             02790099
                       , :XST00010-LAST-UPD-TMST                        02800099
                       , 'NOT AVAIL'                                    02810099
121402                 , :XST00010-SOR-LAST-MSG-TMST                    02820099
091004                 , :XST00010-CUSTFACG-CLOR-DESC                   02830099
091004                 , :XST00010-POG-IND                              02840099
                       , :XST00010-GP-CDE)                              02840199
           END-EXEC.                                                    02850099
                                                                        02860099
           EVALUATE TRUE                                                02870099
      ***SUCCESSFUL PROCESSING                                          02880099
              WHEN SQLCODE = ZEROS                                      02890099
                   PERFORM 3000-INSERT-UPC                              02900099
      ***REFERENTIAL INTEGRITY ISSUE                                    02910099
              WHEN SQLCODE = -530                                       02920099
              WHEN SQLCODE = -532                                       02930099
                   SET PS-PROCESS-COMPLETE   TO TRUE                    02940099
      ***ROW/TABLE LOCK                                                 02950099
              WHEN SQLCODE = -911                                       02960099
              WHEN SQLCODE = -913                                       02970099
              WHEN SQLCODE = -904                                       02980099
                   ADD +1                      TO PC-RETRY-COUNTER      02990099
                   IF  PC-RETRY-COUNTER >= PC-RETRY-MAX                 03000099
                       SET PS-PROCESS-COMPLETE TO TRUE                  03010099
                   ELSE                                                 03020099
                       ADD +1                  TO PC-RETRY-COUNTER      03030099
                   END-IF                                               03040099
              WHEN OTHER                                                03050099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  03060099
           END-EVALUATE.                                                03070099
                                                                        03080099
       EJECT.                                                           03090099
      ******************************************************************03100099
      **MESSAGE HAS NEWER TIMESTAMP SO UPDATE DATA ON TABLE             03110099
      ******************************************************************03120099
       3000-INSERT-UPC.                                                 03130099
                                                                        03140099
           MOVE '3000-INSERT-UPC' TO PV-PARAGRAPH-NAME.                 03150099
                                                                        03160099
           EXEC SQL                                                     03170099
                INSERT INTO XST_UPC ( UPC_ID                            03180099
                                    , INTR_UPC_ID                       03190099
                                    , UPC_TYP_CDE                       03200099
                                    , UPC_NBR                           03210099
                                    , LAST_UPD_TMST                     03220099
121402                              , SOR_LAST_MSG_TMST                 03230099
121402                              , LAST_ACTN_CDE)                    03240099
                VALUES ( :XST00012-UPC-ID                               03250099
                       , :XST00012-INTR-UPC-ID                          03260099
                       , :XST00012-UPC-TYP-CDE                          03270099
                       , :XST00012-UPC-NBR                              03280099
                       , :XST00012-LAST-UPD-TMST                        03290099
121402                 , :XST00012-SOR-LAST-MSG-TMST                    03300099
121402                 , 'A')                                           03310099
           END-EXEC.                                                    03320099
                                                                        03330099
           EVALUATE TRUE                                                03340099
      ***SUCCESSFUL PROCESSING                                          03350099
              WHEN SQLCODE = ZEROS                                      03360099
                   SET PS-PROCESS-COMPLETE   TO TRUE                    03370099
      ***REFERENTIAL INTEGRITY ISSUE                                    03380099
              WHEN SQLCODE = -530                                       03390099
              WHEN SQLCODE = -532                                       03400099
                   SET PS-PROCESS-COMPLETE   TO TRUE                    03410099
      ***ROW/TABLE LOCK                                                 03420099
              WHEN SQLCODE = -913                                       03430099
              WHEN SQLCODE = -911                                       03440099
              WHEN SQLCODE = -904                                       03450099
                   ADD +1                      TO PC-RETRY-COUNTER      03460099
                   IF  PC-RETRY-COUNTER >= PC-RETRY-MAX                 03470099
                       SET PS-PROCESS-COMPLETE TO TRUE                  03480099
                   ELSE                                                 03490099
                       ADD +1                  TO PC-RETRY-COUNTER      03500099
                   END-IF                                               03510099
              WHEN OTHER                                                03520099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  03530099
           END-EVALUATE.                                                03540099
                                                                        03550099
       EJECT.                                                           03560099
      ******************************************************************03570099
      *POPULATES SKU_ATTR, SKU_LOC, AND SKU_LOC_ATTR TABLES.            03580099
      ******************************************************************03590099
       4000-FILL-SKU-ATTR-LOC-TBLS.                                     03600099
                                                                        03610099
           PERFORM 4100-FORMAT-SKU-ATTR-DATA.                           03620099
                                                                        03630099
           MOVE 0                    TO PC-RETRY-COUNTER.               03640099
           SET PS-PROCESS-CONTINUE   TO TRUE.                           03650099
           PERFORM 4200-INSERT-SKU-ATTR-DATA                            03660099
                 UNTIL PS-PROCESS-COMPLETE.                             03670099
                                                                        03680099
           IF SQLCODE EQUAL ZEROS                                       03690099
              PERFORM 4300-FORMAT-SKU-LOC-DATA                          03700099
                                                                        03710099
              MOVE 0                    TO PC-RETRY-COUNTER             03720099
              SET PS-PROCESS-CONTINUE   TO TRUE                         03730099
              PERFORM 4400-INSERT-SKU-LOC-DATA                          03740099
                 UNTIL PS-PROCESS-COMPLETE                              03750099
                                                                        03760099
              IF SQLCODE EQUAL ZEROS                                    03770099
                 PERFORM 4500-FORMAT-SKU-LOC-ATTR-DATA                  03780099
                                                                        03790099
                 MOVE 0                    TO PC-RETRY-COUNTER          03800099
                 SET PS-PROCESS-CONTINUE   TO TRUE                      03810099
                 PERFORM 4600-INSERT-SKU-LOC-ATTR-DATA                  03820099
                    UNTIL PS-PROCESS-COMPLETE                           03830099
              END-IF                                                    03840099
           END-IF.                                                      03850099
                                                                        03860099
       EJECT.                                                           03870099
      ******************************************************************03880099
      *FORMATS DATA TO BE INSERTED INTO THE SKU_ATTR TABLE.             03890099
      ******************************************************************03900099
       4100-FORMAT-SKU-ATTR-DATA.                                       03910099
                                                                        03920099
      *THIS DONE BECAUSE OF A COMPILER LIMITATION WHEN DEALING WITH     03930099
      *     COMP FIELDS.                                                03940099
           MOVE IM008-ITEM-KEY-INTR-UPC-ID   TO PC-10-DIGIT.            03950099
           MOVE PC-10-DIGIT                  TO PC-18-DIGIT.            03960099
           MOVE PC-18-DIGIT                  TO PC-09-DIGIT.            03970099
           MOVE PC-09-DIGIT                  TO XST00011-INTR-UPC-ID.   03980099
                                                                        03990099
           MOVE 'N'                  TO XST00011-PLU-DWNLD-EXCL-IND.    04000099
           MOVE IM008-SKU-ADD-UNT-RTL-AMT                               04010099
                                     TO XST00011-LAST-NCLR-RTL-AMT.     04020099
           MOVE LV-CURRENT-TIMESTAMP TO XST00011-LAST-UPD-TMST.         04030099
                                                                        04040099
      ******************************************************************04050099
      *INSERTS DATA INTO THE SKU_ATTR TABLE.                            04060099
      ******************************************************************04070099
       4200-INSERT-SKU-ATTR-DATA.                                       04080099
                                                                        04090099
           EXEC SQL                                                     04100099
                INSERT INTO XST_SKU_ATTR ( INTR_UPC_ID                  04110099
                                         , PLU_DWNLD_EXCL_IND           04120099
                                         , LAST_NCLR_RTL_AMT            04130099
                                         , LAST_UPD_TMST)               04140099
                VALUES ( :XST00011-INTR-UPC-ID                          04150099
                       , :XST00011-PLU-DWNLD-EXCL-IND                   04160099
                       , :XST00011-LAST-NCLR-RTL-AMT                    04170099
                       , :XST00011-LAST-UPD-TMST)                       04180099
           END-EXEC.                                                    04190099
                                                                        04200099
           EVALUATE TRUE                                                04210099
      ***SUCCESSFUL PROCESSING                                          04220099
              WHEN SQLCODE = ZEROS                                      04230099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  04240099
      ***REFERENTIAL INTEGRITY ISSUE                                    04250099
              WHEN SQLCODE = -530                                       04260099
              WHEN SQLCODE = -532                                       04270099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  04280099
      ***ROW/TABLE LOCK                                                 04290099
              WHEN SQLCODE = -911                                       04300099
              WHEN SQLCODE = -913                                       04310099
              WHEN SQLCODE = -904                                       04320099
                   ADD +1                      TO PC-RETRY-COUNTER      04330099
                   IF  PC-RETRY-COUNTER >= PC-RETRY-MAX                 04340099
                       SET PS-PROCESS-COMPLETE TO TRUE                  04350099
                   ELSE                                                 04360099
                       ADD +1                  TO PC-RETRY-COUNTER      04370099
                   END-IF                                               04380099
              WHEN OTHER                                                04390099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  04400099
           END-EVALUATE.                                                04410099
                                                                        04420099
       EJECT.                                                           04430099
      ******************************************************************04440099
      *FORMATS DATA TO BE INSERTED INTO THE SKU_LOC TABLE.              04450099
      ******************************************************************04460099
       4300-FORMAT-SKU-LOC-DATA.                                        04470099
                                                                        04480099
      *THIS DONE BECAUSE OF A COMPILER LIMITATION WHEN DEALING WITH     04490099
      *     COMP FIELDS.                                                04500099
           MOVE IM008-ITEM-KEY-INTR-UPC-ID   TO PC-10-DIGIT.            04510099
           MOVE PC-10-DIGIT                  TO PC-18-DIGIT.            04520099
           MOVE PC-18-DIGIT                  TO PC-09-DIGIT.            04530099
           MOVE PC-09-DIGIT                  TO XST00008-INTR-UPC-ID.   04540099
                                                                        04550099
           MOVE 0                   TO XST00008-LOC-NBR.                04560099
           MOVE IM008-CRE-TMST      TO XST00008-BEG-TMST.               04570099
           MOVE -1                  TO PV-END-TMST-IND.                 04580099
           MOVE IM008-SKU-ADD-UNT-RTL-AMT                               04590099
                                    TO XST00008-UNT-RTL-AMT.            04600099
           MOVE IM008-SKU-ADD-UNT-COST-AMT                              04610099
                                    TO XST00008-UNT-COST-AMT.           04620099
           MOVE IM008-SKU-ADD-UPC-STAT-CDE                              04630099
                                    TO XST00008-LOC-SKU-STAT-CDE.       04640099
           MOVE IM008-SKU-ADD-UPC-STAT-CHG                              04650099
                                    TO XST00008-UPC-STAT-CHG-DTE.       04660099
                                                                        04670099
           IF IM008-SKU-ADD-MEITGP-NBR = 0                              04680099
              MOVE -1               TO PV-GPPRIC-ID-IND                 04690099
                                       PV-GPRTL-QTY-IND                 04700099
                                       PV-GPRTL-AMT-IND                 04710099
              MOVE ZEROS            TO XST00008-GP-PRIC-ID              04720099
              MOVE ZEROS            TO XST00008-GP-RTL-QTY              04730099
              MOVE ZEROS            TO XST00008-GP-RTL-AMT              04740099
           ELSE                                                         04750099
              MOVE ZEROS            TO PV-GPPRIC-ID-IND                 04760099
                                       PV-GPRTL-QTY-IND                 04770099
                                       PV-GPRTL-AMT-IND                 04780099
              MOVE IM008-SKU-ADD-MEITGP-NBR                             04790099
                                    TO XST00008-GP-PRIC-ID              04800099
              MOVE IM008-SKU-ADD-MITGPL-QTY                             04810099
                                    TO XST00008-GP-RTL-QTY              04820099
              MOVE IM008-SKU-ADD-MITGPL-GP-AMT                          04830099
                                    TO XST00008-GP-RTL-AMT              04840099
           END-IF.                                                      04850099
                                                                        04860099
           MOVE IM008-SKU-ADD-UPC-STAT-CHG                              04870099
                                    TO XST00008-UNT-RTL-CHG-DTE.        04880099
           MOVE LV-CURRENT-TIMESTAMP                                    04890099
                                    TO XST00008-LAST-UPD-TMST.          04900099
           MOVE IM008-CRE-TMST      TO XST00008-SOR-LAST-MSG-TMST.      04910099
                                                                        04920099
           MOVE SPACES              TO XST00008-MKDN-CDE.               04930099
           MOVE -1                  TO PV-MKDN-CDE-IND.                 04940099
           MOVE SPACES              TO XST00008-ORIG-CLR-DTE.           04950099
           MOVE -1                  TO PV-ORIG-CLR-DTE-IND.             04960099
                                                                        04970099
      ******************************************************************04980099
      *INSERTS DATA INTO THE SKU_LOC TABLE.                             04990099
      ******************************************************************05000099
       4400-INSERT-SKU-LOC-DATA.                                        05010099
                                                                        05020099
           EXEC SQL                                                     05030099
                INSERT INTO XST_SKU_LOC ( LOC_NBR                       05040099
                                        , INTR_UPC_ID                   05050099
                                        , BEG_TMST                      05060099
                                        , END_TMST                      05070099
                                        , UNT_RTL_AMT                   05080099
                                        , UNT_COST_AMT                  05090099
                                        , LOC_SKU_STAT_CDE              05100099
                                        , UPC_STAT_CHG_DTE              05110099
                                        , GP_PRIC_ID                    05120099
                                        , UNT_RTL_CHG_DTE               05130099
                                        , GP_RTL_QTY                    05140099
                                        , GP_RTL_AMT                    05150099
                                        , LAST_UPD_TMST                 05160099
                                        , SOR_LAST_MSG_TMST             05170099
                                        , MKDN_CDE                      05171099
                                        , ORIG_CLR_DTE)                 05172099
                VALUES ( :XST00008-LOC-NBR                              05173099
                       , :XST00008-INTR-UPC-ID                          05174099
                       , :XST00008-BEG-TMST                             05175099
                       , :XST00008-END-TMST:PV-END-TMST-IND             05176099
                       , :XST00008-UNT-RTL-AMT                          05177099
                       , :XST00008-UNT-COST-AMT                         05178099
                       , :XST00008-LOC-SKU-STAT-CDE                     05179099
                       , :XST00008-UPC-STAT-CHG-DTE                     05180099
                       , :XST00008-GP-PRIC-ID:PV-GPPRIC-ID-IND          05190099
                       , :XST00008-UNT-RTL-CHG-DTE                      05200099
                       , :XST00008-GP-RTL-QTY:PV-GPRTL-QTY-IND          05210099
                       , :XST00008-GP-RTL-AMT:PV-GPRTL-AMT-IND          05220099
                       , :XST00008-LAST-UPD-TMST                        05230099
                       , :XST00008-SOR-LAST-MSG-TMST                    05240099
                       , :XST00008-MKDN-CDE:PV-MKDN-CDE-IND             05250099
                       , :XST00008-ORIG-CLR-DTE:PV-ORIG-CLR-DTE-IND)    05260099
           END-EXEC.                                                    05270099
                                                                        05280099
           EVALUATE TRUE                                                05290099
      ***SUCCESSFUL PROCESSING                                          05300099
              WHEN SQLCODE = ZEROS                                      05310099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  05320099
      ***REFERENTIAL INTEGRITY ISSUE                                    05330099
              WHEN SQLCODE = -530                                       05340099
              WHEN SQLCODE = -532                                       05350099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  05360099
      ***ROW/TABLE LOCK                                                 05370099
              WHEN SQLCODE = -911                                       05380099
              WHEN SQLCODE = -913                                       05390099
              WHEN SQLCODE = -904                                       05400099
                   ADD +1                      TO PC-RETRY-COUNTER      05410099
                   IF  PC-RETRY-COUNTER >= PC-RETRY-MAX                 05420099
                       SET PS-PROCESS-COMPLETE TO TRUE                  05430099
                   ELSE                                                 05440099
                       ADD +1                  TO PC-RETRY-COUNTER      05450099
                   END-IF                                               05460099
              WHEN OTHER                                                05470099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  05480099
           END-EVALUATE.                                                05490099
                                                                        05500099
       EJECT.                                                           05510099
      ******************************************************************05520099
      *FORMATS DATA TO BE INSERTED INTO THE SKU_LOC_ATTR TABLE.         05530099
      ******************************************************************05540099
       4500-FORMAT-SKU-LOC-ATTR-DATA.                                   05550099
                                                                        05560099
      *THIS DONE BECAUSE OF A COMPILER LIMITATION WHEN DEALING WITH     05570099
      *     COMP FIELDS.                                                05580099
           MOVE IM008-ITEM-KEY-INTR-UPC-ID   TO PC-10-DIGIT.            05590099
           MOVE PC-10-DIGIT                  TO PC-18-DIGIT.            05600099
           MOVE PC-18-DIGIT                  TO PC-09-DIGIT.            05610099
           MOVE PC-09-DIGIT                  TO XST00041-INTR-UPC-ID.   05620099
                                                                        05630099
           MOVE 0                   TO XST00041-LOC-NBR.                05640099
           MOVE 'N'                 TO XST00041-PRMPT-FOR-PRIC-IND.     05650099
           MOVE LV-CURRENT-TIMESTAMP                                    05660099
                                    TO XST00041-LAST-UPD-TMST.          05670099
                                                                        05680099
      ******************************************************************05690099
      *INSERTS DATA INTO THE SKU_LOC_ATTR TABLE.                        05700099
      ******************************************************************05710099
       4600-INSERT-SKU-LOC-ATTR-DATA.                                   05720099
                                                                        05730099
           EXEC SQL                                                     05740099
                INSERT INTO XST_SKU_LOC_ATTR ( INTR_UPC_ID              05750099
                                             , LOC_NBR                  05760099
                                             , PRMPT_FOR_PRIC_IND       05770099
                                             , LAST_UPD_TMST)           05780099
                VALUES ( :XST00041-INTR-UPC-ID                          05790099
                       , :XST00041-LOC-NBR                              05800099
                       , :XST00041-PRMPT-FOR-PRIC-IND                   05810099
                       , :XST00041-LAST-UPD-TMST)                       05820099
           END-EXEC.                                                    05830099
                                                                        05840099
           EVALUATE TRUE                                                05850099
      ***SUCCESSFUL PROCESSING                                          05860099
              WHEN SQLCODE = ZEROS                                      05870099
                   SET PS-PROCESS-COMPLETE   TO TRUE                    05880099
      ***REFERENTIAL INTEGRITY ISSUE                                    05890099
              WHEN SQLCODE = -530                                       05900099
              WHEN SQLCODE = -532                                       05910099
                   SET PS-PROCESS-COMPLETE   TO TRUE                    05920099
      ***ROW/TABLE LOCK                                                 05930099
              WHEN SQLCODE = -911                                       05940099
              WHEN SQLCODE = -913                                       05950099
              WHEN SQLCODE = -904                                       05960099
                   ADD +1                      TO PC-RETRY-COUNTER      05970099
                   IF  PC-RETRY-COUNTER >= PC-RETRY-MAX                 05980099
                       SET PS-PROCESS-COMPLETE TO TRUE                  05990099
                   ELSE                                                 06000099
                       ADD +1                  TO PC-RETRY-COUNTER      06010099
                   END-IF                                               06020099
              WHEN OTHER                                                06030099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  06040099
           END-EVALUATE.                                                06050099
                                                                        06060099
       EJECT.                                                           06070099
      ******************************************************************06080099
      *UNDOES ANY CHANGES PERFORMED IF SQLCODES ARE NOT ZEROS           06090099
      ******************************************************************06100099
       9999-ROLLBACK-CHANGES.                                           06110099
                                                                        06120099
           MOVE '9999-ROLLBACK-CHANGES' TO PV-PARAGRAPH-NAME.           06130099
                                                                        06140099
           EXEC SQL                                                     06150099
                ROLLBACK                                                06160099
           END-EXEC.                                                    06170099
                                                                        06180099
           EVALUATE TRUE                                                06190099
      ***SUCCESSFUL PROCESSING                                          06200099
              WHEN SQLCODE = ZEROS                                      06210099
                   DISPLAY 'ALL CHANGES ROLLED BACK DUE TO SQL ERROR'   06220099
                   SET PS-ACTION-NOTHING   TO TRUE                      06230099
              WHEN OTHER                                                06240099
                   CONTINUE                                             06250099
           END-EVALUATE.                                                06260099
                                                                        06270099
       EJECT.                                                           06280099
      ******************************************************************06290099
      **PASS SQLCODE TO CALLING AND EXIT PROGRAM                        06300099
      ******************************************************************06310099
       9999-WRAPUP.                                                     06320099
                                                                        06330099
           MOVE '9999-WRAPUP' TO PV-PARAGRAPH-NAME.                     06340099
                                                                        06350099
           MOVE SQLCODE       TO LV-RETURN-CODE.                        06360099
                                                                        06370099
           IF  SQLCODE NOT EQUAL ZEROS                                  06380099
               PERFORM 9999-ROLLBACK-CHANGES                            06390099
           END-IF.                                                      06400099
                                                                        06410099
           MOVE PS-ACTION-IND         TO LV-ACTION-IND.                 06420099
                                                                        06430099
           EXIT PROGRAM.                                                06440099
                                                                        06450099
       EJECT.                                                           06460099
