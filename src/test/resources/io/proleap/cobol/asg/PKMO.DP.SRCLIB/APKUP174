000100*------------------------*                                        00010009
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------*                                        00030009
000400 PROGRAM-ID.     APKUP174.                                        00040078
000500 AUTHOR.         COGNIZANT.                                       00050083
000600 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00060009
000700 DATE-WRITTEN.   MARCH 2019.                                      00070078
000800 DATE-COMPILED.                                                   00080009
000900                                                                  00090009
001000*---------------------------------------------------------------* 00100009
001100*  LOADS DATA TO APT_AP_MEMO DB2 TABLE                       *    00110078
001200*---------------------------------------------------------------* 00120009
001300*                 COBOL 2 WITH PEOPLESOFT SQL                   * 00130009
001400*---------------------------------------------------------------* 00140009
001500*                                                               * 00150009
001600*    THIS PROGRAM IS TO LOAD THE AP MEMORANDUM DATA INTO THE    * 00160090
001700*  APT_AP_MEMO DB2 TABLE.                                       * 00170090
001800*                                                               * 00180090
001900*                                                               * 00190009
002000*---------------------------------------------------------------* 00200009
002100*                                                               * 00210009
      *  DB2 TABLES:                                DCLGENS:          * 00211078
      *   1. APT_AP_MEMO                            (APT00001)        * 00212078
      *                                                               * 00213078
      *  INPUT:                                     COPYBOOK:         * 00214078
      *   1. INPUT-FILE                             APRD130           * 00215088
      *                                                               * 00216078
      *---------------------------------------------------------------* 00310078
      * CHANGE LOG:                                                   * 00320078
      *   DATE  03/13/2019                                            * 00330078
      *       CHANGE MADE: NEW PROGRAM                                * 00340078
      *       MADE BY: COGNIZANT               WR/IR #: CHG0220043    * 00350090
      *                                                               * 00360078
      *---------------------------------------------------------------* 00361078
003700                                                                  00370009
003800*---------------------*                                           00380009
003900 ENVIRONMENT DIVISION.                                            00390009
004000*---------------------*                                           00400009
004100 CONFIGURATION SECTION.                                           00410009
004200 SOURCE-COMPUTER.        IBM-3090.                                00420009
004300 OBJECT-COMPUTER.        IBM-3090.                                00430009
004400                                                                  00440009
004500 INPUT-OUTPUT SECTION.                                            00450009
004600 FILE-CONTROL.                                                    00460009
004700                                                                  00470009
004800     SELECT INPUT-FILE          ASSIGN TO INP01.                  00480041
004900                                                                  00490009
005000*---------------------*                                           00500009
005100 DATA DIVISION.                                                   00510009
005200*---------------------*                                           00520009
005300 FILE SECTION.                                                    00530009
005400                                                                  00540009
005500 FD  INPUT-FILE                                                   00550009
005600     RECORDING MODE IS F                                          00560009
005700     LABEL RECORDS ARE STANDARD                                   00570009
005800     RECORD CONTAINS 157 CHARACTERS                               00580009
005900     BLOCK CONTAINS 0  RECORDS.                                   00590009
006000 01  INPUT-REC                        PIC X(157).                 00600009
006100                                                                  00610009
006180                                                                  00618077
006200 WORKING-STORAGE SECTION.                                         00620009
006300                                                                  00630009
006400 01  FILLER                      PIC  X(27)     VALUE             00640009
006500     '** START OF APKUP174 W/S **'.                               00650078
006600                                                                  00660009
006700 01  PROGRAM-CONSTANTS.                                           00670009
006800     05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'APKUP174'.  00680086
007200                                                                  00720009
007300 01  PROGRAM-SWITCHES.                                            00730009
007400     05  PS-EOF-SW                    PIC X(01) VALUE 'N'.        00740022
007500         88  PS-EOF                             VALUE 'Y'.        00750022
008200                                                                  00820009
008300 01  PROGRAM-VARIABLES.                                           00830022
008800     05  PV-DISP-NBR                  PIC Z,ZZZ,ZZ9.              00880022
008900     05  PV-ABEND-CODE                PIC S9(04) COMP SYNC        00890022
009000                                                 VALUE ZERO.      00900022
009030                                                                  00903077
009100 01  PV-COUNTERS.                                                 00910009
009200     05  PV-INPUT-COUNT               PIC S9(07) COMP-3           00920009
009300                                          VALUE ZERO.             00930009
009400     05  PV-INSERT-COUNT              PIC S9(07) COMP-3           00940009
009500                                          VALUE ZERO.             00950009
013300                                                                  01330077
      *----------------------------------------------------------------*01369978
      *    SQL COMMUNICATIONS AREA DCLGEN                               01370078
      *----------------------------------------------------------------*01370178
           EXEC SQL                                                     01370278
                INCLUDE SQLCA                                           01370378
           END-EXEC.                                                    01370478
           COPY SQLCA2.                                                 01370578
                                                                        01370678
      *----------------------------------------------------------------*01370778
      *    AP NEW MEMORANDUM TABLE - APT_AP_MEMO                        01370878
      *----------------------------------------------------------------*01370978
           EXEC SQL                                                     01371078
                INCLUDE APT00001                                        01371178
           END-EXEC.                                                    01371278
                                                                        01371378
015700                                                                  01570009
015730*----------------------------------------------------------------*01573059
015740*    COPYBOOK FOR INPUT FILE                                      01574059
015750*----------------------------------------------------------------*01575059
015760     COPY APRD130.                                                01576063
015770                                                                  01577059
015800*----------------------------------------------------------------*01580009
015900*    ABEND DATA AREAS                                             01590009
016000*----------------------------------------------------------------*01600009
016100 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      01610009
016200                                   COMP         SYNC.             01620009
016300                                                                  01630009
016400     88  AC-ANY-ERROR                           VALUE  +4001      01640009
016500                                                THRU   +4019.     01650009
016600     88  AC-OPEN-ERROR                          VALUE  +4005.     01660009
016700     88  AC-CLOSE-ERROR                         VALUE  +4006.     01670009
016800     88  AC-INVALID-DATA                        VALUE  +4008.     01680009
           88  AC-DB2-ERROR                           VALUE  +4013.     01690086
017000     88  AC-UNSUCCESSFUL-SELECT                 VALUE  +4015.     01700009
017200                                                                  01720009
017300 01  ABEND-AREAS.                                                 01730009
017400     05  AA-ABEND-LIT              PIC  X(40)   VALUE             01740009
017500             '*****       ABEND'.                                 01750009
017600     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             01760009
017700             '*****   PROGRAM: APKUP174'.                         01770087
017800     05  AA-PARAGRAPH-LIT.                                        01780009
017900         10  FILLER                PIC  X(17)   VALUE             01790009
018000             '***** PARAGRAPH: '.                                 01800009
018100         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     01810009
018200     05  AA-MESSAGE-LINE-1.                                       01820009
018300         10  FILLER                PIC  X(06)   VALUE '*****'.    01830009
018400         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     01840009
018500     05  AA-MESSAGE-LINE-2.                                       01850009
018600         10  FILLER                PIC  X(06)   VALUE '*****'.    01860009
018700         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     01870009
           05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01880086
                   '*****    DB2 ERROR'.                                01890086
           05  AA-DB2-OPERATION-LIT.                                    01900086
               10  FILLER              PIC  X(17)  VALUE                01910086
                   '***** OPERATION: '.                                 01920086
               10  AA-DB2-OPERATION.                                    01930086
                   15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01940086
                   15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01950086
           05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01960086
           05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01970086
                                                                        01980086
019900*----------------------------------------------------------------*01990009
020000*    SQLCA FORMATTED MESSAGE AREA                                 02000009
020100*----------------------------------------------------------------*02010009
020200     COPY DPWS004.                                                02020009
020300                                                                  02030009
020400*                                                                 02040009
020500 01  FILLER                      PIC  X(25)     VALUE             02050009
020600     '** END OF APKUP174 W/S **'.                                 02060079
020700                                                                  02070009
020800*-------------------*                                             02080009
020900 PROCEDURE DIVISION.                                              02090009
021000*-------------------*                                             02100009
021100 A100-MAIN.                                                       02110009
021200                                                                  02120022
021300     PERFORM B100-INITIALIZE.                                     02130009
021400                                                                  02140009
021500     PERFORM B200-PROCESS UNTIL PS-EOF.                           02150009
021600                                                                  02160009
021700     PERFORM B300-EOJ.                                            02170009
021800                                                                  02180009
021900     GOBACK.                                                      02190009
022000                                                                  02200009
022100*----------------------------------------------------------------*02210009
022200*    INITIALIZATION PROCESSING                                    02220009
022300*    - OPEN FILE                                                  02230009
022400*    - INITIALIZE DCLGENS AND SWITCHES                            02240009
022500*    - PERFORM SELECTS                                            02250009
022600*----------------------------------------------------------------*02260009
022700 B100-INITIALIZE.                                                 02270009
022800                                                                  02280022
022801     OPEN INPUT INPUT-FILE.                                       02280187
022803                                                                  02280343
023700     INITIALIZE  AP130-INPUT-FILE                                 02370063
023910                 DCLAPT00001                                      02391079
024000                 PROGRAM-SWITCHES.                                02400009
024100                                                                  02410009
024800        PERFORM R100-READ-INPUT-FILE                              02480009
025000                                                                  02500009
025100     IF PS-EOF                                                    02510009
              DISPLAY '**********EMPTY INPUT FILE**********'            02520079
027100     END-IF.                                                      02710010
027200                                                                  02720010
027370*----------------------------------------------------------------*02737010
027400*    PROCESS INPUT FILE                                           02740010
027500*----------------------------------------------------------------*02750010
027600 B200-PROCESS.                                                    02760010
027700                                                                  02770014
027800     PERFORM I100-INSERT-RECORD.                                  02780014
027900                                                                  02790014
028200     PERFORM R100-READ-INPUT-FILE.                                02820014
028300                                                                  02830014
028400*----------------------------------------------------------------*02840014
028500*    END OF PROGRAM                                               02850014
028600*    - CLOSE FILE                                                 02860014
028700*    - DISPLAY COUNTS                                             02870014
028800*----------------------------------------------------------------*02880014
028900 B300-EOJ.                                                        02890014
029000                                                                  02900022
029100     CLOSE INPUT-FILE.                                            02910079
029700                                                                  02970014
029800     DISPLAY '****************************************'.          02980021
029900     MOVE PV-INPUT-COUNT              TO PV-DISP-NBR.             02990014
030000     DISPLAY '** RECORDS READ         = ' PV-DISP-NBR.            03000014
030100     MOVE PV-INSERT-COUNT             TO PV-DISP-NBR.             03010014
030200     DISPLAY '** RECORDS INSERTED     = ' PV-DISP-NBR.            03020014
030700     DISPLAY '****************************************'.          03070021
030800     DISPLAY '**     END OF APKUP174 PROCESSING     **'.          03080079
030900     DISPLAY '****************************************'.          03090021
031000                                                                  03100014
031100*----------------------------------------------------------------*03110014
031200*    INSERT ROW TO APT_AP_MEMO                                    03120078
031300*----------------------------------------------------------------*03130014
031400 I100-INSERT-RECORD.                                              03140014
031500                                                                  03150014
031510     MOVE AP130-VENDOR-ID          TO  APT00001-VENDOR-ID.        03151080
031520     MOVE AP130-INVOICE-ID         TO  APT00001-INVOICE-ID.       03152080
031530     MOVE AP130-KC-SKU-NBR         TO  APT00001-KC-SKU-NBR.       03153080
031540     MOVE AP130-DEPTID             TO  APT00001-DEPTID.           03154080
031550     MOVE AP130-KC-PO-NBR          TO  APT00001-KC-PO-NBR.        03155080
031560     MOVE AP130-KC-VS-NBR          TO  APT00001-KC-VS-NBR.        03156080
031570     MOVE AP130-KC-INVC-QTY        TO  APT00001-KC-INVC-QTY.      03157080
031580     MOVE AP130-KC-RCVD-QTY        TO  APT00001-KC-RCVD-QTY.      03158080
031590     MOVE AP130-KC-INVC-COST-AMT   TO  APT00001-KC-INVC-COST-AMT. 03159080
031592     MOVE AP130-KC-ORD-COST-AMT    TO  APT00001-KC-ORD-COST-AMT.  03159280
031594     MOVE AP130-KC-TOT-COST-AMT    TO  APT00001-KC-TOT-COST-AMT.  03159480
031596     MOVE AP130-ORIGIN             TO  APT00001-ORIGIN.           03159680
031597     MOVE AP130-KC-CRE-DTE         TO  APT00001-KC-CRE-DTE.       03159780
031598     MOVE AP130-KC-AP-MEMO-TMST    TO  APT00001-KC-AP-MEMO-TMST.  03159880
031600     MOVE AP130-UPC-ID             TO  APT00001-UPC-ID.           03160080
031601                                                                  03160141
032200                                                                  03220014
032300          EXEC SQL                                                03230014
032400              INSERT INTO APT_AP_MEMO                             03240078
032500                  (VENDOR_ID                                      03250014
032600                  ,INVOICE_ID                                     03260014
032700                  ,KC_SKU_NBR                                     03270014
032800                  ,DEPTID                                         03280014
032900                  ,KC_PO_NBR                                      03290014
033000                  ,KC_VS_NBR                                      03300014
033100                  ,KC_INVC_QTY                                    03310014
033200                  ,KC_RCVD_QTY                                    03320014
033300                  ,KC_INVC_COST_AMT                               03330014
033400                  ,KC_ORD_COST_AMT                                03340014
033500                  ,KC_TOT_COST_AMT                                03350014
033600                  ,ORIGIN                                         03360014
033700                  ,KC_CRE_DTE                                     03370014
033800                  ,KC_AP_MEMO_TMST                                03380014
033900                  ,UPC_ID                                         03390014
034000              )                                                   03400014
034100                  VALUES                                          03410014
                       (:APT00001-VENDOR-ID                             03411083
                       ,:APT00001-INVOICE-ID                            03412083
                       ,:APT00001-KC-SKU-NBR                            03413083
                       ,:APT00001-DEPTID                                03414083
                       ,:APT00001-KC-PO-NBR                             03415083
                       ,:APT00001-KC-VS-NBR                             03416083
                       ,:APT00001-KC-INVC-QTY                           03417083
                       ,:APT00001-KC-RCVD-QTY                           03418083
                       ,:APT00001-KC-INVC-COST-AMT                      03419083
                       ,:APT00001-KC-ORD-COST-AMT                       03419183
                       ,:APT00001-KC-TOT-COST-AMT                       03419283
                       ,:APT00001-ORIGIN                                03419383
                       ,:APT00001-KC-CRE-DTE                            03419483
                       ,:APT00001-KC-AP-MEMO-TMST                       03419583
                       ,:APT00001-UPC-ID                                03419683
                    )                                                   03419783
035800          END-EXEC                                                03580014
035900                                                                  03590014
036000        EVALUATE TRUE                                             03600014
036100           WHEN SQLCODE = ZERO                                    03610014
036200               ADD 1               TO PV-INSERT-COUNT             03620014
036500                                                                  03650014
036600           WHEN SQLWARN0 NOT = SPACES                             03660014
036700           WHEN SQLCODE  NOT = ZERO                               03670014
036800               MOVE 'I100-INSERT-RECORD'                          03680014
036900                                   TO AA-PARAGRAPH-NAME           03690014
037000               DISPLAY '** PLAN_NAME: ' PC-PROGRAM-NAME           03700014
037100               MOVE 'UNSUCCESSFUL INSERT' TO AA-DB2-OPERATION     03710087
037200               MOVE 'APT00001'     TO AA-DB2-TABLE-1              03720087
037300               MOVE SPACES         TO AA-DB2-TABLE-2              03730087
037400               PERFORM Z998-DB2-ABEND                             03740084
037500        END-EVALUATE.                                             03750084
037800                                                                  03780014
038600                                                                  03860014
038700*----------------------------------------------------------------*03870014
038800*    READ INPUT FILE                                              03880014
038900*----------------------------------------------------------------*03890014
039000 R100-READ-INPUT-FILE.                                            03900014
039100                                                                  03910022
039200     READ INPUT-FILE INTO AP130-INPUT-FILE                        03920063
039300          AT END                                                  03930014
039400              SET PS-EOF                   TO TRUE                03940014
039500          NOT AT END                                              03950014
039600              ADD 1                        TO PV-INPUT-COUNT      03960014
039700     END-READ.                                                    03970014
039800                                                                  03980014
058800                                                                  05880014
      *----------------------------------------------------------------*06850084
      *    DB2 ABEND ROUTINE                                            06860084
      *----------------------------------------------------------------*06870084
       Z998-DB2-ABEND.                                                  06880084
                                                                        06890084
           CLOSE INPUT-FILE.                                            06900084
                                                                        06900184
                                                                        06910084
           DISPLAY AA-ABEND-LIT.                                        06920084
           DISPLAY AA-MESSAGE-LINE-1.                                   06930084
           DISPLAY AA-MESSAGE-LINE-2.                                   06940084
           DISPLAY AA-DB2-ERROR-LIT.                                    06950084
           DISPLAY AA-PROGRAM-LIT.                                      06960084
           DISPLAY AA-PARAGRAPH-LIT.                                    06970084
           DISPLAY AA-DB2-OPERATION-LIT.                                06980084
           DISPLAY AA-DB2-TABLE-1.                                      06990084
           DISPLAY AA-DB2-TABLE-2.                                      07000084
           SET AC-DB2-ERROR TO TRUE.                                    07010084
                                                                        07020084
           COPY DPPD004.                                                07030084
                                                                        07040084
           CALL 'ILBOABN0' USING ABEND-CODE.                            07050084
071200                                                                  07120014
