000100 IDENTIFICATION DIVISION.                                         00010000
001600 PROGRAM-ID.             SNKUP023.                                00160000
001700 AUTHOR.                 TKMA479.                                 00170000
001800 INSTALLATION.           KOHLS.                                   00180000
001900 DATE-WRITTEN            MAY, 2004.                               00190000
002000 DATE-COMPILED.                                                   00200000
002010******************************************************************00201000
002020* THIS PROGRAM, SNKUP023, IS A CALLED PROGRAM FROM               *00202000
002030* SNKUP001.  IS USED TO SEND PACK LOCKS FROM NON-STANDARD        *00203000
002040* ASN FORMATS.                                                   *00204000
002050******************************************************************00205000
002100******************************************************************00206000
002100*CHANGE HISTORY                                                  *00207000
002100******************************************************************00208000
001300* 11/07/14 TKMAJC7 - PRITHIVIRAJ SUBRAMANIAN (COGNIZANT)         *00209000
001300*          CHANGES THRU OUT THE PROGRAM TO INCREASE SIZE OF PO#  *00209100
001300*          FROM 7 DIGITS TO 8 DIGITS.  TAGGED WITH *PS 11/07/2014*00209200
002100******************************************************************00209300
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627         00209599
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00209699
263627* MAKING THE CALL DYNAMIC VS STATIC.                              00209799
002100******************************************************************00209899
002100                                                                  00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300                                                                  00230000
002400 DATA DIVISION.                                                   00240000
002500                                                                  00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700                                                                  00270000
002800 01  WS-COMMUNICATIONS.                                           00280000
002900     05  WS-PUB-TABLE OCCURS 10000 TIMES.                         00290000
003000         10  WS-PUB-SKU               PIC 9(8).                   00300000
003100*PS 11/07/2014 CHANGE STARTS                                      00310000
003100         10  WS-PUB-PO                PIC 9(8).                   00311000
003100*PS 11/07/2014 CHANGE ENDS                                        00312000
003200     05  WS-PO                        PIC X(22).                  00320000
003300     05  WS-UPC                       PIC S9(17) COMP-3.          00330000
003360                                                                  00336000
023901 01  WS-VARIABLES.                                                02390100
023902     05  PC-DEFAULT-TMST            PIC X(26)  VALUE              02390200
023903         '0001-01-01-00.00.00.000000'.                            02390300
023904     05  WS-CURR-ELEMENT              PIC 9(7)  VALUE 0.          02390400
023905     05  WS-SUB                       PIC 9(7)  VALUE 0.          02390500
023906     05  WS-END-OF-TBL-SW             PIC X     VALUE 'N'.        02390600
023907         88  END-OF-TBL                         VALUE 'Y'.        02390700
023908         88  NOT-END-OF-TBL                     VALUE 'N'.        02390800
023909     05  WS-ID-SW                     PIC X     VALUE 'N'.        02390900
023910         88  PACK-ID-FOUND                      VALUE 'Y'.        02391000
023911         88  PACK-ID-NOT-FOUND                  VALUE 'N'.        02391100
023912     05  WS-ERROR-SW                  PIC X     VALUE 'N'.        02391200
023913         88  ERROR-FOUND                        VALUE 'Y'.        02391300
023914         88  ERROR-NOT-FOUND                    VALUE 'N'.        02391400
023915*PS 11/07/2014 CHANGE STARTS                                      02391500
023915     05  PW-PO-NBR-N                  PIC 9(8).                   02391600
023915*PS 11/07/2014 CHANGE ENDS                                        02391700
023916     05  WS-PUBLISH-MESSAGE.                                      02391800
023917         10  FILLER                   PIC X(9)  VALUE 'SNKUP023 '.02391900
023918         10  WS-PUBLISH-PO            PIC 9(8)  VALUE 0.          02392000
023919         10  FILLER                   PIC X(14) VALUE             02392100
023920             'ASNPCK        '.                                    02392200
023921         10  FILLER                   PIC X(20) VALUE             02392300
023922             'ASN PACK RECEIPT    '.                              02392400
023923         10  WS-PUBLISH-SKU           PIC 9(8)  VALUE 0.          02392500
023924*                                                                 02392600
023925*  NUMERIC EDIT LAYOUT                                            02392700
023930*                                                                 02393000
023940     COPY DPWS010I.                                               02394000
023941                                                                  02394100
023942* DB2 COMMUNICATION AREA.                                         02394200
023943*                                                                 02394300
023944     EXEC SQL                                                     02394400
023945         INCLUDE SQLCA                                            02394500
023946     END-EXEC.                                                    02394600
023947                                                                  02394700
023948* DB2 COMMUNICATION AREA 2                                        02394800
023949*                                                                 02394900
023950     COPY SQLCA2.                                                 02395000
023960                                                                  02396000
023970     EXEC SQL                                                     02397000
023980         INCLUDE XLT00003                                         02398000
023990     END-EXEC.                                                    02399000
023991                                                                  02399100
023992     EXEC SQL                                                     02399200
023993         INCLUDE XLT00006                                         02399300
023994     END-EXEC.                                                    02399400
023995                                                                  02399500
023996     EXEC SQL                                                     02399600
023997         INCLUDE TPURITM                                          02399700
023998     END-EXEC.                                                    02399800
023999                                                                  02399900
024000     EXEC SQL                                                     02400000
024001         INCLUDE TPOPRPK                                          02400100
024002     END-EXEC.                                                    02400200
024003                                                                  02400300
024004     EXEC SQL                                                     02400400
024005         INCLUDE WFT00001                                         02400500
024006     END-EXEC.                                                    02400600
024007                                                                  02400700
024008     EXEC SQL                                                     02400800
024009         INCLUDE WFT00002                                         02400900
024010     END-EXEC.                                                    02401000
024011                                                                  02401100
024020 LINKAGE SECTION.                                                 02402000
024100                                                                  02410000
024200 01  WS-TRANSFER.                                                 02420000
024210     05  WS-TABLE-PUB.                                            02421000
024220         10  WS-PUBLISH OCCURS 10000 TIMES.                       02422000
024230             15  WS-TRAN-SKU          PIC 9(8).                   02423000
024240*PS 11/07/2014 CHANGE STARTS                                      02424000
024240             15  WS-TRAN-PO           PIC 9(8).                   02424100
024240*PS 11/07/2014 CHANGE ENDS                                        02424200
024250     05  WS-ASNORD-PO-NBR             PIC X(22).                  02425000
024260     05  WS-ASNDTL-UPC-NBR            PIC S9(17) COMP-3.          02426000
024300                                                                  02430000
024500 PROCEDURE DIVISION USING WS-TRANSFER.                            02450000
024600                                                                  02460000
024700 0000-MAINLINE.                                                   02470000
024800                                                                  02480000
025000     MOVE WS-TRANSFER TO WS-COMMUNICATIONS.                       02500000
025001                                                                  02500100
025002     SET ERROR-NOT-FOUND TO TRUE.                                 02500200
025003                                                                  02500300
025010     PERFORM S050-NUMERIC-PO.                                     02501000
025011                                                                  02501100
025012     IF ERROR-NOT-FOUND                                           02501200
025020        PERFORM S100-GET-ITEM                                     02502000
025021     END-IF.                                                      02502100
025022                                                                  02502200
025023     IF ERROR-NOT-FOUND                                           02502300
025030        PERFORM S200-PACK-ID                                      02503000
025031     END-IF.                                                      02503100
025032                                                                  02503200
025033     IF ERROR-NOT-FOUND                                           02503300
025040        PERFORM S300-PACK-SKU                                     02504000
025041     END-IF.                                                      02504100
025042                                                                  02504200
025043     IF ERROR-NOT-FOUND                                           02504300
025044        PERFORM S450-FIND                                         02504400
025045     END-IF.                                                      02504500
025046                                                                  02504600
025047     IF ERROR-NOT-FOUND                                           02504700
025050        IF PACK-ID-FOUND                                          02505000
025060           CONTINUE                                               02506000
025070        ELSE                                                      02507000
025100           PERFORM S400-FIND-LAST                                 02510000
025200           MOVE PW-PO-NBR-N TO                                    02521000
025300              WS-PUB-PO(WS-CURR-ELEMENT)                          02530000
025400           MOVE POPRPK-PK-SKU-NBR TO                              02540000
025500              WS-PUB-SKU(WS-CURR-ELEMENT)                         02550000
025600           MOVE PW-PO-NBR-N TO WS-PUBLISH-PO                      02560000
025700           MOVE POPRPK-PK-SKU-NBR TO                              02570000
025800              WS-PUBLISH-SKU                                      02580000
026400           PERFORM S600-INSERT-WFT-LOD-XFER                       02640000
026410           IF ERROR-NOT-FOUND                                     02641000
026500              PERFORM S500-INSERT-WFT-LOD-CNTL                    02650000
026520           END-IF                                                 02652000
026521        END-IF                                                    02652100
026522     END-IF.                                                      02652200
026600                                                                  02660000
026601     MOVE WS-COMMUNICATIONS TO WS-TRANSFER.                       02660100
026602                                                                  02660200
026610     MOVE 0 TO RETURN-CODE.                                       02661000
026620                                                                  02662000
026700     GOBACK.                                                      02670000
030800                                                                  03080000
030801************************************************                  03080100
030802* GET NUMERIC FORM OF PO                                          03080200
030803************************************************                  03080300
030804 S050-NUMERIC-PO.                                                 03080400
030805                                                                  03080500
030806     MOVE WS-PO TO DP010I-UNEDITED-FIELD                          03080600
030807*PS 11/07/2014 CHANGE STARTS                                      03080700
030807     MOVE 8 TO DP010I-MAXIMUM-DIGITS                              03080800
030807*PS 11/07/2014 CHANGE ENDS                                        03080900
030808     MOVE ZERO TO DP010I-MAXIMUM-DECIMALS                         03081000
030809     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                      03081100
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03081399
263627          USING DP010I-NUMERIC-EDIT-AREA                          03081499
030811     IF DP010I-ERROR-DETECTED                                     03081500
030812        MOVE ZERO           TO PW-PO-NBR-N                        03081600
030813        SET ERROR-FOUND TO TRUE                                   03081700
030814     ELSE                                                         03081800
030815        MOVE DP010I-NUMERIC-FIELD                                 03081900
030816                            TO PW-PO-NBR-N                        03082000
030817     END-IF.                                                      03082100
030818                                                                  03082200
030819************************************************                  03082300
030820* GET ITEM FROM UPC                                               03082400
030821************************************************                  03082500
030822 S100-GET-ITEM.                                                   03082600
030823                                                                  03082700
030824     MOVE WS-UPC TO XLT00006-UPC-NBR.                             03082800
030830     EXEC SQL                                                     03083000
030840        SELECT A.ITM_NBR                                          03084000
030850          INTO :XLT00003-ITM-NBR                                  03085000
030860          FROM XLT_SKU A,                                         03086000
030870               XLT_UPC B                                          03087000
030880          WHERE B.UPC_NBR     = :XLT00006-UPC-NBR AND             03088000
030890                A.INTR_UPC_ID = B.INTR_UPC_ID                     03089000
030892     END-EXEC.                                                    03089200
030893                                                                  03089300
030894     MOVE SQLCODE    TO SQLCODE2.                                 03089400
030895                                                                  03089500
030896     EVALUATE TRUE                                                03089600
030897        WHEN SQLCODE = 0                                          03089700
030898           CONTINUE                                               03089800
030901        WHEN OTHER                                                03090100
030902             SET ERROR-FOUND TO TRUE                              03090200
030903             DISPLAY '******************************************' 03090300
030904             DISPLAY 'SQLCODE => ' SQLCODE2                       03090400
030905             DISPLAY 'S100-GET ITEM'                              03090500
030906             DISPLAY 'SNKUP023'                                   03090600
030907             DISPLAY 'ERROR GETTING ITEM  '                       03090700
030908             DISPLAY 'PO: ' PW-PO-NBR-N                           03090800
030909             DISPLAY 'UPC: ' XLT00006-UPC-NBR                     03090900
030910             DISPLAY '******************************************' 03091000
030917     END-EVALUATE.                                                03091700
030918                                                                  03091800
030919************************************************                  03091900
030920* GET PACK ID USING PO AND ITEM                                   03092000
030921************************************************                  03092100
030922 S200-PACK-ID.                                                    03092200
030923     MOVE PW-PO-NBR-N TO PURITM-PO-NBR.                           03092300
030924     EXEC SQL                                                     03092400
030925        SELECT A.PO_PREPK_ID                                      03092500
030926          INTO :PURITM-PO-PREPK-ID                                03092600
030927          FROM TPURITM A                                          03092700
030928          WHERE A.PO_NBR      = :PURITM-PO-NBR     AND            03092800
030929                A.ITM_NBR     = :XLT00003-ITM-NBR  AND            03092900
030930                A.VER_STATUS_CDE = 'A' AND                        03093000
030931                A.STATUS_CDE ^= 'CA'                              03093100
030932     END-EXEC.                                                    03093200
030933                                                                  03093300
030934     MOVE SQLCODE    TO SQLCODE2.                                 03093400
030935                                                                  03093500
030936     EVALUATE TRUE                                                03093600
030937        WHEN SQLCODE = 0                                          03093700
030938           CONTINUE                                               03093800
030939        WHEN OTHER                                                03093900
030940             SET ERROR-FOUND TO TRUE                              03094000
030941             DISPLAY '******************************************' 03094100
030942             DISPLAY 'SQLCODE => ' SQLCODE2                       03094200
030943             DISPLAY 'S200-PACK-ID'                               03094300
030944             DISPLAY 'SNKUP023'                                   03094400
030945             DISPLAY 'ERROR GETTING PACK ID   '                   03094500
030946             DISPLAY 'PO: ' PURITM-PO-NBR                         03094600
030947             DISPLAY 'ITEM: ' XLT00003-ITM-NBR                    03094700
030948             DISPLAY 'UPC: ' XLT00006-UPC-NBR                     03094800
030949             DISPLAY '******************************************' 03094900
030950     END-EVALUATE.                                                03095000
030951                                                                  03095100
030952************************************************                  03095200
030953* GET PACK SKU USING PO AND PACK ID                               03095300
030954************************************************                  03095400
030955 S300-PACK-SKU.                                                   03095500
030956                                                                  03095600
030957     EXEC SQL                                                     03095700
030958        SELECT A.PK_SKU_NBR                                       03095800
030959          INTO :POPRPK-PK-SKU-NBR                                 03095900
030960          FROM TPOPRPK A                                          03096000
030961          WHERE A.PO_NBR      = :PURITM-PO-NBR     AND            03096100
030962                A.PO_PREPK_ID = :PURITM-PO-PREPK-ID               03096200
030963     END-EXEC.                                                    03096300
030964                                                                  03096400
030965     MOVE SQLCODE    TO SQLCODE2.                                 03096500
030966                                                                  03096600
030967     EVALUATE TRUE                                                03096700
030968        WHEN SQLCODE = 0                                          03096800
030969           CONTINUE                                               03096900
030970        WHEN OTHER                                                03097000
030971             SET ERROR-FOUND TO TRUE                              03097100
030980             DISPLAY '******************************************' 03098000
030981             DISPLAY 'SQLCODE => ' SQLCODE2                       03098100
030982             DISPLAY 'S300-PACK-SKU'                              03098200
030983             DISPLAY 'SNKUP023'                                   03098300
030984             DISPLAY 'ERROR GETTING PACK SKU   '                  03098400
030985             DISPLAY 'PO: ' PURITM-PO-NBR                         03098500
030986             DISPLAY 'ID: ' PURITM-PO-PREPK-ID                    03098600
030987             DISPLAY 'ITEM: ' XLT00003-ITM-NBR                    03098700
030988             DISPLAY 'UPC: ' XLT00006-UPC-NBR                     03098800
030989             DISPLAY '******************************************' 03098900
030990     END-EVALUATE.                                                03099000
030991                                                                  03099100
030992************************************************                  03099200
030993* FIND LAST USED ELEMENT WITHIN TABLE                             03099300
030994************************************************                  03099400
030995 S400-FIND-LAST.                                                  03099500
030996                                                                  03099600
030997     SET NOT-END-OF-TBL TO TRUE.                                  03099700
030998     MOVE 0 TO WS-CURR-ELEMENT.                                   03099800
030999     PERFORM                                                      03099900
031000        VARYING WS-SUB FROM 1 BY 1                                03100000
031001        UNTIL END-OF-TBL OR                                       03100100
031002              WS-SUB > 10000                                      03100200
031003        ADD 1 TO WS-CURR-ELEMENT                                  03100300
031004        IF WS-PUB-SKU(WS-SUB) > 0                                 03100400
031005           CONTINUE                                               03100500
031006        ELSE                                                      03100600
031007           SET END-OF-TBL TO TRUE                                 03100700
031008        END-IF                                                    03100800
031009     END-PERFORM.                                                 03100900
031010                                                                  03101000
031011************************************************                  03101100
031012* DETERMINE IF LOCK WAS ALREADY SENT                              03101200
031013************************************************                  03101300
031014 S450-FIND.                                                       03101400
031015     SET PACK-ID-NOT-FOUND TO TRUE.                               03101500
031016     PERFORM                                                      03101600
031017        VARYING WS-SUB  FROM 1 BY 1                               03101700
031018        UNTIL (WS-PUB-PO(WS-SUB) = 0 AND                          03101800
031019               WS-PUB-SKU(WS-SUB) = 0)    OR                      03101900
031020              PACK-ID-FOUND                OR                     03102000
031021              WS-SUB > 10000                                      03102100
031022        IF WS-PUB-PO(WS-SUB) = PW-PO-NBR-N AND                    03102200
031023           WS-PUB-SKU(WS-SUB) = POPRPK-PK-SKU-NBR                 03102300
031024           SET PACK-ID-FOUND TO TRUE                              03102400
031025        END-IF                                                    03102500
031026     END-PERFORM.                                                 03102600
031027                                                                  03102700
031028 S500-INSERT-WFT-LOD-CNTL.                                        03102800
031029                                                                  03102900
031030     EXEC SQL                                                     03103000
031031         INSERT INTO WFT_LOD_CNTL                                 03103100
031032             ( PRC_CNTL_TMST                                      03103200
031033              ,TRN_TYP_CDE                                        03103300
031034              ,STAT_CDE                                           03103400
031035              ,INIT_PRCG_BEG_TMST                                 03103500
031036              ,END_TMST                                           03103600
031037              ,ARCH_DAT_IND                                       03103700
031038              ,DAT_LOD_VER_NBR                                    03103800
031039              ,STR_NBR                                            03103900
031040             )                                                    03104000
031041         VALUES                                                   03104100
031042             (:WFT00002-PRC-CNTL-TMST                             03104200
031043             ,'ASNPCK'                                            03104300
031044             ,'READY'                                             03104400
031045             ,:PC-DEFAULT-TMST                                    03104500
031046             ,:PC-DEFAULT-TMST                                    03104600
031047             ,'N'                                                 03104700
031048             ,10.01                                               03104800
031049             ,0900                                                03104900
031050             )                                                    03105000
031051     END-EXEC.                                                    03105100
031052                                                                  03105200
031053     MOVE SQLCODE    TO SQLCODE2.                                 03105300
031054                                                                  03105400
031055     EVALUATE TRUE                                                03105500
031056       WHEN SQLCODE = ZERO                                        03105600
031057           CONTINUE                                               03105700
031058       WHEN OTHER                                                 03105800
031059             SET ERROR-FOUND TO TRUE                              03105900
031060             DISPLAY '******************************************' 03106000
031061             DISPLAY 'SQLCODE => ' SQLCODE2                       03106100
031062             DISPLAY 'S500-INSERT-WFT-LOD-CNTL'                   03106200
031063             DISPLAY 'SNKUP023'                                   03106300
031064             DISPLAY 'ERROR ISSUED ON INSERT   '                  03106400
031065             DISPLAY '******************************************' 03106500
031066     END-EVALUATE.                                                03106600
031067                                                                  03106700
031068 S600-INSERT-WFT-LOD-XFER.                                        03106800
031069                                                                  03106900
031070     INITIALIZE WFT00002-LOD-DAT-TXT.                             03107000
031071                                                                  03107100
031072     EXEC SQL                                                     03107200
031073         SET :WFT00002-PRC-CNTL-TMST = CURRENT TIMESTAMP          03107300
031074     END-EXEC.                                                    03107400
031075                                                                  03107500
031076     MOVE LENGTH OF WS-PUBLISH-MESSAGE TO                         03107600
031077        WFT00002-LOD-DAT-TXT-LEN.                                 03107700
031078                                                                  03107800
031079     MOVE WS-PUBLISH-MESSAGE TO                                   03107900
031080        WFT00002-LOD-DAT-TXT-TEXT.                                03108000
031081                                                                  03108100
031082     EXEC SQL                                                     03108200
031083         INSERT INTO WFT_LOD_XFER                                 03108300
031084             ( PRC_CNTL_TMST                                      03108400
031085              ,TRN_TYP_CDE                                        03108500
031086              ,BTCH_LOD_SEQ_ID                                    03108600
031087              ,LOD_DAT_TXT                                        03108700
031088             )                                                    03108800
031089         VALUES                                                   03108900
031090             (:WFT00002-PRC-CNTL-TMST                             03109000
031091             ,'ASNPCK'                                            03109100
031092             ,1                                                   03109200
031093             ,:WFT00002-LOD-DAT-TXT                               03109300
031094             )                                                    03109400
031095     END-EXEC.                                                    03109500
031096                                                                  03109600
031097     EVALUATE TRUE                                                03109700
031098       WHEN SQLCODE = ZERO                                        03109800
031099          DISPLAY WS-PUBLISH-MESSAGE                              03109900
031100       WHEN OTHER                                                 03110000
031101             SET ERROR-FOUND TO TRUE                              03110100
031102             DISPLAY '******************************************' 03110200
031103             DISPLAY 'SQLCODE => ' SQLCODE2                       03110300
031104             DISPLAY 'S600-INSERT-WFT-DAT-XFER'                   03110400
031105             DISPLAY 'SNKUP023'                                   03110500
031106             DISPLAY 'ERROR ISSUED ON INSERT   '                  03110600
031107             DISPLAY WS-PUBLISH-MESSAGE                           03110700
031108             DISPLAY '******************************************' 03110800
031109     END-EVALUATE.                                                03110900
031110                                                                  03111000
