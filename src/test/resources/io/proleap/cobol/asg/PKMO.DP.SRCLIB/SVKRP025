000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.         SVKRP025.                                    00020003
000300 AUTHOR.             COGNIZANT.                                   00030003
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040003
000500 DATE-WRITTEN.       APRIL 2013.                                  00050003
000600 DATE-COMPILED.                                                   00060003
000700                                                                  00070003
000800******************************************************************00080003
000900* THIS PROGRAM PRODUCES A REPORT TO VERIFY KMC AND GIFT CARD     *00090003
001000* ACTIVITY PERFORMED AT ECOMM CALL CENTERS.                      *00100003
001100******************************************************************00110003
P12431*  09/28/2018  MODIFIED THE PROGRAM TO DISPLAY THE NEWLY ADDED   *00111004
P12431*              ORD_NBR FIELD IN THE REPORT                       *00112004
P12431*  MADE BY: COGNIZANT                   WR#: CHG0208643          *00113005
P12431******************************************************************00114004
001200******************************************************************00120003
001300 ENVIRONMENT DIVISION.                                            00130003
001400******************************************************************00140003
001500 CONFIGURATION SECTION.                                           00150003
001600                                                                  00160003
001700 SOURCE-COMPUTER.    IBM-3090.                                    00170003
001800 OBJECT-COMPUTER.    IBM-3090.                                    00180003
001900                                                                  00190003
002000 INPUT-OUTPUT SECTION.                                            00200003
002100                                                                  00210003
002200 FILE-CONTROL.                                                    00220003
002300                                                                  00230003
002400     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00240003
002500     SELECT GIFT-CARD-REPORT-FILE     ASSIGN TO RPT01.            00250003
002600                                                                  00260003
002700******************************************************************00270003
002800 DATA DIVISION.                                                   00280003
002900******************************************************************00290003
003000                                                                  00300003
003100 FILE SECTION.                                                    00310003
003200                                                                  00320003
003300 FD  CONTROL-DATE-FILE                                            00330003
003400     RECORDING MODE IS F                                          00340003
003500     BLOCK CONTAINS 0 RECORDS                                     00350003
003600     LABEL RECORDS ARE OMITTED.                                   00360003
003700                                                                  00370003
003800 01  CONTROL-DATE-RECORD              PIC X(80).                  00380003
003900                                                                  00390003
004000 FD  GIFT-CARD-REPORT-FILE                                        00400003
004100     RECORDING MODE IS F                                          00410003
004200     BLOCK CONTAINS 0 RECORDS                                     00420003
004300     LABEL RECORDS ARE OMITTED.                                   00430003
004400                                                                  00440003
P12431 01  GIFT-CARD-REPORT-RECORD          PIC X(250).                 00450004
004600                                                                  00460003
004700 WORKING-STORAGE SECTION.                                         00470003
004800                                                                  00480003
004900 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.00490003
005000                                                                  00500003
005100******************************************************************00510003
005200*    CR-CONTROL RECORD                                           *00520003
005300******************************************************************00530003
005400 01  CR-CONTROL-RECORD.                                           00540003
005500     05  CR-CONTROL-DATE              PIC  X(10)    VALUE SPACES. 00550003
005600     05  CR-ECOMM-IND                 PIC  X        VALUE SPACES. 00560003
005700         88  CR-ECOMM                               VALUE 'E'.    00570003
005800     05  FILLER                       PIC  X(69)    VALUE SPACES. 00580003
005900                                                                  00590003
006000******************************************************************00600003
006100*    PC-PROGRAM CONSTANTS                                        *00610003
006200******************************************************************00620003
006300 01  PC-PROGRAM-CONSTANTS.                                        00630003
006400     05  PC-PROGRAM-NAME             PIC  X(08) VALUE 'SVKRP025'. 00640003
006500     05  PC-ONE                      PIC  9(01) VALUE 1 COMP.     00650003
006600     05  PC-TWO                      PIC  9(01) VALUE 2 COMP.     00660003
006700     05  PC-THREE                    PIC  9(01) VALUE 3 COMP.     00670003
006800     05  PC-HEADER-LINE-COUNT        PIC S9(03) VALUE +10         00680003
006900                                                COMP.             00690003
007000     05  PC-MAX-LINES-PER-PAGE       PIC S9(03) VALUE +75         00700003
007100                                                COMP.             00710003
007200     05  PC-MAX-LINES-COUNT          PIC S9(03) VALUE +72         00720003
007300                                                COMP.             00730003
007400                                                                  00740003
007500******************************************************************00750003
007600*    RESPROGRAM VARIABLES                                        *00760003
007700******************************************************************00770003
007800 01  PS-PROGRAM-SWITCHES.                                         00780003
007900     05  PS-END-OF-CURSOR-SW           PIC X(01)  VALUE 'N'.      00790003
008000         88  PS-NOT-END-OF-CURSOR                 VALUE 'N'.      00800003
008100         88  PS-END-OF-CURSOR                     VALUE 'Y'.      00810003
008200     05  PS-NEW-PAGE-SW                PIC X(01)  VALUE 'N'.      00820003
008300         88  PS-NOT-NEW-PAGE                      VALUE 'N'.      00830003
008400         88  PS-NEW-PAGE                          VALUE 'Y'.      00840003
008500     05  PS-END-OF-CONTROL-FILE-SW      PIC  X(01)   VALUE 'N'.   00850003
008600         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   00860003
008700                                                                  00870003
008800 01  PV-PROGRAM-VARIABLES.                                        00880003
008900     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.00890003
009000     05  PV-DB2-OPERATION             PIC  X(30)     VALUE SPACES.00900003
009100     05  PV-NOT-FIRST-RECORD          PIC  X(01)     VALUE 'N'.   00910003
009200                                                                  00920003
009300     05  PV-CURRENT-DATE.                                         00930003
009400         10  PV-CURRENT-YEAR         PIC  9(02) VALUE ZERO.       00940003
009500         10  PV-CURRENT-MONTH        PIC  9(02) VALUE ZERO.       00950003
009600         10  PV-CURRENT-DAY          PIC  9(02) VALUE ZERO.       00960003
009700     05  PV-CURRENT-TIME.                                         00970003
009800         10  PV-CURRENT-HOUR         PIC  9(02) VALUE ZERO.       00980003
009900         10  PV-CURRENT-MINUTE       PIC  9(02) VALUE ZERO.       00990003
010000         10  FILLER                  PIC  9(04) VALUE ZERO.       01000003
010100     05  PV-RPT-POSTING-DATE.                                     01010003
010200         10  PV-RPT-POST-DATE-CC     PIC  X(02) VALUE SPACES.     01020003
010300         10  PV-RPT-POST-DATE-YY     PIC  X(02) VALUE SPACES.     01030003
010400         10  FILLER                  PIC  X(01) VALUE SPACE.      01040003
010500         10  PV-RPT-POST-DATE-MM     PIC  X(02) VALUE SPACES.     01050003
010600         10  FILLER                  PIC  X(01) VALUE SPACE.      01060003
010700         10  PV-RPT-POST-DATE-DD     PIC  X(02) VALUE SPACES.     01070003
010800                                                                  01080003
010900     05  PV-HDR-POSTING-DATE.                                     01090003
011000         10  PV-HDR-POST-DATE-MM     PIC  X(02) VALUE SPACES.     01100003
011100         10  FILLER                  PIC  X(01) VALUE '/'.        01110003
011200         10  PV-HDR-POST-DATE-DD     PIC  X(02) VALUE SPACES.     01120003
011300         10  FILLER                  PIC  X(01) VALUE '/'.        01130003
011400         10  PV-HDR-POST-DATE-CC     PIC  X(02) VALUE SPACES.     01140003
011500         10  PV-HDR-POST-DATE-YY     PIC  X(02) VALUE SPACES.     01150003
011600                                                                  01160003
011700     05  PV-POS-DATE.                                             01170003
011800         10  PV-POS-DATE-CC          PIC  X(02) VALUE SPACE.      01180003
011900         10  PV-POS-DATE-YY          PIC  X(02) VALUE SPACE.      01190003
012000         10  FILLER                  PIC  X(01) VALUE SPACE.      01200003
012100         10  PV-POS-DATE-MM          PIC  X(02) VALUE SPACE.      01210003
012200         10  FILLER                  PIC  X(01) VALUE SPACE.      01220003
012300         10  PV-POS-DATE-DD          PIC  X(02) VALUE SPACE.      01230003
012400                                                                  01240003
012500     05  PV-POS-OPRT-ID              PIC  S9(11)V COMP-3.         01250003
012600     05  PV-CARD-NUMBER              PIC  S9(12)V COMP-3.         01260003
012700     05  PV-STR-NBR                  PIC  S9(4) COMP.             01270003
012800     05  PV-POS-TRMNL-NBR            PIC  S9(4) COMP.             01280003
012900     05  PV-POS-TRN-NBR              PIC  S9(4) COMP.             01290003
013000     05  PV-APP-AUTH-AMT             PIC  S9(7)V9(2) COMP-3.      01300003
013100     05  PV-DAILY-POS-DOLLARS-ISSUED PIC S9(09)V9(02)             01310003
013200                                                     VALUE ZEROES 01320003
013300                                                     COMP-3.      01330003
013400     05  PA-GIFT-CARD-RECORDS-WRITTEN PIC S9(11)                  01340003
013500                                        VALUE ZEROES  COMP-3.     01350003
013600     05  PA-GIFT-CARD-LINE-COUNT        PIC S9(11)                01360003
013700                                        VALUE ZEROES  COMP-3.     01370003
013800     05  PA-GIFT-CARD-RECORDS-FETCHED PIC S9(11)                  01380003
013900                                        VALUE ZEROES  COMP-3.     01390003
014000     05  PA-PAGE-COUNTER                PIC S9(11)  VALUE ZEROES  01400003
014100                                                     COMP-3.      01410003
P12431     05  PV-ORD-NBR-NULL-IND            PIC S9(4) COMP            01411004
P12431                                                VALUE ZEROES.     01412004
014200                                                                  01420003
014300*----------------------------------------------------------------*01430003
014400*    STANDARD DB2 ERROR HANDLING AREA                            *01440003
014500*----------------------------------------------------------------*01450003
014600     COPY DPWS004.                                                01460003
014700******************************************************************01470003
014800*    STANDARD HEADER FOR 200 COLUMN REPORT                       *01480003
014900******************************************************************01490003
P12431     COPY DPWS250O.                                               01500004
015100                                                                  01510003
015200 01  REPORT-TITLE-LINE.                                           01520003
015300     05  FILLER                         PIC  X(80)   VALUE SPACES.01530003
015400     05  FILLER                         PIC  X(26)   VALUE        01540003
015500     '  GIFT CARD/KMC AUDIT FOR '.                                01550003
015600     05  RC-GIFT-CARD-DATE              PIC  X(10).               01560003
P12431     05  FILLER                         PIC  X(134)  VALUE SPACES.01570004
015800 01  REPORT-AUDIT-HEADING-LINE.                                   01580003
015900     05  FILLER                         PIC  X(12)   VALUE SPACES.01590003
016000     05  FILLER                         PIC  X(11)   VALUE        01600003
016100         'APVL_USR_ID'.                                           01610003
016200     05  FILLER                         PIC  X(04)   VALUE SPACES.01620003
016300     05  FILLER                         PIC  X(11)   VALUE        01630003
016400         'POS_OPRT_ID'.                                           01640003
016500     05  FILLER                         PIC  X(06)   VALUE SPACES.01650003
016600     05  FILLER                         PIC  X(07)   VALUE        01660003
016700         'CRD_NBR'.                                               01670003
016800     05  FILLER                         PIC  X(11)   VALUE SPACES.01680003
016900     05  FILLER                         PIC  X(13)   VALUE        01690003
017000         'TRN_AUTH_TMST'.                                         01700003
017100     05  FILLER                         PIC  X(17)   VALUE SPACES.01710003
017200     05  FILLER                         PIC  X(12)   VALUE        01720003
017300         'TRN_VOID_IND'.                                          01730003
017400     05  FILLER                         PIC  X(04)   VALUE SPACES.01740003
017500     05  FILLER                         PIC  X(04)   VALUE        01750003
017600         'TYPE'.                                                  01760003
017700     05  FILLER                         PIC  X(06)   VALUE SPACES.01770003
017800     05  FILLER                         PIC  X(07)   VALUE        01780003
017900         'STR_NBR'.                                               01790003
018000     05  FILLER                         PIC  X(06)   VALUE SPACES.01800003
018100     05  FILLER                         PIC  X(13)   VALUE        01810003
018200         'POS_TRMNL_NBR'.                                         01820003
018300     05  FILLER                         PIC  X(04)   VALUE SPACES.01830003
018400     05  FILLER                         PIC  X(11)   VALUE        01840003
018500         'POS_TRN_NBR'.                                           01850003
018600     05  FILLER                         PIC  X(06)   VALUE SPACES.01860003
018700     05  FILLER                         PIC  X(12)   VALUE        01870003
018800         'APP_AUTH_AMT'.                                          01880003
P12431     05  FILLER                         PIC  X(05)  VALUE SPACES. 01890004
P12431     05  FILLER                         PIC  X(07)   VALUE        01891004
P12431         'ORD_NBR'.                                               01892004
P12431     05  FILLER                         PIC  X(61)  VALUE SPACES. 01893004
019000 01  REPORT-AUDIT-DETAIL-LINE.                                    01900003
019100     05  FILLER                         PIC  X(12)   VALUE SPACES.01910003
019200     05  RPT-ON-LINE-APVL-USR-ID        PIC  X(10)   VALUE SPACES.01920003
019300     05  FILLER                         PIC  X(06)   VALUE SPACES.01930003
019400     05  RPT-ON-LINE-POS-OPRT-ID        PIC  ZZZZZZZZZZ9.-.       01940003
019500     05  FILLER                         PIC  X(4)    VALUE SPACES.01950003
019600     05  RPT-ON-LINE-CARD-NUMBER        PIC  ZZZZZZZZZZZ9.-.      01960003
019700     05  FILLER                         PIC  X(3)   VALUE SPACES. 01970003
019800     05  RPT-ON-LINE-TRN-AUTH-TMST      PIC  X(26).               01980003
019900     05  FILLER                         PIC  X(4)   VALUE SPACES. 01990003
020000     05  RPT-ON-LINE-TRN-VOID-IND       PIC  X(1).                02000003
020100     05  FILLER                         PIC  X(15)   VALUE SPACES.02010003
020200     05  RPT-ON-LINE-TYPE               PIC  X(6).                02020003
020300     05  FILLER                         PIC  X(7)   VALUE SPACES. 02030003
020400     05  RPT-ON-LINE-STORE-NBR          PIC  ZZZ9.                02040003
020500     05  FILLER                         PIC  X(15)   VALUE SPACES.02050003
020600     05  RPT-ON-LINE-POS-TRMNL-NBR      PIC  ZZZ9.                02060003
020700     05  FILLER                         PIC  X(11)   VALUE SPACES.02070003
020800     05  RPT-ON-LINE-POS-TRN-NBR        PIC  ZZZ9.                02080003
020900     05  FILLER                         PIC  X(8)   VALUE SPACES. 02090003
021000     05  RPT-ON-LINE-APP-AUTH-AMT       PIC  ZZZZZZ9.99-.         02100003
P12431     05  FILLER                         PIC  X(4)    VALUE SPACES.02110004
P12431     05  RPT-ON-LINE-ORD-NBR            PIC  X(40)   VALUE SPACES.02111004
P12431     05  FILLER                         PIC  X(28)   VALUE SPACES.02112004
021200 01  REPORT-AUDIT-NO-ERROR-LINE.                                  02120004
021300     05  FILLER                         PIC  X(75)   VALUE SPACES.02130003
021400     05  FILLER                         PIC  X(42)   VALUE        02140003
021500         '***  NO DATA POSTED ON '.                               02150003
021600     05  RC-EMPTY-GIFT-CARD-DATE        PIC  X(10).               02160003
021700     05  FILLER                         PIC  X(04)   VALUE        02170003
021800         ' ***'.                                                  02180003
P12431     05  FILLER                         PIC  X(119)  VALUE SPACES.02190004
022000 01  REPORT-AUDIT-POS-ISSUED-LINE.                                02200003
022100     05  FILLER                         PIC  X(70)   VALUE SPACES.02210003
022200     05  FILLER                         PIC  X(30)   VALUE        02220003
022300     ' NUMBER OF RECORDS PROCESSED :'.                            02230003
022400     05  RPT-ON-LINE-NUM-OF-RECORDS     PIC  ZZZZZZZZ9.           02240003
P12431     05  FILLER                         PIC  X(141)  VALUE SPACES.02250004
022600                                                                  02260003
022700 01  REPORT-ENDING-LINE.                                          02270003
022800     05  FILLER                         PIC  X(80)   VALUE SPACES.02280003
022900     05  FILLER                         PIC  X(21)   VALUE        02290003
023000         '*** END OF REPORT ***'.                                 02300003
P12431     05  FILLER                         PIC  X(149)  VALUE SPACES.02310004
023200                                                                  02320003
023300*----------------------------------------------------------------*02330003
023400*    LOCATION DOMAIN TABLE                                       *02340003
023500*----------------------------------------------------------------*02350003
023600     EXEC SQL                                                     02360003
023700         INCLUDE SVT00002                                         02370003
023800     END-EXEC.                                                    02380003
023900*----------------------------------------------------------------*02390003
024000*    STANDARD DB2 COMMUNICATIONS AREA                            *02400003
024100*----------------------------------------------------------------*02410003
024200      EXEC SQL                                                    02420003
024300         INCLUDE SQLCA                                            02430003
024400      END-EXEC.                                                   02440003
024500*----------------------------------------------------------------*02450003
024600*----------------------------------------------------------------*02460003
024700*    CURSOR TO OBTAIN ORIGINAL STORE AND TRANS INFO              *02470003
024800*----------------------------------------------------------------*02480003
024900      EXEC SQL                                                    02490003
025000           DECLARE EXTRACT-CURSOR  CURSOR                         02500003
025100           FOR SELECT APVL_USR_ID                                 02510003
025200                    , POS_OPRT_ID                                 02520003
P12431                    , ORD_NBR                                     02521004
025300                    , CRD_NBR                                     02530003
025400                    , TRN_AUTH_TMST                               02540003
025500                    , TRN_VOID_IND                                02550003
025600                    , CASE ACTVY_TYP_CDE                          02560003
025700                        WHEN 1 THEN 'KMC'                         02570003
025800                        WHEN 2 THEN 'GC'                          02580003
025900                        WHEN 3 THEN 'TENDER'                      02590003
026000                        ELSE 'OTHER'                              02600003
026100                      END AS TYPE                                 02610003
026200                    , STR_NBR                                     02620003
026300                    , POS_TRMNL_NBR                               02630003
026400                    , POS_TRN_NBR                                 02640003
026500                    , APP_AUTH_AMT                                02650003
026600           FROM SVT_KOHLS_CRD_TXN                                 02660003
                   WHERE ((STR_NBR IN (873,809,819,829)                 02670003
                   AND POS_TRMNL_NBR BETWEEN 1 AND 15)OR(STR_NBR = 880  02680003
                   AND POS_TRMNL_NBR BETWEEN 1 AND 4))                  02690003
026900             AND POS_DTE = :CR-CONTROL-DATE                       02700003
027000           ORDER BY APVL_USR_ID                                   02710003
027100                  , POS_OPRT_ID                                   02720003
027200                  , ACTVY_TYP_CDE                                 02730003
027300                  , TRN_AUTH_TMST                                 02740003
027400           WITH UR                                                02750003
027500      END-EXEC.                                                   02760003
027600                                                                  02770003
027700******************************************************************02780003
027800*      PROCEDURE DIVISION                                        *02790003
027900******************************************************************02800003
028000 PROCEDURE DIVISION.                                              02810003
028100                                                                  02820003
028200 A100-MAINLINE.                                                   02830003
028300                                                                  02840003
028400     PERFORM B100-INITIALIZE.                                     02850003
028500                                                                  02860003
028600     IF  PS-END-OF-CURSOR                                         02870003
028700         PERFORM  W400-WRITE-EMPTY-REPORT                         02880003
028800     ELSE                                                         02890003
028900         PERFORM  B200-PROCESS                                    02900003
029000     END-IF.                                                      02910003
029100                                                                  02920003
029200     PERFORM B300-EOJ-ROUTINE.                                    02930003
029300                                                                  02940003
029400     GOBACK.                                                      02950003
029500******************************************************************02960003
029600*     B100-INITIALIZE                                            *02970003
029700* ==> PERFORMED FROM:  A100-MAINLINE                             *02980003
029800******************************************************************02990003
029900 B100-INITIALIZE.                                                 03000003
030000                                                                  03010003
030100     OPEN INPUT CONTROL-DATE-FILE                                 03020003
030200          OUTPUT GIFT-CARD-REPORT-FILE.                           03030003
030300                                                                  03040003
030400     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                03050003
030500         AT END                                                   03060003
030600             SET PS-END-OF-CONTROL-FILE TO TRUE.                  03070003
030700                                                                  03080003
030800     IF PS-END-OF-CONTROL-FILE                                    03090003
030900         DISPLAY ' '                                              03100003
031000         DISPLAY '** ABEND     **'                                03110003
031100         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            03120003
031200         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '       03130003
031300         DISPLAY '** CONTROL DATE FILE IS EMPTY  '                03140003
031400         DISPLAY ' '                                              03150003
031500         MOVE +4002 TO ABEND-CODE                                 03160003
031600         CALL 'ILBOABN0' USING ABEND-CODE                         03170004
031700     ELSE                                                         03180003
031800         DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '               03190003
031900                 CR-CONTROL-DATE                                  03200003
032000     END-IF.                                                      03210003
032100                                                                  03220003
032200     ACCEPT PV-CURRENT-DATE      FROM DATE.                       03230003
P12431     MOVE PV-CURRENT-YEAR          TO DP250O-RUN-YEAR.            03240006
P12431     MOVE PV-CURRENT-MONTH         TO DP250O-RUN-MONTH.           03250006
P12431     MOVE PV-CURRENT-DAY           TO DP250O-RUN-DAY.             03260006
032600                                                                  03270003
032700     ACCEPT PV-CURRENT-TIME        FROM TIME.                     03280003
P12431     MOVE PV-CURRENT-HOUR          TO DP250O-RUN-HOUR.            03290006
P12431     MOVE PV-CURRENT-MINUTE        TO DP250O-RUN-MINUTE.          03300006
033000                                                                  03310003
P12431     MOVE PC-PROGRAM-NAME          TO DP250O-PROGRAM-NAME.        03320006
033200                                                                  03330003
033300     MOVE CR-CONTROL-DATE          TO PV-RPT-POSTING-DATE.        03340003
033400     MOVE PV-RPT-POST-DATE-MM      TO PV-HDR-POST-DATE-MM.        03350003
033500     MOVE PV-RPT-POST-DATE-DD      TO PV-HDR-POST-DATE-DD.        03360003
033600     MOVE PV-RPT-POST-DATE-CC      TO PV-HDR-POST-DATE-CC.        03370003
033700     MOVE PV-RPT-POST-DATE-YY      TO PV-HDR-POST-DATE-YY.        03380003
033800     MOVE PV-HDR-POSTING-DATE      TO RC-GIFT-CARD-DATE           03390003
033900                                      RC-EMPTY-GIFT-CARD-DATE.    03400003
034000                                                                  03410003
034100     PERFORM W100-WRITE-PAGE-HEADING.                             03420003
034200     PERFORM C100-OPEN-CURSOR.                                    03430003
034300     PERFORM C200-FETCH-CURSOR.                                   03440003
034400                                                                  03450003
034500******************************************************************03460003
034600*     B200-PROCESS                                               *03470003
034700* ==> PROCESSES:                                                 *03480003
034800*     - WRITES THE REPORT WITH DETAIL RECORD                     *03490003
034900* ==> PERFORMED FROM:  A100-MAINLINE                             *03500003
035000******************************************************************03510003
035100 B200-PROCESS.                                                    03520003
035200                                                                  03530003
035300     MOVE 'Y'            TO  PV-NOT-FIRST-RECORD.                 03540003
035400     PERFORM  C200-FETCH-CURSOR                                   03550003
035500            UNTIL PS-END-OF-CURSOR.                               03560003
035600                                                                  03570003
035700     MOVE PA-GIFT-CARD-RECORDS-WRITTEN  TO                        03580003
035800                            RPT-ON-LINE-NUM-OF-RECORDS.           03590003
035900                                                                  03600003
036000     IF  PA-GIFT-CARD-LINE-COUNT  >=                              03610003
036100                      PC-MAX-LINES-PER-PAGE                       03620003
036200          INITIALIZE  PA-GIFT-CARD-LINE-COUNT                     03630003
036300          PERFORM  W100-WRITE-PAGE-HEADING                        03640003
036400     END-IF.                                                      03650003
036500                                                                  03660003
036600     WRITE GIFT-CARD-REPORT-RECORD                                03670003
036700         FROM REPORT-AUDIT-POS-ISSUED-LINE                        03680003
036800          AFTER ADVANCING 2 LINES.                                03690003
036900     ADD PC-TWO             TO  PA-GIFT-CARD-LINE-COUNT.          03700003
037000                                                                  03710003
037100                                                                  03720003
037200******************************************************************03730003
037300*     B300-EOJ-ROUTINE                                           *03740003
037400* ==> PROCESSES:                                                 *03750003
037500*     - WRITES AN END OF REPORT LINE TO THE REPORTS              *03760003
037600*     - CLOSES THE FILES AND CURSOR                              *03770003
037700* ==> PERFORMED FROM:  A100-MAINLINE                             *03780003
037800******************************************************************03790003
037900 B300-EOJ-ROUTINE.                                                03800003
038000                                                                  03810003
038100     IF  PA-GIFT-CARD-LINE-COUNT  >                               03820003
038200                      PC-MAX-LINES-COUNT                          03830003
038300          PERFORM  W100-WRITE-PAGE-HEADING                        03840003
038400     END-IF.                                                      03850003
038500                                                                  03860003
038600     WRITE GIFT-CARD-REPORT-RECORD                                03870003
038700         FROM REPORT-ENDING-LINE                                  03880003
038800         AFTER ADVANCING 2 LINES.                                 03890003
038900                                                                  03900003
039000     PERFORM  C300-CLOSE-CURSOR                                   03910003
039100                                                                  03920003
039200     CLOSE CONTROL-DATE-FILE                                      03930003
039300           GIFT-CARD-REPORT-FILE.                                 03940003
039400                                                                  03950003
039500     DISPLAY ' '.                                                 03960003
039600     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME              03970003
039700             ' REPORT ' PC-PROGRAM-NAME '-' PC-ONE                03980003
039800     DISPLAY ' '.                                                 03990003
039900     DISPLAY 'NUMBER OF GIFT-CARD RECORDS READ:       '           04000003
040000                  PA-GIFT-CARD-RECORDS-FETCHED.                   04010003
040100     DISPLAY 'NUMBER OF GIFT-CARD RECORDS WRITTEN:    '           04020003
040200                  PA-GIFT-CARD-RECORDS-WRITTEN.                   04030003
040300                                                                  04040003
040400******************************************************************04050003
040500* C100-OPEN-CURSOR.                                              *04060003
040600* ==> PERFORMED FORM:  B200-WRITE-REPORT                         *04070003
040700******************************************************************04080003
040800 C100-OPEN-CURSOR.                                                04090003
040900                                                                  04100003
041000     EXEC SQL                                                     04110003
041100          OPEN EXTRACT-CURSOR                                     04120003
041200     END-EXEC.                                                    04130003
041300                                                                  04140003
041400     EVALUATE TRUE                                                04150003
041500         WHEN SQLCODE = ZERO                                      04160003
041600              CONTINUE                                            04170003
041700         WHEN SQLWARN0 NOT EQUAL SPACE                            04180003
041800         WHEN SQLCODE NOT EQUAL ZERO                              04190003
041900             MOVE 'C100-OPEN-EXTRACT-CURSOR'                      04200003
042000                                            TO PV-PARAGRAPH-NAME  04210003
042100             MOVE 'ERROR ON OPEN OF EXTRACT-CURSOR'               04220003
042200                                            TO PV-DB2-OPERATION   04230003
042300             DISPLAY 'SQLCODE :' SQLCODE                          04240003
042400             PERFORM 9100-SQL-ABEND                               04250003
042500     END-EVALUATE.                                                04260003
042600                                                                  04270003
042700******************************************************************04280003
042800* C200-FETCH-CURSOR                                              *04290003
042900* ==> PERFORMED FORM:  A100-MAINLINE , B200-PROCESS-PARA         *04300003
043000******************************************************************04310003
043100 C200-FETCH-CURSOR.                                               04320003
043200                                                                  04330003
P12431     MOVE 0 TO PV-ORD-NBR-NULL-IND.                               04331004
P12431     MOVE SPACES TO SVT00002-ORD-NBR-TEXT.                        04332004
P12431                                                                  04333004
043300     EXEC SQL                                                     04340003
043400          FETCH EXTRACT-CURSOR                                    04350003
043500           INTO :RPT-ON-LINE-APVL-USR-ID                          04360003
043600               ,:PV-POS-OPRT-ID                                   04370003
P12431               ,:SVT00002-ORD-NBR :PV-ORD-NBR-NULL-IND            04371004
043700               ,:PV-CARD-NUMBER                                   04380003
043800               ,:RPT-ON-LINE-TRN-AUTH-TMST                        04390003
043900               ,:RPT-ON-LINE-TRN-VOID-IND                         04400003
044000               ,:RPT-ON-LINE-TYPE                                 04410003
044100               ,:PV-STR-NBR                                       04420003
044200               ,:PV-POS-TRMNL-NBR                                 04430003
044300               ,:PV-POS-TRN-NBR                                   04440003
044400               ,:PV-APP-AUTH-AMT                                  04450003
044500     END-EXEC.                                                    04460003
044600                                                                  04470003
044700     EVALUATE TRUE                                                04480003
044800         WHEN SQLCODE = ZERO                                      04490003
044900           ADD  PC-ONE     TO PA-GIFT-CARD-RECORDS-FETCHED        04500003
045000           PERFORM  W300-WRITE-DETAIL-REPORT                      04510003
045100                                                                  04520003
045200         WHEN SQLCODE = +100                                      04530003
045300             SET PS-END-OF-CURSOR           TO TRUE               04540003
045400                                                                  04550003
045500         WHEN OTHER                                               04560003
045600             MOVE 'C200-FETCH-CURSOR'                             04570003
045700                                            TO PV-PARAGRAPH-NAME  04580003
045800             MOVE 'ERROR ON FETCH OF EXTRACT-CURSOR'              04590003
045900                                            TO PV-DB2-OPERATION   04600003
046000             PERFORM 9100-SQL-ABEND                               04610003
046100     END-EVALUATE.                                                04620003
046200************************************************************      04630003
046300* C300-CLOSE-EXTRACT-CURSOR                                *      04640003
046400* ==> PERFORMED FORM:  B300-EOJ-ROUTINE                    *      04650003
046500************************************************************      04660003
046600 C300-CLOSE-CURSOR.                                               04670003
046700                                                                  04680003
046800     EXEC SQL                                                     04690003
046900          CLOSE EXTRACT-CURSOR                                    04700003
047000     END-EXEC.                                                    04710003
047100                                                                  04720003
047200     EVALUATE TRUE                                                04730003
047300         WHEN SQLCODE = ZERO                                      04740003
047400              CONTINUE                                            04750003
047500         WHEN SQLWARN0 NOT EQUAL SPACE                            04760003
047600         WHEN SQLCODE NOT EQUAL ZERO                              04770003
047700             MOVE '3300-CLOSE-EXTRACT-CURSOR'                     04780003
047800                                       TO PV-PARAGRAPH-NAME       04790003
047900             MOVE 'ERROR ON CLOSE OF EXTRACT-CURSOR'              04800003
048000                                       TO PV-DB2-OPERATION        04810003
048100             PERFORM 9100-SQL-ABEND                               04820003
048200     END-EVALUATE.                                                04830003
048300******************************************************************04840003
048400*     W100-WRITE-PAGE-HEADING.                                   *04850003
048500* ==> PROCESSES:                                                 *04860003
048600*     - ADVANCES TO A NEW PAGE AND WRITES THE REPORT HEADINGS    *04870003
048700* ==> PERFORMED FROM: B100-INITIALIZE, B200-PROCESS,             *04880003
048800*                 B300-EOJ-ROUTINE, C200-FETCH-CURSOR             04890003
048900******************************************************************04900003
049000 W100-WRITE-PAGE-HEADING.                                         04910003
049100                                                                  04920003
049200     ADD PC-ONE                    TO PA-PAGE-COUNTER.            04930003
P12431     MOVE PA-PAGE-COUNTER          TO DP250O-PAGE-NUMBER.         04940006
P12431     MOVE PC-ONE                   TO DP250O-REPORT-NUMBER.       04950006
049500                                                                  04960003
049600     WRITE GIFT-CARD-REPORT-RECORD                                04970003
P12431         FROM DP250O-STANDRD-HEADER-250-COLS                      04980006
049800         AFTER ADVANCING PAGE.                                    04990003
049900     WRITE GIFT-CARD-REPORT-RECORD                                05000003
050000         FROM REPORT-TITLE-LINE                                   05010003
050100         AFTER ADVANCING 2 LINE.                                  05020003
050200                                                                  05030003
050300     ADD  PC-TWO     TO   PA-GIFT-CARD-LINE-COUNT.                05040003
050400                                                                  05050003
050500******************************************************************05060003
050600*     W200-WRITE-SECOND-HEADING.                                 *05070003
050700* ==> PERFORMED FROM: C200-FETCH-CURSOR                          *05080003
050800******************************************************************05090003
050900 W200-WRITE-SECOND-HEADING.                                       05100003
051000                                                                  05110003
051100     WRITE GIFT-CARD-REPORT-RECORD                                05120003
051200         FROM REPORT-AUDIT-HEADING-LINE                           05130003
051300         AFTER ADVANCING 2 LINE.                                  05140003
051400                                                                  05150003
051500     ADD  PC-ONE     TO   PA-GIFT-CARD-LINE-COUNT.                05160003
051600                                                                  05170003
051700******************************************************************05180003
051800*   W300-WRITE-DETAIL-REPORT                                      05190003
051900* ==> PERFORMED FORM:  C200-FETCH-CURSOR                         *05200003
052000******************************************************************05210003
052100 W300-WRITE-DETAIL-REPORT.                                        05220003
052200                                                                  05230003
052300        MOVE PV-POS-OPRT-ID   TO RPT-ON-LINE-POS-OPRT-ID          05240003
052400        MOVE PV-CARD-NUMBER   TO RPT-ON-LINE-CARD-NUMBER          05250003
052500        MOVE PV-STR-NBR       TO RPT-ON-LINE-STORE-NBR            05260003
052600        MOVE PV-POS-TRMNL-NBR TO RPT-ON-LINE-POS-TRMNL-NBR        05270003
052700        MOVE PV-POS-TRN-NBR   TO RPT-ON-LINE-POS-TRN-NBR          05280003
052800        MOVE PV-APP-AUTH-AMT  TO RPT-ON-LINE-APP-AUTH-AMT         05290003
P12431        IF PV-ORD-NBR-NULL-IND < +0                               05292004
P12431           MOVE SPACES                TO RPT-ON-LINE-ORD-NBR      05293004
P12431        ELSE                                                      05294004
P12431           MOVE SVT00002-ORD-NBR-TEXT TO RPT-ON-LINE-ORD-NBR      05295004
P12431        END-IF                                                    05296004
052900        IF  PA-GIFT-CARD-LINE-COUNT  >=                           05300003
053000                        PC-MAX-LINES-PER-PAGE                     05310003
053100             INITIALIZE  PA-GIFT-CARD-LINE-COUNT                  05320003
053200             PERFORM  W100-WRITE-PAGE-HEADING                     05330003
053300             PERFORM  W200-WRITE-SECOND-HEADING                   05340003
053400        END-IF                                                    05350003
053500        IF  PV-NOT-FIRST-RECORD = 'N'                             05360003
053600             PERFORM  W200-WRITE-SECOND-HEADING                   05370003
053700        END-IF                                                    05380003
053800        WRITE GIFT-CARD-REPORT-RECORD                             05390003
053900           FROM REPORT-AUDIT-DETAIL-LINE                          05400003
054000           AFTER ADVANCING 1 LINE.                                05410003
054100                                                                  05420003
054200       ADD PC-ONE TO PA-GIFT-CARD-RECORDS-WRITTEN.                05430003
054300       ADD PC-ONE TO PA-GIFT-CARD-LINE-COUNT.                     05440003
054400                                                                  05450003
054500******************************************************************05460003
054600*   W400-WRITE-EMPTY-REPORT                                       05470003
054700* ==> PERFORMED FROM:  A100-MAINLINE                             *05480003
054800******************************************************************05490003
054900 W400-WRITE-EMPTY-REPORT.                                         05500003
055000                                                                  05510003
055100     WRITE GIFT-CARD-REPORT-RECORD                                05520003
055200         FROM REPORT-AUDIT-NO-ERROR-LINE                          05530003
055300         AFTER ADVANCING 2 LINE.                                  05540003
055400                                                                  05550003
055500******************************************************************05560003
055600*     9100-SQL-ABEND                                             *05570003
055700* ==> PROCESSES:                                                 *05580003
055800*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *05590003
055900******************************************************************05600003
056000 9100-SQL-ABEND.                                                  05610003
056100                                                                  05620003
056200     DISPLAY '9100-SQL-ABEND'.                                    05630003
056300     DISPLAY '**  ABEND     **'.                                  05640003
056400     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               05650003
056500     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             05660003
056600     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION.              05670003
056700                                                                  05680003
