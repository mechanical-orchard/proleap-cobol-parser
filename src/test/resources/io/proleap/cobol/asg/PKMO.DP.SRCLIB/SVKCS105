000200*-----------------------*                                         00020001
000300 IDENTIFICATION DIVISION.                                         00030001
000400*-----------------------*                                         00040001
000500 PROGRAM-ID.    SVKCS105.                                         00050001
000600 AUTHOR.        JIM LEIKNESS.                                     00060001
000700 INSTALLATION. KOHLS DEPARTMENT STORES.                           00070001
000800 DATE-WRITTEN.  04-12-04.                                         00080001
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100*---------------------------------------------------------------* 00110001
001200*    U105 - CARD STOCK LIST PROGRAM.                            * 00120005
001300*                                                               * 00130001
001400*    THIS PROGRAM GENERATES A LIST SCREEN OF STORED VALUE       * 00140001
001500*    CARD STOCK ID'S.                                           * 00150001
002000*                                                               * 00200001
002100*---------------------------------------------------------------* 00210001
002200* CHANGE LOG:                                                   * 00220094
002201*                                                                 00220194
002202* 09/01/2021 GERMAN BANDA                    WR/IR #: CHG0261091  00220296
002203*            - CHANGE CALL OF DPKUT100 TO                       * 00220394
002204*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00220494
002205*              MAKING THE CALL DYNAMIC VS STATIC                * 00220594
002206*                                                               * 00220694
CICS  * 11/28/2022 RONNA MCDONALD                  WR/IR #: CHG0278721* 00220799
CICS  *                                                               * 00220997
CICS  *  ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL     * 00221097
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00221197
CICS  *---------------------------------------------------------------* 00221297
002208 ENVIRONMENT DIVISION.                                            00221402
002209                                                                  00221502
002210 DATA DIVISION.                                                   00221602
002211                                                                  00221702
002212 WORKING-STORAGE SECTION.                                         00221802
002213                                                                  00221902
002214 01  PC-PROGRAM-CONSTANTS.                                        00222002
002215     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00222102
002216                                                    'SV105A  '.   00222204
002217     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00222302
002218                                                    'SVKM105 '.   00222404
002219     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00222502
002220                                                    'SVKCS105'.   00222604
002221     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00222702
002222     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00222802
002223     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00222905
002224                                                    COMP SYNC.    00223002
002225     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00223102
002226                                                    COMP SYNC.    00223202
002227     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00223302
002228                                                    +9999         00223405
002229                                                    COMP-3.       00223502
002230     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00223602
002231                                                    COMP SYNC.    00223702
002232     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00223802
002233                                                    COMP-3.       00223902
002234*                                                                 00224002
002235     05  PC-TSYMSG-NUMBERS.                                       00224102
002236         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00224202
002237         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00224302
002238         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00224402
002239         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00224502
002240         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00224602
002241         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00224702
002242         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00224802
002243         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00224902
002244         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00225002
002245         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00225102
002246         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00225202
002247         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00225302
002248         10  PC-TSYMSG-00112            PIC  9(05)  VALUE 00112.  00225493
002249         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00225593
002250*                                                                 00225602
002251 01  PS-PROGRAM-SWITCHES.                                         00225702
002252     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00225802
002253         88  PS-NO-ERROR                            VALUE 'Y'.    00225902
002254         88  PS-ERROR                               VALUE 'N'.    00226002
002262*                                                                 00226202
002263 01  PV-PROGRAM-VARIABLES.                                        00226302
002264     05  PV-SUB                         PIC S9(04)  VALUE +0      00226402
002265                                                    COMP SYNC.    00226502
002268     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00226802
002269                                                    COMP SYNC.    00226902
002270     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00227002
002271                                                    COMP-3.       00227102
002272     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      00227202
002273                                                    COMP-3.       00227302
002274     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      00227402
002275                                                    COMP-3.       00227502
002276     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00227602
002277                                                    COMP-3.       00227702
002278     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00227802
002279                                                    COMP-3.       00227902
002280     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00228002
002281                                                    COMP-3.       00228102
002282     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00228202
002283                                                    COMP SYNC.    00228302
002284     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      00228402
002285                                                    COMP SYNC.    00228502
002286     05  PV-ITEM                        PIC S9(04)  VALUE +0      00228602
002287                                                    COMP SYNC.    00228702
002288     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      00228802
002289                                                    COMP SYNC.    00228902
002290     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      00229002
002291                                                    COMP SYNC.    00229102
002292     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      00229202
002293                                                    COMP SYNC.    00229302
002294     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      00229402
002295                                                    COMP SYNC.    00229502
002296     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      00229602
002297                                                    COMP SYNC.    00229702
002298     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      00229802
002299                                                    COMP SYNC.    00229902
002300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      00230002
002301                                                    COMP SYNC.    00230102
002302     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      00230202
002303                                                    COMP SYNC.    00230302
002304     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      00230402
002305                                                    COMP SYNC.    00230502
002306     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      00230602
002307                                                    COMP SYNC.    00230702
002308     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      00230802
002309                                                    COMP SYNC.    00230902
002310     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      00231002
002311                                                    COMP SYNC.    00231102
002312 01  IV-INDICATOR-VARIABLES.                                      00231220
002313     05  IV-CMNT-TXT                    PIC S9(04) COMP           00231322
002314                                                    VALUE +0.     00231422
002319******************************************************************00231902
002320**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **00232002
002321**  THIS MUST BE THE EXACT SAME FORMAT AS A BLOCK IN THE        **00232102
002322**  APPLICATION-SPECIFIC COMMAREA.                              **00232202
002323******************************************************************00232302
002324 01  LQW-LIST-QUEUE-WORK-AREA.                                    00232402
002325     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  00232502
002326     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           00232606
002327                                        INDEXED BY LQW-IDX.       00232702
002328         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       00232802
002329         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               00232902
002330         10  LQW-SELECTED-SW            PIC  X(01).               00233002
002331             88  LQW-SELECT                         VALUE 'S'.    00233102
002332             88  LQW-DESELECT                       VALUE ' '.    00233202
002333         10  LQW-TYPE                   PIC  9(1).                00233378
002334         10  LQW-TYPE-DESC              PIC  X(4).                00233479
002335         10  LQW-STOCK                  PIC  X(08).               00233579
002336         10  LQW-DENOMINATION           PIC  X(08).               00233679
002337         10  LQW-DENOMINATION-9         PIC  9(05)V99.            00233779
002341         10  LQW-COMMENT                PIC  X(30).               00234151
002342         10  LQW-REPLENISH              PIC  X(01).               00234275
002345                                                                  00234502
002347*---------------------------------------------------------------* 00234702
002348*    RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  00234813
002349*---------------------------------------------------------------* 00234902
002351     COPY SVWS009.                                                00235113
002352                                                                  00235213
002354*---------------------------------------------------------------* 00235480
002355*                                                                 00235580
002356*---------------------------------------------------------------* 00235680
002357     COPY SVWS004.                                                00235780
002358                                                                  00235880
002360*---------------------------------------------------------------* 00236080
002361*    MAP LAYOUT                                                 * 00236180
002362*---------------------------------------------------------------* 00236280
002363                                                                  00236380
002364     COPY SVKM105.                                                00236480
002365*                                                                 00236580
002366 01  MR-OCCURS-LAYOUT                   REDEFINES  SV105AO.       00236680
002367     05  FILLER                         PIC X(42).                00236780
002368     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          00236880
002369         10  MR-SELECTL                 PIC S9(04) COMP.          00236980
002370         10  MR-SELECTA                 PIC  X(01).               00237080
002371         10  MR-SELECTC                 PIC  X(01).               00237180
002372         10  MR-SELECTH                 PIC  X(01).               00237280
002373         10  MR-SELECTI                 PIC  X(01).               00237380
002374                                                                  00237480
002375         10  MR-TYPEL                   PIC S9(04) COMP.          00237580
002376         10  MR-TYPEA                   PIC  X(01).               00237680
002377         10  MR-TYPEC                   PIC  X(01).               00237780
002378         10  MR-TYPEH                   PIC  X(01).               00237880
002379         10  MR-TYPE                    PIC  X(04).               00237980
002380                                                                  00238080
002383         10  MR-STOCKL                  PIC S9(04) COMP.          00238379
002384         10  MR-STOCKA                  PIC  X(01).               00238479
002385         10  MR-STOCKC                  PIC  X(01).               00238579
002386         10  MR-STOCKH                  PIC  X(01).               00238679
002387         10  MR-STOCK                   PIC  X(08).               00238779
002388                                                                  00238879
002389         10  MR-DENOML                  PIC S9(04) COMP.          00238979
002390         10  MR-DENOMA                  PIC  X(01).               00239079
002391         10  MR-DENOMC                  PIC  X(01).               00239179
002392         10  MR-DENOMH                  PIC  X(01).               00239279
002395         10  MR-DENOM               PIC  Z(04)9.99.               00239579
002396         10  MR-DENOM-X REDEFINES MR-DENOM PIC X(08).             00239679
002397                                                                  00239779
002398         10  MR-CMMNTL                  PIC S9(04) COMP.          00239879
002399         10  MR-CMMNTA                  PIC  X(01).               00239979
002400         10  MR-CMMNTC                  PIC  X(01).               00240079
002401         10  MR-CMMNTH                  PIC  X(01).               00240179
002402         10  MR-CMMNT                   PIC  X(30).               00240279
002410                                                                  00241079
002411         10  MR-REPLL                   PIC S9(04) COMP.          00241157
002412         10  MR-REPLA                   PIC  X(01).               00241257
002413         10  MR-REPLC                   PIC  X(01).               00241357
002414         10  MR-REPLH                   PIC  X(01).               00241457
002415         10  MR-REPL                    PIC  X(01).               00241557
002416                                                                  00241657
002418*---------------------------------------------------------------* 00241857
002419*    ATTRIBUTE SETTINGS COPYBOOK.                               * 00241957
002420*---------------------------------------------------------------* 00242057
002421                                                                  00242157
002422     COPY DPWS015.                                                00242257
002423                                                                  00242357
002424*---------------------------------------------------------------* 00242457
002425*    FUNCTION KEYS COPYBOOK.                                    * 00242557
002426*---------------------------------------------------------------* 00242657
002427                                                                  00242757
002428     COPY DPWS016.                                                00242857
002429                                                                  00242957
002430*---------------------------------------------------------------* 00243057
002431*    NUMERIC EDIT LAYOUT.                                       * 00243157
002432*---------------------------------------------------------------* 00243257
002433                                                                  00243357
002434     COPY DPWS010I.                                               00243457
002436*---------------------------------------------------------------* 00243657
CICS  *    PARAMETERS FOR CALLING CICS ARCHITECTURE API.              * 00243799
002438*---------------------------------------------------------------* 00243857
002439                                                                  00243957
002440     COPY DPWS030.                                                00244098
CICS       COPY DPWS930.                                                00244199
002441                                                                  00244298
002442*---------------------------------------------------------------* 00244398
002443*    STANDARD COMMAREA.                                         * 00244498
002444*---------------------------------------------------------------* 00244598
002445                                                                  00244698
002446     COPY DPWS020.                                                00244798
002447     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00244898
002448                                                                  00244998
002449*---------------------------------------------------------------* 00245098
002450* INTER-APPLICATION COMMAREA.                                   * 00245198
002451*   DPWS054 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 00245298
002452*             SPEC SCREEN.                                      * 00245398
002453*   DPWS056 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 00245498
002454*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 00245598
002455*---------------------------------------------------------------* 00245698
002456                                                                  00245798
002457         10  INTER-APPL-COMM-AREA       PIC X(200).               00245898
002458     COPY SVWS008.                                                00245998
002459*---------------------------------------------------------------* 00246098
002460*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 00246198
002461*---------------------------------------------------------------* 00246298
002462         10  ASC-SPECIFIC-COMMAREA.                               00246398
002463             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                00246498
002464                 20  ASC-BLOCK-MODIFIED-SW         PIC  X(01).    00246598
002465                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   00246698
002466                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   00246798
002467                 20  ASC-ITEM-ARRAY.                              00246898
002468                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        00246998
002469                         30  ASC-LIST-ITEM-NUMBER                 00247098
002470                                                   PIC S9(09)     00247198
002471                                                     COMP-3.      00247298
002472                         30  ASC-TEMP-SELECTED-SW  PIC  X(01).    00247398
002473                             88  ASC-VALID-SELECT    VALUE ' '    00247498
002474                                                           'S'.   00247598
002475                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   00247698
002476                             88  ASC-TEMP-SELECT     VALUE 'S'.   00247798
002477                             88  ASC-TEMP-BEGIN      VALUE 'B'.   00247898
002478                             88  ASC-TEMP-END        VALUE 'E'.   00247998
002479                         30  ASC-SELECTED-SW       PIC  X(01).    00248098
002480                             88  ASC-NO-SELECT       VALUE ' '.   00248198
002481                             88  ASC-SELECT          VALUE 'S'.   00248298
002482                             88  ASC-BEGIN           VALUE 'B'.   00248398
002483                             88  ASC-END             VALUE 'E'.   00248498
002484                         30  ASC-TYP-CDE     PIC  9(1).           00248598
002485                         30  ASC-TYP-DESC    PIC  X(04).          00248698
002487                         30  ASC-STK-TYP-ID        PIC  X(08).    00248779
002488                         30  ASC-DENOMINATION      PIC  X(08).    00248879
002489                         30  ASC-DENOMINATION-9    PIC 9(05)V99.  00248979
002493                         30  ASC-COMMENT           PIC  X(30).    00249364
002494                         30  ASC-REPLENISH         PIC  X(1).     00249475
002495                                                                  00249575
002496             15  ASC-BLK-SUB                       PIC S9(04)     00249675
002497                                                          COMP    00249775
002498                                                          SYNC.   00249875
002499             15  ASC-ITEM-SUB                        PIC S9(04)   00249975
002500                                                          COMP    00250075
002501                                                          SYNC.   00250175
002502             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   00250275
002503                                                          COMP-3. 00250375
002504             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   00250475
002505                                                          COMP-3. 00250575
002506             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   00250675
002507                                                          COMP-3. 00250775
002508             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   00250875
002509                                                          COMP-3. 00250975
002510             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   00251075
002511                                                          COMP-3. 00251175
002512             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   00251275
002513                                                          COMP    00251375
002514                                                          SYNC.   00251475
002515             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   00251575
002516                                                          COMP-3. 00251675
002517             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   00251775
002518                                                          COMP-3. 00251875
002519             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  00251975
002520                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   00252075
002521                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   00252175
002522             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  00252275
002523                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   00252375
002524                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   00252475
002525             15  ASC-LIST-QUEUE-NAME.                             00252575
002526                 20  ASC-LIST-TERM-ID                PIC  X(04).  00252675
002527                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   00252775
002528                                                          COMP-3. 00252875
002529                 20  ASC-LIST-SEQ                    PIC  9(01).  00252975
002530             15  ASC-SEL-QUEUE-NAME.                              00253075
002531                 20  ASC-SEL-TERM-ID                 PIC  X(04).  00253175
002532                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   00253275
002533                                                          COMP-3. 00253375
002534                 20  ASC-SEL-SEQ                     PIC  9(01).  00253475
002535             15  ASC-START-ITEM-REQUEST.                          00253575
002536                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  00253675
002538         10  FILLER                                  PIC X(821).  00253892
002539                                                                  00253992
002540*---------------------------------------------------------------* 00254075
002541*    ABEND PROCESSING COPYBOOK.                                 * 00254175
002542*---------------------------------------------------------------* 00254275
002543                                                                  00254375
002544     COPY DPWS013.                                                00254475
002545                                                                  00254575
002547*---------------------------------------------------------------* 00254775
002548*    DB2 AREA FOR COMMUNICATIONS                                * 00254875
002549*---------------------------------------------------------------* 00254975
002550     EXEC SQL                                                     00255075
002551          INCLUDE SQLCA                                           00255175
002552     END-EXEC.                                                    00255275
002553                                                                  00255375
002554*---------------------------------------------------------------* 00255475
002555*    DB2 AREA FOR SVT_CRD_STK_DNMNTN                              00255575
002556*---------------------------------------------------------------* 00255675
002557     EXEC SQL                                                     00255775
002558          INCLUDE SVT00008                                        00255875
002559     END-EXEC.                                                    00255975
002560                                                                  00256075
002561*---------------------------------------------------------------* 00256175
002562*    CRD STOCK CURSOR FROM SVT_CRD_STK_DNMNTN                   * 00256275
002563*---------------------------------------------------------------* 00256375
002564                                                                  00256475
002565     EXEC SQL                                                     00256575
002566          DECLARE CRD-STK CURSOR                                  00256675
002567          FOR SELECT                                              00256775
002568                CRD_TYP_CDE                                       00256875
002569               ,CRD_STK_TYP_ID                                    00256975
002570               ,PRE_DNNTD_CRD_AMT                                 00257075
002571               ,CMNT_TXT                                          00257157
002572               ,CRD_RPLNT_IND                                     00257275
002573          FROM                                                    00257375
002574                SVT_CRD_STK_DNMNTN                                00257475
002577          ORDER BY                                                00257708
002578                CRD_TYP_CDE,                                      00257809
002579                CRD_STK_TYP_ID,                                   00257909
002580                PRE_DNNTD_CRD_AMT                                 00258009
002584     END-EXEC.                                                    00258408
002585                                                                  00258508
002586*---------------------------------------------------------------* 00258608
002587                                                                  00258708
002589 LINKAGE SECTION.                                                 00258908
002590                                                                  00259008
002591 01  DFHCOMMAREA.                                                 00259108
002592     05  FILLER                         OCCURS  1 TO 4072 TIMES   00259208
002593                                        DEPENDING ON EIBCALEN.    00259308
002594         10  FILLER                     PIC X.                    00259408
002595                                                                  00259508
002597 PROCEDURE DIVISION.                                              00259708
002598******************************************************************00259808
002599**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **00259908
002600**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **00260008
002601**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **00260108
002602******************************************************************00260208
002603 0000-MAIN-MODULE.                                                00260308
002604     INITIALIZE DP030-CICS-API-FIELDS.                            00260408
002605     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       00260508
002606     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          00260608
002607     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         00260708
002608     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       00260808
002609     MOVE LENGTH OF SV105AI        TO DP030-MAP-LENGTH (1).       00260908
002610     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     00261008
002611     PERFORM 0001-CALL-CICS-ARCH-API.                             00261108
002612*                                                                 00261208
002613     PERFORM 1000-CONTROL-PROCESSING                              00261308
002614*                                                                 00261408
002615     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     00261508
002616     PERFORM 0001-CALL-CICS-ARCH-API.                             00261608
002617                                                                  00261708
002618******************************************************************00261808
002619**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **00261908
002620**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **00262008
002621******************************************************************00262108
002622 0001-CALL-CICS-ARCH-API.                                         00262208
002623                                                                  00262399
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      00262497
002624                                    DFHCOMMAREA                   00262697
002625                                    DP030-CICS-API-FIELDS         00262797
002626                                    DP020-STANDARD-COMMAREA       00262897
002627                                    SV105AI.                      00262997
002628*                                                                 00263008
002629     IF  DP030-RC-CALL-SUCCESSFUL                                 00263108
002630         CONTINUE                                                 00263208
002631     ELSE                                                         00263308
002632         SET DP013-NO-ROLLBACK                                    00263408
002633             DP013-XCTL-DISPLAY-RESTART                           00263508
002634             DP013-CICS-ABEND      TO TRUE                        00263608
002635         MOVE '0001-CALL-CICS-ARCH-API'                           00263708
002636                                   TO DP013-PARAGRAPH             00263808
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O00263997
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      00264097
002639         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      00264197
002640         PERFORM DP013-0000-PROCESS-ABEND                         00264297
002641     END-IF.                                                      00264397
002642*----------------------------------------------------------------*00264497
002643* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *00264597
002644* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *00264697
002645*                                                                *00264797
002646* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *00264897
002647*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *00264997
002648*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *00265097
002649*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *00265197
002650*----------------------------------------------------------------*00265297
002651                                                                  00265397
002652 1000-CONTROL-PROCESSING.                                         00265497
002653                                                                  00265597
002654     EVALUATE TRUE                                                00265697
002655         WHEN DP020-NEXT-ACT-INITIAL                              00265797
002656             INITIALIZE ASC-SPECIFIC-COMMAREA                     00265897
002657             INITIALIZE SV008-INTER-APPL-COMMAREA                 00265997
002658             MOVE EIBTRMID           TO ASC-LIST-TERM-ID          00266097
002659                                        ASC-SEL-TERM-ID           00266197
002660             MOVE DP020-SRC-TASK-NUMBER                           00266297
002661                                     TO ASC-LIST-TASK-NUMBER      00266397
002662                                        ASC-SEL-TASK-NUMBER       00266497
002663             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              00266597
002664             MOVE PC-SEL-QUEUE-SEQ   TO ASC-SEL-SEQ               00266697
002665                                                                  00266797
002666             PERFORM 1100-PROCESS-INTER-APPL-COMM                 00266897
002667                                                                  00266997
002668             PERFORM 4000-BUILD-INITIAL-PANEL                     00267097
002669                                                                  00267197
002670         WHEN DP020-NEXT-ACT-READ-MAP                             00267297
002671             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        00267397
002672                                   TO PV-TOP-ITEM                 00267497
002673             PERFORM 2000-PROCESS-PANEL                           00267597
002674                                                                  00267697
002675         WHEN DP020-NEXT-ACT-RETURN                               00267797
002698             PERFORM 2050-DELETE-LIST-QUEUE                       00269889
002700             PERFORM 4000-BUILD-INITIAL-PANEL                     00270089
002713                                                                  00271308
002714         WHEN OTHER                                               00271408
002715             SET DP013-LOGIC-ABEND TO TRUE                        00271508
002716             SET DP013-NO-ROLLBACK TO TRUE                        00271608
002717             MOVE '1000-CONTROL-PROCESSING'                       00271708
002718                                   TO DP013-PARAGRAPH             00271808
002719             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    00271908
002720                                   TO DP013-MESSAGE-TEXT(1)       00272008
002721             PERFORM DP013-0000-PROCESS-ABEND                     00272108
002722     END-EVALUATE.                                                00272208
002723                                                                  00272308
002725*----------------------------------------------------------------*00272508
002726* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *00272608
002727* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *00272708
002728*----------------------------------------------------------------*00272808
002729                                                                  00272908
002730 1100-PROCESS-INTER-APPL-COMM.                                    00273008
002731                                                                  00273108
002733     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     00273308
002734                                                                  00273408
002736*----------------------------------------------------------------*00273608
002737* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *00273708
002738* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *00273808
002739* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *00273908
002740* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *00274008
002741* FUNCTION KEYS CAN GET THIS FAR.                                *00274108
002742*----------------------------------------------------------------*00274208
002743                                                                  00274308
002744 2000-PROCESS-PANEL.                                              00274408
002745     EVALUATE TRUE                                                00274508
002746         WHEN DP020-SRC-AID = DP016-CLEAR                         00274608
002747             MOVE ZERO  TO  ASC-ITEM-AT-TOP-OF-PANEL              00274711
002748             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   00274808
002749             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00274908
002750                                                                  00275008
002751         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    00275108
002752             PERFORM 2050-DELETE-LIST-QUEUE                       00275208
002754             PERFORM 4000-BUILD-INITIAL-PANEL                     00275408
002755                                                                  00275508
002756         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    00275608
002757             PERFORM 2140-DESELECT-ALL-ITEMS                      00275708
002758             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00275808
002759                                                                  00275908
002760         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  00276008
002761             PERFORM 2150-SELECT-ALL-ITEMS                        00276108
002762             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00276208
002763                                                                  00276308
002764         WHEN OTHER                                               00276408
002765             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 00276508
002766             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   00276608
002767             IF  PS-NO-ERROR                                      00276708
002768                 SET DP030-CONTINUE-GO                            00276808
002769                                 TO TRUE                          00276908
002770                 PERFORM 2100-CHECK-FUNCTION-KEY                  00277008
002771             ELSE                                                 00277108
002772                 SET DP030-OVERRIDE-GO                            00277208
002773                                 TO TRUE                          00277308
002774             END-IF                                               00277408
002775     END-EVALUATE.                                                00277508
002776                                                                  00277692
002777*----------------------------------------------------------------*00277708
002778*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *00277808
002779*----------------------------------------------------------------*00277908
002780 2050-DELETE-LIST-QUEUE.                                          00278008
002781                                                                  00278108
002782     EXEC CICS                                                    00278208
002783         DELETEQ TS                                               00278308
002784             QUEUE (ASC-LIST-QUEUE-NAME)                          00278408
002785             RESP  (PV-CICS-RESP)                                 00278508
002786     END-EXEC.                                                    00278608
002787                                                                  00278708
002788     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       00278808
002789        (PV-CICS-RESP = DFHRESP(QIDERR))                          00278908
002790         CONTINUE                                                 00279008
002791     ELSE                                                         00279108
002792         SET DP013-CICS-ABEND      TO TRUE                        00279208
002793         SET DP013-NO-ROLLBACK     TO TRUE                        00279308
002794                                                                  00279408
002795         MOVE '2050-DELETE-LIST-QUEUE'                            00279508
002796                                   TO DP013-PARAGRAPH             00279608
002797         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    00279708
002798                                   TO DP013-MESSAGE-TEXT (1)      00279808
002799         PERFORM DP013-0000-PROCESS-ABEND                         00279908
002800     END-IF.                                                      00280008
002801                                                                  00280108
002802     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  00280208
002803                                                                  00280392
002804*----------------------------------------------------------------*00280408
002805* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*00280508
002806* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *00280608
002807* CICS ARCHITECTURE API.                                         *00280708
002808*----------------------------------------------------------------*00280808
002809 2100-CHECK-FUNCTION-KEY.                                         00280908
002810     EVALUATE TRUE                                                00281008
002811*------------------ F13 ADD ------                                00281110
002812         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               00281208
002813             IF ASC-NUMBER-OF-SELECTED-ITEMS > 0                  00281392
002814                 SET DP030-OVERRIDE-GO TO TRUE                    00281492
002815*------------------ CANNOT SELECT FOR AN ADD -----                00281592
002816                 MOVE PC-TSYMSG-00112                             00281692
002817                                   TO DP020-MSG-NUMBER            00281792
002818                 SET DP020-MSG-FATAL TO TRUE                      00281892
002819             ELSE                                                 00281992
002820                 PERFORM 5000-PREPARE-SEL-QUEUE                   00282008
002821             END-IF                                               00282192
002822                                                                  00282208
002823*------------------ F15 UPDATE --------------------               00282310
002824         WHEN DP020-FK-LOCAL-FUNC-02(DP020-SRC-AID)               00282410
002825             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              00282527
002826                 SET DP030-OVERRIDE-GO TO TRUE                    00282627
002827*------------------ A LIST ITEM MUST BE SELECTED --               00282727
002828                 MOVE PC-TSYMSG-00057                             00282827
002829                                   TO DP020-MSG-NUMBER            00282927
002830                 SET DP020-MSG-FATAL TO TRUE                      00283027
002831             ELSE                                                 00283127
002832                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                00283227
002833                              TO SV008-NUMBER-OF-SELECTED-ITEMS   00283329
002834                 PERFORM 5000-PREPARE-SEL-QUEUE                   00283427
002835             END-IF                                               00283527
002836                                                                  00283610
002837*------------------ F16 DELETE --------------------               00283710
002838         WHEN DP020-FK-LOCAL-FUNC-03(DP020-SRC-AID)               00283810
002839             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              00283927
002840                 SET DP030-OVERRIDE-GO TO TRUE                    00284027
002841*------------------ A LIST ITEM MUST BE SELECTED --               00284127
002842                 MOVE PC-TSYMSG-00057                             00284227
002843                                   TO DP020-MSG-NUMBER            00284327
002844                 SET DP020-MSG-FATAL TO TRUE                      00284427
002845             ELSE                                                 00284527
002846                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                00284627
002847                           TO SV008-NUMBER-OF-SELECTED-ITEMS      00284729
002848                 PERFORM 5000-PREPARE-SEL-QUEUE                   00284827
002849             END-IF                                               00284927
002850                                                                  00285010
002851*------------------ F22 REQUEST- GOES TO RDREQ-----               00285137
002852         WHEN DP020-FK-LOCAL-FUNC-04(DP020-SRC-AID)               00285237
002853             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              00285337
002854                 SET DP030-OVERRIDE-GO TO TRUE                    00285437
002855*------------------ A LIST ITEM MUST BE SELECTED --               00285537
002856                 MOVE PC-TSYMSG-00057                             00285637
002857                                   TO DP020-MSG-NUMBER            00285737
002858                 SET DP020-MSG-FATAL TO TRUE                      00285837
002859             ELSE                                                 00285937
002860                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                00286037
002861                           TO SV008-NUMBER-OF-SELECTED-ITEMS      00286137
002862                 PERFORM 5000-PREPARE-SEL-QUEUE                   00286237
002863             END-IF                                               00286337
002864                                                                  00286437
002865         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  00286537
002866             MOVE +1               TO PV-TOP-ITEM                 00286637
002867             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00286737
002868                                                                  00286837
002869         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   00286937
002870             PERFORM 2110-BROWSE-BACKWARD                         00287037
002871             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00287137
002872                                                                  00287237
002873         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   00287337
002874             PERFORM 2120-BROWSE-FORWARD                          00287437
002875             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00287537
002876                                                                  00287637
002877         WHEN DP020-SRC-AID = DP016-ENTER                         00287737
002878             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   00287837
002879             IF  PS-ERROR                                         00287937
002880                 CONTINUE                                         00288037
002881             ELSE                                                 00288137
002882                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             00288237
002883             END-IF                                               00288337
002884                                                                  00288437
002885         WHEN OTHER                                               00288537
002886             SET DP013-NO-ROLLBACK                                00288637
002887                 DP013-XCTL-DISPLAY-RESTART                       00288737
002888                 DP013-CICS-ABEND  TO TRUE                        00288837
002889             MOVE '2100-CHECK-FUNCTION-KEY'                       00288937
002890                                   TO DP013-PARAGRAPH             00289037
002891             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      00289137
002892                                   TO DP013-MESSAGE-TEXT (1)      00289237
002893             PERFORM DP013-0000-PROCESS-ABEND                     00289337
002894     END-EVALUATE.                                                00289437
002895*                                                                 00289537
002896*----------------------------------------------------------------*00289637
002897*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *00289737
002898*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *00289837
002899*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *00289937
002900*    MESSAGE.                                                    *00290037
002901*----------------------------------------------------------------*00290137
002902                                                                  00290237
002903 2110-BROWSE-BACKWARD.                                            00290337
002904     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    00290437
002905         GIVING PV-TOP-ITEM.                                      00290537
002906*                                                                 00290637
002907     IF  ((PV-TOP-ITEM < +1)                                      00290737
002908       OR (PV-TOP-ITEM = +1))                                     00290837
002909         MOVE +1                   TO PV-TOP-ITEM                 00290937
002910*------------------ TOP OF LIST -------------------               00291037
002911         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            00291137
002912         SET DP020-MSG-INFORMATIONAL TO TRUE                      00291237
002913     END-IF.                                                      00291337
002914                                                                  00291437
002916*----------------------------------------------------------------*00291637
002917*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *00291737
002918*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *00291837
002919*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *00291937
002920*----------------------------------------------------------------*00292037
002921                                                                  00292137
002922 2120-BROWSE-FORWARD.                                             00292237
002923                                                                  00292337
002924     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              00292437
002925         GIVING PV-TOP-ITEM.                                      00292537
002926     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   00292637
002927         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            00292737
002928                                   TO PV-TOP-ITEM                 00292837
002929*----------------- BOTTOM OF LIST -----------------               00292937
002930         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            00293037
002931         SET DP020-MSG-INFORMATIONAL                              00293137
002932                                   TO TRUE                        00293237
002933     ELSE                                                         00293337
002934         COMPUTE PV-BOTTOM-ITEM =                                 00293437
002935             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 00293537
002936         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            00293637
002937*----------------- BOTTOM OF LIST ------------------              00293737
002938             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            00293837
002939             SET DP020-MSG-INFORMATIONAL                          00293937
002940                                   TO TRUE                        00294037
002941         END-IF                                                   00294137
002942     END-IF.                                                      00294237
002943                                                                  00294392
002944*----------------------------------------------------------------*00294437
002945*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *00294537
002946*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *00294637
002947*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *00294737
002948*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *00294837
002949*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *00294937
002950*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *00295037
002951*----------------------------------------------------------------*00295137
002952                                                                  00295237
002953 2130-CHECK-FOR-JUMP-BROWSE.                                      00295337
002954     SET PS-NO-ERROR               TO TRUE.                       00295437
002955     IF (ASC-START-ITEM-REQUEST = SPACE)                          00295537
002956         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            00295637
002957                                   TO PV-TOP-ITEM                 00295737
002958     ELSE                                                         00295837
002959         MOVE ASC-START-ITEM-REQUEST                              00295937
002960                                   TO DP010I-UNEDITED-FIELD       00296037
002961         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       00296137
002962         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     00296237
002963         SET DP010I-NEGATIVE-NOT-ALLOWED                          00296337
002964                                   TO TRUE                        00296437
002965         CALL DP010I-NUMERIC-EDIT-ROUTINE                         00296594
002966                         USING DP010I-NUMERIC-EDIT-AREA           00296694
002967                                                                  00296794
002968         IF  NOT DP010I-ERROR-DETECTED                            00296894
002969             MOVE DP010I-NUMERIC-FIELD                            00296994
002970                                   TO  ASC-START-ITEM-REQUEST-N   00297094
002971             IF  ASC-START-ITEM-REQUEST-N > ZERO                  00297194
002972                 IF  ASC-START-ITEM-REQUEST-N >                   00297294
002973                                          ASC-NUMBER-OF-ITEMS-READ00297394
002974                     MOVE SPACE TO ASC-START-ITEM-REQUEST         00297494
002975                     COMPUTE PV-TOP-ITEM =                        00297594
002976                             ASC-NUMBER-OF-ITEMS-READ             00297694
002977                             - PC-ITEMS-PER-PANEL + 1             00297794
002978                     IF  PV-TOP-ITEM < +1                         00297894
002979                         MOVE +1   TO PV-TOP-ITEM                 00297994
002980                         MOVE PC-TSYMSG-00070                     00298094
002981                                   TO DP020-MSG-NUMBER            00298194
002982                         SET DP020-MSG-INFORMATIONAL              00298294
002983                                   TO TRUE                        00298394
002984                     END-IF                                       00298494
002985                 ELSE                                             00298594
002986                     MOVE ASC-START-ITEM-REQUEST-N                00298694
002987                                   TO PV-TOP-ITEM                 00298794
002988                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      00298894
002989                     COMPUTE PV-BOTTOM-ITEM =                     00298994
002990                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     00299094
002991                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ00299194
002992*                        -- BOTTOM OF LIST --                     00299294
002993                         MOVE PC-TSYMSG-00070                     00299394
002994                                   TO DP020-MSG-NUMBER            00299494
002995                         SET DP020-MSG-INFORMATIONAL              00299594
002996                                   TO TRUE                        00299694
002997                     END-IF                                       00299794
002998                 END-IF                                           00299894
002999             ELSE                                                 00299994
003000*                --- VALUE OUT OF RANGE ----                      00300094
003001                 MOVE PC-TSYMSG-00101                             00300194
003002                                   TO DP020-MSG-NUMBER            00300294
003003                 MOVE -1           TO ASTRTITL                    00300394
003004                 SET DP030-SET-CURSOR-APPL-1                      00300494
003005                                   TO TRUE                        00300594
003006                 MOVE DP015-REVERSE                               00300694
003007                                   TO ASTRTITH                    00300794
003008                 MOVE DP015-RED    TO ASTRTITC                    00300894
003009                 MOVE DP015-UNP-NUM-BRT-MDT                       00300994
003010                                   TO ASTRTITA                    00301094
003011                 SET DP020-MSG-FATAL                              00301194
003012                                   TO TRUE                        00301294
003013                 SET PS-ERROR      TO TRUE                        00301394
003014             END-IF                                               00301494
003015                                                                  00301594
003016         ELSE                                                     00301694
003017             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            00301794
003018             MOVE -1               TO ASTRTITL                    00301894
003019             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  00301994
003020             MOVE DP015-REVERSE    TO ASTRTITH                    00302094
003021             MOVE DP015-RED        TO ASTRTITC                    00302194
003022             MOVE DP015-UNP-NUM-BRT-MDT                           00302294
003023                                   TO ASTRTITA                    00302394
003024             SET DP020-MSG-FATAL   TO TRUE                        00302494
003025             SET PS-ERROR          TO TRUE                        00302594
003026         END-IF                                                   00302694
003027     END-IF.                                                      00302794
003028                                                                  00302894
003029*----------------------------------------------------------------*00302994
003030*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *00303094
003031*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *00303194
003032*----------------------------------------------------------------*00303294
003033 2140-DESELECT-ALL-ITEMS.                                         00303394
003034     MOVE +1                       TO ASC-BLK-SUB.                00303494
003035                                                                  00303594
003036     PERFORM 2141-CLEAR-SELECTED-INDS                             00303694
003037         VARYING ASC-ITEM-SUB                                     00303794
003038         FROM 1 BY 1                                              00303894
003039         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 00303994
003040                                                                  00304094
003041     ADD +1                        TO ASC-BLK-SUB.                00304194
003042                                                                  00304294
003043     PERFORM 2141-CLEAR-SELECTED-INDS                             00304394
003044         VARYING ASC-ITEM-SUB                                     00304494
003045         FROM 1 BY 1                                              00304594
003046         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 00304694
003047                                                                  00304794
003048     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               00304894
003049                                   TO PV-LIST-ITEM-NUMBER.        00304994
003050                                                                  00305094
003051     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            00305194
003052         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    00305294
003053                                                                  00305394
003054     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     00305494
003055        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      00305594
003056         MOVE +1                   TO ASC-BLK-SUB                 00305694
003057                                                                  00305794
003058         PERFORM 5100-WRITE-TEMP-STORAGE                          00305894
003059                                                                  00305994
003060         MOVE +1                   TO PV-BLOCK-NUMBER             00306094
003061                                                                  00306194
003062         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         00306294
003063             PV-FIRST-BLOCK-IN-ARRAY - 1                          00306394
003064                                                                  00306494
003065         PERFORM                                                  00306594
003066             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       00306694
003067                                                                  00306794
003068             PERFORM 4410-READ-TEMP-STORAGE                       00306894
003069                                                                  00306994
003070             PERFORM 2141-CLEAR-SELECTED-INDS                     00307094
003071                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 00307194
003072                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          00307294
003073                                                                  00307394
003074             PERFORM 5100-WRITE-TEMP-STORAGE                      00307494
003075                                                                  00307594
003076             ADD +1                TO PV-BLOCK-NUMBER             00307694
003077                                                                  00307794
003078         END-PERFORM                                              00307894
003079                                                                  00307994
003080         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         00308094
003081             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     00308194
003082                                                                  00308294
003083         PERFORM                                                  00308394
003084             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       00308494
003085                   ASC-HIGHEST-BLOCK-WRITTEN                      00308594
003086                                                                  00308694
003087             MOVE PV-NEXT-BLOCK-IN-ARRAY                          00308794
003088                                   TO PV-BLOCK-NUMBER             00308894
003089                                                                  00308994
003090             PERFORM 4410-READ-TEMP-STORAGE                       00309094
003091                                                                  00309194
003092             PERFORM 2141-CLEAR-SELECTED-INDS                     00309294
003093                 VARYING ASC-ITEM-SUB                             00309394
003094                 FROM 1 BY 1                                      00309494
003095                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          00309594
003096                                                                  00309694
003097             PERFORM 5100-WRITE-TEMP-STORAGE                      00309794
003098                                                                  00309894
003099             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      00309994
003100                                                                  00310094
003101         END-PERFORM                                              00310194
003102                                                                  00310294
003103         MOVE PV-FIRST-BLOCK-IN-ARRAY                             00310394
003104                                   TO PV-BLOCK-NUMBER             00310494
003105                                                                  00310594
003106         PERFORM 4410-READ-TEMP-STORAGE                           00310694
003107     END-IF.                                                      00310794
003108                                                                  00310894
003109                                                                  00310994
003110     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 00311094
003111     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.00311194
003112     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  00311294
003113                                                                  00311394
003114     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        00311494
003115                                                                  00311594
003116*----------------------------------------------------------------*00311637
003117*    MARK EACH ITEM AS BEING NOT SELECTED.                       *00311737
003118*----------------------------------------------------------------*00311837
003119                                                                  00311937
003120 2141-CLEAR-SELECTED-INDS.                                        00312037
003121                                                                  00312137
003122     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           00312237
003123             NOT EQUAL ZERO                                       00312337
003124         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          00312437
003125             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          00312537
003126                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    00312637
003127                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  00312737
003128                                   TO TRUE                        00312837
003129         END-IF                                                   00312937
003130     END-IF.                                                      00313037
003131                                                                  00313137
003133*----------------------------------------------------------------*00313337
003134*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *00313437
003135*  FOR ALL ITEMS.                                                *00313537
003136*----------------------------------------------------------------*00313637
003137                                                                  00313737
003138 2150-SELECT-ALL-ITEMS.                                           00313837
003139                                                                  00313937
003140     MOVE +1                       TO ASC-BLK-SUB.                00314037
003141                                                                  00314137
003142     PERFORM 2151-SET-SELECTED-INDS                               00314237
003143         VARYING ASC-ITEM-SUB                                     00314337
003144         FROM 1 BY 1                                              00314437
003145         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 00314537
003146                                                                  00314637
003147     ADD +1                        TO ASC-BLK-SUB.                00314737
003148                                                                  00314837
003149     PERFORM 2151-SET-SELECTED-INDS                               00314937
003150         VARYING ASC-ITEM-SUB                                     00315037
003151         FROM 1 BY 1                                              00315137
003152         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 00315237
003153                                                                  00315337
003154     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               00315437
003155                                   TO PV-LIST-ITEM-NUMBER.        00315537
003156                                                                  00315637
003157     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            00315737
003158         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    00315837
003159                                                                  00315937
003160     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     00316037
003161        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    00316137
003162         MOVE +1                   TO ASC-BLK-SUB                 00316237
003163                                                                  00316337
003164         PERFORM 5100-WRITE-TEMP-STORAGE                          00316437
003165                                                                  00316537
003166         MOVE +1                   TO PV-BLOCK-NUMBER             00316637
003167                                                                  00316737
003168         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         00316837
003169             PV-FIRST-BLOCK-IN-ARRAY - 1                          00316937
003170                                                                  00317037
003171         PERFORM                                                  00317137
003172             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       00317237
003173                                                                  00317337
003174             PERFORM 4410-READ-TEMP-STORAGE                       00317437
003175                                                                  00317537
003176             PERFORM 2151-SET-SELECTED-INDS                       00317637
003177                 VARYING ASC-ITEM-SUB                             00317737
003178                 FROM 1 BY 1                                      00317837
003179                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          00317937
003180                                                                  00318037
003181             PERFORM 5100-WRITE-TEMP-STORAGE                      00318137
003182                                                                  00318237
003183             ADD +1                TO PV-BLOCK-NUMBER             00318337
003184                                                                  00318437
003185         END-PERFORM                                              00318537
003186                                                                  00318637
003187         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         00318737
003188             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     00318837
003189                                                                  00318937
003190         PERFORM                                                  00319037
003191             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       00319137
003192                   ASC-HIGHEST-BLOCK-WRITTEN                      00319237
003193                                                                  00319337
003194             MOVE PV-NEXT-BLOCK-IN-ARRAY                          00319437
003195                                   TO PV-BLOCK-NUMBER             00319537
003196                                                                  00319637
003197             PERFORM 4410-READ-TEMP-STORAGE                       00319737
003198                                                                  00319837
003199             PERFORM 2151-SET-SELECTED-INDS                       00319937
003200                 VARYING ASC-ITEM-SUB                             00320037
003201                 FROM 1 BY 1                                      00320137
003202                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          00320237
003203                                                                  00320337
003204             PERFORM 5100-WRITE-TEMP-STORAGE                      00320437
003205                                                                  00320537
003206             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      00320637
003207                                                                  00320737
003208         END-PERFORM                                              00320837
003209                                                                  00320937
003210         MOVE PV-FIRST-BLOCK-IN-ARRAY                             00321037
003211                                   TO PV-BLOCK-NUMBER             00321137
003212                                                                  00321237
003213         PERFORM 4410-READ-TEMP-STORAGE                           00321337
003214     END-IF.                                                      00321437
003215                                                                  00321537
003216                                                                  00321637
003217     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             00321737
003218                       ASC-NUMBER-OF-SELECTED-ITEMS.              00321837
003219                                                                  00321937
003220     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        00322037
003221                                                                  00322137
003223*----------------------------------------------------------------*00322337
003224*    MARK EACH ITEM AS BEING SELECTED.                           *00322437
003225*----------------------------------------------------------------*00322537
003226                                                                  00322637
003227 2151-SET-SELECTED-INDS.                                          00322737
003228                                                                  00322837
003229     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           00322937
003230             NOT EQUAL ZERO                                       00323037
003231         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             00323137
003232             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             00323237
003233                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        00323337
003234                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  00323437
003235                               TO  TRUE                           00323537
003236         END-IF                                                   00323637
003237     END-IF.                                                      00323737
003238******************************************************************00323837
003239** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **00323937
003240** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **00324037
003241******************************************************************00324137
003242 2200-MOVE-SCREEN-TO-COMMAREA.                                    00324237
003243                                                                  00324337
003244     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             00324437
003245     MOVE +1                       TO PV-SUB.                     00324537
003246*                                                                 00324637
003247     PERFORM 3100-SET-SUBSCRIPTS.                                 00324737
003248     IF  ASTRTITL > ZERO                                          00324837
003249         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          00324937
003250     ELSE                                                         00325037
003251         IF  ASTRTITF = DP015-ERASE-EOF                           00325137
003252             INITIALIZE ASC-START-ITEM-REQUEST                    00325237
003253         END-IF                                                   00325337
003254     END-IF.                                                      00325437
003255     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          00325537
003256         VARYING PV-SUB                                           00325637
003257         FROM 1 BY 1                                              00325737
003258         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      00325837
003259******************************************************************00325937
003260** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**00326037
003261******************************************************************00326137
003262 2210-MOVE-LINES-TO-COMMAREA.                                     00326237
003263     IF  MR-SELECTL (PV-SUB) > ZERO                               00326337
003264         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             00326437
003265         MOVE MR-SELECTI (PV-SUB)                                 00326537
003266                                   TO ASC-TEMP-SELECTED-SW        00326637
003267                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      00326737
003268     ELSE                                                         00326837
003269         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                00326937
003270                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     00327037
003271                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        00327137
003272                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      00327237
003273         END-IF                                                   00327337
003274     END-IF.                                                      00327437
003275     ADD +1                        TO ASC-ITEM-SUB.               00327537
003276     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        00327637
003277         ADD +1                    TO ASC-BLK-SUB                 00327737
003278         MOVE +1                   TO ASC-ITEM-SUB                00327837
003279     END-IF.                                                      00327937
003280******************************************************************00328037
003281** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **00328137
003282** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **00328237
003283******************************************************************00328337
003284 3000-EDIT-DATA-IN-COMMAREA.                                      00328437
003285     SET PS-NO-ERROR               TO TRUE.                       00328537
003286     PERFORM 3200-RESET-ATTRIBUTES.                               00328637
003287     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     00328737
003288**                                                                00328837
003289* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              00328937
003290* EDITTING IS DONE FROM THE BOTTOM UP.                            00329037
003291**                                                                00329137
003292     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       00329237
003293         ASC-ITEMS-DISPLAYED - 1.                                 00329337
003294     PERFORM 3100-SET-SUBSCRIPTS.                                 00329437
003295     PERFORM 3300-EDIT-SELECTIONS                                 00329537
003296         VARYING PV-SUB                                           00329637
003297         FROM PV-SUB BY -1                                        00329737
003298         UNTIL PV-SUB < +1                                        00329837
003299*                                                                 00329937
003300     IF  PS-NO-ERROR                                              00330037
003301         PERFORM 3400-CHECK-RANGE-SEQUENCE                        00330137
003302     END-IF.                                                      00330237
003303*                                                                 00330337
003304     IF  ((PS-NO-ERROR)                                           00330437
003305       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   00330537
003306       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    00330637
003307             PERFORM 3500-MARK-RANGE-AS-SELECTED                  00330737
003308     END-IF.                                                      00330837
003309                                                                  00330992
003310*----------------------------------------------------------------*00331037
003311*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *00331137
003312*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*00331237
003313*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *00331337
003314*                                                                *00331437
003315*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *00331537
003316*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *00331637
003317*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *00331737
003318*    US IN THE 2ND BLOCK OF THE ARRAY.                           *00331837
003319*----------------------------------------------------------------*00331937
003320                                                                  00332037
003321 3100-SET-SUBSCRIPTS.                                             00332137
003322                                                                  00332237
003323     COMPUTE ASC-ITEM-SUB =                                       00332337
003324         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        00332437
003325                                                                  00332537
003326     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         00332637
003327         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            00332737
003328                                                                  00332837
003329         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               00332937
003330     ELSE                                                         00333037
003331         MOVE +1                     TO ASC-BLK-SUB               00333137
003332     END-IF.                                                      00333237
003333******************************************************************00333337
003334** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **00333437
003335******************************************************************00333537
003336                                                                  00333637
003337 3200-RESET-ATTRIBUTES.                                           00333737
003338     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   00333837
003339     MOVE DP015-GREEN              TO ASTRTITC.                   00333937
003340     MOVE DP015-UNDERLINE          TO ASTRTITH.                   00334037
003341*                                                                 00334137
003342     PERFORM                                                      00334237
003343         VARYING PV-SUB                                           00334337
003344         FROM 1 BY 1                                              00334437
003345         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        00334537
003346         MOVE DP015-UNP-ALP-NOR-OFF                               00334637
003347                                   TO MR-SELECTA (PV-SUB)         00334737
003348         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         00334837
003349         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         00334937
003350     END-PERFORM.                                                 00335037
003351******************************************************************00335137
003352** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **00335237
003353** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **00335337
003354** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **00335437
003355** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **00335537
003356******************************************************************00335637
003357 3300-EDIT-SELECTIONS.                                            00335737
003358     EVALUATE TRUE                                                00335837
003359         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     00335937
003360             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         00336037
003361                 CONTINUE                                         00336137
003362         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         00336237
003363             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        00336337
003364                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   00336437
003365                 MOVE ASC-TEMP-SELECTED-SW                        00336537
003366                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00336637
003367                                TO ASC-SELECTED-SW                00336737
003368                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00336837
003369             END-IF                                               00336937
003370         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     00337037
003371                 = SPACE                                          00337137
003372             EVALUATE TRUE                                        00337237
003373                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       00337337
003374                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS00337437
003375                     MOVE SPACE TO ASC-SELECTED-SW                00337537
003376                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00337637
003377                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        00337737
003378                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    00337837
003379                     MOVE SPACE TO ASC-SELECTED-SW                00337937
003380                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00338037
003381                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          00338137
003382                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      00338237
003383                     MOVE SPACE TO ASC-SELECTED-SW                00338337
003384                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00338437
003385             END-EVALUATE                                         00338537
003386         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           00338637
003387             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            00338737
003388                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    00338837
003389             END-IF                                               00338937
003390             PERFORM 3310-EDIT-RANGE                              00339037
003391         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             00339137
003392             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            00339237
003393                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    00339337
003394             END-IF                                               00339437
003395             PERFORM 3310-EDIT-RANGE                              00339537
003396         WHEN OTHER                                               00339637
003397             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           00339737
003398             SET DP020-MSG-FATAL    TO TRUE                       00339837
003399             MOVE -1                TO MR-SELECTL (PV-SUB)        00339937
003400             SET DP030-SET-CURSOR-APPL-1                          00340037
003401                                    TO TRUE                       00340137
003402             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        00340237
003403             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        00340337
003404             SET PS-ERROR TO TRUE                                 00340437
003405             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            00340537
003406                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     00340637
003407                 MOVE SPACE         TO ASC-SELECTED-SW            00340737
003408                                        (ASC-BLK-SUB ASC-ITEM-SUB)00340837
003409             END-IF                                               00340937
003410     END-EVALUATE.                                                00341037
003411                                                                  00341137
003412     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 00341237
003413     SUBTRACT +1 FROM ASC-ITEM-SUB.                               00341337
003414     IF  ASC-ITEM-SUB < 1                                         00341437
003415         SUBTRACT +1 FROM ASC-BLK-SUB                             00341537
003416         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                00341637
003417     END-IF.                                                      00341737
003418******************************************************************00341837
003419** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **00341937
003420** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **00342037
003421** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**00342137
003422** THE ENDING.                                                  **00342237
003423******************************************************************00342337
003424 3310-EDIT-RANGE.                                                 00342437
003425     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                00342537
003426         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   00342637
003427             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)00342737
003428                                   TO ASC-SELECTED-SW             00342837
003429                                        (ASC-BLK-SUB ASC-ITEM-SUB)00342937
003430             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 00343037
003431         ELSE                                                     00343137
003432             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     00343237
003433                 CONTINUE                                         00343337
003434             ELSE                                                 00343437
003435*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        00343537
003436                 MOVE PC-TSYMSG-00054                             00343637
003437                                   TO DP020-MSG-NUMBER            00343737
003438                 SET DP020-MSG-FATAL                              00343837
003439                                   TO TRUE                        00343937
003440                 MOVE -1           TO MR-SELECTL (PV-SUB)         00344037
003441                 SET DP030-SET-CURSOR-APPL-1                      00344137
003442                                   TO TRUE                        00344237
003443                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         00344337
003444                 MOVE DP015-UNDERLINE                             00344437
003445                                   TO MR-SELECTH (PV-SUB)         00344537
003446                 SET PS-ERROR      TO TRUE                        00344637
003447             END-IF                                               00344737
003448         END-IF                                                   00344837
003449     ELSE                                                         00344937
003450         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     00345037
003451             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 00345137
003452                                   TO ASC-SELECTED-SW             00345237
003453                                     (ASC-BLK-SUB ASC-ITEM-SUB)   00345337
003454             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   00345437
003455         ELSE                                                     00345537
003456             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       00345637
003457                 CONTINUE                                         00345737
003458             ELSE                                                 00345837
003459*                -- ONLY ONE END-OF-RANGE ALLOWED --              00345937
003460                 MOVE PC-TSYMSG-00055                             00346037
003461                                   TO DP020-MSG-NUMBER            00346137
003462                 SET DP020-MSG-FATAL                              00346237
003463                                   TO TRUE                        00346337
003464                 MOVE -1           TO MR-SELECTL (PV-SUB)         00346437
003465                 SET DP030-SET-CURSOR-APPL-1                      00346537
003466                                   TO TRUE                        00346637
003467                 SET PS-ERROR      TO TRUE                        00346737
003468             END-IF                                               00346837
003469         END-IF                                                   00346937
003470     END-IF.                                                      00347037
003471*                                                                 00347137
003472******************************************************************00347237
003473** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **00347337
003474** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **00347437
003475******************************************************************00347537
003476 3400-CHECK-RANGE-SEQUENCE.                                       00347637
003477     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       00347737
003478       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      00347837
003479       AND  ASC-START-OF-SELECTED-RANGE >                         00347937
003480                                         ASC-END-OF-SELECTED-RANGE00348037
003481*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                00348137
003482         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 00348237
003483         SET DP020-MSG-FATAL TO TRUE                              00348337
003484         SET PS-ERROR TO TRUE                                     00348437
003485         PERFORM 3410-POSITION-AT-ERROR                           00348537
003486     END-IF.                                                      00348637
003487******************************************************************00348737
003488** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **00348837
003489** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **00348937
003490** SHOULD BE POSITIONED ON A RANGE ERROR.                       **00349037
003491******************************************************************00349137
003492 3410-POSITION-AT-ERROR.                                          00349237
003493     SET DP030-SET-CURSOR-APPL-1                                  00349337
003494                                   TO TRUE.                       00349437
003495     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 00349537
003496                    - PV-TOP-ITEM + 1.                            00349637
003497     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      00349737
003498         CONTINUE                                                 00349837
003499     ELSE                                                         00349937
003500         MOVE -1                   TO MR-SELECTL (PV-SUB)         00350037
003501         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         00350137
003502         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         00350237
003503     END-IF.                                                      00350337
003504*                                                                 00350437
003505     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   00350537
003506                    - PV-TOP-ITEM + 1.                            00350637
003507     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      00350737
003508         CONTINUE                                                 00350837
003509     ELSE                                                         00350937
003510         MOVE -1                   TO MR-SELECTL (PV-SUB)         00351037
003511         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         00351137
003512         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         00351237
003513     END-IF.                                                      00351337
003514                                                                  00351492
003515*----------------------------------------------------------------*00351537
003516*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *00351637
003517*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *00351737
003518*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *00351837
003519*----------------------------------------------------------------*00351937
003520                                                                  00352037
003521 3500-MARK-RANGE-AS-SELECTED.                                     00352137
003522     MOVE +1                       TO  ASC-BLK-SUB.               00352237
003523     PERFORM 3510-MARK-SELECTED-INDS                              00352337
003524         VARYING ASC-ITEM-SUB                                     00352437
003525         FROM 1 BY 1                                              00352537
003526         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 00352637
003527                                                                  00352737
003528     ADD +1                        TO ASC-BLK-SUB.                00352837
003529     PERFORM 3510-MARK-SELECTED-INDS                              00352937
003530         VARYING ASC-ITEM-SUB                                     00353037
003531         FROM 1 BY 1                                              00353137
003532         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 00353237
003533                                                                  00353337
003534     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               00353437
003535                                   TO  PV-LIST-ITEM-NUMBER.       00353537
003536     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            00353637
003537         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         00353737
003538               PC-ITEMS-PER-PANEL).                               00353837
003539                                                                  00353937
003540     MOVE ASC-START-OF-SELECTED-RANGE                             00354037
003541                                   TO PV-START-OF-SELECTED-RANGE. 00354137
003542     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            00354237
003543         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  00354337
003544               PC-ITEMS-PER-PANEL).                               00354437
003545                                                                  00354537
003546     MOVE ASC-END-OF-SELECTED-RANGE                               00354637
003547                                   TO  PV-END-OF-SELECTED-RANGE.  00354737
003548     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             00354837
003549         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    00354937
003550               PC-ITEMS-PER-PANEL).                               00355037
003551     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             00355137
003552         PV-FIRST-BLOCK-IN-ARRAY + 1.                             00355237
003553                                                                  00355337
003554     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    00355437
003555        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        00355537
003556         MOVE +1                   TO ASC-BLK-SUB                 00355637
003557         PERFORM 5100-WRITE-TEMP-STORAGE                          00355737
003558         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         00355837
003559             PV-FIRST-BLOCK-IN-ARRAY - 1                          00355937
003560                                                                  00356037
003561         PERFORM                                                  00356137
003562             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      00356237
003563                   PV-PREV-BLOCK-IN-ARRAY                         00356337
003564             MOVE PV-FIRST-BLOCK-IN-RANGE                         00356437
003565                                   TO PV-BLOCK-NUMBER             00356537
003566             PERFORM 4410-READ-TEMP-STORAGE                       00356637
003567             PERFORM 3510-MARK-SELECTED-INDS                      00356737
003568                 VARYING ASC-ITEM-SUB                             00356837
003569                 FROM 1 BY 1                                      00356937
003570                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          00357037
003571             PERFORM 5100-WRITE-TEMP-STORAGE                      00357137
003572             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     00357237
003573         END-PERFORM                                              00357337
003574                                                                  00357437
003575         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         00357537
003576             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     00357637
003577         PERFORM                                                  00357737
003578             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       00357837
003579                   PV-LAST-BLOCK-IN-RANGE                         00357937
003580             MOVE PV-NEXT-BLOCK-IN-ARRAY                          00358037
003581                                   TO PV-BLOCK-NUMBER             00358137
003582             PERFORM 4410-READ-TEMP-STORAGE                       00358237
003583             PERFORM 3510-MARK-SELECTED-INDS                      00358337
003584                 VARYING ASC-ITEM-SUB                             00358437
003585                 FROM 1 BY 1                                      00358537
003586                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          00358637
003587             PERFORM 5100-WRITE-TEMP-STORAGE                      00358737
003588             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      00358837
003589         END-PERFORM                                              00358937
003590                                                                  00359037
003591         MOVE PV-FIRST-BLOCK-IN-ARRAY                             00359137
003592                                   TO PV-BLOCK-NUMBER             00359237
003593         PERFORM 4410-READ-TEMP-STORAGE                           00359337
003594     END-IF.                                                      00359437
003595                                                                  00359537
003596     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 00359637
003597                                      ASC-END-OF-SELECTED-RANGE.  00359737
003598                                                                  00359837
003600*----------------------------------------------------------------*00360037
003601* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *00360137
003602*----------------------------------------------------------------*00360237
003603                                                                  00360337
003604 3510-MARK-SELECTED-INDS.                                         00360437
003605                                                                  00360537
003606     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         00360637
003607                                ASC-ITEM-SUB) >                   00360737
003608         ASC-START-OF-SELECTED-RANGE)                             00360837
003609     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         00360937
003610                                ASC-ITEM-SUB) =                   00361037
003611         ASC-START-OF-SELECTED-RANGE)                             00361137
003612                                                                  00361237
003613         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     00361337
003614                                    ASC-ITEM-SUB) <               00361437
003615             ASC-END-OF-SELECTED-RANGE)                           00361537
003616         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     00361637
003617                                    ASC-ITEM-SUB) =               00361737
003618             ASC-END-OF-SELECTED-RANGE)                           00361837
003619                                                                  00361937
003620             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          00362037
003621                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   00362137
003622                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   00362237
003623                               TO TRUE                            00362337
003624                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              00362437
003625                               TO TRUE                            00362537
003626                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    00362637
003627             END-IF                                               00362737
003628         END-IF                                                   00362837
003629     END-IF.                                                      00362937
003630                                                                  00363037
003632*----------------------------------------------------------------*00363237
003633*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *00363337
003634*    INITIALIZE ALL COUNTERS AND FLAGS.                          *00363437
003635*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *00363537
003636*    DISPLAY THE PANEL TO USER.                                  *00363637
003637*----------------------------------------------------------------*00363737
003638                                                                  00363837
003639 4000-BUILD-INITIAL-PANEL.                                        00363937
003640                                                                  00364037
003641     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             00364137
003642                                ASC-BLOCK-ENTRIES (2).            00364237
003643     MOVE +1                 TO ASC-BLK-SUB.                      00364337
003644     SET ASC-ITEMS-LEFT-ON-DB                                     00364437
003645                             TO TRUE.                             00364537
003646                                                                  00364637
003647     MOVE +0                 TO ASC-ITEM-SUB                      00364737
003648                                ASC-NUMBER-OF-ITEMS-READ          00364837
003649                                ASC-NUMBER-OF-SELECTED-ITEMS      00364937
003650                                ASC-HIGHEST-BLOCK-WRITTEN         00365037
003651                                ASC-START-OF-SELECTED-RANGE       00365137
003652                                ASC-END-OF-SELECTED-RANGE         00365237
003653                                ASC-ITEM-AT-TOP-OF-PANEL.         00365337
003654                                                                  00365437
003655     PERFORM 4010-OPEN-CURSOR.                                    00365537
003656                                                                  00365637
003657     PERFORM 4300-READ-ITEMS-FROM-DB.                             00365737
003658                                                                  00365837
003659     PERFORM 4020-CLOSE-CURSOR.                                   00365937
003660                                                                  00366037
003661     MOVE +1                   TO  PV-TOP-ITEM.                   00366137
003662     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          00366237
003663         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    00366337
003664         SET DP020-MSG-FATAL   TO  TRUE                           00366437
003665         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               00366537
003666     ELSE                                                         00366637
003667         MOVE -1               TO MR-SELECTL (1)                  00366737
003668         SET DP030-SET-CURSOR-APPL-1                              00366837
003669                               TO TRUE                            00366937
003670         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     00367037
003671     END-IF.                                                      00367137
003672                                                                  00367292
003673*----------------------------------------------------------------*00367337
003674*   OPENS THE ADDRESS CURSOR.                                    *00367437
003675*                                                                *00367537
003676*----------------------------------------------------------------*00367637
003677                                                                  00367737
003678 4010-OPEN-CURSOR.                                                00367837
003679     PERFORM                                                      00367937
003680         WITH TEST AFTER                                          00368037
003681         VARYING PV-RETRY-COUNTER                                 00368137
003682         FROM 1 BY 1                                              00368237
003683         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               00368337
003684                   OR (SQLCODE = ZERO))                           00368437
003685                                                                  00368537
003686         EXEC SQL                                                 00368637
003687              OPEN CRD-STK                                        00368737
003688         END-EXEC                                                 00368837
003689                                                                  00368937
003690                                                                  00369037
003691         EVALUATE TRUE                                            00369137
003692             WHEN SQLCODE = ZERO                                  00369237
003693             WHEN SQLCODE = -904                                  00369337
003694             WHEN SQLCODE = -913                                  00369437
003695                 CONTINUE                                         00369537
003696             WHEN SQLWARN0 NOT = SPACES                           00369637
003697             WHEN SQLCODE < ZERO                                  00369737
003698             WHEN SQLCODE > ZERO                                  00369837
003699                 MOVE '4010-OPEN-CURSOR'                          00369937
003700                                   TO DP013-PARAGRAPH             00370037
003701                 MOVE 'OPEN CARD STOCK CURSOR - '                 00370137
003702                                   TO DP013-MESSAGE-TEXT (1)      00370237
003703                 MOVE SQLCA    TO DP013-SQLCA                     00370337
003704                 MOVE 'SVT_CRD_STK_DNMNTN'                        00370437
003705                                   TO DP013-DB2-TABLE-NAME (1)    00370537
003706                 SET DP013-DB2-ABEND                              00370637
003707                     DP013-XCTL-DISPLAY-RESTART TO TRUE           00370737
003708                 PERFORM DP013-0000-PROCESS-ABEND                 00370837
003709         END-EVALUATE                                             00370937
003710     END-PERFORM.                                                 00371037
003711*                                                                 00371137
003712     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        00371237
003713         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             00371337
003714         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   00371437
003715                                   TO DP013-MESSAGE-TEXT (1)      00371537
003716         MOVE SQLCA                TO DP013-SQLCA                 00371637
003717         MOVE 'SVT_CRD_STK_DNMNTN' TO DP013-DB2-TABLE-NAME (1)    00371737
003718         SET DP013-DB2-ABEND                                      00371837
003719             DP013-XCTL-DISPLAY-RESTART                           00371937
003720                                   TO TRUE                        00372037
003721         PERFORM DP013-0000-PROCESS-ABEND                         00372137
003722     END-IF.                                                      00372237
003723                                                                  00372337
003725*----------------------------------------------------------------*00372537
003726* CLOSE THE CARD STOCK DENOMINATION CURSOR                       *00372637
003727*----------------------------------------------------------------*00372737
003728                                                                  00372837
003729 4020-CLOSE-CURSOR.                                               00372937
003730     PERFORM                                                      00373037
003731         WITH TEST AFTER                                          00373137
003732         VARYING PV-RETRY-COUNTER                                 00373237
003733         FROM 1 BY 1                                              00373337
003734         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               00373437
003735                   OR (SQLCODE = ZERO))                           00373537
003736                                                                  00373637
003737         EXEC SQL                                                 00373737
003738             CLOSE CRD-STK                                        00373837
003739         END-EXEC                                                 00373937
003740                                                                  00374037
003741         EVALUATE TRUE                                            00374137
003742             WHEN SQLCODE = ZERO                                  00374237
003743                 CONTINUE                                         00374337
003744             WHEN SQLWARN0 NOT = SPACES                           00374437
003745             WHEN SQLCODE < ZERO                                  00374537
003746             WHEN SQLCODE > ZERO                                  00374637
003747                 MOVE '4020-CLOSE-CURSOR'                         00374737
003748                                   TO DP013-PARAGRAPH             00374837
003749                 MOVE 'CLOSE ADDRESS CURSOR '                     00374937
003750                                   TO DP013-MESSAGE-TEXT (1)      00375037
003751                 MOVE SQLCA        TO DP013-SQLCA                 00375137
003752                 MOVE 'SVT_CRD_STK_DNMNTN'                        00375237
003753                                   TO DP013-DB2-TABLE-NAME (1)    00375337
003754                 SET DP013-DB2-ABEND                              00375437
003755                     DP013-XCTL-DISPLAY-RESTART TO TRUE           00375537
003756                 PERFORM DP013-0000-PROCESS-ABEND                 00375637
003757         END-EVALUATE                                             00375737
003758     END-PERFORM.                                                 00375837
003759                                                                  00375937
003761                                                                  00376137
003762*----------------------------------------------------------------*00376211
003763*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *00376311
003764*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *00376411
003765*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *00376511
003766*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *00376611
003767*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *00376711
003768*                                                                *00376811
003769*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *00376911
003770*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *00377011
003771*    UPON INITIALIZATION.                                        *00377111
003772*----------------------------------------------------------------*00377211
003773                                                                  00377311
003774 4300-READ-ITEMS-FROM-DB.                                         00377411
003775                                                                  00377511
003776     PERFORM                                                      00377611
003777         VARYING PV-READ-COUNT                                    00377711
003778         FROM 1 BY 1                                              00377811
003779         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    00377911
003780            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         00378011
003781                                                                  00378111
003782         PERFORM 4310-FETCH                                       00378211
003783                                                                  00378311
003784         IF  ASC-ITEMS-LEFT-ON-DB                                 00378411
003785             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                00378511
003786                 ADD +1            TO ASC-ITEM-SUB                00378611
003787             ELSE                                                 00378711
003788                 ADD +1            TO ASC-BLK-SUB                 00378811
003789                 MOVE +1           TO ASC-ITEM-SUB                00378911
003790                                                                  00379011
003791                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         00379111
003792                     MOVE +1       TO ASC-BLK-SUB                 00379211
003793                     SET ASC-BLOCK-MODIFIED (1)                   00379311
003794                                   TO TRUE                        00379411
003795                     PERFORM 5100-WRITE-TEMP-STORAGE              00379511
003796                     MOVE ASC-BLOCK-ENTRIES                       00379611
003797                               (PC-MAX-BLOCKS-IN-ARRAY)           00379711
003798                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 00379811
003799                     ADD +1        TO ASC-BLK-SUB                 00379911
003800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   00380011
003801                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      00380111
003802                                   TO TRUE                        00380211
003803                 END-IF                                           00380311
003804             END-IF                                               00380411
003805             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    00380511
003806             MOVE ASC-NUMBER-OF-ITEMS-READ                        00380611
003807                                   TO ASC-LIST-ITEM-NUMBER        00380711
003808                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00380811
003809                                                                  00380979
003810             MOVE SVT00008-CRD-TYP-CDE  TO ASC-TYP-CDE            00381083
003811                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00381183
003812                                                                  00381283
003815             IF SVT00008-CRD-TYP-CDE = SV004-KMRC-CRD-TYP         00381579
003817                 MOVE SV004-KMRC-CRD-DESC  TO ASC-TYP-DESC        00381779
003818                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00381879
003819             ELSE                                                 00381979
003820                 MOVE SV004-GIFT-CRD-DESC(1:4)                    00382081
003821                     TO ASC-TYP-DESC (ASC-BLK-SUB ASC-ITEM-SUB)   00382181
003823             END-IF                                               00382381
003824                                                                  00382481
003825             MOVE SVT00008-CRD-STK-TYP-ID TO ASC-STK-TYP-ID       00382581
003826                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00382681
003827             MOVE SVT00008-PRE-DNNTD-CRD-AMT TO ASC-DENOMINATION-900382781
003828                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00382881
003829             MOVE SVT00008-CRD-RPLNT-IND     TO ASC-REPLENISH     00382981
003830                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00383081
003831             IF IV-CMNT-TXT = 0                                   00383181
003832                 MOVE SVT00008-CMNT-TXT  TO ASC-COMMENT           00383281
003833                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00383381
003834             ELSE                                                 00383481
003835                 MOVE SPACE  TO ASC-COMMENT                       00383581
003836                                      (ASC-BLK-SUB ASC-ITEM-SUB)  00383681
003837             END-IF                                               00383781
003838         END-IF                                                   00383881
003839     END-PERFORM.                                                 00383981
003840                                                                  00384081
003841     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          00384181
003842         MOVE +1               TO ASC-BLK-SUB                     00384281
003843         PERFORM 5100-WRITE-TEMP-STORAGE                          00384381
003844         ADD +1                TO ASC-BLK-SUB                     00384481
003845         PERFORM 5100-WRITE-TEMP-STORAGE                          00384581
003846                                                                  00384681
003847         MOVE 1                TO ASC-BLK-SUB                     00384781
003848                                  PV-BLOCK-NUMBER                 00384881
003849         PERFORM 4410-READ-TEMP-STORAGE                           00384981
003850         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             00385081
003851             MOVE 2            TO ASC-BLK-SUB                     00385181
003852                                  PV-BLOCK-NUMBER                 00385281
003853             PERFORM 4410-READ-TEMP-STORAGE                       00385381
003854         END-IF                                                   00385481
003855     END-IF.                                                      00385581
003856                                                                  00385692
003857*----------------------------------------------------------------*00385781
003858*    FETCH THE CARD STOCK CURSOR                                 *00385881
003859*----------------------------------------------------------------*00385981
003860                                                                  00386081
003861 4310-FETCH.                                                      00386181
003862                                                                  00386281
003863         MOVE 0 TO IV-CMNT-TXT.                                   00386381
003864         PERFORM                                                  00386481
003865              WITH TEST AFTER                                     00386581
003866              VARYING PV-RETRY-COUNTER                            00386681
003867              FROM 1 BY 1                                         00386781
003868              UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)          00386881
003869                        OR (SQLCODE = ZERO)                       00386981
003870                        OR (SQLCODE = +100)                       00387081
003871                        OR (SQLCODE = -811))                      00387181
003872                                                                  00387281
003873             EXEC SQL                                             00387381
003874                 FETCH CRD-STK                                    00387481
003875                  INTO  :SVT00008-CRD-TYP-CDE                     00387581
003876                      , :SVT00008-CRD-STK-TYP-ID                  00387681
003877                      , :SVT00008-PRE-DNNTD-CRD-AMT               00387781
003878                      , :SVT00008-CMNT-TXT                        00387881
003879                        :IV-CMNT-TXT                              00387981
003880                      , :SVT00008-CRD-RPLNT-IND                   00388081
003881             END-EXEC                                             00388181
003882                                                                  00388281
003883             EVALUATE TRUE                                        00388381
003884                WHEN SQLCODE = ZERO                               00388481
003885                WHEN SQLCODE = -811                               00388581
003886                WHEN SQLCODE = +100                               00388681
003887                WHEN SQLCODE = -904                               00388781
003888                WHEN SQLCODE = -913                               00388881
003889                     CONTINUE                                     00388981
003890                WHEN SQLWARN0 NOT = SPACE                         00389081
003891                WHEN SQLCODE NOT = ZERO                           00389181
003892                     MOVE '4310-FETCH '   TO DP013-PARAGRAPH      00389281
003893                     MOVE 'FETCH CARD STOCK CURSOR'               00389381
003894                                  TO DP013-MESSAGE-TEXT (1)       00389481
003895                     MOVE SQLCA           TO DP013-SQLCA          00389581
003896                     SET DP013-DB2-ABEND  TO TRUE                 00389681
003897                     PERFORM DP013-0000-PROCESS-ABEND             00389781
003898             END-EVALUATE                                         00389881
003899         END-PERFORM.                                             00389981
003900                                                                  00390081
003901     IF  SQLCODE EQUAL +100                                       00390181
003902         SET ASC-NO-ITEMS-LEFT-ON-DB  TO TRUE                     00390281
003903     END-IF.                                                      00390381
003904                                                                  00390481
003906*----------------------------------------------------------------*00390681
003907* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *00390781
003908*----------------------------------------------------------------*00390881
003909                                                                  00390981
003910 4400-MOVE-COMMAREA-TO-SCREEN.                                    00391081
003911     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             00391181
003912         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          00391281
003913         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          00391381
003914             MOVE +1    TO ASC-BLK-SUB                            00391481
003915             PERFORM 5100-WRITE-TEMP-STORAGE                      00391581
003916             ADD +1     TO ASC-BLK-SUB                            00391681
003917             PERFORM 5100-WRITE-TEMP-STORAGE                      00391781
003918             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             00391881
003919                 GIVING PV-BLOCK-NUMBER                           00391981
003920                 REMAINDER PV-REMAINDER                           00392081
003921             IF  PV-REMAINDER > ZERO                              00392181
003922                 ADD +1 TO PV-BLOCK-NUMBER                        00392281
003923             END-IF                                               00392381
003924             MOVE +1    TO ASC-BLK-SUB                            00392481
003925             PERFORM 4410-READ-TEMP-STORAGE                       00392581
003926             ADD +1     TO ASC-BLK-SUB                            00392681
003927                           PV-BLOCK-NUMBER                        00392781
003928             PERFORM 4410-READ-TEMP-STORAGE                       00392881
003929     END-IF.                                                      00392981
003930     MOVE +1            TO ASC-BLK-SUB.                           00393081
003931     COMPUTE ASC-ITEM-SUB =                                       00393181
003932         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              00393281
003933         + PC-ITEMS-PER-PANEL).                                   00393381
003934*                                                                 00393481
003935     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        00393581
003936         ADD +1         TO ASC-BLK-SUB                            00393681
003937         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            00393781
003938     END-IF.                                                      00393881
003939*                                                                 00393981
003940     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           00394081
003941         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                00394181
003942     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        00394281
003943     PERFORM 4420-FORMAT-LIST-LINES                               00394381
003944         VARYING PV-SUB                                           00394481
003945         FROM PC-ITEMS-PER-PANEL BY -1                            00394581
003946         UNTIL PV-SUB < +1.                                       00394681
003947*                                                                 00394781
003948     COMPUTE ASC-ITEMS-DISPLAYED =                                00394881
003949         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          00394981
003950     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    00395081
003951                                      ASTRTITO.                   00395181
003952     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    00395281
003953     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    00395381
003954     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            00395481
003955                                   TO ASELITO.                    00395581
003956*                                                                 00395681
003957     IF  DP020-MSG-NUMBER-X = SPACE                               00395781
003958         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  00395881
003959*            --- MORE ITEMS TO DISPLAY ----                       00395981
003960             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            00396081
003961             SET DP020-MSG-INFORMATIONAL TO TRUE                  00396181
003962         END-IF                                                   00396281
003963     END-IF.                                                      00396381
003964*----------------------------------------------------------------*00396481
003965*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *00396581
003966*----------------------------------------------------------------*00396681
003967                                                                  00396781
003968 4410-READ-TEMP-STORAGE.                                          00396881
003969                                                                  00396981
003970     EXEC CICS                                                    00397081
003971         READQ TS                                                 00397181
003972             QUEUE (ASC-LIST-QUEUE-NAME)                          00397281
003973             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               00397381
003974             ITEM  (PV-BLOCK-NUMBER)                              00397481
003975             RESP  (PV-CICS-RESP)                                 00397581
003976     END-EXEC.                                                    00397681
003977                                                                  00397781
003978     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       00397881
003979       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     00397981
003980         CONTINUE                                                 00398081
003981     ELSE                                                         00398181
003982         SET DP013-CICS-ABEND     TO TRUE                         00398281
003983         SET DP013-NO-ROLLBACK    TO TRUE                         00398381
003984         MOVE '4410-READ-TEMP-STORAGE'                            00398481
003985                                  TO DP013-PARAGRAPH              00398581
003986         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      00398681
003987                                  TO DP013-MESSAGE-TEXT(1)        00398781
003988         PERFORM DP013-0000-PROCESS-ABEND                         00398881
003989     END-IF.                                                      00398981
003990                                                                  00399081
003991     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             00399181
003992*                                                                 00399281
003993     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         00399381
003994         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               00399481
003995     END-IF.                                                      00399581
003996                                                                  00399692
003997*----------------------------------------------------------------*00399781
003998*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *00399881
003999*----------------------------------------------------------------*00399981
004000                                                                  00400081
004001 4420-FORMAT-LIST-LINES.                                          00400181
004002     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      00400281
004003         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                00400381
004004         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           00400481
004005         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           00400581
004006         MOVE SPACE              TO MR-TYPE (PV-SUB)              00400690
004007         MOVE SPACE              TO MR-SELECTI (PV-SUB)           00400781
004008                                    MR-STOCK (PV-SUB)             00400881
004009                                    MR-CMMNT (PV-SUB)             00400981
004010                                    MR-REPL  (PV-SUB)             00401081
004011         MOVE SPACE              TO MR-DENOM-X (PV-SUB)           00401181
004012     ELSE                                                         00401281
004013         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      00401381
004014                                                   > SPACE        00401481
004015             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 00401581
004016                                 TO MR-SELECTI (PV-SUB)           00401681
004017         ELSE                                                     00401781
004018             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      00401881
004019                                 TO MR-SELECTI (PV-SUB)           00401981
004020         END-IF                                                   00402081
004021*                                                                 00402181
004022         IF  DP030-SET-CURSOR-TRAILER                             00402281
004023             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)00402381
004024                 > SPACE)                                         00402481
004025               OR (PV-SUB = 1))                                   00402581
004026                SET DP030-SET-CURSOR-APPL-1 TO TRUE               00402681
004027                MOVE -1          TO MR-SELECTL (PV-SUB)           00402781
004028             END-IF                                               00402881
004029         END-IF                                                   00402981
004030*                                                                 00403081
004031         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           00403181
004034             MOVE ASC-TYP-DESC    (ASC-BLK-SUB ASC-ITEM-SUB)      00403481
004035                                 TO MR-TYPE (PV-SUB)              00403582
004036             MOVE ASC-STK-TYP-ID  (ASC-BLK-SUB ASC-ITEM-SUB)      00403681
004037                                 TO MR-STOCK (PV-SUB)             00403781
004042             MOVE ASC-COMMENT     (ASC-BLK-SUB ASC-ITEM-SUB)      00404212
004043                                 TO MR-CMMNT (PV-SUB)             00404312
004044             MOVE ASC-REPLENISH   (ASC-BLK-SUB ASC-ITEM-SUB)      00404475
004045                                 TO MR-REPL (PV-SUB)              00404575
004046             MOVE ASC-DENOMINATION-9 (ASC-BLK-SUB ASC-ITEM-SUB)   00404675
004047                                 TO MR-DENOM (PV-SUB)             00404775
004048         END-IF                                                   00404875
004049     END-IF.                                                      00404975
004050     SUBTRACT +1 FROM ASC-ITEM-SUB                                00405075
004051     IF  ASC-ITEM-SUB < + 1                                       00405175
004052         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  00405275
004053         MOVE +1                 TO ASC-BLK-SUB                   00405375
004054     END-IF.                                                      00405475
004055******************************************************************00405575
004056** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **00405675
004057** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **00405775
004058** ISSUE A WARNING.                                             **00405875
004059******************************************************************00405975
004060 4430-CHECK-FOR-BEGIN-AND-END.                                    00406075
004061     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       00406175
004062         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     00406275
004063*            -- NO END-OF-RANGE SPECFIED ---                      00406375
004064             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            00406475
004065             SET DP020-MSG-WARNING TO TRUE                        00406575
004066             PERFORM 4431-POSITION-AT-WARNING                     00406675
004067         END-IF                                                   00406775
004068     ELSE                                                         00406875
004069         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     00406975
004070*            -- NO BEGINNING-OF-RANGE SPECFIED ---                00407075
004071             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            00407175
004072             SET DP020-MSG-WARNING TO TRUE                        00407275
004073             PERFORM 4431-POSITION-AT-WARNING                     00407375
004074         END-IF                                                   00407475
004075     END-IF.                                                      00407575
004076******************************************************************00407675
004077** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **00407775
004078** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **00407875
004079** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **00407975
004080** POSITION THE CURSOR THERE.                                   **00408075
004081******************************************************************00408175
004082 4431-POSITION-AT-WARNING.                                        00408275
004083     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 00408375
004084                    - PV-TOP-ITEM + 1.                            00408475
004085     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      00408575
004086         CONTINUE                                                 00408675
004087     ELSE                                                         00408775
004088         SET DP030-SET-CURSOR-APPL-1                              00408875
004089                                   TO TRUE                        00408975
004090         MOVE -1                   TO MR-SELECTL (PV-SUB)         00409075
004091         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         00409175
004092         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         00409275
004093     END-IF.                                                      00409375
004094*                                                                 00409475
004095     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   00409575
004096                    - PV-TOP-ITEM + 1.                            00409675
004097     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      00409775
004098         CONTINUE                                                 00409875
004099     ELSE                                                         00409975
004100         SET DP030-SET-CURSOR-APPL-1                              00410075
004101                                   TO TRUE                        00410175
004102         MOVE -1                   TO MR-SELECTL (PV-SUB)         00410275
004103         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         00410375
004104         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         00410475
004105     END-IF.                                                      00410575
004106                                                                  00410692
004107*----------------------------------------------------------------*00410775
004108* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *00410875
004109* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *00410975
004110* FOR THE SELECTED ITEMS QUEUE.                                  *00411075
004111*                                                                *00411175
004112* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *00411275
004113* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *00411375
004114* THE ARRAY IS FULL.                                             *00411475
004115*----------------------------------------------------------------*00411575
004116                                                                  00411675
004117 5000-PREPARE-SEL-QUEUE.                                          00411775
004118                                                                  00411875
004119     MOVE +1                   TO  ASC-BLK-SUB.                   00411975
004120     PERFORM 5100-WRITE-TEMP-STORAGE.                             00412075
004121     ADD +1                    TO  ASC-BLK-SUB.                   00412175
004122     PERFORM 5100-WRITE-TEMP-STORAGE.                             00412275
004123                                                                  00412375
004124     MOVE ASC-SEL-QUEUE-NAME   TO  SV008-SEL-QUEUE-NAME.          00412475
004125     PERFORM 6010-DELETE-SEL-QUEUE.                               00412575
004126                                                                  00412675
004127     SET ASC-UPDATE-TSQ        TO  TRUE.                          00412775
004128                                                                  00412875
004129     SET SV009-IDX             TO  1.                             00412975
004130     MOVE ZERO                 TO SV008-NUMBER-OF-TS-ITEMS.       00413075
004131     INITIALIZE SV009-SELECTED-ITEM-ARRAY.                        00413175
004132                                                                  00413275
004133     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           00413375
004134             VARYING PV-ITEM                                      00413475
004135             FROM 1 BY 1                                          00413575
004136             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     00413675
004137                                                                  00413775
004138     IF  SV009-IDX > 1                                            00413875
004139         PERFORM 5205-WRITE-SEL-QUEUE                             00413975
004140         ADD +1                TO SV008-NUMBER-OF-TS-ITEMS        00414075
004141     END-IF.                                                      00414175
004142                                                                  00414292
004143*----------------------------------------------------------------*00414375
004144*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *00414475
004145*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *00414575
004146*----------------------------------------------------------------*00414675
004147                                                                  00414775
004148 5100-WRITE-TEMP-STORAGE.                                         00414875
004149     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     00414975
004150                                   TO PV-LIST-ITEM-NUMBER.        00415075
004151     COMPUTE PV-BLOCK-NUMBER =                                    00415175
004152         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    00415275
004153                                                                  00415375
004154     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             00415475
004155     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             00415575
004156         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      00415675
004157             PERFORM 5105-REWRITE-ASC-LISTQ                       00415775
004158         END-IF                                                   00415875
004159     ELSE                                                         00415975
004160         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       00416075
004161         ASC-HIGHEST-BLOCK-WRITTEN + 1                            00416175
004162         PERFORM 5110-WRITE-ASC-LISTQ                             00416275
004163         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   00416375
004164     END-IF.                                                      00416475
004165                                                                  00416575
004166     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             00416675
004167******************************************************************00416775
004168** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **00416875
004169** SPECIFIC COMMAREA.                                           **00416975
004170******************************************************************00417075
004171 5105-REWRITE-ASC-LISTQ.                                          00417175
004172     EXEC CICS                                                    00417275
004173         WRITEQ TS                                                00417375
004174             QUEUE (ASC-LIST-QUEUE-NAME)                          00417475
004175             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               00417575
004176             ITEM  (PV-BLOCK-NUMBER)                              00417675
004177             REWRITE                                              00417775
004178             RESP  (PV-CICS-RESP)                                 00417875
004179     END-EXEC.                                                    00417975
004180                                                                  00418075
004181     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           00418175
004182         CONTINUE                                                 00418275
004183     ELSE                                                         00418375
004184         SET DP013-CICS-ABEND            TO TRUE                  00418475
004185         SET DP013-NO-ROLLBACK           TO TRUE                  00418575
004186         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       00418675
004187         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     00418775
004188                                         TO DP013-MESSAGE-TEXT(1) 00418875
004189         PERFORM DP013-0000-PROCESS-ABEND                         00418975
004190     END-IF.                                                      00419075
004191                                                                  00419175
004192******************************************************************00419275
004193** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **00419375
004194** SPECIFIC COMMAREA.                                           **00419475
004195******************************************************************00419575
004196 5110-WRITE-ASC-LISTQ.                                            00419675
004197     EXEC CICS                                                    00419775
004198         WRITEQ TS                                                00419875
004199             QUEUE (ASC-LIST-QUEUE-NAME)                          00419975
004200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               00420075
004201             ITEM  (PV-BLOCK-NUMBER)                              00420175
004202             RESP  (PV-CICS-RESP)                                 00420275
004203     END-EXEC.                                                    00420375
004204     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      00420475
004205         SET DP013-CICS-ABEND      TO TRUE                        00420575
004206         SET DP013-NO-ROLLBACK     TO TRUE                        00420675
004207         MOVE '5110-WRITE-ASC-LISTQ'                              00420775
004208                                   TO DP013-PARAGRAPH             00420875
004209         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           00420975
004210                                   TO DP013-MESSAGE-TEXT(1)       00421075
004211         PERFORM DP013-0000-PROCESS-ABEND                         00421175
004212     END-IF.                                                      00421275
004213                                                                  00421392
004214*----------------------------------------------------------------*00421475
004215* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *00421575
004216* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *00421675
004217*----------------------------------------------------------------*00421775
004218                                                                  00421875
004219 5200-FILL-SEL-QUEUE-RECORD.                                      00421975
004220                                                                  00422075
004221     PERFORM 6112-READ-LIST-QUEUE.                                00422175
004222                                                                  00422275
004223     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       00422375
004224         PERFORM                                                  00422475
004225         VARYING LQW-IDX                                          00422575
004226         FROM 1 BY 1                                              00422675
004227         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            00422775
004228           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          00422875
004229                                                                  00422975
004230             IF  LQW-SELECT (LQW-IDX)                             00423075
004231                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              00423175
004232                                 TO SV009-ITEM (SV009-IDX)        00423275
004233                 MOVE LQW-TYPE (LQW-IDX)                          00423375
004234                                 TO SV009-CRD-TYPE-CDE            00423475
004235                                        (SV009-IDX)               00423575
004236                 MOVE LQW-STOCK (LQW-IDX)                         00423675
004237                                 TO SV009-STK-TYP-ID              00423775
004238                                        (SV009-IDX)               00423875
004239                 MOVE LQW-DENOMINATION-9 (LQW-IDX)                00423975
004240                                 TO SV009-PRE-DNNTD-AMT-9         00424075
004241                                        (SV009-IDX)               00424175
004243                 MOVE LQW-COMMENT (LQW-IDX)                       00424335
004244                                 TO SV009-COMMENT                 00424435
004245                                        (SV009-IDX)               00424535
004246                 MOVE SPACE      TO SV009-ACTION-SW (SV009-IDX)   00424635
004247                 SET SV009-IDX UP BY 1                            00424735
004248                                                                  00424835
004249                 IF  SV009-IDX > SV009-MAX-ITEMS                  00424935
004250                     PERFORM 5205-WRITE-SEL-QUEUE                 00425035
004251                     ADD +1        TO SV008-NUMBER-OF-TS-ITEMS    00425135
004252                     INITIALIZE SV009-SELECTED-ITEM-ARRAY         00425235
004253                     SET SV009-IDX TO  1                          00425335
004254                 END-IF                                           00425435
004255             END-IF                                               00425535
004256         END-PERFORM                                              00425635
004257     END-IF.                                                      00425735
004258                                                                  00425835
004259*----------------------------------------------------------------*00425935
004260*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *00426035
004261*----------------------------------------------------------------*00426135
004262                                                                  00426235
004263 5205-WRITE-SEL-QUEUE.                                            00426335
004264                                                                  00426435
004265     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            00426535
004266                                   TO SV009-SELECTED-ITEMS.       00426635
004267                                                                  00426735
004268     EXEC CICS                                                    00426835
004269          WRITEQ TS                                               00426935
004270              QUEUE (ASC-SEL-QUEUE-NAME)                          00427035
004271              FROM  (SV009-SEL-REC)                               00427135
004272              ITEM  (PV-SEL-QUEUE-ITEM)                           00427235
004273              RESP  (PV-CICS-RESP)                                00427335
004274     END-EXEC.                                                    00427435
004275                                                                  00427535
004276     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          00427635
004277         CONTINUE                                                 00427735
004278     ELSE                                                         00427835
004279         SET DP013-CICS-ABEND      TO TRUE                        00427935
004280         SET DP013-NO-ROLLBACK     TO TRUE                        00428035
004281         MOVE '5205-WRITE-SEL-QUEUE'                              00428135
004282                                   TO DP013-PARAGRAPH             00428235
004283         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          00428335
004284                                   TO DP013-MESSAGE-TEXT(1)       00428435
004285         PERFORM DP013-0000-PROCESS-ABEND                         00428535
004286     END-IF.                                                      00428635
004287                                                                  00428792
004288******************************************************************00428835
004289** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **00428935
004290** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **00429035
004291** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **00429135
004292** THE USER.                                                    **00429235
004293******************************************************************00429335
004294 6000-REFRESH-PANEL-FROM-TEMP.                                    00429435
004295     IF  ASC-UPDATE-TSQ                                           00429535
004296         SET ASC-NO-TSQ-UPDATE TO TRUE                            00429635
004297         MOVE ZERO                 TO PV-SAVE-ITEM                00429735
004298                                      PV-SEL-QUEUE-ITEM           00429835
004299         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        00429935
004300                                   TO PV-HOLD-SELECTED-ITEMS      00430035
004301         MOVE +1                   TO PV-ITEMS-PROCESSED          00430135
004302         PERFORM 6100-UPDATE-TSQ                                  00430235
004303             UNTIL PV-ITEMS-PROCESSED >                           00430335
004304                                     PV-HOLD-SELECTED-ITEMS       00430435
004305         PERFORM 6010-DELETE-SEL-QUEUE                            00430535
004306         INITIALIZE ASC-BLOCK-ENTRIES (1)                         00430635
004307                    ASC-BLOCK-ENTRIES (2)                         00430735
004308     END-IF.                                                      00430835
004309                                                                  00430935
004310*----------------------------------------------------------------*00431035
004311*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *00431135
004312*----------------------------------------------------------------*00431235
004313 6010-DELETE-SEL-QUEUE.                                           00431335
004314                                                                  00431435
004315     EXEC CICS                                                    00431535
004316         DELETEQ TS                                               00431635
004317             QUEUE (ASC-SEL-QUEUE-NAME)                           00431735
004318             RESP  (PV-CICS-RESP)                                 00431835
004319     END-EXEC.                                                    00431935
004320*                                                                 00432035
004321     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      00432135
004322        (PV-CICS-RESP = DFHRESP(QIDERR)))                         00432235
004323         CONTINUE                                                 00432335
004324     ELSE                                                         00432435
004325         SET DP013-CICS-ABEND TO TRUE                             00432535
004326         SET DP013-NO-ROLLBACK TO TRUE                            00432635
004327         MOVE '6010-DELETE-SEL-QUEUE'                             00432735
004328                        TO DP013-PARAGRAPH                        00432835
004329         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         00432935
004330                        TO DP013-MESSAGE-TEXT (1)                 00433035
004331         PERFORM DP013-0000-PROCESS-ABEND                         00433135
004332     END-IF.                                                      00433235
004333                                                                  00433335
004334*----------------------------------------------------------------*00433435
004335*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *00433535
004336*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *00433635
004337*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *00433735
004338*    THE TEMP QUEUE.                                             *00433835
004339*----------------------------------------------------------------*00433935
004340                                                                  00434035
004341 6100-UPDATE-TSQ.                                                 00434135
004342                                                                  00434235
004343     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             00434335
004344     PERFORM 6105-READ-SEL-QUEUE.                                 00434435
004345     PERFORM                                                      00434535
004346         VARYING SV009-IDX                                        00434635
004347         FROM 1 BY 1                                              00434735
004348         UNTIL ((PV-ITEMS-PROCESSED >                             00434835
004349                              PV-HOLD-SELECTED-ITEMS)             00434935
004350         OR (SV009-IDX GREATER THAN SV009-MAX-ITEMS))             00435035
004351         IF  SV009-ACTION-SW (SV009-IDX) > SPACE                  00435135
004352             PERFORM 6110-PROCESS-ITEMS                           00435235
004353         END-IF                                                   00435335
004354         ADD +1                TO PV-ITEMS-PROCESSED              00435435
004355     END-PERFORM.                                                 00435535
004356     PERFORM 6111-WRITE-LIST-QUEUE.                               00435635
004357*----------------------------------------------------------------*00435735
004358*    READ THE LIST QUEUE RECORD.                                 *00435835
004359*----------------------------------------------------------------*00435935
004360                                                                  00436035
004361 6105-READ-SEL-QUEUE.                                             00436135
004362                                                                  00436235
004363     EXEC CICS                                                    00436335
004364          READQ TS                                                00436435
004365              QUEUE (ASC-SEL-QUEUE-NAME)                          00436535
004366              INTO  (SV009-SEL-REC)                               00436635
004367              ITEM  (PV-SEL-QUEUE-ITEM)                           00436735
004368              RESP  (PV-CICS-RESP)                                00436835
004369     END-EXEC.                                                    00436935
004370*                                                                 00437035
004371     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          00437135
004372         CONTINUE                                                 00437235
004373     ELSE                                                         00437335
004374         SET DP013-CICS-ABEND      TO  TRUE                       00437435
004375         SET DP013-NO-ROLLBACK     TO  TRUE                       00437535
004376         MOVE '6105-READ-SEL-QUEUE'                               00437635
004377                                   TO  DP013-PARAGRAPH            00437735
004378         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           00437835
004379                                   TO  DP013-MESSAGE-TEXT(1)      00437935
004380         PERFORM DP013-0000-PROCESS-ABEND                         00438035
004381     END-IF.                                                      00438135
004382                                                                  00438292
004383*----------------------------------------------------------------*00438335
004384*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*00438435
004385*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*00438535
004386*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *00438635
004387*----------------------------------------------------------------*00438735
004388                                                                  00438835
004389 6110-PROCESS-ITEMS.                                              00438935
004390                                                                  00439035
004391     COMPUTE PV-ITEM = 1 + ((SV009-ITEM (SV009-IDX) - 1)          00439135
004392                     / PC-ITEMS-PER-PANEL).                       00439235
004393                                                                  00439335
004394     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           00439435
004395         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          00439535
004396             PERFORM 6111-WRITE-LIST-QUEUE                        00439635
004397         END-IF                                                   00439735
004398         MOVE PV-ITEM          TO PV-SAVE-ITEM                    00439835
004399                                                                  00439935
004400         PERFORM 6112-READ-LIST-QUEUE                             00440035
004401         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               00440135
004402             CONTINUE                                             00440235
004403         END-IF                                                   00440335
004404     END-IF.                                                      00440435
004405                                                                  00440535
004406     COMPUTE PV-SUB = (SV009-ITEM (SV009-IDX)                     00440635
004407                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              00440735
004408     SET LQW-DESELECT (PV-SUB) TO    TRUE                         00440835
004409     MOVE LQW-SELECTED-SW (PV-SUB)                                00440935
004410                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  00441035
004411                                                                  00441135
004412     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                00441235
004413                                                                  00441335
004414*----------------------------------------------------------------*00441435
004415*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *00441535
004416*----------------------------------------------------------------*00441635
004417                                                                  00441735
004418 6111-WRITE-LIST-QUEUE.                                           00441835
004419                                                                  00441935
004420     EXEC CICS                                                    00442035
004421         WRITEQ TS                                                00442135
004422             QUEUE (ASC-LIST-QUEUE-NAME)                          00442235
004423             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     00442335
004424             ITEM  (PV-SAVE-ITEM)                                 00442435
004425             REWRITE                                              00442535
004426             RESP  (PV-CICS-RESP)                                 00442635
004427     END-EXEC.                                                    00442735
004428*                                                                 00442835
004429     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          00442935
004430         CONTINUE                                                 00443035
004431     ELSE                                                         00443135
004432         SET DP013-CICS-ABEND  TO  TRUE                           00443235
004433         SET DP013-NO-ROLLBACK TO  TRUE                           00443335
004434         MOVE '6111-WRITE-LIST-QUEUE'                             00443435
004435                               TO  DP013-PARAGRAPH                00443535
004436         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  00443635
004437                               TO  DP013-MESSAGE-TEXT(1)          00443735
004438         PERFORM DP013-0000-PROCESS-ABEND                         00443835
004439     END-IF.                                                      00443935
004440                                                                  00444035
004442*----------------------------------------------------------------*00444235
004443*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*00444335
004444*----------------------------------------------------------------*00444435
004445                                                                  00444535
004446 6112-READ-LIST-QUEUE.                                            00444635
004447                                                                  00444735
004448     EXEC CICS                                                    00444835
004449         READQ TS                                                 00444935
004450             QUEUE (ASC-LIST-QUEUE-NAME)                          00445035
004451             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     00445135
004452             ITEM  (PV-ITEM)                                      00445235
004453             RESP  (PV-CICS-RESP)                                 00445335
004454     END-EXEC.                                                    00445435
004455*                                                                 00445535
004456     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          00445635
004457         CONTINUE                                                 00445735
004458     ELSE                                                         00445835
004459         SET DP013-CICS-ABEND        TO TRUE                      00445935
004460         SET DP013-NO-ROLLBACK       TO TRUE                      00446035
004461         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           00446135
004462         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    00446235
004463                                     TO DP013-MESSAGE-TEXT(1)     00446335
004464         PERFORM DP013-0000-PROCESS-ABEND                         00446435
004465     END-IF.                                                      00446535
004466                                                                  00446635
004468*----------------------------------------------------------------*00446835
004469*    ABEND PROCESSOR MODULE                                      *00446935
004470*----------------------------------------------------------------*00447035
004471                                                                  00447135
004480     COPY DPPD013.                                                00448012
