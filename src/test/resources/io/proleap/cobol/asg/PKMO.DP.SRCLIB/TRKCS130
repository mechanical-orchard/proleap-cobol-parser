000100 PROCESS CICS                                                     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID. TRKCS130.                                            00030000
000400 AUTHOR. BRENDA ROCKWELL.                                         00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  08-23-2017.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800***************************************************************** 00080000
000900* *                                                               00090000
001000* COUPLE OF POINTS ABOUT THIS PROGRAM:                            00100000
001100* 1) THIS PROGRAM IS A HEADER PROCESSING PROGRAM.                 00110000
001200* 2) THIS PROGRAM WOULD BE CONFIGURED IN A PIPELINE (BOTH REQUEST 00120000
001300*    AND PROVIDER PIPELINES)                                      00130000
001400* 3) THIS ACTS AS A COMMUNICATION ADAPTER FOR KOHL'S              00140000
001500*                                                                 00150000
001600* SPECIAL NOTE:                                                   00160000
001700*--------------                                                   00170000
001800* 1) CURRENT PROGRAM ACCESSES A VSAM FILE BY NAME 'TRCACNFG'.     00180000
001900*    THIS NAME IS STORED IN VARIABLE PV-VSAM-FILE-NM.             00190000
002000*    UPDATE THIS VARIABLE PV-VSAM-FILE-NM WHEN A DIFFERENT        00200000
002100*    CONFIG FILE NEEDS TO BE USED FOR A DIFFERENT VERSION OF CA   00210000
002200* 2) IF THE CA VERSION NUMBER NEEDS TO BE CHANGED, THEN CHANGE    00220000
002300*    VALUE OF THE VARIABLE PV-LITERAL-KMH-VER. AS OF NOW, THIS IS 00230000
002400*    SET TO BE '1.0'. ALL INCOMING KMH NEED TO HAVE VERSION NUMBER00240000
002500*    IN KMH MATCHING WITH THIS VALUE.                             00250000
002600* 3) AMEND VALUE IN PV-HDR-APP-ID AS PER THE APPLICATION UNDER IT 00260000
002700*    IS RUNNING.                                                  00270000
002800* 4) CURRENT PROGRAM ACCESSES A DB2 TABLE DBT_WEB_SRVC_HDR_LOG FOR00280000
002900*    LOGGING THE KMH IN JSON FORMAT. CHANGE THIS NAME IF A        00290000
003000*    DIFFERENT TABLE NAME NEEDS TO BE USED FOR A DIFFERENT        00300000
003100*    APPLICATION.                                                 00310000
003200* 5) SOME LINES ARE ADDED FOR TESTING PURPOSE. THEY HAVE BEEN     00320000
003300*    TAGGED WTIH DELDSP* DO NOT DELETE THEM. WHEN NOT NEEDED,     00330000
003400*    JUST REPLACE 'DELDSP ' WITH 'DELDSP*'. THIS WILL COMMENT OUT 00340000
003500*    THESE LINES. IF NEEDED THEY CAN EASILY BE RESTORED FOR TESTIN00350000
003600*    COMMAND: C ALL 'DELDSP*' 'DELDSP'                            00360000
003700*             --------------------                                00370000
003800******************************************************************00380000
003900 ENVIRONMENT DIVISION.                                            00390000
004000 CONFIGURATION SECTION.                                           00400000
004100 SPECIAL-NAMES.                                                   00410000
004200 DATA DIVISION.                                                   00420000
004300                                                                  00430000
004400 WORKING-STORAGE SECTION.                                         00440000
004500 01  PV-PROGRAM-CONSTANTS.                                        00450000
004600     05 PV-MSGID-MF-LITERAL        PIC X(2) VALUE 'MF'.           00460000
004700                                                                  00470000
004800 01  PS-PROGRAM-SWITCHES.                                         00480000
004810                                                                  00481002
004820     05 PS-DISPLAY-MSG-SW          PIC X(1) VALUE 'N'.            00482002
004830        88 PS-DISPLAY-MSG-YES               VALUE 'Y'.            00483002
004840        88 PS-DISPLAY-MSG-NO                VALUE 'N'.            00484002
004850                                                                  00485002
004900     05 PS-FUNC-VALID-SW           PIC X(2).                      00490000
005000        88 PS-FUNC-REC-REQ         VALUE 'RR'.                    00500000
005100        88 PS-FUNC-REC-RESP        VALUE 'RS'.                    00510000
005200        88 PS-FUNC-SEND-REQ        VALUE 'SR'.                    00520000
005300        88 PS-FUNC-SEND-RESP       VALUE 'SS'.                    00530000
005400        88 PS-SKIP-FUNCTION        VALUE 'NN'.                    00540000
005500        88 PS-VALID-FUNCTION       VALUE 'RR',                    00550000
005600                                         'RS',                    00560000
005700                                         'SR',                    00570000
005800                                         'SS'.                    00580000
005900     05 PS-PROC-KMHPREM-SW         PIC X(1).                      00590000
006000        88 PS-PROC-KMHPREM         VALUE 'Y'.                     00600000
006100        88 PS-PROC-KMHPREM-FALSE   VALUE 'N'.                     00610000
006200     05 PS-RETRIEVE-KMH-SW         PIC X(1).                      00620000
006300        88 PS-RETR-NO-ERROR        VALUE 'N'.                     00630000
006400        88 PS-RETR-ERROR           VALUE 'Y'.                     00640000
006500     05 PS-LOOP-SW                 PIC X(1).                      00650000
006600        88 PS-BREAK-THE-LOOP       VALUE 'N'.                     00660000
006700        88 PS-CONT-THE-LOOP        VALUE 'Y'.                     00670000
006800     05 PS-LOOP-SW1                PIC X(1).                      00680000
006900        88 PS-BREAK-THE-LOOP1      VALUE 'N'.                     00690000
007000        88 PS-CONT-THE-LOOP1       VALUE 'Y'.                     00700000
007100     05 PS-LOOP-SW2                PIC X(1).                      00710000
007200        88 PS-BREAK-THE-LOOP2      VALUE 'N'.                     00720000
007300        88 PS-CONT-THE-LOOP2       VALUE 'Y'.                     00730000
007400     05 PS-IN-MSG-FLDS             PIC X(1).                      00740000
007500        88 PS-IN-MSG-FLDS-MSGID    VALUE 'M'.                     00750000
007600        88 PS-IN-MSG-FLDS-CORRID   VALUE 'C'.                     00760000
007700        88 PS-IN-MSG-FLDS-FROM     VALUE 'F'.                     00770000
007800        88 PS-IN-MSG-FLDS-CRDT     VALUE 'T'.                     00780000
007900        88 PS-IN-MSG-FLDS-EXDT     VALUE 'E'.                     00790000
008000        88 PS-IN-MSG-FLDS-NO       VALUE 'N'.                     00800000
008100     05 PS-IN-MSG-EXDT-SW          PIC X(1).                      00810000
008200        88 PS-IN-MSG-EXDT-Y        VALUE 'Y'.                     00820000
008300        88 PS-IN-MSG-EXDT-N        VALUE 'N'.                     00830000
008400     05 PS-IN-MSG-FRM              PIC X(1).                      00840000
008500        88 PS-IN-MSG-FRM-YES       VALUE 'Y'.                     00850000
008600        88 PS-IN-MSG-FRM-NO        VALUE 'N'.                     00860000
008700     05 PS-IN-MSG-INRPT-SW         PIC X(1).                      00870000
008800        88 PS-IN-MSG-INRPT-Y       VALUE 'Y'.                     00880000
008900        88 PS-IN-MSG-INRPT-N       VALUE 'N'.                     00890000
009000        88 PS-IN-MSG-INRPT-D       VALUE 'D'.                     00900000
009100     05 PS-IN-MSG-FAULT-SW         PIC X(1).                      00910000
009200        88 PS-IN-MSG-FAULT-Y       VALUE 'Y'.                     00920000
009300        88 PS-IN-MSG-FAULT-C       VALUE 'C'.                     00930000
009400        88 PS-IN-MSG-FAULT-D       VALUE 'D'.                     00940000
009500        88 PS-IN-MSG-FAULT-F       VALUE 'F'.                     00950000
009600        88 PS-IN-MSG-FAULT-N       VALUE 'N'.                     00960000
009700     05 PS-IN-SYS-CD               PIC X(1).                      00970000
009800        88 PS-IN-SYS-CD-YES        VALUE 'Y'.                     00980000
009900        88 PS-IN-SYS-CD-NO         VALUE 'N'.                     00990000
010000     05 PS-IN-APP-CD               PIC X(1).                      01000000
010100        88 PS-IN-APP-CD-YES        VALUE 'Y'.                     01010000
010200        88 PS-IN-APP-CD-NO         VALUE 'N'.                     01020000
010300     05 PS-IN-MOD-CD               PIC X(1).                      01030000
010400        88 PS-IN-MOD-CD-YES        VALUE 'Y'.                     01040000
010500        88 PS-IN-MOD-CD-NO         VALUE 'N'.                     01050000
010600     05 PS-IN-NOD-ID               PIC X(1).                      01060000
010700        88 PS-IN-NOD-ID-YES        VALUE 'Y'.                     01070000
010800        88 PS-IN-NOD-ID-NO         VALUE 'N'.                     01080000
010900     05 PS-MANDATE-SW              PIC X(1).                      01090000
011000        88 PS-VALIDATE-PASS        VALUE 'Y'.                     01100000
011100        88 PS-VALIDATE-FAIL        VALUE 'N'.                     01110000
011200     05 PS-SOAP-LEVEL              PIC S9(8) COMP-4.              01120000
011300        88 PS-SOAP-11              VALUE 1.                       01130000
011400        88 PS-SOAP-12              VALUE 2.                       01140000
011500        88 PS-NOT-SOAP             VALUE 10.                      01150000
011600     05 PS-FROM-SW                 PIC X(1).                      01160000
011700        88 PS-FROM-NOT-MANDATE     VALUE 'N'.                     01170000
011800        88 PS-FROM-MANDATE         VALUE 'Y'.                     01180000
011900     05 PS-EXDT-SW                 PIC X(1).                      01190000
012000        88 PS-EXDT-NT-NEED         VALUE 'N'.                     01200000
012100        88 PS-EXDT-NEED            VALUE 'Y'.                     01210000
012200     05 PS-ACT-SW                  PIC X(1).                      01220000
012300        88 PS-ACT-NT-NEED          VALUE 'N'.                     01230000
012400        88 PS-ACT-NEED             VALUE 'Y'.                     01240000
012500     05 PS-TO-SW                   PIC X(1).                      01250000
012600        88 PS-TO-NT-NEED           VALUE 'N'.                     01260000
012700        88 PS-TO-NEED              VALUE 'Y'.                     01270000
012800     05 PS-RKEYS-SW                PIC X(1).                      01280000
012900        88 PS-RKEYS-NT-NEED        VALUE 'N'.                     01290000
013000        88 PS-RKEYS-NEED           VALUE 'Y'.                     01300000
013100     05 PS-CORID-SW                PIC X(1).                      01310000
013200        88 PS-CORID-NT-NEED        VALUE 'N'.                     01320000
013300        88 PS-CORID-NEED           VALUE 'Y'.                     01330000
013400     05 PS-FAULT-SW                PIC X(1).                      01340000
013500        88 PS-FAULT-NT-NEED        VALUE 'N'.                     01350000
013600        88 PS-FAULT-NEED           VALUE 'Y'.                     01360000
013700     05 PS-FROM-SW                 PIC X(1).                      01370000
013800        88 PS-FROM-NT-NEED         VALUE 'N'.                     01380000
013900        88 PS-FROM-NEED            VALUE 'Y'.                     01390000
014000     05 PS-MSGID-SW                PIC X(1).                      01400000
014100        88 PS-MSGID-NT-NEED        VALUE 'N'.                     01410000
014200        88 PS-MSGID-NEED           VALUE 'Y'.                     01420000
014300     05 PS-CRDATM-SW               PIC X(1).                      01430000
014400        88 PS-CRDATM-NT-NEED       VALUE 'N'.                     01440000
014500        88 SV-CRDATM-NEED          VALUE 'Y'.                     01450000
014600     05 PS-INRPTO-SW               PIC X(1).                      01460000
014700        88 PS-INRPTO-NT-NEED       VALUE 'N'.                     01470000
014800        88 PS-INRPTO-NEED          VALUE 'Y'.                     01480000
014900     05 PS-IN-KMH-VER-SW           PIC X(1).                      01490000
015000        88 PS-INKMH-VER-N          VALUE 'N'.                     01500000
015100        88 PS-INKMH-VER-Y          VALUE 'Y'.                     01510000
015200                                                                  01520000
015300 01  PV-PROGRAM-VARIABLES.                                        01530000
015400* THE FOLLOWING VARIABLES ARE FOR BUILDING KOHL'S MESSAGE HEADER  01540000
015500     05 PV-NEW-KMH-MSG-HDR-1.                                     01550000
015600        10 FILLER                  PIC X(74) VALUE                01560000
015700     '<MessageHeader xmlns="urn:kohls:xml:schemas:message-header:v01570000
015800-    '1_0" version="'.                                            01580000
015900        10 PV-NEW-KMH-VER          PIC X(3)  VALUE SPACES.        01590000
016000        10 FILLER                  PIC X(2)  VALUE '">'.          01600000
016100     05 PV-NEW-KMH-MSG-ID.                                        01610000
016200        10 FILLER                  PIC X(11) VALUE '<MessageID>'. 01620000
016300        10 PV-KMH-MSG-ID           PIC X(36) VALUE SPACES.        01630000
016400        10 FILLER                  PIC X(12) VALUE '</MessageID>'.01640000
016500     05 PV-NEW-KMH-CDT.                                           01650000
016600        10 FILLER                  PIC X(16) VALUE                01660000
016700                                             '<CreateDateTime>'.  01670000
016800        10 PV-KMH-CDATIME          PIC X(24) VALUE SPACES.        01680000
016900        10 FILLER                  PIC X(17) VALUE                01690000
017000                                             '</CreateDateTime>'. 01700000
017100     05 PV-NEW-KMH-FROM.                                          01710000
017200        10 FILLER                  PIC X(18) VALUE                01720000
017300                                             '<From systemCode="'.01730000
017400        10 PV-KMH-SYS-CD.                                         01740000
017500           15 FILLER               PIC X OCCURS 15 DEPENDING ON   01750000
017600                                   PV-SYS-CD-LEN.                 01760000
017700        10 PV-FILLER-APP           PIC X(7).                      01770000
017800        10 PV-KMH-APP-CD.                                         01780000
017900           15 FILLER               PIC X OCCURS 15 DEPENDING ON   01790000
018000                                   PV-APP-CD-LEN.                 01800000
018100        10 PV-FILLER-MOD           PIC X(10).                     01810000
018200        10 PV-KMH-MODULE.                                         01820000
018300           15 FILLER               PIC X OCCURS 15 DEPENDING ON   01830000
018400                                   PV-MOD-CD-LEN.                 01840000
018500        10 PV-FILLER-NOD           PIC X(10).                     01850000
018600        10 PV-KMH-NODEID.                                         01860000
018700           15 FILLER               PIC X OCCURS 10 DEPENDING ON   01870000
018800                                   PV-NOD-ID-LEN.                 01880000
018900        10 PV-FILLER-EOF           PIC X(4).                      01890000
019000                                                                  01900000
019100 01  PV-MORE-PROGRAM-VARIABLES.                                   01910000
019200     05 PV-NEW-KMH-INRP-TO.                                       01920000
019300        10 FILLER                  PIC X(11) VALUE '<InReplyTo>'. 01930000
019400        10 PV-KMH-IRP-TO           PIC X(36) VALUE SPACES.        01940000
019500        10 FILLER                  PIC X(12) VALUE '</InReplyTo>'.01950000
019600     05 PV-NEW-KMH-CORID.                                         01960000
019700        10 FILLER                  PIC X(15) VALUE                01970000
019800                                             '<CorrelationID>'.   01980000
019900        10 PV-KMH-CORRL-ID         PIC X(36) VALUE SPACES.        01990000
020000        10 FILLER                  PIC X(21) VALUE                02000000
020100                                             '</CorrelationID>'.  02010000
020200     05 PV-NEW-KMH-EDT.                                           02020000
020300        10 FILLER                  PIC X(16) VALUE                02030000
020400                                             '<ExpiryDateTime>'.  02040000
020500        10 PV-KMH-EDATIME          PIC X(24) VALUE SPACES.        02050000
020600        10 FILLER                  PIC X(17) VALUE                02060000
020700                                             '</ExpiryDateTime>'. 02070000
020800     05 PV-NEW-KMH-ACTION.                                        02080000
020900        10 FILLER                  PIC X(8)  VALUE '<Action>'.    02090000
021000        10 PV-KMH-ACTION           PIC X(25) VALUE SPACES.        02100000
021100        10 FILLER                  PIC X(9)  VALUE '</Action>'.   02110000
021200     05 PV-NEW-KMH-TO-1.                                          02120000
021300        10 FILLER                  PIC X(4)  VALUE '<To>'.        02130000
021400     05 PV-NEW-KMH-TO-ADR.                                        02140000
021500        10 FILLER                  PIC X(9)  VALUE '<Address>'.   02150000
021600        10 PV-KMH-TO-ADR           PIC X(80) VALUE SPACES.        02160000
021700        10 FILLER                  PIC X(10) VALUE '</Address>'.  02170000
021800     05 PV-NEW-KMH-TO-ACT.                                        02180000
021900        10 FILLER                  PIC X(8)  VALUE '<Action>'.    02190000
022000        10 PV-KMH-TO-ACT           PIC X(25) VALUE SPACES.        02200000
022100        10 FILLER                  PIC X(9)  VALUE '</Action>'.   02210000
022200     05 PV-NEW-KMH-PARM-1.                                        02220000
022300        10 FILLER                  PIC X(12) VALUE '<Parameters>'.02230000
022400     05 PV-NEW-KMH-TO-PARM1.                                      02240000
022500        10 FILLER                  PIC X(17) VALUE                02250000
022600                                             '<Parameter name="'. 02260000
022700        10 PV-KMH-TO-PARMNM1       PIC X(10) VALUE 'PARM1'.       02270000
022800        10 FILLER                  PIC X(2)  VALUE '">'.          02280000
022900        10 PV-KMH-TO-PARMVAL1      PIC X(25) VALUE SPACES.        02290000
023000        10 FILLER                  PIC X(12) VALUE '</Parameter>'.02300000
023100     05 PV-NEW-KMH-TO-PARM2.                                      02310000
023200        10 FILLER                  PIC X(17) VALUE                02320000
023300                                             '<Parameter name="'. 02330000
023400        10 PV-KMH-TO-PARMNM2       PIC X(10) VALUE 'PARM2'.       02340000
023500        10 FILLER                  PIC X(2)  VALUE '">'.          02350000
023600        10 PV-KMH-TO-PARMVAL2      PIC X(25) VALUE SPACES.        02360000
023700        10 FILLER                  PIC X(12) VALUE '</Parameter>'.02370000
023800     05 PV-NEW-KMH-PARM-2.                                        02380000
023900        10 FILLER                  PIC X(13) VALUE                02390000
024000                                             '</Parameters>'.     02400000
024100     05 PV-NEW-KMH-TO-2.                                          02410000
024200        10 FILLER                  PIC X(5)  VALUE '</To>'.       02420000
024300     05 PV-NEW-KMH-RKEYS.                                         02430000
024400        10 FILLER                  PIC X(38) VALUE                02440000
024500                        '<RoutingKeys><RoutingKey name="store">'. 02450000
024600        10 PV-KMH-RKEYS-VAL        PIC X(25) VALUE SPACES.        02460000
024700        10 FILLER                  PIC X(14) VALUE                02470000
024800                                             '</RoutingKey>'.     02480000
024900        10 FILLER                  PIC X(14) VALUE                02490000
025000                                             '</RoutingKeys>'.    02500000
025100     05 PV-NEW-KMH-FAULT.                                         02510000
025200        10 FILLER                  PIC X(7)  VALUE '<Fault>'.     02520000
025300        10 FILLER                  PIC X(6)  VALUE '<Code>'.      02530000
025400        10 PV-KMH-FAULT-CD         PIC X(26) VALUE                02540000
025500           'BAD MESSAGE HEADER ELEMENT'.                          02550000
025600        10 FILLER                  PIC X(7)  VALUE '</Code>'.     02560000
025700        10 FILLER                  PIC X(13) VALUE                02570000
025800                                             '<Description>'.     02580000
025900        10 PV-KMH-FAULT-MSG        PIC X(255) VALUE SPACES.       02590000
026000        10 FILLER                  PIC X(14) VALUE                02600000
026100                                             '</Description>'.    02610000
026200        10 FILLER                  PIC X(14) VALUE '</Fault>'.    02620000
026300     05 PV-NEW-KMH-MSG-HDR-2.                                     02630000
026400        10 FILLER                  PIC X(16) VALUE                02640000
026500                                             '</MessageHeader>'.  02650000
026600     05 PV-HEAD-PTR                USAGE IS POINTER.              02660000
026700     05 PV-URI-PTR                 USAGE IS POINTER.              02670000
026800     05 PV-URI-LEN                 PIC S9(8) COMP-4.              02680000
026900     05 PV-TRANID-LEN              PIC S9(8) BINARY.              02690000
027000     05 PV-CONT-LEN                PIC S9(8) COMP-4 VALUE 16.     02700000
027100     05 PV-CONT-LEN-DISP           PIC 9(8).                      02710000
027200     05 PV-PIPE-LEN                PIC S9(8) COMP-4 VALUE 16.     02720000
027300     05 PV-GETMAIN-LEN             PIC S9(8) COMP-4.              02730000
027400     05 PV-RETR-KMH-LEN            PIC S9(8) COMP-4.              02740000
027500     05 PV-GETMAIN-PTR             USAGE IS POINTER.              02750000
027600     05 PV-RESP                    PIC S9(8) COMP-5 SYNC.         02760000
027700     05 PV-RESP2                   PIC S9(8) COMP-5 SYNC.         02770000
027800     05 PV-SYS-CD-LEN              PIC S9(8) COMP-4.              02780000
027900     05 PV-APP-CD-LEN              PIC S9(8) COMP-4.              02790000
028000     05 PV-MOD-CD-LEN              PIC S9(8) COMP-4.              02800000
028100     05 PV-NOD-ID-LEN              PIC S9(8) COMP-4.              02810000
028200     05 PV-FLT-DS-LEN              PIC S9(8) COMP-4.              02820000
028300     05 PV-FLT-CD-LEN              PIC S9(8) COMP-4.              02830000
028400     05 PV-RESP-DISP               PIC 9(8).                      02840000
028500     05 PV-XML-CODE-DISP           PIC 9(8).                      02850000
028600     05 PV-RESP2-DISP              PIC 9(8).                      02860000
028700     05 PV-SQLCODE-DISP            PIC 9(9).                      02870000
028800     05 PV-WEBS-LEN                PIC S9(8) COMP-4 VALUE 30.     02880000
028900     05 PV-FUNC-LEN                PIC S9(8) COMP-4 VALUE 16.     02890000
029000     05 PV-RECORD-LENGTH-300       PIC S9(4) COMP VALUE 300.      02900000
029100     05 PV-WEBS-AREA               PIC X(30).                     02910000
029200     05 PV-DEFAULT-WEBS            PIC X(30) VALUE 'DEFAULT'.     02920000
029300     05 PV-LITERAL-KMH-VER         PIC X(3) VALUE '1.0'.          02930000
029400     05 PV-FUNC-AREA               PIC X(30).                     02940000
029500     05 PV-VALIDATE-DTM            PIC X(24).                     02950000
029600     05 PV-TRAN-ID                 PIC X(4).                      02960000
029700* UPDATE THIS VARIABLE PV-VSAM-FILE-NM WHEN A DIFFERENT           02970000
029800* CONFIG FILE NEEDS TO BE USED                                    02980000
029900     05 PV-VSAM-FILE-NM            PIC X(8)  VALUE 'TRCACNFG'.    02990000
030000* UPDATE THIS VARIABLE PV-HDR-APP-ID WHEN A DIFFERENT APP         03000000
030100* IS USING THIS PROGRAM                                           03010000
030200     05 PV-HDR-APP-ID              PIC X(2) VALUE 'TR'.           03020000
030300     05 PV-HEADER-LOG-MSG          PIC X(2000) VALUE SPACES.      03030000
030400     05 PV-SPOOL-LOG-MSG           PIC X(400).                    03040000
030500     05 PV-TEMP-LOG-MSG            PIC X(400).                    03050000
030600     05 PV-RUNNING-KMH             PIC X(2000).                   03060000
030700     05 PV-KMH-HEADER-FINAL        PIC X(2000).                   03070000
030800     05 PV-KMH-TO-ELE-STRNG        PIC X(500).                    03080000
030900*    05 PV-TCP-IP-INFO             PIC X(15).                     03090000
031000     05 PV-HOST-NAME               PIC X(30).                     03100000
031100     05 PV-EZACICAL                PIC X(08) VALUE 'EZACICAL'.    03110000
031200     05 PV-EZ-TOKEN                PIC X(16).                     03120000
031300     05 PV-EZ-COMMAND              PIC 9(04) BINARY.              03130000
031400     05 PV-EZ-HZERO                PIC 9(04) BINARY.              03140000
031500     05 PV-EZ-DZERO                PIC X(08).                     03150000
031600     05 PV-EZ-NAMELEN              PIC 9(08) BINARY.              03160000
031700     05 PV-EZ-NAME                 PIC X(30).                     03170000
031800     05 PV-EZ-ERRNO                PIC 9(08) BINARY.              03180000
031900     05 PV-EZ-RETCODE              PIC 9(08) BINARY.              03190000
032000     05 PV-EZ-RETCODE2             PIC 9(08).                     03200000
032100     05 PV-STOR-IRP-TO             PIC X(36).                     03210000
032200     05 PV-STOR-CORR-ID            PIC X(36).                     03220000
032300     05 PV-STOR-KMH-VER            PIC X(3).                      03230000
032400     05 PV-IN-MSG-MSGID            PIC X(36).                     03240000
032500     05 PV-IN-MSG-CORRID           PIC X(36).                     03250000
032600     05 PV-IN-MSG-INRPTO           PIC X(36).                     03260000
032700     05 PV-IN-MSG-CRDT             PIC X(24).                     03270000
032800     05 PV-IN-MSG-EXDT             PIC X(24).                     03280000
032900     05 PV-IN-MSG-SYSCD            PIC X(36).                     03290000
033000     05 PV-IN-MSG-APPCD            PIC X(36).                     03300000
033100     05 PV-IN-MSG-MODCD            PIC X(36).                     03310000
033200     05 PV-IN-MSG-NODID            PIC X(36).                     03320000
033300     05 PV-IN-MSG-FAULT-CD         PIC X(40).                     03330000
033400     05 PV-IN-MSG-FAULT-DES        PIC X(200).                    03340000
033500     05 PV-NEW-SYSTEM-CD           PIC X(30).                     03350000
033600     05 PV-NEW-APP                 PIC X(30).                     03360000
033700     05 PV-NEW-MODULE              PIC X(30).                     03370000
033800     05 PV-NEW-NODEID              PIC X(30).                     03380000
033900     05 PV-NEW-ACTION-ELE          PIC X(30).                     03390000
034000     05 PV-NEW-RKEYS-ELE           PIC X(30).                     03400000
034100     05 PV-OFFSET-CHAR             PIC X(10).                     03410000
034200     05 PV-OFFSET-CHAR2            PIC X(10).                     03420000
034300     05 PV-OFFSET-NBR              PIC 9(10).                     03430000
034400     05 PV-CICS-MSG-AREA           PIC X(80) VALUE SPACE.         03440000
034500     05 PV-NBR-M-ELEMENTS          PIC 9(2).                      03450000
034600     05 PV-NBR-O-ELEMENTS          PIC 9(2).                      03460000
034700     05 PV-NBR-TO-ELEMENTS         PIC 9(2).                      03470000
034800     05 PV-STRING-PTR-1            PIC 9(3).                      03480000
034900     05 PV-STRING-PTR-2            PIC 9(3).                      03490000
035000     05 PV-STRING-PTR-3            PIC 9(3).                      03500000
035100     05 PV-STRING-PTR-4            PIC 9(3).                      03510000
035200     05 PV-CSS-DSP-LEN             PIC 9(4).                      03520000
035300     05 PV-CSS-DSP-TO-LEN          PIC 9(4).                      03530000
035400     05 PV-HEADER-LOG-LEN          PIC 9(4).                      03540000
035500     05 PV-SPOOL-LOG-LEN           PIC 9(4).                      03550000
035600     05 PV-UTC-DATE                PIC X(24).                     03560000
035700     05 PV-CURR-DATE               PIC X(24).                     03570000
035800     05 PV-NEW-EXP-DATE-TIME       PIC X(24).                     03580000
035900     05 PV-RUNNING-SPACE-CNT       PIC 9(5).                      03590000
036000     05 PV-HDR-LOG-SPACE-CNT       PIC 9(5).                      03600000
036100     05 PV-HDR-SPACE-CNT           PIC 9(5).                      03610000
036200     05 PV-HDR-CUR-CNT             PIC 9(5).                      03620000
036300     05 PV-FROM-SPACE-CNT          PIC 9(5).                      03630000
036400     05 PV-FAULT-SPACE-CNT         PIC 9(5).                      03640000
036500     05 PV-OFFSET-LEN              PIC 9(5).                      03650000
036600     05 PV-OFFSET-LEN2             PIC 9(5).                      03660000
036700     05 PV-RUNNING-CUR-CNT         PIC 9(5).                      03670000
036800     05 PV-STR-INDEX               PIC 9(3).                      03680000
036900     05 PV-STR-INDEX1              PIC 9(3).                      03690000
037000     05 PV-STR-INDEX2              PIC 9(3).                      03700000
037100     05 PV-STR-INDEX3              PIC 9(3).                      03710000
037200     05 PV-STR-INDEX4              PIC 9(3).                      03720000
037300     05 PV-STR-INDEX5              PIC 9(3).                      03730000
037400     05 PV-STR-INDEX6              PIC 9(3).                      03740000
037500     05 PV-STR-INDEX7              PIC 9(3).                      03750000
037600     05 PV-STR-INDEX8              PIC 9(3).                      03760000
037700     05 PV-STR-INDEX9              PIC 9(3).                      03770000
037800     05 PV-STR-INDEX10             PIC 9(3).                      03780000
037900     05 PV-STR-INDEX11             PIC 9(3).                      03790000
038000     05 PV-STR-INDEX12             PIC 9(3).                      03800000
038100     05 PV-STR-INDEX13             PIC 9(3).                      03810000
038200     05 PV-STR-INDEX14             PIC 9(3).                      03820000
038300     05 PV-CONFIG-RECORD           PIC X(300).                    03830000
038400     05 PV-FAULT-MSG               PIC X(255).                    03840000
038500     05 PV-FAULT-MSG-1             PIC X(400).                    03850000
038600     05 PV-NEW-MESSAGE-ID          PIC X(36) VALUE SPACES.        03860000
038700     05 PV-SOAP-LVL-LEN            PIC S9(8) COMP-4.              03870000
038800     05 PV-FAULT-CODE              PIC S9(8) COMP-4.              03880000
038900     05 PV-PIPE-AREA               PIC X(8)  VALUE SPACES.        03890000
039000     05 PV-PIPE-AREA-SPLIT         PIC X(5) VALUE SPACES.         03900000
039100     05 PV-TASK-NBR                PIC X(7).                      03910000
039200     05 PV-TASKN                   REDEFINES PV-TASK-NBR          03920000
039300                                   PIC 9(7).                      03930000
039400     05 PV-TASKN-SPLIT.                                           03940000
039500        10 PV-TASK1                PIC X(1) VALUE SPACES.         03950000
039600        10 FILLER                  PIC X(1) VALUE '-'.            03960000
039700        10 PV-TASK2                PIC X(4) VALUE SPACES.         03970000
039800        10 FILLER                  PIC X(1) VALUE '-'.            03980000
039900        10 PV-TASK3                PIC X(2) VALUE SPACES.         03990000
040000     05 PV-SECS2-SPLIT.                                           04000000
040100        10 PV-SEC-1                PIC X(2) VALUE SPACES.         04010000
040200        10 FILLER                  PIC X(1) VALUE '-'.            04020000
040300        10 PV-SEC-2                PIC X(4) VALUE SPACES.         04030000
040400        10 FILLER                  PIC X(1) VALUE '-'.            04040000
040500        10 PV-SEC-3                PIC X(12) VALUE SPACES.        04050000
040600     05 PV-SECTION-NAME            PIC X(30) OCCURS 100 TIMES.    04060000
040700     05 PV-SECTION-NAME2           PIC X(30) OCCURS 100 TIMES.    04070000
040800     05 PV-SECTION-NAME3           PIC X(30) OCCURS 100 TIMES.    04080000
040900     05 PV-SECTION-NAME4           PIC X(30) OCCURS 100 TIMES.    04090000
041000     05 PV-NEW-TO-ARRAY            OCCURS 100 TIMES.              04100000
041100        10 PV-NEW-TO-ADR           PIC X(100) VALUE SPACES.       04110000
041200        10 PV-NEW-TO-ACT           PIC X(50) VALUE SPACES.        04120000
041300        10 PV-NEW-TO-PARM1         PIC X(20) VALUE SPACES.        04130000
041400        10 PV-NEW-TO-PARM2         PIC X(20) VALUE SPACES.        04140000
041500     05 PV-KMH-ELEMENT-ARRAY       OCCURS 100 TIMES.              04150000
041600        10 PV-KMH-ELEMENT          PIC X(20).                     04160000
041700        10 PV-KMH-MANDATE          PIC X(1).                      04170000
041800        10 PV-KMH-ELE-PRESENCE     PIC X(1).                      04180000
041900        10 PV-KMH-VAL              OCCURS 10 TIMES.               04190000
042000           15 PV-KMH-ELEMENT-VAL   PIC X(50).                     04200000
042100     05 PV-CHRDATE                 PIC X(80).                     04210000
042200     05 PV-IN-DATE.                                               04220000
042300        10 PV-STRING-LENGTH        PIC S9(4) BINARY.              04230000
042400        10 PV-STRING-TEXT.                                        04240000
042500           15 PV-STRING-CHAR       PIC X                          04250000
042600                                   OCCURS 0 TO 256 TIMES          04260000
042700                                   DEPENDING ON PV-STRING-LENGTH  04270000
042800                                   of PV-IN-DATE.                 04280000
042900 01  PV-MORE2-PROGRAM-VARIALES.                                   04290000
043000     05 PV-PICSTR.                                                04300000
043100        10 PV-STRING-LENGTH        PIC S9(4) BINARY.              04310000
043200        10 PV-STRING-TEXT.                                        04320000
043300           15 PV-STRING-CHAR         PIC X                        04330000
043400                                   OCCURS 0 TO 256 TIMES          04340000
043500                                   DEPENDING ON PV-STRING-LENGTH  04350000
043600                                   of PV-PICSTR.                  04360000
043700 01  PV-FC.                                                       04370000
043800     05 PV-COND-TOKEN-VALUE.                                      04380000
043900        10 PV-CASE-1-CONDITION-ID.                                04390000
044000           15 PV-SEVERITY          PIC S9(4) COMP.                04400000
044100           15 PV-MSG-NO            PIC S9(4) COMP.                04410000
044200        10 PV-CASE-SEV-CTL         PIC X.                         04420000
044300        10 PV-FACILITY-ID          PIC X(3).                      04430000
044400     05 PV-I-S-INFO                PIC S9(9) COMP.                04440000
044500 01  PV-LILIAN                     PIC S9(9) BINARY.              04450000
044600 01  PV-CEE-SECS                   COMP-2.                        04460000
044700 01  PV-SAVED-SECS                 COMP-2.                        04470000
044800 01  PV-EXPIRY-SECS                COMP-2.                        04480000
044900 01  PV-NEW-SECS                   COMP-2.                        04490000
045000 01  PV-SEC-VAR.                                                  04500000
045100     05 PV-SECS2                   PIC X(18).                     04510000
045200     05 PV-SECS                    REDEFINES PV-SECS2             04520000
045300                                   PIC  9(12)V9(6).               04530000
045400 01  PV-RETR-KMH-AREA.                                            04540000
045500     05 FILLER                     PIC X OCCURS 65536             04550000
045600                                   DEPENDING ON PV-RETR-KMH-LEN.  04560000
045700                                                                  04570000
045800*VSAM RECORD LAYOUT                                               04580000
045900      COPY TRRD071.                                               04590000
046000                                                                  04600000
046100*----------------------------------------------------------------*04610000
046200* DCLGEN TABLE(DBT_WEB_SRVC_HDR_LOG)                              04620000
046300*----------------------------------------------------------------*04630000
046400                                                                  04640000
046500     EXEC SQL                                                     04650000
046600         INCLUDE DBT00024                                         04660000
046700     END-EXEC.                                                    04670000
046800                                                                  04680000
046810*----------------------------------------------------------------*04681003
046820* parm table used to control displays                             04682003
046830*----------------------------------------------------------------*04683003
046840                                                                  04684003
046850     EXEC SQL                                                     04685003
046860         INCLUDE TKRPRPM                                          04686003
046870     END-EXEC.                                                    04687003
046880                                                                  04688003
046890                                                                  04689003
046900*----------------------------------------------------------------*04690000
047000*    DB2 AREA FOR COMMUNICATIONS                                  04700000
047100*----------------------------------------------------------------*04710000
047200                                                                  04720000
047300     EXEC SQL                                                     04730000
047400          INCLUDE SQLCA                                           04740000
047500     END-EXEC.                                                    04750000
047600                                                                  04760000
047700*EJECT                                                            04770000
047800 LINKAGE SECTION.                                                 04780000
047900 01  PV-GETMAIN-AREA.                                             04790000
048000     05 FILLER                     PIC X OCCURS 65536             04800000
048100                                   DEPENDING ON PV-GETMAIN-LEN.   04810000
048200 01  PV-URI-AREA.                                                 04820000
048300     05 FILLER                     PIC X OCCURS 256               04830000
048400                                   DEPENDING ON PV-URI-LEN.       04840000
048500 01  PV-TRANID-DATA.                                              04850000
048600     05 FILLER                     PIC X OCCURS 32768             04860000
048700                                   DEPENDING ON PV-TRANID-LEN.    04870000
048800                                                                  04880000
048900******************************************************************04890000
049000******************************************************************04900000
049100 PROCEDURE DIVISION.                                              04910000
049200******************************************************************04920000
049300* READ DFHWS-WEBSERVICE TO GET THE CURRENT WEB SERVICE NAME      *04930000
049400******************************************************************04940000
049500*                                                                 04950000
049600 0000-MAIN-MODULE.                                                04960000
049700                                                                  04970000
049710                                                                  04971002
049720*    DMH 2/15/18 BEGIN                                            04972002
049730*    ADDED NEW PARM - TR130D TO CONTROL WHEN MESSAGES WILL        04973002
049740*    BE DISPLAYED                                                 04974002
049750     PERFORM 0500-CHECK-DISPLAY                                   04975002
049760     IF  PS-DISPLAY-MSG-YES                                       04976002
049800         DISPLAY 'TRKCS130-ENTRY TIME: ' FUNCTION CURRENT-DATE    04980002
049801     END-IF                                                       04980102
049810*    dmh 2/15/18 end                                              04981001
049820                                                                  04982001
049900*    STRING  'INSIDE TRKCS130'                                    04990000
050000*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              05000000
050100*    PERFORM 9990-WRITE-CICS                                      05010000
050200*                                                                 05020000
050300     PERFORM 1000-INITIALIZE.                                     05030000
050400*                                                                 05040000
050500     IF PS-VALID-FUNCTION                                         05050000
050600                                                                  05060000
050700        PERFORM 2000-SUB-PROCESS-1                                05070000
050800                                                                  05080000
050900     END-IF                                                       05090000
051000                                                                  05100000
051100*    STRING 'EXIT TRKCS130'                                       05110000
051200*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05120000
051300*    PERFORM 9990-WRITE-CICS                                      05130000
051310                                                                  05131001
051320*    DMH 2/15/18 BEGIN                                            05132002
051330*    ADDED NEW PARM - TR130D TO CONTROL WHEN MESSAGES WILL        05133002
051340*    BE DISPLAYED                                                 05134002
051350     IF  PS-DISPLAY-MSG-YES                                       05135002
051400         DISPLAY 'TRKCS130-EXIT TIME: '  FUNCTION CURRENT-DATE    05140002
051401     END-IF                                                       05140102
051402*    dmh 2/15/18 end                                              05140201
051500                                                                  05150000
051600     EXEC CICS RETURN END-EXEC                                    05160000
051700     .                                                            05170000
051800                                                                  05180000
051810*----------------------------------------------------------------*05181002
051820* check to see if displays will be written or not                *05182002
051830* dmh added - 2/15/18                                            *05183002
051840*----------------------------------------------------------------*05184002
051850 0500-CHECK-DISPLAY.                                              05185002
051860                                                                  05186002
051870     EXEC SQL                                                     05187002
051880          SELECT  FUNC_TXT                                        05188002
051890            INTO :PS-DISPLAY-MSG-SW                               05189002
051891            FROM  TKRPRPM                                         05189102
051892           WHERE LOC_ID             =  90                         05189202
051893             AND INTFC_SYS_CDE      = 'KHL'                       05189302
051894             AND SYS_PRC_FUNC_CDE   = 'TR130D'                    05189402
051895             AND FUNC_PRC_STAT_CDE  = 'AC'                        05189502
051896             AND FUNC_BEG_TMST     <=  CURRENT TIMESTAMP          05189602
051897             AND FUNC_END_TMST     >=  CURRENT TIMESTAMP          05189702
051898     END-EXEC.                                                    05189802
051899                                                                  05189902
051900     EVALUATE TRUE                                                05190002
051901        WHEN SQLCODE = 0                                          05190102
051902             CONTINUE                                             05190202
051903        WHEN OTHER                                                05190302
051904             SET PS-DISPLAY-MSG-NO TO TRUE                        05190402
051905             MOVE SQLCODE TO PV-SQLCODE-DISP                      05190502
051906             STRING  ' TRKCS130 - '                               05190602
051907                     'SELECT TR130D TKRPRPM '                     05190702
051908                     'SQL:' PV-SQLCODE-DISP  DELIMITED BY SIZE    05190802
051909                                        INTO PV-CICS-MSG-AREA     05190902
051910             DISPLAY PV-CICS-MSG-AREA                             05191002
051911     END-EVALUATE.                                                05191102
051912                                                                  05191202
051913                                                                  05191302
051920 1000-INITIALIZE.                                                 05192000
052000                                                                  05200000
052100     PERFORM 1100-GET-WEBSERVICE                                  05210000
052200     PERFORM 1200-GET-WEBSRVC-FUNCTION                            05220000
052300                                                                  05230000
052400     SET PS-EXDT-NT-NEED             TO TRUE                      05240000
052500     SET PS-ACT-NT-NEED              TO TRUE                      05250000
052600     SET PS-TO-NT-NEED               TO TRUE                      05260000
052700     SET PS-RKEYS-NT-NEED            TO TRUE                      05270000
052800     SET PS-CORID-NT-NEED            TO TRUE                      05280000
052900     SET PS-FAULT-NT-NEED            TO TRUE                      05290000
053000     SET PS-FROM-NT-NEED             TO TRUE                      05300000
053100     SET PS-MSGID-NT-NEED            TO TRUE                      05310000
053200     SET PS-CRDATM-NT-NEED           TO TRUE                      05320000
053300     SET PS-INRPTO-NT-NEED           TO TRUE                      05330000
053400                                                                  05340000
053500     INITIALIZE PV-RESP                                           05350000
053600                PV-HOST-NAME                                      05360000
053700                                                                  05370000
053800     MOVE 'TCPIPIUCVSTREAMS' TO PV-EZ-TOKEN                       05380000
053900     MOVE  8                 TO PV-EZ-COMMAND                     05390000
054000     MOVE  0                 TO PV-EZ-HZERO                       05400000
054100     MOVE  LOW-VALUES        TO PV-EZ-DZERO                       05410000
054200     MOVE  30                TO PV-EZ-NAMELEN                     05420000
054300     INITIALIZE              PV-EZ-NAME                           05430000
054400                             PV-EZ-ERRNO                          05440000
054500                             PV-EZ-RETCODE                        05450000
054600                                                                  05460000
054700     CALL 'EZACICAL'  USING PV-EZ-TOKEN                           05470000
054800                            PV-EZ-COMMAND                         05480000
054900                            PV-EZ-HZERO                           05490000
055000                            PV-EZ-DZERO                           05500000
055100                            PV-EZ-NAMELEN                         05510000
055200                            PV-EZ-NAME                            05520000
055300                            PV-EZ-ERRNO                           05530000
055400                            PV-EZ-RETCODE.                        05540000
055500                                                                  05550000
055600     MOVE PV-EZ-RETCODE TO PV-EZ-RETCODE2.                        05560000
055700     IF PV-EZ-RETCODE = 0                                         05570000
055800        STRING PV-EZ-NAME                                         05580000
055900               DELIMITED BY LOW-VALUE                             05590000
056000              '.KOHLS.COM'                                        05600000
056100               DELIMITED BY SIZE INTO PV-HOST-NAME                05610000
056200     END-IF                                                       05620000
056300                                                                  05630000
056400*    STRING 'TRKCS130: PV-HOST-NAME: '                            05640000
056500*           DELIMITED BY SIZE                                     05650000
056600*           PV-HOST-NAME                                          05660000
056700*           DELIMITED BY SIZE                                     05670000
056800*           'PV-EZ-RETCODE: '                                     05680000
056900*           DELIMITED BY SIZE                                     05690000
057000*           PV-EZ-RETCODE2                                        05700000
057100*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05710000
057200*    PERFORM 9990-WRITE-CICS                                      05720000
057300     .                                                            05730000
057400                                                                  05740000
057500 1100-GET-WEBSERVICE.                                             05750000
057600                                                                  05760000
057700     INITIALIZE PV-RESP                                           05770000
057800                PV-WEBS-AREA                                      05780000
057900                                                                  05790000
058000     EXEC CICS                                                    05800000
058100          GET CONTAINER('DFHWS-WEBSERVICE')                       05810000
058200          INTO(PV-WEBS-AREA)                                      05820000
058300          FLENGTH(PV-WEBS-LEN)                                    05830000
058400          RESP(PV-RESP)                                           05840000
058500     END-EXEC                                                     05850000
058600                                                                  05860000
058700*    MOVE PV-RESP              TO PV-RESP-DISP                    05870000
058800*    STRING 'PV-RESP AFTER WEBSERVCE CONTAINER READ: '            05880000
058900*           DELIMITED BY SIZE                                     05890000
059000*           PV-RESP-DISP                                          05900000
059100*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05910000
059200*    PERFORM 9990-WRITE-CICS                                      05920000
059300*    STRING 'PV-WEBS-AREA CONTAINER READ: '                       05930000
059400*           DELIMITED BY SIZE                                     05940000
059500*           PV-WEBS-AREA                                          05950000
059600*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               05960000
059700*    PERFORM 9990-WRITE-CICS                                      05970000
059800                                                                  05980000
059900     EVALUATE PV-RESP                                             05990000
060000        WHEN DFHRESP(CCSIDERR)                                    06000000
060100             EXEC CICS ABEND ABCODE('C001') END-EXEC              06010000
060200             CONTINUE                                             06020000
060300        WHEN DFHRESP(CONTAINERERR)                                06030000
060400             EXEC CICS ABEND ABCODE('C002') END-EXEC              06040000
060500             CONTINUE                                             06050000
060600        WHEN DFHRESP(INVREQ)                                      06060000
060700             EXEC CICS ABEND ABCODE('C003') END-EXEC              06070000
060800             CONTINUE                                             06080000
060900        WHEN DFHRESP(LENGERR)                                     06090000
061000             CONTINUE                                             06100000
061100        WHEN OTHER                                                06110000
061200             CONTINUE                                             06120000
061300     END-EVALUATE.                                                06130000
061400******************************************************************06140000
061500* READ DFHFUNCTION TO GET THE FUNCTION UNDER WHICH THIS PROGRAM   06150000
061600* IS INVOKED. IF THE FUNCTION IS NOT IN EITHER OF THE BELOW, THEN 06160000
061700* SKIP FURTHER PROCESSING AND EXIT THIS PROGRAM.                  06170000
061800* ALLOWED VALUES ARE:                                             06180000
061900*   1) SEND-REQUEST                                               06190000
062000*   2) RECEIVE-RESPONSE                                           06200000
062100*   3) RECEIVE-REQUEST                                            06210000
062200*   4) SEND-RESPONSE                                              06220000
062300******************************************************************06230000
062400*                                                                 06240000
062500 1200-GET-WEBSRVC-FUNCTION.                                       06250000
062600     INITIALIZE PV-RESP                                           06260000
062700                PV-FUNC-AREA                                      06270000
062800*    STRING  'GET CONTAINER DFHFUNCTION'                          06280000
062900*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              06290000
063000*    PERFORM 9990-WRITE-CICS                                      06300000
063100                                                                  06310000
063200     EXEC CICS                                                    06320000
063300          GET CONTAINER('DFHFUNCTION')                            06330000
063400          INTO(PV-FUNC-AREA)                                      06340000
063500          FLENGTH(PV-FUNC-LEN)                                    06350000
063600          RESP(PV-RESP)                                           06360000
063700     END-EXEC                                                     06370000
063800                                                                  06380000
063900                                                                  06390000
064000*    MOVE PV-RESP              TO PV-RESP-DISP                    06400000
064100*    STRING 'PV-RESP AFTER DFHFUNCTION READ: '                    06410000
064200*           DELIMITED BY SIZE                                     06420000
064300*           PV-RESP-DISP                                          06430000
064400*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               06440000
064500*    PERFORM 9990-WRITE-CICS                                      06450000
064600*    STRING 'PV-FUNC-AREA CONTAINER READ: '                       06460000
064700*           DELIMITED BY SIZE                                     06470000
064800*           PV-FUNC-AREA                                          06480000
064900*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               06490000
065000*    PERFORM 9990-WRITE-CICS                                      06500000
065100     EVALUATE PV-RESP                                             06510000
065200        WHEN DFHRESP(CCSIDERR)                                    06520000
065300             EXEC CICS ABEND ABCODE('C005') END-EXEC              06530000
065400             CONTINUE                                             06540000
065500        WHEN DFHRESP(CONTAINERERR)                                06550000
065600             EXEC CICS ABEND ABCODE('C006') END-EXEC              06560000
065700             CONTINUE                                             06570000
065800        WHEN DFHRESP(INVREQ)                                      06580000
065900             EXEC CICS ABEND ABCODE('C007') END-EXEC              06590000
066000             CONTINUE                                             06600000
066100        WHEN DFHRESP(LENGERR)                                     06610000
066200             EXEC CICS ABEND ABCODE('C008') END-EXEC              06620000
066300             CONTINUE                                             06630000
066400     END-EVALUATE                                                 06640000
066500                                                                  06650000
066600     SET PS-SKIP-FUNCTION            TO TRUE                      06660000
066700     EVALUATE PV-FUNC-AREA                                        06670000
066800        WHEN 'SEND-REQUEST'                                       06680000
066900             SET PS-FUNC-SEND-REQ      TO TRUE                    06690000
067000        WHEN 'SEND-RESPONSE'                                      06700000
067100             SET PS-FUNC-SEND-RESP     TO TRUE                    06710000
067200        WHEN 'RECEIVE-REQUEST'                                    06720000
067300             SET PS-FUNC-REC-REQ       TO TRUE                    06730000
067400        WHEN 'RECEIVE-RESPONSE'                                   06740000
067500             SET PS-FUNC-REC-RESP      TO TRUE                    06750000
067600        WHEN OTHER                                                06760000
067700             SET PS-SKIP-FUNCTION      TO TRUE                    06770000
067800     END-EVALUATE.                                                06780000
067900                                                                  06790000
068000******************************************************************06800000
068100* READ CONFIG FILE FOR THE WEBSERVICE AND FUNCTION TO READ CONTROL06810000
068200* PARAMETERS. IF NO ROW FOUND, THEN REPLACE WEBSERVICE NAME WITH  06820000
068300* A DEFAULT WEBSERVICE NAME 'DEFAULT' AND TRY READING AGAIN       06830000
068400******************************************************************06840000
068500 2000-SUB-PROCESS-1.                                              06850000
068600                                                                  06860000
068700     INITIALIZE PV-CURR-DATE                                      06870000
068800                PV-IN-MSG-CORRID                                  06880000
068900                PV-IN-MSG-INRPTO.                                 06890000
069000                                                                  06900000
069100     PERFORM 1008-GENERATE-UTC.                                   06910000
069200                                                                  06920000
069300     MOVE PV-UTC-DATE        TO PV-CURR-DATE                      06930000
069400                                                                  06940000
069500     INITIALIZE TR071-CA-CONFIG-RECORD                            06950000
069600                PV-CONFIG-RECORD                                  06960000
069700                                                                  06970000
069800     PERFORM VARYING PV-STR-INDEX FROM 1 BY 1                     06980000
069900        UNTIL PV-STR-INDEX > 99                                   06990000
070000                                                                  07000000
070100        MOVE SPACES           TO PV-SECTION-NAME(PV-STR-INDEX)    07010000
070200                                                                  07020000
070300     END-PERFORM.                                                 07030000
070400                                                                  07040000
070500     MOVE PV-FUNC-AREA        TO TR071-FUNC-AREA                  07050000
070600     MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                  07060000
070700     MOVE 1                   TO TR071-SEQ-NO                     07070000
070800                                                                  07080000
070900     PERFORM 7000-VSAM-FILE-READ                                  07090000
071000                                                                  07100000
071100*    MOVE   PV-RESP            TO PV-RESP-DISP                    07110000
071200*    STRING 'VSAM FILE READ. PV-RESP: '                           07120000
071300*           DELIMITED BY SIZE                                     07130000
071400*           PV-RESP-DISP                                          07140000
071500*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               07150000
071600*    PERFORM 9990-WRITE-CICS                                      07160000
071700                                                                  07170000
071800     EVALUATE PV-RESP                                             07180000
071900                                                                  07190000
072000        WHEN 0                                                    07200000
072100                                                                  07210000
072200            CONTINUE                                              07220000
072300                                                                  07230000
072400        WHEN 13                                                   07240000
072500                                                                  07250000
072600            MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA           07260000
072700                                                                  07270000
072800            PERFORM 7000-VSAM-FILE-READ                           07280000
072900                                                                  07290000
073000*           MOVE   PV-RESP           TO PV-RESP-DISP              07300000
073100*           STRING  'VSAM FILE READ2 PV-RESP: '                   07310000
073200*                   DELIMITED BY SIZE                             07320000
073300*                   PV-RESP-DISP                                  07330000
073400*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       07340000
073500*           PERFORM 9990-WRITE-CICS                               07350000
073600                                                                  07360000
073700            IF PV-RESP = 13                                       07370000
073800               EXEC CICS ABEND ABCODE('C010') END-EXEC            07380000
073900               CONTINUE                                           07390000
074000            END-IF                                                07400000
074100                                                                  07410000
074200        WHEN OTHER                                                07420000
074300            EXEC CICS ABEND ABCODE('C011') END-EXEC               07430000
074400     END-EVALUATE.                                                07440000
074500                                                                  07450000
074600* UNSTRING PV-CONFIG-RECORD                                       07460000
074700     MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD    07470000
074800     MOVE 1                          TO PV-STRING-PTR-1           07480000
074900     SET PS-CONT-THE-LOOP            TO TRUE                      07490000
075000                                                                  07500000
075100     PERFORM VARYING PV-STR-INDEX FROM 1 BY 1                     07510000
075200        UNTIL PV-STR-INDEX > 99 OR                                07520000
075300        PS-BREAK-THE-LOOP                                         07530000
075400                                                                  07540000
075500        UNSTRING TR071-FREE-TEXT DELIMITED BY ';'                 07550000
075600                 INTO PV-SECTION-NAME(PV-STR-INDEX)               07560000
075700                 WITH POINTER PV-STRING-PTR-1                     07570000
075800        END-UNSTRING                                              07580000
075900                                                                  07590000
076000        IF PV-SECTION-NAME(PV-STR-INDEX) = SPACES                 07600000
076100           SET PS-BREAK-THE-LOOP   TO TRUE                        07610000
076200        END-IF                                                    07620000
076300                                                                  07630000
076400     END-PERFORM                                                  07640000
076500                                                                  07650000
076600     SET PS-VALIDATE-PASS        TO TRUE                          07660000
076700     SET PS-CONT-THE-LOOP1       TO TRUE                          07670000
076800     MOVE 1                      TO PV-STR-INDEX1                 07680000
076900                                                                  07690000
077000     PERFORM UNTIL PV-STR-INDEX1 > PV-STR-INDEX                   07700000
077100     OR PS-BREAK-THE-LOOP1                                        07710000
077200                                                                  07720000
077300*       STRING 'READING SECTIONS: '                               07730000
077400*               PV-SECTION-NAME(PV-STR-INDEX1)                    07740000
077500*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           07750000
077600*       PERFORM 9990-WRITE-CICS                                   07760000
077700                                                                  07770000
077800        EVALUATE PV-SECTION-NAME(PV-STR-INDEX1)                   07780000
077900           WHEN 'KMHLOG'                                          07790000
078000                                                                  07800000
078100                PERFORM 2100-KMHLOG                               07810000
078200                                                                  07820000
078300           WHEN 'KMHVAL'                                          07830000
078400                                                                  07840000
078500                PERFORM 2200-KMHVAL                               07850000
078600                                                                  07860000
078700           WHEN 'KMHPREP'                                         07870000
078800                                                                  07880000
078900                PERFORM 2300-KMHPREP                              07890000
079000                                                                  07900000
079100           WHEN OTHER                                             07910000
079200                                                                  07920000
079300                SET PS-BREAK-THE-LOOP1  TO TRUE                   07930000
079400                CONTINUE                                          07940000
079500                                                                  07950000
079600        END-EVALUATE                                              07960000
079700                                                                  07970000
079800        ADD 1                       TO PV-STR-INDEX1              07980000
079900     END-PERFORM                                                  07990000
080000     .                                                            08000000
080100******************************************************************08010000
080200* THIS SECTION RETRIEVES KMH AND LOGS IT                          08020000
080300* 1) IN CASE OF SEND-REQUEST, KMH SHOULD HAVE BEEN PREPARED FIRST,08030000
080400*    TO BE LOGGED. SO, USE THE VALUES FROM KMHPREP                08040000
080500* 2) IN CASE OF SEND-RESPONSE TOO, SAME APPLIES                   08050000
080600* 3) IN ALL OTHER CASES, RETRIEVE THE JUST RECEIVED KMH AND LOG   08060000
080700******************************************************************08070000
080800 2100-KMHLOG.                                                     08080000
080900                                                                  08090000
081000*    STRING 'INSIDE 2100-KMHLOG'                                  08100000
081100*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              08110000
081200*    PERFORM 9990-WRITE-CICS                                      08120000
081300                                                                  08130000
081400     INITIALIZE PV-IN-MSG-MSGID                                   08140000
081500                PV-IN-MSG-CRDT                                    08150000
081600                PV-IN-MSG-SYSCD                                   08160000
081700                PV-IN-MSG-APPCD                                   08170000
081800                PV-IN-MSG-MODCD                                   08180000
081900                PV-IN-MSG-NODID                                   08190000
082000                PV-HEADER-LOG-MSG                                 08200000
082100                                                                  08210000
082200     IF PS-FUNC-SEND-REQ OR                                       08220000
082300        PS-FUNC-SEND-RESP                                         08230000
082400                                                                  08240000
082500        MOVE PV-NEW-MESSAGE-ID    TO  PV-IN-MSG-MSGID             08250000
082600        MOVE PV-UTC-DATE          TO  PV-IN-MSG-CRDT              08260000
082700        MOVE PV-NEW-SYSTEM-CD     TO  PV-IN-MSG-SYSCD             08270000
082800        MOVE PV-NEW-APP           TO  PV-IN-MSG-APPCD             08280000
082900        MOVE PV-NEW-MODULE        TO  PV-IN-MSG-MODCD             08290000
083000        MOVE PV-NEW-NODEID        TO  PV-IN-MSG-NODID             08300000
083100                                                                  08310000
083200     ELSE                                                         08320000
083300                                                                  08330000
083400        PERFORM 2110-RETRIEVE-KMH                                 08340000
083500                                                                  08350000
083600        IF PS-RETR-NO-ERROR                                       08360000
083700                                                                  08370000
083800           PERFORM 2120-READ-CONFIG-MANDATE                       08380000
083900           PERFORM 2130-PARSE-KMH                                 08390000
084000                                                                  08400000
084100        END-IF                                                    08410000
084200                                                                  08420000
084300*       STRING '2100-KMHLOG; INCOMING KM HEADER IS: '             08430000
084400*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08440000
084500*       PERFORM 9990-WRITE-CICS                                   08450000
084600*       STRING 'PV-IN-MSG-MSGID: ' PV-IN-MSG-MSGID                08460000
084700*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08470000
084800*       PERFORM 9990-WRITE-CICS                                   08480000
084900*       STRING 'PV-IN-MSG-CRDT : ' PV-IN-MSG-CRDT                 08490000
085000*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08500000
085100*       PERFORM 9990-WRITE-CICS                                   08510000
085200*       STRING 'PV-IN-MSG-SYSCD: ' PV-IN-MSG-SYSCD                08520000
085300*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08530000
085400*       PERFORM 9990-WRITE-CICS                                   08540000
085500*       STRING 'PV-IN-MSG-APPCD: ' PV-IN-MSG-APPCD                08550000
085600*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08560000
085700*       PERFORM 9990-WRITE-CICS                                   08570000
085800*       STRING 'PV-IN-MSG-MODCD: ' PV-IN-MSG-MODCD                08580000
085900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08590000
086000*       PERFORM 9990-WRITE-CICS                                   08600000
086100*       STRING 'PV-IN-MSG-NODID: ' PV-IN-MSG-NODID                08610000
086200*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08620000
086300*       PERFORM 9990-WRITE-CICS                                   08630000
086400*       STRING 'TOTAL KMH IS: '                                   08640000
086500*               PV-RETR-KMH-AREA(1:80)                            08650000
086600*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08660000
086700*       PERFORM 9990-WRITE-CICS                                   08670000
086800*       STRING  PV-RETR-KMH-AREA(81:160)                          08680000
086900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08690000
087000*       PERFORM 9990-WRITE-CICS                                   08700000
087100*       STRING  PV-RETR-KMH-AREA(161:240)                         08710000
087200*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08720000
087300*       PERFORM 9990-WRITE-CICS                                   08730000
087400*       STRING  PV-RETR-KMH-AREA(241:320)                         08740000
087500*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08750000
087600*       PERFORM 9990-WRITE-CICS                                   08760000
087700*       STRING  PV-RETR-KMH-AREA(321:400)                         08770000
087800*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           08780000
087900*       PERFORM 9990-WRITE-CICS                                   08790000
088000     END-IF                                                       08800000
088100                                                                  08810000
088200     INITIALIZE PV-FROM-SPACE-CNT                                 08820000
088300                PV-SYS-CD-LEN                                     08830000
088400                PV-APP-CD-LEN                                     08840000
088500                PV-MOD-CD-LEN                                     08850000
088600                PV-NOD-ID-LEN                                     08860000
088700                PV-HDR-SPACE-CNT                                  08870000
088800                PV-HDR-CUR-CNT                                    08880000
088900                PV-TEMP-LOG-MSG                                   08890000
089000                PV-FAULT-SPACE-CNT                                08900000
089100                PV-FLT-CD-LEN                                     08910000
089200                PV-FLT-DS-LEN                                     08920000
089300                                                                  08930000
089400     INSPECT FUNCTION REVERSE(PV-IN-MSG-SYSCD)                    08940000
089500             TALLYING PV-FROM-SPACE-CNT                           08950000
089600             FOR LEADING SPACES                                   08960000
089700                                                                  08970000
089800     COMPUTE PV-SYS-CD-LEN = LENGTH OF PV-IN-MSG-SYSCD -          08980000
089900                             PV-FROM-SPACE-CNT                    08990000
090000**                                                                09000000
090100     INITIALIZE PV-FROM-SPACE-CNT                                 09010000
090200                                                                  09020000
090300     INSPECT FUNCTION REVERSE(PV-IN-MSG-APPCD)                    09030000
090400             TALLYING PV-FROM-SPACE-CNT                           09040000
090500             FOR LEADING SPACES                                   09050000
090600                                                                  09060000
090700     COMPUTE PV-APP-CD-LEN = LENGTH OF PV-IN-MSG-APPCD -          09070000
090800                             PV-FROM-SPACE-CNT                    09080000
090900**                                                                09090000
091000     INITIALIZE PV-FROM-SPACE-CNT                                 09100000
091100                                                                  09110000
091200     INSPECT FUNCTION REVERSE(PV-IN-MSG-MODCD)                    09120000
091300             TALLYING PV-FROM-SPACE-CNT                           09130000
091400             FOR LEADING SPACES                                   09140000
091500                                                                  09150000
091600     COMPUTE PV-MOD-CD-LEN = LENGTH OF PV-IN-MSG-MODCD -          09160000
091700                             PV-FROM-SPACE-CNT                    09170000
091800**                                                                09180000
091900     INITIALIZE PV-FROM-SPACE-CNT                                 09190000
092000     INSPECT FUNCTION REVERSE(PV-IN-MSG-NODID)                    09200000
092100             TALLYING PV-FROM-SPACE-CNT                           09210000
092200             FOR LEADING SPACES                                   09220000
092300                                                                  09230000
092400     COMPUTE PV-NOD-ID-LEN = LENGTH OF PV-IN-MSG-NODID -          09240000
092500                             PV-FROM-SPACE-CNT                    09250000
092600                                                                  09260000
092700     IF PS-FUNC-SEND-RESP OR PS-FUNC-SEND-REQ                     09270000
092800        OR ( PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                09280000
092900                                                                  09290000
093000        MOVE PV-LITERAL-KMH-VER TO PV-STOR-KMH-VER                09300000
093100                                                                  09310000
093200     END-IF                                                       09320000
093300                                                                  09330000
093400     IF PS-FUNC-SEND-RESP OR PS-FUNC-REC-RESP                     09340000
093500                                                                  09350000
093600        STRING PV-CURR-DATE DELIMITED BY SIZE                     09360000
093700               '||INFO||{' DELIMITED BY SIZE                      09370000
093800               '"MessageHeader":{"version":"' DELIMITED BY SIZE   09380000
093900               PV-STOR-KMH-VER                                    09390000
094000               '","MessageID":"'                                  09400000
094100               DELIMITED BY SIZE                                  09410000
094200               PV-IN-MSG-MSGID DELIMITED BY SPACE                 09420000
094300               '","CreateDateTime":"' DELIMITED BY SIZE           09430000
094400               PV-IN-MSG-CRDT DELIMITED BY SIZE                   09440000
094500               '","From":{"systemCode":"' DELIMITED BY SIZE       09450000
094600               PV-IN-MSG-SYSCD(1: PV-SYS-CD-LEN)                  09460000
094700               '","app":"' DELIMITED BY SIZE                      09470000
094800               PV-IN-MSG-APPCD(1: PV-APP-CD-LEN)                  09480000
094900               '","module":"' DELIMITED BY SIZE                   09490000
095000               PV-IN-MSG-MODCD(1: PV-MOD-CD-LEN)                  09500000
095100               '","nodeID":"' DELIMITED BY SIZE                   09510000
095200               PV-IN-MSG-NODID(1:PV-NOD-ID-LEN)                   09520000
095300               '"}'                                               09530000
095400               DELIMITED BY SIZE                                  09540000
095500               INTO PV-HEADER-LOG-MSG                             09550000
095600                                                                  09560000
095700      IF PV-IN-MSG-INRPTO NOT = SPACES                            09570000
095800                                                                  09580000
095900         INITIALIZE PV-HDR-SPACE-CNT                              09590000
096000                    PV-HDR-CUR-CNT                                09600000
096100                    PV-TEMP-LOG-MSG                               09610000
096200                                                                  09620000
096300         INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)              09630000
096400                 TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES     09640000
096500                                                                  09650000
096600         COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -   09660000
096700                                  PV-HDR-SPACE-CNT + 1            09670000
096800                                                                  09680000
096900         STRING ',"InReplyTo":"' DELIMITED BY SIZE                09690000
097000                PV-IN-MSG-INRPTO                                  09700000
097100                '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG        09710000
097200                                                                  09720000
097300         MOVE PV-TEMP-LOG-MSG    TO                               09730000
097400              PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                  09740000
097500                                                                  09750000
097600      ELSE                                                        09760000
097700                                                                  09770000
097800         IF PS-FUNC-SEND-RESP                                     09780000
097900                                                                  09790000
098000         INITIALIZE PV-HDR-SPACE-CNT                              09800000
098100                    PV-HDR-CUR-CNT                                09810000
098200                    PV-TEMP-LOG-MSG                               09820000
098300                                                                  09830000
098400         INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)              09840000
098500         TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES             09850000
098600                                                                  09860000
098700         COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -   09870000
098800                                  PV-HDR-SPACE-CNT + 1            09880000
098900                                                                  09890000
099000         STRING ',"InReplyTo":"' DELIMITED BY SIZE                09900000
099100                PV-STOR-IRP-TO                                    09910000
099200                '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG        09920000
099300                                                                  09930000
099400         MOVE PV-TEMP-LOG-MSG    TO                               09940000
099500              PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                  09950000
099600                                                                  09960000
099700       END-IF                                                     09970000
099800      END-IF                                                      09980000
099900                                                                  09990000
100000      IF PV-IN-MSG-CORRID NOT = SPACES                            10000000
100100                                                                  10010000
100200        INITIALIZE PV-HDR-SPACE-CNT                               10020000
100300                   PV-HDR-CUR-CNT                                 10030000
100400                   PV-TEMP-LOG-MSG                                10040000
100500                                                                  10050000
100600        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               10060000
100700        TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES              10070000
100800                                                                  10080000
100900        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    10090000
101000                                 PV-HDR-SPACE-CNT + 1             10100000
101100                                                                  10110000
101200        STRING ',"CorrelationID":"' DELIMITED BY SIZE             10120000
101300        PV-IN-MSG-CORRID                                          10130000
101400        '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG                10140000
101500                                                                  10150000
101600        MOVE PV-TEMP-LOG-MSG    TO                                10160000
101700                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)     10170000
101800                                                                  10180000
101900      ELSE                                                        10190000
102000                                                                  10200000
102100       IF PS-FUNC-SEND-RESP                                       10210000
102200                                                                  10220000
102300        INITIALIZE PV-HDR-SPACE-CNT                               10230000
102400                   PV-HDR-CUR-CNT                                 10240000
102500                   PV-TEMP-LOG-MSG                                10250000
102600                                                                  10260000
102700        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               10270000
102800        TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES              10280000
102900                                                                  10290000
103000        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    10300000
103100                                 PV-HDR-SPACE-CNT + 1             10310000
103200                                                                  10320000
103300        STRING ',"CorrelationID":"' DELIMITED BY SIZE             10330000
103400        PV-STOR-IRP-TO                                            10340000
103500        '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG                10350000
103600                                                                  10360000
103700        MOVE PV-TEMP-LOG-MSG    TO                                10370000
103800                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)     10380000
103900                                                                  10390000
104000       END-IF                                                     10400000
104100      END-IF                                                      10410000
104200                                                                  10420000
104300*     DISPLAY 'PV-HEADER-LOG-MSG: ' PV-HEADER-LOG-MSG             10430000
104400      IF PS-IN-MSG-FAULT-F                                        10440000
104500**                                                                10450000
104600                                                                  10460000
104700        INITIALIZE PV-FAULT-SPACE-CNT                             10470000
104800                                                                  10480000
104900        INSPECT FUNCTION REVERSE(PV-IN-MSG-FAULT-CD)              10490000
105000                TALLYING PV-FAULT-SPACE-CNT                       10500000
105100                FOR LEADING SPACES                                10510000
105200                                                                  10520000
105300        COMPUTE PV-FLT-CD-LEN = LENGTH OF PV-IN-MSG-FAULT-CD -    10530000
105400                                PV-FAULT-SPACE-CNT                10540000
105500**                                                                10550000
105600        INITIALIZE PV-FAULT-SPACE-CNT                             10560000
105700                                                                  10570000
105800        INSPECT FUNCTION REVERSE(PV-IN-MSG-FAULT-DES)             10580000
105900                TALLYING PV-FAULT-SPACE-CNT                       10590000
106000                FOR LEADING SPACES                                10600000
106100        COMPUTE PV-FLT-DS-LEN = LENGTH OF PV-IN-MSG-FAULT-DES -   10610000
106200                                PV-FAULT-SPACE-CNT                10620000
106300**                                                                10630000
106400        INITIALIZE PV-HDR-SPACE-CNT                               10640000
106500                   PV-HDR-CUR-CNT                                 10650000
106600                   PV-TEMP-LOG-MSG                                10660000
106700                                                                  10670000
106800        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               10680000
106900                TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES      10690000
107000                                                                  10700000
107100        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    10710000
107200                                 PV-HDR-SPACE-CNT + 1             10720000
107300                                                                  10730000
107400        STRING ',"Fault":{"Code":"' DELIMITED BY SIZE             10740000
107500               PV-IN-MSG-FAULT-CD(1: PV-FLT-CD-LEN)               10750000
107600               '","Description":"' DELIMITED BY SIZE              10760000
107700               PV-IN-MSG-FAULT-DES(1: PV-FLT-DS-LEN)              10770000
107800               '"}'                                               10780000
107900               DELIMITED BY SIZE                                  10790000
108000               INTO PV-TEMP-LOG-MSG                               10800000
108100                                                                  10810000
108200        MOVE PV-TEMP-LOG-MSG    TO                                10820000
108300             PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                   10830000
108400      END-IF                                                      10840000
108500      INITIALIZE PV-HDR-SPACE-CNT                                 10850000
108600                 PV-HDR-CUR-CNT                                   10860000
108700                 PV-TEMP-LOG-MSG                                  10870000
108800      INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)                 10880000
108900              TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES        10890000
109000      COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -      10900000
109100                               PV-HDR-SPACE-CNT + 1               10910000
109200      MOVE '}}'                TO                                 10920000
109300           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)                     10930000
109400                                                                  10940000
109500*     DISPLAY 'PV-HEADER-LOG-MSG 2: ' PV-HEADER-LOG-MSG           10950000
109600                                                                  10960000
109700     ELSE                                                         10970000
109800                                                                  10980000
109900        STRING PV-CURR-DATE DELIMITED BY SIZE                     10990000
110000               '||INFO||{' DELIMITED BY SIZE                      11000000
110100               '"MessageHeader":{"version":"' DELIMITED BY SIZE   11010000
110200               PV-STOR-KMH-VER                                    11020000
110300               '","MessageID":"'                                  11030000
110400               DELIMITED BY SIZE                                  11040000
110500               PV-IN-MSG-MSGID DELIMITED BY SPACE                 11050000
110600               '","CreateDateTime":"' DELIMITED BY SIZE           11060000
110700               PV-IN-MSG-CRDT DELIMITED BY SIZE                   11070000
110800               '","From":{"systemCode":"' DELIMITED BY SIZE       11080000
110900               PV-IN-MSG-SYSCD(1: PV-SYS-CD-LEN)                  11090000
111000               '","app":"' DELIMITED BY SIZE                      11100000
111100               PV-IN-MSG-APPCD(1: PV-APP-CD-LEN)                  11110000
111200               '","module":"' DELIMITED BY SIZE                   11120000
111300               PV-IN-MSG-MODCD(1: PV-MOD-CD-LEN)                  11130000
111400               '","nodeID":"' DELIMITED BY SIZE                   11140000
111500               PV-IN-MSG-NODID(1:PV-NOD-ID-LEN)                   11150000
111600               '"}' DELIMITED BY SIZE                             11160000
111700               INTO PV-HEADER-LOG-MSG                             11170000
111800                                                                  11180000
111900        IF PV-IN-MSG-INRPTO NOT = SPACES                          11190000
112000                                                                  11200000
112100           INITIALIZE PV-HDR-SPACE-CNT                            11210000
112200                      PV-HDR-CUR-CNT                              11220000
112300                      PV-TEMP-LOG-MSG                             11230000
112400                                                                  11240000
112500          INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)             11250000
112600          TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES            11260000
112700                                                                  11270000
112800          COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -  11280000
112900                                   PV-HDR-SPACE-CNT + 1           11290000
113000                                                                  11300000
113100          STRING ',"InReplyTo":"' DELIMITED BY SIZE               11310000
113200          PV-IN-MSG-INRPTO                                        11320000
113300          '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG              11330000
113400                                                                  11340000
113500          MOVE PV-TEMP-LOG-MSG    TO                              11350000
113600                             PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)   11360000
113700                                                                  11370000
113800        END-IF                                                    11380000
113900                                                                  11390000
114000        IF PV-IN-MSG-CORRID NOT = SPACES                          11400000
114100                                                                  11410000
114200          INITIALIZE PV-HDR-SPACE-CNT                             11420000
114300                     PV-HDR-CUR-CNT                               11430000
114400                     PV-TEMP-LOG-MSG                              11440000
114500                                                                  11450000
114600          INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)             11460000
114700          TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES            11470000
114800                                                                  11480000
114900          COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -  11490000
115000                                   PV-HDR-SPACE-CNT + 1           11500000
115100                                                                  11510000
115200          STRING ',"CorrelationID":"' DELIMITED BY SIZE           11520000
115300          PV-IN-MSG-CORRID                                        11530000
115400          '"' DELIMITED BY SIZE INTO PV-TEMP-LOG-MSG              11540000
115500                                                                  11550000
115600          MOVE PV-TEMP-LOG-MSG    TO                              11560000
115700                             PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)   11570000
115800                                                                  11580000
115900        END-IF                                                    11590000
116000                                                                  11600000
116100        IF  PS-VALIDATE-FAIL AND PS-FUNC-REC-REQ                  11610000
116200                                                                  11620000
116300           INITIALIZE PV-HDR-SPACE-CNT                            11630000
116400                      PV-HDR-CUR-CNT                              11640000
116500                      PV-TEMP-LOG-MSG                             11650000
116600           INITIALIZE PV-FAULT-SPACE-CNT                          11660000
116700                                                                  11670000
116800           INSPECT FUNCTION REVERSE(PV-FAULT-MSG)                 11680000
116900            TALLYING PV-FAULT-SPACE-CNT                           11690000
117000            FOR LEADING SPACES                                    11700000
117100                                                                  11710000
117200           COMPUTE PV-FLT-DS-LEN = LENGTH OF PV-FAULT-MSG -       11720000
117300           PV-FAULT-SPACE-CNT                                     11730000
117400                                                                  11740000
117500           STRING ',"Fault":{"Code":"' DELIMITED BY SIZE          11750000
117600           'BAD MESSAGE HEADER ELEMENT' DELIMITED BY SIZE         11760000
117700           '","Description":"' DELIMITED BY SIZE                  11770000
117800           PV-FAULT-MSG(1: PV-FLT-DS-LEN)                         11780000
117900           '"}'                                                   11790000
118000           DELIMITED BY SIZE                                      11800000
118100           INTO PV-TEMP-LOG-MSG                                   11810000
118200                                                                  11820000
118300           INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)            11830000
118400           TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES           11840000
118500                                                                  11850000
118600           COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG - 11860000
118700                                    PV-HDR-SPACE-CNT + 1          11870000
118800                                                                  11880000
118900           MOVE PV-TEMP-LOG-MSG    TO                             11890000
119000                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT:)     11900000
119100                                                                  11910000
119200        END-IF                                                    11920000
119300                                                                  11930000
119400        INITIALIZE PV-HDR-SPACE-CNT                               11940000
119500                   PV-HDR-CUR-CNT                                 11950000
119600                   PV-TEMP-LOG-MSG                                11960000
119700                                                                  11970000
119800        INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)               11980000
119900        TALLYING PV-HDR-SPACE-CNT FOR LEADING SPACES              11990000
120000                                                                  12000000
120100        COMPUTE PV-HDR-CUR-CNT = LENGTH OF PV-HEADER-LOG-MSG -    12010000
120200                                 PV-HDR-SPACE-CNT + 1             12020000
120300                                                                  12030000
120400        MOVE '}}'                TO                               12040000
120500                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT: 2)   12050000
120600        COMPUTE PV-HDR-CUR-CNT = PV-HDR-CUR-CNT + 2               12060000
120700                                                                  12070000
120800        MOVE SPACES              TO                               12080000
120900                           PV-HEADER-LOG-MSG(PV-HDR-CUR-CNT :)    12090000
121000                                                                  12100000
121100     END-IF                                                       12110000
121200                                                                  12120000
121300     INITIALIZE PV-HDR-LOG-SPACE-CNT                              12130000
121400                                                                  12140000
121500     MOVE 1                 TO PV-CSS-DSP-LEN                     12150000
121600     MOVE 80                TO PV-CSS-DSP-TO-LEN                  12160000
121700     MOVE LENGTH OF PV-HEADER-LOG-MSG TO PV-HEADER-LOG-LEN        12170000
121800*    DISPLAY ' PV-HEADER-LOG-LEN 1 : ' PV-HEADER-LOG-LEN          12180000
121900**                                                                12190000
122000                                                                  12200000
122100     INSPECT FUNCTION REVERSE(PV-HEADER-LOG-MSG)                  12210000
122200      TALLYING PV-HDR-LOG-SPACE-CNT                               12220000
122300      FOR LEADING SPACES                                          12230000
122400                                                                  12240000
122500     COMPUTE PV-HEADER-LOG-LEN = PV-HEADER-LOG-LEN -              12250000
122600     PV-HDR-LOG-SPACE-CNT                                         12260000
122700                                                                  12270000
122800     INITIALIZE DCLDBT00024                                       12280000
122900     MOVE PV-HDR-APP-ID      TO DBT00024-APPL-ID                  12290000
123000     MOVE PV-WEBS-AREA       TO DBT00024-WEB-SRVC-NM              12300000
123100     MOVE PV-IN-MSG-MSGID    TO DBT00024-MSG-ID                   12310000
123200     MOVE PV-HEADER-LOG-LEN  TO DBT00024-MSG-TXT-LEN              12320000
123300     MOVE PV-HEADER-LOG-MSG(1 : PV-HEADER-LOG-LEN)                12330000
123400                             TO DBT00024-MSG-TXT-TEXT             12340000
123500                                                                  12350000
123600     EXEC SQL                                                     12360000
123700          INSERT                                                  12370000
123800          INTO DBT_WEB_SRVC_HDR_LOG                               12380000
123900                         ( APPL_ID                                12390000
124000                          ,WEB_SRVC_NM                            12400000
124100                          ,MSG_ID                                 12410000
124200                          ,MSG_TXT                                12420000
124300                          ,CRE_TMST                               12430000
124400                         )                                        12440000
124500          VALUES                                                  12450000
124600                         (                                        12460000
124700                           :DBT00024-APPL-ID                      12470000
124800                          ,:DBT00024-WEB-SRVC-NM                  12480000
124900                          ,:DBT00024-MSG-ID                       12490000
125000                          ,:DBT00024-MSG-TXT                      12500000
125100                          ,CURRENT_TIMESTAMP                      12510000
125200                         )                                        12520000
125300     END-EXEC                                                     12530000
125400                                                                  12540000
125500     EVALUATE TRUE                                                12550000
125600        WHEN SQLCODE = 0                                          12560000
125700             CONTINUE                                             12570000
125800        WHEN OTHER                                                12580000
125900             MOVE SQLCODE TO PV-SQLCODE-DISP                      12590000
126000             STRING  'INSERT ERROR SQL CODE: '                    12600000
126100                      DELIMITED BY SIZE                           12610000
126200                      PV-SQLCODE-DISP                             12620000
126300                     'INSERT ERROR SQLSTATE: '                    12630000
126400                      SQLSTATE                                    12640000
126500                      DELIMITED BY SIZE INTO PV-CICS-MSG-AREA     12650000
126600              PERFORM 9990-WRITE-CICS                             12660000
126700     END-EVALUATE                                                 12670000
126800                                                                  12680000
126900*    PERFORM UNTIL PV-CSS-DSP-LEN > PV-HEADER-LOG-LEN             12690000
127000                                                                  12700000
127100*       STRING PV-HEADER-LOG-MSG(PV-CSS-DSP-LEN:PV-CSS-DSP-TO-LEN)12710000
127200*              DELIMITED BY SIZE INTO PV-CICS-MSG-AREA            12720000
127300*       PERFORM 9990-WRITE-CICS                                   12730000
127400*       COMPUTE PV-CSS-DSP-LEN = 1 + PV-CSS-DSP-TO-LEN            12740000
127500*       COMPUTE PV-CSS-DSP-TO-LEN = 80 + PV-CSS-DSP-TO-LEN        12750000
127600                                                                  12760000
127700*    END-PERFORM                                                  12770000
127800           .                                                      12780000
127900******************************************************************12790000
128000* THIS SECTION PERFORMS THE BELOW STEPS:                          12800000
128100* 1) RETRIEVE KMH HEADER                                          12810000
128200* 2) PARSE KMH HEADER                                             12820000
128300* 3) RETRIEVE MANDATORY FIELD INFORMATION FROM CONFIG FILE LOOKUP 12830000
128400* 4) CHECK IF MANDATORY FIELDS ARE PRESENT                        12840000
128500* 5) IF ERROR OCCURED:                                            12850000
128600*    IF DFHFUNCTION 'RECEIVE RESPONSE', LOG IT IN SPOOL AND QUIT  12860000
128700*    IF DFHFUNCTION 'RECEIVE REQUEST', THEN                       12870000
128800*    A) READ CONFIG FILE WITH 'SEND-RESPONSE' FOR OUTBOUND LOGIC  12880000
128900*    B) SET A VALIDATION ERROR FLAG TO TRUE AND LOG MSG IN SPOOL  12890000
129000*    C) IF APPLICABLE, PERFORM KMHPREPARE                         12900000
129100*    D) IF APPLICABLE, PERFORM NEW KMHLOG                         12910000
129200*    E) CREATE SOAP FAULT                                         12920000
129300******************************************************************12930000
129400 2200-KMHVAL.                                                     12940000
129500                                                                  12950000
129600*    STRING 'INSIDE 2200-KMHVAL'                                  12960000
129700*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              12970000
129800*    PERFORM 9990-WRITE-CICS                                      12980000
129900                                                                  12990000
130000     SET PS-RETR-ERROR       TO TRUE                              13000000
130100     INITIALIZE PV-IN-MSG-MSGID                                   13010000
130200                PV-IN-MSG-CRDT                                    13020000
130300                PV-IN-MSG-SYSCD                                   13030000
130400                PV-IN-MSG-APPCD                                   13040000
130500                PV-IN-MSG-MODCD                                   13050000
130600                PV-IN-MSG-NODID                                   13060000
130700                                                                  13070000
130800*    STRING '2110-RETRIEVE-KMH'                                   13080000
130900*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              13090000
131000*    PERFORM 9990-WRITE-CICS                                      13100000
131100                                                                  13110000
131200     PERFORM 2110-RETRIEVE-KMH                                    13120000
131300                                                                  13130000
131400     IF PS-RETR-NO-ERROR                                          13140000
131500                                                                  13150000
131600*       STRING 'NO ERROR IN RETRIEVE 2120-READ-CONFIG-MANDATE'    13160000
131700*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13170000
131800*       PERFORM 9990-WRITE-CICS                                   13180000
131900                                                                  13190000
132000        PERFORM 2120-READ-CONFIG-MANDATE                          13200000
132100                                                                  13210000
132200*       STRING '2130-PARSE-KMH          '                         13220000
132300*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13230000
132400*       PERFORM 9990-WRITE-CICS                                   13240000
132500                                                                  13250000
132600        PERFORM 2130-PARSE-KMH                                    13260000
132700                                                                  13270000
132800*       STRING '2140-VALIDATE-MANDATE   '                         13280000
132900*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13290000
133000*       PERFORM 9990-WRITE-CICS                                   13300000
133100                                                                  13310000
133200        PERFORM 2140-VALIDATE-MANDATE                             13320000
133300                                                                  13330000
133400        IF PS-VALIDATE-FAIL                                       13340000
133500*          STRING 'VALIDATE FAILED, SPOOL LOG'                    13350000
133600*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        13360000
133700*          PERFORM 9990-WRITE-CICS                                13370000
133800                                                                  13380000
133900           PERFORM 2150-PERFORM-SPOOL-LOG                         13390000
134000                                                                  13400000
134100        END-IF                                                    13410000
134200                                                                  13420000
134300        IF PS-VALIDATE-FAIL   AND ( PS-FUNC-REC-REQ               13430000
134400           )                                                      13440000
134500                                                                  13450000
134600        PERFORM 2500-FAILED-PROCS                                 13460000
134700                                                                  13470000
134800        END-IF                                                    13480000
134900     ELSE                                                         13490000
135000      IF PS-FUNC-REC-RESP                                         13500000
135100                                                                  13510000
135200         STRING PV-CURR-DATE DELIMITED BY SIZE                    13520000
135300               '||WARNING||Message header is NULL'                13530000
135400                DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           13540000
135500        PERFORM 9990-WRITE-CICS                                   13550000
135600                                                                  13560000
135700        MOVE 'Message header is NULL'       TO PV-FAULT-MSG       13570000
135800        SET PS-VALIDATE-FAIL      TO TRUE                         13580000
135900        PERFORM 2150-PERFORM-SPOOL-LOG                            13590000
136000                                                                  13600000
136100      ELSE                                                        13610000
136200                                                                  13620000
136300        STRING PV-CURR-DATE DELIMITED BY SIZE                     13630000
136400              '||ERROR||Message header is NULL'                   13640000
136500               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA            13650000
136600        PERFORM 9990-WRITE-CICS                                   13660000
136700                                                                  13670000
136800        MOVE 'Message header is NULL'       TO PV-FAULT-MSG       13680000
136900        SET PS-VALIDATE-FAIL      TO TRUE                         13690000
137000                                                                  13700000
137100        PERFORM 2150-PERFORM-SPOOL-LOG                            13710000
137200                                                                  13720000
137300        IF PS-FUNC-REC-REQ                                        13730000
137400                                                                  13740000
137500           PERFORM 2500-FAILED-PROCS                              13750000
137600                                                                  13760000
137700        END-IF                                                    13770000
137800      END-IF                                                      13780000
137900     END-IF                                                       13790000
138000           .                                                      13800000
138100******************************************************************13810000
138200* THIS SECTION PERFORMS BELOW LOGIC:                              13820000
138300* PROCEED TO KMHPREP-2 ONLY                                       13830000
138400*       IF EITHER DFHFUNCTION='SEND-REQUEST'                      13840000
138500*       OR        DFHFUNCTION='SEND-RESPONSE'                     13850000
138600*       OR DFHFUNCTION='RECEIVE-REQUEST'& PS-VALIDATE-FAILED TRUE 13860000
138700*                                                                 13870000
138800******************************************************************13880000
138900 2300-KMHPREP.                                                    13890000
139000*    STRING 'INSIDE 2300-KMHPREP'                                 13900000
139100*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              13910000
139200*    PERFORM 9990-WRITE-CICS                                      13920000
139300                                                                  13930000
139400     SET PS-PROC-KMHPREM-FALSE     TO TRUE                        13940000
139500                                                                  13950000
139600*    STRING 'PS-FUNC-VALID-SW: ' PS-FUNC-VALID-SW                 13960000
139700*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              13970000
139800*    PERFORM 9990-WRITE-CICS                                      13980000
139900*    STRING 'PS-MANDATE-SW: ' PS-MANDATE-SW                       13990000
140000*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              14000000
140100*    PERFORM 9990-WRITE-CICS                                      14010000
140200                                                                  14020000
140300     IF (PS-FUNC-SEND-REQ)  OR                                    14030000
140400        (PS-FUNC-SEND-RESP) OR                                    14040000
140500        (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                    14050000
140600                                                                  14060000
140700        SET PS-PROC-KMHPREM   TO TRUE                             14070000
140800                                                                  14080000
140900     END-IF                                                       14090000
141000                                                                  14100000
141100     IF PS-PROC-KMHPREM                                           14110000
141200                                                                  14120000
141300        PERFORM 2400-KMHPREP-2                                    14130000
141400                                                                  14140000
141500     END-IF                                                       14150000
141600           .                                                      14160000
141700******************************************************************14170000
141800* 1) IN CASE OF 'SEND-RESPONSE' AND 'RECEIVE-REQUEST'(ERROR),     14180000
141900*    RETRIEVE THE KMH HEADER OF INCOMING MESSAGE AND READ BELOW   14190000
142000*       A) INCOMING MESSAGE ID                                    14200000
142100*       B) INCOMING CORRELATION ID                                14210000
142200* 2) GENERATE MESSAGE ID                                          14220000
142300* 3) PREPARE CREATEDATETIME                                       14230000
142400* 4) READ CONFIG FILE TO POPULATE:                                14240000
142500*       A) SYSTEMCODE                                             14250000
142600*       B) APP                                                    14260000
142700*       C) MODULE                                                 14270000
142800*       D) NODEID                                                 14280000
142900* 5) IN CASE OF 'SEND-RESPONSE' AND 'RECEIVE-REQUEST'(ERROR),     14290000
143000*    POPULATE, INREPLYTO, CORRELATIONID AND FAULT (IF ERROR)      14300000
143100* 6) IF APPLICABLE, POPULATE OPTIONAL FIELDS                      14310000
143200* 7) WRITE DFHHEADER CONTAINER WITH NEW KMH                       14320000
143300******************************************************************14330000
143400 2400-KMHPREP-2.                                                  14340000
143500*    STRING  'INSIDE 2400-KMHPREP2'                               14350000
143600*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14360000
143700*    PERFORM 9990-WRITE-CICS                                      14370000
143800                                                                  14380000
143900     IF (PS-FUNC-SEND-RESP) OR                                    14390000
144000        (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL) OR                 14400000
144100        (PS-FUNC-SEND-REQ)                                        14410000
144200                                                                  14420000
144300*         STRING  '2120-READ-CONFIG-MANDATE'                      14430000
144400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                14440000
144500*         PERFORM 9990-WRITE-CICS                                 14450000
144600                                                                  14460000
144700          PERFORM 2120-READ-CONFIG-MANDATE                        14470000
144800                                                                  14480000
144900     END-IF                                                       14490000
145000                                                                  14500000
145100     IF (PS-FUNC-SEND-RESP) OR                                    14510000
145200        (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                    14520000
145300                                                                  14530000
145400        SET PS-RETR-ERROR       TO TRUE                           14540000
145500                                                                  14550000
145600        INITIALIZE PV-IN-MSG-MSGID                                14560000
145700                PV-IN-MSG-CRDT                                    14570000
145800                PV-IN-MSG-SYSCD                                   14580000
145900                PV-IN-MSG-APPCD                                   14590000
146000                PV-IN-MSG-MODCD                                   14600000
146100                PV-IN-MSG-NODID                                   14610000
146200                                                                  14620000
146300*       STRING  '2110-RETRIEVE-KMH'                               14630000
146400*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14640000
146500*       PERFORM 9990-WRITE-CICS                                   14650000
146600        IF PS-FUNC-SEND-RESP                                      14660000
146700                                                                  14670000
146800          PERFORM 2540-RET-OLD-KMH                                14680000
146900                                                                  14690000
147000        ELSE                                                      14700000
147100                                                                  14710000
147200          PERFORM 2110-RETRIEVE-KMH                               14720000
147300                                                                  14730000
147400        END-IF                                                    14740000
147500                                                                  14750000
147600        IF PS-RETR-NO-ERROR                                       14760000
147700                                                                  14770000
147800* RETRIEVE IN-MSGID AND IN-CORRELATION ID FROM INCOMING MSG       14780000
147900*         STRING  '2130-PARSE-KMH'                                14790000
148000*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                14800000
148100*         PERFORM 9990-WRITE-CICS                                 14810000
148200                                                                  14820000
148300          PERFORM 2130-PARSE-KMH                                  14830000
148400                                                                  14840000
148500        END-IF                                                    14850000
148600     END-IF                                                       14860000
148700                                                                  14870000
148800*    STRING  '2410-OPT-HDR-FLDS'                                  14880000
148900*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14890000
149000*    PERFORM 9990-WRITE-CICS                                      14900000
149100     PERFORM 2410-OPT-HDR-FLDS                                    14910000
149200                                                                  14920000
149300     IF PS-MSGID-NEED OR SV-CRDATM-NEED OR PS-EXDT-NEED           14930000
149400                                                                  14940000
149500*       STRING  '1008-GENERATE-UTC'                               14950000
149600*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  14960000
149700*       PERFORM 9990-WRITE-CICS                                   14970000
149800                                                                  14980000
149900        PERFORM 1008-GENERATE-UTC                                 14990000
150000                                                                  15000000
150100     END-IF                                                       15010000
150200     IF PS-MSGID-NEED                                             15020000
150300                                                                  15030000
150400*       STRING  '2420-GENERATE-MSGID'                             15040000
150500*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  15050000
150600*       PERFORM 9990-WRITE-CICS                                   15060000
150700        PERFORM 2420-GENERATE-MSGID                               15070000
150800                                                                  15080000
150900     END-IF                                                       15090000
151000                                                                  15100000
151100     IF PS-FROM-NEED                                              15110000
151200                                                                  15120000
151300*       STRING  '2430-GENERATE-FROM'                              15130000
151400*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  15140000
151500*       PERFORM 9990-WRITE-CICS                                   15150000
151600        PERFORM 2430-GENERATE-FROM                                15160000
151700                                                                  15170000
151800     END-IF                                                       15180000
151900                                                                  15190000
152000     IF PS-EXDT-NEED                                              15200000
152100                                                                  15210000
152200        PERFORM 2440-BLD-EXPIRY-DATE                              15220000
152300                                                                  15230000
152400     END-IF                                                       15240000
152500                                                                  15250000
152600     IF PS-ACT-NEED                                               15260000
152700                                                                  15270000
152800        PERFORM 2450-BLD-ACTION                                   15280000
152900                                                                  15290000
153000     END-IF                                                       15300000
153100                                                                  15310000
153200     IF PS-TO-NEED                                                15320000
153300                                                                  15330000
153400        PERFORM 2460-BLD-TO                                       15340000
153500                                                                  15350000
153600     END-IF                                                       15360000
153700                                                                  15370000
153800     IF PS-RKEYS-NEED                                             15380000
153900                                                                  15390000
154000        PERFORM 2470-BLD-RKEYS                                    15400000
154100                                                                  15410000
154200     END-IF                                                       15420000
154300                                                                  15430000
154400     PERFORM 2480-WRITE-DFHHDR                                    15440000
154500              .                                                   15450000
154600******************************************************************15460000
154700* A VALIDATION FAILURE OF INCOMING MESSAGE HAS BEEN DETECTED.     15470000
154800* INITIATE A KMH BUILD FOR 'SEND-RESPONSE' SCENARIO               15480000
154900* ISSUE SOAP FAULT                                                15490000
155000******************************************************************15500000
155100 2500-FAILED-PROCS.                                               15510000
155200                                                                  15520000
155300     INITIALIZE TR071-CA-CONFIG-RECORD                            15530000
155400                      PV-CONFIG-RECORD                            15540000
155500                                                                  15550000
155600     PERFORM VARYING PV-STR-INDEX7 FROM 1 BY 1                    15560000
155700          UNTIL PV-STR-INDEX7 > 99                                15570000
155800                                                                  15580000
155900          MOVE SPACES           TO                                15590000
156000              PV-SECTION-NAME2(PV-STR-INDEX7)                     15600000
156100                                                                  15610000
156200           END-PERFORM                                            15620000
156300                                                                  15630000
156400           MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA            15640000
156500           MOVE 'SEND-RESPONSE'     TO TR071-FUNC-AREA            15650000
156600           MOVE 1                   TO TR071-SEQ-NO               15660000
156700                                                                  15670000
156800           PERFORM 7000-VSAM-FILE-READ                            15680000
156900                                                                  15690000
157000           EVALUATE PV-RESP                                       15700000
157100                                                                  15710000
157200              WHEN 0                                              15720000
157300                                                                  15730000
157400                  CONTINUE                                        15740000
157500                                                                  15750000
157600              WHEN 13                                             15760000
157700                                                                  15770000
157800                  MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA     15780000
157900                                                                  15790000
158000                  PERFORM 7000-VSAM-FILE-READ                     15800000
158100                                                                  15810000
158200                  IF PV-RESP = 13                                 15820000
158300                     EXEC CICS ABEND ABCODE('C012') END-EXEC      15830000
158400                     CONTINUE                                     15840000
158500                                                                  15850000
158600                  END-IF                                          15860000
158700           END-EVALUATE                                           15870000
158800                                                                  15880000
158900           MOVE PV-CONFIG-RECORD       TO TR071-CA-CONFIG-RECORD  15890000
159000           MOVE 1                      TO PV-STRING-PTR-2         15900000
159100           SET PS-CONT-THE-LOOP        TO TRUE                    15910000
159200                                                                  15920000
159300           PERFORM VARYING PV-STR-INDEX7 FROM 1 BY 1              15930000
159400              UNTIL PV-STR-INDEX7 > 99 OR                         15940000
159500              PS-BREAK-THE-LOOP                                   15950000
159600                                                                  15960000
159700              UNSTRING TR071-FREE-TEXT DELIMITED BY ';'           15970000
159800                INTO PV-SECTION-NAME2(PV-STR-INDEX7)              15980000
159900                WITH POINTER PV-STRING-PTR-2                      15990000
160000                                                                  16000000
160100              END-UNSTRING                                        16010000
160200                                                                  16020000
160300              IF PV-SECTION-NAME2(PV-STR-INDEX7) = SPACES         16030000
160400                 SET PS-BREAK-THE-LOOP   TO TRUE                  16040000
160500              END-IF                                              16050000
160600                                                                  16060000
160700           END-PERFORM                                            16070000
160800                                                                  16080000
160900           MOVE 1                      TO PV-STR-INDEX1           16090000
161000           SET PS-CONT-THE-LOOP2       TO TRUE                    16100000
161100                                                                  16110000
161200           PERFORM UNTIL PV-STR-INDEX1 > PV-STR-INDEX7            16120000
161300           OR PS-BREAK-THE-LOOP2                                  16130000
161400                                                                  16140000
161500              EVALUATE PV-SECTION-NAME2(PV-STR-INDEX1)            16150000
161600                                                                  16160000
161700                 WHEN 'KMHLOG'                                    16170000
161800*                    STRING  'KMHLOG FOR VALIDATE FAIL'           16180000
161900*                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA     16190000
162000*                    PERFORM 9990-WRITE-CICS                      16200000
162100                                                                  16210000
162200                     PERFORM 2100-KMHLOG                          16220000
162300                                                                  16230000
162400                 WHEN 'KMHPREP'                                   16240000
162500*                    STRING  'KMHPREP FOR VALIDATE FAIL'          16250000
162600*                     DELIMITED BY SIZE INTO PV-CICS-MSG-AREA     16260000
162700*                    PERFORM 9990-WRITE-CICS                      16270000
162800                                                                  16280000
162900                     PERFORM 2300-KMHPREP                         16290000
163000                                                                  16300000
163100                 WHEN OTHER                                       16310000
163200                                                                  16320000
163300                     SET PS-BREAK-THE-LOOP2  TO TRUE              16330000
163400                                                                  16340000
163500                     CONTINUE                                     16350000
163600              END-EVALUATE                                        16360000
163700                                                                  16370000
163800              ADD 1                     TO PV-STR-INDEX1          16380000
163900                                                                  16390000
164000           END-PERFORM                                            16400000
164100                                                                  16410000
164200*          STRING  '2510-CREATE-SOAP-FAULT'                       16420000
164300*           DELIMITED BY SIZE INTO PV-CICS-MSG-AREA               16430000
164400*          PERFORM 9990-WRITE-CICS                                16440000
164500           PERFORM 2510-CREATE-SOAP-FAULT                         16450000
164600              .                                                   16460000
164700******************************************************************16470000
164800* THIS SECTION READ CONTAINER DHFHEADER TO RETRIEVE KMH.          16480000
164900* IN CASE, THIS RETRIEVAL IS FOR 'RECEIVE-REQUEST', THEN          16490000
165000* IMMEDIATELY, STORE THE RETRIEVED KMH IN A USER CONTAINTER BY    16500000
165100* NAME - 'OLD-HEADER1'. THIS CONTAINER WOULD BE USED TO RETRIEVE  16510000
165200* THE INCOMING KMH WHEN SEND-RESPONSE IS BEING PROCESSED          16520000
165300******************************************************************16530000
165400 2110-RETRIEVE-KMH.                                               16540000
165500                                                                  16550000
165600        INITIALIZE PV-RESP                                        16560000
165700                                                                  16570000
165800        EXEC CICS                                                 16580000
165900             GET CONTAINER('DFHHEADER')                           16590000
166000             SET(PV-HEAD-PTR)                                     16600000
166100             FLENGTH(PV-CONT-LEN)                                 16610000
166200             RESP(PV-RESP)                                        16620000
166300        END-EXEC                                                  16630000
166400                                                                  16640000
166500*       MOVE   PV-RESP            TO PV-RESP-DISP                 16650000
166600*       STRING 'PV-RESP AFTER DFHHEADER CONTAINER READ: '         16660000
166700*               PV-RESP-DISP                                      16670000
166800*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           16680000
166900*       PERFORM 9990-WRITE-CICS                                   16690000
167000        EVALUATE PV-RESP                                          16700000
167100                                                                  16710000
167200           WHEN DFHRESP(CONTAINERERR)                             16720000
167300                                                                  16730000
167400*                STRING  'Container NOT FOUND'                    16740000
167500*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         16750000
167600*                PERFORM 9990-WRITE-CICS                          16760000
167700                 SET PS-RETR-ERROR    TO TRUE                     16770000
167800                                                                  16780000
167900           WHEN DFHRESP(NORMAL)                                   16790000
168000                                                                  16800000
168100                 SET PS-RETR-NO-ERROR TO TRUE                     16810000
168200*                MOVE PV-CONT-LEN     TO PV-CONT-LEN-DISP         16820000
168300                                                                  16830000
168400*                STRING  '>========<'                             16840000
168500*                        'Container Name : ' 'DFHHEADER'          16850000
168600*                        'Content length : ' PV-CONT-LEN-DISP     16860000
168700*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         16870000
168800*                PERFORM 9990-WRITE-CICS                          16880000
168900                 MOVE PV-CONT-LEN    TO PV-GETMAIN-LEN            16890000
169000                                                                  16900000
169100                 IF PV-GETMAIN-LEN > 0                            16910000
169200                                                                  16920000
169300                  EXEC CICS GETMAIN                               16930000
169400                       SET(PV-GETMAIN-PTR)                        16940000
169500                       FLENGTH(PV-GETMAIN-LEN)                    16950000
169600                  END-EXEC                                        16960000
169700                                                                  16970000
169800                  SET ADDRESS OF PV-GETMAIN-AREA TO               16980000
169900                  PV-GETMAIN-PTR                                  16990000
170000                                                                  17000000
170100                  EXEC CICS GET CONTAINER('DFHHEADER')            17010000
170200                       INTO(PV-GETMAIN-AREA)                      17020000
170300                       FLENGTH(PV-CONT-LEN)                       17030000
170400                  END-EXEC                                        17040000
170500                                                                  17050000
170600*                 STRING 'DFHHEADER Container content: '          17060000
170700*                         PV-GETMAIN-AREA(80:)                    17070000
170800*                         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA 17080000
170900*                 PERFORM 9990-WRITE-CICS                         17090000
171000                  MOVE PV-GETMAIN-LEN  TO PV-RETR-KMH-LEN         17100000
171100                  MOVE PV-GETMAIN-AREA TO PV-RETR-KMH-AREA        17110000
171200                                                                  17120000
171300                 ELSE                                             17130000
171400                                                                  17140000
171500                  SET PS-RETR-ERROR    TO TRUE                    17150000
171600                                                                  17160000
171700                 END-IF                                           17170000
171800                                                                  17180000
171900           WHEN DFHRESP(CCSIDERR)                                 17190000
172000                                                                  17200000
172100               SET PS-RETR-ERROR  TO TRUE                         17210000
172200                                                                  17220000
172300               EXEC CICS ABEND ABCODE('C015') END-EXEC            17230000
172400               CONTINUE                                           17240000
172500                                                                  17250000
172600           WHEN DFHRESP(CONTAINERERR)                             17260000
172700                                                                  17270000
172800               SET PS-RETR-ERROR  TO TRUE                         17280000
172900               EXEC CICS ABEND ABCODE('C016') END-EXEC            17290000
173000               CONTINUE                                           17300000
173100                                                                  17310000
173200           WHEN DFHRESP(INVREQ)                                   17320000
173300                                                                  17330000
173400               SET PS-RETR-ERROR  TO TRUE                         17340000
173500               EXEC CICS ABEND ABCODE('C017') END-EXEC            17350000
173600               CONTINUE                                           17360000
173700                                                                  17370000
173800           WHEN DFHRESP(LENGERR)                                  17380000
173900                                                                  17390000
174000               SET PS-RETR-ERROR  TO TRUE                         17400000
174100               EXEC CICS ABEND ABCODE('C018') END-EXEC            17410000
174200               CONTINUE                                           17420000
174300                                                                  17430000
174400        END-EVALUATE                                              17440000
174500                                                                  17450000
174600* SAVE INCOMING KMH HEADER IN A USER CONTAINER OLD-HEADER1 SO THAT17460000
174700* THIS CAN BE RETREIVED AGAIN WHILE SENDING RESPONSE              17470000
174800        IF PS-FUNC-REC-REQ                                        17480000
174900           INITIALIZE PV-RESP                                     17490000
175000           EXEC CICS                                              17500000
175100                PUT  CONTAINER('OLD-HEADER1')                     17510000
175200                FROM(PV-RETR-KMH-AREA)                            17520000
175300                FLENGTH(LENGTH OF PV-RETR-KMH-AREA)               17530000
175400                RESP(PV-RESP)                                     17540000
175500          END-EXEC                                                17550000
175600                                                                  17560000
175700        END-IF                                                    17570000
175800           .                                                      17580000
175900******************************************************************17590000
176000 2130-PARSE-KMH.                                                  17600000
176100                                                                  17610000
176200     PERFORM VARYING PV-STR-INDEX5 FROM 1 BY 1 UNTIL              17620000
176300             PV-STR-INDEX5 > 99                                   17630000
176400                                                                  17640000
176500        INITIALIZE PV-KMH-ELEMENT(PV-STR-INDEX5)                  17650000
176600                   PV-KMH-MANDATE(PV-STR-INDEX5)                  17660000
176700                   PV-KMH-ELE-PRESENCE(PV-STR-INDEX5)             17670000
176800                                                                  17680000
176900        PERFORM VARYING PV-STR-INDEX6 FROM 1 BY 1 UNTIL           17690000
177000                PV-STR-INDEX6 > 10                                17700000
177100                                                                  17710000
177200           INITIALIZE                                             17720000
177300                PV-KMH-ELEMENT-VAL(PV-STR-INDEX5, PV-STR-INDEX6)  17730000
177400                                                                  17740000
177500        END-PERFORM                                               17750000
177600     END-PERFORM                                                  17760000
177700                                                                  17770000
177800     MOVE 1                       TO PV-STR-INDEX2                17780000
177900                                                                  17790000
178000*    STRING 'PV-NBR-M-ELEMENTS: ' PV-NBR-M-ELEMENTS               17800000
178100*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              17810000
178200*    PERFORM 9990-WRITE-CICS                                      17820000
178300     PERFORM UNTIL PV-STR-INDEX2 > PV-NBR-M-ELEMENTS              17830000
178400             OR PV-SECTION-NAME3(PV-STR-INDEX2) = SPACES          17840000
178500                                                                  17850000
178600*       STRING 'PV-SECTION-NAME3(PV-STR-INDEX2): '                17860000
178700*               PV-SECTION-NAME3(PV-STR-INDEX2)                   17870000
178800*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           17880000
178900*       PERFORM 9990-WRITE-CICS                                   17890000
179000        MOVE PV-SECTION-NAME3(PV-STR-INDEX2)                      17900000
179100                            TO PV-KMH-ELEMENT(PV-STR-INDEX2)      17910000
179200        MOVE 'M'            TO PV-KMH-MANDATE(PV-STR-INDEX2)      17920000
179300        ADD 1               TO PV-STR-INDEX2                      17930000
179400                                                                  17940000
179500     END-PERFORM                                                  17950000
179600                                                                  17960000
179700     INITIALIZE PV-IN-MSG-MSGID                                   17970000
179800                PV-IN-MSG-CORRID                                  17980000
179900                PV-STOR-KMH-VER                                   17990000
180000                PV-IN-MSG-INRPTO                                  18000000
180100                PV-IN-MSG-FAULT-CD                                18010000
180200                PV-IN-MSG-FAULT-DES                               18020000
180300                                                                  18030000
180400     SET PS-IN-MSG-FRM-NO  TO TRUE                                18040000
180500     SET PS-IN-MSG-EXDT-N  TO TRUE                                18050000
180600     SET PS-INKMH-VER-N    TO TRUE                                18060000
180700     SET PS-IN-MSG-INRPT-N TO TRUE                                18070000
180800     SET PS-IN-MSG-FAULT-N TO TRUE                                18080000
180900                                                                  18090000
181000     XML PARSE PV-RETR-KMH-AREA                                   18100000
181100         PROCESSING PROCEDURE 2190-XML-HANDLER                    18110000
181200     END-XML                                                      18120000
181300           .                                                      18130000
181400******************************************************************18140000
181500* THIS SECTION READS THE CONFIG FILE TO UNDERSTAND THE MANDATORY  18150000
181600* FIELDS                                                          18160000
181700******************************************************************18170000
181800 2120-READ-CONFIG-MANDATE.                                        18180000
181900                                                                  18190000
182000     INITIALIZE TR071-CA-CONFIG-RECORD                            18200000
182100                PV-CONFIG-RECORD                                  18210000
182200                                                                  18220000
182300     PERFORM VARYING PV-STR-INDEX8 FROM 1 BY 1                    18230000
182400        UNTIL PV-STR-INDEX8 > 99                                  18240000
182500                                                                  18250000
182600        MOVE SPACES           TO                                  18260000
182700             PV-SECTION-NAME3(PV-STR-INDEX8)                      18270000
182800                                                                  18280000
182900     END-PERFORM                                                  18290000
183000                                                                  18300000
183100     MOVE 'MANDATORY'         TO TR071-FUNC-AREA                  18310000
183200* FIRST TRY WITH CURRENT WEBSERVICE NAME                          18320000
183300     MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                  18330000
183400     MOVE 1                   TO TR071-SEQ-NO                     18340000
183500                                                                  18350000
183600     PERFORM 7000-VSAM-FILE-READ                                  18360000
183700                                                                  18370000
183800     EVALUATE PV-RESP                                             18380000
183900                                                                  18390000
184000        WHEN 0                                                    18400000
184100                                                                  18410000
184200            CONTINUE                                              18420000
184300                                                                  18430000
184400        WHEN 13                                                   18440000
184500                                                                  18450000
184600* ROW NOT FOUND. USE DEFAULT WEBSERVICE NAME                      18460000
184700            MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA           18470000
184800                                                                  18480000
184900            PERFORM 7000-VSAM-FILE-READ                           18490000
185000                                                                  18500000
185100            IF PV-RESP NOT = 0                                    18510000
185200                                                                  18520000
185300               EXEC CICS ABEND ABCODE('C019') END-EXEC            18530000
185400               CONTINUE                                           18540000
185500            END-IF                                                18550000
185600                                                                  18560000
185700        WHEN OTHER                                                18570000
185800            EXEC CICS ABEND ABCODE('C020') END-EXEC               18580000
185900     END-EVALUATE                                                 18590000
186000                                                                  18600000
186100* UNSTRING PV-CONFIG-RECORD                                       18610000
186200     MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD    18620000
186300     MOVE 1                          TO PV-STRING-PTR-3           18630000
186400     MOVE 0                          TO PV-NBR-M-ELEMENTS         18640000
186500     SET PS-CONT-THE-LOOP            TO TRUE                      18650000
186600                                                                  18660000
186700     PERFORM VARYING PV-STR-INDEX8 FROM 1 BY 1                    18670000
186800             UNTIL PV-STR-INDEX8 > 99 OR                          18680000
186900             PS-BREAK-THE-LOOP                                    18690000
187000                                                                  18700000
187100        UNSTRING TR071-FREE-TEXT DELIMITED BY ';'                 18710000
187200                 INTO PV-SECTION-NAME3(PV-STR-INDEX8)             18720000
187300                 WITH POINTER PV-STRING-PTR-3                     18730000
187400                                                                  18740000
187500        END-UNSTRING                                              18750000
187600                                                                  18760000
187700        EVALUATE PV-SECTION-NAME3(PV-STR-INDEX8)                  18770000
187800                                                                  18780000
187900           WHEN 'From'                                            18790000
188000                                                                  18800000
188100               SET PS-FROM-NEED       TO TRUE                     18810000
188200                                                                  18820000
188300           WHEN 'MessageID'                                       18830000
188400                                                                  18840000
188500               SET PS-MSGID-NEED      TO TRUE                     18850000
188600                                                                  18860000
188700           WHEN 'CreateDateTime'                                  18870000
188800                                                                  18880000
188900               SET SV-CRDATM-NEED     TO TRUE                     18890000
189000                                                                  18900000
189100           WHEN 'ExpiryDateTime'                                  18910000
189200                                                                  18920000
189300                SET PS-EXDT-NEED      TO TRUE                     18930000
189400                                                                  18940000
189500           WHEN 'Action'                                          18950000
189600                                                                  18960000
189700                SET PS-ACT-NEED       TO TRUE                     18970000
189800                                                                  18980000
189900           WHEN 'To'                                              18990000
190000                                                                  19000000
190100                SET PS-TO-NEED        TO TRUE                     19010000
190200                                                                  19020000
190300           WHEN 'RoutingKeys'                                     19030000
190400                                                                  19040000
190500                SET PS-RKEYS-NEED     TO TRUE                     19050000
190600                                                                  19060000
190700           WHEN 'CorrelationID'                                   19070000
190800                                                                  19080000
190900                SET PS-CORID-NEED     TO TRUE                     19090000
191000                                                                  19100000
191100           WHEN 'Fault'                                           19110000
191200                                                                  19120000
191300                SET PS-FAULT-NEED     TO TRUE                     19130000
191400                                                                  19140000
191500           WHEN 'InReplyTo'                                       19150000
191600                                                                  19160000
191700                SET PS-INRPTO-NEED    TO TRUE                     19170000
191800                                                                  19180000
191900        END-EVALUATE                                              19190000
192000                                                                  19200000
192100        IF PV-SECTION-NAME3(PV-STR-INDEX8) = SPACES               19210000
192200                                                                  19220000
192300           SET PS-BREAK-THE-LOOP  TO TRUE                         19230000
192400                                                                  19240000
192500        END-IF                                                    19250000
192600                                                                  19260000
192700     END-PERFORM                                                  19270000
192800                                                                  19280000
192900     MOVE PV-STR-INDEX8               TO PV-NBR-M-ELEMENTS        19290000
193000                                                                  19300000
193100     INITIALIZE TR071-CA-CONFIG-RECORD                            19310000
193200                PV-CONFIG-RECORD                                  19320000
193300                                                                  19330000
193400     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   19340000
193500             UNTIL PV-STR-INDEX11 > 99                            19350000
193600                                                                  19360000
193700        MOVE SPACES          TO PV-SECTION-NAME4(PV-STR-INDEX11)  19370000
193800                                                                  19380000
193900     END-PERFORM                                                  19390000
194000                                                                  19400000
194100     MOVE 'OPTIONAL'         TO TR071-FUNC-AREA                   19410000
194200                                                                  19420000
194300* FIRST TRY WITH CURRENT WEBSERVICE NAME                          19430000
194400     MOVE PV-WEBS-AREA       TO TR071-WEBS-AREA                   19440000
194500                                                                  19450000
194600     MOVE 1                  TO TR071-SEQ-NO                      19460000
194700                                                                  19470000
194800     PERFORM 7000-VSAM-FILE-READ                                  19480000
194900                                                                  19490000
195000     EVALUATE PV-RESP                                             19500000
195100                                                                  19510000
195200        WHEN 0                                                    19520000
195300                                                                  19530000
195400            CONTINUE                                              19540000
195500                                                                  19550000
195600        WHEN 13                                                   19560000
195700                                                                  19570000
195800* ROW NOT FOUND. USE DEFAULT WEBSERVICE NAME                      19580000
195900            MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA           19590000
196000                                                                  19600000
196100            PERFORM 7000-VSAM-FILE-READ                           19610000
196200                                                                  19620000
196300            IF PV-RESP NOT = 0                                    19630000
196400                                                                  19640000
196500               EXEC CICS ABEND ABCODE('C028') END-EXEC            19650000
196600               CONTINUE                                           19660000
196700                                                                  19670000
196800            END-IF                                                19680000
196900                                                                  19690000
197000        WHEN OTHER                                                19700000
197100                                                                  19710000
197200            EXEC CICS ABEND ABCODE('C029') END-EXEC               19720000
197300                                                                  19730000
197400     END-EVALUATE                                                 19740000
197500                                                                  19750000
197600* UNSTRING PV-CONFIG-RECORD                                       19760000
197700     MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD    19770000
197800     MOVE 1                          TO PV-STRING-PTR-4           19780000
197900     MOVE 0                          TO PV-NBR-O-ELEMENTS         19790000
198000     SET PS-CONT-THE-LOOP            TO TRUE                      19800000
198100                                                                  19810000
198200     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   19820000
198300        UNTIL PV-STR-INDEX11 > 99 OR                              19830000
198400        PS-BREAK-THE-LOOP                                         19840000
198500                                                                  19850000
198600        UNSTRING TR071-FREE-TEXT DELIMITED BY ';'                 19860000
198700          INTO PV-SECTION-NAME4(PV-STR-INDEX11)                   19870000
198800          WITH POINTER PV-STRING-PTR-4                            19880000
198900                                                                  19890000
199000        END-UNSTRING                                              19900000
199100                                                                  19910000
199200        EVALUATE PV-SECTION-NAME4(PV-STR-INDEX11)                 19920000
199300                                                                  19930000
199400           WHEN 'From'                                            19940000
199500                                                                  19950000
199600               SET PS-FROM-NEED       TO TRUE                     19960000
199700                                                                  19970000
199800           WHEN 'MessageID'                                       19980000
199900                                                                  19990000
200000               SET PS-MSGID-NEED      TO TRUE                     20000000
200100                                                                  20010000
200200           WHEN 'CreateDateTime'                                  20020000
200300                                                                  20030000
200400               SET SV-CRDATM-NEED     TO TRUE                     20040000
200500                                                                  20050000
200600           WHEN 'ExpiryDateTime'                                  20060000
200700                                                                  20070000
200800                SET PS-EXDT-NEED      TO TRUE                     20080000
200900                                                                  20090000
201000           WHEN 'Action'                                          20100000
201100                                                                  20110000
201200                SET PS-ACT-NEED       TO TRUE                     20120000
201300                                                                  20130000
201400           WHEN 'To'                                              20140000
201500                                                                  20150000
201600                SET PS-TO-NEED        TO TRUE                     20160000
201700                                                                  20170000
201800           WHEN 'RoutingKeys'                                     20180000
201900                                                                  20190000
202000                SET PS-RKEYS-NEED     TO TRUE                     20200000
202100                                                                  20210000
202200           WHEN 'CorrelationID'                                   20220000
202300                                                                  20230000
202400                SET PS-CORID-NEED     TO TRUE                     20240000
202500                                                                  20250000
202600           WHEN 'Fault'                                           20260000
202700                                                                  20270000
202800                SET PS-FAULT-NEED     TO TRUE                     20280000
202900                                                                  20290000
203000           WHEN 'InReplyTo'                                       20300000
203100                                                                  20310000
203200                SET PS-INRPTO-NEED    TO TRUE                     20320000
203300                                                                  20330000
203400        END-EVALUATE                                              20340000
203500                                                                  20350000
203600        IF PV-SECTION-NAME4(PV-STR-INDEX11) = SPACES              20360000
203700                                                                  20370000
203800           SET PS-BREAK-THE-LOOP   TO TRUE                        20380000
203900                                                                  20390000
204000        END-IF                                                    20400000
204100                                                                  20410000
204200     END-PERFORM                                                  20420000
204300                                                                  20430000
204400     MOVE PV-STR-INDEX11             TO PV-NBR-O-ELEMENTS         20440000
204500           .                                                      20450000
204600******************************************************************20460000
204700* THIS SECTION CHECK IF ANY OF THE MANDATORY FIELDS (AS SPECIFIED 20470000
204800* IN CONFIG FILE) ARE NOT PRESENT. IF ANY MANDATORY FIELDS NOT    20480000
204900* PRESENT, A VALIDATION FAIL FLAG WOULD BE SET TO TRUE            20490000
205000*                                                                 20500000
205100* ONCE THE ABOVE CHECK IS DONE, THEN THIS SECTION LOOKS AT        20510000
205200* SPECIFIC FIELD VALIDATIONS.                                     20520000
205300*  1) THE MANDATORY FIELD 'FROM', NEEDS TO HAVE SYSTEMCODE, APP,  20530000
205400*     MODULE, NODEID IN REQUEST KMH. IF NOT PRESENT, ITS A        20540000
205500*     VALIDATION FAILURE                                          20550000
205600*  2) CREATEDATETIME FIELD, IN ADDITION TO BEING PRESENT, ALSO    20560000
205700*     NEEDS TO ADHERE TO UTC FORMAT                               20570000
205800*  3) EXPIRYDATETIME IS A OPTIONAL FIELD. BUT WHEN IT IS PRESENT  20580000
205900*     AND IS EXEPECTED TO BE PRESENT (CONFIG FILE), THEN, THE     20590000
206000*     CONTENT OF THIS FIELD NEEDS TO BE ADHERING TO UTC FORMAT    20600000
206100******************************************************************20610000
206200 2140-VALIDATE-MANDATE.                                           20620000
206300                                                                  20630000
206400     INITIALIZE PV-FAULT-MSG                                      20640000
206500                                                                  20650000
206600     IF PV-STOR-KMH-VER = SPACES                                  20660000
206700                                                                  20670000
206800        SET PS-VALIDATE-FAIL       TO TRUE                        20680000
206900                                                                  20690000
207000        STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED MESSA20700000
207100-          'GE HEADER ATTRIBUTE [version]'                        20710000
207200        DELIMITED BY SIZE                                         20720000
207300        INTO PV-FAULT-MSG                                         20730000
207400                                                                  20740000
207500     END-IF                                                       20750000
207600                                                                  20760000
207700     IF PV-STOR-KMH-VER NOT = PV-LITERAL-KMH-VER AND NOT          20770000
207800        PS-VALIDATE-FAIL                                          20780000
207900                                                                  20790000
208000        SET PS-VALIDATE-FAIL       TO TRUE                        20800000
208100                                                                  20810000
208200        STRING 'BAD MESSAGE HEADER ELEMENT. THE VERSION NUMBER SPE20820000
208300-          'CIFIED IN THE HEADER, '                               20830000
208400        DELIMITED BY SIZE                                         20840000
208500        PV-STOR-KMH-VER                                           20850000
208600        ', DOES NOT MATCH WITH THE EXPECTED VERSION '             20860000
208700        DELIMITED BY SIZE                                         20870000
208800        PV-LITERAL-KMH-VER                                        20880000
208900        DELIMITED BY SIZE                                         20890000
209000        INTO PV-FAULT-MSG                                         20900000
209100                                                                  20910000
209200     END-IF                                                       20920000
209300                                                                  20930000
209400     PERFORM VARYING PV-STR-INDEX9    FROM 1 BY 1                 20940000
209500     UNTIL PV-STR-INDEX9 > PV-NBR-M-ELEMENTS                      20950000
209600     OR PV-KMH-MANDATE(PV-STR-INDEX9) = ' '                       20960000
209700     OR PS-VALIDATE-FAIL                                          20970000
209800*       STRING 'PV-KMH-MANDATE(PV-STR-INDEX9): '                  20980000
209900*               PV-KMH-MANDATE(PV-STR-INDEX9)                     20990000
210000*              'PV-KMH-ELEMENT(PV-STR-INDEX9): '                  21000000
210100*               PV-KMH-ELEMENT(PV-STR-INDEX9)                     21010000
210200*              'PV-KMH-ELE-PRESENCE(PV-STR-INDEX9): '             21020000
210300*               PV-KMH-ELE-PRESENCE(PV-STR-INDEX9)                21030000
210400*              'PS-MANDATE-SW: ' PS-MANDATE-SW                    21040000
210500*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           21050000
210600*       PERFORM 9990-WRITE-CICS                                   21060000
210700                                                                  21070000
210800        IF PV-KMH-ELE-PRESENCE(PV-STR-INDEX9) NOT = 'Y'           21080000
210900                                                                  21090000
211000           SET PS-VALIDATE-FAIL       TO TRUE                     21100000
211100                                                                  21110000
211200           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME21120000
211300-          'SSAGE HEADER ELEMENT ['                               21130000
211400                  DELIMITED BY SIZE                               21140000
211500                  PV-KMH-ELEMENT(PV-STR-INDEX9) DELIMITED BY SPACE21150000
211600                  ']' DELIMITED BY SIZE                           21160000
211700                  INTO PV-FAULT-MSG                               21170000
211800                                                                  21180000
211900        END-IF                                                    21190000
212000                                                                  21200000
212100        IF PS-MSGID-NEED AND PS-VALIDATE-PASS                     21210000
212200           AND PV-KMH-ELEMENT(PV-STR-INDEX9) = 'MessageID'        21220000
212300                                                                  21230000
212400           IF PV-KMH-ELEMENT-VAL(PV-STR-INDEX9, 1) = SPACES       21240000
212500                                                                  21250000
212600              SET PS-VALIDATE-FAIL  TO TRUE                       21260000
212700                                                                  21270000
212800              STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED21280000
212900-             ' MESSAGE HEADER ELEMENT ['                         21290000
213000              DELIMITED BY SIZE                                   21300000
213100              PV-KMH-ELEMENT(PV-STR-INDEX9) DELIMITED BY SPACE    21310000
213200              ']' DELIMITED BY SIZE                               21320000
213300              INTO PV-FAULT-MSG                                   21330000
213400                                                                  21340000
213500           END-IF                                                 21350000
213600                                                                  21360000
213700        END-IF                                                    21370000
213800                                                                  21380000
213900        IF ( SV-CRDATM-NEED AND PS-VALIDATE-PASS                  21390000
214000           AND PV-KMH-ELEMENT(PV-STR-INDEX9) = 'CreateDateTime')  21400000
214100                                                                  21410000
214200           MOVE PV-KMH-ELEMENT-VAL(PV-STR-INDEX9, 1)              21420000
214300                                TO PV-VALIDATE-DTM                21430000
214400                                                                  21440000
214500           PERFORM VARYING PV-STR-INDEX14 FROM 1 BY 1             21450000
214600           UNTIL PS-VALIDATE-FAIL OR PV-STR-INDEX14 > 24          21460000
214700                                                                  21470000
214800              EVALUATE PV-STR-INDEX14                             21480000
214900                                                                  21490000
215000                 WHEN 1                                           21500000
215100                 WHEN 2                                           21510000
215200                 WHEN 3                                           21520000
215300                 WHEN 4                                           21530000
215400                 WHEN 6                                           21540000
215500                 WHEN 7                                           21550000
215600                 WHEN 9                                           21560000
215700                 WHEN 10                                          21570000
215800                 WHEN 12                                          21580000
215900                 WHEN 13                                          21590000
216000                 WHEN 15                                          21600000
216100                 WHEN 16                                          21610000
216200                 WHEN 18                                          21620000
216300                 WHEN 19                                          21630000
216400                 WHEN 21                                          21640000
216500                 WHEN 22                                          21650000
216600                 WHEN 23                                          21660000
216700                                                                  21670000
216800                    IF PV-VALIDATE-DTM(PV-STR-INDEX14:1)          21680000
216900                       NOT NUMERIC                                21690000
217000                                                                  21700000
217100                       SET PS-VALIDATE-FAIL  TO TRUE              21710000
217200                                                                  21720000
217300                    END-IF                                        21730000
217400                                                                  21740000
217500                 WHEN 5                                           21750000
217600                 WHEN 8                                           21760000
217700                                                                  21770000
217800                   IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '-' 21780000
217900                                                                  21790000
218000                      SET PS-VALIDATE-FAIL  TO TRUE               21800000
218100                                                                  21810000
218200                   END-IF                                         21820000
218300                                                                  21830000
218400                 WHEN 11                                          21840000
218500                                                                  21850000
218600                   IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'T' 21860000
218700                                                                  21870000
218800*                     STRING 'PV-VALIDATE-DTM NOT = T'            21880000
218900*                            'PV-STR-INDEX14: ' PV-STR-INDEX14    21890000
219000*                             DELIMITED BY SIZE INTO              21900000
219100*                             PV-CICS-MSG-AREA                    21910000
219200*                     PERFORM 9990-WRITE-CICS                     21920000
219300                      SET PS-VALIDATE-FAIL  TO TRUE               21930000
219400                                                                  21940000
219500                   END-IF                                         21950000
219600                                                                  21960000
219700                 WHEN 14                                          21970000
219800                 WHEN 17                                          21980000
219900                                                                  21990000
220000                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = ':'    22000000
220100                                                                  22010000
220200*                     STRING 'PV-VALIDATE-DTM NOT = :'            22020000
220300*                            'PV-STR-INDEX14: ' PV-STR-INDEX14    22030000
220400*                             DELIMITED BY SIZE                   22040000
220500*                             INTO PV-CICS-MSG-AREA               22050000
220600*                     PERFORM 9990-WRITE-CICS                     22060000
220700                      SET PS-VALIDATE-FAIL  TO TRUE               22070000
220800                                                                  22080000
220900                END-IF                                            22090000
221000                                                                  22100000
221100              WHEN 20                                             22110000
221200                                                                  22120000
221300                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '.'    22130000
221400                                                                  22140000
221500*                  STRING  'PV-VALIDATE-DTM NOT = .'              22150000
221600*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             22160000
221700*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       22170000
221800*                  PERFORM 9990-WRITE-CICS                        22180000
221900                                                                  22190000
222000                   SET PS-VALIDATE-FAIL  TO TRUE                  22200000
222100                                                                  22210000
222200                END-IF                                            22220000
222300                                                                  22230000
222400              WHEN 24                                             22240000
222500                                                                  22250000
222600                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'Z'    22260000
222700*                  STRING  'PV-VALIDATE-DTM NOT = Z'              22270000
222800*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             22280000
222900*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        22290000
223000*                  PERFORM 9990-WRITE-CICS                        22300000
223100                                                                  22310000
223200                   SET PS-VALIDATE-FAIL  TO TRUE                  22320000
223300                                                                  22330000
223400                END-IF                                            22340000
223500                                                                  22350000
223600            END-EVALUATE                                          22360000
223700                                                                  22370000
223800          END-PERFORM                                             22380000
223900                                                                  22390000
224000          IF PS-VALIDATE-FAIL                                     22400000
224100                                                                  22410000
224200             STRING 'BAD MESSAGE HEADER ELEMENT. '                22420000
224300                     DELIMITED BY SIZE                            22430000
224400                     PV-KMH-ELEMENT(PV-STR-INDEX9)                22440000
224500                     DELIMITED BY SPACE                           22450000
224600                   ' ELEMENT CONTAINS IMPROPER DATE-TIME FORMAT: '22460000
224700                     DELIMITED BY SIZE                            22470000
224800                     PV-VALIDATE-DTM DELIMITED BY SIZE            22480000
224900                     INTO PV-FAULT-MSG                            22490000
225000                                                                  22500000
225100          END-IF                                                  22510000
225200        END-IF                                                    22520000
225300                                                                  22530000
225400     END-PERFORM                                                  22540000
225500                                                                  22550000
225600     IF PS-IN-MSG-FRM-YES   AND PS-VALIDATE-PASS                  22560000
225700                                                                  22570000
225800        IF PS-IN-SYS-CD-NO OR ( PV-IN-MSG-SYSCD = SPACES )        22580000
225900                                                                  22590000
226000           SET PS-VALIDATE-FAIL  TO TRUE                          22600000
226100           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22610000
226200-          'SSAGE HEADER ATTRIBUTE [systemCode] of element [From]'22620000
226300           DELIMITED BY SIZE                                      22630000
226400           INTO PV-FAULT-MSG                                      22640000
226500                                                                  22650000
226600        END-IF                                                    22660000
226700                                                                  22670000
226800        IF NOT PS-VALIDATE-FAIL AND                               22680000
226900             ( PS-IN-APP-CD-NO OR ( PV-IN-MSG-APPCD = SPACES ))   22690000
227000                                                                  22700000
227100           SET PS-VALIDATE-FAIL  TO TRUE                          22710000
227200                                                                  22720000
227300           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22730000
227400-          'SSAGE HEADER ATTRIBUTE [app] of element [From]'       22740000
227500           DELIMITED BY SIZE                                      22750000
227600                                                                  22760000
227700           INTO PV-FAULT-MSG                                      22770000
227800                                                                  22780000
227900        END-IF                                                    22790000
228000                                                                  22800000
228100        IF NOT PS-VALIDATE-FAIL AND                               22810000
228200             ( PS-IN-MOD-CD-NO OR ( PV-IN-MSG-MODCD = SPACES ))   22820000
228300           SET PS-VALIDATE-FAIL  TO TRUE                          22830000
228400                                                                  22840000
228500           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22850000
228600-          'SSAGE HEADER ATTRIBUTE [module] of element [From]'    22860000
228700           DELIMITED BY SIZE                                      22870000
228800                                                                  22880000
228900           INTO PV-FAULT-MSG                                      22890000
229000        END-IF                                                    22900000
229100                                                                  22910000
229200        IF NOT PS-VALIDATE-FAIL AND                               22920000
229300             ( PS-IN-NOD-ID-NO OR ( PV-IN-MSG-NODID = SPACES ))   22930000
229400                                                                  22940000
229500           SET PS-VALIDATE-FAIL  TO TRUE                          22950000
229600                                                                  22960000
229700           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME22970000
229800-          'SSAGE HEADER ATTRIBUTE [nodeID] of element [From]'    22980000
229900           DELIMITED BY SIZE                                      22990000
230000           INTO PV-FAULT-MSG                                      23000000
230100                                                                  23010000
230200        END-IF                                                    23020000
230300     END-IF                                                       23030000
230400                                                                  23040000
230500     IF PS-VALIDATE-PASS AND PS-FUNC-REC-RESP                     23050000
230600        IF NOT PS-IN-MSG-INRPT-D                                  23060000
230700                                                                  23070000
230800           SET PS-VALIDATE-FAIL  TO TRUE                          23080000
230900                                                                  23090000
231000           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME23100000
231100-          'SSAGE HEADER ELEMENT [InReplyTo]'                     23110000
231200           DELIMITED BY SIZE                                      23120000
231300           INTO PV-FAULT-MSG                                      23130000
231400                                                                  23140000
231500        END-IF                                                    23150000
231600                                                                  23160000
231700        IF PS-IN-MSG-INRPT-D AND PV-IN-MSG-INRPTO = SPACES        23170000
231800                                                                  23180000
231900           SET PS-VALIDATE-FAIL  TO TRUE                          23190000
232000                                                                  23200000
232100           STRING 'BAD MESSAGE HEADER ELEMENT. MISSING REQUIRED ME23210000
232200-          'SSAGE HEADER ELEMENT [InReplyTo]'                     23220000
232300           DELIMITED BY SIZE INTO PV-FAULT-MSG                    23230000
232400                                                                  23240000
232500        END-IF                                                    23250000
232600     END-IF                                                       23260000
232700* VALIDATE OPTIONAL FIELDS                                        23270000
232800*    DISPLAY 'PS-EXDT-SW: ' PS-EXDT-SW                            23280000
232900*    DISPLAY 'PS-MANDATE-SW: ' PS-MANDATE-SW                      23290000
233000*    DISPLAY 'PS-IN-MSG-EXDT-Y: ' PS-IN-MSG-EXDT-SW               23300000
233100        IF PS-EXDT-NEED AND PS-VALIDATE-PASS                      23310000
233200                                                                  23320000
233300        AND PS-IN-MSG-EXDT-Y                                      23330000
233400                                                                  23340000
233500          MOVE PV-IN-MSG-EXDT TO PV-VALIDATE-DTM                  23350000
233600                                                                  23360000
233700          PERFORM VARYING PV-STR-INDEX14 FROM 1 BY 1              23370000
233800          UNTIL PS-VALIDATE-FAIL OR PV-STR-INDEX14 > 24           23380000
233900                                                                  23390000
234000            EVALUATE PV-STR-INDEX14                               23400000
234100                                                                  23410000
234200              WHEN 1                                              23420000
234300              WHEN 2                                              23430000
234400              WHEN 3                                              23440000
234500              WHEN 4                                              23450000
234600              WHEN 6                                              23460000
234700              WHEN 7                                              23470000
234800              WHEN 9                                              23480000
234900              WHEN 10                                             23490000
235000              WHEN 12                                             23500000
235100              WHEN 13                                             23510000
235200              WHEN 15                                             23520000
235300              WHEN 16                                             23530000
235400              WHEN 18                                             23540000
235500              WHEN 19                                             23550000
235600              WHEN 21                                             23560000
235700              WHEN 22                                             23570000
235800              WHEN 23                                             23580000
235900                                                                  23590000
236000                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT NUMERIC  23600000
236100                                                                  23610000
236200*                  STRING  'PV-VALIDATE-DTM NOT NUMERIC'          23620000
236300*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             23630000
236400*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       23640000
236500*                  PERFORM 9990-WRITE-CICS                        23650000
236600                   SET PS-VALIDATE-FAIL  TO TRUE                  23660000
236700                                                                  23670000
236800                END-IF                                            23680000
236900                                                                  23690000
237000              WHEN 5                                              23700000
237100              WHEN 8                                              23710000
237200                                                                  23720000
237300                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '-'    23730000
237400                                                                  23740000
237500*                  STRING  'PV-VALIDATE-DTM NOT = -'              23750000
237600*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             23760000
237700*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        23770000
237800*                  PERFORM 9990-WRITE-CICS                        23780000
237900                                                                  23790000
238000                   SET PS-VALIDATE-FAIL  TO TRUE                  23800000
238100                                                                  23810000
238200                END-IF                                            23820000
238300                                                                  23830000
238400              WHEN 11                                             23840000
238500                                                                  23850000
238600                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'T'    23860000
238700*                  STRING  'PV-VALIDATE-DTM NOT = T'              23870000
238800*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             23880000
238900*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       23890000
239000*                  PERFORM 9990-WRITE-CICS                        23900000
239100                                                                  23910000
239200                   SET PS-VALIDATE-FAIL  TO TRUE                  23920000
239300                                                                  23930000
239400                END-IF                                            23940000
239500                                                                  23950000
239600              WHEN 14                                             23960000
239700              WHEN 17                                             23970000
239800                                                                  23980000
239900                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = ':'    23990000
240000*                  STRING  'PV-VALIDATE-DTM NOT = :'              24000000
240100*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             24010000
240200*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       24020000
240300*                  PERFORM 9990-WRITE-CICS                        24030000
240400                                                                  24040000
240500                   SET PS-VALIDATE-FAIL  TO TRUE                  24050000
240600                                                                  24060000
240700                END-IF                                            24070000
240800                                                                  24080000
240900              WHEN 20                                             24090000
241000                                                                  24100000
241100                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = '.'    24110000
241200*                  STRING  'PV-VALIDATE-DTM NOT = .'              24120000
241300*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             24130000
241400*                   DELIMITED BY SIZE INTO PV-CICS-MSG-AREA       24140000
241500*                  PERFORM 9990-WRITE-CICS                        24150000
241600                                                                  24160000
241700                   SET PS-VALIDATE-FAIL  TO TRUE                  24170000
241800                                                                  24180000
241900                END-IF                                            24190000
242000                                                                  24200000
242100              WHEN 24                                             24210000
242200                                                                  24220000
242300                IF PV-VALIDATE-DTM(PV-STR-INDEX14:1) NOT = 'Z'    24230000
242400*                  STRING  'PV-VALIDATE-DTM NOT = Z'              24240000
242500*                   'PV-STR-INDEX14: ' PV-STR-INDEX14             24250000
242600*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        24260000
242700*                  PERFORM 9990-WRITE-CICS                        24270000
242800                                                                  24280000
242900                   SET PS-VALIDATE-FAIL  TO TRUE                  24290000
243000                                                                  24300000
243100                END-IF                                            24310000
243200                                                                  24320000
243300            END-EVALUATE                                          24330000
243400          END-PERFORM                                             24340000
243500                                                                  24350000
243600          IF PS-VALIDATE-FAIL                                     24360000
243700                                                                  24370000
243800           STRING 'BAD MESSAGE HEADER ELEMENT. '                  24380000
243900           DELIMITED BY SIZE                                      24390000
244000           'ExpiryDateTime' DELIMITED BY SIZE                     24400000
244100           ' ELEMENT CONTAINS IMPROPER DATE-TIME FORMAT: '        24410000
244200           DELIMITED BY SIZE                                      24420000
244300           PV-VALIDATE-DTM DELIMITED BY SIZE                      24430000
244400           INTO PV-FAULT-MSG                                      24440000
244500                                                                  24450000
244600          END-IF                                                  24460000
244700        END-IF                                                    24470000
244800           .                                                      24480000
244900******************************************************************24490000
245000* THIS SECTION LOGS THE ERROR MESSAGE IN SPOOL                    24500000
245100******************************************************************24510000
245200                                                                  24520000
245300 2150-PERFORM-SPOOL-LOG.                                          24530000
245400                                                                  24540000
245500     INITIALIZE PV-SPOOL-LOG-MSG                                  24550000
245600                                                                  24560000
245700      IF PS-FUNC-REC-RESP                                         24570000
245800                                                                  24580000
245900       STRING  PV-CURR-DATE DELIMITED BY SIZE                     24590000
246000               '||WARNING||' DELIMITED BY SIZE                    24600000
246100               'FAULT-MESSAGE:   ' DELIMITED BY SIZE              24610000
246200               PV-FAULT-MSG DELIMITED BY SIZE                     24620000
246300       INTO PV-SPOOL-LOG-MSG                                      24630000
246400                                                                  24640000
246500      ELSE                                                        24650000
246600                                                                  24660000
246700       STRING  PV-CURR-DATE DELIMITED BY SIZE                     24670000
246800               '||ERROR||' DELIMITED BY SIZE                      24680000
246900               'FAULT-MESSAGE:   ' DELIMITED BY SIZE              24690000
247000               PV-FAULT-MSG DELIMITED BY SIZE                     24700000
247100       INTO PV-SPOOL-LOG-MSG                                      24710000
247200                                                                  24720000
247300      END-IF                                                      24730000
247400                                                                  24740000
247500     MOVE 1                 TO PV-CSS-DSP-LEN                     24750000
247600     MOVE 80                TO PV-CSS-DSP-TO-LEN                  24760000
247700     MOVE LENGTH OF PV-SPOOL-LOG-MSG TO PV-SPOOL-LOG-LEN          24770000
247800                                                                  24780000
247900     PERFORM UNTIL PV-CSS-DSP-LEN > PV-SPOOL-LOG-LEN              24790000
248000                                                                  24800000
248100      STRING  PV-SPOOL-LOG-MSG(PV-CSS-DSP-LEN:PV-CSS-DSP-TO-LEN)  24810000
248200         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  24820000
248300      PERFORM 9990-WRITE-CICS                                     24830000
248400                                                                  24840000
248500      COMPUTE PV-CSS-DSP-LEN = 1 + PV-CSS-DSP-TO-LEN              24850000
248600      COMPUTE PV-CSS-DSP-TO-LEN = 80 + PV-CSS-DSP-TO-LEN          24860000
248700                                                                  24870000
248800     END-PERFORM                                                  24880000
248900           .                                                      24890000
249000******************************************************************24900000
249100* THIS SECTION CREATES SOAP FAULT AND IS INVOKED IF ANY VALIDATION24910000
249200* FAILURE OF A INCOMING REQUEST MESSAGE OCCURS                    24920000
249300******************************************************************24930000
249400                                                                  24940000
249500 2510-CREATE-SOAP-FAULT.                                          24950000
249600                                                                  24960000
249700     INITIALIZE PV-RESP                                           24970000
249800                PV-FAULT-CODE                                     24980000
249900                PS-SOAP-LEVEL                                     24990000
250000                PV-SOAP-LVL-LEN                                   25000000
250100                                                                  25010000
250200*    STRING  'GET CONTAINER DFHWS-SOAPLEVEL'                      25020000
250300*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25030000
250400*    PERFORM 9990-WRITE-CICS                                      25040000
250500     EXEC CICS                                                    25050000
250600         GET CONTAINER('DFHWS-SOAPLEVEL')                         25060000
250700         INTO(PS-SOAP-LEVEL)                                      25070000
250800         FLENGTH(PV-SOAP-LVL-LEN)                                 25080000
250900         RESP(PV-RESP)                                            25090000
251000     END-EXEC                                                     25100000
251100                                                                  25110000
251200     IF PS-SOAP-11                                                25120000
251300                                                                  25130000
251400        MOVE DFHVALUE(CLIENT) TO PV-FAULT-CODE                    25140000
251500                                                                  25150000
251600     ELSE                                                         25160000
251700                                                                  25170000
251800        MOVE DFHVALUE(SENDER) TO PV-FAULT-CODE                    25180000
251900                                                                  25190000
252000     END-IF                                                       25200000
252100                                                                  25210000
252200*    STRING  'ISSUING SOAPFAULT'                                  25220000
252300*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25230000
252400*    PERFORM 9990-WRITE-CICS                                      25240000
252500     STRING  PV-CURR-DATE DELIMITED BY SIZE                       25250000
252600             '||ERROR||' DELIMITED BY SIZE                        25260000
252700             'FAULT-MESSAGE:   ' DELIMITED BY SIZE                25270000
252800             PV-FAULT-MSG DELIMITED BY SIZE                       25280000
252900      INTO PV-FAULT-MSG-1                                         25290000
253000                                                                  25300000
253100     EXEC CICS SOAPFAULT CREATE                                   25310000
253200         FAULTSTRING(PV-FAULT-MSG-1)                              25320000
253300         FAULTSTRLEN(LENGTH OF PV-FAULT-MSG-1)                    25330000
253400         FAULTCODE(PV-FAULT-CODE)                                 25340000
253500         RESP(PV-RESP)                                            25350000
253600     END-EXEC                                                     25360000
253700                                                                  25370000
253800*    MOVE   PV-RESP            TO PV-RESP-DISP                    25380000
253900*    STRING  'PV-RESP AFTER SOAP FAULT: ' PV-RESP-DISP            25390000
254000*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25400000
254100*    PERFORM 9990-WRITE-CICS                                      25410000
254200     .                                                            25420000
254300******************************************************************25430000
254400* THIS SECTION GENERATES UTC                                      25440000
254500* 1) CALL CEEGMT TO OBTAIN CURRENT GMT IN SECS FORMAT             25450000
254600* 2) CALL CEEDATM TO CONVERT THE SECONDS INTO                     25460000
254700*    'YYYY-MM-DDTHH:MI:SS.999Z' FORMAT                            25470000
254800******************************************************************25480000
254900* UTC TIME HANDLING                                               25490000
255000 1008-GENERATE-UTC.                                               25500000
255100                                                                  25510000
255200     INITIALIZE PV-UTC-DATE                                       25520000
255300                                                                  25530000
255400     CALL 'CEEGMT' USING PV-LILIAN , PV-CEE-SECS , PV-FC.         25540000
255500                                                                  25550000
255600     IF PV-COND-TOKEN-VALUE = LOW-VALUES THEN                     25560000
255700                                                                  25570000
255800        MOVE PV-CEE-SECS TO PV-SECS                               25580000
255900        MOVE PV-CEE-SECS TO PV-SAVED-SECS                         25590000
256000                                                                  25600000
256100     ELSE                                                         25610000
256200                                                                  25620000
256300*       STRING  'CEEGMT failed with msg '                         25630000
256400*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25640000
256500*       PERFORM 9990-WRITE-CICS                                   25650000
256600        EXEC CICS ABEND ABCODE('C021') END-EXEC                   25660000
256700                                                                  25670000
256800     END-IF                                                       25680000
256900                                                                  25690000
257000     MOVE 24 TO PV-STRING-LENGTH OF PV-PICSTR                     25700000
257100     MOVE 'YYYY-MM-DDTHH:MI:SS.999Z' TO                           25710000
257200           PV-STRING-TEXT OF PV-PICSTR(1:24)                      25720000
257300                                                                  25730000
257400     CALL 'CEEDATM' USING PV-CEE-SECS,                            25740000
257500                          PV-PICSTR,                              25750000
257600                          PV-CHRDATE,                             25760000
257700                          PV-FC.                                  25770000
257800                                                                  25780000
257900     IF PV-COND-TOKEN-VALUE = LOW-VALUES THEN                     25790000
258000                                                                  25800000
258100*       STRING  'Input Lilian date '                              25810000
258200*               'corresponds to:  ' PV-CHRDATE                    25820000
258300*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           25830000
258400*       PERFORM 9990-WRITE-CICS                                   25840000
258500        MOVE PV-CHRDATE TO PV-UTC-DATE                            25850000
258600                                                                  25860000
258700     ELSE                                                         25870000
258800                                                                  25880000
258900*       STRING  'CEEDATE failed with msg '                        25890000
259000*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  25900000
259100*       PERFORM 9990-WRITE-CICS                                   25910000
259200                                                                  25920000
259300        EXEC CICS ABEND ABCODE('C022') END-EXEC                   25930000
259400                                                                  25940000
259500     END-IF                                                       25950000
259600           .                                                      25960000
259700******************************************************************25970000
259800* MESSAGEID IS EXPECTED TO BE A UUID. SINCE UUID GENERATION IS NOT25980000
259900* POSSIBLE FROM WITHIN MAINFRAME, A SIMILAR UNIQUE ID IS TO BE    25990000
260000* GENERATED USING:                                                26000000
260100* 1) LAST 5 CHARACTERS OF PIPELINE NAME                           26010000
260200* 2) 7 CHARACTERS OF EIBTASKN                                     26020000
260300* 3) 18 CHARACTERS OF CURRENT GMT IN SECONDS FORMAT OBTAINED IN   26030000
260400*    1008-GENERATE-UTC                                            26040000
260500******************************************************************26050000
260600* OBTAIN PIPELINE NAME AND THE TASKN ID ASSOCIATED                26060000
260700 2420-GENERATE-MSGID.                                             26070000
260800                                                                  26080000
260900     INITIALIZE PV-RESP                                           26090000
261000*    STRING  'READ DFHWS-PIPELINE'                                26100000
261100*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  26110000
261200*    PERFORM 9990-WRITE-CICS                                      26120000
261300                                                                  26130000
261400     EXEC CICS                                                    26140000
261500       GET CONTAINER('DFHWS-PIPELINE')                            26150000
261600       INTO(PV-PIPE-AREA)                                         26160000
261700       FLENGTH(PV-PIPE-LEN)                                       26170000
261800       RESP(PV-RESP)                                              26180000
261900     END-EXEC                                                     26190000
262000                                                                  26200000
262100     EVALUATE PV-RESP                                             26210000
262200                                                                  26220000
262300       WHEN DFHRESP(CCSIDERR)                                     26230000
262400                                                                  26240000
262500           EXEC CICS ABEND ABCODE('C023') END-EXEC                26250000
262600                                                                  26260000
262700           CONTINUE                                               26270000
262800                                                                  26280000
262900       WHEN DFHRESP(CONTAINERERR)                                 26290000
263000           EXEC CICS ABEND ABCODE('C024') END-EXEC                26300000
263100                                                                  26310000
263200           CONTINUE                                               26320000
263300                                                                  26330000
263400       WHEN DFHRESP(INVREQ)                                       26340000
263500                                                                  26350000
263600           EXEC CICS ABEND ABCODE('C025') END-EXEC                26360000
263700                                                                  26370000
263800           CONTINUE                                               26380000
263900                                                                  26390000
264000       WHEN DFHRESP(LENGERR)                                      26400000
264100                                                                  26410000
264200           EXEC CICS ABEND ABCODE('C026') END-EXEC                26420000
264300                                                                  26430000
264400           CONTINUE                                               26440000
264500                                                                  26450000
264600     END-EVALUATE                                                 26460000
264700                                                                  26470000
264800*    STRING  'PV-PIPE-AREA :' PV-PIPE-AREA                        26480000
264900*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  26490000
265000*    PERFORM 9990-WRITE-CICS                                      26500000
265100                                                                  26510000
265200     MOVE PV-PIPE-AREA              TO PV-PIPE-AREA-SPLIT         26520000
265300     MOVE EIBTASKN                  TO PV-TASKN                   26530000
265400*    DISPLAY 'PV-TASK-NBR : ' PV-TASK-NBR                         26540000
265500     MOVE PV-TASK-NBR(1:1)          TO PV-TASK1                   26550000
265600     MOVE PV-TASK-NBR(2:4)          TO PV-TASK2                   26560000
265700     MOVE PV-TASK-NBR(6:2)          TO PV-TASK3                   26570000
265800     MOVE PV-SECS2(1:2)             TO PV-SEC-1                   26580000
265900     MOVE PV-SECS2(3:4)             TO PV-SEC-2                   26590000
266000     MOVE PV-SECS2(7:12)            TO PV-SEC-3                   26600000
266100                                                                  26610000
266200     STRING PV-MSGID-MF-LITERAL DELIMITED BY SIZE                 26620000
266300            PV-PIPE-AREA-SPLIT  DELIMITED BY SIZE                 26630000
266400            PV-TASKN-SPLIT      DELIMITED BY SIZE                 26640000
266500            PV-SECS2-SPLIT      DELIMITED BY SIZE                 26650000
266600     INTO   PV-NEW-MESSAGE-ID                                     26660000
266700                                                                  26670000
266800           .                                                      26680000
266900******************************************************************26690000
267000* WHILE PREPARING KMH, IF 'FROM' ELEMENT IS LISTED AS MANDATORY,  26700000
267100* THEN THIS SECTION PERFORMS BELOW:                               26710000
267200* RETRIEVE SYSTEMCD, APP, MODULE & NODEID DETAILS FROM CONFIG FILE26720000
267300* AND COMPOSE 'FROM' ELEMENT                                      26730000
267400******************************************************************26740000
267500 2430-GENERATE-FROM.                                              26750000
267600                                                                  26760000
267700     INITIALIZE TR071-CA-CONFIG-RECORD                            26770000
267800                PV-CONFIG-RECORD                                  26780000
267900                PV-STR-INDEX10                                    26790000
268000                                                                  26800000
268100     MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                  26810000
268200     MOVE 1                   TO TR071-SEQ-NO                     26820000
268300                                                                  26830000
268400     PERFORM VARYING PV-STR-INDEX10 FROM 1 BY 1 UNTIL             26840000
268500     PV-STR-INDEX10 > 4                                           26850000
268600                                                                  26860000
268700       EVALUATE PV-STR-INDEX10                                    26870000
268800                                                                  26880000
268900         WHEN 1                                                   26890000
269000                                                                  26900000
269100            MOVE 'systemCode'         TO TR071-FUNC-AREA          26910000
269200                                                                  26920000
269300         WHEN 2                                                   26930000
269400                                                                  26940000
269500            MOVE 'app'                TO TR071-FUNC-AREA          26950000
269600                                                                  26960000
269700         WHEN 3                                                   26970000
269800                                                                  26980000
269900            MOVE 'module'             TO TR071-FUNC-AREA          26990000
270000                                                                  27000000
270100         WHEN 4                                                   27010000
270200                                                                  27020000
270300            MOVE 'nodeID'             TO TR071-FUNC-AREA          27030000
270400                                                                  27040000
270500       END-EVALUATE                                               27050000
270600                                                                  27060000
270700       PERFORM 7000-VSAM-FILE-READ                                27070000
270800                                                                  27080000
270900       EVALUATE PV-RESP                                           27090000
271000                                                                  27100000
271100          WHEN 0                                                  27110000
271200                                                                  27120000
271300              CONTINUE                                            27130000
271400                                                                  27140000
271500          WHEN 13                                                 27150000
271600                                                                  27160000
271700              MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA         27170000
271800                                                                  27180000
271900              PERFORM 7000-VSAM-FILE-READ                         27190000
272000                                                                  27200000
272100              IF PV-RESP = 13                                     27210000
272200                                                                  27220000
272300                 EXEC CICS ABEND ABCODE('C027') END-EXEC          27230000
272400                                                                  27240000
272500                 CONTINUE                                         27250000
272600                                                                  27260000
272700              END-IF                                              27270000
272800                                                                  27280000
272900       END-EVALUATE                                               27290000
273000                                                                  27300000
273100* UNSTRING PV-CONFIG-RECORD                                       27310000
273200       MOVE PV-CONFIG-RECORD          TO TR071-CA-CONFIG-RECORD   27320000
273300                                                                  27330000
273400       EVALUATE PV-STR-INDEX10                                    27340000
273500                                                                  27350000
273600         WHEN 1                                                   27360000
273700                                                                  27370000
273800            MOVE TR071-FREE-TEXT      TO PV-NEW-SYSTEM-CD         27380000
273900                                                                  27390000
274000         WHEN 2                                                   27400000
274100                                                                  27410000
274200            MOVE TR071-FREE-TEXT      TO PV-NEW-APP               27420000
274300                                                                  27430000
274400         WHEN 3                                                   27440000
274500                                                                  27450000
274600            MOVE TR071-FREE-TEXT      TO PV-NEW-MODULE            27460000
274700                                                                  27470000
274800         WHEN 4                                                   27480000
274900                                                                  27490000
275000            MOVE TR071-FREE-TEXT      TO PV-NEW-NODEID            27500000
275100                                                                  27510000
275200       END-EVALUATE                                               27520000
275300                                                                  27530000
275400     END-PERFORM                                                  27540000
275500                                                                  27550000
275600     MOVE PV-HOST-NAME                TO PV-NEW-NODEID            27560000
275700           .                                                      27570000
275800******************************************************************27580000
275900* THIS SECTION RETRIEVES THE ADDITIONAL OPTIONAL FIELDS NEEDED TO 27590000
276000* BUILD KMH FROM CONFIG FILE AND GENERATES THEM                   27600000
276100* IF NEW FIELDS NEED TO BE ADDED TO THE CURRENT LIST OF OPTIONAL  27610000
276200* FIELDS, THEN THIS SECTION WOULD NEED CHANGE TO SET THE          27620000
276300* 'FIELD-REQUIRED' FLAG TO TRUE. FURTHER, A NEW SECTION WOULD     27630000
276400* NEED TO BE CODED, TO BUILD THE NEW FIELD. ALSO, THIS FIELD NEEDS27640000
276500* TO BE ADDED TO THE CONFIG FILE                                  27650000
276600******************************************************************27660000
276700 2410-OPT-HDR-FLDS.                                               27670000
276800                                                                  27680000
276900     INITIALIZE TR071-CA-CONFIG-RECORD                            27690000
277000                PV-CONFIG-RECORD                                  27700000
277100                                                                  27710000
277200     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   27720000
277300        UNTIL PV-STR-INDEX11 > 99                                 27730000
277400                                                                  27740000
277500        MOVE SPACES           TO                                  27750000
277600        PV-SECTION-NAME4(PV-STR-INDEX11)                          27760000
277700                                                                  27770000
277800     END-PERFORM                                                  27780000
277900                                                                  27790000
278000     MOVE 'OPTIONAL'         TO TR071-FUNC-AREA                   27800000
278100* FIRST TRY WITH CURRENT WEBSERVICE NAME                          27810000
278200     MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                  27820000
278300     MOVE 1                   TO TR071-SEQ-NO                     27830000
278400                                                                  27840000
278500     PERFORM 7000-VSAM-FILE-READ                                  27850000
278600                                                                  27860000
278700     EVALUATE PV-RESP                                             27870000
278800                                                                  27880000
278900        WHEN 0                                                    27890000
279000                                                                  27900000
279100            CONTINUE                                              27910000
279200                                                                  27920000
279300        WHEN 13                                                   27930000
279400                                                                  27940000
279500* ROW NOT FOUND. USE DEFAULT WEBSERVICE NAME                      27950000
279600            MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA           27960000
279700                                                                  27970000
279800            PERFORM 7000-VSAM-FILE-READ                           27980000
279900                                                                  27990000
280000            IF PV-RESP NOT = 0                                    28000000
280100                                                                  28010000
280200               EXEC CICS ABEND ABCODE('C028') END-EXEC            28020000
280300               CONTINUE                                           28030000
280400                                                                  28040000
280500            END-IF                                                28050000
280600                                                                  28060000
280700        WHEN OTHER                                                28070000
280800                                                                  28080000
280900            EXEC CICS ABEND ABCODE('C029') END-EXEC               28090000
281000                                                                  28100000
281100     END-EVALUATE                                                 28110000
281200* UNSTRING PV-CONFIG-RECORD                                       28120000
281300                                                                  28130000
281400     MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD    28140000
281500     MOVE 1                          TO PV-STRING-PTR-4           28150000
281600     MOVE 0                          TO PV-NBR-O-ELEMENTS         28160000
281700     SET PS-CONT-THE-LOOP            TO TRUE                      28170000
281800                                                                  28180000
281900     PERFORM VARYING PV-STR-INDEX11 FROM 1 BY 1                   28190000
282000        UNTIL PV-STR-INDEX11 > 99 OR                              28200000
282100        PS-BREAK-THE-LOOP                                         28210000
282200                                                                  28220000
282300        UNSTRING TR071-FREE-TEXT DELIMITED BY ';'                 28230000
282400          INTO PV-SECTION-NAME4(PV-STR-INDEX11)                   28240000
282500          WITH POINTER PV-STRING-PTR-4                            28250000
282600        END-UNSTRING                                              28260000
282700                                                                  28270000
282800        EVALUATE PV-SECTION-NAME4(PV-STR-INDEX11)                 28280000
282900                                                                  28290000
283000           WHEN 'From'                                            28300000
283100                                                                  28310000
283200               SET PS-FROM-NEED       TO TRUE                     28320000
283300                                                                  28330000
283400           WHEN 'MessageID'                                       28340000
283500                                                                  28350000
283600               SET PS-MSGID-NEED      TO TRUE                     28360000
283700                                                                  28370000
283800           WHEN 'CreateDateTime'                                  28380000
283900                                                                  28390000
284000               SET SV-CRDATM-NEED     TO TRUE                     28400000
284100                                                                  28410000
284200           WHEN 'ExpiryDateTime'                                  28420000
284300                                                                  28430000
284400                SET PS-EXDT-NEED      TO TRUE                     28440000
284500                                                                  28450000
284600           WHEN 'Action'                                          28460000
284700                                                                  28470000
284800                SET PS-ACT-NEED       TO TRUE                     28480000
284900                                                                  28490000
285000           WHEN 'To'                                              28500000
285100                                                                  28510000
285200                SET PS-TO-NEED        TO TRUE                     28520000
285300                                                                  28530000
285400           WHEN 'RoutingKeys'                                     28540000
285500                                                                  28550000
285600                SET PS-RKEYS-NEED     TO TRUE                     28560000
285700                                                                  28570000
285800           WHEN 'CorrelationID'                                   28580000
285900                                                                  28590000
286000                SET PS-CORID-NEED     TO TRUE                     28600000
286100                                                                  28610000
286200           WHEN 'Fault'                                           28620000
286300                                                                  28630000
286400                SET PS-FAULT-NEED     TO TRUE                     28640000
286500                                                                  28650000
286600           WHEN 'InReplyTo'                                       28660000
286700                                                                  28670000
286800                SET PS-INRPTO-NEED    TO TRUE                     28680000
286900                                                                  28690000
287000        END-EVALUATE                                              28700000
287100                                                                  28710000
287200        IF PV-SECTION-NAME4(PV-STR-INDEX11) = SPACES              28720000
287300                                                                  28730000
287400           SET PS-BREAK-THE-LOOP   TO TRUE                        28740000
287500                                                                  28750000
287600        END-IF                                                    28760000
287700                                                                  28770000
287800     END-PERFORM                                                  28780000
287900                                                                  28790000
288000     MOVE PV-STR-INDEX11             TO PV-NBR-O-ELEMENTS         28800000
288100           .                                                      28810000
288200******************************************************************28820000
288300* THIS SECTION PERFORMS BELOW LOGIC:                              28830000
288400* 1) PREPARE KMH XML FOR SEND-REQUEST, SEND-RESPONSE, RECIEVE     28840000
288500*    REQUEST (ERROR CONDITION)                                    28850000
288600* 2) WRITE INTO DFHHEADER CONTAINER                               28860000
288700******************************************************************28870000
288800 2480-WRITE-DFHHDR.                                               28880000
288900                                                                  28890000
289000*    STRING  '2480-WRITE-DFHHDR'                                  28900000
289100*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  28910000
289200*    PERFORM 9990-WRITE-CICS                                      28920000
289300                                                                  28930000
289400     IF (PS-FUNC-SEND-REQ) OR (PS-FUNC-SEND-RESP) OR              28940000
289500     (PS-FUNC-REC-REQ AND PS-VALIDATE-FAIL)                       28950000
289600                                                                  28960000
289700       PERFORM 2520-NEW-KMH-XML                                   28970000
289800       PERFORM 2530-UPD-DFHHEADER                                 28980000
289900                                                                  28990000
290000     ELSE                                                         29000000
290100                                                                  29010000
290200       CONTINUE                                                   29020000
290300                                                                  29030000
290400     END-IF                                                       29040000
290500           .                                                      29050000
290600******************************************************************29060000
290700* THIS PARA HANDLES XML PARSING BY EVALUATING 'XML-EVENT'         29070000
290800* 1) ELEMENT PRESENCE WOULD BE KNOWN FROM XML-TEXT OF             29080000
290900*    'START-OF-ELEMENT'                                           29090000
291000* 2) VALUE OF THAT ELEMENT WOULD BE KNOWN FROM XML-TEXT OF        29100000
291100*    'CONTENT-CHARACTERS'                                         29110000
291200* 3) ELEMENT 'FROM' HAS ATTRIBUTES NAMELY, SYSTEMCODE, APP, MODULE29120000
291300*    NODEID. PRESENCE OF THESE ATTRIBUTES WOULD BE KNOWN FROM     29130000
291400*    XML-TEXT OF 'ATTRIBUTE-NAME'. CORRESPONDING VALUES WOULD BE  29140000
291500*    KNOWN FROM THE XML-TEXT OF 'ATTRIBUTE-CHARACTERS'            29150000
291600******************************************************************29160000
291700 2190-XML-HANDLER.                                                29170000
291800                                                                  29180000
291900     EVALUATE XML-EVENT                                           29190000
292000                                                                  29200000
292100        WHEN 'START-OF-ELEMENT'                                   29210000
292200*         STRING  'START OF ELEMENT'                              29220000
292300*                 'XML-TEXT: ' XML-TEXT                           29230000
292400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                29240000
292500*         PERFORM 9990-WRITE-CICS                                 29250000
292600                                                                  29260000
292700          MOVE 0                            TO PV-STR-INDEX3      29270000
292800          MOVE 0                            TO PV-STR-INDEX4      29280000
292900          SET PS-CONT-THE-LOOP              TO TRUE               29290000
293000          SET PS-IN-MSG-FLDS-NO             TO TRUE               29300000
293100                                                                  29310000
293200          PERFORM UNTIL PV-STR-INDEX3 > PV-NBR-M-ELEMENTS OR      29320000
293300            PS-BREAK-THE-LOOP                                     29330000
293400                                                                  29340000
293500            ADD 1                           TO PV-STR-INDEX3      29350000
293600                                                                  29360000
293700*              STRING  'XML-TEXT: ' XML-TEXT                      29370000
293800*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           29380000
293900*              PERFORM 9990-WRITE-CICS                            29390000
294000*              STRING  'PV-STR-INDEX3: ' PV-STR-INDEX3            29400000
294100*                      'PV-KMH-ELEMENT(PV-STR-INDEX3): '          29410000
294200*                       PV-KMH-ELEMENT(PV-STR-INDEX3)             29420000
294300*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           29430000
294400*              PERFORM 9990-WRITE-CICS                            29440000
294500            IF XML-TEXT = PV-KMH-ELEMENT(PV-STR-INDEX3)           29450000
294600                                                                  29460000
294700               MOVE 'Y'                     TO                    29470000
294800               PV-KMH-ELE-PRESENCE(PV-STR-INDEX3)                 29480000
294900               SET PS-BREAK-THE-LOOP        TO TRUE               29490000
295000                                                                  29500000
295100               IF XML-TEXT = 'MessageID'                          29510000
295200                                                                  29520000
295300                  SET PS-IN-MSG-FLDS-MSGID  TO TRUE               29530000
295400                                                                  29540000
295500               END-IF                                             29550000
295600                                                                  29560000
295700               IF XML-TEXT = 'CorrelationID'                      29570000
295800                                                                  29580000
295900                  SET PS-IN-MSG-FLDS-CORRID TO TRUE               29590000
296000                                                                  29600000
296100               END-IF                                             29610000
296200                                                                  29620000
296300               IF XML-TEXT = 'From'                               29630000
296400                                                                  29640000
296500                  SET PS-IN-MSG-FLDS-FROM   TO TRUE               29650000
296600                  SET PS-IN-MSG-FRM-YES     TO TRUE               29660000
296700                  SET PS-IN-SYS-CD-NO       TO TRUE               29670000
296800                  SET PS-IN-APP-CD-NO       TO TRUE               29680000
296900                  SET PS-IN-MOD-CD-NO       TO TRUE               29690000
297000                  SET PS-IN-NOD-ID-NO       TO TRUE               29700000
297100                                                                  29710000
297200               END-IF                                             29720000
297300                                                                  29730000
297400               IF XML-TEXT = 'CreateDateTime'                     29740000
297500                                                                  29750000
297600                  SET PS-IN-MSG-FLDS-CRDT   TO TRUE               29760000
297700                                                                  29770000
297800               END-IF                                             29780000
297900            END-IF                                                29790000
298000                                                                  29800000
298100            IF PS-CORID-NEED                                      29810000
298200                                                                  29820000
298300               IF XML-TEXT = 'CorrelationID'                      29830000
298400                                                                  29840000
298500                  SET PS-IN-MSG-FLDS-CORRID TO TRUE               29850000
298600                                                                  29860000
298700               END-IF                                             29870000
298800                                                                  29880000
298900            END-IF                                                29890000
299000                                                                  29900000
299100            IF XML-TEXT = 'InReplyTo'                             29910000
299200                                                                  29920000
299300               SET PS-IN-MSG-INRPT-Y     TO TRUE                  29930000
299400                                                                  29940000
299500            END-IF                                                29950000
299600                                                                  29960000
299700            IF XML-TEXT = 'Fault'                                 29970000
299800                                                                  29980000
299900               SET PS-IN-MSG-FAULT-Y     TO TRUE                  29990000
300000                                                                  30000000
300100            END-IF                                                30010000
300200                                                                  30020000
300300            IF XML-TEXT = 'Code' AND PS-IN-MSG-FAULT-Y            30030000
300400                                                                  30040000
300500               SET PS-IN-MSG-FAULT-C     TO TRUE                  30050000
300600                                                                  30060000
300700            END-IF                                                30070000
300800                                                                  30080000
300900            IF XML-TEXT = 'Description'                           30090000
301000                                                                  30100000
301100               SET PS-IN-MSG-FAULT-D     TO TRUE                  30110000
301200                                                                  30120000
301300            END-IF                                                30130000
301400                                                                  30140000
301500            IF PS-EXDT-NEED                                       30150000
301600                                                                  30160000
301700               IF XML-TEXT = 'ExpiryDateTime'                     30170000
301800                                                                  30180000
301900                  SET PS-IN-MSG-FLDS-EXDT   TO TRUE               30190000
302000                                                                  30200000
302100               END-IF                                             30210000
302200            END-IF                                                30220000
302300                                                                  30230000
302400          END-PERFORM                                             30240000
302500        WHEN 'CONTENT-CHARACTERS'                                 30250000
302600                                                                  30260000
302700*         STRING  'CONTENT-CHARACTERS'                            30270000
302800*                 'XML-TEXT: ' XML-TEXT                           30280000
302900*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                30290000
303000*         PERFORM 9990-WRITE-CICS                                 30300000
303100          IF PV-KMH-ELE-PRESENCE(PV-STR-INDEX3) = 'Y'             30310000
303200                                                                  30320000
303300            ADD 1                           TO PV-STR-INDEX4      30330000
303400            MOVE XML-TEXT                   TO                    30340000
303500            PV-KMH-ELEMENT-VAL(PV-STR-INDEX3, PV-STR-INDEX4)      30350000
303600                                                                  30360000
303700            IF PS-IN-MSG-FLDS-MSGID                               30370000
303800                                                                  30380000
303900               MOVE XML-TEXT                TO PV-IN-MSG-MSGID    30390000
304000                                                                  30400000
304100            END-IF                                                30410000
304200                                                                  30420000
304300            IF PS-IN-MSG-FLDS-CRDT                                30430000
304400                                                                  30440000
304500               MOVE XML-TEXT                TO PV-IN-MSG-CRDT     30450000
304600                                                                  30460000
304700            END-IF                                                30470000
304800                                                                  30480000
304900            IF PS-IN-MSG-FLDS-CORRID                              30490000
305000                                                                  30500000
305100*           DISPLAY 'MOVING PV-IN-MSG-CORRID: '                   30510000
305200*           DISPLAY XML-TEXT                                      30520000
305300               MOVE XML-TEXT                TO PV-IN-MSG-CORRID   30530000
305400                                                                  30540000
305500            END-IF                                                30550000
305600          END-IF                                                  30560000
305700                                                                  30570000
305800          IF PS-IN-MSG-INRPT-Y                                    30580000
305900                                                                  30590000
306000             MOVE XML-TEXT                  TO PV-IN-MSG-INRPTO   30600000
306100             SET PS-IN-MSG-INRPT-D          TO TRUE               30610000
306200                                                                  30620000
306300          END-IF                                                  30630000
306400                                                                  30640000
306500          IF PS-IN-MSG-FAULT-C                                    30650000
306600                                                                  30660000
306700             MOVE XML-TEXT                  TO PV-IN-MSG-FAULT-CD 30670000
306800             SET PS-IN-MSG-FAULT-F          TO TRUE               30680000
306900                                                                  30690000
307000          END-IF                                                  30700000
307100                                                                  30710000
307200          IF PS-IN-MSG-FAULT-D                                    30720000
307300                                                                  30730000
307400             MOVE XML-TEXT                  TO PV-IN-MSG-FAULT-DES30740000
307500             SET PS-IN-MSG-FAULT-F          TO TRUE               30750000
307600                                                                  30760000
307700          END-IF                                                  30770000
307800                                                                  30780000
307900          IF PS-IN-MSG-FLDS-CORRID                                30790000
308000*            DISPLAY 'MOVING PV-IN-MSG-CORRID: '                  30800000
308100*            DISPLAY XML-TEXT                                     30810000
308200                                                                  30820000
308300             MOVE XML-TEXT                TO PV-IN-MSG-CORRID     30830000
308400          END-IF                                                  30840000
308500                                                                  30850000
308600          IF PS-IN-MSG-FLDS-EXDT                                  30860000
308700                                                                  30870000
308800*            DISPLAY 'MOVING PV-IN-MSG-EXDT: '                    30880000
308900*            DISPLAY XML-TEXT                                     30890000
309000             MOVE XML-TEXT                TO PV-IN-MSG-EXDT       30900000
309100             SET PS-IN-MSG-EXDT-Y         TO TRUE                 30910000
309200                                                                  30920000
309300          END-IF                                                  30930000
309400                                                                  30940000
309500        WHEN 'END-OF-ELEMENT'                                     30950000
309600                                                                  30960000
309700          IF PS-IN-MSG-INRPT-Y                                    30970000
309800                                                                  30980000
309900             SET PS-IN-MSG-INRPT-N        TO TRUE                 30990000
310000                                                                  31000000
310100          END-IF                                                  31010000
310200         CONTINUE                                                 31020000
310300*         STRING  'END-OF-ELEMENT'                                31030000
310400*                 'XML-TEXT: ' XML-TEXT                           31040000
310500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31050000
310600*         PERFORM 9990-WRITE-CICS                                 31060000
310700                                                                  31070000
310800        WHEN 'START-OF-DOCUMENT'                                  31080000
310900                                                                  31090000
311000         CONTINUE                                                 31100000
311100*         STRING  'START-OF-DOCUMENT'                             31110000
311200*                 'XML-TEXT: ' XML-TEXT                           31120000
311300*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31130000
311400*         PERFORM 9990-WRITE-CICS                                 31140000
311500                                                                  31150000
311600        WHEN 'END-OF-DOCUMENT'                                    31160000
311700                                                                  31170000
311800         CONTINUE                                                 31180000
311900                                                                  31190000
312000*         STRING  'END-OF-DOCUMENT'                               31200000
312100*                 'XML-TEXT: ' XML-TEXT                           31210000
312200*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31220000
312300*         PERFORM 9990-WRITE-CICS                                 31230000
312400        WHEN 'VERSION-INFORMATION'                                31240000
312500                                                                  31250000
312600         CONTINUE                                                 31260000
312700*         STRING  'VERSION-INFORMATION'                           31270000
312800*                 'XML-TEXT: ' XML-TEXT                           31280000
312900*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31290000
313000*         PERFORM 9990-WRITE-CICS                                 31300000
313100                                                                  31310000
313200        WHEN 'ENCODING-DECLARATION'                               31320000
313300                                                                  31330000
313400         CONTINUE                                                 31340000
313500*         STRING  'ENCODING-DECLARATION'                          31350000
313600*                 'XML-TEXT: ' XML-TEXT                           31360000
313700*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31370000
313800*         PERFORM 9990-WRITE-CICS                                 31380000
313900                                                                  31390000
314000        WHEN 'STANDALONE-DECLARATION'                             31400000
314100                                                                  31410000
314200         CONTINUE                                                 31420000
314300*         STRING  'STANDALONE-DECLARATION'                        31430000
314400*                 'XML-TEXT: ' XML-TEXT                           31440000
314500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31450000
314600*         PERFORM 9990-WRITE-CICS                                 31460000
314700                                                                  31470000
314800        WHEN 'ATTRIBUTE-NAME'                                     31480000
314900                                                                  31490000
315000         IF XML-TEXT = 'systemCode'                               31500000
315100                                                                  31510000
315200            SET PS-IN-SYS-CD-YES TO TRUE                          31520000
315300*           DISPLAY 'SYS-CD SET TO YES'                           31530000
315400                                                                  31540000
315500         END-IF                                                   31550000
315600                                                                  31560000
315700         IF XML-TEXT = 'app'                                      31570000
315800                                                                  31580000
315900            SET PS-IN-APP-CD-YES TO TRUE                          31590000
316000*           DISPLAY 'APP-CD SET TO YES'                           31600000
316100                                                                  31610000
316200         END-IF                                                   31620000
316300                                                                  31630000
316400         IF XML-TEXT = 'module'                                   31640000
316500                                                                  31650000
316600            SET PS-IN-MOD-CD-YES TO TRUE                          31660000
316700*           DISPLAY 'MOD-CD SET TO YES'                           31670000
316800                                                                  31680000
316900         END-IF                                                   31690000
317000                                                                  31700000
317100         IF XML-TEXT = 'nodeID'                                   31710000
317200                                                                  31720000
317300            SET PS-IN-NOD-ID-YES TO TRUE                          31730000
317400*           DISPLAY 'NOD-ID SET TO YES'                           31740000
317500                                                                  31750000
317600         END-IF                                                   31760000
317700                                                                  31770000
317800         IF XML-TEXT = 'version'                                  31780000
317900                                                                  31790000
318000            SET PS-INKMH-VER-Y   TO TRUE                          31800000
318100*           DISPLAY 'NOD-ID SET TO YES'                           31810000
318200         END-IF                                                   31820000
318300                                                                  31830000
318400         CONTINUE                                                 31840000
318500*         STRING  'ATTRIBUTE-NAME'                                31850000
318600*                 'XML-TEXT: ' XML-TEXT                           31860000
318700*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31870000
318800*         PERFORM 9990-WRITE-CICS                                 31880000
318900                                                                  31890000
319000        WHEN 'START-OF-CDATA-SECTION'                             31900000
319100                                                                  31910000
319200*         STRING  'START-OF-CDATA-SECTION'                        31920000
319300*                 'XML-TEXT: ' XML-TEXT                           31930000
319400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                31940000
319500*         PERFORM 9990-WRITE-CICS                                 31950000
319600         CONTINUE                                                 31960000
319700                                                                  31970000
319800        WHEN 'END-OF-CDATA-SECTION'                               31980000
319900                                                                  31990000
320000*         STRING  'END-OF-CDATA-SECTION'                          32000000
320100*                 'XML-TEXT: ' XML-TEXT                           32010000
320200*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32020000
320300*         PERFORM 9990-WRITE-CICS                                 32030000
320400                                                                  32040000
320500         CONTINUE                                                 32050000
320600                                                                  32060000
320700        WHEN 'PROCESSING-INSTRUCTION-TARGET'                      32070000
320800                                                                  32080000
320900*         STRING  'PROCESSING-INSTRUCTION-TARGET'                 32090000
321000*                 'XML-TEXT: ' XML-TEXT                           32100000
321100*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32110000
321200*         PERFORM 9990-WRITE-CICS                                 32120000
321300         CONTINUE                                                 32130000
321400                                                                  32140000
321500        WHEN 'PROCESSING-INSTRUCTION-DATA'                        32150000
321600                                                                  32160000
321700*         STRING  'PROCESSING-INSTRUCTION-DATA'                   32170000
321800*                 'XML-TEXT: ' XML-TEXT                           32180000
321900*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32190000
322000*         PERFORM 9990-WRITE-CICS                                 32200000
322100                                                                  32210000
322200         CONTINUE                                                 32220000
322300                                                                  32230000
322400        WHEN 'COMMENT'                                            32240000
322500                                                                  32250000
322600         CONTINUE                                                 32260000
322700                                                                  32270000
322800*         STRING  'COMMENT'                                       32280000
322900*                 'XML-TEXT: ' XML-TEXT                           32290000
323000*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32300000
323100*         PERFORM 9990-WRITE-CICS                                 32310000
323200                                                                  32320000
323300        WHEN 'EXCEPTION'                                          32330000
323400                                                                  32340000
323500         CONTINUE                                                 32350000
323600                                                                  32360000
323700*        MOVE XML-CODE     TO PV-XML-CODE-DISP                    32370000
323800*         STRING  'EXCEPTION'                                     32380000
323900*                 'XML-TEXT: ' XML-TEXT                           32390000
324000*                 'XML-CODE: ' PV-XML-CODE-DISP                   32400000
324100*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32410000
324200*         PERFORM 9990-WRITE-CICS                                 32420000
324300        WHEN 'ATTRIBUTE-CHARACTERS'                               32430000
324400                                                                  32440000
324500*         STRING  'ATTRIBUTE-CHARACTERS'                          32450000
324600*                 'XML-TEXT: ' XML-TEXT                           32460000
324700*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                32470000
324800*         PERFORM 9990-WRITE-CICS                                 32480000
324900                                                                  32490000
325000          IF PV-KMH-ELE-PRESENCE(PV-STR-INDEX3) = 'Y'             32500000
325100            ADD 1              TO PV-STR-INDEX4                   32510000
325200            MOVE XML-TEXT      TO                                 32520000
325300            PV-KMH-ELEMENT-VAL(PV-STR-INDEX3, PV-STR-INDEX4)      32530000
325400                                                                  32540000
325500            IF PS-IN-MSG-FLDS-FROM AND PS-IN-SYS-CD-YES           32550000
325600            AND  PV-STR-INDEX4 = 1                                32560000
325700*           DISPLAY 'STORED SYS CODE'                             32570000
325800                                                                  32580000
325900               MOVE XML-TEXT                TO PV-IN-MSG-SYSCD    32590000
326000                                                                  32600000
326100            END-IF                                                32610000
326200                                                                  32620000
326300            IF PS-IN-MSG-FLDS-FROM AND PS-IN-APP-CD-YES           32630000
326400            AND  PV-STR-INDEX4 = 2                                32640000
326500*           DISPLAY 'STORED APP CODE'                             32650000
326600                                                                  32660000
326700               MOVE XML-TEXT                TO PV-IN-MSG-APPCD    32670000
326800                                                                  32680000
326900            END-IF                                                32690000
327000                                                                  32700000
327100            IF PS-IN-MSG-FLDS-FROM AND PS-IN-MOD-CD-YES           32710000
327200                                                                  32720000
327300            AND  PV-STR-INDEX4 = 3                                32730000
327400*           DISPLAY 'STORED MOD CODE'                             32740000
327500                                                                  32750000
327600               MOVE XML-TEXT                TO PV-IN-MSG-MODCD    32760000
327700                                                                  32770000
327800            END-IF                                                32780000
327900                                                                  32790000
328000            IF PS-IN-MSG-FLDS-FROM AND PS-IN-NOD-ID-YES           32800000
328100            AND  PV-STR-INDEX4 = 4                                32810000
328200*           DISPLAY 'STORED NODE ID'                              32820000
328300                                                                  32830000
328400               MOVE XML-TEXT                TO PV-IN-MSG-NODID    32840000
328500                                                                  32850000
328600            END-IF                                                32860000
328700          END-IF                                                  32870000
328800                                                                  32880000
328900          IF PS-INKMH-VER-Y                                       32890000
329000                                                                  32900000
329100             MOVE XML-TEXT                  TO PV-STOR-KMH-VER    32910000
329200             SET PS-INKMH-VER-N             TO TRUE               32920000
329300                                                                  32930000
329400          END-IF                                                  32940000
329500                                                                  32950000
329600        WHEN OTHER                                                32960000
329700                                                                  32970000
329800            CONTINUE                                              32980000
329900*        MOVE XML-CODE       TO PV-XML-CODE-DISP                  32990000
330000*           MOVE 'Y' TO PV-PARSE-ERROR                            33000000
330100*           STRING  'PARSE ERROR: WHEN OTHER'                     33010000
330200*                   'XML-TEXT: ' XML-TEXT                         33020000
330300*                   'XML-CODE: ' PV-XML-CODE-DISP                 33030000
330400*            DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              33040000
330500*           PERFORM 9990-WRITE-CICS                               33050000
330600                                                                  33060000
330700     END-EVALUATE                                                 33070000
330800           .                                                      33080000
330900******************************************************************33090000
331000* THIS SECTION PREPARES EXPIRY DATE, IF APPLICABLE BY RETREIVING  33100000
331100* OFFSET-TIME (IN SEC) FROM CONFIG FILE AND ADDING IT TO CURRENT  33110000
331200* TIME                                                            33120000
331300******************************************************************33130000
331400 2440-BLD-EXPIRY-DATE.                                            33140000
331500                                                                  33150000
331600     INITIALIZE TR071-CA-CONFIG-RECORD                            33160000
331700                PV-CONFIG-RECORD                                  33170000
331800                PV-OFFSET-CHAR                                    33180000
331900     MOVE 'OFFSET-TIME'       TO TR071-FUNC-AREA                  33190000
332000     MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                  33200000
332100     MOVE 1                   TO TR071-SEQ-NO                     33210000
332200                                                                  33220000
332300     PERFORM 7000-VSAM-FILE-READ                                  33230000
332400                                                                  33240000
332500     EVALUATE PV-RESP                                             33250000
332600                                                                  33260000
332700        WHEN 0                                                    33270000
332800                                                                  33280000
332900            CONTINUE                                              33290000
333000                                                                  33300000
333100        WHEN 13                                                   33310000
333200                                                                  33320000
333300            MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA           33330000
333400                                                                  33340000
333500            PERFORM 7000-VSAM-FILE-READ                           33350000
333600                                                                  33360000
333700            IF PV-RESP = 13                                       33370000
333800                                                                  33380000
333900               EXEC CICS ABEND ABCODE('C030') END-EXEC            33390000
334000               CONTINUE                                           33400000
334100                                                                  33410000
334200            END-IF                                                33420000
334300                                                                  33430000
334400     END-EVALUATE                                                 33440000
334500* UNSTRING PV-CONFIG-RECORD                                       33450000
334600                                                                  33460000
334700     MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD    33470000
334800     MOVE TR071-FREE-TEXT            TO PV-OFFSET-CHAR            33480000
334900     MOVE 0                          TO PV-OFFSET-NBR             33490000
335000                                                                  33500000
335100     INSPECT FUNCTION REVERSE(PV-OFFSET-CHAR)                     33510000
335200      TALLYING PV-OFFSET-LEN FOR LEADING SPACES                   33520000
335300                                                                  33530000
335400     COMPUTE PV-OFFSET-LEN2 =                                     33540000
335500                    LENGTH OF PV-OFFSET-CHAR - PV-OFFSET-LEN      33550000
335600                                                                  33560000
335700     MOVE ZEROES  TO PV-OFFSET-CHAR2(1:PV-OFFSET-LEN)             33570000
335800     MOVE PV-OFFSET-CHAR(1: PV-OFFSET-LEN2)                       33580000
335900                  TO PV-OFFSET-CHAR2(PV-OFFSET-LEN + 1 : )        33590000
336000*    DISPLAY 'PV-OFFSET-CHAR: ' PV-OFFSET-CHAR2                   33600000
336100                                                                  33610000
336200     IF PV-OFFSET-CHAR2 IS NUMERIC                                33620000
336300                                                                  33630000
336400*       DISPLAY 'OFFSET-CHAR IS NUMERIC'                          33640000
336500        MOVE PV-OFFSET-CHAR2         TO PV-OFFSET-NBR             33650000
336600                                                                  33660000
336700     END-IF                                                       33670000
336800                                                                  33680000
336900*    DISPLAY 'PV-SAVED-SEC BEFORE ADD: ' PV-SAVED-SECS            33690000
337000*    DISPLAY 'PV-OFFSET-NBR: ' PV-OFFSET-NBR                      33700000
337100                                                                  33710000
337200     COMPUTE PV-EXPIRY-SECS = PV-OFFSET-NBR + PV-SAVED-SECS       33720000
337300                                                                  33730000
337400     MOVE PV-EXPIRY-SECS             TO PV-NEW-SECS               33740000
337500     MOVE 24 TO PV-STRING-LENGTH OF PV-PICSTR                     33750000
337600     MOVE 'YYYY-MM-DDTHH:MI:SS.999Z' TO                           33760000
337700           PV-STRING-TEXT OF PV-PICSTR(1:24)                      33770000
337800                                                                  33780000
337900     CALL 'CEEDATM' USING PV-NEW-SECS,                            33790000
338000                          PV-PICSTR,                              33800000
338100                          PV-CHRDATE,                             33810000
338200                          PV-FC.                                  33820000
338300                                                                  33830000
338400     IF PV-COND-TOKEN-VALUE = LOW-VALUES THEN                     33840000
338500                                                                  33850000
338600*       STRING  'Input Lilian date'                               33860000
338700*               ' corresponds to:  ' PV-CHRDATE                   33870000
338800*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           33880000
338900*       PERFORM 9990-WRITE-CICS                                   33890000
339000        MOVE PV-CHRDATE TO PV-NEW-EXP-DATE-TIME                   33900000
339100                                                                  33910000
339200     ELSE                                                         33920000
339300*       STRING  'CEEDATE failed with msg '                        33930000
339400*               DELIMITED BY SIZE INTO PV-CICS-MSG-AREA           33940000
339500*       PERFORM 9990-WRITE-CICS                                   33950000
339600        EXEC CICS ABEND ABCODE('C031') END-EXEC                   33960000
339700                                                                  33970000
339800     END-IF                                                       33980000
339900           .                                                      33990000
340000******************************************************************34000000
340100* THIS SECTION BUILDS ELEMENT 'ACTION' BY READING CONFIG FILE     34010000
340200******************************************************************34020000
340300 2450-BLD-ACTION.                                                 34030000
340400                                                                  34040000
340500     INITIALIZE TR071-CA-CONFIG-RECORD                            34050000
340600                PV-CONFIG-RECORD                                  34060000
340700                                                                  34070000
340800     MOVE 'ACTION'            TO TR071-FUNC-AREA                  34080000
340900     MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                  34090000
341000     MOVE 1                   TO TR071-SEQ-NO                     34100000
341100                                                                  34110000
341200     PERFORM 7000-VSAM-FILE-READ                                  34120000
341300                                                                  34130000
341400     EVALUATE PV-RESP                                             34140000
341500                                                                  34150000
341600        WHEN 0                                                    34160000
341700                                                                  34170000
341800            CONTINUE                                              34180000
341900                                                                  34190000
342000        WHEN 13                                                   34200000
342100                                                                  34210000
342200            MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA           34220000
342300                                                                  34230000
342400            PERFORM 7000-VSAM-FILE-READ                           34240000
342500                                                                  34250000
342600            IF PV-RESP = 13                                       34260000
342700                                                                  34270000
342800               EXEC CICS ABEND ABCODE('C032') END-EXEC            34280000
342900               CONTINUE                                           34290000
343000            END-IF                                                34300000
343100                                                                  34310000
343200     END-EVALUATE                                                 34320000
343300* UNSTRING PV-CONFIG-RECORD                                       34330000
343400     MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD    34340000
343500     MOVE TR071-FREE-TEXT            TO PV-NEW-ACTION-ELE         34350000
343600           .                                                      34360000
343700******************************************************************34370000
343800* THIS SECTION BUILDS 'TO' ELEMENT. THERE CAN BE MULTIPLE 'TO'    34380000
343900* ELEMENTS. NEED TO HANDLE                                        34390000
344000******************************************************************34400000
344100 2460-BLD-TO.                                                     34410000
344200                                                                  34420000
344300     SET PS-CONT-THE-LOOP       TO TRUE                           34430000
344400     MOVE 0                     TO PV-NBR-TO-ELEMENTS             34440000
344500                                                                  34450000
344600     PERFORM VARYING PV-STR-INDEX12 FROM 1 BY 1                   34460000
344700     UNTIL PV-STR-INDEX12 > 99                                    34470000
344800                                                                  34480000
344900        MOVE SPACES             TO PV-NEW-TO-ADR(PV-STR-INDEX12)  34490000
345000        MOVE SPACES             TO PV-NEW-TO-ACT(PV-STR-INDEX12)  34500000
345100        MOVE SPACES             TO PV-NEW-TO-PARM1(PV-STR-INDEX12)34510000
345200        MOVE SPACES             TO PV-NEW-TO-PARM2(PV-STR-INDEX12)34520000
345300                                                                  34530000
345400     END-PERFORM                                                  34540000
345500                                                                  34550000
345600     PERFORM VARYING PV-STR-INDEX12 FROM 1 BY 1                   34560000
345700     UNTIL PV-STR-INDEX12 > 99 OR                                 34570000
345800     PS-BREAK-THE-LOOP                                            34580000
345900                                                                  34590000
346000       INITIALIZE TR071-CA-CONFIG-RECORD                          34600000
346100                  PV-CONFIG-RECORD                                34610000
346200                                                                  34620000
346300       MOVE 'TO'                TO TR071-FUNC-AREA                34630000
346400       MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                34640000
346500*      DISPLAY 'PV-WEBS-AREA :' TR071-WEBS-AREA                   34650000
346600       MOVE PV-STR-INDEX12      TO TR071-SEQ-NO                   34660000
346700                                                                  34670000
346800       PERFORM 7000-VSAM-FILE-READ                                34680000
346900                                                                  34690000
347000       EVALUATE PV-RESP                                           34700000
347100                                                                  34710000
347200          WHEN 0                                                  34720000
347300                                                                  34730000
347400              CONTINUE                                            34740000
347500                                                                  34750000
347600          WHEN 13                                                 34760000
347700                                                                  34770000
347800              MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA         34780000
347900                                                                  34790000
348000              PERFORM 7000-VSAM-FILE-READ                         34800000
348100                                                                  34810000
348200              IF PV-RESP = 13                                     34820000
348300                                                                  34830000
348400              SET PS-BREAK-THE-LOOP    TO TRUE                    34840000
348500                 CONTINUE                                         34850000
348600                                                                  34860000
348700              END-IF                                              34870000
348800                                                                  34880000
348900       END-EVALUATE                                               34890000
349000                                                                  34900000
349100* UNSTRING PV-CONFIG-RECORD                                       34910000
349200       MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD  34920000
349300                                                                  34930000
349400       UNSTRING TR071-FREE-TEXT DELIMITED BY ';'                  34940000
349500          INTO PV-NEW-TO-ADR(PV-STR-INDEX12)                      34950000
349600               PV-NEW-TO-ACT(PV-STR-INDEX12)                      34960000
349700               PV-NEW-TO-PARM1(PV-STR-INDEX12)                    34970000
349800               PV-NEW-TO-PARM2(PV-STR-INDEX12)                    34980000
349900       END-UNSTRING                                               34990000
350000                                                                  35000000
350100     END-PERFORM                                                  35010000
350200                                                                  35020000
350300     COMPUTE PV-NBR-TO-ELEMENTS = PV-STR-INDEX12 - 2              35030000
350400*    DISPLAY 'PV-NBR-TO-ELEMENTS: ' PV-NBR-TO-ELEMENTS            35040000
350500           .                                                      35050000
350600******************************************************************35060000
350700* THIS SECTION BUILDS ROUTING KEY ELEMENT                         35070000
350800******************************************************************35080000
350900 2470-BLD-RKEYS.                                                  35090000
351000                                                                  35100000
351100     INITIALIZE TR071-CA-CONFIG-RECORD                            35110000
351200                PV-CONFIG-RECORD                                  35120000
351300                                                                  35130000
351400     MOVE 'ROUTINGKEYS'       TO TR071-FUNC-AREA                  35140000
351500     MOVE PV-WEBS-AREA        TO TR071-WEBS-AREA                  35150000
351600     MOVE 1                   TO TR071-SEQ-NO                     35160000
351700                                                                  35170000
351800     PERFORM 7000-VSAM-FILE-READ                                  35180000
351900                                                                  35190000
352000     EVALUATE PV-RESP                                             35200000
352100                                                                  35210000
352200        WHEN 0                                                    35220000
352300                                                                  35230000
352400            CONTINUE                                              35240000
352500                                                                  35250000
352600        WHEN 13                                                   35260000
352700                                                                  35270000
352800            MOVE PV-DEFAULT-WEBS     TO TR071-WEBS-AREA           35280000
352900                                                                  35290000
353000            PERFORM 7000-VSAM-FILE-READ                           35300000
353100                                                                  35310000
353200            IF PV-RESP = 13                                       35320000
353300                                                                  35330000
353400               EXEC CICS ABEND ABCODE('C032') END-EXEC            35340000
353500                                                                  35350000
353600               CONTINUE                                           35360000
353700                                                                  35370000
353800            END-IF                                                35380000
353900     END-EVALUATE                                                 35390000
354000* UNSTRING PV-CONFIG-RECORD                                       35400000
354100     MOVE PV-CONFIG-RECORD           TO TR071-CA-CONFIG-RECORD    35410000
354200     MOVE TR071-FREE-TEXT            TO PV-NEW-RKEYS-ELE          35420000
354300           .                                                      35430000
354400******************************************************************35440000
354500* PREPARE NEW KMH BASED ON APPLICABLE ELEMENTS.                   35450000
354600* 1) SCAN THRU MANDATORY ELEMENTS AND PAD THEM                    35460000
354700* 2) SCAN THRU OPTIONAL ELEMENTS AND PAD THEM                     35470000
354800******************************************************************35480000
354900 2520-NEW-KMH-XML.                                                35490000
355000                                                                  35500000
355100     INITIALIZE PV-KMH-HEADER-FINAL                               35510000
355200                PV-RUNNING-KMH                                    35520000
355300                PV-RUNNING-SPACE-CNT                              35530000
355400                PV-RUNNING-CUR-CNT                                35540000
355500                                                                  35550000
355600     MOVE PV-LITERAL-KMH-VER     TO PV-NEW-KMH-VER                35560000
355700                                                                  35570000
355800*    STRING  'PV-NEW-KMH-MSG-HDR-1: ' PV-NEW-KMH-MSG-HDR-1        35580000
355900*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                35590000
356000*    PERFORM 9990-WRITE-CICS                                      35600000
356100     STRING PV-NEW-KMH-MSG-HDR-1 DELIMITED BY SIZE                35610000
356200            PV-RUNNING-KMH       DELIMITED BY SPACE               35620000
356300            INTO PV-KMH-HEADER-FINAL                              35630000
356400     END-STRING                                                   35640000
356500                                                                  35650000
356600     MOVE PV-KMH-HEADER-FINAL    TO PV-RUNNING-KMH                35660000
356700     INITIALIZE PV-KMH-HEADER-FINAL                               35670000
356800     MOVE 0    TO PV-RUNNING-SPACE-CNT                            35680000
356900                                                                  35690000
357000     INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                     35700000
357100     TALLYING PV-RUNNING-SPACE-CNT                                35710000
357200     FOR LEADING SPACES                                           35720000
357300*    STRING  'PV-RUNNING-SPACE-CNT: ' PV-RUNNING-SPACE-CNT        35730000
357400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                35740000
357500*    PERFORM 9990-WRITE-CICS                                      35750000
357600                                                                  35760000
357700     COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH        35770000
357800                                - PV-RUNNING-SPACE-CNT            35780000
357900                                + 1                               35790000
358000*    STRING  'PV-RUNNING-CUR-CNT: ' PV-RUNNING-CUR-CNT            35800000
358100*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                35810000
358200*    PERFORM 9990-WRITE-CICS                                      35820000
358300                                                                  35830000
358400     IF PS-MSGID-NEED                                             35840000
358500                                                                  35850000
358600       MOVE PV-NEW-MESSAGE-ID    TO PV-KMH-MSG-ID                 35860000
358700       MOVE PV-NEW-KMH-MSG-ID    TO                               35870000
358800       PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)                        35880000
358900                                                                  35890000
359000     END-IF                                                       35900000
359100     IF SV-CRDATM-NEED                                            35910000
359200                                                                  35920000
359300       MOVE PV-UTC-DATE          TO PV-KMH-CDATIME                35930000
359400       MOVE 0    TO PV-RUNNING-SPACE-CNT                          35940000
359500                                                                  35950000
359600       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   35960000
359700       TALLYING PV-RUNNING-SPACE-CNT                              35970000
359800       FOR LEADING SPACES                                         35980000
359900                                                                  35990000
360000       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      36000000
360100                                  - PV-RUNNING-SPACE-CNT          36010000
360200                                  + 1                             36020000
360300                                                                  36030000
360400       MOVE   PV-NEW-KMH-CDT     TO                               36040000
360500                             PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  36050000
360600                                                                  36060000
360700     END-IF                                                       36070000
360800                                                                  36080000
360900     IF PS-FROM-NEED                                              36090000
361000                                                                  36100000
361100       INITIALIZE PV-FROM-SPACE-CNT                               36110000
361200                  PV-SYS-CD-LEN                                   36120000
361300                  PV-APP-CD-LEN                                   36130000
361400                  PV-MOD-CD-LEN                                   36140000
361500                  PV-NOD-ID-LEN                                   36150000
361600                                                                  36160000
361700       INSPECT FUNCTION REVERSE(PV-NEW-SYSTEM-CD)                 36170000
361800         TALLYING PV-FROM-SPACE-CNT                               36180000
361900         FOR LEADING SPACES                                       36190000
362000**                                                                36200000
362100       COMPUTE PV-SYS-CD-LEN = LENGTH OF PV-NEW-SYSTEM-CD -       36210000
362200       PV-FROM-SPACE-CNT                                          36220000
362300                                                                  36230000
362400       MOVE PV-NEW-SYSTEM-CD(1 : PV-SYS-CD-LEN)                   36240000
362500                                 TO PV-KMH-SYS-CD                 36250000
362600                                                                  36260000
362700       INITIALIZE PV-FROM-SPACE-CNT                               36270000
362800                                                                  36280000
362900       INSPECT FUNCTION REVERSE(PV-NEW-APP)                       36290000
363000         TALLYING PV-FROM-SPACE-CNT                               36300000
363100         FOR LEADING SPACES                                       36310000
363200**                                                                36320000
363300       COMPUTE PV-APP-CD-LEN = LENGTH OF PV-NEW-APP -             36330000
363400       PV-FROM-SPACE-CNT                                          36340000
363500                                                                  36350000
363600       MOVE PV-NEW-APP(1 : PV-APP-CD-LEN)                         36360000
363700                                 TO PV-KMH-APP-CD                 36370000
363800       INITIALIZE PV-FROM-SPACE-CNT                               36380000
363900                                                                  36390000
364000       INSPECT FUNCTION REVERSE(PV-NEW-MODULE)                    36400000
364100         TALLYING PV-FROM-SPACE-CNT                               36410000
364200         FOR LEADING SPACES                                       36420000
364300**                                                                36430000
364400       COMPUTE PV-MOD-CD-LEN = LENGTH OF PV-NEW-MODULE -          36440000
364500       PV-FROM-SPACE-CNT                                          36450000
364600                                                                  36460000
364700       MOVE PV-NEW-MODULE(1 : PV-MOD-CD-LEN)                      36470000
364800                                 TO PV-KMH-MODULE                 36480000
364900                                                                  36490000
365000       INITIALIZE PV-FROM-SPACE-CNT                               36500000
365100                                                                  36510000
365200       INSPECT FUNCTION REVERSE(PV-NEW-NODEID)                    36520000
365300         TALLYING PV-FROM-SPACE-CNT                               36530000
365400         FOR LEADING SPACES                                       36540000
365500**                                                                36550000
365600       COMPUTE PV-NOD-ID-LEN = LENGTH OF PV-NEW-NODEID -          36560000
365700       PV-FROM-SPACE-CNT                                          36570000
365800                                                                  36580000
365900       MOVE PV-NEW-NODEID(1 : PV-NOD-ID-LEN)                      36590000
366000                                 TO PV-KMH-NODEID                 36600000
366100       MOVE '" app="'            TO PV-FILLER-APP                 36610000
366200       MOVE '" module="'         TO PV-FILLER-MOD                 36620000
366300       MOVE '" nodeID="'         TO PV-FILLER-NOD                 36630000
366400       MOVE '" />'               TO PV-FILLER-EOF                 36640000
366500       MOVE 0    TO PV-RUNNING-SPACE-CNT                          36650000
366600                                                                  36660000
366700       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   36670000
366800       TALLYING PV-RUNNING-SPACE-CNT                              36680000
366900       FOR LEADING SPACES                                         36690000
367000                                                                  36700000
367100       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      36710000
367200                                  - PV-RUNNING-SPACE-CNT          36720000
367300                                  + 1                             36730000
367400                                                                  36740000
367500       MOVE PV-NEW-KMH-FROM      TO                               36750000
367600                             PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  36760000
367700                                                                  36770000
367800     END-IF                                                       36780000
367900                                                                  36790000
368000     INITIALIZE PV-STOR-IRP-TO                                    36800000
368100                PV-STOR-CORR-ID                                   36810000
368200                                                                  36820000
368300     IF PS-INRPTO-NEED AND (PV-IN-MSG-MSGID NOT = SPACES)         36830000
368400     AND NOT PS-FUNC-SEND-REQ                                     36840000
368500                                                                  36850000
368600       MOVE PV-IN-MSG-MSGID      TO PV-KMH-IRP-TO                 36860000
368700       MOVE PV-IN-MSG-MSGID      TO PV-STOR-IRP-TO                36870000
368800       MOVE 0                    TO PV-RUNNING-SPACE-CNT          36880000
368900                                                                  36890000
369000       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   36900000
369100       TALLYING PV-RUNNING-SPACE-CNT                              36910000
369200       FOR LEADING SPACES                                         36920000
369300                                                                  36930000
369400       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      36940000
369500                                  - PV-RUNNING-SPACE-CNT          36950000
369600                                  + 1                             36960000
369700                                                                  36970000
369800       MOVE PV-NEW-KMH-INRP-TO   TO                               36980000
369900                             PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  36990000
370000                                                                  37000000
370100     END-IF                                                       37010000
370200                                                                  37020000
370300*    STRING  'PV-IN-MSG-CORRID : ' PV-IN-MSG-CORRID               37030000
370400*            'PV-IN-MSG-MSGID  : ' PV-IN-MSG-MSGID                37040000
370500*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                37050000
370600*    PERFORM 9990-WRITE-CICS                                      37060000
370700                                                                  37070000
370800     IF PS-CORID-NEED AND NOT PS-FUNC-SEND-REQ                    37080000
370900     AND (                                                        37090000
371000     (PV-IN-MSG-CORRID  NOT = SPACES) OR                          37100000
371100     (PV-IN-MSG-MSGID   NOT = SPACES)   )                         37110000
371200                                                                  37120000
371300       IF PV-IN-MSG-CORRID NOT = SPACES                           37130000
371400                                                                  37140000
371500          MOVE PV-IN-MSG-CORRID  TO PV-KMH-CORRL-ID               37150000
371600                                                                  37160000
371700       ELSE                                                       37170000
371800                                                                  37180000
371900          MOVE PV-IN-MSG-MSGID   TO PV-KMH-CORRL-ID               37190000
372000                                                                  37200000
372100       END-IF                                                     37210000
372200                                                                  37220000
372300       MOVE PV-KMH-CORRL-ID      TO PV-STOR-CORR-ID               37230000
372400       MOVE 0    TO PV-RUNNING-SPACE-CNT                          37240000
372500                                                                  37250000
372600       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   37260000
372700       TALLYING PV-RUNNING-SPACE-CNT                              37270000
372800       FOR LEADING SPACES                                         37280000
372900                                                                  37290000
373000       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      37300000
373100                                  - PV-RUNNING-SPACE-CNT          37310000
373200                                  + 1                             37320000
373300                                                                  37330000
373400       MOVE PV-NEW-KMH-CORID                                      37340000
373500                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  37350000
373600                                                                  37360000
373700     END-IF                                                       37370000
373800                                                                  37380000
373900     IF PS-EXDT-NEED AND PS-FUNC-SEND-REQ                         37390000
374000                                                                  37400000
374100       MOVE PV-NEW-EXP-DATE-TIME TO PV-KMH-EDATIME                37410000
374200       MOVE 0                    TO PV-RUNNING-SPACE-CNT          37420000
374300                                                                  37430000
374400       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   37440000
374500       TALLYING PV-RUNNING-SPACE-CNT                              37450000
374600       FOR LEADING SPACES                                         37460000
374700                                                                  37470000
374800       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      37480000
374900                                  - PV-RUNNING-SPACE-CNT          37490000
375000                                  + 1                             37500000
375100                                                                  37510000
375200       MOVE PV-NEW-KMH-EDT                                        37520000
375300                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  37530000
375400                                                                  37540000
375500     END-IF                                                       37550000
375600                                                                  37560000
375700     IF PS-ACT-NEED AND PS-FUNC-SEND-REQ                          37570000
375800                                                                  37580000
375900       MOVE PV-NEW-ACTION-ELE    TO PV-KMH-ACTION                 37590000
376000       MOVE 0    TO PV-RUNNING-SPACE-CNT                          37600000
376100                                                                  37610000
376200       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   37620000
376300       TALLYING PV-RUNNING-SPACE-CNT                              37630000
376400       FOR LEADING SPACES                                         37640000
376500                                                                  37650000
376600       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      37660000
376700                                  - PV-RUNNING-SPACE-CNT          37670000
376800                                  + 1                             37680000
376900                                                                  37690000
377000       MOVE PV-NEW-KMH-ACTION                                     37700000
377100                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  37710000
377200                                                                  37720000
377300     END-IF                                                       37730000
377400                                                                  37740000
377500     IF PS-TO-NEED AND PS-FUNC-SEND-REQ                           37750000
377600                                                                  37760000
377700       PERFORM VARYING PV-STR-INDEX12 FROM 1 BY 1                 37770000
377800       UNTIL PV-STR-INDEX12 > PV-NBR-TO-ELEMENTS                  37780000
377900                                                                  37790000
378000         INITIALIZE PV-KMH-TO-ELE-STRNG                           37800000
378100                                                                  37810000
378200         MOVE PV-NEW-TO-ADR(PV-STR-INDEX12)                       37820000
378300         TO PV-KMH-TO-ADR                                         37830000
378400         MOVE PV-NEW-TO-ACT(PV-STR-INDEX12)                       37840000
378500         TO PV-KMH-TO-ACT                                         37850000
378600         MOVE PV-NEW-TO-PARM1(PV-STR-INDEX12)                     37860000
378700         TO PV-KMH-TO-PARMVAL1                                    37870000
378800         MOVE PV-NEW-TO-PARM2(PV-STR-INDEX12)                     37880000
378900         TO PV-KMH-TO-PARMVAL2                                    37890000
379000                                                                  37900000
379100         STRING                                                   37910000
379200           PV-NEW-KMH-TO-1 DELIMITED BY SIZE                      37920000
379300           PV-NEW-KMH-TO-ADR DELIMITED BY SIZE                    37930000
379400           PV-NEW-KMH-TO-ACT DELIMITED BY SIZE                    37940000
379500           PV-NEW-KMH-PARM-1 DELIMITED BY SIZE                    37950000
379600           PV-NEW-KMH-TO-PARM1 DELIMITED BY SIZE                  37960000
379700           PV-NEW-KMH-TO-PARM2 DELIMITED BY SIZE                  37970000
379800           PV-NEW-KMH-PARM-2 DELIMITED BY SIZE                    37980000
379900           PV-NEW-KMH-TO-2 DELIMITED BY SIZE                      37990000
380000         INTO PV-KMH-TO-ELE-STRNG                                 38000000
380100                                                                  38010000
380200         END-STRING                                               38020000
380300                                                                  38030000
380400         MOVE 0    TO PV-RUNNING-SPACE-CNT                        38040000
380500                                                                  38050000
380600         INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                 38060000
380700         TALLYING PV-RUNNING-SPACE-CNT                            38070000
380800         FOR LEADING SPACES                                       38080000
380900                                                                  38090000
381000         COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH    38100000
381100                                    - PV-RUNNING-SPACE-CNT        38110000
381200                                    + 1                           38120000
381300                                                                  38130000
381400         MOVE PV-KMH-TO-ELE-STRNG                                 38140000
381500                          TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)38150000
381600                                                                  38160000
381700       END-PERFORM                                                38170000
381800     END-IF                                                       38180000
381900                                                                  38190000
382000     IF PS-RKEYS-NEED AND PS-FUNC-SEND-REQ                        38200000
382100                                                                  38210000
382200       MOVE PV-NEW-RKEYS-ELE     TO PV-KMH-RKEYS-VAL              38220000
382300       MOVE 0    TO PV-RUNNING-SPACE-CNT                          38230000
382400                                                                  38240000
382500       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   38250000
382600       TALLYING PV-RUNNING-SPACE-CNT                              38260000
382700       FOR LEADING SPACES                                         38270000
382800                                                                  38280000
382900       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      38290000
383000                                  - PV-RUNNING-SPACE-CNT          38300000
383100                                  + 1                             38310000
383200                                                                  38320000
383300       MOVE PV-NEW-KMH-RKEYS                                      38330000
383400                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  38340000
383500                                                                  38350000
383600     END-IF                                                       38360000
383700                                                                  38370000
383800     IF PS-FAULT-NEED AND PS-VALIDATE-FAIL                        38380000
383900                                                                  38390000
384000       MOVE PV-FAULT-MSG         TO PV-KMH-FAULT-MSG              38400000
384100       MOVE 0    TO PV-RUNNING-SPACE-CNT                          38410000
384200                                                                  38420000
384300       INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                   38430000
384400       TALLYING PV-RUNNING-SPACE-CNT                              38440000
384500       FOR LEADING SPACES                                         38450000
384600                                                                  38460000
384700       COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH      38470000
384800                                  - PV-RUNNING-SPACE-CNT          38480000
384900                                  + 1                             38490000
385000                                                                  38500000
385100       MOVE PV-NEW-KMH-FAULT                                      38510000
385200                        TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)  38520000
385300                                                                  38530000
385400     END-IF                                                       38540000
385500                                                                  38550000
385600     MOVE 0    TO PV-RUNNING-SPACE-CNT                            38560000
385700                                                                  38570000
385800     INSPECT FUNCTION REVERSE(PV-RUNNING-KMH)                     38580000
385900     TALLYING PV-RUNNING-SPACE-CNT                                38590000
386000     FOR LEADING SPACES                                           38600000
386100                                                                  38610000
386200     COMPUTE PV-RUNNING-CUR-CNT = LENGTH OF PV-RUNNING-KMH        38620000
386300                                - PV-RUNNING-SPACE-CNT            38630000
386400                                + 1                               38640000
386500                                                                  38650000
386600     MOVE PV-NEW-KMH-MSG-HDR-2                                    38660000
386700                      TO   PV-RUNNING-KMH(PV-RUNNING-CUR-CNT:)    38670000
386800                                                                  38680000
386900     MOVE PV-RUNNING-KMH        TO PV-KMH-HEADER-FINAL            38690000
387000                                                                  38700000
387100*    DISPLAY 'NEW KMH PREPARED: ' PV-KMH-HEADER-FINAL(1:800)      38710000
387200*    STRING  'PV-KMH-HEADER-FINAL: ' PV-KMH-HEADER-FINAL          38720000
387300*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                38730000
387400*    PERFORM 9990-WRITE-CICS                                      38740000
387500           .                                                      38750000
387600******************************************************************38760000
387700* THIS PARA WRITES THE NEW KMH HEADER BY PUTTING THE KMH INTO     38770000
387800* DFHHEADER CONTAINTER                                            38780000
387900******************************************************************38790000
388000 2530-UPD-DFHHEADER.                                              38800000
388100                                                                  38810000
388200*    STRING  '1020 PUT CONTAINER DFHHEADER'                       38820000
388300*            '1020 PV-KMH-HEADER-FINAL :  ' PV-KMH-HEADER-FINAL   38830000
388400*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                38840000
388500*    PERFORM 9990-WRITE-CICS                                      38850000
388600     INITIALIZE PV-RESP                                           38860000
388700                                                                  38870000
388800     EXEC CICS                                                    38880000
388900       PUT CONTAINER('DFHHEADER')                                 38890000
389000       FROM(PV-KMH-HEADER-FINAL)                                  38900000
389100       FLENGTH(LENGTH OF PV-KMH-HEADER-FINAL)                     38910000
389200       RESP(PV-RESP)                                              38920000
389300     END-EXEC                                                     38930000
389400                                                                  38940000
389500*    MOVE   PV-RESP            TO PV-RESP-DISP                    38950000
389600*    STRING  'PV-RESP AFTER WRITING DFHHEADER: ' PV-RESP-DISP     38960000
389700*          DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                38970000
389800*    PERFORM 9990-WRITE-CICS                                      38980000
389900     EVALUATE PV-RESP                                             38990000
390000                                                                  39000000
390100           WHEN DFHRESP(NORMAL)                                   39010000
390200                                                                  39020000
390300               CONTINUE                                           39030000
390400                                                                  39040000
390500           WHEN OTHER                                             39050000
390600                                                                  39060000
390700               EXEC CICS ABEND ABCODE('C033') END-EXEC            39070000
390800     END-EVALUATE                                                 39080000
390900           .                                                      39090000
391000******************************************************************39100000
391100* THIS SECTION READ CONTAINER OLD-HEADER1 TO RETRIEVE KMH THAT WAS39110000
391200* ORIGINALLY RECEIVED FROM THE REQUESTER                          39120000
391300******************************************************************39130000
391400 2540-RET-OLD-KMH.                                                39140000
391500                                                                  39150000
391600        INITIALIZE PV-RESP                                        39160000
391700                                                                  39170000
391800        EXEC CICS                                                 39180000
391900          GET CONTAINER('OLD-HEADER1')                            39190000
392000          SET(PV-HEAD-PTR)                                        39200000
392100          FLENGTH(PV-CONT-LEN)                                    39210000
392200          RESP(PV-RESP)                                           39220000
392300        END-EXEC                                                  39230000
392400                                                                  39240000
392500*       DISPLAY 'PV-RESP AFTER OLD-HEADER1 READ: ' PV-RESP        39250000
392600*       MOVE   PV-RESP            TO PV-RESP-DISP                 39260000
392700*       STRING  'PV-RESP AFTER DFHHEADER CONTAINER READ: '        39270000
392800*       PV-RESP-DISP                                              39280000
392900*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  39290000
393000*       PERFORM 9990-WRITE-CICS                                   39300000
393100                                                                  39310000
393200        EVALUATE PV-RESP                                          39320000
393300                                                                  39330000
393400           WHEN DFHRESP(CONTAINERERR)                             39340000
393500                                                                  39350000
393600*                STRING  'Container NOT FOUND'                    39360000
393700*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         39370000
393800*                PERFORM 9990-WRITE-CICS                          39380000
393900                 SET PS-RETR-ERROR    TO TRUE                     39390000
394000                                                                  39400000
394100           WHEN DFHRESP(NORMAL)                                   39410000
394200                                                                  39420000
394300                 SET PS-RETR-NO-ERROR TO TRUE                     39430000
394400*                MOVE PV-CONT-LEN     TO PV-CONT-LEN-DISP         39440000
394500*                STRING  '>========<'                             39450000
394600*                        'Container Name : ' 'DFHHEADER'          39460000
394700*                        'Content length : ' PV-CONT-LEN-DISP     39470000
394800*                 DELIMITED BY SIZE INTO PV-CICS-MSG-AREA         39480000
394900*                PERFORM 9990-WRITE-CICS                          39490000
395000                                                                  39500000
395100                 MOVE PV-CONT-LEN    TO PV-GETMAIN-LEN            39510000
395200                                                                  39520000
395300                 IF PV-GETMAIN-LEN > 0                            39530000
395400                                                                  39540000
395500                  EXEC CICS GETMAIN                               39550000
395600                    SET(PV-GETMAIN-PTR)                           39560000
395700                    FLENGTH(PV-GETMAIN-LEN)                       39570000
395800                  END-EXEC                                        39580000
395900                                                                  39590000
396000                  SET ADDRESS OF PV-GETMAIN-AREA TO               39600000
396100                  PV-GETMAIN-PTR                                  39610000
396200                                                                  39620000
396300                  EXEC CICS GET CONTAINER('OLD-HEADER1')          39630000
396400                   INTO(PV-GETMAIN-AREA)                          39640000
396500                   FLENGTH(PV-CONT-LEN)                           39650000
396600                  END-EXEC                                        39660000
396700                                                                  39670000
396800*                 STRING  'DFHHEADER Container content: '         39680000
396900*                 PV-GETMAIN-AREA(80:)                            39690000
397000*                  DELIMITED BY SIZE INTO PV-CICS-MSG-AREA        39700000
397100*                 PERFORM 9990-WRITE-CICS                         39710000
397200*                 DISPLAY 'PV-GETMAIN-AREA: ' PV-GETMAIN-AREA     39720000
397300                  MOVE PV-GETMAIN-LEN  TO PV-RETR-KMH-LEN         39730000
397400                  MOVE PV-GETMAIN-AREA TO PV-RETR-KMH-AREA        39740000
397500                                                                  39750000
397600                 ELSE                                             39760000
397700                                                                  39770000
397800                  SET PS-RETR-ERROR    TO TRUE                    39780000
397900                                                                  39790000
398000                 END-IF                                           39800000
398100                                                                  39810000
398200           WHEN DFHRESP(CCSIDERR)                                 39820000
398300                                                                  39830000
398400               SET PS-RETR-ERROR  TO TRUE                         39840000
398500               EXEC CICS ABEND ABCODE('C015') END-EXEC            39850000
398600               CONTINUE                                           39860000
398700                                                                  39870000
398800           WHEN DFHRESP(CONTAINERERR)                             39880000
398900                                                                  39890000
399000               SET PS-RETR-ERROR  TO TRUE                         39900000
399100               EXEC CICS ABEND ABCODE('C016') END-EXEC            39910000
399200               CONTINUE                                           39920000
399300                                                                  39930000
399400           WHEN DFHRESP(INVREQ)                                   39940000
399500                                                                  39950000
399600               SET PS-RETR-ERROR  TO TRUE                         39960000
399700               EXEC CICS ABEND ABCODE('C017') END-EXEC            39970000
399800               CONTINUE                                           39980000
399900                                                                  39990000
400000           WHEN DFHRESP(LENGERR)                                  40000000
400100                                                                  40010000
400200               SET PS-RETR-ERROR  TO TRUE                         40020000
400300               EXEC CICS ABEND ABCODE('C018') END-EXEC            40030000
400400               CONTINUE                                           40040000
400500                                                                  40050000
400600        END-EVALUATE                                              40060000
400700           .                                                      40070000
400800******************************************************************40080000
400900* THIS PARA READS CONFIG FILE (VSAM)                              40090000
401000* PV-RESP IS HANDLED ALWAYS FROM WHEREVER THIS PARA IS INVOKED.   40100000
401100* SO, DO NOT HANDLE PV-RESP HERE                                  40110000
401200******************************************************************40120000
401300 7000-VSAM-FILE-READ.                                             40130000
401400*    STRING  'TR071-CA-KEY :' TR071-CA-KEY                        40140000
401500*        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  40150000
401600*    PERFORM 9990-WRITE-CICS                                      40160000
401700                                                                  40170000
401800     EXEC CICS READ                                               40180000
401900          DATASET   (PV-VSAM-FILE-NM)                             40190000
402000          INTO      (PV-CONFIG-RECORD)                            40200000
402100          LENGTH    (PV-RECORD-LENGTH-300)                        40210000
402200          RIDFLD    (TR071-CA-KEY)                                40220000
402300          KEYLENGTH (48)                                          40230000
402400          RESP      (PV-RESP)                                     40240000
402500          RESP2 (PV-RESP2)                                        40250000
402600     END-EXEC                                                     40260000
402700                                                                  40270000
402800*    DISPLAY 'RESP : ' PV-RESP                                    40280000
402900*    DISPLAY 'RESP2: ' PV-RESP2                                   40290000
403000           .                                                      40300000
403100 9990-WRITE-CICS.                                                 40310000
403200                                                                  40320000
403300     EXEC CICS WRITEQ TD                                          40330000
403400         QUEUE('CSSL')                                            40340000
403500         FROM(PV-CICS-MSG-AREA)                                   40350000
403600         NOHANDLE                                                 40360000
403700     END-EXEC.                                                    40370000
403800                                                                  40380000
403900     MOVE SPACES TO PV-CICS-MSG-AREA                              40390000
404000           .                                                      40400000
404100*                                                                 40410000
