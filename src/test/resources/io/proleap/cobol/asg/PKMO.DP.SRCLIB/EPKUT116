000100 IDENTIFICATION DIVISION.                                         00010033
000200 PROGRAM-ID.      EPKUT116.                                       00020033
000300 AUTHOR.          BOB KOLESAR (SAFENET CONSULTING).               00030033
000400 DATE-WRITTEN.    MAY, 2003.                                      00040033
000500                                                                  00050033
000600*-----------------------------------------------------------      00060033
000700*              NEXT FUTURE DAY(S)                                 00070033
000800*-----------------------------------------------------------      00080033
000900*-----------------------------------------------------------      00090033
001000* HISTORY LOG:                                                    00100033
001100*-----------------------------------------------------------      00110033
001200* DATE: 06/21/2021                                                00120033
001300* WR/IR#: CHG0258136                                              00130033
001400* PROGRAMMER: COGNIZANT                                           00140033
001500* DESCRIPTION:                                                    00150033
???FIX*  CHANGE MADE: EPK317 IS A DAILY BATCH JOB THAT REGULARLY        00160033
???FIX*  APPEARS ON A LIST OF TOP 25 CPU CONSUMERS. IT TYPICALLY        00170033
???FIX*  RUNS FROM 20-30 MINUTES AND USES AROUND 15 CPU MINUTES EACH    00180033
???FIX*  RUN.  THE MAJORITY OF THAT TIME IS SPENT IN STEP S030          00190033
???FIX*  WHICH EXECUTES EPKUT116 MOST TIME WITHIN EPKUT116 IS           00200033
???FIX*  SPENT ON DB2 CURSOR FUTURE-RMS. BY MAKING THE TWO CHANGES      00210033
???FIX*  (INDEX CREATION AND PROGRAM CHANGES) WE WERE ABLE TO REDUCE    00220033
???FIX*  BOTH ELAPSED TIME AND CPU TIME TO SECONDS WHEN TESTING         00230033
???FIX*  WITH PRODUCTION VOLUMES.                                       00240033
001600*                                                                 00250033
001700*----------------------------------------------------------       00260033
001800 ENVIRONMENT DIVISION.                                            00270033
001900*----------------------------------------------------------       00280033
002000 CONFIGURATION SECTION.                                           00290033
002100 SOURCE-COMPUTER.        IBM-3090.                                00300033
002200 OBJECT-COMPUTER.        IBM-3090.                                00310033
002210                                                                  00320033
002220 INPUT-OUTPUT SECTION.                                            00330033
002230                                                                  00340033
002240 FILE-CONTROL.                                                    00350033
002250                                                                  00360033
002251     SELECT CONTROL-CARD-FOR-RESTART                              00370033
002252       ASSIGN TO UPD01.                                           00380033
002253     SELECT CONTROL-CARD-LAST-FUTURE-DTE                          00390033
002254       ASSIGN TO INP02.                                           00400033
002255     SELECT CONTROL-CARD-CURR-FUTURE-DTE                          00410033
002256       ASSIGN TO INP03.                                           00420033
002255     SELECT CONTROL-CARD-CURR-BATCH-DTE                           00430033
002256       ASSIGN TO INP04.                                           00440033
002259     SELECT PROMO-INTFC-FILE                                      00450033
002260       ASSIGN TO OUT01.                                           00460033
002270                                                                  00470033
002280 DATA DIVISION.                                                   00480033
002290 FILE SECTION.                                                    00490033
002300                                                                  00500033
002400 FD  CONTROL-CARD-FOR-RESTART                                     00510033
002500     RECORDING MODE F                                             00520033
002600     BLOCK CONTAINS 0 RECORDS                                     00530033
002700     LABEL RECORDS ARE OMITTED                                    00540033
002800     DATA RECORD IS CONTROL-CARD-FOR-RESTART-REC.                 00550033
002900 01  CONTROL-CARD-FOR-RESTART-REC              PIC  X(080).       00560033
003000                                                                  00570033
003001 FD  CONTROL-CARD-LAST-FUTURE-DTE                                 00580033
003002     RECORDING MODE F                                             00590033
003003     BLOCK CONTAINS 0 RECORDS                                     00600033
003004     LABEL RECORDS ARE OMITTED                                    00610033
003005     DATA RECORD IS CNTRL-CARD-LAST-FUTURE-DTE-REC.               00620033
003006 01  CNTRL-CARD-LAST-FUTURE-DTE-REC            PIC  X(080).       00630033
003007                                                                  00640033
003008 FD  CONTROL-CARD-CURR-FUTURE-DTE                                 00650033
003009     RECORDING MODE F                                             00660033
003010     BLOCK CONTAINS 0 RECORDS                                     00670033
003020     LABEL RECORDS ARE OMITTED                                    00680033
003030     DATA RECORD IS CNTRL-CARD-CURR-FUTURE-DTE-REC.               00690033
003040 01  CNTRL-CARD-CURR-FUTURE-DTE-REC            PIC  X(080).       00700033
003050                                                                  00710033
003001 FD  CONTROL-CARD-CURR-BATCH-DTE                                  00720033
003002     RECORDING MODE F                                             00730033
003003     BLOCK CONTAINS 0 RECORDS                                     00740033
003004     LABEL RECORDS ARE OMITTED                                    00750033
003005     DATA RECORD IS CNTRL-CARD-CURR-BATCH-DTE-REC.                00760033
003006 01  CNTRL-CARD-CURR-BATCH-DTE-REC             PIC  X(080).       00770033
003007                                                                  00780033
003060 FD  PROMO-INTFC-FILE                                             00790033
003070     RECORDING MODE F                                             00800033
003080     BLOCK CONTAINS 0 RECORDS                                     00810033
003090     LABEL RECORDS ARE OMITTED                                    00820033
003100     DATA RECORD IS PROMO-INTFC-ID-RECORD.                        00830033
003200 01  PROMO-INTFC-RECORD                        PIC  X(200).       00840033
003300                                                                  00850033
004100 WORKING-STORAGE SECTION.                                         00860033
004200*-----------------------------------------------------------      00870033
004300* PS-PROGRAM SWITCHES                                             00880033
004400*-----------------------------------------------------------      00890033
004500 01  PS-PROGRAM-SWITCHES.                                         00900033
004600     05  PS-FUTRE-DAY-RMS-CSR-EOF-SW           PIC  X(001).       00910033
004700       88  PS-FUTRE-DAY-RMS-CSR-EOF              VALUE 'Y'.       00920033
004800       88  PS-FUTRE-DAY-RMS-CSR-NOT-EOF          VALUE 'N'.       00930033
004900     05  PS-FUTRE-DAY-ADHOC-CSR-EOF-SW         PIC  X(001).       00940033
005000       88  PS-FUTRE-DAY-ADHOC-CSR-EOF            VALUE 'Y'.       00950033
005100       88  PS-FUTRE-DAY-ADHOC-CSR-NOT-EOF        VALUE 'N'.       00960033
004900     05  PS-STORE-OVRRDE-CSR-EOF-SW            PIC  X(001).       00970033
005000       88  PS-STORE-OVRRDE-CSR-EOF               VALUE 'Y'.       00980033
005100       88  PS-STORE-OVRRDE-CSR-NOT-EOF           VALUE 'N'.       00990033
005800     05 PS-FILE-STATUS                         PIC  X(002).       01000033
005900       88  PS-SUCCESSFUL-COMPLETION              VALUE '00'.      01010033
006000       88  PS-END-OF-FILE                        VALUE '10'.      01020033
006100       88  PS-SUCCESSFUL-OPEN                    VALUE '97'.      01030033
006200     05  PS-END-OF-CNTL-CRD-SW                 PIC  X(001).       01040033
006300       88  PS-END-OF-CNTL-CRD-FILE               VALUE 'Y'.       01050033
006400       88  PS-NOT-END-OF-CNTL-CRD-FILE           VALUE 'N'.       01060033
006500     05  PS-END-OF-RESTART-CD-SW               PIC  X(001).       01070033
006600       88  PS-END-OF-RESTART-CARD                VALUE 'N'.       01080033
006700       88  PS-NOT-END-OF-RESTART-CARD            VALUE 'Y'.       01090033
006800                                                                  01100033
006900*-----------------------------------------------------------      01110033
007000* PROGRAM CONSTANTS                                               01120033
007100*-----------------------------------------------------------      01130033
007200 01  PC-PROGRAM-CONSTANTS.                                        01140033
007210     05  PC-CURRENT-PROGRAM-NAME               PIC  X(008)        01150033
007220       VALUE 'EPKUT116'.                                          01160033
007230     05  PC-INTFC-ID                           PIC  X(010).       01170033
007240     05  PC-STR-GRP-AD-IND                     PIC  X(001).       01180033
007250       88  PC-RMS-STR-GRP                        VALUE 'S'.       01190033
007260       88  PC-ADHOC-STR-GRP                      VALUE 'A'.       01200033
007270     05  PC-PRICING-BUS-EVENT                  PIC  X(003)        01210033
007280       VALUE '090'.                                               01220033
007290     05  PC-RMS-PRC-SETUP-IND                  PIC  X(001)        01230033
007300       VALUE 'R'.                                                 01240033
007290     05  PC-RERUN-IND                          PIC  X(001)        01250033
007300       VALUE 'R'.                                                 01260033
007400     05  PC-ADHOC-PRC-SETUP-IND                PIC  X(001)        01270033
007500       VALUE 'A'.                                                 01280033
007600     05  PC-ADHOC-STR-GRP-TYP-CDE              PIC  X(005)        01290033
007700       VALUE '99999'.                                             01300033
008000     05  PC-FILE-ACT-TYPE                      PIC  X(003)        01310033
008100       VALUE 'CHG'.                                               01320033
008200     05  PC-APPLY-NIGHTLY                      PIC  X(001)        01330033
008300       VALUE 'N'.                                                 01340033
008400     05  PC-ADD-STAT-CDE                       PIC  X(001)        01350033
008500       VALUE 'A'.                                                 01360033
008800     05  PC-MDSE-INCL-IND                      PIC  X(001)        01370033
008900       VALUE 'I'.                                                 01380033
008800     05  PC-MDSE-INCL-ALL-IND                  PIC  X(001)        01390033
008900       VALUE 'B'.                                                 01400033
009000                                                                  01410033
009100*-----------------------------------------------------------      01420033
009200* PV- PROGRAM VARIABLES                                           01430033
009300*-----------------------------------------------------------      01440033
009400 01  PV-PROGRAM-VARAIBLES.                                        01450033
009500     05  PV-SQL-SUB                                PIC S9(004)    01460033
009600                                                     VALUE +0     01470033
009700                                                     COMP.        01480033
008693     05  PV-PROMO-INTFC-ID                         PIC S9(010)    01490033
008692                                                     VALUE ZEROS  01500033
                                                           COMP-3.      01510033
008693     05  PV-MDSE-LNE-ID                            PIC S9(010)    01520033
008692                                                     VALUE ZEROS  01530033
                                                           COMP-3.      01540033
008693     05  PV-STR-SELN-HIER-CDE                      PIC S9(002)    01550033
008692                                                     VALUE ZEROS  01560033
                                                           COMP-3.      01570033
010100     05  PV-HOLD-INTERFACE-ID                      PIC S9(010)    01580033
008692                                                     VALUE ZEROS  01590033
010110                                                     COMP-3.      01600033
010134     05  PV-SOR-LAST-UPD-TMST                      PIC  X(026)    01610033
010135                                                     VALUE SPACES.01620033
010143     05  PV-ABEND-CODE                             PIC  9(004)    01630033
010144                                                     VALUE ZEROS  01640033
010145                                                     COMP.        01650033
010150     05  EP107-CC-CRNT-DTE-MINUS1                  PIC  X(010)    01660033
010160                                                     VALUE SPACES.01670033
010161     05  EP101-CC-DATE-PLUS1                       PIC  X(010)    01680033
010162                                                     VALUE SPACES.01690033
                                                                        01700033
010168*----------------------------------------------------------       01710033
010169* STORE OVERRIDE SELECT VARIABLES.                                01720033
010170*----------------------------------------------------------       01730033
       01  STORE-OVERRIDE-RECORD.                                       01740033
           10 OVRRDE-PROMO-INTFC-ID                  PIC  S9(010)V      01750033
                                                       COMP-3.          01760033
           10 OVRRDE-MDSE-LNE-ID                     PIC  S9(010)V      01770033
                                                       COMP-3.          01780033
           10 OVRRDE-STR-GP-TYP-CDE                  PIC  S9(004)       01790033
                                                       COMP.            01800033
           10 OVRRDE-STR-GP-ID                       PIC  S9(004)       01810033
                                                       COMP.            01820033
           10 OVRRDE-PROMO-PRIC-VER-ID               PIC  S9(010)V      01830033
                                                       COMP-3.          01840033
           10 OVRRDE-STR-SELN-HIER-CDE               PIC  S9(002)V      01850033
                                                       COMP-3.          01860033
           10 OVRRDE-STAT-CDE                        PIC   X(001).      01870033
           10 OVRRDE-PRNT-GP-TYP-CDE                 PIC   X(001).      01880033
           10 OVRRDE-PRNT-STR-GP-CDE                 PIC  S9(004)       01890033
                                                       COMP.            01900033
           10 OVRRDE-PRNT-STR-GP-ID                  PIC  S9(004)       01910033
                                                       COMP.            01920033
           10 OVRRDE-PRNT-ADHC-GP-ID                 PIC  S9(010)V      01930033
                                                       COMP-3.          01940033
           10 OVRRDE-PROMO-STRT-TMST                 PIC   X(026).      01950033
           10 OVRRDE-PROMO-END-TMST                  PIC   X(026).      01960033
           10 OVRRDE-ACTL-STRT-TMST                  PIC   X(026).      01970033
           10 OVRRDE-ACTL-END-TMST                   PIC   X(026).      01980033
           10 OVRRDE-LAST-UPD-TMST                   PIC   X(026).      01990033
           10 OVRRDE-SOR-LAST-UPD-TMST               PIC   X(026).      02000033
           10 OVRRDE-LAST-ACTN-CDE                   PIC   X(001).      02010033
                                                                        02020033
010168*----------------------------------------------------------       02030033
010169* FULL FILE EXTRACT OUTPUT FILE.                                  02040033
010170*----------------------------------------------------------       02050033
010180     COPY EPRD072.                                                02060033
010190                                                                  02070033
011200*----------------------------------------------------------       02080033
000320* EPCC101 CONTROL CARD LAYOUT - THE LAST BATCH OFFSET NUMBER      02090033
000330*         AND THE LAST BATCH OFFSET DATE.                         02100033
011400*----------------------------------------------------------       02110033
011500     COPY EPRD101.                                                02120033
011600                                                                  02130033
010700*----------------------------------------------------------       02140033
010800* EPCC107 CONTROL CARD LAYOUT - CURRENT BATCH FUTURE DATE         02150033
010900*----------------------------------------------------------       02160033
011000     COPY EPRD107.                                                02170033
011100                                                                  02180033
010200*----------------------------------------------------------       02190033
010300* EPCC108 CONTROL CARD LAYOUT - RESTART INFORMATION               02200033
010400*----------------------------------------------------------       02210033
010500     COPY EPRD108.                                                02220033
010600                                                                  02230033
011200*----------------------------------------------------------       02240033
011300* EPCC111 CONTROL CARD LAYOUT - CURRENT BATCH DATE                02250033
011400*----------------------------------------------------------       02260033
011500     COPY EPRD111.                                                02270033
011600                                                                  02280033
011700*----------------------------------------------------------       02290033
011800* DATE ROUTINE COPY MEMBERS                                       02300033
011900*----------------------------------------------------------       02310033
012000     COPY DPWS500.                                                02320033
012100                                                                  02330033
012200*-----------------------------------------------------------      02340033
012300* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02350033
012400*-----------------------------------------------------------      02360033
012500     COPY DPWS004.                                                02370033
012600                                                                  02380033
012700*-----------------------------------------------------------      02390033
012800* DB2 ABEND COPYBOOK                                              02400033
012900*-----------------------------------------------------------      02410033
013000     COPY DPWS900.                                                02420033
013100                                                                  02430033
013200*-----------------------------------------------------------      02440033
013300* DB2 MESSAGE AREA                                                02450033
013400*-----------------------------------------------------------      02460033
013500     COPY SQLCA2.                                                 02470033
013600                                                                  02480033
013700*-----------------------------------------------------------      02490033
013800* PROGRAM COUNTERS                                                02500033
013900*-----------------------------------------------------------      02510033
014000 01  PC-PROGRAM-COUNTERS.                                         02520033
014100     05  PC-CNT-READ-RECS                      PIC  9(009)        02530033
014200                                                 VALUE 0.         02540033
014300     05  PC-CNT-PROMO-RECS                     PIC  9(009)        02550033
014400                                                 VALUE 0.         02560033
014500     05  PC-CNT-RESTRT-RECS                    PIC  9(009)        02570033
014600                                                 VALUE 0.         02580033
014700     05  PC-CNT-ERROR-RECS                     PIC  9(009)        02590033
014710                                                 VALUE 0.         02600033
014720     05  PC-CNT-ALL-RECS                       PIC  9(009)        02610033
014730                                                 VALUE 0.         02620033
014780     05  PC-MAX-RETRIES                        PIC S9(004)        02630033
014790                                                 VALUE +5         02640033
014800                                                 COMP.            02650033
014900                                                                  02660033
015000*-----------------------------------------------------------      02670033
015100* ERROR HANDLING                                                  02680033
015200*-----------------------------------------------------------      02690033
015300 01  PV-MISC-ABEND-FIELDS.                                        02700033
015400     05  PV-PARAGRAPH-NAME                     PIC  X(030)        02710033
015500                                                 VALUE SPACE.     02720033
015600     05  PV-OPERATION-MSG-1                    PIC  X(040)        02730033
015700                                                 VALUE SPACE.     02740033
015800     05  PV-OPERATION-MSG-2                    PIC  X(040)        02750033
015900                                                 VALUE SPACE.     02760033
016000     05  PV-DB2-OPERATION                      PIC  X(030)        02770033
016100                                                 VALUE SPACE.     02780033
016200 01  ABEND-CODE                                PIC S9(004)        02790033
016210                                                 VALUE ZEROS      02800033
016220                                                 COMP             02810033
016230                                                 SYNC.            02820033
016240   88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.     02830033
016250   88  ABEND-4013-DB2-ERROR                      VALUE +4013.     02840033
016260   88  ABEND-4019-CAL-SUB-ERROR                  VALUE +4019.     02850033
016270   88  ABEND-4020-MQ-ERROR                       VALUE +4020.     02860033
016280   88  ABEND-4444-FORCED-ABEND                   VALUE +4444.     02870033
016290   88  ABEND-4008                                VALUE +4008.     02880033
016300                                                                  02890033
016400*-----------------------------------------------------------      02900033
016500* DB2 COMMUNICATIONS AREA                                         02910033
016600*-----------------------------------------------------------      02920033
016700     EXEC SQL                                                     02930033
016800       INCLUDE SQLCA                                              02940033
016900     END-EXEC.                                                    02950033
017000                                                                  02960033
018210*-----------------------------------------------------------      02970033
018220* DB2 TABLE XST00028(XST_MDSE_LNE_SELN) - MERCHANDISE TABLE       02980033
018230*-----------------------------------------------------------      02990033
018240     EXEC SQL                                                     03000033
018250       INCLUDE XST00028                                           03010033
018260     END-EXEC.                                                    03020033
018270                                                                  03030033
018280*-----------------------------------------------------------      03040033
018290* DB2 TABLE XST00029(XST_PROMO_STR_GP) - STORE ZONE PRICING       03050033
018300*                                               TABLE             03060033
018400*-----------------------------------------------------------      03070033
018500     EXEC SQL                                                     03080033
018600       INCLUDE XST00029                                           03090033
018700     END-EXEC.                                                    03100033
018800                                                                  03110033
018900*-----------------------------------------------------------      03120033
019000* DB2 TABLE XST00031(XST_PROMO_ADHC_RLT) ADHOC RELATION           03130033
019100*-----------------------------------------------------------      03140033
019200     EXEC SQL                                                     03150033
019300       INCLUDE XST00031                                           03160033
019400     END-EXEC.                                                    03170033
019500                                                                  03180033
020300*-----------------------------------------------------------      03190033
020400* FUTURE PROMOTIONS ID CURSOR. (RMS)                              03200033
020500*-----------------------------------------------------------      03210033
020600     EXEC SQL                                                     03220033
020700       DECLARE FUTURE-RMS CURSOR FOR                              03230033
020900         SELECT STRGP.PROMO_INTFC_ID                              03240033
021000               ,STRGP.MDSE_LNE_ID                                 03250033
021100               ,STRGP.STR_GP_TYP_CDE                              03260033
021200               ,STRGP.STR_GP_ID                                   03270033
021300               ,STRGP.STR_SELN_HIER_CDE                           03280033
021400               ,STRGP.ACTL_STRT_TMST                              03290033
021500               ,STRGP.ACTL_END_TMST                               03300033
021600               ,STRGP.SOR_LAST_UPD_TMST                           03310033
021700               ,MDSSEL.PRICG_TYP_CDE                              03320033
021740         FROM XST_PROMO_STR_GP   STRGP                            03330033
021750             ,XST_MDSE_LNE_SELN  MDSSEL                           03340033
021755         WHERE STRGP.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       03350033
021756           AND STRGP.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          03360033
???FIX*          AND STRGP.PROMO_INTFC_ID >= :PV-HOLD-INTERFACE-ID      03370033
???FIX           AND (STRGP.PROMO_INTFC_ID >= :PV-HOLD-INTERFACE-ID     03380033
???FIX             OR 0=1)                                              03390033
021757           AND STRGP.STAT_CDE  IN ('S')                           03400033
021758           AND MDSSEL.STAT_CDE IN ('S')                           03410033
021779           AND (DATE(STRGP.ACTL_STRT_TMST)                        03420033
021780               BETWEEN :EP101-CC-DATE-PLUS1                       03430033
021781                   AND :EP107-CC-CRNT-DTE)                        03440033
021800           AND :EP111-CC-CRNT-DTE < DATE(STRGP.ACTL_END_TMST)     03450033
021802         ORDER BY STRGP.PROMO_INTFC_ID, STRGP.MDSE_LNE_ID         03460033
021803         FOR FETCH ONLY                                           03470033
021804         WITH UR                                                  03480033
021805     END-EXEC.                                                    03490033
021806                                                                  03500033
021807*-----------------------------------------------------------      03510033
021808* FUTURE PROMOTIONS ID ADHOC CURSOR.                              03520033
021809*-----------------------------------------------------------      03530033
021810     EXEC SQL                                                     03540033
021820       DECLARE FUTURE-ADHOC CURSOR FOR                            03550033
021840         SELECT ADHOC.PROMO_INTFC_ID                              03560033
021850               ,ADHOC.MDSE_LNE_ID                                 03570033
021860               ,ADHOC.ADHC_STR_GP_ID                              03580033
021870               ,ADHOC.STR_SELN_HIER_CDE                           03590033
021871               ,ADHOC.ACTL_STRT_TMST                              03600033
021872               ,ADHOC.ACTL_END_TMST                               03610033
021873               ,ADHOC.SOR_LAST_UPD_TMST                           03620033
021876               ,MDSSEL.PRICG_TYP_CDE                              03630033
021880         FROM XST_PROMO_ADHC_RLT ADHOC                            03640033
021882             ,XST_MDSE_LNE_SELN  MDSSEL                           03650033
021888         WHERE ADHOC.PROMO_INTFC_ID = MDSSEL.PROMO_INTFC_ID       03660033
021889           AND ADHOC.MDSE_LNE_ID    = MDSSEL.MDSE_LNE_ID          03670033
021755           AND ADHOC.PROMO_INTFC_ID >= :PV-HOLD-INTERFACE-ID      03680033
021890           AND ADHOC.STAT_CDE  IN ('S')                           03690033
021891           AND MDSSEL.STAT_CDE IN ('S')                           03700033
021779           AND (DATE(ADHOC.ACTL_STRT_TMST)                        03710033
021780               BETWEEN :EP101-CC-DATE-PLUS1                       03720033
021781                   AND :EP107-CC-CRNT-DTE)                        03730033
021800           AND :EP111-CC-CRNT-DTE < DATE(ADHOC.ACTL_END_TMST)     03740033
021802         ORDER BY ADHOC.PROMO_INTFC_ID, ADHOC.MDSE_LNE_ID         03750033
021925         FOR FETCH ONLY                                           03760033
021926         WITH UR                                                  03770033
021927     END-EXEC.                                                    03780033
021928                                                                  03790033
019100*-----------------------------------------------------------      03800033
019200* STORE OVERRIDE CURSOR. (RMS & ADHOC STORES)                     03810033
019300*-----------------------------------------------------------      03820033
019400     EXEC SQL                                                     03830033
019500       DECLARE STORE-OVRRDE CURSOR FOR                            03840033
019900         SELECT STRGP.PROMO_INTFC_ID                              03850033
020000               ,STRGP.MDSE_LNE_ID                                 03860033
020100               ,STRGP.STR_GP_TYP_CDE                              03870033
020200               ,STRGP.STR_GP_ID                                   03880033
020300               ,STRGP.STR_SELN_HIER_CDE                           03890033
020400               ,STRGP.STAT_CDE                                    03900033
                     ,STRGP.ACTL_STRT_TMST                              03910033
                     ,STRGP.ACTL_END_TMST                               03920033
020500               ,STRGP.LAST_UPD_TMST                               03930033
020500               ,STRGP.SOR_LAST_UPD_TMST                           03940033
020800         FROM XST_PROMO_STR_GP   STRGP                            03950033
021200         WHERE STRGP.PROMO_INTFC_ID  = :PV-PROMO-INTFC-ID         03960033
021300           AND STRGP.MDSE_LNE_ID     = :PV-MDSE-LNE-ID            03970033
                 AND (STRGP.STR_SELN_HIER_CDE                           03980033
                                         > :PV-STR-SELN-HIER-CDE)       03990033
021780         FOR FETCH ONLY                                           04000033
021790         WITH UR                                                  04010033
021800     END-EXEC.                                                    04020033
                                                                        04030033
021929 LINKAGE SECTION.                                                 04040033
021930                                                                  04050033
021931*----------------------------------------------------------       04060033
021940 PROCEDURE DIVISION.                                              04070033
021950*----------------------------------------------------------       04080033
021951 0000-MAINLINE.                                                   04090033
021952                                                                  04100033
021953     PERFORM 1000-INITIALIZATION.                                 04110033
021954                                                                  04120033
021955     PERFORM 2000-PROCESS-STORES.                                 04130033
021956                                                                  04140033
021957     PERFORM 9999-WRAPUP.                                         04150033
021958                                                                  04160033
021959     GOBACK.                                                      04170033
021960                                                                  04180033
021970*0000-EXIT.                                                       04190033
021980 EJECT.                                                           04200033
021990                                                                  04210033
022000*----------------------------------------------------------       04220033
022100* 1000-INITIALIZATION.                                            04230033
022200*     INITIALIZATION AREA - INITIALIZES ALL VARIABLES, OPENS      04240033
022300*     FILES, READS INPUT FILES, AND PROCESSES ANY INPUT FILE      04250033
022400*     PARAMETERS IT MAY NEED TO USE TO READ THE PROMO             04260033
022500*     INTERFACE ID FILE.                                          04270033
022600*----------------------------------------------------------       04280033
022700 1000-INITIALIZATION.                                             04290033
022800                                                                  04300033
022900     OPEN INPUT  CONTROL-CARD-FOR-RESTART                         04310033
023000                 CONTROL-CARD-CURR-FUTURE-DTE                     04320033
023100                 CONTROL-CARD-LAST-FUTURE-DTE                     04330033
023100                 CONTROL-CARD-CURR-BATCH-DTE                      04340033
023300     OPEN OUTPUT PROMO-INTFC-FILE.                                04350033
023400                                                                  04360033
023500     PERFORM 1010-READ-RESTART-CONTROL-CARD                       04370033
023600       UNTIL PS-END-OF-RESTART-CARD.                              04380033
023700     PERFORM 1020-READ-LAST-FUTURE-DTE-CARD.                      04390033
023800     PERFORM 1030-READ-CURR-FUTURE-DTE-CARD.                      04400033
023800     PERFORM 1040-READ-CURR-BATCH-DTE-CARD.                       04410033
024000     PERFORM 6100-DATE-ROUTINE.                                   04420033
024100     CLOSE CONTROL-CARD-FOR-RESTART.                              04430033
024200     OPEN OUTPUT CONTROL-CARD-FOR-RESTART.                        04440033
024300                                                                  04450033
024400*1000-EXIT.                                                       04460033
024500 EJECT.                                                           04470033
024600                                                                  04480033
024700*----------------------------------------------------------       04490033
024800* 1010-READ-RESTART-CONTROL-CARD.                                 04500033
024900*     READ RESTART CONTROL CARD. THIS DETERMINES IF THIS IS       04510033
025000*     AN INITAL RUN OF THE PROGRAM OR A RESTART. IF A RESTART     04520033
025100*     THIS CARD WILL CONTAIN THE ENDING PROMO INTFCE ID.          04530033
025200*----------------------------------------------------------       04540033
025300 1010-READ-RESTART-CONTROL-CARD.                                  04550033
025400                                                                  04560033
02580      SET PS-NOT-END-OF-RESTART-CARD TO TRUE.                      04570033
                                                                        04580033
025500     READ CONTROL-CARD-FOR-RESTART                                04590033
025600                               INTO EP108-PROMO-RESTART-REC       04600033
025700       AT END                                                     04610033
025800         SET PS-END-OF-RESTART-CARD TO TRUE                       04620033
025900     END-READ.                                                    04630033
026000                                                                  04640033
026100     IF PS-NOT-END-OF-RESTART-CARD                                04650033
026200       ADD 1 TO PC-CNT-READ-RECS                                  04660033
026300     END-IF.                                                      04670033
                                                                        04680033
026400     IF EP108-JOB-RUN-TYP-IND = SPACES AND                        04690033
026400        EP108-INTERFACE-ID    = ZEROS AND                         04700033
026400        EP108-CURSOR-EXEC-IND = SPACES                            04710033
026500          DISPLAY ' '                                             04720033
026600          DISPLAY '** ABEND     **'                               04730033
026700          DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME   04740033
026800          DISPLAY '** PARAGRAPH **  = 1010-READ-PGM-LAST-RUN-CARD'04750033
026900          DISPLAY '** RESTART CNTRL FILE IS EMPTY  '              04760033
027000          DISPLAY ' '                                             04770033
027100          MOVE +4002 TO ABEND-CODE                                04780033
027200          CALL 'ILBOABN0' USING ABEND-CODE                        04790033
027700     END-IF.                                                      04800033
027800                                                                  04810033
027900*1010-EXIT.                                                       04820033
028000 EJECT.                                                           04830033
028100                                                                  04840033
028200*----------------------------------------------------------       04850033
028210* 1020-READ-LAST-FUTURE-DTE-CARD.                                 04860033
028220*     READ CONTROL CARD.  THIS GETS THE FUTURE DATE CARD          04870033
028240*----------------------------------------------------------       04880033
028250 1020-READ-LAST-FUTURE-DTE-CARD.                                  04890033
028260                                                                  04900033
028270     READ CONTROL-CARD-LAST-FUTURE-DTE                            04910033
028280                                  INTO EP101-CC-CONTROL-CARD      04920033
028290       AT END                                                     04930033
028300         SET PS-END-OF-CNTL-CRD-FILE TO TRUE                      04940033
028301     END-READ.                                                    04950033
028302                                                                  04960033
028303     IF PS-END-OF-CNTL-CRD-FILE                                   04970033
028304       DISPLAY ' '                                                04980033
028305       DISPLAY '** ABEND     **'                                  04990033
028306       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05000033
028307       DISPLAY '** PARAGRAPH **  = 1020-READ-LAST-FUTURE-DTE-CARD'05010033
028308       DISPLAY '** LAST BATCH DATE CRD IS EMPTY  '                05020033
028309       DISPLAY ' '                                                05030033
028310       MOVE +4002 TO ABEND-CODE                                   05040033
028311       CALL 'ILBOABN0' USING ABEND-CODE                           05050033
028312     ELSE                                                         05060033
028313       DISPLAY '** LAST BTCH DTE CONTROL CARD  **'                05070033
028314       DISPLAY '** EPCC101   *  = ' EP101-CC-LAST-DTE             05080033
028315       DISPLAY ' '                                                05090033
028316     END-IF.                                                      05100033
028317                                                                  05110033
028318*1020-EXIT.                                                       05120033
028319 EJECT.                                                           05130033
028320                                                                  05140033
028321*----------------------------------------------------------       05150033
028322* 1030-READ-CURR-FUTURE-DTE-CARD.                                 05160033
028323*     READ CONTROL CARD.  THIS GETS THE PROMO INTERFACE           05170033
028324*     ID'S IT NEEDS TO PROCESS.                                   05180033
028325*----------------------------------------------------------       05190033
028326 1030-READ-CURR-FUTURE-DTE-CARD.                                  05200033
028327                                                                  05210033
028328     READ CONTROL-CARD-CURR-FUTURE-DTE                            05220033
028329                                  INTO EP107-CC-CONTROL-CARD      05230033
028330       AT END                                                     05240033
028331         SET PS-END-OF-CNTL-CRD-FILE TO TRUE                      05250033
028332     END-READ.                                                    05260033
028333                                                                  05270033
028334     IF PS-END-OF-CNTL-CRD-FILE                                   05280033
028335       DISPLAY ' '                                                05290033
028336       DISPLAY '** ABEND     **'                                  05300033
028337       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05310033
028338       DISPLAY '** PARAGRAPH **  = 1030-READ-CURR-FUTURE-DTE-CARD'05320033
028339       DISPLAY '** CURR FUTURE DATE CRD IS EMPTY  '               05330033
028340       DISPLAY ' '                                                05340033
028341       MOVE +4002 TO ABEND-CODE                                   05350033
028342       CALL 'ILBOABN0' USING ABEND-CODE                           05360033
028343     ELSE                                                         05370033
028344       DISPLAY '** CURRENT FUTURE DTE CONTROL CARD  **'           05380033
028345       DISPLAY '** EPCC107   *  = ' EP107-CC-CRNT-DTE             05390033
028346       DISPLAY ' '                                                05400033
028347     END-IF.                                                      05410033
028348                                                                  05420033
028349*1030-EXIT.                                                       05430033
028350 EJECT.                                                           05440033
028351                                                                  05450033
028200*----------------------------------------------------------       05460033
028210* 1040-READ-CURR-BATCH-DTE-CARD.                                  05470033
028220*     READ CONTROL CARD.  THIS GETS THE PROMO INTERFACE           05480033
028230*     ID'S IT NEEDS TO PROCESS.                                   05490033
028240*----------------------------------------------------------       05500033
028250 1040-READ-CURR-BATCH-DTE-CARD.                                   05510033
028260                                                                  05520033
028270     READ CONTROL-CARD-CURR-BATCH-DTE                             05530033
028280                                  INTO EP111-CC-CONTROL-CARD      05540033
028290       AT END                                                     05550033
028300         SET PS-END-OF-CNTL-CRD-FILE TO TRUE                      05560033
028301     END-READ.                                                    05570033
028302                                                                  05580033
028303     IF PS-END-OF-CNTL-CRD-FILE                                   05590033
028304       DISPLAY ' '                                                05600033
028305       DISPLAY '** ABEND     **'                                  05610033
028306       DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME      05620033
028307       DISPLAY '** PARAGRAPH **  = 1040-READ-CURR-BATCH-DTE-CARD' 05630033
028308       DISPLAY '** CURR BATCH DATE CRD IS EMPTY  '                05640033
028309       DISPLAY ' '                                                05650033
028310       MOVE +4002 TO ABEND-CODE                                   05660033
028311       CALL 'ILBOABN0' USING ABEND-CODE                           05670033
028312     ELSE                                                         05680033
028313       DISPLAY '** CURRENT BTCH DTE CONTROL CARD  **'             05690033
028314       DISPLAY '** EPCC111   *  = ' EP111-CC-CRNT-DTE             05700033
028315       DISPLAY ' '                                                05710033
028316     END-IF.                                                      05720033
028317                                                                  05730033
028318*1040-EXIT.                                                       05740033
028319 EJECT.                                                           05750033
028320                                                                  05760033
028370*----------------------------------------------------------       05770033
028371* 2000-PROCESS-STORES.                                            05780033
028372*     THE FIRST PART OF THIS MODULE COMPARES THE CURRENT          05790033
      *     FUTURE DATE TO THE LAST FUTURE DATE. IF THE LAST DATE       05800033
      *     IS > OR = TO THE CURRENT FUTURE DATE, THE EOF SWITCHES      05810033
      *     FOR THE CURSORS ARE SET TO 'Y' WHICH WILL END PROCESSING.   05820033
      *                                                                 05830033
028372*     THE MODULE THEN DETERMINES IF THIS RUN OF THE PROGRAM IS    05840033
028373*     AN INITAL BATCH RUN OR A RESTART. THIS IS ACCOMPLISHED BY   05850033
028374*     CHECKING THE LAST RECORD IN THE EPCC108 CONTROL CARD.       05860033
028375*     ONCE THE RUN IS DETERMINED TWO QUERYS (RMS AND ADHOC) ARE   05870033
028376*     EXECUTED WHICH IDENTIFY WHICH STORES SHOULD RECIEVE A       05880033
028377*     FULL FILE.                                                  05890033
028378*----------------------------------------------------------       05900033
028379 2000-PROCESS-STORES.                                             05910033
028380                                                                  05920033
           IF EP101-CC-LAST-DTE > EP107-CC-CRNT-DTE OR                  05930033
              EP101-CC-LAST-DTE = EP107-CC-CRNT-DTE                     05940033
028313         DISPLAY '***** PROCESSING  ENDED *****'                  05950033
028313         DISPLAY '** LAST FUTURE DATE IS >=  **'                  05960033
028313         DISPLAY '** CURRENT FUTURE DATE     **'                  05970033
028314         DISPLAY '** EPCC101   *  = ' EP101-CC-LAST-DTE           05980033
028314         DISPLAY '** EPCC107   *  = ' EP107-CC-CRNT-DTE           05990033
028313         DISPLAY '*****************************'                  06000033
                                                                        06010033
037500         SET PS-FUTRE-DAY-RMS-CSR-EOF TO TRUE                     06020033
037500         SET PS-FUTRE-DAY-ADHOC-CSR-EOF TO TRUE                   06030033
           END-IF.                                                      06040033
                                                                        06050033
028381     EVALUATE TRUE                                                06060033
028382       WHEN EP108-FIRST-RUN                                       06070033
028383         DISPLAY 'THIS IS AN INITAL RUN OF EPKUT116'              06080033
028384         MOVE ZEROS TO PV-HOLD-INTERFACE-ID                       06090033
R28385         PERFORM 2100-PROCESS-RMS-CURSOR UNTIL                    06100033
028386           PS-FUTRE-DAY-RMS-CSR-EOF                               06110033
028387         MOVE ZEROS TO PV-HOLD-INTERFACE-ID                       06120033
028388         PERFORM 2200-PROCESS-ADHC-CURSOR UNTIL                   06130033
028389           PS-FUTRE-DAY-ADHOC-CSR-EOF                             06140033
028390       WHEN EP108-RESTART                                         06150033
028391         DISPLAY 'THIS IS A RESTART OF EPKUT116'                  06160033
028392         MOVE EP108-INTERFACE-ID TO PV-HOLD-INTERFACE-ID          06170033
028393         IF EP108-RMS-STR-GRP                                     06180033
028394           PERFORM 2100-PROCESS-RMS-CURSOR UNTIL                  06190033
028395             PS-FUTRE-DAY-RMS-CSR-EOF                             06200033
028396           MOVE ZEROS TO PV-HOLD-INTERFACE-ID                     06210033
028397           PERFORM 2200-PROCESS-ADHC-CURSOR UNTIL                 06220033
028398             PS-FUTRE-DAY-ADHOC-CSR-EOF                           06230033
028399         END-IF                                                   06240033
028400         IF EP108-ADHOC-STR-GRP                                   06250033
028401           PERFORM 2200-PROCESS-ADHC-CURSOR UNTIL                 06260033
028402             PS-FUTRE-DAY-ADHOC-CSR-EOF                           06270033
028403         END-IF                                                   06280033
028404       WHEN OTHER                                                 06290033
028405         MOVE '2000-PROCESS-STORES'                               06300033
028406                                 TO PV-PARAGRAPH-NAME             06310033
028407         MOVE 'READ RESTART CONTROL CARD'                         06320033
028408                                 TO PV-OPERATION-MSG-1            06330033
052701         PERFORM 4100-WRITE-RESTART-RECORD                        06340033
028409         PERFORM 9800-ABEND                                       06350033
028410     END-EVALUATE.                                                06360033
028411                                                                  06370033
028412*2000-EXIT.                                                       06380033
028413 EJECT.                                                           06390033
028414                                                                  06400033
028415*----------------------------------------------------------       06410033
028416* 2100-PROCESS-RMS-CURSOR.                                        06420033
028420*     READS THE FOLLOWING TABLES: XST_PROMO_STR_GP                06430033
028430*                                 XST_MDSE_LNE_SELN               06440033
028440*     TO DETERMINE IF THE STORE NEEDS TO RECIEVE A FUTURE DAY(S)  06450033
028450*     FILE. IF SO, A RECORD IS CREATED TO BE SENT TO THE STORE.   06460033
028460*----------------------------------------------------------       06470033
028470 2100-PROCESS-RMS-CURSOR.                                         06480033
028480                                                                  06490033
028490     PERFORM 2110-OPEN-FUTURE-DAY-RMS.                            06500033
028500     PERFORM 2120-FETCH-FUTURE-DAY-RMS                            06510033
028600       UNTIL PS-FUTRE-DAY-RMS-CSR-EOF.                            06520033
028700     PERFORM 2130-CLOSE-FUTURE-DAY-RMS.                           06530033
028800                                                                  06540033
028900*2100-EXIT.                                                       06550033
029000 EJECT.                                                           06560033
029100                                                                  06570033
029200*----------------------------------------------------------       06580033
029300* 2110-OPEN-FUTURE-DAY-RMS.                                       06590033
029400*     OPEN THE FUTURE DAY PROMO AND PMAP CURSOR.                  06600033
029500*----------------------------------------------------------       06610033
029600 2110-OPEN-FUTURE-DAY-RMS.                                        06620033
029700                                                                  06630033
029800     PERFORM                                                      06640033
029900         WITH TEST AFTER                                          06650033
030000         VARYING PV-SQL-SUB                                       06660033
030100         FROM 1 BY 1                                              06670033
030200         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 06680033
030300                   OR  SQLCODE = 0)                               06690033
030400                                                                  06700033
030500         EXEC SQL                                                 06710033
030600           OPEN FUTURE-RMS                                        06720033
030700         END-EXEC                                                 06730033
030800                                                                  06740033
030900         EVALUATE TRUE                                            06750033
031000           WHEN SQLCODE = -904                                    06760033
031100           WHEN SQLCODE = -911                                    06770033
031200           WHEN SQLCODE = -913                                    06780033
031300             CONTINUE                                             06790033
031400           WHEN SQLCODE = 0                                       06800033
031500             SET PC-RMS-STR-GRP TO TRUE                           06810033
031600             SET PS-FUTRE-DAY-RMS-CSR-NOT-EOF TO TRUE             06820033
031700           WHEN SQLWARN0 NOT EQUAL SPACE                          06830033
031800           WHEN SQLCODE NOT EQUAL ZERO                            06840033
031900             MOVE '2110-OPEN-FUTURE-DAY-RMS'                      06850033
032000                                     TO PV-PARAGRAPH-NAME         06860033
032100             MOVE 'ERROR ON OPEN OF FUTURE-RMS CURSOR'            06870033
032200                                     TO PV-DB2-OPERATION          06880033
052701             PERFORM 4100-WRITE-RESTART-RECORD                    06890033
032300             PERFORM 9900-SQL-ABEND-ROUTINE                       06900033
032400         END-EVALUATE                                             06910033
032500     END-PERFORM.                                                 06920033
032600                                                                  06930033
032700     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         06940033
032800       MOVE '2110-OPEN-FUTURE-DAY-RMS'                            06950033
032900                             TO  PV-PARAGRAPH-NAME                06960033
033000       MOVE 'OPEN RETRIES EXCEEDED'                               06970033
033100                              TO  PV-DB2-OPERATION                06980033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          06990033
033200       PERFORM 9900-SQL-ABEND-ROUTINE                             07000033
033300     END-IF.                                                      07010033
033400                                                                  07020033
033500*2110-EXIT.                                                       07030033
033600 EJECT.                                                           07040033
033700                                                                  07050033
033800*----------------------------------------------------------       07060033
033900* 2120-FETCH-FUTURE-DAY-RMS.                                      07070033
034000*     FETCH THE TIERED PROMO AND PMAP CURSOR.                     07080033
034100*----------------------------------------------------------       07090033
034200 2120-FETCH-FUTURE-DAY-RMS.                                       07100033
034300                                                                  07110033
034400     PERFORM                                                      07120033
034500         WITH TEST AFTER                                          07130033
034600         VARYING PV-SQL-SUB                                       07140033
034700         FROM 1 BY 1                                              07150033
034800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07160033
034900                   OR  SQLCODE = 0                                07170033
035000                   OR  SQLCODE = +100)                            07180033
035100                                                                  07190033
035200         EXEC SQL                                                 07200033
035300           FETCH FUTURE-RMS                                       07210033
035500           INTO  :XST00029-PROMO-INTFC-ID                         07220033
035600                ,:XST00029-MDSE-LNE-ID                            07230033
035700                ,:XST00029-STR-GP-TYP-CDE                         07240033
035800                ,:XST00029-STR-GP-ID                              07250033
035900                ,:XST00029-STR-SELN-HIER-CDE                      07260033
036000                ,:XST00029-ACTL-STRT-TMST                         07270033
036100                ,:XST00029-ACTL-END-TMST                          07280033
036200                ,:XST00029-SOR-LAST-UPD-TMST                      07290033
036300                ,:XST00028-PRICG-TYP-CDE                          07300033
036400         END-EXEC                                                 07310033
036500                                                                  07320033
036600         EVALUATE TRUE                                            07330033
036700           WHEN SQLCODE = -904                                    07340033
036800           WHEN SQLCODE = -911                                    07350033
036900           WHEN SQLCODE = -913                                    07360033
037000             CONTINUE                                             07370033
037100           WHEN SQLCODE = ZERO                                    07380033
                   MOVE XST00029-PROMO-INTFC-ID TO PV-PROMO-INTFC-ID    07390033
                   MOVE XST00029-MDSE-LNE-ID    TO PV-MDSE-LNE-ID       07400033
                   MOVE XST00029-STR-SELN-HIER-CDE                      07410033
                                                TO PV-STR-SELN-HIER-CDE 07420033
037200             PERFORM 3000-FORMAT-RESTART-RECORD                   07430033
037300             PERFORM 3100-FORMAT-RMS-OUTPUT                       07440033
037300             PERFORM 2300-PROCESS-STORE-OVRRDE-CSR                07450033
037400           WHEN SQLCODE = +100                                    07460033
037500             SET PS-FUTRE-DAY-RMS-CSR-EOF TO TRUE                 07470033
037600           WHEN SQLWARN0 NOT EQUAL SPACE                          07480033
037700           WHEN SQLCODE NOT EQUAL ZERO                            07490033
037800             MOVE '2120-FETCH-FUTURE-DAY-RMS'                     07500033
037900                                     TO PV-PARAGRAPH-NAME         07510033
038000             MOVE 'ERROR ON FETCHING FUTURE-RMS CURSOR'           07520033
038100                                     TO PV-DB2-OPERATION          07530033
052701             PERFORM 4100-WRITE-RESTART-RECORD                    07540033
038200             PERFORM 9900-SQL-ABEND-ROUTINE                       07550033
038300         END-EVALUATE                                             07560033
038400     END-PERFORM.                                                 07570033
038500                                                                  07580033
038600     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         07590033
038700       MOVE '2120-FETCH-FUTURE-DAY-RMS'                           07600033
038800                               TO  PV-PARAGRAPH-NAME              07610033
038900       MOVE 'FETCH RETRIES EXCEEDED'                              07620033
039000                               TO  PV-DB2-OPERATION               07630033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          07640033
039100       PERFORM 9900-SQL-ABEND-ROUTINE                             07650033
039200     END-IF.                                                      07660033
039300                                                                  07670033
039400*2120-EXIT.                                                       07680033
039500 EJECT.                                                           07690033
039600                                                                  07700033
039700*-----------------------------------------------------------      07710033
039800* 2130-CLOSE-FUTURE-DAY-RMS.                                      07720033
039900*-----------------------------------------------------------      07730033
040000 2130-CLOSE-FUTURE-DAY-RMS.                                       07740033
040100                                                                  07750033
040400     PERFORM                                                      07760033
040500         WITH TEST AFTER                                          07770033
040600         VARYING PV-SQL-SUB                                       07780033
040700         FROM 1 BY 1                                              07790033
040800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 07800033
040900                   OR  SQLCODE = 0)                               07810033
041000                                                                  07820033
041100         EXEC SQL                                                 07830033
041200           CLOSE FUTURE-RMS                                       07840033
041300         END-EXEC                                                 07850033
041400                                                                  07860033
041500         EVALUATE TRUE                                            07870033
041600           WHEN SQLCODE = -904                                    07880033
041700           WHEN SQLCODE = -911                                    07890033
041800           WHEN SQLCODE = -913                                    07900033
041900           WHEN SQLCODE = 0                                       07910033
042000             CONTINUE                                             07920033
042100           WHEN SQLWARN0 NOT EQUAL SPACE                          07930033
042200           WHEN SQLCODE NOT EQUAL ZERO                            07940033
042300             MOVE '2130-CLOSE-FUTURE-DAY-RMS'                     07950033
042400                                     TO PV-PARAGRAPH-NAME         07960033
042500             MOVE 'ERROR ON CLOSE OF FUTURE-RMS'                  07970033
042600                                     TO PV-DB2-OPERATION          07980033
052701             PERFORM 4100-WRITE-RESTART-RECORD                    07990033
042700             PERFORM 9900-SQL-ABEND-ROUTINE                       08000033
042800         END-EVALUATE                                             08010033
042900     END-PERFORM.                                                 08020033
043000                                                                  08030033
043100     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08040033
043200       MOVE '2130-CLOSE-FUTURE-DAY-RMS'                           08050033
043300                               TO  PV-PARAGRAPH-NAME              08060033
043400       MOVE 'CLOSE RETRIES EXCEEDED'                              08070033
043500                               TO  PV-DB2-OPERATION               08080033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          08090033
043600       PERFORM 9900-SQL-ABEND-ROUTINE                             08100033
043700     END-IF.                                                      08110033
043800                                                                  08120033
043900*2130-EXIT.                                                       08130033
044000 EJECT.                                                           08140033
044100                                                                  08150033
044200*----------------------------------------------------------       08160033
044300* 2200-PROCESS-ADHC-CURSOR.                                       08170033
044500*     READS THE FOLLOWING TABLES: XST_MDSE_LNE_SELN               08180033
044600*                                 XST_PROMO_ADHC_RLT              08190033
045500*     TO DETERMINE IF THE STORE NEEDS TO RECIEVE A FUTURE DAY(S)  08200033
045600*     FILE. IF SO, A RECORD IS CREATED TO BE SENT TO THE STORE.   08210033
045700*----------------------------------------------------------       08220033
045800 2200-PROCESS-ADHC-CURSOR.                                        08230033
045900                                                                  08240033
046000     PERFORM 2210-OPEN-FUTURE-DAY-ADHOC.                          08250033
046100     PERFORM 2220-FETCH-FUTURE-DAY-ADHOC                          08260033
046200       UNTIL PS-FUTRE-DAY-ADHOC-CSR-EOF                           08270033
046300     PERFORM 2230-CLOSE-FUTURE-DAY-ADHOC.                         08280033
046400                                                                  08290033
046500*2200-EXIT.                                                       08300033
046600 EJECT.                                                           08310033
046700                                                                  08320033
046800*----------------------------------------------------------       08330033
046900* 2210-OPEN-FUTURE-DAY-ADHOC.                                     08340033
047000*     OPEN THE BWP BUY PROMO AND PMAP CURSOR.                     08350033
047100*----------------------------------------------------------       08360033
047200 2210-OPEN-FUTURE-DAY-ADHOC.                                      08370033
047300                                                                  08380033
047400     PERFORM                                                      08390033
047500         WITH TEST AFTER                                          08400033
047600         VARYING PV-SQL-SUB                                       08410033
047700         FROM 1 BY 1                                              08420033
047800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08430033
047900                   OR  SQLCODE = 0)                               08440033
048000                                                                  08450033
048100         EXEC SQL                                                 08460033
048200           OPEN FUTURE-ADHOC                                      08470033
048300         END-EXEC                                                 08480033
048400                                                                  08490033
048500                                                                  08500033
048600         EVALUATE TRUE                                            08510033
048700           WHEN SQLCODE = -904                                    08520033
048800           WHEN SQLCODE = -911                                    08530033
048900           WHEN SQLCODE = -913                                    08540033
049000             CONTINUE                                             08550033
049100           WHEN SQLCODE = 0                                       08560033
049200             SET PC-ADHOC-STR-GRP TO TRUE                         08570033
049300             SET PS-FUTRE-DAY-ADHOC-CSR-NOT-EOF  TO TRUE          08580033
049400           WHEN SQLWARN0 NOT EQUAL SPACE                          08590033
049500           WHEN SQLCODE NOT EQUAL ZERO                            08600033
049600           MOVE '2210-OPEN-FUTURE-DAY-ADHOC'                      08610033
049700                                     TO PV-PARAGRAPH-NAME         08620033
049800           MOVE 'ERROR ON OPEN OF FUTURE-ADHOC CURSOR'            08630033
049900                                     TO PV-DB2-OPERATION          08640033
052701           PERFORM 4100-WRITE-RESTART-RECORD                      08650033
050000           PERFORM 9900-SQL-ABEND-ROUTINE                         08660033
050100         END-EVALUATE                                             08670033
050200     END-PERFORM.                                                 08680033
050300                                                                  08690033
050400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         08700033
050500       MOVE '2210-OPEN-FUTURE-DAY-ADHOC'                          08710033
050600                             TO  PV-PARAGRAPH-NAME                08720033
050700       MOVE 'OPEN RETRIES EXCEEDED'                               08730033
050800                              TO  PV-DB2-OPERATION                08740033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          08750033
050900       PERFORM 9900-SQL-ABEND-ROUTINE                             08760033
051000     END-IF.                                                      08770033
051100                                                                  08780033
051200*2210-EXIT.                                                       08790033
051300 EJECT.                                                           08800033
051400                                                                  08810033
051500*----------------------------------------------------------       08820033
051600* 2220-FETCH-FUTURE-DAY-ADHOC.                                    08830033
051700*     FETCH THE BWP BUY PROMO AND PMAP CURSOR.                    08840033
051800*----------------------------------------------------------       08850033
051810 2220-FETCH-FUTURE-DAY-ADHOC.                                     08860033
051820                                                                  08870033
051830     PERFORM                                                      08880033
051831         WITH TEST AFTER                                          08890033
051832         VARYING PV-SQL-SUB                                       08900033
051833         FROM 1 BY 1                                              08910033
051834         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 08920033
051835                   OR  SQLCODE = 0                                08930033
051836                   OR  SQLCODE = +100)                            08940033
051837                                                                  08950033
051838         EXEC SQL                                                 08960033
051839           FETCH FUTURE-ADHOC                                     08970033
051841           INTO  :XST00031-PROMO-INTFC-ID                         08980033
051842                ,:XST00031-MDSE-LNE-ID                            08990033
051843                ,:XST00031-ADHC-STR-GP-ID                         09000033
051844                ,:XST00031-STR-SELN-HIER-CDE                      09010033
051845                ,:XST00031-ACTL-STRT-TMST                         09020033
051846                ,:XST00031-ACTL-END-TMST                          09030033
051847                ,:XST00031-SOR-LAST-UPD-TMST                      09040033
036300                ,:XST00028-PRICG-TYP-CDE                          09050033
051861         END-EXEC                                                 09060033
051862                                                                  09070033
051863         EVALUATE TRUE                                            09080033
051864           WHEN SQLCODE = -904                                    09090033
051865           WHEN SQLCODE = -911                                    09100033
051866           WHEN SQLCODE = -913                                    09110033
051867             CONTINUE                                             09120033
051868           WHEN SQLCODE = ZERO                                    09130033
                   MOVE XST00031-PROMO-INTFC-ID TO PV-PROMO-INTFC-ID    09140033
                   MOVE XST00031-MDSE-LNE-ID    TO PV-MDSE-LNE-ID       09150033
                   MOVE XST00031-STR-SELN-HIER-CDE                      09160033
                                                TO PV-STR-SELN-HIER-CDE 09170033
051869             PERFORM 3000-FORMAT-RESTART-RECORD                   09180033
051870             PERFORM 3200-FORMAT-ADHOC-OUTPUT                     09190033
051870             PERFORM 2300-PROCESS-STORE-OVRRDE-CSR                09200033
051871           WHEN SQLCODE = +100                                    09210033
051872             SET PS-FUTRE-DAY-ADHOC-CSR-EOF TO TRUE               09220033
051873           WHEN SQLWARN0 NOT EQUAL SPACE                          09230033
051874           WHEN SQLCODE NOT EQUAL ZERO                            09240033
051875           MOVE '2220-FETCH-FUTURE-DAY-ADHOC'                     09250033
051876                                     TO PV-PARAGRAPH-NAME         09260033
051877           MOVE 'ERROR ON FETCHING FUTURE-ADHOC CURSOR'           09270033
051878                                     TO PV-DB2-OPERATION          09280033
051879           DISPLAY 'SQLCODE= ' SQLCODE                            09290033
052701           PERFORM 4100-WRITE-RESTART-RECORD                      09300033
051880           PERFORM 9900-SQL-ABEND-ROUTINE                         09310033
051881         END-EVALUATE                                             09320033
051882     END-PERFORM.                                                 09330033
051883                                                                  09340033
051884     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09350033
051885       MOVE '2220-FETCH-FUTURE-DAY-ADHOC'                         09360033
051886                               TO  PV-PARAGRAPH-NAME              09370033
051887       MOVE 'FETCH RETRIES EXCEEDED'                              09380033
051888                               TO  PV-DB2-OPERATION               09390033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          09400033
051889       PERFORM 9900-SQL-ABEND-ROUTINE                             09410033
051890     END-IF.                                                      09420033
051891                                                                  09430033
051892*2220-EXIT.                                                       09440033
051893 EJECT.                                                           09450033
051894                                                                  09460033
051895*-----------------------------------------------------------      09470033
051896* 2230-CLOSE-FUTURE-DAY-ADHOC.                                    09480033
051897*     CLOSE THE BWP BUY PROMO AND PMAP CURSOR.                    09490033
051898*-----------------------------------------------------------      09500033
051899 2230-CLOSE-FUTURE-DAY-ADHOC.                                     09510033
051900                                                                  09520033
051901     PERFORM                                                      09530033
051902         WITH TEST AFTER                                          09540033
051903         VARYING PV-SQL-SUB                                       09550033
051904         FROM 1 BY 1                                              09560033
051905         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 09570033
051906                   OR  SQLCODE = 0)                               09580033
051907                                                                  09590033
051908         EXEC SQL                                                 09600033
051909           CLOSE FUTURE-ADHOC                                     09610033
051910         END-EXEC                                                 09620033
051911                                                                  09630033
051912         EVALUATE TRUE                                            09640033
051913           WHEN SQLCODE = -904                                    09650033
051914           WHEN SQLCODE = -911                                    09660033
051915           WHEN SQLCODE = -913                                    09670033
051916           WHEN SQLCODE = 0                                       09680033
051917             CONTINUE                                             09690033
051918           WHEN SQLWARN0 NOT EQUAL SPACE                          09700033
051919           WHEN SQLCODE NOT EQUAL ZERO                            09710033
051920             MOVE '2230-CLOSE-FUTURE-DAY-ADHOC'                   09720033
051921                                     TO PV-PARAGRAPH-NAME         09730033
051922             MOVE 'ERROR ON CLOSE OF FUTURE-ADHOC CURSOR'         09740033
051923                                     TO PV-DB2-OPERATION          09750033
052701             PERFORM 4100-WRITE-RESTART-RECORD                    09760033
051924             PERFORM 9900-SQL-ABEND-ROUTINE                       09770033
051925         END-EVALUATE                                             09780033
051926     END-PERFORM.                                                 09790033
051927                                                                  09800033
051928     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         09810033
051929       MOVE '2230-CLOSE-FUTURE-DAY-ADHOC'                         09820033
051930                               TO  PV-PARAGRAPH-NAME              09830033
051931       MOVE 'CLOSE RETRIES EXCEEDED'                              09840033
051932                               TO  PV-DB2-OPERATION               09850033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          09860033
051933       PERFORM 9900-SQL-ABEND-ROUTINE                             09870033
051934     END-IF.                                                      09880033
051935                                                                  09890033
051936*2230-EXIT.                                                       09900033
051937 EJECT.                                                           09910033
051938                                                                  09920033
044200*----------------------------------------------------------       09930033
044300* 2300-PROCESS-STORE-OVRRDE-CSR.                                  09940033
044600*     READS THE FOLLOWING TABLE:  XST_PROMO_STR_GP                09950033
045500*     TO DETERMINE IF THE STORE RETRIEVED FROM THE RMS AND        09960033
045600*     ADHOC CURSORS HAS ANY STORE GROUPS OVERRIDES.               09970033
045700*----------------------------------------------------------       09980033
045800 2300-PROCESS-STORE-OVRRDE-CSR.                                   09990033
045900                                                                  10000033
046000     PERFORM 2310-OPEN-STORE-OVRRDE.                              10010033
046100     PERFORM 2320-FETCH-STORE-OVRRDE                              10020033
046200       UNTIL PS-STORE-OVRRDE-CSR-EOF                              10030033
046300     PERFORM 2330-CLOSE-STORE-OVRRDE.                             10040033
046400                                                                  10050033
046500*2300-EXIT.                                                       10060033
046600 EJECT.                                                           10070033
046700                                                                  10080033
046800*----------------------------------------------------------       10090033
046900* 2310-OPEN-STORE-OVRRDE.                                         10100033
047000*     OPEN THE BWP BUY PROMO AND PMAP CURSOR.                     10110033
047100*----------------------------------------------------------       10120033
047200 2310-OPEN-STORE-OVRRDE.                                          10130033
047300                                                                  10140033
047400     PERFORM                                                      10150033
047500         WITH TEST AFTER                                          10160033
047600         VARYING PV-SQL-SUB                                       10170033
047700         FROM 1 BY 1                                              10180033
047800         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10190033
047900                   OR  SQLCODE = 0)                               10200033
048000                                                                  10210033
048100         EXEC SQL                                                 10220033
048200           OPEN STORE-OVRRDE                                      10230033
048300         END-EXEC                                                 10240033
048500                                                                  10250033
048600         EVALUATE TRUE                                            10260033
048700           WHEN SQLCODE = -904                                    10270033
048800           WHEN SQLCODE = -911                                    10280033
048900           WHEN SQLCODE = -913                                    10290033
049000             CONTINUE                                             10300033
049100           WHEN SQLCODE = 0                                       10310033
049300             SET PS-STORE-OVRRDE-CSR-NOT-EOF  TO TRUE             10320033
049400           WHEN SQLWARN0 NOT EQUAL SPACE                          10330033
049500           WHEN SQLCODE NOT EQUAL ZERO                            10340033
049600           MOVE '2310-OPEN-STORE-OVRRDE'                          10350033
049700                                     TO PV-PARAGRAPH-NAME         10360033
049800           MOVE 'ERROR ON OPEN OF STORE-OVRRDE CURSOR'            10370033
049900                                     TO PV-DB2-OPERATION          10380033
052701           PERFORM 4100-WRITE-RESTART-RECORD                      10390033
050000           PERFORM 9900-SQL-ABEND-ROUTINE                         10400033
050100         END-EVALUATE                                             10410033
050200     END-PERFORM.                                                 10420033
050300                                                                  10430033
050400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         10440033
050500       MOVE '2310-OPEN-STORE-OVRRDE'                              10450033
050600                             TO  PV-PARAGRAPH-NAME                10460033
050700       MOVE 'OPEN RETRIES EXCEEDED'                               10470033
050800                              TO  PV-DB2-OPERATION                10480033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          10490033
050900       PERFORM 9900-SQL-ABEND-ROUTINE                             10500033
051000     END-IF.                                                      10510033
051100                                                                  10520033
051200*2310-EXIT.                                                       10530033
051300 EJECT.                                                           10540033
051400                                                                  10550033
051500*----------------------------------------------------------       10560033
051600* 2320-FETCH-STORE-OVRRDE.                                        10570033
051700*     FETCH THE BWP BUY PROMO AND PMAP CURSOR.                    10580033
051800*----------------------------------------------------------       10590033
051810 2320-FETCH-STORE-OVRRDE.                                         10600033
051820                                                                  10610033
051830     PERFORM                                                      10620033
051831         WITH TEST AFTER                                          10630033
051832         VARYING PV-SQL-SUB                                       10640033
051833         FROM 1 BY 1                                              10650033
051834         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 10660033
051835                   OR  SQLCODE = 0                                10670033
051836                   OR  SQLCODE = +100)                            10680033
051837                                                                  10690033
051838         EXEC SQL                                                 10700033
051839           FETCH STORE-OVRRDE                                     10710033
019900           INTO  :OVRRDE-PROMO-INTFC-ID                           10720033
020000                ,:OVRRDE-MDSE-LNE-ID                              10730033
020100                ,:OVRRDE-STR-GP-TYP-CDE                           10740033
020200                ,:OVRRDE-STR-GP-ID                                10750033
020300                ,:OVRRDE-STR-SELN-HIER-CDE                        10760033
020400                ,:OVRRDE-STAT-CDE                                 10770033
                      ,:OVRRDE-ACTL-STRT-TMST                           10780033
                      ,:OVRRDE-ACTL-END-TMST                            10790033
020500                ,:OVRRDE-LAST-UPD-TMST                            10800033
020500                ,:OVRRDE-SOR-LAST-UPD-TMST                        10810033
051861         END-EXEC                                                 10820033
051862                                                                  10830033
051863         EVALUATE TRUE                                            10840033
051864           WHEN SQLCODE = -904                                    10850033
051865           WHEN SQLCODE = -911                                    10860033
051866           WHEN SQLCODE = -913                                    10870033
051867             CONTINUE                                             10880033
051868           WHEN SQLCODE = ZERO                                    10890033
051869             PERFORM 3000-FORMAT-RESTART-RECORD                   10900033
051870             PERFORM 3300-FORMAT-STORE-OVERRIDE                   10910033
051871           WHEN SQLCODE = +100                                    10920033
051872             SET PS-STORE-OVRRDE-CSR-EOF TO TRUE                  10930033
051873           WHEN SQLWARN0 NOT EQUAL SPACE                          10940033
051874           WHEN SQLCODE NOT EQUAL ZERO                            10950033
051875           MOVE '2320-FETCH-STORE-OVRRDE'                         10960033
051876                                     TO PV-PARAGRAPH-NAME         10970033
051877           MOVE 'ERROR ON FETCHING STORE-OVRRDE CURSOR'           10980033
051878                                     TO PV-DB2-OPERATION          10990033
051879           DISPLAY 'SQLCODE= ' SQLCODE                            11000033
052701           PERFORM 4100-WRITE-RESTART-RECORD                      11010033
051880           PERFORM 9900-SQL-ABEND-ROUTINE                         11020033
051881         END-EVALUATE                                             11030033
051882     END-PERFORM.                                                 11040033
051883                                                                  11050033
051884     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11060033
051885       MOVE '2320-FETCH-STORE-OVRRDE'                             11070033
051886                               TO  PV-PARAGRAPH-NAME              11080033
051887       MOVE 'FETCH RETRIES EXCEEDED'                              11090033
051888                               TO  PV-DB2-OPERATION               11100033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          11110033
051889       PERFORM 9900-SQL-ABEND-ROUTINE                             11120033
051890     END-IF.                                                      11130033
051891                                                                  11140033
051892*2320-EXIT.                                                       11150033
051893 EJECT.                                                           11160033
051894                                                                  11170033
051895*-----------------------------------------------------------      11180033
051896* 2330-CLOSE-STORE-OVRRDE.                                        11190033
051897*     CLOSE THE BWP BUY PROMO AND PMAP CURSOR.                    11200033
051898*-----------------------------------------------------------      11210033
051899 2330-CLOSE-STORE-OVRRDE.                                         11220033
051900                                                                  11230033
051901     PERFORM                                                      11240033
051902         WITH TEST AFTER                                          11250033
051903         VARYING PV-SQL-SUB                                       11260033
051904         FROM 1 BY 1                                              11270033
051905         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 11280033
051906                   OR  SQLCODE = 0)                               11290033
051907                                                                  11300033
051908         EXEC SQL                                                 11310033
051909           CLOSE STORE-OVRRDE                                     11320033
051910         END-EXEC                                                 11330033
051911                                                                  11340033
051912         EVALUATE TRUE                                            11350033
051913           WHEN SQLCODE = -904                                    11360033
051914           WHEN SQLCODE = -911                                    11370033
051915           WHEN SQLCODE = -913                                    11380033
051916           WHEN SQLCODE = 0                                       11390033
051917             CONTINUE                                             11400033
051918           WHEN SQLWARN0 NOT EQUAL SPACE                          11410033
051919           WHEN SQLCODE NOT EQUAL ZERO                            11420033
051920             MOVE '2230-CLOSE-STORE-OVRRDE'                       11430033
051921                                     TO PV-PARAGRAPH-NAME         11440033
051922             MOVE 'ERROR ON CLOSE OF STORE-OVRRDE CURSOR'         11450033
051923                                     TO PV-DB2-OPERATION          11460033
052701             PERFORM 4100-WRITE-RESTART-RECORD                    11470033
051924             PERFORM 9900-SQL-ABEND-ROUTINE                       11480033
051925         END-EVALUATE                                             11490033
051926     END-PERFORM.                                                 11500033
051927                                                                  11510033
051928     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         11520033
051929       MOVE '2330-CLOSE-STORE-OVRRDE'                             11530033
051930                               TO  PV-PARAGRAPH-NAME              11540033
051931       MOVE 'CLOSE RETRIES EXCEEDED'                              11550033
051932                               TO  PV-DB2-OPERATION               11560033
052701       PERFORM 4100-WRITE-RESTART-RECORD                          11570033
051933       PERFORM 9900-SQL-ABEND-ROUTINE                             11580033
051934     END-IF.                                                      11590033
051935                                                                  11600033
051936*2330-EXIT.                                                       11610033
051937 EJECT.                                                           11620033
                                                                        11630033
052672*-----------------------------------------------------------      11640033
052673* 3000-FORMAT-RESTART-RECORD.                                     11650033
052674*     FORMAT THE RESTART RECORD.                                  11660033
052675*-----------------------------------------------------------      11670033
052676 3000-FORMAT-RESTART-RECORD.                                      11680033
052677                                                                  11690033
052678     IF PV-PROMO-INTFC-ID NOT EQUAL TO PV-HOLD-INTERFACE-ID       11700033
052679       MOVE PC-RERUN-IND            TO EP108-JOB-RUN-TYP-IND      11710033
052680       MOVE PV-PROMO-INTFC-ID       TO EP108-INTERFACE-ID         11720033
052680                                       PC-INTFC-ID                11730033
052682         IF PC-RMS-STR-GRP                                        11740033
052683           SET EP108-RMS-STR-GRP    TO TRUE                       11750033
052685         ELSE                                                     11760033
052686          IF PC-ADHOC-STR-GRP                                     11770033
052687            SET EP108-ADHOC-STR-GRP TO TRUE                       11780033
052689          END-IF                                                  11790033
052690         END-IF                                                   11800033
052678       MOVE PV-PROMO-INTFC-ID TO PV-HOLD-INTERFACE-ID             11810033
052703     END-IF.                                                      11820033
052704                                                                  11830033
052705*3000-EXIT.                                                       11840033
052706 EJECT.                                                           11850033
052707                                                                  11860033
051939*-----------------------------------------------------------      11870033
051940* 3100-FORMAT-RMS-OUTPUT.                                         11880033
051941*     POPULATE COPYBOOK EPRD072.                                  11890033
051942*-----------------------------------------------------------      11900033
051943 3100-FORMAT-RMS-OUTPUT.                                          11910033
051944                                                                  11920033
051945     INITIALIZE EP072-PROMO-INTFC-RECORD.                         11930033
051946     MOVE PC-PRICING-BUS-EVENT   TO EP072-BUSINESS-EVENT-ID.      11940033
051947     MOVE PC-RMS-PRC-SETUP-IND   TO EP072-PRC-SETUP-IND.          11950033
051948     MOVE XST00029-STR-GP-TYP-CDE                                 11960033
051949                                 TO EP072-SETUP-STR-GRP-TYP-CDE.  11970033
051950     MOVE XST00029-STR-GP-ID                                      11980033
051951                                 TO EP072-SETUP-STR-GRP-ID.       11990033
051952     MOVE XST00029-STR-GP-TYP-CDE                                 12000033
051949                                 TO EP072-DIST-STR-GRP-TYP-CDE.   12010033
051953     MOVE XST00029-STR-GP-ID     TO EP072-DIST-STR-GRP-ID.        12020033
051954     MOVE XST00029-STR-SELN-HIER-CDE                              12030033
051955                                 TO EP072-STR-SELN-HIER-CDE.      12040033
051956     MOVE PC-FILE-ACT-TYPE       TO EP072-FILE-ACT-TYP.           12050033
051957     MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND.              12060033
051958     MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION.          12070033
051959     MOVE XST00029-PROMO-INTFC-ID                                 12080033
051960                                 TO EP072-PROMO-INTFC-ID.         12090033
051970     MOVE XST00029-MDSE-LNE-ID                                    12100033
051980                                 TO EP072-MERCH-LNE-ID.           12110033
051990     MOVE XST00028-PRICG-TYP-CDE                                  12120033
052000                                 TO EP072-PRICG-TYP-CDE.          12130033
052010     MOVE PC-MDSE-INCL-ALL-IND   TO EP072-MDSE-INC-EXC-IND.       12140033
052011     MOVE XST00029-ACTL-STRT-TMST                                 12150033
052012                                 TO EP072-STR-GRP-PROMO-STRT-TMST.12160033
052013     MOVE XST00029-ACTL-END-TMST                                  12170033
052014                                 TO EP072-STR-GRP-PROMO-END-TMST. 12180033
052015     MOVE XST00029-SOR-LAST-UPD-TMST                              12190033
052016                                 TO EP072-SOR-LAST-UPD-TMST.      12200033
052017                                                                  12210033
052018     PERFORM 4000-WRITE-FULL-FILE-RECORD.                         12220033
052019                                                                  12230033
052020*3100-EXIT.                                                       12240033
052030 EJECT.                                                           12250033
052040                                                                  12260033
052050*-----------------------------------------------------------      12270033
052060* 3200-FORMAT-ADHOC-OUTPUT.                                       12280033
052070*     POPULATE COPYBOOK EPRD072.                                  12290033
052080*-----------------------------------------------------------      12300033
052090 3200-FORMAT-ADHOC-OUTPUT.                                        12310033
052100                                                                  12320033
052200     INITIALIZE EP072-PROMO-INTFC-RECORD.                         12330033
052300     MOVE PC-PRICING-BUS-EVENT   TO EP072-BUSINESS-EVENT-ID.      12340033
052400     MOVE PC-ADHOC-PRC-SETUP-IND TO EP072-PRC-SETUP-IND.          12350033
052500     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                12360033
052600                                 TO EP072-SETUP-STR-GRP-TYP-CDE.  12370033
052610     MOVE XST00031-ADHC-STR-GP-ID                                 12380033
052620                                 TO EP072-SETUP-STR-GRP-ID.       12390033
052500     MOVE PC-ADHOC-STR-GRP-TYP-CDE                                12400033
052640                                 TO EP072-DIST-STR-GRP-TYP-CDE.   12410033
052610     MOVE XST00031-ADHC-STR-GP-ID                                 12420033
052630                                 TO EP072-DIST-STR-GRP-ID.        12430033
052650     MOVE XST00031-STR-SELN-HIER-CDE                              12440033
052651                                 TO EP072-STR-SELN-HIER-CDE.      12450033
052652     MOVE PC-FILE-ACT-TYPE       TO EP072-FILE-ACT-TYP.           12460033
052653     MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND.              12470033
052654     MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION.          12480033
052655     MOVE XST00031-PROMO-INTFC-ID                                 12490033
052656                                 TO EP072-PROMO-INTFC-ID.         12500033
052657     MOVE XST00031-MDSE-LNE-ID                                    12510033
052658                                 TO EP072-MERCH-LNE-ID.           12520033
052659     MOVE XST00028-PRICG-TYP-CDE                                  12530033
052660                                 TO EP072-PRICG-TYP-CDE.          12540033
052661     MOVE PC-MDSE-INCL-ALL-IND   TO EP072-MDSE-INC-EXC-IND.       12550033
052662     MOVE XST00031-ACTL-STRT-TMST                                 12560033
052663                           TO EP072-STR-GRP-PROMO-STRT-TMST.      12570033
052664     MOVE XST00031-ACTL-END-TMST                                  12580033
052665                           TO EP072-STR-GRP-PROMO-END-TMST.       12590033
052666     MOVE XST00031-SOR-LAST-UPD-TMST                              12600033
052667                           TO EP072-SOR-LAST-UPD-TMST.            12610033
052668                                                                  12620033
052669     PERFORM 4000-WRITE-FULL-FILE-RECORD.                         12630033
052670                                                                  12640033
052671*3200-EXIT.                                                       12650033
                                                                        12660033
051939*-----------------------------------------------------------      12670033
051940* 3300-FORMAT-STORE-OVERRIDE.                                     12680033
051941*     POPULATE COPYBOOK EPRD072.                                  12690033
051942*-----------------------------------------------------------      12700033
051943 3300-FORMAT-STORE-OVERRIDE.                                      12710033
051944                                                                  12720033
051945     INITIALIZE EP072-PROMO-INTFC-RECORD.                         12730033
051946     MOVE PC-PRICING-BUS-EVENT   TO EP072-BUSINESS-EVENT-ID.      12740033
051947     MOVE PC-RMS-PRC-SETUP-IND   TO EP072-PRC-SETUP-IND.          12750033
051949     MOVE OVRRDE-STR-GP-TYP-CDE  TO EP072-SETUP-STR-GRP-TYP-CDE.  12760033
051951     MOVE OVRRDE-STR-GP-ID       TO EP072-SETUP-STR-GRP-ID.       12770033
051952     MOVE OVRRDE-STR-GP-TYP-CDE  TO EP072-DIST-STR-GRP-TYP-CDE.   12780033
051953     MOVE OVRRDE-STR-GP-ID       TO EP072-DIST-STR-GRP-ID.        12790033
051954     MOVE OVRRDE-STR-SELN-HIER-CDE                                12800033
051955                                 TO EP072-STR-SELN-HIER-CDE.      12810033
051956     MOVE PC-FILE-ACT-TYPE       TO EP072-FILE-ACT-TYP.           12820033
051957     MOVE PC-APPLY-NIGHTLY       TO EP072-APPLY-IND.              12830033
051958     MOVE PC-ADD-STAT-CDE        TO EP072-RECORD-ACTION.          12840033
051959     MOVE XST00029-PROMO-INTFC-ID                                 12850033
051960                                 TO EP072-PROMO-INTFC-ID.         12860033
051970     MOVE XST00029-MDSE-LNE-ID                                    12870033
051980                                 TO EP072-MERCH-LNE-ID.           12880033
051990     MOVE XST00028-PRICG-TYP-CDE                                  12890033
052000                                 TO EP072-PRICG-TYP-CDE.          12900033
052010     MOVE PC-MDSE-INCL-IND       TO EP072-MDSE-INC-EXC-IND.       12910033
052011     MOVE OVRRDE-ACTL-STRT-TMST                                   12920033
052012                           TO EP072-STR-GRP-PROMO-STRT-TMST.      12930033
052013     MOVE OVRRDE-ACTL-END-TMST                                    12940033
052014                           TO EP072-STR-GRP-PROMO-END-TMST.       12950033
052015     MOVE OVRRDE-SOR-LAST-UPD-TMST                                12960033
052016                                 TO EP072-SOR-LAST-UPD-TMST.      12970033
052017                                                                  12980033
052018     PERFORM 4000-WRITE-FULL-FILE-RECORD.                         12990033
052019                                                                  13000033
052020*3300-EXIT.                                                       13010033
052030 EJECT.                                                           13020033
052040                                                                  13030033
052751*----------------------------------------------------------       13040033
052752* 4000-WRITE-FULL-FILE-RECORD                                     13050033
052753*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          13060033
052754*----------------------------------------------------------       13070033
052755 4000-WRITE-FULL-FILE-RECORD.                                     13080033
052756                                                                  13090033
052757     WRITE PROMO-INTFC-RECORD FROM EP072-PROMO-INTFC-RECORD.      13100033
052758                                                                  13110033
052759     ADD 1           TO PC-CNT-PROMO-RECS.                        13120033
052760                                                                  13130033
052761*4000-EXIT.                                                       13140033
052762 EJECT.                                                           13150033
052763                                                                  13160033
052764*----------------------------------------------------------       13170033
052765* 4100-WRITE-RESTART-RECORD                                       13180033
052766*     WRITES THE PROMO FULL FILE RECORD TO THE FULL FILE          13190033
052767*----------------------------------------------------------       13200033
052768 4100-WRITE-RESTART-RECORD.                                       13210033
052769                                                                  13220033
052770     WRITE CONTROL-CARD-FOR-RESTART-REC                           13230033
052771                              FROM EP108-PROMO-RESTART-REC.       13240033
052772                                                                  13250033
052775*4100-EXIT.                                                       13260033
052776 EJECT.                                                           13270033
052777                                                                  13280033
052778****************************************************              13290033
052779* DATE ROUTINE TO SET UP THE PROCESS DATE IN       *              13300033
052780* CCYYMMDD FORMAT.                                 *              13310033
052790****************************************************              13320033
052791 6100-DATE-ROUTINE.                                               13330033
052792                                                                  13340033
052793     INITIALIZE DPG51 DPG52 DPG53                                 13350033
052794                DPG54 DPG55 DPG56.                                13360033
052795                                                                  13370033
052796     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      13380033
052797     SET DPG51-INCREMENT-DATE       TO TRUE.                      13390033
052798     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      13400033
052799     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    13410033
052800     MOVE EP101-CC-LAST-DTE         TO DPG52-DB2-ISO-DATE-FMT.    13420033
052801                                                                  13430033
052802     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13440033
052803                                             DPG54 DPG55 DPG56.   13450033
052804                                                                  13460033
052805     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  13470033
052806       DISPLAY '** ABEND **'                                      13480033
052807       DISPLAY '** PROGRAM = EPKUT116'                            13490033
052808       DISPLAY 'DATE = ' EP101-CC-LAST-DTE                        13500033
052809       DISPLAY DPG54-ERROR-MESSAGE                                13510033
052810       MOVE 4019 TO PV-ABEND-CODE                                 13520033
052811       CALL 'ILBOABN0' USING PV-ABEND-CODE                        13530033
052812     END-IF.                                                      13540033
052813                                                                  13550033
052814     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP101-CC-DATE-PLUS1.      13560033
052841                                                                  13570033
052842     INITIALIZE DPG51 DPG52 DPG53                                 13580033
052843                DPG54 DPG55 DPG56.                                13590033
052844                                                                  13600033
052845     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      13610033
052846     SET DPG51-DECREMENT-DATE       TO TRUE.                      13620033
052847     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      13630033
052848     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9.    13640033
052849     MOVE EP107-CC-CRNT-DTE         TO DPG52-DB2-ISO-DATE-FMT.    13650033
052850                                                                  13660033
052851     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13670033
052852                                             DPG54 DPG55 DPG56.   13680033
052853                                                                  13690033
052854     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  13700033
052855       DISPLAY '** ABEND **'                                      13710033
052856       DISPLAY '** PROGRAM = EPKUT116'                            13720033
052857       DISPLAY 'DATE = ' EP107-CC-CRNT-DTE                        13730033
052858       DISPLAY DPG54-ERROR-MESSAGE                                13740033
052859       MOVE 4019 TO PV-ABEND-CODE                                 13750033
052860       CALL 'ILBOABN0' USING PV-ABEND-CODE                        13760033
052861     END-IF.                                                      13770033
052862                                                                  13780033
052863     MOVE DPG55-DB2-ISO-DATE-FMT     TO EP107-CC-CRNT-DTE-MINUS1. 13790033
052864                                                                  13800033
052865*6100-EXIT.                                                       13810033
052866 EJECT.                                                           13820033
052867                                                                  13830033
052868*----------------------------------------------------------       13840033
052869* 9800-ABEND.                                                     13850033
052870*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  13860033
052880*----------------------------------------------------------       13870033
052890 9800-ABEND.                                                      13880033
052900                                                                  13890033
053000     DISPLAY '** ABEND           **'.                             13900033
053100     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  13910033
053200     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        13920033
053300     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       13930033
053400     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       13940033
053500     CALL 'ILBOABN0' USING ABEND-CODE.                            13950033
053600                                                                  13960033
053700*9800-EXIT.                                                       13970033
053800 EJECT.                                                           13980033
053900                                                                  13990033
054000*----------------------------------------------------------       14000033
054100* 9900-SQL-ABEND-ROUTINE.                                         14010033
054200*     SQL ABEND ROUTINE.                                          14020033
054300*----------------------------------------------------------       14030033
054400 9900-SQL-ABEND-ROUTINE.                                          14040033
054500                                                                  14050033
054600     DISPLAY '** ABEND     **'.                                   14060033
054700     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        14070033
054800     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              14080033
054900     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               14090033
055000                                                                  14100033
055100     COPY DPPD004.                                                14110033
055200     SET ABEND-4013-DB2-ERROR TO TRUE.                            14120033
055300     CALL 'ILBOABN0' USING ABEND-CODE.                            14130033
055400                                                                  14140033
055500*9900-EXIT.                                                       14150033
055600 EJECT.                                                           14160033
055700                                                                  14170033
055800*----------------------------------------------------------       14180033
055900* 9999-WRAPUP.                                                    14190033
056000*     END OF PROGRAM ROUTINE. CLOSES ALL FILES AND DISPLAYS       14200033
056100*     ANY DATA FROM THE PROGRAM.                                  14210033
056200*----------------------------------------------------------       14220033
056300 9999-WRAPUP.                                                     14230033
056400                                                                  14240033
056500     CLOSE CONTROL-CARD-FOR-RESTART                               14250033
056600           CONTROL-CARD-CURR-FUTURE-DTE                           14260033
056700           CONTROL-CARD-LAST-FUTURE-DTE                           14270033
056700           CONTROL-CARD-CURR-BATCH-DTE                            14280033
056800           PROMO-INTFC-FILE.                                      14290033
056900                                                                  14300033
057000     DISPLAY ' '.                                                 14310033
057100     DISPLAY '*********************************************'.     14320033
057200     DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            14330033
057300     DISPLAY '*********************************************'.     14340033
057400     DISPLAY 'NUMBER OF RESTRT RECS READ: ' PC-CNT-READ-RECS.     14350033
057500     DISPLAY 'NUMBER OF PROMO RECS WRITTEN: ' PC-CNT-PROMO-RECS.  14360033
057700*    DISPLAY 'MUMBER OF ERROR RECS WRITTEN: ' PC-CNT-ERROR-RECS.  14370033
057800*    DISPLAY 'ALL RECS WRITTEN: ' PC-CNT-ALL-RECS.                14380033
057900     DISPLAY '*********************************************'.     14390033
058000                                                                  14400033
058100*9999-EXIT.                                                       14410033
058200 EJECT.                                                           14420033
058300                                                                  14430033
