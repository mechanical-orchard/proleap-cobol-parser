000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             TMKUT004.                                00050000
000600 AUTHOR.                 TAMARA KOLTUN.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            9-10-96.                                 00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100*----------------------------------------------------------------*00110000
001200* THIS PROGRAM ATTACHES THE VANDOR NAME TO EACH OF THE TROUBLE   *00120000
001300* REPORT RECORDS.                                                *00130000
      *                                                                 00131003
      * CHANGE LOG:                                                     00131103
      *  09/26/2022  JEAN KURK  RECOMPILE FOR COBOL UPGRADE             00131203
      *                                CHG0274597                       00131303
001320*----------------------------------------------------------------*00132000
001330                                                                  00133000
001340******************************************************************00134000
001350 ENVIRONMENT DIVISION.                                            00135000
001360******************************************************************00136000
001370                                                                  00137000
001380 CONFIGURATION SECTION.                                           00138000
001390                                                                  00139000
001400 SOURCE-COMPUTER.        IBM-3090.                                00140000
001500 OBJECT-COMPUTER.        IBM-3090.                                00150000
001600                                                                  00160000
001700 INPUT-OUTPUT SECTION.                                            00170000
001800                                                                  00180000
001900 FILE-CONTROL.                                                    00190000
002000                                                                  00200000
002100      SELECT EXTRACT-TROUBLE-FILE   ASSIGN TO IO01.               00210000
002200                                                                  00220000
002300******************************************************************00230000
002400 DATA DIVISION.                                                   00240000
002500******************************************************************00250000
002600                                                                  00260000
002700 FILE SECTION.                                                    00270000
002800 FD  EXTRACT-TROUBLE-FILE                                         00280000
002900     LABEL RECORDS ARE STANDARD                                   00290000
003000     BLOCK CONTAINS 0 RECORDS                                     00300000
003100     RECORDING MODE IS F                                          00310000
003200     RECORD CONTAINS 400 CHARACTERS                               00320001
003300     DATA RECORD IS TE-TROUBLE-EXTRACT-RECORD.                    00330000
003400                                                                  00340000
003500 01  TE-TROUBLE-EXTRACT-RECORD       PIC X(400).                  00350001
003600*------------------------------------------------------*          00360000
003700 WORKING-STORAGE SECTION.                                         00370000
003800*------------------------------------------------------*          00380000
003900 01 PC-PROGRAM-CONSTANTS.                                         00390000
004000    05 PC-PROGRAM-NAME               PIC X(08) VALUE 'TMKUT004'.  00400000
004100    05 PC-NOT-FOUND                  PIC X(15) VALUE              00410001
004200                                              '** NOT FOUND **'.  00420000
004300 01 DK-DATABASE-KEYS.                                             00430001
004301    05 DK-ENT-ID                     PIC S9(9)     VALUE 99999999900430101
004302                                                       COMP.      00430201
004310 01 PC-PROGRAM-VARIABLES.                                         00431001
004400    05 PV-PARA-NAME                  PIC X(30)     VALUE SPACE.   00440000
004500    05 PV-ABEND-CODE                 PIC 9(04)     VALUE 0.       00450000
004600    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   00460000
004700    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   00470000
004800    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   00480000
004900    05 PV-SQLCODE                    PIC Z(8)9-.                  00490000
005000    05 PV-PARAGRAPH-NAME             PIC X(30)     VALUE SPACE.   00500000
005400    05 PV-START-EXTRACT              PIC X(10)     VALUE SPACE.   00540000
005500    05 PV-END-EXTRACT                PIC X(10)     VALUE SPACE.   00550000
005600    05 PV-ENT-ID-SAVE                PIC S9(9)     VALUE 0 COMP.  00560000
005700    05 PV-ENT-DESC                   PIC X(30)     VALUE SPACE.   00570000
005800 01 PS-PROGRAM-SWITCHES.                                          00580000
006400    05 PS-END-OF-FILE-SW             PIC X(01)     VALUE SPACE.   00640000
006500       88 PS-EOF                     VALUE 'Y'.                   00650000
006600       88 PS-NOT-EOF                 VALUE 'N'.                   00660000
006610    05 PS-ENT-FOUND-SW               PIC X(01)     VALUE SPACE.   00661001
006620       88 PS-ENT-FOUND               VALUE 'Y'.                   00662001
006630       88 PS-ENT-NOT-FOUND           VALUE 'N'.                   00663001
006700                                                                  00670000
007000     COPY TMRD001.                                                00700000
007100                                                                  00710000
007200*** DB2 MESSAGE AREAS ****                                        00720000
007300     COPY DPWS004.                                                00730000
007400*                                                                 00740000
007500     EXEC SQL                                                     00750000
007600          INCLUDE SQLCA                                           00760000
007700     END-EXEC.                                                    00770000
007800                                                                  00780000
007900     EXEC SQL                                                     00790000
008000          INCLUDE TENTNME                                         00800000
008100     END-EXEC.                                                    00810000
008200                                                                  00820000
008700********************************************************          00870000
008800 PROCEDURE DIVISION.                                              00880000
008900********************************************************          00890000
009000 0000-MAIN.                                                       00900000
009100     PERFORM 1000-INITIALIZATION         THRU 1000-EXIT.          00910000
009200     PERFORM 2000-PROCESS-INPUT-FILE     THRU 2000-EXIT           00920000
009300                            UNTIL PS-EOF.                         00930000
009400     CLOSE  EXTRACT-TROUBLE-FILE.                                 00940000
009500 0000-EXIT.  STOP RUN.                                            00950000
009600                                                                  00960000
009700 1000-INITIALIZATION.                                             00970000
009800      OPEN I-O    EXTRACT-TROUBLE-FILE.                           00980000
009900**** SCIPPING THE HEADER RECORD.                                  00990000
010000      READ EXTRACT-TROUBLE-FILE  INTO                             01000000
010100                                  TM001-TROUBLE-EXT-RECORD        01010000
010200          AT END                                                  01020000
010300             SET PS-EOF TO TRUE                                   01030000
010700      END-READ.                                                   01070000
010800                                                                  01080000
010900 1000-EXIT.  EXIT.                                                01090000
011000                                                                  01100000
011100 2000-PROCESS-INPUT-FILE.                                         01110000
011200      INITIALIZE TM001-TROUBLE-EXT-RECORD.                        01120000
011300      READ EXTRACT-TROUBLE-FILE  INTO                             01130000
011400                                  TM001-TROUBLE-EXT-RECORD        01140000
011500         AT END                                                   01150000
011600            SET PS-EOF TO TRUE                                    01160000
011700         NOT AT END                                               01170000
011800           PERFORM 2100-UPDATE-INPUT-FILE THRU 2100-EXIT          01180000
011900      END-READ.                                                   01190000
012000 2000-EXIT. EXIT.                                                 01200000
012100                                                                  01210000
012200 2100-UPDATE-INPUT-FILE.                                          01220000
012210                                                                  01221001
012300      IF TM001-ENT-ID   IS NOT = DK-ENT-ID                        01230001
012400         MOVE TM001-ENT-ID                TO DK-ENT-ID            01240001
012500         PERFORM 2110-GET-TENTNME-ROW     THRU 2110-EXIT          01250001
012600         EVALUATE TRUE                                            01260001
012700             WHEN PS-ENT-FOUND                                    01270001
013500                MOVE ENTNME-ENT-NAME-DESC TO TM001-ENT-NAME-DESC  01350001
013600                                             PV-ENT-DESC          01360001
013700                MOVE ENTNME-ENT-ID        TO PV-ENT-ID-SAVE       01370001
014100             WHEN PS-ENT-NOT-FOUND                                01410001
014900                MOVE PC-NOT-FOUND         TO TM001-ENT-NAME-DESC  01490001
015000                                             PV-ENT-DESC          01500001
015500           END-EVALUATE                                           01550001
015600      ELSE                                                        01560001
015700        MOVE PV-ENT-DESC                  TO TM001-ENT-NAME-DESC  01570001
016000      END-IF.                                                     01600001
016100                                                                  01610001
016300      REWRITE TE-TROUBLE-EXTRACT-RECORD FROM                      01630001
016400                                  TM001-TROUBLE-EXT-RECORD.       01640001
016500 2100-EXIT.  EXIT.                                                01650000
016600                                                                  01660001
016700 2110-GET-TENTNME-ROW.                                            01670001
016800      EXEC SQL                                                    01680001
016900                SELECT                                            01690001
017000                      ENT_NAME_DESC                               01700001
017400                INTO :ENTNME-ENT-NAME-DESC                        01740001
017800                FROM TENTNME                                      01780001
017900                WHERE   ENT_ID   = :DK-ENT-ID                     01790001
                        AND   TYPE_CDE = '01'                           01810002
018500       END-EXEC.                                                  01850001
018600                                                                  01860001
018700       EVALUATE TRUE                                              01870001
018800            WHEN SQLCODE = ZERO                                   01880001
018900                SET PS-ENT-FOUND             TO TRUE              01890001
019000            WHEN SQLCODE = +100                                   01900001
019100                SET  PS-ENT-NOT-FOUND        TO TRUE              01910001
019200            WHEN OTHER                                            01920001
019300               MOVE '2110-GET-TENTNME-ROW  ' TO PV-ABEND-PARA-NAME01930001
019400                MOVE 'SELECT TENTNME ROW'                         01940001
019500                                         TO PV-DB2-OPERATION-MSG-101950001
019600                MOVE 'TENTNME'           TO PV-DB2-TABLE-NAME     01960001
019700                PERFORM 9998-SQL-ABEND   THRU 9998-EXIT           01970001
019800        END-EVALUATE.                                             01980001
019900                                                                  01990001
020000 2110-EXIT.  EXIT.                                                02000001
020100                                                                  02010001
020200 9998-SQL-ABEND.                                                  02020001
020300     MOVE SQLCODE     TO PV-SQLCODE.                              02030001
020400     DISPLAY '** ABEND           ** = SQLABEND'.                  02040001
020500     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02050001
020600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        02060001
020700     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        02070001
020800     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   02080001
020900     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               02090001
021000     COPY DPPD004.                                                02100001
021100     MOVE +4013                  TO PV-ABEND-CODE.                02110001
021200     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       02120001
021300 9998-EXIT.  EXIT.                                                02130001
021400                                                                  02140000
