000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400 PROGRAM-ID.         RDKUT020.                                    00040001
000500 AUTHOR.             BARB ERTL.                                   00050001
000600 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00060001
000700 DATE-WRITTEN.       MAY 2003.                                    00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000******************************************************************00100001
001100* THIS PROGRAM PREPARES THE UPDATE REFUND FILE TO BE PROCESSED   *00110001
001200* BY RDKUP010 UNDER THE DB2 CHECKPOINT RESTART SYSTEM.           *00120001
001300*                                                                *00130001
001400* THE PROGRAM READS THE UPDATE REFUND FILE, REFORMATS THE        *00140001
001500* RECORDS AND SETS A CHECKPOINT INDICATOR ON THE RECORD BASED    *00150001
001600* ON HOW CHECKPOINTS WILL BE TAKEN BY THE MAINTENANCE PROGRAM.   *00160001
001700* AFTER A RECORD HAS BEEN REFORMATTED IT IS PASSED TO THE        *00170001
001800* TRANSACTION PREPARATION MODULE (DPKUT900) WHICH DOES SOME MORE *00180001
001900* PROCESSING ON THE RECORDS AND WRITES THE REFORMATTED RECORDS   *00190001
002000* OUT TO A SEQUENTIAL FILE.                                      *00200001
002100*                                                                *00210001
002200* THE PROGRAM COMMUNICATES WITH THE TRANSACTION PREPARATION      *00220001
002300* MODULE USING FUNCTION CODES (OPEN, WRITE, & CLOSE) AND CHECKS  *00230001
002400* THE RETURN CODE AFTER EACH REQUEST.  IF AN INVALID RETURN CODE *00240001
002500* IS RECEIVED, ANY INFORMATION THAT MAY BE HELPFUL IN RESOLVING  *00250001
002600* THE BAD RETURN CODE IS DISPLAYED ON SYSOUT AND THE PROGRAM     *00260001
002700* ABENDS.                                                        *00270001
002800*                                                                *00280001
002900* INPUT FILES:   UPDATE-REFUND-FILE        DDNAME = INP01        *00290001
003000*                                                                *00300001
003100* OUTPUT FILES:  CHECKPOINT/RESTART FILE   DDNAME = OUT01        *00310001
003200*                                                                *00320001
260107* CHG0260107   JIM HUNTER   08-16-21   ADD COPYBOOK DPWS990 TO    00321006
260107*                                      MAKE DPKUT900 CALL DYNAMIC.00322006
003300******************************************************************00330001
003400 ENVIRONMENT DIVISION.                                            00340001
003500******************************************************************00350001
003600                                                                  00360001
003700 CONFIGURATION SECTION.                                           00370001
003800                                                                  00380001
003900 SOURCE-COMPUTER.    IBM-3090.                                    00390001
004000 OBJECT-COMPUTER.    IBM-3090.                                    00400001
004100                                                                  00410001
004200 INPUT-OUTPUT SECTION.                                            00420001
004300                                                                  00430001
004400 FILE-CONTROL.                                                    00440001
004500                                                                  00450001
004600     SELECT UPDATE-REFUND-FILE   ASSIGN TO INP01.                 00460001
004700                                                                  00470001
004800******************************************************************00480001
004900 DATA DIVISION.                                                   00490001
005000******************************************************************00500001
005100                                                                  00510001
005200 FILE SECTION.                                                    00520001
005300                                                                  00530001
005400 FD  UPDATE-REFUND-FILE                                           00540001
005500     RECORDING MODE IS F                                          00550001
005600     BLOCK CONTAINS 0 RECORDS                                     00560001
005700     LABEL RECORDS ARE OMITTED.                                   00570001
005800                                                                  00580001
005900 01  UPDATE-REFUND-RECORD        PIC  X(206).                     00590001
006000                                                                  00600001
006100 WORKING-STORAGE SECTION.                                         00610001
006200                                                                  00620001
006300 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00630001
006400                                                                  00640001
006500******************************************************************00650001
006600*PC - PROGRAM CONSTANTS                                           00660001
006700******************************************************************00670001
006800 01  PROGRAM-CONSTANTS.                                           00680001
006900     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'RDKUT020'. 00690001
007000     05  PC-TRAN-PREP-FUNC-CODES.                                 00700001
007100         10  PC-TRAN-PREP-FUNC-OPEN                               00710001
007200                                 PIC X(05)      VALUE 'OPEN '.    00720001
007300         10  PC-TRAN-PREP-FUNC-WRITE                              00730001
007400                                 PIC X(05)      VALUE 'WRITE'.    00740001
007500         10  PC-TRAN-PREP-FUNC-CLOSE                              00750001
007600                                 PIC X(05)      VALUE 'CLOSE'.    00760001
007700     05  PC-JOB-NAME             PIC X(08)      VALUE 'RDK015  '. 00770001
007800     05  PC-PLAN-NAME            PIC X(08)      VALUE 'RDKUP010'. 00780001
007900     05  PC-TRANS-RECORD-LENGTH  PIC S9(04)     VALUE +206 COMP.  00790001
008000                                                                  00800001
008100******************************************************************00810001
008200*PV - PROGRAM VARIABLES                                           00820001
008300******************************************************************00830001
008400 01  PROGRAM-VARIABLES.                                           00840001
008500     05  PV-CHECKPOINT-TYPE      PIC X(01)      VALUE SPACE.      00850001
008600         88  CONTROL-BREAK                      VALUE 'C'.        00860001
008700         88  LOGICAL-TRANSACTION                VALUE 'L'.        00870001
008800         88  TIME-INTERVAL                      VALUE 'T'.        00880001
008900         88  REQUESTED-BY-PROGRAM               VALUE 'R'.        00890001
009000                                                                  00900001
009100     05  PV-KEY-FIELDS.                                           00910002
009200         10  PV-DRV-LIC-NBR           PIC   X(25).                00920002
009300         10  PV-LAST-NM               PIC   X(30).                00930002
009400         10  PV-FRST-NM               PIC   X(30).                00940002
009500         10  PV-M2A-LNE-1-ADDR        PIC   X(40).                00950002
009600         10  PV-M2A-CTY-NM            PIC   X(20).                00960002
009700         10  PV-M2A-ST-CDE            PIC   X(02).                00970002
009800         10  PV-M2A-PSTL-CDE          PIC   X(11).                00980002
009900         10  PV-STR-RGST-ID           PIC  S9(04) COMP.           00990002
010000         10  PV-RGST-TRN-NBR          PIC  S9(04) COMP.           01000002
010100         10  PV-RFND-SEQ-NBR          PIC  S9(04) COMP.           01010002
010200******************************************************************01020001
010300*PA - PROGRAM ACCUMULATORS                                        01030001
010400******************************************************************01040001
010500 01  PROGRAM-ACCUMULATORS.                                        01050001
010600     05  PA-REFUND-RECORDS-READ PIC S9(11)      COMP-3            01060002
010700                                                VALUE ZEROES.     01070001
010800     05  PA-REFUND-RECS-WRITTEN PIC S9(11)      COMP-3            01080002
010900                                                VALUE ZEROES.     01090001
011000                                                                  01100001
011100******************************************************************01110001
011200*PS - PROGRAM SWITCHES                                            01120001
011300******************************************************************01130001
011400 01  PROGRAM-SWITCHES.                                            01140001
011500     05  PS-UPD-REFUND-EOF-SW    PIC X(01)      VALUE 'N'.        01150002
011600         88  PS-UPD-REFUND-EOF                  VALUE 'Y'.        01160002
011700     05  PS-PS-FIRST-TRANS-READ-SW PIC X(01)    VALUE 'Y'.        01170003
011800         88  PS-FIRST-TRANS-READ                VALUE 'Y'.        01180003
011900         88  PS-FIRST-TRANS-NOT-READ            VALUE 'N'.        01190003
012000                                                                  01200001
012100******************************************************************01210001
012200*  REFUND UPDATE RECORD LAYOUT                                   *01220002
012300******************************************************************01230001
012400     COPY RDRD037.                                                01240002
012500                                                                  01250001
012600******************************************************************01260001
012700*  TRANSACTION PREPARATION MODULE LINKAGE SECTION                *01270001
012800******************************************************************01280001
260107     COPY DPWS990.                                                01290006
013000                                                                  01300001
012900     COPY DPLS000.                                                01301006
013000                                                                  01302006
013100******************************************************************01310001
013200*  SQL COMMUNICATIONS WORK AREA                                  *01320001
013300******************************************************************01330001
013400     COPY SQLCA2.                                                 01340001
013500                                                                  01350001
013600 EJECT                                                            01360001
013700******************************************************************01370001
013800 PROCEDURE DIVISION.                                              01380001
013900******************************************************************01390001
014000* A100-MAINLINE-PROCESSING                                        01400001
014100*    CONTROLS FLOW OF THE PROGRAM                                *01410001
014200******************************************************************01420001
014300 A100-MAINLINE-PROCESSING.                                        01430001
014400                                                                  01440001
014500     PERFORM B100-INITIALIZE.                                     01450001
014600                                                                  01460001
014700     PERFORM B200-PROCESS-UPD-REFUND-FILE                         01470002
014800         UNTIL PS-UPD-REFUND-EOF.                                 01480002
014900                                                                  01490001
015000     PERFORM B300-END-OF-JOB-ROUTINE.                             01500001
015100                                                                  01510001
015200     GOBACK.                                                      01520001
015300 EJECT                                                            01530001
015400******************************************************************01540001
015500* B100-INITIALIZE                                                *01550001
015600******************************************************************01560001
015700 B100-INITIALIZE.                                                 01570001
015800                                                                  01580001
015900     PERFORM C100-ISSUE-OPEN-REQUEST.                             01590001
016000                                                                  01600001
016100     OPEN INPUT UPDATE-REFUND-FILE.                               01610001
016200                                                                  01620001
016300     PERFORM C200-READ-UPDATE-REFUND-FILE.                        01630001
016400                                                                  01640002
016500     IF PS-UPD-REFUND-EOF                                         01650002
016600         DISPLAY ' '                                              01660001
016700         DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME          01670001
016800         DISPLAY 'UPDATE REFUND FILE IS EMPTY'                    01680002
016900         DISPLAY ' '                                              01690001
017000     END-IF.                                                      01700001
017100                                                                  01710001
017200******************************************************************01720001
017300* B200-PROCESS-UPD-REFUND-FILE                                   *01730002
017400*     READ AN UPDATE REFUND RECORD.   IF END-OF-FILE, STOP PRO-  *01740002
017500*     CESSING.  IF A RECORD IS READ, GATHER WHATEVER OTHER DATA  *01750001
017600*     IS NECESSARY TO TAKE CHECKPOINTS BASED ON THE TYPE OF      *01760001
017700*     CHECKPOINTS BEING TAKEN BY RDKUP010 AND ISSUE A WRITE      *01770001
017800*     REQUEST TO THE TRANSACTION PREPARATION PROGRAM.            *01780001
017900******************************************************************01790001
018000 B200-PROCESS-UPD-REFUND-FILE.                                    01800002
018100                                                                  01810001
018200     IF PS-FIRST-TRANS-READ                                       01820003
018300         MOVE RD037-DRV-LIC-NBR      TO PV-DRV-LIC-NBR            01830002
018400         MOVE RD037-LAST-NM          TO PV-LAST-NM                01840002
018500         MOVE RD037-FRST-NM          TO PV-FRST-NM                01850002
018600         MOVE RD037-M2A-LNE-1-ADDR   TO PV-M2A-LNE-1-ADDR         01860002
018700         MOVE RD037-M2A-CTY-NM       TO PV-M2A-CTY-NM             01870002
018800         MOVE RD037-M2A-ST-CDE       TO PV-M2A-ST-CDE             01880002
018900         MOVE RD037-M2A-PSTL-CDE     TO PV-M2A-PSTL-CDE           01890002
019000         MOVE RD037-STR-RGST-ID      TO PV-STR-RGST-ID            01900002
019100         MOVE RD037-RGST-TRN-NBR     TO PV-RGST-TRN-NBR           01910002
019200         MOVE RD037-RFND-SEQ-NBR     TO PV-RFND-SEQ-NBR           01920002
019300         SET PS-FIRST-TRANS-NOT-READ TO TRUE                      01930003
019400     END-IF.                                                      01940001
019500                                                                  01950001
019600     IF CONTROL-BREAK                                             01960001
019700         PERFORM C300-CKPT-BY-CNTL-BREAK                          01970001
019800     ELSE                                                         01980001
019900         IF LOGICAL-TRANSACTION                                   01990001
020000             PERFORM C400-CKPT-BY-LOGICAL-TRANS                   02000001
020100         ELSE                                                     02010001
020200             PERFORM C500-CKPT-BY-TIME-OR-REQUEST                 02020001
020300         END-IF                                                   02030001
020400     END-IF.                                                      02040001
020500                                                                  02050001
020600     PERFORM C200-READ-UPDATE-REFUND-FILE.                        02060001
020700                                                                  02070001
020800 EJECT                                                            02080001
020900******************************************************************02090001
021000* B300-END-OF-JOB-ROUTINE                                        *02100001
021100******************************************************************02110001
021200 B300-END-OF-JOB-ROUTINE.                                         02120001
021300                                                                  02130001
021400     CLOSE UPDATE-REFUND-FILE.                                    02140001
021500                                                                  02150001
021600     DISPLAY ' '.                                                 02160001
021700     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             02170001
021800     DISPLAY 'NUMBER OF REFUND RECORDS READ:        '             02180002
021900             PA-REFUND-RECORDS-READ.                              02190002
022000     DISPLAY 'NUMBER OF TRANS/PREP RECORDS WRITTEN:  '            02200001
022100             PA-REFUND-RECS-WRITTEN.                              02210002
022200     DISPLAY ' '.                                                 02220001
022300                                                                  02230001
022400     PERFORM C600-ISSUE-CLOSE-REQUEST.                            02240001
022500                                                                  02250001
022600******************************************************************02260001
022700* C100-ISSUE-OPEN-REQUEST                                        *02270001
022800*     ISSUE AN 'OPEN' REQUEST TO THE TRANSACTION PREPARATION     *02280001
022900*     MODULE.                                                    *02290001
023000******************************************************************02300001
023100 C100-ISSUE-OPEN-REQUEST.                                         02310001
023200                                                                  02320001
023300     MOVE PC-TRAN-PREP-FUNC-OPEN TO DP000-FUNC-CODE.              02330001
023400     MOVE PC-JOB-NAME            TO DP000-JOB-NAME.               02340001
023500     MOVE PC-PLAN-NAME           TO DP000-PLAN-NAME.              02350001
023600                                                                  02360001
023700     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         02370001
023800                                                                  02380001
023900     MOVE DP000-CKPT-TYPE-CODE   TO PV-CHECKPOINT-TYPE.           02390001
024000                                                                  02400001
024100******************************************************************02410001
024200* C200-READ-UPDATE-REFUND-FILE                                   *02420001
024300******************************************************************02430001
024400 C200-READ-UPDATE-REFUND-FILE.                                    02440001
024500                                                                  02450001
024600     READ UPDATE-REFUND-FILE INTO RD037-RECORD                    02460002
024700         AT END                                                   02470001
024800             SET PS-UPD-REFUND-EOF TO TRUE.                       02480002
024900                                                                  02490001
025000     IF PS-UPD-REFUND-EOF                                         02500002
025100         CONTINUE                                                 02510001
025200     ELSE                                                         02520001
025300         ADD +1 TO PA-REFUND-RECORDS-READ                         02530002
025400     END-IF.                                                      02540001
025500                                                                  02550001
025600******************************************************************02560001
025700* C300-CKPT-BY-CNTL-BREAK                                        *02570001
025800*     THIS ROUTINE SETS THE CHECKPOINT INDICATOR ON THE TRANSAC- *02580001
025900*     TION RECORD "ON" IF THERE IS A CHANGE IN THE KEY INFO.     *02590004
026000*     AFTER THE TRANSACTION RECORD HAS BEEN FORMATTED, A WRITE   *02600004
026100*     REQUEST IS ISSUED TO THE TRANSACTION PREPARATION MODULE.   *02610004
026200* NOTE: AT THIS TIME CONTROL/LOGIC BREAK PROCESSING IS IDENTICAL.*02620001
026300******************************************************************02630001
026400 C300-CKPT-BY-CNTL-BREAK.                                         02640001
026500                                                                  02650001
026600     IF RD037-DRV-LIC-NBR          = PV-DRV-LIC-NBR               02660002
026700       AND RD037-LAST-NM           = PV-LAST-NM                   02670002
026800       AND RD037-FRST-NM           = PV-FRST-NM                   02680002
026900       AND RD037-M2A-LNE-1-ADDR    = PV-M2A-LNE-1-ADDR            02690002
027000       AND RD037-M2A-CTY-NM        = PV-M2A-CTY-NM                02700002
027100       AND RD037-M2A-ST-CDE        = PV-M2A-ST-CDE                02710002
027200       AND RD037-M2A-PSTL-CDE      = PV-M2A-PSTL-CDE              02720002
027300       AND RD037-STR-RGST-ID       = PV-STR-RGST-ID               02730002
027400       AND RD037-RGST-TRN-NBR      = PV-RGST-TRN-NBR              02740002
027500       AND RD037-RFND-SEQ-NBR      = PV-RFND-SEQ-NBR              02750002
027600         MOVE 'N'                    TO DP000-CHECKPOINT-IND      02760002
027700     ELSE                                                         02770001
027800         MOVE 'Y'                    TO DP000-CHECKPOINT-IND      02780002
027900         MOVE RD037-DRV-LIC-NBR      TO PV-DRV-LIC-NBR            02790002
028000         MOVE RD037-LAST-NM          TO PV-LAST-NM                02800002
028100         MOVE RD037-FRST-NM          TO PV-FRST-NM                02810002
028200         MOVE RD037-M2A-LNE-1-ADDR   TO PV-M2A-LNE-1-ADDR         02820002
028300         MOVE RD037-M2A-CTY-NM       TO PV-M2A-CTY-NM             02830002
028400         MOVE RD037-M2A-ST-CDE       TO PV-M2A-ST-CDE             02840002
028500         MOVE RD037-M2A-PSTL-CDE     TO PV-M2A-PSTL-CDE           02850002
028600         MOVE RD037-STR-RGST-ID      TO PV-STR-RGST-ID            02860002
028700         MOVE RD037-RGST-TRN-NBR     TO PV-RGST-TRN-NBR           02870002
028800         MOVE RD037-RFND-SEQ-NBR     TO PV-RFND-SEQ-NBR           02880002
028900     END-IF.                                                      02890001
029000                                                                  02900001
029100     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      02910001
029200     MOVE RD037-RECORD            TO DP000-TRANS-REC.             02920002
029300     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             02930001
029400     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              02940001
029500     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             02950001
029600                                                                  02960001
029700     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         02970001
029800     ADD +1 TO PA-REFUND-RECS-WRITTEN.                            02980002
029900                                                                  02990001
030000******************************************************************03000001
030100* C400-CKPT-BY-LOGICAL-TRANS.                                    *03010001
030200*     THIS ROUTINE SETS THE CHECKPOINT INDICATOR ON THE TRANSAC- *03020001
030300*     TION RECORD "ON" IF THERE IS A CHANGE IN THE KEY INFO.     *03030002
030400*     AFTER THE TRANSACTION RECORD HAS BEEN FORMATTED, A WRITE   *03040002
030500*     REQUEST IS ISSUED TO THE TRANSACTION PERPARATION MODULE.   *03050002
030600* NOTE: AT THIS TIME CONTROL/LOGIC BREAK PROCESSING IS IDENTICAL.*03060001
030700******************************************************************03070001
030800 C400-CKPT-BY-LOGICAL-TRANS.                                      03080001
030900                                                                  03090001
031000     IF RD037-DRV-LIC-NBR          = PV-DRV-LIC-NBR               03100002
031100       AND RD037-LAST-NM           = PV-LAST-NM                   03110002
031200       AND RD037-FRST-NM           = PV-FRST-NM                   03120002
031300       AND RD037-M2A-LNE-1-ADDR    = PV-M2A-LNE-1-ADDR            03130002
031400       AND RD037-M2A-CTY-NM        = PV-M2A-CTY-NM                03140002
031500       AND RD037-M2A-ST-CDE        = PV-M2A-ST-CDE                03150002
031600       AND RD037-M2A-PSTL-CDE      = PV-M2A-PSTL-CDE              03160002
031700       AND RD037-STR-RGST-ID       = PV-STR-RGST-ID               03170002
031800       AND RD037-RGST-TRN-NBR      = PV-RGST-TRN-NBR              03180002
031900       AND RD037-RFND-SEQ-NBR      = PV-RFND-SEQ-NBR              03190002
032000         MOVE 'N'                    TO DP000-CHECKPOINT-IND      03200002
032100     ELSE                                                         03210001
032200         MOVE 'Y'                    TO DP000-CHECKPOINT-IND      03220002
032300         MOVE RD037-DRV-LIC-NBR      TO PV-DRV-LIC-NBR            03230002
032400         MOVE RD037-LAST-NM          TO PV-LAST-NM                03240002
032500         MOVE RD037-FRST-NM          TO PV-FRST-NM                03250002
032600         MOVE RD037-M2A-LNE-1-ADDR   TO PV-M2A-LNE-1-ADDR         03260002
032700         MOVE RD037-M2A-CTY-NM       TO PV-M2A-CTY-NM             03270002
032800         MOVE RD037-M2A-ST-CDE       TO PV-M2A-ST-CDE             03280002
032900         MOVE RD037-M2A-PSTL-CDE     TO PV-M2A-PSTL-CDE           03290002
033000         MOVE RD037-STR-RGST-ID      TO PV-STR-RGST-ID            03300002
033100         MOVE RD037-RGST-TRN-NBR     TO PV-RGST-TRN-NBR           03310002
033200         MOVE RD037-RFND-SEQ-NBR     TO PV-RFND-SEQ-NBR           03320002
033300     END-IF.                                                      03330001
033400                                                                  03340001
033500     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      03350001
033600     MOVE RD037-RECORD            TO DP000-TRANS-REC.             03360002
033700     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             03370001
033800     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              03380001
033900     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03390001
034000                                                                  03400001
034100     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         03410001
034200     ADD +1 TO PA-REFUND-RECS-WRITTEN.                            03420002
034300                                                                  03430001
034400******************************************************************03440001
034500* C500-CKPT-BY-TIME-OR-REQUEST.                                  *03450001
034600*     THIS ROUTINE BUILDS THE TRANSACTION RECORD AND ISSUES A    *03460001
034700*     WRITE REQUEST TO THE TRANSACTION PREPARATION MODULE IF     *03470001
034800*     CHECKPOINTS ARE TAKEN BY TIME INTERVAL (SECONDS) OR        *03480001
034900*     REQUESTED BY THE MAINTENANCE PROGRAM.                      *03490001
035000******************************************************************03500001
035100 C500-CKPT-BY-TIME-OR-REQUEST.                                    03510001
035200                                                                  03520001
035300     MOVE 'N' TO DP000-CHECKPOINT-IND.                            03530001
035400     MOVE PC-TRANS-RECORD-LENGTH  TO DP000-TRANS-REC-LENGTH.      03540001
035500     MOVE RD037-RECORD            TO DP000-TRANS-REC.             03550002
035600     MOVE PC-TRAN-PREP-FUNC-WRITE TO DP000-FUNC-CODE.             03560001
035700     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              03570001
035800     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03580001
035900                                                                  03590001
036000     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         03600001
036100     ADD +1 TO PA-REFUND-RECS-WRITTEN.                            03610002
036200                                                                  03620001
036300******************************************************************03630001
036400* C600-ISSUE-CLOSE-REQUEST                                       *03640001
036500*     ISSUE A 'CLOSE' REQUEST TO THE TRANSACTION PREPARATION     *03650001
036600*     MODULE.                                                    *03660001
036700******************************************************************03670001
036800 C600-ISSUE-CLOSE-REQUEST.                                        03680001
036900                                                                  03690001
037000     MOVE PC-TRAN-PREP-FUNC-CLOSE TO DP000-FUNC-CODE.             03700001
037100     MOVE PC-JOB-NAME             TO DP000-JOB-NAME.              03710001
037200     MOVE PC-PLAN-NAME            TO DP000-PLAN-NAME.             03720001
037300                                                                  03730001
037400     PERFORM Z900-CALL-TRANS-PREP-MODULE.                         03740001
037500                                                                  03750001
037600******************************************************************03760001
037700*  TRANSACTION PREPARATION MODULE CALL AND ERROR ROUTINES        *03770001
037800******************************************************************03780001
037900     COPY DPPD000.                                                03790001
038000                                                                  03800001
