000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    RCKCS222.                                         00040000
000500 AUTHOR.        JOHN GREFFER (STRATAGEM).                         00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  03-19-93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    E222 - RECEIVER LIST PROGRAM.                              * 00110000
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF RECEIVERS BY PURCHASE     * 00130000
001400*    ORDER IN DESCENDING RECEIPT DATE SEQUENCE IF A PO NUMBER   * 00140000
001500*    WAS ENTERED ON THE PREVIOUS SCREEN. IF A SEQUENCE NUMBER   * 00150000
001600*    WAS ENTERED ON THE PREVIOUS SCREEN, ONLY ONE RECEIVER WILL * 00160000
001700*    APPEAR ON THE LIST SCREEN.                                 * 00170000
001800*                                                               * 00180000
001900*    THE APPROPRIATE PROGRAM IS INVOKED WHEN THE OPERATOR       * 00190000
002000*    SELECTS ONE OR MORE ITEMS AND PRESSES A FUNCTION KEY.      * 00200000
002100*                                                               * 00210000
002200*    THE DP030-OVERRIDE-APPL-ERROR SWITCH IS SET TO TRUE WHEN   * 00220000
002300*    ENTERING THE PROGRAM IN ORDER TO GIVE CONTROL BACK TO THE  * 00230000
002400*    LIST WHEN A NEXT-ACT-APPL-ERROR IS SENT BACK FROM THE      * 00240000
002500*    UPDATE.  THE DP030-RC-APPL-ERROR IS CHECKED TO DETERMINE   * 00250000
002600*    IF A NEXT-ACT-APPL-ERROR IS BEING RETURNED TO THE LIST.    * 00260000
002700*                                                               * 00270000
002800*---------------------------------------------------------------* 00280000
002810* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00281005
002820* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00282006
002830* MAKING THE CALL DYNAMIC VS STATIC.                              00283006
002840*---------------------------------------------------------------* 00284006
002900/                                                                 00290000
003000 ENVIRONMENT DIVISION.                                            00300000
003100                                                                  00310000
003200 DATA DIVISION.                                                   00320000
003300                                                                  00330000
003400 WORKING-STORAGE SECTION.                                         00340000
003500                                                                  00350000
003600 01  DK-DB2-KEYS.                                                 00360000
003700     05  DK-OPER-UNT-ID                 PIC S9(04) COMP VALUE +0. 00370000
003800     05  DK-OPER-UNT-ID-B               PIC S9(04) COMP VALUE +0. 00380000
003900     05  DK-OPER-UNT-ID-E               PIC S9(04) COMP VALUE +0. 00390000
004000     05  DK-FCLTY-ID                    PIC S9(04) COMP VALUE +0. 00400000
004100     05  DK-FCLTY-ID-B                  PIC S9(04) COMP VALUE +0. 00410000
004200     05  DK-FCLTY-ID-E                  PIC S9(04) COMP VALUE +0. 00420000
004300     05  DK-PO-NBR                      PIC S9(09) COMP VALUE +0. 00430000
004400     05  DK-REC-SEQ-NBR                 PIC S9(09) COMP VALUE +0. 00440000
004500     05  DK-REC-SEQ-NBR-B               PIC S9(09) COMP VALUE +0. 00450000
004600     05  DK-REC-SEQ-NBR-E               PIC S9(09) COMP VALUE +0. 00460000
004700     05  DK-ENT-ID                      PIC S9(09) COMP VALUE +0. 00470000
004800     05  DK-STATUS-CDE                  PIC X(02)  VALUE SPACES.  00480000
004900     05  DK-STORE-NMBR                  PIC S9(04) COMP VALUE +0. 00490000
005000                                                                  00500000
005100     05  DK-PO-RCVR.                                              00510000
005200         10  DK-TRN-NBR                 PIC 9(08) VALUE ZERO.     00520000
005300         10  FILLER                     PIC X(01) VALUE '-'.      00530000
005400         10  DK-RCVR-NBR                PIC 9(03) VALUE ZERO.     00540000
005500                                                                  00550000
005600                                                                  00560000
005700 01  PA-PROGRAM-ACCUMULATORS.                                     00570000
005800     05  PA-INVOICED-COUNT            PIC S9(09) VALUE +0         00580000
005900                                                 COMP-3.          00590000
006000     05  PA-AP-VERIFIED-COUNT           PIC S9(09) VALUE +0       00600000
006100                                                   COMP-3.        00610000
006200                                                                  00620000
006300 01  PC-PROGRAM-CONSTANTS.                                        00630000
006400     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00640000
006500                                                    'RC222A  '.   00650000
006600     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00660000
006700                                                    'RCKM222 '.   00670000
006800     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00680000
006900                                                    'RCKCS222'.   00690000
007000     05  PC-RCKCS279                    PIC  X(08)  VALUE         00700000
007100                                                    'RCKCS279'.   00710000
007200     05  PC-RCKCS280                    PIC  X(08)  VALUE         00720000
007300                                                    'RCKCS280'.   00730000
007400     05  PC-RCKPV818                    PIC  X(08)  VALUE         00740000
007500                                                    'RCKPV818'.   00750000
007600     05  PC-RCKPV819                    PIC  X(08)  VALUE         00760000
007700                                                    'RCKPV819'.   00770000
007800     05  PC-RCKPV820                    PIC  X(08)  VALUE         00780000
007900                                                    'RCKPV820'.   00790000
008000     05  PC-SUKPV702                    PIC  X(08)  VALUE         00800000
008100                                                    'SUKPV702'.   00810000
008200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00820000
008300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00830000
008400     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00840000
008500     05  PC-RCVR-PO-LIST                PIC  X(01)  VALUE '2'.    00850000
008600     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +12     00860000
008700                                                    COMP SYNC.    00870000
008800     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00880000
008900                                                    COMP SYNC.    00890000
009000     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00900000
009100                                                    +1000000      00910000
009200                                                    COMP-3.       00920000
009300     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00930000
009400                                                    COMP SYNC.    00940000
009500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00950000
009600                                                    COMP-3.       00960000
009700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00970000
009800     05  PC-Y                           PIC  X(01)  VALUE 'Y'.    00980000
009900     05  PC-T                           PIC  X(01)  VALUE 'T'.    00990000
010000     05  PC-ADD                         PIC  X(03)  VALUE 'ADD'.  01000000
010100     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  01010000
010200     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  01020000
010300     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  01030000
010400     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  01040000
010500     05  PC-VERIFIED                    PIC  X(20)  VALUE         01050000
010600                                             'VERIFIED'.          01060000
010700     05  PC-VERIF-ADJ                   PIC  X(20)  VALUE         01070000
010800                                             'VERIFIED(ADJ)'.     01080000
010900                                                                  01090000
011000     05  PC-TSYMSG-NUMBERS.                                       01100000
011100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01110000
011200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01120000
011300         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01130000
011400         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01140000
011500         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01150000
011600         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01160000
011700         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01170000
011800         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01180000
011900         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01190000
012000         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01200000
012100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01210000
012200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01220000
012300         10  PC-TSYMSG-00083            PIC  9(05)  VALUE 00083.  01230000
012400         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01240000
012500         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01250000
012600         10  PC-TSYMSG-01089            PIC  9(05)  VALUE 01089.  01260000
012700         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01270000
012800                                                                  01280000
012900 01  PS-PROGRAM-SWITCHES.                                         01290000
013000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01300000
013100         88  PS-NO-ERROR                            VALUE 'Y'.    01310000
013200         88  PS-ERROR                               VALUE 'N'.    01320000
013300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01330000
013400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01340000
013500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01350000
013600     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01360000
013700         88  PS-DONE                                VALUE 'Y'.    01370000
013800         88  PS-NOT-DONE                            VALUE 'N'.    01380000
013900     05  PS-TROUBLE-SW                  PIC  X(01)  VALUE 'N'.    01390000
014000         88  PS-TROUBLE-BUSY                        VALUE 'Y'.    01400000
014100         88  PS-TROUBLE-NOT-BUSY                    VALUE 'N'.    01410000
014200     05  PS-ENTNME-SW                   PIC  X(01)  VALUE 'Y'.    01420000
014300         88  PS-ENTNME-FOUND                        VALUE 'Y'.    01430000
014400         88  PS-ENTNME-NOT-FOUND                    VALUE 'N'.    01440000
014500     05  PS-DIR-STORE-SW                PIC  X(01)  VALUE 'N'.    01450006
014600         88  PS-DIR-STORE                           VALUE 'Y'.    01460000
014700         88  PS-NOT-DIR-STORE                       VALUE 'N'.    01470000
014800                                                                  01480000
014900 01  PV-PROGRAM-VARIABLES.                                        01490000
015000     05  PV-SUB                         PIC S9(04)  VALUE +0      01500000
015100                                                    COMP SYNC.    01510000
015200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01520000
015300                                                    COMP SYNC.    01530000
015400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01540000
015500                                                    COMP-3.       01550000
015600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01560000
015700                                                    COMP-3.       01570000
015800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01580000
015900                                                    COMP-3.       01590000
016000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01600000
016100                                                    COMP-3.       01610000
016200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01620000
016300                                                    COMP-3.       01630000
016400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01640000
016500                                                    COMP-3.       01650000
016600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01660000
016700                                                    COMP-3.       01670000
016800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01680000
016900                                                    COMP SYNC.    01690000
017000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01700000
017100                                                    COMP SYNC.    01710000
017200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01720000
017300                                                    COMP SYNC.    01730000
017400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01740000
017500                                                    COMP SYNC.    01750000
017600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01760000
017700                                                    COMP SYNC.    01770000
017800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01780000
017900                                                    COMP SYNC.    01790000
018000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01800000
018100                                                    COMP SYNC.    01810000
018200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01820000
018300                                                    COMP SYNC.    01830000
018400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01840000
018500                                                    COMP SYNC.    01850000
018600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01860000
018700                                                    COMP SYNC.    01870000
018800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01880000
018900                                                    COMP SYNC.    01890000
019000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01900000
019100                                                    COMP SYNC.    01910000
019200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01920000
019300                                                    COMP SYNC.    01930000
019400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01940000
019500                                                    COMP SYNC.    01950000
019600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01960000
019700                                                    COMP SYNC.    01970000
019800     05  PV-OPER-UNT-ID                 PIC 9(04).                01980000
019900     05  PV-OPER-UNT-ID-X REDEFINES                               01990000
020000         PV-OPER-UNT-ID                 PIC X(04).                02000000
020100     05  PV-REC-DTE                     PIC X(10).                02010000
020200     05  PV-DB2-DATE.                                             02020000
020300         10  PV-DB2-CC                  PIC X(02).                02030000
020400         10  PV-DB2-YY                  PIC X(02).                02040000
020500         10  FILLER                     PIC X(01).                02050000
020600         10  PV-DB2-MM                  PIC X(02).                02060000
020700         10  FILLER                     PIC X(01).                02070000
020800         10  PV-DB2-DD                  PIC X(02).                02080000
020900     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      02090000
021000                                                    COMP-3.       02100000
021100     05  PV-LOC.                                                  02110000
021200         10  PV-LOC-OPER-UNT            PIC 9(04).                02120000
021300         10  FILLER                     PIC X(01) VALUE '-'.      02130000
021400         10  PV-LOC-FCLTY               PIC 9(01).                02140000
021500     05  PV-CURR-LOC.                                             02150000
021600         10  PV-CURR-LOC-OPER-UNT       PIC 9(04).                02160000
021700         10  FILLER                     PIC X(01) VALUE '-'.      02170000
021800         10  PV-CURR-LOC-FCLTY          PIC 9(01).                02180000
021900                                                                  02190000
022000     05  PV-NULL-IND                    PIC S9(04)  VALUE +0      02200000
022100                                                    COMP SYNC.    02210000
022200                                                                  02220000
022300*---------------------------------------------------------------* 02230000
022400*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02240000
022500*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02250000
022600*   APPLICATION-SPECIFIC COMMAREA.                              * 02260000
022700*---------------------------------------------------------------* 02270000
022800 01  LQW-LIST-QUEUE-WORK-AREA.                                    02280000
022900     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02290000
023000     05  LQW-ITEM-ENTRIES               OCCURS 12 TIMES           02300000
023100                                        INDEXED BY LQW-IDX.       02310000
023200         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02320000
023300         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02330000
023400         10  LQW-SELECTED-SW            PIC  X(01).               02340000
023500             88  LQW-SELECT                         VALUE 'S'.    02350000
023600             88  LQW-DESELECT                       VALUE ' '.    02360000
023700         10  LQW-ACTION                 PIC  X(03).               02370000
023800         10  LQW-REC-SEQ-NBR            PIC  9(04).               02380000
023900         10  LQW-LOC                    PIC  X(06).               02390000
024000         10  LQW-CUR-LOC                PIC  X(06).               02400000
024100         10  LQW-ARRIVAL-DTE            PIC  X(08).               02410000
024200         10  LQW-ARRIVAL-DTE-ISO        PIC  X(10).               02420000
024300         10  LQW-RECEIVER-STAT          PIC  X(02).               02430000
024400         10  LQW-ADJUSTED-SW            PIC  X(01).               02440000
024500             88 LQW-ADJUSTED-PO                     VALUE 'Y'.    02450000
024600             88 LQW-NOT-ADJUSTED                    VALUE ' '.    02460000
024700         10  LQW-OPER-SET-DESC          PIC  X(16).               02470000
024800         10  LQW-EXP-CTN                PIC S9(04)  COMP-3.       02480000
024900         10  LQW-CTN-CNT                PIC S9(04)  COMP-3.       02490000
025000         10  LQW-SHIPT-ID               PIC S9(09)  COMP.         02500000
025100         10  LQW-TRIP-ID                PIC S9(09)  COMP.         02510000
025200         10  LQW-OPER-UNT-ID            PIC S9(04)  COMP.         02520000
025300         10  LQW-FCLTY-ID               PIC S9(04)  COMP.         02530000
025400         10  LQW-EXP-PCS                PIC S9(05)  COMP-3.       02540000
025500         10  LQW-PCS-VERFD              PIC S9(05)  COMP-3.       02550000
025600         10  LQW-TROUBLE-SW             PIC  X(01).               02560000
025700             88 LQW-TROUBLE-EXISTS                  VALUE 'Y'.    02570000
025800             88 LQW-NO-TROUBLE                      VALUE ' '.    02580000
025900                                                                  02590000
026000/                                                                 02600000
026100*---------------------------------------------------------------* 02610000
026200*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02620000
026300*---------------------------------------------------------------* 02630000
026400                                                                  02640000
026500     COPY RCWS013.                                                02650000
026600     COPY SUWS010.                                                02660000
026700                                                                  02670000
026800/                                                                 02680000
026900*---------------------------------------------------------------* 02690000
027000*    MAP LAYOUT                                                 * 02700000
027100*---------------------------------------------------------------* 02710000
027200                                                                  02720000
027300     COPY RCKM222.                                                02730000
027400                                                                  02740000
027500 01  MR-OCCURS-LAYOUT                   REDEFINES  RC222AO.       02750000
027600     05  FILLER                         PIC X(12).                02760003
027700     05  FILLER.                                                  02770000
027800         10  MR-PO-NBRL                 PIC S9(04) COMP.          02780000
027900         10  MR-PO-NBRA                 PIC  X(01).               02790000
028000         10  MR-PO-NBRC                 PIC  X(01).               02800000
028100         10  MR-PO-NBRH                 PIC  X(01).               02810000
028200** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  02820002
028300         10  MR-PO-NBR-X.                                         02830002
028400             15  MR-PO-NBR              PIC  9(08).               02840002
028500                                                                  02850000
028600         10  MR-ENT-NAME-DESCL          PIC S9(04) COMP.          02860000
028700         10  MR-ENT-NAME-DESCA          PIC  X(01).               02870000
028800         10  MR-ENT-NAME-DESCC          PIC  X(01).               02880000
028900         10  MR-ENT-NAME-DESCH          PIC  X(01).               02890000
029000         10  MR-ENT-NAME-DESC           PIC  X(25).               02900000
029100                                                                  02910000
029200         10  FILLER                     PIC  X(36).               02920000
029300                                                                  02930000
029400     05  MR-SCROLL-AREA                 OCCURS 12 TIMES.          02940000
029500         10  MR-SELECTL                 PIC S9(04) COMP.          02950000
029600         10  MR-SELECTA                 PIC  X(01).               02960000
029700         10  MR-SELECTC                 PIC  X(01).               02970000
029800         10  MR-SELECTH                 PIC  X(01).               02980000
029900         10  MR-SELECT                  PIC  X(01).               02990000
030000                                                                  03000000
030100         10  MR-ACTIONL                 PIC S9(04) COMP.          03010000
030200         10  MR-ACTIONA                 PIC  X(01).               03020000
030300         10  MR-ACTIONC                 PIC  X(01).               03030000
030400         10  MR-ACTIONH                 PIC  X(01).               03040000
030500         10  MR-ACTION                  PIC  X(03).               03050000
030600                                                                  03060000
030700         10  MR-REC-SEQ-NBRL            PIC S9(04) COMP.          03070000
030800         10  MR-REC-SEQ-NBRA            PIC  X(01).               03080000
030900         10  MR-REC-SEQ-NBRC            PIC  X(01).               03090000
031000         10  MR-REC-SEQ-NBRH            PIC  X(01).               03100000
031100         10  MR-REC-SEQ-NBR             PIC  X(04).               03110000
031200                                                                  03120000
031300         10  MR-REC-SEQ-LOCL            PIC S9(04) COMP.          03130000
031400         10  MR-REC-SEQ-LOCA            PIC  X(01).               03140000
031500         10  MR-REC-SEQ-LOCC            PIC  X(01).               03150000
031600         10  MR-REC-SEQ-LOCH            PIC  X(01).               03160000
031700         10  MR-REC-SEQ-LOC             PIC  X(06).               03170000
031800                                                                  03180000
031900         10  MR-REC-CUR-LOCL            PIC S9(04) COMP.          03190000
032000         10  MR-REC-CUR-LOCA            PIC  X(01).               03200000
032100         10  MR-REC-CUR-LOCC            PIC  X(01).               03210000
032200         10  MR-REC-CUR-LOCH            PIC  X(01).               03220000
032300         10  MR-REC-CUR-LOC             PIC  X(06).               03230000
032400                                                                  03240000
032500         10  MR-ARRIVAL-DTEL            PIC S9(04) COMP.          03250000
032600         10  MR-ARRIVAL-DTEA            PIC  X(01).               03260000
032700         10  MR-ARRIVAL-DTEC            PIC  X(01).               03270000
032800         10  MR-ARRIVAL-DTEH            PIC  X(01).               03280000
032900         10  MR-ARRIVAL-DTE             PIC  X(08).               03290000
033000                                                                  03300000
033100         10  MR-RECEIVER-STATL          PIC S9(04) COMP.          03310000
033200         10  MR-RECEIVER-STATA          PIC  X(01).               03320000
033300         10  MR-RECEIVER-STATC          PIC  X(01).               03330000
033400         10  MR-RECEIVER-STATH          PIC  X(01).               03340000
033500         10  MR-RECEIVER-STAT           PIC  X(02).               03350000
033600                                                                  03360000
033700         10  MR-OPER-SET-DESCL          PIC S9(04) COMP.          03370000
033800         10  MR-OPER-SET-DESCA          PIC  X(01).               03380000
033900         10  MR-OPER-SET-DESCC          PIC  X(01).               03390000
034000         10  MR-OPER-SET-DESCH          PIC  X(01).               03400000
034100         10  MR-OPER-SET-DESC           PIC  X(16).               03410000
034200                                                                  03420000
034300         10  MR-EXPECT-CTNL             PIC S9(04) COMP.          03430000
034400         10  MR-EXPECT-CTNA             PIC  X(01).               03440000
034500         10  MR-EXPECT-CTNC             PIC  X(01).               03450000
034600         10  MR-EXPECT-CTNH             PIC  X(01).               03460000
034700         10  MR-EXPECT-CTN-X.                                     03470000
034800             15  MR-EXPECT-CTN          PIC  Z(3)9.               03480000
034900                                                                  03490000
035000         10  MR-CARTON-CNTL             PIC S9(04) COMP.          03500000
035100         10  MR-CARTON-CNTA             PIC  X(01).               03510000
035200         10  MR-CARTON-CNTC             PIC  X(01).               03520000
035300         10  MR-CARTON-CNTH             PIC  X(01).               03530000
035400         10  MR-CARTON-CNT-X.                                     03540000
035500             15  MR-CARTON-CNT          PIC  Z(3)9.               03550000
035600                                                                  03560000
035700         10  MR-EXP-PCSL                PIC S9(04) COMP.          03570000
035800         10  MR-EXP-PCSA                PIC  X(01).               03580000
035900         10  MR-EXP-PCSC                PIC  X(01).               03590000
036000         10  MR-EXP-PCSH                PIC  X(01).               03600000
036100         10  MR-EXP-PCS-X.                                        03610000
036200             15  MR-EXP-PCS             PIC  Z(4)9.               03620000
036300                                                                  03630000
036400         10  MR-PCS-CNTL                PIC S9(04) COMP.          03640000
036500         10  MR-PCS-CNTA                PIC  X(01).               03650000
036600         10  MR-PCS-CNTC                PIC  X(01).               03660000
036700         10  MR-PCS-CNTH                PIC  X(01).               03670000
036800         10  MR-PCS-CNT-X.                                        03680000
036900             15  MR-PCS-CNT             PIC  Z(4)9.               03690000
037000                                                                  03700000
037100/                                                                 03710000
037200*---------------------------------------------------------------* 03720000
037300*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03730000
037400*---------------------------------------------------------------* 03740000
037500                                                                  03750000
037600     COPY DPWS015.                                                03760000
037700                                                                  03770000
037800*---------------------------------------------------------------* 03780000
037900*    FUNCTION KEYS COPYBOOK.                                    * 03790000
038000*---------------------------------------------------------------* 03800000
038100                                                                  03810000
038200     COPY DPWS016.                                                03820000
038300                                                                  03830000
038400*---------------------------------------------------------------* 03840000
038500*    NUMERIC EDIT LAYOUT.                                       * 03850000
038600*---------------------------------------------------------------* 03860000
038700                                                                  03870000
038800     COPY DPWS010I.                                               03880000
038900                                                                  03890000
039000/                                                                 03900000
039100******************************************************************03910006
039200** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **03920006
039210** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **03921006
039300******************************************************************03930006
039400                                                                  03940000
039500     COPY DPWS030.                                                03950000
039510     COPY DPWS930.                                                03951006
039600                                                                  03960000
039700/                                                                 03970000
039800*---------------------------------------------------------------* 03980000
039900*    STANDARD COMMAREA.                                         * 03990000
040000*---------------------------------------------------------------* 04000000
040100                                                                  04010000
040200     COPY DPWS020.                                                04020000
040300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04030000
040400                                                                  04040000
040500*---------------------------------------------------------------* 04050000
040600* INTER-APPLICATION COMMAREA.                                   * 04060000
040700*---------------------------------------------------------------* 04070000
040800                                                                  04080000
040900         10  INTER-APPL-COMM-AREA       PIC X(200).               04090000
041000     COPY RCWS012.                                                04100000
041100     COPY RCWS015.                                                04110000
041200     COPY POWS017.                                                04120000
041300     COPY SUWS009.                                                04130000
041400*---------------------------------------------------------------* 04140000
041500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04150000
041600*---------------------------------------------------------------* 04160000
041700         10  ASC-SPECIFIC-COMMAREA.                               04170000
041800             15  ASC-FUNC03-RETURN-FLAG    PIC  X(01).            04180000
041900                 88  ASC-FUNC03-RETURN-NO          VALUE 'N'.     04190000
042000                 88  ASC-FUNC03-RETURN-YES         VALUE 'Y'.     04200000
042100                                                                  04210000
042200             15  ASC-INT-APPL-FORMAT-IND   PIC X(01).             04220000
042300             15  ASC-USE-SELECTION-QUEUE-IND                      04230000
042400                                           PIC X(01).             04240000
042500                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        04250000
042600             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     04260000
042700             15  ASC-SEL-SUB               PIC S9(04) COMP.       04270000
042800             15  ASC-SEL-ITEM              PIC S9(04) COMP.       04280000
042900             15  ASC-LIST-KEYS.                                   04290000
043000                 20  ASC-KEY-OPER-UNT-ID PIC S9(04) COMP.         04300000
043100                 20  ASC-KEY-FCLTY-ID    PIC S9(04) COMP.         04310000
043200                 20  ASC-KEY-PO-NBR      PIC S9(09) COMP.         04320000
043300                 20  ASC-KEY-REC-SEQ-NBR PIC S9(09) COMP.         04330000
043400             15  ASC-PO-RCVR                 PIC  X(12).          04340000
043500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04350000
043600                 20  ASC-BLOCK-MODIFIED-SW                        04360000
043700                                        PIC X(01).                04370000
043800                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    04380000
043900                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    04390000
044000                                                                  04400000
044100                 20  ASC-ITEM-ARRAY.                              04410000
044200                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        04420000
044300                         30  ASC-LIST-ITEM-NUMBER                 04430000
044400                                        PIC S9(09)  COMP-3.       04440000
044500                         30  ASC-TEMP-SELECTED-SW                 04450000
044600                                        PIC X(01).                04460000
044700                             88  ASC-VALID-SELECT   VALUE ' '     04470000
044800                                                          'S'     04480000
044900                                                          'B'     04490000
045000                                                          'E'.    04500000
045100                             88  ASC-TEMP-NO-SELECT VALUE ' '.    04510000
045200                             88  ASC-TEMP-SELECT    VALUE 'S'.    04520000
045300                             88  ASC-TEMP-BEGIN     VALUE 'B'.    04530000
045400                             88  ASC-TEMP-END       VALUE 'E'.    04540000
045500                         30  ASC-SELECTED-SW                      04550000
045600                                        PIC X(01).                04560000
045700                             88  ASC-NO-SELECT      VALUE ' '.    04570000
045800                             88  ASC-SELECT         VALUE 'S'.    04580000
045900                             88  ASC-BEGIN          VALUE 'B'.    04590000
046000                             88  ASC-END            VALUE 'E'.    04600000
046100                         30  ASC-ACTION PIC X(03).                04610000
046200                         30  ASC-REC-SEQ-NBR                      04620000
046300                                        PIC 9(04).                04630000
046400                         30  ASC-LOC                              04640000
046500                                        PIC X(06).                04650000
046600                         30  ASC-CUR-LOC                          04660000
046700                                        PIC X(06).                04670000
046800                         30  ASC-ARRIVAL-DTE                      04680000
046900                                        PIC X(08).                04690000
047000                         30  ASC-ARRIVAL-DTE-ISO                  04700000
047100                                        PIC X(10).                04710000
047200                         30  ASC-RECEIVER-STAT                    04720000
047300                                        PIC X(02).                04730000
047400                         30  ASC-ADJUSTED-SW                      04740000
047500                                        PIC X(01).                04750000
047600                             88 ASC-ADJUSTED-PO     VALUE 'Y'.    04760000
047700                             88 ASC-NOT-ADJUSTED    VALUE ' '.    04770000
047800                         30  ASC-OPER-SET-DESC                    04780000
047900                                        PIC X(16).                04790000
048000                         30  ASC-EXP-CTN                          04800000
048100                                        PIC S9(04)  COMP-3.       04810000
048200                         30  ASC-CTN-CNT                          04820000
048300                                        PIC S9(04)  COMP-3.       04830000
048400                         30  ASC-SHIPT-ID                         04840000
048500                                        PIC S9(09)  COMP.         04850000
048600                         30  ASC-TRIP-ID                          04860000
048700                                        PIC S9(09)  COMP.         04870000
048800                         30  ASC-OPER-UNT-ID                      04880000
048900                                        PIC S9(04)  COMP.         04890000
049000                         30  ASC-FCLTY-ID                         04900000
049100                                        PIC S9(04)  COMP.         04910000
049200                         30  ASC-EXP-PCS                          04920000
049300                                        PIC S9(05)  COMP-3.       04930000
049400                         30  ASC-PCS-VERFD                        04940000
049500                                        PIC S9(05)  COMP-3.       04950000
049600                         30  ASC-TROUBLE-SW                       04960000
049700                                        PIC X(01).                04970000
049800                             88 ASC-TROUBLE-EXISTS  VALUE 'Y'.    04980000
049900                             88 ASC-NO-TROUBLE      VALUE ' '.    04990000
050000                                                                  05000000
050100             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     05010000
050200             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     05020000
050300             15  ASC-NUMBER-OF-ITEMS-READ                         05030000
050400                                        PIC S9(09) COMP-3.        05040000
050500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     05050000
050600                                        PIC S9(09) COMP-3.        05060000
050700             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        05070000
050800             15  ASC-ITEM-AT-TOP-OF-PANEL                         05080000
050900                                        PIC S9(09) COMP-3.        05090000
051000             15  ASC-ITEM-AT-BOT-OF-PANEL                         05100000
051100                                        PIC S9(09) COMP-3.        05110000
051200             15  ASC-HIGHEST-BLOCK-WRITTEN                        05120000
051300                                        PIC S9(04) COMP SYNC.     05130000
051400             15  ASC-START-OF-SELECTED-RANGE                      05140000
051500                                        PIC S9(09) COMP-3.        05150000
051600             15  ASC-END-OF-SELECTED-RANGE                        05160000
051700                                        PIC S9(09) COMP-3.        05170000
051800             15  ASC-ITEMS-LEFT-INDICATOR                         05180000
051900                                        PIC X(01).                05190000
052000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     05200000
052100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     05210000
052200             15  ASC-TEMP-QUEUE-UPDATE-SW                         05220000
052300                                        PIC X(01).                05230000
052400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     05240000
052500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     05250000
052600             15  ASC-LIST-QUEUE-NAME.                             05260000
052700                 20  ASC-LIST-TERM-ID   PIC X(04).                05270000
052800                 20  ASC-LIST-TASK-NUMBER                         05280000
052900                                        PIC S9(05) COMP-3.        05290000
053000                 20  ASC-LIST-SEQ       PIC 9(01).                05300000
053100             15  ASC-SEL-QUEUE-NAME-IN        PIC X(08).          05310000
053200             15  ASC-SEL-QUEUE-NAME.                              05320000
053300                 20  ASC-SEL-TERM-ID          PIC X(04).          05330000
053400                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  05340000
053500                 20  ASC-SEL-SEQ              PIC 9(01).          05350000
053600             15  ASC-SEL-QUEUE-NAME-2.                            05360000
053700                 20  ASC-SEL-TERM-ID-2        PIC  X(04).         05370000
053800                 20  ASC-SEL-TASK-NUMBER-2    PIC S9(05) COMP-3.  05380000
053900                 20  ASC-SEL-SEQ-2            PIC  9(01).         05390000
054000                                                                  05400000
054100             15  ASC-CURSOR-SW          PIC X(01).                05410000
054200                 88  ASC-NO-CURSOR                 VALUE 'Z'.     05420000
054300                 88  ASC-TYPE-CURSOR               VALUE 'S'.     05430000
054400                 88  ASC-LOC-CURSOR                VALUE 'N'.     05440000
054500                 88  ASC-DESC-CURSOR               VALUE 'T'.     05450000
054600             15  ASC-START-ITEM-REQUEST.                          05460000
054700                 20  ASC-START-ITEM-REQUEST-N                     05470000
054800                                        PIC 9(07).                05480000
054900             15  ASC-ENT-NAME-DESC      PIC X(25).                05490000
055000             15  FILLER                 PIC X(611).               05500000
055100/                                                                 05510000
055200*---------------------------------------------------------------* 05520000
055300*    ABEND PROCESSING COPYBOOK.                                 * 05530000
055400*---------------------------------------------------------------* 05540000
055500                                                                  05550000
055600     COPY DPWS013.                                                05560000
055700                                                                  05570000
055800/                                                                 05580000
055900*---------------------------------------------------------------* 05590000
056000*    DB2 AREA FOR RECEIVER DISTRIBUTION TABLE                   * 05600000
056100*---------------------------------------------------------------* 05610000
056200     EXEC SQL                                                     05620000
056300          INCLUDE TRECDIS                                         05630000
056400     END-EXEC.                                                    05640000
056500                                                                  05650000
056600/                                                                 05660000
056700*---------------------------------------------------------------* 05670000
056800*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 05680000
056900*---------------------------------------------------------------* 05690000
057000     EXEC SQL                                                     05700000
057100          INCLUDE TPURCHS                                         05710000
057200     END-EXEC.                                                    05720000
057300                                                                  05730000
057400/                                                                 05740000
057500*---------------------------------------------------------------* 05750000
057600*    DB2 AREA FOR THE ENTERPRISE TABLE                          * 05760000
057700*---------------------------------------------------------------* 05770000
057800     EXEC SQL                                                     05780000
057900          INCLUDE TEXTENT                                         05790000
058000     END-EXEC.                                                    05800000
058100                                                                  05810000
058200/                                                                 05820000
058300*---------------------------------------------------------------* 05830000
058400*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 05840000
058500*---------------------------------------------------------------* 05850000
058600     EXEC SQL                                                     05860000
058700          INCLUDE TENTNME                                         05870000
058800     END-EXEC.                                                    05880000
058900                                                                  05890000
059000/                                                                 05900000
059100*---------------------------------------------------------------* 05910000
059200*    DB2 AREA FOR RECEIVER TABLE                                * 05920000
059300*---------------------------------------------------------------* 05930000
059400     EXEC SQL                                                     05940000
059500          INCLUDE TRECEIV                                         05950000
059600     END-EXEC.                                                    05960000
059700                                                                  05970000
059800/                                                                 05980000
059900*---------------------------------------------------------------* 05990000
060000*    DB2 AREA FOR PO STATUS CODE TABLE                          * 06000000
060100*---------------------------------------------------------------* 06010000
060200     EXEC SQL                                                     06020000
060300          INCLUDE TSTATCD                                         06030000
060400     END-EXEC.                                                    06040000
060500                                                                  06050000
060600/                                                                 06060000
060700*---------------------------------------------------------------* 06070000
060800*    DB2 AREA FOR PO SHIPMENT TABLE                             * 06080000
060900*---------------------------------------------------------------* 06090000
061000     EXEC SQL                                                     06100000
061100          INCLUDE TSHPTPO                                         06110000
061200     END-EXEC.                                                    06120000
061300                                                                  06130000
061400/                                                                 06140000
061500*---------------------------------------------------------------* 06150000
061600*    DB2 AREA FOR SHIPMENT TABLE                                * 06160000
061700*---------------------------------------------------------------* 06170000
061800     EXEC SQL                                                     06180000
061900          INCLUDE TSHIPMT                                         06190000
062000     END-EXEC.                                                    06200000
062100                                                                  06210000
062200/                                                                 06220000
062300*---------------------------------------------------------------* 06230000
062400*    DB2 AREA FOR COMMUNICATIONS                                * 06240000
062500*---------------------------------------------------------------* 06250000
062600     EXEC SQL                                                     06260000
062700          INCLUDE SQLCA                                           06270000
062800     END-EXEC.                                                    06280000
062900                                                                  06290000
063000/                                                                 06300000
063100*----------------------------------------------------------------*06310000
063200*    DB2 AREA FOR OPERATION SET TABLE                            *06320000
063300*----------------------------------------------------------------*06330000
063400                                                                  06340000
063500     EXEC SQL                                                     06350000
063600          INCLUDE TOPRSET                                         06360000
063700     END-EXEC.                                                    06370000
063800                                                                  06380000
063900/                                                                 06390000
064000*----------------------------------------------------------------*06400000
064100*    DB2 AREA FOR WORK ORDER TABLE                               *06410000
064200*----------------------------------------------------------------*06420000
064300                                                                  06430000
064400     EXEC SQL                                                     06440000
064500          INCLUDE TWRKORD                                         06450000
064600     END-EXEC.                                                    06460000
064700                                                                  06470000
064800/                                                                 06480000
064900*----------------------------------------------------------------*06490000
065000*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                06500000
065100*----------------------------------------------------------------*06510000
065200     EXEC SQL                                                     06520000
065300          INCLUDE TTRBNTF                                         06530000
065400     END-EXEC.                                                    06540000
065500                                                                  06550000
065600/                                                                 06560000
065700*----------------------------------------------------------------*06570000
065800*    DB2 DCLGEN FOR THE XLT_LOC TABLE                             06580000
065900*----------------------------------------------------------------*06590000
066000     EXEC SQL                                                     06600000
066100          INCLUDE XLT00010                                        06610000
066200     END-EXEC.                                                    06620000
066300                                                                  06630000
066400/                                                                 06640000
066500*----------------------------------------------------------------*06650000
066600*    DB2 DCLGEN FOR THE RECEIPT DISTRIBUTION AUDIT TABLE          06660000
066700*----------------------------------------------------------------*06670000
066800     EXEC SQL                                                     06680000
066900          INCLUDE TAURECD                                         06690000
067000     END-EXEC.                                                    06700000
067100                                                                  06710000
067200/                                                                 06720000
067300*---------------------------------------------------------------* 06730000
067400*  CURSOR TO SELECT RECEIVERS                                   * 06740000
067500*---------------------------------------------------------------* 06750000
067600                                                                  06760000
067700     EXEC SQL                                                     06770000
067800          DECLARE RCVR-CSR CURSOR FOR                             06780000
067900          SELECT DISTINCT                                         06790000
068000                 A.REC_SEQ_NBR                                    06800000
068100                ,CHAR(DATE(A.REC_TMST),ISO)                       06810000
068200                ,A.OPER_UNT_ID                                    06820000
068300                ,A.FCLTY_ID                                       06830000
068400                ,A.STATUS_CDE                                     06840000
068500                ,A.ACTL_CART_CNT                                  06850000
068600                ,A.EXPTED_CART_CNT                                06860000
068700                ,A.REC_TYP_CDE                                    06870000
068800                ,B.STATUS_DESC                                    06880000
068900                ,A.EXPTED_CART_CNT                                06890000
069000                ,A.EXPTED_ITM_QTY                                 06900000
069100                ,A.CURR_OPER_UNT_ID                               06910000
069200                ,A.CURR_FCLTY_ID                                  06920000
069300          FROM   TRECEIV A                                        06930000
069400                ,TSTATCD B                                        06940000
069500          WHERE A.ORD_NBR = :DK-PO-NBR                            06950000
069600            AND A.REC_SEQ_NBR BETWEEN :DK-REC-SEQ-NBR-B           06960000
069700                                  AND :DK-REC-SEQ-NBR-E           06970000
069800            AND A.OPER_UNT_ID BETWEEN :DK-OPER-UNT-ID-B           06980000
069900                                  AND :DK-OPER-UNT-ID-E           06990000
070000            AND A.FCLTY_ID    BETWEEN :DK-FCLTY-ID-B              07000000
070100                                  AND :DK-FCLTY-ID-E              07010000
070200            AND A.VER_STATUS_CDE = 'A'                            07020000
070300            AND B.STATUS_TYP_CDE = 'R'                            07030000
070400            AND A.STATUS_CDE = B.STATUS_CDE                       07040000
070500          ORDER BY 2 DESC                                         07050000
070600     END-EXEC.                                                    07060000
070700                                                                  07070000
070800/                                                                 07080000
070900 LINKAGE SECTION.                                                 07090000
071000                                                                  07100000
071100 01  DFHCOMMAREA.                                                 07110000
071200     05  FILLER                         OCCURS  1 TO 4072 TIMES   07120000
071300                                        DEPENDING ON EIBCALEN.    07130000
071400         10  FILLER                     PIC X.                    07140000
071500                                                                  07150000
071600/                                                                 07160000
071700 PROCEDURE DIVISION.                                              07170000
071800*---------------------------------------------------------------* 07180000
071900*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 07190000
072000*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 07200000
072100*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 07210000
072200*---------------------------------------------------------------* 07220000
072300 0000-MAIN-MODULE.                                                07230000
072400                                                                  07240000
072500     INITIALIZE DP030-CICS-API-FIELDS.                            07250000
072600                                                                  07260000
072700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07270000
072800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07280000
072900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07290000
073000                                                                  07300000
073100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07310000
073200                                                                  07320000
073300     MOVE LENGTH OF RC222AI        TO DP030-MAP-LENGTH (1).       07330000
073400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07340000
073500     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       07350000
073600                                                                  07360000
073700     PERFORM 0001-CALL-CICS-ARCH-API.                             07370000
073800     PERFORM 1000-CONTROL-PROCESSING                              07380000
073900                                                                  07390000
074000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07400000
074100     PERFORM 0001-CALL-CICS-ARCH-API.                             07410000
074200                                                                  07420000
074300*---------------------------------------------------------------* 07430000
074400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 07440000
074500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 07450000
074600*---------------------------------------------------------------* 07460000
074700 0001-CALL-CICS-ARCH-API.                                         07470000
074810     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07481006
074900                                    DFHCOMMAREA                   07490006
075000                                    DP030-CICS-API-FIELDS         07500006
075100                                    DP020-STANDARD-COMMAREA       07510006
075200                                    RC222AI.                      07520006
075300                                                                  07530000
075400     IF DP030-RC-CALL-SUCCESSFUL OR                               07540000
075500        DP030-RC-APPL-ERROR                                       07550000
075600         CONTINUE                                                 07560000
075700     ELSE                                                         07570000
075800         SET DP013-NO-ROLLBACK                                    07580000
075900             DP013-XCTL-DISPLAY-RESTART                           07590000
076000             DP013-CICS-ABEND      TO TRUE                        07600000
076100         MOVE '0001-CALL-CICS-ARCH-API'                           07610000
076200                                   TO DP013-PARAGRAPH             07620000
076210         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O07621006
076220-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07622006
076500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07650000
076600         PERFORM DP013-0000-PROCESS-ABEND                         07660000
076700     END-IF.                                                      07670000
076800                                                                  07680000
076900*----------------------------------------------------------------*07690000
077000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07700000
077100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07710000
077200*                                                                *07720000
077300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07730000
077400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07740000
077500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07750000
077600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07760000
077700*----------------------------------------------------------------*07770000
077800                                                                  07780000
077900 1000-CONTROL-PROCESSING.                                         07790000
078000                                                                  07800000
078100     EVALUATE TRUE                                                07810000
078200         WHEN DP030-RC-APPL-ERROR                                 07820000
078300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         07830000
078400             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                07840000
078500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07850000
078600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07860000
078700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07870000
078800                                                                  07880000
078900         WHEN DP020-NEXT-ACT-INITIAL                              07890000
079000             INITIALIZE ASC-SPECIFIC-COMMAREA                     07900000
079100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07910000
079200                                      ASC-SEL-TERM-ID             07920000
079300                                      ASC-SEL-TERM-ID-2           07930000
079400             MOVE DP020-SRC-TASK-NUMBER                           07940000
079500                                   TO ASC-LIST-TASK-NUMBER        07950000
079600                                      ASC-SEL-TASK-NUMBER         07960000
079700                                      ASC-SEL-TASK-NUMBER-2       07970000
079800             MOVE PC-LIST-QUEUE-SEQ                               07980000
079900                                   TO ASC-LIST-SEQ                07990000
080000             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 08000000
080100                                      ASC-SEL-SEQ-2               08010000
080200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 08020000
080300             IF  PS-COMMAREA-NOT-VALID                            08030000
080400                 SET DP020-NEXT-ACT-APPL-ERROR                    08040000
080500                                   TO TRUE                        08050000
080600             ELSE                                                 08060000
080700                 PERFORM 4000-BUILD-INITIAL-PANEL                 08070000
080800             END-IF                                               08080000
080900                                                                  08090000
081000         WHEN DP020-NEXT-ACT-READ-MAP                             08100000
081100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08110000
081200                                   TO PV-TOP-ITEM                 08120000
081300             PERFORM 2000-PROCESS-PANEL                           08130000
081400                                                                  08140000
081500         WHEN DP020-NEXT-ACT-RETURN                               08150000
081600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08160000
081700                                   TO PV-TOP-ITEM                 08170000
081800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08180000
081900                                                                  08190000
082000             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 08200000
082100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08210000
082200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08220000
082300                                                                  08230000
082400         WHEN OTHER                                               08240000
082500             SET DP013-LOGIC-ABEND TO TRUE                        08250000
082600             SET DP013-NO-ROLLBACK TO TRUE                        08260000
082700             MOVE '1000-CONTROL-PROCESSING'                       08270000
082800                                   TO DP013-PARAGRAPH             08280000
082900             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08290000
083000                                   TO DP013-MESSAGE-TEXT(1)       08300000
083100             PERFORM DP013-0000-PROCESS-ABEND                     08310000
083200     END-EVALUATE.                                                08320000
083300                                                                  08330000
083400/                                                                 08340000
083500*----------------------------------------------------------------*08350000
083600* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *08360000
083700*----------------------------------------------------------------*08370000
083800                                                                  08380000
083900 1100-PROCESS-INTER-APPL-COMM.                                    08390000
084000                                                                  08400000
084100     SET PS-COMMAREA-VALID         TO TRUE.                       08410000
084200     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08420000
084300                                                                  08430000
084400     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          08440000
084500         MOVE RC012-OPER-UNT-ID    TO ASC-KEY-OPER-UNT-ID         08450000
084600         MOVE RC012-FCLTY-ID       TO ASC-KEY-FCLTY-ID            08460000
084700         MOVE RC012-PO-NBR         TO ASC-KEY-PO-NBR              08470000
084800         MOVE RC012-REC-SEQ-NBR    TO ASC-KEY-REC-SEQ-NBR         08480000
084900     ELSE                                                         08490000
085000         IF  DP020-INT-APPL-FORMAT-IND = PC-RCVR-PO-LIST          08500000
085100             IF  RC015-NUMBER-OF-SELECTED-ITEMS > ZERO            08510000
085200                 SET ASC-USE-SELECTION-QUEUE                      08520000
085300                                   TO TRUE                        08530000
085400                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              08540000
085500                                   TO ASC-NUMBER-OF-SELECTED-ITEMS08550000
085600                 MOVE RC015-NUMBER-OF-TS-ITEMS                    08560000
085700                                   TO ASC-NUMBER-OF-TS-ITEMS      08570000
085800                 MOVE RC015-SEL-QUEUE-NAME                        08580000
085900                                   TO ASC-SEL-QUEUE-NAME-IN       08590000
086000                 PERFORM 1120-PREPARE-LIST-ENTRY                  08600000
086100                 IF  ASC-KEY-OPER-UNT-ID = ZEROES                 08610000
086200                 AND ASC-KEY-FCLTY-ID    = ZEROES                 08620000
086300                     MOVE RC015-OPER-UNT-ID                       08630000
086400                                   TO ASC-KEY-OPER-UNT-ID         08640000
086500                     MOVE RC015-FCLTY-ID                          08650000
086600                                   TO ASC-KEY-FCLTY-ID            08660000
086700                 END-IF                                           08670000
086800             ELSE                                                 08680000
086900                 SET DP030-OVERRIDE-GO                            08690000
087000                                   TO TRUE                        08700000
087100                 MOVE PC-TSYMSG-00057                             08710000
087200                                   TO DP020-MSG-NUMBER            08720000
087300                 SET DP020-MSG-WARNING                            08730000
087400                     DP020-NEXT-ACT-APPL-ERROR                    08740000
087500                                   TO TRUE                        08750000
087600             END-IF                                               08760000
087700         END-IF                                                   08770000
087800     END-IF.                                                      08780000
087900                                                                  08790000
088000*----------------------------------------------------------------*08800000
088100*    ENTRY IS FROM A LIST.  GET THE RECEIVER NUMBER FROM THE     *08810000
088200*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *08820000
088300*----------------------------------------------------------------*08830000
088400 1120-PREPARE-LIST-ENTRY.                                         08840000
088500                                                                  08850000
088600     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                08860000
088700     MOVE ZERO                     TO ASC-SEL-ITEM.               08870000
088800     PERFORM 2160-GET-NEXT-RECORD.                                08880000
088900                                                                  08890000
089000                                                                  08900000
089100/                                                                 08910000
089200*----------------------------------------------------------------*08920000
089300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08930000
089400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08940000
089500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08950000
089600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08960000
089700* FUNCTION KEYS CAN GET THIS FAR.                                *08970000
089800*----------------------------------------------------------------*08980000
089900                                                                  08990000
090000 2000-PROCESS-PANEL.                                              09000000
090100     EVALUATE TRUE                                                09010000
090200         WHEN DP020-SRC-AID = DP016-CLEAR                         09020000
090300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09030000
090400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09040000
090500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09050000
090600                                                                  09060000
090700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    09070000
090800             PERFORM 2050-DELETE-LIST-QUEUE                       09080000
090900             PERFORM 4000-BUILD-INITIAL-PANEL                     09090000
091000                                                                  09100000
091100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    09110000
091200             PERFORM 2140-DESELECT-ALL-ITEMS                      09120000
091300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09130000
091400                                                                  09140000
091500         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 09150000
091600              PERFORM 2150-SELECT-ALL-ITEMS                       09160000
091700              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                09170000
091800                                                                  09180000
091900         WHEN OTHER                                               09190000
092000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 09200000
092100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09210000
092200             IF  PS-NO-ERROR                                      09220000
092300                 SET DP030-CONTINUE-GO TO TRUE                    09230000
092400                 PERFORM 2100-CHECK-FUNCTION-KEY                  09240000
092500             ELSE                                                 09250000
092600                 SET DP030-OVERRIDE-GO TO TRUE                    09260000
092700             END-IF                                               09270000
092800     END-EVALUATE.                                                09280000
092900                                                                  09290000
093000/                                                                 09300000
093100*----------------------------------------------------------------*09310000
093200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *09320000
093300*----------------------------------------------------------------*09330000
093400 2050-DELETE-LIST-QUEUE.                                          09340000
093500                                                                  09350000
093600     EXEC CICS                                                    09360000
093700         DELETEQ TS                                               09370000
093800           QUEUE (ASC-LIST-QUEUE-NAME)                            09380000
093900            RESP (PV-CICS-RESP)                                   09390000
094000     END-EXEC.                                                    09400000
094100                                                                  09410000
094200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09420000
094300        (PV-CICS-RESP = DFHRESP(QIDERR))                          09430000
094400         CONTINUE                                                 09440000
094500     ELSE                                                         09450000
094600         SET DP013-CICS-ABEND      TO TRUE                        09460000
094700         SET DP013-NO-ROLLBACK     TO TRUE                        09470000
094800                                                                  09480000
094900         MOVE '2050-DELETE-LIST-QUEUE'                            09490000
095000                                   TO DP013-PARAGRAPH             09500000
095100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09510000
095200                                   TO DP013-MESSAGE-TEXT (1)      09520000
095300         PERFORM DP013-0000-PROCESS-ABEND                         09530000
095400     END-IF.                                                      09540000
095500                                                                  09550000
095600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09560000
095700                                                                  09570000
095800/                                                                 09580000
095900*----------------------------------------------------------------*09590000
096000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09600000
096100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09610000
096200* CICS ARCHITECTURE API.                                         *09620000
096300*----------------------------------------------------------------*09630000
096400 2100-CHECK-FUNCTION-KEY.                                         09640000
096500                                                                  09650000
096600     EVALUATE TRUE                                                09660000
096700         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09670000
096800             INITIALIZE PO017-INTER-APPL-COMMAREA                 09680000
096900             MOVE ASC-KEY-PO-NBR TO PO017-PO-NBR                  09690000
097000             MOVE ASC-ENT-NAME-DESC TO PO017-ENT-NAME-DESC        09700000
097100         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09710000
097200             INITIALIZE RC015-INTER-APPL-COMMAREA                 09720000
097300             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    09730000
097400                            TO RC015-NUMBER-OF-SELECTED-ITEMS     09740000
097500             MOVE ASC-KEY-OPER-UNT-ID                             09750000
097600                            TO RC015-OPER-UNT-ID                  09760000
097700             MOVE ASC-KEY-FCLTY-ID                                09770000
097800                            TO RC015-FCLTY-ID                     09780000
097900             MOVE ASC-KEY-PO-NBR                                  09790000
098000                            TO RC015-PO-NBR                       09800000
098100             MOVE ASC-KEY-REC-SEQ-NBR                             09810000
098200                            TO RC015-REC-SEQ-NBR                  09820000
098300             PERFORM 5000-PREPARE-SEL-QUEUE                       09830000
098400             IF ASC-NUMBER-OF-SELECTED-ITEMS > +0                 09840000
098500                 PERFORM 7000-FORMAT-COMMAREA                     09850000
098600             END-IF                                               09860000
098700                                                                  09870000
098800*F19 SU-OUTBOUND PO LINE LIST (SUKCS598)                          09880000
098900         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              09890000
099000             SET ASC-FUNC03-RETURN-YES TO TRUE                    09900000
099100             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              09910000
099200                 INITIALIZE SU009-INTER-APPL-COMMAREA             09920000
099300                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                09930000
099400                           TO SU009-NUMBER-OF-SELECTED-ITEMS      09940000
099500                 MOVE ASC-KEY-OPER-UNT-ID                         09950000
099600                                  TO SU009-OPER-UNT-ID            09960000
099700                 PERFORM 5000A-PREPARE-SEL-QUEUE                  09970000
099800             ELSE                                                 09980000
099900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09990000
100000                 SET DP030-OVERRIDE-GO TO TRUE                    10000000
100100                 MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER         10010000
100200                 SET DP020-MSG-WARNING TO TRUE                    10020000
100300             END-IF                                               10030000
100400                                                                  10040000
100500         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  10050000
100600             INITIALIZE RC015-INTER-APPL-COMMAREA                 10060000
100700             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    10070000
100800                            TO RC015-NUMBER-OF-SELECTED-ITEMS     10080000
100900             MOVE ASC-KEY-OPER-UNT-ID                             10090000
101000                                TO RC015-OPER-UNT-ID              10100000
101100             MOVE ASC-KEY-FCLTY-ID                                10110000
101200                                TO RC015-FCLTY-ID                 10120000
101300             MOVE ASC-KEY-PO-NBR TO RC015-PO-NBR                  10130000
101400             MOVE ASC-KEY-REC-SEQ-NBR TO RC015-REC-SEQ-NBR        10140000
101500             PERFORM 5000-PREPARE-SEL-QUEUE                       10150000
101600             IF  ASC-NUMBER-OF-SELECTED-ITEMS > +0                10160000
101700                 PERFORM 7000-FORMAT-COMMAREA                     10170000
101800             END-IF                                               10180000
101900                                                                  10190000
102000                                                                  10200000
102100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10210000
102200             MOVE +1               TO PV-TOP-ITEM                 10220000
102300             PERFORM 3200-RESET-ATTRIBUTES                        10230000
102400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10240000
102500                                                                  10250000
102600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10260000
102700             PERFORM 2110-BROWSE-BACKWARD                         10270000
102800             PERFORM 3200-RESET-ATTRIBUTES                        10280000
102900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10290000
103000                                                                  10300000
103100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10310000
103200             PERFORM 2120-BROWSE-FORWARD                          10320000
103300             PERFORM 3200-RESET-ATTRIBUTES                        10330000
103400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10340000
103500                                                                  10350000
103600         WHEN DP020-SRC-AID = DP016-ENTER                         10360000
103700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10370000
103800             IF  PS-ERROR                                         10380000
103900                 CONTINUE                                         10390000
104000             ELSE                                                 10400000
104100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10410000
104200             END-IF                                               10420000
104300                                                                  10430000
104400         WHEN OTHER                                               10440000
104500             SET DP013-NO-ROLLBACK                                10450000
104600                 DP013-XCTL-DISPLAY-RESTART                       10460000
104700                 DP013-CICS-ABEND  TO TRUE                        10470000
104800             MOVE '2100-CHECK-FUNCTION-KEY'                       10480000
104900                                   TO DP013-PARAGRAPH             10490000
105000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10500000
105100                                   TO DP013-MESSAGE-TEXT (1)      10510000
105200             PERFORM DP013-0000-PROCESS-ABEND                     10520000
105300     END-EVALUATE.                                                10530000
105400                                                                  10540000
105500/                                                                 10550000
105600*----------------------------------------------------------------*10560000
105700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10570000
105800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10580000
105900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10590000
106000*    MESSAGE.                                                    *10600000
106100*----------------------------------------------------------------*10610000
106200                                                                  10620000
106300 2110-BROWSE-BACKWARD.                                            10630000
106400                                                                  10640000
106500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10650000
106600         GIVING PV-TOP-ITEM.                                      10660000
106700                                                                  10670000
106800     IF  ((PV-TOP-ITEM < +1)                                      10680000
106900       OR (PV-TOP-ITEM = +1))                                     10690000
107000         MOVE +1                   TO PV-TOP-ITEM                 10700000
107100*        -- TOP OF LIST --                                        10710000
107200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            10720000
107300         SET DP020-MSG-INFORMATIONAL                              10730000
107400                                   TO TRUE                        10740000
107500     END-IF.                                                      10750000
107600                                                                  10760000
107700/                                                                 10770000
107800*----------------------------------------------------------------*10780000
107900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *10790000
108000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *10800000
108100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *10810000
108200*----------------------------------------------------------------*10820000
108300                                                                  10830000
108400 2120-BROWSE-FORWARD.                                             10840000
108500                                                                  10850000
108600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              10860000
108700         GIVING PV-TOP-ITEM.                                      10870000
108800                                                                  10880000
108900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   10890000
109000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            10900000
109100                                   TO PV-TOP-ITEM                 10910000
109200*        -- BOTTOM OF LIST --                                     10920000
109300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            10930000
109400         SET DP020-MSG-INFORMATIONAL                              10940000
109500                                   TO TRUE                        10950000
109600     ELSE                                                         10960000
109700         COMPUTE PV-BOTTOM-ITEM =                                 10970000
109800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 10980000
109900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            10990000
110000*            -- BOTTOM OF LIST --                                 11000000
110100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11010000
110200             SET DP020-MSG-INFORMATIONAL                          11020000
110300                                   TO TRUE                        11030000
110400         END-IF                                                   11040000
110500     END-IF.                                                      11050000
110600                                                                  11060000
110700/                                                                 11070000
110800*----------------------------------------------------------------*11080000
110900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11090000
111000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11100000
111100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11110000
111200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11120000
111300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11130000
111400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11140000
111500*----------------------------------------------------------------*11150000
111600                                                                  11160000
111700 2130-CHECK-FOR-JUMP-BROWSE.                                      11170000
111800                                                                  11180000
111900     SET PS-NO-ERROR               TO TRUE.                       11190000
112000     IF (ASC-START-ITEM-REQUEST = SPACE)                          11200000
112100         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            11210000
112200                                   TO PV-TOP-ITEM                 11220000
112300     ELSE                                                         11230000
112400         MOVE ASC-START-ITEM-REQUEST                              11240000
112500                                   TO DP010I-UNEDITED-FIELD       11250000
112600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11260000
112700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11270000
112800         SET DP010I-NEGATIVE-NOT-ALLOWED                          11280000
112900                                   TO TRUE                        11290000
113010         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11301005
113020              USING DP010I-NUMERIC-EDIT-AREA                      11302005
113100                                                                  11310000
113200         IF  NOT DP010I-ERROR-DETECTED                            11320000
113300             MOVE DP010I-NUMERIC-FIELD                            11330000
113400                                   TO ASC-START-ITEM-REQUEST-N    11340000
113500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11350000
113600                 IF  ASC-START-ITEM-REQUEST-N >                   11360000
113700                                          ASC-NUMBER-OF-ITEMS-READ11370000
113800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11380000
113900                     COMPUTE PV-TOP-ITEM =                        11390000
114000                             ASC-NUMBER-OF-ITEMS-READ             11400000
114100                             - PC-ITEMS-PER-PANEL + 1             11410000
114200                     IF  PV-TOP-ITEM < +1                         11420000
114300                         MOVE +1   TO PV-TOP-ITEM                 11430000
114400                         MOVE PC-TSYMSG-00070                     11440000
114500                                   TO DP020-MSG-NUMBER            11450000
114600                         SET DP020-MSG-INFORMATIONAL              11460000
114700                                   TO TRUE                        11470000
114800                     END-IF                                       11480000
114900                 ELSE                                             11490000
115000                     MOVE ASC-START-ITEM-REQUEST-N                11500000
115100                                   TO PV-TOP-ITEM                 11510000
115200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11520000
115300                     COMPUTE PV-BOTTOM-ITEM =                     11530000
115400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11540000
115500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11550000
115600*                        -- BOTTOM OF LIST --                     11560000
115700                         MOVE PC-TSYMSG-00070                     11570000
115800                                   TO DP020-MSG-NUMBER            11580000
115900                         SET DP020-MSG-INFORMATIONAL              11590000
116000                                   TO TRUE                        11600000
116100                     END-IF                                       11610000
116200                 END-IF                                           11620000
116300             ELSE                                                 11630000
116400*                --- VALUE OUT OF RANGE ----                      11640000
116500                 MOVE PC-TSYMSG-00101                             11650000
116600                                   TO DP020-MSG-NUMBER            11660000
116700                 MOVE -1           TO ASTRTITL                    11670000
116800                 SET DP030-SET-CURSOR-APPL-1                      11680000
116900                                   TO TRUE                        11690000
117000                 MOVE DP015-REVERSE                               11700000
117100                                   TO ASTRTITH                    11710000
117200                 MOVE DP015-RED    TO ASTRTITC                    11720000
117300                 MOVE DP015-UNP-NUM-BRT-MDT                       11730000
117400                                   TO ASTRTITA                    11740000
117500                 SET DP020-MSG-FATAL                              11750000
117600                                   TO TRUE                        11760000
117700                 SET PS-ERROR      TO TRUE                        11770000
117800             END-IF                                               11780000
117900                                                                  11790000
118000         ELSE                                                     11800000
118100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11810000
118200             MOVE -1               TO ASTRTITL                    11820000
118300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11830000
118400             MOVE DP015-REVERSE    TO ASTRTITH                    11840000
118500             MOVE DP015-RED        TO ASTRTITC                    11850000
118600             MOVE DP015-UNP-NUM-BRT-MDT                           11860000
118700                                   TO ASTRTITA                    11870000
118800             SET DP020-MSG-FATAL   TO TRUE                        11880000
118900             SET PS-ERROR          TO TRUE                        11890000
119000         END-IF                                                   11900000
119100     END-IF.                                                      11910000
119200                                                                  11920000
119300/                                                                 11930000
119400*----------------------------------------------------------------*11940000
119500*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11950000
119600*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11960000
119700*----------------------------------------------------------------*11970000
119800 2140-DESELECT-ALL-ITEMS.                                         11980000
119900                                                                  11990000
120000     MOVE +1                       TO ASC-BLK-SUB.                12000000
120100                                                                  12010000
120200     PERFORM 2141-CLEAR-SELECTED-INDS                             12020000
120300         VARYING ASC-ITEM-SUB                                     12030000
120400         FROM 1 BY 1                                              12040000
120500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12050000
120600                                                                  12060000
120700     ADD +1                        TO ASC-BLK-SUB.                12070000
120800                                                                  12080000
120900     PERFORM 2141-CLEAR-SELECTED-INDS                             12090000
121000         VARYING ASC-ITEM-SUB                                     12100000
121100         FROM 1 BY 1                                              12110000
121200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12120000
121300                                                                  12130000
121400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12140000
121500                                   TO PV-LIST-ITEM-NUMBER.        12150000
121600                                                                  12160000
121700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12170000
121800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12180000
121900                                                                  12190000
122000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12200000
122100        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12210000
122200         MOVE +1                   TO ASC-BLK-SUB                 12220000
122300                                                                  12230000
122400         PERFORM 5100-WRITE-TEMP-STORAGE                          12240000
122500                                                                  12250000
122600         MOVE +1                   TO PV-BLOCK-NUMBER             12260000
122700                                                                  12270000
122800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12280000
122900             PV-FIRST-BLOCK-IN-ARRAY - 1                          12290000
123000                                                                  12300000
123100         PERFORM                                                  12310000
123200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12320000
123300                                                                  12330000
123400             PERFORM 4410-READ-TEMP-STORAGE                       12340000
123500                                                                  12350000
123600             PERFORM 2141-CLEAR-SELECTED-INDS                     12360000
123700                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12370000
123800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12380000
123900                                                                  12390000
124000             PERFORM 5100-WRITE-TEMP-STORAGE                      12400000
124100                                                                  12410000
124200             ADD +1                TO PV-BLOCK-NUMBER             12420000
124300                                                                  12430000
124400         END-PERFORM                                              12440000
124500                                                                  12450000
124600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12460000
124700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12470000
124800                                                                  12480000
124900         PERFORM                                                  12490000
125000             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12500000
125100                   ASC-HIGHEST-BLOCK-WRITTEN                      12510000
125200                                                                  12520000
125300             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12530000
125400                                   TO PV-BLOCK-NUMBER             12540000
125500                                                                  12550000
125600             PERFORM 4410-READ-TEMP-STORAGE                       12560000
125700                                                                  12570000
125800             PERFORM 2141-CLEAR-SELECTED-INDS                     12580000
125900                 VARYING ASC-ITEM-SUB                             12590000
126000                 FROM 1 BY 1                                      12600000
126100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12610000
126200                                                                  12620000
126300             PERFORM 5100-WRITE-TEMP-STORAGE                      12630000
126400                                                                  12640000
126500             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12650000
126600                                                                  12660000
126700         END-PERFORM                                              12670000
126800                                                                  12680000
126900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12690000
127000                                   TO PV-BLOCK-NUMBER             12700000
127100                                                                  12710000
127200         PERFORM 4410-READ-TEMP-STORAGE                           12720000
127300     END-IF.                                                      12730000
127400                                                                  12740000
127500                                                                  12750000
127600     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.12760000
127700     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 12770000
127800     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   12780000
127900                                                                  12790000
128000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12800000
128100                                                                  12810000
128200/                                                                 12820000
128300*----------------------------------------------------------------*12830000
128400*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12840000
128500*----------------------------------------------------------------*12850000
128600                                                                  12860000
128700 2141-CLEAR-SELECTED-INDS.                                        12870000
128800                                                                  12880000
128900     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          12890000
129000             NOT EQUAL ZERO                                       12900000
129100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12910000
129200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12920000
129300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12930000
129400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12940000
129500                                   TO TRUE                        12950000
129600         END-IF                                                   12960000
129700     END-IF.                                                      12970000
129800                                                                  12980000
129900/                                                                 12990000
130000*----------------------------------------------------------------*13000000
130100*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *13010000
130200*  FOR ALL ITEMS.                                                *13020000
130300*----------------------------------------------------------------*13030000
130400                                                                  13040000
130500 2150-SELECT-ALL-ITEMS.                                           13050000
130600                                                                  13060000
130700     MOVE +1                       TO ASC-BLK-SUB.                13070000
130800                                                                  13080000
130900     PERFORM 2151-SET-SELECTED-INDS                               13090000
131000         VARYING ASC-ITEM-SUB                                     13100000
131100         FROM 1 BY 1                                              13110000
131200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13120000
131300                                                                  13130000
131400     ADD +1                        TO ASC-BLK-SUB.                13140000
131500                                                                  13150000
131600     PERFORM 2151-SET-SELECTED-INDS                               13160000
131700         VARYING ASC-ITEM-SUB                                     13170000
131800         FROM 1 BY 1                                              13180000
131900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13190000
132000                                                                  13200000
132100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13210000
132200                                   TO PV-LIST-ITEM-NUMBER.        13220000
132300                                                                  13230000
132400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13240000
132500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13250000
132600                                                                  13260000
132700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13270000
132800        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13280000
132900         MOVE +1                   TO ASC-BLK-SUB                 13290000
133000                                                                  13300000
133100         PERFORM 5100-WRITE-TEMP-STORAGE                          13310000
133200                                                                  13320000
133300         MOVE +1                   TO PV-BLOCK-NUMBER             13330000
133400                                                                  13340000
133500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13350000
133600             PV-FIRST-BLOCK-IN-ARRAY - 1                          13360000
133700                                                                  13370000
133800         PERFORM                                                  13380000
133900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13390000
134000                                                                  13400000
134100             PERFORM 4410-READ-TEMP-STORAGE                       13410000
134200                                                                  13420000
134300             PERFORM 2151-SET-SELECTED-INDS                       13430000
134400                 VARYING ASC-ITEM-SUB                             13440000
134500                 FROM 1 BY 1                                      13450000
134600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13460000
134700                                                                  13470000
134800             PERFORM 5100-WRITE-TEMP-STORAGE                      13480000
134900                                                                  13490000
135000             ADD +1                TO PV-BLOCK-NUMBER             13500000
135100         END-PERFORM                                              13510000
135200                                                                  13520000
135300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13530000
135400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13540000
135500                                                                  13550000
135600         PERFORM                                                  13560000
135700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13570000
135800                   ASC-HIGHEST-BLOCK-WRITTEN                      13580000
135900                                                                  13590000
136000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13600000
136100                                   TO PV-BLOCK-NUMBER             13610000
136200                                                                  13620000
136300             PERFORM 4410-READ-TEMP-STORAGE                       13630000
136400                                                                  13640000
136500             PERFORM 2151-SET-SELECTED-INDS                       13650000
136600                 VARYING ASC-ITEM-SUB                             13660000
136700                 FROM 1 BY 1                                      13670000
136800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13680000
136900                                                                  13690000
137000             PERFORM 5100-WRITE-TEMP-STORAGE                      13700000
137100                                                                  13710000
137200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13720000
137300         END-PERFORM                                              13730000
137400                                                                  13740000
137500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13750000
137600                                   TO PV-BLOCK-NUMBER             13760000
137700                                                                  13770000
137800         PERFORM 4410-READ-TEMP-STORAGE                           13780000
137900     END-IF.                                                      13790000
138000                                                                  13800000
138100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13810000
138200          ASC-NUMBER-OF-SELECTED-ITEMS.                           13820000
138300                                                                  13830000
138400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13840000
138500                                                                  13850000
138600/                                                                 13860000
138700*----------------------------------------------------------------*13870000
138800*    MARK EACH ITEM AS BEING SELECTED.                           *13880000
138900*----------------------------------------------------------------*13890000
139000                                                                  13900000
139100 2151-SET-SELECTED-INDS.                                          13910000
139200                                                                  13920000
139300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           13930000
139400             NOT EQUAL ZERO                                       13940000
139500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13950000
139600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             13960000
139700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        13970000
139800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  13980000
139900                                   TO TRUE                        13990000
140000         END-IF                                                   14000000
140100     END-IF.                                                      14010000
140200                                                                  14020000
140300/                                                                 14030000
140400*----------------------------------------------------------------*14040000
140500*    GET THE RECEIVER NUMBER (KEY) OF THE NEXT SELECTED OBJECT   *14050000
140600*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *14060000
140700*----------------------------------------------------------------*14070000
140800 2160-GET-NEXT-RECORD.                                            14080000
140900                                                                  14090000
141000     ADD +1                        TO ASC-SEL-SUB.                14100000
141100     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            14110000
141200         ADD +1                    TO ASC-SEL-ITEM                14120000
141300         MOVE +1                   TO ASC-SEL-SUB                 14130000
141400     END-IF.                                                      14140000
141500                                                                  14150000
141600     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                14160000
141700         PERFORM 9100-READ-SEL-QUEUE                              14170000
141800         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      14180000
141900             MOVE RC013-PO-NBR (ASC-SEL-SUB)                      14190000
142000                                   TO ASC-KEY-PO-NBR              14200000
142100             MOVE ZERO             TO ASC-KEY-REC-SEQ-NBR         14210000
142200             MOVE RC013-OPER-UNT-ID (ASC-SEL-SUB)                 14220000
142300                                   TO ASC-KEY-OPER-UNT-ID         14230000
142400             MOVE RC013-FCLTY-ID (ASC-SEL-SUB)                    14240000
142500                                   TO ASC-KEY-FCLTY-ID            14250000
142600             SET RC013-INQ (ASC-SEL-SUB)                          14260000
142700                                   TO TRUE                        14270000
142800             PERFORM 9200-REWRITE-LIST-QUEUE                      14280000
142900         ELSE                                                     14290000
143000             SUBTRACT +1 FROM ASC-SEL-SUB                         14300000
143100*            --- BOTTOM OF LIST ---                               14310000
143200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14320000
143300             SET DP020-MSG-INFORMATIONAL                          14330000
143400                                   TO TRUE                        14340000
143500         END-IF                                                   14350000
143600     ELSE                                                         14360000
143700         SUBTRACT +1 FROM ASC-SEL-ITEM                            14370000
143800         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 14380000
143900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14390000
144000         SET DP020-MSG-INFORMATIONAL                              14400000
144100                                   TO TRUE                        14410000
144200     END-IF.                                                      14420000
144300                                                                  14430000
144400                                                                  14440000
144500/                                                                 14450000
144600*----------------------------------------------------------------*14460000
144700*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *14470000
144800*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *14480000
144900*----------------------------------------------------------------*14490000
145000 2200-MOVE-SCREEN-TO-COMMAREA.                                    14500000
145100                                                                  14510000
145200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             14520000
145300     MOVE +1                       TO PV-SUB.                     14530000
145400                                                                  14540000
145500     PERFORM 3100-SET-SUBSCRIPTS.                                 14550000
145600                                                                  14560000
145700     IF  ASTRTITL > ZERO                                          14570000
145800         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      14580000
145900     ELSE                                                         14590000
146000         IF  ASTRTITF = DP015-ERASE-EOF                           14600000
146100             INITIALIZE ASC-START-ITEM-REQUEST                    14610000
146200         END-IF                                                   14620000
146300     END-IF.                                                      14630000
146400                                                                  14640000
146500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14650000
146600         VARYING PV-SUB                                           14660000
146700         FROM 1 BY 1                                              14670000
146800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14680000
146900                                                                  14690000
147000/                                                                 14700000
147100*----------------------------------------------------------------*14710000
147200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *14720000
147300*----------------------------------------------------------------*14730000
147400 2210-MOVE-LINES-TO-COMMAREA.                                     14740000
147500                                                                  14750000
147600     IF  MR-SELECTL (PV-SUB) > ZERO                               14760000
147700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     14770000
147800                                   TO TRUE                        14780000
147900         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        14790000
148000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14800000
148100     ELSE                                                         14810000
148200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14820000
148300             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         14830000
148400             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        14840000
148500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14850000
148600         END-IF                                                   14860000
148700     END-IF.                                                      14870000
148800                                                                  14880000
148900     ADD +1                        TO ASC-ITEM-SUB.               14890000
149000                                                                  14900000
149100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14910000
149200         ADD +1                    TO ASC-BLK-SUB                 14920000
149300         MOVE +1                   TO ASC-ITEM-SUB                14930000
149400     END-IF.                                                      14940000
149500                                                                  14950000
149600/                                                                 14960000
149700*----------------------------------------------------------------*14970000
149800*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *14980000
149900*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *14990000
150000*----------------------------------------------------------------*15000000
150100 3000-EDIT-DATA-IN-COMMAREA.                                      15010000
150200                                                                  15020000
150300     SET PS-NO-ERROR               TO TRUE.                       15030000
150400                                                                  15040000
150500     PERFORM 3200-RESET-ATTRIBUTES.                               15050000
150600                                                                  15060000
150700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     15070000
150800**                                                                15080000
150900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              15090000
151000* EDITTING IS DONE FROM THE BOTTOM UP.                            15100000
151100**                                                                15110000
151200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       15120000
151300         ASC-ITEMS-DISPLAYED - 1.                                 15130000
151400                                                                  15140000
151500     PERFORM 3100-SET-SUBSCRIPTS.                                 15150000
151600     PERFORM 3300-EDIT-SELECTIONS                                 15160000
151700         VARYING PV-SUB                                           15170000
151800         FROM PV-SUB BY -1                                        15180000
151900         UNTIL PV-SUB < +1                                        15190000
152000                                                                  15200000
152100     IF  PS-NO-ERROR                                              15210000
152200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        15220000
152300     END-IF.                                                      15230000
152400                                                                  15240000
152500     IF  ((PS-NO-ERROR)                                           15250000
152600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   15260000
152700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    15270000
152800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  15280000
152900     END-IF.                                                      15290000
153000                                                                  15300000
153100/                                                                 15310000
153200*----------------------------------------------------------------*15320000
153300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *15330000
153400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*15340000
153500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *15350000
153600*                                                                *15360000
153700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *15370000
153800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *15380000
153900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *15390000
154000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *15400000
154100*----------------------------------------------------------------*15410000
154200                                                                  15420000
154300 3100-SET-SUBSCRIPTS.                                             15430000
154400                                                                  15440000
154500     COMPUTE ASC-ITEM-SUB =                                       15450000
154600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        15460000
154700                                                                  15470000
154800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         15480000
154900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            15490000
155000                                                                  15500000
155100         MOVE PC-MAX-BLOCKS-IN-ARRAY                              15510000
155200                                   TO ASC-BLK-SUB                 15520000
155300     ELSE                                                         15530000
155400         MOVE +1                   TO ASC-BLK-SUB                 15540000
155500     END-IF.                                                      15550000
155600                                                                  15560000
155700*----------------------------------------------------------------*15570000
155800*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *15580000
155900*----------------------------------------------------------------*15590000
156000                                                                  15600000
156100 3200-RESET-ATTRIBUTES.                                           15610000
156200                                                                  15620000
156300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   15630000
156400     MOVE DP015-GREEN              TO ASTRTITC.                   15640000
156500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   15650000
156600                                                                  15660000
156700        PERFORM                                                   15670000
156800            VARYING PV-SUB                                        15680000
156900            FROM 1 BY 1                                           15690000
157000            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     15700000
157100            MOVE DP015-UNP-ALP-NOR-OFF                            15710000
157200                                      TO MR-SELECTA (PV-SUB)      15720000
157300            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      15730000
157400            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      15740000
157500        END-PERFORM.                                              15750000
157600/                                                                 15760000
157700*----------------------------------------------------------------*15770000
157800*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *15780000
157900*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *15790000
158000*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *15800000
158100*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *15810000
158200*----------------------------------------------------------------*15820000
158300 3300-EDIT-SELECTIONS.                                            15830000
158400                                                                  15840000
158500     EVALUATE TRUE                                                15850000
158600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15860000
158700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         15870000
158800                 CONTINUE                                         15880000
158900                                                                  15890000
159000         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         15900000
159100             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        15910000
159200                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS15920000
159300                 MOVE ASC-TEMP-SELECTED-SW                        15930000
159400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15940000
159500                                   TO ASC-SELECTED-SW             15950000
159600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15960000
159700             END-IF                                               15970000
159800                                                                  15980000
159900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     15990000
160000                 = SPACE                                          16000000
160100             EVALUATE TRUE                                        16010000
160200                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16020000
160300                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16030000
160400                     MOVE SPACE    TO ASC-SELECTED-SW             16040000
160500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16050000
160600                                                                  16060000
160700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16070000
160800                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 16080000
160900                     MOVE SPACE    TO ASC-SELECTED-SW             16090000
161000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16100000
161100                                                                  16110000
161200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16120000
161300                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   16130000
161400                     MOVE SPACE    TO ASC-SELECTED-SW             16140000
161500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16150000
161600             END-EVALUATE                                         16160000
161700                                                                  16170000
161800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16180000
161900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16190000
162000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16200000
162100             END-IF                                               16210000
162200             PERFORM 3310-EDIT-RANGE                              16220000
162300                                                                  16230000
162400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             16240000
162500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16250000
162600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    16260000
162700             END-IF                                               16270000
162800             PERFORM 3310-EDIT-RANGE                              16280000
162900                                                                  16290000
163000         WHEN OTHER                                               16300000
163100             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            16310000
163200             SET DP020-MSG-FATAL   TO TRUE                        16320000
163300             MOVE -1               TO MR-SELECTL (PV-SUB)         16330000
163400             SET DP030-SET-CURSOR-APPL-1                          16340000
163500                                   TO TRUE                        16350000
163600             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         16360000
163700             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         16370000
163800             SET PS-ERROR          TO TRUE                        16380000
163900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16390000
164000                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     16400000
164100                 MOVE SPACE        TO ASC-SELECTED-SW             16410000
164200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16420000
164300             END-IF                                               16430000
164400     END-EVALUATE.                                                16440000
164500                                                                  16450000
164600     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             16460000
164700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               16470000
164800                                                                  16480000
164900     IF  ASC-ITEM-SUB < 1                                         16490000
165000         SUBTRACT +1 FROM ASC-BLK-SUB                             16500000
165100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                16510000
165200     END-IF.                                                      16520000
165300                                                                  16530000
165400*----------------------------------------------------------------*16540000
165500*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *16550000
165600*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *16560000
165700*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *16570000
165800*  THE ENDING.                                                   *16580000
165900*----------------------------------------------------------------*16590000
166000 3310-EDIT-RANGE.                                                 16600000
166100                                                                  16610000
166200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                16620000
166300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   16630000
166400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)16640000
166500                                   TO ASC-SELECTED-SW             16650000
166600                                        (ASC-BLK-SUB ASC-ITEM-SUB)16660000
166700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 16670000
166800         ELSE                                                     16680000
166900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     16690000
167000                 CONTINUE                                         16700000
167100             ELSE                                                 16710000
167200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        16720000
167300                 MOVE PC-TSYMSG-00054                             16730000
167400                                   TO DP020-MSG-NUMBER            16740000
167500                 SET DP020-MSG-FATAL                              16750000
167600                                   TO TRUE                        16760000
167700                 MOVE -1           TO MR-SELECTL (PV-SUB)         16770000
167800                 SET DP030-SET-CURSOR-APPL-1                      16780000
167900                                   TO TRUE                        16790000
168000                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         16800000
168100                 MOVE DP015-UNDERLINE                             16810000
168200                                   TO MR-SELECTH (PV-SUB)         16820000
168300                 SET PS-ERROR      TO TRUE                        16830000
168400             END-IF                                               16840000
168500         END-IF                                                   16850000
168600     ELSE                                                         16860000
168700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     16870000
168800             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 16880000
168900                                   TO ASC-SELECTED-SW             16890000
169000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   16900000
169100             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   16910000
169200         ELSE                                                     16920000
169300             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       16930000
169400                 CONTINUE                                         16940000
169500             ELSE                                                 16950000
169600*                -- ONLY ONE END-OF-RANGE ALLOWED --              16960000
169700                 MOVE PC-TSYMSG-00055                             16970000
169800                                   TO DP020-MSG-NUMBER            16980000
169900                 SET DP020-MSG-FATAL                              16990000
170000                                   TO TRUE                        17000000
170100                 MOVE -1           TO MR-SELECTL (PV-SUB)         17010000
170200                 SET DP030-SET-CURSOR-APPL-1                      17020000
170300                                   TO TRUE                        17030000
170400                 SET PS-ERROR      TO TRUE                        17040000
170500             END-IF                                               17050000
170600         END-IF                                                   17060000
170700     END-IF.                                                      17070000
170800                                                                  17080000
170900*----------------------------------------------------------------*17090000
171000*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *17100000
171100*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *17110000
171200*----------------------------------------------------------------*17120000
171300 3400-CHECK-RANGE-SEQUENCE.                                       17130000
171400                                                                  17140000
171500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17150000
171600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17160000
171700       AND  ASC-START-OF-SELECTED-RANGE >                         17170000
171800                                         ASC-END-OF-SELECTED-RANGE17180000
171900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17190000
172000         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            17200000
172100         SET DP020-MSG-FATAL       TO TRUE                        17210000
172200         SET PS-ERROR              TO TRUE                        17220000
172300         PERFORM 3410-POSITION-AT-ERROR                           17230000
172400     END-IF.                                                      17240000
172500                                                                  17250000
172600*----------------------------------------------------------------*17260000
172700*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *17270000
172800*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *17280000
172900*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *17290000
173000*----------------------------------------------------------------*17300000
173100 3410-POSITION-AT-ERROR.                                          17310000
173200                                                                  17320000
173300     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       17330000
173400                                                                  17340000
173500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 17350000
173600                    - PV-TOP-ITEM + 1.                            17360000
173700                                                                  17370000
173800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17380000
173900         CONTINUE                                                 17390000
174000     ELSE                                                         17400000
174100         MOVE -1                   TO MR-SELECTL (PV-SUB)         17410000
174200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17420000
174300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17430000
174400     END-IF.                                                      17440000
174500                                                                  17450000
174600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   17460000
174700                    - PV-TOP-ITEM + 1.                            17470000
174800                                                                  17480000
174900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      17490000
175000         CONTINUE                                                 17500000
175100     ELSE                                                         17510000
175200         MOVE -1                   TO MR-SELECTL (PV-SUB)         17520000
175300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         17530000
175400         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         17540000
175500     END-IF.                                                      17550000
175600                                                                  17560000
175700/                                                                 17570000
175800*----------------------------------------------------------------*17580000
175900*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *17590000
176000*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *17600000
176100*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *17610000
176200*----------------------------------------------------------------*17620000
176300                                                                  17630000
176400 3500-MARK-RANGE-AS-SELECTED.                                     17640000
176500                                                                  17650000
176600     MOVE +1                       TO ASC-BLK-SUB.                17660000
176700                                                                  17670000
176800     PERFORM 3510-MARK-SELECTED-INDS                              17680000
176900         VARYING ASC-ITEM-SUB                                     17690000
177000         FROM 1 BY 1                                              17700000
177100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17710000
177200                                                                  17720000
177300     ADD +1                        TO ASC-BLK-SUB.                17730000
177400                                                                  17740000
177500     PERFORM 3510-MARK-SELECTED-INDS                              17750000
177600         VARYING ASC-ITEM-SUB                                     17760000
177700         FROM 1 BY 1                                              17770000
177800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 17780000
177900                                                                  17790000
178000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               17800000
178100                                   TO PV-LIST-ITEM-NUMBER.        17810000
178200                                                                  17820000
178300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            17830000
178400         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         17840000
178500               PC-ITEMS-PER-PANEL).                               17850000
178600                                                                  17860000
178700     MOVE ASC-START-OF-SELECTED-RANGE                             17870000
178800                                   TO PV-START-OF-SELECTED-RANGE. 17880000
178900                                                                  17890000
179000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            17900000
179100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  17910000
179200               PC-ITEMS-PER-PANEL).                               17920000
179300                                                                  17930000
179400     MOVE ASC-END-OF-SELECTED-RANGE                               17940000
179500                                   TO PV-END-OF-SELECTED-RANGE.   17950000
179600                                                                  17960000
179700     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             17970000
179800         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    17980000
179900               PC-ITEMS-PER-PANEL).                               17990000
180000                                                                  18000000
180100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             18010000
180200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             18020000
180300                                                                  18030000
180400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    18040000
180500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        18050000
180600         MOVE +1                   TO ASC-BLK-SUB                 18060000
180700         PERFORM 5100-WRITE-TEMP-STORAGE                          18070000
180800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18080000
180900             PV-FIRST-BLOCK-IN-ARRAY - 1                          18090000
181000                                                                  18100000
181100         PERFORM                                                  18110000
181200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18120000
181300                   PV-PREV-BLOCK-IN-ARRAY                         18130000
181400             MOVE PV-FIRST-BLOCK-IN-RANGE                         18140000
181500                                   TO PV-BLOCK-NUMBER             18150000
181600             PERFORM 4410-READ-TEMP-STORAGE                       18160000
181700             PERFORM 3510-MARK-SELECTED-INDS                      18170000
181800                 VARYING ASC-ITEM-SUB                             18180000
181900                 FROM 1 BY 1                                      18190000
182000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18200000
182100             PERFORM 5100-WRITE-TEMP-STORAGE                      18210000
182200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18220000
182300         END-PERFORM                                              18230000
182400                                                                  18240000
182500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18250000
182600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18260000
182700         PERFORM                                                  18270000
182800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18280000
182900                   PV-LAST-BLOCK-IN-RANGE                         18290000
183000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18300000
183100                                   TO PV-BLOCK-NUMBER             18310000
183200             PERFORM 4410-READ-TEMP-STORAGE                       18320000
183300             PERFORM 3510-MARK-SELECTED-INDS                      18330000
183400                 VARYING ASC-ITEM-SUB                             18340000
183500                 FROM 1 BY 1                                      18350000
183600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18360000
183700             PERFORM 5100-WRITE-TEMP-STORAGE                      18370000
183800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18380000
183900         END-PERFORM                                              18390000
184000                                                                  18400000
184100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18410000
184200                                   TO PV-BLOCK-NUMBER             18420000
184300         PERFORM 4410-READ-TEMP-STORAGE                           18430000
184400     END-IF.                                                      18440000
184500                                                                  18450000
184600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 18460000
184700                                      ASC-END-OF-SELECTED-RANGE.  18470000
184800                                                                  18480000
184900/                                                                 18490000
185000*----------------------------------------------------------------*18500000
185100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *18510000
185200*----------------------------------------------------------------*18520000
185300                                                                  18530000
185400 3510-MARK-SELECTED-INDS.                                         18540000
185500                                                                  18550000
185600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         18560000
185700         ASC-START-OF-SELECTED-RANGE)                             18570000
185800     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         18580000
185900         ASC-START-OF-SELECTED-RANGE)                             18590000
186000                                                                  18600000
186100         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     18610000
186200             ASC-END-OF-SELECTED-RANGE)                           18620000
186300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     18630000
186400             ASC-END-OF-SELECTED-RANGE)                           18640000
186500                                                                  18650000
186600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          18660000
186700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   18670000
186800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   18680000
186900                                   TO TRUE                        18690000
187000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              18700000
187100                                   TO TRUE                        18710000
187200                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS18720000
187300             END-IF                                               18730000
187400         END-IF                                                   18740000
187500     END-IF.                                                      18750000
187600                                                                  18760000
187700/                                                                 18770000
187800*----------------------------------------------------------------*18780000
187900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *18790000
188000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *18800000
188100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *18810000
188200*    DISPLAY THE PANEL TO USER.                                  *18820000
188300*----------------------------------------------------------------*18830000
188400                                                                  18840000
188500 4000-BUILD-INITIAL-PANEL.                                        18850000
188600                                                                  18860000
188700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             18870000
188800                ASC-BLOCK-ENTRIES (2).                            18880000
188900                                                                  18890000
189000     MOVE +1                       TO ASC-BLK-SUB.                18900000
189100                                                                  18910000
189200     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       18920000
189300                                                                  18930000
189400     MOVE +0                       TO ASC-ITEM-SUB                18940000
189500                                      ASC-NUMBER-OF-ITEMS-READ    18950000
189600                                      ASC-NUMBER-OF-SELECTED-ITEMS18960000
189700                                      ASC-HIGHEST-BLOCK-WRITTEN   18970000
189800                                      ASC-START-OF-SELECTED-RANGE 18980000
189900                                      ASC-END-OF-SELECTED-RANGE   18990000
190000                                      ASC-ITEM-AT-TOP-OF-PANEL.   19000000
190100                                                                  19010000
190200     PERFORM 4100-PREPARE-CURSOR.                                 19020000
190300                                                                  19030000
190400     PERFORM 4320-GET-ENT-NAME-DESC                               19040000
190500                                                                  19050000
190600     PERFORM 4010-OPEN-CURSOR.                                    19060000
190700                                                                  19070000
190800     PERFORM 4300-READ-ITEMS-FROM-DB.                             19080000
190900                                                                  19090000
191000     PERFORM 4020-CLOSE-CURSOR.                                   19100000
191100                                                                  19110000
191200     MOVE +1                       TO PV-TOP-ITEM.                19120000
191300                                                                  19130000
191400     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19140000
191500         SET DP020-NEXT-ACT-APPL-ERROR                            19150000
191600                                   TO TRUE                        19160000
191700         SET DP020-MSG-FATAL       TO TRUE                        19170000
191800         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            19180000
191900     ELSE                                                         19190000
192000         MOVE -1                   TO MR-SELECTL (1)              19200000
192100         SET DP030-SET-CURSOR-APPL-1                              19210000
192200                                   TO TRUE                        19220000
192300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     19230000
192400     END-IF.                                                      19240000
192500                                                                  19250000
192600/                                                                 19260000
192700*----------------------------------------------------------------*19270000
192800* OPEN THE RCVR CURSOR.                                          *19280000
192900*----------------------------------------------------------------*19290000
193000                                                                  19300000
193100 4010-OPEN-CURSOR.                                                19310000
193200                                                                  19320000
193300     PERFORM                                                      19330000
193400         WITH TEST AFTER                                          19340000
193500         VARYING PV-RETRY-COUNTER                                 19350000
193600         FROM 1 BY 1                                              19360000
193700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19370000
193800            OR (SQLCODE = +0))                                    19380000
193900                                                                  19390000
194000         EXEC SQL                                                 19400000
194100             OPEN RCVR-CSR                                        19410000
194200         END-EXEC                                                 19420000
194300                                                                  19430000
194400         EVALUATE TRUE                                            19440000
194500             WHEN SQLCODE = +0                                    19450000
194600                  CONTINUE                                        19460000
194700             WHEN SQLCODE = -904                                  19470000
194800             WHEN SQLCODE = -913                                  19480000
194900                  CONTINUE                                        19490000
195000             WHEN SQLWARN0 NOT = SPACE                            19500000
195100             WHEN SQLCODE  NOT = +0                               19510000
195200                  MOVE '4010-OPEN-CURSOR'                         19520000
195300                                   TO DP013-PARAGRAPH             19530000
195400                  MOVE 'OPEN RCVR-CSR CURSOR'                     19540000
195500                                   TO DP013-MESSAGE-TEXT (1)      19550000
195600                  MOVE SQLCA       TO DP013-SQLCA                 19560000
195700                  MOVE 'TPURCHS'   TO DP013-DB2-TABLE-NAME (1)    19570000
195800                  MOVE 'TSTATCD'   TO DP013-DB2-TABLE-NAME (2)    19580000
195900                  MOVE 'TRECEIV'   TO DP013-DB2-TABLE-NAME (3)    19590000
196000                  SET DP013-DB2-ABEND                             19600000
196100                                   TO TRUE                        19610000
196200                  PERFORM DP013-0000-PROCESS-ABEND                19620000
196300         END-EVALUATE                                             19630000
196400     END-PERFORM.                                                 19640000
196500                                                                  19650000
196600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        19660000
196700                 AND SQLCODE NOT = ZERO                           19670000
196800         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             19680000
196900         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              19690000
197000                                   TO DP013-MESSAGE-TEXT (1)      19700000
197100         MOVE SQLCA                TO DP013-SQLCA                 19710000
197200         SET DP013-DB2-ABEND       TO TRUE                        19720000
197300         PERFORM DP013-0000-PROCESS-ABEND                         19730000
197400     END-IF.                                                      19740000
197500                                                                  19750000
197600/                                                                 19760000
197700*----------------------------------------------------------------*19770000
197800* CLOSE THE RCVR CURSOR                                          *19780000
197900*----------------------------------------------------------------*19790000
198000                                                                  19800000
198100 4020-CLOSE-CURSOR.                                               19810000
198200                                                                  19820000
198300     EXEC SQL                                                     19830000
198400         CLOSE RCVR-CSR                                           19840000
198500     END-EXEC.                                                    19850000
198600                                                                  19860000
198700     EVALUATE TRUE                                                19870000
198800         WHEN SQLCODE = +0                                        19880000
198900              CONTINUE                                            19890000
199000         WHEN SQLWARN0 NOT = SPACE                                19900000
199100         WHEN SQLCODE  NOT = +0                                   19910000
199200              MOVE '4020-CLOSE-CURSOR'                            19920000
199300                                   TO DP013-PARAGRAPH             19930000
199400              MOVE 'CLOSE RCVR-CSR CURSOR'                        19940000
199500                                   TO DP013-MESSAGE-TEXT (1)      19950000
199600              MOVE SQLCA           TO DP013-SQLCA                 19960000
199700              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    19970000
199800              MOVE 'TSTATCD'       TO DP013-DB2-TABLE-NAME (2)    19980000
199900              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (3)    19990000
200000              SET DP013-DB2-ABEND  TO TRUE                        20000000
200100              PERFORM DP013-0000-PROCESS-ABEND                    20010000
200200     END-EVALUATE.                                                20020000
200300                                                                  20030000
200400/                                                                 20040000
200500*----------------------------------------------------------------*20050000
200600*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *20060000
200700*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *20070000
200800*----------------------------------------------------------------*20080000
200900                                                                  20090000
201000 4100-PREPARE-CURSOR.                                             20100000
201100                                                                  20110000
201200     IF  ASC-KEY-OPER-UNT-ID > ZEROES                             20120000
201300         MOVE ASC-KEY-OPER-UNT-ID TO DK-OPER-UNT-ID-B             20130000
201400                                     DK-OPER-UNT-ID-E             20140000
201500     ELSE                                                         20150000
201600         MOVE ZEROES              TO DK-OPER-UNT-ID-B             20160000
201700         MOVE 9999                TO DK-OPER-UNT-ID-E             20170000
201800     END-IF.                                                      20180000
201900                                                                  20190000
202000     IF  ASC-KEY-FCLTY-ID > ZEROES                                20200000
202100         MOVE ASC-KEY-FCLTY-ID    TO DK-FCLTY-ID-B                20210000
202200                                     DK-FCLTY-ID-E                20220000
202300     ELSE                                                         20230000
202400         MOVE ZEROES              TO DK-FCLTY-ID-B                20240000
202500         MOVE 9999                TO DK-FCLTY-ID-E                20250000
202600     END-IF.                                                      20260000
202700                                                                  20270000
202800     MOVE ASC-KEY-PO-NBR          TO DK-PO-NBR                    20280000
202900                                                                  20290000
203000     IF  ASC-KEY-REC-SEQ-NBR > ZEROES                             20300000
203100         MOVE ASC-KEY-REC-SEQ-NBR TO DK-REC-SEQ-NBR-B             20310000
203200                                     DK-REC-SEQ-NBR-E             20320000
203300     ELSE                                                         20330000
203400         MOVE ZEROES              TO DK-REC-SEQ-NBR-B             20340000
203500         MOVE 9999                TO DK-REC-SEQ-NBR-E             20350000
203600     END-IF.                                                      20360000
203700                                                                  20370000
203800/                                                                 20380000
203900*----------------------------------------------------------------*20390000
204000*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *20400000
204100*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *20410000
204200*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *20420000
204300*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *20430000
204400*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *20440000
204500*                                                                *20450000
204600*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *20460000
204700*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *20470000
204800*    UPON INITIALIZATION.                                        *20480000
204900*----------------------------------------------------------------*20490000
205000                                                                  20500000
205100 4300-READ-ITEMS-FROM-DB.                                         20510000
205200                                                                  20520000
205300     PERFORM                                                      20530000
205400         VARYING PV-READ-COUNT                                    20540000
205500         FROM 1 BY 1                                              20550000
205600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    20560000
205700            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         20570000
205800                                                                  20580000
205900         PERFORM 4310-FETCH                                       20590000
206000                                                                  20600000
206100         IF  ASC-ITEMS-LEFT-ON-DB                                 20610000
206200             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                20620000
206300                 ADD +1            TO ASC-ITEM-SUB                20630000
206400             ELSE                                                 20640000
206500                 ADD +1            TO ASC-BLK-SUB                 20650000
206600                 MOVE +1           TO ASC-ITEM-SUB                20660000
206700                                                                  20670000
206800                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         20680000
206900                     MOVE +1       TO ASC-BLK-SUB                 20690000
207000                     SET ASC-BLOCK-MODIFIED (1)                   20700000
207100                                   TO TRUE                        20710000
207200                     PERFORM 5100-WRITE-TEMP-STORAGE              20720000
207300                     MOVE ASC-BLOCK-ENTRIES                       20730000
207400                               (PC-MAX-BLOCKS-IN-ARRAY)           20740000
207500                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 20750000
207600                     ADD +1        TO ASC-BLK-SUB                 20760000
207700                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   20770000
207800                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      20780000
207900                                   TO TRUE                        20790000
208000                 END-IF                                           20800000
208100             END-IF                                               20810000
208200             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    20820000
208300             MOVE ASC-NUMBER-OF-ITEMS-READ                        20830000
208400                                   TO ASC-LIST-ITEM-NUMBER        20840000
208500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  20850000
208600             MOVE RECEIV-OPER-UNT-ID  TO DK-OPER-UNT-ID           20860000
208700             MOVE RECEIV-FCLTY-ID     TO DK-FCLTY-ID              20870000
208800             MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR                20880000
208900             MOVE RECEIV-REC-SEQ-NBR                              20890000
209000                                   TO ASC-REC-SEQ-NBR             20900000
209100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20910000
209200                                      DK-REC-SEQ-NBR              20920000
209300                                                                  20930000
209400             IF PV-REC-DTE = '9999-09-09'                         20940000
209500                MOVE 'ENROUTE'     TO ASC-ARRIVAL-DTE             20950000
209600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   20960000
209700             ELSE                                                 20970000
209800                MOVE PV-REC-DTE    TO ASC-ARRIVAL-DTE-ISO         20980000
209900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   20990000
210000                                         PV-DB2-DATE              21000000
210100                STRING PV-DB2-MM   DELIMITED BY SIZE              21010000
210200                       '/'         DELIMITED BY SIZE              21020000
210300                       PV-DB2-DD   DELIMITED BY SIZE              21030000
210400                       '/'         DELIMITED BY SIZE              21040000
210500                       PV-DB2-YY   DELIMITED BY SIZE              21050000
210600                                   INTO ASC-ARRIVAL-DTE           21060000
210700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21070000
210800             END-IF                                               21080000
210900             MOVE ZEROES TO PV-DB2-COUNT                          21090000
211000             PERFORM 4380-CHECK-IF-IN-TROUBLE                     21100000
211100             IF PV-DB2-COUNT > ZERO                               21110000
211200                MOVE 'Y'   TO                                     21120000
211300                     ASC-TROUBLE-SW (ASC-BLK-SUB ASC-ITEM-SUB)    21130000
211400             ELSE                                                 21140000
211500                MOVE SPACE TO                                     21150000
211600                     ASC-TROUBLE-SW (ASC-BLK-SUB ASC-ITEM-SUB)    21160000
211700             END-IF                                               21170000
211800             MOVE SPACES TO ASC-ADJUSTED-SW                       21180000
211900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21190000
212000             IF STATCD-STATUS-DESC = PC-VERIFIED                  21200000
212100                 PERFORM 4390-CHECK-IF-ADJUSTED                   21210000
212200                     IF PV-DB2-COUNT > ZERO                       21220000
212300*                        MOVE PC-VERIF-ADJ TO ASC-RECEIVER-STAT   21230000
212400                       MOVE RECEIV-STATUS-CDE TO ASC-RECEIVER-STAT21240000
212500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21250000
212600                         SET ASC-ADJUSTED-PO                      21260000
212700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21270000
212800                                             TO TRUE              21280000
212900                     ELSE                                         21290000
213000*                        MOVE STATCD-STATUS-DESC TO               21300000
213100                         MOVE RECEIV-STATUS-CDE TO                21310000
213200                                    ASC-RECEIVER-STAT             21320000
213300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21330000
213400                     END-IF                                       21340000
213500             ELSE                                                 21350000
213600*                MOVE STATCD-STATUS-DESC TO ASC-RECEIVER-STAT     21360000
213700                 MOVE RECEIV-STATUS-CDE TO ASC-RECEIVER-STAT      21370000
213800                               (ASC-BLK-SUB ASC-ITEM-SUB)         21380000
213900             END-IF                                               21390000
214000             IF  RECEIV-ACTL-CART-CNT GREATER THAN ZERO           21400000
214100                 MOVE RECEIV-ACTL-CART-CNT                        21410000
214200                                   TO ASC-CTN-CNT                 21420000
214300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21430000
214400             ELSE                                                 21440000
214500                 MOVE RECEIV-EXPTED-CART-CNT                      21450000
214600                                   TO ASC-CTN-CNT                 21460000
214700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21470000
214800             END-IF                                               21480000
214900             MOVE RECEIV-EXPTED-CART-CNT TO                       21490000
215000                ASC-EXP-CTN (ASC-BLK-SUB ASC-ITEM-SUB)            21500000
215100             IF  RECEIV-REC-TYP-CDE = 'EX'                        21510000
215200                 MOVE 'EXPENSE RECEIPT' TO ASC-OPER-SET-DESC      21520000
215300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21530000
215400             ELSE                                                 21540000
215500                 INITIALIZE DCLTOPRSET                            21550000
215600                 PERFORM 4350-GET-OPER-SET-DESC                   21560000
215700                 MOVE OPRSET-OPER-SET-DESC                        21570000
215800                                        TO ASC-OPER-SET-DESC      21580000
215900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21590000
216000             END-IF                                               21600000
216100             INITIALIZE PS-DIR-STORE-SW                           21610000
216200             MOVE RECEIV-OPER-UNT-ID TO PV-OPER-UNT-ID            21620000
216300                                        PV-LOC-OPER-UNT           21630000
216400             MOVE PV-OPER-UNT-ID     TO DK-STORE-NMBR             21640000
216500             PERFORM 4360-CHECK-DIRECT-STORE                      21650000
216600             IF  PS-DIR-STORE                                     21660000
216700                 STRING PV-OPER-UNT-ID-X      DELIMITED BY SIZE   21670000
216800                        '-'                   DELIMITED BY SIZE   21680000
216900                        'DIR. STORE SHIPMT'   DELIMITED BY SIZE   21690000
217000                                      INTO ASC-OPER-SET-DESC      21700000
217100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21710000
217200             END-IF                                               21720000
217300             INITIALIZE DCLTSHIPMT                                21730000
217400             PERFORM 4340-GET-SHIPMENT-INFO                       21740000
217500             MOVE SHIPMT-SHIPT-ID  TO ASC-SHIPT-ID                21750000
217600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21760000
217700             MOVE SHIPMT-TRIP-ID   TO ASC-TRIP-ID                 21770000
217800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21780000
217900             MOVE RECEIV-OPER-UNT-ID TO ASC-OPER-UNT-ID           21790000
218000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21800000
218100             MOVE RECEIV-FCLTY-ID  TO ASC-FCLTY-ID                21810000
218200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21820000
218300                                       PV-LOC-FCLTY               21830000
218400             MOVE PV-LOC           TO ASC-LOC                     21840000
218500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21850000
218600             MOVE RECEIV-CURR-OPER-UNT-ID TO PV-CURR-LOC-OPER-UNT 21860000
218700             MOVE RECEIV-CURR-FCLTY-ID  TO PV-CURR-LOC-FCLTY      21870000
218800             MOVE PV-CURR-LOC      TO ASC-CUR-LOC                 21880000
218900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21890000
219000             PERFORM 4370-SUM-PCS                                 21900000
219100             IF  RECEIV-STATUS-CDE = 'VE'                         21910000
219200                 MOVE PA-AP-VERIFIED-COUNT                        21920000
219300                                   TO ASC-PCS-VERFD               21930000
219400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21940000
219500             ELSE                                                 21950000
219600                  MOVE ZEROES      TO ASC-PCS-VERFD               21960000
219700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 21970000
219800             END-IF                                               21980000
219900             MOVE PA-INVOICED-COUNT TO                            21990000
220000                ASC-EXP-PCS (ASC-BLK-SUB ASC-ITEM-SUB)            22000000
220100             IF PS-ENTNME-NOT-FOUND                               22010000
220200                 PERFORM 4330-GET-VEND-NAME                       22020000
220300             END-IF                                               22030000
220400         END-IF                                                   22040000
220500     END-PERFORM.                                                 22050000
220600                                                                  22060000
220700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          22070000
220800         MOVE +1                   TO ASC-BLK-SUB                 22080000
220900         PERFORM 5100-WRITE-TEMP-STORAGE                          22090000
221000         ADD +1                    TO ASC-BLK-SUB                 22100000
221100         PERFORM 5100-WRITE-TEMP-STORAGE                          22110000
221200                                                                  22120000
221300         MOVE 1                    TO ASC-BLK-SUB                 22130000
221400                                      PV-BLOCK-NUMBER             22140000
221500         PERFORM 4410-READ-TEMP-STORAGE                           22150000
221600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             22160000
221700             MOVE 2                TO ASC-BLK-SUB                 22170000
221800                                      PV-BLOCK-NUMBER             22180000
221900             PERFORM 4410-READ-TEMP-STORAGE                       22190000
222000         END-IF                                                   22200000
222100     END-IF.                                                      22210000
222200                                                                  22220000
222300/                                                                 22230000
222400*----------------------------------------------------------------*22240000
222500*    FETCH A RCVR ROW                                            *22250000
222600*----------------------------------------------------------------*22260000
222700                                                                  22270000
222800 4310-FETCH.                                                      22280000
222900                                                                  22290000
223000     EXEC SQL                                                     22300000
223100         FETCH RCVR-CSR                                           22310000
223200          INTO :RECEIV-REC-SEQ-NBR                                22320000
223300              ,:PV-REC-DTE                                        22330000
223400              ,:RECEIV-OPER-UNT-ID                                22340000
223500              ,:RECEIV-FCLTY-ID                                   22350000
223600              ,:RECEIV-STATUS-CDE                                 22360000
223700              ,:RECEIV-ACTL-CART-CNT                              22370000
223800              ,:RECEIV-EXPTED-CART-CNT                            22380000
223900              ,:RECEIV-REC-TYP-CDE                                22390000
224000              ,:STATCD-STATUS-DESC                                22400000
224100              ,:RECEIV-EXPTED-CART-CNT                            22410000
224200              ,:RECEIV-EXPTED-ITM-QTY                             22420000
224300              ,:RECEIV-CURR-OPER-UNT-ID                           22430000
224400              ,:RECEIV-CURR-FCLTY-ID                              22440000
224500     END-EXEC.                                                    22450000
224600                                                                  22460000
224700     EVALUATE TRUE                                                22470000
224800         WHEN SQLCODE = +0                                        22480000
224900              CONTINUE                                            22490000
225000         WHEN SQLCODE = +100                                      22500000
225100              SET ASC-NO-ITEMS-LEFT-ON-DB                         22510000
225200                                   TO TRUE                        22520000
225300         WHEN SQLWARN0 NOT = SPACE                                22530000
225400         WHEN SQLCODE < +0                                        22540000
225500         WHEN SQLCODE > +0                                        22550000
225600              MOVE '4310-FETCH-CURSOR'                            22560000
225700                                   TO DP013-PARAGRAPH             22570000
225800              MOVE 'FETCH RCVR CURSOR'                            22580000
225900                                   TO DP013-MESSAGE-TEXT (1)      22590000
226000              MOVE SQLCA           TO DP013-SQLCA                 22600000
226100              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    22610000
226200              MOVE 'TSTATCD'       TO DP013-DB2-TABLE-NAME (2)    22620000
226300              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (3)    22630000
226400              SET DP013-DB2-ABEND  TO TRUE                        22640000
226500              PERFORM DP013-0000-PROCESS-ABEND                    22650000
226600     END-EVALUATE.                                                22660000
226700                                                                  22670000
226800/                                                                 22680000
226900 4320-GET-ENT-NAME-DESC.                                          22690000
227000                                                                  22700000
227100     PERFORM                                                      22710000
227200         WITH TEST AFTER                                          22720000
227300         VARYING PV-RETRY-COUNTER                                 22730000
227400         FROM 1 BY 1                                              22740000
227500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22750000
227600            OR (SQLCODE = +0)                                     22760000
227700            OR (SQLCODE = +100))                                  22770000
227800                                                                  22780000
227900         EXEC SQL                                                 22790000
228000            SELECT  ENT_NAME_DESC                                 22800000
228100              INTO :ENTNME-ENT-NAME-DESC                          22810000
228200              FROM  TENTNME A                                     22820000
228300                   ,TEXTENT B                                     22830000
228400                   ,TPURCHS C                                     22840000
228500          WHERE C.PO_NBR         = :DK-PO-NBR                     22850000
228600            AND C.VER_STATUS_CDE = 'A'                            22860000
228700            AND A.SEQ_NBR =                                       22870000
228800                (SELECT MAX(SEQ_NBR)                              22880000
228900                 FROM TENTNME                                     22890000
229000                 WHERE ENT_ID   = C.ENT_ID                        22900000
229100                   AND TYPE_CDE = '01')                           22910000
229200            AND A.ENT_ID = B.ENT_ID                               22920000
229300            AND B.ENT_ID = C.ENT_ID                               22930000
229400          WITH UR                                                 22940001
229500         END-EXEC                                                 22950000
229600                                                                  22960000
229700         EVALUATE TRUE                                            22970000
229800             WHEN SQLCODE = +0                                    22980000
229900                 MOVE ENTNME-ENT-NAME-DESC                        22990000
230000                                 TO ASC-ENT-NAME-DESC             23000000
230100                 SET PS-ENTNME-FOUND                              23010000
230200                                 TO TRUE                          23020000
230300                                                                  23030000
230400             WHEN SQLCODE = +100                                  23040000
230500                 SET PS-ENTNME-NOT-FOUND                          23050000
230600                                 TO TRUE                          23060000
230700             WHEN SQLCODE = -904                                  23070000
230800             WHEN SQLCODE = -913                                  23080000
230900                 CONTINUE                                         23090000
231000                                                                  23100000
231100             WHEN SQLWARN0 NOT = SPACE                            23110000
231200             WHEN SQLCODE < +0                                    23120000
231300             WHEN SQLCODE > +0                                    23130000
231400                 MOVE '4320-GET-ENT-NAME-DESC'                    23140000
231500                                 TO DP013-PARAGRAPH               23150000
231600                 MOVE 'SELECT ENTERPRISE NAME'                    23160000
231700                                 TO DP013-MESSAGE-TEXT (1)        23170000
231800                 MOVE SQLCA      TO DP013-SQLCA                   23180000
231900                 MOVE 'TENTNME'  TO DP013-DB2-TABLE-NAME (1)      23190000
232000                 MOVE 'TEXTENT'  TO DP013-DB2-TABLE-NAME (2)      23200000
232100                 SET DP013-DB2-ABEND                              23210000
232200                                 TO TRUE                          23220000
232300                 SET DP013-XCTL-DISPLAY-RESTART                   23230000
232400                                 TO TRUE                          23240000
232500                 PERFORM DP013-0000-PROCESS-ABEND                 23250000
232600         END-EVALUATE                                             23260000
232700     END-PERFORM.                                                 23270000
232800                                                                  23280000
232900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23290000
233000             AND SQLCODE NOT = ZERO                               23300000
233100             AND SQLCODE NOT = +100                               23310000
233200         MOVE '4320-GET-ENT-NAME-DESC'                            23320000
233300                                 TO DP013-PARAGRAPH               23330000
233400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     23340000
233500                                 TO DP013-MESSAGE-TEXT (1)        23350000
233600         MOVE 'VENDOR NAME'                                       23360000
233700                                 TO DP013-MESSAGE-TEXT (2)        23370000
233800         MOVE SQLCA              TO DP013-SQLCA                   23380000
233900         MOVE 'TENTNME'          TO DP013-DB2-TABLE-NAME (1)      23390000
234000         MOVE 'TEXTENT'          TO DP013-DB2-TABLE-NAME (2)      23400000
234100         SET DP013-DB2-ABEND     TO TRUE                          23410000
234200         SET DP013-XCTL-DISPLAY-RESTART                           23420000
234300                                 TO TRUE                          23430000
234400         PERFORM DP013-0000-PROCESS-ABEND                         23440000
234500     END-IF.                                                      23450000
234600                                                                  23460000
234700/                                                                 23470000
234800 4330-GET-VEND-NAME.                                              23480000
234900*  THIS ONLY NEEDS TO BE DONE IF A NAME WASN'T FOUND IN           23490000
235000*    PARAGRAPH 4320-GET-ENT-NAME-DESC.                            23500000
235100                                                                  23510000
235200     PERFORM                                                      23520000
235300         WITH TEST AFTER                                          23530000
235400         VARYING PV-RETRY-COUNTER                                 23540000
235500         FROM 1 BY 1                                              23550000
235600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23560000
235700            OR (SQLCODE = +0)                                     23570000
235800            OR (SQLCODE = +100))                                  23580000
235900                                                                  23590000
236000         EXEC SQL                                                 23600000
236100            SELECT  VEND_NAME                                     23610000
236200              INTO :SHPTPO-VEND-NAME                              23620000
236300              FROM  TSHPTPO                                       23630000
236400          WHERE PO_NBR      = :DK-PO-NBR                          23640000
236500            AND REC_SEQ_NBR = :DK-REC-SEQ-NBR                     23650000
236600            AND PRIM_SHIPT_IND = :PC-Y                            23660000
236700         END-EXEC                                                 23670000
236800                                                                  23680000
236900         EVALUATE TRUE                                            23690000
237000             WHEN SQLCODE = +0                                    23700000
237100                 MOVE SHPTPO-VEND-NAME                            23710000
237200                                 TO ASC-ENT-NAME-DESC             23720000
237300                 SET PS-ENTNME-FOUND                              23730000
237400                                 TO TRUE                          23740000
237500                                                                  23750000
237600             WHEN SQLCODE = +100                                  23760000
237700             WHEN SQLCODE = -904                                  23770000
237800             WHEN SQLCODE = -913                                  23780000
237900                 CONTINUE                                         23790000
238000                                                                  23800000
238100             WHEN SQLWARN0 NOT = SPACE                            23810000
238200             WHEN SQLCODE < +0                                    23820000
238300             WHEN SQLCODE > +0                                    23830000
238400                 MOVE '4330-GET-VEND-NAME    '                    23840000
238500                                 TO DP013-PARAGRAPH               23850000
238600                 MOVE 'SELECT VENDOR NAME    '                    23860000
238700                                 TO DP013-MESSAGE-TEXT (1)        23870000
238800                 MOVE SQLCA      TO DP013-SQLCA                   23880000
238900                 MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME (1)      23890000
239000                 SET DP013-DB2-ABEND                              23900000
239100                                 TO TRUE                          23910000
239200                 SET DP013-XCTL-DISPLAY-RESTART                   23920000
239300                                 TO TRUE                          23930000
239400                 PERFORM DP013-0000-PROCESS-ABEND                 23940000
239500         END-EVALUATE                                             23950000
239600     END-PERFORM.                                                 23960000
239700                                                                  23970000
239800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23980000
239900             AND SQLCODE NOT = ZERO                               23990000
240000             AND SQLCODE NOT = +100                               24000000
240100         MOVE '4330-GET-VEND-NAME    '                            24010000
240200                                 TO DP013-PARAGRAPH               24020000
240300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     24030000
240400                                 TO DP013-MESSAGE-TEXT (1)        24040000
240500         MOVE 'VENDOR NAME'                                       24050000
240600                                 TO DP013-MESSAGE-TEXT (2)        24060000
240700         MOVE SQLCA              TO DP013-SQLCA                   24070000
240800         MOVE 'TSHPTPO'          TO DP013-DB2-TABLE-NAME (1)      24080000
240900         SET DP013-DB2-ABEND     TO TRUE                          24090000
241000         SET DP013-XCTL-DISPLAY-RESTART                           24100000
241100                                 TO TRUE                          24110000
241200         PERFORM DP013-0000-PROCESS-ABEND                         24120000
241300     END-IF.                                                      24130000
241400                                                                  24140000
241500/                                                                 24150000
241600 4340-GET-SHIPMENT-INFO.                                          24160000
241700                                                                  24170000
241800     PERFORM                                                      24180000
241900         WITH TEST AFTER                                          24190000
242000         VARYING PV-RETRY-COUNTER                                 24200000
242100         FROM 1 BY 1                                              24210000
242200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24220000
242300            OR (SQLCODE = +0)                                     24230000
242400            OR (SQLCODE = +100)                                   24240000
242500            OR (SQLCODE = -811))                                  24250000
242600                                                                  24260000
242700         EXEC SQL                                                 24270000
242800            SELECT  B.SHIPT_ID                                    24280000
242900                   ,B.TRIP_ID                                     24290000
243000              INTO :SHIPMT-SHIPT-ID                               24300000
243100                  ,:SHIPMT-TRIP-ID                                24310000
243200              FROM  TSHPTPO A                                     24320000
243300                   ,TSHIPMT B                                     24330000
243400          WHERE A.PO_NBR      = :DK-PO-NBR                        24340000
243500            AND A.REC_SEQ_NBR = :DK-REC-SEQ-NBR                   24350000
243600            AND A.PRIM_SHIPT_IND = :PC-Y                          24360000
243700            AND A.SHIPT_ID = B.SHIPT_ID                           24370000
243800         END-EXEC                                                 24380000
243900                                                                  24390000
244000         EVALUATE TRUE                                            24400000
244100             WHEN SQLCODE = +0                                    24410000
244200             WHEN SQLCODE = +100                                  24420000
244300             WHEN SQLCODE = -811                                  24430000
244400             WHEN SQLCODE = -904                                  24440000
244500             WHEN SQLCODE = -913                                  24450000
244600                 CONTINUE                                         24460000
244700                                                                  24470000
244800             WHEN SQLWARN0 NOT = SPACE                            24480000
244900             WHEN SQLCODE < +0                                    24490000
245000             WHEN SQLCODE > +0                                    24500000
245100                 MOVE '4340-GET-SHIPMENT-INFO'                    24510000
245200                                 TO DP013-PARAGRAPH               24520000
245300                 MOVE 'SELECT SHIPMENT TABLE'                     24530000
245400                                 TO DP013-MESSAGE-TEXT (1)        24540000
245500                 MOVE SQLCA      TO DP013-SQLCA                   24550000
245600                 MOVE 'TSHPTPO'  TO DP013-DB2-TABLE-NAME (1)      24560000
245700                 MOVE 'TSHIPMT'  TO DP013-DB2-TABLE-NAME (2)      24570000
245800                 SET DP013-DB2-ABEND                              24580000
245900                                 TO TRUE                          24590000
246000                 SET DP013-XCTL-DISPLAY-RESTART                   24600000
246100                                 TO TRUE                          24610000
246200                 PERFORM DP013-0000-PROCESS-ABEND                 24620000
246300         END-EVALUATE                                             24630000
246400     END-PERFORM.                                                 24640000
246500                                                                  24650000
246600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24660000
246700             AND SQLCODE NOT = ZERO                               24670000
246800             AND SQLCODE NOT = +100                               24680000
246900             AND SQLCODE NOT = -811                               24690000
247000         MOVE '4340-GET-SHIPMENT-INFO'                            24700000
247100                                 TO DP013-PARAGRAPH               24710000
247200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     24720000
247300                                 TO DP013-MESSAGE-TEXT (1)        24730000
247400         MOVE 'SHIPMENT INFO'                                     24740000
247500                                 TO DP013-MESSAGE-TEXT (2)        24750000
247600         MOVE SQLCA              TO DP013-SQLCA                   24760000
247700         MOVE 'TSHPTPO'          TO DP013-DB2-TABLE-NAME (1)      24770000
247800         MOVE 'TSHIPMT'          TO DP013-DB2-TABLE-NAME (2)      24780000
247900         SET DP013-DB2-ABEND     TO TRUE                          24790000
248000         SET DP013-XCTL-DISPLAY-RESTART                           24800000
248100                                 TO TRUE                          24810000
248200         PERFORM DP013-0000-PROCESS-ABEND                         24820000
248300     END-IF.                                                      24830000
248400                                                                  24840000
248500/                                                                 24850000
248600*----------------------------------------------------------------*24860000
248700*    RETRIEVE OPERATION SET DESCRIPTION                          *24870000
248800*----------------------------------------------------------------*24880000
248900 4350-GET-OPER-SET-DESC.                                          24890000
249000                                                                  24900000
249100*-10/6/05 GB CHANGE SELECT TO NOT USE OPER UNT ID                 24910000
249200*----------------------------------------------------------------*24920000
249300     PERFORM                                                      24930000
249400         WITH TEST AFTER                                          24940000
249500         VARYING PV-RETRY-COUNTER                                 24950000
249600         FROM 1 BY 1                                              24960000
249700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               24970000
249800             OR (SQLCODE = +0)                                    24980000
249900             OR (SQLCODE = +100))                                 24990000
250000                                                                  25000000
250100         EXEC SQL                                                 25010000
250200            SELECT  DISTINCT                                      25020000
250300                    C.OPER_SET_DESC                               25030000
250400              INTO :OPRSET-OPER-SET-DESC                          25040000
250500              FROM  TRECEIV A                                     25050000
250600                   ,TWRKORD B                                     25060000
250700                   ,TOPRSET C                                     25070000
250800             WHERE  A.ORD_NBR        = :DK-PO-NBR                 25080000
250900               AND  A.REC_SEQ_NBR    = :DK-REC-SEQ-NBR            25090000
251000               AND  B.ORD_LNE_NBR    = 0                          25100000
251100               AND  A.VER_STATUS_CDE = 'A'                        25110000
251200               AND  B.VER_STATUS_CDE = 'A'                        25120000
251300****           AND  A.OPER_UNT_ID    = B.OPER_UNT_ID              25130000
251400****           AND  A.FCLTY_ID       = B.FCLTY_ID                 25140000
251500               AND  A.ORD_NBR        = B.ORD_NBR                  25150000
251600               AND  A.REC_SEQ_NBR    = B.RCVR_SEQ_NBR             25160000
251700               AND  B.OPER_SET_ID    = C.OPER_SET_ID              25170000
251800               AND  C.OPER_UNT_ID    = A.CURR_OPER_UNT_ID         25180000
251900         END-EXEC                                                 25190000
252000                                                                  25200000
252100         EVALUATE TRUE                                            25210000
252200             WHEN SQLCODE = +0                                    25220000
252300             WHEN SQLCODE = +100                                  25230000
252400             WHEN SQLCODE = -904                                  25240000
252500             WHEN SQLCODE = -913                                  25250000
252600                  CONTINUE                                        25260000
252700                                                                  25270000
252800             WHEN SQLWARN0 NOT = SPACES                           25280000
252900             WHEN SQLCODE < +0                                    25290000
253000             WHEN SQLCODE > +0                                    25300000
253100                  MOVE '4350-GET-OPER-SET-DESC'                   25310000
253200                                  TO DP013-PARAGRAPH              25320000
253300                  MOVE 'UNSUCCESSFUL SELECT ON TOPRSET  '         25330000
253400                                  TO DP013-MESSAGE-TEXT (1)       25340000
253500                  MOVE SQLCA      TO DP013-SQLCA                  25350000
253600                  MOVE 'TRECEIV ' TO DP013-DB2-TABLE-NAME (1)     25360000
253700                  MOVE 'TWRKORD ' TO DP013-DB2-TABLE-NAME (2)     25370000
253800                  MOVE 'TOPRSET ' TO DP013-DB2-TABLE-NAME (3)     25380000
253900                  SET DP013-DB2-ABEND                             25390000
254000                      DP013-XCTL-DISPLAY-RESTART                  25400000
254100                                  TO TRUE                         25410000
254200                  PERFORM DP013-0000-PROCESS-ABEND                25420000
254300         END-EVALUATE                                             25430000
254400     END-PERFORM.                                                 25440000
254500                                                                  25450000
254600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25460000
254700             AND SQLCODE NOT = ZERO                               25470000
254800             AND SQLCODE NOT = +100                               25480000
254900         MOVE '4350-GET-OPER-SET-DESC'                            25490000
255000                                  TO DP013-PARAGRAPH              25500000
255100         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON TOPRSET  '       25510000
255200                                  TO DP013-MESSAGE-TEXT (1)       25520000
255300         MOVE SQLCA               TO DP013-SQLCA                  25530000
255400         MOVE 'TRECEIV '          TO DP013-DB2-TABLE-NAME (1)     25540000
255500         MOVE 'TWRKORD '          TO DP013-DB2-TABLE-NAME (2)     25550000
255600         MOVE 'TOPRSET '          TO DP013-DB2-TABLE-NAME (3)     25560000
255700         SET DP013-DB2-ABEND                                      25570000
255800             DP013-XCTL-DISPLAY-RESTART                           25580000
255900                                  TO TRUE                         25590000
256000         PERFORM DP013-0000-PROCESS-ABEND                         25600000
256100     END-IF.                                                      25610000
256200                                                                  25620000
256300/                                                                 25630000
256400*----------------------------------------------------------------*25640000
256500*     CHECK TO SEE IF OPERATING UNIT IS A STORE                  *25650000
256600*----------------------------------------------------------------*25660000
256700 4360-CHECK-DIRECT-STORE.                                         25670000
256800                                                                  25680000
256900     PERFORM                                                      25690000
257000         WITH TEST AFTER                                          25700000
257100         VARYING PV-RETRY-COUNTER                                 25710000
257200         FROM 1 BY 1                                              25720000
257300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25730000
257400            OR (SQLCODE = +0)                                     25740000
257500            OR (SQLCODE = +100))                                  25750000
257600                                                                  25760000
257700         EXEC SQL                                                 25770000
257800             SELECT LOC_NM                                        25780000
257900              INTO  :XLT00010-LOC-NM                              25790000
258000              FROM  XLT_LOC                                       25800000
258100             WHERE LOC_NBR      = :DK-STORE-NMBR                  25810000
258200               AND LOC_TYP_CDE  = 'DS'                            25820000
258300         END-EXEC                                                 25830000
258400                                                                  25840000
258500         EVALUATE TRUE                                            25850000
258600             WHEN SQLCODE = +0                                    25860000
258700                 SET PS-DIR-STORE TO TRUE                         25870000
258800             WHEN SQLCODE = +100                                  25880000
258900             WHEN SQLCODE = -904                                  25890000
259000             WHEN SQLCODE = -913                                  25900000
259100                 SET PS-NOT-DIR-STORE TO TRUE                     25910000
259200                                                                  25920000
259300             WHEN SQLWARN0 NOT = SPACE                            25930000
259400             WHEN SQLCODE < +0                                    25940000
259500             WHEN SQLCODE > +0                                    25950000
259600                 MOVE '4360-CHECK-DIRECT-STORE'                   25960000
259700                                 TO DP013-PARAGRAPH               25970000
259800                 MOVE 'SELECT ON XLT_LOC'                         25980000
259900                                 TO DP013-MESSAGE-TEXT (1)        25990000
260000                 STRING 'STORE NUMBER:  ' DELIMITED BY SIZE       26000000
260100                        PV-OPER-UNT-ID-X  DELIMITED BY SIZE       26010000
260200                                 INTO DP013-MESSAGE-TEXT (2)      26020000
260300                 MOVE SQLCA      TO DP013-SQLCA                   26030000
260400                 MOVE 'XLT_LOC'  TO DP013-DB2-TABLE-NAME (1)      26040000
260500                 SET DP013-DB2-ABEND                              26050000
260600                                 TO TRUE                          26060000
260700                 SET DP013-XCTL-DISPLAY-RESTART                   26070000
260800                                 TO TRUE                          26080000
260900                 PERFORM DP013-0000-PROCESS-ABEND                 26090000
261000         END-EVALUATE                                             26100000
261100     END-PERFORM.                                                 26110000
261200                                                                  26120000
261300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26130000
261400             AND SQLCODE NOT = ZERO                               26140000
261500             AND SQLCODE NOT = +100                               26150000
261600         MOVE '4360-CHECK-DIRECT-STORE'                           26160000
261700                                 TO DP013-PARAGRAPH               26170000
261800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     26180000
261900                                 TO DP013-MESSAGE-TEXT (1)        26190000
262000         MOVE SQLCA              TO DP013-SQLCA                   26200000
262100         MOVE 'XLT_LOC'          TO DP013-DB2-TABLE-NAME (1)      26210000
262200         SET DP013-DB2-ABEND     TO TRUE                          26220000
262300         SET DP013-XCTL-DISPLAY-RESTART                           26230000
262400                                 TO TRUE                          26240000
262500         PERFORM DP013-0000-PROCESS-ABEND                         26250000
262600     END-IF.                                                      26260000
262700                                                                  26270000
262800/                                                                 26280000
262900 4370-SUM-PCS.                                                    26290000
263000                                                                  26300000
263100     PERFORM                                                      26310000
263200         WITH TEST AFTER                                          26320000
263300         VARYING PV-RETRY-COUNTER                                 26330000
263400         FROM 1 BY 1                                              26340000
263500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               26350000
263600            OR (SQLCODE = +0)                                     26360000
263700            OR (SQLCODE = -305))                                  26370000
263800                                                                  26380000
263900         MOVE ZERO              TO PA-INVOICED-COUNT              26390000
264000                                   PA-AP-VERIFIED-COUNT           26400000
264100         EXEC SQL                                                 26410000
264200            SELECT  SUM(EXPTED_ITM_QTY)                           26420000
264300                   ,SUM(AP_VERIFY_ITM_QTY)                        26430000
264400              INTO :PA-INVOICED-COUNT                             26440000
264500                  ,:PA-AP-VERIFIED-COUNT                          26450000
264600              FROM  TRECDIS                                       26460000
264700            WHERE OPER_UNT_ID    = :DK-OPER-UNT-ID                26470000
264800              AND FCLTY_ID       = :DK-FCLTY-ID                   26480000
264900              AND ORD_NBR        = :DK-PO-NBR                     26490000
265000              AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                26500000
265200         END-EXEC                                                 26520000
265300                                                                  26530000
265400         EVALUATE TRUE                                            26540000
265500             WHEN SQLCODE = +0                                    26550000
265600             WHEN SQLCODE = -305                                  26560000
265700             WHEN SQLCODE = -904                                  26570000
265800             WHEN SQLCODE = -913                                  26580000
265900                 CONTINUE                                         26590000
266000                                                                  26600000
266100             WHEN SQLWARN0 NOT = SPACE                            26610000
266200             WHEN SQLCODE < +0                                    26620000
266300             WHEN SQLCODE > +0                                    26630000
266400                 MOVE '4370-SUM-PCS'                              26640000
266500                                 TO DP013-PARAGRAPH               26650000
266600                 MOVE 'SELECT ON TRECDIS'                         26660000
266700                                 TO DP013-MESSAGE-TEXT (1)        26670000
266800                 MOVE SQLCA      TO DP013-SQLCA                   26680000
266900                 MOVE 'TRECDIS'  TO DP013-DB2-TABLE-NAME (1)      26690000
267000                 SET DP013-DB2-ABEND                              26700000
267100                                 TO TRUE                          26710000
267200                 SET DP013-XCTL-DISPLAY-RESTART                   26720000
267300                                 TO TRUE                          26730000
267400                 PERFORM DP013-0000-PROCESS-ABEND                 26740000
267500         END-EVALUATE                                             26750000
267600     END-PERFORM.                                                 26760000
267700                                                                  26770000
267800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26780000
267900             AND SQLCODE NOT = ZERO                               26790000
268000             AND SQLCODE NOT = -305                               26800000
268100         MOVE '4370-SUM-PCS'                                      26810000
268200                                 TO DP013-PARAGRAPH               26820000
268300         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     26830000
268400                                 TO DP013-MESSAGE-TEXT (1)        26840000
268500         MOVE 'REC ITEM QTY INFO'                                 26850000
268600                                 TO DP013-MESSAGE-TEXT (2)        26860000
268700         MOVE SQLCA              TO DP013-SQLCA                   26870000
268800         MOVE 'TRECDIS'          TO DP013-DB2-TABLE-NAME (1)      26880000
268900         SET DP013-DB2-ABEND     TO TRUE                          26890000
269000         SET DP013-XCTL-DISPLAY-RESTART                           26900000
269100                                 TO TRUE                          26910000
269200         PERFORM DP013-0000-PROCESS-ABEND                         26920000
269300     END-IF.                                                      26930000
269400                                                                  26940000
269500/                                                                 26950000
269600*----------------------------------------------------------------*26960000
269700* CHECK IF TROUBLE NOTIFICATION EXISTS FOR THE PO #/RECV SEQ #.  *26970000
269800*----------------------------------------------------------------*26980000
269900                                                                  26990000
270000 4380-CHECK-IF-IN-TROUBLE.                                        27000000
270100     MOVE ZERO                    TO PV-DB2-COUNT.                27010000
270200                                                                  27020000
270300         EXEC SQL                                                 27030000
270400              SELECT COUNT(*)                                     27040000
270500                INTO :PV-DB2-COUNT :PV-NULL-IND                   27050000
270600                FROM TTRBNTF A                                    27060000
270700               WHERE A.PO_NBR        = :DK-PO-NBR                 27070000
270800                 AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR            27080000
270900                 AND A.RESOLVED_IND IN ('N','I')                  27090000
271000         END-EXEC                                                 27100000
271100                                                                  27110000
271200         EVALUATE TRUE                                            27120000
271300             WHEN SQLCODE = +0                                    27130000
271400             WHEN SQLCODE = +100                                  27140000
271500             WHEN SQLCODE = -904                                  27150000
271600                 CONTINUE                                         27160000
271700             WHEN SQLCODE = -913                                  27170000
271800                 SET PS-TROUBLE-BUSY TO TRUE                      27180000
271900                                                                  27190000
272000             WHEN SQLWARN0 NOT = SPACES                           27200000
272100             WHEN SQLCODE < +0                                    27210000
272200             WHEN SQLCODE > +0                                    27220000
272300                  MOVE '4380-CHECK-IF-IN-TROUBLE'                 27230000
272400                                  TO DP013-PARAGRAPH              27240000
272500                  MOVE 'UNSUCCESSFUL SELECT TROUBLE COUNT'        27250000
272600                                  TO DP013-MESSAGE-TEXT (1)       27260000
272700                  MOVE SQLCA      TO DP013-SQLCA                  27270000
272800                  MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)     27280000
272900                  SET DP013-DB2-ABEND                             27290000
273000                      DP013-XCTL-DISPLAY-RESTART                  27300000
273100                                  TO TRUE                         27310000
273200                  PERFORM DP013-0000-PROCESS-ABEND                27320000
273300         END-EVALUATE.                                            27330000
273400/                                                                 27340000
273500*----------------------------------------------------------------*27350000
273600* CHECK IF PO/RECEIVER WAS ADJUSTED AFTER VERIFICATION           *27360000
273700*----------------------------------------------------------------*27370000
273800                                                                  27380000
273900 4390-CHECK-IF-ADJUSTED.                                          27390000
274000     MOVE ZERO                    TO PV-DB2-COUNT.                27400000
274100                                                                  27410000
274200         EXEC SQL                                                 27420000
274300              SELECT COUNT(*)                                     27430000
274400                INTO :PV-DB2-COUNT :PV-NULL-IND                   27440000
274500                FROM TAURECD A                                    27450000
274600               WHERE A.ORD_NBR       = :DK-PO-NBR                 27460000
274700                 AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR            27470000
274800                 AND NOT A.AUD_FUNC_CDE  = :PC-T                  27480000
274900                AND (A.UPD_PGM_ID    = :PC-RCKCS279               27490000
275000                  OR A.UPD_PGM_ID    = :PC-RCKCS280               27500000
275100                  OR A.UPD_PGM_ID    = :PC-RCKPV818               27510000
275200                  OR A.UPD_PGM_ID    = :PC-RCKPV819               27520000
275300                  OR A.UPD_PGM_ID    = :PC-RCKPV820               27530000
275400                  OR A.UPD_PGM_ID    = :PC-SUKPV702)              27540000
275500         END-EXEC                                                 27550000
275600                                                                  27560000
275700         EVALUATE TRUE                                            27570000
275800             WHEN SQLCODE = +0                                    27580000
275900             WHEN SQLCODE = +100                                  27590000
276000                 CONTINUE                                         27600000
276100                                                                  27610000
276200             WHEN SQLWARN0 NOT = SPACES                           27620000
276300             WHEN SQLCODE < +0                                    27630000
276400             WHEN SQLCODE > +0                                    27640000
276500                  MOVE '4390-CHECK-IF-ADJUSTED'                   27650000
276600                                  TO DP013-PARAGRAPH              27660000
276700                  MOVE 'UNSUCCESSFUL SELECT TROUBLE COUNT'        27670000
276800                                  TO DP013-MESSAGE-TEXT (1)       27680000
276900                  MOVE SQLCA      TO DP013-SQLCA                  27690000
277000                  MOVE 'TAURECD ' TO DP013-DB2-TABLE-NAME (1)     27700000
277100                  SET DP013-DB2-ABEND                             27710000
277200                      DP013-XCTL-DISPLAY-RESTART                  27720000
277300                                  TO TRUE                         27730000
277400                  PERFORM DP013-0000-PROCESS-ABEND                27740000
277500         END-EVALUATE.                                            27750000
277600/                                                                 27760000
277700*----------------------------------------------------------------*27770000
277800* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *27780000
277900*----------------------------------------------------------------*27790000
278000                                                                  27800000
278100 4400-MOVE-COMMAREA-TO-SCREEN.                                    27810000
278200                                                                  27820000
278300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             27830000
278400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          27840000
278500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          27850000
278600             MOVE +1               TO ASC-BLK-SUB                 27860000
278700             PERFORM 5100-WRITE-TEMP-STORAGE                      27870000
278800             ADD +1                TO ASC-BLK-SUB                 27880000
278900             PERFORM 5100-WRITE-TEMP-STORAGE                      27890000
279000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             27900000
279100                 GIVING PV-BLOCK-NUMBER                           27910000
279200                 REMAINDER PV-REMAINDER                           27920000
279300             IF  PV-REMAINDER > ZERO                              27930000
279400                 ADD +1            TO PV-BLOCK-NUMBER             27940000
279500             END-IF                                               27950000
279600             MOVE +1               TO ASC-BLK-SUB                 27960000
279700             PERFORM 4410-READ-TEMP-STORAGE                       27970000
279800             ADD +1                TO ASC-BLK-SUB                 27980000
279900                                      PV-BLOCK-NUMBER             27990000
280000             PERFORM 4410-READ-TEMP-STORAGE                       28000000
280100     END-IF.                                                      28010000
280200                                                                  28020000
280300     MOVE +1                       TO ASC-BLK-SUB.                28030000
280400                                                                  28040000
280500     COMPUTE ASC-ITEM-SUB =                                       28050000
280600         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28060000
280700         + PC-ITEMS-PER-PANEL).                                   28070000
280800                                                                  28080000
280900     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        28090000
281000         ADD +1                    TO ASC-BLK-SUB                 28100000
281100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28110000
281200     END-IF.                                                      28120000
281300                                                                  28130000
281400     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           28140000
281500         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                28150000
281600                                                                  28160000
281700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        28170000
281800     PERFORM 4420-FORMAT-LIST-LINES                               28180000
281900         VARYING PV-SUB                                           28190000
282000         FROM PC-ITEMS-PER-PANEL BY -1                            28200000
282100         UNTIL PV-SUB < +1.                                       28210000
282200                                                                  28220000
282300     COMPUTE ASC-ITEMS-DISPLAYED =                                28230000
282400         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          28240000
282500                                                                  28250000
282600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    28260000
282700                                      ASTRTITO.                   28270000
282800                                                                  28280000
282900     MOVE ASC-KEY-PO-NBR           TO MR-PO-NBR.                  28290000
283000     MOVE ASC-ENT-NAME-DESC        TO MR-ENT-NAME-DESC.           28300000
283100                                                                  28310000
283200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    28320000
283300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    28330000
283400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28340000
283500                                   TO ASELITO.                    28350000
283600                                                                  28360000
283700     IF  DP020-MSG-NUMBER-X = SPACE                               28370000
283800         IF  PS-TROUBLE-BUSY                                      28380000
283900*            --- MORE ITEMS TO DISPLAY ----                       28390000
284000             MOVE PC-TSYMSG-01089  TO DP020-MSG-NUMBER            28400000
284100             SET DP020-MSG-INFORMATIONAL                          28410000
284200                                   TO TRUE                        28420000
284300         END-IF                                                   28430000
284400     IF  DP020-MSG-NUMBER-X = SPACE                               28440000
284500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  28450000
284600*            --- MORE ITEMS TO DISPLAY ----                       28460000
284700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            28470000
284800             SET DP020-MSG-INFORMATIONAL                          28480000
284900                                   TO TRUE                        28490000
285000         END-IF                                                   28500000
285100     END-IF.                                                      28510000
285200                                                                  28520000
285300*----------------------------------------------------------------*28530000
285400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *28540000
285500*----------------------------------------------------------------*28550000
285600                                                                  28560000
285700 4410-READ-TEMP-STORAGE.                                          28570000
285800                                                                  28580000
285900     EXEC CICS                                                    28590000
286000         READQ TS                                                 28600000
286100             QUEUE (ASC-LIST-QUEUE-NAME)                          28610000
286200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28620000
286300             ITEM  (PV-BLOCK-NUMBER)                              28630000
286400             RESP  (PV-CICS-RESP)                                 28640000
286500     END-EXEC.                                                    28650000
286600                                                                  28660000
286700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       28670000
286800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     28680000
286900         CONTINUE                                                 28690000
287000     ELSE                                                         28700000
287100         SET DP013-CICS-ABEND      TO TRUE                        28710000
287200         SET DP013-NO-ROLLBACK     TO TRUE                        28720000
287300         MOVE '4410-READ-TEMP-STORAGE'                            28730000
287400                                   TO DP013-PARAGRAPH             28740000
287500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      28750000
287600                                   TO DP013-MESSAGE-TEXT(1)       28760000
287700         PERFORM DP013-0000-PROCESS-ABEND                         28770000
287800     END-IF.                                                      28780000
287900                                                                  28790000
288000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      28800000
288100                                   TO TRUE.                       28810000
288200                                                                  28820000
288300     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         28830000
288400         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               28840000
288500     END-IF.                                                      28850000
288600                                                                  28860000
288700/                                                                 28870000
288800*----------------------------------------------------------------*28880000
288900*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *28890000
289000*----------------------------------------------------------------*28900000
289100                                                                  28910000
289200 4420-FORMAT-LIST-LINES.                                          28920000
289300                                                                  28930000
289400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      28940000
289500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                28950000
289600         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         28960000
289700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           28970000
289800         MOVE SPACES             TO MR-PO-NBR-X                   28980000
289900                                    MR-ENT-NAME-DESC              28990000
290000         MOVE SPACE              TO MR-SELECT (PV-SUB)            29000000
290100                                    MR-ACTION (PV-SUB)            29010000
290200                                    MR-REC-SEQ-NBR (PV-SUB)       29020000
290300                                    MR-ARRIVAL-DTE (PV-SUB)       29030000
290400                                    MR-RECEIVER-STAT (PV-SUB)     29040000
290500                                    MR-OPER-SET-DESC (PV-SUB)     29050000
290600                                    MR-CARTON-CNT-X (PV-SUB)      29060000
290700                                    MR-PCS-CNT-X    (PV-SUB)      29070000
290800                                    MR-EXPECT-CTN-X (PV-SUB)      29080000
290900                                    MR-EXP-PCS-X    (PV-SUB)      29090000
291000                                    MR-REC-SEQ-LOC  (PV-SUB)      29100000
291100                                    MR-REC-CUR-LOC  (PV-SUB)      29110000
291200     ELSE                                                         29120000
291300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29130000
291400                                                   > SPACE        29140000
291500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 29150000
291600                                   TO MR-SELECT (PV-SUB)          29160000
291700         ELSE                                                     29170000
291800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29180000
291900                                   TO MR-SELECT (PV-SUB)          29190000
292000         END-IF                                                   29200000
292100                                                                  29210000
292200         IF  DP030-SET-CURSOR-TRAILER                             29220000
292300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)29230000
292400                 > SPACE)                                         29240000
292500               OR (PV-SUB = 1))                                   29250000
292600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               29260000
292700                MOVE -1            TO MR-SELECTL (PV-SUB)         29270000
292800             END-IF                                               29280000
292900         END-IF                                                   29290000
293000                                                                  29300000
293100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           29310000
293200             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           29320000
293300                                   TO MR-ACTION (PV-SUB)          29330000
293400             MOVE ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      29340000
293500                                   TO MR-REC-SEQ-NBR (PV-SUB)     29350000
293600             MOVE ASC-ARRIVAL-DTE (ASC-BLK-SUB ASC-ITEM-SUB)      29360000
293700                                   TO MR-ARRIVAL-DTE (PV-SUB)     29370000
293800             MOVE ASC-RECEIVER-STAT (ASC-BLK-SUB ASC-ITEM-SUB)    29380000
293900                                 TO MR-RECEIVER-STAT (PV-SUB)     29390000
294000             MOVE ASC-OPER-SET-DESC (ASC-BLK-SUB ASC-ITEM-SUB)    29400000
294100                                 TO MR-OPER-SET-DESC (PV-SUB)     29410000
294200             MOVE ASC-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          29420000
294300                                 TO MR-CARTON-CNT (PV-SUB)        29430000
294400             MOVE ASC-EXP-CTN (ASC-BLK-SUB ASC-ITEM-SUB)          29440000
294500                                 TO MR-EXPECT-CTN (PV-SUB)        29450000
294600             MOVE ASC-EXP-PCS   (ASC-BLK-SUB ASC-ITEM-SUB)        29460000
294700                                 TO MR-EXP-PCS    (PV-SUB)        29470000
294800             MOVE ASC-PCS-VERFD (ASC-BLK-SUB ASC-ITEM-SUB)        29480000
294900                                 TO MR-PCS-CNT    (PV-SUB)        29490000
295000             MOVE ASC-LOC       (ASC-BLK-SUB ASC-ITEM-SUB)        29500000
295100                                 TO MR-REC-SEQ-LOC (PV-SUB)       29510000
295200             MOVE ASC-CUR-LOC   (ASC-BLK-SUB ASC-ITEM-SUB)        29520000
295300                                 TO MR-REC-CUR-LOC (PV-SUB)       29530000
295400             IF ASC-TROUBLE-SW (ASC-BLK-SUB ASC-ITEM-SUB)         29540000
295500                                                   > SPACE        29550000
295600                MOVE DP015-YELLOW TO MR-RECEIVER-STATC (PV-SUB)   29560000
295700             ELSE                                                 29570000
295800                MOVE DP015-BLUE   TO MR-RECEIVER-STATC (PV-SUB)   29580000
295900             END-IF                                               29590000
296000                                                                  29600000
296100             IF ASC-ADJUSTED-PO (ASC-BLK-SUB ASC-ITEM-SUB)        29610000
296200                MOVE DP015-YELLOW TO MR-RECEIVER-STATC (PV-SUB)   29620000
296300                                     MR-PCS-CNTC (PV-SUB)         29630000
296400             ELSE                                                 29640000
296500*TCR THIS WOULD MEAN TROUBLE EXISTS FOR A NON-ADJUSTED PO, SO     29650000
296600* IT SHOULD REMAIN YELLOW, AND NOT BE TURNED BACK TO BLUE.        29660000
296700                IF ASC-TROUBLE-SW (ASC-BLK-SUB ASC-ITEM-SUB)      29670000
296800                                                   > SPACE        29680000
296900                   CONTINUE                                       29690000
297000                ELSE                                              29700000
297100                   MOVE DP015-BLUE TO MR-RECEIVER-STATC (PV-SUB)  29710000
297200                                      MR-PCS-CNTC (PV-SUB)        29720000
297300                END-IF                                            29730000
297400             END-IF                                               29740000
297500         END-IF                                                   29750000
297600     END-IF.                                                      29760000
297700                                                                  29770000
297800     SUBTRACT +1 FROM ASC-ITEM-SUB.                               29780000
297900                                                                  29790000
298000     IF  ASC-ITEM-SUB < + 1                                       29800000
298100         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                29810000
298200         MOVE +1                   TO ASC-BLK-SUB                 29820000
298300     END-IF.                                                      29830000
298400                                                                  29840000
298500*----------------------------------------------------------------*29850000
298600*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *29860000
298700*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *29870000
298800*  ISSUE A WARNING.                                              *29880000
298900*----------------------------------------------------------------*29890000
299000 4430-CHECK-FOR-BEGIN-AND-END.                                    29900000
299100                                                                  29910000
299200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       29920000
299300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     29930000
299400*            -- NO END-OF-RANGE SPECFIED ---                      29940000
299500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            29950000
299600             SET DP020-MSG-WARNING TO TRUE                        29960000
299700             PERFORM 4431-POSITION-AT-WARNING                     29970000
299800         END-IF                                                   29980000
299900     ELSE                                                         29990000
300000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     30000000
300100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                30010000
300200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            30020000
300300             SET DP020-MSG-WARNING TO TRUE                        30030000
300400             PERFORM 4431-POSITION-AT-WARNING                     30040000
300500         END-IF                                                   30050000
300600     END-IF.                                                      30060000
300700                                                                  30070000
300800*----------------------------------------------------------------*30080000
300900*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *30090000
301000*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *30100000
301100*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *30110000
301200*  POSITION THE CURSOR THERE.                                    *30120000
301300*----------------------------------------------------------------*30130000
301400 4431-POSITION-AT-WARNING.                                        30140000
301500                                                                  30150000
301600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 30160000
301700                    - PV-TOP-ITEM + 1.                            30170000
301800                                                                  30180000
301900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30190000
302000         CONTINUE                                                 30200000
302100     ELSE                                                         30210000
302200         SET DP030-SET-CURSOR-APPL-1                              30220000
302300                                   TO TRUE                        30230000
302400         MOVE -1                   TO MR-SELECTL (PV-SUB)         30240000
302500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30250000
302600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30260000
302700     END-IF.                                                      30270000
302800                                                                  30280000
302900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   30290000
303000                    - PV-TOP-ITEM + 1.                            30300000
303100                                                                  30310000
303200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30320000
303300         CONTINUE                                                 30330000
303400     ELSE                                                         30340000
303500         SET DP030-SET-CURSOR-APPL-1                              30350000
303600                                   TO TRUE                        30360000
303700         MOVE -1                   TO MR-SELECTL (PV-SUB)         30370000
303800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30380000
303900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30390000
304000     END-IF.                                                      30400000
304100                                                                  30410000
304200/                                                                 30420000
304300*----------------------------------------------------------------*30430000
304400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *30440000
304500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *30450000
304600* FOR THE SELECTED ITEMS QUEUE.                                  *30460000
304700*                                                                *30470000
304800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *30480000
304900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *30490000
305000* THE ARRAY IS FULL.                                             *30500000
305100*----------------------------------------------------------------*30510000
305200                                                                  30520000
305300 5000-PREPARE-SEL-QUEUE.                                          30530000
305400                                                                  30540000
305500     MOVE +1                       TO ASC-BLK-SUB.                30550000
305600     PERFORM 5100-WRITE-TEMP-STORAGE.                             30560000
305700     ADD +1                        TO ASC-BLK-SUB.                30570000
305800     PERFORM 5100-WRITE-TEMP-STORAGE.                             30580000
305900                                                                  30590000
306000     MOVE ASC-SEL-QUEUE-NAME-2     TO RC015-SEL-QUEUE-NAME.       30600000
306100     PERFORM 6010-DELETE-SEL-QUEUE.                               30610000
306200                                                                  30620000
306300     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      30630000
306400         SET ASC-UPDATE-TSQ        TO TRUE                        30640000
306500     END-IF.                                                      30650000
306600                                                                  30660000
306700     SET RC013-IDX                 TO 1.                          30670000
306800     MOVE ZERO                     TO RC015-NUMBER-OF-TS-ITEMS.   30680000
306900     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        30690000
307000                                                                  30700000
307100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           30710000
307200             VARYING PV-ITEM                                      30720000
307300             FROM 1 BY 1                                          30730000
307400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     30740000
307500                                                                  30750000
307600     IF  RC013-IDX > 1                                            30760000
307700         PERFORM 5205-WRITE-SEL-QUEUE                             30770000
307800         ADD +1                    TO RC015-NUMBER-OF-TS-ITEMS    30780000
307900     END-IF.                                                      30790000
308000                                                                  30800000
308100/                                                                 30810000
308200 5000A-PREPARE-SEL-QUEUE.                                         30820000
308300                                                                  30830000
308400     MOVE +1                       TO ASC-BLK-SUB.                30840000
308500     PERFORM 5100-WRITE-TEMP-STORAGE.                             30850000
308600     ADD +1                        TO ASC-BLK-SUB.                30860000
308700     PERFORM 5100-WRITE-TEMP-STORAGE.                             30870000
308800                                                                  30880000
308900     MOVE ASC-SEL-QUEUE-NAME       TO SU009-SEL-QUEUE-NAME.       30890000
309000     PERFORM 6010-DELETE-SEL-QUEUE.                               30900000
309100                                                                  30910000
309200     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      30920000
309300         SET ASC-UPDATE-TSQ        TO TRUE                        30930000
309400     END-IF.                                                      30940000
309500                                                                  30950000
309600     SET SU010-IDX                 TO 1.                          30960000
309700     MOVE ZERO                     TO SU009-NUMBER-OF-TS-ITEMS.   30970000
309800     INITIALIZE SU010-SELECTED-ITEM-ARRAY.                        30980000
309900                                                                  30990000
310000     PERFORM 5200A-FILL-SEL-QUEUE-RECORD                          31000000
310100             VARYING PV-ITEM                                      31010000
310200             FROM 1 BY 1                                          31020000
310300             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     31030000
310400                                                                  31040000
310500     IF  SU010-IDX > 1                                            31050000
310600         PERFORM 5205A-WRITE-SEL-QUEUE                            31060000
310700         ADD +1                    TO SU009-NUMBER-OF-TS-ITEMS    31070000
310800     END-IF.                                                      31080000
310900                                                                  31090000
311000/                                                                 31100000
311100*----------------------------------------------------------------*31110000
311200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *31120000
311300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *31130000
311400*----------------------------------------------------------------*31140000
311500                                                                  31150000
311600 5100-WRITE-TEMP-STORAGE.                                         31160000
311700                                                                  31170000
311800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     31180000
311900                                   TO PV-LIST-ITEM-NUMBER.        31190000
312000     COMPUTE PV-BLOCK-NUMBER =                                    31200000
312100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    31210000
312200                                                                  31220000
312300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             31230000
312400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             31240000
312500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      31250000
312600             PERFORM 5105-REWRITE-ASC-LISTQ                       31260000
312700         END-IF                                                   31270000
312800     ELSE                                                         31280000
312900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       31290000
313000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            31300000
313100         PERFORM 5110-WRITE-ASC-LISTQ                             31310000
313200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   31320000
313300     END-IF.                                                      31330000
313400                                                                  31340000
313500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      31350000
313600                                   TO TRUE.                       31360000
313700                                                                  31370000
313800/                                                                 31380000
313900*----------------------------------------------------------------*31390000
314000*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *31400000
314100*  SPECIFIC COMMAREA.                                            *31410000
314200*----------------------------------------------------------------*31420000
314300 5105-REWRITE-ASC-LISTQ.                                          31430000
314400                                                                  31440000
314500     EXEC CICS                                                    31450000
314600         WRITEQ TS                                                31460000
314700             QUEUE (ASC-LIST-QUEUE-NAME)                          31470000
314800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31480000
314900             ITEM  (PV-BLOCK-NUMBER)                              31490000
315000             REWRITE                                              31500000
315100             RESP  (PV-CICS-RESP)                                 31510000
315200     END-EXEC.                                                    31520000
315300                                                                  31530000
315400     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           31540000
315500         CONTINUE                                                 31550000
315600     ELSE                                                         31560000
315700         SET DP013-CICS-ABEND      TO TRUE                        31570000
315800         SET DP013-NO-ROLLBACK     TO TRUE                        31580000
315900         MOVE '5105-REWRITE-ASC-LISTQ'                            31590000
316000                                   TO DP013-PARAGRAPH             31600000
316100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     31610000
316200                                   TO DP013-MESSAGE-TEXT(1)       31620000
316300         PERFORM DP013-0000-PROCESS-ABEND                         31630000
316400     END-IF.                                                      31640000
316500                                                                  31650000
316600/                                                                 31660000
316700*----------------------------------------------------------------*31670000
316800*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *31680000
316900*  SPECIFIC COMMAREA.                                            *31690000
317000*----------------------------------------------------------------*31700000
317100 5110-WRITE-ASC-LISTQ.                                            31710000
317200                                                                  31720000
317300     EXEC CICS                                                    31730000
317400         WRITEQ TS                                                31740000
317500             QUEUE (ASC-LIST-QUEUE-NAME)                          31750000
317600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31760000
317700             ITEM  (PV-BLOCK-NUMBER)                              31770000
317800             RESP  (PV-CICS-RESP)                                 31780000
317900     END-EXEC.                                                    31790000
318000                                                                  31800000
318100     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      31810000
318200         SET DP013-CICS-ABEND      TO TRUE                        31820000
318300         SET DP013-NO-ROLLBACK     TO TRUE                        31830000
318400         MOVE '5110-WRITE-ASC-LISTQ'                              31840000
318500                                   TO DP013-PARAGRAPH             31850000
318600         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           31860000
318700                                   TO DP013-MESSAGE-TEXT(1)       31870000
318800         PERFORM DP013-0000-PROCESS-ABEND                         31880000
318900     END-IF.                                                      31890000
319000                                                                  31900000
319100/                                                                 31910000
319200*----------------------------------------------------------------*31920000
319300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *31930000
319400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *31940000
319500*----------------------------------------------------------------*31950000
319600                                                                  31960000
319700 5200-FILL-SEL-QUEUE-RECORD.                                      31970000
319800                                                                  31980000
319900     PERFORM 6112-READ-LIST-QUEUE.                                31990000
320000                                                                  32000000
320100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       32010000
320200         PERFORM                                                  32020000
320300         VARYING LQW-IDX                                          32030000
320400         FROM 1 BY 1                                              32040000
320500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            32050000
320600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          32060000
320700                                                                  32070000
320800             IF  LQW-SELECT (LQW-IDX)                             32080000
320900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              32090000
321000                                   TO RC013-ITEM (RC013-IDX)      32100000
321100                 MOVE LQW-REC-SEQ-NBR (LQW-IDX)                   32110000
321200                                   TO RC013-REC-SEQ-NBR           32120000
321300                                        (RC013-IDX)               32130000
321400                                     RC015-REC-SEQ-NBR            32140000
321500                 MOVE LQW-ARRIVAL-DTE-ISO (LQW-IDX)               32150000
321600                                   TO RC013-ARRIVAL-DTE(RC013-IDX)32160000
321700                 MOVE ASC-KEY-PO-NBR                              32170000
321800                                   TO RC013-PO-NBR (RC013-IDX)    32180000
321900                 MOVE LQW-SHIPT-ID (LQW-IDX)                      32190000
322000                                   TO RC013-SHIPT-ID (RC013-IDX)  32200000
322100                 MOVE LQW-TRIP-ID (LQW-IDX)                       32210000
322200                                   TO RC013-TRIP-ID (RC013-IDX)   32220000
322300                 MOVE LQW-OPER-UNT-ID (LQW-IDX)                   32230000
322400                                   TO RC013-OPER-UNT-ID(RC013-IDX)32240000
322500                 MOVE LQW-FCLTY-ID (LQW-IDX)                      32250000
322600                                   TO RC013-FCLTY-ID(RC013-IDX)   32260000
322700                 MOVE LQW-ACTION (LQW-IDX)                        32270000
322800                                   TO RC013-ACTION-SW (RC013-IDX) 32280000
322900                 MOVE SPACE        TO RC013-ACTION-SW (RC013-IDX) 32290000
323000                 SET RC013-IDX UP BY 1                            32300000
323100                 IF  RC013-IDX > RC013-MAX-ITEMS                  32310000
323200                     PERFORM 5205-WRITE-SEL-QUEUE                 32320000
323300                     ADD +1        TO RC015-NUMBER-OF-TS-ITEMS    32330000
323400                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         32340000
323500                     SET RC013-IDX TO 1                           32350000
323600                 END-IF                                           32360000
323700             END-IF                                               32370000
323800         END-PERFORM                                              32380000
323900     END-IF.                                                      32390000
324000                                                                  32400000
324100/                                                                 32410000
324200*----------------------------------------------------------------*32420000
324300* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *32430000
324400* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *32440000
324500*----------------------------------------------------------------*32450000
324600                                                                  32460000
324700 5200A-FILL-SEL-QUEUE-RECORD.                                     32470000
324800                                                                  32480000
324900     PERFORM 6112-READ-LIST-QUEUE.                                32490000
325000                                                                  32500000
325100     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       32510000
325200         PERFORM                                                  32520000
325300         VARYING LQW-IDX                                          32530000
325400         FROM 1 BY 1                                              32540000
325500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            32550000
325600           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          32560000
325700                                                                  32570000
325800             IF  LQW-SELECT (LQW-IDX)                             32580000
325900                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              32590000
326000                                   TO SU010-ITEM (SU010-IDX)      32600000
326100                 MOVE ASC-KEY-PO-NBR TO DK-TRN-NBR                32610000
326200                 MOVE LQW-REC-SEQ-NBR (LQW-IDX)                   32620000
326300                                     TO DK-RCVR-NBR               32630000
326400                 MOVE DK-PO-RCVR     TO SU009-PO-RCVR             32640000
326500                                        SU010-PO-RCVR (SU010-IDX) 32650000
326600                                                                  32660000
326700                 MOVE LQW-ACTION (LQW-IDX)                        32670000
326800                                   TO SU010-ACTION-SW (SU010-IDX) 32680000
326900                 MOVE SPACE        TO SU010-ACTION-SW (SU010-IDX) 32690000
327000                 SET SU010-IDX UP BY 1                            32700000
327100                 IF  SU010-IDX > SU010-MAX-ITEMS                  32710000
327200                     PERFORM 5205A-WRITE-SEL-QUEUE                32720000
327300                     ADD +1        TO SU009-NUMBER-OF-TS-ITEMS    32730000
327400                     INITIALIZE SU010-SELECTED-ITEM-ARRAY         32740000
327500                     SET SU010-IDX TO 1                           32750000
327600                 END-IF                                           32760000
327700             END-IF                                               32770000
327800         END-PERFORM                                              32780000
327900     END-IF.                                                      32790000
328000                                                                  32800000
328100/                                                                 32810000
328200*----------------------------------------------------------------*32820000
328300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *32830000
328400*----------------------------------------------------------------*32840000
328500                                                                  32850000
328600 5205-WRITE-SEL-QUEUE.                                            32860000
328700                                                                  32870000
328800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            32880000
328900                                   TO RC013-SELECTED-ITEMS.       32890000
329000                                                                  32900000
329100     EXEC CICS                                                    32910000
329200          WRITEQ TS                                               32920000
329300              QUEUE (ASC-SEL-QUEUE-NAME-2)                        32930000
329400              FROM  (RC013-DC-SELECT-RECORD)                      32940000
329500              ITEM  (PV-SEL-QUEUE-ITEM)                           32950000
329600              RESP  (PV-CICS-RESP)                                32960000
329700     END-EXEC.                                                    32970000
329800                                                                  32980000
329900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32990000
330000         CONTINUE                                                 33000000
330100     ELSE                                                         33010000
330200         SET DP013-CICS-ABEND      TO TRUE                        33020000
330300         SET DP013-NO-ROLLBACK     TO TRUE                        33030000
330400         MOVE '5205-WRITE-SEL-QUEUE'                              33040000
330500                                   TO DP013-PARAGRAPH             33050000
330600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          33060000
330700                                   TO DP013-MESSAGE-TEXT(1)       33070000
330800         PERFORM DP013-0000-PROCESS-ABEND                         33080000
330900     END-IF.                                                      33090000
331000                                                                  33100000
331100/                                                                 33110000
331200*----------------------------------------------------------------*33120000
331300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *33130000
331400*----------------------------------------------------------------*33140000
331500                                                                  33150000
331600 5205A-WRITE-SEL-QUEUE.                                           33160000
331700                                                                  33170000
331800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            33180000
331900                                   TO SU010-SELECTED-ITEMS.       33190000
332000                                                                  33200000
332100     EXEC CICS                                                    33210000
332200          WRITEQ TS                                               33220000
332300              QUEUE (ASC-SEL-QUEUE-NAME)                          33230000
332400              FROM  (SU010-SELECT-RECORD)                         33240000
332500              ITEM  (PV-SEL-QUEUE-ITEM)                           33250000
332600              RESP  (PV-CICS-RESP)                                33260000
332700     END-EXEC.                                                    33270000
332800                                                                  33280000
332900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33290000
333000         CONTINUE                                                 33300000
333100     ELSE                                                         33310000
333200         SET DP013-CICS-ABEND      TO TRUE                        33320000
333300         SET DP013-NO-ROLLBACK     TO TRUE                        33330000
333400         MOVE '5205A-WRITE-SEL-QUEUE'                             33340000
333500                                   TO DP013-PARAGRAPH             33350000
333600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          33360000
333700                                   TO DP013-MESSAGE-TEXT(1)       33370000
333800         PERFORM DP013-0000-PROCESS-ABEND                         33380000
333900     END-IF.                                                      33390000
334000                                                                  33400000
334100/                                                                 33410000
334200*----------------------------------------------------------------*33420000
334300*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *33430000
334400*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *33440000
334500*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *33450000
334600*  THE USER.                                                     *33460000
334700*----------------------------------------------------------------*33470000
334800 6000-REFRESH-PANEL-FROM-TEMP.                                    33480000
334900                                                                  33490000
335000     IF  ASC-UPDATE-TSQ AND ASC-NUMBER-OF-SELECTED-ITEMS > 0      33500000
335100         SET ASC-NO-TSQ-UPDATE     TO TRUE                        33510000
335200         MOVE ZERO                 TO PV-SAVE-ITEM                33520000
335300                                      PV-SEL-QUEUE-ITEM           33530000
335400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        33540000
335500                                   TO PV-HOLD-SELECTED-ITEMS      33550000
335600         MOVE +1                   TO PV-ITEMS-PROCESSED          33560000
335700         EVALUATE TRUE                                            33570000
335800            WHEN ASC-FUNC03-RETURN-YES                            33580000
335900               PERFORM 6100A-UPDATE-TSQ                           33590000
336000                   UNTIL PV-ITEMS-PROCESSED >                     33600000
336100                                        PV-HOLD-SELECTED-ITEMS    33610000
336200            WHEN OTHER                                            33620000
336300               PERFORM 6100-UPDATE-TSQ                            33630000
336400                   UNTIL PV-ITEMS-PROCESSED >                     33640000
336500                                        PV-HOLD-SELECTED-ITEMS    33650000
336600         END-EVALUATE                                             33660000
336700                                                                  33670000
336800         SET ASC-FUNC03-RETURN-NO TO TRUE                         33680000
336900                                                                  33690000
337000         PERFORM 6010-DELETE-SEL-QUEUE                            33700000
337100         INITIALIZE ASC-BLOCK-ENTRIES (1)                         33710000
337200                    ASC-BLOCK-ENTRIES (2)                         33720000
337300     END-IF.                                                      33730000
337400                                                                  33740000
337500/                                                                 33750000
337600*----------------------------------------------------------------*33760000
337700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *33770000
337800*----------------------------------------------------------------*33780000
337900 6010-DELETE-SEL-QUEUE.                                           33790000
338000                                                                  33800000
338100     EXEC CICS                                                    33810000
338200         DELETEQ TS                                               33820000
338300             QUEUE (ASC-SEL-QUEUE-NAME-2)                         33830000
338400             RESP  (PV-CICS-RESP)                                 33840000
338500     END-EXEC.                                                    33850000
338600                                                                  33860000
338700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      33870000
338800         (PV-CICS-RESP = DFHRESP(QIDERR)))                        33880000
338900         CONTINUE                                                 33890000
339000     ELSE                                                         33900000
339100         SET DP013-CICS-ABEND      TO TRUE                        33910000
339200         SET DP013-NO-ROLLBACK     TO TRUE                        33920000
339300         MOVE '6010-DELETE-SEL-QUEUE'                             33930000
339400                                   TO DP013-PARAGRAPH             33940000
339500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         33950000
339600                                   TO DP013-MESSAGE-TEXT (1)      33960000
339700         PERFORM DP013-0000-PROCESS-ABEND                         33970000
339800     END-IF.                                                      33980000
339900                                                                  33990000
340000/                                                                 34000000
340100*----------------------------------------------------------------*34010000
340200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *34020000
340300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *34030000
340400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *34040000
340500*    THE TEMP QUEUE.                                             *34050000
340600*----------------------------------------------------------------*34060000
340700                                                                  34070000
340800 6100-UPDATE-TSQ.                                                 34080000
340900                                                                  34090000
341000     ADD 1                         TO PV-SEL-QUEUE-ITEM.          34100000
341100     PERFORM 6105-READ-SEL-QUEUE.                                 34110000
341200                                                                  34120000
341300     PERFORM                                                      34130000
341400         VARYING RC013-IDX                                        34140000
341500         FROM 1 BY 1                                              34150000
341600         UNTIL ((PV-ITEMS-PROCESSED >                             34160000
341700                              PV-HOLD-SELECTED-ITEMS)             34170000
341800         OR (RC013-IDX GREATER THAN RC013-MAX-ITEMS))             34180000
341900         IF  RC013-ACTION-SW (RC013-IDX) > SPACE                  34190000
342000             PERFORM 6110-PROCESS-ITEMS                           34200000
342100         END-IF                                                   34210000
342200         ADD +1                    TO PV-ITEMS-PROCESSED          34220000
342300     END-PERFORM.                                                 34230000
342400                                                                  34240000
342500     PERFORM 6111-WRITE-LIST-QUEUE.                               34250000
342600                                                                  34260000
342700/                                                                 34270000
342800*----------------------------------------------------------------*34280000
342900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *34290000
343000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *34300000
343100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *34310000
343200*    THE TEMP QUEUE.                                             *34320000
343300*----------------------------------------------------------------*34330000
343400                                                                  34340000
343500 6100A-UPDATE-TSQ.                                                34350000
343600                                                                  34360000
343700     ADD 1                         TO PV-SEL-QUEUE-ITEM.          34370000
343800     PERFORM 6105A-READ-SEL-QUEUE.                                34380000
343900                                                                  34390000
344000     PERFORM                                                      34400000
344100         VARYING SU010-IDX                                        34410000
344200         FROM 1 BY 1                                              34420000
344300         UNTIL ((PV-ITEMS-PROCESSED >                             34430000
344400                              PV-HOLD-SELECTED-ITEMS)             34440000
344500         OR (SU010-IDX GREATER THAN SU010-MAX-ITEMS))             34450000
344600         IF  SU010-ACTION-SW (SU010-IDX) > SPACE                  34460000
344700             PERFORM 6110A-PROCESS-ITEMS                          34470000
344800         END-IF                                                   34480000
344900         ADD +1                    TO PV-ITEMS-PROCESSED          34490000
345000     END-PERFORM.                                                 34500000
345100                                                                  34510000
345200     PERFORM 6111-WRITE-LIST-QUEUE.                               34520000
345300                                                                  34530000
345400/                                                                 34540000
345500*----------------------------------------------------------------*34550000
345600*    READ THE LIST QUEUE RECORD.                                 *34560000
345700*----------------------------------------------------------------*34570000
345800                                                                  34580000
345900 6105-READ-SEL-QUEUE.                                             34590000
346000                                                                  34600000
346100     EXEC CICS                                                    34610000
346200          READQ TS                                                34620000
346300              QUEUE (ASC-SEL-QUEUE-NAME-2)                        34630000
346400              INTO  (RC013-DC-SELECT-RECORD)                      34640000
346500              ITEM  (PV-SEL-QUEUE-ITEM)                           34650000
346600              RESP  (PV-CICS-RESP)                                34660000
346700     END-EXEC.                                                    34670000
346800                                                                  34680000
346900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34690000
347000         CONTINUE                                                 34700000
347100     ELSE                                                         34710000
347200         SET DP013-CICS-ABEND      TO TRUE                        34720000
347300         SET DP013-NO-ROLLBACK     TO TRUE                        34730000
347400         MOVE '6105-READ-SEL-QUEUE'                               34740000
347500                                   TO DP013-PARAGRAPH             34750000
347600         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           34760000
347700                                   TO DP013-MESSAGE-TEXT(1)       34770000
347800         PERFORM DP013-0000-PROCESS-ABEND                         34780000
347900     END-IF.                                                      34790000
348000                                                                  34800000
348100*----------------------------------------------------------------*34810000
348200*    READ THE LIST QUEUE RECORD.                                 *34820000
348300*----------------------------------------------------------------*34830000
348400                                                                  34840000
348500 6105A-READ-SEL-QUEUE.                                            34850000
348600                                                                  34860000
348700     EXEC CICS                                                    34870000
348800          READQ TS                                                34880000
348900              QUEUE (ASC-SEL-QUEUE-NAME)                          34890000
349000              INTO  (SU010-SELECT-RECORD)                         34900000
349100              ITEM  (PV-SEL-QUEUE-ITEM)                           34910000
349200              RESP  (PV-CICS-RESP)                                34920000
349300     END-EXEC.                                                    34930000
349400                                                                  34940000
349500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34950000
349600         CONTINUE                                                 34960000
349700     ELSE                                                         34970000
349800         SET DP013-CICS-ABEND      TO TRUE                        34980000
349900         SET DP013-NO-ROLLBACK     TO TRUE                        34990000
350000         MOVE '6105A-READ-SEL-QUEUE'                              35000000
350100                                   TO DP013-PARAGRAPH             35010000
350200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           35020000
350300                                   TO DP013-MESSAGE-TEXT(1)       35030000
350400         PERFORM DP013-0000-PROCESS-ABEND                         35040000
350500     END-IF.                                                      35050000
350600                                                                  35060000
350700/                                                                 35070000
350800*----------------------------------------------------------------*35080000
350900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*35090000
351000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*35100000
351100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *35110000
351200*----------------------------------------------------------------*35120000
351300                                                                  35130000
351400 6110-PROCESS-ITEMS.                                              35140000
351500                                                                  35150000
351600     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          35160000
351700                     / PC-ITEMS-PER-PANEL).                       35170000
351800                                                                  35180000
351900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           35190000
352000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          35200000
352100             PERFORM 6111-WRITE-LIST-QUEUE                        35210000
352200         END-IF                                                   35220000
352300         MOVE PV-ITEM              TO PV-SAVE-ITEM                35230000
352400                                                                  35240000
352500         PERFORM 6112-READ-LIST-QUEUE                             35250000
352600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               35260000
352700             CONTINUE                                             35270000
352800         END-IF                                                   35280000
352900     END-IF.                                                      35290000
353000                                                                  35300000
353100     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX)                     35310000
353200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              35320000
353300                                                                  35330000
353400     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       35340000
353500     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        35350000
353600                                     (PV-SUB).                    35360000
353700     EVALUATE TRUE                                                35370000
353800         WHEN RC013-INQ (RC013-IDX)                               35380000
353900              MOVE PC-INQ          TO LQW-ACTION (PV-SUB)         35390000
354000                                                                  35400000
354100         WHEN RC013-UPD (RC013-IDX)                               35410000
354200              MOVE PC-UPD          TO LQW-ACTION (PV-SUB)         35420000
354300                                                                  35430000
354400         WHEN RC013-DEL (RC013-IDX)                               35440000
354500              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         35450000
354600                                                                  35460000
354700         WHEN RC013-ERR (RC013-IDX)                               35470000
354800              MOVE PC-ERR          TO LQW-ACTION (PV-SUB)         35480000
354900     END-EVALUATE.                                                35490000
355000                                                                  35500000
355100     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                35510000
355200                                                                  35520000
355300/                                                                 35530000
355400*----------------------------------------------------------------*35540000
355500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*35550000
355600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*35560000
355700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *35570000
355800*----------------------------------------------------------------*35580000
355900                                                                  35590000
356000 6110A-PROCESS-ITEMS.                                             35600000
356100                                                                  35610000
356200     COMPUTE PV-ITEM = 1 + ((SU010-ITEM (SU010-IDX) - 1)          35620000
356300                     / PC-ITEMS-PER-PANEL).                       35630000
356400                                                                  35640000
356500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           35650000
356600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          35660000
356700             PERFORM 6111-WRITE-LIST-QUEUE                        35670000
356800         END-IF                                                   35680000
356900         MOVE PV-ITEM              TO PV-SAVE-ITEM                35690000
357000                                                                  35700000
357100         PERFORM 6112-READ-LIST-QUEUE                             35710000
357200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               35720000
357300             CONTINUE                                             35730000
357400         END-IF                                                   35740000
357500     END-IF.                                                      35750000
357600                                                                  35760000
357700     COMPUTE PV-SUB = (SU010-ITEM (SU010-IDX)                     35770000
357800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              35780000
357900                                                                  35790000
358000     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       35800000
358100     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        35810000
358200                                     (PV-SUB).                    35820000
358300     EVALUATE TRUE                                                35830000
358400         WHEN SU010-INQ (SU010-IDX)                               35840000
358500              MOVE PC-INQ          TO LQW-ACTION (PV-SUB)         35850000
358600                                                                  35860000
358700         WHEN SU010-UPD (SU010-IDX)                               35870000
358800              MOVE PC-UPD          TO LQW-ACTION (PV-SUB)         35880000
358900                                                                  35890000
359000         WHEN SU010-DEL (SU010-IDX)                               35900000
359100              MOVE PC-DEL          TO LQW-ACTION (PV-SUB)         35910000
359200                                                                  35920000
359300         WHEN SU010-ERR (SU010-IDX)                               35930000
359400              MOVE PC-ERR          TO LQW-ACTION (PV-SUB)         35940000
359500     END-EVALUATE.                                                35950000
359600                                                                  35960000
359700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                35970000
359800                                                                  35980000
359900/                                                                 35990000
360000*----------------------------------------------------------------*36000000
360100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *36010000
360200*----------------------------------------------------------------*36020000
360300                                                                  36030000
360400 6111-WRITE-LIST-QUEUE.                                           36040000
360500                                                                  36050000
360600     EXEC CICS                                                    36060000
360700         WRITEQ TS                                                36070000
360800             QUEUE (ASC-LIST-QUEUE-NAME)                          36080000
360900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     36090000
361000             ITEM  (PV-SAVE-ITEM)                                 36100000
361100             REWRITE                                              36110000
361200             RESP  (PV-CICS-RESP)                                 36120000
361300     END-EXEC.                                                    36130000
361400                                                                  36140000
361500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          36150000
361600     OR  PV-CICS-RESP = DFHRESP (ITEMERR)                         36160000
361700         CONTINUE                                                 36170000
361800     ELSE                                                         36180000
361900         SET DP013-CICS-ABEND      TO TRUE                        36190000
362000         SET DP013-NO-ROLLBACK     TO TRUE                        36200000
362100         MOVE '6111-WRITE-LIST-QUEUE'                             36210000
362200                                   TO DP013-PARAGRAPH             36220000
362300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  36230000
362400                                   TO DP013-MESSAGE-TEXT(1)       36240000
362500         PERFORM DP013-0000-PROCESS-ABEND                         36250000
362600     END-IF.                                                      36260000
362700                                                                  36270000
362800/                                                                 36280000
362900*----------------------------------------------------------------*36290000
363000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*36300000
363100*----------------------------------------------------------------*36310000
363200                                                                  36320000
363300 6112-READ-LIST-QUEUE.                                            36330000
363400                                                                  36340000
363500     EXEC CICS                                                    36350000
363600         READQ TS                                                 36360000
363700             QUEUE (ASC-LIST-QUEUE-NAME)                          36370000
363800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     36380000
363900             ITEM  (PV-ITEM)                                      36390000
364000             RESP  (PV-CICS-RESP)                                 36400000
364100     END-EXEC.                                                    36410000
364200                                                                  36420000
364300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          36430000
364400         CONTINUE                                                 36440000
364500     ELSE                                                         36450000
364600         SET DP013-CICS-ABEND      TO TRUE                        36460000
364700         SET DP013-NO-ROLLBACK     TO TRUE                        36470000
364800         MOVE '6112-READ-LIST-QUEUE'                              36480000
364900                                   TO DP013-PARAGRAPH             36490000
365000         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    36500000
365100                                   TO DP013-MESSAGE-TEXT(1)       36510000
365200         PERFORM DP013-0000-PROCESS-ABEND                         36520000
365300     END-IF.                                                      36530000
365400                                                                  36540000
365500/                                                                 36550000
365600 7000-FORMAT-COMMAREA.                                            36560000
365700                                                                  36570000
365800     IF ASC-BLOCK-MODIFIED-SW(1) = 'Y'                            36580000
365900        MOVE 1                   TO PV-BLOCK-NUMBER               36590000
366000     ELSE                                                         36600000
366100        MOVE 2                   TO PV-BLOCK-NUMBER               36610000
366200     END-IF.                                                      36620000
366300                                                                  36630000
366400                                                                  36640000
366500     PERFORM VARYING PV-SUB FROM 1 BY 1                           36650000
366600             UNTIL  PV-SUB > PC-ITEMS-PER-PANEL                   36660000
366700         IF  ASC-SELECTED-SW  (PV-BLOCK-NUMBER PV-SUB) = 'S'      36670000
366800             MOVE ASC-REC-SEQ-NBR (PV-BLOCK-NUMBER PV-SUB)        36680000
366900                                  TO RC015-REC-SEQ-NBR            36690000
367000             MOVE ASC-OPER-UNT-ID (PV-BLOCK-NUMBER PV-SUB)        36700000
367100                                  TO RC015-OPER-UNT-ID            36710000
367200             MOVE ASC-FCLTY-ID (PV-BLOCK-NUMBER PV-SUB)           36720000
367300                                  TO RC015-FCLTY-ID               36730000
367400             COMPUTE PV-SUB = PC-ITEMS-PER-PANEL + 1              36740000
367500         END-IF                                                   36750000
367600     END-PERFORM.                                                 36760000
367700                                                                  36770000
367800     MOVE ASC-KEY-PO-NBR          TO RC015-PO-NBR.                36780000
367900                                                                  36790000
368000/                                                                 36800000
368100*----------------------------------------------------------------*36810000
368200*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *36820000
368300*----------------------------------------------------------------*36830000
368400                                                                  36840000
368500 9100-READ-SEL-QUEUE.                                             36850000
368600     EXEC CICS                                                    36860000
368700         READQ TS                                                 36870000
368800             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        36880000
368900             INTO  (RC013-DC-SELECT-RECORD)                       36890000
369000             ITEM  (ASC-SEL-ITEM)                                 36900000
369100             RESP  (PV-CICS-RESP)                                 36910000
369200     END-EXEC.                                                    36920000
369300                                                                  36930000
369400     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       36940000
369500         CONTINUE                                                 36950000
369600     ELSE                                                         36960000
369700         SET DP013-LOGIC-ABEND                                    36970000
369800             DP013-NO-ROLLBACK     TO TRUE                        36980000
369900         MOVE '9100-READ-SEL-QUEUE'                               36990000
370000                                   TO DP013-PARAGRAPH             37000000
370100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   37010000
370200                                   TO DP013-MESSAGE-TEXT (1)      37020000
370300         PERFORM DP013-0000-PROCESS-ABEND                         37030000
370400     END-IF.                                                      37040000
370500                                                                  37050000
370600/                                                                 37060000
370700*----------------------------------------------------------------*37070000
370800*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *37080000
370900*----------------------------------------------------------------*37090000
371000 9200-REWRITE-LIST-QUEUE.                                         37100000
371100     EXEC CICS                                                    37110000
371200          WRITEQ TS                                               37120000
371300              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      37130000
371400              FROM   (RC013-DC-SELECT-RECORD)                     37140000
371500              ITEM   (ASC-SEL-ITEM)                               37150000
371600              RESP   (PV-CICS-RESP)                               37160000
371700              REWRITE                                             37170000
371800     END-EXEC.                                                    37180000
371900                                                                  37190000
372000     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   37200000
372100         SET DP013-CICS-ABEND                                     37210000
372200             DP013-NO-ROLLBACK     TO TRUE                        37220000
372300         MOVE '9200-REWRITE-LIST-QUEUE'                           37230000
372400                                   TO DP013-PARAGRAPH             37240000
372500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   37250000
372600                                   TO DP013-MESSAGE-TEXT (1)      37260000
372700         PERFORM DP013-0000-PROCESS-ABEND                         37270000
372800     END-IF.                                                      37280000
372900                                                                  37290000
373000*----------------------------------------------------------------*37300000
373100*    THE DB2 TROUBLE IS NOT AVAILABLE, SET THE ERROR MESSAGE     *37310000
373200*    AND THE ERROR SWITCHES.                                     *37320000
373300*----------------------------------------------------------------*37330000
373400*9900-SOFT-ABORT.                                                 37340000
373500*    SET PS-ERROR         TO TRUE.                                37350000
373600*    SET DP020-MSG-FATAL  TO TRUE.                                37360000
373700*    MOVE PC-TSYMSG-01089 TO DP020-MSG-NUMBER.                    37370000
373800*    IF PS-NO-NEXT-SCREEN                                         37380000
373900*       SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                     37390000
374000*    END-IF.                                                      37400000
374100*    IF PS-UPDATES-DONE AND SQLCODE = -913                        37410000
374200*       PERFORM 9901-BACKUP                                       37420000
374300*    END-IF.                                                      37430000
374400*    MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          37440000
374500*    PERFORM 0001-CALL-CICS-ARCH-API.                             37450000
374600                                                                  37460000
374700/                                                                 37470000
374800*----------------------------------------------------------------*37480000
374900*    ABEND PROCESSOR MODULE                                      *37490000
375000*----------------------------------------------------------------*37500000
375100                                                                  37510000
375200     COPY DPPD013.                                                37520000
