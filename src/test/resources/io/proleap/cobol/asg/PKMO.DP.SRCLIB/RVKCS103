000100 IDENTIFICATION DIVISION.                                                 
000200                                                                          
000300 PROGRAM-ID.    RVKCS103.                                                 
000400 AUTHOR.        NATALIYA PALATNIK                                         
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  12-11-92.                                                 
000700 DATE-COMPILED.                                                           
000800******************************************************************        
000900*      THIS IS A PROGRAM FOR REQ RA ORDER HEADER DELETE.                  
001000*                                                                         
001100*      TRANSID T103                                                       
001200******************************************************************        
001300* 12/04/96 - TCM -  WR NO. 3904                                  *        
001400*    - DISALLOW DELETE ABILITY FOR "MARKOUT" ORDERS              *        
001500******************************************************************        
001600* 12/31/96 - TCM -  WR NO. 3904                                  *        
001700*    - DELETE UNUSED WORKING-STORAGE FIELDS                      *        
001800*    - REPLACE ALL "++INCLUDE" REFERENCES WITH "COPY"            *        
001900*      REFERENCES, PER STANDARDS                                 *        
002000*    - ADD DELETION OF PERM IN-STORE DETAIL RECORDS, UPDATE OF   *        
002100*      PERM IN-STORE HEADER RECORDS FOR A DELETED LISTING        *        
002200*      NOTE: IF A LISTING HAS COMPLETED PERMS ASSOCIATED WITH    *        
002300*            IT, IT CANNOT BE DELETED                            *        
002400******************************************************************        
002500* 01/03/97 - TCM -  WR NO. P000057544                            *        
002600*    - ALLOW LISTING DELETES FOR ALL DOCUMENTS, CORRECT PROGRAM  *        
002700*      TO ONLY LOOK FOR PERM DOCUMENTS ON "MARKOUTS" THAT ARE NO *        
002800*      LONGER "OPEN"                                             *        
002900******************************************************************        
003000* 04/11/03 - S PRABHAKAR RAO, IGSI - WR NO. 23022                *        
003100*    - REPLACED ALL REFERENCES TO TSK TABLE WITH XLT_SKU,        *        
003200*      XLT_VND_STYL TABLES                                       *        
003300* 10/30/03 - PAUL OMAN - WR?????                                 *        
003400*    - ADD NEW PARAGRAPHES TO DELETE RECORDS FROM RVT_DFCT_SHIPT *        
003500*      WHEN ALL OF THE LISTINGS ASSOCIATED WITH THE SHIPMENT     *        
003600*      ARE DELETED.  PARAGRAPHES ARE L600 AND L650.              *        
003700******************************************************************        
003710* 02/03/04 - JOE LAROSA - WR23568                                *        
003720*    - CHGD PROGRAM TO NOT ALLOW LISTING TO BE DELETED           *        
003730*      IF STATUS IS SHIPPED, APPROVED OR DISPOSED.               *        
003750******************************************************************        
003800*                                                                         
003900 ENVIRONMENT DIVISION.                                                    
004000*                                                                         
004100*                                                                         
004200 DATA DIVISION.                                                           
004300*                                                                         
004400*                                                                         
004500 WORKING-STORAGE SECTION.                                                 
004600                                                                          
004700 01  PC-PROGRAM-CONSTANTS.                                                
004800* PC-NAVIGATOR-TRAN-ID NEEDED IN DPPD015                                  
004900     05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.        
005000* PC-MAXIMUM-COMMAREA-LENGTH NEEDED IN DPPD015                            
005100     05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072          
005200                                                     COMP SYNC.           
005300     05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE                
005400     'RV103A  '.                                                          
005500     05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE                
005600     'RVKM103 '.                                                          
005700     05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE                
005800     'RVKCS103'.                                                          
005900     05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128           
006000                                                     COMP SYNC.           
006100     05  FILLER REDEFINES PC-ERASE-EOF-COMP.                              
006200         10  FILLER                     PIC X(01).                        
006300         10  PC-ERASE-EOF               PIC X(01).                        
006400     05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3              
006500                                                     COMP-3.              
006600                                                                          
006700                                                                          
006800 01  PC-TSYMSG-NUMBERS.                                                   
006900     05  PC-TSYMSG-00004                PIC 9(5)    VALUE 00004.          
007000     05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.          
007100     05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.          
007200     05  PC-TSYMSG-00115                PIC 9(5)    VALUE 00115.          
007300     05  PC-TSYMSG-00116                PIC 9(5)    VALUE 00116.          
007400     05  PC-TSYMSG-00118                PIC 9(5)    VALUE 00118.          
007500     05  PC-TSYMSG-00148                PIC 9(5)    VALUE 00148.          
007600     05  PC-TSYMSG-01480                PIC 9(5)    VALUE 01480.          
007700     05  PC-TSYMSG-03219                PIC 9(5)    VALUE 03219.          
007800*                                                                         
007900 01  PM-PROGRAM-MESSAGES.                                                 
008000     05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE                
008100     'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                        
008200     05  PM-PROGRAM-MESSAGE-22          PIC X(78)    VALUE                
008300     'LOGIC ERROR IN TRYING TO READ RA     QUEUE - RESP = '.              
008400     05  FILLER REDEFINES PM-PROGRAM-MESSAGE-22.                          
008500         10  FILLER                     PIC X(61).                        
008600         10  PM-RESP-22                 PIC 9999.                         
008700         10  FILLER                     PIC X(13).                        
008800                                                                          
008900 01  PS-PROGRAM-SWITCHES.                                                 
009000     05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.           
009100         88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.           
009200* PS-SEND-MAP-N-DATA-FRSET-CPOSN NEEDED IN DPPD008                        
009300         88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.           
009400         88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.           
009500         88  PS-SEND-DATA-ONLY                       VALUE '4'.           
009600* PS-SEND-DATA-ONLY-ERASEAUP NEEDED IN DPPD008                            
009700         88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.           
009800* PS-SEND-MAP-ONLY-FRSET NEEDED IN DPPD008                                
009900         88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.           
010000     05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.           
010100         88  PS-ERROR                                VALUE 'Y'.           
010200         88  PS-NO-ERROR                             VALUE 'N'.           
010300     05  PS-TDFCTOR-FOUND-SW            PIC X(01)    VALUE 'N'.           
010400         88  PS-TDFCTOR-FOUND                        VALUE 'Y'.           
010500         88  PS-TDFCTOR-NOT-FOUND                    VALUE 'N'.           
010600     05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.           
010700         88  CONTINUE-PROCESSING                     VALUE 'Y'.           
010800         88  STOP-PROCESSING                         VALUE 'N'.           
010900     05  PS-DELETE-OK-SW                PIC X(01)    VALUE 'Y'.           
011000         88  PS-DELETE-OK-YES                        VALUE 'Y'.           
011100         88  PS-DELETE-OK-NO                         VALUE 'N'.           
011200                                                                          
011300 01  PV-PROGRAM-VARIABLES.                                                
011400     05  PV-DB2-OPER-UNT-ID        PIC S9(04)   VALUE +0                  
011500                                                COMP SYNC.                
011600     05  PV-DFCT-SHIPT-ID-IND      PIC S9(04)   VALUE +0 COMP.            
011700         88  PV-DFCT-SHIPT-ID-NULL              VALUE -1.                 
011800* PV-CICS-RESPONSE NEEDED IN DPPD005                                      
011900     05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0             
012000                                                     COMP SYNC.           
012100     05  PV-RESP                        PIC S9(04)   VALUE +0             
012200                                                     COMP SYNC.           
012300     05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.        
012400     05  PV-SQL-SUB                     PIC S9(4)    COMP.                
012500                                                                          
012600     05  PV-RETAIL                      PIC S9(9)V99 VALUE +0             
012700                                                     COMP-3.              
012800     05  PV-COST                        PIC S9(9)V99 VALUE +0             
012900                                                     COMP-3.              
013000     05  PV-QTY                         PIC S9(7)    VALUE +0             
013100                                                     COMP-3.              
013200     05  PV-TOT-RETAIL                  PIC S9(9)V99 VALUE +0             
013300                                                     COMP-3.              
013400     05  PV-TOT-COST                    PIC S9(9)V99 VALUE +0             
013500                                                     COMP-3.              
013600     05  PV-TOT-QTY                     PIC S9(7)    VALUE +0             
013700                                                     COMP-3.              
013800     05  PV-TDFCTOR-COUNT               PIC S9(5)    VALUE +0             
013900                                                     COMP-3.              
014000     05  PV-CP-PERM-COUNT               PIC  X(01)   VALUE SPACES.        
014100                                                                          
014200     05  PV-DEPT-LIST-AUTH.                                               
014300         10  FILLER                     PIC  X(04)   VALUE '___/'.        
014400         10  PV-LIST-NUMBER             PIC  9(12).                       
014500         10  FILLER                     PIC  X(24)   VALUE                
014600             '/_______________________'.                                  
014700     05  PV-DEPT-AREA-DEST              PIC  X(40)   VALUE SPACES.        
014800                                                                          
014900     05  PV-PHONE.                                                        
015000         10  FILLER                     PIC X        VALUE '('.           
015100         10  PV-PHN-AREA-CODE           PIC X(03)    VALUE SPACES.        
015200         10  FILLER                     PIC X        VALUE ')'.           
015300         10  PV-PHN-EXCH-NBR            PIC X(03)    VALUE SPACES.        
015400         10  FILLER                     PIC X        VALUE '-'.           
015500         10  PV-PHN-NBR                 PIC X(04)    VALUE SPACES.        
015600                                                                          
015700     05  PV-FAX.                                                          
015800         10  FILLER                     PIC X        VALUE '('.           
015900         10  PV-FAX-PHN-AREA-CODE       PIC X(03)    VALUE SPACES.        
016000         10  FILLER                     PIC X        VALUE ')'.           
016100         10  PV-FAX-EXCH-NBR            PIC X(03)    VALUE SPACES.        
016200         10  FILLER                     PIC X        VALUE '-'.           
016300         10  PV-FAX-PHN-NBR             PIC X(04)    VALUE SPACES.        
016400                                                                          
016500     05  PV-VEND-ZIP-CODE-SFX           PIC 9(9)     VALUE ZEROS.         
016600     05  PV-VEND-ZIP-CODE-SFX-R         REDEFINES                         
016700         PV-VEND-ZIP-CODE-SFX.                                            
016800         10  PV-VEND-ZIP-CODE           PIC 9(5).                         
016900         10  PV-VEND-ZIP-SFX            PIC 9(4).                         
017000                                                                          
017100     05  PV-VEND-ZIP-CODE-SFX-PRINT.                                      
017200         10  PV-VEND-ZIP-CODE-PRINT     PIC 9(05)    VALUE ZEROS.         
017300         10  FILLER                     PIC X        VALUE '-'.           
017400         10  PV-VEND-ZIP-SFX-PRINT      PIC 9(04)    VALUE ZEROS.         
017500                                                                          
017600     05  PV-DFCT-ORD-ID          PIC S9(12)   VALUE +0  COMP-3.           
017700     05  PV-DFCT-SHIPT-ID        PIC S9(09)   VALUE +0  COMP.             
017800     05  PV-ITEMS-ON-DB2         PIC X        VALUE 'Y'.                  
017900         88  PV-NO-ITEMS-LEFT                    VALUE 'N'.               
018000     05  PV-DEPT                 PIC 9(4)     VALUE ZEROS.                
018100                                                                          
018200*****************************************************************         
018300*    STANDARD COMMAREA.                                                   
018400*****************************************************************         
018500     COPY DPWS020.                                                        
018600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
018700*****************************************************************         
018800*    INTER-APPLICATION COMMAREA.                                          
018900*****************************************************************         
019000         10  INTER-APPL-COMM-AREA       PIC X(200).                       
019100     COPY RVWS100.                                                        
019200*****************************************************************         
019300*    SPECIFIC COMMMAREA FOR RVKCS103.                                     
019400*****************************************************************         
019500         10  RV103-SPECIFIC-COMMAREA.                                     
019600             15  RV103-APPL-CURSOR-POSITION  PIC S9(04)                   
019700                                             COMP.                        
019800             15  RV103-RL-SUB                PIC S9(04)                   
019900                                             COMP.                        
020000             15  RV103-RL-ITEM               PIC S9(04)                   
020100                                             COMP.                        
020200             15  RV103-REQUEST-DATA.                                      
020300                                                                          
020400                 20  RV103-DFCT-ORD-ID       PIC 9(12).                   
020500                 20  RV103-ORDER-TYPE        PIC X(08).                   
020600                 20  RV103-ORDER-STATUS      PIC X(08).                   
020700                 20  RV103-LOCATION          PIC X(15).                   
020800                 20  RV103-STATUS-DATE       PIC X(10).                   
020900                 20  RV103-BUYER             PIC X(15).                   
021000                 20  RV103-DUNS-NBR          PIC X(09).                   
021100                 20  RV103-VEND-NAME         PIC X(20).                   
021200                 20  RV103-VEND-ATTN-NAME    PIC X(25).                   
021300                 20  RV103-TOTAL-QTY         PIC Z,ZZZ,ZZ9.               
021400                 20  RV103-TOTAL-RETAIL      PIC $$$$$$,$$9.99.           
021500                 20  RV103-TOTAL-COST        PIC $$$$$$,$$9.99.           
021600                 20  RV103-VEND-ADDR         PIC X(25).                   
021700                 20  RV103-VEND-CITY         PIC X(12).                   
021800                 20  RV103-VEND-STATE        PIC X(02).                   
021900                 20  RV103-VEND-ZIP-CODE-SFX PIC 9(09).                   
022000                 20  RV103-PHONE             PIC X(13).                   
022100                 20  RV103-FAX               PIC X(13).                   
022200                 20  RV103-DFCT-SHIPT-ID     PIC S9(9) COMP.              
022300                                                                          
022400             15  RV103-LIST-SWITCH           PIC X.                       
022500                 88  RV103-LIST              VALUE 'Y'.                   
022600                 88  RV103-NO-LIST           VALUE 'N'.                   
022700             15  RV103-CONFIRM-SWITCH        PIC X.                       
022800                 88  RV103-CONFIRM           VALUE 'Y'.                   
022900                 88  RV103-NO-CONFIRM        VALUE 'N'.                   
023000                                                                          
023100             15  RV103-TEMP-QUEU-NAME.                                    
023200                 20  RV103-TERM-ID           PIC X(04).                   
023300                 20  RV103-TASK-NUMBER       PIC S9(07)                   
023400                                             COMP-3.                      
023500             15  RV103-SAVE-INTER-APPL-COMM  PIC X(200).                  
023600             15  RV103-SAVE-TS-QUEUE         PIC X(1100).                 
023700         10  FILLER                          PIC X(1320).                 
023800                                                                          
023900*****************************************************************         
024000*    PERM PROGRAM CONSTANTS AND WORK AREAS                                
024100*****************************************************************         
024200     COPY PEWS049.                                                        
024300*****************************************************************         
024400*         LIST QUEUE RECORD LAYOUT.                                       
024500*****************************************************************         
024600     COPY RVWS101.                                                        
024700*****************************************************************         
024800*    ABEND PROCESSING COPYBOOK.                                           
024900*****************************************************************         
025000     COPY DPWS013.                                                        
025100*****************************************************************         
025200*    ATTRIBUTE SETTINGS COPYBOOK.                                         
025300*****************************************************************         
025400     COPY DPWS015.                                                        
025500*****************************************************************         
025600*    CURRENT DATE AND TIME COPYBOOK.                                      
025700*****************************************************************         
025800     COPY DPWS017.                                                        
025900*****************************************************************         
026000*    MESSAGE LAYOUT COPYBOOK.                                             
026100*    - DPWS006 NEEDED IN DPPD005                                          
026200*****************************************************************         
026300     COPY DPWS006.                                                        
026400*****************************************************************         
026500*    TOGGLE FUNCTION KEY LINES COPYBOOK.                                  
026600*****************************************************************         
026700     COPY DPWS009.                                                        
026800*****************************************************************         
026900*    FUNCTION KEYS COPYBOOK.                                              
027000*****************************************************************         
027100     COPY DPWS016.                                                        
027200*****************************************************************         
027300*    DPKUT045 COPYBOOK.                                                   
027400*                                                                         
027500*    DATA AREA NECESSARY TO INTERACT WITH SUB-ROUTINE DPKUT045            
027600*                                                                         
027700*    DPKUT045 IS A UTILITY ROUTINE THAT CONVERTS THE EIBAID               
027800*    CHARACTER RECEIVED FROM THE TERMINAL INTO A INTEGER VALUE            
027900*    FROM 1 TO 29. THIS INTEGER VALUE IS STORED IN DP020-SRC-AID          
028000*    AND IS USED TO INTERROGATE THE DP020-FUNCTION-KEY-ARRAY              
028100*    TABLE IN THE STANDARD COMMAREA TO DETERMINE WHAT TO DO NEXT.         
028200*    IN ADDITION DPKUT045 WILL PARSE THE SCREEN INPUT COMMAND             
028300*    FIELD AND CONVERT RECOGNIZED SCREEN MANIPULATION COMMANDS            
028400*    INTO THE DP020-SRC-AID EQUIVALENT.                                   
028500*    - DPWS045 NEEDED IN DPPD007                                          
028600*****************************************************************         
028700     COPY DPWS045.                                                        
028800*****************************************************************         
028900*    SYSTEM MESSAGES RECORD LAYOUT                                        
029000*****************************************************************         
029100     COPY DPRD507I.                                                       
029200*****************************************************************         
029300*    STANDARD ATTENTION IDENTIFIER LIST                                   
029400*****************************************************************         
029500     COPY DFHAID.                                                         
029600*****************************************************************         
029700*    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST                
029800*****************************************************************         
029900     COPY DFHBMSCA.                                                       
030000*****************************************************************         
030100*    MAP LAYOUT                                                           
030200*****************************************************************         
030300     COPY RVKM103.                                                        
030400 01  MD-MAP-DATA-AREA REDEFINES RV103AO.                                  
030500     05  FILLER                         PIC X(1000).                      
030600 EJECT                                                                    
030700*****************************************************************         
030800*    DB2 AREA FOR DEFECT ORDER TABLE                                      
030900*****************************************************************         
031000     EXEC SQL                                                             
031100         INCLUDE TDFCTOR                                                  
031200     END-EXEC.                                                            
031300*****************************************************************         
031400*    DB2 AREA FOR DEFECT ORDER ITEM TABLE                                 
031500*****************************************************************         
031600     EXEC SQL                                                             
031700         INCLUDE TDFMEIT                                                  
031800     END-EXEC.                                                            
031900*****************************************************************         
032000     EXEC SQL                                                             
032100         INCLUDE TMDSEAR                                                  
032200     END-EXEC.                                                            
032300*****************************************************************         
032400     EXEC SQL                                                             
032500         INCLUDE TRSPBAR                                                  
032600     END-EXEC.                                                            
032700*****************************************************************         
032800*    DB2 XLT_SKU TABLE                                                    
032900*****************************************************************         
033000     EXEC SQL                                                             
033100         INCLUDE XLT00003                                                 
033200     END-EXEC.                                                            
033300*****************************************************************         
033400*    DB2 XLT_VND_STYL TABLE                                               
033500*****************************************************************         
033600     EXEC SQL                                                             
033700         INCLUDE XLT00004                                                 
033800     END-EXEC.                                                            
033900*****************************************************************         
034000*    DB2 STATE TABLE                                                      
034100*****************************************************************         
034200     EXEC SQL                                                             
034300         INCLUDE TSTATE                                                   
034400     END-EXEC.                                                            
034500*****************************************************************         
034600*  DCLGEN LAYOUT AND COBOL DECLARATION OF THE IN-STORE HEADER             
034700*  DB2 TABLE.                                                             
034800*****************************************************************         
034900     EXEC SQL                                                             
035000         INCLUDE TSTRPPC                                                  
035100     END-EXEC.                                                            
035200*****************************************************************         
035300*  DCLGEN LAYOUT AND COBOL DECLARATION OF THE IN-STORE DETAIL             
035400*  DB2 TABLE.                                                             
035500*****************************************************************         
035600     EXEC SQL                                                             
035700         INCLUDE TSPPCDT                                                  
035800     END-EXEC.                                                            
035900*****************************************************************         
036000*    SHIPMENT (RVT_DFCT_SHIPT) DB2 TABLE                                  
036100*****************************************************************         
036200     EXEC SQL                                                             
036300         INCLUDE RVT00000                                                 
036400     END-EXEC.                                                            
036500*****************************************************************         
036600*    DB2 COMMUNICATION AREA                                               
036700*****************************************************************         
036800     EXEC SQL                                                             
036900         INCLUDE SQLCA                                                    
037000     END-EXEC.                                                            
037100*****************************************************************         
037200*    CURSOR DECLARE FOR TDFMEIT                                           
037300*****************************************************************         
037400     EXEC SQL                                                             
037500          DECLARE DFCT-ITEM CURSOR                                        
037600          FOR SELECT SUM(RTL_COST_AMT),                                   
037700                     SUM(UNIT_COST_AMT),                                  
037800                     COUNT(*)                                             
037900          FROM TDFMEIT                                                    
038000             WHERE                                                        
038100                 DFCT_ORD_ID  =  :DFCTOR-DFCT-ORD-ID                      
038200     END-EXEC.                                                            
038300*                                                                         
038400 EJECT                                                                    
038500*                                                                         
038600 LINKAGE SECTION.                                                         
038700                                                                          
038800 01  DFHCOMMAREA.                                                         
038900     05  FILLER                       OCCURS 1 TO 4072 TIMES              
039000                                      DEPENDING ON EIBCALEN.              
039100         10  FILLER                   PIC X.                              
039200*                                                                         
039300*                                                                         
039400 PROCEDURE DIVISION.                                                      
039500                                                                          
039600 A000-MAIN-MODULE.                                                        
039700                                                                          
039800******************************************************************        
039900*    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.                   
040000******************************************************************        
040100                                                                          
040200     PERFORM DP015-0000-CHECK-COMMAREA.                                   
040300                                                                          
040400******************************************************************        
040500*    DP020-SRC-RETURN-W-TRAN-ID WILL BE TRUE IF THIS PROGRAM WAS          
040600*    SENT A STANDARD COMMAREA. IF NOT SET TRUE (MEANING OTHER             
040700*    THAN A STANDARD COMMAREA WAS SENT TO THIS PROGRAM, THIS              
040800*    PROGRAM WILL RETURN TO CICS.                                         
040900******************************************************************        
041000     IF DP020-SRC-RETURN-W-TRAN-ID                                        
041100         PERFORM B000-CONTROL-PROCESSING                                  
041200     END-IF.                                                              
041300                                                                          
041400     PERFORM DP003-0000-RETURN-TO-CICS.                                   
041500 EJECT                                                                    
041600 B000-CONTROL-PROCESSING.                                                 
041700                                                                          
041800******************************************************************        
041900*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT            
042000*    COURSE OF ACTION IS FOR THIS TRANSACTION.                            
042100******************************************************************        
042200                                                                          
042300     EVALUATE TRUE                                                        
042400                                                                          
042500         WHEN DP020-NEXT-ACT-INITIAL                                      
042600             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                         
042700             SET DP020-NEXT-ACT-READ-MAP  TO TRUE                         
042800             SET CONTINUE-PROCESSING      TO TRUE                         
042900                                                                          
043000             PERFORM C100-INITIALIZE-COMMAREA                             
043100             MOVE RV100-INTER-APPL-COMMAREA TO                            
043200                      RV103-SAVE-INTER-APPL-COMM                          
043300                                                                          
043400             PERFORM C200-BUILD-INITIAL-PANEL                             
043500             IF  STOP-PROCESSING                                          
043600                 MOVE DP016-PF3  TO  DP020-SRC-AID                        
043700                 PERFORM  X400-NAVIGATE                                   
043800             END-IF                                                       
043900         WHEN DP020-NEXT-ACT-READ-MAP                                     
044000             PERFORM C300-PROCESS-MAP                                     
044100                                                                          
044200         WHEN DP020-NEXT-ACT-RETURN                                       
044300             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                         
044400             MOVE RV103-SAVE-INTER-APPL-COMM                              
044500                               TO RV100-INTER-APPL-COMMAREA               
044600             PERFORM E800-MOVE-COMMAREA-TO-SCREEN                         
044700             PERFORM E700-EDIT-DATA-IN-COMMAREA                           
044800             PERFORM E200-DISPLAY-PANEL                                   
044900*                                                                         
045000         WHEN DP020-NEXT-ACT-ERROR                                        
045100                                                                          
045200             MOVE DP020-MSG-MESSAGE   TO PV-MESSAGE                       
045300             IF DP020-NAV-MNEMONIC = SPACES                               
045400                 MOVE SPACES          TO ANAVCMDO                         
045500                 MOVE DP015-GREEN     TO ANAVCMDC                         
045600                 MOVE DP015-UNDERLINE TO ANAVCMDH                         
045700             ELSE                                                         
045800                 MOVE DP015-RED       TO ANAVCMDC                         
045900                 MOVE DP015-REVERSE   TO ANAVCMDH                         
046000             END-IF                                                       
046100                                                                          
046200             MOVE PV-MESSAGE          TO DP020-MSG-MESSAGE                
046300             MOVE LOW-VALUES TO DP020-INTER-APPL-DATA-AREA                
046400                                                                          
046500             PERFORM E700-EDIT-DATA-IN-COMMAREA                           
046600                                                                          
046700             SET DP020-MSG-FATAL         TO TRUE                          
046800             SET PS-ERROR                TO TRUE                          
046900             SET PS-SEND-DATA-ONLY-FRSET TO TRUE                          
047000                                                                          
047100             MOVE -1         TO ANAVCMDL                                  
047200                                                                          
047300             PERFORM E200-DISPLAY-PANEL                                   
047400                                                                          
047500         WHEN OTHER                                                       
047600             SET DP013-LOGIC-ABEND TO TRUE                                
047700             SET DP013-NO-ROLLBACK TO TRUE                                
047800                                                                          
047900             MOVE 'B000-CONTROL-PROCESSING' TO                            
048000                  DP013-PARAGRAPH                                         
048100             MOVE PM-PROGRAM-MESSAGE-12     TO                            
048200                     DP013-MESSAGE-TEXT(1)                                
048300                                                                          
048400             PERFORM DP013-0000-PROCESS-ABEND                             
048500                                                                          
048600     END-EVALUATE.                                                        
048700 EJECT                                                                    
048800******************************************************************        
048900 C100-INITIALIZE-COMMAREA.                                                
049000                                                                          
049100     INITIALIZE RV103-SPECIFIC-COMMAREA.                                  
049200                                                                          
049300 EJECT                                                                    
049400******************************************************************        
049500 C200-BUILD-INITIAL-PANEL.                                                
049600                                                                          
049700     IF  DP020-INT-APPL-FORMAT-IND  NOT EQUAL  '1'                        
049800         MOVE 1           TO  RV103-RL-ITEM                               
049900         PERFORM H100-READ-LIST-QUEUE                                     
050000         MOVE RV101-RA-REQUEST-RECORD  TO RV103-SAVE-TS-QUEUE             
050100         MOVE 1           TO  RV103-RL-SUB                                
050200         MOVE SPACES      TO  DCLTDFCTOR                                  
050300                                                                          
050400         MOVE RV101-RA-NUMBER(1)  TO   DFCTOR-DFCT-ORD-ID                 
050500         SET  RV103-LIST  TO TRUE                                         
050600     ELSE                                                                 
050700         MOVE RV100-RA-NUMBER  TO  RV103-DFCT-ORD-ID                      
050800         MOVE RV103-DFCT-ORD-ID  TO  DFCTOR-DFCT-ORD-ID                   
050900                                                                          
051000         SET  RV103-NO-LIST    TO  TRUE                                   
051100*                                                                         
051200     END-IF.                                                              
051300     IF CONTINUE-PROCESSING                                               
051400          PERFORM E000-RETRIEVE-DATA-FOR-PANEL                            
051500     END-IF.                                                              
051600     IF CONTINUE-PROCESSING                                               
051700          PERFORM E200-DISPLAY-PANEL                                      
051800     END-IF.                                                              
051900 EJECT                                                                    
052000******************************************************************        
052100 C300-PROCESS-MAP.                                                        
052200                                                                          
052300     SET PS-SEND-DATA-ONLY-FRSET TO TRUE.                                 
052400                                                                          
052500     PERFORM DP007-0000-GET-PANEL.                                        
052600                                                                          
052700                                                                          
052800     IF (DP020-SRC-AID NOT = DP016-PF5)   AND                             
052900        (DP020-SRC-AID NOT = DP016-CLEAR)                                 
053000         PERFORM D500-MOVE-SCREEN-TO-COMMAREA                             
053100     END-IF.                                                              
053200     IF (RV103-CONFIRM  AND                                               
053300      NOT DP020-FK-CONFIRM(DP020-SRC-AID))                                
053400         SET RV103-NO-CONFIRM  TO TRUE                                    
053500     END-IF.                                                              
053600     PERFORM D600-CHECK-LOCAL-FKEYS.                                      
053700 EJECT                                                                    
053800******************************************************************        
053900 D500-MOVE-SCREEN-TO-COMMAREA.                                            
054000                                                                          
054100******************************************************************        
054200*   MOVES SCREEN FIELDS TO THIS TRANSACTION SPECIFIC                      
054300*   COMMAREA.                                                             
054400*                                                                         
054500******************************************************************        
054600                                                                          
054700                                                                          
054800     IF (ARANAMEL   GREATER  THAN ZERO                                    
054900      OR ARANAMEA   EQUAL  PC-ERASE-EOF)                                  
055000        MOVE  ARANAMEI   TO   RV103-VEND-ATTN-NAME                        
055100     END-IF.                                                              
055200                                                                          
055300     IF (ARVADDRL   GREATER  THAN ZERO                                    
055400      OR ARVADDRA   EQUAL  PC-ERASE-EOF)                                  
055500        MOVE  ARVADDRI   TO   RV103-VEND-ADDR                             
055600     END-IF.                                                              
055700                                                                          
055800     IF (ARVCITYL   GREATER  THAN ZERO                                    
055900      OR ARVCITYA   EQUAL  PC-ERASE-EOF)                                  
056000        MOVE  ARVCITYI   TO   RV103-VEND-CITY                             
056100     END-IF.                                                              
056200                                                                          
056300     IF (ARSTATEL   GREATER  THAN ZERO                                    
056400      OR ARSTATEA   EQUAL  PC-ERASE-EOF)                                  
056500        MOVE  ARSTATEI   TO   RV103-VEND-STATE                            
056600     END-IF.                                                              
056700                                                                          
056800     IF (ARZIPCDL   GREATER  THAN ZERO                                    
056900      OR ARZIPCDA   EQUAL  PC-ERASE-EOF)                                  
057000        MOVE  ARZIPCDI               TO PV-VEND-ZIP-CODE-SFX-PRINT        
057100        MOVE  PV-VEND-ZIP-CODE-PRINT TO PV-VEND-ZIP-CODE                  
057200        MOVE  PV-VEND-ZIP-SFX-PRINT  TO PV-VEND-ZIP-SFX                   
057300        MOVE  PV-VEND-ZIP-CODE-SFX   TO RV103-VEND-ZIP-CODE-SFX           
057400     END-IF.                                                              
057500 EJECT                                                                    
057600*                                                                         
057700                                                                          
057800******************************************************************        
057900* PERFORM THE APPROPRIATE ACTION BASED ON WHICH FUNCTION KEY              
058000* THE USER HIT.                                                           
058100*                                                                         
058200******************************************************************        
058300 D600-CHECK-LOCAL-FKEYS.                                                  
058400                                                                          
058500     EVALUATE TRUE                                                        
058600                                                                          
058700         WHEN (DP020-FK-GO-TO-TRAN(DP020-SRC-AID) OR                      
058800               DP020-FK-RETURN(DP020-SRC-AID))                            
058900             PERFORM X300-SETUP-INTER-APPL-COMM                           
059000             PERFORM X400-NAVIGATE                                        
059100                                                                          
059200         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                             
059300             MOVE SPACES  TO   ANAVCMDO                                   
059400                               ANAVKEYO                                   
059500             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                         
059600             MOVE RV103-DFCT-ORD-ID  TO  DFCTOR-DFCT-ORD-ID               
059700             PERFORM E000-RETRIEVE-DATA-FOR-PANEL                         
059800             PERFORM E200-DISPLAY-PANEL                                   
059900                                                                          
060000                                                                          
060100         WHEN DP020-SRC-AID = DP016-ENTER                                 
060200             IF DP020-NAV-MNEMONIC GREATER THAN SPACES                    
060300                PERFORM  X400-NAVIGATE                                    
060400             ELSE                                                         
060500                PERFORM  E700-EDIT-DATA-IN-COMMAREA                       
060600                PERFORM  E200-DISPLAY-PANEL                               
060700             END-IF                                                       
060800                                                                          
060900         WHEN DP020-SRC-AID = DP016-PA2                                   
061000             SET PS-SEND-DATA-ONLY TO TRUE                                
061100                                                                          
061200             MOVE -1 TO ANAVCMDL                                          
061300                                                                          
061400             PERFORM DP017-0000-GET-CURR-DATE-TIME                        
061500             PERFORM DP009-0000-LOAD-FK-LINES                             
061600             PERFORM DP008-0000-WRITE-PANEL                               
061700                                                                          
061800         WHEN DP020-SRC-AID = DP016-CLEAR                                 
061900             SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                         
062000                                                                          
062100             PERFORM E800-MOVE-COMMAREA-TO-SCREEN                         
062200             PERFORM E700-EDIT-DATA-IN-COMMAREA                           
062300             PERFORM E200-DISPLAY-PANEL                                   
062400                                                                          
062500         WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)                      
062600           MOVE ZEROES  TO  PV-TOT-RETAIL                                 
062700                            PV-TOT-COST                                   
062800                            PV-TOT-QTY                                    
062900           IF RV103-LIST                                                  
063000             PERFORM F700-GET-NEXT-DFCTOR                                 
063100           ELSE                                                           
063200*----PC-TSYMSG-00070 - BOTTOM OF LIST                                     
063300             MOVE PC-TSYMSG-00070                                         
063400                            TO  DP020-MSG-NUMBER                          
063500             SET  DP020-MSG-INFORMATIONAL                                 
063600                            TO  TRUE                                      
063700             MOVE -1        TO  ANAVCMDL                                  
063800           END-IF                                                         
063900             PERFORM E200-DISPLAY-PANEL                                   
064000                                                                          
064100         WHEN  DP020-SRC-AID = DP016-PF16                                 
064200             SET RV103-CONFIRM   TO TRUE                                  
064300             PERFORM E700-EDIT-DATA-IN-COMMAREA                           
064400*JPL - 2/3/04                                                             
064500             IF PS-DELETE-OK-NO                                           
064600*----PC-TSYMSG-03219 - CANNOT DELETE IF STATUS SHIPPED/APPROVED           
064700                 SET RV103-NO-CONFIRM TO TRUE                             
064800                 MOVE PC-TSYMSG-03219 TO DP020-MSG-NUMBER                 
064900                 SET DP020-MSG-FATAL  TO TRUE                             
065000                 MOVE -1              TO ANAVCMDL                         
065100                 PERFORM E200-DISPLAY-PANEL                               
065200             ELSE                                                         
065300                 MOVE RV103-DFCT-ORD-ID TO DFCTOR-DFCT-ORD-ID             
065400                 PERFORM E000-RETRIEVE-DATA-FOR-PANEL                     
065500*----PC-TSYMSG-00004 - PRESS F2 TO CONFIRM REQUEST                        
065600                 MOVE PC-TSYMSG-00004   TO DP020-MSG-NUMBER               
065700                 SET DP020-MSG-WARNING  TO TRUE                           
065800                 MOVE -1                TO ANAVCMDL                       
065900                 PERFORM E200-DISPLAY-PANEL                               
066000             END-IF                                                       
066100                                                                          
066200         WHEN  DP020-FK-CONFIRM(DP020-SRC-AID)                            
066300             IF RV103-CONFIRM                                             
066400                 PERFORM G100-DELETE-HEADER                               
066500             ELSE                                                         
066600*----PC-TSYMSG-00118 - DELETE MUST BE REQUESTED BEFORE CONFIRM            
066700                 MOVE PC-TSYMSG-00118                                     
066800                                 TO DP020-MSG-NUMBER                      
066900                 SET DP020-MSG-FATAL                                      
067000                                 TO TRUE                                  
067100                 MOVE -1         TO ANAVCMDL                              
067200             END-IF                                                       
067300             PERFORM E200-DISPLAY-PANEL                                   
067400                                                                          
067500         WHEN OTHER                                                       
067600*            -- INVALID FUNCTION KEY --                                   
067700             PERFORM E700-EDIT-DATA-IN-COMMAREA                           
067800             MOVE -1  TO ANAVCMDL                                         
067900*----PC-TSYMSG-00045 - INVALID FUNCTION KEY                               
068000             MOVE PC-TSYMSG-00045  TO                                     
068100                                    DP020-MSG-NUMBER                      
068200             SET DP020-MSG-FATAL TO TRUE                                  
068300             PERFORM E200-DISPLAY-PANEL                                   
068400                                                                          
068500     END-EVALUATE.                                                        
068600******************************************************************        
068700* GET THE HEADER INFORMATION FROM DB2 TABLES AND MOVE IT TO THE  *        
068800* SCREEN.                                                        *        
068900* PERFORMED BY  C200, F700, D600                                 *        
069000******************************************************************        
069100 E000-RETRIEVE-DATA-FOR-PANEL.                                            
069200*                                                                         
069300     PERFORM F100-READ-TABLE-TDFCTOR.                                     
069400     IF SQLCODE EQUAL ZERO                                                
069500        SET CONTINUE-PROCESSING       TO TRUE                             
069600        PERFORM F150-GET-ORDER-STATUS                                     
069700        IF (RV103-ORDER-TYPE = 'MARKOUT ' AND                             
069800            RV103-ORDER-STATUS NOT = 'OPEN    ')                          
069900            SET PE049-IS-RTN-TO-VNDR-RSN                                  
070000                                 TO TRUE                                  
070100            MOVE PE049-WORKING-INSTR-RSN-CDE                              
070200                                 TO STRPPC-RSN-CDE                        
070300            MOVE PE049-MARKDOWN-TYPE-CDE                                  
070400                                 TO STRPPC-TYP-CDE                        
070500            MOVE DFCTOR-DFCT-ORD-ID                                       
070600                                 TO PV-LIST-NUMBER                        
070700            MOVE PV-DEPT-LIST-AUTH                                        
070800                                 TO PV-DEPT-AREA-DEST                     
070900            PERFORM F175-COUNT-CP-PERMS                                   
071000* IF THIS LISTING HAS COMPLETED PERMS ASSOCIATED WITH IT, IT              
071100*   CANNOT BE DELETED                                                     
071200            IF SQLCODE = 0 OR SQLCODE = -811                              
071300*----PC-TSYMSG-01480 - LISTINGS WITH PERMANENT PRICE CHANGES              
071400*----                  CANNOT BE DELETED                                  
071500                MOVE PC-TSYMSG-01480                                      
071600                                 TO DP020-MSG-NUMBER                      
071700                SET STOP-PROCESSING                                       
071800                                 TO TRUE                                  
071900                SET DP020-MSG-FATAL                                       
072000                                 TO TRUE                                  
072100            END-IF                                                        
072200        END-IF                                                            
072300     ELSE                                                                 
072400*----PC-TSYMSG-00148 - DATA DOES NOT EXIST                                
072500        MOVE PC-TSYMSG-00148     TO DP020-MSG-NUMBER                      
072600        SET STOP-PROCESSING      TO TRUE                                  
072700        SET DP020-MSG-FATAL      TO TRUE                                  
072800     END-IF.                                                              
072900                                                                          
073000     IF CONTINUE-PROCESSING                                               
073100         MOVE ZERO                    TO PV-VEND-ZIP-CODE-SFX             
073200         MOVE DFCTOR-DFCT-ORD-ID      TO RV103-DFCT-ORD-ID                
073300                                                                          
073400         IF PV-DFCT-SHIPT-ID-NULL                                         
073500            MOVE 0 TO RV103-DFCT-SHIPT-ID                                 
073600         ELSE                                                             
073700            MOVE DFCTOR-DFCT-SHIPT-ID TO RV103-DFCT-SHIPT-ID              
073800         END-IF                                                           
073900                                                                          
074000         MOVE DFCTOR-VENDOR-DUNS-NBR  TO RV103-DUNS-NBR                   
074100         MOVE DFCTOR-LOC-ID           TO RV103-LOCATION                   
074200         MOVE DFCTOR-STATUS-CHG-DTE   TO RV103-STATUS-DATE                
074300         MOVE DFCTOR-VEND-ATTN-NAME   TO RV103-VEND-ATTN-NAME             
074400         MOVE DFCTOR-VEND-NAME        TO RV103-VEND-NAME                  
074500         MOVE DFCTOR-VEND-ADDR-DESC   TO RV103-VEND-ADDR                  
074600         MOVE DFCTOR-VEND-CITY-NAME   TO RV103-VEND-CITY                  
074700         MOVE DFCTOR-VEND-STATE-CDE   TO RV103-VEND-STATE                 
074800         MOVE DFCTOR-VEND-ZIP-CDE     TO RV103-VEND-ZIP-CODE-SFX          
074900*                                                                         
075000         MOVE DFCTOR-PHN-AREA-CDE     TO PV-PHN-AREA-CODE                 
075100         MOVE DFCTOR-PHN-EXCH-NBR     TO PV-PHN-EXCH-NBR                  
075200         MOVE DFCTOR-PHN-NBR          TO PV-PHN-NBR                       
075300                                                                          
075400         MOVE PV-PHONE                TO RV103-PHONE                      
075500*                                                                         
075600         MOVE DFCTOR-FAX-PHN-AREA-CDE TO PV-FAX-PHN-AREA-CODE             
075700         MOVE DFCTOR-FAX-EXCH-NBR     TO PV-FAX-EXCH-NBR                  
075800         MOVE DFCTOR-FAX-PHN-NBR      TO PV-FAX-PHN-NBR                   
075900                                                                          
076000         MOVE PV-FAX                  TO RV103-FAX                        
076100*                                                                         
076200         PERFORM F200-READ-BUYER-NAME                                     
076300                                                                          
076400         IF SQLCODE EQUAL ZERO                                            
076500         OR SQLCODE EQUAL -811                                            
076600         OR SQLCODE EQUAL +100                                            
076700             SET CONTINUE-PROCESSING  TO TRUE                             
076800         ELSE                                                             
076900*----PC-TSYMSG-00148 - DATA DOES NOT EXIST                                
077000             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER                    
077100             SET STOP-PROCESSING   TO TRUE                                
077200             SET DP020-MSG-FATAL   TO TRUE                                
077300         END-IF                                                           
077400         IF CONTINUE-PROCESSING                                           
077500             IF  RSPBAR-WORKER-LAST-NAME  = SPACES                        
077600             AND RSPBAR-WORKER-FIR-NAME   = SPACES                        
077700                 MOVE SPACES             TO RV103-BUYER                   
077800             ELSE                                                         
077900               STRING RSPBAR-WORKER-LAST-NAME DELIMITED BY '  '           
078000                      ','                     DELIMITED BY SIZE           
078100                      RSPBAR-WORKER-FIR-NAME  DELIMITED BY '  '           
078200               INTO RV103-BUYER                                           
078300             END-IF                                                       
078400                                                                          
078500             PERFORM F400-OPEN-CURSOR                                     
078600                                                                          
078700             PERFORM UNTIL  PV-NO-ITEMS-LEFT                              
078800                 PERFORM F500-FETCH                                       
078900             END-PERFORM                                                  
079000                                                                          
079100             PERFORM F600-CLOSE-CURSOR                                    
079200                                                                          
079300             MOVE PV-TOT-RETAIL       TO RV103-TOTAL-RETAIL               
079400             MOVE PV-TOT-QTY          TO RV103-TOTAL-QTY                  
079500             MOVE PV-TOT-COST         TO RV103-TOTAL-COST                 
079600                                                                          
079700                                                                          
079800                                                                          
079900             PERFORM E800-MOVE-COMMAREA-TO-SCREEN                         
080000         END-IF                                                           
080100         IF RV103-LIST                                                    
080200              MOVE RV103-SAVE-TS-QUEUE                                    
080300                                      TO RV101-RA-REQUEST-RECORD          
080400              SET RV101-INQ(RV103-RL-SUB)                                 
080500                                      TO TRUE                             
080600              MOVE  RV101-RA-REQUEST-RECORD                               
080700                                      TO RV103-SAVE-TS-QUEUE              
080800         END-IF                                                           
080900     END-IF.                                                              
081000*                                                                         
081100 EJECT                                                                    
081200******************************************************************        
081300 E200-DISPLAY-PANEL.                                                      
081400                                                                          
081500******************************************************************        
081600*    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.               
081700*                                                                         
081800******************************************************************        
081900                                                                          
082000     PERFORM DP017-0000-GET-CURR-DATE-TIME.                               
082100     MOVE DP017-EDITED-TIME-HMS                                           
082200                      TO  ATIMEO.                                         
082300*                                                                         
082400     IF  NOT DP020-MSG-FATAL                                              
082500         MOVE -1      TO  ANAVCMDL                                        
082600     END-IF.                                                              
082700                                                                          
082800     IF PS-SEND-MAP-N-DATA-FRSET                                          
082900         PERFORM DP002-0000-FORMAT-TITLE-LINES                            
083000         PERFORM DP009-0000-LOAD-FK-LINES                                 
083100     END-IF.                                                              
083200                                                                          
083300     PERFORM DP005-0000-FORMAT-MSG-LINES.                                 
083400                                                                          
083500     PERFORM DP008-0000-WRITE-PANEL.                                      
083600                                                                          
083700 EJECT                                                                    
083800*                                                                         
083900******************************************************************        
084000 E700-EDIT-DATA-IN-COMMAREA.                                              
084100     SET PS-NO-ERROR TO TRUE.                                             
084200     SET CONTINUE-PROCESSING  TO TRUE.                                    
084300*JPL - 2/3/04                                                             
084400     IF (RV103-ORDER-STATUS = 'SHIPPED '                                  
084500                           OR 'APPROVED'                                  
084600                           OR 'DEBT/DIS')                                 
084700         SET PS-DELETE-OK-NO TO TRUE                                      
084800     END-IF.                                                              
084900******************************************************************        
085000*    MOVE DATA FROM THE COMMAREA TO THE SCREEN.                           
085100*                                                                         
085200******************************************************************        
085300 E800-MOVE-COMMAREA-TO-SCREEN.                                            
085400     MOVE  RV103-DFCT-ORD-ID  TO ARRANBRO.                                
085500     MOVE  RV103-ORDER-TYPE   TO ATYPEO.                                  
085600     MOVE  RV103-ORDER-STATUS TO ASTATUSO.                                
085700     MOVE  RV103-LOCATION     TO ARLOCTNO                                 
085800     MOVE  RV103-STATUS-DATE  TO ASTDATEO                                 
085900     MOVE  RV103-BUYER        TO ARBUYERO.                                
086000     MOVE  RV103-DUNS-NBR     TO ARIVNRNO.                                
086100     MOVE  RV103-VEND-NAME    TO ARIVNRDO.                                
086200     MOVE  RV103-VEND-ATTN-NAME    TO ARANAMEO.                           
086300     MOVE  RV103-TOTAL-QTY    TO  ARTOTQTO.                               
086400     MOVE  RV103-TOTAL-RETAIL TO ARTOTRTO.                                
086500     MOVE  RV103-TOTAL-COST   TO ARTOTCTO.                                
086600     MOVE  RV103-VEND-ADDR    TO ARVADDRO.                                
086700     MOVE  RV103-VEND-CITY    TO ARVCITYO.                                
086800     MOVE  RV103-VEND-STATE   TO ARSTATEO                                 
086900     MOVE  RV103-VEND-ZIP-CODE-SFX                                        
087000                              TO PV-VEND-ZIP-CODE-SFX.                    
087100     MOVE PV-VEND-ZIP-CODE    TO PV-VEND-ZIP-CODE-PRINT.                  
087200     MOVE PV-VEND-ZIP-SFX     TO PV-VEND-ZIP-SFX-PRINT.                   
087300     MOVE  PV-VEND-ZIP-CODE-SFX-PRINT                                     
087400                              TO ARZIPCDO.                                
087500     MOVE  RV103-PHONE        TO ARPHONEO.                                
087600     MOVE  RV103-FAX          TO ARFAXPHO.                                
087700                                                                          
087800 EJECT                                                                    
087900******************************************************************        
088000* READ THE DEFECT ORDER TABLE TO GET THE HEADER DATA.                     
088100*                                                                         
088200******************************************************************        
088300 F100-READ-TABLE-TDFCTOR.                                                 
088400*                                                                         
088500     MOVE RV100-OPER-UNT-ID TO PV-DB2-OPER-UNT-ID.                        
088600                                                                          
088700     PERFORM                                                              
088800         WITH TEST AFTER                                                  
088900         VARYING PV-SQL-SUB                                               
089000         FROM 1 BY 1                                                      
089100         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
089200            OR SQLCODE = 0                                                
089300            OR SQLCODE = +100                                             
089400*                                                                         
089500         EXEC SQL                                                         
089600              SELECT                                                      
089700                     DFCT_ORD_ID,                                         
089800                     DFCT_SHIPT_ID,                                       
089900                     VENDOR_DUNS_NBR,                                     
090000                     LOC_ID,                                              
090100                     STATUS_CHG_DTE,                                      
090200                     DFCT_ORD_ID_CDE,                                     
090300                     DFCT_ORD_STAT_CDE,                                   
090400                     VEND_ATTN_NAME,                                      
090500                     VEND_NAME,                                           
090600                     VEND_ADDR_DESC,                                      
090700                     VEND_CITY_NAME,                                      
090800                     VEND_STATE_CDE,                                      
090900                     VEND_ZIP_CDE,                                        
091000                     PHN_AREA_CDE,                                        
091100                     PHN_EXCH_NBR,                                        
091200                     PHN_NBR,                                             
091300                     FAX_PHN_AREA_CDE,                                    
091400                     FAX_EXCH_NBR,                                        
091500                     FAX_PHN_NBR                                          
091600              INTO                                                        
091700                     :DFCTOR-DFCT-ORD-ID,                                 
091800                     :DFCTOR-DFCT-SHIPT-ID                                
091900                                 :PV-DFCT-SHIPT-ID-IND,                   
092000                     :DFCTOR-VENDOR-DUNS-NBR,                             
092100                     :DFCTOR-LOC-ID,                                      
092200                     :DFCTOR-STATUS-CHG-DTE,                              
092300                     :DFCTOR-DFCT-ORD-ID-CDE,                             
092400                     :DFCTOR-DFCT-ORD-STAT-CDE,                           
092500                     :DFCTOR-VEND-ATTN-NAME,                              
092600                     :DFCTOR-VEND-NAME,                                   
092700                     :DFCTOR-VEND-ADDR-DESC,                              
092800                     :DFCTOR-VEND-CITY-NAME,                              
092900                     :DFCTOR-VEND-STATE-CDE,                              
093000                     :DFCTOR-VEND-ZIP-CDE,                                
093100                     :DFCTOR-PHN-AREA-CDE,                                
093200                     :DFCTOR-PHN-EXCH-NBR,                                
093300                     :DFCTOR-PHN-NBR,                                     
093400                     :DFCTOR-FAX-PHN-AREA-CDE,                            
093500                     :DFCTOR-FAX-EXCH-NBR,                                
093600                     :DFCTOR-FAX-PHN-NBR                                  
093700              FROM                                                        
093800                     TDFCTOR                                              
093900              WHERE                                                       
094000                     DFCT_ORD_ID  = :DFCTOR-DFCT-ORD-ID                   
094100                AND  OPER_UNT_ID  = :PV-DB2-OPER-UNT-ID                   
094200         END-EXEC                                                         
094300*                                                                         
094400         EVALUATE TRUE                                                    
094500             WHEN SQLCODE = -911                                          
094600             WHEN SQLCODE = -913                                          
094700             WHEN SQLCODE = ZERO                                          
094800                  CONTINUE                                                
094900                                                                          
095000             WHEN SQLCODE = +100                                          
095100                  MOVE 0 TO DFCTOR-DFCT-SHIPT-ID                          
095200                                                                          
095300             WHEN SQLWARN0 NOT EQUAL SPACE                                
095400             WHEN SQLCODE NOT EQUAL ZERO                                  
095500                  MOVE 'F100-READ-DFCTOR'                                 
095600                               TO  DP013-PARAGRAPH                        
095700                  MOVE 'READ DFCTOR'                                      
095800                               TO  DP013-MESSAGE-TEXT (1)                 
095900                  MOVE SQLCA   TO  DP013-SQLCA                            
096000                  SET DP013-DB2-ABEND                                     
096100                               TO  TRUE                                   
096200                  PERFORM DP013-0000-PROCESS-ABEND                        
096300         END-EVALUATE                                                     
096400     END-PERFORM.                                                         
096500*                                                                         
096600     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
096700         MOVE 'F100-READ-TABLE-TDFCTOR'                                   
096800                               TO  DP013-PARAGRAPH                        
096900         MOVE 'MAX RETRIES EXCEEDED FOR READ DFCTOR'                      
097000                               TO  DP013-MESSAGE-TEXT (1)                 
097100         MOVE SQLCA            TO  DP013-SQLCA                            
097200         SET DP013-DB2-ABEND   TO  TRUE                                   
097300         PERFORM DP013-0000-PROCESS-ABEND                                 
097400     END-IF.                                                              
097500*                                                                         
097600 EJECT                                                                    
097700******************************************************************        
097800* READ THE DEFECT ORDER STATUS CONTROL TABLE TO GET THE RA ORDER          
097900* STATUS DESCRIPTION.                                                     
098000* VF - ADDED CODING FOR CALLBACK AND CHANGED DEBT/DES TO DEBT/DIS         
098100* VF - ADDED CODING FOR NEW STATUS                                        
098200******************************************************************        
098300 F150-GET-ORDER-STATUS.                                                   
098400     EVALUATE DFCTOR-DFCT-ORD-ID-CDE                                      
098500         WHEN 'M'                                                         
098600             MOVE 'MARKOUT '           TO RV103-ORDER-TYPE                
098700                                                                          
098800         WHEN 'R'                                                         
098900             MOVE 'RTV     '           TO RV103-ORDER-TYPE                
099000                                                                          
099100         WHEN 'D'                                                         
099200             MOVE 'DEBT/DIS'           TO RV103-ORDER-TYPE                
099300                                                                          
099400         WHEN 'C'                                                         
099500             MOVE 'CALLBACK'           TO RV103-ORDER-TYPE                
099600     END-EVALUATE.                                                        
099700                                                                          
099800     EVALUATE DFCTOR-DFCT-ORD-STAT-CDE                                    
099900         WHEN 'N'                                                         
100000             MOVE 'NEW     '           TO RV103-ORDER-STATUS              
100100                                                                          
100200         WHEN 'O'                                                         
100300             MOVE 'OPEN    '           TO RV103-ORDER-STATUS              
100400                                                                          
100500         WHEN 'C'                                                         
100600             MOVE 'CLOSED  '           TO RV103-ORDER-STATUS              
100700                                                                          
100800         WHEN 'S'                                                         
100900             MOVE 'SHIPPED '           TO RV103-ORDER-STATUS              
101000                                                                          
101100         WHEN 'P'                                                         
101200             MOVE 'PENDING '           TO RV103-ORDER-STATUS              
101300                                                                          
101400         WHEN 'A'                                                         
101500             MOVE 'APPROVED'           TO RV103-ORDER-STATUS              
101600                                                                          
101700         WHEN 'D'                                                         
101800             MOVE 'DEBT/DIS'           TO RV103-ORDER-STATUS              
101900     END-EVALUATE.                                                        
102000******************************************************************        
102100* COUNT THE NUMBER OF COMPELETED PERMS FOR THE LISTING.  IF THERE         
102200*   ARE ANY, THIS LISTING CANNOT BE DELETED.                              
102300******************************************************************        
102400 F175-COUNT-CP-PERMS.                                                     
102500     PERFORM                                                              
102600         WITH TEST AFTER                                                  
102700         VARYING PV-SQL-SUB                                               
102800         FROM 1 BY 1                                                      
102900         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
103000            OR SQLCODE = 0                                                
103100            OR SQLCODE = +100                                             
103200            OR SQLCODE = -811                                             
103300                                                                          
103400         EXEC SQL                                                         
103500              SELECT 'Y'                                                  
103600              INTO :PV-CP-PERM-COUNT                                      
103700              FROM TSTRPPC                                                
103800              WHERE DEPT_AREA_DEST LIKE :PV-DEPT-AREA-DEST AND            
103900                    STATUS_CDE =                                          
104000                        :PE049-IS-COMPLETED-STATUS-CDE AND                
104100                    RSN_CDE = :STRPPC-RSN-CDE AND                         
104200                    TYP_CDE = :STRPPC-TYP-CDE                             
104300         END-EXEC                                                         
104400                                                                          
104500         EVALUATE TRUE                                                    
104600             WHEN SQLCODE = -911                                          
104700             WHEN SQLCODE = -913                                          
104800             WHEN SQLCODE = +100                                          
104900             WHEN SQLCODE = ZERO                                          
105000             WHEN SQLCODE = -811                                          
105100                  CONTINUE                                                
105200             WHEN OTHER                                                   
105300                  MOVE 'F175-COUNT-CP-PERMS'                              
105400                                 TO DP013-PARAGRAPH                       
105500                  MOVE 'COUNT COMPLETED PERMS'                            
105600                                 TO DP013-MESSAGE-TEXT (1)                
105700                  MOVE SQLCA     TO DP013-SQLCA                           
105800                  SET DP013-DB2-ABEND                                     
105900                                 TO TRUE                                  
106000                  PERFORM DP013-0000-PROCESS-ABEND                        
106100         END-EVALUATE                                                     
106200     END-PERFORM.                                                         
106300                                                                          
106400     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
106500         MOVE 'F175-COUNT-CP-PERMS'                                       
106600                                 TO DP013-PARAGRAPH                       
106700         MOVE 'MAX RETRIES EXCEEDED FOR COUNT CP PERMS'                   
106800                                 TO DP013-MESSAGE-TEXT (1)                
106900         MOVE SQLCA              TO DP013-SQLCA                           
107000         SET DP013-DB2-ABEND     TO TRUE                                  
107100         PERFORM DP013-0000-PROCESS-ABEND                                 
107200     END-IF.                                                              
107300******************************************************************        
107400* GET THE BUYER FIRST AND LAST NAME.                                      
107500*                                                                         
107600******************************************************************        
107700 F200-READ-BUYER-NAME.                                                    
107800*                                                                         
107900     PERFORM                                                              
108000         WITH TEST AFTER                                                  
108100         VARYING PV-SQL-SUB                                               
108200         FROM 1 BY 1                                                      
108300         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
108400            OR SQLCODE = 0                                                
108500            OR SQLCODE = +100                                             
108600            OR SQLCODE = -811                                             
108700*                                                                         
108800         EXEC SQL                                                         
108900            SELECT DISTINCT                                               
109000               V.DEPT_NBR                                                 
109100            INTO                                                          
109200               :XLT00004-DEPT-NBR                                         
109300            FROM                                                          
109400               TDFMEIT I,                                                 
109500               XLT_SKU S,                                                 
109600               XLT_VND_STYL V                                             
109700            WHERE I.DFCT_ORD_ID   =  :DFCTOR-DFCT-ORD-ID                  
109800               AND S.ITM_NBR      =  I.DFCT_ITEM_NBR                      
109900               AND S.STYL_ID      =  V.STYL_ID                            
110000         END-EXEC                                                         
110100*                                                                         
110200         EVALUATE TRUE                                                    
110300             WHEN SQLCODE = -911                                          
110400             WHEN SQLCODE = -913                                          
110500             WHEN SQLCODE = ZERO                                          
110600                  CONTINUE                                                
110700             WHEN SQLCODE = +100                                          
110800                  MOVE SPACES  TO RSPBAR-WORKER-LAST-NAME                 
110900                                  RSPBAR-WORKER-FIR-NAME                  
111000             WHEN SQLCODE = -811                                          
111100                  MOVE 'MULTIPLE BUYERS   '                               
111200                               TO RSPBAR-WORKER-LAST-NAME                 
111300                  MOVE 'MARKOUT LIST'                                     
111400                               TO RSPBAR-WORKER-FIR-NAME,                 
111500             WHEN SQLWARN0 NOT EQUAL SPACE                                
111600             WHEN SQLCODE NOT EQUAL ZERO                                  
111700                  MOVE 'F200-READ-BUYER-NAME'                             
111800                               TO  DP013-PARAGRAPH                        
111900                  MOVE 'READ DEPARTMENT'                                  
112000                               TO  DP013-MESSAGE-TEXT (1)                 
112100                  MOVE SQLCA   TO  DP013-SQLCA                            
112200                  SET DP013-DB2-ABEND                                     
112300                               TO  TRUE                                   
112400                  PERFORM DP013-0000-PROCESS-ABEND                        
112500         END-EVALUATE                                                     
112600     END-PERFORM.                                                         
112700*                                                                         
112800     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
112900         MOVE 'F200-READ-BUYER-NAME'                                      
113000                               TO  DP013-PARAGRAPH                        
113100         MOVE 'MAX RETRIES EXCEEDED FOR READ DEPT'                        
113200                               TO  DP013-MESSAGE-TEXT (1)                 
113300         MOVE SQLCA            TO  DP013-SQLCA                            
113400         SET DP013-DB2-ABEND   TO  TRUE                                   
113500         PERFORM DP013-0000-PROCESS-ABEND                                 
113600     END-IF.                                                              
113700*                                                                         
113800*                                                                         
113900     IF SQLCODE = +100 OR SQLCODE = -811                                  
114000         CONTINUE                                                         
114100     ELSE                                                                 
114200         MOVE XLT00004-DEPT-NBR  TO  PV-DEPT                              
114300         MOVE PV-DEPT(2:3)       TO  MDSEAR-DEPT-NBR                      
114400         PERFORM                                                          
114500             WITH TEST AFTER                                              
114600             VARYING PV-SQL-SUB                                           
114700             FROM 1 BY 1                                                  
114800             UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                 
114900                OR SQLCODE = 0                                            
115000                OR SQLCODE = +100                                         
115100                                                                          
115200             EXEC SQL                                                     
115300                SELECT DISTINCT                                           
115400                   R.WORKER_FIR_NAME,                                     
115500                   R.WORKER_LAST_NAME                                     
115600                INTO                                                      
115700                   :RSPBAR-WORKER-FIR-NAME,                               
115800                   :RSPBAR-WORKER-LAST-NAME                               
115900                FROM TMDSEAR A,                                           
116000                   TRSPBAR R                                              
116100                WHERE                                                     
116200                       A.DEPT_NBR       =  :MDSEAR-DEPT-NBR               
116300                   AND A.OPERCO_NBR     =  '03'                           
116400                   AND A.MDSELV_CDE     =  'DPT'                          
116500                   AND A.MDSEAR_DKEY    =  R.MDSEAR_DKEY                  
116600                   AND R.RSPLVL_CDE     =  'BYR'                          
116700                   AND R.WORKER_STRT_DTE <= CURRENT DATE                  
116800                   AND R.WORKER_END_DTE  >= CURRENT DATE                  
116900             END-EXEC                                                     
117000*                                                                         
117100             EVALUATE TRUE                                                
117200                 WHEN SQLCODE = -911                                      
117300                 WHEN SQLCODE = -913                                      
117400                 WHEN SQLCODE = ZERO                                      
117500                 WHEN SQLCODE = +100                                      
117600                      CONTINUE                                            
117700                 WHEN SQLWARN0 NOT EQUAL SPACE                            
117800                 WHEN SQLCODE NOT EQUAL ZERO                              
117900                      MOVE 'F200-READ-BUYER-NAME'                         
118000                                   TO  DP013-PARAGRAPH                    
118100                      MOVE 'READ BUYER'                                   
118200                                   TO  DP013-MESSAGE-TEXT (1)             
118300                      MOVE SQLCA   TO  DP013-SQLCA                        
118400                      SET DP013-DB2-ABEND                                 
118500                                   TO  TRUE                               
118600                      PERFORM DP013-0000-PROCESS-ABEND                    
118700             END-EVALUATE                                                 
118800         END-PERFORM                                                      
118900*                                                                         
119000         IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                       
119100             MOVE 'F200-READ-BUYER-NAME'                                  
119200                                   TO  DP013-PARAGRAPH                    
119300             MOVE 'MAX RETRIES EXCEEDED FOR READ BUYER'                   
119400                                   TO  DP013-MESSAGE-TEXT (1)             
119500             MOVE SQLCA            TO  DP013-SQLCA                        
119600             SET DP013-DB2-ABEND   TO  TRUE                               
119700             PERFORM DP013-0000-PROCESS-ABEND                             
119800         END-IF                                                           
119900     END-IF.                                                              
120000*                                                                         
120100 EJECT                                                                    
120200*                                                                         
120300 F400-OPEN-CURSOR.                                                        
120400*                                                                         
120500     PERFORM                                                              
120600         WITH TEST AFTER                                                  
120700         VARYING PV-SQL-SUB                                               
120800         FROM 1 BY 1                                                      
120900         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
121000            OR SQLCODE = 0                                                
121100            OR SQLCODE = +100                                             
121200*                                                                         
121300         EXEC SQL                                                         
121400              OPEN DFCT-ITEM                                              
121500         END-EXEC                                                         
121600*                                                                         
121700         EVALUATE TRUE                                                    
121800             WHEN SQLCODE = -911                                          
121900             WHEN SQLCODE = -913                                          
122000             WHEN SQLCODE = ZERO                                          
122100             WHEN SQLCODE = +100                                          
122200                  CONTINUE                                                
122300             WHEN SQLWARN0 NOT EQUAL SPACE                                
122400             WHEN SQLCODE NOT EQUAL ZERO                                  
122500                  MOVE 'F400-OPEN-CURSOR'                                 
122600                               TO  DP013-PARAGRAPH                        
122700                  MOVE 'OPEN DFCT-ITEM CURSOR'                            
122800                               TO  DP013-MESSAGE-TEXT (1)                 
122900                  MOVE SQLCA   TO  DP013-SQLCA                            
123000                  SET DP013-DB2-ABEND                                     
123100                               TO  TRUE                                   
123200                  PERFORM DP013-0000-PROCESS-ABEND                        
123300         END-EVALUATE                                                     
123400     END-PERFORM.                                                         
123500*                                                                         
123600     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
123700         MOVE 'F400-OPEN-CURSOR'                                          
123800                               TO  DP013-PARAGRAPH                        
123900         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'                      
124000                               TO  DP013-MESSAGE-TEXT (1)                 
124100         MOVE SQLCA            TO  DP013-SQLCA                            
124200         SET DP013-DB2-ABEND   TO  TRUE                                   
124300         PERFORM DP013-0000-PROCESS-ABEND                                 
124400     END-IF.                                                              
124500*                                                                         
124600 EJECT                                                                    
124700******************************************************************        
124800*                                                                         
124900 F600-CLOSE-CURSOR.                                                       
125000*                                                                         
125100     PERFORM                                                              
125200         WITH TEST AFTER                                                  
125300         VARYING PV-SQL-SUB                                               
125400         FROM 1 BY 1                                                      
125500         UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                     
125600            OR SQLCODE = 0                                                
125700            OR SQLCODE = +100                                             
125800*                                                                         
125900         EXEC SQL                                                         
126000             CLOSE DFCT-ITEM                                              
126100         END-EXEC                                                         
126200*                                                                         
126300         EVALUATE TRUE                                                    
126400             WHEN SQLCODE = -911                                          
126500             WHEN SQLCODE = -913                                          
126600             WHEN SQLCODE = ZERO                                          
126700             WHEN SQLCODE = +100                                          
126800                  CONTINUE                                                
126900             WHEN SQLWARN0 NOT EQUAL SPACE                                
127000             WHEN SQLCODE NOT EQUAL ZERO                                  
127100                  MOVE 'F600-CLOSE-CURSOR'                                
127200                               TO  DP013-PARAGRAPH                        
127300                  MOVE 'CLOSE DFCT-ITEM CURSOR'                           
127400                               TO  DP013-MESSAGE-TEXT (1)                 
127500                  MOVE SQLCA   TO  DP013-SQLCA                            
127600                  SET DP013-DB2-ABEND                                     
127700                               TO  TRUE                                   
127800                  PERFORM DP013-0000-PROCESS-ABEND                        
127900         END-EVALUATE                                                     
128000     END-PERFORM.                                                         
128100*                                                                         
128200     IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                           
128300         MOVE 'F600-CLOSE-CURSOR'                                         
128400                               TO  DP013-PARAGRAPH                        
128500         MOVE 'MAX RETRIES EXCEEDED FOR CLOSE CURSOR'                     
128600                               TO  DP013-MESSAGE-TEXT (1)                 
128700         MOVE SQLCA            TO  DP013-SQLCA                            
128800         SET DP013-DB2-ABEND   TO  TRUE                                   
128900         PERFORM DP013-0000-PROCESS-ABEND                                 
129000     END-IF.                                                              
129100*                                                                         
129200 EJECT                                                                    
129300******************************************************************        
129400* FETCH THE CURSOR TO GET THE QUNTITY, RETAIL AND COST AMOUNTS            
129500* FROM DEFECT ITEM TABLE.                                                 
129600******************************************************************        
129700*                                                                         
129800 F500-FETCH.                                                              
129900*                                                                         
130000         EXEC SQL                                                         
130100              FETCH DFCT-ITEM                                             
130200              INTO                                                        
130300                    :PV-RETAIL,                                           
130400                    :PV-COST,                                             
130500                    :PV-QTY                                               
130600         END-EXEC.                                                        
130700*                                                                         
130800         EVALUATE TRUE                                                    
130900             WHEN SQLCODE = ZERO                                          
131000                 ADD PV-RETAIL   TO   PV-TOT-RETAIL                       
131100                 ADD PV-COST     TO   PV-TOT-COST                         
131200                 ADD PV-QTY      TO   PV-TOT-QTY                          
131300             WHEN SQLCODE = +100                                          
131400                 SET PV-NO-ITEMS-LEFT   TO TRUE                           
131500             WHEN SQLCODE = -305                                          
131600                 SET PV-NO-ITEMS-LEFT   TO TRUE                           
131700                 MOVE ZERO       TO   PV-TOT-RETAIL                       
131800                                      PV-TOT-COST                         
131900                                      PV-TOT-QTY                          
132000             WHEN SQLWARN0 NOT EQUAL SPACE                                
132100             WHEN SQLCODE NOT EQUAL ZERO                                  
132200                  MOVE 'F500-FETCH'                                       
132300                               TO  DP013-PARAGRAPH                        
132400                  MOVE 'FETCH DFCT-ITEM CURSOR'                           
132500                               TO  DP013-MESSAGE-TEXT (1)                 
132600                  MOVE SQLCA   TO  DP013-SQLCA                            
132700                  SET DP013-DB2-ABEND                                     
132800                               TO  TRUE                                   
132900                  PERFORM DP013-0000-PROCESS-ABEND                        
133000         END-EVALUATE.                                                    
133100*                                                                         
133200******************************************************************        
133300*    POSITION TO THE NEXT DEFECT ORDER                                    
133400*    IF AT END, ISSUE MESSAGE, OTHERWISE CONTINUE PROCESSING.             
133500*                                                                         
133600*    PERFORMED BY C300                                                    
133700******************************************************************        
133800*                                                                         
133900 F700-GET-NEXT-DFCTOR.                                                    
134000*                                                                         
134100     ADD 1                     TO  RV103-RL-SUB.                          
134200     IF  RV103-RL-SUB GREATER THAN RV101-RA-MAX-ITEMS                     
134300         PERFORM H200-WRITE-QUEUE                                         
134400         ADD 1                 TO  RV103-RL-ITEM                          
134500         MOVE 1                TO  RV103-RL-SUB                           
134600         PERFORM H100-READ-LIST-QUEUE                                     
134700         MOVE  RV101-RA-REQUEST-RECORD                                    
134800                               TO  RV103-SAVE-TS-QUEUE                    
134900     ELSE                                                                 
135000         MOVE RV103-SAVE-TS-QUEUE                                         
135100                               TO  RV101-RA-REQUEST-RECORD                
135200     END-IF.                                                              
135300*                                                                         
135400     IF  RV101-RA-NUMBER(RV103-RL-SUB) GREATER THAN ZEROES                
135500         MOVE SPACES           TO  DCLTDFCTOR                             
135600         MOVE RV101-RA-NUMBER(RV103-RL-SUB)                               
135700                               TO  DFCTOR-DFCT-ORD-ID                     
135800         SET RV101-INQ(RV103-RL-SUB)  TO TRUE                             
135900         PERFORM E000-RETRIEVE-DATA-FOR-PANEL                             
136000     ELSE                                                                 
136100         SUBTRACT 1          FROM  RV103-RL-SUB                           
136200*----PC-TSYMSG-00070 - BOTTOM OF LIST                                     
136300         MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER                       
136400         SET DP020-MSG-INFORMATIONAL                                      
136500                               TO  TRUE                                   
136600     END-IF.                                                              
136700*                                                                         
136800 EJECT                                                                    
136900                                                                          
137000******************************************************************        
137100 G100-DELETE-HEADER.                                                      
137200******************************************************************        
137300                                                                          
137400     PERFORM L200-DELETE-TDFCTOR                                          
137500     IF SQLCODE EQUAL ZERO                                                
137600        PERFORM L300-DELETE-TDFMEIT                                       
137700                                                                          
137800        IF RV103-DFCT-SHIPT-ID = 0                                        
137900           CONTINUE                                                       
138000        ELSE                                                              
138100           PERFORM L600-COUNT-TDFCTOR                                     
138200                                                                          
138300           IF PV-TDFCTOR-COUNT = 0                                        
138400              PERFORM L650-DELETE-RVT-DFCT-STAT                           
138500           END-IF                                                         
138600        END-IF                                                            
138700                                                                          
138800        IF RV103-LIST                                                     
138900            MOVE RV103-SAVE-TS-QUEUE                                      
139000                               TO RV101-RA-REQUEST-RECORD                 
139100            SET RV101-DEL(RV103-RL-SUB)                                   
139200                               TO TRUE                                    
139300            MOVE RV101-RA-REQUEST-RECORD                                  
139400                               TO RV103-SAVE-TS-QUEUE                     
139500        END-IF                                                            
139600     END-IF.                                                              
139700******************************************************************        
139800*    READ THE TEMPORARY STORAGE QUEUE THAT CONTAINS THE SELECTED          
139900*    BUSINESS GROUPS FROM MBKCS120 (BUSINESS GROUP LIST).                 
140000*                                                                         
140100*    PERFORMED BY C200, F700                                              
140200******************************************************************        
140300*                                                                         
140400 H100-READ-LIST-QUEUE.                                                    
140500*                                                                         
140600     EXEC CICS                                                            
140700         READQ TS                                                         
140800         QUEUE(RV100-TSQB-QUEUE-NAME)                                     
140900         INTO(RV101-RA-REQUEST-RECORD)                                    
141000         LENGTH(RV100-TSQB-QUEUE-LENGTH)                                  
141100         ITEM(RV103-RL-ITEM)                                              
141200         RESP(PV-RESP)                                                    
141300     END-EXEC.                                                            
141400*                                                                         
141500     IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                                
141600         MOVE PV-RESP          TO  PM-RESP-22                             
141700         SET DP013-LOGIC-ABEND TO  TRUE                                   
141800         SET DP013-NO-ROLLBACK TO  TRUE                                   
141900         MOVE 'H100-READ-LIST-QUEUE'                                      
142000                               TO  DP013-PARAGRAPH                        
142100         MOVE PM-PROGRAM-MESSAGE-22                                       
142200                               TO  DP013-MESSAGE-TEXT (1)                 
142300         PERFORM DP013-0000-PROCESS-ABEND                                 
142400     END-IF.                                                              
142500*                                                                         
142600 EJECT                                                                    
142700******************************************************************        
142800*    REWRITE THE TEMPORARY STORAGE QUEUE.                                 
142900*                                                                         
143000*    PERFORMED BY X300, X500, F700                                        
143100******************************************************************        
143200 H200-WRITE-QUEUE.                                                        
143300     EXEC CICS                                                            
143400         WRITEQ TS                                                        
143500         REWRITE                                                          
143600         QUEUE(RV100-TSQB-QUEUE-NAME)                                     
143700         FROM(RV103-SAVE-TS-QUEUE)                                        
143800         LENGTH(RV100-TSQB-QUEUE-LENGTH)                                  
143900         ITEM(RV103-RL-ITEM)                                              
144000         RESP(PV-RESP)                                                    
144100     END-EXEC.                                                            
144200*                                                                         
144300     IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                                
144400         MOVE PV-RESP          TO  PM-RESP-22                             
144500         SET DP013-LOGIC-ABEND TO  TRUE                                   
144600         SET DP013-NO-ROLLBACK TO  TRUE                                   
144700         MOVE 'H200-WRITE-QUEUE'                                          
144800                               TO  DP013-PARAGRAPH                        
144900         MOVE PM-PROGRAM-MESSAGE-22                                       
145000                               TO  DP013-MESSAGE-TEXT (1)                 
145100         PERFORM DP013-0000-PROCESS-ABEND                                 
145200     END-IF.                                                              
145300******************************************************************        
145400*    CONFIRM KEY WAS PRESSED, THE HEADER INFORMATION CAN BE               
145500*    DELETED FROM TDFCTOR TABLE.                                          
145600*                                                                         
145700*    PERFORMED BY G100.                                                   
145800******************************************************************        
145900 L200-DELETE-TDFCTOR.                                                     
146000     MOVE RV103-DFCT-ORD-ID      TO PV-DFCT-ORD-ID.                       
146100                                                                          
146200     EXEC SQL                                                             
146300          DELETE FROM TDFCTOR                                             
146400          WHERE DFCT_ORD_ID = :PV-DFCT-ORD-ID                             
146500     END-EXEC.                                                            
146600                                                                          
146700     EVALUATE TRUE                                                        
146800         WHEN SQLCODE = ZERO                                              
146900              CONTINUE                                                    
147000         WHEN OTHER                                                       
147100              MOVE 'L200-DELETE-DFCTOR'                                   
147200                                 TO DP013-PARAGRAPH                       
147300              MOVE 'DELETE DFCTOR'                                        
147400                                 TO DP013-MESSAGE-TEXT (1)                
147500              MOVE SQLCA         TO DP013-SQLCA                           
147600              SET DP013-DB2-ABEND                                         
147700                                 TO TRUE                                  
147800              PERFORM DP013-0000-PROCESS-ABEND                            
147900     END-EVALUATE.                                                        
148000                                                                          
148100     IF  SQLCODE EQUAL ZERO                                               
148200         CONTINUE                                                         
148300     ELSE                                                                 
148400*----PC-TSYMSG-00116 - CANNOT DELETE - RECORD DOES NOT EXIST              
148500         MOVE PC-TSYMSG-00116  TO  DP020-MSG-NUMBER                       
148600         SET DP020-MSG-WARNING TO TRUE                                    
148700     END-IF.                                                              
148800******************************************************************        
148900*    CONFIRM KEY WAS PRESSED, THE DETAIL INFORMATION CAN BE               
149000*    DELETED FROM DEFECT ITEM TABLE.                                      
149100*                                                                         
149200*    PERFORMED BY G100.                                                   
149300******************************************************************        
149400 L300-DELETE-TDFMEIT.                                                     
149500     EXEC SQL                                                             
149600          DELETE FROM TDFMEIT                                             
149700          WHERE DFCT_ORD_ID = :PV-DFCT-ORD-ID                             
149800     END-EXEC.                                                            
149900                                                                          
150000     EVALUATE TRUE                                                        
150100         WHEN SQLCODE = ZERO                                              
150200         WHEN SQLCODE = +100                                              
150300             IF (RV103-ORDER-TYPE = 'MARKOUT ' AND                        
150400                 RV103-ORDER-STATUS NOT = 'OPEN    ')                     
150500                 SET PE049-IS-RTN-TO-VNDR-RSN                             
150600                                 TO TRUE                                  
150700                 MOVE PE049-WORKING-INSTR-RSN-CDE                         
150800                                 TO STRPPC-RSN-CDE                        
150900                 MOVE PE049-MARKDOWN-TYPE-CDE                             
151000                                 TO STRPPC-TYP-CDE                        
151100                 MOVE RV103-DFCT-ORD-ID                                   
151200                                 TO PV-LIST-NUMBER                        
151300                 MOVE PV-DEPT-LIST-AUTH                                   
151400                                 TO PV-DEPT-AREA-DEST                     
151500                 PERFORM L400-DELETE-TSPPCDT                              
151600             END-IF                                                       
151700         WHEN OTHER                                                       
151800             MOVE 'L300-DELETE-DFMEIT'                                    
151900                                 TO DP013-PARAGRAPH                       
152000             MOVE 'DELETE DFMEIT'                                         
152100                                 TO DP013-MESSAGE-TEXT (1)                
152200             MOVE SQLCA          TO DP013-SQLCA                           
152300             SET DP013-DB2-ABEND TO TRUE                                  
152400             PERFORM DP013-0000-PROCESS-ABEND                             
152500     END-EVALUATE.                                                        
152600                                                                          
152700*----PC-TSYMSG-00115 - DELETE SUCCESSFUL                                  
152800     MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER.                     
152900     SET DP020-MSG-INFORMATIONAL TO TRUE.                                 
153000******************************************************************        
153100*    CONFIRM KEY WAS PRESSED, THE DETAIL INFORMATION CAN BE               
153200*    DELETED FROM THE PERM DETAIL TABLE.                                  
153300******************************************************************        
153400 L400-DELETE-TSPPCDT.                                                     
153500     EXEC SQL                                                             
153600          DELETE FROM TSPPCDT                                             
153700          WHERE DOC_NBR IN                                                
153800              (SELECT DOC_NBR                                             
153900               FROM TSTRPPC                                               
154000               WHERE DEPT_AREA_DEST LIKE :PV-DEPT-AREA-DEST AND           
154100                     RSN_CDE = :STRPPC-RSN-CDE AND                        
154200                     TYP_CDE = :STRPPC-TYP-CDE)                           
154300     END-EXEC.                                                            
154400                                                                          
154500     EVALUATE TRUE                                                        
154600         WHEN SQLCODE = ZERO                                              
154700         WHEN SQLCODE = +100                                              
154800             PERFORM L500-UPDATE-TSTRPPC                                  
154900         WHEN OTHER                                                       
155000             MOVE 'L400-DELETE-TSPPCDT'                                   
155100                                 TO DP013-PARAGRAPH                       
155200             MOVE 'DELETE PERM DETAIL LINES - TSPPCDT'                    
155300                                 TO DP013-MESSAGE-TEXT (1)                
155400             MOVE SQLCA          TO DP013-SQLCA                           
155500             SET DP013-DB2-ABEND TO TRUE                                  
155600             PERFORM DP013-0000-PROCESS-ABEND                             
155700     END-EVALUATE.                                                        
155800******************************************************************        
155900*    CONFIRM KEY WAS PRESSED, THE PERM HEADER(S) CAN BE UPDATED.          
156000******************************************************************        
156100 L500-UPDATE-TSTRPPC.                                                     
156200     EXEC SQL                                                             
156300          UPDATE TSTRPPC                                                  
156400          SET STATUS_CDE = :PE049-IS-CANCELLED-STATUS-CDE                 
156500            , PREV_STATUS_CDE = STATUS_CDE                                
156600            , CAN_DTE = CURRENT DATE                                      
156700            , CAN_ID = :DP020-USERID                                      
156800            , TOT_ACT_PR_CHG_AMT = 0                                      
156900          WHERE DEPT_AREA_DEST LIKE :PV-DEPT-AREA-DEST AND                
157000                STATUS_CDE ^= :PE049-IS-CANCELLED-STATUS-CDE AND          
157100                RSN_CDE = :STRPPC-RSN-CDE AND                             
157200                TYP_CDE = :STRPPC-TYP-CDE                                 
157300     END-EXEC.                                                            
157400                                                                          
157500     EVALUATE TRUE                                                        
157600         WHEN SQLCODE = ZERO                                              
157700         WHEN SQLCODE = +100                                              
157800             CONTINUE                                                     
157900         WHEN OTHER                                                       
158000             MOVE 'L500-UPDATE-TSTRPPC'                                   
158100                                 TO DP013-PARAGRAPH                       
158200             MOVE 'UPDATE PERM HEADER(S) - TSTRPPC'                       
158300                                 TO DP013-MESSAGE-TEXT (1)                
158400             MOVE SQLCA          TO DP013-SQLCA                           
158500             SET DP013-DB2-ABEND TO TRUE                                  
158600             PERFORM DP013-0000-PROCESS-ABEND                             
158700     END-EVALUATE.                                                        
158800                                                                          
158900******************************************************************        
159000*    IF THERE AREN'T ANY MORE TDFCTOR ROWS FOR THE DFCT-SHIPT-ID          
159100*    THEN YOU CAN DELETE THE RVT-DFCT-STAT ROW (RVT00000).                
159200*                                                                         
159300*    NOTE: THE RVT-SHIPT-STAT (RVT00001) IS DELETED AUTOMATCALLY          
159400*          BY DB2.                                                        
159500******************************************************************        
159600 L600-COUNT-TDFCTOR.                                                      
159700     MOVE RV103-DFCT-SHIPT-ID      TO PV-DFCT-SHIPT-ID.                   
159800                                                                          
159900     EXEC SQL                                                             
160000          SELECT COUNT(*)                                                 
160100           INTO :PV-TDFCTOR-COUNT                                         
160200           FROM TDFCTOR                                                   
160300          WHERE DFCT_SHIPT_ID = :PV-DFCT-SHIPT-ID                         
160400     END-EXEC.                                                            
160500                                                                          
160600     EVALUATE TRUE                                                        
160700         WHEN SQLCODE = ZERO                                              
160800              CONTINUE                                                    
160900                                                                          
161000         WHEN OTHER                                                       
161100              MOVE 'L600-COUNT-TDFCTOR'                                   
161200                                 TO DP013-PARAGRAPH                       
161300              MOVE 'DELETE RVT-DFCT-SHIPT'                                
161400                                 TO DP013-MESSAGE-TEXT (1)                
161500              MOVE SQLCA         TO DP013-SQLCA                           
161600              SET DP013-DB2-ABEND                                         
161700                                 TO TRUE                                  
161800              PERFORM DP013-0000-PROCESS-ABEND                            
161900     END-EVALUATE.                                                        
162000                                                                          
162100******************************************************************        
162200*    IF THERE AREN'T ANY MORE TDFCTOR ROWS FOR THE DFCT-SHIPT-ID          
162300*    THEN YOU CAN DELETE THE RVT-DFCT-STAT ROW (RVT00000).                
162400*                                                                         
162500*    NOTE: THE RVT-SHIPT-STAT (RVT00001) IS DELETED AUTOMATCALLY          
162600*          BY DB2.                                                        
162700******************************************************************        
162800 L650-DELETE-RVT-DFCT-STAT.                                               
162900     MOVE RV103-DFCT-SHIPT-ID      TO PV-DFCT-SHIPT-ID.                   
163000                                                                          
163100     EXEC SQL                                                             
163200          DELETE FROM RVT_DFCT_SHIPT                                      
163300          WHERE DFCT_SHIPT_ID = :PV-DFCT-SHIPT-ID                         
163400     END-EXEC.                                                            
163500                                                                          
163600     EVALUATE TRUE                                                        
163700         WHEN SQLCODE = ZERO                                              
163800              CONTINUE                                                    
163900         WHEN OTHER                                                       
164000              MOVE 'L650-DELETE-RVT-DFCT-SHIPT'                           
164100                                 TO DP013-PARAGRAPH                       
164200              MOVE 'DELETE RVT-DFCT-SHIPT'                                
164300                                 TO DP013-MESSAGE-TEXT (1)                
164400              MOVE SQLCA         TO DP013-SQLCA                           
164500              SET DP013-DB2-ABEND                                         
164600                                 TO TRUE                                  
164700              PERFORM DP013-0000-PROCESS-ABEND                            
164800     END-EVALUATE.                                                        
164900                                                                          
165000******************************************************************        
165100 X400-NAVIGATE.                                                           
165200******************************************************************        
165300     COMPUTE  RV100-NUMBER-PROCESSED-ITEMS =                              
165400         ((RV103-RL-ITEM - 1) * RV101-RA-MAX-ITEMS) +                     
165500                             RV103-RL-SUB.                                
165600     MOVE RV100-INTER-APPL-COMMAREA TO                                    
165700                          RV103-SAVE-INTER-APPL-COMM.                     
165800                                                                          
165900     PERFORM DP015-1000-START-NAVIGATOR.                                  
166000                                                                          
166100 EJECT                                                                    
166200*                                                                         
166300******************************************************************        
166400 X300-SETUP-INTER-APPL-COMM.                                              
166500******************************************************************        
166600                                                                          
166700     IF DP020-FK-RETURN(DP020-SRC-AID)                                    
166800         IF RV103-LIST                                                    
166900            PERFORM H200-WRITE-QUEUE                                      
167000         END-IF                                                           
167100         MOVE RV103-SAVE-INTER-APPL-COMM                                  
167200                              TO  RV100-INTER-APPL-COMMAREA               
167300         MOVE DP020-INTER-APPL-FORMAT-CODE                                
167400                              TO  DP020-INTER-APPL-ACKNLG-CODE            
167500         PERFORM  X500-RESET-INITIAL-INTER-APPL                           
167600     ELSE                                                                 
167700                                                                          
167800         MOVE RV103-DFCT-ORD-ID  TO    RV100-UK-RA-NUMBER                 
167900                                                                          
168000     END-IF.                                                              
168100                                                                          
168200 EJECT                                                                    
168300******************************************************************        
168400 X500-RESET-INITIAL-INTER-APPL.                                           
168500******************************************************************        
168600                                                                          
168700         MOVE RV103-SAVE-INTER-APPL-COMM                                  
168800                              TO  RV100-INTER-APPL-COMMAREA               
168900         IF RV103-LIST                                                    
169000            IF DP020-NEXT-ACT-APPL-ERROR                                  
169100              MOVE RV103-SAVE-TS-QUEUE TO RV101-RA-REQUEST-RECORD         
169200              SET RV101-ERR(RV103-RL-SUB) TO TRUE                         
169300              MOVE RV101-RA-REQUEST-RECORD                                
169400                                  TO     RV103-SAVE-TS-QUEUE              
169500              PERFORM H200-WRITE-QUEUE                                    
169600            END-IF                                                        
169700          END-IF.                                                         
169800******************************************************************        
169900*    FILL IN SCREEN HEADER MODULE                                         
170000******************************************************************        
170100     COPY DPPD022.                                                        
170200******************************************************************        
170300*    RETURN TO CICS MODULE                                                
170400******************************************************************        
170500     COPY DPPD003.                                                        
170600******************************************************************        
170700*    FORMAT MESSAGE LINES MODULE                                          
170800******************************************************************        
170900     COPY DPPD005.                                                        
171000******************************************************************        
171100*    GET PANEL MODULE                                                     
171200******************************************************************        
171300     COPY DPPD007.                                                        
171400******************************************************************        
171500*    WRITE PANEL MODULE                                                   
171600******************************************************************        
171700     COPY DPPD008.                                                        
171800******************************************************************        
171900*    TOGGLE THE FUNCTION KEY LINE MODULE                                  
172000******************************************************************        
172100     COPY DPPD009.                                                        
172200******************************************************************        
172300*    ABEND PROCESSOR MODULE                                               
172400******************************************************************        
172500     COPY DPPD013.                                                        
172600******************************************************************        
172700*    CHECK COMMUNICATION AREA MODULE                                      
172800******************************************************************        
172900     COPY DPPD015.                                                        
173000******************************************************************        
173100*    UPDATE TIME AND DATE MODULE                                          
173200******************************************************************        
173300     COPY DPPD017.                                                        
