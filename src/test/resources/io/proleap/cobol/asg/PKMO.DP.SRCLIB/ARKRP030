000100*##############################################################   00010001
000200*    ARKRP030 - Financial Transaction Report                      00020009
000300*##############################################################   00030001
000400 IDENTIFICATION DIVISION.                                         00040001
000500 PROGRAM-ID.     ARKRP030.                                        00050009
000600 AUTHOR.         J Zimbal.                                        00060012
000700 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00070012
000800 DATE-WRITTEN    01-07-12.                                        00080012
000900 DATE-COMPILED.                                                   00090001
001000/                                                                 00100001
001100 ENVIRONMENT DIVISION.                                            00110001
001200******************************************************************00120001
001300**DESC: FTD File From First Data Report by element ID.            00130001
001500******************************************************************00150001
001600 CONFIGURATION SECTION.                                           00160011
001700                                                                  00170011
001800 SOURCE-COMPUTER.        IBM-3090.                                00180011
001900 OBJECT-COMPUTER.        IBM-3090.                                00190011
002000                                                                  00200011
002100 INPUT-OUTPUT SECTION.                                            00210011
002200                                                                  00220011
002300 FILE-CONTROL.                                                    00230011
002400                                                                  00240011
002500     SELECT FTD-FILE             ASSIGN TO INP01.                 00250011
002600     SELECT FTD-REPORT           ASSIGN TO RPT01.                 00260011
002700                                                                  00270011
002800******************************************************************00280011
002900 DATA DIVISION.                                                   00290011
003000******************************************************************00300011
003100                                                                  00310011
003200 FILE SECTION.                                                    00320011
00050  FD  FTD-FILE                                                        CL**2
00051      RECORDING MODE IS F                                             CL**2
00052      LABEL RECORDS ARE STANDARD                                      CL**2
00053      BLOCK CONTAINS 0 RECORDS.                                       CL**2
00056                                                                      CL**2
00057  01  FTD-RECORD.                                                     CL**2
017300      10 FTD-RPT-ACTION              PIC X(1).                    01710004
035800      10 FTD-RPT-SYSTEM              PIC X(4).                    03330012
035900      10 FTD-RPT-PRIN                PIC X(4).                    03340012
036000      10 FTD-RPT-AGENT               PIC X(4).                    03350012
017300      10 FTD-ACCOUNT-ID              PIC X(16).                   01710004
017300      10 FTD-ELEMENT-ID              PIC 9(04).                   01710004
017500      10 FTD-RPT-ELEM-DESC           PIC X(75).                   01730004
018100      10 FTD-ELEMENT-AMT             PIC ZZZZZ,ZZZ,ZZZ,ZZ9.99-.   01790012
            10 FILLER                      pic X(03).                           
018200                                                                  01810003
004000                                                                  00400011
004100                                                                  00410011
004200 FD  FTD-REPORT                                                   00420011
004300     RECORDING MODE IS F                                          00430011
004400     BLOCK CONTAINS 0 RECORDS                                     00440011
004500     LABEL RECORDS ARE STANDARD.                                  00450011
004600                                                                  00460011
004700 01  FTD-REPORT-RECORD           PIC X(132).                      00470011
004800                                                                  00480011
004900*                                                                 00490011
005000******************************************************************00500001
005100 WORKING-STORAGE              SECTION.                            00510001
005200******************************************************************00520001
005300*                     LOCAL WORKING STORAGE                       00530001
005400*                     ---------------------                       00540001
005500******************************************************************00550001
005600 01  WS-LOCAL-DATA.                                               00560004
005700     05 WS-DATA                       PIC X.                      00570016
           05 WS-ELE-IDX                    PIC 9(4).                           
005800     05 WS-PGM-NAME                   PIC X(08)  VALUE "ARKRP030".00580016
005900     05 WS-ERRORS                     PIC 9(10).                  00590016
006000     05 WS-RESULTS                    PIC S9(04) COMP.            00600016
006100     05 WS-HOLD-TYPE                  PIC X(04).                  00610016
006200     05 WS-HOLD-SYSTEM                PIC X(04).                  00620016
006300     05 WS-HOLD-PRIN                  PIC X(04).                  00630016
006400     05 WS-HOLD-AGENT                 PIC X(04).                  00640016
006500     05 WS-HOLD-ACTION-CD             PIC X(01).                  00650016
008600     05 WS-ELEMENT-COUNT              PIC 9(06).                  00860016
008600     05 WS-FIRST-ELEMENT-AMT          PIC S9(14)V9(2)             00860016
008700                                      SIGN LEADING SEPARATE.      00870016
008600     05 WS-ELEMENT-AMT                PIC S9(14)V9(2)             00860016
008700                                      SIGN LEADING SEPARATE.      00870016
008600     05 WS-ELEMENT-TOTAL              PIC S9(16)V9(2)             00860016
008700                                      SIGN LEADING SEPARATE.      00870016
008600     05 WS-PREV-ACT-CODE              PIC X(01).                  00860016
008600     05 WS-PREV-ELEMENT               PIC X(04).                  00860016
008600     05 WS-PREV-ELEMENT-DESC          PIC X(75).                  00860016
009000                                                                  00900001
009100 01  WS-LOCAL-CONSTANTS.                                          00910004
009200     05 WS-FILE-USED               PIC X     VALUE "Y".           00920016
009300     05 WS-END-OF-FILE             PIC X(02) VALUE "10".          00930016
009400     05 WS-FTD-EOF                 PIC X     VALUE "N".           00940016
009500        88 FTD-EOF                           VALUE "Y".           00950016
009600     05 WS-HEADER-RECORD           PIC 9(06) VALUE ZEROS.         00960016
009700     05 WS-TRAILER-RECORD          PIC 9(06) VALUE 999999.        00970016
009800     05 PR-REPORT-LINES            PIC S9(04) COMP VALUE +0.      00980016
009900     05 PR-LINES-PAGE              PIC S9(04) COMP VALUE +0.      00990016
010000     05 PR-PAGE-COUNT              PIC S9(04) COMP VALUE +0.      01000016
010100     05 PR-REPORT-NBR              PIC S9(04) COMP VALUE +1.      01010016
010200*                                                                 01020009
010300                                                                  01030009
010700*** STANDARD HEADER LINE - 132 BYTES.                             01070009
010800     COPY DPWS132O.                                               01080009
010900                                                                  01090009
011000/***********************************************************      01100002
011100 01  WS-REPORT-LINES.                                             01110011
011200     05 PR-REPORT-HEADER.                                         01120011
011300        10 FILLER             PIC X(45)    VALUE SPACE.                   
011400        10 FILLER             PIC X(40)                                   
011500                     VALUE "FINANCIAL TRANSACTION DETAIL REPORT". 01130002
                                                                                
011200     05 PR-REPORT-HEADER-LINE2.                                   01120011
011300        10 FILLER             PIC X(01)    VALUE SPACE.                   
011400        10 FILLER             PIC X(05)                                   
011500                      VALUE "CDEOT".                              01130002
011300        10 FILLER             PIC X(03)    VALUE SPACE.                   
011400        10 FILLER             PIC X(07)                                   
011500                      VALUE "ELEMENT".                            01130002
011300        10 FILLER             PIC X(05)    VALUE SPACE.                   
011400        10 FILLER             PIC X(12)                                   
011500                      VALUE "DESCRIPTION ".                       01130002
011300        10 FILLER             PIC X(64)    VALUE SPACE.                   
011400        10 FILLER             PIC X(07)                                   
011500                      VALUE "COUNTID".                            01130002
011300        10 FILLER             PIC X(12)    VALUE SPACE.                   
011400        10 FILLER             PIC X(12)                                   
011500                      VALUE "SUM OF AMT ".                        01130002
011300        10 FILLER             PIC X(01)    VALUE SPACE.                   
                                                                                
011200     05 PR-REPORT-HEADER-LINE3.                                   01120011
011300        10 FILLER             PIC X(01)    VALUE SPACE.                   
011400        10 FILLER             PIC X(05)                                   
011500                      VALUE "=====".                              01130002
011300        10 FILLER             PIC X(03)    VALUE SPACE.                   
011400        10 FILLER             PIC X(07)                                   
011500                      VALUE "=======".                            01130002
011300        10 FILLER             PIC X(05)    VALUE SPACE.                   
011400        10 FILLER             PIC X(12)                                   
011500                      VALUE "============".                       01130002
011300        10 FILLER             PIC X(64)    VALUE SPACE.                   
011400        10 FILLER             PIC X(07)                                   
011500                      VALUE "=======".                            01130002
011300        10 FILLER             PIC X(12)    VALUE SPACE.                   
011400        10 FILLER             PIC X(12)                                   
011500                      VALUE "========== ".                        01130002
011300        10 FILLER             PIC X(01)    VALUE SPACE.                   
                                                                                
015000* FTD REPORT DETAIL LINE ONE.                                     01480002
015100*                                                                 01490002
011200     05 FTD-REPORT-DETAIL-LINE1.                                  01120011
011300        10 FILLER             PIC X(03)    VALUE SPACE.                   
011400        10 WD-ACTION-CODE     PIC X(02).                                  
011300        10 FILLER             PIC X(04)    VALUE SPACE.                   
011400        10 WD-ELEMENT-ID      PIC X(06).                                  
011300        10 FILLER             PIC X(04)    VALUE SPACE.                   
011400        10 WD-ELEMENT-DESC    PIC X(75).                                  
011300        10 FILLER             PIC X(4)    VALUE SPACE.                    
011400        10 WD-ELEMENT-COUNT   PIC ZZZZZZZ9.                               
011300        10 FILLER             PIC X(02)    VALUE SPACE.                   
018100        10 WD-ELEMENT-AMT     PIC ----,---,---,---,--9.99.        01790012
018100****    10 WD-ELEMENT-AMT     PIC -ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99.        01790012
018100***     10 WD-ELEMENT-AMT     PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99-.        01790012
018100***     10 WD-ELEMENT-AMT     PIC -Z99,999,999,999,999.99.        01790012
                                                                                
                                                                                
020200 01  WS-LOCAL-FLAGS.                                              02020004
020300     05 WS-PROGRAM-ABORT-FLAG       PIC  9     VALUE 0.           02030004
020400        88 DONOT-ABORT-PROGRAM                 VALUE 0.           02040004
020500        88 ABORT-PROGRAM                       VALUE 1.           02050004
020600                                                                  02060003
020700 01  WS-DATE-TIME.                                                02070012
020800     05 WS-DATE-TIME-YYYY.                                        02080004
020900        10 WS-DATE-TIME-CENTURY    PIC  9(02).                    02090004
021000        10 WS-DATE-TIME-YEAR       PIC  9(02).                    02100004
021100     05 WS-DATE-TIME-MONTH         PIC  9(02).                    02110004
021200     05 WS-DATE-TIME-DAY           PIC  9(02).                    02120004
021300     05 WS-DATE-TIME-HOURS         PIC  9(02).                    02130004
021400     05 WS-DATE-TIME-MINS          PIC  9(02).                    02140004
021500     05 WS-DATE-TIME-SECS          PIC  9(02).                    02150004
021600     05 WS-DATE-TIME-HSCS          PIC  9(02).                    02160004
021700                                                                  02170003
021800 01  WS-DATE-YYYYMMDD.                                            02180012
021900     05 WS-DATE-YYYYMMDD-YYYY.                                    02190004
022000        10 WS-DATE-YYYYMMDD-CENTURY PIC  9(02).                   02200004
022100        10 WS-DATE-YYYYMMDD-YEAR    PIC  9(02).                   02210004
022200     05 WS-DATE-YYYYMMDD-MONTH      PIC  9(02).                   02220004
022300     05 WS-DATE-YYYYMMDD-DAY        PIC  9(02).                   02230004
022400                                                                  02240003
022500 01  WS-TIME-HHMMSSCC.                                            02250004
022600     05 WS-TIME-HHMMSSCC-HOURS      PIC  9(02).                   02260004
022700     05 WS-TIME-HHMMSSCC-MINS       PIC  9(02).                   02270004
022800     05 WS-TIME-HHMMSSCC-SECS       PIC  9(02).                   02280004
022900     05 WS-TIME-HHMMSSCC-HSCS       PIC  9(02).                   02290004
023000                                                                  02300003
023100 01  WS-DATE-YYMMDD.                                              02310004
023200     05 WS-DATE-YYMMDD-YEAR         PIC  9(02).                   02320004
023300     05 WS-DATE-YYMMDD-MONTH        PIC  9(02).                   02330004
023400     05 WS-DATE-YYMMDD-DAY          PIC  9(02).                   02340004
023500                                                                  02350003
023600 01  WS-TIME-HHMMSS.                                              02360004
023700     05 WS-TIME-HHMMSS-HOURS        PIC  9(02).                   02370004
023800     05 WS-TIME-HHMMSS-MINS         PIC  9(02).                   02380004
023900     05 WS-TIME-HHMMSS-SECS         PIC  9(02).                   02390004
024000     05 WS-TIME-HHMMSS-HSCS         PIC  9(02).                   02400004
024100                                                                  02410003
024200 01  WS-JULIAN-DATES.                                             02420004
024300     05 WS-SYSTEM-PROCESSING-DATE   PIC S9(09) COMP.              02430004
024400     05 WS-JULIAN-DATE              PIC S9(09) COMP.              02440004
024500 01  WS-DATES.                                                            
024600     05  WS-CURRENT-DATE.                                                 
024700         10 WS-CURRENT-YY        PIC 9(02)    VALUE ZEROES.               
024800         10 WS-CURRENT-MM        PIC 9(02)    VALUE ZEROES.               
024900         10 WS-CURRENT-DD        PIC 9(02)    VALUE ZEROES.               
025000     05  WS-CURRENT-TIME.                                                 
025100         10 WS-CURRENT-HOUR      PIC 9(02)    VALUE ZEROES.               
025200         10 WS-CURRENT-MINUTE    PIC 9(02)    VALUE ZEROES.               
025300                                                                  02450003
025400 PROCEDURE DIVISION.                                              02460004
025500 0000-MAIN SECTION.                                               02470009
025600                                                                  02480003
025700     PERFORM 1000-INITIALIZE.                                     02490005
025900                                                                  02510003
026000     PERFORM 4000-CREATE-REPORT                                   02520006
026100       UNTIL FTD-EOF.                                             02530006
026200                                                                          
026700     PERFORM 9999-CLOSE                                           02550011
026800                                                                  02560003
026900     GOBACK.                                                      02570006
027000                                                                  02580003
      *-------------------------*                                               
027100 1000-INITIALIZE.                                                 02590005
      *-------------------------*                                               
027200                                                                  02600003
027300     OPEN INPUT  FTD-FILE                                         02610012
027400          OUTPUT FTD-REPORT.                                      02620011
027500                                                                  02630006
018100     MOVE ZEROES   TO  WS-ELEMENT-TOTAL                           01790012
018100                       WS-ELEMENT-AMT                             01790012
                             WS-ELEMENT-COUNT.                                  
                                                                                
027600     PERFORM 2000-READ-FTD-FILE.                                  02640008
027700                                                                  02650008
017300        MOVE FTD-RPT-ACTION       TO  WS-PREV-ACT-CODE.           01710004
017300        MOVE FTD-ELEMENT-ID       TO  WS-PREV-ELEMENT.            01710004
017500        MOVE FTD-RPT-ELEM-DESC    TO  WS-PREV-ELEMENT-DESC.       01730004
017500        MOVE ZEROES               TO  WS-ELEMENT-AMT.             01730004
018200                                                                  01810003
027800     PERFORM 3000-SETUP-REPORT.                                   02800010
027900                                                                          
      *-------------------------*                                               
028000 2000-READ-FTD-FILE.                                              02660008
      *-------------------------*                                               
028100                                                                  02670008
028200     READ FTD-FILE                                                02680013
028400       AT END                                                     02700006
028500          SET FTD-EOF TO TRUE.                                    02710006
028600                                                                  02720006
                                                                                
030100/*****************************************************************02880010
030200*                          SETUP REPORT                           02890010
030300*                          ------------                           02900010
030400* This section controls the setting up oF the batch audit report. 02910010
030500******************************************************************02920010
030600 3000-SETUP-REPORT.                                               02930010
030700*                                                                 02940010
031300* Initialize the working storage variables                        03000010
031400*                                                                 03010010
032700                                                                  03140010
032800* SET REPORT HEADER DATE AND TIME                                         
032900     ACCEPT WS-CURRENT-DATE FROM DATE.                                    
033000     ACCEPT WS-CURRENT-TIME FROM TIME.                                    
033100                                                                          
033200     MOVE WS-CURRENT-YY            TO DP132O-RUN-YEAR.                    
033300     MOVE WS-CURRENT-MM            TO DP132O-RUN-MONTH.                   
033400     MOVE WS-CURRENT-DD            TO DP132O-RUN-DAY.                     
033500                                                                          
033600     MOVE WS-CURRENT-HOUR          TO DP132O-RUN-HOUR.                    
033700     MOVE WS-CURRENT-MINUTE        TO DP132O-RUN-MINUTE.                  
033800                                                                          
033900     MOVE WS-PGM-NAME              TO DP132O-PROGRAM-NAME.                
034000     PERFORM 9200-WRITE-HEADERS.                                  03150011
034100*                                                                 03160011
      *-------------------------*                                               
028700 4000-CREATE-REPORT.                                              02730006
      *-------------------------*                                               
                                                                                
                                                                                
043300     EVALUATE TRUE                                                04080007
                                                                                
043400              WHEN FTD-ELEMENT-ID      = WS-PREV-ELEMENT          04090007
018100                   ADD  WS-ELEMENT-AMT       TO  WS-ELEMENT-TOTAL 01790012
                         ADD +1                    TO  WS-ELEMENT-COUNT         
                                                                                
043400              WHEN FTD-ELEMENT-ID NOT = WS-PREV-ELEMENT           04090007
018100                   ADD  WS-ELEMENT-AMT       TO  WS-ELEMENT-TOTAL 01790012
034700                   PERFORM 5000-PRINT-DETAILS                     03220010
                         MOVE ZEROES               TO  WS-ELEMENT-TOTAL         
                                                       WS-ELEMENT-COUNT         
                         ADD +1                    TO  WS-ELEMENT-COUNT         
                                                                                
                                                                                
043400              WHEN FTD-RPT-ACTION NOT = WS-PREV-ACT-CODE          04090007
018100                   ADD  WS-ELEMENT-AMT       TO  WS-ELEMENT-TOTAL 01790012
034700                   PERFORM 5000-PRINT-DETAILS                     03220010
                         MOVE ZEROES               TO  WS-ELEMENT-TOTAL         
                                                       WS-ELEMENT-COUNT         
                         ADD +1                    TO  WS-ELEMENT-COUNT         
                                                                                
045700     END-EVALUATE                                                 04320007
                                                                                
017300     MOVE FTD-RPT-ACTION       TO  WS-PREV-ACT-CODE.              01710004
017300     MOVE FTD-ELEMENT-ID       TO  WS-PREV-ELEMENT.               01710004
017500     MOVE FTD-RPT-ELEM-DESC    TO  WS-PREV-ELEMENT-DESC.          01730004
017500     MOVE FTD-ELEMENT-AMT      TO  WS-ELEMENT-AMT.                01730004
018200                                                                  01810003
027600     PERFORM 2000-READ-FTD-FILE.                                  02640008
027700                                                                  02650008
                                                                                
034200/*****************************************************************03170010
034300*                              PRINT DETAILS                      03180010
034400*                              -------------                      03190010
034500* This section controls the printing oF the batch audit report det03200010
034600******************************************************************03210010
034700 5000-PRINT-DETAILS.                                              03220010
058500*---------------------------*                                     05600011
034800                                                                  03230010
017300        MOVE WS-PREV-ACT-CODE     TO  WD-ACTION-CODE              01710004
017300        MOVE WS-PREV-ELEMENT      TO  WD-ELEMENT-ID               01710004
017500        MOVE WS-PREV-ELEMENT-DESC TO  WD-ELEMENT-DESC.            01730004
018100        MOVE WS-ELEMENT-TOTAL     TO  WD-ELEMENT-AMT              01790012
              MOVE WS-ELEMENT-COUNT     TO  WD-ELEMENT-COUNT                    
018200                                                                  01810003
037400                                                                  03490010
037700     WRITE FTD-REPORT-RECORD FROM FTD-REPORT-DETAIL-LINE1         03520012
037800                        AFTER ADVANCING 1 LINE.                   03530011
037900     ADD 1 TO PR-LINES-PAGE.                                      03540011
038000     PERFORM 9200-WRITE-HEADERS.                                  03550011
042500*                                                                 04000008
                                                                                
058500*---------------------------*                                     05600011
058600 9200-WRITE-HEADERS.                                              05610011
058500*---------------------------*                                     05600011
058700                                                                  05620011
058800      IF PR-LINES-PAGE = 0                                        05630011
058900      OR PR-LINES-PAGE > 61                                       05640011
059000         ADD  1                 TO PR-PAGE-COUNT                  05650011
059100         MOVE PR-PAGE-COUNT     TO DP132O-PAGE-NUMBER             05660011
059200         MOVE 0                 TO PR-LINES-PAGE                  05670011
059300         MOVE PR-REPORT-NBR     TO DP132O-REPORT-NUMBER           05680011
059400         WRITE FTD-REPORT-RECORD FROM                             05690011
059500                                DP132O-STANDRD-HEADER-132-COLS    05700011
059600                AFTER ADVANCING PAGE                              05710011
059700         WRITE FTD-REPORT-RECORD FROM PR-REPORT-HEADER            05720011
059800               AFTER ADVANCING 2 LINES                            05730011
059700         WRITE FTD-REPORT-RECORD FROM PR-REPORT-HEADER-LINE2      05720011
059800               AFTER ADVANCING 3 LINES                            05730011
059700         WRITE FTD-REPORT-RECORD FROM PR-REPORT-HEADER-LINE3      05720011
059800               AFTER ADVANCING 3 LINES                            05730011
060300         ADD 10 TO PR-LINES-PAGE                                  05780011
060400     END-IF.                                                      05790011
060500                                                                  05800011
060600 9999-CLOSE.                                                      05810011
060700                                                                  05820011
060800     CLOSE FTD-FILE                                               05830011
060900           FTD-REPORT.                                            05840011
