000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    RCKCS235.                                         00020000
000300 AUTHOR.        TOM RUSKA.                                        00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  03-08-94.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800*---------------------------------------------------------------* 00080000
000900*    E235 - PURCHASE ORDERS ON A SHIPMENT LIST                  * 00090000
001000*                                                               * 00100000
001100*    THIS PROGRAM GENERATES A LIST OF PO NUMBERS FOR A SHIPMENT.* 00110000
001200*                                                               * 00120000
001300*    THE DP030-OVERRIDE-APPL-ERROR SWITCH IS SET TO TRUE WHEN   * 00130000
001400*    ENTERING THE PROGRAM IN ORDER TO GIVE CONTROL BACK TO THE  * 00140000
001500*    LIST WHEN A NEXT-ACT-APPL-ERROR IS SENT BACK FROM THE      * 00150000
001600*    UPDATE.  THE DP030-RC-APPL-ERROR IS CHECKED TO DETERMINE   * 00160000
001700*    IF A NEXT-ACT-APPL-ERROR IS BEING RETURNED TO THE LIST.    * 00170000
001800*                                                               * 00180000
001900*    IR-213: DON'T ALLOW F16 (DELETE FUNCTION) IF A RECEIVER    * 00190000
002000*            EXISTS.                                            * 00200000
002100*            7/13/94 BY M. FURLICK                              * 00210000
002200*---------------------------------------------------------------* 00220000
002300*  CHANGED 10/21/2014    BY COGNIZANT       WR: CHG0094517        00230019
002400*                                                                 00240020
002500* EXTENDED PO# FROM 7 TO 8 DIGITS WHERE NEEDED.                   00250020
002600*-----------------------------------------------------------------00260020
002610* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00261027
002620* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00262028
002630* MAKING THE CALL DYNAMIC VS STATIC.                              00263028
002640*---------------------------------------------------------------* 00264028
002700/                                                                 00270000
002800 ENVIRONMENT DIVISION.                                            00280000
002900 DATA DIVISION.                                                   00290000
003000 WORKING-STORAGE SECTION.                                         00300000
003100                                                                  00310000
003200 01  DK-DB2-KEYS.                                                 00320000
003300     05  DK-OWNER-SCAC-ID                PIC  X(04)  VALUE SPACE. 00330000
003400     05  DK-VEH-NBR                      PIC  X(10)  VALUE SPACE. 00340000
003500     05  DK-PRO-NBR                      PIC  X(16)  VALUE SPACE. 00350000
003600     05  DK-BOL-NBR                      PIC  X(16)  VALUE SPACE. 00360000
003700     05  DK-OPER-UNT-ID                  PIC S9(04) COMP VALUE +0.00370000
003800     05  DK-PO-NBR                       PIC S9(09) COMP VALUE +0.00380000
003900     05  DK-SHIPT-ID                     PIC S9(09) COMP VALUE +0.00390000
004000                                                                  00400000
004100 01  DN-DB2-NULL-INDICATORS.                                      00410000
004200     05  DN-AD-EVNT-DTE                  PIC S9(04) VALUE +0      00420000
004300                                                    COMP.         00430000
004400     05  DN-VEH-NBR                      PIC S9(04) VALUE +0      00440000
004500                                                    COMP.         00450000
004600 01  PC-PROGRAM-CONSTANTS.                                        00460000
004700     05  PC-CURRENT-MAP-NAME             PIC  X(08)  VALUE        00470000
004800                                                     'RC235A  '.  00480000
004900     05  PC-CURRENT-MAPSET-NAME          PIC  X(08)  VALUE        00490000
005000                                                     'RCKM235 '.  00500000
005100     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00510000
005200                                                     'RCKCS235'.  00520000
005300     05  PC-LIST-QUEUE-SEQ               PIC  9(01)  VALUE 1.     00530000
005400     05  PC-SEL-QUEUE-SEQ                PIC  9(01)  VALUE 2.     00540000
005500     05  PC-INTER-APPL-CODES.                                     00550000
005600         10 PC-INTER-APPL-YARD-LIST     PIC  X(01)  VALUE 'A'.    00560000
005700     05  PC-ITEMS-PER-PANEL              PIC S9(04)  VALUE +11    00570000
005800                                                     COMP SYNC.   00580000
005900     05  PC-MAX-BLOCKS-IN-ARRAY          PIC S9(04)  VALUE +2     00590000
006000                                                     COMP SYNC.   00600000
006100     05  PC-MAX-ITEMS                    PIC S9(09)  VALUE        00610000
006200                                                     +1000000     00620000
006300                                                     COMP-3.      00630000
006400     05  PC-MSG-NUMBER-LENGTH            PIC S9(04)  VALUE +7     00640000
006500                                                     COMP SYNC.   00650000
006600     05  PC-MAX-RETRIES                  PIC S9(03)  VALUE 3      00660000
006700                                                     COMP-3.      00670000
006800     05  PC-PERCENT                      PIC  X(01)  VALUE '%'.   00680000
006900     05  PC-INQ                          PIC  X(03)  VALUE 'INQ'. 00690000
007000     05  PC-UPD                          PIC  X(03)  VALUE 'UPD'. 00700000
007100     05  PC-DEL                          PIC  X(03)  VALUE 'DEL'. 00710000
007200     05  PC-ERR                          PIC  X(03)  VALUE 'ERR'. 00720000
007300                                                                  00730000
007400     05  PC-TSYMSG-NUMBERS.                                       00740000
007500         10  PC-TSYMSG-00005             PIC  9(05)  VALUE 00005. 00750000
007600         10  PC-TSYMSG-00007             PIC  9(05)  VALUE 00007. 00760000
007700         10  PC-TSYMSG-00008             PIC  9(05)  VALUE 00008. 00770000
007800         10  PC-TSYMSG-00047             PIC  9(05)  VALUE 00047. 00780000
007900         10  PC-TSYMSG-00050             PIC  9(05)  VALUE 00050. 00790000
008000         10  PC-TSYMSG-00051             PIC  9(05)  VALUE 00051. 00800000
008100         10  PC-TSYMSG-00052             PIC  9(05)  VALUE 00052. 00810000
008200         10  PC-TSYMSG-00053             PIC  9(05)  VALUE 00053. 00820000
008300         10  PC-TSYMSG-00054             PIC  9(05)  VALUE 00054. 00830000
008400         10  PC-TSYMSG-00055             PIC  9(05)  VALUE 00055. 00840000
008500         10  PC-TSYMSG-00057             PIC  9(05)  VALUE 00057. 00850000
008600         10  PC-TSYMSG-00069             PIC  9(05)  VALUE 00069. 00860000
008700         10  PC-TSYMSG-00070             PIC  9(05)  VALUE 00070. 00870000
008800         10  PC-TSYMSG-00082             PIC  9(05)  VALUE 00082. 00880000
008900         10  PC-TSYMSG-00098             PIC  9(05)  VALUE 00098. 00890000
009000         10  PC-TSYMSG-00101             PIC  9(05)  VALUE 00101. 00900000
009100         10  PC-TSYMSG-00148             PIC  9(05)  VALUE 00148. 00910000
009200         10  PC-TSYMSG-00279             PIC  9(05)  VALUE 00279. 00920000
009300         10  PC-TSYMSG-00390             PIC  9(05)  VALUE 00390. 00930000
009400         10  PC-TSYMSG-00416             PIC  9(05)  VALUE 00416. 00940000
009500         10  PC-TSYMSG-00417             PIC  9(05)  VALUE 00417. 00950000
009600         10  PC-TSYMSG-00902             PIC  9(05)  VALUE 00902. 00960000
009700         10  PC-TSYMSG-99901             PIC  9(05)  VALUE 99901. 00970000
009800         10  PC-TSYMSG-99907             PIC  9(05)  VALUE 99907. 00980000
009900                                                                  00990000
010000 01  PS-PROGRAM-SWITCHES.                                         01000000
010100     05  PS-ERROR-SW                     PIC  X(01)  VALUE 'Y'.   01010000
010200         88  PS-NO-ERROR                             VALUE 'Y'.   01020000
010300         88  PS-ERROR                                VALUE 'N'.   01030000
010400     05  PS-COMMAREA-SW                  PIC  X(01)  VALUE 'N'.   01040000
010500         88  PS-COMMAREA-VALID                       VALUE 'Y'.   01050000
010600         88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.   01060000
010700     05  PS-DONE-SW                      PIC  X(01)  VALUE 'N'.   01070000
010800         88  PS-DONE                                 VALUE 'Y'.   01080000
010900         88  PS-NOT-DONE                             VALUE 'N'.   01090000
011000                                                                  01100000
011100 01  PV-PROGRAM-VARIABLES.                                        01110000
011200     05  PV-SUB                          PIC S9(04)  VALUE +0     01120000
011300                                                     COMP SYNC.   01130000
011400     05  PV-REMAINDER                    PIC S9(04)  VALUE +0     01140000
011500                                                     COMP SYNC.   01150000
011600     05  PV-READ-COUNT                   PIC S9(09)  VALUE +0     01160000
011700                                                     COMP-3.      01170000
011800     05  PV-ITEMS-PROCESSED              PIC S9(09)  VALUE +0     01180000
011900                                                     COMP-3.      01190000
012000     05  PV-HOLD-SELECTED-ITEMS          PIC S9(09)  VALUE +0     01200000
012100                                                     COMP-3.      01210000
012200     05  PV-ITEM-IN-USE                  PIC S9(09)  VALUE +0     01220000
012300                                                     COMP-3.      01230000
012400     05  PV-TOP-ITEM                     PIC S9(09)  VALUE +0     01240000
012500                                                     COMP-3.      01250000
012600     05  PV-BOTTOM-ITEM                  PIC S9(09)  VALUE +0     01260000
012700                                                     COMP-3.      01270000
012800     05  PV-TEMP-BLOCK-NUMBER            PIC S9(09)  VALUE +0     01280000
012900                                                     COMP-3.      01290000
013000     05  PV-BLOCK-NUMBER                 PIC S9(04)  VALUE +0     01300000
013100                                                     COMP SYNC.   01310000
013200     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     01320000
013300                                                     COMP SYNC.   01330000
013400     05  PV-ITEM                         PIC S9(04)  VALUE +0     01340000
013500                                                     COMP SYNC.   01350000
013600     05  PV-SEL-QUEUE-ITEM               PIC S9(04)  VALUE +0     01360000
013700                                                     COMP SYNC.   01370000
013800     05  PV-SAVE-ITEM                    PIC S9(04)  VALUE +0     01380000
013900                                                     COMP SYNC.   01390000
014000     05  PV-HIGHEST-BLOCK-WRITTEN        PIC S9(04)  VALUE +0     01400000
014100                                                     COMP SYNC.   01410000
014200     05  PV-LIST-ITEM-NUMBER             PIC S9(04)  VALUE +0     01420000
014300                                                     COMP SYNC.   01430000
014400     05  PV-FIRST-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0     01440000
014500                                                     COMP SYNC.   01450000
014600     05  PV-NEXT-BLOCK-IN-ARRAY          PIC S9(04)  VALUE +0     01460000
014700                                                     COMP SYNC.   01470000
014800     05  PV-PREV-BLOCK-IN-ARRAY          PIC S9(04)  VALUE +0     01480000
014900                                                     COMP SYNC.   01490000
015000     05  PV-FIRST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0     01500000
015100                                                     COMP SYNC.   01510000
015200     05  PV-LAST-BLOCK-IN-RANGE          PIC S9(04)  VALUE +0     01520000
015300                                                     COMP SYNC.   01530000
015400     05  PV-START-OF-SELECTED-RANGE      PIC S9(04)  VALUE +0     01540000
015500                                                     COMP SYNC.   01550000
015600     05  PV-END-OF-SELECTED-RANGE        PIC S9(04)  VALUE +0     01560000
015700                                                     COMP SYNC.   01570000
015800     05  PV-SQL-SUB                      PIC S9(04)  VALUE +0     01580000
015900                                                     COMP SYNC.   01590000
016000     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE +0     01600000
016100                                                     COMP SYNC.   01610000
016200     05  PV-SUB1                         PIC S9(04)  VALUE ZERO   01620000
016300                                                     COMP.        01630000
016400     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         01640000
016500                                                 COMP-3.          01650000
016600     05  PV-DB2-DATE                  PIC  X(10).                 01660000
016700     05  FILLER  REDEFINES PV-DB2-DATE.                           01670000
016800         10  PV-DB2-DATE-CC           PIC  X(02).                 01680000
016900         10  PV-DB2-DATE-YY           PIC  X(02).                 01690000
017000         10  FILLER                   PIC  X(01).                 01700000
017100         10  PV-DB2-DATE-MM           PIC  X(02).                 01710000
017200         10  FILLER                   PIC  X(01).                 01720000
017300         10  PV-DB2-DATE-DD           PIC  X(02).                 01730000
017400     05  PV-DISPLAY-DATE.                                         01740000
017500         10  PV-DISPLAY-DATE-MM       PIC  X(02).                 01750000
017600         10  PV-DISPLAY-DATE-DD       PIC  X(02).                 01760000
017700         10  PV-DISPLAY-DATE-YY       PIC  X(02).                 01770000
017800     05  PV-UNPACK-OPER-UNT-ID        PIC  9(04).                 01780005
017900                                                                  01790000
018000******************************************************************01800000
018100**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01810000
018200**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01820000
018300**  APPLICATION-SPECIFIC COMMAREA.                              **01830000
018400******************************************************************01840000
018500 01  LQW-LIST-QUEUE-WORK-AREA.                                    01850000
018600     05  LQW-BLOCK-MODIFIED              PIC  X(01)  VALUE SPACE. 01860000
018700     05  LQW-ITEM-ENTRIES                                         01870000
018800                 OCCURS 11 TIMES                                  01880000
018900                 INDEXED BY LQW-IDX.                              01890000
019000         10  LQW-LIST-ITEM-NUMBER        PIC S9(09)  COMP-3.      01900000
019100         10  LQW-TEMP-SELECTED-SW        PIC  X(01).              01910000
019200         10  LQW-SELECTED-SW             PIC  X(01).              01920000
019300             88  LQW-SELECT                          VALUE 'S'.   01930000
019400             88  LQW-DESELECT                        VALUE ' '.   01940000
019500         10  LQW-PO-NBR                  PIC  9(08).              01950010
019600         10  LQW-CTN-CNT                 PIC  9(04).              01960000
019700         10  LQW-ACTL-CTN-CNT            PIC  9(04).              01970000
019800         10  LQW-DMG-CTN-CNT             PIC  9(04).              01980000
019900         10  LQW-REC-SEQ-NBR             PIC  9(04).              01990000
020000         10  LQW-PIC-AD                  PIC  X(03).              02000000
020100         10  LQW-AD-DTE                  PIC  X(06).              02010000
020200         10  LQW-ENT-NAME-DESC           PIC  X(25).              02020000
020300         10  LQW-ERROR-SW                PIC  X(01).              02030000
020400             88  LQW-ERROR                           VALUE 'E'.   02040000
020500                                                                  02050000
020600*---------------------------------------------------------------* 02060000
020700*  RECORD LAYOUT FOR THE RECEIVER SELECTION TEMP STORAGE QUEUE. * 02070000
020800*---------------------------------------------------------------* 02080000
020900                                                                  02090000
021000     COPY RCWS013.                                                02100000
021100                                                                  02110000
021200/                                                                 02120000
021300*---------------------------------------------------------------* 02130000
021400*  RECORD LAYOUT FOR THE YARD SELECTION TEMP STORAGE QUEUE.     * 02140000
021500*---------------------------------------------------------------* 02150000
021600                                                                  02160000
021700     COPY TRWS006.                                                02170000
021800                                                                  02180000
021900/                                                                 02190000
022000*---------------------------------------------------------------* 02200000
022100*    MAP LAYOUT                                                 * 02210000
022200*---------------------------------------------------------------* 02220000
022300                                                                  02230000
022400     COPY RCKM235.                                                02240000
022500                                                                  02250000
022600 01  MR-OCCURS-LAYOUT                    REDEFINES RC235AO.       02260000
022800     05  FILLER                          PIC X(221).              02280019
022900                                                                  02290000
023000     05  MR-SCROLL-AREA                  OCCURS 11 TIMES.         02300000
023100         10  MR-SELECTL                  PIC S9(04)  COMP.        02310000
023200         10  MR-SELECTA                  PIC  X(01).              02320000
023300         10  MR-SELECTC                  PIC  X(01).              02330000
023400         10  MR-SELECTH                  PIC  X(01).              02340000
023500         10  MR-SELECT                   PIC  X(01).              02350000
023600                                                                  02360000
023700         10  FILLER                      PIC  X(05).              02370000
023800         10  MR-PO-NBR                   PIC  X(08).              02380010
023900                                                                  02390000
024000         10  FILLER                      PIC  X(05).              02400000
024100         10  MR-CARTON-CNT-X.                                     02410000
024200             15  MR-CARTON-CNT           PIC  Z(3)9.              02420000
024300                                                                  02430000
024400         10  FILLER                      PIC  X(05).              02440000
024500         10  MR-ACTL-CARTON-CNT-X.                                02450000
024600             15  MR-ACTL-CARTON-CNT      PIC  Z(3)9.              02460000
024700                                                                  02470000
024800         10  FILLER                      PIC  X(05).              02480000
024900         10  MR-DMG-CARTON-CNT-X.                                 02490000
025000             15  MR-DMG-CARTON-CNT       PIC  Z(3)9.              02500000
025100                                                                  02510000
025200         10  FILLER                      PIC  X(05).              02520000
025300         10  MR-REC-SEQ-NBR              PIC  X(04).              02530000
025400                                                                  02540000
025500         10  FILLER                      PIC  X(05).              02550000
025600         10  MR-PIC-AD                   PIC  X(03).              02560000
025700                                                                  02570000
025800         10  FILLER                      PIC  X(05).              02580000
025900         10  MR-AD-DTE                   PIC  X(06).              02590000
026000                                                                  02600000
026100         10  FILLER                      PIC  X(05).              02610000
026200         10  MR-ENT-NAME-DESC            PIC  X(25).              02620000
026300/                                                                 02630000
026400*---------------------------------------------------------------* 02640000
026500*    ABEND PROCESSING COPYBOOK.                                 * 02650000
026600*---------------------------------------------------------------* 02660000
026700                                                                  02670000
026800     COPY DPWS013.                                                02680000
026900/                                                                 02690000
027000*---------------------------------------------------------------* 02700000
027100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02710000
027200*---------------------------------------------------------------* 02720000
027300                                                                  02730000
027400     COPY DPWS015.                                                02740000
027500                                                                  02750000
027600*---------------------------------------------------------------* 02760000
027700*    FUNCTION KEYS COPYBOOK.                                    * 02770000
027800*---------------------------------------------------------------* 02780000
027900                                                                  02790000
028000     COPY DPWS016.                                                02800000
028100                                                                  02810000
028200*---------------------------------------------------------------* 02820000
028300*    NUMERIC EDIT LAYOUT.                                       * 02830000
028400*---------------------------------------------------------------* 02840000
028500                                                                  02850000
028600     COPY DPWS010I.                                               02860000
028700/                                                                 02870000
028800******************************************************************02880028
028900** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **02890028
028910** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **02891028
029000******************************************************************02900028
029100                                                                  02910000
029200     COPY DPWS030.                                                02920000
029210     COPY DPWS930.                                                02921028
029300/                                                                 02930000
029400*---------------------------------------------------------------* 02940005
029500*    COPYBOOK FOR CALLING LOGISTICS LOCATION MODULE (XLKUT071). * 02950005
029600*---------------------------------------------------------------* 02960005
029700                                                                  02970005
029800     COPY XLWS071.                                                02980006
029900/                                                                 02990005
030000*---------------------------------------------------------------* 03000000
030100*    STANDARD COMMAREA.                                         * 03010000
030200*---------------------------------------------------------------* 03020000
030300                                                                  03030000
030400     COPY DPWS020.                                                03040000
030500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03050000
030600                                                                  03060000
030700*---------------------------------------------------------------* 03070000
030800* INTER-APPLICATION COMMAREA.                                   * 03080000
030900*---------------------------------------------------------------* 03090000
031000                                                                  03100000
031100         10  INTER-APPL-COMM-AREA       PIC X(200).               03110000
031200     COPY RCWS012.                                                03120000
031300     COPY RCWS015.                                                03130000
031400*---------------------------------------------------------------* 03140000
031500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03150000
031600*---------------------------------------------------------------* 03160000
031700         10  ASC-SPECIFIC-COMMAREA.                               03170000
031800             15  ASC-LIST-KEYS.                                   03180000
031900                 20  ASC-KEY-OWNER-SCAC-ID           PIC  X(04).  03190000
032000                 20  ASC-KEY-VEH-NBR                 PIC  X(10).  03200000
032100                 20  ASC-KEY-PRO-NBR                 PIC  X(16).  03210000
032200                 20  ASC-KEY-BOL-NBR                 PIC  X(16).  03220000
032300                 20  ASC-KEY-OPER-UNT-ID             PIC S9(04)   03230000
032400                                                         COMP.    03240000
032500                 20  ASC-KEY-FCLTY-ID                PIC S9(04)   03250000
032600                                                         COMP.    03260000
032700                 20  ASC-KEY-ARRIVAL-DTE             PIC  X(10).  03270000
032800                 20  ASC-KEY-SHIPT-ID                PIC S9(09)   03280000
032900                                                         COMP.    03290000
033000                 20  ASC-KEY-TRIP-ID                 PIC S9(09)   03300000
033100                                                         COMP.    03310000
033200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03320000
033300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03330000
033400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03340000
033500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03350000
033600                                                                  03360000
033700                 20  ASC-ITEM-ARRAY.                              03370000
033800                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        03380000
033900                         30  ASC-LIST-ITEM-NUMBER                 03390000
034000                                                     PIC S9(09)   03400000
034100                                                     COMP-3.      03410000
034200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03420000
034300                             88  ASC-VALID-SELECT    VALUE ' '    03430000
034400                                                           'S'    03440000
034500                                                           'B'    03450000
034600                                                           'E'.   03460000
034700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03470000
034800                             88  ASC-TEMP-SELECT     VALUE 'S'.   03480000
034900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03490000
035000                             88  ASC-TEMP-END        VALUE 'E'.   03500000
035100                         30  ASC-SELECTED-SW         PIC  X(01).  03510000
035200                             88  ASC-NO-SELECT       VALUE ' '.   03520000
035300                             88  ASC-SELECT          VALUE 'S'.   03530000
035400                             88  ASC-BEGIN           VALUE 'B'.   03540000
035500                             88  ASC-END             VALUE 'E'.   03550000
035600                         30  ASC-PO-NBR              PIC  9(08).  03560010
035700                         30  ASC-CTN-CNT             PIC  9(04).  03570000
035800                         30  ASC-ACTL-CTN-CNT        PIC  9(04).  03580000
035900                         30  ASC-DMG-CTN-CNT         PIC  9(04).  03590000
036000                         30  ASC-REC-SEQ-NBR         PIC  9(04).  03600000
036100                         30  ASC-PIC-AD              PIC  X(03).  03610000
036200                         30  ASC-AD-DTE              PIC  X(06).  03620000
036300                         30  ASC-ENT-NAME-DESC       PIC  X(25).  03630000
036400                         30  ASC-ERROR-SW            PIC  X(01).  03640000
036500                             88  ASC-ERROR           VALUE 'E'.   03650000
036600                                                                  03660000
036700             15  ASC-FCLTY-NME                       PIC  X(25).  03670000
036800             15  ASC-BLK-SUB                         PIC S9(04)   03680000
036900                                                          COMP    03690000
037000                                                          SYNC.   03700000
037100             15  ASC-ITEM-SUB                        PIC S9(04)   03710000
037200                                                          COMP    03720000
037300                                                          SYNC.   03730000
037400             15  ASC-SEL-SUB            PIC S9(04) COMP.          03740000
037500             15  ASC-SEL-ITEM           PIC S9(04) COMP.          03750000
037600             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03760000
037700                                                          COMP-3. 03770000
037800             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03780000
037900                                                          COMP-3. 03790000
038000             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   03800000
038100                                                          COMP-3. 03810000
038200             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03820000
038300                                                          COMP-3. 03830000
038400             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03840000
038500                                                          COMP-3. 03850000
038600             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03860000
038700                                                          COMP-3. 03870000
038800             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03880000
038900                                                          COMP    03890000
039000                                                          SYNC.   03900000
039100             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03910000
039200                                                          COMP-3. 03920000
039300             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03930000
039400                                                          COMP-3. 03940000
039500             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03950000
039600                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03960000
039700                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03970000
039800             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03980000
039900                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03990000
040000                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04000000
040100             15  ASC-LIST-QUEUE-NAME.                             04010000
040200                 20  ASC-LIST-TERM-ID                PIC  X(04).  04020000
040300                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04030000
040400                                                          COMP-3. 04040000
040500                 20  ASC-LIST-SEQ               PIC  9(01).       04050000
040600             15  ASC-SEL-QUEUE-NAME-IN          PIC X(08).        04060000
040700             15  ASC-SEL-QUEUE-NAME-OUT.                          04070000
040800                 20  ASC-SEL-TERM-ID-OUT        PIC X(04).        04080000
040900                 20  ASC-SEL-TASK-NUMBER-OUT                      04090000
041000                                                PIC S9(05) COMP-3.04100000
041100                 20  ASC-SEL-SEQ-OUT            PIC 9(01).        04110000
041200                                                                  04120000
041300             15  ASC-CURSOR-SW                       PIC  X(01).  04130000
041400                 88  ASC-NO-CURSOR                   VALUE 'Z'.   04140000
041500             15  ASC-START-ITEM-REQUEST.                          04150000
041600                 20  ASC-START-ITEM-REQUEST-N        PIC  9(07).  04160000
041700             15  ASC-USE-SELECTION-QUEUE-IND   PIC X(01).         04170000
041800                 88  ASC-USE-SELECTION-QUEUE   VALUE 'Y'.         04180000
041801***                                                               04180120
041802*** DMH 1/22/2019 - BEGIN                                         04180220
041803***                                                               04180320
041810             15  ASC-TRIP-OPER                 PIC S9(04) COMP.   04181020
041830             15  ASC-TRIP-OPER-E-BUS-SW        PIC  X(01).        04183020
041840                 88  ASC-TRIP-E-BUS            VALUE 'Y'.         04184020
041850                 88  ASC-TRIP-E-BUS-N          VALUE 'N'.         04185020
041860             15  ASC-TRIP-OPER-SW              PIC  X(01).        04186020
041870                 88  ASC-SINGLE-OPER           VALUE 'S'.         04187020
041880                 88  ASC-MULT-OPER             VALUE 'M'.         04188020
041881             15  ASC-TRIP-OPER-NAME            PIC  X(34).        04188122
041890***                                                               04189020
041891*** DMH 1/22/2019 - END                                           04189120
041892***                                                               04189220
041900                                                                  04190000
042000/                                                                 04200000
042100*---------------------------------------------------------------* 04210000
042200*    DB2 AREA FOR SHIPMENT PO TABLE                             * 04220000
042300*---------------------------------------------------------------* 04230000
042400     EXEC SQL                                                     04240000
042500          INCLUDE TSHPTPO                                         04250000
042600     END-EXEC.                                                    04260000
042700                                                                  04270000
042800/                                                                 04280000
042900*---------------------------------------------------------------* 04290000
043000*    DB2 AREA FOR SHIPMENT TABLE                                * 04300000
043100*---------------------------------------------------------------* 04310000
043200     EXEC SQL                                                     04320000
043300          INCLUDE TSHIPMT                                         04330000
043400     END-EXEC.                                                    04340000
043500                                                                  04350000
043600/                                                                 04360000
043700*---------------------------------------------------------------* 04370000
043800*    DB2 AREA FOR THE ENTERPRISE TABLE                          * 04380000
043900*---------------------------------------------------------------* 04390000
044000     EXEC SQL                                                     04400000
044100          INCLUDE TEXTENT                                         04410000
044200     END-EXEC.                                                    04420000
044300                                                                  04430000
044400/                                                                 04440000
044500*---------------------------------------------------------------* 04450000
044600*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 04460000
044700*---------------------------------------------------------------* 04470000
044800     EXEC SQL                                                     04480000
044900          INCLUDE TENTNME                                         04490000
045000     END-EXEC.                                                    04500000
045100                                                                  04510000
045200/                                                                 04520000
045300*---------------------------------------------------------------* 04530000
045400*    DB2 AREA FOR THE PO TABLE                                  * 04540000
045500*---------------------------------------------------------------* 04550000
045600     EXEC SQL                                                     04560000
045700          INCLUDE TPURCHS                                         04570000
045800     END-EXEC.                                                    04580000
045900                                                                  04590000
046000/                                                                 04600000
046100*---------------------------------------------------------------* 04610000
046200*    DB2 AREA FOR THE PO LINE ITEM TABLE                        * 04620000
046300*---------------------------------------------------------------* 04630000
046400     EXEC SQL                                                     04640000
046500          INCLUDE TPURITM                                         04650000
046600     END-EXEC.                                                    04660000
046700                                                                  04670000
046800/                                                                 04680000
046900*---------------------------------------------------------------* 04690000
047000*    DB2 AREA FOR THE TRIP TABLE                                * 04700000
047100*---------------------------------------------------------------* 04710000
047200     EXEC SQL                                                     04720000
047300          INCLUDE TVHTRIP                                         04730000
047400     END-EXEC.                                                    04740000
047500                                                                  04750000
047510*---------------------------------------------------------------* 04751023
047520*    DB2 AREA FOR THE TRIP STATUS TABLE                         * 04752023
047530*---------------------------------------------------------------* 04753023
047540     EXEC SQL                                                     04754023
047550          INCLUDE TTRIPST                                         04755023
047560     END-EXEC.                                                    04756023
047570                                                                  04757023
047580*---------------------------------------------------------------* 04758023
047590*    DB2 AREA FOR THE XLT_LOC                                   * 04759023
047591*---------------------------------------------------------------* 04759123
047592     EXEC SQL                                                     04759223
047593          INCLUDE XLT00010                                        04759323
047594     END-EXEC.                                                    04759423
047595                                                                  04759523
047600/                                                                 04760000
047700*---------------------------------------------------------------* 04770000
047800*    DB2 AREA FOR COMMUNICATIONS                                * 04780000
047900*---------------------------------------------------------------* 04790000
048000     EXEC SQL                                                     04800000
048100          INCLUDE SQLCA                                           04810000
048200     END-EXEC.                                                    04820000
048300                                                                  04830000
048400/                                                                 04840000
048500*---------------------------------------------------------------* 04850000
048600*     PO-SHIPMENT CURSOR DECLARE                                * 04860000
048700*---------------------------------------------------------------* 04870000
048800                                                                  04880000
048900     EXEC SQL                                                     04890000
049000          DECLARE PO-SHIPMENT CURSOR FOR                          04900000
049100             SELECT PO_NBR                                        04910000
049200                   ,REC_SEQ_NBR                                   04920000
049300                   ,EXPTED_CART_CNT                               04930000
049400                   ,ACTL_CART_CNT                                 04940000
049500                   ,DMG_CART_CNT                                  04950000
049600                   ,VEND_NAME                                     04960002
049700                   ,CRE_TMST                                      04970000
049800               FROM TSHPTPO                                       04980000
049900              WHERE SHIPT_ID = :DK-SHIPT-ID                       04990000
050000             ORDER BY PO_NBR                                      05000003
050100     END-EXEC.                                                    05010000
050200/                                                                 05020000
050300 LINKAGE SECTION.                                                 05030000
050400                                                                  05040000
050500 01  DFHCOMMAREA.                                                 05050000
050600     05  FILLER                          OCCURS 1 TO 4072 TIMES   05060000
050700                                         DEPENDING ON EIBCALEN.   05070000
050800         10  FILLER                      PIC X.                   05080000
050900                                                                  05090000
051000/                                                                 05100000
051100 PROCEDURE DIVISION.                                              05110000
051200******************************************************************05120000
051300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05130000
051400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05140000
051500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05150000
051600******************************************************************05160000
051700 0000-MAIN-MODULE.                                                05170000
051800                                                                  05180000
051900     INITIALIZE DP030-CICS-API-FIELDS.                            05190000
052000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05200000
052100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05210000
052200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05220000
052300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05230000
052400     MOVE LENGTH OF RC235AI        TO DP030-MAP-LENGTH (1).       05240000
052500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05250000
052600     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       05260000
052700                                                                  05270000
052800     PERFORM 0001-CALL-CICS-ARCH-API.                             05280000
052900     PERFORM 1000-CONTROL-PROCESSING                              05290000
053000                                                                  05300000
053100     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05310000
053200     PERFORM 0001-CALL-CICS-ARCH-API.                             05320000
053300                                                                  05330000
053400******************************************************************05340000
053500**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05350000
053600**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05360000
053700******************************************************************05370000
053800 0001-CALL-CICS-ARCH-API.                                         05380000
053910     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05391028
054000                                    DFHCOMMAREA                   05400028
054100                                    DP030-CICS-API-FIELDS         05410028
054200                                    DP020-STANDARD-COMMAREA       05420028
054300                                    RC235AI.                      05430028
054400*                                                                 05440000
054500     IF DP030-RC-CALL-SUCCESSFUL OR                               05450000
054600        DP030-RC-APPL-ERROR                                       05460000
054700         CONTINUE                                                 05470000
054800     ELSE                                                         05480000
054900         SET DP013-NO-ROLLBACK                                    05490000
055000             DP013-XCTL-DISPLAY-RESTART                           05500000
055100             DP013-CICS-ABEND      TO TRUE                        05510000
055200         MOVE 'BEFORE 0000-MAIN-MODULE'                           05520000
055300                                   TO DP013-PARAGRAPH             05530000
055320         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O05532028
055330-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05533028
055600         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05560000
055700         PERFORM DP013-0000-PROCESS-ABEND                         05570000
055800     END-IF.                                                      05580000
055900*----------------------------------------------------------------*05590000
056000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05600000
056100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05610000
056200*                                                                *05620000
056300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05630000
056400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05640000
056500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05650000
056600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05660000
056700*----------------------------------------------------------------*05670000
056800                                                                  05680000
056900 1000-CONTROL-PROCESSING.                                         05690000
057000                                                                  05700000
057100     EVALUATE TRUE                                                05710000
057200                                                                  05720000
057300         WHEN DP030-RC-APPL-ERROR                                 05730000
057400             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05740000
057500             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05750000
057600             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05760000
057700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05770000
057800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05780000
057900                                                                  05790000
058000         WHEN DP020-NEXT-ACT-INITIAL                              05800000
058100             INITIALIZE ASC-SPECIFIC-COMMAREA                     05810000
058200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05820000
058300                                      ASC-SEL-TERM-ID-OUT         05830000
058400             MOVE DP020-SRC-TASK-NUMBER                           05840000
058500                                   TO ASC-LIST-TASK-NUMBER        05850000
058600                                      ASC-SEL-TASK-NUMBER-OUT     05860000
058700             MOVE PC-LIST-QUEUE-SEQ                               05870000
058800                                   TO ASC-LIST-SEQ                05880000
058900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ-OUT             05890000
059000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05900000
059100                                                                  05910000
059200             IF  PS-COMMAREA-NOT-VALID                            05920000
059300                 CONTINUE                                         05930000
059400             ELSE                                                 05940000
059500                 PERFORM 4000-BUILD-INITIAL-PANEL                 05950000
059600             END-IF                                               05960000
059700                                                                  05970000
059800         WHEN DP020-NEXT-ACT-READ-MAP                             05980000
059900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05990000
060000                                   TO PV-TOP-ITEM                 06000000
060100             PERFORM 2000-PROCESS-PANEL                           06010000
060200                                                                  06020000
060300         WHEN DP020-NEXT-ACT-RETURN                               06030000
060400             PERFORM 2050-DELETE-LIST-QUEUE                       06040000
060500             PERFORM 4000-BUILD-INITIAL-PANEL                     06050000
060600                                                                  06060000
060700         WHEN OTHER                                               06070000
060800             SET DP013-LOGIC-ABEND TO TRUE                        06080000
060900             SET DP013-NO-ROLLBACK TO TRUE                        06090000
061000             MOVE '1000-CONTROL-PROCESSING'                       06100000
061100                                   TO DP013-PARAGRAPH             06110000
061200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06120000
061300                                   TO DP013-MESSAGE-TEXT(1)       06130000
061400             PERFORM DP013-0000-PROCESS-ABEND                     06140000
061500     END-EVALUATE.                                                06150000
061600/                                                                 06160000
061700*----------------------------------------------------------------*06170000
061800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06180000
061900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06190000
062000*----------------------------------------------------------------*06200000
062100                                                                  06210000
062200 1100-PROCESS-INTER-APPL-COMM.                                    06220000
062300                                                                  06230000
062400     SET PS-COMMAREA-VALID         TO TRUE.                       06240000
062500     MOVE SPACES                   TO ASC-START-ITEM-REQUEST.     06250000
062600                                                                  06260000
062700     EVALUATE DP020-INT-APPL-FORMAT-IND                           06270000
062800                                                                  06280000
062900         WHEN PC-INTER-APPL-YARD-LIST                             06290000
063000             IF  RC015-NUMBER-OF-SELECTED-ITEMS > +1              06300000
063100                 SET DP030-OVERRIDE-GO                            06310000
063200                     PS-COMMAREA-NOT-VALID                        06320000
063300                                   TO TRUE                        06330000
063400                 MOVE PC-TSYMSG-00047                             06340000
063500                                   TO DP020-MSG-NUMBER            06350000
063600                 SET DP020-MSG-WARNING                            06360000
063700                     DP020-NEXT-ACT-APPL-ERROR                    06370000
063800                                   TO TRUE                        06380000
063900             ELSE                                                 06390000
064000             IF  RC015-NUMBER-OF-SELECTED-ITEMS = +0              06400000
064100                 SET DP030-OVERRIDE-GO                            06410000
064200                     PS-COMMAREA-NOT-VALID                        06420000
064300                                   TO TRUE                        06430000
064400                 MOVE PC-TSYMSG-00057                             06440000
064500                                   TO DP020-MSG-NUMBER            06450000
064600                 SET DP020-MSG-WARNING                            06460000
064700                     DP020-NEXT-ACT-APPL-ERROR                    06470000
064800                                   TO TRUE                        06480000
064900             ELSE                                                 06490000
065000                 SET ASC-USE-SELECTION-QUEUE                      06500000
065100                                   TO TRUE                        06510000
065200                 MOVE RC015-NUMBER-OF-SELECTED-ITEMS              06520000
065300                                   TO ASC-NUMBER-OF-SELECTED-ITEMS06530000
065400                 MOVE RC015-NUMBER-OF-TS-ITEMS                    06540000
065500                                   TO ASC-NUMBER-OF-TS-ITEMS      06550000
065600                 MOVE RC015-SEL-QUEUE-NAME                        06560000
065700                                   TO ASC-SEL-QUEUE-NAME-IN       06570000
065800                 PERFORM 1120-PREPARE-YARD-LIST-ENTRY             06580000
065900                 PERFORM 1130-SELECT-TSHIPMT                      06590000
065910                 PERFORM 1140-GET-SHPMT-OPER                      06591021
066000             END-IF                                               06600000
066100             END-IF                                               06610000
066200                                                                  06620000
066300         WHEN OTHER                                               06630000
066400             SET PS-COMMAREA-NOT-VALID TO TRUE                    06640000
066500                                                                  06650000
066600     END-EVALUATE.                                                06660000
066700                                                                  06670000
066800/                                                                 06680000
066900*----------------------------------------------------------------*06690000
067000*  ENTRY IS FROM A YARD LIST SCREEN. GET KEYS FROM TEMP STORAGE  *06700000
067100*  QUEUE PASSED FROM THE LIST.                                   *06710000
067200*----------------------------------------------------------------*06720000
067300                                                                  06730000
067400 1120-PREPARE-YARD-LIST-ENTRY.                                    06740000
067500                                                                  06750000
067600      MOVE TR006-MAX-ITEMS         TO ASC-SEL-SUB.                06760000
067700      MOVE ZERO                    TO ASC-SEL-ITEM.               06770000
067800      PERFORM 2300-GET-YARD-NEXT-RECORD.                          06780000
067900                                                                  06790000
068000/                                                                 06800000
068100*----------------------------------------------------------------*06810000
068200*    RETREIVE SHIPMENT INFO                                      *06820000
068300*----------------------------------------------------------------*06830000
068400 1130-SELECT-TSHIPMT.                                             06840000
068500                                                                  06850000
068600     PERFORM                                                      06860000
068700         WITH TEST AFTER                                          06870000
068800         VARYING PV-RETRY-COUNTER                                 06880000
068900         FROM 1 BY 1                                              06890000
069000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06900000
069100             OR (SQLCODE = +0))                                   06910000
069200                                                                  06920000
069300         EXEC SQL                                                 06930000
069400              SELECT A.PRO_NBR                                    06940000
069500                    ,A.BOL_NBR                                    06950000
069600                    ,B.OWNER_SCAC_ID                              06960000
069700                    ,B.VEH_NBR                                    06970000
069800                    ,B.TRIP_ID                                    06980000
069900                INTO :SHIPMT-PRO-NBR                              06990000
070000                    ,:SHIPMT-BOL-NBR                              07000000
070100                    ,:VHTRIP-OWNER-SCAC-ID                        07010000
070200                    ,:VHTRIP-VEH-NBR :DN-VEH-NBR                  07020000
070300                    ,:VHTRIP-TRIP-ID                              07030000
070400                FROM TSHIPMT A                                    07040000
070500                    ,TVHTRIP B                                    07050000
070600               WHERE A.SHIPT_ID = :DK-SHIPT-ID                    07060000
070700                 AND A.TRIP_ID  = B.TRIP_ID                       07070000
070800         END-EXEC                                                 07080000
070900                                                                  07090000
071000         EVALUATE TRUE                                            07100000
071100             WHEN SQLCODE = +0                                    07110000
071200                  MOVE SHIPMT-PRO-NBR  TO ASC-KEY-PRO-NBR         07120000
071300                  MOVE SHIPMT-BOL-NBR  TO ASC-KEY-BOL-NBR         07130000
071400                  IF DN-VEH-NBR = -1                              07140000
071500                      MOVE SPACES          TO ASC-KEY-VEH-NBR     07150000
071600                  ELSE                                            07160000
071700                      MOVE VHTRIP-VEH-NBR  TO ASC-KEY-VEH-NBR     07170000
071800                  END-IF                                          07180000
071900                  MOVE VHTRIP-OWNER-SCAC-ID                       07190000
072000                                       TO ASC-KEY-OWNER-SCAC-ID   07200000
072100                  MOVE VHTRIP-TRIP-ID  TO ASC-KEY-TRIP-ID         07210000
072200                                                                  07220000
072300             WHEN SQLCODE = -904                                  07230000
072400             WHEN SQLCODE = -913                                  07240000
072500                  CONTINUE                                        07250000
072600                                                                  07260000
072700             WHEN SQLWARN0 NOT = SPACES                           07270000
072800             WHEN SQLCODE < +0                                    07280000
072900             WHEN SQLCODE > +0                                    07290000
073000                  MOVE '1130-SELECT-TSHIPMT     '                 07300000
073100                                  TO DP013-PARAGRAPH              07310000
073200                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         07320000
073300                                  TO DP013-MESSAGE-TEXT (1)       07330000
073400                  MOVE SQLCA      TO DP013-SQLCA                  07340000
073500                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     07350000
073600                  SET DP013-DB2-ABEND                             07360000
073700                      DP013-XCTL-DISPLAY-RESTART                  07370000
073800                                  TO TRUE                         07380000
073900                  PERFORM DP013-0000-PROCESS-ABEND                07390000
074000         END-EVALUATE                                             07400000
074100     END-PERFORM.                                                 07410000
074200                                                                  07420000
074300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07430000
074400         MOVE '1130-SELECT-TSHIPMT     '                          07440000
074500                                  TO DP013-PARAGRAPH              07450000
074600         MOVE 'MAX RETRIES EXCEEDED FOR SELECT ON TSHIPMT '       07460000
074700                                  TO DP013-MESSAGE-TEXT (1)       07470000
074800         MOVE SQLCA               TO DP013-SQLCA                  07480000
074900         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     07490000
075000         SET DP013-DB2-ABEND                                      07500000
075100             DP013-XCTL-DISPLAY-RESTART                           07510000
075200                                  TO TRUE                         07520000
075300         PERFORM DP013-0000-PROCESS-ABEND                         07530000
075400     END-IF.                                                      07540000
075500                                                                  07550000
075600/                                                                 07560000
075601******************************************************************07560124
075602* GET OPER THE SHIPMENT                                          *07560224
075603*   DMH 1/22/2019                                                 07560324
075605******************************************************************07560524
075610 1140-GET-SHPMT-OPER.                                             07561021
075620                                                                  07562021
075621     SET  ASC-SINGLE-OPER  TO TRUE.                               07562126
075622                                                                  07562226
075630     PERFORM                                                      07563021
075640         WITH TEST AFTER                                          07564021
075650         VARYING PV-RETRY-COUNTER                                 07565021
075660         FROM 1 BY 1                                              07566021
075670         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07567021
075680             OR (SQLCODE = +0))                                   07568021
075690                                                                  07569021
075700         EXEC SQL                                                 07570022
075710          SELECT DISTINCT                                         07571022
075720                 A.OPER_UNT_ID                                    07572022
075721               , B.E_BUS_IND                                      07572122
075722               , B.LOC_NM                                         07572222
075723           INTO  :TRIPST-OPER-UNT-ID                              07572322
075724               , :XLT00010-E-BUS-IND                              07572422
075725               , :XLT00010-LOC-NM                                 07572522
075726           FROM   TTRIPST A                                       07572622
075727                , XLT_LOC B                                       07572722
075728           WHERE  A.TRIP_ID       = :VHTRIP-TRIP-ID               07572822
075729             AND  A.OPER_UNT_ID   = B.LOC_NBR                     07572922
075730         END-EXEC                                                 07573022
075731                                                                  07573122
075732         EVALUATE TRUE                                            07573222
075733             WHEN SQLCODE = +0                                    07573322
075734                  MOVE TRIPST-OPER-UNT-ID                         07573422
075735                    TO ASC-TRIP-OPER                              07573522
075736                  MOVE XLT00010-E-BUS-IND                         07573622
075737                    TO ASC-TRIP-OPER-E-BUS-SW                     07573722
075738                  MOVE XLT00010-LOC-NM                            07573822
075739                    TO ASC-TRIP-OPER-NAME                         07573922
075741                                                                  07574122
075742             WHEN SQLCODE = +100                                  07574222
075743             WHEN SQLCODE = -305                                  07574322
075744                  MOVE  ZEROES  TO  ASC-TRIP-OPER                 07574422
075745                  MOVE  SPACES  TO  ASC-TRIP-OPER-E-BUS-SW        07574522
075746                                    ASC-TRIP-OPER-NAME            07574624
075747                                                                  07574726
075748             WHEN SQLCODE = -811                                  07574826
075749                  MOVE  ZEROES  TO  ASC-TRIP-OPER                 07574926
075750                  MOVE  SPACES  TO  ASC-TRIP-OPER-E-BUS-SW        07575026
075752                  SET  ASC-MULT-OPER TO  TRUE                     07575226
075753                  MOVE 'MULTIPLE OPER'                            07575326
075754                                TO  ASC-TRIP-OPER-NAME            07575426
075755                                                                  07575526
075756             WHEN SQLCODE = -904                                  07575626
075757             WHEN SQLCODE = -913                                  07575726
075758                  CONTINUE                                        07575826
075759                                                                  07575926
075760             WHEN SQLWARN0 NOT = SPACES                           07576026
075761             WHEN SQLCODE < +0                                    07576126
075762             WHEN SQLCODE > +0                                    07576226
075763                  MOVE '1140-GET-SHPMT-OPER     '                 07576326
075764                                  TO DP013-PARAGRAPH              07576426
075765                  MOVE 'UNSUCCESSFUL SELECT ON TSHIPMT  '         07576526
075766                                  TO DP013-MESSAGE-TEXT (1)       07576626
075767                  MOVE SQLCA      TO DP013-SQLCA                  07576726
075768                  MOVE 'TSHIPMT ' TO DP013-DB2-TABLE-NAME (1)     07576826
075769                  SET DP013-DB2-ABEND                             07576926
075770                      DP013-XCTL-DISPLAY-RESTART                  07577026
075771                                  TO TRUE                         07577126
075772                  PERFORM DP013-0000-PROCESS-ABEND                07577226
075773         END-EVALUATE                                             07577326
075774     END-PERFORM.                                                 07577426
075775                                                                  07577526
075776     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07577626
075777         MOVE '1140-GET-SHPMT-OPER     '                          07577726
075778                                  TO DP013-PARAGRAPH              07577826
075779         MOVE 'MAX RETRIES EXCEEDED FOR SELECT ON TSHIPMT '       07577926
075780                                  TO DP013-MESSAGE-TEXT (1)       07578026
075781         MOVE SQLCA               TO DP013-SQLCA                  07578126
075782         MOVE 'TSHIPMT '          TO DP013-DB2-TABLE-NAME (1)     07578226
075783         SET DP013-DB2-ABEND                                      07578326
075784             DP013-XCTL-DISPLAY-RESTART                           07578426
075785                                  TO TRUE                         07578526
075786         PERFORM DP013-0000-PROCESS-ABEND                         07578626
075787     END-IF.                                                      07578726
075788                                                                  07578826
075789/                                                                 07578926
075790*----------------------------------------------------------------*07579000
075800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07580000
075900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07590000
076000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07600000
076100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07610000
076200* FUNCTION KEYS CAN GET THIS FAR.                                *07620000
076300*----------------------------------------------------------------*07630000
076400                                                                  07640000
076500 2000-PROCESS-PANEL.                                              07650000
076600                                                                  07660000
076700     EVALUATE TRUE                                                07670000
076800         WHEN DP020-SRC-AID = DP016-CLEAR                         07680000
076900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07690000
077000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07700000
077100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07710000
077200                                                                  07720000
077300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07730000
077400             PERFORM 2050-DELETE-LIST-QUEUE                       07740000
077500             PERFORM 4000-BUILD-INITIAL-PANEL                     07750000
077600                                                                  07760000
077700         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07770000
077800             PERFORM 2140-DESELECT-ALL-ITEMS                      07780000
077900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07790000
078000                                                                  07800000
078100         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07810000
078200             PERFORM 2150-SELECT-ALL-ITEMS                        07820000
078300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07830000
078400                                                                  07840000
078500         WHEN OTHER                                               07850000
078600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07860000
078700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07870000
078800             IF  PS-NO-ERROR                                      07880000
078900                 SET DP030-CONTINUE-GO TO TRUE                    07890000
079000                 PERFORM 2100-CHECK-FUNCTION-KEY                  07900000
079100             ELSE                                                 07910000
079200                 SET DP030-OVERRIDE-GO TO TRUE                    07920000
079300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07930000
079400             END-IF                                               07940000
079500     END-EVALUATE.                                                07950000
079600/                                                                 07960000
079700*----------------------------------------------------------------*07970000
079800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07980000
079900*----------------------------------------------------------------*07990000
080000 2050-DELETE-LIST-QUEUE.                                          08000000
080100                                                                  08010000
080200     EXEC CICS                                                    08020000
080300         DELETEQ TS                                               08030000
080400             QUEUE (ASC-LIST-QUEUE-NAME)                          08040000
080500             RESP  (PV-CICS-RESP)                                 08050000
080600     END-EXEC.                                                    08060000
080700                                                                  08070000
080800     IF (PV-CICS-RESP = DFHRESP(NORMAL))                          08080000
080900     OR (PV-CICS-RESP = DFHRESP(QIDERR))                          08090000
081000         CONTINUE                                                 08100000
081100     ELSE                                                         08110000
081200         SET DP013-CICS-ABEND      TO TRUE                        08120000
081300         SET DP013-NO-ROLLBACK     TO TRUE                        08130000
081400                                                                  08140000
081500         MOVE '2050-DELETE-LIST-QUEUE'                            08150000
081600                                   TO DP013-PARAGRAPH             08160000
081700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08170000
081800                                   TO DP013-MESSAGE-TEXT (1)      08180000
081900         PERFORM DP013-0000-PROCESS-ABEND                         08190000
082000     END-IF.                                                      08200000
082100                                                                  08210000
082200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08220000
082300/                                                                 08230000
082400*----------------------------------------------------------------*08240000
082500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08250000
082600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08260000
082700* CICS ARCHITECTURE API.                                         *08270000
082800*----------------------------------------------------------------*08280000
082900                                                                  08290000
083000 2100-CHECK-FUNCTION-KEY.                                         08300000
083100                                                                  08310000
083200     EVALUATE TRUE                                                08320000
083300                                                                  08330000
083400         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  08340000
083500             INITIALIZE RC015-INTER-APPL-COMMAREA                 08350000
083600             MOVE ASC-KEY-OPER-UNT-ID TO RC015-OPER-UNT-ID        08360000
083700             MOVE ASC-KEY-FCLTY-ID    TO RC015-FCLTY-ID           08370000
083800             MOVE ASC-KEY-SHIPT-ID    TO RC015-SHIPT-ID           08380000
083900             MOVE ASC-KEY-TRIP-ID     TO RC015-TRIP-ID            08390000
084000             MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO                 08400000
084100                                    RC015-NUMBER-OF-SELECTED-ITEMS08410000
084200             PERFORM 5000-PREPARE-SEL-QUEUE                       08420000
084300                                                                  08430000
084400*IR-213 FROM HERE                                                 08440000
084500             IF  PS-ERROR                                         08450000
084600                 SET DP030-OVERRIDE-GO TO TRUE                    08460000
084700                 MOVE +1               TO ASC-BLK-SUB             08470000
084800                 PERFORM 4410-READ-TEMP-STORAGE                   08480000
084900                 ADD +1                TO ASC-BLK-SUB             08490000
085000                                          PV-BLOCK-NUMBER         08500000
085100                 PERFORM 4410-READ-TEMP-STORAGE                   08510000
085200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08520000
085300             END-IF                                               08530000
085400*IR-213 TO HERE                                                   08540000
085500                                                                  08550000
085600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08560000
085700             MOVE +1               TO PV-TOP-ITEM                 08570000
085800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08580000
085900                                                                  08590000
086000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08600000
086100             PERFORM 2110-BROWSE-BACKWARD                         08610000
086200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08620000
086300                                                                  08630000
086400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08640000
086500             PERFORM 2120-BROWSE-FORWARD                          08650000
086600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08660000
086700                                                                  08670000
086800         WHEN DP020-SRC-AID = DP016-ENTER                         08680000
086900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08690000
087000             IF  PS-ERROR                                         08700000
087100                 CONTINUE                                         08710000
087200             ELSE                                                 08720000
087300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08730000
087400             END-IF                                               08740000
087500                                                                  08750000
087600         WHEN OTHER                                               08760000
087700             SET DP013-NO-ROLLBACK                                08770000
087800                 DP013-XCTL-DISPLAY-RESTART                       08780000
087900                 DP013-CICS-ABEND  TO TRUE                        08790000
088000             MOVE '2100-CHECK-FUNCTION-KEY'                       08800000
088100                                   TO DP013-PARAGRAPH             08810000
088200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08820000
088300                                   TO DP013-MESSAGE-TEXT (1)      08830000
088400             PERFORM DP013-0000-PROCESS-ABEND                     08840000
088500     END-EVALUATE.                                                08850000
088600/                                                                 08860000
088700*----------------------------------------------------------------*08870000
088800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08880000
088900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08890000
089000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08900000
089100*    MESSAGE.                                                    *08910000
089200*----------------------------------------------------------------*08920000
089300                                                                  08930000
089400 2110-BROWSE-BACKWARD.                                            08940000
089500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08950000
089600         GIVING PV-TOP-ITEM.                                      08960000
089700                                                                  08970000
089800     IF  ((PV-TOP-ITEM < +1)                                      08980000
089900       OR (PV-TOP-ITEM = +1))                                     08990000
090000         MOVE +1                   TO PV-TOP-ITEM                 09000000
090100*        -- TOP OF LIST --                                        09010000
090200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09020000
090300         SET DP020-MSG-INFORMATIONAL TO TRUE                      09030000
090400     END-IF.                                                      09040000
090500                                                                  09050000
090600                                                                  09060000
090700*----------------------------------------------------------------*09070000
090800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09080000
090900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09090000
091000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09100000
091100*----------------------------------------------------------------*09110000
091200                                                                  09120000
091300 2120-BROWSE-FORWARD.                                             09130000
091400                                                                  09140000
091500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09150000
091600         GIVING PV-TOP-ITEM.                                      09160000
091700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09170000
091800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09180000
091900                                   TO PV-TOP-ITEM                 09190000
092000*        -- BOTTOM OF LIST --                                     09200000
092100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09210000
092200         SET DP020-MSG-INFORMATIONAL                              09220000
092300                                   TO TRUE                        09230000
092400     ELSE                                                         09240000
092500         COMPUTE PV-BOTTOM-ITEM =                                 09250000
092600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09260000
092700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09270000
092800*            -- BOTTOM OF LIST --                                 09280000
092900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09290000
093000             SET DP020-MSG-INFORMATIONAL                          09300000
093100                                   TO TRUE                        09310000
093200         END-IF                                                   09320000
093300     END-IF.                                                      09330000
093400/                                                                 09340000
093500*----------------------------------------------------------------*09350000
093600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09360000
093700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09370000
093800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09380000
093900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09390000
094000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09400000
094100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09410000
094200*----------------------------------------------------------------*09420000
094300                                                                  09430000
094400 2130-CHECK-FOR-JUMP-BROWSE.                                      09440000
094500                                                                  09450000
094600     SET PS-NO-ERROR               TO TRUE.                       09460000
094700                                                                  09470000
094800     IF (ASC-START-ITEM-REQUEST = SPACE)                          09480000
094900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09490000
095000                                   TO PV-TOP-ITEM                 09500000
095100     ELSE                                                         09510000
095200         MOVE ASC-START-ITEM-REQUEST                              09520000
095300                                   TO DP010I-UNEDITED-FIELD       09530000
095400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       09540000
095500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09550000
095600         SET DP010I-NEGATIVE-NOT-ALLOWED                          09560000
095700                                   TO TRUE                        09570000
095800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09580028
095810              USING DP010I-NUMERIC-EDIT-AREA                      09581028
095900                                                                  09590000
096000         IF  NOT DP010I-ERROR-DETECTED                            09600000
096100             MOVE DP010I-NUMERIC-FIELD                            09610000
096200                                   TO  ASC-START-ITEM-REQUEST-N   09620000
096300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09630000
096400                 IF  ASC-START-ITEM-REQUEST-N >                   09640000
096500                                          ASC-NUMBER-OF-ITEMS-READ09650000
096600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09660000
096700                     COMPUTE PV-TOP-ITEM =                        09670000
096800                             ASC-NUMBER-OF-ITEMS-READ             09680000
096900                             - PC-ITEMS-PER-PANEL + 1             09690000
097000                     IF  PV-TOP-ITEM < +1                         09700000
097100                         MOVE +1   TO PV-TOP-ITEM                 09710000
097200                         MOVE PC-TSYMSG-00070                     09720000
097300                                   TO DP020-MSG-NUMBER            09730000
097400                         SET DP020-MSG-INFORMATIONAL              09740000
097500                                   TO TRUE                        09750000
097600                     END-IF                                       09760000
097700                 ELSE                                             09770000
097800                     MOVE ASC-START-ITEM-REQUEST-N                09780000
097900                                   TO PV-TOP-ITEM                 09790000
098000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09800000
098100                     COMPUTE PV-BOTTOM-ITEM =                     09810000
098200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09820000
098300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09830000
098400*                        -- BOTTOM OF LIST --                     09840000
098500                         MOVE PC-TSYMSG-00070                     09850000
098600                                   TO DP020-MSG-NUMBER            09860000
098700                         SET DP020-MSG-INFORMATIONAL              09870000
098800                                   TO TRUE                        09880000
098900                     END-IF                                       09890000
099000                 END-IF                                           09900000
099100             ELSE                                                 09910000
099200*                --- VALUE OUT OF RANGE ----                      09920000
099300                 MOVE PC-TSYMSG-00101                             09930000
099400                                   TO DP020-MSG-NUMBER            09940000
099500                 MOVE -1           TO ASTRTITL                    09950000
099600                 SET DP030-SET-CURSOR-APPL-1                      09960000
099700                                   TO TRUE                        09970000
099800                 MOVE DP015-REVERSE                               09980000
099900                                   TO ASTRTITH                    09990000
100000                 MOVE DP015-RED    TO ASTRTITC                    10000000
100100                 MOVE DP015-UNP-NUM-BRT-MDT                       10010000
100200                                   TO ASTRTITA                    10020000
100300                 SET DP020-MSG-FATAL                              10030000
100400                                   TO TRUE                        10040000
100500                 SET PS-ERROR      TO TRUE                        10050000
100600             END-IF                                               10060000
100700                                                                  10070000
100800         ELSE                                                     10080000
100900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            10090000
101000             MOVE -1               TO ASTRTITL                    10100000
101100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  10110000
101200             MOVE DP015-REVERSE    TO ASTRTITH                    10120000
101300             MOVE DP015-RED        TO ASTRTITC                    10130000
101400             MOVE DP015-UNP-NUM-BRT-MDT                           10140000
101500                                   TO ASTRTITA                    10150000
101600             SET DP020-MSG-FATAL   TO TRUE                        10160000
101700             SET PS-ERROR          TO TRUE                        10170000
101800         END-IF                                                   10180000
101900     END-IF.                                                      10190000
102000/                                                                 10200000
102100*----------------------------------------------------------------*10210000
102200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10220000
102300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10230000
102400*----------------------------------------------------------------*10240000
102500 2140-DESELECT-ALL-ITEMS.                                         10250000
102600                                                                  10260000
102700     MOVE +1                       TO ASC-BLK-SUB.                10270000
102800                                                                  10280000
102900     PERFORM 2141-CLEAR-SELECTED-INDS                             10290000
103000         VARYING ASC-ITEM-SUB                                     10300000
103100         FROM 1 BY 1                                              10310000
103200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10320000
103300                                                                  10330000
103400     ADD +1                        TO ASC-BLK-SUB.                10340000
103500                                                                  10350000
103600     PERFORM 2141-CLEAR-SELECTED-INDS                             10360000
103700         VARYING ASC-ITEM-SUB                                     10370000
103800         FROM 1 BY 1                                              10380000
103900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10390000
104000                                                                  10400000
104100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10410000
104200                                   TO PV-LIST-ITEM-NUMBER.        10420000
104300                                                                  10430000
104400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10440000
104500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10450000
104600                                                                  10460000
104700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10470000
104800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10480000
104900         MOVE +1                   TO ASC-BLK-SUB                 10490000
105000                                                                  10500000
105100         PERFORM 5100-WRITE-TEMP-STORAGE                          10510000
105200                                                                  10520000
105300         MOVE +1                   TO PV-BLOCK-NUMBER             10530000
105400                                                                  10540000
105500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10550000
105600             PV-FIRST-BLOCK-IN-ARRAY - 1                          10560000
105700                                                                  10570000
105800         PERFORM                                                  10580000
105900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10590000
106000                                                                  10600000
106100             PERFORM 4410-READ-TEMP-STORAGE                       10610000
106200                                                                  10620000
106300             PERFORM 2141-CLEAR-SELECTED-INDS                     10630000
106400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10640000
106500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10650000
106600                                                                  10660000
106700             PERFORM 5100-WRITE-TEMP-STORAGE                      10670000
106800                                                                  10680000
106900             ADD +1                TO PV-BLOCK-NUMBER             10690000
107000                                                                  10700000
107100         END-PERFORM                                              10710000
107200                                                                  10720000
107300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10730000
107400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10740000
107500                                                                  10750000
107600         PERFORM                                                  10760000
107700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10770000
107800                   ASC-HIGHEST-BLOCK-WRITTEN                      10780000
107900                                                                  10790000
108000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10800000
108100                                   TO PV-BLOCK-NUMBER             10810000
108200                                                                  10820000
108300             PERFORM 4410-READ-TEMP-STORAGE                       10830000
108400                                                                  10840000
108500             PERFORM 2141-CLEAR-SELECTED-INDS                     10850000
108600                 VARYING ASC-ITEM-SUB                             10860000
108700                 FROM 1 BY 1                                      10870000
108800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10880000
108900                                                                  10890000
109000             PERFORM 5100-WRITE-TEMP-STORAGE                      10900000
109100                                                                  10910000
109200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10920000
109300                                                                  10930000
109400         END-PERFORM                                              10940000
109500                                                                  10950000
109600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10960000
109700                                   TO PV-BLOCK-NUMBER             10970000
109800                                                                  10980000
109900         PERFORM 4410-READ-TEMP-STORAGE                           10990000
110000     END-IF.                                                      11000000
110100                                                                  11010000
110200                                                                  11020000
110300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 11030000
110400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.11040000
110500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  11050000
110600                                                                  11060000
110700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11070000
110800                                                                  11080000
110900                                                                  11090000
111000*----------------------------------------------------------------*11100000
111100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11110000
111200*----------------------------------------------------------------*11120000
111300                                                                  11130000
111400 2141-CLEAR-SELECTED-INDS.                                        11140000
111500                                                                  11150000
111600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11160000
111700             NOT EQUAL ZERO                                       11170000
111800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11180000
111900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11190000
112000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11200000
112100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11210000
112200                                   TO TRUE                        11220000
112300         END-IF                                                   11230000
112400     END-IF.                                                      11240000
112500/                                                                 11250000
112600*----------------------------------------------------------------*11260000
112700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11270000
112800*  FOR ALL ITEMS.                                                *11280000
112900*----------------------------------------------------------------*11290000
113000                                                                  11300000
113100 2150-SELECT-ALL-ITEMS.                                           11310000
113200                                                                  11320000
113300     MOVE +1                       TO ASC-BLK-SUB.                11330000
113400                                                                  11340000
113500     PERFORM 2151-SET-SELECTED-INDS                               11350000
113600         VARYING ASC-ITEM-SUB                                     11360000
113700         FROM 1 BY 1                                              11370000
113800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11380000
113900                                                                  11390000
114000     ADD +1                        TO ASC-BLK-SUB.                11400000
114100                                                                  11410000
114200     PERFORM 2151-SET-SELECTED-INDS                               11420000
114300         VARYING ASC-ITEM-SUB                                     11430000
114400         FROM 1 BY 1                                              11440000
114500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11450000
114600                                                                  11460000
114700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11470000
114800                                   TO PV-LIST-ITEM-NUMBER.        11480000
114900                                                                  11490000
115000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11500000
115100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11510000
115200                                                                  11520000
115300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11530000
115400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11540000
115500         MOVE +1                   TO ASC-BLK-SUB                 11550000
115600                                                                  11560000
115700         PERFORM 5100-WRITE-TEMP-STORAGE                          11570000
115800                                                                  11580000
115900         MOVE +1                   TO PV-BLOCK-NUMBER             11590000
116000                                                                  11600000
116100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11610000
116200             PV-FIRST-BLOCK-IN-ARRAY - 1                          11620000
116300                                                                  11630000
116400         PERFORM                                                  11640000
116500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11650000
116600                                                                  11660000
116700             PERFORM 4410-READ-TEMP-STORAGE                       11670000
116800                                                                  11680000
116900             PERFORM 2151-SET-SELECTED-INDS                       11690000
117000                 VARYING ASC-ITEM-SUB                             11700000
117100                 FROM 1 BY 1                                      11710000
117200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11720000
117300                                                                  11730000
117400             PERFORM 5100-WRITE-TEMP-STORAGE                      11740000
117500                                                                  11750000
117600             ADD +1                TO PV-BLOCK-NUMBER             11760000
117700                                                                  11770000
117800         END-PERFORM                                              11780000
117900                                                                  11790000
118000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11800000
118100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11810000
118200                                                                  11820000
118300         PERFORM                                                  11830000
118400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11840000
118500                   ASC-HIGHEST-BLOCK-WRITTEN                      11850000
118600                                                                  11860000
118700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11870000
118800                                   TO PV-BLOCK-NUMBER             11880000
118900                                                                  11890000
119000             PERFORM 4410-READ-TEMP-STORAGE                       11900000
119100                                                                  11910000
119200             PERFORM 2151-SET-SELECTED-INDS                       11920000
119300                 VARYING ASC-ITEM-SUB                             11930000
119400                 FROM 1 BY 1                                      11940000
119500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11950000
119600                                                                  11960000
119700             PERFORM 5100-WRITE-TEMP-STORAGE                      11970000
119800                                                                  11980000
119900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11990000
120000                                                                  12000000
120100         END-PERFORM                                              12010000
120200                                                                  12020000
120300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12030000
120400                                   TO PV-BLOCK-NUMBER             12040000
120500                                                                  12050000
120600         PERFORM 4410-READ-TEMP-STORAGE                           12060000
120700     END-IF.                                                      12070000
120800                                                                  12080000
120900                                                                  12090000
121000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12100000
121100                       ASC-NUMBER-OF-SELECTED-ITEMS.              12110000
121200                                                                  12120000
121300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12130000
121400                                                                  12140000
121500                                                                  12150000
121600*----------------------------------------------------------------*12160000
121700*    MARK EACH ITEM AS BEING SELECTED.                           *12170000
121800*----------------------------------------------------------------*12180000
121900                                                                  12190000
122000 2151-SET-SELECTED-INDS.                                          12200000
122100                                                                  12210000
122200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12220000
122300             NOT EQUAL ZERO                                       12230000
122400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12240000
122500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12250000
122600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12260000
122700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12270000
122800                               TO  TRUE                           12280000
122900         END-IF                                                   12290000
123000     END-IF.                                                      12300000
123100/                                                                 12310000
123200******************************************************************12320000
123300** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12330000
123400** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12340000
123500******************************************************************12350000
123600 2200-MOVE-SCREEN-TO-COMMAREA.                                    12360000
123700                                                                  12370000
123800     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12380000
123900     MOVE +1                       TO PV-SUB.                     12390000
124000                                                                  12400000
124100     PERFORM 3100-SET-SUBSCRIPTS.                                 12410000
124200                                                                  12420000
124300     IF  ASTRTITL > ZERO                                          12430000
124400         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12440000
124500     ELSE                                                         12450000
124600         IF  ASTRTITF = DP015-ERASE-EOF                           12460000
124700             INITIALIZE ASC-START-ITEM-REQUEST                    12470000
124800         END-IF                                                   12480000
124900     END-IF.                                                      12490000
125000                                                                  12500000
125100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12510000
125200         VARYING PV-SUB                                           12520000
125300         FROM 1 BY 1                                              12530000
125400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12540000
125500                                                                  12550000
125600                                                                  12560000
125700******************************************************************12570000
125800** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12580000
125900******************************************************************12590000
126000 2210-MOVE-LINES-TO-COMMAREA.                                     12600000
126100                                                                  12610000
126200     IF  MR-SELECTL (PV-SUB) > ZERO                               12620000
126300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12630000
126400         MOVE MR-SELECT (PV-SUB) TO ASC-TEMP-SELECTED-SW          12640000
126500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12650000
126600     ELSE                                                         12660000
126700         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12670000
126800                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12680000
126900                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12690000
127000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12700000
127100         END-IF                                                   12710000
127200     END-IF.                                                      12720000
127300                                                                  12730000
127400     ADD +1                        TO ASC-ITEM-SUB.               12740000
127500                                                                  12750000
127600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12760000
127700         ADD +1                    TO ASC-BLK-SUB                 12770000
127800         MOVE +1                   TO ASC-ITEM-SUB                12780000
127900     END-IF.                                                      12790000
128000/                                                                 12800000
128100/                                                                 12810000
128200******************************************************************12820000
128300* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *12830000
128400* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *12840000
128500******************************************************************12850000
128600 2300-GET-YARD-NEXT-RECORD.                                       12860000
128700                                                                  12870000
128800     ADD +1                        TO ASC-SEL-SUB.                12880000
128900     IF ASC-SEL-SUB > TR006-MAX-ITEMS                             12890000
129000         ADD +1                    TO ASC-SEL-ITEM                12900000
129100         MOVE +1                   TO ASC-SEL-SUB                 12910000
129200     END-IF.                                                      12920000
129300                                                                  12930000
129400     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 12940000
129500         PERFORM 9100-READ-SEL-QUEUE                              12950000
129600         IF TR006-ITEM (ASC-SEL-SUB) > ZERO                       12960000
129700             MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                 12970000
129800                                   TO ASC-KEY-OPER-UNT-ID         12980000
129900                                      DK-OPER-UNT-ID              12990000
130000             MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                    13000005
130100                                   TO ASC-KEY-FCLTY-ID            13010000
130200             MOVE TR006-CALL-IN-DATE (ASC-SEL-SUB)                13020000
130300                                   TO ASC-KEY-ARRIVAL-DTE         13030000
130400             MOVE TR006-SHIPT-ID (ASC-SEL-SUB)                    13040000
130500                                   TO ASC-KEY-SHIPT-ID            13050000
130600                                      DK-SHIPT-ID                 13060000
130700             SET TR006-INQ (ASC-SEL-SUB)                          13070000
130800                                   TO TRUE                        13080000
130900             PERFORM 9200-REWRITE-LIST-QUEUE                      13090000
131000         ELSE                                                     13100000
131100             SUBTRACT +1 FROM ASC-SEL-SUB                         13110000
131200*            --- BOTTOM OF LIST ---                               13120000
131300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13130000
131400             SET DP020-MSG-INFORMATIONAL                          13140000
131500                                   TO TRUE                        13150000
131600         END-IF                                                   13160000
131700     ELSE                                                         13170000
131800         SUBTRACT +1 FROM ASC-SEL-ITEM                            13180000
131900         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 13190000
132000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13200000
132100         SET DP020-MSG-INFORMATIONAL                              13210000
132200                                   TO TRUE                        13220000
132300     END-IF.                                                      13230000
132400                                                                  13240000
132500/                                                                 13250000
132600******************************************************************13260000
132700* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *13270000
132800* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *13280000
132900******************************************************************13290000
133000 2310-GET-YARD-PREV-RECORD.                                       13300000
133100                                                                  13310000
133200     SUBTRACT +1 FROM ASC-SEL-SUB.                                13320000
133300     IF ASC-SEL-SUB < +1                                          13330000
133400         SUBTRACT +1 FROM ASC-SEL-ITEM                            13340000
133500         MOVE TR006-MAX-ITEMS      TO ASC-SEL-SUB                 13350000
133600     END-IF.                                                      13360000
133700                                                                  13370000
133800     IF ASC-SEL-ITEM > ZERO                                       13380000
133900         PERFORM 9100-READ-SEL-QUEUE                              13390000
134000         MOVE TR006-OPER-UNT-ID (ASC-SEL-SUB)                     13400000
134100                                   TO ASC-KEY-OPER-UNT-ID         13410000
134200                                      DK-OPER-UNT-ID              13420000
134300         MOVE TR006-FCLTY-ID (ASC-SEL-SUB)                        13430000
134400                                   TO ASC-KEY-FCLTY-ID            13440000
134500         MOVE TR006-CALL-IN-DATE (ASC-SEL-SUB)                    13450000
134600                                   TO ASC-KEY-ARRIVAL-DTE         13460000
134700         MOVE TR006-SHIPT-ID (ASC-SEL-SUB)                        13470000
134800                                   TO ASC-KEY-SHIPT-ID            13480000
134900                                      DK-SHIPT-ID                 13490000
135000     ELSE                                                         13500000
135100         MOVE +1                   TO ASC-SEL-ITEM                13510000
135200                                      ASC-SEL-SUB                 13520000
135300*        --- TOP OF LIST ---                                      13530000
135400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13540000
135500         SET DP020-MSG-INFORMATIONAL                              13550000
135600                                   TO TRUE                        13560000
135700     END-IF.                                                      13570000
135800                                                                  13580000
135900/                                                                 13590000
136000******************************************************************13600000
136100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **13610000
136200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **13620000
136300******************************************************************13630000
136400                                                                  13640000
136500 3000-EDIT-DATA-IN-COMMAREA.                                      13650000
136600                                                                  13660000
136700     SET PS-NO-ERROR               TO TRUE.                       13670000
136800     PERFORM 3200-RESET-ATTRIBUTES.                               13680000
136900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     13690000
137000**                                                                13700000
137100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              13710000
137200* EDITTING IS DONE FROM THE BOTTOM UP.                            13720000
137300**                                                                13730000
137400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       13740000
137500         ASC-ITEMS-DISPLAYED - 1.                                 13750000
137600                                                                  13760000
137700     PERFORM 3100-SET-SUBSCRIPTS.                                 13770000
137800     PERFORM 3300-EDIT-SELECTIONS                                 13780000
137900         VARYING PV-SUB                                           13790000
138000         FROM PV-SUB BY -1                                        13800000
138100         UNTIL PV-SUB < +1                                        13810000
138200                                                                  13820000
138300     IF  PS-NO-ERROR                                              13830000
138400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13840000
138500     END-IF.                                                      13850000
138600                                                                  13860000
138700     IF ((PS-NO-ERROR)                                            13870000
138800     AND (ASC-START-OF-SELECTED-RANGE > ZERO)                     13880000
138900     AND (ASC-END-OF-SELECTED-RANGE > ZERO))                      13890000
139000         PERFORM 3500-MARK-RANGE-AS-SELECTED                      13900000
139100     END-IF.                                                      13910000
139200                                                                  13920000
139300/                                                                 13930000
139400*----------------------------------------------------------------*13940000
139500*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13950000
139600*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13960000
139700*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13970000
139800*                                                                *13980000
139900*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13990000
140000*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *14000000
140100*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *14010000
140200*    US IN THE 2ND BLOCK OF THE ARRAY.                           *14020000
140300*----------------------------------------------------------------*14030000
140400                                                                  14040000
140500 3100-SET-SUBSCRIPTS.                                             14050000
140600                                                                  14060000
140700     COMPUTE ASC-ITEM-SUB =                                       14070000
140800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        14080000
140900                                                                  14090000
141000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         14100000
141100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14110000
141200                                                                  14120000
141300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               14130000
141400     ELSE                                                         14140000
141500         MOVE +1                     TO ASC-BLK-SUB               14150000
141600     END-IF.                                                      14160000
141700                                                                  14170000
141800                                                                  14180000
141900******************************************************************14190000
142000** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **14200000
142100******************************************************************14210000
142200                                                                  14220000
142300 3200-RESET-ATTRIBUTES.                                           14230000
142400                                                                  14240000
142500     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   14250000
142600     MOVE DP015-GREEN              TO ASTRTITC.                   14260000
142700     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14270000
142800                                                                  14280000
142900*    IF DP020-NEXT-ACT-RETURN                                     14290000
143000*    OR DP020-NEXT-ACT-READ-MAP                                   14300000
143100*       PERFORM                                                   14310000
143200*           VARYING PV-SUB                                        14320000
143300*           FROM 1 BY 1                                           14330000
143400*           UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    14340000
143500*           MOVE DP015-UNP-ALP-NOR-OFF                            14350000
143600*                                     TO MR-SELECTA (PV-SUB)      14360000
143700*           MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      14370000
143800*           MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      14380000
143900*       END-PERFORM                                               14390000
144000*    ELSE                                                         14400000
144100        PERFORM                                                   14410000
144200            VARYING PV-SUB                                        14420000
144300            FROM 1 BY 1                                           14430000
144400            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     14440000
144500            MOVE DP015-UNP-ALP-NOR-OFF                            14450000
144600                                      TO MR-SELECTA (PV-SUB)      14460000
144700            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      14470000
144800            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      14480000
144900        END-PERFORM.                                              14490000
145000*    END-IF.                                                      14500000
145100                                                                  14510000
145200/                                                                 14520000
145300******************************************************************14530000
145400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14540000
145500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14550000
145600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14560000
145700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14570000
145800******************************************************************14580000
145900 3300-EDIT-SELECTIONS.                                            14590000
146000                                                                  14600000
146100     EVALUATE TRUE                                                14610000
146200                                                                  14620000
146300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14630000
146400             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14640000
146500                 CONTINUE                                         14650000
146600                                                                  14660000
146700         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14670000
146800             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14680000
146900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14690000
147000                 MOVE ASC-TEMP-SELECTED-SW                        14700000
147100                      (ASC-BLK-SUB ASC-ITEM-SUB) TO               14710000
147200                          ASC-SELECTED-SW                         14720000
147300                          (ASC-BLK-SUB ASC-ITEM-SUB)              14730000
147400             END-IF                                               14740000
147500                                                                  14750000
147600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14760000
147700                 = SPACE                                          14770000
147800             EVALUATE TRUE                                        14780000
147900                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14790000
148000                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14800000
148100                     MOVE SPACE TO ASC-SELECTED-SW                14810000
148200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14820000
148300                                   ASC-ERROR-SW                   14830000
148400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14840000
148500                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14850000
148600                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14860000
148700                     MOVE SPACE TO ASC-SELECTED-SW                14870000
148800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14880000
148900                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14890000
149000                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14900000
149100                     MOVE SPACE TO ASC-SELECTED-SW                14910000
149200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14920000
149300             END-EVALUATE                                         14930000
149400                                                                  14940000
149500         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14950000
149600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14960000
149700                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14970000
149800             END-IF                                               14980000
149900             PERFORM 3310-EDIT-RANGE                              14990000
150000                                                                  15000000
150100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             15010000
150200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15020000
150300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    15030000
150400             END-IF                                               15040000
150500             PERFORM 3310-EDIT-RANGE                              15050000
150600                                                                  15060000
150700         WHEN OTHER                                               15070000
150800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           15080000
150900             SET DP020-MSG-FATAL    TO TRUE                       15090000
151000             MOVE -1                TO MR-SELECTL (PV-SUB)        15100000
151100             SET DP030-SET-CURSOR-APPL-1                          15110000
151200                                    TO TRUE                       15120000
151300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        15130000
151400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        15140000
151500             SET PS-ERROR TO TRUE                                 15150000
151600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            15160000
151700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     15170000
151800                 MOVE SPACE         TO ASC-SELECTED-SW            15180000
151900                                        (ASC-BLK-SUB ASC-ITEM-SUB)15190000
152000             END-IF                                               15200000
152100     END-EVALUATE.                                                15210000
152200                                                                  15220000
152300     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             15230000
152400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15240000
152500                                                                  15250000
152600     IF ASC-ITEM-SUB < 1                                          15260000
152700         SUBTRACT +1 FROM ASC-BLK-SUB                             15270000
152800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15280000
152900     END-IF.                                                      15290000
153000                                                                  15300000
153100/                                                                 15310000
153200******************************************************************15320000
153300** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **15330000
153400** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **15340000
153500** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**15350000
153600** THE ENDING.                                                  **15360000
153700******************************************************************15370000
153800 3310-EDIT-RANGE.                                                 15380000
153900                                                                  15390000
154000     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                15400000
154100         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   15410000
154200             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)15420000
154300                                   TO ASC-SELECTED-SW             15430000
154400                                        (ASC-BLK-SUB ASC-ITEM-SUB)15440000
154500             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 15450000
154600         ELSE                                                     15460000
154700             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     15470000
154800                 CONTINUE                                         15480000
154900             ELSE                                                 15490000
155000*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        15500000
155100                 MOVE PC-TSYMSG-00054                             15510000
155200                                   TO DP020-MSG-NUMBER            15520000
155300                 SET DP020-MSG-FATAL                              15530000
155400                                   TO TRUE                        15540000
155500                 MOVE -1           TO MR-SELECTL (PV-SUB)         15550000
155600                 SET DP030-SET-CURSOR-APPL-1                      15560000
155700                                   TO TRUE                        15570000
155800                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15580000
155900                 MOVE DP015-UNDERLINE                             15590000
156000                                   TO MR-SELECTH (PV-SUB)         15600000
156100                 SET PS-ERROR      TO TRUE                        15610000
156200             END-IF                                               15620000
156300         END-IF                                                   15630000
156400     ELSE                                                         15640000
156500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15650000
156600             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15660000
156700                                   TO ASC-SELECTED-SW             15670000
156800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15680000
156900             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15690000
157000         ELSE                                                     15700000
157100             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15710000
157200                 CONTINUE                                         15720000
157300             ELSE                                                 15730000
157400*                -- ONLY ONE END-OF-RANGE ALLOWED --              15740000
157500                 MOVE PC-TSYMSG-00055                             15750000
157600                                   TO DP020-MSG-NUMBER            15760000
157700                 SET DP020-MSG-FATAL                              15770000
157800                                   TO TRUE                        15780000
157900                 MOVE -1           TO MR-SELECTL (PV-SUB)         15790000
158000                 SET DP030-SET-CURSOR-APPL-1                      15800000
158100                                   TO TRUE                        15810000
158200                 SET PS-ERROR      TO TRUE                        15820000
158300             END-IF                                               15830000
158400         END-IF                                                   15840000
158500     END-IF.                                                      15850000
158600/                                                                 15860000
158700******************************************************************15870000
158800** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15880000
158900** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15890000
159000******************************************************************15900000
159100 3400-CHECK-RANGE-SEQUENCE.                                       15910000
159200                                                                  15920000
159300     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15930000
159400       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15940000
159500       AND  ASC-START-OF-SELECTED-RANGE >                         15950000
159600                                         ASC-END-OF-SELECTED-RANGE15960000
159700*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15970000
159800         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15980000
159900         SET DP020-MSG-FATAL TO TRUE                              15990000
160000         SET PS-ERROR TO TRUE                                     16000000
160100         PERFORM 3410-POSITION-AT-ERROR                           16010000
160200     END-IF.                                                      16020000
160300                                                                  16030000
160400                                                                  16040000
160500******************************************************************16050000
160600** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **16060000
160700** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **16070000
160800** SHOULD BE POSITIONED ON A RANGE ERROR.                       **16080000
160900******************************************************************16090000
161000 3410-POSITION-AT-ERROR.                                          16100000
161100                                                                  16110000
161200     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       16120000
161300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 16130000
161400                    - PV-TOP-ITEM + 1.                            16140000
161500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16150000
161600         CONTINUE                                                 16160000
161700     ELSE                                                         16170000
161800         MOVE -1                   TO MR-SELECTL (PV-SUB)         16180000
161900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16190000
162000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16200000
162100     END-IF.                                                      16210000
162200                                                                  16220000
162300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   16230000
162400                    - PV-TOP-ITEM + 1.                            16240000
162500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      16250000
162600         CONTINUE                                                 16260000
162700     ELSE                                                         16270000
162800         MOVE -1                   TO MR-SELECTL (PV-SUB)         16280000
162900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         16290000
163000         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         16300000
163100     END-IF.                                                      16310000
163200/                                                                 16320000
163300*----------------------------------------------------------------*16330000
163400*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *16340000
163500*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *16350000
163600*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *16360000
163700*----------------------------------------------------------------*16370000
163800 3500-MARK-RANGE-AS-SELECTED.                                     16380000
163900                                                                  16390000
164000     MOVE +1                       TO  ASC-BLK-SUB.               16400000
164100     PERFORM 3510-MARK-SELECTED-INDS                              16410000
164200         VARYING ASC-ITEM-SUB                                     16420000
164300         FROM 1 BY 1                                              16430000
164400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16440000
164500                                                                  16450000
164600     ADD +1                        TO ASC-BLK-SUB.                16460000
164700     PERFORM 3510-MARK-SELECTED-INDS                              16470000
164800         VARYING ASC-ITEM-SUB                                     16480000
164900         FROM 1 BY 1                                              16490000
165000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 16500000
165100                                                                  16510000
165200     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               16520000
165300                                   TO  PV-LIST-ITEM-NUMBER.       16530000
165400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            16540000
165500         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         16550000
165600               PC-ITEMS-PER-PANEL).                               16560000
165700                                                                  16570000
165800     MOVE ASC-START-OF-SELECTED-RANGE                             16580000
165900                                   TO PV-START-OF-SELECTED-RANGE. 16590000
166000     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16600000
166100         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16610000
166200               PC-ITEMS-PER-PANEL).                               16620000
166300                                                                  16630000
166400     MOVE ASC-END-OF-SELECTED-RANGE                               16640000
166500                                   TO  PV-END-OF-SELECTED-RANGE.  16650000
166600     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16660000
166700         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16670000
166800               PC-ITEMS-PER-PANEL).                               16680000
166900     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16690000
167000         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16700000
167100                                                                  16710000
167200     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16720000
167300        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16730000
167400         MOVE +1                   TO ASC-BLK-SUB                 16740000
167500         PERFORM 5100-WRITE-TEMP-STORAGE                          16750000
167600         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16760000
167700             PV-FIRST-BLOCK-IN-ARRAY - 1                          16770000
167800                                                                  16780000
167900         PERFORM                                                  16790000
168000             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16800000
168100                   PV-PREV-BLOCK-IN-ARRAY                         16810000
168200             MOVE PV-FIRST-BLOCK-IN-RANGE                         16820000
168300                                   TO PV-BLOCK-NUMBER             16830000
168400             PERFORM 4410-READ-TEMP-STORAGE                       16840000
168500             PERFORM 3510-MARK-SELECTED-INDS                      16850000
168600                 VARYING ASC-ITEM-SUB                             16860000
168700                 FROM 1 BY 1                                      16870000
168800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16880000
168900             PERFORM 5100-WRITE-TEMP-STORAGE                      16890000
169000             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16900000
169100         END-PERFORM                                              16910000
169200                                                                  16920000
169300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16930000
169400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16940000
169500         PERFORM                                                  16950000
169600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16960000
169700                   PV-LAST-BLOCK-IN-RANGE                         16970000
169800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16980000
169900                                   TO PV-BLOCK-NUMBER             16990000
170000             PERFORM 4410-READ-TEMP-STORAGE                       17000000
170100             PERFORM 3510-MARK-SELECTED-INDS                      17010000
170200                 VARYING ASC-ITEM-SUB                             17020000
170300                 FROM 1 BY 1                                      17030000
170400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          17040000
170500             PERFORM 5100-WRITE-TEMP-STORAGE                      17050000
170600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      17060000
170700         END-PERFORM                                              17070000
170800                                                                  17080000
170900         MOVE PV-FIRST-BLOCK-IN-ARRAY                             17090000
171000                                   TO PV-BLOCK-NUMBER             17100000
171100         PERFORM 4410-READ-TEMP-STORAGE                           17110000
171200     END-IF.                                                      17120000
171300                                                                  17130000
171400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 17140000
171500                                      ASC-END-OF-SELECTED-RANGE.  17150000
171600/                                                                 17160000
171700*----------------------------------------------------------------*17170000
171800* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *17180000
171900*----------------------------------------------------------------*17190000
172000                                                                  17200000
172100 3510-MARK-SELECTED-INDS.                                         17210000
172200                                                                  17220000
172300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17230000
172400                                ASC-ITEM-SUB) >                   17240000
172500         ASC-START-OF-SELECTED-RANGE)                             17250000
172600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         17260000
172700                                ASC-ITEM-SUB) =                   17270000
172800         ASC-START-OF-SELECTED-RANGE)                             17280000
172900                                                                  17290000
173000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17300000
173100                                    ASC-ITEM-SUB) <               17310000
173200             ASC-END-OF-SELECTED-RANGE)                           17320000
173300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     17330000
173400                                    ASC-ITEM-SUB) =               17340000
173500             ASC-END-OF-SELECTED-RANGE)                           17350000
173600                                                                  17360000
173700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          17370000
173800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   17380000
173900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   17390000
174000                               TO TRUE                            17400000
174100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              17410000
174200                               TO TRUE                            17420000
174300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    17430000
174400             END-IF                                               17440000
174500         END-IF                                                   17450000
174600     END-IF.                                                      17460000
174700/                                                                 17470000
174800*----------------------------------------------------------------*17480000
174900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *17490000
175000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *17500000
175100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *17510000
175200*    DISPLAY THE PANEL TO USER.                                  *17520000
175300*----------------------------------------------------------------*17530000
175400                                                                  17540000
175500 4000-BUILD-INITIAL-PANEL.                                        17550000
175600                                                                  17560000
175700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             17570000
175800                ASC-BLOCK-ENTRIES (2).                            17580000
175900                                                                  17590000
176000     MOVE +1                       TO ASC-BLK-SUB.                17600000
176100                                                                  17610000
176200     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       17620000
176300                                                                  17630000
176400     MOVE +0                       TO ASC-ITEM-SUB                17640000
176500                                      ASC-NUMBER-OF-ITEMS-READ    17650000
176600                                      ASC-NUMBER-OF-SELECTED-ITEMS17660000
176700                                      ASC-HIGHEST-BLOCK-WRITTEN   17670000
176800                                      ASC-START-OF-SELECTED-RANGE 17680000
176900                                      ASC-END-OF-SELECTED-RANGE   17690000
177000                                      ASC-ITEM-AT-TOP-OF-PANEL.   17700000
177100                                                                  17710000
177200     MOVE ASC-KEY-SHIPT-ID     TO DK-SHIPT-ID.                    17720000
177300     MOVE ASC-KEY-OPER-UNT-ID  TO DK-OPER-UNT-ID.                 17730000
177400                                                                  17740000
177500     PERFORM 4010-OPEN-CURSOR.                                    17750000
177600                                                                  17760000
177700     PERFORM 4300-READ-ITEMS-FROM-DB.                             17770000
177800                                                                  17780000
177900     PERFORM 4020-CLOSE-CURSOR.                                   17790000
178000                                                                  17800000
178100     MOVE +1                   TO  PV-TOP-ITEM.                   17810000
178200                                                                  17820000
178300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17830000
178400         SET DP030-SET-CURSOR-TRAILER                             17840000
178500                                   TO TRUE                        17850000
178600         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17860000
178700     ELSE                                                         17870000
178800         MOVE -1                   TO MR-SELECTL (1)              17880000
178900         SET DP030-SET-CURSOR-APPL-1                              17890000
179000                                   TO TRUE                        17900000
179100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17910000
179200     END-IF.                                                      17920000
179300                                                                  17930000
179400/                                                                 17940000
179500*----------------------------------------------------------------*17950000
179600* OPEN THE RECEIVER CURSOR.                                      *17960000
179700*----------------------------------------------------------------*17970000
179800                                                                  17980000
179900 4010-OPEN-CURSOR.                                                17990000
180000                                                                  18000000
180100     EXEC SQL                                                     18010000
180200          OPEN PO-SHIPMENT                                        18020000
180300     END-EXEC.                                                    18030000
180400                                                                  18040000
180500                                                                  18050000
180600*----------------------------------------------------------------*18060000
180700* CLOSE THE RECEIVER CURSOR.                                     *18070000
180800*----------------------------------------------------------------*18080000
180900                                                                  18090000
181000 4020-CLOSE-CURSOR.                                               18100000
181100                                                                  18110000
181200     EXEC SQL                                                     18120000
181300          CLOSE PO-SHIPMENT                                       18130000
181400     END-EXEC.                                                    18140000
181500                                                                  18150000
181600/                                                                 18160000
181700*----------------------------------------------------------------*18170000
181800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18180000
181900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18190000
182000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18200000
182100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18210000
182200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18220000
182300*                                                                *18230000
182400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18240000
182500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18250000
182600*    UPON INITIALIZATION.                                        *18260000
182700*----------------------------------------------------------------*18270000
182800                                                                  18280000
182900 4300-READ-ITEMS-FROM-DB.                                         18290000
183000                                                                  18300000
183100     PERFORM                                                      18310000
183200         VARYING PV-READ-COUNT                                    18320000
183300         FROM 1 BY 1                                              18330000
183400         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18340000
183500            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18350000
183600                                                                  18360000
183700         PERFORM 4310-FETCH                                       18370000
183800                                                                  18380000
183900         IF  ASC-ITEMS-LEFT-ON-DB                                 18390000
184000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18400000
184100                 ADD +1            TO ASC-ITEM-SUB                18410000
184200             ELSE                                                 18420000
184300                 ADD +1            TO ASC-BLK-SUB                 18430000
184400                 MOVE +1           TO ASC-ITEM-SUB                18440000
184500                                                                  18450000
184600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18460000
184700                     MOVE +1       TO ASC-BLK-SUB                 18470000
184800                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           18480000
184900                     PERFORM 5100-WRITE-TEMP-STORAGE              18490000
185000                     MOVE ASC-BLOCK-ENTRIES                       18500000
185100                               (PC-MAX-BLOCKS-IN-ARRAY)           18510000
185200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18520000
185300                     ADD +1        TO ASC-BLK-SUB                 18530000
185400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18540000
185500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18550000
185600                                   TO TRUE                        18560000
185700                 END-IF                                           18570000
185800             END-IF                                               18580000
185900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18590000
186000             MOVE ASC-NUMBER-OF-ITEMS-READ                        18600000
186100                                   TO ASC-LIST-ITEM-NUMBER        18610000
186200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18620000
186300             MOVE SHPTPO-PO-NBR    TO DK-PO-NBR                   18630000
186400                  ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           18640000
186500             MOVE SHPTPO-EXPTED-CART-CNT TO                       18650000
186600                  ASC-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          18660000
186700             MOVE SHPTPO-ACTL-CART-CNT TO                         18670000
186800                  ASC-ACTL-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)     18680000
186900             MOVE SHPTPO-DMG-CART-CNT TO                          18690000
187000                  ASC-DMG-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)      18700000
187100             MOVE SHPTPO-REC-SEQ-NBR TO                           18710000
187200                  ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      18720000
187300             MOVE SPACES         TO ENTNME-ENT-NAME-DESC          18730000
187400             PERFORM 4340-GET-AD-DATE                             18740000
187500             IF  SQLCODE = -305                                   18750000
187600                 MOVE SPACES     TO ASC-AD-DTE                    18760000
187700                                   (ASC-BLK-SUB ASC-ITEM-SUB)     18770000
187800             ELSE                                                 18780000
187900                 IF  DN-AD-EVNT-DTE = -1                          18790000
188000                     MOVE SPACES TO ASC-AD-DTE                    18800000
188100                                   (ASC-BLK-SUB ASC-ITEM-SUB)     18810000
188200                 ELSE                                             18820000
188300                     MOVE PURITM-AD-EVNT-DTE TO PV-DB2-DATE       18830000
188400                     MOVE PV-DB2-DATE-MM   TO PV-DISPLAY-DATE-MM  18840000
188500                     MOVE PV-DB2-DATE-DD   TO PV-DISPLAY-DATE-DD  18850000
188600                     MOVE PV-DB2-DATE-YY   TO PV-DISPLAY-DATE-YY  18860000
188700                     MOVE PV-DISPLAY-DATE  TO ASC-AD-DTE          18870000
188800                                   (ASC-BLK-SUB ASC-ITEM-SUB)     18880000
188900                 END-IF                                           18890000
189000             END-IF                                               18900000
189100             INITIALIZE PV-DB2-COUNT                              18910000
189200             PERFORM 4350-CHECK-PIC-AD                            18920000
189300             IF  PV-DB2-COUNT > +0                                18930000
189400                 MOVE 'YES'             TO ASC-PIC-AD             18940000
189500                                    (ASC-BLK-SUB ASC-ITEM-SUB)    18950000
189600             ELSE                                                 18960000
189700                 MOVE SPACES            TO ASC-PIC-AD             18970000
189800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    18980000
189900             END-IF                                               18990000
190000             PERFORM 4330-GET-ENT-NAME                            19000000
190100         END-IF                                                   19010000
190200     END-PERFORM.                                                 19020000
190300                                                                  19030000
190400     PERFORM 4320-GET-FCLTY-NAME.                                 19040000
190500                                                                  19050000
190600     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19060000
190700         MOVE +1               TO ASC-BLK-SUB                     19070000
190800         PERFORM 5100-WRITE-TEMP-STORAGE                          19080000
190900         ADD +1                TO ASC-BLK-SUB                     19090000
191000         PERFORM 5100-WRITE-TEMP-STORAGE                          19100000
191100                                                                  19110000
191200         MOVE 1                TO ASC-BLK-SUB                     19120000
191300                                  PV-BLOCK-NUMBER                 19130000
191400         PERFORM 4410-READ-TEMP-STORAGE                           19140000
191500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19150000
191600             MOVE 2            TO ASC-BLK-SUB                     19160000
191700                                  PV-BLOCK-NUMBER                 19170000
191800             PERFORM 4410-READ-TEMP-STORAGE                       19180000
191900         END-IF                                                   19190000
192000     END-IF.                                                      19200000
192100/                                                                 19210000
192200*----------------------------------------------------------------*19220000
192300*    FETCH THE RECEIVER NUMBER CURSOR.                           *19230000
192400*----------------------------------------------------------------*19240000
192500                                                                  19250000
192600 4310-FETCH.                                                      19260000
192700                                                                  19270000
192800     EXEC SQL                                                     19280000
192900          FETCH PO-SHIPMENT                                       19290000
193000          INTO                                                    19300000
193100                :SHPTPO-PO-NBR                                    19310000
193200               ,:SHPTPO-REC-SEQ-NBR                               19320000
193300               ,:SHPTPO-EXPTED-CART-CNT                           19330000
193400               ,:SHPTPO-ACTL-CART-CNT                             19340000
193500               ,:SHPTPO-DMG-CART-CNT                              19350000
193600               ,:SHPTPO-VEND-NAME                                 19360003
193700               ,:SHPTPO-CRE-TMST                                  19370000
193800     END-EXEC.                                                    19380000
193900                                                                  19390000
194000     EVALUATE TRUE                                                19400000
194100         WHEN SQLCODE = ZERO                                      19410000
194200              CONTINUE                                            19420000
194300         WHEN SQLCODE = +100                                      19430000
194400              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 19440000
194500         WHEN SQLWARN0 NOT EQUAL SPACE                            19450000
194600         WHEN SQLCODE NOT EQUAL ZERO                              19460000
194700              MOVE '4310-FETCH-CURSOR'                            19470000
194800                               TO DP013-PARAGRAPH                 19480000
194900              MOVE 'FETCH PO SHIPMEMT CURSOR'                     19490000
195000                               TO DP013-MESSAGE-TEXT (1)          19500000
195100              MOVE SQLCA       TO DP013-SQLCA                     19510000
195200              SET DP013-DB2-ABEND                                 19520000
195300                               TO TRUE                            19530000
195400              PERFORM DP013-0000-PROCESS-ABEND                    19540000
195500     END-EVALUATE.                                                19550000
195600/                                                                 19560000
195700*----------------------------------------------------------------*19570000
195800*    GET LOCATION NAME FROM XLT_LOC TABLE VIA XLKUT071           *19580005
195900*----------------------------------------------------------------*19590000
196000 4320-GET-FCLTY-NAME.                                             19600000
196100                                                                  19610000
196200     INITIALIZE XL071-COMMAREA-REC.                               19620005
196300                                                                  19630005
196400     MOVE ASC-KEY-OPER-UNT-ID TO XL071-LOCATION-NUMBER.           19640005
196500                                                                  19650005
196600     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    19660005
196700                                      XL071-COMMAREA              19670005
196800                                      XL071-COMMAREA-REC.         19680005
196900                                                                  19690000
197000     EVALUATE TRUE                                                19700005
197100         WHEN XL071-NO-ERRORS                                     19710005
197200             MOVE XL071-LOC-NM TO ASC-FCLTY-NME                   19720005
197300         WHEN XL071-LOC-NOT-FOUND                                 19730005
197400         WHEN XL071-SQLCODE-N = -904                              19740008
197500         WHEN XL071-SQLCODE-N = -913                              19750008
197600             MOVE SPACES TO XL071-LOC-NM                          19760005
197700         WHEN XL071-BAD-DB2-RETURN                                19770005
197800              MOVE '4320-GET-FCLTY-NAME' TO DP013-PARAGRAPH       19780005
197900              MOVE 'CALL TO XLKUT071' TO DP013-MESSAGE-TEXT (1)   19790005
198000              STRING 'LOCATION NBR: '    DELIMITED BY SIZE        19800005
198100                   XL071-LOCATION-NUMBER DELIMITED BY SIZE        19810005
198200                            INTO DP013-MESSAGE-TEXT(2)            19820005
198300              MOVE XL071-SQLCA     TO DP013-SQLCA                 19830005
198400              MOVE 'XLT_LOC'       TO DP013-DB2-TABLE-NAME (1)    19840005
198500              SET DP013-DB2-ABEND                                 19850005
198600                  DP013-XCTL-DISPLAY-RESTART TO TRUE              19860005
198700              PERFORM DP013-0000-PROCESS-ABEND                    19870005
198800     END-EVALUATE.                                                19880005
198900/                                                                 19890000
199000*----------------------------------------------------------------*19900000
199100*    GET THE VENDOR NAME                                         *19910000
199200*----------------------------------------------------------------*19920000
199300 4330-GET-ENT-NAME.                                               19930000
199400                                                                  19940000
199500     PERFORM                                                      19950000
199600         WITH TEST AFTER                                          19960000
199700         VARYING PV-RETRY-COUNTER                                 19970000
199800         FROM 1 BY 1                                              19980000
199900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19990000
200000             OR (SQLCODE = +0)                                    20000000
200100             OR (SQLCODE = +100))                                 20010000
200200                                                                  20020000
200300         EXEC SQL                                                 20030000
200400              SELECT ENT_NAME_DESC                                20040000
200500                INTO :ENTNME-ENT-NAME-DESC                        20050000
200600                FROM TPURCHS A                                    20060000
200700                    ,TENTNME B                                    20070000
200800               WHERE A.PO_NBR         = :DK-PO-NBR                20080000
200900                 AND A.VER_STATUS_CDE = 'A'                       20090000
201000                 AND B.TYPE_CDE       = '01'                      20100000
201100                 AND A.ENT_ID = B.ENT_ID                          20110000
201200         END-EXEC                                                 20120000
201300                                                                  20130000
201400         EVALUATE TRUE                                            20140000
201500             WHEN SQLCODE = +0                                    20150000
201600                  MOVE ENTNME-ENT-NAME-DESC  TO                   20160003
201700                                     ASC-ENT-NAME-DESC            20170003
201800                                    (ASC-BLK-SUB ASC-ITEM-SUB)    20180000
201900             WHEN SQLCODE = +100                                  20190000
202000                  MOVE SHPTPO-VEND-NAME      TO                   20200003
202100                                     ASC-ENT-NAME-DESC            20210003
202200                                    (ASC-BLK-SUB ASC-ITEM-SUB)    20220000
202300             WHEN SQLCODE = -904                                  20230000
202400             WHEN SQLCODE = -913                                  20240000
202500                  CONTINUE                                        20250000
202600                                                                  20260000
202700             WHEN SQLWARN0 NOT = SPACES                           20270000
202800             WHEN SQLCODE < +0                                    20280000
202900             WHEN SQLCODE > +0                                    20290000
203000                  MOVE '4330-GET-ENT-NAME'                        20300000
203100                                  TO DP013-PARAGRAPH              20310000
203200                  MOVE 'UNSUCCESSFUL SELECT ON TENTNME TABLE'     20320000
203300                                  TO DP013-MESSAGE-TEXT (1)       20330000
203400                  MOVE SQLCA      TO DP013-SQLCA                  20340000
203500                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     20350000
203600                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (2)     20360000
203700                  SET DP013-DB2-ABEND                             20370000
203800                      DP013-XCTL-DISPLAY-RESTART                  20380000
203900                                  TO TRUE                         20390000
204000                  PERFORM DP013-0000-PROCESS-ABEND                20400000
204100         END-EVALUATE                                             20410000
204200     END-PERFORM.                                                 20420000
204300                                                                  20430000
204400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20440000
204500         MOVE '4330-GET-ENT-NAME  '                               20450000
204600                                  TO DP013-PARAGRAPH              20460000
204700         MOVE 'MAX RETRIES EXCEEDED ON SELECT TENTNME TABLE'      20470000
204800                                  TO DP013-MESSAGE-TEXT (1)       20480000
204900         MOVE SQLCA               TO DP013-SQLCA                  20490000
205000         MOVE 'TPURCHS'           TO DP013-DB2-TABLE-NAME (1)     20500000
205100         MOVE 'TENTNME'           TO DP013-DB2-TABLE-NAME (2)     20510000
205200         SET DP013-DB2-ABEND                                      20520000
205300             DP013-XCTL-DISPLAY-RESTART                           20530000
205400                                  TO TRUE                         20540000
205500         PERFORM DP013-0000-PROCESS-ABEND                         20550000
205600     END-IF.                                                      20560000
205700                                                                  20570000
205800/                                                                 20580000
205900*----------------------------------------------------------------*20590000
206000*    GET THE EARLIEST AD DATE                                    *20600000
206100*----------------------------------------------------------------*20610000
206200 4340-GET-AD-DATE.                                                20620000
206300                                                                  20630000
206400     PERFORM                                                      20640000
206500         WITH TEST AFTER                                          20650000
206600         VARYING PV-RETRY-COUNTER                                 20660000
206700         FROM 1 BY 1                                              20670000
206800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20680000
206900             OR (SQLCODE = +0)                                    20690000
207000             OR (SQLCODE = -305))                                 20700000
207100                                                                  20710000
207200         EXEC SQL                                                 20720000
207300              SELECT MIN(AD_EVNT_DTE)                             20730000
207400                INTO :PURITM-AD-EVNT-DTE                          20740000
207500                       :DN-AD-EVNT-DTE                            20750000
207600                FROM TPURITM                                      20760000
207700               WHERE PO_NBR         = :DK-PO-NBR                  20770000
207800                 AND VER_STATUS_CDE = 'A'                         20780000
207900                 AND AD_EVNT_DTE    > '0001-01-01'                20790000
208000         END-EXEC                                                 20800000
208100                                                                  20810000
208200         EVALUATE TRUE                                            20820000
208300             WHEN SQLCODE = +0                                    20830000
208400             WHEN SQLCODE = -305                                  20840000
208500             WHEN SQLCODE = -904                                  20850000
208600             WHEN SQLCODE = -913                                  20860000
208700                  CONTINUE                                        20870000
208800                                                                  20880000
208900             WHEN SQLWARN0 NOT = SPACES                           20890000
209000             WHEN SQLCODE < +0                                    20900000
209100             WHEN SQLCODE > +0                                    20910000
209200                  MOVE '4340-GET-AD-DATE'                         20920000
209300                                  TO DP013-PARAGRAPH              20930000
209400                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           20940000
209500                                  TO DP013-MESSAGE-TEXT (1)       20950000
209600                  MOVE SQLCA      TO DP013-SQLCA                  20960000
209700                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     20970000
209800                  SET DP013-DB2-ABEND                             20980000
209900                      DP013-XCTL-DISPLAY-RESTART                  20990000
210000                                  TO TRUE                         21000000
210100                  PERFORM DP013-0000-PROCESS-ABEND                21010000
210200         END-EVALUATE                                             21020000
210300     END-PERFORM.                                                 21030000
210400                                                                  21040000
210500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21050000
210600         MOVE '4340-GET-AD-DATE'                                  21060000
210700                                  TO DP013-PARAGRAPH              21070000
210800         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            21080000
210900                                  TO DP013-MESSAGE-TEXT (1)       21090000
211000         MOVE SQLCA               TO DP013-SQLCA                  21100000
211100         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     21110000
211200         SET DP013-DB2-ABEND                                      21120000
211300             DP013-XCTL-DISPLAY-RESTART                           21130000
211400                                  TO TRUE                         21140000
211500         PERFORM DP013-0000-PROCESS-ABEND                         21150000
211600     END-IF.                                                      21160000
211700                                                                  21170000
211800/                                                                 21180000
211900*----------------------------------------------------------------*21190000
212000*    GET THE EARLIEST AD DATE                                    *21200000
212100*----------------------------------------------------------------*21210000
212200 4350-CHECK-PIC-AD.                                               21220000
212300                                                                  21230000
212400     PERFORM                                                      21240000
212500         WITH TEST AFTER                                          21250000
212600         VARYING PV-RETRY-COUNTER                                 21260000
212700         FROM 1 BY 1                                              21270000
212800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21280000
212900             OR (SQLCODE = +0)                                    21290000
213000             OR (SQLCODE = -305))                                 21300000
213100                                                                  21310000
213200         EXEC SQL                                                 21320000
213300              SELECT COUNT(*)                                     21330000
213400                INTO :PV-DB2-COUNT                                21340000
213500                FROM TPURITM                                      21350000
213600               WHERE PO_NBR         = :DK-PO-NBR                  21360000
213700                 AND VER_STATUS_CDE = 'A'                         21370000
213800                 AND PIC_ITM_IND    = 'Y'                         21380000
213900         END-EXEC                                                 21390000
214000                                                                  21400000
214100         EVALUATE TRUE                                            21410000
214200             WHEN SQLCODE = +0                                    21420000
214300             WHEN SQLCODE = -305                                  21430000
214400             WHEN SQLCODE = -904                                  21440000
214500             WHEN SQLCODE = -913                                  21450000
214600                  CONTINUE                                        21460000
214700                                                                  21470000
214800             WHEN SQLWARN0 NOT = SPACES                           21480000
214900             WHEN SQLCODE < +0                                    21490000
215000             WHEN SQLCODE > +0                                    21500000
215100                  MOVE '435-CHECK-PIC-AD'                         21510000
215200                                  TO DP013-PARAGRAPH              21520000
215300                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           21530000
215400                                  TO DP013-MESSAGE-TEXT (1)       21540000
215500                  MOVE SQLCA      TO DP013-SQLCA                  21550000
215600                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     21560000
215700                  SET DP013-DB2-ABEND                             21570000
215800                      DP013-XCTL-DISPLAY-RESTART                  21580000
215900                                  TO TRUE                         21590000
216000                  PERFORM DP013-0000-PROCESS-ABEND                21600000
216100         END-EVALUATE                                             21610000
216200     END-PERFORM.                                                 21620000
216300                                                                  21630000
216400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21640000
216500         MOVE '4350-CHECK-PIC-AD'                                 21650000
216600                                  TO DP013-PARAGRAPH              21660000
216700         MOVE 'MAX RETRIES EXCEEDED ON SELECT TPURITM'            21670000
216800                                  TO DP013-MESSAGE-TEXT (1)       21680000
216900         MOVE SQLCA               TO DP013-SQLCA                  21690000
217000         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     21700000
217100         SET DP013-DB2-ABEND                                      21710000
217200             DP013-XCTL-DISPLAY-RESTART                           21720000
217300                                  TO TRUE                         21730000
217400         PERFORM DP013-0000-PROCESS-ABEND                         21740000
217500     END-IF.                                                      21750000
217600                                                                  21760000
217700/                                                                 21770000
217800*----------------------------------------------------------------*21780000
217900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21790000
218000*----------------------------------------------------------------*21800000
218100                                                                  21810000
218200 4400-MOVE-COMMAREA-TO-SCREEN.                                    21820000
218300                                                                  21830000
218400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21840000
218500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21850000
218600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21860000
218700             MOVE +1    TO ASC-BLK-SUB                            21870000
218800             PERFORM 5100-WRITE-TEMP-STORAGE                      21880000
218900             ADD +1     TO ASC-BLK-SUB                            21890000
219000             PERFORM 5100-WRITE-TEMP-STORAGE                      21900000
219100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21910000
219200                 GIVING PV-BLOCK-NUMBER                           21920000
219300                 REMAINDER PV-REMAINDER                           21930000
219400             IF  PV-REMAINDER > ZERO                              21940000
219500                 ADD +1 TO PV-BLOCK-NUMBER                        21950000
219600             END-IF                                               21960000
219700             MOVE +1    TO ASC-BLK-SUB                            21970000
219800             PERFORM 4410-READ-TEMP-STORAGE                       21980000
219900             ADD +1     TO ASC-BLK-SUB                            21990000
220000                           PV-BLOCK-NUMBER                        22000000
220100             PERFORM 4410-READ-TEMP-STORAGE                       22010000
220200     END-IF.                                                      22020000
220300                                                                  22030000
220400     MOVE +1            TO ASC-BLK-SUB.                           22040000
220500                                                                  22050000
220600     COMPUTE ASC-ITEM-SUB =                                       22060000
220700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              22070000
220800         + PC-ITEMS-PER-PANEL).                                   22080000
220900                                                                  22090000
221000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        22100000
221100         ADD +1         TO ASC-BLK-SUB                            22110000
221200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            22120000
221300     END-IF.                                                      22130000
221400                                                                  22140000
221500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           22150000
221600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                22160000
221700     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        22170000
221800     PERFORM 4420-FORMAT-LIST-LINES                               22180000
221900         VARYING PV-SUB                                           22190000
222000         FROM PC-ITEMS-PER-PANEL BY -1                            22200000
222100         UNTIL PV-SUB < +1.                                       22210000
222200                                                                  22220000
222300     MOVE ASC-KEY-OPER-UNT-ID   TO AOPERO.                        22230000
222400     MOVE ASC-KEY-FCLTY-ID      TO AFCLTYO.                       22240000
222500     MOVE ASC-FCLTY-NME         TO ADESCO.                        22250000
222600     MOVE ASC-KEY-OWNER-SCAC-ID TO ASCACO.                        22260000
222700     MOVE ASC-KEY-VEH-NBR       TO ATRLRO.                        22270000
222800     MOVE ASC-KEY-PRO-NBR       TO APRONBRO.                      22280000
222900     MOVE ASC-KEY-BOL-NBR       TO ABOLNBRO.                      22290000
222910*** DMH 1/22/2019 - BEGIN                                         22291025
222911     MOVE ASC-TRIP-OPER         TO ASHOPO.                        22291125
222912     MOVE ASC-TRIP-OPER-NAME    TO ASHNMO.                        22291225
222920*** DMH 1/22/2019 - END                                           22292025
223000                                                                  22300000
223100     COMPUTE ASC-ITEMS-DISPLAYED =                                22310000
223200         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          22320000
223300     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    22330000
223400                                      ASTRTITO.                   22340000
223500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    22350000
223600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    22360000
223700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            22370000
223800                                   TO ASELITO.                    22380000
223900                                                                  22390000
224000     IF  DP020-MSG-NUMBER-X = SPACE                               22400000
224100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  22410000
224200*            --- MORE ITEMS TO DISPLAY ----                       22420000
224300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            22430000
224400             SET DP020-MSG-INFORMATIONAL TO TRUE                  22440000
224500         END-IF                                                   22450000
224600     END-IF.                                                      22460000
224700/                                                                 22470000
224800*----------------------------------------------------------------*22480000
224900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *22490000
225000*----------------------------------------------------------------*22500000
225100                                                                  22510000
225200 4410-READ-TEMP-STORAGE.                                          22520000
225300                                                                  22530000
225400     EXEC CICS                                                    22540000
225500         READQ TS                                                 22550000
225600             QUEUE (ASC-LIST-QUEUE-NAME)                          22560000
225700             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22570000
225800             ITEM  (PV-BLOCK-NUMBER)                              22580000
225900             RESP  (PV-CICS-RESP)                                 22590000
226000     END-EXEC.                                                    22600000
226100                                                                  22610000
226200     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       22620000
226300       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     22630000
226400         CONTINUE                                                 22640000
226500     ELSE                                                         22650000
226600         SET DP013-CICS-ABEND     TO TRUE                         22660000
226700         SET DP013-NO-ROLLBACK    TO TRUE                         22670000
226800         MOVE '4410-READ-TEMP-STORAGE'                            22680000
226900                                  TO DP013-PARAGRAPH              22690000
227000         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      22700000
227100                                  TO DP013-MESSAGE-TEXT(1)        22710000
227200         PERFORM DP013-0000-PROCESS-ABEND                         22720000
227300     END-IF.                                                      22730000
227400                                                                  22740000
227500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22750000
227600                                                                  22760000
227700     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22770000
227800         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22780000
227900     END-IF.                                                      22790000
228000/                                                                 22800000
228100*----------------------------------------------------------------*22810000
228200*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22820000
228300*----------------------------------------------------------------*22830000
228400                                                                  22840000
228500 4420-FORMAT-LIST-LINES.                                          22850000
228600                                                                  22860000
228700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       22870000
228800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22880000
228900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           22890000
229000         MOVE ZEROES             TO AOPERO                        22900000
229100                                    AFCLTYO                       22910000
229200         MOVE SPACES             TO ADESCO                        22920000
229300                                    ASCACO                        22930000
229400                                    ATRLRO                        22940000
229500                                    APRONBRO                      22950000
229600                                    ABOLNBRO                      22960000
229700                                    MR-SELECT (PV-SUB)            22970000
229800                                    MR-PO-NBR (PV-SUB)            22980000
229900                                    MR-CARTON-CNT-X (PV-SUB)      22990000
230000                                    MR-ACTL-CARTON-CNT-X (PV-SUB) 23000000
230100                                    MR-DMG-CARTON-CNT-X (PV-SUB)  23010000
230200                                    MR-REC-SEQ-NBR (PV-SUB)       23020000
230300                                    MR-PIC-AD (PV-SUB)            23030000
230400                                    MR-AD-DTE (PV-SUB)            23040000
230500                                    MR-ENT-NAME-DESC (PV-SUB)     23050000
230600     ELSE                                                         23060000
230700         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23070000
230800                                                   > SPACE        23080000
230900             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 23090000
231000                                 TO MR-SELECT (PV-SUB)            23100000
231100         ELSE                                                     23110000
231200             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      23120000
231300                                 TO MR-SELECT (PV-SUB)            23130000
231400         END-IF                                                   23140000
231500                                                                  23150000
231600         IF  ASC-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)                 23160000
231700             MOVE DP015-RED      TO  MR-SELECTC(PV-SUB)           23170000
231800             MOVE DP015-REVERSE  TO  MR-SELECTH(PV-SUB)           23180000
231900         ELSE                                                     23190000
232000             MOVE DP015-GREEN    TO  MR-SELECTC(PV-SUB)           23200000
232100             MOVE DP015-UNDERLINE TO MR-SELECTH(PV-SUB)           23210000
232200         END-IF                                                   23220000
232300                                                                  23230000
232400         IF DP030-SET-CURSOR-TRAILER                              23240000
232500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)23250000
232600                 > SPACE)                                         23260000
232700               OR (PV-SUB = 1))                                   23270000
232800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               23280000
232900                MOVE -1          TO MR-SELECTL (PV-SUB)           23290000
233000             END-IF                                               23300000
233100         END-IF                                                   23310000
233200                                                                  23320000
233300*        IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            23330000
233400             MOVE ASC-PO-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           23340000
233500                                 TO MR-PO-NBR (PV-SUB)            23350000
233600             MOVE ASC-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)          23360000
233700                                 TO MR-CARTON-CNT (PV-SUB)        23370000
233800             MOVE ASC-ACTL-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)     23380000
233900                                 TO MR-ACTL-CARTON-CNT (PV-SUB)   23390000
234000             MOVE ASC-DMG-CTN-CNT (ASC-BLK-SUB ASC-ITEM-SUB)      23400000
234100                                 TO MR-DMG-CARTON-CNT (PV-SUB)    23410000
234200             MOVE ASC-REC-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      23420000
234300                                 TO MR-REC-SEQ-NBR (PV-SUB)       23430000
234400             MOVE ASC-PIC-AD (ASC-BLK-SUB ASC-ITEM-SUB)           23440000
234500                                 TO MR-PIC-AD (PV-SUB)            23450000
234600             MOVE ASC-AD-DTE (ASC-BLK-SUB ASC-ITEM-SUB)           23460000
234700                                 TO MR-AD-DTE (PV-SUB)            23470000
234800             MOVE ASC-ENT-NAME-DESC (ASC-BLK-SUB ASC-ITEM-SUB)    23480000
234900                                 TO MR-ENT-NAME-DESC (PV-SUB)     23490000
235000*        END-IF                                                   23500000
235100     END-IF.                                                      23510000
235200                                                                  23520000
235300     SUBTRACT +1 FROM ASC-ITEM-SUB                                23530000
235400                                                                  23540000
235500     IF  ASC-ITEM-SUB < + 1                                       23550000
235600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  23560000
235700         MOVE +1                 TO ASC-BLK-SUB                   23570000
235800     END-IF.                                                      23580000
235900/                                                                 23590000
236000******************************************************************23600000
236100** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **23610000
236200** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **23620000
236300** ISSUE A WARNING.                                             **23630000
236400******************************************************************23640000
236500                                                                  23650000
236600 4430-CHECK-FOR-BEGIN-AND-END.                                    23660000
236700                                                                  23670000
236800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       23680000
236900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     23690000
237000*            -- NO END-OF-RANGE SPECFIED ---                      23700000
237100             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            23710000
237200             SET DP020-MSG-WARNING TO TRUE                        23720000
237300             PERFORM 4431-POSITION-AT-WARNING                     23730000
237400         END-IF                                                   23740000
237500     ELSE                                                         23750000
237600         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     23760000
237700*            -- NO BEGINNING-OF-RANGE SPECFIED ---                23770000
237800             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23780000
237900             SET DP020-MSG-WARNING TO TRUE                        23790000
238000             PERFORM 4431-POSITION-AT-WARNING                     23800000
238100         END-IF                                                   23810000
238200     END-IF.                                                      23820000
238300                                                                  23830000
238400                                                                  23840000
238500******************************************************************23850000
238600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **23860000
238700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **23870000
238800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **23880000
238900** POSITION THE CURSOR THERE.                                   **23890000
239000******************************************************************23900000
239100                                                                  23910000
239200 4431-POSITION-AT-WARNING.                                        23920000
239300                                                                  23930000
239400     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23940000
239500                    - PV-TOP-ITEM + 1.                            23950000
239600                                                                  23960000
239700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23970000
239800         CONTINUE                                                 23980000
239900     ELSE                                                         23990000
240000         SET DP030-SET-CURSOR-APPL-1                              24000000
240100                                   TO TRUE                        24010000
240200         MOVE -1                   TO MR-SELECTL (PV-SUB)         24020000
240300         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24030000
240400         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24040000
240500     END-IF.                                                      24050000
240600                                                                  24060000
240700     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   24070000
240800                    - PV-TOP-ITEM + 1.                            24080000
240900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      24090000
241000         CONTINUE                                                 24100000
241100     ELSE                                                         24110000
241200         SET DP030-SET-CURSOR-APPL-1                              24120000
241300                                   TO TRUE                        24130000
241400         MOVE -1                   TO MR-SELECTL (PV-SUB)         24140000
241500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         24150000
241600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         24160000
241700     END-IF.                                                      24170000
241800/                                                                 24180000
241900*----------------------------------------------------------------*24190000
242000* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *24200000
242100* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *24210000
242200* FOR THE SELECTED ITEMS QUEUE.                                  *24220000
242300*                                                                *24230000
242400* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *24240000
242500* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *24250000
242600* THE ARRAY IS FULL.                                             *24260000
242700*----------------------------------------------------------------*24270000
242800                                                                  24280000
242900 5000-PREPARE-SEL-QUEUE.                                          24290000
243000                                                                  24300000
243100     MOVE +1                   TO  ASC-BLK-SUB.                   24310000
243200     PERFORM 5100-WRITE-TEMP-STORAGE.                             24320000
243300     ADD +1                    TO  ASC-BLK-SUB.                   24330000
243400     PERFORM 5100-WRITE-TEMP-STORAGE.                             24340000
243500                                                                  24350000
243600     MOVE ASC-SEL-QUEUE-NAME-OUT TO  RC015-SEL-QUEUE-NAME.        24360000
243700     PERFORM 6010-DELETE-SEL-QUEUE.                               24370000
243800                                                                  24380000
243900     SET ASC-UPDATE-TSQ        TO  TRUE.                          24390000
244000                                                                  24400000
244100     SET RC013-IDX             TO  1.                             24410000
244200     MOVE ZERO                 TO RC015-NUMBER-OF-TS-ITEMS.       24420000
244300     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        24430000
244400                                                                  24440000
244500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           24450000
244600             VARYING PV-ITEM                                      24460000
244700             FROM 1 BY 1                                          24470000
244800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     24480000
244900                                                                  24490000
245000     IF  RC013-IDX > 1                                            24500000
245100         PERFORM 5205-WRITE-SEL-QUEUE                             24510000
245200         ADD +1                TO RC015-NUMBER-OF-TS-ITEMS        24520000
245300     END-IF.                                                      24530000
245400/                                                                 24540000
245500*----------------------------------------------------------------*24550000
245600*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *24560000
245700*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *24570000
245800*----------------------------------------------------------------*24580000
245900                                                                  24590000
246000 5100-WRITE-TEMP-STORAGE.                                         24600000
246100                                                                  24610000
246200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     24620000
246300                                   TO PV-LIST-ITEM-NUMBER.        24630000
246400     COMPUTE PV-BLOCK-NUMBER =                                    24640000
246500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    24650000
246600                                                                  24660000
246700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             24670000
246800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             24680000
246900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      24690000
247000             PERFORM 5105-REWRITE-ASC-LISTQ                       24700000
247100         END-IF                                                   24710000
247200     ELSE                                                         24720000
247300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       24730000
247400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            24740000
247500         PERFORM 5110-WRITE-ASC-LISTQ                             24750000
247600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   24760000
247700     END-IF.                                                      24770000
247800                                                                  24780000
247900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             24790000
248000                                                                  24800000
248100                                                                  24810000
248200******************************************************************24820000
248300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **24830000
248400** SPECIFIC COMMAREA.                                           **24840000
248500******************************************************************24850000
248600 5105-REWRITE-ASC-LISTQ.                                          24860000
248700                                                                  24870000
248800     EXEC CICS                                                    24880000
248900         WRITEQ TS                                                24890000
249000             QUEUE (ASC-LIST-QUEUE-NAME)                          24900000
249100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24910000
249200             ITEM  (PV-BLOCK-NUMBER)                              24920000
249300             REWRITE                                              24930000
249400             RESP  (PV-CICS-RESP)                                 24940000
249500     END-EXEC.                                                    24950000
249600                                                                  24960000
249700     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24970000
249800         CONTINUE                                                 24980000
249900     ELSE                                                         24990000
250000         SET DP013-CICS-ABEND            TO TRUE                  25000000
250100         SET DP013-NO-ROLLBACK           TO TRUE                  25010000
250200         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       25020000
250300         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     25030000
250400                                         TO DP013-MESSAGE-TEXT(1) 25040000
250500         PERFORM DP013-0000-PROCESS-ABEND                         25050000
250600     END-IF.                                                      25060000
250700                                                                  25070000
250800                                                                  25080000
250900******************************************************************25090000
251000** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **25100000
251100** SPECIFIC COMMAREA.                                           **25110000
251200******************************************************************25120000
251300 5110-WRITE-ASC-LISTQ.                                            25130000
251400                                                                  25140000
251500     EXEC CICS                                                    25150000
251600         WRITEQ TS                                                25160000
251700             QUEUE (ASC-LIST-QUEUE-NAME)                          25170000
251800             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               25180000
251900             ITEM  (PV-BLOCK-NUMBER)                              25190000
252000             RESP  (PV-CICS-RESP)                                 25200000
252100     END-EXEC.                                                    25210000
252200                                                                  25220000
252300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      25230000
252400         SET DP013-CICS-ABEND      TO TRUE                        25240000
252500         SET DP013-NO-ROLLBACK     TO TRUE                        25250000
252600         MOVE '5110-WRITE-ASC-LISTQ'                              25260000
252700                                   TO DP013-PARAGRAPH             25270000
252800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           25280000
252900                                   TO DP013-MESSAGE-TEXT(1)       25290000
253000         PERFORM DP013-0000-PROCESS-ABEND                         25300000
253100     END-IF.                                                      25310000
253200/                                                                 25320000
253300*----------------------------------------------------------------*25330000
253400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *25340000
253500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *25350000
253600*----------------------------------------------------------------*25360000
253700                                                                  25370000
253800 5200-FILL-SEL-QUEUE-RECORD.                                      25380000
253900                                                                  25390000
254000     PERFORM 6112-READ-LIST-QUEUE.                                25400000
254100                                                                  25410000
254200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       25420000
254300         PERFORM                                                  25430000
254400         VARYING LQW-IDX                                          25440000
254500         FROM 1 BY 1                                              25450000
254600         UNTIL LQW-IDX > PC-ITEMS-PER-PANEL                       25460000
254700         OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO                25470000
254800                                                                  25480000
254900             IF  LQW-SELECT (LQW-IDX)                             25490000
255000*IR-213 FROM HERE                                                 25500000
255100                 IF (LQW-REC-SEQ-NBR (LQW-IDX) NOT EQUAL ZERO     25510000
255200                 AND DP020-SRC-AID EQUAL DP016-PF16)              25520000
255300                     MOVE PC-TSYMSG-00902                         25530000
255400                                   TO  DP020-MSG-NUMBER           25540000
255500                     SET DP020-MSG-FATAL                          25550000
255600                         LQW-ERROR (LQW-IDX)                      25560000
255700                         PS-ERROR  TO  TRUE                       25570000
255800                     MOVE PV-ITEM  TO  PV-SAVE-ITEM               25580000
255900                     PERFORM 6111-WRITE-LIST-QUEUE                25590000
256000*IR-213 TO HERE                                                   25600000
256100                 ELSE                                             25610000
256200                     MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX) TO       25620000
256300                                   RC013-ITEM (RC013-IDX)         25630000
256400                     MOVE LQW-PO-NBR (LQW-IDX) TO                 25640000
256500                                   RC013-PO-NBR (RC013-IDX)       25650000
256600                     MOVE LQW-REC-SEQ-NBR (LQW-IDX) TO            25660000
256700                                   RC013-REC-SEQ-NBR (RC013-IDX)  25670000
256800                     MOVE ASC-KEY-ARRIVAL-DTE TO                  25680000
256900                                   RC013-ARRIVAL-DTE (RC013-IDX)  25690000
257000                     SET RC013-IDX UP BY 1                        25700000
257100                     IF  RC013-IDX > RC013-MAX-ITEMS              25710000
257200                         PERFORM 5205-WRITE-SEL-QUEUE             25720000
257300                         ADD +1    TO RC015-NUMBER-OF-TS-ITEMS    25730000
257400                         INITIALIZE RC013-SELECTED-ITEM-ARRAY     25740000
257500                         SET RC013-IDX TO  1                      25750000
257600                     END-IF                                       25760000
257700                 END-IF                                           25770000
257800             END-IF                                               25780000
257900         END-PERFORM                                              25790000
258000     END-IF.                                                      25800000
258100                                                                  25810000
258200*----------------------------------------------------------------*25820000
258300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *25830000
258400*----------------------------------------------------------------*25840000
258500                                                                  25850000
258600 5205-WRITE-SEL-QUEUE.                                            25860000
258700                                                                  25870000
258800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            25880000
258900                                   TO RC013-SELECTED-ITEMS.       25890000
259000                                                                  25900000
259100     EXEC CICS                                                    25910000
259200          WRITEQ TS                                               25920000
259300              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      25930000
259400              FROM  (RC013-DC-SELECT-RECORD)                      25940000
259500              ITEM  (PV-SEL-QUEUE-ITEM)                           25950000
259600              RESP  (PV-CICS-RESP)                                25960000
259700     END-EXEC.                                                    25970000
259800                                                                  25980000
259900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25990000
260000         CONTINUE                                                 26000000
260100     ELSE                                                         26010000
260200         SET DP013-CICS-ABEND      TO TRUE                        26020000
260300         SET DP013-NO-ROLLBACK     TO TRUE                        26030000
260400         MOVE '5205-WRITE-SEL-QUEUE'                              26040000
260500                                   TO DP013-PARAGRAPH             26050000
260600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          26060000
260700                                   TO DP013-MESSAGE-TEXT(1)       26070000
260800         PERFORM DP013-0000-PROCESS-ABEND                         26080000
260900     END-IF.                                                      26090000
261000/                                                                 26100000
261100******************************************************************26110000
261200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **26120000
261300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **26130000
261400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **26140000
261500** THE USER.                                                    **26150000
261600******************************************************************26160000
261700 6000-REFRESH-PANEL-FROM-TEMP.                                    26170000
261800                                                                  26180000
261900     IF  ASC-UPDATE-TSQ                                           26190000
262000         SET ASC-NO-TSQ-UPDATE TO TRUE                            26200000
262100         MOVE ZERO                 TO PV-SAVE-ITEM                26210000
262200                                      PV-SEL-QUEUE-ITEM           26220000
262300         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        26230000
262400                                   TO PV-HOLD-SELECTED-ITEMS      26240000
262500         PERFORM 6100-UPDATE-TSQ                                  26250000
262600             UNTIL PV-ITEMS-PROCESSED >                           26260000
262700                                     ASC-NUMBER-OF-SELECTED-ITEMS 26270000
262800         PERFORM 6010-DELETE-SEL-QUEUE                            26280000
262900         INITIALIZE ASC-BLOCK-ENTRIES (1)                         26290000
263000                    ASC-BLOCK-ENTRIES (2)                         26300000
263100     END-IF.                                                      26310000
263200                                                                  26320000
263300                                                                  26330000
263400*----------------------------------------------------------------*26340000
263500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *26350000
263600*----------------------------------------------------------------*26360000
263700 6010-DELETE-SEL-QUEUE.                                           26370000
263800                                                                  26380000
263900     EXEC CICS                                                    26390000
264000         DELETEQ TS                                               26400000
264100             QUEUE (ASC-SEL-QUEUE-NAME-OUT)                       26410000
264200             RESP  (PV-CICS-RESP)                                 26420000
264300     END-EXEC.                                                    26430000
264400                                                                  26440000
264500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      26450000
264600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         26460000
264700         CONTINUE                                                 26470000
264800     ELSE                                                         26480000
264900         SET DP013-CICS-ABEND TO TRUE                             26490000
265000         SET DP013-NO-ROLLBACK TO TRUE                            26500000
265100         MOVE '6010-DELETE-SEL-QUEUE'                             26510000
265200                        TO DP013-PARAGRAPH                        26520000
265300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         26530000
265400                        TO DP013-MESSAGE-TEXT (1)                 26540000
265500         PERFORM DP013-0000-PROCESS-ABEND                         26550000
265600     END-IF.                                                      26560000
265700                                                                  26570000
265800                                                                  26580000
265900*----------------------------------------------------------------*26590000
266000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *26600000
266100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *26610000
266200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *26620000
266300*    THE TEMP QUEUE.                                             *26630000
266400*----------------------------------------------------------------*26640000
266500                                                                  26650000
266600 6100-UPDATE-TSQ.                                                 26660000
266700                                                                  26670000
266800     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             26680000
266900     PERFORM 6105-READ-SEL-QUEUE.                                 26690000
267000     PERFORM                                                      26700000
267100         VARYING RC013-IDX                                        26710000
267200         FROM 1 BY 1                                              26720000
267300         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     26730000
267400         OR (RC013-IDX > RC013-MAX-ITEMS))                        26740000
267500         IF  RC013-ACTION-SW (RC013-IDX) > SPACE                  26750000
267600             PERFORM 6110-PROCESS-ITEMS                           26760000
267700         END-IF                                                   26770000
267800         ADD +1                TO PV-ITEMS-PROCESSED              26780000
267900     END-PERFORM.                                                 26790000
268000     PERFORM 6111-WRITE-LIST-QUEUE.                               26800000
268100                                                                  26810000
268200                                                                  26820000
268300*----------------------------------------------------------------*26830000
268400*    READ THE LIST QUEUE RECORD.                                 *26840000
268500*----------------------------------------------------------------*26850000
268600                                                                  26860000
268700 6105-READ-SEL-QUEUE.                                             26870000
268800                                                                  26880000
268900     EXEC CICS                                                    26890000
269000          READQ TS                                                26900000
269100              QUEUE (ASC-SEL-QUEUE-NAME-OUT)                      26910000
269200              INTO  (RC013-DC-SELECT-RECORD)                      26920000
269300              ITEM  (PV-SEL-QUEUE-ITEM)                           26930000
269400              RESP  (PV-CICS-RESP)                                26940000
269500     END-EXEC.                                                    26950000
269600                                                                  26960000
269700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26970000
269800     OR  PV-CICS-RESP = DFHRESP (QIDERR)                          26980000
269900         CONTINUE                                                 26990000
270000     ELSE                                                         27000000
270100         SET DP013-CICS-ABEND      TO  TRUE                       27010000
270200         SET DP013-NO-ROLLBACK     TO  TRUE                       27020000
270300         MOVE '6105-READ-SEL-QUEUE'                               27030000
270400                                   TO  DP013-PARAGRAPH            27040000
270500         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           27050000
270600                                   TO  DP013-MESSAGE-TEXT(1)      27060000
270700         PERFORM DP013-0000-PROCESS-ABEND                         27070000
270800     END-IF.                                                      27080000
270900/                                                                 27090000
271000*----------------------------------------------------------------*27100000
271100*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*27110000
271200*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY. CALCULATE *27120000
271300*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *27130000
271400*----------------------------------------------------------------*27140000
271500                                                                  27150000
271600 6110-PROCESS-ITEMS.                                              27160000
271700                                                                  27170000
271800     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          27180000
271900                     / PC-ITEMS-PER-PANEL).                       27190000
272000                                                                  27200000
272100     IF  PV-ITEM NOT = PV-SAVE-ITEM                               27210000
272200         IF  PV-SAVE-ITEM NOT = ZERO                              27220000
272300             PERFORM 6111-WRITE-LIST-QUEUE                        27230000
272400         END-IF                                                   27240000
272500         MOVE PV-ITEM          TO PV-SAVE-ITEM                    27250000
272600                                                                  27260000
272700         PERFORM 6112-READ-LIST-QUEUE                             27270000
272800         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               27280000
272900             CONTINUE                                             27290000
273000         END-IF                                                   27300000
273100     END-IF.                                                      27310000
273200                                                                  27320000
273300     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX)                     27330000
273400                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              27340000
273500     SET LQW-DESELECT (PV-SUB) TO    TRUE                         27350000
273600     MOVE LQW-SELECTED-SW (PV-SUB)                                27360000
273700                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  27370000
273800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                27380000
273900/                                                                 27390000
274000*----------------------------------------------------------------*27400000
274100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN 6100.             *27410000
274200*----------------------------------------------------------------*27420000
274300                                                                  27430000
274400 6111-WRITE-LIST-QUEUE.                                           27440000
274500                                                                  27450000
274600     EXEC CICS                                                    27460000
274700         WRITEQ TS                                                27470000
274800             QUEUE (ASC-LIST-QUEUE-NAME)                          27480000
274900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     27490000
275000             ITEM  (PV-SAVE-ITEM)                                 27500000
275100             REWRITE                                              27510000
275200             RESP  (PV-CICS-RESP)                                 27520000
275300     END-EXEC.                                                    27530000
275400                                                                  27540000
275500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27550000
275600     OR  PV-CICS-RESP = DFHRESP (ITEMERR)                         27560000
275700         CONTINUE                                                 27570000
275800     ELSE                                                         27580000
275900         SET DP013-CICS-ABEND  TO  TRUE                           27590000
276000         SET DP013-NO-ROLLBACK TO  TRUE                           27600000
276100         MOVE '6111-WRITE-LIST-QUEUE'                             27610000
276200                               TO  DP013-PARAGRAPH                27620000
276300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  27630000
276400                               TO  DP013-MESSAGE-TEXT(1)          27640000
276500         PERFORM DP013-0000-PROCESS-ABEND                         27650000
276600     END-IF.                                                      27660000
276700                                                                  27670000
276800                                                                  27680000
276900*----------------------------------------------------------------*27690000
277000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*27700000
277100*----------------------------------------------------------------*27710000
277200                                                                  27720000
277300 6112-READ-LIST-QUEUE.                                            27730000
277400                                                                  27740000
277500     EXEC CICS                                                    27750000
277600         READQ TS                                                 27760000
277700             QUEUE (ASC-LIST-QUEUE-NAME)                          27770000
277800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     27780000
277900             ITEM  (PV-ITEM)                                      27790000
278000             RESP  (PV-CICS-RESP)                                 27800000
278100     END-EXEC.                                                    27810000
278200                                                                  27820000
278300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          27830000
278400         CONTINUE                                                 27840000
278500     ELSE                                                         27850000
278600         SET DP013-CICS-ABEND        TO TRUE                      27860000
278700         SET DP013-NO-ROLLBACK       TO TRUE                      27870000
278800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           27880000
278900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    27890000
279000                                     TO DP013-MESSAGE-TEXT(1)     27900000
279100         PERFORM DP013-0000-PROCESS-ABEND                         27910000
279200     END-IF.                                                      27920000
279300                                                                  27930000
279400/                                                                 27940000
279500/                                                                 27950000
279600******************************************************************27960000
279700* READ AN ITEM FROM THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *27970000
279800******************************************************************27980000
279900 9100-READ-SEL-QUEUE.                                             27990000
280000     EXEC CICS                                                    28000000
280100         READQ TS                                                 28010000
280200             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        28020000
280300             INTO  (TR006-DOCK-SCHEDULE-REC)                      28030000
280400             ITEM  (ASC-SEL-ITEM)                                 28040000
280500             RESP  (PV-CICS-RESP)                                 28050000
280600     END-EXEC.                                                    28060000
280700                                                                  28070000
280800     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        28080000
280900         CONTINUE                                                 28090000
281000     ELSE                                                         28100000
281100         SET DP013-LOGIC-ABEND                                    28110000
281200             DP013-NO-ROLLBACK     TO TRUE                        28120000
281300         MOVE '9100-READ-SEL-QUEUE'                               28130000
281400                                   TO DP013-PARAGRAPH             28140000
281500         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    28150000
281600                                   TO DP013-MESSAGE-TEXT (1)      28160000
281700         PERFORM DP013-0000-PROCESS-ABEND                         28170000
281800     END-IF.                                                      28180000
281900                                                                  28190000
282000/                                                                 28200000
282100******************************************************************28210000
282200* UPDATE AN ITEM IN THE INPUT SELECTED ITEMS TEMP STORAGE QUEUE. *28220000
282300******************************************************************28230000
282400 9200-REWRITE-LIST-QUEUE.                                         28240000
282500     EXEC CICS                                                    28250000
282600          WRITEQ TS                                               28260000
282700              QUEUE   (ASC-SEL-QUEUE-NAME-IN)                     28270000
282800              FROM    (TR006-DOCK-SCHEDULE-REC)                   28280000
282900              ITEM    (ASC-SEL-ITEM)                              28290000
283000              RESP    (PV-CICS-RESP)                              28300000
283100              REWRITE                                             28310000
283200     END-EXEC.                                                    28320000
283300                                                                  28330000
283400     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    28340000
283500         SET DP013-CICS-ABEND                                     28350000
283600             DP013-NO-ROLLBACK     TO TRUE                        28360000
283700         MOVE '9200-REWRITE-LIST-QUEUE'                           28370000
283800                                   TO DP013-PARAGRAPH             28380000
283900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   28390000
284000                                   TO DP013-MESSAGE-TEXT (1)      28400000
284100         PERFORM DP013-0000-PROCESS-ABEND                         28410000
284200     END-IF.                                                      28420000
284300                                                                  28430000
284400/                                                                 28440000
284500*----------------------------------------------------------------*28450000
284600*    ABEND PROCESSOR MODULE                                      *28460000
284700*----------------------------------------------------------------*28470000
284800                                                                  28480000
284900     COPY DPPD013.                                                28490000
