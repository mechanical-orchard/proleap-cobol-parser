000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT658.                                         00020000
000300 AUTHOR.        BUDDY BARNES.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   DEC, 2010.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900*  AHKUT658.   "ARCHIVE HISTORY" PROJECT. DATA OFFLOAD.          *00090000
001000*                                                                *00100000
001000*                                                                *00101000
001100*  PURPOSE:                                                      *00102000
001200*  THIS PROGRAM BEGINS THE PROCESS OF CREATING A DRIVER FILE.    *00103000
001300*  ONCE COMPLETED, THE DRIVER FILE WILL BE USED BY SUBSEQUENT    *00104000
001400*  PROGRAMS TO IDENTIFY AND EXTRACT CONTAINER DATA               *00105000
001500*  FROM SEVERAL INTERRELATED TABLES, FOR ARCHIVING.              *00106000
001600*                                                                *00107000
001700*  PROCESSING OVERVIEW:                                          *00108000
001800*  THIS PROGRAM ACCESSES TAUCNTK AND BASED ON A CONTROL CARD DATE*00109000
001900*  APPLIES SELECTION CRITERIA, CREATING AN OUTPUT FILE           *00110000
002000*  OF RECORDS CONTAINING:                                        *00120000
002100*  1) THE FULL ROW OF DATA FROM TAUCNTK                          *00130000
002200*  THESE RECORDS ARE SORTED FOR EASE                             *00140000
002300*  AND EFFICIENCY OF SUBSEQUENT PROCESSING.                      *00150000
002400*                                                                *00160000
002500*  FOR EACH CONTAINER RETURNED, THE FULL ROW OF DATA IS WRITTEN  *00170000
002600*  TO THE EXTRACT FILE TO BE USED FOR ARCHIVING AND DELETING.    *00180000
003000******************************************************************00190000
006020******************************************************************00200000
006030 ENVIRONMENT DIVISION.                                            00210000
006040 CONFIGURATION SECTION.                                           00220000
006050 SOURCE-COMPUTER.        IBM-3090.                                00230000
006060 OBJECT-COMPUTER.        IBM-3090.                                00240000
006070                                                                  00250000
006080 INPUT-OUTPUT SECTION.                                            00260000
006090 FILE-CONTROL.                                                    00270000
006100                                                                  00280000
006200     SELECT  OUT-DRIVER-FILE              ASSIGN TO OUT01.        00290000
006300                                                                  00300000
006400 DATA DIVISION.                                                   00310000
006500 FILE SECTION.                                                    00320000
006600                                                                  00330000
006700 FD  OUT-DRIVER-FILE                                              00340000
006800     RECORDING MODE IS F                                          00350000
006900     LABEL RECORDS ARE STANDARD                                   00360000
007000     BLOCK CONTAINS 0 RECORDS.                                    00370000
007100 01  OUT-DRIVER-RECORD               PIC  X(665).                 00380001
007200                                                                  00390000
007300 WORKING-STORAGE SECTION.                                         00400000
007400                                                                  00410000
007500 01  PC-PROGRAM-CONSTANTS.                                        00420000
007600     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT658'.  00430000
007700     05  PC-PGM-PROGRESS-DESC.                                    00440000
007800         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00450000
007800         10  PC-CONTINUING           PIC X(10) VALUE 'CONTINUING'.00460000
008500         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00470000
008600         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00480000
008700     05  PC-ABEND-INFO.                                           00490000
008800         10  PC-ABEND                PIC X(11) VALUE              00500000
008900                                               '** ABEND **'.     00510000
009000         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00520000
009100                                               '- PARA       : '. 00530000
009200         10  PC-ABEND-MSG-DISPLAY-PARA                            00540000
009300                                     PIC X(15) VALUE              00550000
009400                                               '  CALLED PARA: '. 00560000
009500         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00570000
009600                                               '  FOR ABEND# : '. 00580000
009700         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00590000
009800                                               '- ERROR IS   : '. 00600000
009900         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00610000
010000         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00620000
010100                                               '- ACTION     : '. 00630000
010200     05  PC-TEST-AND-SET-NULL-IND.                                00640000
010300         10  PC-NOT-NULL             PIC S9(4) COMP               00650000
010400                                               VALUE ZERO.        00660000
010500         10  PC-NULL                 PIC S9(4) COMP               00670000
010600                                               VALUE -1.          00680000
010700         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               00690000
010800                                               VALUE -2.          00700000
010900         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         00710000
011000                                                                  00720000
011100     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 010000.      00730000
011200                                                                  00740000
011300 01  PS-PROGRAM-SWITCHES.                                         00750000
011400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         00760000
011500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         00770000
011600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         00780000
012000                                                                  00790000
012100 01  PV-PROGRAM-VARIABLES.                                        00800000
012400     05  DISPLAY-CNTR-NBR            PIC  X(12) VALUE SPACES.     00810000
013600     05  PV-FUNC-QTY                  PIC S9(09) COMP.            00820000
012500     05  PV-PRG-TMST                 PIC X(26) VALUE SPACES.      00830000
012600     05  PV-PRG-TMST-DETAIL REDEFINES PV-PRG-TMST.                00840000
012700         10  PV-PRG-DATE             PIC X(10).                   00850000
012800         10  PV-PRG-TIME             PIC X(16).                   00860000
013000     05  PV-TABLE-ROW-FETCHED-CNT    PIC  9(9) VALUE 0.           00870000
013100     05  PV-DRIVER-WRITTEN-CNT       PIC  9(9) VALUE 0.           00880000
013800     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      00890000
013900     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      00900000
014000     05  PV-DB2-TABLE-NAME-1         PIC X(18) VALUE SPACES.      00910000
014100     05  PV-DB2-TABLE-NAME-2         PIC X(18) VALUE SPACES.      00920000
014200     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           00930000
014300     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           00940000
014400     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        00950000
014500                                                                  00960000
014600     05  PV-TMST                     PIC X(26) VALUE SPACES.      00970000
014700     05  PV-TIMESTAMP-DETAIL                                      00980000
014800         REDEFINES                                                00990000
014900         PV-TMST.                                                 01000000
015000         10  PV-TIMESTAMP-19.                                     01010000
015100             15  PV-TMS-DATE.                                     01020000
015200                 20  PV-TMS-YEAR.                                 01030000
015300                     25  PV-TMS-CC   PIC X(02).                   01040000
015400                     25  PV-TMS-YY   PIC X(02).                   01050000
015500                 20  FILLER          PIC X(01).                   01060000
015600                 20  PV-TMS-MONTH    PIC X(02).                   01070000
015700                 20  FILLER          PIC X(01).                   01080000
015800                 20  PV-TMS-DAY      PIC X(02).                   01090000
015900             15  FILLER              PIC X(01).                   01100000
016000             15  PV-TMS-HOUR         PIC X(02).                   01110000
016100             15  FILLER              PIC X(01).                   01120000
016200             15  PV-TMS-MINUTE       PIC X(02).                   01130000
016300             15  FILLER              PIC X(01).                   01140000
016400             15  PV-TMS-SECOND       PIC X(02).                   01150000
016500         10  FILLER                  PIC X(01).                   01160000
016600         10  PV-TMS-MSECOND          PIC X(06).                   01170000
016800                                                                  01180000
018200*---------------------------------------------------------------* 01190000
018300*  RECORD LAYOUT FOR DRIVER FILE.                               * 01200000
018400*---------------------------------------------------------------* 01210000
018500     COPY AHRD020.                                                01220000
018700                                                                  01230000
018800 01  DM-DISPLAY-MESSAGE.                                          01240000
018900     05  DM-01-10.                                                01250000
019000         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01260000
019100         10  FILLER                  PIC X(02) VALUE ': '.        01270000
019200     05  DM-11-80.                                                01280000
019300         10  FILLER                  PIC X(27) VALUE              01290000
019400                                    'BEGIN DRIVER FILE CREATION.'.01300000
019500         10  FILLER                  PIC X(01) VALUE SPACE.       01310000
019600         10  FILLER                  PIC X(42) VALUE ALL '*'.     01320000
019700     05  DM-81-120.                                               01330000
019800         10  FILLER                  PIC X(40) VALUE ALL '*'.     01340000
019900                                                                  01350000
020000 01  DP-DISPLAY-PROGRESS-MSG.                                     01360000
020100     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01370000
020200     05  FILLER                      PIC X(02) VALUE SPACE.       01380000
020300     05  DP-STATUS-DESCRIPTION       PIC X(13) VALUE SPACE.       01390000
020400     05  FILLER                      PIC X(04) VALUE ' AT '.      01400000
020500     05  DP-TIMESTAMP                PIC X(26) VALUE SPACE.       01410000
020600     05  FILLER                      PIC X(03) VALUE '.  '.       01420000
020700     05  FILLER                      PIC X(09) VALUE 'FETCHES: '. 01430000
020800     05  DP-TABLE-ROW-FETCHED-CNT    PIC ZZZ,ZZZ,ZZ9              01440000
020900                                               VALUE ZERO.        01450000
021000     05  FILLER                      PIC X(02) VALUE ', '.        01460000
021100     05  FILLER                      PIC X(09) VALUE 'WRITTEN: '. 01470000
021200     05  DP-DRIVER-WRITTEN-CNT       PIC ZZZ,ZZZ,ZZ9              01480000
021300                                               VALUE ZERO.        01490000
021400     05  FILLER                      PIC X(01) VALUE '.'.         01500000
021500                                                                  01510000
021600 01  ABEND-CODE                      PIC S9(04)                   01520000
021700                                               VALUE ZEROES.      01530000
022000*---------------------------------------------------------------* 01540000
022100*  DB2 FORMATTED MESSAGE AREA                                     01550000
022200*---------------------------------------------------------------* 01560000
022300     COPY DPWS004.                                                01570000
022400                                                                  01580000
022500*---------------------------------------------------------------* 01590000
022600*    DB2 AREA FOR TAUCNTK                                       * 01600000
022700*---------------------------------------------------------------* 01610000
022800     EXEC SQL                                                     01620000
022900          INCLUDE TAUCNTK                                         01630000
023000     END-EXEC.                                                    01640000
023100                                                                  01650000
023200*---------------------------------------------------------------* 01660000
023300*    DB2 AREA FOR SYSDUMMY                                      * 01670000
023400*---------------------------------------------------------------* 01680000
023500     EXEC SQL                                                     01690000
023600          INCLUDE SYSDUMMY                                        01700000
023700     END-EXEC.                                                    01710000
023800                                                                  01720000
033500******************************************************************01730000
033600*    TKRPRPM TABLE                                                01740000
033700******************************************************************01750000
033800     EXEC SQL                                                     01760000
033900          INCLUDE TKRPRPM                                         01770000
034000     END-EXEC.                                                    01780000
034100*                                                                 01790000
023900*---------------------------------------------------------------* 01800000
024000*    DB2 AREA FOR COMMUNICATIONS                                * 01810000
024100*---------------------------------------------------------------* 01820000
024200     EXEC SQL                                                     01830000
024300          INCLUDE SQLCA                                           01840000
024400     END-EXEC.                                                    01850000
024500                                                                  01860000
024600*---------------------------------------------------------------* 01870000
024700*    DEFINE CURSOR FOR ACCESSING TAUCNTK                        * 01880000
024800*---------------------------------------------------------------* 01890000
024900     EXEC SQL                                                     01900000
025000         DECLARE TABLE-CURSOR CURSOR FOR                          01910000
025100           SELECT                                                 01920000
025200              CONTNR_ID                                           01930000
025300             ,CONTNR_SEQ_NBR                                      01940000
025400             ,CONSLR_SCAC_ID                                      01950000
025500             ,MOM_IMPRT_TRIP_ID                                   01960000
025600             ,MOM_DPRTR_TMST                                      01970000
025700             ,MOM_POE_DELY_TMST                                   01980000
025800             ,MOM_CARR_SCAC_ID                                    01990000
025900             ,MOM_FOB_CDE                                         02000000
026000             ,MOM_IMPRT_VEH_NM                                    02010000
026100             ,MOM_TRIP_TYP_CDE                                    02020000
026200             ,MOM_DEST_POE_CDE                                    02030000
026300             ,FDR_IMPRT_TRIP_ID                                   02040000
026400             ,FDR_DPRTR_TMST                                      02050000
026500             ,FDR_POE_DELY_TMST                                   02060000
026600             ,FDR_CARR_SCAC_ID                                    02070000
026700             ,FDR_FOB_CDE                                         02080000
026800             ,FDR_IMPRT_VEH_NM                                    02090000
026900             ,FDR_TRIP_TYP_CDE                                    02100000
027000             ,FDR_DEST_POE_CDE                                    02110000
027100             ,SIZE_CDE                                            02120000
027200             ,CART_CNT                                            02130000
027300             ,CBMT_QTY                                            02140000
027400             ,WT_KGRM_QTY                                         02150000
027500             ,UNT_QTY                                             02160000
027600             ,ORGN_SHPD_FR_CDE                                    02170000
027700             ,ORGN_SHPD_TO_CDE                                    02180000
027700             ,EST_LBD_NM                                          02181000
027700             ,EST_LBD_TMST                                        02182000
027700             ,RISU_DO_RSN_CDE                                     02183000
027700             ,BKR_FRGT_RLSE_TMST                                  02184000
027700             ,DO_TO_DCONSLR_TMST                                  02185000
027700             ,DO_RCVD_TMST                                        02186000
027700             ,CONTNR_PU_TMST                                      02186100
027700             ,DAT_SRC_ENT_ID                                      02186200
027700             ,LAST_UPD_BY_USR_ID                                  02186500
027700             ,LAST_UPD_TMST                                       02186600
027700             ,AUD_FUNC_CDE                                        02186702
027700             ,AUD_TMST                                            02186802
027700             ,ACTL_POE_DELY_TMST                                  02186900
027700             ,ACTL_DEST_POE_CDE                                   02187000
027700             ,ACTL_LBD_NM                                         02187100
027700             ,ACTL_LBD_TMST                                       02187200
027700             ,DVN_TMST                                            02187300
027700             ,DCONSLR_SCAC_ID                                     02187400
027700             ,DCONSLR_RET_TMST                                    02187500
027700             ,MOM_POL_CDE                                         02187600
027700             ,FDR_POL_CDE                                         02187700
027700             ,MOM_POR_CDE                                         02187800
027700             ,FDR_POR_CDE                                         02187900
027700             ,DCONSLR_DELY_TMST                                   02188000
027900             FROM TAUCNTK                                         02188100
028100            WHERE AUD_TMST <=                                     02188203
028100                    CURRENT TIMESTAMP - :PV-FUNC-QTY DAYS         02188300
028440         ORDER BY CONTNR_ID                                       02188400
028450                 ,CONTNR_SEQ_NBR                                  02188500
028500         FOR FETCH ONLY                                           02188600
028600         WITH UR                                                  02188700
028700         OPTIMIZE FOR 1 ROW                                       02188800
028800     END-EXEC.                                                    02188900
029000                                                                  02189000
029100 PROCEDURE DIVISION.                                              02189100
029200                                                                  02189200
029300 0000-PROGRAM-MAINLINE.                                           02189300
029400                                                                  02189400
029500     PERFORM 1000-INITIALIZE.                                     02189500
029600                                                                  02189600
029700     PERFORM 2000-GET-NEXT-FROM-CURSOR                            02189700
029800         UNTIL PS-TABLE-LOOP-DONE.                                02189800
029900                                                                  02189900
030000     PERFORM 6000-EOJ-ROUTINE.                                    02190000
030100     STOP RUN.                                                    02190100
030200                                                                  02190200
030400******************************************************************02190300
030500*  INITIALIZATIONS                                               *02190400
030600******************************************************************02190500
030700 1000-INITIALIZE.                                                 02190600
030800                                                                  02190700
030900     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02190800
031000     DISPLAY DM-DISPLAY-MESSAGE.                                  02190900
031400                                                                  02191000
031500     OPEN OUTPUT OUT-DRIVER-FILE.                                 02191100
031600                                                                  02191200
328000     EXEC SQL                                                     02191300
328100         SELECT FUNC_QTY                                          02191400
328200           INTO   :PV-FUNC-QTY                                    02191500
328300           FROM   TKRPRPM                                         02191600
328400          WHERE LOC_ID           = 90                             02191700
328500            AND INTFC_SYS_CDE    = 'KHL'                          02191800
328600            AND SYS_PRC_FUNC_CDE = 'TRPGDY'                       02191900
328700            AND FUNC_PRC_STAT_CDE = 'AC'                          02192000
328800     END-EXEC.                                                    02192100
328900                                                                  02192200
329000     EVALUATE TRUE                                                02192300
329100         WHEN SQLCODE = +0                                        02192400
329200             CONTINUE                                             02192500
329300         WHEN OTHER                                               02192600
051900              MOVE '1000-INITIALIZE'                              02192700
052000                                 TO PV-PARAGRAPH-NAME             02192800
052100              MOVE 'SELECT FROM TABLE '                           02192900
052200                                 TO PV-DB2-OPERATION-MSG-1        02193000
052300              MOVE 'TKRPRPM'     TO PV-DB2-TABLE-NAME-1           02193100
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           02193200
052500              PERFORM 9999-DB2-ABEND                              02193300
329900     END-EVALUATE.                                                02193400
032000                                                                  02193500
031200     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02193600
033600     DISPLAY 'PURGE USING CURRENT TIMESTAMP - ' DP-TIMESTAMP      02193700
033600     DISPLAY 'MINUS - ' PV-FUNC-QTY ' DAYS'                       02193800
032500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02193900
032600     SET PS-TABLE-LOOP-NOT-DONE TO TRUE.                          02194000
032700     PERFORM 9100-OPEN-TABLE-CURSOR.                              02194100
033000                                                                  02194200
033100     INITIALIZE DCLTAUCNTK                                        02195000
033200                AH020-DRIVER-RECORD-LAYOUT.                       02195100
033300     PERFORM 9110-FETCH-TABLE-CURSOR.                             02195200
033400                                                                  02195300
033500     IF PS-TABLE-LOOP-DONE                                        02195400
033600        DISPLAY 'NO CONTAINERS SELECTED FROM CURSOR'              02195500
033700     END-IF.                                                      02195600
033800                                                                  02195700
033900******************************************************************02195800
034000*  FETCH NEXT FROM CURSOR & WRITE OUTPUT DRIVER FILE RECORD.     *02195900
034100******************************************************************02196000
034200 2000-GET-NEXT-FROM-CURSOR.                                       02196100
034300                                                                  02196200
034400     MOVE AUCNTK-CONTNR-ID  TO DISPLAY-CNTR-NBR.                  02196300
034410*    DISPLAY 'FETCHED CONTAINER = ' DISPLAY-CNTR-NBR.             02196400
034610                                                                  02196500
036100     PERFORM 2010-POPULATE-DRIVER-RECORD.                         02196600
036200     PERFORM 9650-WRITE-DRIVER-RECORD.                            02196700
036300     PERFORM 2100-CHECK-PGM-PROGRESS.                             02196800
036600                                                                  02196900
036700     INITIALIZE DCLTAUCNTK                                        02197000
036800                AH020-DRIVER-RECORD-LAYOUT.                       02197100
036900     PERFORM 9110-FETCH-TABLE-CURSOR.                             02197200
037000                                                                  02197300
037100******************************************************************02197400
037200*  MOVE COLUMNS FROM TABLES TO FIELDS IN DRIVER FILE RECORD.     *02197500
037300******************************************************************02197600
037400 2010-POPULATE-DRIVER-RECORD.                                     02197700
037500                                                                  02197800
037600     INITIALIZE AH020-DRIVER-RECORD-LAYOUT.                       02197900
037700                                                                  02198000
037800     MOVE AUCNTK-CONTNR-ID         TO                             02198100
                                      AH020-CONTNR-ID.                  02198200
037900     MOVE AUCNTK-CONTNR-SEQ-NBR    TO                             02198300
                                      AH020-CONTNR-SEQ-NBR.             02198400
038000     MOVE AUCNTK-CONSLR-SCAC-ID    TO                             02198500
                                      AH020-CONSLR-SCAC-ID.             02198600
038100     MOVE AUCNTK-MOM-IMPRT-TRIP-ID TO                             02198700
                                      AH020-MOM-IMPRT-TRIP-ID.          02198800
038200     MOVE AUCNTK-MOM-DPRTR-TMST    TO                             02198900
                                      AH020-MOM-DPRTR-TMST.             02199000
038300     MOVE AUCNTK-MOM-POE-DELY-TMST TO                             02199100
                                      AH020-MOM-POE-DELY-TMST.          02199200
038400     MOVE AUCNTK-MOM-CARR-SCAC-ID  TO                             02199300
                                      AH020-MOM-CARR-SCAC-ID.           02199400
038500     MOVE AUCNTK-MOM-FOB-CDE       TO                             02199500
                                      AH020-MOM-FOB-CDE.                02199600
038600     MOVE AUCNTK-MOM-IMPRT-VEH-NM  TO                             02199700
                                      AH020-MOM-IMPRT-VEH-NM.           02199800
038700     MOVE AUCNTK-MOM-TRIP-TYP-CDE  TO                             02199900
                                      AH020-MOM-TRIP-TYP-CDE.           02200000
038800     MOVE AUCNTK-MOM-DEST-POE-CDE  TO                             02200100
                                      AH020-MOM-DEST-POE-CDE.           02200200
038900     MOVE AUCNTK-FDR-IMPRT-TRIP-ID TO                             02200300
                                      AH020-FDR-IMPRT-TRIP-ID.          02200400
039000     MOVE AUCNTK-FDR-DPRTR-TMST    TO                             02200500
                                      AH020-FDR-DPRTR-TMST.             02200600
039100     MOVE AUCNTK-FDR-POE-DELY-TMST TO                             02200700
                                      AH020-FDR-POE-DELY-TMST.          02200800
039200     MOVE AUCNTK-FDR-CARR-SCAC-ID  TO                             02200900
                                      AH020-FDR-CARR-SCAC-ID.           02201000
039300     MOVE AUCNTK-FDR-FOB-CDE       TO                             02201100
                                      AH020-FDR-FOB-CDE.                02201200
039400     MOVE AUCNTK-FDR-IMPRT-VEH-NM  TO                             02201300
                                      AH020-FDR-IMPRT-VEH-NM.           02201400
039500     MOVE AUCNTK-FDR-TRIP-TYP-CDE  TO                             02201500
                                      AH020-FDR-TRIP-TYP-CDE.           02201600
039600     MOVE AUCNTK-FDR-DEST-POE-CDE  TO                             02201700
                                      AH020-FDR-DEST-POE-CDE.           02201800
039700     MOVE AUCNTK-SIZE-CDE          TO                             02201900
                                      AH020-SIZE-CDE.                   02202000
039800     MOVE AUCNTK-CART-CNT          TO                             02202100
                                      AH020-CART-CNT.                   02202200
039900     MOVE AUCNTK-CBMT-QTY          TO                             02202300
                                      AH020-CBMT-QTY.                   02202400
040000     MOVE AUCNTK-WT-KGRM-QTY       TO                             02202500
                                      AH020-WT-KGRM-QTY.                02202600
040100     MOVE AUCNTK-UNT-QTY           TO                             02202700
                                      AH020-UNT-QTY.                    02202800
040200     MOVE AUCNTK-ORGN-SHPD-FR-CDE  TO                             02202900
                                      AH020-ORGN-SHPD-FR-CDE.           02203000
040300     MOVE AUCNTK-ORGN-SHPD-TO-CDE  TO                             02203100
                                      AH020-ORGN-SHPD-TO-CDE.           02203200
040400     MOVE AUCNTK-EST-LBD-NM        TO                             02203300
                                      AH020-EST-LBD-NM.                 02203400
040500     MOVE AUCNTK-EST-LBD-TMST      TO                             02203500
                                      AH020-EST-LBD-TMST.               02203600
040500     MOVE AUCNTK-RISU-DO-RSN-CDE   TO                             02203700
                                      AH020-RISU-DO-RSN-CDE.            02203800
040500     MOVE AUCNTK-BKR-FRGT-RLSE-TMST TO                            02203900
                                      AH020-BKR-FRGT-RLSE-TMST.         02204000
040500     MOVE AUCNTK-DO-TO-DCONSLR-TMST TO                            02204100
                                      AH020-DO-TO-DCONSLR-TMST.         02204200
040500     MOVE AUCNTK-DO-RCVD-TMST       TO                            02204300
                                      AH020-DO-RCVD-TMST.               02204400
040500     MOVE AUCNTK-CONTNR-PU-TMST     TO                            02204500
                                      AH020-CONTNR-PU-TMST.             02204600
040600     MOVE AUCNTK-DAT-SRC-ENT-ID     TO                            02204700
                                      AH020-DAT-SRC-ENT-ID.             02204800
           MOVE AUCNTK-AUD-FUNC-CDE       TO                            02204901
                                      AH020-AUD-FUNC-CDE.               02205001
           MOVE AUCNTK-AUD-TMST           TO                            02205101
                                      AH020-AUD-TMST.                   02205201
           MOVE AUCNTK-LAST-UPD-BY-USR-ID TO                            02205300
                                      AH020-LAST-UPD-BY-USR-ID.         02205400
           MOVE AUCNTK-LAST-UPD-TMST      TO                            02205500
                                      AH020-LAST-UPD-TMST.              02205600
           MOVE AUCNTK-ACTL-POE-DELY-TMST TO                            02205700
                                      AH020-ACTL-POE-DELY-TMST.         02205800
           MOVE AUCNTK-ACTL-DEST-POE-CDE  TO                            02205900
                                      AH020-ACTL-DEST-POE-CDE.          02206000
           MOVE AUCNTK-ACTL-LBD-NM        TO                            02206100
                                      AH020-ACTL-LBD-NM.                02206200
           MOVE AUCNTK-ACTL-LBD-TMST      TO                            02206300
                                      AH020-ACTL-LBD-TMST.              02206400
           MOVE AUCNTK-DVN-TMST           TO                            02206500
                                      AH020-DVN-TMST.                   02206600
           MOVE AUCNTK-DCONSLR-SCAC-ID    TO                            02206700
                                      AH020-DCONSLR-SCAC-ID.            02206800
           MOVE AUCNTK-DCONSLR-RET-TMST   TO                            02206900
                                      AH020-DCONSLR-RET-TMST.           02207000
           MOVE AUCNTK-MOM-POL-CDE        TO                            02207100
                                      AH020-MOM-POL-CDE.                02207200
           MOVE AUCNTK-FDR-POL-CDE        TO                            02207300
                                      AH020-FDR-POL-CDE.                02207400
           MOVE AUCNTK-MOM-POR-CDE        TO                            02207500
                                      AH020-MOM-POR-CDE.                02207600
           MOVE AUCNTK-FDR-POR-CDE        TO                            02207700
                                      AH020-FDR-POR-CDE.                02207800
           MOVE AUCNTK-DCONSLR-DELY-TMST  TO                            02207900
                                      AH020-DCONSLR-DELY-TMST.          02208000
                                                                        02208100
040700******************************************************************02208200
040800*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02208300
040900*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02208400
041000*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02208500
041100******************************************************************02208600
041200 2100-CHECK-PGM-PROGRESS.                                         02208700
041300     DIVIDE    PV-DRIVER-WRITTEN-CNT                              02208800
041400         BY        PC-HOW-OFTEN-TO-DISPLAY                        02208900
041500         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02209000
041600         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02209100
041700                                                                  02209200
041800     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02209300
041900         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02209400
042000         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02209500
042100     END-IF.                                                      02209600
042200                                                                  02209700
046400******************************************************************02209800
046500*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *02209900
046600******************************************************************02210000
046700 6000-EOJ-ROUTINE.                                                02210100
046800                                                                  02210200
047100     CLOSE OUT-DRIVER-FILE.                                       02210300
047200                                                                  02210400
047300     PERFORM 9130-CLOSE-TABLE-CURSOR.                             02210500
047400                                                                  02210600
046900     MOVE PC-ENDING  TO  DP-STATUS-DESCRIPTION.                   02210700
047500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02210800
047600                                                                  02210900
047700     DISPLAY 'TOTAL CONTAINERS PROCESSED = '                      02211000
047700                                  PV-DRIVER-WRITTEN-CNT.          02211100
047900                                                                  02211200
048000******************************************************************02211300
048100*  DISPLAY PROGRAM PROGRESS.                                     *02211400
048200******************************************************************02211500
048300 6200-DISPLAY-PGM-PROGRESS.                                       02211600
048400                                                                  02211700
048500     EXEC SQL                                                     02211800
048600          SET :PV-TMST = CURRENT TIMESTAMP                        02211900
048700     END-EXEC.                                                    02212000
048800                                                                  02212100
048900     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                02212200
049000     MOVE PV-TMST                   TO DP-TIMESTAMP.              02212300
049100     MOVE PV-TABLE-ROW-FETCHED-CNT  TO DP-TABLE-ROW-FETCHED-CNT.  02212400
049200     MOVE PV-DRIVER-WRITTEN-CNT     TO DP-DRIVER-WRITTEN-CNT.     02212500
049300                                                                  02212600
049400     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             02212700
049600                                                                  02212800
049700******************************************************************02212900
049800*  OPEN   TABLE CURSOR                                           *02213000
049900******************************************************************02213100
050000 9100-OPEN-TABLE-CURSOR.                                          02213200
050100     EXEC SQL                                                     02213300
050200          OPEN TABLE-CURSOR                                       02213400
050300     END-EXEC.                                                    02213500
050400                                                                  02213600
050500     EVALUATE TRUE                                                02213700
050600         WHEN SQLCODE = ZERO                                      02213800
050700              CONTINUE                                            02213900
050800         WHEN SQLCODE = +100                                      02214000
050900              SET PS-TABLE-LOOP-DONE TO TRUE                      02214100
051000              MOVE '9100-OPEN-TABLE-CURSOR'                       02214200
051100                                 TO PV-PARAGRAPH-NAME             02214300
051200              MOVE 'OPEN TABLE CURSOR - NO ROWS SELECTED'         02214400
051300                                 TO PV-DB2-OPERATION-MSG-1        02214500
051400              MOVE 'TAUCNTK'     TO PV-DB2-TABLE-NAME-1           02214600
051500              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           02214700
051600              PERFORM 9999-DB2-ABEND                              02214800
051700         WHEN SQLWARN0 NOT EQUAL SPACE                            02214900
051800         WHEN SQLCODE  NOT EQUAL ZERO                             02215000
051900              MOVE '9100-OPEN-TABLE-CURSOR'                       02215100
052000                                 TO PV-PARAGRAPH-NAME             02215200
052100              MOVE 'OPEN TABLE CURSOR'                            02215300
052200                                 TO PV-DB2-OPERATION-MSG-1        02215400
052300              MOVE 'TAUCNTK'     TO PV-DB2-TABLE-NAME-1           02215500
052400              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           02215600
052500              PERFORM 9999-DB2-ABEND                              02215700
052600     END-EVALUATE.                                                02215800
052700                                                                  02215900
052900******************************************************************02216000
053000*  FETCH TABLE CURSOR                                            *02216100
053100******************************************************************02216200
053200 9110-FETCH-TABLE-CURSOR.                                         02216300
053300     EXEC SQL                                                     02216400
053400         FETCH TABLE-CURSOR                                       02216500
053500          INTO  :AUCNTK-CONTNR-ID                                 02216600
053600               ,:AUCNTK-CONTNR-SEQ-NBR                            02216700
053700               ,:AUCNTK-CONSLR-SCAC-ID                            02216800
053800               ,:AUCNTK-MOM-IMPRT-TRIP-ID                         02216900
053900               ,:AUCNTK-MOM-DPRTR-TMST                            02217000
054000               ,:AUCNTK-MOM-POE-DELY-TMST                         02217100
054100               ,:AUCNTK-MOM-CARR-SCAC-ID                          02217200
054200               ,:AUCNTK-MOM-FOB-CDE                               02217300
054300               ,:AUCNTK-MOM-IMPRT-VEH-NM                          02217400
054400               ,:AUCNTK-MOM-TRIP-TYP-CDE                          02217500
054500               ,:AUCNTK-MOM-DEST-POE-CDE                          02217600
054600               ,:AUCNTK-FDR-IMPRT-TRIP-ID                         02217700
054700               ,:AUCNTK-FDR-DPRTR-TMST                            02217800
054800               ,:AUCNTK-FDR-POE-DELY-TMST                         02217900
054900               ,:AUCNTK-FDR-CARR-SCAC-ID                          02218000
055000               ,:AUCNTK-FDR-FOB-CDE                               02218100
055100               ,:AUCNTK-FDR-IMPRT-VEH-NM                          02218200
055200               ,:AUCNTK-FDR-TRIP-TYP-CDE                          02218300
055300               ,:AUCNTK-FDR-DEST-POE-CDE                          02218400
055400               ,:AUCNTK-SIZE-CDE                                  02218500
055500               ,:AUCNTK-CART-CNT                                  02218600
055600               ,:AUCNTK-CBMT-QTY                                  02218700
055700               ,:AUCNTK-WT-KGRM-QTY                               02218800
055800               ,:AUCNTK-UNT-QTY                                   02218900
055900               ,:AUCNTK-ORGN-SHPD-FR-CDE                          02219000
056000               ,:AUCNTK-ORGN-SHPD-TO-CDE                          02219100
056100               ,:AUCNTK-EST-LBD-NM                                02219200
056200               ,:AUCNTK-EST-LBD-TMST                              02219300
055000               ,:AUCNTK-RISU-DO-RSN-CDE                           02219400
055100               ,:AUCNTK-BKR-FRGT-RLSE-TMST                        02219500
055200               ,:AUCNTK-DO-TO-DCONSLR-TMST                        02219600
055300               ,:AUCNTK-DO-RCVD-TMST                              02219700
055400               ,:AUCNTK-CONTNR-PU-TMST                            02219800
055500               ,:AUCNTK-DAT-SRC-ENT-ID                            02219900
055800               ,:AUCNTK-LAST-UPD-BY-USR-ID                        02220200
055900               ,:AUCNTK-LAST-UPD-TMST                             02220300
055600               ,:AUCNTK-AUD-FUNC-CDE                              02220401
055700               ,:AUCNTK-AUD-TMST                                  02220501
056000               ,:AUCNTK-ACTL-POE-DELY-TMST                        02220600
056100               ,:AUCNTK-ACTL-DEST-POE-CDE                         02220700
056200               ,:AUCNTK-ACTL-LBD-NM                               02220800
055300               ,:AUCNTK-ACTL-LBD-TMST                             02220900
055400               ,:AUCNTK-DVN-TMST                                  02221000
055500               ,:AUCNTK-DCONSLR-SCAC-ID                           02221100
055600               ,:AUCNTK-DCONSLR-RET-TMST                          02221200
055700               ,:AUCNTK-MOM-POL-CDE                               02221300
055800               ,:AUCNTK-FDR-POL-CDE                               02221400
055900               ,:AUCNTK-MOM-POR-CDE                               02221500
056000               ,:AUCNTK-FDR-POR-CDE                               02221600
056100               ,:AUCNTK-DCONSLR-DELY-TMST                         02221700
056300     END-EXEC.                                                    02221800
056400                                                                  02221900
056500     EVALUATE TRUE                                                02222000
056600         WHEN SQLCODE = ZERO                                      02222100
056700              ADD +1                 TO PV-TABLE-ROW-FETCHED-CNT  02222200
056800         WHEN SQLCODE = +100                                      02222300
056900              SET PS-TABLE-LOOP-DONE TO TRUE                      02222400
057000         WHEN SQLWARN0 NOT EQUAL SPACE                            02222500
057100         WHEN SQLCODE NOT EQUAL ZERO                              02222600
057200              MOVE '9110-FETCH-TABLE-CURSOR'                      02222700
057300                                 TO PV-PARAGRAPH-NAME             02222800
057400              MOVE 'FETCH TABLE CURSOR'                           02222900
057500                                 TO PV-DB2-OPERATION-MSG-1        02223000
057600              MOVE 'TAUCNTK'     TO PV-DB2-TABLE-NAME-1           02223100
057700              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           02223200
057800              PERFORM 9999-DB2-ABEND                              02223300
057900     END-EVALUATE.                                                02223400
058100                                                                  02223500
058200******************************************************************02223600
058300*  CLOSE TABLE CURSOR                                            *02223700
058400******************************************************************02223800
058500 9130-CLOSE-TABLE-CURSOR.                                         02223900
058600     EXEC SQL                                                     02224000
058700          CLOSE TABLE-CURSOR                                      02224100
058800     END-EXEC.                                                    02224200
058900                                                                  02224300
059000     EVALUATE TRUE                                                02224400
059100         WHEN SQLCODE = ZERO                                      02224500
059200              CONTINUE                                            02224600
059300         WHEN SQLWARN0 NOT EQUAL SPACE                            02224700
059400         WHEN SQLCODE NOT EQUAL ZERO                              02224800
059500              MOVE '9130-CLOSE-TABLE-CURSOR'                      02224900
059600                                 TO PV-PARAGRAPH-NAME             02225000
059700              MOVE 'CLOSE TABLE CURSOR'                           02225100
059800                                 TO PV-DB2-OPERATION-MSG-1        02225200
059900              MOVE 'TAUCNTK'     TO PV-DB2-TABLE-NAME-1           02225300
060000              MOVE SPACES        TO PV-DB2-TABLE-NAME-2           02225400
060100              PERFORM 9999-DB2-ABEND                              02225500
060200     END-EVALUATE.                                                02225600
060600                                                                  02225700
060700******************************************************************02225800
060800*  WRITE A RECORD TO THE DRIVER FILE                             *02225900
060900******************************************************************02226000
061000 9650-WRITE-DRIVER-RECORD.                                        02226100
061100     WRITE  OUT-DRIVER-RECORD  FROM  AH020-DRIVER-RECORD-LAYOUT.  02226200
061200     ADD +1 TO PV-DRIVER-WRITTEN-CNT.                             02226300
061400                                                                  02226400
061700******************************************************************02226500
061800*  DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT  *02226600
061900*  AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN             *02226700
062000*  SQL ERROR OR WARNING CODE OCCURS.                             *02226800
062100******************************************************************02226900
062200 9999-DB2-ABEND.                                                  02227000
062300     DISPLAY PC-CURRENT-PROGRAM-NAME                              02227100
062400             ' 9999-DB2-ABEND'.                                   02227200
062500     DISPLAY PC-CURRENT-PROGRAM-NAME                              02227300
062600             ' ** ABEND           **'.                            02227400
062700     DISPLAY PC-CURRENT-PROGRAM-NAME                              02227500
062800             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       02227600
062900     DISPLAY PC-CURRENT-PROGRAM-NAME                              02227700
063000             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME-1.     02227800
063100     DISPLAY PC-CURRENT-PROGRAM-NAME                              02227900
063200             ' **                 ** = ' PV-DB2-TABLE-NAME-2.     02228000
063300     DISPLAY PC-CURRENT-PROGRAM-NAME                              02228100
063400             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  02228200
063500                                                                  02228300
063600     DISPLAY PC-CURRENT-PROGRAM-NAME                              02228400
063700             ' ** SQLCODE         ** = ' SQLCODE.                 02228500
063800     MOVE SQLCODE TO PV-SQLCODE.                                  02228600
063900     DISPLAY PC-CURRENT-PROGRAM-NAME                              02228700
064000             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          02228800
064100                                                                  02228900
064200     DISPLAY PC-CURRENT-PROGRAM-NAME                              02229000
064300             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            02229100
064400                                                                  02229200
064600*----------------------------------------------------------------*02229300
064700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *02229400
064800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *02229500
064900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *02229600
065000* FORMAT.                                                        *02229700
065100*----------------------------------------------------------------*02229800
065200     COPY DPPD004.                                                02229900
065300                                                                  02230000
065400     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     02230100
065500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02230200
065700                                                                  02230300
065800*----------------------------------------------------------------*02230400
065900* CALL ABEND                                                     *02230500
066000*----------------------------------------------------------------*02230600
066100     MOVE +4013                  TO ABEND-CODE.                   02230700
066200     CALL 'ILBOABN0' USING ABEND-CODE.                            02230800
