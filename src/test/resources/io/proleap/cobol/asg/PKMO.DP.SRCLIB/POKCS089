000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    POKCS089.                                         00020000
000300 AUTHOR.        RENEE SCHMITZ.                                    00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  03/98.                                            00050000
000600 DATE-COMPILED.                                                   00060000
000800*---------------------------------------------------------------* 00070000
000900*    W089 - PURCHASE LINE QTY SUMMARY LIST                      * 00080000
001000*                                                               * 00090000
001100*    THIS PROGRAM GENERATES A LIST OF PO LINE ITEMS ASSOCIATED  * 00100000
001200*    WITH A PURCHASE ORDER.  THE ORDER QTY CAN BE COMPARED TO   * 00110000
001300*    THE ASN QTY TO THE INV QTY TO THE RECVD QTY                * 00120000
001600*---------------------------------------------------------------* 00130000
W24803* 05/02/03 - S PRABHAKAR RAO, IGSI - WR NO. 24803               * 00140094
W24803*    - IN MAP POKM089 REPLACED CLASS AND SEQUENCE NUMBER WITH   * 00150094
W24803*      MAJOR CLASS, SUB CLASS AND SKU NUMBER.                   * 00160094
W24803*    - REPLACED CLASS AND 3 DIGIT SEQUENCE NUMBER WITH          * 00170095
W24803*      SUB CLASS, MAJOR CLASS AND SKU NUMBER RESPECTIVELY       * 00180096
W24803*      FOR NI SKU CONVERSION.                                   * 00190096
W24803*    - REMOVED VARIABLE DK-DEPT-NBR.                            * 00200094
W24803*    - CHANGES ARE MADE IN 'MR-OCCURS-LAYOUT' ACCORDING TO THE  * 00210094
W24803*      MAP CHANGES.                                             * 00220094
W24803*    - ADDED LOGIC TO HANDLE DUMMY AND DELETED SKU.             * 00230099
W24803*---------------------------------------------------------------* 00240000
C98147* 11/19/14 - LINDA FRIESS          - CHG0098147                   00250099
C98147*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND INCREASED        00260099
C98147*      MAP FILLER                                                 00270099
C98147*    - ADDED AN 8-DIGIT FORMAT FOR SELECTING PO NBR IN ASN TABLES 00280099
C98147*      (PARAGRAPH 4370)                                           00290099
C98147*----------------------------------------------------------------*00300099
076319* DATE  10/27/2021                                                00301099
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00302099
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00303099
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00304099
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00305099
076312*                                                               * 00306099
076318*---------------------------------------------------------------* 00307099
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00308099
CICS  *                                                               * 00309099
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00309199
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00309299
CICS  *---------------------------------------------------------------* 00309599
001800/                                                                 00310000
001900 ENVIRONMENT DIVISION.                                            00320000
002000                                                                  00330000
002100 DATA DIVISION.                                                   00340000
002200                                                                  00350000
002300 WORKING-STORAGE SECTION.                                         00360000
002400                                                                  00370000
002500 01  DK-DB2-KEYS.                                                 00380000
002600     05  DK-PO-NBR                 PIC S9(9) COMP VALUE +0.       00390000
002900                                                                  00400000
003000 01  PC-PROGRAM-CONSTANTS.                                        00410000
003100     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00420000
003200                                                    'PO089A  '.   00430000
003300     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00440000
003400                                                    'POKM089 '.   00450000
003500     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00460000
003600                                                    'POKCS089'.   00470000
003700     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00480000
003800                                                    COMP.         00490000
003900     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00500000
004000     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00510000
004100     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00520000
004200     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +11     00530000
004300                                                    COMP SYNC.    00540000
004400     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00550000
004500                                                    COMP SYNC.    00560000
004600     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00570000
004700                                                    +1000000      00580000
004800                                                    COMP-3.       00590000
004900     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      00600000
005000                                                    COMP SYNC.    00610000
005100     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      00620000
005200                                                    COMP-3.       00630000
005300     05  PC-MAX-RETRIES-2               PIC S9(03)  VALUE +2      00640000
005400                                                    COMP-3.       00650000
006600     05  PC-TSYMSG-NUMBERS.                                       00660000
006800         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00670000
007100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00680000
007800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00690000
007900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00700000
008000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00710000
008200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00720000
008500         10  PC-TSYMSG-00461            PIC  9(05)  VALUE 00461.  00730000
008900                                                                  00740000
009000 01  PS-PROGRAM-SWITCHES.                                         00750000
009100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00760000
009200         88  PS-NO-ERROR                            VALUE 'Y'.    00770000
009300         88  PS-ERROR                               VALUE 'N'.    00780000
009400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00790000
009500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00800000
009600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00810000
009700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    00820000
009800         88  PS-DONE                                VALUE 'Y'.    00830000
009900         88  PS-NOT-DONE                            VALUE 'N'.    00840000
010300                                                                  00850000
010400 01  PV-PROGRAM-VARIABLES.                                        00860000
010500     05  PV-SUB                         PIC S9(04)  VALUE +0      00870000
010600                                                    COMP SYNC.    00880000
010700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00890000
010800                                                    COMP SYNC.    00900000
010900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00910000
011000                                                    COMP-3.       00920000
011500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      00930000
011600                                                    COMP-3.       00940000
011700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      00950000
011800                                                    COMP-3.       00960000
011900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      00970000
012000                                                    COMP-3.       00980000
012300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      00990000
012400                                                    COMP SYNC.    01000000
012500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01010000
012600                                                    COMP SYNC.    01020000
013300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01030000
013400                                                    COMP SYNC.    01040000
013500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01050000
013600                                                    COMP SYNC.    01060000
015100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01070000
015200                                                    COMP SYNC.    01080000
015500     05  PV-VER-QTY-NULL                PIC S9(04)  VALUE +0      01090000
015600                                                    COMP SYNC.    01100000
015700     05  PV-ASN-QTY-NULL                PIC S9(04)  VALUE +0      01110000
015800                                                    COMP SYNC.    01120000
016300     05  PV-PO-LNE-NBR                  PIC S9(09)  VALUE +0      01130000
016400                                                    COMP.         01140000
016500     05  PV-ASN-PO-LN-NBR               PIC S9(03)V VALUE +0      01150000
016600                                                    COMP-3.       01160000
C98147     05  PV-ASN-PO-NBR-8                PIC X(22)   VALUE SPACES. 01170099
C98147     05  PV-ASN-PO-NBR-7                PIC X(22)   VALUE SPACES. 01180099
016800     05  PV-ASN-PO-NBR-6                PIC X(22)   VALUE SPACES. 01190000
016900     05  PV-PO-NBR9                     PIC 9(10)   VALUE ZEROES. 01200000
W24803     05  PV-NULL-INDICATORS.                                      01210098
W24803         10 PV-MAJ-CL-NBR-IND           PIC S9(04)  VALUE +0      01220098
W24803                                                    COMP.         01230098
W24803         10 PV-SUB-CL-NBR-IND           PIC S9(04)  VALUE +0      01240098
W24803                                                    COMP.         01250098
W24803         10 PV-SKU-NBR-IND              PIC S9(04)  VALUE +0      01260098
W24803                                                    COMP.         01270098
W24803         10 PV-VS-NBR-IND               PIC S9(04)  VALUE +0      01280098
W24803                                                    COMP.         01290098
W24803     05  PV-TEMP-SKU.                                             01300098
W24803         10 PV-TEMP-SKU-DEPT            PIC 9(03)   VALUE 0.      01310098
W24803         10 PV-TEMP-SKU-CLASS           PIC 9(02)   VALUE 0.      01320098
W24803         10 PV-TEMP-SKU-SEQ             PIC 9(03)   VALUE 0.      01330099
W24803     05  PV-SKU-NBR REDEFINES PV-TEMP-SKU                         01340098
W24803                                        PIC 9(08).                01350098
W24803     05  PV-MAJ-CL.                                               01360098
W24803         10 PV-MAJ-CL-1                 PIC 9       VALUE 0.      01370098
W24803         10 FILLER                      PIC 9       VALUE 0.      01380098
W24803     05  PV-MAJ-CLASS REDEFINES PV-MAJ-CL                         01390098
W24803                                        PIC 9(02).                01400099
019100*---------------------------------------------------------------* 01410000
019200*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01420000
019300*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01430000
019400*   APPLICATION-SPECIFIC COMMAREA.                              * 01440000
019500*---------------------------------------------------------------* 01450000
019600 01  LQW-LIST-QUEUE-WORK-AREA.                                    01460000
019700     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  01470000
019800     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           01480000
019900                                        INDEXED BY LQW-IDX.       01490000
020000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01500000
020500         10  LQW-PO-LNE-NBR             PIC 9(03).                01510000
020600         10  LQW-APP-PO-LNE-NBR         PIC 9(03).                01520000
020700         10  LQW-PO-LNE-VAR-NBR         PIC 9(03).                01530000
W24803         10  LQW-MAJ-CL                 PIC 9(02).                01540000
W24803         10  LQW-CL-NBR                 PIC 9(02).                01550000
W24803         10  LQW-SKU-NBR                PIC 9(8).                 01560000
021100         10  LQW-VEND-STYL-NAME         PIC X(20).                01570000
021200         10  LQW-STATUS-CDE             PIC X(02).                01580000
021300         10  LQW-ORD-QTY                PIC 9(06).                01590000
021500         10  LQW-ASN-QTY                PIC 9(06).                01600000
021600         10  LQW-INV-QTY                PIC 9(06).                01610000
021700         10  LQW-REC-QTY                PIC 9(06).                01620000
022100/                                                                 01630000
022900*---------------------------------------------------------------* 01640000
023000*    MAP LAYOUT                                                 * 01650000
023100*---------------------------------------------------------------* 01660000
023300     COPY POKM089.                                                01670000
023500 01  MR-OCCURS-LAYOUT                   REDEFINES  PO089AO.       01680000
C98147     05  FILLER                         PIC X(104).               01690099
023620                                                                  01700000
025600     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          01710000
025800         10  MR-PO-LNE-NBRL                 PIC S9(04) COMP.      01720000
025900         10  MR-PO-LNE-NBRA                 PIC X(01).            01730000
026000         10  MR-PO-LNE-NBRC                 PIC X(01).            01740000
026100         10  MR-PO-LNE-NBRH                 PIC X(01).            01750000
026400         10  MR-PO-LNE-NBR-X.                                     01760000
026500             15  MR-PO-LNE-NBR              PIC ZZZ.              01770000
026510                                                                  01780000
W24803         10  MR-MAJ-CLL                     PIC S9(04) COMP.      01790000
W24803         10  MR-MAJ-CLA                     PIC X(01).            01800000
W24803         10  MR-MAJ-CLC                     PIC X(01).            01810000
W24803         10  MR-MAJ-CLH                     PIC X(01).            01820000
W24803         10  MR-MAJ-CL                      PIC X(02).            01830000
026900                                                                  01840000
027100         10  MR-CL-NBRL                     PIC S9(04) COMP.      01850000
027110         10  MR-CL-NBRA                     PIC X(01).            01860000
027120         10  MR-CL-NBRC                     PIC X(01).            01870000
027130         10  MR-CL-NBRH                     PIC X(01).            01880000
027200         10  MR-CL-NBR                      PIC X(02).            01890000
027300                                                                  01900000
W24803         10  MR-SKU-NBRL                    PIC S9(04) COMP.      01910000
W24803         10  MR-SKU-NBRA                    PIC X(01).            01920000
W24803         10  MR-SKU-NBRC                    PIC X(01).            01930000
W24803         10  MR-SKU-NBRH                    PIC X(01).            01940000
W24803         10  MR-SKU-NBR                     PIC X(08).            01950000
027700                                                                  01960000
027720         10  MR-VEND-STYL-NAMEL             PIC S9(04) COMP.      01970000
027730         10  MR-VEND-STYL-NAMEA             PIC X(01).            01980000
027740         10  MR-VEND-STYL-NAMEC             PIC X(01).            01990000
027750         10  MR-VEND-STYL-NAMEH             PIC X(01).            02000000
027900         10  MR-VEND-STYL-NAME              PIC X(20).            02010000
028000                                                                  02020000
028002         10  MR-STATUS-CDEL                 PIC S9(04) COMP.      02030000
028003         10  MR-STATUS-CDEA                 PIC X(01).            02040000
028004         10  MR-STATUS-CDEC                 PIC X(01).            02050000
028005         10  MR-STATUS-CDEH                 PIC X(01).            02060000
028050         10  MR-STATUS-CDE                  PIC X(02).            02070000
028060                                                                  02080000
028080         10  MR-ORD-QTYL                    PIC S9(04) COMP.      02090000
028090         10  MR-ORD-QTYA                    PIC X(01).            02100000
028100         10  MR-ORD-QTYC                    PIC X(01).            02110000
028200         10  MR-ORD-QTYH                    PIC X(01).            02120000
028500         10  MR-ORD-QTY-X.                                        02130000
028600             15  MR-ORD-QTY                 PIC Z(6).             02140000
028610                                                                  02150000
028612         10  MR-ASN-QTYL                    PIC S9(04) COMP.      02160000
028613         10  MR-ASN-QTYA                    PIC X(01).            02170000
028614         10  MR-ASN-QTYC                    PIC X(01).            02180000
028615         10  MR-ASN-QTYH                    PIC X(01).            02190000
028620         10  MR-ASN-QTY-X.                                        02200000
028630             15  MR-ASN-QTY                 PIC Z(6).             02210000
028640                                                                  02220000
028642         10  MR-INV-QTYL                    PIC S9(04) COMP.      02230000
028643         10  MR-INV-QTYA                    PIC X(01).            02240000
028644         10  MR-INV-QTYC                    PIC X(01).            02250000
028645         10  MR-INV-QTYH                    PIC X(01).            02260000
028900         10  MR-INV-QTY-X.                                        02270000
029000             15  MR-INV-QTY                 PIC Z(6).             02280000
029100                                                                  02290000
029120         10  MR-REC-QTYL                    PIC S9(04) COMP.      02300000
029130         10  MR-INV-QTYA                    PIC X(01).            02310000
029140         10  MR-INV-QTYC                    PIC X(01).            02320000
029150         10  MR-INV-QTYH                    PIC X(01).            02330000
029300         10  MR-REC-QTY-X.                                        02340000
029400             15  MR-REC-QTY                 PIC Z(6).             02350000
030800/                                                                 02360000
030900*---------------------------------------------------------------* 02370000
031000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02380000
031100*---------------------------------------------------------------* 02390000
031300     COPY DPWS015.                                                02400000
031500*---------------------------------------------------------------* 02410000
031600*    FUNCTION KEYS COPYBOOK.                                    * 02420000
031700*---------------------------------------------------------------* 02430000
031900     COPY DPWS016.                                                02440000
032100*---------------------------------------------------------------* 02450000
032200*    NUMERIC EDIT LAYOUT.                                       * 02460000
032300*---------------------------------------------------------------* 02470000
032500     COPY DPWS010I.                                               02480000
032700/                                                                 02490000
032800*---------------------------------------------------------------* 02500000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02510099
033000*---------------------------------------------------------------* 02520000
033200     COPY DPWS030.                                                02530000
CICS       COPY DPWS930.                                                02531099
033400/                                                                 02540000
033500*---------------------------------------------------------------* 02550000
033600*    STANDARD COMMAREA.                                         * 02560000
033700*---------------------------------------------------------------* 02570000
033900     COPY DPWS020.                                                02580000
034000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02590000
034200*---------------------------------------------------------------* 02600000
034300* INTER-APPLICATION COMMAREA.                                   * 02610000
034400*---------------------------------------------------------------* 02620000
034600         10  INTER-APPL-COMM-AREA       PIC X(200).               02630000
034700     COPY POWS013.                                                02640000
034900*---------------------------------------------------------------* 02650000
035000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02660000
035100*---------------------------------------------------------------* 02670000
035200         10  ASC-SPECIFIC-COMMAREA.                               02680000
035300             15  ASC-LIST-KEYS.                                   02690000
035400                 20  ASC-KEY-PO-NBR        PIC S9(9) COMP.        02700000
035600                 20  ASC-KEY-DEPT-NBR      PIC X(3).              02710000
035700                 20  ASC-KEY-ENT-NAME-DESC PIC X(30).             02720000
035800             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           02730000
035900                 20  ASC-BLOCK-MODIFIED-SW                        02740000
036000                                        PIC X(01).                02750000
036100                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     02760000
036200                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     02770000
036300                                                                  02780000
036400                 20  ASC-ITEM-ARRAY.                              02790000
036500                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        02800000
036600                         30  ASC-LIST-ITEM-NUMBER                 02810000
036700                                        PIC S9(09) COMP-3.        02820000
038500                         30  ASC-PO-LNE-NBR     PIC 9(03).        02830000
038600                         30  ASC-APP-PO-LNE-NBR PIC 9(03).        02840000
038700                         30  ASC-PO-LNE-VAR-NBR PIC 9(03).        02850000
W24803                         30  ASC-MAJ-CL         PIC 9(02).        02860000
W24803                         30  ASC-CL-NBR         PIC 9(02).        02870000
W24803                         30  ASC-SKU-NBR        PIC 9(08).        02880000
039100                         30  ASC-VEND-STYL-NAME PIC X(20).        02890000
039200                         30  ASC-STATUS-CDE     PIC X(02).        02900000
039300                         30  ASC-ORD-QTY        PIC 9(06).        02910000
039401                         30  ASC-ASN-QTY        PIC 9(06).        02920000
039402                         30  ASC-ASN-QTY-X    REDEFINES           02930000
039410                             ASC-ASN-QTY        PIC X(06).        02940000
039500                         30  ASC-INV-QTY        PIC 9(06).        02950000
039600                         30  ASC-INV-QTY-X    REDEFINES           02960000
039610                             ASC-INV-QTY        PIC X(06).        02970000
039700                         30  ASC-REC-QTY        PIC 9(06).        02980000
039710                         30  ASC-REC-QTY-X    REDEFINES           02990000
039720                             ASC-REC-QTY        PIC X(06).        03000000
039721                                                                  03010000
039800             15  ASC-TOT-ORD-QTY        PIC 9(07).                03020000
039900             15  ASC-TOT-ASN-QTY        PIC 9(07).                03030000
040100             15  ASC-TOT-INV-QTY        PIC 9(07).                03040000
040110             15  ASC-TOT-REC-QTY        PIC 9(07).                03050000
040200                                                                  03060000
040300             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03070000
040400             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03080000
040500             15  ASC-NUMBER-OF-ITEMS-READ                         03090000
040600                                        PIC S9(09) COMP-3.        03100000
040900             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03110000
041000             15  ASC-ITEM-AT-TOP-OF-PANEL                         03120000
041100                                        PIC S9(09) COMP-3.        03130000
041200             15  ASC-ITEM-AT-BOT-OF-PANEL                         03140000
041300                                        PIC S9(09) COMP-3.        03150000
041400             15  ASC-HIGHEST-BLOCK-WRITTEN                        03160000
041500                                        PIC S9(04) COMP SYNC.     03170000
042000             15  ASC-ITEMS-LEFT-INDICATOR                         03180000
042100                                        PIC X(01).                03190000
042200                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03200000
042300                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03210000
042301             15  ASC-LIST-QUEUE-NAME.                             03220000
042302                20  ASC-LIST-TERM-ID   PIC X(04).                 03230000
042303                20  ASC-LIST-TASK-NUMBER                          03240000
042310                                       PIC S9(05) COMP-3.         03250000
042400                20  ASC-LIST-SEQ       PIC 9(01).                 03260000
043900             15  ASC-CURSOR-SW          PIC X(01).                03270000
044100                 88  ASC-ITEM-CURSOR               VALUE 'I'.     03280000
044200                 88  ASC-APP-ITEM-CURSOR           VALUE 'A'.     03290000
044300             15  ASC-START-ITEM-REQUEST.                          03300000
044400                 20  ASC-START-ITEM-REQUEST-N                     03310000
044500                                        PIC 9(07).                03320000
W24803         10  FILLER                     PIC X(1173).              03330000
044800/                                                                 03340000
044900*---------------------------------------------------------------* 03350000
045000*    ABEND PROCESSING COPYBOOK.                                 * 03360000
045100*---------------------------------------------------------------* 03370000
045300     COPY DPWS013.                                                03380000
045500/                                                                 03390000
W24803*---------------------------------------------------------------* 03400098
W24803*    DB2 AREA FOR THE SKU TABLE                                 * 03410098
W24803*---------------------------------------------------------------* 03420098
W24803     EXEC SQL                                                     03430098
W24803          INCLUDE XLT00003                                        03440098
W24803     END-EXEC.                                                    03450098
W24803/                                                                 03460098
W24803*---------------------------------------------------------------* 03470098
W24803*    DB2 AREA FOR THE VENDOR STYLE TABLE                        * 03480098
W24803*---------------------------------------------------------------* 03490098
W24803     EXEC SQL                                                     03500098
W24803          INCLUDE XLT00004                                        03510098
W24803     END-EXEC.                                                    03520098
W24803/                                                                 03530098
045600*---------------------------------------------------------------* 03540098
045700*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 03550000
045800*---------------------------------------------------------------* 03560000
045900     EXEC SQL                                                     03570000
046000          INCLUDE TPURCHS                                         03580000
046100     END-EXEC.                                                    03590000
046210     EXEC SQL                                                     03600000
046220          INCLUDE TINVOIC                                         03610099
046230     END-EXEC.                                                    03620000
046291     EXEC SQL                                                     03630000
046292          INCLUDE TPREQIT                                         03640000
046293     END-EXEC.                                                    03650000
046300/                                                                 03660000
046400*---------------------------------------------------------------* 03670000
046500*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 03680000
046600*---------------------------------------------------------------* 03690000
046700     EXEC SQL                                                     03700000
046800          INCLUDE TPURITM                                         03710000
046900     END-EXEC.                                                    03720000
047100/                                                                 03730000
052000*---------------------------------------------------------------* 03740000
052100*    DB2 AREA FOR THE RECEIVING STORE DISTRIBUTION TABLE        * 03750000
052200*---------------------------------------------------------------* 03760000
052300     EXEC SQL                                                     03770000
052400          INCLUDE TRECDIS                                         03780000
052500     END-EXEC.                                                    03790000
052700/                                                                 03800000
052800*---------------------------------------------------------------* 03810000
052900*    DB2 AREA FOR THE ASN TASDTPL TABLE                         * 03820000
053000*---------------------------------------------------------------* 03830000
053100     EXEC SQL                                                     03840000
053200          INCLUDE TASDTPL                                         03850000
053300     END-EXEC.                                                    03860000
053500/                                                                 03870000
053600*---------------------------------------------------------------* 03880000
053700*    DB2 AREA FOR COMMUNICATIONS                                * 03890000
053800*---------------------------------------------------------------* 03900000
053900     EXEC SQL                                                     03910000
054000          INCLUDE SQLCA                                           03920000
054100     END-EXEC.                                                    03930000
054300/                                                                 03940000
054400*---------------------------------------------------------------* 03950000
054500*  CURSOR TO SELECT LINE ITEMS WHEN PO IS NOT APPROVED          * 03960000
054600*---------------------------------------------------------------* 03970000
054800     EXEC SQL                                                     03980000
054900          DECLARE ITEM-CSR CURSOR FOR                             03990000
055000          SELECT PO_LNE_NBR                                       04000000
055010                ,APP_PO_LNE_NBR                                   04010000
W24803                ,MAJ_CL_NBR                                       04020098
W24803                ,SUB_CL_NBR                                       04030098
W24803                ,SKU_NBR                                          04040098
W24803                ,VS_NBR                                           04050098
W24803                ,CL_NBR                                           04060098
W24803                ,SKU_SEQ_NBR                                      04070099
W24803                ,VEND_STYL_NAME                                   04080098
055500                ,STATUS_CDE                                       04090000
055600                ,UNT_QTY                                          04100000
055900            FROM TPURITM I                                        04110098
W24803            LEFT OUTER JOIN                                       04120098
W24803                 XLT_SKU S                                        04130098
W24803            ON   I.ITM_NBR = S.ITM_NBR                            04140098
W24803            LEFT OUTER JOIN                                       04150098
W24803                 XLT_VND_STYL V                                   04160098
W24803            ON   S.STYL_ID = V.STYL_ID                            04170098
W24803          WHERE PO_NBR         = :PURITM-PO-NBR                   04180000
056100            AND VER_STATUS_CDE = 'A'                              04190000
056200          ORDER BY                                                04200000
056300                PO_LNE_NBR                                        04210000
056400     END-EXEC.                                                    04220000
056600/                                                                 04230000
056700*---------------------------------------------------------------* 04240000
056800*  CURSOR TO SELECT LINE ITEMS WHEN PO IS APPROVED              * 04250000
056900*---------------------------------------------------------------* 04260000
057000                                                                  04270000
057100     EXEC SQL                                                     04280000
057200          DECLARE APP-ITEM-CSR CURSOR FOR                         04290000
057300          SELECT PO_LNE_NBR                                       04300000
057400                ,APP_PO_LNE_NBR                                   04310000
W24803                ,MAJ_CL_NBR                                       04320098
W24803                ,SUB_CL_NBR                                       04330098
W24803                ,SKU_NBR                                          04340098
W24803                ,VS_NBR                                           04350098
W24803                ,CL_NBR                                           04360098
W24803                ,SKU_SEQ_NBR                                      04370099
W24803                ,VEND_STYL_NAME                                   04380098
057900                ,STATUS_CDE                                       04390000
058000                ,UNT_QTY                                          04400000
058200            FROM TPURITM I                                        04410098
W24803            LEFT OUTER JOIN                                       04420098
W24803                 XLT_SKU S                                        04430098
W24803            ON   I.ITM_NBR = S.ITM_NBR                            04440098
W24803            LEFT OUTER JOIN                                       04450098
W24803                 XLT_VND_STYL V                                   04460098
W24803            ON   S.STYL_ID = V.STYL_ID                            04470098
W24803          WHERE PO_NBR         = :PURITM-PO-NBR                   04480000
058400            AND VER_STATUS_CDE = 'A'                              04490000
058500          ORDER BY                                                04500000
058600                APP_PO_LNE_NBR                                    04510000
058700     END-EXEC.                                                    04520000
058900/                                                                 04530000
059000 LINKAGE SECTION.                                                 04540000
059200 01  DFHCOMMAREA.                                                 04550000
059300     05  FILLER                         OCCURS  1 TO 4072 TIMES   04560000
059400                                        DEPENDING ON EIBCALEN.    04570000
059500         10  FILLER                     PIC X.                    04580000
059700/                                                                 04590000
059800 PROCEDURE DIVISION.                                              04600000
059900*---------------------------------------------------------------* 04610000
060000*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04620000
060100*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04630000
060200*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04640000
060300*---------------------------------------------------------------* 04650000
060400 0000-MAIN-MODULE.                                                04660000
060600     INITIALIZE DP030-CICS-API-FIELDS.                            04670000
060800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04680000
060900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04690000
061000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04700000
061200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04710000
061400     MOVE LENGTH OF PO089AI        TO DP030-MAP-LENGTH (1).       04720000
061500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04730000
061700     PERFORM 0001-CALL-CICS-ARCH-API.                             04740000
061800     PERFORM 1000-CONTROL-PROCESSING.                             04750000
062000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04760000
062100     PERFORM 0001-CALL-CICS-ARCH-API.                             04770000
062200                                                                  04780000
062300*---------------------------------------------------------------* 04790000
062400*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 04800000
062500*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 04810000
062600*---------------------------------------------------------------* 04820000
062700 0001-CALL-CICS-ARCH-API.                                         04830000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04840099
062900                                    DFHCOMMAREA                   04850099
063000                                    DP030-CICS-API-FIELDS         04860099
063100                                    DP020-STANDARD-COMMAREA       04870099
063200                                    PO089AI.                      04880099
063300                                                                  04890000
063400     IF  DP030-RC-CALL-SUCCESSFUL                                 04900000
063500         CONTINUE                                                 04910000
063600     ELSE                                                         04920000
063700         SET DP013-NO-ROLLBACK                                    04930000
063800             DP013-XCTL-DISPLAY-RESTART                           04940000
063900             DP013-CICS-ABEND      TO TRUE                        04950000
064000         MOVE '0001-CALL-CICS-ARCH-API'                           04960000
064100                                   TO DP013-PARAGRAPH             04970000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04980099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04990099
064400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05000000
064500         PERFORM DP013-0000-PROCESS-ABEND                         05010000
064600     END-IF.                                                      05020000
064700                                                                  05030000
064800*----------------------------------------------------------------*05040000
064900* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05050000
065000* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05060000
065100*                                                                *05070000
065200* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05080000
065300*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05090000
065400*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05100000
065500*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05110000
065600*----------------------------------------------------------------*05120000
065700                                                                  05130000
065800 1000-CONTROL-PROCESSING.                                         05140000
065900                                                                  05150000
066000     EVALUATE TRUE                                                05160000
066100         WHEN DP020-NEXT-ACT-INITIAL                              05170000
066200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05180000
066300             MOVE EIBTRMID              TO ASC-LIST-TERM-ID       05190000
066500             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   05200000
066800             MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           05210000
067100             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05220000
067200             IF  PS-COMMAREA-NOT-VALID                            05230000
067300                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            05240000
067500             ELSE                                                 05250000
067600                 PERFORM 4000-BUILD-INITIAL-PANEL                 05260000
067700             END-IF                                               05270000
067800                                                                  05280000
067900         WHEN DP020-NEXT-ACT-READ-MAP                             05290000
068000             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05300000
068200             PERFORM 2000-PROCESS-PANEL                           05310000
068300                                                                  05320000
068400         WHEN DP020-NEXT-ACT-RETURN                               05330000
068500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05340000
068700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05350000
068900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05360000
069000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05370000
069100                                                                  05380000
069200         WHEN OTHER                                               05390000
069300             SET DP013-LOGIC-ABEND TO TRUE                        05400000
069400             SET DP013-NO-ROLLBACK TO TRUE                        05410000
069500             MOVE '1000-CONTROL-PROCESSING'                       05420000
069600                                   TO DP013-PARAGRAPH             05430000
069700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05440000
069800                                   TO DP013-MESSAGE-TEXT(1)       05450000
069900             PERFORM DP013-0000-PROCESS-ABEND                     05460000
070000     END-EVALUATE.                                                05470000
070100                                                                  05480000
070200/                                                                 05490000
070300*----------------------------------------------------------------*05500000
070400* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *05510000
070500*----------------------------------------------------------------*05520000
070600                                                                  05530000
070700 1100-PROCESS-INTER-APPL-COMM.                                    05540000
070800                                                                  05550000
070900     SET PS-COMMAREA-VALID         TO TRUE.                       05560000
071000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05570000
071100                                                                  05580000
071200     IF  PO013-PO-NBR = ZEROES                                    05590000
071300         MOVE PC-TSYMSG-00461    TO DP020-MSG-NUMBER              05600000
071400         SET PS-ERROR                                             05610000
071500             PS-COMMAREA-NOT-VALID                                05620000
071600             DP020-NEXT-ACT-APPL-ERROR                            05630000
071700             DP020-MSG-FATAL     TO TRUE                          05640000
071800     ELSE                                                         05650000
071900         MOVE PO013-PO-NBR       TO ASC-KEY-PO-NBR                05660000
072000                                    DK-PO-NBR                     05670000
072010         MOVE PO013-DEPT-NBR     TO ASC-KEY-DEPT-NBR              05680000
072040         MOVE PO013-VENDOR-NAME  TO ASC-KEY-ENT-NAME-DESC         05690000
072100         PERFORM 1110-GET-PO-INFO                                 05700000
072200         IF  PURCHS-STATUS-CDE = 'WK' OR 'PA' OR 'RJ' OR 'RS'     05710000
072300                                      OR 'FE'                     05720000
072400             SET ASC-ITEM-CURSOR TO TRUE                          05730000
072500         ELSE                                                     05740000
072600             SET ASC-APP-ITEM-CURSOR  TO TRUE                     05750000
072800         END-IF                                                   05760000
073000     END-IF.                                                      05770000
073200/                                                                 05780000
073300*----------------------------------------------------------------*05790000
073400*    READ PURCHASE ORDER HEADER                                  *05800000
073500*----------------------------------------------------------------*05810000
073600 1110-GET-PO-INFO.                                                05820000
073700                                                                  05830000
073800     PERFORM                                                      05840000
073900         WITH TEST AFTER                                          05850000
074000         VARYING PV-RETRY-COUNTER                                 05860000
074100         FROM 1 BY 1                                              05870000
074200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05880000
074300             OR (SQLCODE = +0))                                   05890000
074400                                                                  05900000
074500         EXEC SQL                                                 05910000
074800              SELECT TOT_UNT_QTY                                  05920000
075000                    ,STATUS_CDE                                   05930000
075300                INTO :PURCHS-TOT-UNT-QTY                          05940000
075500                    ,:PURCHS-STATUS-CDE                           05950000
075600                FROM TPURCHS                                      05960000
075700               WHERE PO_NBR         = :DK-PO-NBR                  05970000
075800                 AND VER_STATUS_CDE = 'A'                         05980000
075900         END-EXEC                                                 05990000
076000                                                                  06000000
076100         EVALUATE TRUE                                            06010000
076200             WHEN SQLCODE = +0                                    06020000
077400             WHEN SQLCODE = -904                                  06030000
077500             WHEN SQLCODE = -913                                  06040000
077600                  CONTINUE                                        06050000
077700                                                                  06060000
077800             WHEN SQLWARN0 NOT = SPACES                           06070000
077900             WHEN SQLCODE < +0                                    06080000
078000             WHEN SQLCODE > +0                                    06090000
078100                  MOVE '1110-GET-PO-INFO'                         06100000
078200                                  TO DP013-PARAGRAPH              06110000
078300                  MOVE 'UNSUCCESSFUL SELECT ON PO HEADER'         06120000
078400                                  TO DP013-MESSAGE-TEXT (1)       06130000
078500                  MOVE SQLCA      TO DP013-SQLCA                  06140000
078600                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     06150000
078700                  SET DP013-DB2-ABEND                             06160000
078800                      DP013-XCTL-DISPLAY-RESTART                  06170000
078900                                  TO TRUE                         06180000
079000                  PERFORM DP013-0000-PROCESS-ABEND                06190000
079100         END-EVALUATE                                             06200000
079200     END-PERFORM.                                                 06210000
079300                                                                  06220000
079400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06230000
079500         MOVE '1110-GET-PO-INFO'  TO DP013-PARAGRAPH              06240000
079600         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         06250000
079700                                  TO DP013-MESSAGE-TEXT (1)       06260000
079800         MOVE SQLCA               TO DP013-SQLCA                  06270000
079900         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     06280000
080000         SET DP013-DB2-ABEND                                      06290000
080100             DP013-XCTL-DISPLAY-RESTART                           06300000
080200                                  TO TRUE                         06310000
080300         PERFORM DP013-0000-PROCESS-ABEND                         06320000
080400     END-IF.                                                      06330000
086500/                                                                 06340000
086600*----------------------------------------------------------------*06350000
086700* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06360000
086800* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06370000
086900* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06380000
087000* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06390000
087100* FUNCTION KEYS CAN GET THIS FAR.                                *06400000
087200*----------------------------------------------------------------*06410000
087300                                                                  06420000
087400 2000-PROCESS-PANEL.                                              06430000
087500     EVALUATE TRUE                                                06440000
087600         WHEN DP020-SRC-AID = DP016-CLEAR                         06450000
087700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06460000
087800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06470000
087900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06480000
088000                                                                  06490000
088100         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06500000
088300             PERFORM 4000-BUILD-INITIAL-PANEL                     06510000
088400                                                                  06520000
089300         WHEN OTHER                                               06530000
089400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06540000
089500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06550000
089600             IF  PS-NO-ERROR                                      06560000
089700                 SET DP030-CONTINUE-GO TO TRUE                    06570000
089800                 PERFORM 2100-CHECK-FUNCTION-KEY                  06580000
089900             ELSE                                                 06590000
090000                 SET DP030-OVERRIDE-GO TO TRUE                    06600000
090100             END-IF                                               06610000
090200     END-EVALUATE.                                                06620000
090300                                                                  06630000
093300*----------------------------------------------------------------*06640000
093400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06650000
093500* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06660000
093600* CICS ARCHITECTURE API.                                         *06670000
093700*----------------------------------------------------------------*06680000
093800 2100-CHECK-FUNCTION-KEY.                                         06690000
093900                                                                  06700000
094000     EVALUATE TRUE                                                06710000
096000                                                                  06720000
096100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06730000
096200             MOVE +1               TO PV-TOP-ITEM                 06740000
096300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06750000
096400             PERFORM 3200-RESET-ATTRIBUTES                        06760000
096500                                                                  06770000
096600         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06780000
096700             PERFORM 2110-BROWSE-BACKWARD                         06790000
096800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06800000
096900             PERFORM 3200-RESET-ATTRIBUTES                        06810000
097000                                                                  06820000
097100         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06830000
097200             PERFORM 2120-BROWSE-FORWARD                          06840000
097300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06850000
097400             PERFORM 3200-RESET-ATTRIBUTES                        06860000
097500                                                                  06870000
097600         WHEN DP020-SRC-AID = DP016-ENTER                         06880000
097700             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06890000
097800             IF  PS-ERROR                                         06900000
097900                 CONTINUE                                         06910000
098000             ELSE                                                 06920000
098100                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06930000
098200             END-IF                                               06940000
098300                                                                  06950000
098400         WHEN OTHER                                               06960000
098500             SET DP013-NO-ROLLBACK                                06970000
098600                 DP013-XCTL-DISPLAY-RESTART                       06980000
098700                 DP013-CICS-ABEND  TO TRUE                        06990000
098800             MOVE '2100-CHECK-FUNCTION-KEY'                       07000000
098900                                   TO DP013-PARAGRAPH             07010000
099000             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07020000
099100                                   TO DP013-MESSAGE-TEXT (1)      07030000
099200             PERFORM DP013-0000-PROCESS-ABEND                     07040000
099300     END-EVALUATE.                                                07050000
099400                                                                  07060000
099500/                                                                 07070000
099600*----------------------------------------------------------------*07080000
099700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07090000
099800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07100000
099900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07110000
100000*    MESSAGE.                                                    *07120000
100100*----------------------------------------------------------------*07130000
100200                                                                  07140000
100300 2110-BROWSE-BACKWARD.                                            07150000
100400                                                                  07160000
100500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07170000
100600         GIVING PV-TOP-ITEM.                                      07180000
100700                                                                  07190000
100800     IF  ((PV-TOP-ITEM < +1)                                      07200000
100900       OR (PV-TOP-ITEM = +1))                                     07210000
101000        MOVE +1                    TO PV-TOP-ITEM                 07220000
101100*        -- TOP OF LIST --                                        07230000
101200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07240000
101300         SET DP020-MSG-INFORMATIONAL TO TRUE                      07250000
101500     END-IF.                                                      07260000
101600                                                                  07270000
101700/                                                                 07280000
101800*----------------------------------------------------------------*07290000
101900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07300000
102000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07310000
102100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07320000
102200*----------------------------------------------------------------*07330000
102300                                                                  07340000
102400 2120-BROWSE-FORWARD.                                             07350000
102500                                                                  07360000
102600     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07370000
102700         GIVING PV-TOP-ITEM.                                      07380000
102800                                                                  07390000
102900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07400000
103000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            07410000
103100                                   TO PV-TOP-ITEM                 07420000
103200*        -- BOTTOM OF LIST --                                     07430000
103300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07440000
103400         SET DP020-MSG-INFORMATIONAL                              07450000
103500                                   TO TRUE                        07460000
103600     ELSE                                                         07470000
103700         COMPUTE PV-BOTTOM-ITEM =                                 07480000
103800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07490000
103900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07500000
104000*            -- BOTTOM OF LIST --                                 07510000
104100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07520000
104200             SET DP020-MSG-INFORMATIONAL                          07530000
104300                                   TO TRUE                        07540000
104400         END-IF                                                   07550000
104500     END-IF.                                                      07560000
104600                                                                  07570000
104700/                                                                 07580000
104800*----------------------------------------------------------------*07590000
104900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07600000
105000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07610000
105100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07620000
105200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07630000
105300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07640000
105400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07650000
105500*----------------------------------------------------------------*07660000
105600                                                                  07670000
105700 2130-CHECK-FOR-JUMP-BROWSE.                                      07680000
105800                                                                  07690000
105900     SET PS-NO-ERROR               TO TRUE.                       07700000
106000     IF (ASC-START-ITEM-REQUEST = SPACE)                          07710000
106100         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07720000
106300     ELSE                                                         07730000
106400         MOVE ASC-START-ITEM-REQUEST                              07740000
106500                                   TO DP010I-UNEDITED-FIELD       07750000
106600         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07760000
106700         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07770000
106800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07780000
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07791099
264230                         USING DP010I-NUMERIC-EDIT-AREA           07792099
107100                                                                  07800000
107200         IF  NOT DP010I-ERROR-DETECTED                            07810000
107300             MOVE DP010I-NUMERIC-FIELD                            07820000
107400                                   TO ASC-START-ITEM-REQUEST-N    07830000
107500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07840000
107600                 IF  ASC-START-ITEM-REQUEST-N >                   07850000
107700                                          ASC-NUMBER-OF-ITEMS-READ07860000
107800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07870000
107900                     COMPUTE PV-TOP-ITEM =                        07880000
108000                             ASC-NUMBER-OF-ITEMS-READ             07890000
108100                             - PC-ITEMS-PER-PANEL + 1             07900000
108200                     IF  PV-TOP-ITEM < +1                         07910000
108300                         MOVE +1   TO PV-TOP-ITEM                 07920000
108400                         MOVE PC-TSYMSG-00070                     07930000
108500                                   TO DP020-MSG-NUMBER            07940000
108600                         SET DP020-MSG-INFORMATIONAL TO TRUE      07950000
108800                     END-IF                                       07960000
108900                 ELSE                                             07970000
109000                     MOVE ASC-START-ITEM-REQUEST-N                07980000
109100                                   TO PV-TOP-ITEM                 07990000
109200                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08000000
109300                     COMPUTE PV-BOTTOM-ITEM =                     08010000
109400                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08020000
109500                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08030000
109600*                        -- BOTTOM OF LIST --                     08040000
109700                         MOVE PC-TSYMSG-00070                     08050000
109800                                   TO DP020-MSG-NUMBER            08060000
109900                         SET DP020-MSG-INFORMATIONAL TO TRUE      08070000
110100                     END-IF                                       08080000
110200                 END-IF                                           08090000
110300             ELSE                                                 08100000
110400*                --- VALUE OUT OF RANGE ----                      08110000
110500                 MOVE PC-TSYMSG-00101                             08120000
110600                                   TO DP020-MSG-NUMBER            08130000
110700                 MOVE -1           TO ASTRTITL                    08140000
110800                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              08150000
111000                 MOVE DP015-REVERSE                               08160000
111100                                   TO ASTRTITH                    08170000
111200                 MOVE DP015-RED    TO ASTRTITC                    08180000
111300                 MOVE DP015-UNP-NUM-BRT-MDT                       08190000
111400                                   TO ASTRTITA                    08200000
111500                 SET DP020-MSG-FATAL TO TRUE                      08210000
111700                 SET PS-ERROR      TO TRUE                        08220000
111800             END-IF                                               08230000
111900                                                                  08240000
112000         ELSE                                                     08250000
112100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08260000
112200             MOVE -1               TO ASTRTITL                    08270000
112300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08280000
112400             MOVE DP015-REVERSE    TO ASTRTITH                    08290000
112500             MOVE DP015-RED        TO ASTRTITC                    08300000
112600             MOVE DP015-UNP-NUM-BRT-MDT                           08310000
112700                                   TO ASTRTITA                    08320000
112800             SET DP020-MSG-FATAL   TO TRUE                        08330000
112900             SET PS-ERROR          TO TRUE                        08340000
113000         END-IF                                                   08350000
113100     END-IF.                                                      08360000
113200                                                                  08370000
134400*----------------------------------------------------------------*08380000
134500*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *08390000
134600*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *08400000
134700*----------------------------------------------------------------*08410000
134800 2200-MOVE-SCREEN-TO-COMMAREA.                                    08420000
134900                                                                  08430000
135000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             08440000
135100     MOVE +1                       TO PV-SUB.                     08450000
135200                                                                  08460000
135300     PERFORM 3100-SET-SUBSCRIPTS.                                 08470000
135400                                                                  08480000
135500     IF  ASTRTITL > ZERO                                          08490000
135600         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      08500000
135700     ELSE                                                         08510000
135800         IF  ASTRTITF = DP015-ERASE-EOF                           08520000
135900             INITIALIZE ASC-START-ITEM-REQUEST                    08530000
136000         END-IF                                                   08540000
136100     END-IF.                                                      08550000
136200                                                                  08560000
139500*----------------------------------------------------------------*08570000
139600*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *08580000
139700*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *08590000
139800*----------------------------------------------------------------*08600000
139900 3000-EDIT-DATA-IN-COMMAREA.                                      08610000
140000                                                                  08620000
140100     SET PS-NO-ERROR               TO TRUE.                       08630000
140200                                                                  08640000
140300     PERFORM 3200-RESET-ATTRIBUTES.                               08650000
140400                                                                  08660000
140500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     08670000
140600**                                                                08680000
140700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              08690000
140800* EDITTING IS DONE FROM THE BOTTOM UP.                            08700000
140900**                                                                08710000
141000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       08720000
141100         ASC-ITEMS-DISPLAYED - 1.                                 08730000
141200                                                                  08740000
141300     PERFORM 3100-SET-SUBSCRIPTS.                                 08750000
141800                                                                  08760000
142900/                                                                 08770000
143000*----------------------------------------------------------------*08780000
143100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *08790000
143200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*08800000
143300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *08810000
143400*                                                                *08820000
143500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *08830000
143600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *08840000
143700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *08850000
143800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *08860000
143900*----------------------------------------------------------------*08870000
144000                                                                  08880000
144100 3100-SET-SUBSCRIPTS.                                             08890000
144200                                                                  08900000
144300     COMPUTE ASC-ITEM-SUB =                                       08910000
144400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        08920000
144500                                                                  08930000
144600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         08940000
144700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            08950000
144800                                                                  08960000
144900         MOVE PC-MAX-BLOCKS-IN-ARRAY                              08970000
145000                                   TO ASC-BLK-SUB                 08980000
145100     ELSE                                                         08990000
145200         MOVE +1                   TO ASC-BLK-SUB                 09000000
145300     END-IF.                                                      09010000
145400                                                                  09020000
145500*----------------------------------------------------------------*09030000
145600*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *09040000
145700*----------------------------------------------------------------*09050000
145800                                                                  09060000
145900 3200-RESET-ATTRIBUTES.                                           09070000
146000                                                                  09080000
146100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   09090000
146200     MOVE DP015-GREEN              TO ASTRTITC.                   09100000
146300     MOVE DP015-UNDERLINE          TO ASTRTITH.                   09110000
148800/                                                                 09120000
179000*----------------------------------------------------------------*09130000
179100*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *09140000
179200*    INITIALIZE ALL COUNTERS AND FLAGS.                          *09150000
179300*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *09160000
179400*    DISPLAY THE PANEL TO USER.                                  *09170000
179500*----------------------------------------------------------------*09180000
179600                                                                  09190000
179700 4000-BUILD-INITIAL-PANEL.                                        09200000
179800                                                                  09210000
179810     MOVE 0 TO ASC-TOT-INV-QTY ASC-TOT-ASN-QTY ASC-TOT-REC-QTY    09220000
179820               ASC-TOT-ORD-QTY.                                   09230000
179900     INITIALIZE ASC-BLOCK-ENTRIES (1)                             09240000
180000                ASC-BLOCK-ENTRIES (2).                            09250000
180200     MOVE +1                       TO ASC-BLK-SUB.                09260000
180400     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       09270000
180600     MOVE +0                       TO ASC-ITEM-SUB                09280000
180700                                      ASC-NUMBER-OF-ITEMS-READ    09290000
180900                                      ASC-HIGHEST-BLOCK-WRITTEN   09300000
181200                                      ASC-ITEM-AT-TOP-OF-PANEL.   09310000
181410     MOVE ASC-KEY-PO-NBR           TO DK-PO-NBR.                  09320000
181600     MOVE ZEROES                   TO PV-PO-LNE-NBR.              09330000
181700                                                                  09340000
181800     PERFORM 4010-OPEN-CURSOR.                                    09350000
181900                                                                  09360000
182000     PERFORM 4300-READ-ITEMS-FROM-DB.                             09370000
182100                                                                  09380000
182200     PERFORM 4020-CLOSE-CURSOR.                                   09390000
182300                                                                  09400000
182400     MOVE +1                       TO PV-TOP-ITEM.                09410000
182500                                                                  09420000
182600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          09430000
182700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    09440000
182900         SET DP020-MSG-FATAL       TO TRUE                        09450000
183000         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            09460000
183100     ELSE                                                         09470000
183300         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      09480000
183500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     09490000
183600     END-IF.                                                      09500000
183700                                                                  09510000
183800/                                                                 09520000
183900*----------------------------------------------------------------*09530000
184000* OPEN THE PO LINE ITEM CURSOR                                   *09540000
184100*----------------------------------------------------------------*09550000
184200                                                                  09560000
184300 4010-OPEN-CURSOR.                                                09570000
184400                                                                  09580000
W24803         INITIALIZE DCLTPURITM                                    09590000
W24803         MOVE DK-PO-NBR TO PURITM-PO-NBR                          09600000
184500     PERFORM                                                      09610000
184600         WITH TEST AFTER                                          09620000
184700         VARYING PV-RETRY-COUNTER                                 09630000
184800         FROM 1 BY 1                                              09640000
184900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09650000
185000            OR (SQLCODE = +0))                                    09660000
185100                                                                  09670000
185200         EVALUATE TRUE                                            09680000
185300                                                                  09690000
185400             WHEN ASC-ITEM-CURSOR                                 09700000
185500                  EXEC SQL                                        09710000
185600                      OPEN ITEM-CSR                               09720000
185700                  END-EXEC                                        09730000
185800                                                                  09740000
185900             WHEN ASC-APP-ITEM-CURSOR                             09750000
186000                  EXEC SQL                                        09760000
186100                      OPEN APP-ITEM-CSR                           09770000
186200                  END-EXEC                                        09780000
186300                                                                  09790000
186400         END-EVALUATE                                             09800000
186500                                                                  09810000
186600         EVALUATE TRUE                                            09820000
186700             WHEN SQLCODE = +0                                    09830000
186800                  CONTINUE                                        09840000
186900             WHEN SQLCODE = -904                                  09850000
187000             WHEN SQLCODE = -913                                  09860000
187100                  CONTINUE                                        09870000
187200             WHEN SQLWARN0 NOT = SPACE                            09880000
187300             WHEN SQLCODE  NOT = +0                               09890000
187400                  MOVE '4010-OPEN-CURSOR'                         09900000
187500                                   TO DP013-PARAGRAPH             09910000
187600                  MOVE 'OPEN APP/ITEM-CSR CURSOR'                 09920000
187700                                   TO DP013-MESSAGE-TEXT (1)      09930000
187800                  MOVE SQLCA       TO DP013-SQLCA                 09940000
187900                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)    09950000
188000                  SET DP013-DB2-ABEND                             09960000
188100                                   TO TRUE                        09970000
188200                  PERFORM DP013-0000-PROCESS-ABEND                09980000
188300         END-EVALUATE                                             09990000
188400     END-PERFORM.                                                 10000000
188500                                                                  10010000
188600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10020000
188700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             10030000
188800         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              10040000
188900                                   TO DP013-MESSAGE-TEXT (1)      10050000
189000         MOVE SQLCA                TO DP013-SQLCA                 10060000
189100         SET DP013-DB2-ABEND       TO TRUE                        10070000
189200         PERFORM DP013-0000-PROCESS-ABEND                         10080000
189300     END-IF.                                                      10090000
189400                                                                  10100000
189500/                                                                 10110000
189600*----------------------------------------------------------------*10120000
189700* CLOSE THE PO LINE ITEM CURSOR                                  *10130000
189800*----------------------------------------------------------------*10140000
189900                                                                  10150000
190000 4020-CLOSE-CURSOR.                                               10160000
190100                                                                  10170000
190200     EVALUATE TRUE                                                10180000
190300                                                                  10190000
190400         WHEN ASC-ITEM-CURSOR                                     10200000
190500              EXEC SQL                                            10210000
190600                  CLOSE ITEM-CSR                                  10220000
190700              END-EXEC                                            10230000
190800                                                                  10240000
190900         WHEN ASC-APP-ITEM-CURSOR                                 10250000
191000              EXEC SQL                                            10260000
191100                  CLOSE APP-ITEM-CSR                              10270000
191200              END-EXEC                                            10280000
191300                                                                  10290000
191400     END-EVALUATE.                                                10300000
191500                                                                  10310000
191600     EVALUATE TRUE                                                10320000
191700         WHEN SQLCODE = +0                                        10330000
191800              CONTINUE                                            10340000
191900                                                                  10350000
192000         WHEN SQLWARN0 NOT = SPACE                                10360000
192100         WHEN SQLCODE  NOT = +0                                   10370000
192200              MOVE '4020-CLOSE-CURSOR'                            10380000
192300                                   TO DP013-PARAGRAPH             10390000
192400              MOVE 'CLOSE APP/ITEM-CSR CURSOR'                    10400000
192500                                   TO DP013-MESSAGE-TEXT (1)      10410000
192600              MOVE SQLCA           TO DP013-SQLCA                 10420000
192700              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    10430000
192800              SET DP013-DB2-ABEND  TO TRUE                        10440000
192900              PERFORM DP013-0000-PROCESS-ABEND                    10450000
193000     END-EVALUATE.                                                10460000
193100                                                                  10470000
194400*----------------------------------------------------------------*10480000
194500*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *10490000
194600*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *10500000
194700*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *10510000
194800*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *10520000
194900*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *10530000
195000*                                                                *10540000
195100*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *10550000
195200*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *10560000
195300*    UPON INITIALIZATION.                                        *10570000
195400*----------------------------------------------------------------*10580000
195500                                                                  10590000
195600 4300-READ-ITEMS-FROM-DB.                                         10600000
195700                                                                  10610000
195800     PERFORM                                                      10620000
195900         VARYING PV-READ-COUNT                                    10630000
196000         FROM 1 BY 1                                              10640000
196100         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    10650000
196200            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         10660000
196300                                                                  10670000
196400         PERFORM 4310-FETCH                                       10680000
196500                                                                  10690000
196600         IF  ASC-ITEMS-LEFT-ON-DB                                 10700000
196700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                10710000
196800                 ADD +1            TO ASC-ITEM-SUB                10720000
196900             ELSE                                                 10730000
197000                 ADD +1            TO ASC-BLK-SUB                 10740000
197100                 MOVE +1           TO ASC-ITEM-SUB                10750000
197200                                                                  10760000
197300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         10770000
197400                     MOVE +1       TO ASC-BLK-SUB                 10780000
197500                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           10790000
197700                     PERFORM 5100-WRITE-TEMP-STORAGE              10800000
197800                     MOVE ASC-BLOCK-ENTRIES                       10810000
197900                               (PC-MAX-BLOCKS-IN-ARRAY)           10820000
198000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 10830000
198100                     ADD +1        TO ASC-BLK-SUB                 10840000
198200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   10850000
198300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      10860000
198400                                   TO TRUE                        10870000
198500                 END-IF                                           10880000
198600             END-IF                                               10890000
198700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    10900000
198800             MOVE ASC-NUMBER-OF-ITEMS-READ                        10910000
198900                                   TO ASC-LIST-ITEM-NUMBER        10920000
199000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10930000
199100             IF  ASC-ITEM-CURSOR                                  10940000
199200                 ADD +1            TO PV-PO-LNE-NBR               10950000
199300                 MOVE PV-PO-LNE-NBR                               10960000
199400                                   TO ASC-PO-LNE-VAR-NBR          10970000
199500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  10980000
199600                 MOVE ZEROES       TO ASC-APP-PO-LNE-NBR          10990000
199700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11000000
199710                 MOVE ZEROES       TO ASC-INV-QTY                 11010000
199720                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11020000
199800             ELSE                                                 11030000
199900                 MOVE ZEROES       TO ASC-PO-LNE-VAR-NBR          11040000
200000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11050000
200100                 MOVE PURITM-APP-PO-LNE-NBR                       11060000
200200                                   TO ASC-APP-PO-LNE-NBR          11070000
200300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11080000
200310                 PERFORM 4380-GET-INVOICE-QTY-APP                 11090000
200400             END-IF                                               11100000
200500             MOVE PURITM-PO-LNE-NBR                               11110000
200600                                   TO ASC-PO-LNE-NBR              11120000
200700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11130000
W24803             IF PV-SKU-NBR-IND = 0                                11140098
W24803               MOVE XLT00004-MAJ-CL-NBR                           11150098
W24803                                   TO ASC-MAJ-CL                  11160098
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11170098
W24803               MOVE XLT00004-SUB-CL-NBR                           11180098
W24803                                   TO ASC-CL-NBR                  11190098
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11200098
W24803               MOVE XLT00003-SKU-NBR                              11210098
W24803                                   TO ASC-SKU-NBR                 11220098
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11230098
W24803               MOVE XLT00004-VS-NBR                               11240098
W24803                                   TO ASC-VEND-STYL-NAME          11250098
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11260098
W24803             ELSE                                                 11270098
W24803               MOVE ASC-KEY-DEPT-NBR                              11280098
W24803                                   TO PV-TEMP-SKU-DEPT            11290098
W24803               MOVE PURITM-CL-NBR  TO ASC-CL-NBR                  11300098
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11310098
W24803                                      PV-TEMP-SKU-CLASS           11320098
W24803               MOVE PURITM-SKU-SEQ-NBR                            11330099
W24803                                   TO PV-TEMP-SKU-SEQ             11340099
W24803               MOVE PV-SKU-NBR     TO ASC-SKU-NBR                 11350099
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11360099
W24803               MOVE PURITM-CL-NBR (1:1)                           11370099
W24803                                   TO PV-MAJ-CL-1                 11380099
W24803               MOVE PV-MAJ-CLASS   TO ASC-MAJ-CL                  11390099
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11400099
W24803               MOVE PURITM-VEND-STYL-NAME                         11410098
W24803                                   TO ASC-VEND-STYL-NAME          11420098
W24803                                     (ASC-BLK-SUB ASC-ITEM-SUB)   11430098
W24803             END-IF                                               11440098
201800             MOVE PURITM-STATUS-CDE                               11450000
201900                                   TO ASC-STATUS-CDE              11460000
202000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11470000
202300             MOVE PURITM-UNT-QTY   TO ASC-ORD-QTY                 11480000
202400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  11490000
202500             ADD PURITM-UNT-QTY TO ASC-TOT-ORD-QTY                11500000
208600             PERFORM 4360-GET-RCVG-INFO                           11510000
208700             PERFORM 4370-GET-ASN-INFO                            11520000
208810         END-IF                                                   11530000
208900     END-PERFORM.                                                 11540000
209000                                                                  11550000
209100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          11560000
209200         MOVE +1                   TO ASC-BLK-SUB                 11570000
209300         PERFORM 5100-WRITE-TEMP-STORAGE                          11580000
209400         ADD +1                    TO ASC-BLK-SUB                 11590000
209500         PERFORM 5100-WRITE-TEMP-STORAGE                          11600000
209600                                                                  11610000
209700         MOVE 1                    TO ASC-BLK-SUB                 11620000
209800                                      PV-BLOCK-NUMBER             11630000
209900         PERFORM 4410-READ-TEMP-STORAGE                           11640000
210000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             11650000
210100             MOVE 2                TO ASC-BLK-SUB                 11660000
210200                                      PV-BLOCK-NUMBER             11670000
210300             PERFORM 4410-READ-TEMP-STORAGE                       11680000
210400         END-IF                                                   11690000
210500     END-IF.                                                      11700000
210700/                                                                 11710000
210800*----------------------------------------------------------------*11720000
210900*    FETCH A LINE ITEM                                           *11730000
211000*----------------------------------------------------------------*11740000
211200 4310-FETCH.                                                      11750000
W24803     INITIALIZE PV-NULL-INDICATORS.                               11760098
211400     EVALUATE TRUE                                                11770000
211600         WHEN ASC-ITEM-CURSOR                                     11780000
211700              EXEC SQL                                            11790000
211800                  FETCH ITEM-CSR                                  11800000
211900                  INTO :PURITM-PO-LNE-NBR                         11810000
211910                      ,:PURITM-APP-PO-LNE-NBR                     11820000
W24803                      ,:XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND     11830098
W24803                      ,:XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND     11840098
W24803                      ,:XLT00003-SKU-NBR:PV-SKU-NBR-IND           11850098
W24803                      ,:XLT00004-VS-NBR:PV-VS-NBR-IND             11860098
W24803                      ,:PURITM-CL-NBR                             11870098
W24803                      ,:PURITM-SKU-SEQ-NBR                        11880099
W24803                      ,:PURITM-VEND-STYL-NAME                     11890098
212400                      ,:PURITM-STATUS-CDE                         11900000
212500                      ,:PURITM-UNT-QTY                            11910000
212700               END-EXEC                                           11920000
212800                                                                  11930000
212900         WHEN ASC-APP-ITEM-CURSOR                                 11940000
213000              EXEC SQL                                            11950000
213100                  FETCH APP-ITEM-CSR                              11960000
213200                  INTO :PURITM-PO-LNE-NBR                         11970000
213300                      ,:PURITM-APP-PO-LNE-NBR                     11980000
W24803                      ,:XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND     11990098
W24803                      ,:XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND     12000098
W24803                      ,:XLT00003-SKU-NBR:PV-SKU-NBR-IND           12010098
W24803                      ,:XLT00004-VS-NBR:PV-VS-NBR-IND             12020098
W24803                      ,:PURITM-CL-NBR                             12030098
W24803                      ,:PURITM-SKU-SEQ-NBR                        12040099
W24803                      ,:PURITM-VEND-STYL-NAME                     12050098
213800                      ,:PURITM-STATUS-CDE                         12060000
213900                      ,:PURITM-UNT-QTY                            12070000
214100               END-EXEC                                           12080000
214300     END-EVALUATE                                                 12090000
214400                                                                  12100000
214500     EVALUATE TRUE                                                12110000
214600         WHEN SQLCODE = +0                                        12120000
214700              CONTINUE                                            12130000
214800         WHEN SQLCODE = +100                                      12140000
214900              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                 12150000
215100         WHEN SQLWARN0 NOT = SPACE                                12160000
215200         WHEN SQLCODE < +0                                        12170000
215300         WHEN SQLCODE > +0                                        12180000
215400              MOVE '4310-FETCH-CURSOR'                            12190000
215500                                   TO DP013-PARAGRAPH             12200000
215600              MOVE 'FETCH APP/ITEM CURSOR'                        12210000
215700                                   TO DP013-MESSAGE-TEXT (1)      12220000
215800              MOVE SQLCA           TO DP013-SQLCA                 12230000
215900              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    12240000
216000              SET DP013-DB2-ABEND  TO TRUE                        12250000
216100              PERFORM DP013-0000-PROCESS-ABEND                    12260000
216200     END-EVALUATE.                                                12270000
216300                                                                  12280000
216400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        12290000
216500         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             12300000
216600         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             12310000
216700                                   TO DP013-MESSAGE-TEXT (1)      12320000
216800         MOVE SQLCA                TO DP013-SQLCA                 12330000
216900         SET DP013-DB2-ABEND                                      12340000
217000             DP013-XCTL-DISPLAY-RESTART                           12350000
217100                                   TO TRUE                        12360000
217200         PERFORM DP013-0000-PROCESS-ABEND                         12370000
217300     END-IF.                                                      12380000
217400/                                                                 12390000
229600*----------------------------------------------------------------*12400000
229700 4360-GET-RCVG-INFO.                                              12410000
229800                                                                  12420000
229900     EXEC SQL                                                     12430000
230000         SELECT SUM(AP_VERIFY_ITM_QTY)                            12440000
230100          INTO :RECDIS-AP-VERIFY-ITM-QTY:PV-VER-QTY-NULL          12450000
230200          FROM TRECDIS                                            12460000
230300          WHERE ORD_NBR = :ASC-KEY-PO-NBR                         12470000
230400           AND  ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR              12480000
230500           AND  VER_STATUS_CDE = 'A'                              12490000
230600     END-EXEC.                                                    12500000
230700                                                                  12510000
230800     EVALUATE TRUE                                                12520000
230900         WHEN SQLCODE = +0                                        12530000
231000             IF PV-VER-QTY-NULL < ZERO                            12540000
231100                MOVE ZEROES           TO                          12550000
231200                         ASC-REC-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)  12560000
231300             ELSE                                                 12570000
231400                MOVE RECDIS-AP-VERIFY-ITM-QTY TO                  12580000
231500                         ASC-REC-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)  12590000
231600                ADD RECDIS-AP-VERIFY-ITM-QTY TO ASC-TOT-REC-QTY   12600000
231700             END-IF                                               12610000
231800                                                                  12620000
231810         WHEN SQLCODE = -913 OR -904                              12630000
231820           MOVE '??????' TO ASC-REC-QTY-X                         12640000
231830                                (ASC-BLK-SUB ASC-ITEM-SUB)        12650000
231900         WHEN SQLWARN0 NOT = SPACES                               12660000
232000         WHEN SQLCODE < +0                                        12670000
232100         WHEN SQLCODE > +0                                        12680000
232200             MOVE '4360-GET-RCVG-INFO'                            12690000
232300                               TO DP013-PARAGRAPH                 12700000
232400             MOVE 'SELECT VERIFIED QTY     '                      12710000
232500                               TO DP013-MESSAGE-TEXT (1)          12720000
232600             MOVE SQLCA        TO DP013-SQLCA                     12730000
232700             MOVE 'TRECDIS'    TO DP013-DB2-TABLE-NAME (1)        12740000
232800             SET DP013-DB2-ABEND                                  12750000
232900                 DP013-XCTL-DISPLAY-RESTART                       12760000
233000                               TO TRUE                            12770000
233100             PERFORM DP013-0000-PROCESS-ABEND                     12780000
233200     END-EVALUATE.                                                12790000
233300                                                                  12800000
233400/                                                                 12810000
233500*----------------------------------------------------------------*12820000
233600 4370-GET-ASN-INFO.                                               12830000
233800     MOVE ZEROES          TO PV-PO-NBR9.                          12840000
C98147     MOVE SPACES          TO PV-ASN-PO-NBR-6                      12850099
C98147                             PV-ASN-PO-NBR-7                      12860099
C98147                             PV-ASN-PO-NBR-8.                     12870099
234100     MOVE PURITM-APP-PO-LNE-NBR TO PV-ASN-PO-LN-NBR.              12880000
234200     MOVE ASC-KEY-PO-NBR TO PV-PO-NBR9.                           12890000
234300                                                                  12900000
C98147*  CREATE ALL POSSIBLE FORMATS OF PO NBR FOR READING ASN TABLES.  12910099
C98147*  PO NBR IS 22 CHARACTERS LEFT-JUSTIFIED IN TABLES.              12920099
C98147                                                                  12930099
C98147*    -- CHECK FOR 7-DIGIT OR 6-DIGIT PO                           12940099
C98147     IF PV-PO-NBR9(3:1) = 0                                       12950099
234400        IF PV-PO-NBR9(4:1) = 0                                    12960099
                                                                        12970099
C98147*          -- CREATE 6-DIGIT PO FORMATS AS A 22 CHAR FIELD:       12980099
C98147*             123456                                              12990099
C98147*             0123456                                             13000099
C98147*             00123456                                            13010099
234700           MOVE PV-PO-NBR9(5:6) TO PV-ASN-PO-NBR-6                13020099
234600           MOVE PV-PO-NBR9(4:7) TO PV-ASN-PO-NBR-7                13030099
C98147           MOVE PV-PO-NBR9(3:8) TO PV-ASN-PO-NBR-8                13040099
C98147        ELSE                                                      13050099
C98147*          -- CREATE 7-DIGIT PO FORMATS AS A 22 CHAR FIELD:       13060099
C98147*             1234567                                             13070099
C98147*             01234567                                            13080099
C98147           MOVE PV-PO-NBR9(4:7) TO PV-ASN-PO-NBR-6                13090099
C98147           MOVE PV-PO-NBR9(3:8) TO PV-ASN-PO-NBR-7                13100099
C98147                                   PV-ASN-PO-NBR-8                13110099
C98147        END-IF                                                    13120099
                                                                        13130099
234900     ELSE                                                         13140000
C98147*       -- CREATE 8-DIGIT PO FORMAT AS A 22 CHAR FIELD:           13150099
C98147*          12345678                                               13160099
C98147        MOVE PV-PO-NBR9(3:8) TO PV-ASN-PO-NBR-6                   13170099
C98147                                PV-ASN-PO-NBR-7                   13180099
C98147                                PV-ASN-PO-NBR-8                   13190099
235200     END-IF.                                                      13200000
235400                                                                  13210000
235401     PERFORM                                                      13220000
235402       WITH TEST AFTER                                            13230000
235403       VARYING PV-RETRY-COUNTER                                   13240000
235404       FROM 1 BY 1                                                13250000
235405       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES-2)               13260000
235406           OR (SQLCODE = +0) OR SQLCODE = +100)                   13270000
235407                                                                  13280000
235408       EXEC SQL                                                   13290000
235409           SELECT SUM(ASSOC_QTY)                                  13300000
235410            INTO :ASDTPL-ASSOC-QTY:PV-ASN-QTY-NULL                13310000
235411            FROM TASDTPL                                          13320000
C98147            WHERE PO_NBR IN                                       13330099
C98147             (:PV-ASN-PO-NBR-6,:PV-ASN-PO-NBR-7,:PV-ASN-PO-NBR-8) 13340099
235413            AND   PO_LN_NBR = :PV-ASN-PO-LN-NBR                   13350000
235414       END-EXEC                                                   13360000
235415                                                                  13370000
235416       EVALUATE TRUE                                              13380000
235417         WHEN SQLCODE = +100                                      13390000
235418             MOVE ZEROES           TO                             13400000
235419                   ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)         13410000
235420         WHEN SQLCODE = +0                                        13420000
235421           IF PV-ASN-QTY-NULL < ZERO                              13430000
235422             MOVE ZEROES           TO                             13440000
235423                   ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)         13450000
235424           ELSE                                                   13460000
235425             MOVE ASDTPL-ASSOC-QTY         TO                     13470000
235426                      ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)      13480000
235427             IF ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)            13490000
235428                      < ASC-REC-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)   13500000
235429               MOVE ZERO TO                                       13510000
235430                         ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)   13520000
235431             ELSE                                                 13530000
235432               COMPUTE                                            13540000
235433                  ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB) =        13550000
235434                    ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB) -      13560000
235435                    ASC-REC-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)       13570000
235436             END-IF                                               13580000
235437             ADD ASC-ASN-QTY(ASC-BLK-SUB ASC-ITEM-SUB) TO         13590000
235438                 ASC-TOT-ASN-QTY                                  13600000
235439           END-IF                                                 13610000
235440                                                                  13620000
235441         WHEN SQLCODE = -913 OR -904                              13630000
235442           MOVE '??????' TO ASC-ASN-QTY-X                         13640000
235443                                (ASC-BLK-SUB ASC-ITEM-SUB)        13650000
235444         WHEN SQLWARN0 NOT = SPACES                               13660000
235445         WHEN SQLCODE < +0                                        13670000
235446         WHEN SQLCODE > +0                                        13680000
235447           MOVE '4370-GET-ASN-INFO'                               13690000
235448                             TO DP013-PARAGRAPH                   13700000
235449           MOVE 'SELECT ASN QTY          '                        13710000
235450                             TO DP013-MESSAGE-TEXT (1)            13720000
235451           MOVE SQLCA        TO DP013-SQLCA                       13730000
235452           MOVE 'TASDTPL'    TO DP013-DB2-TABLE-NAME (1)          13740000
235453           SET DP013-DB2-ABEND                                    13750000
235454               DP013-XCTL-DISPLAY-RESTART                         13760000
235455                             TO TRUE                              13770000
235456           PERFORM DP013-0000-PROCESS-ABEND                       13780000
235457       END-EVALUATE                                               13790000
235458     END-PERFORM.                                                 13800000
241200/                                                                 13810000
241210*----------------------------------------------------------------*13820000
241220 4380-GET-INVOICE-QTY-APP.                                        13830000
241230     PERFORM                                                      13840000
241231       WITH TEST AFTER                                            13850000
241232       VARYING PV-RETRY-COUNTER                                   13860000
241233       FROM 1 BY 1                                                13870000
241234       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                 13880000
241235           OR (SQLCODE = +0) OR SQLCODE = +100)                   13890000
241236                                                                  13900000
241240     EXEC SQL                                                     13910000
241250         SELECT SUM(R.PAY_REQ_LNE_QTY)                            13920000
241251          INTO :PREQIT-PAY-REQ-LNE-QTY:PV-VER-QTY-NULL            13930000
241252         FROM TINVOIC I,TPREQIT R                                 13940099
241253         WHERE I.PAYT_REQ_SEQ_NBR = R.PAYT_REQ_SEQ_NBR            13950099
241254          AND R.PAYT_REQ_LNE_NBR =:PURITM-APP-PO-LNE-NBR          13960000
241256          AND I.PO_NBR =: DK-PO-NBR                               13970099
241260*        SELECT R.PAY_REQ_LNE_QTY                                 13980000
241261*         INTO :PREQIT-PAY-REQ-LNE-QTY:PV-VER-QTY-NULL            13990000
241270*         FROM TINVOIC I, TPREQIT R, TMIITEM M                    14000099
241290*         WHERE I.PAYT_REQ_SEQ_NBR = M.PAYT_REQ_SEQ_NBR           14010099
241292*          AND  I.PAYT_REQ_SEQ_NBR = R.PAYT_REQ_SEQ_NBR           14020099
241293*          AND  P.PAYT_REQ_SEQ_NBR = I.PAYT_REQ_SEQ_NBR           14030000
241294*          AND  M.PAYT_REQ_SEQ_NBR = R.PAYT_REQ_SEQ_NBR           14040000
241295*          AND  M.PAYT_REQ_LNE_NBR =:PURITM-APP-PO-LNE-NBR        14050000
241296*          AND  I.PO_NBR =: DK-PO-NBR                             14060099
241297     END-EXEC                                                     14070000
241298                                                                  14080000
241299     EVALUATE TRUE                                                14090000
241300         WHEN SQLCODE = +100                                      14100000
241301                MOVE ZEROES           TO                          14110000
241302                         ASC-INV-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)  14120000
241303         WHEN SQLCODE = +0                                        14130000
241304             IF PV-VER-QTY-NULL < ZERO                            14140000
241305                MOVE ZEROES           TO                          14150000
241306                         ASC-INV-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)  14160000
241307             ELSE                                                 14170000
241308                MOVE PREQIT-PAY-REQ-LNE-QTY TO                    14180000
241309                         ASC-INV-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)  14190000
241310                ADD ASC-INV-QTY(ASC-BLK-SUB ASC-ITEM-SUB)         14200000
241311                 TO ASC-TOT-INV-QTY                               14210000
241312             END-IF                                               14220000
241313                                                                  14230000
241314         WHEN SQLCODE = -913 OR -904                              14240000
241315           MOVE '??????' TO ASC-INV-QTY-X                         14250000
241316                                (ASC-BLK-SUB ASC-ITEM-SUB)        14260000
241317         WHEN SQLWARN0 NOT = SPACES                               14270000
241318         WHEN SQLCODE < +0                                        14280000
241319         WHEN SQLCODE > +0                                        14290000
241320             MOVE '4380-GET-INVOICE-QTY-APP'                      14300000
241321                               TO DP013-PARAGRAPH                 14310000
241322             MOVE 'SELECT INVOICE QTY      '                      14320000
241323                               TO DP013-MESSAGE-TEXT (1)          14330000
241324             MOVE SQLCA        TO DP013-SQLCA                     14340000
241325             MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)        14350099
241326             SET DP013-DB2-ABEND                                  14360000
241327                 DP013-XCTL-DISPLAY-RESTART                       14370000
241328                               TO TRUE                            14380000
241329             PERFORM DP013-0000-PROCESS-ABEND                     14390000
241330      END-EVALUATE                                                14400000
241340     END-PERFORM.                                                 14410000
241426*----------------------------------------------------------------*14420000
241430* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *14430000
241500*----------------------------------------------------------------*14440000
241700 4400-MOVE-COMMAREA-TO-SCREEN.                                    14450000
241900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             14460000
242000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          14470000
242100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          14480000
242200             MOVE +1               TO ASC-BLK-SUB                 14490000
242300             PERFORM 5100-WRITE-TEMP-STORAGE                      14500000
242400             ADD +1                TO ASC-BLK-SUB                 14510000
242500             PERFORM 5100-WRITE-TEMP-STORAGE                      14520000
242600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             14530000
242700                 GIVING PV-BLOCK-NUMBER                           14540000
242800                 REMAINDER PV-REMAINDER                           14550000
242900             IF  PV-REMAINDER > ZERO                              14560000
243000                 ADD +1            TO PV-BLOCK-NUMBER             14570000
243100             END-IF                                               14580000
243200             MOVE +1               TO ASC-BLK-SUB                 14590000
243300             PERFORM 4410-READ-TEMP-STORAGE                       14600000
243400             ADD +1                TO ASC-BLK-SUB                 14610000
243500                                      PV-BLOCK-NUMBER             14620000
243600             PERFORM 4410-READ-TEMP-STORAGE                       14630000
243700     END-IF.                                                      14640000
243900     MOVE +1                       TO ASC-BLK-SUB.                14650000
244100     COMPUTE ASC-ITEM-SUB =                                       14660000
244200         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              14670000
244300         + PC-ITEMS-PER-PANEL).                                   14680000
244400                                                                  14690000
244500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14700000
244600         ADD +1                    TO ASC-BLK-SUB                 14710000
244700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            14720000
244800     END-IF.                                                      14730000
245000     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           14740000
245100         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                14750000
245400     PERFORM 4420-FORMAT-LIST-LINES                               14760000
245500         VARYING PV-SUB                                           14770000
245600         FROM PC-ITEMS-PER-PANEL BY -1                            14780000
245700         UNTIL PV-SUB < +1.                                       14790000
245900     COMPUTE ASC-ITEMS-DISPLAYED =                                14800000
246000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          14810000
246200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    14820000
246300                                      ASTRTITO.                   14830000
246510     MOVE ASC-KEY-PO-NBR           TO APONUMO.                    14840000
246610     MOVE ASC-KEY-DEPT-NBR         TO AHDEPTO.                    14850000
246800     MOVE ASC-KEY-ENT-NAME-DESC    TO AVENDNMO.                   14860000
246900     MOVE ASC-TOT-ORD-QTY          TO AORQTOTO.                   14870000
247000     MOVE ASC-TOT-INV-QTY          TO AINVTOTO.                   14880000
247010     MOVE ASC-TOT-ASN-QTY          TO AASNTOTO.                   14890000
247020     MOVE ASC-TOT-REC-QTY          TO ARECTOTO.                   14900000
247100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    14910000
247200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    14920000
247600     IF  DP020-MSG-NUMBER-X = SPACE                               14930000
247700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  14940000
247800*            --- MORE ITEMS TO DISPLAY ----                       14950000
247900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            14960000
248000             SET DP020-MSG-INFORMATIONAL TO TRUE                  14970000
248200         END-IF                                                   14980000
248300     END-IF.                                                      14990000
248400/                                                                 15000000
248500*----------------------------------------------------------------*15010000
248600*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *15020000
248700*----------------------------------------------------------------*15030000
248900 4410-READ-TEMP-STORAGE.                                          15040000
249100     EXEC CICS                                                    15050000
249200         READQ TS                                                 15060000
249300             QUEUE (ASC-LIST-QUEUE-NAME)                          15070000
249400             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               15080000
249500             ITEM  (PV-BLOCK-NUMBER)                              15090000
249600             RESP  (PV-CICS-RESP)                                 15100000
249700     END-EXEC.                                                    15110000
249900     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       15120000
250000       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     15130000
250100         CONTINUE                                                 15140000
250200     ELSE                                                         15150000
250300         SET DP013-CICS-ABEND      TO TRUE                        15160000
250400         SET DP013-NO-ROLLBACK     TO TRUE                        15170000
250500         MOVE '4410-READ-TEMP-STORAGE'                            15180000
250600                                   TO DP013-PARAGRAPH             15190000
250700         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      15200000
250800                                   TO DP013-MESSAGE-TEXT(1)       15210000
250900         PERFORM DP013-0000-PROCESS-ABEND                         15220000
251000     END-IF.                                                      15230000
251200     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      15240000
251300                                   TO TRUE.                       15250000
251500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         15260000
251600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               15270000
251700     END-IF.                                                      15280000
251900/                                                                 15290000
252000*----------------------------------------------------------------*15300000
252100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *15310000
252200*----------------------------------------------------------------*15320000
252400 4420-FORMAT-LIST-LINES.                                          15330000
252600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      15340000
252700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                15350000
253010         MOVE SPACES               TO AHDEPTO                     15360000
253200                                      AVENDNMO                    15370000
253500                                      MR-PO-LNE-NBR-X (PV-SUB)    15380000
W24803                                      MR-MAJ-CL (PV-SUB)          15390000
253700                                      MR-CL-NBR (PV-SUB)          15400000
W24803                                      MR-SKU-NBR (PV-SUB)         15410000
253900                                      MR-VEND-STYL-NAME (PV-SUB)  15420000
254000                                      MR-STATUS-CDE (PV-SUB)      15430000
254100                                      MR-ORD-QTY-X (PV-SUB)       15440000
254300                                      MR-REC-QTY-X (PV-SUB)       15450000
254400                                      MR-INV-QTY-X (PV-SUB)       15460000
254500                                      MR-ASN-QTY-X (PV-SUB)       15470000
254800     ELSE                                                         15480000
256700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           15490000
256800             IF  ASC-ITEM-CURSOR                                  15500000
256900                 MOVE ASC-PO-LNE-VAR-NBR                          15510000
257000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15520000
257100                                   TO MR-PO-LNE-NBR (PV-SUB)      15530000
257200             ELSE                                                 15540000
257300                 MOVE ASC-APP-PO-LNE-NBR                          15550000
257400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 15560000
257500                                   TO MR-PO-LNE-NBR (PV-SUB)      15570000
257600             END-IF                                               15580000
W24803             MOVE ASC-MAJ-CL (ASC-BLK-SUB ASC-ITEM-SUB)           15590000
W24803                                   TO MR-MAJ-CL (PV-SUB)          15600000
257900             MOVE ASC-CL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)           15610000
258000                                   TO MR-CL-NBR (PV-SUB)          15620000
W24803             MOVE ASC-SKU-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          15630000
W24803                                   TO MR-SKU-NBR (PV-SUB)         15640000
258300             MOVE ASC-VEND-STYL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)   15650000
258400                                   TO MR-VEND-STYL-NAME (PV-SUB)  15660000
258500             MOVE ASC-STATUS-CDE (ASC-BLK-SUB ASC-ITEM-SUB)       15670000
258600                                   TO MR-STATUS-CDE (PV-SUB)      15680000
258700             MOVE ASC-ORD-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          15690000
258800                                   TO MR-ORD-QTY (PV-SUB)         15700000
259700             MOVE ASC-REC-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          15710000
259800                                   TO MR-REC-QTY (PV-SUB)         15720000
259900             MOVE ASC-ASN-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          15730000
260000                                   TO MR-ASN-QTY (PV-SUB)         15740000
260100             MOVE ASC-INV-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          15750000
260200                                   TO MR-INV-QTY (PV-SUB)         15760000
260700         END-IF                                                   15770000
260800     END-IF.                                                      15780000
260900                                                                  15790000
261000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               15800000
261100                                                                  15810000
261200     IF  ASC-ITEM-SUB < + 1                                       15820000
261300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                15830000
261400         MOVE +1                   TO ASC-BLK-SUB                 15840000
261500     END-IF.                                                      15850000
261600/                                                                 15860000
261601*----------------------------------------------------------------*15870000
261602*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *15880000
261603*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *15890000
261604*----------------------------------------------------------------*15900000
261606 5100-WRITE-TEMP-STORAGE.                                         15910000
261607                                                                  15920000
261608     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     15930000
261609                                   TO PV-LIST-ITEM-NUMBER.        15940000
261610     COMPUTE PV-BLOCK-NUMBER =                                    15950000
261611         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15960000
261612                                                                  15970000
261613     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             15980000
261614     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             15990000
261615         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      16000000
261616             PERFORM 5105-REWRITE-ASC-LISTQ                       16010000
261617         END-IF                                                   16020000
261618     ELSE                                                         16030000
261619         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       16040000
261620         ASC-HIGHEST-BLOCK-WRITTEN + 1                            16050000
261621         PERFORM 5110-WRITE-ASC-LISTQ                             16060000
261622         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   16070000
261623     END-IF.                                                      16080000
261624                                                                  16090000
261625     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             16100000
261628/                                                                 16110000
261629*----------------------------------------------------------------*16120000
261630*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *16130000
261631*  SPECIFIC COMMAREA.                                            *16140000
261632*----------------------------------------------------------------*16150000
261633 5105-REWRITE-ASC-LISTQ.                                          16160000
261634                                                                  16170000
261635     EXEC CICS                                                    16180000
261636         WRITEQ TS                                                16190000
261637             QUEUE (ASC-LIST-QUEUE-NAME)                          16200000
261638             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16210000
261639             ITEM  (PV-BLOCK-NUMBER)                              16220000
261640             REWRITE                                              16230000
261641             RESP  (PV-CICS-RESP)                                 16240000
261642     END-EXEC.                                                    16250000
261643                                                                  16260000
261644     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           16270000
261645         CONTINUE                                                 16280000
261646     ELSE                                                         16290000
261647         SET DP013-CICS-ABEND      TO TRUE                        16300000
261648         SET DP013-NO-ROLLBACK     TO TRUE                        16310000
261649         MOVE '5105-REWRITE-ASC-LISTQ'                            16320000
261650                                   TO DP013-PARAGRAPH             16330000
261651         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     16340000
261652                                   TO DP013-MESSAGE-TEXT(1)       16350000
261653         PERFORM DP013-0000-PROCESS-ABEND                         16360000
261660     END-IF.                                                      16370000
261661/                                                                 16380000
261662*----------------------------------------------------------------*16390000
261663*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *16400000
261664*  SPECIFIC COMMAREA.                                            *16410000
261665*----------------------------------------------------------------*16420000
261666 5110-WRITE-ASC-LISTQ.                                            16430000
261667                                                                  16440000
261668     EXEC CICS                                                    16450000
261669         WRITEQ TS                                                16460000
261670             QUEUE (ASC-LIST-QUEUE-NAME)                          16470000
261671             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               16480000
261672             ITEM  (PV-BLOCK-NUMBER)                              16490000
261673             RESP  (PV-CICS-RESP)                                 16500000
261674     END-EXEC.                                                    16510000
261675                                                                  16520000
261676     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      16530000
261677         SET DP013-CICS-ABEND      TO TRUE                        16540000
261678         SET DP013-NO-ROLLBACK     TO TRUE                        16550000
261679         MOVE '5110-WRITE-ASC-LISTQ'                              16560000
261680                                   TO DP013-PARAGRAPH             16570000
261681         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           16580000
261682                                   TO DP013-MESSAGE-TEXT(1)       16590000
261683         PERFORM DP013-0000-PROCESS-ABEND                         16600000
261684     END-IF.                                                      16610000
261690/                                                                 16620000
305200*----------------------------------------------------------------*16630000
305300*    ABEND PROCESSOR MODULE                                      *16640000
305400*----------------------------------------------------------------*16650000
305600     COPY DPPD013.                                                16660000
