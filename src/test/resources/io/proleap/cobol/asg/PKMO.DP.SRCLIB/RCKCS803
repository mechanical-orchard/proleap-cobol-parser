000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.    RCKCS803.                                         00020099
000300 AUTHOR.        KAREN WALL                                        00030099
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
000500 DATE-WRITTEN.  10/16/99.                                         00050099
000600 DATE-COMPILED.                                                   00060099
000700                                                                  00070099
000800*---------------------------------------------------------------* 00080099
000900*    TRANID      - E803                                         * 00090099
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00100099
001100*    DESCRIPTION - ADD A PACK RECEIPT ITEM                      * 00110099
001200*    MAPSET      - RCKM803                                      * 00120099
001300*                                                               * 00130099
001400*    THIS PROGRAM ALLOWS THE USER TO ADD A NEW ROW TO THE       * 00140099
001500*    RECITM TABLE FOR A PACK.  THE USER ENTERS THIS PROGRAM     * 00150099
001600*    THROUGH THE RECEIPT ITEM ADD LIST PROGRAM (RCKCS802).      * 00160099
001700*                                                               * 00170099
001800*---------------------------------------------------------------* 00180099
001900* MAINTENANCE:                                                  * 00190099
002000*    SUE BARTELT   01/03/14   SEBSEB                            * 00200099
002100*      MTK PROJECT - PACKAGE CODE CHANGES. CHG0081355           * 00210099
002200*        CHANGES IN PARAGRAPHS:                                 * 00220099
002300*            9500-CALL-VALIDATION-MODULE                        * 00230099
002400*---------------------------------------------------------------* 00240099
002500* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00250099
002600* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00260099
002700* MAKING THE CALL DYNAMIC VS STATIC.                              00270099
002800*---------------------------------------------------------------* 00280099
002900                                                                  00290099
003000 ENVIRONMENT DIVISION.                                            00300099
003100 DATA DIVISION.                                                   00310099
003200                                                                  00320099
003300 WORKING-STORAGE SECTION.                                         00330099
003400                                                                  00340099
003500 01  DK-DB2-KEYS.                                                 00350099
003600     05  DK-PO-NBR                    PIC S9(9) COMP VALUE +0.    00360099
003700     05  DK-REC-SEQ-NBR               PIC S9(9) COMP VALUE +0.    00370099
003800     05  DK-PO-LNE-NBR                PIC S9(4) COMP VALUE +0.    00380099
003900     05  DK-OPER-UNT-ID               PIC S9(4) COMP VALUE +0.    00390099
004000     05  DK-FCLTY-ID                  PIC S9(4) COMP VALUE +0.    00400099
004100     05  DK-PACK-ID                   PIC S9(04)  COMP.           00410099
004200     05  DK-DEPT-NBR                  PIC X(03) VALUE SPACES.     00420099
004300                                                                  00430099
004400     05  DK-AGRMT-TYP-ID              PIC X(01)  VALUE SPACES.    00440099
004500     05  DK-TYP-CDE                   PIC S9(04) COMP VALUE +0.   00450099
004600     05  DK-MERCH-DEPT-NMBR           PIC X(03) VALUE SPACE.      00460099
004700     05  DK-MERCH-CLASS-NMBR          PIC X(03) VALUE SPACE.      00470099
004800     05  DK-SUBCLASS-NBR              PIC X(03) VALUE SPACE.      00480099
004900     05  DK-MAJCLASS-NBR              PIC X(02) VALUE SPACE.      00490099
005000     05  DK-TICKET-DESC               PIC X(20) VALUE SPACE.      00500099
005100     05  DK-ENT-ID                    PIC S9(9) COMP VALUE +0.    00510099
005200     05  DK-MDSEAR-ID                 PIC S9(9) COMP VALUE +0.    00520099
005300     05  DK-TKT-TYP-SEQ-NBR           PIC S9(4) COMP VALUE +0.    00530099
005400                                                                  00540099
005500 01  PC-PROGRAM-CONSTANTS.                                        00550099
005600     05  PC-TRANS-ID                  PIC X(04)  VALUE 'E803'.    00560099
005700     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'RCKCS803'.00570099
005800     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'RC803A  '.00580099
005900     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'RCKM803 '.00590099
006000     05  PC-LINE-TROUBLE-RTN          PIC X(08)  VALUE 'TMKCS520'.00600099
006100     05  PC-LINE-TROUBLE-RTN-LENGTH   PIC S9(04) VALUE +600 COMP. 00610099
006200     05  PC-APPL-MAP                  PIC S9(04) VALUE  +1        00620099
006300                                                 COMP.            00630099
006400     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00640099
006500                                                 COMP.            00650099
006600     05  PC-DEFAULT-TMST              PIC  X(26) VALUE            00660099
006700                             '9999-09-09-09.09.09.999999'.        00670099
006800     05  PC-DEFAULT-DATE              PIC X(10) VALUE             00680099
006900                                                '9999-09-09'.     00690099
007000     05  PC-ZERO                      PIC S9(9) VALUE +0          00700099
007100                                                COMP.             00710099
007200     05  PC-ACTIVE                    PIC X(01)  VALUE 'A'.       00720099
007300     05  PC-A                         PIC X(01)  VALUE 'A'.       00730099
007400     05  PC-R                         PIC X(01)  VALUE 'R'.       00740099
007500     05  PC-T                         PIC X(01)  VALUE 'T'.       00750099
007600     05  PC-Y                         PIC X(01)  VALUE 'Y'.       00760099
007700     05  PC-IP                        PIC X(02)  VALUE 'IP'.      00770099
007800     05  PC-DASH                      PIC X(01)  VALUE '-'.       00780099
007900     05  PC-8999                      PIC 9(04)  VALUE 8999.      00790099
008000     05  PC-SUBCLASS-MDSELV-CDE       PIC X(03)  VALUE 'SCL'.     00800099
008100     05  PC-MAJCLASS-MDSELV-CDE       PIC X(03)  VALUE 'MCL'.     00810099
008200     05  PC-DPT-MDSELV-CDE            PIC X(03)  VALUE 'DPT'.     00820099
008300     05  PC-VS-TICKET-TYPE-CDE        PIC S9(04) COMP             00830099
008400                                                 VALUE +2.        00840099
008500     05  PC-CURRENT-DATE              PIC X(10) VALUE SPACE.      00850099
008600                                                                  00860099
008700     05  PC-TSYMSG-NUMBERS.                                       00870099
008800         10  PC-TSYMSG-00005          PIC 9(05)  VALUE 00005.     00880099
008900*            INVALID VALUE                                        00890099
009000         10  PC-TSYMSG-00007          PIC 9(05)  VALUE 00007.     00900099
009100*            REQUIRED ENTRY                                       00910099
009200         10  PC-TSYMSG-00008          PIC 9(05)  VALUE 00008.     00920099
009300*            MUST BE NUMERIC                                      00930099
009400         10  PC-TSYMSG-00057          PIC 9(05)  VALUE 00057.     00940099
009500*            A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       00950099
009600         10  PC-TSYMSG-00059          PIC 9(05)  VALUE 00059.     00960099
009700*            UPDATE(S) SUCCESSFUL                                 00970099
009800         10  PC-TSYMSG-00069          PIC 9(05)  VALUE 00069.     00980099
009900*            TOP OF LIST                                          00990099
010000         10  PC-TSYMSG-00070          PIC 9(05)  VALUE 00070.     01000099
010100*            BOTTOM OF LIST                                       01010099
010200         10  PC-TSYMSG-00084          PIC 9(05)  VALUE 00084.     01020099
010300*            PURCHASE ORDER LINE DOES NOT EXIST                   01030099
010400         10  PC-TSYMSG-00117          PIC 9(05)  VALUE 00117.     01040099
010500*            CANNOT ADD - RECORD ALREADY EXISTS                   01050099
010600         10  PC-TSYMSG-00148          PIC 9(05)  VALUE 00148.     01060099
010700*            DATA DOES NOT EXIST                                  01070099
010800         10  PC-TSYMSG-00342          PIC 9(05)  VALUE 00342.     01080099
010900         10  PC-TSYMSG-00551          PIC 9(05)  VALUE 00551.     01090099
011000*            MUST BE NUMERIC AND > ZERO                           01100099
011100         10  PC-TSYMSG-00808          PIC 9(05)  VALUE 00808.     01110099
011200*            PURCHASE ORDER LINE STATUS MUST BE ACTIVE OR APPROVED01120099
011300         10  PC-TSYMSG-01293          PIC 9(05)  VALUE 01293.     01130099
011400*            LINE ADDED                                           01140099
011500         10  PC-TSYMSG-02161          PIC 9(05)  VALUE 02161.     01150099
011600* UPDATE SUCCESSFUL - REDISTRO  PERFORMED                         01160099
011700         10  PC-TSYMSG-02179          PIC 9(05)  VALUE 02179.     01170099
011800* DETAIL RATIO MUST BE > 0 ON AN UPDATE                           01180099
011900         10  PC-TSYMSG-02183          PIC 9(05)  VALUE 02183.     01190099
012000* DETAIL UNITS MUST BE > 0 WHEN PACK SLIP UNITS = 0               01200099
012100         10  PC-TSYMSG-02229          PIC 9(05)  VALUE 02229.     01210099
012200* A PREPACK SYSTEM ERROR HAS OCCURRED (&VAR). PLEASE CONTACT HELP 01220099
012300         10  PC-TSYMSG-02239          PIC 9(05)  VALUE 02239.     01230099
012400* UPDATE SUCCESSFUL - UNABLE TO REDISTRO DUE TO TROUBLE           01240099
012500         10  PC-TSYMSG-02452          PIC 9(05)  VALUE 02452.     01250099
012600*  ALLOCATION IS INCORRECT; PLEASE REVIEW DISTRO                  01260099
012700         10  PC-TSYMSG-03570          PIC 9(05)  VALUE 03570.     01270099
012800*  UPD SUCCESSFUL-REDISTRO, WILL BE DOWNLOADED TO WMS             01280099
012900*----------------------------------------------------------------*01290099
013000* INCLUDED NEW CONSTANTS PC-000 AND PC-999.          WR # 230ZZ  *01300099
013100*----------------------------------------------------------------*01310099
013200     05  PC-000                       PIC X(03) VALUE '000'.      01320099
013300     05  PC-999                       PIC X(03) VALUE '999'.      01330099
013400*----------------------------------------------------------------*01340099
013500* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *01350099
013600*----------------------------------------------------------------*01360099
013700                                                                  01370099
013800 01  PS-PROGRAM-SWITCHES.                                         01380099
013900     05  PS-ERROR-SW                  PIC X(01)  VALUE 'N'.       01390099
014000         88  PS-ERROR                            VALUE 'Y'.       01400099
014100         88  PS-NO-ERROR                         VALUE 'N'.       01410099
014200     05  PS-ORIG-ASN-PKSLIP-SW        PIC  X     VALUE 'N'.       01420099
014300         88  PS-ORIG-ASN-PKSLIP-YES              VALUE 'Y'.       01430099
014400         88  PS-ORIG-ASN-PKSLIP-NO               VALUE 'N'.       01440099
014500     05  PS-COMMAREA-SW               PIC X(01)  VALUE 'N'.       01450099
014600         88  PS-COMMAREA-VALID                   VALUE 'Y'.       01460099
014700         88  PS-COMMAREA-NOT-VALID               VALUE 'N'.       01470099
014800     05  PS-PURITM-EXISTS-SW          PIC X(01)  VALUE 'N'.       01480099
014900         88  PS-PURITM-FOUND                     VALUE 'Y'.       01490099
015000         88  PS-PURITM-NOT-FOUND                 VALUE 'N'.       01500099
015100     05  PS-LIST-SW                   PIC X(01)  VALUE 'N'.       01510099
015200         88  PS-LIST-END                         VALUE 'Y'.       01520099
015300         88  PS-NO-LIST-END                      VALUE 'N'.       01530099
015400     05  PS-INACTIVE-EXISTS-SW        PIC X(01)  VALUE 'N'.       01540099
015500         88  PS-INACTIVE-EXISTS                  VALUE 'Y'.       01550099
015600     05  PS-PRETICKET-SW              PIC X      VALUE 'N'.       01560099
015700         88  PS-NOT-PRETICKET                    VALUE 'N'.       01570099
015800         88  PS-PRETICKET                        VALUE 'Y'.       01580099
015900     05  PS-VSM-SW                    PIC X      VALUE 'N'.       01590099
016000         88  PS-NOT-VSM                          VALUE 'N'.       01600099
016100         88  PS-VSM                              VALUE 'Y'.       01610099
016200*----------------------------------------------------------------*01620099
016300*  INCLUDED PROGRAM SWITCHES FOR XLKUT001       **   WR # 230ZZ  *01630099
016400*----------------------------------------------------------------*01640099
016500     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        01650099
016600         88  PS-CALL-API-NO                     VALUE 'N'.        01660099
016700         88  PS-CALL-API-YES                    VALUE 'Y'.        01670099
016800*----------------------------------------------------------------*01680099
016900* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *01690099
017000*----------------------------------------------------------------*01700099
017100                                                                  01710099
017200                                                                  01720099
017300 01  PV-PROGRAM-VARIABLES.                                        01730099
017400     05  PV-CICS-RESPONSE             PIC S9(04) VALUE +0         01740099
017500                                                 COMP SYNC.       01750099
017600     05  PV-DB2-COUNT                 PIC S9(09) VALUE +0         01760099
017700                                                 COMP-3.          01770099
017800     05  PV-LINE-NBR-IND              PIC S9(04) VALUE +0         01780099
017900                                                 COMP SYNC.       01790099
018000     05  PV-VALID-IDX                 PIC S9(04) VALUE +0         01800099
018100                                                 COMP SYNC.       01810099
018200     05  PV-MAX-LINE-NBR              PIC S9(04) VALUE +0         01820099
018300                                                 COMP.            01830099
018400     05  PV-NEXT-LINE-NBR             PIC S9(04) VALUE +0         01840099
018500                                                 COMP.            01850099
018600     05  PV-NULL-IND                  PIC S9(04) VALUE +0         01860099
018700                                                 COMP.            01870099
018800     05  PV-COUNTER                   PIC S9(04) VALUE +0         01880099
018900                                                 COMP.            01890099
019000     05  DN-TKT-FMT-ID                PIC S9(04) VALUE +0         01900099
019100                                                 COMP.            01910099
019200     05  PV-ABSTIME                   PIC S9(15) COMP.            01920099
019300     05  PV-CURRENT-TIME              PIC  9(06).                 01930099
019400     05  PV-CURRENT-DATE              PIC  9(06).                 01940099
019500     05  FILLER REDEFINES PV-CURRENT-DATE.                        01950099
019600         10  PV-CURRENT-DATE-YY       PIC  X(02).                 01960099
019700         10  PV-CURRENT-DATE-MM       PIC  X(02).                 01970099
019800         10  PV-CURRENT-DATE-DD       PIC  X(02).                 01980099
019900                                                                  01990099
020000     05  PV-PURITM-STATUS-CDE         PIC  X(02)   VALUE SPACES.  02000099
020100         88  PV-PURITM-STATUS-CDE-VALID            VALUES         02010099
020200                                                   'AC', 'AP'.    02020099
020300                                                                  02030099
020400     05  PV-TROUBLE-COUNT             PIC 9(03)    VALUE ZEROS.   02040099
020500     05  PV-NOT-IN-TROUBLE-COUNT      PIC 9(03)    VALUE ZEROS.   02050099
020600     05  PV-PACK-BY-ST-IND            PIC X(01)    VALUE SPACE.   02060099
020700         88  PV-PACK-BY-ST-IND-YES                 VALUE 'Y'.     02070099
020800     05  PV-DRIVER-LINE-NBR           PIC S9(04)  COMP.           02080099
020900     05  PV-UNPACK-OPER-UNT-ID        PIC  9(04)   VALUE ZERO.    02090099
021000     05  PV-RETRY-COUNTER             PIC S9(4) VALUE ZERO        02100099
021100                                                COMP SYNC.        02110099
021200     05  PV-ORIG-PKSL-ITM-QTY         PIC S9(9) VALUE +0 COMP.    02120099
021300     05  PV-TEMP-ORD-LNE-NBR          PIC  S9(9) COMP.            02130099
021400     05  PV-TEMP-STATUS-CDE           PIC   X(2).                 02140099
021500     05  PV-TEMP-CASE-PACK-QTY        PIC  S9(9) COMP.            02150099
021600     05  PV-TEMP-PKSL-ITM-QTY         PIC  S9(9) COMP.            02160099
021700     05  PV-TEMP-DTL-CK-ITM-QTY       PIC  S9(9) COMP.            02170099
021800     05  PV-TEMP-DTL-PACK-RATIO       PIC  S9(4) COMP.            02180099
021900     05  PV-TEMP-PO-PACK-RATIO        PIC  S9(4) COMP.            02190099
022000     05  PV-TEMP-PREPK-ODD-UNT-QTY    PIC  S9(4) COMP.            02200099
022100     05  PV-TEMP-DRV-LNE-CDE          PIC   X(1).                 02210099
022200     05  PV-NBR-OF-PIC-AD             PIC S9(04) COMP.            02220099
022300     05  PV-PACK-LINE-COUNT           PIC S9(04)   VALUE +0       02230099
022400                                                    COMP.         02240099
022500     05  PV-UPDATE-NEEDED-SW          PIC X(01).                  02250099
022600         88  PV-UPDATE-NOT-NEEDED                  VALUE 'N'.     02260099
022700         88  PV-UPDATE-NEEDED                      VALUE 'Y'.     02270099
022800*----------------------------------------------------------------*02280099
022900*                                               WR # 230ZZ       *02290099
023000* ADDED NEW VARIABLES - PV-TEMP-SEQ-NBR, PV-SKU-SEQ-NBR,         *02300099
023100* DK-SKU-SEQ, DK-ITM-NBR AND PV-TEMP-TKT-TYPE.                   *02310099
023200*----------------------------------------------------------------*02320099
023300     05  PV-TEMP-SEQ-NBR              PIC  9(08).                 02330099
023400     05  PV-SKU-SEQ-NBR               PIC  X(08).                 02340099
023500     05  DK-SKU-SEQ                   PIC  X(03).                 02350099
023600     05  DK-ITM-NBR                   PIC  S9(15)V COMP-3.        02360099
023700     05  PV-TEMP-TKT-TYPE             PIC  X(20).                 02370099
023800                                                                  02380099
023900     05  PV-PO-NBR-PIC9               PIC S9(11) VALUE +0.        02390099
024000     05  PV-REC-SEQ-NBR-PIC9          PIC S9(11) VALUE +0.        02400099
024100     05  PV-PO-LNE-NBR-PIC9           PIC S9(11) VALUE +0.        02410099
024200*----------------------------------------------------------------*02420099
024300* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *02430099
024400*----------------------------------------------------------------*02440099
024500*----------------------------------------------------------------*02450099
024600*    COPYBOOK FOR THE FIELDS PASSED TO THE TROUBLE SUBROUTINE     02460099
024700*----------------------------------------------------------------*02470099
024800     COPY TMWS500.                                                02480099
024900                                                                  02490099
025000*---------------------------------------------------------------* 02500099
025100*  RECORD LAYOUT FOR THE PACK VALIDATION MODULE.                * 02510099
025200*---------------------------------------------------------------* 02520099
025300                                                                  02530099
025400     COPY RCWS806.                                                02540099
025500                                                                  02550099
025600*----------------------------------------------------------------*02560099
025700*    THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING       *02570099
025800*    SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.        *02580099
025900*----------------------------------------------------------------*02590099
026000                                                                  02600099
026100     COPY RCWS013.                                                02610099
026200     COPY RCWS801.                                                02620099
026300                                                                  02630099
026400*----------------------------------------------------------------*02640099
026500*    MAP LAYOUT                                                  *02650099
026600*----------------------------------------------------------------*02660099
026700     COPY RCKM803.                                                02670099
026800                                                                  02680099
026900*----------------------------------------------------------------*02690099
027000*    ATTRIBUTE SETTINGS COPYBOOK.                                *02700099
027100*----------------------------------------------------------------*02710099
027200     COPY DPWS015.                                                02720099
027300                                                                  02730099
027400*----------------------------------------------------------------*02740099
027500*    FUNCTION KEYS COPYBOOK                                      *02750099
027600*----------------------------------------------------------------*02760099
027700     COPY DPWS016.                                                02770099
027800                                                                  02780099
027900*----------------------------------------------------------------*02790099
028000*    THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT   *02800099
028100*    SUB-ROUTINE (POKUT100).                                     *02810099
028200*----------------------------------------------------------------*02820099
028300     COPY DPWS010I.                                               02830099
028400                                                                  02840099
028500*----------------------------------------------------------------*02850099
028600* WORK AREA PASSED IN CALL TO DPKUT500                          * 02860099
028700*----------------------------------------------------------------*02870099
028800     COPY DPWS500.                                                02880099
028900                                                                  02890099
029000******************************************************************02900099
029100** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **02910099
029200** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **02920099
029300******************************************************************02930099
029400     COPY DPWS030.                                                02940099
029410     COPY DPWS930.                                                02941099
029500                                                                  02950099
029600*----------------------------------------------------------------*02960099
029700*    STANDARD COMMAREA.                                          *02970099
029800*----------------------------------------------------------------*02980099
029900     COPY DPWS020.                                                02990099
030000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03000099
030100                                                                  03010099
030200*----------------------------------------------------------------*03020099
030300*   INTER-APPLICATION COMMAREA.                                 * 03030099
030400*----------------------------------------------------------------*03040099
030500         10  INTER-APPL-COMM-AREA PIC X(200).                     03050099
030600     COPY RCWS800.                                                03060099
030700     COPY PCWS000.                                                03070099
030800     COPY POWS017.                                                03080099
030900                                                                  03090099
031000*----------------------------------------------------------------*03100099
031100*    SPECIFIC COMMMAREA FOR RCKCS803.                            *03110099
031200*----------------------------------------------------------------*03120099
031300         10  ASC-SPECIFIC-COMMAREA.                               03130099
031400             15  ASC-USE-SELECTION-QUEUE-IND                      03140099
031500                                            PIC X(01).            03150099
031600                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        03160099
031700             15  ASC-SEL-QUEUE-NAME         PIC X(08).            03170099
031800             15  ASC-NUMBER-OF-TS-ITEMS     PIC S9(05) COMP-3.    03180099
031900             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03190099
032000                                            PIC S9(09) COMP-3.    03200099
032100             15  ASC-SEL-SUB                PIC S9(04) COMP.      03210099
032200             15  ASC-SEL-ITEM               PIC S9(04) COMP.      03220099
032300             15  ASC-CURRENT-DATE           PIC X(10).            03230099
032400             15  ASC-ACTION-SW              PIC X(03).            03240099
032500                 88  ASC-UPDATE-PENDING     VALUE 'UPD'.          03250099
032600             15  ASC-SCREEN-FIELDS.                               03260099
032700                 20  ASC-OPER-UNT-ID        PIC S9(4)  COMP.      03270099
032800                 20  ASC-FCLTY-ID           PIC S9(4)  COMP.      03280099
032900                 20  ASC-FCLTY-DESC         PIC X(25).            03290099
033000                 20  ASC-RECEIVER.                                03300099
033100                     25  ASC-PO-NBR         PIC 9(08).            03310099
033200                     25  ASC-REC-DASH       PIC X(01).            03320099
033300                     25  ASC-REC-SEQ-NBR    PIC 9(03).            03330099
033400                 20  ASC-PO-LNE-NBR.                              03340099
033500                     25  ASC-PO-LNE-NBR-N   PIC 9(04).            03350099
033600                 20  ASC-STATUS-DESC        PIC X(10).            03360099
033700                 20  ASC-TROUBLE-DESC       PIC X(26).            03370099
033800                 20  ASC-PACK-ID            PIC 9(03).            03380099
033900                 20  ASC-PACK-DESC          PIC X(36).            03390099
034000                 20  ASC-DTL-PACK-RATIO.                          03400099
034100                     25  ASC-DTL-PACK-RATIO-N                     03410099
034200                                            PIC 9(03).            03420099
034300                 20  ASC-ODD-PACK-UNITS     PIC S9(06) COMP.      03430099
034400                 20  ASC-PKSL-ITM-QTY       PIC 9(07).            03440099
034500                 20  ASC-GP-RTL-AMT         PIC 9(04)V99.         03450099
034600                 20  ASC-PO-PACK-RATIO.                           03460099
034700                     25  ASC-PO-PACK-RATIO-N                      03470099
034800                                            PIC 9(03).            03480099
034900                 20  ASC-DTL-CK-ITM-QTY.                          03490099
035000                     25  ASC-DTL-CK-ITM-QTY-N                     03500099
035100                                            PIC 9(05).            03510099
035200                 20  ASC-GP-QTY             PIC 9(03).            03520099
035300                 20  ASC-PRE-TKT-IND        PIC X(01).            03530099
035400                 20  ASC-EXPTED-CART-CNT    PIC 9(04).            03540099
035500                 20  ASC-UNT-RTL-PR-AMT     PIC 9(06)V99.         03550099
035600                 20  ASC-ACTL-CART-CNT      PIC 9(04).            03560099
035700                 20  ASC-TKT-TYP-DESC       PIC X(06).            03570099
035800                 20  ASC-UNT-COST-AMT       PIC 9(06)V99.         03580099
035900*----------------------------------------------------------------*03590099
036000*                                                     WR # 230ZZ *03600099
036100*       ADDED CODE FOR ASC-SKU, DASHES IN BETWEEN FIELDS HAVE    *03610099
036200*       BEING REPLACED WITH SPACES.                              *03620099
036300*       SEQUENCE NUMBER FIELD SIZE HAS BEEN INCREASED FROM       *03630099
036400*       3 TO 8 CHARACTERS.                                       *03640099
036500*                                                                *03650099
036600*----------------------------------------------------------------*03660099
036700                 20  ASC-SKU.                                     03670099
036800                     25  ASC-DEPT-NBR       PIC X(03).            03680099
036900                     25  ASC-SKU-SPACE-1    PIC X(01).            03690099
037000                     25  ASC-CLASS-NBR      PIC X(02).            03700099
037100                     25  ASC-SKU-SPACE-2    PIC X(01).            03710099
037200                     25  ASC-SKU-SEQ-NBR    PIC X(08).            03720099
037300                 20  ASC-VEND-STYL-NAME     PIC X(20).            03730099
037400                 20  ASC-COLOR-DESC         PIC X(25).            03740099
037500                 20  ASC-SIZE-DESC          PIC X(25).            03750099
037600             15  ASC-PKNG-CDE               PIC X(01).            03760099
037700             15  ASC-PURITM-VER-NBR         PIC S9(04) COMP.      03770099
037800             15  ASC-ITM-NBR                PIC S9(15) COMP-3.    03780099
037900             15  ASC-PURITM-PIC-ITM-IND     PIC X(01).            03790099
038000             15  ASC-ENT-ID                 PIC S9(09) COMP.      03800099
038100             15  ASC-CASE-PACK-QTY          PIC S9(03) COMP.      03810099
038200             15  ASC-NOT-FOUND-SW           PIC X(01).            03820099
038300                 88  ASC-FOUND                         VALUE 'F'. 03830099
038400                 88  ASC-NOT-FOUND                     VALUE 'N'. 03840099
038500             15  ASC-ITEMS-LEFT-INDICATOR   PIC X(01).            03850099
038600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03860099
038700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03870099
038800             15  ASC-RECITM-STATUS-CDE      PIC X(02).            03880099
038900                 88  ASC-RECITM-STATUS-CM-VE           VALUES     03890099
039000                                                      'CM', 'VE'. 03900099
039100             15  ASC-RECITM-SETUP-PREV-SW   PIC X(01).            03910099
039200                 88  ASC-RECITM-SETUP-PREV             VALUE 'Y'. 03920099
039300                 88  ASC-RECITM-NOT-SETUP-PREV         VALUE 'N'. 03930099
039400             15  ASC-TKT-DESC               PIC X(16).            03940099
039500                                                                  03950099
039600*----------------------------------------------------------------*03960099
039700*   CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        03970099
039800*----------------------------------------------------------------*03980099
039900*----------------------------------------------------------------*03990099
040000*    ABEND PROCESSING COPYBOOK.                                  *04000099
040100*----------------------------------------------------------------*04010099
040200     COPY DPWS013.                                                04020099
040300                                                                  04030099
040400*----------------------------------------------------------------*04040099
040500*    SYSTEM MESSAGE COPYBOOK                                     *04050099
040600*----------------------------------------------------------------*04060099
040700     COPY DPRD507I.                                               04070099
040800                                                                  04080099
040900*----------------------------------------------------------------*04090099
041000*    LOGISTICS LOCATION MODULE (XLKUT071)                        *04100099
041100*----------------------------------------------------------------*04110099
041200     COPY XLWS071.                                                04120099
041300                                                                  04130099
041400*---------------------------------------------------------------* 04140099
041500*                                                **   WR # 230ZZ* 04150099
041600*  RECORD LAYOUT FOR LOGISTICS DOMAIN ITEM ACCESS MODULE        * 04160099
041700*---------------------------------------------------------------* 04170099
041800                                                                  04180099
041900     COPY XLWS001.                                                04190099
042000                                                                  04200099
042100*----------------------------------------------------------------*04210099
042200*   CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        04220099
042300*----------------------------------------------------------------*04230099
042400*----------------------------------------------------------------*04240099
042500*    DB2 SQL COMMUNICATION AREA                                   04250099
042600*----------------------------------------------------------------*04260099
042700     EXEC SQL                                                     04270099
042800          INCLUDE SQLCA                                           04280099
042900     END-EXEC.                                                    04290099
043000                                                                  04300099
043100*----------------------------------------------------------------*04310099
043200*    DB2 DCLGEN FOR PO AGREEMENT TABLE                            04320099
043300*----------------------------------------------------------------*04330099
043400     EXEC SQL                                                     04340099
043500          INCLUDE TPOAGMT                                         04350099
043600     END-EXEC.                                                    04360099
043700                                                                  04370099
043800*---------------------------------------------------------------- 04380099
043900*    DB2 DCLGEN FOR THE PACK SLIP TABLE                           04390099
044000*----------------------------------------------------------------*04400099
044100     EXEC SQL                                                     04410099
044200          INCLUDE TPKSLIP                                         04420099
044300     END-EXEC.                                                    04430099
044400                                                                  04440099
044500*----------------------------------------------------------------*04450099
044600*    DB2 DCLGEN FOR THE PACK SLIP ITEM TABLE                      04460099
044700*---------------------------------------------------------------- 04470099
044800     EXEC SQL                                                     04480099
044900          INCLUDE TPKITEM                                         04490099
045000     END-EXEC.                                                    04500099
045100                                                                  04510099
045200*----------------------------------------------------------------*04520099
045300*    DB2 DCLGEN FOR THE PO PACK INFORMATION TABLE                 04530099
045400*---------------------------------------------------------------- 04540099
045500     EXEC SQL                                                     04550099
045600          INCLUDE TPOPRPK                                         04560099
045700     END-EXEC.                                                    04570099
045800                                                                  04580099
045900*----------------------------------------------------------------*04590099
046000*    DB2 DCLGEN FOR THE UNMATCHED PACK SLIP ITEM TABLE            04600099
046100*----------------------------------------------------------------*04610099
046200     EXEC SQL                                                     04620099
046300          INCLUDE TUNPKSL                                         04630099
046400     END-EXEC.                                                    04640099
046500                                                                  04650099
046600*----------------------------------------------------------------*04660099
046700*    DB2 DCLGEN FOR THE RECEIVER TABLE                            04670099
046800*----------------------------------------------------------------*04680099
046900     EXEC SQL                                                     04690099
047000          INCLUDE TRECEIV                                         04700099
047100     END-EXEC.                                                    04710099
047200                                                                  04720099
047300*----------------------------------------------------------------*04730099
047400*    DB2 DCLGEN FOR THE RECEIVER ITEM TABLE                       04740099
047500*----------------------------------------------------------------*04750099
047600     EXEC SQL                                                     04760099
047700          INCLUDE TRECITM                                         04770099
047800     END-EXEC.                                                    04780099
047900                                                                  04790099
048000*---------------------------------------------------------------- 04800099
048100*    DB2 DCLGEN FOR THE RECEIVER DISTRIBUTION TABLE               04810099
048200*----------------------------------------------------------------*04820099
048300     EXEC SQL                                                     04830099
048400          INCLUDE TRECDIS                                         04840099
048500     END-EXEC.                                                    04850099
048600                                                                  04860099
048700*----------------------------------------------------------------*04870099
048800*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          04880099
048900*---------------------------------------------------------------- 04890099
049000     EXEC SQL                                                     04900099
049100          INCLUDE TPURCHS                                         04910099
049200     END-EXEC.                                                    04920099
049300                                                                  04930099
049400*----------------------------------------------------------------*04940099
049500*    DB2 DCLGEN FOR PURCHASE ORDER STATUS CODE TABLE              04950099
049600*----------------------------------------------------------------*04960099
049700     EXEC SQL                                                     04970099
049800          INCLUDE TSTATCD                                         04980099
049900     END-EXEC.                                                    04990099
050000                                                                  05000099
050100*----------------------------------------------------------------*05010099
050200*    DB2 DCLGEN FOR PURCHASE ORDER LINE ITEM TABLE                05020099
050300*----------------------------------------------------------------*05030099
050400     EXEC SQL                                                     05040099
050500          INCLUDE TPURITM                                         05050099
050600     END-EXEC.                                                    05060099
050700                                                                  05070099
050800*----------------------------------------------------------------*05080099
050900*    DB2 DCLGEN FOR THE TROUBLE NOTIFICATION TABLE                05090099
051000*---------------------------------------------------------------- 05100099
051100     EXEC SQL                                                     05110099
051200          INCLUDE TTRBNTF                                         05120099
051300     END-EXEC.                                                    05130099
051400                                                                  05140099
051500*----------------------------------------------------------------*05150099
051600*    DB2 DCLGEN FOR THE TROUBLE REASON CODE TABLE                 05160099
051700*----------------------------------------------------------------*05170099
051800     EXEC SQL                                                     05180099
051900          INCLUDE TTRBRSN                                         05190099
052000     END-EXEC.                                                    05200099
052100                                                                  05210099
052200******************************************************************05220099
052300*    DB2 DCLGEN FOR THE PRE TICKET REQUEST TABLE                  05230099
052400******************************************************************05240099
052500     EXEC SQL                                                     05250099
052600          INCLUDE TPTKREQ                                         05260099
052700     END-EXEC.                                                    05270099
052800                                                                  05280099
052900******************************************************************05290099
053000*   DB2 DCLGEN FOR THE TICKET FORMAT TABLE                        05300099
053100******************************************************************05310099
053200     EXEC SQL                                                     05320099
053300          INCLUDE TTKTFMT                                         05330099
053400     END-EXEC.                                                    05340099
053500                                                                  05350099
053600******************************************************************05360099
053700*    DB2 DCLGEN FOR THE PRE TICKET LINE DETAIL TABLE              05370099
053800******************************************************************05380099
053900     EXEC SQL                                                     05390099
054000          INCLUDE TPTKLNE                                         05400099
054100     END-EXEC.                                                    05410099
054200******************************************************************05420099
054300*    DB2 DCLGEN FOR THE TMDSEAR TABLE                             05430099
054400******************************************************************05440099
054500     EXEC SQL                                                     05450099
054600          INCLUDE TMDSEAR                                         05460099
054700     END-EXEC.                                                    05470099
054800******************************************************************05480099
054900*    DB2 DCLGEN FOR THE TDCVSVL TABLE                             05490099
055000******************************************************************05500099
055100     EXEC SQL                                                     05510099
055200          INCLUDE TDCVSVL                                         05520099
055300     END-EXEC.                                                    05530099
055400                                                                  05540099
055500******************************************************************05550099
055600*    DB2 DCLGEN FOR THE TDCVSVL TABLE                             05560099
055700******************************************************************05570099
055800     EXEC SQL                                                     05580099
055900          INCLUDE TVSCHVL                                         05590099
056000     END-EXEC.                                                    05600099
056100                                                                  05610099
056200******************************************************************05620099
056300*    DB2 DCLGEN FOR THE TVNDSTL TABLE                             05630099
056400******************************************************************05640099
056500     EXEC SQL                                                     05650099
056600          INCLUDE TVNDSTL                                         05660099
056700     END-EXEC.                                                    05670099
056800                                                                  05680099
056900******************************************************************05690099
057000*    DB2 DCLGEN FOR THE TMDARVS TABLE                             05700099
057100******************************************************************05710099
057200     EXEC SQL                                                     05720099
057300          INCLUDE TMDARVS                                         05730099
057400     END-EXEC.                                                    05740099
057500                                                                  05750099
057600******************************************************************05760099
057700*    DB2 DCLGEN FOR THE ODD UNIT TABLE                            05770099
057800******************************************************************05780099
057900     EXEC SQL                                                     05790099
058000          INCLUDE RCT00009                                        05800099
058100     END-EXEC.                                                    05810099
058200                                                                  05820099
058300*---------------------------------------------------------------* 05830099
058400*  CURSOR TO LIST TRECITM                                       * 05840099
058500*---------------------------------------------------------------* 05850099
058600                                                                  05860099
058700     EXEC SQL                                                     05870099
058800          DECLARE TRECITM-CSR CURSOR FOR                          05880099
058900           SELECT ORD_LNE_NBR                                     05890099
059000                , STATUS_CDE                                      05900099
059100                , CASE_PACK_QTY                                   05910099
059200                , DTL_CK_ITM_QTY                                  05920099
059300                , PKSL_ITM_QTY                                    05930099
059400                , PREPK_RATO_QTY                                  05940099
059500                , PREPK_ODD_UNT_QTY                               05950099
059600                , PREPK_DRV_LNE_CDE                               05960099
059700           FROM   TRECITM                                         05970099
059800           WHERE  OPER_UNT_ID    = :DK-OPER-UNT-ID                05980099
059900             AND  FCLTY_ID       = :DK-FCLTY-ID                   05990099
060000             AND  ORD_NBR        = :DK-PO-NBR                     06000099
060100             AND  ORD_LNE_NBR    > 0                              06010099
060200             AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR                06020099
060300             AND  PREPK_ID       = :DK-PACK-ID                    06030099
060400                AND (PREPK_RATO_QTY > 0                           06040099
060500                 OR (PREPK_RATO_QTY = 0                           06050099
060600                AND  DTL_CK_ITM_QTY > 0))                         06060099
060700             AND  VER_STATUS_CDE = 'A'                            06070099
060800     END-EXEC.                                                    06080099
060900                                                                  06090099
061000     EXEC SQL                                                     06100099
061100          DECLARE TKTFMT-CURSOR  CURSOR FOR                       06110099
061200           SELECT TKT_DESC,                                       06120099
061300                  A.ACTL_PRT_DTE,                                 06130099
061400                  A.PRT_TM                                        06140099
061500             FROM TPTKREQ A                                       06150099
061600                 ,TPTKLNE B                                       06160099
061700             WHERE A.PO_NBR     = :DK-PO-NBR                      06170099
061800               AND A.PO_REQ_NBR = B.PO_REQ_NBR                    06180099
061900               AND B.PO_LNE_NBR = :DK-PO-LNE-NBR                  06190099
062000         ORDER BY A.ACTL_PRT_DTE DESC, A.PRT_TM DESC              06200099
062100     END-EXEC.                                                    06210099
062200                                                                  06220099
062300                                                                  06230099
062400 LINKAGE SECTION.                                                 06240099
062500                                                                  06250099
062600 01  DFHCOMMAREA.                                                 06260099
062700     05  FILLER                       OCCURS  1 TO 4072 TIMES     06270099
062800                                      DEPENDING ON EIBCALEN.      06280099
062900         10  FILLER                   PIC X.                      06290099
063000                                                                  06300099
063100                                                                  06310099
063200 PROCEDURE DIVISION.                                              06320099
063300                                                                  06330099
063400*----------------------------------------------------------------*06340099
063500*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *06350099
063600*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *06360099
063700*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *06370099
063800*                                                                *06380099
063900*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *06390099
064000*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *06400099
064100*----------------------------------------------------------------*06410099
064200 0000-MAIN-MODULE.                                                06420099
064300                                                                  06430099
064400     INITIALIZE DP030-CICS-API-FIELDS.                            06440099
064500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06450099
064600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06460099
064700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06470099
064800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06480099
064900     MOVE LENGTH OF RC803AI        TO DP030-MAP-LENGTH (1).       06490099
065000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06500099
065100     PERFORM 0001-CALL-CICS-ARCH-API.                             06510099
065200                                                                  06520099
065300     PERFORM 1000-CONTROL-PROCESSING.                             06530099
065400                                                                  06540099
065500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06550099
065600     PERFORM 0001-CALL-CICS-ARCH-API.                             06560099
065700                                                                  06570099
065800                                                                  06580099
065900 0001-CALL-CICS-ARCH-API.                                         06590099
066000                                                                  06600099
066110     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06611099
066200                                    DFHCOMMAREA                   06620099
066300                                    DP030-CICS-API-FIELDS         06630099
066400                                    DP020-STANDARD-COMMAREA       06640099
066500                                    RC803AI.                      06650099
066600                                                                  06660099
066700     IF  DP030-RC-CALL-SUCCESSFUL                                 06670099
066800         CONTINUE                                                 06680099
066900     ELSE                                                         06690099
067000         SET DP013-NO-ROLLBACK                                    06700099
067100             DP013-XCTL-DISPLAY-RESTART                           06710099
067200             DP013-CICS-ABEND      TO TRUE                        06720099
067300         MOVE 'BEFORE 0000-MAIN-MODULE'                           06730099
067400                                   TO DP013-PARAGRAPH             06740099
067420         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O06742099
067430-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06743099
067700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06770099
067800         PERFORM DP013-0000-PROCESS-ABEND                         06780099
067900     END-IF.                                                      06790099
068000                                                                  06800099
068100                                                                  06810099
068200*----------------------------------------------------------------*06820099
068300*   PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   * 06830099
068400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *06840099
068500*----------------------------------------------------------------*06850099
068600                                                                  06860099
068700 1000-CONTROL-PROCESSING.                                         06870099
068800                                                                  06880099
068900     EVALUATE TRUE                                                06890099
069000         WHEN DP020-NEXT-ACT-INITIAL                              06900099
069100              INITIALIZE ASC-SPECIFIC-COMMAREA                    06910099
069200              PERFORM 1100-PROCESS-INTER-APPL-COMM                06920099
069300              PERFORM 4000-BUILD-INITIAL-PANEL                    06930099
069400              PERFORM 3200-RESET-ATTRIBUTES                       06940099
069500                                                                  06950099
069600         WHEN DP020-NEXT-ACT-READ-MAP                             06960099
069700              PERFORM 2000-PROCESS-PANEL                          06970099
069800                                                                  06980099
069900         WHEN DP020-NEXT-ACT-RETURN                               06990099
070000             SUBTRACT +1      FROM ASC-SEL-ITEM                   07000099
070100             PERFORM 3200-RESET-ATTRIBUTES                        07010099
070200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07020099
070300                                                                  07030099
070400         WHEN OTHER                                               07040099
070500              SET DP013-LOGIC-ABEND                               07050099
070600                  DP013-NO-ROLLBACK                               07060099
070700                                   TO TRUE                        07070099
070800              MOVE '1000-CONTROL-PROCESSING'                      07080099
070900                                   TO DP013-PARAGRAPH             07090099
071000              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  07100099
071100                                   TO DP013-MESSAGE-TEXT(1)       07110099
071200              MOVE DP020-NEXT-APPL-ACTIVITY                       07120099
071300                                   TO DP013-MESSAGE-TEXT(2)       07130099
071400              PERFORM DP013-0000-PROCESS-ABEND                    07140099
071500     END-EVALUATE.                                                07150099
071600                                                                  07160099
071700                                                                  07170099
071800*----------------------------------------------------------------*07180099
071900*    SAVE THE KEYS PASSED IN THE INTER-APPL COMMAREA             *07190099
072000*----------------------------------------------------------------*07200099
072100 1100-PROCESS-INTER-APPL-COMM.                                    07210099
072200                                                                  07220099
072300     SET PS-COMMAREA-VALID         TO TRUE.                       07230099
072400                                                                  07240099
072500     IF RC800-NUMBER-OF-SELECTED-ITEMS = ZERO                     07250099
072600         MOVE PC-TSYMSG-00057      TO DP020-MSG-NUMBER            07260099
072700         SET DP020-MSG-FATAL       TO TRUE                        07270099
072800         SET DP020-NEXT-ACT-APPL-ERROR                            07280099
072900                                   TO TRUE                        07290099
073000         SET PS-ERROR              TO TRUE                        07300099
073100     ELSE                                                         07310099
073200         SET ASC-USE-SELECTION-QUEUE                              07320099
073300                                   TO TRUE                        07330099
073400         MOVE RC800-NUMBER-OF-SELECTED-ITEMS                      07340099
073500                                   TO ASC-NUMBER-OF-SELECTED-ITEMS07350099
073600         MOVE RC800-NUMBER-OF-TS-ITEMS                            07360099
073700                                   TO ASC-NUMBER-OF-TS-ITEMS      07370099
073800         MOVE RC800-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME          07380099
073900         PERFORM 1120-PREPARE-LIST-ENTRY                          07390099
074000         SET ASC-UPDATE-PENDING    TO TRUE                        07400099
074100     END-IF.                                                      07410099
074200                                                                  07420099
074300                                                                  07430099
074400                                                                  07440099
074500*----------------------------------------------------------------*07450099
074600*    ENTRY IS FROM A LIST.  GET THE PO NUMBER FROM THE           *07460099
074700*    TEMP STORAGE QUEUE PASSED FROM THE LIST.                    *07470099
074800*----------------------------------------------------------------*07480099
074900 1120-PREPARE-LIST-ENTRY.                                         07490099
075000                                                                  07500099
075100     MOVE RC801-MAX-ITEMS          TO ASC-SEL-SUB.                07510099
075200     MOVE ZERO                     TO ASC-SEL-ITEM.               07520099
075300                                                                  07530099
075400     PERFORM 2110-GET-NEXT-RECITM-SELECT.                         07540099
075500                                                                  07550099
075600                                                                  07560099
075700*----------------------------------------------------------------*07570099
075800*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*07580099
075900*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*07590099
076000*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *07600099
076100*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *07610099
076200*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *07620099
076300*----------------------------------------------------------------*07630099
076400                                                                  07640099
076500 2000-PROCESS-PANEL.                                              07650099
076600                                                                  07660099
076700     EVALUATE TRUE                                                07670099
076800                                                                  07680099
076900                                                                  07690099
077000         WHEN DP020-SRC-AID = DP016-CLEAR                         07700099
077100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07710099
077200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07720099
077300                                                                  07730099
077400         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     07740099
077500             PERFORM 2020-PREPARE-SELECT                          07750099
077600             PERFORM 2050-SELECT-TRECITM                          07760099
077700             PERFORM 4000-BUILD-INITIAL-PANEL                     07770099
077800             PERFORM 3200-RESET-ATTRIBUTES                        07780099
077900                                                                  07790099
078000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07800099
078100             IF ASC-USE-SELECTION-QUEUE                           07810099
078200                 PERFORM 2110-GET-NEXT-RECITM-SELECT              07820099
078300                 PERFORM 2020-PREPARE-SELECT                      07830099
078400                 PERFORM 2050-SELECT-TRECITM                      07840099
078500                 PERFORM 4000-BUILD-INITIAL-PANEL                 07850099
078600                 PERFORM 3200-RESET-ATTRIBUTES                    07860099
078700             ELSE                                                 07870099
078800*                --- BOTTOM OF LIST ---                           07880099
078900                 MOVE PC-TSYMSG-00070                             07890099
079000                                   TO DP020-MSG-NUMBER            07900099
079100                 SET DP020-MSG-INFORMATIONAL                      07910099
079200                                   TO TRUE                        07920099
079300             END-IF                                               07930099
079400                                                                  07940099
079500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07950099
079600             IF  ASC-USE-SELECTION-QUEUE                          07960099
079700                 PERFORM 2120-GET-PREV-RECITM-SELECT              07970099
079800                 IF PS-LIST-END                                   07980099
079900                     SET PS-NO-LIST-END                           07990099
080000                                   TO TRUE                        08000099
080100                 ELSE                                             08010099
080200                     PERFORM 2020-PREPARE-SELECT                  08020099
080300                     PERFORM 2050-SELECT-TRECITM                  08030099
080400                     PERFORM 4000-BUILD-INITIAL-PANEL             08040099
080500                     PERFORM 3200-RESET-ATTRIBUTES                08050099
080600                 END-IF                                           08060099
080700             ELSE                                                 08070099
080800*                --- TOP OF LIST ---                              08080099
080900                 MOVE PC-TSYMSG-00069                             08090099
081000                                   TO DP020-MSG-NUMBER            08100099
081100                 SET DP020-MSG-INFORMATIONAL                      08110099
081200                     PS-LIST-END   TO TRUE                        08120099
081300             END-IF                                               08130099
081400                                                                  08140099
081500         WHEN OTHER                                               08150099
081600              IF  ASC-NOT-FOUND                                   08160099
081700                  MOVE PC-TSYMSG-00148                            08170099
081800                                   TO  DP020-MSG-NUMBER           08180099
081900                  SET DP020-MSG-FATAL                             08190099
082000                          PS-ERROR TO  TRUE                       08200099
082100              ELSE                                                08210099
082200                  PERFORM 2200-MOVE-SCREEN-TO-COMMAREA            08220099
082300                  PERFORM 3000-EDIT-DATA-IN-COMMAREA              08230099
082400                  IF  PS-NO-ERROR                                 08240099
082500                      SET DP030-CONTINUE-GO                       08250099
082600                                   TO TRUE                        08260099
082700                      PERFORM 2100-CHECK-FUNCTION-KEY             08270099
082800                  ELSE                                            08280099
082900                      SET DP030-OVERRIDE-GO                       08290099
083000                                   TO TRUE                        08300099
083100                  END-IF                                          08310099
083200              END-IF                                              08320099
083300     END-EVALUATE.                                                08330099
083400                                                                  08340099
083500                                                                  08350099
083600*----------------------------------------------------------------*08360099
083700*  PREPARE THE SELECT CRITERIA                                   *08370099
083800*----------------------------------------------------------------*08380099
083900 2020-PREPARE-SELECT.                                             08390099
084000     MOVE ASC-PO-NBR               TO DK-PO-NBR.                  08400099
084100     MOVE ASC-PO-LNE-NBR-N         TO DK-PO-LNE-NBR.              08410099
084200     MOVE ASC-REC-SEQ-NBR          TO DK-REC-SEQ-NBR.             08420099
084300                                                                  08430099
084400     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.             08440099
084500     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                08450099
084600     MOVE ASC-PACK-ID              TO DK-PACK-ID.                 08460099
084700                                                                  08470099
084800                                                                  08480099
084900*----------------------------------------------------------------*08490099
085000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08500099
085100*----------------------------------------------------------------*08510099
085200 2040-DELETE-LIST-QUEUE.                                          08520099
085300                                                                  08530099
085400     EXEC CICS                                                    08540099
085500         DELETEQ TS                                               08550099
085600           QUEUE (ASC-SEL-QUEUE-NAME)                             08560099
085700           RESP  (PV-CICS-RESPONSE)                               08570099
085800     END-EXEC.                                                    08580099
085900                                                                  08590099
086000     IF (PV-CICS-RESPONSE = DFHRESP(NORMAL)) OR                   08600099
086100        (PV-CICS-RESPONSE = DFHRESP(QIDERR))                      08610099
086200         CONTINUE                                                 08620099
086300     ELSE                                                         08630099
086400         SET DP013-CICS-ABEND      TO TRUE                        08640099
086500         SET DP013-NO-ROLLBACK     TO TRUE                        08650099
086600                                                                  08660099
086700         MOVE '2040-DELETE-LIST-QUEUE'                            08670099
086800                                   TO DP013-PARAGRAPH             08680099
086900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08690099
087000                                   TO DP013-MESSAGE-TEXT (1)      08700099
087100         PERFORM DP013-0000-PROCESS-ABEND                         08710099
087200     END-IF.                                                      08720099
087300                                                                  08730099
087400/                                                                 08740099
087500 2050-SELECT-TRECITM.                                             08750099
087600     EXEC SQL                                                     08760099
087700          SELECT  STATUS_CDE                                      08770099
087800                 ,EXPTED_CART_CNT                                 08780099
087900                 ,ACTL_CART_CNT                                   08790099
088000                 ,DTL_CK_ITM_QTY                                  08800099
088100          INTO   :RECITM-STATUS-CDE                               08810099
088200                ,:RECITM-EXPTED-CART-CNT                          08820099
088300                ,:RECITM-ACTL-CART-CNT                            08830099
088400                ,:RECITM-DTL-CK-ITM-QTY                           08840099
088500          FROM  TRECITM                                           08850099
088600          WHERE ORD_NBR            =  :DK-PO-NBR                  08860099
088700          AND   ORD_LNE_NBR        =  :DK-PO-LNE-NBR              08870099
088800          AND   REC_SEQ_NBR        =  :DK-REC-SEQ-NBR             08880099
088900          AND   OPER_UNT_ID        =  :DK-OPER-UNT-ID             08890099
089000          AND   FCLTY_ID           =  :DK-FCLTY-ID                08900099
089100          AND   VER_STATUS_CDE     =  :PC-A                       08910099
089200     END-EXEC.                                                    08920099
089300                                                                  08930099
089400     EVALUATE TRUE                                                08940099
089500         WHEN SQLCODE = ZERO                                      08950099
089600              CONTINUE                                            08960099
089700         WHEN SQLCODE = +100                                      08970099
089800             MOVE SPACES TO RECITM-STATUS-CDE                     08980099
089900         WHEN SQLCODE = -904                                      08990099
090000         WHEN SQLCODE = -911                                      09000099
090100         WHEN SQLCODE = -913                                      09010099
090200              PERFORM 9900-SOFT-ABORT                             09020099
090300                                                                  09030099
090400         WHEN SQLWARN0 NOT = SPACE                                09040099
090500         WHEN SQLCODE NOT = ZERO                                  09050099
090600              MOVE '2050-SELECT-TRECITM'                          09060099
090700                               TO DP013-PARAGRAPH                 09070099
090800              MOVE 'SELECT STATUS CODE'                           09080099
090900                               TO DP013-MESSAGE-TEXT (1)          09090099
091000              MOVE SQLCA       TO DP013-SQLCA                     09100099
091100              MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)        09110099
091200              SET DP013-DB2-ABEND                                 09120099
091300                               TO TRUE                            09130099
091400              PERFORM DP013-0000-PROCESS-ABEND                    09140099
091500     END-EVALUATE.                                                09150099
091600                                                                  09160099
091700                                                                  09170099
091800/                                                                 09180099
091900*----------------------------------------------------------------*09190099
092000*    SELECT RECTIM TO GET INITIAL INFORMATION TO DETERMINE IF AN *09200099
092100**   UPDATE IS NEEDED.                                           *09210099
092200*----------------------------------------------------------------*09220099
092300 2051-SELECT-ORIG-RECITM.                                         09230099
092400                                                                  09240099
092500         EXEC SQL                                                 09250099
092600              SELECT  PKSL_ITM_QTY                                09260099
092700                     ,DTL_CK_ITM_QTY                              09270099
092800                     ,CASE_PACK_QTY                               09280099
092900                     ,RCPT_DISTR_UPD_CDE                          09290099
093000                     ,PREPK_ID                                    09300099
093100                     ,PREPK_RATO_QTY                              09310099
093200                     ,PREPK_ODD_UNT_QTY                           09320099
093300                     ,PREPK_DRV_LNE_CDE                           09330099
093400                INTO :RECITM-PKSL-ITM-QTY                         09340099
093500                    ,:RECITM-DTL-CK-ITM-QTY                       09350099
093600                    ,:RECITM-CASE-PACK-QTY                        09360099
093700                    ,:RECITM-RCPT-DISTR-UPD-CDE                   09370099
093800                    ,:RECITM-PREPK-ID                             09380099
093900                    ,:RECITM-PREPK-RATO-QTY                       09390099
094000                    ,:RECITM-PREPK-ODD-UNT-QTY                    09400099
094100                    ,:RECITM-PREPK-DRV-LNE-CDE                    09410099
094200                FROM TRECITM                                      09420099
094300               WHERE  ORD_NBR        = :DK-PO-NBR                 09430099
094400                 AND  ORD_LNE_NBR    = :DK-PO-LNE-NBR             09440099
094500                 AND  REC_SEQ_NBR    = :DK-REC-SEQ-NBR            09450099
094600                 AND  OPER_UNT_ID    = :DK-OPER-UNT-ID            09460099
094700                 AND  FCLTY_ID       = :DK-FCLTY-ID               09470099
094800                 AND  VER_STATUS_CDE = 'A'                        09480099
094900                 AND  PREPK_ID       = :DK-PACK-ID                09490099
095000         END-EXEC                                                 09500099
095100                                                                  09510099
095200         EVALUATE TRUE                                            09520099
095300             WHEN SQLCODE = +0                                    09530099
095400             WHEN SQLCODE = +100                                  09540099
095500                  CONTINUE                                        09550099
095600             WHEN SQLCODE = -904                                  09560099
095700             WHEN SQLCODE = -911                                  09570099
095800             WHEN SQLCODE = -913                                  09580099
095900                  PERFORM 9900-SOFT-ABORT                         09590099
096000                                                                  09600099
096100             WHEN SQLWARN0 NOT = SPACES                           09610099
096200             WHEN SQLCODE < +0                                    09620099
096300             WHEN SQLCODE > +0                                    09630099
096400                  MOVE '2051-SELECT-ORIG-RECITM'                  09640099
096500                                  TO DP013-PARAGRAPH              09650099
096600                  MOVE 'UNSUCCESSFUL SELECT ON TRECITM'           09660099
096700                                  TO DP013-MESSAGE-TEXT (1)       09670099
096800                  MOVE SQLCA      TO DP013-SQLCA                  09680099
096900                  MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)     09690099
097000                  SET DP013-DB2-ABEND                             09700099
097100                      DP013-XCTL-DISPLAY-RESTART                  09710099
097200                                  TO TRUE                         09720099
097300                  PERFORM DP013-0000-PROCESS-ABEND                09730099
097400         END-EVALUATE.                                            09740099
097500                                                                  09750099
097600                                                                  09760099
097700                                                                  09770099
097800*----------------------------------------------------------------*09780099
097900*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *09790099
098000**   FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*09800099
098100*    FROM THE CICS ARCHITECTURE API.                             *09810099
098200*----------------------------------------------------------------*09820099
098300                                                                  09830099
098400 2100-CHECK-FUNCTION-KEY.                                         09840099
098500                                                                  09850099
098600     EVALUATE TRUE                                                09860099
098700         WHEN DP020-SRC-AID = DP016-ENTER                         09870099
098800             CONTINUE                                             09880099
098900                                                                  09890099
099000*  ADD LINE                                                       09900099
099100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09910099
099200             SET DP030-CONTINUE-GO TO TRUE                        09920099
099300             IF  ASC-RECITM-SETUP-PREV                            09930099
099400                 MOVE PC-TSYMSG-00117                             09940099
099500                                   TO DP020-MSG-NUMBER            09950099
099600                 SET DP020-MSG-INFORMATIONAL                      09960099
099700                     DP030-OVERRIDE-GO                            09970099
099800                                   TO TRUE                        09980099
099900             ELSE                                                 09990099
100000                IF ASC-DTL-PACK-RATIO-N NOT > 0                   10000099
100100                   MOVE PC-TSYMSG-02179   TO DP020-MSG-NUMBER     10010099
100200                   SET DP020-MSG-WARNING                          10020099
100300                       DP030-OVERRIDE-GO                          10030099
100400                                   TO TRUE                        10040099
100500                ELSE                                              10050099
100600                IF ASC-PKSL-ITM-QTY = 0   AND                     10060099
100700                   ASC-DTL-CK-ITM-QTY-N NOT > 0                   10070099
100800                   MOVE PC-TSYMSG-02183   TO DP020-MSG-NUMBER     10080099
100900                   SET DP020-MSG-WARNING                          10090099
101000                       DP030-OVERRIDE-GO                          10100099
101100                                   TO TRUE                        10110099
101200                ELSE                                              10120099
101300                   PERFORM 5000-ADD-RECITM                        10130099
101400                   IF PV-PACK-BY-ST-IND = PC-Y                    10140099
101500                      CONTINUE                                    10150099
101600                   ELSE                                           10160099
101700                       SET DP030-OVERRIDE-GO TO TRUE              10170099
101800                   END-IF                                         10180099
101900                   INITIALIZE RC806-PRODUCT-PACK-VALIDATION       10190099
102000                   PERFORM 4500-CHECK-VALIDATION                  10200099
102100                   PERFORM 4030-GET-TROUBLE-DESC                  10210099
102200                   PERFORM 9040-CHECK-FOR-TROUBLE                 10220099
102300                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN           10230099
102400                END-IF                                            10240099
102500                END-IF                                            10250099
102600                MOVE ASC-PO-NBR       TO RC800-REC-NBR-N          10260099
102700                MOVE ASC-PO-LNE-NBR-N TO RC800-LINE-NBR-N         10270099
102800                MOVE ASC-REC-SEQ-NBR  TO RC800-REC-SEQ-NBR-N      10280099
102900                MOVE ASC-OPER-UNT-ID  TO RC800-OPER-UNIT-ID       10290099
103000                MOVE ASC-FCLTY-ID     TO RC800-FACILITY-ID        10300099
103100                MOVE ASC-NUMBER-OF-SELECTED-ITEMS                 10310099
103200                                   TO                             10320099
103300                                 RC800-NUMBER-OF-SELECTED-ITEMS   10330099
103400                MOVE ASC-NUMBER-OF-TS-ITEMS                       10340099
103500                                   TO RC800-NUMBER-OF-TS-ITEMS    10350099
103600             END-IF                                               10360099
103700                                                                  10370099
103800*** GOTO STORE DISTRO BY PACK (RCLPKST)                           10380099
103900         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              10390099
104000             PERFORM 4300-PREPARE-SEL-QUEUE                       10400099
104100                                                                  10410099
104200*** GOTO TROUBLE LIST                                             10420099
104300         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              10430099
104400             MOVE ASC-OPER-UNT-ID TO PC000-OPERATING-UNIT-ID      10440099
104500             MOVE ASC-FCLTY-ID    TO PC000-FACILITY-ID            10450099
104600             MOVE ASC-PO-NBR      TO PC000-PO-NBR-N               10460099
104700             MOVE ASC-REC-SEQ-NBR                                 10470099
104800                                  TO PC000-REC-SEQ-NBR-N          10480099
104900             MOVE ASC-PO-LNE-NBR-N                                10490099
105000                                  TO PC000-LINE-NBR-N             10500099
105100                                                                  10510099
105200                                                                  10520099
105300*** GO TO  PURCHASE LINE SUMMARY (POLINLN)                        10530099
105400         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              10540099
105500              MOVE ASC-PO-NBR      TO PO017-PO-NBR                10550099
105600                                                                  10560099
105700*** GOTO TROUBLE CREATE (TMLDCLNE)                                10570099
105800          WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)             10580099
105900             PERFORM 4300-PREPARE-SEL-QUEUE                       10590099
106000              MOVE ASC-PO-NBR  TO PC000-PO-NBR-N                  10600099
106100              MOVE ASC-REC-SEQ-NBR                                10610099
106200                               TO PC000-REC-SEQ-NBR-N             10620099
106300              MOVE ASC-OPER-UNT-ID                                10630099
106400                               TO PC000-OPERATING-UNIT-ID         10640099
106500              MOVE ASC-FCLTY-ID                                   10650099
106600                               TO PC000-FACILITY-ID               10660099
106700                                                                  10670099
106800         WHEN OTHER                                               10680099
106900             SET DP013-NO-ROLLBACK                                10690099
107000                 DP013-XCTL-DISPLAY-RESTART                       10700099
107100                 DP013-CICS-ABEND  TO TRUE                        10710099
107200             MOVE '2100-CHECK-FUNCTION-KEY'                       10720099
107300                                   TO DP013-PARAGRAPH             10730099
107400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10740099
107500                                   TO DP013-MESSAGE-TEXT (1)      10750099
107600             PERFORM DP013-0000-PROCESS-ABEND                     10760099
107700     END-EVALUATE.                                                10770099
107800                                                                  10780099
107900                                                                  10790099
108000*----------------------------------------------------------------*10800099
108100*    GET THE RECITM (KEY) OF THE NEXT SELECTED OBJECT            *10810099
108200*    FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.                *10820099
108300*----------------------------------------------------------------*10830099
108400 2110-GET-NEXT-RECITM-SELECT.                                     10840099
108500                                                                  10850099
108600     INITIALIZE RC801-SELECTED-ITEM-ARRAY                         10860099
108700     ADD +1                        TO ASC-SEL-SUB.                10870099
108800     IF  ASC-SEL-SUB > RC801-MAX-ITEMS                            10880099
108900         ADD +1                    TO ASC-SEL-ITEM                10890099
109000         MOVE +1                   TO ASC-SEL-SUB                 10900099
109100     END-IF.                                                      10910099
109200                                                                  10920099
109300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                10930099
109400         PERFORM 9100-READ-SEL-QUEUE                              10940099
109500         IF  RC801-ITEM (ASC-SEL-SUB) > ZERO                      10950099
109600             MOVE RC801-REC-LNE-NBR (ASC-SEL-SUB)                 10960099
109700                                   TO ASC-PO-LNE-NBR-N            10970099
109800                                      DK-PO-LNE-NBR               10980099
109900             MOVE RC800-REC-NBR-N  TO DK-PO-NBR                   10990099
110000                                      ASC-PO-NBR                  11000099
110100             MOVE RC800-REC-SEQ-NBR-N                             11010099
110200                                   TO ASC-REC-SEQ-NBR             11020099
110300                                      DK-REC-SEQ-NBR              11030099
110400             MOVE RC800-OPER-UNIT-ID                              11040099
110500                                   TO ASC-OPER-UNT-ID             11050099
110600                                      DK-OPER-UNT-ID              11060099
110700             MOVE RC800-FACILITY-ID                               11070099
110800                                   TO ASC-FCLTY-ID                11080099
110900                                      DK-FCLTY-ID                 11090099
111000             MOVE RC800-PACK-ID    TO ASC-PACK-ID                 11100099
111100                                      RC801-PACK-ID (ASC-SEL-SUB) 11110099
111200                                      DK-PACK-ID                  11120099
111300             MOVE RC800-PREPACK-DESC                              11130099
111400                                   TO ASC-PACK-DESC               11140099
111500                                      RC801-PACK-DESC             11150099
111600                                                    (ASC-SEL-SUB) 11160099
111700                                                                  11170099
111800             IF RC801-UPD (ASC-SEL-SUB)                           11180099
111900                 SET ASC-RECITM-SETUP-PREV                        11190099
112000                                   TO TRUE                        11200099
112100             ELSE                                                 11210099
112200                 SET ASC-RECITM-NOT-SETUP-PREV                    11220099
112300                                   TO TRUE                        11230099
112400             END-IF                                               11240099
112500             IF NOT RC801-UPD (ASC-SEL-SUB)                       11250099
112600                SET RC801-INQ (ASC-SEL-SUB)                       11260099
112700                                   TO TRUE                        11270099
112800                PERFORM 9200-REWRITE-SEL-QUEUE                    11280099
112900             END-IF                                               11290099
113000         ELSE                                                     11300099
113100             SUBTRACT +1 FROM ASC-SEL-SUB                         11310099
113200*            --- BOTTOM OF LIST ---                               11320099
113300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11330099
113400             SET DP020-MSG-INFORMATIONAL                          11340099
113500                 PS-LIST-END                                      11350099
113600                                   TO TRUE                        11360099
113700         END-IF                                                   11370099
113800     ELSE                                                         11380099
113900         SUBTRACT +1 FROM ASC-SEL-ITEM                            11390099
114000         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 11400099
114100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11410099
114200         SET DP020-MSG-INFORMATIONAL                              11420099
114300             PS-LIST-END           TO TRUE                        11430099
114400     END-IF.                                                      11440099
114500                                                                  11450099
114600                                                                  11460099
114700*----------------------------------------------------------------*11470099
114800*    GET THE RECITM (KEY) OF THE PREVIOUS SELECTED               *11480099
114900**   OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.         *11490099
115000*----------------------------------------------------------------*11500099
115100 2120-GET-PREV-RECITM-SELECT.                                     11510099
115200                                                                  11520099
115300     SUBTRACT +1 FROM ASC-SEL-SUB.                                11530099
115400                                                                  11540099
115500     IF  ASC-SEL-SUB < +1                                         11550099
115600         SUBTRACT +1 FROM ASC-SEL-ITEM                            11560099
115700         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 11570099
115800     END-IF.                                                      11580099
115900                                                                  11590099
116000     IF  ASC-SEL-ITEM > ZERO                                      11600099
116100         PERFORM 9100-READ-SEL-QUEUE                              11610099
116200         INITIALIZE ASC-SCREEN-FIELDS                             11620099
116300         MOVE RC801-REC-LNE-NBR (ASC-SEL-SUB)                     11630099
116400                                   TO ASC-PO-LNE-NBR-N            11640099
116500                                      DK-PO-LNE-NBR               11650099
116600                                                                  11660099
116700         MOVE RC800-REC-NBR-N      TO DK-PO-NBR                   11670099
116800                                      ASC-PO-NBR                  11680099
116900                                                                  11690099
117000         MOVE RC800-REC-SEQ-NBR-N  TO ASC-REC-SEQ-NBR             11700099
117100                                      DK-REC-SEQ-NBR              11710099
117200                                                                  11720099
117300         MOVE RC800-OPER-UNIT-ID   TO ASC-OPER-UNT-ID             11730099
117400                                                                  11740099
117500         MOVE RC800-FACILITY-ID    TO ASC-FCLTY-ID                11750099
117600         MOVE RC801-PACK-ID  (ASC-SEL-SUB)                        11760099
117700                                   TO ASC-PACK-ID                 11770099
117800                                      DK-PACK-ID                  11780099
117900         MOVE RC801-PACK-DESC  (ASC-SEL-SUB)                      11790099
118000                                   TO ASC-PACK-DESC               11800099
118100         IF RC801-UPD (ASC-SEL-SUB)                               11810099
118200             SET ASC-RECITM-SETUP-PREV    TO TRUE                 11820099
118300         ELSE                                                     11830099
118400             SET ASC-RECITM-NOT-SETUP-PREV TO TRUE                11840099
118500         END-IF                                                   11850099
118600     ELSE                                                         11860099
118700         MOVE +1                   TO ASC-SEL-ITEM                11870099
118800                                      ASC-SEL-SUB                 11880099
118900*        --- TOP OF LIST ---                                      11890099
119000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11900099
119100         SET DP020-MSG-INFORMATIONAL                              11910099
119200             PS-LIST-END           TO TRUE                        11920099
119300     END-IF.                                                      11930099
119400                                                                  11940099
119500*----------------------------------------------------------------*11950099
119600**   GET THE CURRENT ROW FOR PROCESSING.                         *11960099
119700*----------------------------------------------------------------*11970099
119800                                                                  11980099
119900 2130-CHECK-PACK-BY-STORE.                                        11990099
120000     MOVE ASC-PO-NBR              TO DK-PO-NBR.                   12000099
120100     MOVE ASC-REC-SEQ-NBR         TO DK-REC-SEQ-NBR.              12010099
120200                                                                  12020099
120300     EXEC SQL                                                     12030099
120400          SELECT PACK_BY_ST_IND                                   12040099
120500                ,PKGNG_CDE                                        12050099
120600            INTO :PV-PACK-BY-ST-IND                               12060099
120700                ,:RECEIV-PKGNG-CDE                                12070099
120800            FROM TRECEIV                                          12080099
120900           WHERE ORD_NBR         =  :DK-PO-NBR                    12090099
121000             AND REC_SEQ_NBR     =  :DK-REC-SEQ-NBR               12100099
121100             AND OPER_UNT_ID     =  :DK-OPER-UNT-ID               12110099
121200             AND FCLTY_ID        =  :DK-FCLTY-ID                  12120099
121300             AND VER_STATUS_CDE  =  :PC-A                         12130099
121400     END-EXEC.                                                    12140099
121500                                                                  12150099
121600     EVALUATE TRUE                                                12160099
121700         WHEN SQLCODE = ZERO                                      12170099
121800              MOVE RECEIV-PKGNG-CDE    TO ASC-PKNG-CDE            12180099
121900         WHEN SQLCODE = -904                                      12190099
122000         WHEN SQLCODE = -911                                      12200099
122100         WHEN SQLCODE = -913                                      12210099
122200              PERFORM 9900-SOFT-ABORT                             12220099
122300                                                                  12230099
122400         WHEN SQLWARN0 NOT = SPACE                                12240099
122500         WHEN SQLCODE NOT = ZERO                                  12250099
122600              MOVE '2130-CHECK-PACK-BY-STORE'                     12260099
122700                               TO DP013-PARAGRAPH                 12270099
122800              MOVE 'SELECT TRECEIV'                               12280099
122900                               TO DP013-MESSAGE-TEXT (1)          12290099
123000              MOVE SQLCA       TO DP013-SQLCA                     12300099
123100              MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)        12310099
123200              SET DP013-DB2-ABEND                                 12320099
123300                               TO TRUE                            12330099
123400              PERFORM DP013-0000-PROCESS-ABEND                    12340099
123500     END-EVALUATE.                                                12350099
123600                                                                  12360099
123700*----------------------------------------------------------------*12370099
123800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *12380099
123900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *12390099
124000*----------------------------------------------------------------*12400099
124100 2200-MOVE-SCREEN-TO-COMMAREA.                                    12410099
124200                                                                  12420099
124300     IF ARCRATOL > ZERO                                           12430099
124400         MOVE ARCRATOI             TO ASC-DTL-PACK-RATIO          12440099
124500     ELSE                                                         12450099
124600         IF ARCRATOF = DP015-ERASE-EOF                            12460099
124700             MOVE ZEROS            TO ASC-DTL-PACK-RATIO-N        12470099
124800         END-IF                                                   12480099
124900     END-IF.                                                      12490099
125000                                                                  12500099
125100     IF ADCQTYL > ZERO                                            12510099
125200         MOVE ADCQTYI              TO ASC-DTL-CK-ITM-QTY          12520099
125300     ELSE                                                         12530099
125400         IF ADCQTYF = DP015-ERASE-EOF                             12540099
125500             MOVE ZEROS            TO ASC-DTL-CK-ITM-QTY-N        12550099
125600         END-IF                                                   12560099
125700     END-IF.                                                      12570099
125800                                                                  12580099
125900                                                                  12590099
126000*----------------------------------------------------------------*12600099
126100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12610099
126200*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12620099
126300*----------------------------------------------------------------*12630099
126400 3000-EDIT-DATA-IN-COMMAREA.                                      12640099
126500                                                                  12650099
126600     SET PS-NO-ERROR               TO TRUE.                       12660099
126700                                                                  12670099
126800                                                                  12680099
126900     PERFORM 3200-RESET-ATTRIBUTES.                               12690099
127000                                                                  12700099
127100     IF  ASC-DTL-CK-ITM-QTY > SPACES                              12710099
127200         MOVE ASC-DTL-CK-ITM-QTY   TO DP010I-UNEDITED-FIELD       12720099
127300         MOVE LENGTH OF ASC-DTL-CK-ITM-QTY                        12730099
127400                                   TO DP010I-MAXIMUM-DIGITS       12740099
127500         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     12750099
127600         SET DP010I-NEGATIVE-NOT-ALLOWED                          12760099
127700                                   TO TRUE                        12770099
127800         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12780099
127900              USING DP010I-NUMERIC-EDIT-AREA                      12790099
128000                                                                  12800099
128100         IF  DP010I-ERROR-DETECTED                                12810099
128200             SET PS-ERROR                                         12820099
128300                 DP020-MSG-FATAL   TO TRUE                        12830099
128400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            12840099
128500             MOVE DP015-UNP-NUM-BRT-OFF                           12850099
128600                                   TO ADCQTYA                     12860099
128700             MOVE DP015-RED        TO ADCQTYC                     12870099
128800             MOVE DP015-REVERSE    TO ADCQTYH                     12880099
128900             MOVE -1               TO ADCQTYL                     12890099
129000             SET DP030-SET-CURSOR-APPL-1                          12900099
129100                                   TO TRUE                        12910099
129200         ELSE                                                     12920099
129300             MOVE DP010I-NUMERIC-FIELD                            12930099
129400                                   TO ASC-DTL-CK-ITM-QTY-N        12940099
129500             MOVE ASC-DTL-CK-ITM-QTY-N                            12950099
129600                                   TO ADCQTYO                     12960099
129700         END-IF                                                   12970099
129800     ELSE                                                         12980099
129900         SET PS-ERROR                                             12990099
130000             DP020-MSG-FATAL       TO TRUE                        13000099
130100         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            13010099
130200         MOVE DP015-UNP-NUM-BRT-OFF                               13020099
130300                                   TO ADCQTYA                     13030099
130400         MOVE DP015-RED            TO ADCQTYC                     13040099
130500         MOVE DP015-REVERSE        TO ADCQTYH                     13050099
130600         MOVE -1                   TO ADCQTYL                     13060099
130700     END-IF.                                                      13070099
130800                                                                  13080099
130900     IF  ASC-DTL-PACK-RATIO > SPACES                              13090099
131000         MOVE ASC-DTL-PACK-RATIO   TO DP010I-UNEDITED-FIELD       13100099
131100         MOVE LENGTH OF ASC-DTL-PACK-RATIO                        13110099
131200                                   TO DP010I-MAXIMUM-DIGITS       13120099
131300         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     13130099
131400         SET DP010I-NEGATIVE-NOT-ALLOWED                          13140099
131500                                   TO TRUE                        13150099
131600         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13160099
131700              USING DP010I-NUMERIC-EDIT-AREA                      13170099
131800                                                                  13180099
131900         IF  DP010I-ERROR-DETECTED                                13190099
132000             SET PS-ERROR                                         13200099
132100                 DP020-MSG-FATAL   TO TRUE                        13210099
132200             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            13220099
132300             MOVE DP015-UNP-NUM-BRT-OFF                           13230099
132400                                   TO ARCRATOA                    13240099
132500             MOVE DP015-RED        TO ARCRATOC                    13250099
132600             MOVE DP015-REVERSE    TO ARCRATOH                    13260099
132700             MOVE -1               TO ARCRATOL                    13270099
132800             SET DP030-SET-CURSOR-APPL-1                          13280099
132900                                   TO TRUE                        13290099
133000         ELSE                                                     13300099
133100             MOVE DP010I-NUMERIC-FIELD                            13310099
133200                                   TO ASC-DTL-PACK-RATIO-N        13320099
133300         END-IF                                                   13330099
133400     ELSE                                                         13340099
133500         SET PS-ERROR                                             13350099
133600             DP020-MSG-FATAL   TO TRUE                            13360099
133700         MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER                13370099
133800         MOVE DP015-UNP-NUM-BRT-OFF                               13380099
133900                               TO ARCRATOA                        13390099
134000         MOVE DP015-RED        TO ARCRATOC                        13400099
134100         MOVE DP015-REVERSE    TO ARCRATOH                        13410099
134200         MOVE -1               TO ARCRATOL                        13420099
134300                                                                  13430099
134400     END-IF.                                                      13440099
134500                                                                  13450099
134600     IF  PS-NO-ERROR                                              13460099
134700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     13470099
134800         MOVE -1               TO ARCRATOL                        13480099
134900         SET DP030-SET-CURSOR-APPL-1                              13490099
135000                                   TO TRUE                        13500099
135100     END-IF.                                                      13510099
135200                                                                  13520099
135300                                                                  13530099
135400*---------------------------------------------------------------- 13540099
135500* RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      * 13550099
135600*---------------------------------------------------------------- 13560099
135700                                                                  13570099
135800 3200-RESET-ATTRIBUTES.                                           13580099
135900                                                                  13590099
136000      MOVE DP015-PRO-NOR-OFF                                      13600099
136100                           TO APRETKTA.                           13610099
136200      MOVE DP015-UNP-NUM-NOR-OFF                                  13620099
136300                           TO ARCRATOA                            13630099
136400                              ADCQTYA.                            13640099
136500      MOVE DP015-BLUE      TO APRETKTC.                           13650099
136600      MOVE DP015-GREEN     TO ARCRATOC                            13660099
136700                              ADCQTYC.                            13670099
136800      MOVE DP015-UNDERLINE TO ARCRATOH                            13680099
136900                              ADCQTYH.                            13690099
137000                                                                  13700099
137100     IF  DP020-NEXT-ACT-INITIAL                                   13710099
137200         SET DP030-SET-CURSOR-APPL-1                              13720099
137300                                   TO TRUE                        13730099
137400         MOVE -1                   TO ARCRATOL                    13740099
137500     END-IF.                                                      13750099
137600                                                                  13760099
137700     IF ASC-RECITM-STATUS-CM-VE                                   13770099
137800         SET DP030-SET-CURSOR-TRAILER                             13780099
137900                                   TO TRUE                        13790099
138000     END-IF.                                                      13800099
138100                                                                  13810099
138200*---------------------------------------------------------------- 13820099
138300* THIS PARAGRAPH BUILDS THE INITIAL SCREEN                      * 13830099
138400*---------------------------------------------------------------- 13840099
138500                                                                  13850099
138600*----------------------------------------------------------------*13860099
138700*                                               **   WR # 230ZZ  *13870099
138800* INITIALIZED XL001-ITEM-COMMAREA.                               *13880099
138900* ADDED CODE TO CHECK FOR THE DUMMY SKU AND CALL TO XLKUT001     *13890099
139000*----------------------------------------------------------------*13900099
139100 4000-BUILD-INITIAL-PANEL.                                        13910099
139200                                                                  13920099
139300     PERFORM 4010-GET-LOC-DESC.                                   13930099
139400                                                                  13940099
139500     MOVE ASC-PO-LNE-NBR-N         TO DK-PO-LNE-NBR.              13950099
139600                                                                  13960099
139700     INITIALIZE XL001-ITEM-COMMAREA                               13970099
139800                PV-TEMP-SEQ-NBR                                   13980099
139900                PV-SKU-SEQ-NBR                                    13990099
140000                PV-TEMP-TKT-TYPE.                                 14000099
140100                                                                  14010099
140200     PERFORM 9050-GET-PURITM.                                     14020099
140300                                                                  14030099
140400     IF (DK-SKU-SEQ = PC-000)                                     14040099
140500         MOVE '00000000' TO PV-SKU-SEQ-NBR                        14050099
140600     END-IF                                                       14060099
140700                                                                  14070099
140800     IF (DK-SKU-SEQ = PC-999)                                     14080099
140900         MOVE '99999999' TO PV-SKU-SEQ-NBR                        14090099
141000     END-IF                                                       14100099
141100                                                                  14110099
141200     IF PS-PURITM-FOUND                                           14120099
141300         IF    PS-CALL-API-YES          AND                       14130099
141400             ((DK-SKU-SEQ NOT = PC-000) AND                       14140099
141500              (DK-SKU-SEQ NOT = PC-999))                          14150099
141600                                                                  14160099
141700             PERFORM 4015-CALL-CICS-API-ARCH                      14170099
141800         END-IF                                                   14180099
141900         MOVE PURITM-ITM-NBR       TO ASC-ITM-NBR                 14190099
142000         MOVE PURITM-VER-NBR       TO ASC-PURITM-VER-NBR          14200099
142100         MOVE PURITM-PREPK-RATO-QTY                               14210099
142200                                   TO ASC-PO-PACK-RATIO-N         14220099
142300         MOVE PURITM-UNT-COST-AMT  TO ASC-UNT-COST-AMT.           14230099
142400         MOVE PURITM-GP-RTL-AMT    TO ASC-GP-RTL-AMT              14240099
142500         MOVE PURITM-GP-QTY        TO ASC-GP-QTY                  14250099
142600         MOVE PURITM-UNT-RTL-PR-AMT                               14260099
142700                                   TO ASC-UNT-RTL-PR-AMT          14270099
142800                                                                  14280099
142900         MOVE XL001-INNR-PACK-QTY TO                              14290099
143000            ASC-DTL-PACK-RATIO-N.                                 14300099
143100                                                                  14310099
143200     IF RECITM-PREPK-RATO-QTY > 0                                 14320099
143300        MOVE RECITM-PREPK-RATO-QTY TO ASC-DTL-PACK-RATIO-N        14330099
143400     ELSE                                                         14340099
143500        MOVE PURITM-PREPK-RATO-QTY TO ASC-DTL-PACK-RATIO-N.       14350099
143600                                                                  14360099
143700     PERFORM 2050-SELECT-TRECITM.                                 14370099
143800     IF SQLCODE = +0                                              14380099
143900        MOVE RECITM-EXPTED-CART-CNT                               14390099
144000                                  TO ASC-EXPTED-CART-CNT          14400099
144100        MOVE RECITM-ACTL-CART-CNT TO ASC-ACTL-CART-CNT            14410099
144200        MOVE RECITM-DTL-CK-ITM-QTY                                14420099
144300                                  TO ASC-DTL-CK-ITM-QTY-N         14430099
144400     ELSE                                                         14440099
144500        MOVE +0                   TO ASC-DTL-CK-ITM-QTY-N.        14450099
144600                                                                  14460099
144700     PERFORM 4020-GET-STATUS-DESC.                                14470099
144800                                                                  14480099
144900**   CHECK THE PRE TICKET CODE ON THE PO AGREEMENT TABLE          14490099
145000     INITIALIZE PV-DB2-COUNT.                                     14500099
145100     MOVE 4                      TO DK-AGRMT-TYP-ID.              14510099
145200     MOVE 1                      TO DK-TYP-CDE.                   14520099
145300                                                                  14530099
145400     PERFORM 4005-CHECK-PO-SERVICE-INFO.                          14540099
145500                                                                  14550099
145600     IF  PV-DB2-COUNT > +0                                        14560099
145700         MOVE 'Y'                TO ASC-PRE-TKT-IND               14570099
145800                                    APRETKTI                      14580099
145900                                    APRETKTO                      14590099
146000     ELSE                                                         14600099
146100         MOVE 'N'                TO ASC-PRE-TKT-IND               14610099
146200                                    APRETKTI                      14620099
146300                                    APRETKTO                      14630099
146400     END-IF.                                                      14640099
146500                                                                  14650099
146600                                                                  14660099
146700     MOVE RECITM-STATUS-CDE        TO ASC-RECITM-STATUS-CDE.      14670099
146800                                                                  14680099
146900     PERFORM 4035-GET-TICKET-TYPE.                                14690099
147000     PERFORM 4030-GET-TROUBLE-DESC.                               14700099
147100                                                                  14710099
147200     IF ASC-PO-LNE-NBR > PC-8999                                  14720099
147300         PERFORM 4200-BUILD-UNPKSL-SCREEN                         14730099
147400     ELSE                                                         14740099
147500         PERFORM 4100-BUILD-PKITEM-SCREEN                         14750099
147600     END-IF.                                                      14760099
147700                                                                  14770099
147800     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14780099
147900*----------------------------------------------------------------*14790099
148000* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *14800099
148100*----------------------------------------------------------------*14810099
148200                                                                  14820099
148300                                                                  14830099
148400*----------------------------------------------------------------*14840099
148500*    CHECK TO SEE WHAT TYPES OF SERVICES THIS PO HAS             *14850099
148600*----------------------------------------------------------------*14860099
148700 4005-CHECK-PO-SERVICE-INFO.                                      14870099
148800                                                                  14880099
148900     EXEC SQL                                                     14890099
149000          SELECT COUNT(*)                                         14900099
149100            INTO :PV-DB2-COUNT                                    14910099
149200            FROM TPOAGMT                                          14920099
149300           WHERE PO_NBR         = :DK-PO-NBR                      14930099
149400             AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID                14940099
149500             AND VER_STATUS_CDE = 'A'                             14950099
149600             AND TYP_CDE        = :DK-TYP-CDE                     14960099
149700     END-EXEC.                                                    14970099
149800                                                                  14980099
149900     EVALUATE TRUE                                                14990099
150000         WHEN SQLCODE = +0                                        15000099
150100         WHEN SQLCODE = +100                                      15010099
150200              CONTINUE                                            15020099
150300                                                                  15030099
150400         WHEN SQLCODE = -904                                      15040099
150500         WHEN SQLCODE = -911                                      15050099
150600         WHEN SQLCODE = -913                                      15060099
150700              PERFORM 9900-SOFT-ABORT                             15070099
150800                                                                  15080099
150900         WHEN SQLWARN0 NOT = SPACES                               15090099
151000         WHEN SQLCODE < +0                                        15100099
151100         WHEN SQLCODE > +0                                        15110099
151200              MOVE '4005-CHECK-PO-SERVICE-INFO'                   15120099
151300                              TO DP013-PARAGRAPH                  15130099
151400              MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'       15140099
151500                              TO DP013-MESSAGE-TEXT (1)           15150099
151600              MOVE SQLCA      TO DP013-SQLCA                      15160099
151700              MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)         15170099
151800              SET DP013-DB2-ABEND                                 15180099
151900                  DP013-XCTL-DISPLAY-RESTART                      15190099
152000                              TO TRUE                             15200099
152100              PERFORM DP013-0000-PROCESS-ABEND                    15210099
152200     END-EVALUATE.                                                15220099
152300                                                                  15230099
152400                                                                  15240099
152500*---------------------------------------------------------------- 15250099
152600* CALL XLKUT071 TO GET THE LOCATION DESCRIPTION                 * 15260099
152700*---------------------------------------------------------------- 15270099
152800                                                                  15280099
152900 4010-GET-LOC-DESC.                                               15290099
153000     INITIALIZE XL071-COMMAREA-REC.                               15300099
153100     MOVE DK-OPER-UNT-ID        TO PV-UNPACK-OPER-UNT-ID.         15310099
153200     MOVE PV-UNPACK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.         15320099
153300                                                                  15330099
153400     CALL XL071-LOCATION-MODULE USING DFHEIBLK                    15340099
153500                                      XL071-COMMAREA              15350099
153600                                      XL071-COMMAREA-REC.         15360099
153700                                                                  15370099
153800     EVALUATE TRUE                                                15380099
153900         WHEN XL071-NO-ERRORS                                     15390099
154000             MOVE XL071-LOC-NM TO ASC-FCLTY-DESC                  15400099
154100                                  AFDESCO                         15410099
154200         WHEN XL071-LOC-NOT-FOUND                                 15420099
154300             SET PS-ERROR                                         15430099
154400                 DP020-MSG-FATAL         TO TRUE                  15440099
154500             MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER      15450099
154600             MOVE DP015-UNP-ALP-BRT-OFF  TO AFCLTYA               15460099
154700             MOVE DP015-RED              TO AFCLTYC               15470099
154800             MOVE DP015-REVERSE          TO AFCLTYH               15480099
154900             MOVE -1                     TO AFCLTYL               15490099
155000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  15500099
155100         WHEN XL071-SQLCODE-N = -904                              15510099
155200         WHEN XL071-SQLCODE-N = -911                              15520099
155300         WHEN XL071-SQLCODE-N = -913                              15530099
155400              PERFORM 9900-SOFT-ABORT                             15540099
155500         WHEN XL071-BAD-DB2-RETURN                                15550099
155600             MOVE '4010-GET-LOC-DESC'    TO DP013-PARAGRAPH       15560099
155700             MOVE 'SELECT LOCATION DESC' TO DP013-MESSAGE-TEXT (1)15570099
155800             MOVE XL071-SQLCA            TO DP013-SQLCA           15580099
155900             MOVE 'XLT_LOC'            TO DP013-DB2-TABLE-NAME (1)15590099
156000             SET DP013-DB2-ABEND                                  15600099
156100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15610099
156200             PERFORM DP013-0000-PROCESS-ABEND                     15620099
156300     END-EVALUATE.                                                15630099
156400                                                                  15640099
156500                                                                  15650099
156600*----------------------------------------------------------------*15660099
156700*                                               **   WR # 230ZZ  *15670099
156800* CODE FOR ACCESSING LOGISTICS DOMAIN ITEM ACCESS MODULE         *15680099
156900*----------------------------------------------------------------*15690099
157000 4015-CALL-CICS-API-ARCH.                                         15700099
157100                                                                  15710099
157200        MOVE DK-ITM-NBR           TO XL001-KEY-ITM-NBR.           15720099
157300                                                                  15730099
157400        SET  XL001-BY-ITEM                                        15740099
157500             XL001-SELECT-SKU                                     15750099
157600             XL001-SELECT-VND-STYL TO TRUE.                       15760099
157700                                                                  15770099
157800        CALL XL001-VSM-PGM USING  DFHEIBLK                        15780099
157900                                  XL001-COMMAREA                  15790099
158000                                  XL001-ITEM-COMMAREA.            15800099
158100        EVALUATE TRUE                                             15810099
158200                                                                  15820099
158300         WHEN XL001-SKU-SQLCODE = +0                              15830099
158400           MOVE XL001-SKU-NBR     TO  PV-TEMP-SEQ-NBR             15840099
158500           MOVE PV-TEMP-SEQ-NBR   TO  PV-SKU-SEQ-NBR              15850099
158600                                                                  15860099
158700           PERFORM 4016-SELECT-VND-STYL                           15870099
158800                                                                  15880099
158900         WHEN XL001-SKU-SQLCODE = +100                            15890099
159000           MOVE ZEROES            TO  PV-TEMP-SEQ-NBR             15900099
159100           MOVE SPACES            TO  PV-SKU-SEQ-NBR              15910099
159200           MOVE SPACES            TO  PV-TEMP-TKT-TYPE            15920099
159300           CONTINUE                                               15930099
159400                                                                  15940099
159500         WHEN XL001-SKU-SQLCODE = -904                            15950099
159600         WHEN XL001-SKU-SQLCODE = -911                            15960099
159700         WHEN XL001-SKU-SQLCODE = -913                            15970099
159800           PERFORM 9900-SOFT-ABORT                                15980099
159900                                                                  15990099
160000         WHEN XL001-INVALID-ACCESS                                16000099
160100           MOVE '4015-CALL-CICS-API-ARCH'                         16010099
160200                                TO DP013-PARAGRAPH                16020099
160300           MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'              16030099
160400                                TO DP013-MESSAGE-TEXT (1)         16040099
160500           MOVE SQLCA           TO DP013-SQLCA                    16050099
160600           MOVE 'XLV_SKU'       TO DP013-DB2-TABLE-NAME (1)       16060099
160700           SET DP013-DB2-ABEND  TO TRUE                           16070099
160800           PERFORM DP013-0000-PROCESS-ABEND                       16080099
160900                                                                  16090099
161000         WHEN OTHER                                               16100099
161100           MOVE '4015-CALL-CICS-API-ARCH'                         16110099
161200                                TO DP013-PARAGRAPH                16120099
161300           MOVE 'UNSUCCESSFUL SELECT OF ITEM NBR'                 16130099
161400                                TO DP013-MESSAGE-TEXT (1)         16140099
161500           MOVE XL001-SKU-SQLCODE                                 16150099
161600                                TO SQLCODE                        16160099
161700           MOVE SQLCA           TO DP013-SQLCA                    16170099
161800           MOVE 'XLV_SKU'       TO DP013-DB2-TABLE-NAME (1)       16180099
161900           SET DP013-DB2-ABEND  TO TRUE                           16190099
162000           PERFORM DP013-0000-PROCESS-ABEND                       16200099
162100        END-EVALUATE.                                             16210099
162200                                                                  16220099
162300 4016-SELECT-VND-STYL.                                            16230099
162400                                                                  16240099
162500        EVALUATE TRUE                                             16250099
162600                                                                  16260099
162700         WHEN XL001-VND-STYL-SQLCODE = +0                         16270099
162800           MOVE XL001-TKT-TYP-DESC  TO  PV-TEMP-TKT-TYPE          16280099
162900                                                                  16290099
163000         WHEN XL001-VND-STYL-SQLCODE = +100                       16300099
163100           MOVE SPACES              TO  PV-TEMP-TKT-TYPE          16310099
163200                                                                  16320099
163300         WHEN XL001-VND-STYL-SQLCODE = -904                       16330099
163400         WHEN XL001-VND-STYL-SQLCODE = -911                       16340099
163500         WHEN XL001-VND-STYL-SQLCODE = -913                       16350099
163600           PERFORM 9900-SOFT-ABORT                                16360099
163700                                                                  16370099
163800         WHEN XL001-INVALID-ACCESS                                16380099
163900           MOVE '4016-SELECT-VND-STYL'                            16390099
164000                                TO DP013-PARAGRAPH                16400099
164100           MOVE 'ACCESS INFO FOR XLKUT001 INCORRECT'              16410099
164200                                TO DP013-MESSAGE-TEXT (1)         16420099
164300           MOVE SQLCA           TO DP013-SQLCA                    16430099
164400           MOVE 'XLV_VND_STYL'  TO DP013-DB2-TABLE-NAME (1)       16440099
164500           SET DP013-DB2-ABEND  TO TRUE                           16450099
164600           PERFORM DP013-0000-PROCESS-ABEND                       16460099
164700                                                                  16470099
164800         WHEN OTHER                                               16480099
164900           MOVE '4016-SELECT-VND-STYL'                            16490099
165000                                TO DP013-PARAGRAPH                16500099
165100           MOVE 'FETCH TKT-TYP-DESC'                              16510099
165200                                TO DP013-MESSAGE-TEXT (1)         16520099
165300           MOVE XL001-VND-STYL-SQLCODE                            16530099
165400                                TO SQLCODE                        16540099
165500           MOVE SQLCA           TO DP013-SQLCA                    16550099
165600           MOVE 'XLV_VND_STYL'  TO DP013-DB2-TABLE-NAME (1)       16560099
165700           SET DP013-DB2-ABEND  TO TRUE                           16570099
165800           PERFORM DP013-0000-PROCESS-ABEND                       16580099
165900        END-EVALUATE.                                             16590099
166000                                                                  16600099
166100*----------------------------------------------------------------*16610099
166200* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *16620099
166300*----------------------------------------------------------------*16630099
166400*---------------------------------------------------------------- 16640099
166500* SELECT THE STATUS CODE DESCRIPTION                            * 16650099
166600*---------------------------------------------------------------- 16660099
166700                                                                  16670099
166800 4020-GET-STATUS-DESC.                                            16680099
166900                                                                  16690099
167000     EXEC SQL                                                     16700099
167100        SELECT  STATUS_DESC                                       16710099
167200          INTO :STATCD-STATUS-DESC                                16720099
167300          FROM  TSTATCD                                           16730099
167400         WHERE  STATUS_CDE     = :RECITM-STATUS-CDE               16740099
167500           AND  STATUS_TYP_CDE = :PC-R                            16750099
167600     END-EXEC.                                                    16760099
167700                                                                  16770099
167800     EVALUATE TRUE                                                16780099
167900         WHEN SQLCODE = +0                                        16790099
168000             MOVE STATCD-STATUS-DESC                              16800099
168100                               TO ASC-STATUS-DESC                 16810099
168200                                                                  16820099
168300         WHEN SQLCODE = +100                                      16830099
168400             MOVE RECITM-STATUS-CDE                               16840099
168500                               TO ASC-STATUS-DESC                 16850099
168600                                                                  16860099
168700         WHEN SQLCODE = -904                                      16870099
168800         WHEN SQLCODE = -911                                      16880099
168900         WHEN SQLCODE = -913                                      16890099
169000              PERFORM 9900-SOFT-ABORT                             16900099
169100                                                                  16910099
169200         WHEN SQLWARN0 NOT = SPACES                               16920099
169300         WHEN SQLCODE < +0                                        16930099
169400         WHEN SQLCODE > +0                                        16940099
169500             MOVE '4020-GET-STATUS-DESC'                          16950099
169600                               TO DP013-PARAGRAPH                 16960099
169700             MOVE 'SELECT STATUS DESC '                           16970099
169800                               TO DP013-MESSAGE-TEXT (1)          16980099
169900             MOVE SQLCA        TO DP013-SQLCA                     16990099
170000             MOVE 'TSTATCD'    TO DP013-DB2-TABLE-NAME (1)        17000099
170100             SET DP013-DB2-ABEND                                  17010099
170200                               TO TRUE                            17020099
170300             SET DP013-XCTL-DISPLAY-RESTART                       17030099
170400                               TO TRUE                            17040099
170500             PERFORM DP013-0000-PROCESS-ABEND                     17050099
170600     END-EVALUATE.                                                17060099
170700                                                                  17070099
170800*---------------------------------------------------------------- 17080099
170900* CHECK IF THE PURCHASE ORDER LINE IS IN TROUBLE                * 17090099
171000*---------------------------------------------------------------- 17100099
171100                                                                  17110099
171200 4030-GET-TROUBLE-DESC.                                           17120099
171300                                                                  17130099
171400     EXEC SQL                                                     17140099
171500        SELECT  TRBL_LONG_DESC                                    17150099
171600          INTO :TRBRSN-TRBL-LONG-DESC                             17160099
171700          FROM  TTRBNTF A,                                        17170099
171800                TTRBRSN B                                         17180099
171900         WHERE  A.OPER_UNT_ID   = :DK-OPER-UNT-ID                 17190099
172000           AND  A.FCLTY_ID      = :DK-FCLTY-ID                    17200099
172100           AND  A.PO_NBR        = :DK-PO-NBR                      17210099
172200           AND  A.PO_LNE_NBR    = :DK-PO-LNE-NBR                  17220099
172300           AND  A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 17230099
172400           AND (A.RESOLVED_IND ^= :PC-A                           17240099
172500           AND  A.RESOLVED_IND ^= :PC-R)                          17250099
172600           AND  A.TRBL_RSN_CDE  = B.TRBL_RSN_CDE                  17260099
172700           AND  B.NOTIF_IND     = :PC-T                           17270099
172800     END-EXEC.                                                    17280099
172900                                                                  17290099
173000     EVALUATE TRUE                                                17300099
173100         WHEN SQLCODE = +0                                        17310099
173200             MOVE TRBRSN-TRBL-LONG-DESC                           17320099
173300                               TO ASC-TROUBLE-DESC                17330099
173400                                                                  17340099
173500         WHEN SQLCODE = +100                                      17350099
173600             MOVE SPACES       TO ASC-TROUBLE-DESC                17360099
173700                                                                  17370099
173800         WHEN SQLCODE = -811                                      17380099
173900             STRING TRBRSN-TRBL-LONG-DESC '*'                     17390099
174000                 DELIMITED BY SIZE                                17400099
174100                 INTO ASC-TROUBLE-DESC                            17410099
174200                                                                  17420099
174300         WHEN SQLCODE = -904                                      17430099
174400         WHEN SQLCODE = -911                                      17440099
174500         WHEN SQLCODE = -913                                      17450099
174600              PERFORM 9900-SOFT-ABORT                             17460099
174700                                                                  17470099
174800         WHEN SQLWARN0 NOT = SPACES                               17480099
174900         WHEN SQLCODE < +0                                        17490099
175000         WHEN SQLCODE > +0                                        17500099
175100             MOVE '4030-GET-TROUBLE-DESC'                         17510099
175200                               TO DP013-PARAGRAPH                 17520099
175300             MOVE 'SELECT TROUBLE LONG DESC '                     17530099
175400                               TO DP013-MESSAGE-TEXT (1)          17540099
175500             MOVE SQLCA        TO DP013-SQLCA                     17550099
175600             MOVE 'TTRBNTF'    TO DP013-DB2-TABLE-NAME (1)        17560099
175700             MOVE 'TTRBRSN'    TO DP013-DB2-TABLE-NAME (2)        17570099
175800             SET DP013-DB2-ABEND                                  17580099
175900                               TO TRUE                            17590099
176000             SET DP013-XCTL-DISPLAY-RESTART                       17600099
176100                               TO TRUE                            17610099
176200             PERFORM DP013-0000-PROCESS-ABEND                     17620099
176300     END-EVALUATE.                                                17630099
176400                                                                  17640099
176500*---------------------------------------------------------------  17650099
176600* PERFORM ROUTINE TO GET THE TICKET TYPE                       *  17660099
176700*---------------------------------------------------------------  17670099
176800*----------------------------------------------------------------*17680099
176900*                                               WR # 230ZZ       *17690099
177000* COMMENTED OUT CODE FOR 4035-GET-TICKET-TYPE PARA.              *17700099
177100* ADDED CODE TO RETRIEVE THE TICKET TYPE DESCRIPTION FROM        *17710099
177200* XLKUT001 MODULE.                                               *17720099
177300*----------------------------------------------------------------*17730099
177400                                                                  17740099
177500 4035-GET-TICKET-TYPE.                                            17750099
177600     PERFORM 4040-OPEN-TKTFMT-CURSOR.                             17760099
177700     PERFORM 4041-FETCH-TKTFMT-CURSOR.                            17770099
177800     PERFORM 4042-CLOSE-TKTFMT-CURSOR.                            17780099
177900                                                                  17790099
178000     IF PS-PRETICKET                                              17800099
178100         MOVE PTKLNE-TKT-DESC  TO   ASC-TKT-DESC                  17810099
178200     ELSE                                                         17820099
178300         MOVE PV-TEMP-TKT-TYPE TO   ASC-TKT-DESC                  17830099
178400     END-IF.                                                      17840099
178500*----------------------------------------------------------------*17850099
178600* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *17860099
178700*----------------------------------------------------------------*17870099
178800*----------------------------------------------------------------*17880099
178900* OPEN THE CURSOR                                                *17890099
179000*----------------------------------------------------------------*17900099
179100 4040-OPEN-TKTFMT-CURSOR.                                         17910099
179200                                                                  17920099
179300         EXEC SQL                                                 17930099
179400             OPEN TKTFMT-CURSOR                                   17940099
179500         END-EXEC                                                 17950099
179600                                                                  17960099
179700         EVALUATE TRUE                                            17970099
179800             WHEN SQLCODE = ZERO                                  17980099
179900                 CONTINUE                                         17990099
180000             WHEN SQLCODE = -904                                  18000099
180100             WHEN SQLCODE = -913                                  18010099
180200             WHEN SQLCODE = -911                                  18020099
180300                 PERFORM 9900-SOFT-ABORT                          18030099
180400             WHEN SQLWARN0 NOT = SPACES                           18040099
180500             WHEN SQLCODE < ZERO                                  18050099
180600             WHEN SQLCODE > ZERO                                  18060099
180700                 MOVE '4040-OPEN-TKTYPE-CURSOR'                   18070099
180800                                   TO DP013-PARAGRAPH             18080099
180900                 MOVE 'OPEN TKTFMT CURSOR'                        18090099
181000                                   TO DP013-MESSAGE-TEXT (1)      18100099
181100                 MOVE SQLCA        TO DP013-SQLCA                 18110099
181200                 MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)    18120099
181300                 MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)    18130099
181400                 SET DP013-DB2-ABEND                              18140099
181500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18150099
181600                 PERFORM DP013-0000-PROCESS-ABEND                 18160099
181700     END-EVALUATE.                                                18170099
181800                                                                  18180099
181900*----------------------------------------------------------------*18190099
182000* FETCH THE CURSOR                                               *18200099
182100*----------------------------------------------------------------*18210099
182200*----------------------------------------------------------------*18220099
182300*                                               WR # 230ZZ       *18230099
182400* ADDED CODE TO SET PS-PRETICKET TO TRUE , WHEN SQLCODE IS       *18240099
182500* EQUAL TO ZERO.                                                 *18250099
182600*----------------------------------------------------------------*18260099
182700 4041-FETCH-TKTFMT-CURSOR.                                        18270099
182800                                                                  18280099
182900     EXEC SQL                                                     18290099
183000          FETCH TKTFMT-CURSOR                                     18300099
183100          INTO  :PTKLNE-TKT-DESC                                  18310099
183200     END-EXEC                                                     18320099
183300                                                                  18330099
183400     EVALUATE TRUE                                                18340099
183500         WHEN SQLCODE = ZERO                                      18350099
183600              SET PS-PRETICKET TO TRUE                            18360099
183700         WHEN SQLCODE = +100                                      18370099
183800              CONTINUE                                            18380099
183900         WHEN SQLWARN0 NOT = SPACE                                18390099
184000         WHEN SQLCODE NOT = ZERO                                  18400099
184100              MOVE '4041-FETCH-TKTFMT-CURSOR'                     18410099
184200                               TO DP013-PARAGRAPH                 18420099
184300              MOVE 'FETCH TKTFMT-CURSOR '                         18430099
184400                               TO DP013-MESSAGE-TEXT (1)          18440099
184500              MOVE SQLCA       TO DP013-SQLCA                     18450099
184600              SET DP013-DB2-ABEND                                 18460099
184700                               TO TRUE                            18470099
184800              PERFORM DP013-0000-PROCESS-ABEND                    18480099
184900     END-EVALUATE.                                                18490099
185000*----------------------------------------------------------------*18500099
185100* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *18510099
185200*----------------------------------------------------------------*18520099
185300                                                                  18530099
185400*----------------------------------------------------------------*18540099
185500* CLOSE THE TKT-FMT-CURSOR.                                      *18550099
185600*----------------------------------------------------------------*18560099
185700 4042-CLOSE-TKTFMT-CURSOR.                                        18570099
185800                                                                  18580099
185900     EXEC SQL                                                     18590099
186000         CLOSE TKTFMT-CURSOR                                      18600099
186100     END-EXEC                                                     18610099
186200                                                                  18620099
186300     EVALUATE TRUE                                                18630099
186400         WHEN SQLCODE = ZERO                                      18640099
186500             CONTINUE                                             18650099
186600         WHEN SQLWARN0 NOT = SPACES                               18660099
186700         WHEN SQLCODE < ZERO                                      18670099
186800         WHEN SQLCODE > ZERO                                      18680099
186900             MOVE '4042-CLOSE-TKTFMT-CURSOR'                      18690099
187000                               TO DP013-PARAGRAPH                 18700099
187100             MOVE 'CLOSE PO_ITEM_CURSOR'                          18710099
187200                               TO DP013-MESSAGE-TEXT (1)          18720099
187300             MOVE SQLCA        TO DP013-SQLCA                     18730099
187400             MOVE 'TPTKREQ '   TO DP013-DB2-TABLE-NAME (1)        18740099
187500             MOVE 'TPTKLNE '   TO DP013-DB2-TABLE-NAME (2)        18750099
187600             SET DP013-DB2-ABEND                                  18760099
187700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18770099
187800             PERFORM DP013-0000-PROCESS-ABEND                     18780099
187900     END-EVALUATE.                                                18790099
188000                                                                  18800099
188100  4065-SELECT-TKT-FMT-ID.                                         18810099
188200      EXEC SQL                                                    18820099
188300          SELECT DISTINCT TKT_FMT_ID                              18830099
188400                INTO :TKTFMT-TKT-FMT-ID                           18840099
188500              FROM TTKTFMT                                        18850099
188600           WHERE                                                  18860099
188700              TKT_FMT_DESC = :DK-TICKET-DESC                      18870099
188800     END-EXEC                                                     18880099
188900                                                                  18890099
189000     EVALUATE TRUE                                                18900099
189100           WHEN SQLCODE = +0                                      18910099
189200             MOVE TKTFMT-TKT-FMT-ID  TO RECITM-TKT-FMT-ID         18920099
189300           WHEN SQLCODE = +100                                    18930099
189400                  MOVE SPACES    TO RECITM-TKT-FMT-ID             18940099
189500             WHEN SQLCODE = -904                                  18950099
189600             WHEN SQLCODE = -911                                  18960099
189700             WHEN SQLCODE = -913                                  18970099
189800                  PERFORM 9900-SOFT-ABORT                         18980099
189900                                                                  18990099
190000             WHEN SQLWARN0 NOT = SPACES                           19000099
190100             WHEN SQLCODE  NOT = ZERO                             19010099
190200                  MOVE '4065-SELECT-TKT-FMT-ID'                   19020099
190300                                 TO DP013-PARAGRAPH               19030099
190400                  MOVE 'UNSUCCESSFUL SELECT OF TTKTFMG'           19040099
190500                                 TO DP013-MESSAGE-TEXT (1)        19050099
190600                  MOVE DK-TICKET-DESC                             19060099
190700                                 TO DP013-MESSAGE-TEXT (2)        19070099
190800                  MOVE SQLCA     TO DP013-SQLCA                   19080099
190900                  MOVE 'TTKTFMT' TO DP013-DB2-TABLE-NAME (1)      19090099
191000                  SET DP013-DB2-ABEND                             19100099
191100                      DP013-XCTL-DISPLAY-RESTART                  19110099
191200                                 TO TRUE                          19120099
191300                  PERFORM DP013-0000-PROCESS-ABEND                19130099
191400         END-EVALUATE.                                            19140099
191500                                                                  19150099
191600                                                                  19160099
191700*---------------------------------------------------------------* 19170099
191800*                                                   WR # 230ZZ  * 19180099
191900* ADDED CODE TO MOVE PV-SKU-SEQ-NBR TO ASC-SKU-SEQ-NBR.         * 19190099
192000*---------------------------------------------------------------* 19200099
192100   4100-BUILD-PKITEM-SCREEN.                                      19210099
192200                                                                  19220099
192300     MOVE PURCHS-DEPT-NBR          TO ASC-DEPT-NBR.               19230099
192400     MOVE PURCHS-ENT-ID            TO ASC-ENT-ID.                 19240099
192500     MOVE XL001-SUB-CL-NBR-2CH     TO ASC-CLASS-NBR.              19250099
192600     MOVE PV-SKU-SEQ-NBR           TO ASC-SKU-SEQ-NBR.            19260099
192700     MOVE PURITM-VEND-STYL-NAME    TO ASC-VEND-STYL-NAME.         19270099
192800     MOVE PURITM-COLOR-DESC        TO ASC-COLOR-DESC.             19280099
192900     MOVE PURITM-SIZE-DESC         TO ASC-SIZE-DESC.              19290099
193000*---------------------------------------------------------------* 19300099
193100* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                        * 19310099
193200*---------------------------------------------------------------* 19320099
193300 4200-BUILD-UNPKSL-SCREEN.                                        19330099
193400                                                                  19340099
193500     MOVE RECITM-VEND-STYL-NAME    TO ASC-VEND-STYL-NAME.         19350099
193600     MOVE RECITM-COLOR-DESC        TO ASC-COLOR-DESC.             19360099
193700     MOVE RECITM-SIZE-DESC         TO ASC-SIZE-DESC.              19370099
193800                                                                  19380099
193900                                                                  19390099
194000*---------------------------------------------------------------* 19400099
194100*- FILL IN THE COMMAREA FOR THE NEXT PROGRAM TO FUNCTION TO    -* 19410099
194200*---------------------------------------------------------------* 19420099
194300 4300-PREPARE-SEL-QUEUE.                                          19430099
194400                                                                  19440099
194500     EVALUATE TRUE                                                19450099
194600* IF TROUBLE                                                      19460099
194700     WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)                  19470099
194800         MOVE ASC-SEL-QUEUE-NAME TO PC000-SEL-QUEUE-NAME          19480099
194900         PERFORM 2040-DELETE-LIST-QUEUE                           19490099
195000                                                                  19500099
195100         SET RC013-IDX           TO 1                             19510099
195200         MOVE +1                 TO PC000-NUMBER-OF-TS-ITEMS      19520099
195300                                   PC000-NUMBER-OF-SELECTED-ITEMS 19530099
195400         INITIALIZE RC013-SELECTED-ITEM-ARRAY                     19540099
195500                                                                  19550099
195600          PERFORM 5210-FILL-SEL-QUEUE-RECORD                      19560099
195700                                                                  19570099
195800      WHEN OTHER                                                  19580099
195900         MOVE ASC-SEL-QUEUE-NAME       TO RC800-SEL-QUEUE-NAME    19590099
196000                                                                  19600099
196100         SET RC801-IDX             TO 1                           19610099
196200         MOVE ZERO                 TO RC800-NUMBER-OF-TS-ITEMS    19620099
196300                                   RC800-NUMBER-OF-SELECTED-ITEMS 19630099
196400                                                                  19640099
196500         INITIALIZE RC801-SELECTED-ITEM-ARRAY                     19650099
196600         PERFORM 5250-FILL-SEL-QUEUE-RECORD                       19660099
196700                                                                  19670099
196800     END-EVALUATE.                                                19680099
196900                                                                  19690099
197000                                                                  19700099
197100*---------------------------------------------------------------* 19710099
197200*- SEND THE TROUBLE SCREEN THE APPROPRIATE INFORMATION         -* 19720099
197300*---------------------------------------------------------------* 19730099
197400                                                                  19740099
197500 5210-FILL-SEL-QUEUE-RECORD.                                      19750099
197600                                                                  19760099
197700     INITIALIZE RC013-SELECTED-ITEM-ARRAY                         19770099
197800     SET RC013-IDX TO 1.                                          19780099
197900     MOVE +1                 TO RC013-ITEM          (RC013-IDX).  19790099
198000     MOVE SPACE              TO RC013-ACTION-SW     (RC013-IDX).  19800099
198100     MOVE ASC-OPER-UNT-ID    TO RC013-OPER-UNT-ID   (RC013-IDX).  19810099
198200     MOVE ASC-FCLTY-ID       TO RC013-FCLTY-ID      (RC013-IDX).  19820099
198300     MOVE ASC-PO-NBR         TO RC013-PO-NBR        (RC013-IDX).  19830099
198400     MOVE ASC-REC-SEQ-NBR    TO RC013-REC-SEQ-NBR   (RC013-IDX).  19840099
198500     MOVE ASC-PO-LNE-NBR-N   TO RC013-PKSL-LNE-NBR-N              19850099
198600                                                   (RC013-IDX).   19860099
198700     PERFORM 5215-WRITE-SEL-QUEUE.                                19870099
198800                                                                  19880099
198900                                                                  19890099
199000*---------------------------------------------------------------* 19900099
199100*- SEND THE TROUBLE SCREEN THE APPROPRIATE INFORMATION         -* 19910099
199200*---------------------------------------------------------------* 19920099
199300                                                                  19930099
199400 5215-WRITE-SEL-QUEUE.                                            19940099
199500                                                                  19950099
199600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19960099
199700                                   TO RC013-SELECTED-ITEMS.       19970099
199800                                                                  19980099
199900     EXEC CICS                                                    19990099
200000          WRITEQ TS                                               20000099
200100              QUEUE (ASC-SEL-QUEUE-NAME)                          20010099
200200              FROM  (RC013-DC-SELECT-RECORD)                      20020099
200300              ITEM  (ASC-SEL-ITEM)                                20030099
200400              RESP  (PV-CICS-RESPONSE)                            20040099
200500     END-EXEC.                                                    20050099
200600                                                                  20060099
200700     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      20070099
200800         CONTINUE                                                 20080099
200900     ELSE                                                         20090099
201000         SET DP013-CICS-ABEND      TO TRUE                        20100099
201100         SET DP013-NO-ROLLBACK     TO TRUE                        20110099
201200         MOVE '5215-WRITE-SEL-QUEUE'                              20120099
201300                                   TO DP013-PARAGRAPH             20130099
201400         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          20140099
201500                                   TO DP013-MESSAGE-TEXT(1)       20150099
201600         PERFORM DP013-0000-PROCESS-ABEND                         20160099
201700     END-IF.                                                      20170099
201800                                                                  20180099
201900                                                                  20190099
202000*----------------------------------------------------------------*20200099
202100*  DETERMINE WHAT LINES WHERE SELECTED AND WHAT FIELDS NEED TO *  20210099
202200*  BE UPDATED.                                                 *  20220099
202300*  GOING TO STORE DISTRO BY PACK WILL SEND ONLY 1 LINE THROUGH TS 20230099
202400*  AREA                                                           20240099
202500*----------------------------------------------------------------*20250099
202600 5250-FILL-SEL-QUEUE-RECORD.                                      20260099
202700                                                                  20270099
202800     SET RC801-IDX           TO +1.                               20280099
202900     INITIALIZE RC801-SELECTED-ITEM-ARRAY.                        20290099
203000     MOVE +1                 TO RC800-NUMBER-OF-SELECTED-ITEMS    20300099
203100                                RC800-NUMBER-OF-TS-ITEMS.         20310099
203200     PERFORM 2020-PREPARE-SELECT.                                 20320099
203300     PERFORM 5255-RETRIEVE-DRIVER-LINE.                           20330099
203400                                                                  20340099
203500     MOVE RECITM-ORD-LNE-NBR TO RC801-REC-LNE-NBR   (RC801-IDX).  20350099
203600     MOVE ASC-PACK-ID        TO RC801-PACK-ID       (RC801-IDX).  20360099
203700     MOVE ASC-PACK-DESC      TO RC801-PACK-DESC     (RC801-IDX).  20370099
203800     MOVE +1                 TO RC801-ITEM          (RC801-IDX).  20380099
203900     MOVE SPACES             TO RC801-ACTION-SW     (RC801-IDX).  20390099
204000     MOVE +1                 TO ASC-SEL-ITEM.                     20400099
204100                                                                  20410099
204200     PERFORM 9300-WRITE-SEL-QUEUE.                                20420099
204300                                                                  20430099
204400                                                                  20440099
204500*----------------------------------------------------------------*20450099
204600*    RETRIEVE THE DRIVER LINE TO SEND TO THE TROUBLE CREATE      *20460099
204700*    SCREEN.                                                      20470099
204800*----------------------------------------------------------------*20480099
204900 5255-RETRIEVE-DRIVER-LINE.                                       20490099
205000                                                                  20500099
205100     EXEC SQL                                                     20510099
205200           SELECT DISTINCT                                        20520099
205300                  D.ORD_NBR                                       20530099
205400                , D.ORD_LNE_NBR                                   20540099
205500                , D.STATUS_CDE                                    20550099
205600           INTO                                                   20560099
205700                 :RECITM-ORD-NBR                                  20570099
205800                ,:RECITM-ORD-LNE-NBR                              20580099
205900                ,:RECITM-STATUS-CDE                               20590099
206000           FROM                                                   20600099
206100                  TRECITM D                                       20610099
206200           WHERE                                                  20620099
206300                  D.ORD_NBR           = :DK-PO-NBR                20630099
206400             AND  D.REC_SEQ_NBR       = :DK-REC-SEQ-NBR           20640099
206500             AND  D.VER_STATUS_CDE    = 'A'                       20650099
206600             AND  D.OPER_UNT_ID       = :DK-OPER-UNT-ID           20660099
206700             AND  D.FCLTY_ID          = :DK-FCLTY-ID              20670099
206800             AND  D.PREPK_ID          = :DK-PACK-ID               20680099
206900             AND  D.PREPK_DRV_LNE_CDE = 'A'                       20690099
207000     END-EXEC.                                                    20700099
207100                                                                  20710099
207200     EVALUATE TRUE                                                20720099
207300         WHEN SQLCODE = +0                                        20730099
207400         WHEN SQLCODE = +100                                      20740099
207500              CONTINUE                                            20750099
207600         WHEN SQLCODE = -904                                      20760099
207700         WHEN SQLCODE = -911                                      20770099
207800         WHEN SQLCODE = -913                                      20780099
207900              PERFORM 9900-SOFT-ABORT                             20790099
208000                                                                  20800099
208100         WHEN SQLWARN0 NOT = SPACES                               20810099
208200         WHEN SQLCODE < +0                                        20820099
208300         WHEN SQLCODE > +0                                        20830099
208400              MOVE '5455-RETRIEVE-DRIVER-LINE'                    20840099
208500                               TO DP013-PARAGRAPH                 20850099
208600              MOVE 'UNSUCCESSFUL SELECT ON PO ITEM'               20860099
208700                               TO DP013-MESSAGE-TEXT (1)          20870099
208800              MOVE SQLCA       TO DP013-SQLCA                     20880099
208900              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        20890099
209000              SET DP013-DB2-ABEND                                 20900099
209100                  DP013-XCTL-DISPLAY-RESTART                      20910099
209200                               TO TRUE                            20920099
209300              PERFORM DP013-0000-PROCESS-ABEND                    20930099
209400     END-EVALUATE.                                                20940099
209500                                                                  20950099
209600*----------------------------------------------------------------*20960099
209700*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *20970099
209800*----------------------------------------------------------------*20980099
209900 4400-MOVE-COMMAREA-TO-SCREEN.                                    20990099
210000                                                                  21000099
210100     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     21010099
210200     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    21020099
210300     MOVE ASC-FCLTY-DESC           TO AFDESCO.                    21030099
210400     MOVE PC-DASH                  TO ASC-REC-DASH.               21040099
210500     MOVE ASC-RECEIVER             TO ARCVRO.                     21050099
210600     MOVE ASC-PO-LNE-NBR-N         TO ALINEO.                     21060099
210700     MOVE ASC-STATUS-DESC          TO ASTDESCO.                   21070099
210800     MOVE ASC-TROUBLE-DESC         TO ATRBLO.                     21080099
210900     MOVE ASC-PACK-ID              TO APACKIDO.                   21090099
211000     MOVE ASC-PACK-DESC            TO APKDESCO.                   21100099
211100                                                                  21110099
211200     MOVE ASC-DTL-PACK-RATIO-N     TO ARCRATOO.                   21120099
211300     MOVE ASC-PKSL-ITM-QTY         TO APSQTYO.                    21130099
211400     MOVE ASC-GP-RTL-AMT           TO AGRPRTLO.                   21140099
211500     MOVE ASC-PO-PACK-RATIO-N      TO ACASEO.                     21150099
211600     MOVE ASC-DTL-CK-ITM-QTY-N     TO ADCQTYO.                    21160099
211700     MOVE ASC-GP-QTY               TO AGRPQTYO.                   21170099
211800     MOVE ASC-PRE-TKT-IND          TO APRETKTO.                   21180099
211900     MOVE ASC-EXPTED-CART-CNT      TO AEXPCTNO.                   21190099
212000     MOVE ASC-UNT-RTL-PR-AMT       TO ARTLO.                      21200099
212100     MOVE ASC-ACTL-CART-CNT        TO AACTCTNO.                   21210099
212200     MOVE ASC-TKT-DESC             TO ATKTO.                      21220099
212300     MOVE ASC-SKU                  TO ASKUO.                      21230099
212400     MOVE ASC-VEND-STYL-NAME       TO ASTYLEO.                    21240099
212500     MOVE ASC-COLOR-DESC           TO ACOLORO.                    21250099
212600     MOVE ASC-SIZE-DESC            TO ASIZEO.                     21260099
212700                                                                  21270099
212800 4500-CHECK-VALIDATION.                                           21280099
212900     MOVE +1                   TO PV-VALID-IDX.                   21290099
213000     MOVE +0                   TO RC806-NBR-OF-LINES.             21300099
213100     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           21310099
213200                                                                  21320099
213300     PERFORM 9400-OPEN-CURSOR.                                    21330099
213400     PERFORM 9420-FETCH                                           21340099
213500        UNTIL ASC-NO-ITEMS-LEFT-ON-DB.                            21350099
213600     PERFORM 9410-CLOSE-CURSOR.                                   21360099
213700                                                                  21370099
213800     PERFORM 9500-CALL-VALIDATION-MODULE.                         21380099
213900                                                                  21390099
214000     PERFORM                                                      21400099
214100          VARYING PV-VALID-IDX                                    21410099
214200          FROM 1 BY 1                                             21420099
214300          UNTIL RC806-RC-RATIO (PV-VALID-IDX) = 0                 21430099
214400             OR PV-VALID-IDX  > 500                               21440099
214500                                                                  21450099
214600          SET PV-UPDATE-NOT-NEEDED  TO TRUE                       21460099
214700          MOVE RC806-PKSL-LNE-NBR  (PV-VALID-IDX)                 21470099
214800                                    TO DK-PO-LNE-NBR              21480099
214900          PERFORM 2051-SELECT-ORIG-RECITM                         21490099
215000                                                                  21500099
215100          IF RC806-ODD-UNITS (PV-VALID-IDX)                       21510099
215200                               NOT = RECITM-PREPK-ODD-UNT-QTY     21520099
215300              IF RC806-ODD-UNITS (PV-VALID-IDX) = +99999          21530099
215400                 MOVE +9999       TO RECITM-PREPK-ODD-UNT-QTY     21540099
215500              ELSE                                                21550099
215600                 MOVE RC806-ODD-UNITS (PV-VALID-IDX)              21560099
215700                                  TO RECITM-PREPK-ODD-UNT-QTY     21570099
215800              END-IF                                              21580099
215900              SET PV-UPDATE-NEEDED TO TRUE                        21590099
216000          END-IF                                                  21600099
216100                                                                  21610099
216200          IF RC806-DRIVER-LNE-SUB  = PV-VALID-IDX                 21620099
216300             IF RECITM-PREPK-DRV-LNE-CDE = 'I' OR SPACES          21630099
216400                MOVE 'A'          TO RECITM-PREPK-DRV-LNE-CDE     21640099
216500                MOVE DK-PO-LNE-NBR                                21650099
216600                                  TO PV-DRIVER-LINE-NBR           21660099
216700                SET PV-UPDATE-NEEDED                              21670099
216800                                  TO TRUE                         21680099
216900             END-IF                                               21690099
217000          ELSE                                                    21700099
217100             IF RECITM-PREPK-DRV-LNE-CDE = 'A'                    21710099
217200                MOVE 'I'          TO RECITM-PREPK-DRV-LNE-CDE     21720099
217300                SET PV-UPDATE-NEEDED                              21730099
217400                                  TO TRUE                         21740099
217500             ELSE                                                 21750099
217600* KEEP THE VALUE THE SAME                                         21760099
217700                MOVE RECITM-PREPK-DRV-LNE-CDE                     21770099
217800                                  TO RECITM-PREPK-DRV-LNE-CDE     21780099
217900             END-IF                                               21790099
218000          END-IF                                                  21800099
218100                                                                  21810099
218200          IF PV-UPDATE-NEEDED                                     21820099
218300            EXEC SQL                                              21830099
218400              UPDATE TRECITM                                      21840099
218500              SET                                                 21850099
218600                  DTL_CK_ITM_QTY      = :RECITM-DTL-CK-ITM-QTY    21860099
218700                , PREPK_RATO_QTY      = :RECITM-PREPK-RATO-QTY    21870099
218800                , PREPK_ODD_UNT_QTY   = :RECITM-PREPK-ODD-UNT-QTY 21880099
218900                , PREPK_DRV_LNE_CDE   = :RECITM-PREPK-DRV-LNE-CDE 21890099
219000               WHERE ORD_NBR          = :DK-PO-NBR                21900099
219100                 AND ORD_LNE_NBR      = :DK-PO-LNE-NBR            21910099
219200                 AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR           21920099
219300                 AND OPER_UNT_ID      = :DK-OPER-UNT-ID           21930099
219400                 AND FCLTY_ID         = :DK-FCLTY-ID              21940099
219500                 AND VER_STATUS_CDE   = 'A'                       21950099
219600                 AND PREPK_ID         = :DK-PACK-ID               21960099
219700            END-EXEC                                              21970099
219800            EVALUATE TRUE                                         21980099
219900              WHEN SQLCODE = ZERO                                 21990099
220000                   CONTINUE                                       22000099
220100                                                                  22010099
220200              WHEN SQLCODE = -904                                 22020099
220300              WHEN SQLCODE = -911                                 22030099
220400              WHEN SQLCODE = -913                                 22040099
220500                  PERFORM 9900-SOFT-ABORT                         22050099
220600                                                                  22060099
220700              WHEN SQLWARN0 NOT = SPACES                          22070099
220800              WHEN SQLCODE < +0                                   22080099
220900              WHEN SQLCODE > +0                                   22090099
221000                   MOVE '9010-UPDATE-RECITM'                      22100099
221100                                    TO DP013-PARAGRAPH            22110099
221200                   MOVE 'UNSUCCESSFUL UPDATE FOR TRECITM'         22120099
221300                                    TO DP013-MESSAGE-TEXT (1)     22130099
221400                   MOVE SQLCA       TO DP013-SQLCA                22140099
221500                   MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)   22150099
221600                   SET DP013-DB2-ABEND                            22160099
221700                       DP013-XCTL-DISPLAY-RESTART                 22170099
221800                                    TO TRUE                       22180099
221900                   PERFORM DP013-0000-PROCESS-ABEND               22190099
222000            END-EVALUATE                                          22200099
222100          END-IF                                                  22210099
222200                                                                  22220099
222300          PERFORM 4999-CLEANUP-RECDIS                             22230099
222400                                                                  22240099
222500          PERFORM 4800-DELETE-ODD-UNIT                            22250099
222600                                                                  22260099
222700     END-PERFORM.                                                 22270099
222800                                                                  22280099
222900 4800-DELETE-ODD-UNIT.                                            22290099
223000                                                                  22300099
223100     EXEC SQL                                                     22310099
223200          DELETE                                                  22320099
223300            FROM RCT_VRFD_ODD_UNT                                 22330099
223400            WHERE PO_NBR         = :DK-PO-NBR                     22340099
223500              AND PO_LNE_NBR     = :DK-PO-LNE-NBR                 22350099
223600              AND RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR                22360099
223700     END-EXEC.                                                    22370099
223800                                                                  22380099
223900     EVALUATE TRUE                                                22390099
224000         WHEN SQLCODE = ZERO                                      22400099
224100         WHEN SQLCODE = +100                                      22410099
224200              CONTINUE                                            22420099
224300         WHEN SQLCODE = -904                                      22430099
224400         WHEN SQLCODE = -911                                      22440099
224500         WHEN SQLCODE = -913                                      22450099
224600              PERFORM 9900-SOFT-ABORT                             22460099
224700                                                                  22470099
224800         WHEN SQLWARN0 NOT = SPACES                               22480099
224900         WHEN SQLCODE  NOT = ZERO                                 22490099
225000              MOVE '4800-DELETE-ODD-UNIT'                         22500099
225100                             TO DP013-PARAGRAPH                   22510099
225200              MOVE 'UNSUCCESSFUL DELETE OF RCT_VRFD_ODD_UNT'      22520099
225300                             TO DP013-MESSAGE-TEXT (1)            22530099
225400              MOVE DK-PO-NBR      TO PV-PO-NBR-PIC9               22540099
225500              MOVE DK-REC-SEQ-NBR TO PV-REC-SEQ-NBR-PIC9          22550099
225600              MOVE DK-PO-LNE-NBR  TO PV-PO-LNE-NBR-PIC9           22560099
225700              STRING 'PO '                                        22570099
225800                     PV-PO-NBR-PIC9                               22580099
225900                     ' SEQ '                                      22590099
226000                     PV-REC-SEQ-NBR-PIC9                          22600099
226100                     ' LINE '                                     22610099
226200                     PV-PO-LNE-NBR-PIC9                           22620099
226300                     DELIMITED BY SIZE                            22630099
226400                     INTO DP013-MESSAGE-TEXT (2)                  22640099
226500              MOVE SQLCA     TO DP013-SQLCA                       22650099
226600              MOVE 'RCT00009' TO DP013-DB2-TABLE-NAME (1)         22660099
226700              SET DP013-DB2-ABEND                                 22670099
226800                  DP013-XCTL-DISPLAY-RESTART                      22680099
226900                             TO TRUE                              22690099
227000              PERFORM DP013-0000-PROCESS-ABEND                    22700099
227100     END-EVALUATE.                                                22710099
227200                                                                  22720099
227300                                                                  22730099
227400*----------------------------------------------------------------*22740099
227500*    DELETE LINE LEVEL RECDIS.                                   *22750099
227600*----------------------------------------------------------------*22760099
227700 4999-CLEANUP-RECDIS.                                             22770099
227800                                                                  22780099
227900     EXEC SQL                                                     22790099
228000           DELETE                                                 22800099
228100             FROM TRECDIS                                         22810099
228200            WHERE ORD_NBR          = :DK-PO-NBR                   22820099
228300              AND ORD_LNE_NBR      = :DK-PO-LNE-NBR               22830099
228400              AND REC_SEQ_NBR      = :DK-REC-SEQ-NBR              22840099
228500              AND OPER_UNT_ID      = :DK-OPER-UNT-ID              22850099
228600              AND FCLTY_ID         = :DK-FCLTY-ID                 22860099
228700     END-EXEC                                                     22870099
228800                                                                  22880099
228900     EVALUATE TRUE                                                22890099
229000         WHEN SQLCODE = ZERO                                      22900099
229100         WHEN SQLCODE = +100                                      22910099
229200              CONTINUE                                            22920099
229300         WHEN SQLCODE = -904                                      22930099
229400         WHEN SQLCODE = -911                                      22940099
229500         WHEN SQLCODE = -913                                      22950099
229600              PERFORM 9900-SOFT-ABORT                             22960099
229700                                                                  22970099
229800         WHEN SQLWARN0 NOT = SPACES                               22980099
229900         WHEN SQLCODE      NOT = ZERO                             22990099
230000              MOVE '4999-CLEANUP-RECDIS'                          23000099
230100                             TO DP013-PARAGRAPH                   23010099
230200              MOVE 'UNSUCCESSFUL DELETE OF RECDIS DATA'           23020099
230300                             TO DP013-MESSAGE-TEXT (1)            23030099
230400              MOVE SQLCA         TO DP013-SQLCA                   23040099
230500              MOVE 'TRECDIS' TO DP013-DB2-TABLE-NAME (1)          23050099
230600              SET DP013-DB2-ABEND                                 23060099
230700                  DP013-XCTL-DISPLAY-RESTART                      23070099
230800                             TO TRUE                              23080099
230900                                                                  23090099
231000              PERFORM DP013-0000-PROCESS-ABEND                    23100099
231100     END-EVALUATE.                                                23110099
231200                                                                  23120099
231300 5000-ADD-RECITM.                                                 23130099
231400                                                                  23140099
231500                                                                  23150099
231600     MOVE ASC-PO-NBR           TO RECITM-ORD-NBR                  23160099
231700                                  DK-PO-NBR.                      23170099
231800     MOVE ASC-PO-LNE-NBR-N     TO RECITM-ORD-LNE-NBR.             23180099
231900     MOVE ASC-REC-SEQ-NBR      TO RECITM-REC-SEQ-NBR              23190099
232000                                  DK-REC-SEQ-NBR.                 23200099
232100     MOVE ASC-OPER-UNT-ID      TO RECITM-OPER-UNT-ID.             23210099
232200     MOVE ASC-FCLTY-ID         TO RECITM-FCLTY-ID.                23220099
232300     MOVE ASC-PURITM-VER-NBR   TO RECITM-PO-VER-NBR.              23230099
232400     MOVE ASC-ITM-NBR          TO RECITM-ITM-NBR.                 23240099
232500     MOVE ASC-PRE-TKT-IND      TO RECITM-PRE-TKT-IND.             23250099
232600     MOVE SPACES               TO RECITM-TKT-FMT-ID.              23260099
232700     MOVE SPACES               TO RECITM-RTV-IND.                 23270099
232800     MOVE PC-IP                TO RECITM-STATUS-CDE.              23280099
232900     MOVE ZERO                 TO RECITM-PKSL-ITM-QTY.            23290099
233000     MOVE ASC-DTL-CK-ITM-QTY-N TO RECITM-DTL-CK-ITM-QTY.          23300099
233100     MOVE ASC-DTL-PACK-RATIO-N TO RECITM-INNR-PACK-QTY.           23310099
233200                                                                  23320099
233300     MOVE ZERO                 TO RECITM-RTV-QTY.                 23330099
233400     MOVE ZERO                 TO RECITM-EXPTED-CART-CNT.         23340099
233500     MOVE ZERO                 TO RECITM-ACTL-CART-CNT.           23350099
233600     MOVE ASC-UNT-COST-AMT     TO RECITM-UNT-COST-AMT.            23360099
233700     MOVE ASC-UNT-RTL-PR-AMT   TO RECITM-UNT-RTL-AMT.             23370099
233800     MOVE ASC-GP-RTL-AMT       TO RECITM-GP-RTL-AMT.              23380099
233900     MOVE ASC-GP-QTY           TO RECITM-GP-QTY.                  23390099
234000                                                                  23400099
234100     MOVE SPACES               TO RECITM-COLOR-DESC.              23410099
234200     MOVE SPACES               TO RECITM-SIZE-DESC.               23420099
234300     MOVE SPACES               TO RECITM-VEND-STYL-NAME.          23430099
234400     MOVE SPACES               TO RECITM-VEND-DESC.               23440099
234500     MOVE SPACES               TO RECITM-PKSL-NBR.                23450099
234600     MOVE ZERO                 TO RECITM-REC-INV-LNE-NBR          23460099
234700                                  RECITM-DMG-ITM-QTY.             23470099
234800     MOVE PC-DEFAULT-TMST      TO RECITM-MKING-APRON-TMST         23480099
234900                                  RECITM-VERFYD-TMST.             23490099
235000     MOVE ASC-DEPT-NBR         TO DK-DEPT-NBR.                    23500099
235100     MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID.                 23510099
235200     MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID.                    23520099
235300     MOVE ASC-PACK-ID          TO RECITM-PREPK-ID                 23530099
235400                                  DK-PACK-ID.                     23540099
235500     MOVE ASC-DTL-PACK-RATIO-N TO RECITM-PREPK-RATO-QTY           23550099
235600     MOVE ASC-ODD-PACK-UNITS   TO RECITM-PREPK-ODD-UNT-QTY        23560099
235700     MOVE ASC-TKT-DESC         TO DK-TICKET-DESC.                 23570099
235800                                                                  23580099
235900     PERFORM 5010-RETRIEVE-POPRPK                                 23590099
236000     IF POPRPK-INPK-UNT-QTY > POPRPK-OTPK-UNT-QTY OR              23600099
236100        POPRPK-OTPK-UNT-QTY = 0                                   23610099
236200        MOVE +1              TO ASC-CASE-PACK-QTY                 23620099
236300     ELSE                                                         23630099
236400        DIVIDE POPRPK-OTPK-UNT-QTY BY POPRPK-INPK-UNT-QTY         23640099
236500                            GIVING  ASC-CASE-PACK-QTY             23650099
236600        IF ASC-CASE-PACK-QTY NOT > 0                              23660099
236700           MOVE +1            TO ASC-CASE-PACK-QTY                23670099
236800        END-IF                                                    23680099
236900     END-IF.                                                      23690099
237000                                                                  23700099
237100     MOVE ASC-CASE-PACK-QTY    TO RECITM-CASE-PACK-QTY.           23710099
237200                                                                  23720099
237300     PERFORM 5020-DETERMINE-IF-PACK.                              23730099
237400     IF PV-PACK-LINE-COUNT = 0                                    23740099
237500        MOVE 'A'               TO RECITM-PREPK-DRV-LNE-CDE        23750099
237600     ELSE                                                         23760099
237700        MOVE ' '               TO RECITM-PREPK-DRV-LNE-CDE.       23770099
237800                                                                  23780099
237900     PERFORM 4065-SELECT-TKT-FMT-ID.                              23790099
238000     PERFORM 2020-PREPARE-SELECT.                                 23800099
238100                                                                  23810099
238200     PERFORM 9007-SELECT-ORPHANS                                  23820099
238300     IF SQLCODE = +0                                              23830099
238400        PERFORM 9006-UPDATE-RECITM                                23840099
238500     ELSE                                                         23850099
238600        IF SQLCODE = +100                                         23860099
238700           PERFORM 9005-SELECT-INACTIVE                           23870099
238800           IF SQLCODE = +100                                      23880099
238900              PERFORM 9006-SELECT-ACTIVE                          23890099
239000              IF SQLCODE = +100                                   23900099
239100                 PERFORM 9010-INSERT-RECITM                       23910099
239200              ELSE                                                23920099
239300                 PERFORM 9006-UPDATE-RECITM                       23930099
239400              END-IF                                              23940099
239500           ELSE                                                   23950099
239600              PERFORM 9006-UPDATE-RECITM                          23960099
239700           END-IF                                                 23970099
239800        END-IF                                                    23980099
239900     END-IF.                                                      23990099
240000                                                                  24000099
240100     IF  SQLCODE = +0                                             24010099
240200                                                                  24020099
240300         PERFORM 2130-CHECK-PACK-BY-STORE                         24030099
240400                                                                  24040099
240500         IF PV-PACK-BY-ST-IND = PC-Y                              24050099
240600             MOVE PC-TSYMSG-01293 TO DP020-MSG-NUMBER             24060099
240700             SET DP020-MSG-INFORMATIONAL                          24070099
240800                                  TO  TRUE                        24080099
240900         END-IF                                                   24090099
241000                                                                  24100099
241100         IF  ASC-USE-SELECTION-QUEUE                              24110099
241200             PERFORM 5300-UPDATE-SELECTION-QUEUE                  24120099
241300         END-IF                                                   24130099
241400     ELSE                                                         24140099
241500         MOVE PC-TSYMSG-00117                                     24150099
241600                           TO DP020-MSG-NUMBER                    24160099
241700         SET DP020-MSG-INFORMATIONAL                              24170099
241800             DP030-OVERRIDE-GO                                    24180099
241900                           TO TRUE                                24190099
242000                                                                  24200099
242100     END-IF.                                                      24210099
242200                                                                  24220099
242300     PERFORM 4020-GET-STATUS-DESC.                                24230099
242400                                                                  24240099
242500 5010-RETRIEVE-POPRPK.                                            24250099
242600                                                                  24260099
242700     EXEC SQL                                                     24270099
242800          SELECT                                                  24280099
242900               INPK_UNT_QTY                                       24290099
243000              ,OTPK_UNT_QTY                                       24300099
243100           INTO                                                   24310099
243200              :POPRPK-INPK-UNT-QTY                                24320099
243300             ,:POPRPK-OTPK-UNT-QTY                                24330099
243400           FROM TPOPRPK A                                         24340099
243500           WHERE A.PO_NBR        = :DK-PO-NBR                     24350099
243600             AND A.PO_PREPK_ID   = :DK-PACK-ID                    24360099
243700     END-EXEC.                                                    24370099
243800                                                                  24380099
243900     EVALUATE TRUE                                                24390099
244000        WHEN SQLCODE = +0                                         24400099
244100        WHEN SQLCODE = +100                                       24410099
244200             CONTINUE                                             24420099
244300        WHEN SQLCODE = -904                                       24430099
244400        WHEN SQLCODE = -911                                       24440099
244500        WHEN SQLCODE = -913                                       24450099
244600             PERFORM 9900-SOFT-ABORT                              24460099
244700                                                                  24470099
244800        WHEN SQLWARN0 NOT = SPACES                                24480099
244900        WHEN SQLCODE < +0                                         24490099
245000        WHEN SQLCODE > +0                                         24500099
245100             MOVE '5010-RETRIEVE-POPRPK'                          24510099
245200                             TO DP013-PARAGRAPH                   24520099
245300             MOVE 'UNSUCCESSFUL SELECT POPRPK'                    24530099
245400                             TO DP013-MESSAGE-TEXT (1)            24540099
245500             MOVE SQLCA      TO DP013-SQLCA                       24550099
245600             MOVE 'TPOPRPK ' TO DP013-DB2-TABLE-NAME (1)          24560099
245700             SET DP013-DB2-ABEND                                  24570099
245800                 DP013-XCTL-DISPLAY-RESTART                       24580099
245900                             TO TRUE                              24590099
246000             PERFORM DP013-0000-PROCESS-ABEND                     24600099
246100     END-EVALUATE.                                                24610099
246200                                                                  24620099
246300*----------------------------------------------------------------*24630099
246400*    IF THERE ARE NO LINES WITHIN THE PACK, CERTAIN FKEYS WILL   *24640099
246500*    BE INVALID.                                                 *24650099
246600*----------------------------------------------------------------*24660099
246700                                                                  24670099
246800 5020-DETERMINE-IF-PACK.                                          24680099
246900     MOVE +0                      TO PV-PACK-LINE-COUNT.          24690099
247000                                                                  24700099
247100     EXEC SQL                                                     24710099
247200         SELECT COUNT(*)                                          24720099
247300         INTO :PV-PACK-LINE-COUNT                                 24730099
247400         FROM TRECITM A                                           24740099
247500         WHERE     A.ORD_NBR          = :DK-PO-NBR                24750099
247600               AND A.REC_SEQ_NBR      = :DK-REC-SEQ-NBR           24760099
247700               AND A.OPER_UNT_ID      = :DK-OPER-UNT-ID           24770099
247800               AND A.FCLTY_ID         = :DK-FCLTY-ID              24780099
247900               AND A.ORD_LNE_NBR      > 0                         24790099
248000               AND A.PREPK_ID         = :DK-PACK-ID               24800099
248100               AND A.PREPK_RATO_QTY   > 0                         24810099
248200     END-EXEC.                                                    24820099
248300                                                                  24830099
248400     EVALUATE TRUE                                                24840099
248500         WHEN SQLCODE = ZERO                                      24850099
248600         WHEN SQLCODE = +100                                      24860099
248700             CONTINUE                                             24870099
248800         WHEN SQLCODE = -904                                      24880099
248900         WHEN SQLCODE = -911                                      24890099
249000         WHEN SQLCODE = -913                                      24900099
249100              PERFORM 9900-SOFT-ABORT                             24910099
249200                                                                  24920099
249300         WHEN SQLWARN0 NOT = SPACE                                24930099
249400         WHEN SQLCODE < ZERO                                      24940099
249500         WHEN SQLCODE > ZERO                                      24950099
249600             MOVE '2170-DETERMINE-IF-PACK'                        24960099
249700                                 TO DP013-PARAGRAPH               24970099
249800             MOVE 'SELECT ON TRECITM'                             24980099
249900                                 TO DP013-MESSAGE-TEXT (1)        24990099
250000             MOVE SQLCA          TO DP013-SQLCA                   25000099
250100             MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (1)      25010099
250200             SET DP013-DB2-ABEND                                  25020099
250300                             TO TRUE                              25030099
250400             SET DP013-XCTL-DISPLAY-RESTART                       25040099
250500                             TO TRUE                              25050099
250600             PERFORM DP013-0000-PROCESS-ABEND                     25060099
250700     END-EVALUATE.                                                25070099
250800                                                                  25080099
250900 5050-CHECK-IF-IN-TROUBLE.                                        25090099
251000                                                                  25100099
251100     MOVE ZERO           TO  PV-DB2-COUNT.                        25110099
251200         EXEC SQL                                                 25120099
251300              SELECT COUNT(*)                                     25130099
251400                INTO :PV-DB2-COUNT :PV-NULL-IND                   25140099
251500                FROM TTRBNTF A                                    25150099
251600               WHERE A.PO_NBR        = :DK-PO-NBR                 25160099
251700                 AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR            25170099
251800                 AND A.PO_LNE_NBR    = :PC-ZERO                   25180099
251900                 AND A.OPER_UNT_ID   = :DK-OPER-UNT-ID            25190099
252000                 AND A.FCLTY_ID      = :DK-FCLTY-ID               25200099
252100                 AND A.PREPK_ID      = :PC-ZERO                   25210099
252200                 AND A.RESOLVED_IND IN ('N','I')                  25220099
252300         END-EXEC                                                 25230099
252400                                                                  25240099
252500         EVALUATE TRUE                                            25250099
252600             WHEN SQLCODE = +0                                    25260099
252700             WHEN SQLCODE = +100                                  25270099
252800                  CONTINUE                                        25280099
252900             WHEN SQLCODE = -904                                  25290099
253000             WHEN SQLCODE = -911                                  25300099
253100             WHEN SQLCODE = -913                                  25310099
253200                  PERFORM 9900-SOFT-ABORT                         25320099
253300                                                                  25330099
253400             WHEN SQLWARN0 NOT = SPACES                           25340099
253500             WHEN SQLCODE < +0                                    25350099
253600             WHEN SQLCODE > +0                                    25360099
253700                  MOVE '5050-CHECK-IF-IN-TROUBLE'                 25370099
253800                                  TO DP013-PARAGRAPH              25380099
253900                  MOVE 'UNSUCCESSFUL SELECT TROUBLE COUNT'        25390099
254000                                  TO DP013-MESSAGE-TEXT (1)       25400099
254100                  MOVE SQLCA      TO DP013-SQLCA                  25410099
254200                  MOVE 'TTRBNTF ' TO DP013-DB2-TABLE-NAME (1)     25420099
254300                  SET DP013-DB2-ABEND                             25430099
254400                      DP013-XCTL-DISPLAY-RESTART                  25440099
254500                                  TO TRUE                         25450099
254600                  PERFORM DP013-0000-PROCESS-ABEND                25460099
254700        END-EVALUATE.                                             25470099
254800                                                                  25480099
254900                                                                  25490099
255000*---------------------------------------------------------------- 25500099
255100* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS * 25510099
255200* OBJECT WAS UDPATED.                                           * 25520099
255300*---------------------------------------------------------------- 25530099
255400                                                                  25540099
255500 5300-UPDATE-SELECTION-QUEUE.                                     25550099
255600                                                                  25560099
255700     INITIALIZE RC801-SELECTED-ITEM-ARRAY                         25570099
255800     PERFORM 9100-READ-SEL-QUEUE.                                 25580099
255900                                                                  25590099
256000     SET RC801-UPD (ASC-SEL-SUB)   TO TRUE.                       25600099
256100     SET ASC-RECITM-SETUP-PREV     TO TRUE.                       25610099
256200     MOVE +1                 TO ASC-SEL-ITEM.                     25620099
256300                                                                  25630099
256400     PERFORM 9200-REWRITE-SEL-QUEUE.                              25640099
256500                                                                  25650099
256600                                                                  25660099
256700                                                                  25670099
256800*---------------------------------------------------------------- 25680099
256900*   SELECT INACTIVE ROWS.                                       * 25690099
257000*---------------------------------------------------------------- 25700099
257100 9005-SELECT-INACTIVE.                                            25710099
257200                                                                  25720099
257300     EXEC SQL                                                     25730099
257400          SELECT ORD_NBR                                          25740099
257500            INTO :RECITM-ORD-NBR                                  25750099
257600            FROM TRECITM                                          25760099
257700           WHERE ORD_NBR        = :DK-PO-NBR                      25770099
257800             AND ORD_LNE_NBR    = :DK-PO-LNE-NBR                  25780099
257900             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 25790099
258000             AND VER_STATUS_CDE = 'I'                             25800099
258100     END-EXEC.                                                    25810099
258200                                                                  25820099
258300     EVALUATE TRUE                                                25830099
258400         WHEN SQLCODE = +0                                        25840099
258500              SET PS-INACTIVE-EXISTS TO TRUE                      25850099
258600         WHEN SQLCODE = +100                                      25860099
258700              CONTINUE                                            25870099
258800                                                                  25880099
258900         WHEN SQLCODE = -904                                      25890099
259000         WHEN SQLCODE = -911                                      25900099
259100         WHEN SQLCODE = -913                                      25910099
259200              PERFORM 9900-SOFT-ABORT                             25920099
259300                                                                  25930099
259400         WHEN SQLWARN0 NOT = SPACES                               25940099
259500         WHEN SQLCODE < +0                                        25950099
259600         WHEN SQLCODE > +0                                        25960099
259700              MOVE '9005-SELECT-INACTIVE'                         25970099
259800                               TO DP013-PARAGRAPH                 25980099
259900              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               25990099
260000                               TO DP013-MESSAGE-TEXT (1)          26000099
260100              MOVE SQLCA       TO DP013-SQLCA                     26010099
260200              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        26020099
260300              SET DP013-DB2-ABEND                                 26030099
260400                  DP013-XCTL-DISPLAY-RESTART                      26040099
260500                               TO TRUE                            26050099
260600              PERFORM DP013-0000-PROCESS-ABEND                    26060099
260700     END-EVALUATE.                                                26070099
260800                                                                  26080099
260900                                                                  26090099
261000*---------------------------------------------------------------- 26100099
261100*   SELECT ACTIVE ROWS WITH 0 FOR PACK ID                       * 26110099
261200*---------------------------------------------------------------- 26120099
261300 9006-SELECT-ACTIVE.                                              26130099
261400                                                                  26140099
261500     EXEC SQL                                                     26150099
261600          SELECT ORD_NBR                                          26160099
261700            INTO :RECITM-ORD-NBR                                  26170099
261800            FROM TRECITM                                          26180099
261900           WHERE ORD_NBR        = :DK-PO-NBR                      26190099
262000             AND ORD_LNE_NBR    = :DK-PO-LNE-NBR                  26200099
262100             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 26210099
262200             AND VER_STATUS_CDE = 'A'                             26220099
262300             AND PREPK_ID       = 0                               26230099
262400     END-EXEC.                                                    26240099
262500                                                                  26250099
262600     EVALUATE TRUE                                                26260099
262700         WHEN SQLCODE = +0                                        26270099
262800              SET PS-INACTIVE-EXISTS TO TRUE                      26280099
262900         WHEN SQLCODE = +100                                      26290099
263000              CONTINUE                                            26300099
263100                                                                  26310099
263200         WHEN SQLCODE = -904                                      26320099
263300         WHEN SQLCODE = -911                                      26330099
263400         WHEN SQLCODE = -913                                      26340099
263500              PERFORM 9900-SOFT-ABORT                             26350099
263600                                                                  26360099
263700         WHEN SQLWARN0 NOT = SPACES                               26370099
263800         WHEN SQLCODE < +0                                        26380099
263900         WHEN SQLCODE > +0                                        26390099
264000              MOVE '9006-SELECT-ACTIVE'                           26400099
264100                               TO DP013-PARAGRAPH                 26410099
264200              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               26420099
264300                               TO DP013-MESSAGE-TEXT (1)          26430099
264400              MOVE SQLCA       TO DP013-SQLCA                     26440099
264500              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        26450099
264600              SET DP013-DB2-ABEND                                 26460099
264700                  DP013-XCTL-DISPLAY-RESTART                      26470099
264800                               TO TRUE                            26480099
264900              PERFORM DP013-0000-PROCESS-ABEND                    26490099
265000     END-EVALUATE.                                                26500099
265100                                                                  26510099
265200 9006-UPDATE-RECITM.                                              26520099
265300                                                                  26530099
265400     EXEC SQL                                                     26540099
265500          UPDATE TRECITM                                          26550099
265600             SET DTL_CK_ITM_QTY    = :RECITM-DTL-CK-ITM-QTY       26560099
265700                ,PREPK_ID          = :RECITM-PREPK-ID             26570099
265800                ,PREPK_RATO_QTY    = :RECITM-PREPK-RATO-QTY       26580099
265900                ,PREPK_ODD_UNT_QTY = :RECITM-PREPK-ODD-UNT-QTY    26590099
266000                ,VER_STATUS_CDE    = 'A'                          26600099
266100           WHERE ORD_NBR        = :DK-PO-NBR                      26610099
266200             AND ORD_LNE_NBR    = :DK-PO-LNE-NBR                  26620099
266300             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 26630099
266400     END-EXEC.                                                    26640099
266500                                                                  26650099
266600     EVALUATE TRUE                                                26660099
266700         WHEN SQLCODE = +0                                        26670099
266800              CONTINUE                                            26680099
266900                                                                  26690099
267000         WHEN SQLCODE = -904                                      26700099
267100         WHEN SQLCODE = -911                                      26710099
267200         WHEN SQLCODE = -913                                      26720099
267300              PERFORM 9900-SOFT-ABORT                             26730099
267400                                                                  26740099
267500         WHEN SQLWARN0 NOT = SPACES                               26750099
267600         WHEN SQLCODE < +0                                        26760099
267700         WHEN SQLCODE > +0                                        26770099
267800              MOVE '9010-SELECT-INACTIVE'                         26780099
267900                               TO DP013-PARAGRAPH                 26790099
268000              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               26800099
268100                               TO DP013-MESSAGE-TEXT (1)          26810099
268200              MOVE SQLCA       TO DP013-SQLCA                     26820099
268300              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        26830099
268400              SET DP013-DB2-ABEND                                 26840099
268500                  DP013-XCTL-DISPLAY-RESTART                      26850099
268600                               TO TRUE                            26860099
268700              PERFORM DP013-0000-PROCESS-ABEND                    26870099
268800     END-EVALUATE.                                                26880099
268900                                                                  26890099
269000                                                                  26900099
269100                                                                  26910099
269200*---------------------------------------------------------------- 26920099
269300*   DETERMINE IF THE LINE HAS BEEN TRANSCRIPTED ALREADY AND IS  * 26930099
269400*   IN ANOTHER PACK IN RECEIVING SYSTEM                         * 26940099
269500*---------------------------------------------------------------- 26950099
269600 9007-SELECT-ORPHANS.                                             26960099
269700                                                                  26970099
269800     EXEC SQL                                                     26980099
269900          SELECT ORD_NBR                                          26990099
270000            INTO :RECITM-ORD-NBR                                  27000099
270100            FROM TRECITM                                          27010099
270200           WHERE ORD_NBR        = :DK-PO-NBR                      27020099
270300             AND ORD_LNE_NBR    = :DK-PO-LNE-NBR                  27030099
270400             AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                 27040099
270500             AND PREPK_ID       > 0                               27050099
270600             AND VER_STATUS_CDE = 'A'                             27060099
270700     END-EXEC.                                                    27070099
270800                                                                  27080099
270900     EVALUATE TRUE                                                27090099
271000         WHEN SQLCODE = +0                                        27100099
271100              SET PS-INACTIVE-EXISTS TO TRUE                      27110099
271200         WHEN SQLCODE = +100                                      27120099
271300              CONTINUE                                            27130099
271400                                                                  27140099
271500         WHEN SQLCODE = -904                                      27150099
271600         WHEN SQLCODE = -911                                      27160099
271700         WHEN SQLCODE = -913                                      27170099
271800              PERFORM 9900-SOFT-ABORT                             27180099
271900                                                                  27190099
272000         WHEN SQLWARN0 NOT = SPACES                               27200099
272100         WHEN SQLCODE < +0                                        27210099
272200         WHEN SQLCODE > +0                                        27220099
272300              MOVE '9007-SELECT-ORPHANS'                          27230099
272400                               TO DP013-PARAGRAPH                 27240099
272500              MOVE 'UNSUCCESSFUL SELECT ON TRECITM'               27250099
272600                               TO DP013-MESSAGE-TEXT (1)          27260099
272700              MOVE SQLCA       TO DP013-SQLCA                     27270099
272800              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        27280099
272900              SET DP013-DB2-ABEND                                 27290099
273000                  DP013-XCTL-DISPLAY-RESTART                      27300099
273100                               TO TRUE                            27310099
273200              PERFORM DP013-0000-PROCESS-ABEND                    27320099
273300     END-EVALUATE.                                                27330099
273400                                                                  27340099
273500 9010-INSERT-RECITM.                                              27350099
273600                                                                  27360099
273700                                                                  27370099
273800*TCR  AUTOVE                                                      27380099
273900         SET PS-ORIG-ASN-PKSLIP-NO   TO TRUE.                     27390099
274000         PERFORM 9015-CHECK-ASN.                                  27400099
274100         MOVE 0 TO PV-ORIG-PKSL-ITM-QTY.                          27410099
274200         IF PS-ORIG-ASN-PKSLIP-YES                                27420099
274300            MOVE RECITM-PKSL-ITM-QTY TO PV-ORIG-PKSL-ITM-QTY      27430099
274400         END-IF.                                                  27440099
274500*TCR  AUTOVE                                                      27450099
274600                                                                  27460099
274700     EXEC SQL                                                     27470099
274800          INSERT INTO TRECITM                                     27480099
274900                 (ORD_NBR,                                        27490099
275000                  ORD_LNE_NBR,                                    27500099
275100                  REC_SEQ_NBR,                                    27510099
275200                  OPER_UNT_ID,                                    27520099
275300                  FCLTY_ID,                                       27530099
275400                  CRE_TMST,                                       27540099
275500                  CRE_UID,                                        27550099
275600                  PO_VER_NBR,                                     27560099
275700                  ITM_NBR,                                        27570099
275800                  PRE_TKT_IND,                                    27580099
275900                  TKT_FMT_ID,                                     27590099
276000                  RTV_IND,                                        27600099
276100                  STATUS_CDE,                                     27610099
276200                  VER_STATUS_CDE,                                 27620099
276300                  PKSL_ITM_QTY,                                   27630099
276400                  DTL_CK_ITM_QTY,                                 27640099
276500                  INNR_PACK_QTY,                                  27650099
276600                  CASE_PACK_QTY,                                  27660099
276700                  RTV_QTY,                                        27670099
276800                  EXPTED_CART_CNT,                                27680099
276900                  ACTL_CART_CNT,                                  27690099
277000                  MKING_APRON_TMST,                               27700099
277100                  UNT_COST_AMT,                                   27710099
277200                  COLOR_DESC,                                     27720099
277300                  SIZE_DESC,                                      27730099
277400                  VEND_STYL_NAME,                                 27740099
277500                  VEND_DESC,                                      27750099
277600                  VERFYD_TMST,                                    27760099
277700                  PKSL_NBR,                                       27770099
277800                  REC_INV_LNE_NBR,                                27780099
277900                  DMG_ITM_QTY,                                    27790099
278000                  UPD_PGM_ID,                                     27800099
278100                  LAST_TRSCP_TMST,                                27810099
278200                  LAST_TRSCP_USR_ID,                              27820099
278300                  PREPK_ID,                                       27830099
278400                  PREPK_RATO_QTY,                                 27840099
278500                  PREPK_ODD_UNT_QTY,                              27850099
278600                  PREPK_DRV_LNE_CDE,                              27860099
278700                  UNT_RTL_AMT,                                    27870099
278800                  GP_RTL_AMT,                                     27880099
278900                  GP_QTY,                                         27890099
279000                  ORIG_PKSL_ITM_QTY)                              27900099
279100          VALUES (:RECITM-ORD-NBR,                                27910099
279200                  :RECITM-ORD-LNE-NBR,                            27920099
279300                  :RECITM-REC-SEQ-NBR,                            27930099
279400                  :RECITM-OPER-UNT-ID,                            27940099
279500                  :RECITM-FCLTY-ID,                               27950099
279600                   CURRENT TIMESTAMP,                             27960099
279700                  :DP020-USERID,                                  27970099
279800                  :RECITM-PO-VER-NBR,                             27980099
279900                  :RECITM-ITM-NBR,                                27990099
280000                  :RECITM-PRE-TKT-IND,                            28000099
280100                  :RECITM-TKT-FMT-ID,                             28010099
280200                  :RECITM-RTV-IND,                                28020099
280300                  :RECITM-STATUS-CDE,                             28030099
280400                  :PC-ACTIVE,                                     28040099
280500                  :RECITM-PKSL-ITM-QTY,                           28050099
280600                  :RECITM-DTL-CK-ITM-QTY,                         28060099
280700                  :RECITM-INNR-PACK-QTY,                          28070099
280800                  :RECITM-CASE-PACK-QTY,                          28080099
280900                  :RECITM-RTV-QTY,                                28090099
281000                  :RECITM-EXPTED-CART-CNT,                        28100099
281100                  :RECITM-ACTL-CART-CNT,                          28110099
281200                  :RECITM-MKING-APRON-TMST,                       28120099
281300                  :RECITM-UNT-COST-AMT,                           28130099
281400                  :RECITM-COLOR-DESC,                             28140099
281500                  :RECITM-SIZE-DESC,                              28150099
281600                  :RECITM-VEND-STYL-NAME,                         28160099
281700                  :RECITM-VEND-DESC,                              28170099
281800                  :RECITM-VERFYD-TMST,                            28180099
281900                  :RECITM-PKSL-NBR,                               28190099
282000                  :RECITM-REC-INV-LNE-NBR,                        28200099
282100                  :RECITM-DMG-ITM-QTY,                            28210099
282200                  :PC-CURRENT-PROGRAM-NAME,                       28220099
282300                  CURRENT TIMESTAMP,                              28230099
282400                  :DP020-USERID,                                  28240099
282500                  :RECITM-PREPK-ID,                               28250099
282600                  :RECITM-PREPK-RATO-QTY,                         28260099
282700                  :RECITM-PREPK-ODD-UNT-QTY,                      28270099
282800                  :RECITM-PREPK-DRV-LNE-CDE,                      28280099
282900                  :RECITM-UNT-RTL-AMT,                            28290099
283000                  :RECITM-GP-RTL-AMT,                             28300099
283100                  :RECITM-GP-QTY,                                 28310099
283200                  :PV-ORIG-PKSL-ITM-QTY)                          28320099
283300     END-EXEC.                                                    28330099
283400                                                                  28340099
283500     EVALUATE TRUE                                                28350099
283600         WHEN SQLCODE = +0                                        28360099
283700         WHEN SQLCODE = +100                                      28370099
283800              CONTINUE                                            28380099
283900         WHEN SQLCODE = -803                                      28390099
284000              MOVE PC-TSYMSG-00117 TO DP020-MSG-NUMBER            28400099
284100              SET DP020-MSG-INFORMATIONAL                         28410099
284200                  DP030-OVERRIDE-GO                               28420099
284300                                   TO TRUE                        28430099
284400         WHEN SQLCODE = -904                                      28440099
284500         WHEN SQLCODE = -911                                      28450099
284600         WHEN SQLCODE = -913                                      28460099
284700              PERFORM 9900-SOFT-ABORT                             28470099
284800                                                                  28480099
284900         WHEN SQLWARN0 NOT = SPACES                               28490099
285000         WHEN SQLCODE < +0                                        28500099
285100         WHEN SQLCODE > +0                                        28510099
285200              MOVE '9010-INSERT-RECITM'                           28520099
285300                               TO DP013-PARAGRAPH                 28530099
285400              MOVE 'UNSUCCESSFUL INSERT FOR TRECITM'              28540099
285500                               TO DP013-MESSAGE-TEXT (1)          28550099
285600              MOVE SQLCA       TO DP013-SQLCA                     28560099
285700              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        28570099
285800              SET DP013-DB2-ABEND                                 28580099
285900                  DP013-XCTL-DISPLAY-RESTART                      28590099
286000                               TO TRUE                            28600099
286100              PERFORM DP013-0000-PROCESS-ABEND                    28610099
286200     END-EVALUATE.                                                28620099
286300                                                                  28630099
286400                                                                  28640099
286500******************************************************************28650099
286600**  CHECK TO SEE IF ASN IS ORIGINAL (CRE_UID = RCKUP006)        **28660099
286700******************************************************************28670099
286800 9015-CHECK-ASN.                                                  28680099
286900                                                                  28690099
287000         MOVE 0 TO PV-COUNTER                                     28700099
287100                   PV-NULL-IND.                                   28710099
287200                                                                  28720099
287300         EXEC SQL                                                 28730099
287400           SELECT COUNT(CRE_UID)                                  28740099
287500           INTO  :PV-COUNTER:PV-NULL-IND                          28750099
287600           FROM   TPKSLIP                                         28760099
287700           WHERE  PO_NBR       = :DK-PO-NBR                       28770099
287800             AND  REC_SEQ_NBR  = :DK-REC-SEQ-NBR                  28780099
287900             AND  CRE_UID      = 'RCKUP006'                       28790099
288000         END-EXEC.                                                28800099
288100                                                                  28810099
288200         EVALUATE TRUE                                            28820099
288300             WHEN SQLCODE = ZERO                                  28830099
288400                  IF PV-COUNTER > 0                               28840099
288500                     SET PS-ORIG-ASN-PKSLIP-YES  TO TRUE          28850099
288600                  END-IF                                          28860099
288700             WHEN SQLCODE = +100                                  28870099
288800                  CONTINUE                                        28880099
288900             WHEN SQLCODE = -904                                  28890099
289000             WHEN SQLCODE = -911                                  28900099
289100             WHEN SQLCODE = -913                                  28910099
289200                  PERFORM 9900-SOFT-ABORT                         28920099
289300                                                                  28930099
289400             WHEN SQLWARN0 NOT = SPACES                           28940099
289500             WHEN SQLCODE  NOT = ZERO                             28950099
289600                  MOVE '9015-CHECK-ASN'                           28960099
289700                               TO DP013-PARAGRAPH                 28970099
289800                  MOVE 'UNSUCCESSFUL SELECT FOR TPKSLIP'          28980099
289900                               TO DP013-MESSAGE-TEXT (1)          28990099
290000                  MOVE SQLCA       TO DP013-SQLCA                 29000099
290100                  MOVE 'TPKSLIP '  TO DP013-DB2-TABLE-NAME (1)    29010099
290200                  SET DP013-DB2-ABEND                             29020099
290300                      DP013-XCTL-DISPLAY-RESTART                  29030099
290400                                   TO TRUE                        29040099
290500                  PERFORM DP013-0000-PROCESS-ABEND                29050099
290600         END-EVALUATE.                                            29060099
290700                                                                  29070099
290800**----------------------------------------------------------------29080099
290900*  CHECK FOR PACK LEVEL TROUBLE AFTER ADD IS SUCCESSFUL          *29090099
291000*----------------------------------------------------------------*29100099
291100 9040-CHECK-FOR-TROUBLE.                                          29110099
291200                                                                  29120099
291300     INITIALIZE TM500-FIELDS.                                     29130099
291400                                                                  29140099
291500     SET  TM500-CREATE-AUTO                                       29150099
291600          TM500-REDISTRO-YES                                      29160099
291700          TM500-PACK-LEVEL                                        29170099
291800          TM500-NO-DETAILS         TO TRUE.                       29180099
291900                                                                  29190099
292000     PERFORM 2020-PREPARE-SELECT.                                 29200099
292100     PERFORM 5255-RETRIEVE-DRIVER-LINE.                           29210099
292200     MOVE DK-PO-NBR                TO TM500-PO-NBR.               29220099
292300     MOVE RECITM-ORD-LNE-NBR       TO TM500-PO-LNE-NBR.           29230099
292400     MOVE ASC-OPER-UNT-ID          TO TM500-OPER-UNT-ID.          29240099
292500     MOVE ASC-FCLTY-ID             TO TM500-FCLTY-ID.             29250099
292600     MOVE ASC-REC-SEQ-NBR          TO TM500-REC-SEQ-NBR.          29260099
292700     MOVE ASC-DTL-CK-ITM-QTY-N     TO TM500-UNITS-TO-ALLOC.       29270099
292800     MOVE ASC-PACK-ID              TO TM500-PREPK-ID.             29280099
292900     MOVE PC-CURRENT-PROGRAM-NAME  TO TM500-NOTIF-UID.            29290099
293000                                                                  29300099
293100     PERFORM 9045-GET-PURITM.                                     29310099
293200                                                                  29320099
293300     IF PV-NBR-OF-PIC-AD > 0                                      29330099
293400        MOVE 'Y'                   TO TM500-AD-SW                 29340099
293500     ELSE                                                         29350099
293600        MOVE 'N'                   TO TM500-AD-SW.                29360099
293700                                                                  29370099
293800     EXEC CICS                                                    29380099
293900         LINK PROGRAM  (PC-LINE-TROUBLE-RTN)                      29390099
294000              COMMAREA (TM500-FIELDS)                             29400099
294100              LENGTH   (PC-LINE-TROUBLE-RTN-LENGTH)               29410099
294200     END-EXEC.                                                    29420099
294300                                                                  29430099
294400     EVALUATE TRUE                                                29440099
294500         WHEN TM500-CALL-SUCCESSFUL                               29450099
294600         WHEN TM500-DUPLICATE-TROUBLE                             29460099
294700         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        29470099
294800* JAK 05/2007 - ADD MSG FOR WMS PROCESSING                        29480099
294900**         MOVE PC-TSYMSG-02161         TO DP020-MSG-NUMBER       29490099
295000**         SET DP020-MSG-INFORMATIONAL                            29500099
295100**             PS-ERROR                 TO TRUE                   29510099
295200           IF TM500-ASN-SENT-TO-WMS-YES                           29520099
295300               MOVE PC-TSYMSG-03570         TO DP020-MSG-NUMBER   29530099
295400               SET DP020-MSG-INFORMATIONAL                        29540099
295500                   PS-ERROR                 TO TRUE               29550099
295600           ELSE                                                   29560099
295700               MOVE PC-TSYMSG-02161         TO DP020-MSG-NUMBER   29570099
295800               SET DP020-MSG-INFORMATIONAL                        29580099
295900                   PS-ERROR                 TO TRUE               29590099
296000           END-IF                                                 29600099
296100* JAK 05/2007 - END                                               29610099
296200                                                                  29620099
296300         WHEN TM500-INVALID-PRORATION                             29630099
296400              SET DP020-MSG-WARNING                               29640099
296500                  PS-ERROR                 TO TRUE                29650099
296600              MOVE PC-TSYMSG-02452         TO DP020-MSG-NUMBER    29660099
296700                                                                  29670099
296800         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                       29680099
296900              MOVE PC-TSYMSG-02239         TO DP020-MSG-NUMBER    29690099
297000              SET DP020-MSG-INFORMATIONAL                         29700099
297100                  PS-ERROR                 TO TRUE                29710099
297200                                                                  29720099
297300         WHEN TM500-PREPACK-DB2-TIMEOUT                           29730099
297400              PERFORM 9900-SOFT-ABORT                             29740099
297500                                                                  29750099
297600         WHEN OTHER                                               29760099
297700           EXEC CICS                                              29770099
297800               SYNCPOINT ROLLBACK                                 29780099
297900           END-EXEC                                               29790099
298000           STRING TM500-PREPACK-PGM-NBR '-'                       29800099
298100                  TM500-PREPACK-ERROR-NBR                         29810099
298200                  DELIMITED BY SIZE                               29820099
298300                                        INTO DP020-MSG-TEXT       29830099
298400           MOVE PC-TSYMSG-02229         TO DP020-MSG-NUMBER       29840099
298500           SET DP020-MSG-FATAL                                    29850099
298600               PS-ERROR                 TO TRUE                   29860099
298700     END-EVALUATE.                                                29870099
298800                                                                  29880099
298900 9045-GET-PURITM.                                                 29890099
299000                                                                  29900099
299100     EXEC SQL                                                     29910099
299200          SELECT DISTINCT                                         29920099
299300                 COUNT (*)                                        29930099
299400            INTO                                                  29940099
299500                 :PV-NBR-OF-PIC-AD                                29950099
299600            FROM TPURCHS A,                                       29960099
299700                 TPURITM B,                                       29970099
299800                 TRECITM C                                        29980099
299900           WHERE A.PO_NBR         = :DK-PO-NBR                    29990099
300000             AND A.VER_STATUS_CDE = 'A'                           30000099
300100             AND A.PO_NBR         = B.PO_NBR                      30010099
300200             AND A.PO_NBR         = C.ORD_NBR                     30020099
300300             AND B.PO_PREPK_ID    = :DK-PACK-ID                   30030099
300400             AND B.PIC_ITM_IND    = 'Y'                           30040099
300500             AND C.ORD_LNE_NBR    = B.APP_PO_LNE_NBR              30050099
300600             AND C.PREPK_ID       = B.PO_PREPK_ID                 30060099
300700             AND C.VER_STATUS_CDE = 'A'                           30070099
300800     END-EXEC.                                                    30080099
300900                                                                  30090099
301000     EVALUATE TRUE                                                30100099
301100         WHEN SQLCODE = +0                                        30110099
301200         WHEN SQLCODE = +100                                      30120099
301300              CONTINUE                                            30130099
301400         WHEN SQLCODE = -904                                      30140099
301500         WHEN SQLCODE = -911                                      30150099
301600         WHEN SQLCODE = -913                                      30160099
301700              PERFORM 9900-SOFT-ABORT                             30170099
301800                                                                  30180099
301900         WHEN SQLWARN0 NOT = SPACES                               30190099
302000         WHEN SQLCODE < +0                                        30200099
302100         WHEN SQLCODE > +0                                        30210099
302200              MOVE '6150-GET-PURITM'                              30220099
302300                               TO DP013-PARAGRAPH                 30230099
302400              MOVE 'UNSUCCESSFUL SELECT ON PO ITEM'               30240099
302500                               TO DP013-MESSAGE-TEXT (1)          30250099
302600              MOVE SQLCA       TO DP013-SQLCA                     30260099
302700              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        30270099
302800              SET DP013-DB2-ABEND                                 30280099
302900                  DP013-XCTL-DISPLAY-RESTART                      30290099
303000                               TO TRUE                            30300099
303100              PERFORM DP013-0000-PROCESS-ABEND                    30310099
303200     END-EVALUATE.                                                30320099
303300                                                                  30330099
303400                                                                  30340099
303500**----------------------------------------------------------------30350099
303600*    RETRIEVE THE VERSION NUMBER AND SEQUENCE NUMBER             *30360099
303700*    OF THE PURCHASE ORDER LINE                                  *30370099
303800*----------------------------------------------------------------*30380099
303900 9050-GET-PURITM.                                                 30390099
304000                                                                  30400099
304100     MOVE ASC-PO-NBR               TO DK-PO-NBR.                  30410099
304200                                                                  30420099
304300     EXEC SQL                                                     30430099
304400          SELECT DISTINCT                                         30440099
304500                 A.DEPT_NBR,                                      30450099
304600                 A.ENT_ID,                                        30460099
304700                 B.VER_NBR,                                       30470099
304800                 B.SKU_SEQ_NBR,                                   30480099
304900                 B.VEND_STYL_NAME,                                30490099
305000                 B.COLOR_DESC,                                    30500099
305100                 B.SIZE_DESC,                                     30510099
305200                 B.UNT_RTL_PR_AMT,                                30520099
305300                 B.UNT_COST_AMT,                                  30530099
305400                 B.STATUS_CDE,                                    30540099
305500                 B.ITM_NBR,                                       30550099
305600                 B.GP_RTL_AMT,                                    30560099
305700                 B.GP_QTY,                                        30570099
305800                 B.PIC_ITM_IND,                                   30580099
305900                 B.PREPK_RATO_QTY                                 30590099
306000            INTO :PURCHS-DEPT-NBR,                                30600099
306100                 :PURCHS-ENT-ID,                                  30610099
306200                 :PURITM-VER-NBR,                                 30620099
306300                 :PURITM-SKU-SEQ-NBR,                             30630099
306400                 :PURITM-VEND-STYL-NAME,                          30640099
306500                 :PURITM-COLOR-DESC,                              30650099
306600                 :PURITM-SIZE-DESC,                               30660099
306700                 :PURITM-UNT-RTL-PR-AMT,                          30670099
306800                 :PURITM-UNT-COST-AMT,                            30680099
306900                 :PV-PURITM-STATUS-CDE,                           30690099
307000                 :PURITM-ITM-NBR,                                 30700099
307100                 :PURITM-GP-RTL-AMT,                              30710099
307200                 :PURITM-GP-QTY,                                  30720099
307300                 :ASC-PURITM-PIC-ITM-IND,                         30730099
307400                 :PURITM-PREPK-RATO-QTY                           30740099
307500            FROM TPURCHS A                                        30750099
307600               , TPURITM B                                        30760099
307700           WHERE A.PO_NBR         = :DK-PO-NBR                    30770099
307800             AND A.VER_STATUS_CDE = :PC-ACTIVE                    30780099
307900             AND A.PO_NBR         = B.PO_NBR                      30790099
308000             AND B.VER_STATUS_CDE = :PC-ACTIVE                    30800099
308100             AND B.APP_PO_LNE_NBR = :DK-PO-LNE-NBR                30810099
308200             AND B.PO_PREPK_ID    = :DK-PACK-ID                   30820099
308300     END-EXEC.                                                    30830099
308400                                                                  30840099
308500*----------------------------------------------------------------*30850099
308600*                                                   WR # 230ZZ   *30860099
308700* IF THE SQL STATEMENT IS SUCCESSFUL, THEN SET PS-CALL-API-YES   *30870099
308800* TO TRUE.                                                       *30880099
308900* ADDED A MOVE STATEMENT, TO MOVE VALUE OF PURITM-SKU-SEQ-NBR TO *30890099
309000* DK-SKU-SEQ.                                                    *30900099
309100* ADDED A MOVE STATEMENT, TO MOVE VALUE OF PURITM-ITM-NBR TO     *30910099
309200* DK-ITM-NBR.                                                    *30920099
309300*----------------------------------------------------------------*30930099
309400     MOVE SPACES TO DK-SKU-SEQ                                    30940099
309500     MOVE ZEROES TO DK-ITM-NBR                                    30950099
309600                                                                  30960099
309700     EVALUATE TRUE                                                30970099
309800         WHEN SQLCODE = +0                                        30980099
309900              SET PS-CALL-API-YES     TO TRUE                     30990099
310000              MOVE PURITM-SKU-SEQ-NBR TO DK-SKU-SEQ               31000099
310100              MOVE PURITM-ITM-NBR     TO DK-ITM-NBR               31010099
310200              SET PS-PURITM-FOUND                                 31020099
310300                               TO TRUE                            31030099
310400         WHEN SQLCODE = +100                                      31040099
310500              SET PS-PURITM-NOT-FOUND                             31050099
310600                               TO TRUE                            31060099
310700         WHEN SQLCODE = -904                                      31070099
310800         WHEN SQLCODE = -911                                      31080099
310900         WHEN SQLCODE = -913                                      31090099
311000              PERFORM 9900-SOFT-ABORT                             31100099
311100                                                                  31110099
311200         WHEN SQLWARN0 NOT = SPACES                               31120099
311300         WHEN SQLCODE < +0                                        31130099
311400         WHEN SQLCODE > +0                                        31140099
311500              MOVE '9050-GET-PURITM'                              31150099
311600                               TO DP013-PARAGRAPH                 31160099
311700              MOVE 'UNSUCCESSFUL SELECT ON PO ITEM'               31170099
311800                               TO DP013-MESSAGE-TEXT (1)          31180099
311900              MOVE SQLCA       TO DP013-SQLCA                     31190099
312000              MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)        31200099
312100              SET DP013-DB2-ABEND                                 31210099
312200                  DP013-XCTL-DISPLAY-RESTART                      31220099
312300                               TO TRUE                            31230099
312400              PERFORM DP013-0000-PROCESS-ABEND                    31240099
312500     END-EVALUATE.                                                31250099
312600*----------------------------------------------------------------*31260099
312700* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *31270099
312800*----------------------------------------------------------------*31280099
312900                                                                  31290099
313000*----------------------------------------------------------------*31300099
313100*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *31310099
313200*----------------------------------------------------------------*31320099
313300                                                                  31330099
313400 9100-READ-SEL-QUEUE.                                             31340099
313500                                                                  31350099
313600     EXEC CICS                                                    31360099
313700         READQ TS                                                 31370099
313800             QUEUE (ASC-SEL-QUEUE-NAME)                           31380099
313900             INTO  (RC801-PREPACK-SELECT-RECORD)                  31390099
314000             ITEM  (ASC-SEL-ITEM)                                 31400099
314100             RESP  (PV-CICS-RESPONSE)                             31410099
314200     END-EXEC.                                                    31420099
314300                                                                  31430099
314400     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       31440099
314500         CONTINUE                                                 31450099
314600     ELSE                                                         31460099
314700         SET DP013-LOGIC-ABEND                                    31470099
314800             DP013-NO-ROLLBACK     TO TRUE                        31480099
314900         MOVE '9100-READ-SEL-QUEUE'                               31490099
315000                                   TO DP013-PARAGRAPH             31500099
315100         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   31510099
315200                                   TO DP013-MESSAGE-TEXT (1)      31520099
315300         PERFORM DP013-0000-PROCESS-ABEND                         31530099
315400     END-IF.                                                      31540099
315500                                                                  31550099
315600                                                                  31560099
315700*---------------------------------------------------------------- 31570099
315800*   UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     * 31580099
315900*---------------------------------------------------------------- 31590099
316000 9200-REWRITE-SEL-QUEUE.                                          31600099
316100                                                                  31610099
316200     EXEC CICS                                                    31620099
316300          WRITEQ TS                                               31630099
316400              QUEUE  (ASC-SEL-QUEUE-NAME)                         31640099
316500              FROM   (RC801-PREPACK-SELECT-RECORD)                31650099
316600              ITEM   (ASC-SEL-ITEM)                               31660099
316700              RESP   (PV-CICS-RESPONSE)                           31670099
316800              REWRITE                                             31680099
316900     END-EXEC.                                                    31690099
317000                                                                  31700099
317100     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   31710099
317200         SET DP013-CICS-ABEND                                     31720099
317300             DP013-NO-ROLLBACK     TO TRUE                        31730099
317400         MOVE '9200-REWRITE-SEL-QUEUE'                            31740099
317500                                   TO DP013-PARAGRAPH             31750099
317600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   31760099
317700                                   TO DP013-MESSAGE-TEXT (1)      31770099
317800         PERFORM DP013-0000-PROCESS-ABEND                         31780099
317900     END-IF.                                                      31790099
318000                                                                  31800099
318100*----------------------------------------------------------------*31810099
318200*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *31820099
318300*----------------------------------------------------------------*31830099
318400                                                                  31840099
318500 9300-WRITE-SEL-QUEUE.                                            31850099
318600                                                                  31860099
318700     EXEC CICS                                                    31870099
318800          WRITEQ TS                                               31880099
318900              QUEUE (ASC-SEL-QUEUE-NAME)                          31890099
319000              FROM  (RC801-PREPACK-SELECT-RECORD)                 31900099
319100              ITEM  (ASC-SEL-ITEM)                                31910099
319200              RESP  (PV-CICS-RESPONSE)                            31920099
319300     END-EXEC.                                                    31930099
319400                                                                  31940099
319500     IF  PV-CICS-RESPONSE = DFHRESP (NORMAL)                      31950099
319600         CONTINUE                                                 31960099
319700     ELSE                                                         31970099
319800         SET DP013-CICS-ABEND      TO TRUE                        31980099
319900         SET DP013-NO-ROLLBACK     TO TRUE                        31990099
320000         MOVE '5204-WRITE-SEL-QUEUE2'                             32000099
320100                                   TO DP013-PARAGRAPH             32010099
320200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          32020099
320300                                   TO DP013-MESSAGE-TEXT(1)       32030099
320400         PERFORM DP013-0000-PROCESS-ABEND                         32040099
320500     END-IF.                                                      32050099
320600                                                                  32060099
320700*----------------------------------------------------------------*32070099
320800* OPEN THE TRECITM  CURSOR                                       *32080099
320900*----------------------------------------------------------------*32090099
321000                                                                  32100099
321100 9400-OPEN-CURSOR.                                                32110099
321200                                                                  32120099
321300         EXEC SQL                                                 32130099
321400             OPEN TRECITM-CSR                                     32140099
321500         END-EXEC                                                 32150099
321600                                                                  32160099
321700         EVALUATE TRUE                                            32170099
321800             WHEN SQLCODE = +0                                    32180099
321900                  CONTINUE                                        32190099
322000             WHEN SQLCODE = -904                                  32200099
322100             WHEN SQLCODE = -911                                  32210099
322200             WHEN SQLCODE = -913                                  32220099
322300                  PERFORM 9900-SOFT-ABORT                         32230099
322400             WHEN SQLWARN0 NOT = SPACE                            32240099
322500             WHEN SQLCODE  NOT = +0                               32250099
322600                  MOVE '9400-OPEN-CURSOR'                         32260099
322700                                   TO DP013-PARAGRAPH             32270099
322800                  MOVE 'OPEN CURSOR'                              32280099
322900                                   TO DP013-MESSAGE-TEXT (1)      32290099
323000                  MOVE SQLCA       TO DP013-SQLCA                 32300099
323100                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)    32310099
323200                  SET DP013-DB2-ABEND                             32320099
323300                                   TO TRUE                        32330099
323400                  PERFORM DP013-0000-PROCESS-ABEND                32340099
323500         END-EVALUATE.                                            32350099
323600/                                                                 32360099
323700*----------------------------------------------------------------*32370099
323800* CLOSE THE RECITM   CURSOR                                      *32380099
323900*----------------------------------------------------------------*32390099
324000                                                                  32400099
324100 9410-CLOSE-CURSOR.                                               32410099
324200                                                                  32420099
324300     EXEC SQL                                                     32430099
324400          CLOSE TRECITM-CSR                                       32440099
324500     END-EXEC.                                                    32450099
324600                                                                  32460099
324700     EVALUATE TRUE                                                32470099
324800         WHEN SQLCODE = +0                                        32480099
324900              CONTINUE                                            32490099
325000         WHEN SQLCODE = -904                                      32500099
325100         WHEN SQLCODE = -911                                      32510099
325200         WHEN SQLCODE = -913                                      32520099
325300              PERFORM 9900-SOFT-ABORT                             32530099
325400         WHEN SQLWARN0 NOT = SPACE                                32540099
325500         WHEN SQLCODE  NOT = +0                                   32550099
325600              MOVE '9410-CLOSE-CURSOR'                            32560099
325700                                   TO DP013-PARAGRAPH             32570099
325800              MOVE 'CLOSE CURSOR'  TO DP013-MESSAGE-TEXT (1)      32580099
325900              MOVE SQLCA           TO DP013-SQLCA                 32590099
326000              MOVE 'TRECITM'       TO DP013-DB2-TABLE-NAME (1)    32600099
326100              SET DP013-DB2-ABEND  TO TRUE                        32610099
326200              PERFORM DP013-0000-PROCESS-ABEND                    32620099
326300     END-EVALUATE.                                                32630099
326400                                                                  32640099
326500*----------------------------------------------------------------*32650099
326600*    FETCH A TPURITM ROW                                         *32660099
326700*----------------------------------------------------------------*32670099
326800 9420-FETCH.                                                      32680099
326900                                                                  32690099
327000     EXEC SQL                                                     32700099
327100         FETCH TRECITM-CSR                                        32710099
327200            INTO                                                  32720099
327300                 :PV-TEMP-ORD-LNE-NBR                             32730099
327400                ,:PV-TEMP-STATUS-CDE                              32740099
327500                ,:PV-TEMP-CASE-PACK-QTY                           32750099
327600                ,:PV-TEMP-DTL-CK-ITM-QTY                          32760099
327700                ,:PV-TEMP-PKSL-ITM-QTY                            32770099
327800                ,:PV-TEMP-DTL-PACK-RATIO                          32780099
327900                ,:PV-TEMP-PREPK-ODD-UNT-QTY                       32790099
328000                ,:PV-TEMP-DRV-LNE-CDE                             32800099
328100     END-EXEC.                                                    32810099
328200                                                                  32820099
328300     EVALUATE TRUE                                                32830099
328400         WHEN SQLCODE = +0                                        32840099
328500              PERFORM 9430-LOAD-VALIDATION                        32850099
328600         WHEN SQLCODE = +100                                      32860099
328700              SET ASC-NO-ITEMS-LEFT-ON-DB                         32870099
328800                                   TO TRUE                        32880099
328900         WHEN SQLCODE = -904                                      32890099
329000         WHEN SQLCODE = -911                                      32900099
329100         WHEN SQLCODE = -913                                      32910099
329200              PERFORM 9900-SOFT-ABORT                             32920099
329300         WHEN SQLWARN0 NOT = SPACE                                32930099
329400         WHEN SQLCODE < +0                                        32940099
329500         WHEN SQLCODE > +0                                        32950099
329600              MOVE '9420-FETCH'    TO DP013-PARAGRAPH             32960099
329700              MOVE 'FETCH TPURITM CURSOR'                         32970099
329800                                   TO DP013-MESSAGE-TEXT (1)      32980099
329900              MOVE SQLCA           TO DP013-SQLCA                 32990099
330000              MOVE 'TRECITM'       TO DP013-DB2-TABLE-NAME (1)    33000099
330100              SET DP013-DB2-ABEND  TO TRUE                        33010099
330200              PERFORM DP013-0000-PROCESS-ABEND                    33020099
330300     END-EVALUATE.                                                33030099
330400                                                                  33040099
330500                                                                  33050099
330600*----------------------------------------------------------------*33060099
330700*    FETCH A TPURITM ROW                                         *33070099
330800*----------------------------------------------------------------*33080099
330900                                                                  33090099
331000 9430-LOAD-VALIDATION.                                            33100099
331100     MOVE PV-TEMP-ORD-LNE-NBR        TO RC806-PKSL-LNE-NBR        33110099
331200                                        (PV-VALID-IDX).           33120099
331300                                                                  33130099
331400     MOVE PV-TEMP-PKSL-ITM-QTY       TO RC806-UNIT-QTY            33140099
331500                                        (PV-VALID-IDX).           33150099
331600                                                                  33160099
331700     MOVE PV-TEMP-DTL-PACK-RATIO     TO RC806-RC-RATIO            33170099
331800                                        (PV-VALID-IDX).           33180099
331900     MOVE ASC-PO-PACK-RATIO-N        TO RC806-PO-RATIO            33190099
332000                                        (PV-VALID-IDX).           33200099
332100                                                                  33210099
332200     IF PV-TEMP-DTL-CK-ITM-QTY  > 0                               33220099
332300         MOVE PV-TEMP-DTL-CK-ITM-QTY  TO RC806-RCVG-QTY           33230099
332400                                        (PV-VALID-IDX)            33240099
332500     ELSE                                                         33250099
332600         MOVE PV-TEMP-PKSL-ITM-QTY    TO RC806-RCVG-QTY           33260099
332700                                        (PV-VALID-IDX)            33270099
332800     END-IF.                                                      33280099
332900                                                                  33290099
333000     ADD  +1                          TO RC806-NBR-OF-LINES       33300099
333100                                         PV-VALID-IDX.            33310099
333200                                                                  33320099
333300                                                                  33330099
333400                                                                  33340099
333500                                                                  33350099
333600*----------------------------------------------------------------*33360099
333700*  CALL THE PACK VALIDATION MODULE TO VALIDATE THE RATIO THAT    *33370099
333800*  WAS ENTERED, DETERMINE BEST CASE, ODD UNITS, AND % VARIANCE.  *33380099
333900*----------------------------------------------------------------*33390099
334000 9500-CALL-VALIDATION-MODULE.                                     33400099
334100                                                                  33410099
334200     IF ASC-PKNG-CDE  = 'I'                                       33420099
334300        MOVE RECITM-CASE-PACK-QTY   TO RC806-INNER-PACK-QTY       33430099
334400     ELSE                                                         33440099
334500        IF ASC-PKNG-CDE = 'M'                                     33450099
334600           IF RECITM-CASE-PACK-QTY > 1                            33460099
334700              MOVE RECITM-CASE-PACK-QTY TO RC806-INNER-PACK-QTY   33470099
334800           END-IF                                                 33480099
334900        END-IF                                                    33490099
335000     END-IF.                                                      33500099
335100     MOVE '3'                       TO RC806-FUNCTION.            33510099
335200     PERFORM 9510-LINK-TO-VALIDATION-MODULE.                      33520099
335300                                                                  33530099
335400                                                                  33540099
335500     MOVE RC806-ODD-UNITS (PV-VALID-IDX)                          33550099
335600                                  TO RECITM-PREPK-ODD-UNT-QTY     33560099
335700                                     ASC-ODD-PACK-UNITS.          33570099
335800                                                                  33580099
335900                                                                  33590099
336000                                                                  33600099
336100*----------------------------------------------------------------*33610099
336200*  LINK TO THE PACK VALIDATION MODULE AND CHECK THE RETURN CODES *33620099
336300*----------------------------------------------------------------*33630099
336400 9510-LINK-TO-VALIDATION-MODULE.                                  33640099
336500                                                                  33650099
336600     EXEC CICS LINK                                               33660099
336700         PROGRAM  ('RCKCS806')                                    33670099
336800         COMMAREA (RC806-PRODUCT-PACK-VALIDATION)                 33680099
336900         RESP     (PV-CICS-RESPONSE)                              33690099
337000     END-EXEC.                                                    33700099
337100                                                                  33710099
337200*  CHECK CICS RETURN CODE                                         33720099
337300     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        33730099
337400         CONTINUE                                                 33740099
337500     ELSE                                                         33750099
337600         SET DP013-CICS-ABEND                                     33760099
337700             DP013-NO-ROLLBACK   TO TRUE                          33770099
337800         MOVE '4422-LINK-TO-VALIDATION-MODULE'                    33780099
337900                                 TO DP013-PARAGRAPH               33790099
338000         MOVE 'ATTEMPTING TO LINK TO PROGRAM RCKCS806'            33800099
338100                                 TO DP013-MESSAGE-TEXT (1)        33810099
338200         PERFORM DP013-0000-PROCESS-ABEND                         33820099
338300     END-IF.                                                      33830099
338400                                                                  33840099
338500*  CHECK RC806-ERROR-FLAG                                         33850099
338600     EVALUATE TRUE                                                33860099
338700     WHEN RC806-NO-ERRORS                                         33870099
338800         CONTINUE                                                 33880099
338900     WHEN OTHER                                                   33890099
339000         EVALUATE TRUE                                            33900099
339100         WHEN RC806-INV-LINE-DATA                                 33910099
339200         WHEN RC806-INV-FUNCTION-CD                               33920099
339300         WHEN RC806-INV-NBR-OF-LINES                              33930099
339400                                                                  33940099
339500              MOVE 'Y'             TO DP020-MSG-SEVERITY-IND      33950099
339600              MOVE +551            TO DP020-MSG-NUMBER            33960099
339700                                                                  33970099
339800              EXEC CICS                                           33980099
339900                   SYNCPOINT ROLLBACK                             33990099
340000              END-EXEC                                            34000099
340100         END-EVALUATE                                             34010099
340200     END-EVALUATE.                                                34020099
340300                                                                  34030099
340400/                                                                 34040099
340500*----------------------------------------------------------------*34050099
340600*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *34060099
340700*    AND THE ERROR SWITCHES.                                     *34070099
340800*----------------------------------------------------------------*34080099
340900 9900-SOFT-ABORT.                                                 34090099
341000     SET PS-ERROR         TO TRUE.                                34100099
341100     SET DP020-MSG-FATAL  TO TRUE.                                34110099
341200     MOVE PC-TSYMSG-00551 TO DP020-MSG-NUMBER.                    34120099
341300     SET  DP020-NEXT-ACT-APPL-ERROR TO TRUE.                      34130099
341400     MOVE 'PROGRAM EXIT CALL'    TO DP013-MESSAGE-TEXT (1).       34140099
341500     PERFORM 0001-CALL-CICS-ARCH-API.                             34150099
341600                                                                  34160099
341700                                                                  34170099
341800                                                                  34180099
341900*---------------------------------------------------------------- 34190099
342000*   ABEND PROCESSOR MODULE                                      * 34200099
342100*---------------------------------------------------------------- 34210099
342200                                                                  34220099
342300     COPY DPPD013.                                                34230099
