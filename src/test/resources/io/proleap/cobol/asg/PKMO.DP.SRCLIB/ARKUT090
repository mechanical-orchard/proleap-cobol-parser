000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             ARKUT090.                                00050000
000600 AUTHOR.                 LIHUA LIANG.                             00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN.           12-26-2005.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  ***  THIS PROGRAM IS COPIED FROM ARKUP016.                    *00120000
001300*  IT HAS BEEN MODIFIED TO ACCOMODATE EID FROM AN EXPENSE TO A   *00121000
001400*  MARKDOWN.                                                     *00140000
001500*                                                                *00150000
001600*       THIS PROGRAM WILL SEQUENTIALLY PROCESS EDITED A/R        *00160000
001700*  TRANSACTIONS, AND REFORMAT THEM INTO THE FORMAT REQUIRED BY   *00170000
001800*  SELECT.  TWO FILES ARE CREATED TO BE SENT TO THE SELECT       *00180000
001900*  SYSTEM:  A SALES CHECK DETAIL FILE, AND A TRANSACTION POSTING *00190000
002000*  FILE.                                                         *00200000
002100******************************************************************00210000
002101*  03/22/2011 ELENA MOZNAIM - ADDED CODE TO PROCESS 'LATE VOID'   00210100
002102*             TRANS. CHAGES ARE MARKED BY EVM001                  00210200
002103******************************************************************00210300
002104*  10/18/2012 TY HOPP - REMOVED 'IF' STATEMENT TO ALLOW PASSING   00210400
002105*             OF A RETURN PRICE SALES ADJUSTMENT 8165.            00210500
002106*             CHANGE MARKED TDH001.                               00210600
002107******************************************************************00210700
002108*  11/15/2012 COGNIZANT                                           00210800
002109*             REPLACED AR001-TRANSACTION-DATE WITH AR001-TRN-DTE  00210900
002110*             IN 2110-CREATE-HEADER AND 2300-PROCESS-POSTING-ONLY 00211000
002111*             WHICH IS NEWLY ADDED FIELD IN ARRD001 COPY BOOK.    00211100
002112******************************************************************00211200
002113*  01/31/2013 TY HOPP                                             00211300
002114*             INCREASE CD-CLASS-IDX AND PC-MAX-DEPT-CLASSES TO    00211400
002115*             40000.  CHANGE MARKED TDH002.                       00211500
002117******************************************************************00211600
      * 06/20/2013 JOE GARDETTO                                         00211700
      *    -ADDED LOGIC TO USE THE NEWLY ADDED EMPLOYEE DISCOUNT        00211800
      *     SOURCE CODE ON THE INPUT AR FILE TO BYPASS RECALCULATING    00211900
      *     TAXES WHEN THE DISCOUT SOURCE IS P FOR POS.                 00212000
      *     (JPGFX1)                                                    00212100
      *    -ADDED LOGIC TO INCLUDE ORDER NUMBER IN THE BREAK LOGIC      00212200
      *     FOR PROCESSING A NEW TRANSACTION.                           00212300
      *     (JPGFX3)                                                    00212400
      ******************************************************************00212500
      * 10/02/2013 JOE GARDETTO                                         00212600
      *    -ADDED LOGIC TO PREVENT ZERO TAX ITEMS FROM BEING ADDED TO   00212700
      *     THE TAX AUDIT FILE.  THIS WAS CAUSING TXKUT009 TO ABEND     00212800
      *     IN JOB TXK030. (JPGFX4)                                     00212900
      ******************************************************************00213000
      * 11/11/2013 JOE GARDETTO                                         00214000
      *    -ADDED LOGIC TO PREVENT TRANSACTIONS WHERE ASSOCIATE DISCOUNT00214100
      *     IS TAKEN AT POS FROM BEING INCLUDED ON THE TAX AUDIT FILE.  00214200
      *     (JPGFX5) CHG0070860                                         00214300
      ******************************************************************00214400
P9696 * 02/17/2014 COGNIZANT                                            00214500
P9696 *    -ADDED TWO NEW OUTPUT FILES TO THE PROGRAM. AJB SALES CHECK  00214600
P9696 *     DETAIL FILE ARRD025, SIMILAR TO ARRD020 WITH ADDITIONAL     00214700
P9696 *     FIELDS AND AJB POSTING TRANSACTION FILE ARRD026, SIMILAR TO 00214800
P9696 *     ARRD021 WITH ADDITIONAL FIELDS.                             00214900
P9696 *    -AJB SALES CHECK DETAIL FILE ARRD025 WILL HAVE NON PAYMENT   00215000
P9696 *     TRANSACTIONS AND AJB POSTING FILE ARRD026 WILL HAVE PAYMENT 00215100
P9696 *     TRANSACTION RECORDS AND EMPLOYEE DISCOUNT TRANSACTION       00215200
P9696 *     RECORDS.                                                    00215300
P9696 *    -ADDED LOGIC TO POPULATE TWO NEW OUTPUT FILES.               00215400
P9696 *    -INCREASED LENGTH OF INPUT FILE TO 311.                      00215500
      ******************************************************************00215600
      * 10/23/2014 JOE GARDETTO                                         00215700
      *     CHG0086844                                                  00215800
      *    -CHANGE LOGIC THAT CHECKS EMPL DISCOUNT SOURCE TO CHECK EACH 00215900
      *     LINE ITEM.                                                  00216000
      *    -CHANGE LOGIC FOR STATE ROUNDING METHOD TO USE STATE CODE ON 00216100
      *     INPUT FILE WHEN AVAILABLE.                                  00216200
      *    -CHANGE LOGIC TO INITIALIZE PT-TAX-RATE-TABLE AND            00216300
      *     PV-TRAN-TAX-RT-CTR FOR EACH LINE ITEM ON ECOM ORDERS TO     00216400
      *     PREVENT ROUNDING DIFFERENCE WITH ARKUT093.                  00216500
      *    -ADDED LOGIC TO INITIALIZE NUMERIC FIELDS ON THE CHECK DETAIL00216600
      *     RECORD                                                      00216700
      *    -REMOVED CODE FOR TAX AUDIT FILE. NOT USED IN THIS PROGRAM.  00216800
P9696 ******************************************************************00216900
P1043 * 06/17/2015 ACCENTURE                                            00217000
P1043 *     CHG0118696                                                  00217100
P1043 *    -ADDED A SIX DIGIT BIN NUMBER BEFORE ACCOUNT NUMBER TO       00217200
P1043 *     HANDLE BOTH 12 DIGIT AND 18 DIGIT ACCOUNT NUMBER            00217300
P1043 ******************************************************************00217400
CFEES * 01/09/2017 BARB SCHULTZ                                         00217500
CFEES *     CHG0160001                                                  00217600
CFEES *    -ADDED PARAGRAPH 2295-PROCESS-FEE-ITEM AND INCREASED INPUT   00217700
CFEES *     FILE TO 385                                                 00217800
CFEES ******************************************************************00217900
SHIP  * 03/26/2019 BARB SCHULTZ                                         00218000
SHIP  *     CHG0220426                                                  00218100
SHIP  *    -MOVED AR001-KC-MULT-CLR-IND TO AR025-H-KC-MULT-CLR-IND      00218200
SHIP  *     FOR SETTLE BY SHIP PROJECT.                                 00218300
SHIP  ******************************************************************00218400
SHIP2 * 01/21/2020 BARB SCHULTZ                                         00218500
SHIP2 *     CHG0233046                                                  00218600
SHIP2 *    -CHANGED AR001-KC-MULT-CLR-IND TO MULT-CLR-SEQ-NBR.          00218700
SHIP2 *    -MOVED PAR-SHP-IND IN ARRD020 AND ARRD025.                   00218800
SHIP2 *    -CHANGED THE LENGTH OF THE SALES CHECK DETAIL FILE.          00218900
SHIP2 ******************************************************************00219000
SHIP3 * 07/21/2020 BARB SCHULTZ                                         00219100
SHIP3 *     CHG0246692                                                  00219200
SHIP3 *    -ADDED CODE TO 9000-EOJ-ROUTINE TO WRITE OUT THE LAST        00219300
SHIP3 *     TRANSACTION TO THE AJB CHCK DTL FILE.                       00219400
071221******************************************************************00219502
071221*  07/01/2021 DAN PAYNTER                                        *00219602
071221*  CHG0257249                                                    *00219702
071221*  GENERATION OF AUTO-ADJUSTMENT FOR IMBALANCE BETWEEN SUMMARY OF*00219802
071221*  TRANSACTION DETAILS AND THE REPORTED TENDER AMOUNT.           *00219902
071221*  ARK01020 OOB TRANSACTIONS WILL BE AUTO ADJUSTED TO MATCH THE  *00220002
071221*  TENDER AMOUNT FIELD WITH A 'RCPT TO STMT SYS ADJ' ENTRY.      *00220102
071221******************************************************************00220202
SHIP3 ******************************************************************00220300
002118 ENVIRONMENT DIVISION.                                            00220400
002119******************************************************************00220500
002120                                                                  00220600
002121 CONFIGURATION SECTION.                                           00220700
002122                                                                  00220800
002123 SOURCE-COMPUTER.        IBM-3090.                                00220900
002124 OBJECT-COMPUTER.        IBM-3090.                                00221000
002125                                                                  00221100
002130 INPUT-OUTPUT SECTION.                                            00221200
002140                                                                  00221300
002150 FILE-CONTROL.                                                    00221400
002160                                                                  00221500
002170     SELECT AR-TRANSACTION-FILE                                   00221600
002180         ASSIGN TO INP01.                                         00221700
002190                                                                  00221800
002200     SELECT SALES-CHECK-DETAIL-FILE                               00221900
002300         ASSIGN TO OUT01.                                         00222000
002400                                                                  00222100
002500     SELECT POSTING-TRANS-FILE-1                                  00222200
002600         ASSIGN TO OUT02.                                         00222300
002700                                                                  00222400
002800     SELECT POSTING-TRANS-FILE-2                                  00223000
002900         ASSIGN TO OUT03.                                         00224000
003000                                                                  00225000
003100     SELECT POSTING-TRANS-FILE-3                                  00226000
003200         ASSIGN TO OUT04.                                         00227000
003300                                                                  00228000
003400     SELECT POSTING-TRANS-FILE-4                                  00229000
003500         ASSIGN TO OUT05.                                         00230000
003600                                                                  00240000
003700     SELECT POSTING-TRANS-FILE-5                                  00250000
003800         ASSIGN TO OUT06.                                         00260000
003900                                                                  00270000
004000     SELECT POSTING-TRANS-FILE-6                                  00280000
004100         ASSIGN TO OUT07.                                         00290000
004200                                                                  00300000
004300     SELECT POSTING-TRANS-FILE-7                                  00310000
004400         ASSIGN TO OUT08.                                         00320000
004500                                                                  00330000
004600     SELECT POSTING-TRANS-FILE-8                                  00340000
004700         ASSIGN TO OUT09.                                         00350000
004800                                                                  00360000
P9696      SELECT AJB-SALES-CHCK-DTL-FILE                               00370000
P9696          ASSIGN TO OUT11.                                         00380000
P9696                                                                   00390000
P9696      SELECT AJB-POSTING-TRANS-FILE                                00400000
P9696          ASSIGN TO OUT12.                                         00410000
005100                                                                  00420000
005200******************************************************************00430000
005300 DATA DIVISION.                                                   00440000
005400******************************************************************00450000
005500                                                                  00460000
005600 FILE SECTION.                                                    00470000
005700                                                                  00480000
005800 FD  AR-TRANSACTION-FILE                                          00490000
005900     RECORDING MODE IS F                                          00500000
006000     LABEL RECORDS ARE STANDARD                                   00510000
006100     BLOCK CONTAINS 0 RECORDS                                     00520000
CFEES      RECORD CONTAINS 385 CHARACTERS                               00530000
006300     DATA RECORD IS AT-AR-TRANSACTION-RECORD.                     00540000
006400                                                                  00550000
CFEES  01  AT-AR-TRANSACTION-RECORD    PIC X(385).                      00560000
006600                                                                  00570000
006700 FD  SALES-CHECK-DETAIL-FILE                                      00580000
006800     RECORDING MODE IS F                                          00590000
006900     LABEL RECORDS ARE STANDARD                                   00600000
007000     BLOCK CONTAINS 0 RECORDS                                     00610000
007100     RECORD CONTAINS 111 CHARACTERS                               00620000
007200     DATA RECORD IS SALES-CHECK-DETAIL-RECORD.                    00630000
007300                                                                  00640000
007400 01  SALES-CHECK-DETAIL-RECORD   PIC X(111).                      00650000
007500                                                                  00660000
007600 FD  POSTING-TRANS-FILE-1                                         00670000
007700     RECORDING MODE IS F                                          00680000
007800     LABEL RECORDS ARE STANDARD                                   00690000
007900     BLOCK CONTAINS 0 RECORDS                                     00700000
008000     RECORD CONTAINS 157 CHARACTERS.                              00710000
008100                                                                  00720000
008200 01  POSTING-TRANS-RECORD-1      PIC X(157).                      00730000
008300                                                                  00740000
008400 FD  POSTING-TRANS-FILE-2                                         00750000
008500     RECORDING MODE IS F                                          00760000
008600     LABEL RECORDS ARE STANDARD                                   00770000
008700     BLOCK CONTAINS 0 RECORDS                                     00780000
008800     RECORD CONTAINS 157 CHARACTERS.                              00790000
008900                                                                  00800000
009000 01  POSTING-TRANS-RECORD-2      PIC X(157).                      00810000
009100                                                                  00820000
009200 FD  POSTING-TRANS-FILE-3                                         00830000
009300     RECORDING MODE IS F                                          00840000
009400     LABEL RECORDS ARE STANDARD                                   00850000
009500     BLOCK CONTAINS 0 RECORDS                                     00860000
009600     RECORD CONTAINS 157 CHARACTERS.                              00870000
009700                                                                  00880000
009800 01  POSTING-TRANS-RECORD-3      PIC X(157).                      00890000
009900                                                                  00900000
010000 FD  POSTING-TRANS-FILE-4                                         00910000
010100     RECORDING MODE IS F                                          00920000
010200     LABEL RECORDS ARE STANDARD                                   00930000
010300     BLOCK CONTAINS 0 RECORDS                                     00940000
010400     RECORD CONTAINS 157 CHARACTERS.                              00950000
010500                                                                  00960000
010600 01  POSTING-TRANS-RECORD-4      PIC X(157).                      00970000
010700                                                                  00980000
010800 FD  POSTING-TRANS-FILE-5                                         00990000
010900     RECORDING MODE IS F                                          01000000
011000     LABEL RECORDS ARE STANDARD                                   01010000
011100     BLOCK CONTAINS 0 RECORDS                                     01020000
011200     RECORD CONTAINS 157 CHARACTERS.                              01030000
011300                                                                  01040000
011400 01  POSTING-TRANS-RECORD-5      PIC X(157).                      01050000
011500                                                                  01060000
011600 FD  POSTING-TRANS-FILE-6                                         01070000
011700     RECORDING MODE IS F                                          01080000
011800     LABEL RECORDS ARE STANDARD                                   01090000
011900     BLOCK CONTAINS 0 RECORDS                                     01100000
012000     RECORD CONTAINS 157 CHARACTERS.                              01110000
012100                                                                  01120000
012200 01  POSTING-TRANS-RECORD-6      PIC X(157).                      01130000
012300                                                                  01140000
012400 FD  POSTING-TRANS-FILE-7                                         01150000
012500     RECORDING MODE IS F                                          01160000
012600     LABEL RECORDS ARE STANDARD                                   01170000
012700     BLOCK CONTAINS 0 RECORDS                                     01180000
012800     RECORD CONTAINS 157 CHARACTERS.                              01190000
012900                                                                  01200000
013000 01  POSTING-TRANS-RECORD-7      PIC X(157).                      01210000
013100                                                                  01220000
013200 FD  POSTING-TRANS-FILE-8                                         01230000
013300     RECORDING MODE IS F                                          01240000
013400     LABEL RECORDS ARE STANDARD                                   01250000
013500     BLOCK CONTAINS 0 RECORDS                                     01260000
013600     RECORD CONTAINS 157 CHARACTERS.                              01270000
013700                                                                  01280000
013800 01  POSTING-TRANS-RECORD-8      PIC X(157).                      01290000
013900                                                                  01300000
P9696  FD  AJB-SALES-CHCK-DTL-FILE                                      01310000
P9696      RECORDING MODE IS F                                          01320000
P9696      LABEL RECORDS ARE STANDARD                                   01330000
P9696      BLOCK CONTAINS 0 RECORDS                                     01340000
SHIP2      RECORD CONTAINS 267 CHARACTERS.                              01350000
P9696                                                                   01360000
SHIP2  01  AJB-SALES-CHCK-DTL-RECORD   PIC X(267).                      01370000
P9696                                                                   01380000
P9696  FD  AJB-POSTING-TRANS-FILE                                       01390000
P9696      RECORDING MODE IS F                                          01400000
P9696      LABEL RECORDS ARE STANDARD                                   01410000
P9696      BLOCK CONTAINS 0 RECORDS                                     01420000
P9696      RECORD CONTAINS 188 CHARACTERS.                              01430000
P9696                                                                   01440000
P9696  01  AJB-POSTING-TRANS-RECORD    PIC X(188).                      01450000
014800                                                                  01460000
014900 WORKING-STORAGE SECTION.                                         01470000
015000                                                                  01471000
015100*                                                                 01472000
015200*  ACCOUNTS RECEIVABLE TRANSACTION FILE RECORD LAYOUT             01473000
015300*                                                                 01474000
015400                                                                  01475000
015500     COPY ARRD001.                                                01476000
015600                                                                  01477000
015700*                                                                 01478000
015800*  SALES CHECK DETAIL FILE                                        01479000
015900*                                                                 01480000
016000                                                                  01490000
016100     COPY ARRD020.                                                01500000
016200                                                                  01510000
016300*                                                                 01520000
016400*  POSTING TRANSACTION FILE                                       01530000
016500*                                                                 01540000
016600                                                                  01550000
016700     COPY ARRD021.                                                01560000
016800                                                                  01570000
P9696                                                                   01580000
P9696 *                                                                 01590000
P9696 *  AJB SALES CHECK DETAIL FILE LAYOUT FOR AJB SETTLEMENT PROCESS  01600000
P9696 *                                                                 01610000
P9696                                                                   01620000
P9696      COPY ARRD025.                                                01630000
P9696                                                                   01640000
P9696 *                                                                 01650000
P9696 *  AJB POSTING TRANSACTION FILE LAYOUT FOR AJB SETTLEMENT PROCESS 01660000
P9696 *                                                                 01670000
P9696                                                                   01680000
P9696      COPY ARRD026.                                                01690000
017400                                                                  01700000
017500*                                                                 01710000
017600*  AR CONSTANTS                                                   01720000
017700*                                                                 01730000
017800                                                                  01731000
017900     COPY ARWS004.                                                01732000
018000                                                                  01733000
018100*                                                                 01734000
018200*  PARAMETER LIST FOR THE CALENDAR SUBROUTINE (DPKUT500)          01735000
018300*                                                                 01736000
018400                                                                  01737000
018500     COPY DPWS500.                                                01738000
018600                                                                  01739000
018700*                                                                 01740000
018800*  VARIABLES TO FORMAT SQLCA                                      01750000
018900*                                                                 01760000
019000                                                                  01770000
019100     COPY DPWS004.                                                01780000
019200                                                                  01790000
019300 01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          01800000
019400                                              COMP SYNC.          01810000
019500     88  AC-INVLD-DATA-ON-DATASET-ERROR       VALUE +4008.        01820000
019600     88  AC-DB2-ERROR                         VALUE +4013.        01830000
019700                                                                  01840000
019800 01  PS-PROGRAM-SWITCHES.                                         01850000
019900     05  PS-END-OF-TRANS-FILE-IND                                 01860000
020000                                 PIC X(1)     VALUE 'N'.          01870000
020100         88  PS-END-OF-TRANS-FILE             VALUE 'Y'.          01880000
020200     05  PS-FIRST-RECORD-IND     PIC X(1)     VALUE 'Y'.          01890000
020300         88  PS-FIRST-RECORD                  VALUE 'Y'.          01900000
020400         88  PS-NOT-FIRST-RECORD              VALUE 'N'.          01910000
020500     05  PS-END-OF-CLASS-CURSOR-IND                               01920000
020600                                 PIC X(1)     VALUE 'N'.          01930000
020700         88  PS-END-OF-CLASS-CURSOR           VALUE 'Y'.          01940000
020800     05  PS-END-OF-STORE-CURSOR-IND                               01950000
020900                                 PIC X(1)     VALUE 'N'.          01960000
021000         88  PS-END-OF-STORE-CURSOR           VALUE 'Y'.          01970000
021100     05  PS-END-OF-ECOMM-CURSOR-IND                               01980000
021200                                 PIC X(1)     VALUE 'N'.          01990000
021300         88  PS-END-OF-ECOMM-CURSOR           VALUE 'Y'.          02000000
021400     05  PS-RATE-MATCH-SW        PIC X(01)    VALUE 'N'.          02010000
021500         88  PS-RATE-MATCH-FOUND              VALUE 'Y'.          02020000
021600         88  PS-RATE-NOT-FOUND                VALUE 'N'.          02030000
021700     05  PS-EMPLOYEE-DISC-CALC-SW    PIC X(1) VALUE SPACE.        02040000
021800         88  PS-EMPLOYEE-DISC-NOT-CALC        VALUE 'N'.          02050000
021900         88  PS-EMPLOYEE-DISC-CALC            VALUE 'Y'.          02060000
022000     05  PS-ASSOC-CASH-SW            PIC X(1) VALUE SPACE.        02070000
022100         88  PS-ASSOC-CASH                    VALUE 'Y'.          02080000
022200         88  PS-NOT-ASSOC-CASH                VALUE 'N'.          02090000
022300*  THIS SWITCH WILL BE USED TO DETERMINE IF THE TRANSACTION       02100000
022400*  HAS ALREADY BEEN SENT TO THE TAX FILE - THIS WAS NEEDED        02110000
022500*  AFTER MULTI-TENDER RETURNS WAS IMPLEMENTED                     02120000
022600     05  PS-TRANS-TO-TAX-SW          PIC X(1) VALUE SPACE.        02130000
022700         88  PS-TRANS-TO-TAX                  VALUE 'Y'.          02140000
022800         88  PS-NO-TRANS-TO-TAX               VALUE 'N'.          02150000
SHIP2      05  PS-OMNI-SW                  PIC X(1) VALUE 'N'.          02170000
SHIP2          88  PS-OMNI                          VALUE 'Y'.          02180000
SHIP2          88  PS-NO-OMNI                       VALUE 'N'.          02190000
SHIP2      05  PS-FIRST-TIME-SW            PIC X(1) VALUE 'Y'.          02191000
SHIP2          88  PS-FIRST-TIME                    VALUE 'Y'.          02192000
SHIP2          88  PS-NOT-FIRST-TIME                VALUE 'N'.          02193000
SHIP2      05  PS-FIRST-S2H-SHIPMENT       PIC X(1) VALUE 'N'.          02193100
SHIP2          88  PS-FIRST-TIME-SHIP               VALUE 'Y'.          02193200
SHIP2          88  PS-NOT-FIRST-TIME-SHIP           VALUE 'N'.          02193300
022900                                                                  02231000
023000 01  PC-PROGRAM-CONSTANTS.                                        02232000
023100     05  PC-NBR-OF-POST-FILES    PIC 9(2)     VALUE 8.            02233000
023200     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'ARKUT090'.   02234000
023210*TDH002                                                           02235000
023300*    05  PC-MAX-DEPT-CLASSES     PIC 9(5)     VALUE 20000.        02236000
023310     05  PC-MAX-DEPT-CLASSES     PIC 9(5)     VALUE 40000.        02237000
023400     05  PC-MAX-TRAN-TAX-RATES   PIC 9(5)     VALUE 20.           02238000
023500     05  PC-SALES-CHECK-DETAIL-LENGTHS.                           02239000
023600         10  PC-SCD-HEADER-LENGTH                                 02240000
023700                                 PIC 9(4)     VALUE 111.          02250000
P9696          10  PC-SCD-HDR-LEN-AJB-FILE                              02260000
P9696                                  PIC 9(4)     VALUE 267.          02270000
023800         10  PC-SCD-MDSE-LENGTH  PIC 9(4)     VALUE  97.          02280000
023900         10  PC-SCD-OTHER-LENGTH PIC 9(4)     VALUE  44.          02290000
024000         10  PC-SCD-TENDER-LENGTH                                 02300000
024100                                 PIC 9(4)     VALUE  72.          02310000
JPGFX7     05  PC-EFC-LOC-873          PIC 9(4)     VALUE 873.          02320000
024200                                                                  02330000
024300 01  PA-PROGRAM-ACCUMULATORS.                                     02340000
024400     05  PA-INPUT-RCDS-READ      PIC S9(11)   VALUE 0 COMP-3.     02350000
024500     05  PA-SALES-CHK-DETAIL     PIC S9(11)   VALUE 0 COMP-3.     02360000
024600     05  PA-POSTING-FILE-1       PIC S9(11)   VALUE 0 COMP-3.     02370000
024700     05  PA-POSTING-FILE-2       PIC S9(11)   VALUE 0 COMP-3.     02380000
024800     05  PA-POSTING-FILE-3       PIC S9(11)   VALUE 0 COMP-3.     02390000
024900     05  PA-POSTING-FILE-4       PIC S9(11)   VALUE 0 COMP-3.     02400000
025000     05  PA-POSTING-FILE-5       PIC S9(11)   VALUE 0 COMP-3.     02410000
025100     05  PA-POSTING-FILE-6       PIC S9(11)   VALUE 0 COMP-3.     02420000
025200     05  PA-POSTING-FILE-7       PIC S9(11)   VALUE 0 COMP-3.     02430000
025300     05  PA-POSTING-FILE-8       PIC S9(11)   VALUE 0 COMP-3.     02440000
P9696      05  PA-AJB-SALES-CHK-CNT    PIC S9(11)   VALUE 0 COMP-3.     02450000
P9696      05  PA-AJB-POSTNG-TRN-CNT   PIC S9(11)   VALUE 0 COMP-3.     02460000
025500                                                                  02470000
025600 01  PV-PROGRAM-VARIABLES.                                        02480000
025700     05  PV-LAST-DB2-ACTION      PIC X(45)    VALUE SPACES.       02490000
025800         88  PV-OPEN-CLASS-CURSOR             VALUE               02500000
025900             'OPEN THE CLASS CURSOR - XST_SUB_CL           '.     02510000
026000         88  PV-FETCH-CLASS-ROW               VALUE               02520000
026100             'FETCH ROW FROM CLASS CURSOR - XST_SUB_CL     '.     02530000
026200         88  PV-CLOSE-CLASS-CURSOR            VALUE               02540000
026300             'CLOSE THE CLASS CURSOR - XST_SUB_CL          '.     02550000
026400         88  PV-STORE-COUNT-ERR               VALUE               02560000
026500             'SELECT COUNT OF STORES - XST_LOC             '.     02570000
026600         88  PV-OPEN-STORE-CURSOR             VALUE               02580000
026700             'OPEN THE STORE CURSOR - XST_LOC              '.     02590000
026800         88  PV-FETCH-STORE-ROW               VALUE               02600000
026900             'FETCH ROW FROM STORE CURSOR - XST_LOC        '.     02610000
027000         88  PV-CLOSE-STORE-CURSOR            VALUE               02620000
027100             'CLOSE THE STORE CURSOR - XST_LOC             '.     02630000
027200         88  PV-SELECT-ROUND-ROW              VALUE               02640000
027300             'SELECT ROW FROM XST_LOC & TSTATE             '.     02650000
JPGFX7         88  PV-SELECT-ROUND-ROW-ST           VALUE               02660000
JPGFX7             'SELECT ROW FROM TSTATE                       '.     02670000
027400         88  PV-OPEN-ECOMM-CURSOR             VALUE               02680000
027500             'OPEN THE ECOMM CURSOR - XST_LOC              '.     02690000
027600         88  PV-FETCH-ECOMM-ROW               VALUE               02700000
027700             'FETCH ROW FROM ECOMM CURSOR - XST_LOC        '.     02710000
027800         88  PV-CLOSE-ECOMM-CURSOR            VALUE               02720000
027900             'CLOSE THE ECOMM CURSOR - XST_LOC             '.     02730000
JPGFX4         88  PV-TEPITM-COUNT-ERR              VALUE               02731000
JPGFX4             'SELECT COUNT OF ZERO TAX - TEPITM            '.     02732000
028000     05  PV-SAVE-AREA.                                            02733000
028100         10  PV-SAVE-TRANS-DATE  PIC 9(6)     VALUE ZERO.         02734000
028200         10  PV-SAVE-TRANS-TIME  PIC 9(4)     VALUE ZERO.         02735000
028300         10  PV-SAVE-TERM-NUM    PIC X(4)     VALUE SPACES.       02736000
028400         10  PV-SAVE-TRANS-NUM   PIC X(4)     VALUE SPACES.       02737000
028500         10  PV-SAVE-TNDR-SEQ-NBR PIC S9(04)  VALUE ZERO          02738000
028600                                                    COMP.         02739000
028700         10  PV-SAVE-TRANS-SOURCE                                 02740000
028800                                 PIC X(1)     VALUE SPACES.       02750000
028900         10  PV-SAVE-KIND-OF-TRANS                                02760000
029000                                 PIC X(1)     VALUE SPACES.       02770000
029100            88  PV-SAVE-TRANS-HAS-MERCHANDISE VALUE 'M'.          02780000
029200            88  PV-SAVE-TRANS-POSTING-ONLY    VALUE 'P'.          02790000
029300         10  PV-SAVE-EMPLOYEE-IND                                 02800000
029400                                 PIC X(1)     VALUE SPACES.       02810000
029500             88  PV-SAVE-EMPLOYEE             VALUE 'E'.          02820000
029600             88  PV-SAVE-NON-EMPLOYEE         VALUE 'N'.          02830000
029700         10  PV-SAVE-STORE-NMBR  PIC 9(4)     VALUE ZERO.         02840000
JPGFX7         10  PV-XST00001-LOC-NBR PIC 9(4)     VALUE ZERO.         02850000
029800         10  PV-SAVE-TX-RND-MTHD PIC X(1)     VALUE SPACES.       02860000
029900         10  PV-SAVE-TAX-RATE-PCT                                 02870000
030000                                 PIC S9V9(5)  COMP-3              02880000
030100                                              VALUE ZERO.         02890000
030200         10  PV-SAVE-TOTAL-TAX   PIC S9(7)V99 COMP-3              02900000
030300                                              VALUE ZERO.         02910000
JPGFX3         10  PV-SAVE-ORD-NBR                                      02920000
JPGFX3                                 PIC X(40)    VALUE SPACES.       02930000
030400     05  PV-STORE-NUMBER         PIC 9(4)     VALUE ZERO.         02950000
030500     05  PV-TERM-NUMBER          PIC 9(4)     VALUE ZERO.         02960000
030600     05  PV-TRANS-NUMBER         PIC 9(4)     VALUE ZERO.         02970000
030700     05  PV-SEQ-NBR              PIC 9(4)     VALUE ZERO.         02980000
030800     05  PV-TRANS-DATE           PIC 9(8)     VALUE ZERO.         02990000
030900     05  FILLER REDEFINES PV-TRANS-DATE.                          03000000
031000         10  PV-TRANS-CC         PIC 9(2).                        03010000
031100         10  PV-TRANS-YY         PIC 9(2).                        03020000
031200         10  PV-TRANS-MM         PIC 9(2).                        03030000
031300         10  PV-TRANS-DD         PIC 9(2).                        03040000
031400     05  PV-LINE-NUMBER          PIC 9(3)     VALUE ZERO.         03050000
031500     05  PV-DESCRIPTION          PIC X(17)    VALUE SPACES.       03060000
031600     05  PV-POSTING-TOTAL-AMT    PIC S9(7)V99 COMP-3              03070000
031700                                              VALUE ZERO.         03080000
031800     05  PV-NON-DISC-TOTAL-AMT   PIC S9(7)V99 COMP-3              03090000
031900                                              VALUE ZERO.         03100000
032000     05  PV-TRAN-TAX-RT-CTR      PIC S9(4)    COMP                03110000
032100                                              VALUE ZERO.         03120000
032200     05  PV-DB2-POS-DATE         PIC X(10).                       03130000
032300                                                                  03140000
032400     05  PV-DB2-FORMAT-DATE.                                      03150000
032500         10  PV-DB2-POS-CC       PIC 9(2).                        03160000
032600         10  PV-DB2-POS-YY       PIC 9(2).                        03170000
032700         10  FILLER              PIC X(1)      VALUE '-'.         03180000
032800         10  PV-DB2-POS-MM       PIC 9(2).                        03190000
032900         10  FILLER              PIC X(1)      VALUE '-'.         03200000
033000         10  PV-DB2-POS-DD       PIC 9(2).                        03210000
033100     05  PV-STORE-COUNT          PIC S9(5)     COMP-3             03220000
033200                                               VALUE ZERO.        03230000
JPGFX4     05  PV-ZERO-TAX-ITEM-COUNT  PIC S9(5)     COMP-3             03240000
JPGFX4                                               VALUE ZERO.        03250000
033300     05  PV-STORES-PER-FILE      PIC S9(5)     COMP-3             03260000
033400                                               VALUE ZERO.        03270000
033500     05  PV-FILE-NUMBER          PIC 9(2)      VALUE ZERO.        03280000
033600     05  PV-REMAINDER            PIC 9(2)      VALUE ZERO.        03290000
033700     05  PV-STORE-COUNTER        PIC S9(5)     COMP-3             03300000
033800                                               VALUE ZERO.        03310000
033900     05  PV-DEPT-CLASS-CTR       PIC 9(5)     VALUE ZERO COMP-3.  03320000
SHIP2      05  PV-AJB                  PIC S9(3)    VALUE ZERO COMP-3.  03321000
SHIP2      05  PV-AJB-SUB              PIC S9(3)    VALUE ZERO COMP-3.  03322000
SHIP2      05  PV-TOT-SUB              PIC S9(3)    VALUE ZERO COMP-3.  03323000
034000     05  PV-TEMP-TAX-CHAR        PIC X(10)    VALUE SPACES.       03330000
034100     05  PV-TEMP-TAX-NUM         PIC 9(10)    VALUE ZERO.         03340000
034200     05  PV-LINE-ITEM-TAX        PIC S9(7)V99 VALUE ZERO COMP-3.  03350000
034300     05  PV-WORK-TAX-AMT         PIC S9(7)V99 VALUE ZERO COMP-3.  03360000
034400     05  PV-LI-NET-TAXABLE-AMT   PIC S9(7)V99 VALUE ZERO COMP-3.  03370000
034500     05  PV-LI-ORIG-N-TXBL-AMT   PIC S9(7)V99 VALUE ZERO COMP-3.  03380000
034900     05  PV-EMP-DISC-TAX-ADJ     PIC S9(9)V99 VALUE ZERO COMP-3.  03390000
035100     05  PV-TOT-ORIG-TAX-AMT     PIC S9(9)V99 VALUE ZERO COMP-3.  03400000
035200     05  PV-DISPLAY-TAXABLE-AMT  PIC ZZZ,ZZZ,ZZZ.99-.             03410000
035300     05  PV-DISPLAY-TAX-AMT      PIC ZZZ,ZZZ,ZZZ.99-.             03420000
P9696      05  PV-PARTN-NBR            PIC  9(04).                      03430000
P9696      05  PV-SALES-DATE.                                           03440000
P9696          10  PV-SALES-CC         PIC  X(02)   VALUE '20'.         03450000
P9696          10  PV-SALES-YY         PIC  X(02).                      03460000
P9696          10  FILLER              PIC  X(01)   VALUE '-'.          03470000
P9696          10  PV-SALES-MM         PIC  X(02).                      03480000
P9696          10  FILLER              PIC  X(01)   VALUE '-'.          03490000
P9696          10  PV-SALES-DD         PIC  X(02).                      03500000
P9696      05  PV-ORG-STR-NBR          PIC  9(04).                      03510000
P9696      05  PV-START-TIME           PIC  X(08).                      03520000
P9696      05  PV-SLS-CORR-SEQ-NBR     PIC S9(04).                      03530000
P9696      05  PV-ACCOUNT-NUMBER       PIC  X(12).                      03531000
P1043      05  PV-BIN-NUMBER           PIC  X(06).                      03532000
SHIP2 ** HOLD ORDER HEADER                                              03533600
SHIP2      05  PV-HOLD-AJB-HEADER-RECORD.                               03533700
SHIP2          10  PV-HOLD-H-RECORD-ID         PIC   X(01).             03533800
SHIP2          10  FILLER                      PIC   X(01).             03533900
SHIP2          10  PV-HOLD-H-LENGTH            PIC   9(04).             03534000
SHIP2          10  PV-HOLD-H-MERCHANT-ID       PIC   9(08).             03534100
SHIP2 *            (STORE NUMBER)                                       03534200
SHIP2          10  PV-HOLD-H-STORE-SUFFIX      PIC   9(04).             03534300
SHIP2              88  PV-HOLD-H-ORIG-TRANS           VALUE 1.          03534400
SHIP2              88  PV-HOLD-H-EMPLOYEE-DISC        VALUE 2.          03534500
SHIP2              88  PV-HOLD-H-ORIG-TRANS-REVERSAL  VALUE 3.          03534600
SHIP2              88  PV-HOLD-H-EMPLOYEE-DISC-REV    VALUE 4.          03534700
SHIP2          10  PV-HOLD-H-DEPT-ID           PIC   9(09).             03534800
SHIP2          10  PV-HOLD-H-POS-ID            PIC   9(09).             03534900
SHIP2 **           (TERMINAL ID)                                        03535000
SHIP2          10  PV-HOLD-H-ENTRY-DATE        PIC   9(09).             03535100
SHIP2          10  PV-HOLD-H-REF-SEQ           PIC   9(05).             03535200
SHIP2          10  PV-HOLD-H-REF-NO            PIC   9(04).             03535300
SHIP2 **           (TRANSACTION NUMBER)                                 03535400
SHIP2          10  PV-HOLD-H-SEQUENCE          PIC   9(04).             03535500
SHIP2          10  PV-HOLD-H-BIN-NUMBER            PIC   X(06).         03535600
SHIP2          10  PV-HOLD-H-ORIG-ACCOUNT-NO.                           03535700
SHIP2              15  PV-HOLD-H-ORIG-ACCOUNT-NO-1                      03535800
SHIP2                                          PIC   X(10).             03535900
SHIP2              15  PV-HOLD-H-ORIG-ACCOUNT-NO-2                      03536000
SHIP2                                          PIC   X(02).             03536100
SHIP2          10  PV-HOLD-H-OPERATOR-ID           PIC   9(18).         03536200
SHIP2          10  PV-HOLD-H-CARD-NO-RECEIVED      PIC   X(01).         03536300
SHIP2              88  PV-HOLD-H-RECEIVED-18-DIGIT-NO    VALUE 'T'.     03536400
SHIP2              88  PV-HOLD-H-RECEIVED-12-DIGIT-NO    VALUE 'Y'.     03536500
SHIP2              88  PV-HOLD-H-RECEIVED-10-DIGIT-NO    VALUE 'N'.     03536600
SHIP2          10  PV-HOLD-H-DATE                  PIC   9(08).         03536700
SHIP2          10  PV-HOLD-H-MATCHING-REVERSAL     PIC   X(01).         03536800
SHIP2          10  PV-HOLD-H-PROCESSED-DATE        PIC   9(09).         03536900
SHIP2          10  PV-HOLD-H-DETAILS-LENGTH        PIC   9(04).         03537000
SHIP2          10  PV-HOLD-H-PARTN-NBR             PIC   9(04).         03537100
SHIP2          10  PV-HOLD-H-SALES-DATE            PIC   X(10).         03537200
SHIP2          10  PV-HOLD-H-ORG-STR-NBR           PIC   9(04).         03537300
SHIP2          10  PV-HOLD-H-START-TIME            PIC   X(08).         03537400
SHIP2          10  PV-HOLD-H-SLS-CORR-SEQ-NBR      PIC  S9(04)          03537500
SHIP2                                          SIGN IS LEADING SEPARATE.03537600
SHIP2          10  PV-HOLD-H-TNDR-SEQ-NBR          PIC   9(04).         03537700
SHIP2          10  PV-HOLD-H-CARD-NO.                                   03537800
SHIP2              15  PV-HOLD-H-CARD-ACCOUNT.                          03537900
SHIP2                  20  PV-HOLD-H-CARD-ACCOUNT-1-3                   03538000
SHIP2                                          PIC   X(03).             03538100
SHIP2                  20  PV-HOLD-H-CARD-ACCOUNT-4-7                   03538200
SHIP2                                          PIC   X(04).             03538300
SHIP2                  20  PV-HOLD-H-CARD-ACCOUNT-8-10                  03538400
SHIP2                                          PIC   X(03).             03538500
SHIP2              15  PV-HOLD-H-CARD-LEVEL-OF-ISSUE                    03538600
SHIP2                                          PIC   X(02).             03538700
SHIP2          10  FILLER                          PIC   X(01).         03538800
SHIP2          10  PV-HOLD-H-AUTH-CODE             PIC   X(06).         03538900
SHIP2          10  PV-HOLD-H-REFERRAL-TYPE         PIC   X(01).         03539000
SHIP2              88  PV-HOLD-H-REF-TYPE-APP            VALUE '0'.     03539100
SHIP2              88  PV-HOLD-H-REF-TYPE-EDIT-ERR       VALUE '2'.     03539200
SHIP2              88  PV-HOLD-H-REF-TYPE-SOFT-REF       VALUE '6'.     03539300
SHIP2              88  PV-HOLD-H-REF-TYPE-HARD-DEC       VALUE '7'.     03539400
SHIP2              88  PV-HOLD-H-REF-TYPE-REQ-CALL       VALUE '8'.     03539500
SHIP2              88  PV-HOLD-H-REF-TYPE-OFF-REF        VALUE '9'.     03539600
SHIP2          10  PV-HOLD-H-ORDER-NBR             PIC   X(25).         03539700
SHIP2          10  PV-HOLD-H-CRS-EMPLOYEE-CODE     PIC   X(1).          03539800
SHIP2              88  PV-HOLD-H-NON-EMPLOYEE            VALUE SPACES.  03539900
SHIP2              88  PV-HOLD-H-DEPT-STORE-EMPLOYEE     VALUE '5'.     03540000
SHIP2              88  PV-HOLD-H-DEPT-STORE-EXECUTIVE    VALUE '6'.     03540100
SHIP2              88  PV-HOLD-H-DEPT-STORE-RETIREE      VALUE '7'.     03540200
SHIP2              88  PV-HOLD-H-FOOD-STORE-EMPLOYEE     VALUE '8'.     03540300
SHIP2          10  PV-HOLD-H-OMNI-CHL-FLMT-IND     PIC X(03).           03540400
SHIP2          10  PV-HOLD-H-AUTH-REF-NBR          PIC X(45).           03540500
SHIP2          10  PV-HOLD-H-TRN-GP-CDE            PIC X(01).           03540600
SHIP2          10  PV-HOLD-H-MULT-CLR-SEQ-NBR      PIC 9(04).           03540700
SHIP2          10  PV-HOLD-H-TOT-SHP-NBR           PIC 9(04).           03540800
SHIP2          10  PV-HOLD-H-PAR-SHP-IND           PIC X(01).           03540900
SHIP2                                                                   03541000
SHIP2 *HOLD HEADER                                                      03541100
SHIP2  01  PV-AJB-SALES-CHCK-DETAIL.                                    03541200
SHIP2      05  PV-AJB-SALES-CHCK-DTL-ARRAY OCCURS 500 TIMES.            03541300
SHIP2          10  AJB-SALES-CHCK-DTL-REC      PIC X(267).              03541400
SHIP2                                                                   03541500
035400***************************************************************** 03541600
035500* THE AMOUNTS BELOW ARE USED AS IN THE FOLLOWING EXAMPLE:       * 03541700
035600*   RECEIPT:              EMPLOYEE DISCOUNT:                    * 03541800
035700*   19.99 CLOCK           10%    2.00                           * 03541900
035800*   25.00 SHIRT           15%    3.75                           * 03542000
035900*   -5.00 COUPON                 -.64                           * 03542100
036000*    2.00 TAX                     .26                           * 03543000
036100*  --------------         ------------                          * 03550000
036200*   41.99                        5.37                           * 03560000
036300*                                                               * 03570000
036400* TOTAL DISCOUNT AMT = (2.00 + 3.75) = 5.75                     * 03580000
036500* TOTAL TAX DISCOUNT AMT = (2.00 + 3.75) = 5.75                 * 03590000
036600* TOTAL ORIGINAL AMT = (19.99 + 25.00) = 44.99                  * 03600000
036700* TOTAL TAXABLE ORIGINAL AMT = (19.99 + 25.00) = 44.99          * 03610000
036800* TOTAL COUPON AMT   = -5.00                                    * 03620000
036900* COUPON ADJUST AMT  = (5.75/44.99) * -5.00 = -.64              * 03630000
037000*                    = TOTAL DISCOUNT AMT/TOTAL ORIGINAL AMT    * 03640000
037100*                      * TOTAL COUPON AMT                       * 03650000
037200* TAX ADJUST AMT     = (2.00 + 3.75 - .64)                      * 03660000
037300*                      / (19.99 + 25.00 - 5.00) * 2.00 = .26    * 03670000
037400*                    = (TOTAL TAX DISCOUNT AMT +                * 03680000
037500*                       COUPON ADJUST AMT)                      * 03690000
037600*                     / (TOTAL TAXABLE ORIGINAL AMT +           * 03700000
037700*                        TOTAL COUPON AMT)                      * 03710000
037800*                     * ORIGINAL TAX AMT                        * 03720000
037900* FINAL DISCOUNT AMT = 5.37                                     * 03730000
038000***************************************************************** 03740000
038100     05  PV-EMPLOYEE-DISCOUNT-CALC-AMTS.                          03750000
038200*        PV-TOTAL-DISCOUNT-AMT IS THE ACCUMULATED EMPLOYEE        03760000
038300*        DISCOUNT AMOUNT FOR THE ENTIRE TRANSACTION.              03770000
038400         10  PV-TOTAL-DISCOUNT-AMT                                03780000
038500                                 PIC S9(7)V99 COMP-3              03790000
038600                                              VALUE ZERO.         03800000
038700*        PV-EMPLOYEE-DISCOUNT IS THE EMPLOYEE DISCOUNT            03810000
038800*        PER ITEM SO THAT IT CAN BE INSERTED INTO THE             03820000
038900*        TEPEID TABLE.                                            03830000
039000         10  PV-EMPLOYEE-DISCOUNT                                 03840000
039100                                 PIC S9(7)V99 COMP-3              03850000
039200                                              VALUE ZERO.         03860000
039300         10  PV-TOTAL-ORIGINAL-AMT                                03870000
039400                                 PIC S9(7)V99 COMP-3              03880000
039500                                              VALUE ZERO.         03890000
039600         10  PV-TOTAL-COUPON-AMT PIC S9(7)V99 COMP-3              03900000
039700                                              VALUE ZERO.         03910000
039800         10  PV-ORIGINAL-TAX-AMT PIC S9(7)V99 COMP-3              03920000
039900                                              VALUE ZERO.         03930000
040000         10  PV-NON-DISC-TAX-AMT PIC S9(7)V99 COMP-3              03940000
040100                                              VALUE ZERO.         03950000
040200         10  PV-TAX-ADJUST-AMT   PIC S9(7)V99 COMP-3              03960000
040300                                              VALUE ZERO.         03970000
040400         10  PV-FINAL-DISCOUNT-AMT                                03980000
040500                                 PIC S9(7)V99 COMP-3              03990000
040600                                              VALUE ZERO.         04000000
040700                                                                  04010000
040800 01  CC-CONTROL-CARD.                                             04020000
040900     05  CC-CONTROL-CARD-DISPLAY.                                 04030000
041000         10  CC-POS-DATE-MDY     PIC 9(8)     VALUE ZERO.         04040000
041100         10  FILLER              REDEFINES CC-POS-DATE-MDY.       04050000
041200             15  CC-POS-MONTH    PIC 9(2).                        04060000
041300             15  CC-POS-DAY      PIC 9(2).                        04070000
041400             15  CC-POS-CENTURY  PIC 9(2).                        04080000
041500             15  CC-POS-YEAR     PIC 9(2).                        04090000
041600     05  FILLER                  PIC X(72)    VALUE SPACES.       04100000
041700                                                                  04110000
041800                                                                  04120000
041900 01  CD-CLASS-DESCRIPTION-TABLE.                                  04130000
041910*TDH002                                                           04140000
042000*    05  CD-CLASS-DESC-ENTRY     OCCURS 20000 TIMES               04150000
042010     05  CD-CLASS-DESC-ENTRY     OCCURS 40000 TIMES               04160000
042100                                 ASCENDING KEY IS CD-DEPT-NUMBER  04170000
042200                                                  CD-CLASS-NUMBER 04180000
042300                                 INDEXED BY CD-CLASS-IDX.         04190000
042400         10  CD-DEPT-NUMBER      PIC 9(03).                       04191000
042500         10  CD-CLASS-NUMBER     PIC 9(02).                       04192000
042600         10  CD-CLASS-POS-DESC   PIC X(17).                       04193000
042700                                                                  04194000
042800***************************************************************** 04195000
042900*    *** POSTING FILE TABLE ***                                 * 04196000
043000*    THIS TABLE IS USED TO SPLIT THE POSTING TRANSACTION FILE   * 04197000
043100*    INTO A NUMBER OF SEPARATE FILES, FOR FASTER PROCESSING ON  * 04198000
043200*    THE TANDEM.                                                * 04199000
043300*    THE TABLE HAS AN ENTRY FOR EACH POSTING FILE.  IT WILL     * 04200000
043400*    CONTAIN THE BEGINNING AND ENDING STORE NUMBERS FOR EACH    * 04210000
043500*    FILE.                                                      * 04220000
043600***************************************************************** 04230000
043700                                                                  04240000
043800 01  PT-POSTING-FILE-TABLE.                                       04250000
043900     05  PT-POSTING-FILE-ENTRY   OCCURS 1 TO 20 TIMES             04260000
044000                                 DEPENDING ON                     04270000
044100                                 PC-NBR-OF-POST-FILES             04280000
044200                                 INDEXED BY PT-FILE-IDX.          04290000
044300         10  PT-BEGIN-STORE      PIC 9(4).                        04300000
044400         10  PT-END-STORE        PIC 9(4).                        04310000
044500*---------------------------------------------------------        04320000
044600* SALES TAX RATE TOTALS TABLE FOR TRANSACTION                     04330000
044700*---------------------------------------------------------        04340000
044800 01  PT-TAX-RATE-TABLE.                                           04350000
044900     05  PT-TAX-RATES            OCCURS 20 TIMES                  04360000
045000                                 INDEXED BY TR-INDEX.             04370000
045100         10  PT-TAX-RATE         PIC S9(1)V9(5) COMP-3            04380000
045200                                              VALUE ZERO.         04390000
045300         10  PT-TAXABLE-AMT-TOT  PIC S9(7)V99   COMP-3            04400000
045400                                              VALUE ZERO.         04410000
045500         10  PT-TAX-AMT-TOT      PIC S9(7)V99   COMP-3            04420000
045600                                              VALUE ZERO.         04430000
045700*---------------------------------------------------------        04440000
045800* ECOMM STORE TABLE                                               04450000
045900*---------------------------------------------------------        04460000
046000 01  PT-ECOMM-STORES-TABLE.                                       04470000
046100     05  PT-ECOMM-STORES         OCCURS 99 TIMES                  04480000
046200                                 INDEXED BY ES-INDEX.             04490000
046210         10  PT-ECOMM-STORE      PIC 9(4)     VALUE ZERO.         04500000
046220                                                                  04510000
046230*                                                                 04520000
046240*  SQL AND COBOL DECLARATIONS FOR XST_SUB_CL TABLE                04530000
046250*                                                                 04540000
046260     EXEC SQL                                                     04550000
046270         INCLUDE XST00014                                         04560000
046280     END-EXEC.                                                    04570000
046290                                                                  04580000
046300*                                                                 04590000
046400*  SQL AND COBOL DECLARATIONS FOR XST_LOC                         04600000
046500*                                                                 04610000
046600                                                                  04620000
046700     EXEC SQL                                                     04621000
046800         INCLUDE XST00001                                         04622000
046900     END-EXEC.                                                    04623000
047000                                                                  04624000
047100*                                                                 04625000
047200*  SQL AND COBOL DECLARATIONS FOR THE STATE TABLE (TSTATE)        04626000
047300*                                                                 04627000
047400     EXEC SQL                                                     04628000
047500         INCLUDE TSTATE                                           04629000
047600     END-EXEC.                                                    04630000
047700                                                                  04640000
047800*                                                                 04650000
047900*                                                                 04660000
048000*  STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA                04670000
048100*                                                                 04680000
048200     EXEC SQL                                                     04690000
048300         INCLUDE SQLCA                                            04700000
048400     END-EXEC.                                                    04710000
048500                                                                  04720000
048600*                                                                 04730000
048700*  CURSOR USED TO RETRIEVE THE CLASS POS DESCRIPTIONS.            04740000
048800*                                                                 04750000
048900                                                                  04760000
049000     EXEC SQL                                                     04770000
049100         DECLARE CLASS_CURSOR CURSOR FOR                          04780000
049200         SELECT   DEPT_NBR                                        04790000
049300                 ,SUB_CL_NBR                                      04800000
049400                 ,POS_MDSE_DESC                                   04810000
049500             FROM XST_SUB_CL                                      04820000
049600         ORDER BY DEPT_NBR                                        04830000
049700                 ,SUB_CL_NBR                                      04840000
049800         WITH UR                                                  04850000
049900     END-EXEC.                                                    04860000
050000                                                                  04870000
050100*                                                                 04880000
050200*  CURSOR USED TO RETRIEVE THE STORE NUMBER RANGES.               04890000
050300*                                                                 04900000
050400                                                                  04910000
050500     EXEC SQL                                                     04920000
050600         DECLARE STORE_CURSOR CURSOR FOR                          04930000
050700             SELECT LOC_NBR                                       04940000
050800                 FROM XST_LOC                                     04950000
050900                WHERE ((:PV-DB2-POS-DATE                          04960000
051000                       BETWEEN OPN_DTE AND CLO_DTE) OR            04970000
051100                       (:PV-DB2-POS-DATE >= OPN_DTE AND           04980000
051200                       CLO_DTE IS NULL))                          04990000
051300                  AND LOC_TYP_CDE = 'DS'                          05000000
051400                 ORDER BY LOC_NBR                                 05010000
051500     END-EXEC.                                                    05020000
051600                                                                  05030000
051700*                                                                 05040000
051800*  CURSOR USED TO RETRIEVE THE ECOMM STORE NUMBERS.               05050000
051900*                                                                 05060000
052000                                                                  05070000
052100     EXEC SQL                                                     05080000
052200         DECLARE ECOMM_CURSOR CURSOR FOR                          05090000
052300             SELECT LOC_NBR                                       05100000
052310                 FROM XST_LOC                                     05110000
052320                WHERE E_BUS_IND = 'Y'                             05120000
052330             ORDER BY LOC_NBR                                     05130000
052340     END-EXEC.                                                    05140000
052350                                                                  05150000
052360******************************************************************05160000
052370 PROCEDURE DIVISION.                                              05170000
052380******************************************************************05180000
052390                                                                  05190000
052400 0000-MAINLINE.                                                   05200000
052500                                                                  05210000
052600     PERFORM 1000-INITIALIZE.                                     05220000
052700                                                                  05230000
052800     PERFORM 2000-PROCESS-TRANSACTION                             05231000
052900       UNTIL PS-END-OF-TRANS-FILE.                                05232000
053000                                                                  05233000
053100     PERFORM 9000-EOJ-ROUTINE.                                    05234000
053200                                                                  05235000
053300     GOBACK.                                                      05236000
053400******************************************************************05237000
053500*  SET UP FOR PROGRAM PROCESSING BY ACCEPTING, DISPLAYING, AND   *05238000
053600*  VALIDATING THE CONTROL CARD, COMPUTING APPLICABLE DISCOUNT    *05239000
053700*  PERCENTAGES, OPENING ALL FILES, AND READING THE               *05240000
053800*  FIRST ACCOUNTS RECEIVABLE TRANSACTION RECORD.                 *05250000
053900******************************************************************05260000
054000                                                                  05270000
054100 1000-INITIALIZE.                                                 05280000
054200                                                                  05290000
054300     ACCEPT CC-CONTROL-CARD.                                      05300000
054400     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - CONTROL CARD = ('       05310000
054500               CC-CONTROL-CARD-DISPLAY  ')'.                      05320000
054600                                                                  05330000
054700     PERFORM 1100-VALIDATE-CONTROL-CARD.                          05340000
054800                                                                  05350000
054900     OPEN INPUT  AR-TRANSACTION-FILE                              05360000
055000          OUTPUT SALES-CHECK-DETAIL-FILE                          05370000
055100                 POSTING-TRANS-FILE-1                             05380000
055200                 POSTING-TRANS-FILE-2                             05390000
055300                 POSTING-TRANS-FILE-3                             05400000
055400                 POSTING-TRANS-FILE-4                             05410000
055500                 POSTING-TRANS-FILE-5                             05420000
055600                 POSTING-TRANS-FILE-6                             05430000
055700                 POSTING-TRANS-FILE-7                             05440000
055800                 POSTING-TRANS-FILE-8                             05450000
P9696                  AJB-SALES-CHCK-DTL-FILE                          05460000
P9696                  AJB-POSTING-TRANS-FILE.                          05470000
056000                                                                  05480000
056100     PERFORM 1200-LOAD-CLASS-DESCRIPTIONS.                        05490000
056200                                                                  05500000
056300     PERFORM 1300-LOAD-POSTING-FILE-TABLE.                        05510000
056400                                                                  05520000
056500     PERFORM 1400-LOAD-ECOMM-STORES-TABLE.                        05530000
056600                                                                  05540000
056700     PERFORM 7000-READ-TRANSACTION-FILE.                          05550000
056800                                                                  05560000
056900******************************************************************05570000
057000*  VALIDATE THE CONTROL CARD.  ENSURE THAT A VALID P.O.S. DATE   *05580000
057100*  HAS BEEN PROVIDED.  ENSURE THAT ALL DISCOUNT PERCENTAGES      *05590000
057200*  ARE NUMERIC, ARE GREATER THAN ZERO, AND ARE PRECEEDED BY THE  *05600000
057300*  APPROPRIATE IDENTIFYING LITERAL.                              *05610000
057400******************************************************************05620000
057500                                                                  05630000
057600 1100-VALIDATE-CONTROL-CARD.                                      05640000
057700                                                                  05650000
057800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05660000
057900     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     05670000
058000     SET DPG52-LK-DTE-GREG-CC        TO TRUE.                     05680000
058100     MOVE CC-POS-DATE-MDY            TO DPG52-LK-DATE-INPUT.      05690000
058200                                                                  05700000
058300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05710000
058400                                             DPG54 DPG55 DPG56.   05720000
058500     IF DPG54-DATE-INVALID                                        05730000
058600        DISPLAY '*** ABEND ***'                                   05740000
058700        DISPLAY '*** PROGRAM = ARKUT090'                          05750000
058800        DISPLAY '*** PARA = 1100-VALIDATE-CONTROL-CARD'           05760000
058900        DISPLAY '*** BAD RESPONSE FROM DATE ROUTINE ***'          05770000
059000        MOVE +4008  TO   ABEND-CODE                               05780000
059100        CALL 'ILBOABN0' USING ABEND-CODE                          05790000
059200     END-IF.                                                      05800000
059300                                                                  05810000
059400******************************************************************05820000
059500*  LOAD THE CLASS DESCRIPTIONS FROM MBS TABLES INTO AN INTERNAL  *05830000
059600*  TABLE IN WORKING-STORAGE.                                     *05840000
059700******************************************************************05850000
059800                                                                  05860000
059900 1200-LOAD-CLASS-DESCRIPTIONS.                                    05870000
060000                                                                  05880000
060100     MOVE HIGH-VALUES TO CD-CLASS-DESCRIPTION-TABLE.              05890000
060200                                                                  05900000
060300     EXEC SQL                                                     05910000
060400         OPEN CLASS_CURSOR                                        05920000
060500     END-EXEC.                                                    05930000
060600                                                                  05940000
060700     IF SQLCODE NOT = ZERO                                        05950000
060800         SET PV-OPEN-CLASS-CURSOR TO TRUE                         05960000
060900         PERFORM 9100-DB2-ERROR                                   05970000
061000     END-IF.                                                      05980000
061100                                                                  05990000
061200     PERFORM 1210-FETCH-CLASS-CURSOR.                             06000000
061300                                                                  06010000
061400     SET CD-CLASS-IDX TO 1.                                       06020000
061500     PERFORM 1205-PROCESS-CLASS-CURSOR                            06030000
061600         UNTIL PS-END-OF-CLASS-CURSOR                             06040000
061700         OR PV-DEPT-CLASS-CTR > PC-MAX-DEPT-CLASSES.              06050000
061800                                                                  06060000
061900     EXEC SQL                                                     06070000
062000         CLOSE CLASS_CURSOR                                       06080000
062100     END-EXEC.                                                    06090000
062200                                                                  06100000
062300     IF SQLCODE NOT = ZERO                                        06110000
062400         SET PV-CLOSE-CLASS-CURSOR TO TRUE                        06120000
062500         PERFORM 9100-DB2-ERROR                                   06130000
062600     END-IF.                                                      06140000
062700     IF PV-DEPT-CLASS-CTR > PC-MAX-DEPT-CLASSES                   06150000
062800         PERFORM 9400-CLASS-MAX-ERROR                             06160000
062900     END-IF.                                                      06170000
063000                                                                  06180000
063100******************************************************************06190000
063200*  PROCESS THE CLASS CURSOR, CREATING AN INTERNAL TABLE          *06200000
063300******************************************************************06210000
063400 1205-PROCESS-CLASS-CURSOR.                                       06220000
063500                                                                  06230000
063600     MOVE XST00014-DEPT-NBR      TO CD-DEPT-NUMBER                06240000
063700                                    (CD-CLASS-IDX).               06250000
063800     MOVE XST00014-SUB-CL-NBR    TO CD-CLASS-NUMBER               06260000
063900                                    (CD-CLASS-IDX).               06270000
064000     MOVE XST00014-POS-MDSE-DESC TO CD-CLASS-POS-DESC             06280000
064100                                    (CD-CLASS-IDX).               06290000
064200     SET CD-CLASS-IDX UP BY 1.                                    06300000
064300                                                                  06310000
064400     PERFORM 1210-FETCH-CLASS-CURSOR.                             06320000
064500                                                                  06330000
064600******************************************************************06340000
064700*  FETCH THE CLASS CURSOR.                                       *06350000
064800******************************************************************06360000
064900 1210-FETCH-CLASS-CURSOR.                                         06370000
065000                                                                  06380000
065100     EXEC SQL                                                     06390000
065200         FETCH CLASS_CURSOR                                       06400000
065300             INTO :XST00014-DEPT-NBR                              06410000
065400                 ,:XST00014-SUB-CL-NBR                            06420000
065500                 ,:XST00014-POS-MDSE-DESC                         06430000
065600     END-EXEC.                                                    06440000
065700                                                                  06450000
065800     IF SQLCODE = ZERO                                            06460000
065900         ADD +1 TO PV-DEPT-CLASS-CTR                              06470000
066000     ELSE                                                         06480000
066100         IF SQLCODE = +100                                        06490000
066200             SET PS-END-OF-CLASS-CURSOR TO TRUE                   06500000
066300         ELSE                                                     06510000
066400             SET PV-FETCH-CLASS-ROW TO TRUE                       06520000
066500             PERFORM 9100-DB2-ERROR                               06530000
066600         END-IF                                                   06540000
066700     END-IF.                                                      06550000
066800                                                                  06560000
066900******************************************************************06570000
067000*    LOAD THE TABLE OF STORE NUMBER RANGES FOR EACH POSTING FILE.*06580000
067100******************************************************************06590000
067200                                                                  06600000
067300 1300-LOAD-POSTING-FILE-TABLE.                                    06610000
067400                                                                  06620000
067500     MOVE SPACES              TO PT-POSTING-FILE-TABLE.           06630000
067600                                                                  06640000
067700     MOVE CC-POS-MONTH        TO PV-DB2-POS-MM.                   06650000
067800     MOVE CC-POS-DAY          TO PV-DB2-POS-DD.                   06660000
067900     MOVE CC-POS-YEAR         TO PV-DB2-POS-YY.                   06670000
068000     MOVE CC-POS-CENTURY      TO PV-DB2-POS-CC.                   06680000
068100     MOVE PV-DB2-FORMAT-DATE  TO PV-DB2-POS-DATE.                 06690000
068200                                                                  06700000
068300     EXEC SQL                                                     06710000
068400         SELECT COUNT(*)                                          06720000
068500         INTO :PV-STORE-COUNT                                     06730000
068600         FROM XST_LOC                                             06740000
068700         WHERE ((:PV-DB2-POS-DATE                                 06750000
068800                  BETWEEN OPN_DTE AND CLO_DTE) OR                 06760000
068900                (:PV-DB2-POS-DATE >= OPN_DTE AND                  06770000
069000                  CLO_DTE IS NULL))                               06780000
069100               AND LOC_TYP_CDE = 'DS'                             06790000
069200     END-EXEC.                                                    06800000
069300                                                                  06810000
069400     IF SQLCODE NOT = ZERO                                        06820000
069500         SET PV-STORE-COUNT-ERR TO TRUE                           06830000
069600         PERFORM 9100-DB2-ERROR                                   06840000
069700     END-IF.                                                      06850000
069800                                                                  06860000
069900     DIVIDE PV-STORE-COUNT BY PC-NBR-OF-POST-FILES                06870000
070000         GIVING PV-STORES-PER-FILE                                06880000
070100         REMAINDER PV-REMAINDER                                   06890000
070200     END-DIVIDE.                                                  06900000
070300                                                                  06910000
070400     IF PV-REMAINDER > ZERO                                       06920000
070500         ADD 1 TO PV-STORES-PER-FILE                              06930000
070600     END-IF.                                                      06940000
070700                                                                  06950000
070800     EXEC SQL                                                     06960000
070900         OPEN STORE_CURSOR                                        06970000
071000     END-EXEC.                                                    06980000
071100                                                                  06990000
071200     IF SQLCODE NOT = ZERO                                        07000000
071300         SET PV-OPEN-STORE-CURSOR TO TRUE                         07010000
071400         PERFORM 9100-DB2-ERROR                                   07020000
071500     END-IF.                                                      07030000
071600                                                                  07040000
071700     PERFORM VARYING PT-FILE-IDX FROM 1 BY 1                      07050000
071800             UNTIL PT-FILE-IDX > PC-NBR-OF-POST-FILES             07060000
071900                   OR PS-END-OF-STORE-CURSOR                      07070000
072000         PERFORM 1310-FETCH-STORE-CURSOR                          07080000
072100         MOVE XST00001-LOC-NBR TO PT-BEGIN-STORE (PT-FILE-IDX)    07090000
072200         PERFORM VARYING PV-STORE-COUNTER FROM 2 BY 1             07100000
072300                 UNTIL PV-STORE-COUNTER > PV-STORES-PER-FILE      07110000
072400                       OR PS-END-OF-STORE-CURSOR                  07120000
072500             PERFORM 1310-FETCH-STORE-CURSOR                      07130000
072600             IF PS-END-OF-STORE-CURSOR                            07140000
072700                 CONTINUE                                         07150000
072800             ELSE                                                 07160000
072900                 MOVE XST00001-LOC-NBR                            07170000
073000                               TO PT-END-STORE (PT-FILE-IDX)      07180000
073100             END-IF                                               07190000
073200         END-PERFORM                                              07200000
073300     END-PERFORM.                                                 07210000
073400                                                                  07220000
073500     EXEC SQL                                                     07230000
073600         CLOSE STORE_CURSOR                                       07240000
073700     END-EXEC.                                                    07250000
073800                                                                  07260000
073900     IF SQLCODE NOT = ZERO                                        07270000
074000         SET PV-CLOSE-STORE-CURSOR TO TRUE                        07280000
074100         PERFORM 9100-DB2-ERROR                                   07290000
074200     END-IF.                                                      07300000
074300                                                                  07310000
074400******************************************************************07320000
074500*  FETCH THE STORE CURSOR.                                       *07330000
074600******************************************************************07340000
074700                                                                  07350000
074800 1310-FETCH-STORE-CURSOR.                                         07360000
074900                                                                  07370000
075000     EXEC SQL                                                     07380000
075100         FETCH STORE_CURSOR                                       07390000
075200             INTO :XST00001-LOC-NBR                               07400000
075300     END-EXEC.                                                    07410000
075400                                                                  07420000
075500     EVALUATE SQLCODE                                             07430000
075600         WHEN ZERO                                                07440000
075700             CONTINUE                                             07450000
075800         WHEN +100                                                07460000
075900             SET PS-END-OF-STORE-CURSOR TO TRUE                   07470000
076000         WHEN OTHER                                               07480000
076100             SET PV-FETCH-STORE-ROW TO TRUE                       07490000
076200             PERFORM 9100-DB2-ERROR                               07500000
076300     END-EVALUATE.                                                07510000
076400                                                                  07520000
076500                                                                  07530000
076600******************************************************************07540000
076700*    LOAD THE TABLE OF ECOMM STORE NUMBERS                       *07550000
076710******************************************************************07560000
076720                                                                  07570000
076730 1400-LOAD-ECOMM-STORES-TABLE.                                    07580000
076740                                                                  07590000
076750     MOVE ZEROES              TO PT-ECOMM-STORES-TABLE.           07600000
076760                                                                  07610000
076770     EXEC SQL                                                     07620000
076780         OPEN ECOMM_CURSOR                                        07630000
076790     END-EXEC.                                                    07640000
076800                                                                  07650000
076810     IF SQLCODE NOT = ZERO                                        07660000
076820         SET PV-OPEN-ECOMM-CURSOR TO TRUE                         07670000
076821         PERFORM 9100-DB2-ERROR                                   07671000
076822     END-IF.                                                      07672000
076823                                                                  07673000
076824     PERFORM VARYING ES-INDEX FROM 1 BY 1                         07674000
076825               UNTIL ES-INDEX  > 99                               07675000
076826                  OR PS-END-OF-ECOMM-CURSOR                       07676000
076827         PERFORM 1410-FETCH-ECOMM-CURSOR                          07677000
076828         MOVE XST00001-LOC-NBR TO PT-ECOMM-STORE (ES-INDEX)       07678000
076829     END-PERFORM.                                                 07679000
076830                                                                  07680000
076840     EXEC SQL                                                     07681000
076841         CLOSE ECOMM_CURSOR                                       07682000
076842     END-EXEC.                                                    07682100
076843                                                                  07682200
076844     IF SQLCODE NOT = ZERO                                        07682300
076845         SET PV-CLOSE-ECOMM-CURSOR TO TRUE                        07682400
076846         PERFORM 9100-DB2-ERROR                                   07682500
076847     END-IF.                                                      07682600
076848                                                                  07682700
076849******************************************************************07682800
076850*  FETCH THE ECOMM CURSOR.                                       *07682900
076851******************************************************************07683000
076852                                                                  07684000
076853 1410-FETCH-ECOMM-CURSOR.                                         07684100
076854                                                                  07684400
076855     EXEC SQL                                                     07684500
076856         FETCH ECOMM_CURSOR                                       07684600
076857             INTO :XST00001-LOC-NBR                               07684700
076858     END-EXEC.                                                    07684800
076859                                                                  07684900
076860     EVALUATE SQLCODE                                             07685000
076861         WHEN ZERO                                                07685100
076862             CONTINUE                                             07685200
076863         WHEN +100                                                07685300
076864             SET PS-END-OF-ECOMM-CURSOR TO TRUE                   07685400
076865         WHEN OTHER                                               07685500
076866             SET PV-FETCH-ECOMM-ROW TO TRUE                       07685600
076867             PERFORM 9100-DB2-ERROR                               07685700
076868     END-EVALUATE.                                                07685800
076869                                                                  07685900
076870                                                                  07686000
076880******************************************************************07686100
076890*  PROCESS A TRANSACTION INPUT RECORD.                           *07686200
076900******************************************************************07686300
077000                                                                  07686400
077100 2000-PROCESS-TRANSACTION.                                        07686500
077200                                                                  07686800
077300     IF PS-FIRST-RECORD                                           07686900
077400         PERFORM 2100-PROCESS-NEW-TRANS                           07687000
077500         SET PS-NOT-FIRST-RECORD TO TRUE                          07687100
077600     ELSE                                                         07687300
077700         IF AR001-TRANSACTION-DATE    = PV-SAVE-TRANS-DATE   AND  07687400
077800            AR001-TRANSACTION-TIME    = PV-SAVE-TRANS-TIME   AND  07687500
077900            AR001-STORE-NUMBER        = PV-SAVE-STORE-NMBR   AND  07688000
078000            AR001-TERMINAL-NUMBER     = PV-SAVE-TERM-NUM     AND  07689000
078100            AR001-TRANSACTION-NUMBER  = PV-SAVE-TRANS-NUM    AND  07690000
078200            AR001-TNDR-SEQ-NBR        = PV-SAVE-TNDR-SEQ-NBR AND  07700000
078300            AR001-TRANSACTION-SOURCE  = PV-SAVE-TRANS-SOURCE AND  07710000
JPGFX3            AR001-ORD-NBR             = PV-SAVE-ORD-NBR      AND  07720000
078400            PV-SAVE-TRANS-HAS-MERCHANDISE                         07730000
078500             PERFORM 2200-PROCESS-MERCHANDISE                     07750000
078600         ELSE                                                     07760000
078700             IF PV-SAVE-TRANS-HAS-MERCHANDISE                     07810800
078800                 PERFORM 2400-UPDATE-POSTING-TRANS                07811000
078900                 PERFORM 7200-WRITE-POSTING-TRANS                 07811100
079000                 IF PV-SAVE-EMPLOYEE                              07812000
079100                     PERFORM 2500-CREATE-EMPL-DISCOUNT            07813000
079200                 END-IF                                           07814000
SHIP2 * WRITE OUT THE HEADER                                            07815100
SHIP2                  MOVE PV-HOLD-AJB-HEADER-RECORD                   07815500
SHIP2                                 TO AR025-AR-SALES-CHECK-RECORD    07815600
SHIP2                  WRITE AJB-SALES-CHCK-DTL-RECORD                  07815700
SHIP2                               FROM AR025-AR-SALES-CHECK-RECORD    07815800
SHIP2 * WRITE OUT ALL THE DETAIL RECORDS IN THE ARRAY                   07816100
SHIP2                  MOVE PV-AJB TO PV-TOT-SUB                        07816200
SHIP2                  PERFORM VARYING PV-AJB-SUB                       07816300
SHIP2                     FROM 1 BY 1 UNTIL PV-AJB-SUB > PV-TOT-SUB     07816400
SHIP2                     MOVE AJB-SALES-CHCK-DTL-REC(PV-AJB-SUB)       07816500
SHIP2                                 TO AR025-AR-SALES-CHECK-RECORD    07816600
SHIP2                     WRITE AJB-SALES-CHCK-DTL-RECORD               07816700
SHIP2                               FROM AR025-AR-SALES-CHECK-RECORD    07816800
SHIP2                  END-PERFORM                                      07816900
SHIP2                  IF AR001-ORD-NBR NOT EQUAL PV-SAVE-ORD-NBR       07817000
SHIP2                     MOVE 'Y' TO PS-FIRST-TIME-SW                  07817100
SHIP2                     MOVE 'N' TO PS-OMNI-SW                        07817200
SHIP2                     MOVE 'N' TO PS-FIRST-S2H-SHIPMENT             07817300
SHIP2                  END-IF                                           07817400
079300             END-IF                                               07817500
079400             PERFORM 2100-PROCESS-NEW-TRANS                       07817600
079500         END-IF                                                   07818000
079600     END-IF.                                                      07819000
079700                                                                  07820000
079800     PERFORM 7000-READ-TRANSACTION-FILE.                          07830000
079900                                                                  07840000
080000******************************************************************07850000
080100*  PROCESS A NEW TRANSACTION.                                    *07860000
080200******************************************************************07870000
080300                                                                  07880000
080400 2100-PROCESS-NEW-TRANS.                                          07890000
080500                                                                  07900000
080600*  IF THIS IS A DUPLICATE TRANSACTION BECAUSE MORE THAN ONE       07910000
080700*  KOHL'S CHARGE WAS USED IN THE TRANSACTION, SET SWITCH SO       07920000
080800*  THAT THE TRANSACTION IS NOT WRITTEN TO THE TAX FILE.           07930000
080900                                                                  07940000
081000     IF AR001-TRANSACTION-DATE    = PV-SAVE-TRANS-DATE   AND      07950000
081100        AR001-TRANSACTION-TIME    = PV-SAVE-TRANS-TIME   AND      07960000
081200        AR001-STORE-NUMBER        = PV-SAVE-STORE-NMBR   AND      07970000
081300        AR001-TERMINAL-NUMBER     = PV-SAVE-TERM-NUM     AND      07980000
JPGFX3        AR001-TRANSACTION-NUMBER  = PV-SAVE-TRANS-NUM    AND      07990000
JPGFX3        AR001-ORD-NBR             = PV-SAVE-ORD-NBR               08000000
081500         SET PS-NO-TRANS-TO-TAX TO TRUE                           08010000
081600     ELSE                                                         08020000
081700         SET PS-TRANS-TO-TAX TO TRUE                              08030000
081800     END-IF.                                                      08040000
SHIP2                                                                   08041000
SHIP2      MOVE 0                         TO PV-AJB.                    08042000
SHIP2      INITIALIZE PV-HOLD-AJB-HEADER-RECORD.                        08044000
SHIP2      INITIALIZE PV-AJB-SALES-CHCK-DETAIL.                         08045000
081900                                                                  08050000
082000*  IF TRANSACTION IS FOR DIFFERENT STORE,                         08060000
082100*  LOOK UP SALES TAX ROUNDING METHOD .                            08070000
082200*                                                                 08080000
082300     IF AR001-STORE-NUMBER NOT = PV-SAVE-STORE-NMBR               08090000
082400        MOVE AR001-STORE-NUMBER TO PV-SAVE-STORE-NMBR             08100000
082600     END-IF.                                                      08110000
082700                                                                  08120000
082800     MOVE ZERO                      TO PV-POSTING-TOTAL-AMT       08130000
082900                                       PV-NON-DISC-TOTAL-AMT      08140000
083000                                       PV-SAVE-TOTAL-TAX          08150000
083100                                       PV-TRAN-TAX-RT-CTR.        08160000
083200                                                                  08170000
083300     INITIALIZE PV-EMPLOYEE-DISCOUNT-CALC-AMTS                    08230000
083400                PT-TAX-RATE-TABLE.                                08240000
083500                                                                  08250000
083600     MOVE AR001-TRANSACTION-DATE    TO PV-SAVE-TRANS-DATE.        08260000
083700     MOVE AR001-TRANSACTION-TIME    TO PV-SAVE-TRANS-TIME.        08270000
083800     MOVE AR001-TERMINAL-NUMBER     TO PV-SAVE-TERM-NUM.          08280000
083900     MOVE AR001-TRANSACTION-NUMBER  TO PV-SAVE-TRANS-NUM.         08290000
084000     MOVE AR001-TNDR-SEQ-NBR        TO PV-SAVE-TNDR-SEQ-NBR.      08300000
084100     MOVE AR001-TRANSACTION-SOURCE  TO PV-SAVE-TRANS-SOURCE.      08310000
JPGFX3     MOVE AR001-ORD-NBR             TO PV-SAVE-ORD-NBR.           08320000
084200                                                                  08340000
084300     IF AR001-NON-EMPLOYEE                                        08350000
084400         SET PV-SAVE-NON-EMPLOYEE   TO TRUE                       08360000
084500     ELSE                                                         08370000
084600         SET PV-SAVE-EMPLOYEE       TO TRUE                       08380000
084700     END-IF.                                                      08390000
084800                                                                  08400000
084900     IF AR001-ASSOC-CASH = 'Y'                                    08410000
085000         SET PS-ASSOC-CASH TO TRUE                                08420000
085100     ELSE                                                         08430000
085200         SET PS-NOT-ASSOC-CASH TO TRUE                            08440000
085300     END-IF.                                                      08450000
085400                                                                  08460000
085500     IF AR001-POS-CHARGE OR                                       08470000
085600        AR001-POS-RETURN OR                                       08480000
085700        AR001-MIXED-MODE-OR-PRICE-ADJ                             08481000
085800         SET PV-SAVE-TRANS-HAS-MERCHANDISE TO TRUE                08510000
085900         PERFORM 2110-CREATE-HEADER                               08520000
086000         PERFORM 2200-PROCESS-MERCHANDISE                         08530000
086100     ELSE                                                         08540000
086200         SET PV-SAVE-TRANS-POSTING-ONLY    TO TRUE                08550000
086300         PERFORM 2300-PROCESS-POSTING-ONLY                        08560000
086400     END-IF.                                                      08570000
086500                                                                  08580000
086600******************************************************************08590000
086700*  CREATE A 'SALES CHECK DETAIL' HEADER FOR THE TRANSACTION.     *08600000
086800******************************************************************08610000
086900                                                                  08620000
087000 2110-CREATE-HEADER.                                              08630000
087100                                                                  08640000
087200     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  08650000
JPGFX8     INITIALIZE AR020-H-HEADER-RECORD.                            08660000
087300     SET AR020-H-RECORD-ID-HEADER TO TRUE.                        08670000
087400     MOVE PC-SCD-HEADER-LENGTH    TO AR020-H-LENGTH.              08680000
087500     SET ES-INDEX TO 1.                                           08690000
087600     SEARCH PT-ECOMM-STORES                                       08700000
087610       AT END                                                     08710000
087620         MOVE AR001-STORE-NUMBER  TO PV-STORE-NUMBER              08720000
087630       WHEN PT-ECOMM-STORE (ES-INDEX) = AR001-STORE-NUMBER        08730000
087631         MOVE 0873                TO PV-STORE-NUMBER              08740000
087632       WHEN PT-ECOMM-STORE (ES-INDEX) = ZEROES                    08750000
087633         MOVE AR001-STORE-NUMBER  TO PV-STORE-NUMBER              08760000
087634     END-SEARCH.                                                  08761000
087635     MOVE PV-STORE-NUMBER         TO AR020-H-MERCHANT-ID.         08762000
087636     IF AR001-POS-TRANSACTION                                     08763000
087637         SET AR020-H-ORIG-TRANS   TO TRUE                         08763100
087638     ELSE                                                         08763200
087639         SET AR020-H-ORIG-TRANS-REVERSAL TO TRUE                  08763300
087640     END-IF.                                                      08763400
087650     MOVE ZERO                    TO AR020-H-DEPT-ID.             08763500
087660     MOVE AR001-TERMINAL-NUMBER   TO PV-TERM-NUMBER.              08763600
087670     MOVE PV-TERM-NUMBER          TO AR020-H-POS-ID.              08763700
087680     MOVE AR001-TRN-DTE(1:2)      TO PV-TRANS-MM.                 08763800
087690     MOVE AR001-TRN-DTE(3:2)      TO PV-TRANS-DD.                 08763900
087700     MOVE AR001-TRN-DTE(5:2)      TO PV-TRANS-YY.                 08764000
087800     IF PV-TRANS-YY < 80                                          08765000
087900         MOVE 20                  TO PV-TRANS-CC                  08766000
088000     ELSE                                                         08767000
088100         MOVE 19                  TO PV-TRANS-CC                  08768000
088200     END-IF.                                                      08769000
088300     MOVE ZERO                    TO AR020-H-ENTRY-DATE.          08770000
088400     MOVE PV-TRANS-DATE           TO AR020-H-DATE.                08780000
088500     MOVE AR001-TRANSACTION-NUMBER                                08790000
088600                                  TO PV-TRANS-NUMBER.             08800000
088700     MOVE PV-TRANS-NUMBER         TO AR020-H-REF-NO.              08810000
088800     ADD 1                        TO PV-SEQ-NBR.                  08820000
088900     MOVE PV-SEQ-NBR              TO AR020-H-SEQUENCE             08830000
089000                                     AR020-H-REF-SEQ.             08840000
089100     MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                           08850000
089200                                  TO AR020-H-ORIG-ACCOUNT-NO-1.   08860000
089300     MOVE AR004-DEFAULT-ACCOUNT-TYPE                              08870000
089400                                  TO AR020-H-ORIG-ACCOUNT-NO-2.   08880000
P1043      IF AR001-BIN-NUMBER > SPACES                                 08890000
P1043         SET AR020-H-RECEIVED-18-DIGIT-NO TO TRUE                  08900000
P1043      ELSE                                                         08910000
089500       IF AR001-ACCOUNT-NUMBER-11-12 NUMERIC                      08920000
089600           IF AR001-ACCOUNT-NUMBER-11-12 > ZERO OR                08930000
089700              AR001-POS-TRANSACTION                               08940000
089800               SET AR020-H-RECEIVED-12-DIGIT-NO TO TRUE           08950000
089900           ELSE                                                   08960000
090000               SET AR020-H-RECEIVED-10-DIGIT-NO TO TRUE           08970000
090100           END-IF                                                 08980000
090200       ELSE                                                       08990000
090300           SET AR020-H-RECEIVED-10-DIGIT-NO TO TRUE               09000000
090400       END-IF                                                     09010000
P1043      END-IF.                                                      09020000
090500     MOVE AR001-REG-OPERATOR-ID   TO AR020-H-OPERATOR-ID.         09030000
090600     MOVE SPACES                  TO AR020-H-MATCHING-REVERSAL.   09040000
090700     MOVE ZERO                    TO AR020-H-PROCESSED-DATE       09041000
090800                                     AR020-H-DETAILS-LENGTH.      09042000
090900     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       09043000
091000                                                                  09044000
091100     MOVE SPACES                  TO AR021-AR-POSTING-RECORD.     09045000
091200     MOVE AR020-H-MERCHANT-ID     TO AR021-MERCHANT-ID.           09046000
091300     MOVE AR020-H-STORE-SUFFIX    TO AR021-STORE-SUFFIX.          09047000
091400     MOVE ZERO                    TO AR021-DEPT-ID.               09048000
091500     MOVE AR020-H-POS-ID          TO AR021-POS-ID.                09049000
091600     MOVE AR020-H-DATE            TO AR021-ENTRY-DATE.            09050000
091700     MOVE AR020-H-REF-NO          TO AR021-REF-NO.                09060000
091800     MOVE AR020-H-REF-SEQ         TO AR021-REF-SEQ.               09070000
091900     MOVE AR001-TRANSACTION-TIME  TO AR021-TIME.                  09080000
P1043      MOVE AR001-BIN-NUMBER        TO AR021-BIN-NUMBER.            09090000
           MOVE AR001-EMP-DISC-SRC-CDE  TO AR021-EMP-DISC-SRC-CDE.      09100000
                                                                        09110000
P1043      IF AR020-H-RECEIVED-18-DIGIT-NO OR                           09120000
P1043         AR020-H-RECEIVED-12-DIGIT-NO                              09130000
092100*          * CARD NUMBER IS KNOWN *                               09140000
092200           MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                     09150000
092300                                    TO AR021-CARD-ACCOUNT         09160000
092400                                       AR021-ACCOUNT-NUMBER       09170000
092500           MOVE AR001-ACCOUNT-NUMBER-11-12                        09180000
092600                                    TO AR021-CARD-LEVEL-OF-ISSUE  09190000
092700           MOVE AR004-DEFAULT-ACCOUNT-TYPE                        09200000
092800                                    TO AR021-ACCOUNT-TYPE         09210000
092900     ELSE                                                         09220000
093000*          * CARD NUMBER IS NOT KNOWN, USE ACCOUNT NUMBER *       09230000
093100           MOVE ZEROS               TO AR021-CARD-NO              09240000
093200           MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                     09250000
093300                                    TO AR021-ACCOUNT-NUMBER       09260000
093400           MOVE AR004-DEFAULT-ACCOUNT-TYPE                        09270000
093500                                    TO AR021-ACCOUNT-TYPE         09280000
P1043      END-IF.                                                      09290000
093700     MOVE AR004-ISSUER            TO AR021-ISSUER.                09300000
093800     MOVE AR004-CARD-AGREEMENT    TO AR021-CARD-AGREEMENT.        09310000
093900     MOVE AR001-AUTH-NUMBER       TO AR021-AUTH-CODE.             09320000
094000     IF AR001-REFERRAL-TYPE IS NUMERIC                            09330000
094100         MOVE AR001-REFERRAL-TYPE                                 09340000
094200                                  TO AR021-REFERRAL-TYPE          09350000
094300     ELSE                                                         09360000
094400         MOVE ZERO                TO AR021-REFERRAL-TYPE          09370000
094500     END-IF.                                                      09380000
094600     MOVE ZERO                    TO AR021-AMOUNT                 09390000
094700                                     AR021-TRANS-TYPE.            09400000
094800     MOVE AR001-ORD-NBR           TO AR021-ECOMM-ORDER-NBR.       09410000
P9696                                                                   09420000
P9696      MOVE AR001-PARTITION-NUMBER  TO PV-PARTN-NBR.                09430000
P9696      MOVE AR001-TRANSACTION-YEAR  TO PV-SALES-YY.                 09440000
P9696      MOVE AR001-TRANSACTION-MONTH TO PV-SALES-MM.                 09450000
P9696      MOVE AR001-TRANSACTION-DAY   TO PV-SALES-DD.                 09460000
P9696      MOVE AR001-ORG-STR-NBR       TO PV-ORG-STR-NBR.              09470000
P9696      MOVE AR001-START-TIME        TO PV-START-TIME.               09480000
P9696      MOVE AR001-SLS-CORR-SEQ-NBR  TO PV-SLS-CORR-SEQ-NBR.         09481000
P9696      MOVE AR001-ACCOUNT-NUMBER    TO PV-ACCOUNT-NUMBER.           09482000
P1043      MOVE AR001-BIN-NUMBER        TO PV-BIN-NUMBER.               09483000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      09485000
094900                                                                  09486000
095000******************************************************************09487000
095100*  PROCESS THE INDIVIDUAL MERCHANDISE ITEM OF A TRANSACTION.     *09488000
095200******************************************************************09489000
095300                                                                  09490000
095400 2200-PROCESS-MERCHANDISE.                                        09500000
JPGFX7                                                                  09501000
JPGFX7     IF AR001-SHIP-ADDR-ST > SPACES                               09502000
JPGFX7         PERFORM 2720-LOOKUP-STORE-INFO-BY-ST                     09503000
JPGFX7         MOVE TSTATE-ST-TX-RND-MTHD-CDE TO PV-SAVE-TX-RND-MTHD    09504000
JPGFX7     ELSE                                                         09505000
JPGFX7         PERFORM 2700-LOOKUP-STORE-INFO                           09506000
JPGFX7     END-IF.                                                      09507000
JPGFX7     IF AR001-ORD-NBR > SPACES                                    09508000
JPGFX7         MOVE ZERO TO PV-TRAN-TAX-RT-CTR                          09509000
JPGFX7         INITIALIZE PT-TAX-RATE-TABLE                             09510000
JPGFX7     END-IF.                                                      09520000
095500                                                                  09530000
095600     EVALUATE TRUE                                                09540000
095700         WHEN AR001-SALES-TAX-ITEM                                09541000
095800             PERFORM 2220-PROCESS-TAX                             09542000
071221         WHEN AR001-ADJ-ITEM                                      09543002
071221             PERFORM 2260-PROCESS-ADJ                             09544002
095900         WHEN AR001-TLCD-ITEM                                     09544100
096000             PERFORM 2230-PROCESS-TLCD                            09544200
096100**  GIFT CARDS WERE CHANGED TO A 981 DEPT BY PROGRAM ARKUT058 SO  09545000
096200**  THE GIFT CERTIFICATES AND GIFT CARDS WOULD GET SUMMARIZED     09546000
096300**  TOGETHER ON THE STATEMENT, EVEN THOUGH THIS 'WHEN' IS CHECKING09547000
096400**  FOR BOTH DEPARTMENTS.                                         09548000
096500         WHEN AR001-BOTH-GIFT-ITEM                                09549000
096600             IF (AR001-POS-RETURN OR                              09550000
096700                 AR001-MIXED-MODE-OR-PRICE-ADJ)                   09560000
096800                 MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT          09570000
096900                 MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT          09580000
097000                 MULTIPLY -1 BY AR001-EMPL-DISC-TRN-AMT           09590000
097100             END-IF                                               09600000
097200             PERFORM 2240-PROCESS-GIFT-CARD-PURCH                 09610000
097300         WHEN AR001-OTHER-TENDER                                  09620000
097400             PERFORM 2250-PROCESS-OTHER-TENDER                    09630000
097500         WHEN AR001-SCANNING-PENALTY-ITEM                         09640000
097600             PERFORM 2270-PROCESS-SCANNING-PENALTY                09650000
097700         WHEN AR001-SHIPPING-ITEM                                 09660000
097800             PERFORM 2280-PROCESS-SHIPPING-ITEM                   09670000
097900         WHEN AR001-GIFT-WRAP-ITEM                                09680000
098000             PERFORM 2290-PROCESS-GIFT-WRAP-ITEM                  09690000
CFEES          WHEN AR001-FEE-ITEM                                      09700000
CFEES              PERFORM 2295-PROCESS-FEE-ITEM                        09710000
098100         WHEN OTHER                                               09720000
098200             PERFORM 2210-PROCESS-REGULAR-MDSE-ITEM               09730000
098300     END-EVALUATE.                                                09740000
098400                                                                  09750000
098500******************************************************************09760000
098600*  PROCESS A REGULAR MERCHANDISE ITEM.                           *09770000
098700******************************************************************09780000
098800                                                                  09790000
098900 2210-PROCESS-REGULAR-MDSE-ITEM.                                  09800000
099000                                                                  09810000
099100*** SALES CHECK DETAIL ***                                        09820000
099200     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  09830000
JPGFX8     INITIALIZE AR020-M-MDSE-RECORD.                              09840000
099300     MOVE ZERO TO AR020-M-TAX-RATE.                               09850000
099400     MOVE ZERO TO AR020-M-NET-TAXABLE-AMT.                        09860000
099500     MOVE ZERO TO AR020-M-TAX-AMT.                                09870000
099600     MOVE ZERO TO PV-LINE-ITEM-TAX.                               09880000
099700     MOVE ZERO TO PV-LI-NET-TAXABLE-AMT.                          09890000
099800     SET AR020-M-RECORD-ID-MDSE TO TRUE.                          09900000
099900     MOVE PC-SCD-MDSE-LENGTH    TO AR020-M-LENGTH.                09910000
100000                                                                  09920000
100100     IF (AR001-POS-RETURN OR                                      09930000
100200         AR001-MIXED-MODE-OR-PRICE-ADJ)                           09940000
100300         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  09950000
100400         MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  09960000
100500         MULTIPLY -1 BY AR001-EMPL-DISC-TRN-AMT                   09970000
100600     END-IF.                                                      09980000
100700                                                                  09990000
100800     IF AR001-TRANSACTION-AMOUNT >= ZERO                          10000000
100900        IF AR001-TIER-MKDN                                        10010000
101000            SET AR020-M-TRANS-TIER TO TRUE                        10020000
101100            SET AR020-M-DEBIT      TO TRUE                        10030000
101200        ELSE                                                      10040000
101300            SET AR020-M-TRANS-SALE TO TRUE                        10050000
101400            SET AR020-M-DEBIT      TO TRUE                        10060000
101500        END-IF                                                    10070000
101600     ELSE                                                         10080000
101700         SET AR020-M-TRANS-RETURN TO TRUE                         10090000
101800         SET AR020-M-CREDIT       TO TRUE                         10100000
101900     END-IF.                                                      10110000
102000                                                                  10120000
102100     MOVE AR001-TRANSACTION-AMOUNT TO AR020-M-EXT-DOLLAR-AMT.     10130000
102200     MOVE AR001-LINE-NUMBER        TO PV-LINE-NUMBER.             10140000
102300     MOVE PV-LINE-NUMBER           TO AR020-M-LINE-NUMBER.        10150000
102400     PERFORM 2600-GET-DESCRIPTION.                                10160000
102500     MOVE PV-DESCRIPTION           TO AR020-M-DESCRIPTION.        10170000
102600     MOVE AR001-UNITS-SOLD         TO AR020-M-QUANTITY.           10180000
102700     MOVE AR001-ITEM-DEPARTMENT-CLASS                             10190000
102800                                   TO AR020-M-DEPT-CLASS-CODE.    10200000
102900     MOVE AR001-MERCHANDISE-ID     TO AR020-M-MDSE-ID.            10210000
103000     MOVE AR001-TAXABLE-IND        TO AR020-M-TAXABLE-IND.        10220000
103100     MOVE AR001-RET-AMT            TO AR020-M-RET-AMT.            10230000
103200     MOVE AR001-BOGO-PROMO-CDE     TO AR020-M-BOGO-PROMO-CDE.     10240000
           MOVE AR001-EMP-DISC-SRC-CDE   TO AR020-M-EMP-DISC-SRC-CDE.   10250000
103300                                                                  10260000
103400     EVALUATE TRUE                                                10270000
103500         WHEN AR001-NON-EMPLOYEE                                  10280000
103600         WHEN AR001-EMPL-DISC-TRN-AMT = ZERO                      10290000
103700         WHEN AR001-POS-RETURN AND AR001-GIFT-RCPT-CDE = 'Y'      10300000
103800         WHEN AR001-POS-CHARGE AND AR001-GIFT-RCPT-CDE = 'Y' AND  10310000
103900              AR001-TRN-STAT-CDE = 'R'                            10320000
104000             MOVE AR001-NET-CHARGED-AMOUNT TO                     10330000
104100                  PV-LI-NET-TAXABLE-AMT                           10340000
104200                  PV-LI-ORIG-N-TXBL-AMT                           10350000
104300                  AR020-M-NET-TAXABLE-AMT                         10360000
104400             SET PS-EMPLOYEE-DISC-NOT-CALC TO TRUE                10370000
104500         WHEN AR001-MIXED-MODE-OR-PRICE-ADJ AND                   10380000
104600              AR001-GIFT-RCPT-CDE = 'Y'     AND                   10390000
104700              AR001-NET-CHARGED-AMOUNT < 0                        10400000
104800             MOVE AR001-TRANSACTION-AMOUNT TO                     10410000
104900                  PV-LI-NET-TAXABLE-AMT                           10420000
105000                  PV-LI-ORIG-N-TXBL-AMT                           10430000
105100                  AR020-M-NET-TAXABLE-AMT                         10440000
105200             SET PS-EMPLOYEE-DISC-NOT-CALC TO TRUE                10450000
105300         WHEN OTHER                                               10460000
105400             PERFORM 2211-CALCULATE-EMPL-DISCOUNT                 10470000
105500             SET PS-EMPLOYEE-DISC-CALC TO TRUE                    10480000
105600     END-EVALUATE.                                                10490000
105700                                                                  10500000
105800*** CALCULATE SALES TAX PER LINE ITEM ***                         10510000
105900                                                                  10520000
CFEES *  AR001-EMP-DISC-SRC-CDE = 'S' WILL BE DELETED IN THE NEAR       10530000
CFEES *  FUTURE. SALES HUB WILL BE RE-CALCULATING TAX FOR ALL THE       10540000
CFEES *  TRANSACTIONS WHERE EMPLOYEE DISCOUNT IS BEING CALCULATED       10550000
CFEES *  IN SALES HUB. THERE WILL NOT BE AR001-EMP-DISC-SRC-CDE OF      10560000
CFEES *  'S' TRANSACTIONS COMING INTO COSA ANY LONGER, SO THE BELOW     10570000
CFEES *  CODE SHOULD NOT GET EXECUTED.                                  10580000
CFEES *                                                                 10590000
JPGFX6     IF AR001-EMP-DISC-SRC-CDE = 'S'                              10600000
JPGFX6         PERFORM 2225-COMPUTE-LINE-ITEM-TAX                       10601000
JPGFX6     ELSE                                                         10602000
JPGFX6         MOVE AR001-TAX-RATE-PCT TO AR020-M-TAX-RATE              10603000
JPGFX6         MOVE AR001-TAX-AMOUNT   TO AR020-M-TAX-AMT               10604000
JPGFX6                                    PV-LINE-ITEM-TAX              10605000
JPGFX6     END-IF.                                                      10606000
106100                                                                  10607000
106200     IF PS-EMPLOYEE-DISC-CALC                                     10608000
106300         ADD PV-LINE-ITEM-TAX TO PV-SAVE-TOTAL-TAX                10609000
106400     ELSE                                                         10609100
106500         ADD PV-LINE-ITEM-TAX TO PV-NON-DISC-TAX-AMT              10609200
106600     END-IF.                                                      10609300
106700                                                                  10609400
106800*** WRITE OUT SALES CHECK DETAIL RECORD ***                       10609500
106900     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       10609600
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      10609700
107000                                                                  10609800
107700                                                                  10609900
107800*** POSTING TOTAL ***                                             10610000
107900     ADD AR001-TRANSACTION-AMOUNT                                 10620000
108000                                TO PV-POSTING-TOTAL-AMT.          10630000
108100                                                                  10640000
108200*** EMPLOYEE DISCOUNT ***                                         10650000
108300* *  USING TRANSACTION AMOUNT, WHICH IS BEFORE TLD, BECAUSE THAT  10660000
108400* *  IS HOW EMPLOYEE DISCOUNT IS CALCULATED FOR A CASH PURCHASE   10670000
108500* *  AT THE REGISTER.                                             10680000
108600* *                                                               10690000
108700* *  CHANGED 6/20/2001 TO CALCULATE FROM THE NET-CHARGED-AMOUNT.  10700000
108800* *   EMPLOYEE DISCOUNT IS BEING TAKEN AFTER ALL OTHER DISCOUNTS. 10710000
108900* *                                                               10720000
109000                                                                  10730000
109100******************************************************************10740000
109200*  HANDLE TAX ADJUSTMENT FOR ASSOC DISCOUNT.                     *10750000
109300******************************************************************10760000
109400 2211-CALCULATE-EMPL-DISCOUNT.                                    10770000
109500                                                                  10780000
109600     MOVE AR001-EMP-DISC-AMT TO PV-EMPLOYEE-DISCOUNT.             10790000
109700                                                                  10800000
109800*   USING NET CHARGED AMOUNT HERE TO MAKE SURE THE MARKDOWN       10810000
109900*   CANCEL IS BACK IN THE TAXABLE AMOUNT                          10820000
110000                                                                  10830000
110100     MOVE AR001-NET-CHARGED-AMOUNT TO PV-LI-NET-TAXABLE-AMT.      10840000
110200                                                                  10850000
110300     MOVE PV-LI-NET-TAXABLE-AMT                                   10860000
110400          TO AR020-M-NET-TAXABLE-AMT.                             10870000
110500                                                                  10880000
110600     COMPUTE PV-LI-ORIG-N-TXBL-AMT = AR001-NET-CHARGED-AMOUNT     10890000
110700                                   + (AR001-EMP-DISC-AMT * -1).   10900000
110800                                                                  10910000
110900     COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED =                      10920000
111000             PV-TOTAL-DISCOUNT-AMT +                              10930000
111100             PV-EMPLOYEE-DISCOUNT                                 10940000
111200     END-COMPUTE                                                  10950000
111300                                                                  10960000
111400     ADD AR001-TRANSACTION-AMOUNT                                 10970000
111500                             TO PV-TOTAL-ORIGINAL-AMT             10980000
111600*** NON-DISCOUNTABLE TOTAL ***                                    10990000
111700     IF  AR001-EMP-DISC-AMT = ZERO                                11000000
111800         ADD AR001-TRANSACTION-AMOUNT                             11010000
111900                             TO PV-NON-DISC-TOTAL-AMT             11020000
112000     END-IF.                                                      11030000
112100******************************************************************11040000
112200*  PROCESS THE SALES TAX ITEM.                                   *11050000
112300*** EMPLOYEE DISCOUNT ***                                         11060000
112400*   EMPLOYEE DISCOUNT DOES NOT APPLY TO TAX                       11070000
112500******************************************************************11080000
112600                                                                  11090000
112700 2220-PROCESS-TAX.                                                11100000
112800                                                                  11110000
112900*** SALES CHECK DETAIL ***                                        11120000
113000     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  11130000
JPGFX8     INITIALIZE AR020-O-OTHER-RECORD.                             11140000
113100     MOVE ZEROES TO AR020-O-DISCOUNT-PERCENT.                     11150000
113200     SET AR020-O-RECORD-ID-OTHER TO TRUE.                         11160000
113300     MOVE PC-SCD-OTHER-LENGTH    TO AR020-O-LENGTH.               11170000
113400     SET AR020-O-TRANS-TAX       TO TRUE.                         11180000
113500     MOVE AR001-LINE-NUMBER      TO PV-LINE-NUMBER.               11190000
113600     MOVE PV-LINE-NUMBER         TO AR020-O-LINE-NUMBER.          11200000
113700     IF (AR001-POS-RETURN OR                                      11210000
113800         AR001-MIXED-MODE-OR-PRICE-ADJ)                           11220000
113900         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  11230000
114000     END-IF.                                                      11240000
114100     MOVE AR001-TRANSACTION-AMOUNT                                11250000
114200                                 TO AR020-O-EXT-DOLLAR-AMT.       11260000
114300     IF AR001-TRANSACTION-AMOUNT >= ZERO                          11270000
114400         SET AR020-O-DEBIT       TO TRUE                          11280000
114500     ELSE                                                         11290000
114600         SET AR020-O-CREDIT      TO TRUE                          11300000
114700     END-IF.                                                      11310000
114800     MOVE 'TAX'                  TO AR020-O-DESCRIPTION.          11320000
114900     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       11330000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      11340000
115000                                                                  11350000
115100*** POSTING TOTAL ***                                             11360000
115200     ADD AR001-TRANSACTION-AMOUNT                                 11370000
115300                                TO PV-POSTING-TOTAL-AMT.          11380000
115400                                                                  11390000
115500     IF PV-SAVE-EMPLOYEE                                          11400000
115600         ADD AR001-TRANSACTION-AMOUNT TO                          11410000
115700             PV-ORIGINAL-TAX-AMT                                  11420000
115800             PV-TOT-ORIG-TAX-AMT                                  11430000
115900     END-IF.                                                      11440000
116000                                                                  11450000
116100******************************************************************11460000
116200*  COMPUTE LINE ITEM SALES TAX AMOUNT WITH EMP DISC INCLUDED     *11470000
116300******************************************************************11480000
116400                                                                  11490000
116500 2225-COMPUTE-LINE-ITEM-TAX.                                      11500000
116600                                                                  11510000
116700**** DETERMINE THE TAX RATE TO USE FOR THIS ITEM                 *11520000
116800**** USE REGULAR TAX RATE UNLESS THERE IS A THRESHOLD AND        *11530000
116900**** NET TAXABLE AMOUNT FOR LINE ITEM IS UNDER THE THRESHOLD.    *11540000
117000     MOVE AR001-TAX-RATE-PCT TO PV-SAVE-TAX-RATE-PCT.             11550000
117100     IF AR001-TAX-THRESH-AMOUNT NOT = ZERO                        11560000
117200        IF AR020-M-NET-TAXABLE-AMT <                              11570000
117300           AR001-TAX-THRESH-AMOUNT                                11580000
117400           MOVE AR001-TAX-RATE-BELOW-THRESH TO                    11590000
117500                PV-SAVE-TAX-RATE-PCT                              11600000
117600        END-IF                                                    11610000
117700     END-IF.                                                      11620000
117800     MOVE PV-SAVE-TAX-RATE-PCT TO                                 11630000
117900          AR020-M-TAX-RATE.                                       11640000
118000                                                                  11650000
118100**** IF THE TAX RATE IS GREATER THAN ZERO, SEARCH THE TAX RATE    11660000
118200**** TABLE FOR THE TAX RATE.  IF THE RATE DOES NOT EXIST IN THE   11670000
118300**** TABLE, INSERT IT.                                            11680000
118400     IF PV-SAVE-TAX-RATE-PCT > ZERO                               11690000
118500         SET TR-INDEX TO 1                                        11700000
118600         SEARCH PT-TAX-RATES                                      11710000
118700            AT END                                                11720000
118800               MOVE 'N' TO PS-RATE-MATCH-SW                       11730000
118900            WHEN PT-TAX-RATE (TR-INDEX) = PV-SAVE-TAX-RATE-PCT    11740000
119000               ADD  PV-LI-NET-TAXABLE-AMT TO                      11750000
119100                    PT-TAXABLE-AMT-TOT (TR-INDEX)                 11760000
119200               PERFORM 2226-CALC-LI-TAX                           11770000
119300               MOVE 'Y' TO PS-RATE-MATCH-SW                       11780000
119400         END-SEARCH                                               11790000
119500                                                                  11800000
119600         IF PS-RATE-NOT-FOUND                                     11810000
119700             ADD 1 TO PV-TRAN-TAX-RT-CTR                          11820000
119800             IF PV-TRAN-TAX-RT-CTR > PC-MAX-TRAN-TAX-RATES        11830000
119900                 PERFORM 9200-TRAN-TAX-ERROR                      11840000
120000             ELSE                                                 11850000
120100                 SET TR-INDEX TO PV-TRAN-TAX-RT-CTR               11860000
120200                 MOVE PV-LI-NET-TAXABLE-AMT TO                    11870000
120300                      PT-TAXABLE-AMT-TOT (TR-INDEX)               11880000
120400                 MOVE PV-SAVE-TAX-RATE-PCT TO                     11890000
120500                      PT-TAX-RATE (TR-INDEX)                      11900000
120600                 PERFORM 2226-CALC-LI-TAX                         11910000
120700             END-IF                                               11920000
120800         END-IF                                                   11930000
120900     END-IF.                                                      11940000
121000                                                                  11950000
121100******************************************************************11960000
121200* 2226-CALC-LI-TAX                                                11970000
121300* A)CALCULATE THE TOTAL TAX FOR THE TAX RATE BY MULTIPLYING THE   11980000
121400*   TAX RATE BY THE TOTAL AMOUNT FOR THE TAX RATE.                11990000
121500* B)ROUND THE CALCULATION IN STEP A BASED ON THE ROUNDING METHOD  12000000
121600*   INDICATED FOR THE STATE.                                      12010000
121700*   - TAX ROUNDING METHOD 1 INDICATES TO ALWAYS ROUND UP.         12020000
121800*   - TAX ROUNDING METHOD 5 INDICATES STANDARD ROUNDING.          12030000
121900* C)DETERMINE THE TAX RATE FOR THE LINE ITEM BY SUBTRACTING THE   12040000
122000*   OLD TAX TOTAL FROM THE NEW TAX TOTAL.                         12050000
122100******************************************************************12060000
122200                                                                  12070000
122300 2226-CALC-LI-TAX.                                                12080000
122400                                                                  12090000
122500     IF PV-SAVE-TX-RND-MTHD = '1'                                 12100000
122600        COMPUTE PV-WORK-TAX-AMT =                                 12110000
122700                PT-TAXABLE-AMT-TOT (TR-INDEX) *                   12120000
122800                PV-SAVE-TAX-RATE-PCT                              12130000
122900        END-COMPUTE                                               12140000
123000        COMPUTE PV-TEMP-TAX-NUM =                                 12150000
123100                PT-TAXABLE-AMT-TOT (TR-INDEX) *                   12160000
123200                PV-SAVE-TAX-RATE-PCT *                            12170000
123300                1000                                              12180000
123400        END-COMPUTE                                               12190000
123500        MOVE PV-TEMP-TAX-NUM TO PV-TEMP-TAX-CHAR                  12200000
123600        IF PV-TEMP-TAX-CHAR (10:1) NOT = '0'                      12210000
123700           EVALUATE TRUE                                          12220000
123800              WHEN PV-WORK-TAX-AMT < 0                            12230000
123900                  SUBTRACT .01 FROM PV-WORK-TAX-AMT               12240000
124000              WHEN PV-WORK-TAX-AMT > 0                            12250000
124100                  ADD      .01 TO   PV-WORK-TAX-AMT               12260000
124200           END-EVALUATE                                           12270000
124300        END-IF                                                    12280000
124400     ELSE                                                         12290000
124500        COMPUTE PV-WORK-TAX-AMT ROUNDED =                         12300000
124600                PT-TAXABLE-AMT-TOT (TR-INDEX) *                   12310000
124700                PV-SAVE-TAX-RATE-PCT                              12320000
124800        END-COMPUTE                                               12330000
124900     END-IF.                                                      12340000
125000     COMPUTE PV-LINE-ITEM-TAX =                                   12350000
125100             PV-WORK-TAX-AMT -                                    12360000
125200             PT-TAX-AMT-TOT (TR-INDEX)                            12370000
125300     END-COMPUTE.                                                 12380000
125400     MOVE PV-WORK-TAX-AMT  TO PT-TAX-AMT-TOT (TR-INDEX).          12390000
125500     MOVE PV-LINE-ITEM-TAX TO AR020-M-TAX-AMT.                    12400000
125600                                                                  12410000
125700******************************************************************12420000
125800*  PROCESS A TRANSACTION LEVEL CASH DISCOUNT.                    *12430000
125900*  (THIS WOULD BE A KOHLS COUPON OR SENIOR CITIZEN DISCOUNT.)    *12440000
126000******************************************************************12450000
126100                                                                  12460000
126200 2230-PROCESS-TLCD.                                               12470000
126300                                                                  12480000
126400*** SALES CHECK DETAIL ***                                        12490000
126500     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  12500000
JPGFX8     INITIALIZE AR020-O-OTHER-RECORD.                             12510000
126600     SET AR020-O-RECORD-ID-OTHER TO TRUE.                         12520000
126700     MOVE PC-SCD-OTHER-LENGTH    TO AR020-O-LENGTH.               12530000
126800     SET AR020-O-TRANS-DISCOUNT  TO TRUE.                         12540000
126900     MOVE AR001-LINE-NUMBER      TO PV-LINE-NUMBER.               12550000
127000     MOVE PV-LINE-NUMBER         TO AR020-O-LINE-NUMBER.          12560000
127100     IF (AR001-POS-RETURN OR                                      12570000
127200         AR001-MIXED-MODE-OR-PRICE-ADJ)                           12580000
127300         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  12590000
127400     END-IF.                                                      12600000
127500     MOVE AR001-TRANSACTION-AMOUNT                                12610000
127600                                 TO AR020-O-EXT-DOLLAR-AMT.       12620000
127700     IF AR001-TRANSACTION-AMOUNT >= ZERO                          12630000
127800         SET AR020-O-DEBIT       TO TRUE                          12640000
127900     ELSE                                                         12650000
128000         SET AR020-O-CREDIT      TO TRUE                          12660000
128100     END-IF.                                                      12670000
128200     IF AR001-MERCHANDISE-ID = AR004-SENIOR-DISCOUNT-SKU          12680000
128300         MOVE 'SENIOR DISCOUNT'  TO AR020-O-DESCRIPTION           12690000
128400                                    PV-DESCRIPTION                12700000
128500     ELSE                                                         12710000
128600         PERFORM 2600-GET-DESCRIPTION                             12720000
128700         MOVE PV-DESCRIPTION     TO AR020-O-DESCRIPTION           12730000
128800     END-IF.                                                      12740000
128900                                                                  12750000
129000     IF AR001-PERCENT-OFF-TLD OR AR001-SENIOR-TLD                 12760000
129100        MOVE AR001-TLD-PCT TO AR020-O-DISCOUNT-PERCENT            12770000
129200     ELSE                                                         12780000
129300        MOVE ZERO TO AR020-O-DISCOUNT-PERCENT                     12790000
129400     END-IF.                                                      12800000
129500                                                                  12810000
129600     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       12820000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      12830000
129700                                                                  12840000
129800*** POSTING TOTAL ***                                             12850000
129900     ADD AR001-TRANSACTION-AMOUNT                                 12860000
130000                                TO PV-POSTING-TOTAL-AMT.          12870000
130100                                                                  12880000
130200     IF AR001-NON-EMPLOYEE                                        12890000
130300         CONTINUE                                                 12900000
130400     ELSE                                                         12910000
130500         ADD AR001-TRANSACTION-AMOUNT                             12920000
130600                                 TO PV-TOTAL-COUPON-AMT           12930000
130700     END-IF.                                                      12940000
130800                                                                  12950000
130900*** EMPLOYEE DISCOUNT ***                                         12960000
131000*   EMPLOYEE DISCOUNT DOES NOT APPLY TO COUPONS                   12970000
131100******************************************************************12980000
131200*  PROCESS THE PURCHASE OF A GIFT CARD.                          *12990000
131300******************************************************************13000000
131400                                                                  13010000
131500 2240-PROCESS-GIFT-CARD-PURCH.                                    13020000
131600                                                                  13030000
131700     MOVE ZERO TO PV-LINE-ITEM-TAX.                               13040000
131800                                                                  13050000
131900*** SALES CHECK DETAIL ***                                        13060000
132000     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  13070000
JPGFX8     INITIALIZE AR020-M-MDSE-RECORD.                              13080000
132100     SET AR020-M-RECORD-ID-MDSE TO TRUE.                          13090000
132200     MOVE PC-SCD-MDSE-LENGTH    TO AR020-M-LENGTH.                13100000
132300                                                                  13110000
132400     IF AR001-TRANSACTION-AMOUNT >= ZERO                          13120000
132500         SET AR020-M-TRANS-SALE TO TRUE                           13130000
132600         SET AR020-M-DEBIT      TO TRUE                           13140000
132700     ELSE                                                         13150000
132800         SET AR020-M-TRANS-RETURN TO TRUE                         13160000
132900         SET AR020-M-CREDIT     TO TRUE                           13170000
133000     END-IF.                                                      13180000
133100     MOVE AR001-TRANSACTION-AMOUNT                                13190000
133200                                TO AR020-M-EXT-DOLLAR-AMT.        13200000
133300     MOVE AR001-LINE-NUMBER     TO PV-LINE-NUMBER.                13210000
133400     MOVE PV-LINE-NUMBER        TO AR020-M-LINE-NUMBER.           13220000
133500     MOVE 'GIFT CARD'           TO AR020-M-DESCRIPTION            13230000
133600                                   PV-DESCRIPTION.                13240000
133700     MOVE AR001-UNITS-SOLD      TO AR020-M-QUANTITY.              13250000
133800     MOVE AR001-ITEM-DEPARTMENT-CLASS                             13260000
133900                                TO AR020-M-DEPT-CLASS-CODE.       13270000
134000     MOVE AR001-MERCHANDISE-ID TO AR020-M-MDSE-ID.                13280000
134100     MOVE AR001-TAXABLE-IND     TO AR020-M-TAXABLE-IND.           13290000
134200     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       13300000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      13310000
134300                                                                  13320000
134400*** POSTING TOTAL ***                                             13330000
134500     ADD AR001-TRANSACTION-AMOUNT                                 13340000
134600                                TO PV-POSTING-TOTAL-AMT.          13350000
134700                                                                  13360000
134800*** EMPLOYEE DISCOUNT ***                                         13370000
134900* *  GIFT CARDS/CERTIFICATES ARE NOT ELIGIBLE FOR EMPLOYEE        13380000
135000* *  DISCOUNT.  THE DEPT/CLASS FILE WILL CAUSE THE RATE TO        13390000
135100* *  BE ZERO.  ADDED THIS COMMENT 3/19/2001 SO THE NEXT PERSON    13400000
135200* *  TO LOOK AT THIS WON'T BE AS CONFUSED AS I WAS.               13410000
135300* *                                                               13420000
135400* *  CHANGED CALCULATION 6/20/2001 TO CALCULATE FROM THE NET-     13430000
135500* *   CHARGED AMOUNT SO THAT EMPLOYEE DISCOUNT IS TAKEN AFTER     13440000
135600* *   ALL OTHER DISCOUNTS HAVE BEEN APPLIED.                      13450000
135700* *                                                               13460000
135800* *  DO NOT PROCESS EMPLOYEE DISCOUNT FOR TENDER RECORDS.         13470000
135900* *                                                               13480000
136000     IF AR001-NON-EMPLOYEE OR AR001-TNDR-TYP-CDE > SPACES         13490000
136100         CONTINUE                                                 13500000
136200     ELSE                                                         13510000
136300         MOVE AR001-EMP-DISC-AMT TO PV-EMPLOYEE-DISCOUNT          13520000
136400                                                                  13530000
136500         COMPUTE PV-TOTAL-DISCOUNT-AMT ROUNDED =                  13540000
136600                 PV-TOTAL-DISCOUNT-AMT +                          13550000
136700                 PV-EMPLOYEE-DISCOUNT                             13560000
136800                                                                  13570000
136900         ADD AR001-TRANSACTION-AMOUNT                             13580000
137000                                 TO PV-TOTAL-ORIGINAL-AMT         13590000
137100*** NON-DISCOUNTABLE TOTAL ***                                    13600000
137200         IF  PV-EMPLOYEE-DISCOUNT = 0                             13610000
137300             ADD AR001-TRANSACTION-AMOUNT                         13620000
137400                                 TO PV-NON-DISC-TOTAL-AMT         13630000
137500         END-IF                                                   13640000
138300     END-IF.                                                      13650000
138400                                                                  13660000
138500******************************************************************13670000
138600*  PROCESS THE REDEMPTION OF A GIFT CERTIFICATE.                 *13680000
138700******************************************************************13690000
138800                                                                  13700000
138900 2250-PROCESS-OTHER-TENDER.                                       13710000
139000                                                                  13720000
139100*** SALES CHECK DETAIL ***                                        13730000
139200     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  13740000
JPGFX8     INITIALIZE AR020-T-TENDER-RECORD.                            13750000
139300     SET AR020-T-RECORD-ID-TENDER                                 13760000
139400                                 TO TRUE.                         13770000
139500     MOVE PC-SCD-TENDER-LENGTH   TO AR020-T-LENGTH.               13780000
139600     SET AR020-T-TRANS-OTHER-TENDER                               13790000
139700                                 TO TRUE.                         13800000
139800     MOVE AR001-LINE-NUMBER      TO PV-LINE-NUMBER.               13810000
139900     MOVE PV-LINE-NUMBER         TO AR020-T-LINE-NUMBER.          13820000
140000                                                                  13830000
140100     IF (AR001-POS-RETURN OR                                      13840000
140200         AR001-MIXED-MODE-OR-PRICE-ADJ)                           13850000
140300         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  13860000
140400     END-IF.                                                      13870000
140500                                                                  13880000
140600     MOVE AR001-TRANSACTION-AMOUNT                                13890000
140700                                 TO AR020-T-EXT-DOLLAR-AMT.       13900000
140800     IF AR001-TRANSACTION-AMOUNT >= ZERO                          13910000
140900         SET AR020-T-DEBIT       TO TRUE                          13920000
141000     ELSE                                                         13930000
141100         SET AR020-T-CREDIT      TO TRUE                          13940000
141200     END-IF.                                                      13950000
141300                                                                  13960000
141400     EVALUATE AR001-TNDR-TYP-CDE                                  13970000
141500         WHEN '00'                                                13980000
141600             MOVE 'CASH             ' TO AR020-T-DESCRIPTION      13990000
141700         WHEN '01'                                                14000000
141800             MOVE 'CHECK            ' TO AR020-T-DESCRIPTION      14010000
141900         WHEN '02'                                                14020000
142000             MOVE 'MDSE RETURN CREDT' TO AR020-T-DESCRIPTION      14030000
142100         WHEN '04'                                                14040000
142200             MOVE 'KOHLS CHARGE     ' TO AR020-T-DESCRIPTION      14050000
142300         WHEN '05'                                                14060000
142400             MOVE 'VISA             ' TO AR020-T-DESCRIPTION      14070000
142500         WHEN '06'                                                14080000
142600             MOVE 'MASTER CARD      ' TO AR020-T-DESCRIPTION      14090000
142700         WHEN '07'                                                14100000
142800             MOVE 'DISCOVER         ' TO AR020-T-DESCRIPTION      14110000
142900         WHEN '08'                                                14120000
143000             MOVE 'AMERICAN EXPRESS ' TO AR020-T-DESCRIPTION      14130000
143100         WHEN '09'                                                14140000
143200             MOVE 'CORPORATE REFUND ' TO AR020-T-DESCRIPTION      14150000
143300         WHEN '10'                                                14160000
143400             MOVE 'TRAVELERS CHECK  ' TO AR020-T-DESCRIPTION      14170000
143500         WHEN '11'                                                14180000
143600             MOVE 'FOREIGN CURRENCY ' TO AR020-T-DESCRIPTION      14190000
143700         WHEN '12'                                                14200000
143800             MOVE 'VENDOR CHECK     ' TO AR020-T-DESCRIPTION      14210000
143900         WHEN '13'                                                14220000
144000             MOVE AR001-MERCHANDISE-ID                            14230000
144100                                     TO AR020-T-NUMBER-IDENTIFIER 14240000
144200             MOVE 'GIFT CARD'        TO AR020-T-DESCRIPTION       14250000
144300         WHEN '14'                                                14260000
144400             MOVE 'MALL GIFT CERT   ' TO AR020-T-DESCRIPTION      14270000
144500         WHEN '15'                                                14280000
144600             MOVE 'CASHIER CHECK    ' TO AR020-T-DESCRIPTION      14290000
144700         WHEN '19'                                                14300000
144800             MOVE 'DEBIT CARD       ' TO AR020-T-DESCRIPTION      14310000
144900         WHEN '90'                                                14320000
145000             MOVE 'PURCHASE ORDER   ' TO AR020-T-DESCRIPTION      14330000
145100         WHEN OTHER                                               14340000
145200             MOVE 'OTHER'            TO AR020-T-DESCRIPTION       14350000
145300     END-EVALUATE.                                                14360000
145400                                                                  14370000
145500     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       14380000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      14390000
145600                                                                  14400000
145700*** POSTING TOTAL ***                                             14410000
145800     ADD AR001-TRANSACTION-AMOUNT                                 14420000
145900                                TO PV-POSTING-TOTAL-AMT.          14430000
146000                                                                  14440000
146100*** EMPLOYEE DISCOUNT ***                                         14450000
146200*   OTHER TENDERS DO NOT AFFECT EMPLOYEE                          14460000
146300*   DISCOUNT CALCULATION.                                         14470000
071221******************************************************************14471002
071221*  PROCESS AN ARK OOB CREDIT ADJUSTMENT.                         *14472002
071221*  THIS ENTRY INDICATES A DIFFERENCE WAS FOUND BETWEEN THE       *14473002
071221*  REPORTED KOHL'S CHARGE TENDER TOTAL AND THE SUMMATION OF THE  *14473102
071221*  DETAILS OF THE TRANSACTION.  TYPICALLY THIS IMBALANCE IS      *14473202
071221*  CAUSED BY THE FAILURE TO DATA COLLECT A TLD FOR A DISCOUNT    *14473302
071221*  THAT HAS BEEN PRORATED TO THE ITEM LEVEL OR JUST FAILED TO    *14473402
071221*  BE DATA COLLECTED ALL TOGETHER OFTEN ON PSA'S OR RETURNS.     *14473502
071221*  ARK OOB'S SHOW UP ON THE ARK01020 REPORT AND THE ADJUSTMENT   *14473602
071221*  RECORD IS INSERTED INTO THE FILE IN ARKUT059.                 *14473702
071221******************************************************************14474002
071221                                                                  14475002
071221 2260-PROCESS-ADJ.                                                14476002
071221                                                                  14477002
071221*** SALES CHECK DETAIL ***                                        14478002
071221     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  14479002
071221     INITIALIZE AR020-O-OTHER-RECORD.                             14479102
071221     SET AR020-O-RECORD-ID-OTHER TO TRUE.                         14479202
071221     MOVE PC-SCD-OTHER-LENGTH    TO AR020-O-LENGTH.               14479302
071221     SET AR020-O-TRANS-DISCOUNT  TO TRUE.                         14479402
071221     MOVE AR001-LINE-NUMBER      TO PV-LINE-NUMBER.               14479502
071221     MOVE PV-LINE-NUMBER         TO AR020-O-LINE-NUMBER.          14479602
071221     IF (AR001-POS-RETURN OR                                      14479702
071221         AR001-MIXED-MODE-OR-PRICE-ADJ)                           14479802
071221         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  14479902
071221     END-IF.                                                      14480002
071221     MOVE AR001-TRANSACTION-AMOUNT                                14480102
071221                                 TO AR020-O-EXT-DOLLAR-AMT.       14480202
071221     IF AR001-TRANSACTION-AMOUNT >= ZERO                          14480302
071221         SET AR020-O-DEBIT       TO TRUE                          14480402
071221     ELSE                                                         14480502
071221         SET AR020-O-CREDIT      TO TRUE                          14480602
071221     END-IF.                                                      14480702
071221* THE BELOW DESCRIPTION WILL SHOW IN SOLUTION BUILDER             14480802
071221     MOVE 'RCPT TO STMT SYS ADJ' TO AR020-O-DESCRIPTION           14480902
071221                                    PV-DESCRIPTION.               14481102
071221     MOVE ZERO                   TO AR020-O-DISCOUNT-PERCENT.     14482002
071221                                                                  14482202
071221     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       14482302
071221     PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      14482402
071221                                                                  14482502
071221*** POSTING TOTAL ***                                             14482602
071221     ADD AR001-TRANSACTION-AMOUNT                                 14482702
071221                                TO PV-POSTING-TOTAL-AMT.          14482802
071221                                                                  14482902
071221     IF AR001-NON-EMPLOYEE                                        14483002
071221         CONTINUE                                                 14483102
071221     ELSE                                                         14483202
071221         ADD AR001-TRANSACTION-AMOUNT                             14483302
071221                                 TO PV-TOTAL-COUPON-AMT           14483402
071221     END-IF.                                                      14483502
071221                                                                  14483602
146500******************************************************************14490000
146600*  PROCESS A SCANNING PENALTY ITEM.                              *14500000
146700******************************************************************14510000
146800                                                                  14520000
146900 2270-PROCESS-SCANNING-PENALTY.                                   14530000
147000                                                                  14540000
147100*** SALES CHECK DETAIL ***                                        14550000
147200     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  14560000
JPGFX8     INITIALIZE AR020-O-OTHER-RECORD.                             14570000
147300     SET AR020-O-RECORD-ID-OTHER TO TRUE.                         14580000
147400     MOVE PC-SCD-OTHER-LENGTH    TO AR020-O-LENGTH.               14590000
147500     SET AR020-O-TRANS-DISCOUNT  TO TRUE.                         14600000
147600     MOVE AR001-LINE-NUMBER      TO PV-LINE-NUMBER.               14610000
147700     MOVE PV-LINE-NUMBER         TO AR020-O-LINE-NUMBER.          14620000
147800     IF (AR001-POS-RETURN OR                                      14630000
147900         AR001-MIXED-MODE-OR-PRICE-ADJ)                           14640000
148000         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  14650000
148100     END-IF.                                                      14660000
148200     MOVE AR001-TRANSACTION-AMOUNT                                14670000
148300                                 TO AR020-O-EXT-DOLLAR-AMT.       14680000
148400     IF AR001-TRANSACTION-AMOUNT >= ZERO                          14690000
148500         SET AR020-O-DEBIT       TO TRUE                          14700000
148600     ELSE                                                         14710000
148700         SET AR020-O-CREDIT      TO TRUE                          14720000
148800     END-IF.                                                      14730000
148900     PERFORM 2600-GET-DESCRIPTION.                                14740000
149000     MOVE PV-DESCRIPTION         TO AR020-O-DESCRIPTION.          14750000
149100                                                                  14760000
149200     IF AR001-PERCENT-OFF-TLD OR AR001-SENIOR-TLD                 14770000
149300        MOVE AR001-TLD-PCT TO AR020-O-DISCOUNT-PERCENT            14780000
149400     ELSE                                                         14790000
149500        MOVE ZERO TO AR020-O-DISCOUNT-PERCENT                     14800000
149600     END-IF.                                                      14810000
149700                                                                  14820000
149800     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       14830000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      14840000
149900                                                                  14850000
150000*** POSTING TOTAL ***                                             14860000
150100     ADD AR001-TRANSACTION-AMOUNT                                 14870000
150200                                TO PV-POSTING-TOTAL-AMT.          14880000
150300                                                                  14890000
150400*** EMPLOYEE DISCOUNT ***                                         14900000
150500*   SCANNING PENALTY DISCOUNTS DO NOT AFFECT EMPLOYEE DISCOUNT    14910000
150600*   CALCULATION. THE DEPARTMENT IS NON-DISCOUNTABLE.              14920000
150700                                                                  14930000
150800******************************************************************14940000
150900*  PROCESS A SHIPPING ITEM.                                      *14950000
151000******************************************************************14960000
151100 2280-PROCESS-SHIPPING-ITEM.                                      14970000
151200                                                                  14980000
151300*** SALES CHECK DETAIL ***                                        14990000
151400     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  15000000
JPGFX8     INITIALIZE AR020-O-OTHER-RECORD.                             15010000
151500     SET AR020-O-RECORD-ID-OTHER    TO TRUE.                      15020000
151600     MOVE PC-SCD-OTHER-LENGTH       TO AR020-O-LENGTH.            15030000
151700     SET AR020-O-TRANS-SHIP-AMOUNT  TO TRUE.                      15040000
151800     MOVE AR001-LINE-NUMBER         TO PV-LINE-NUMBER.            15050000
151900     MOVE PV-LINE-NUMBER            TO AR020-O-LINE-NUMBER.       15060000
152000     IF  AR001-POS-RETURN OR AR001-MIXED-MODE-OR-PRICE-ADJ        15070000
152100         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  15080000
152200         MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  15090000
152300     END-IF.                                                      15100000
152400     MOVE AR001-TRANSACTION-AMOUNT                                15110000
152500                                    TO AR020-O-EXT-DOLLAR-AMT.    15120000
152600     IF AR001-TRANSACTION-AMOUNT >= ZERO                          15130000
152700         SET AR020-O-DEBIT          TO TRUE                       15140000
152800     ELSE                                                         15150000
152900         SET AR020-O-CREDIT         TO TRUE                       15160000
153000     END-IF.                                                      15170000
153100     PERFORM 2600-GET-DESCRIPTION.                                15180000
153200     MOVE PV-DESCRIPTION            TO AR020-O-DESCRIPTION.       15190000
153300                                                                  15200000
153400     MOVE ZERO TO AR020-O-DISCOUNT-PERCENT                        15210000
153500                                                                  15220000
153600     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       15230000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      15240000
153700                                                                  15250000
153800*** POSTING TOTAL ***                                             15260000
153900     ADD AR001-TRANSACTION-AMOUNT                                 15270000
154000                                TO PV-POSTING-TOTAL-AMT.          15280000
154100     ADD AR001-TRANSACTION-AMOUNT                                 15290000
154200                                TO PV-NON-DISC-TOTAL-AMT.         15300000
154300                                                                  15310000
154400     ADD AR001-TAX-AMOUNT       TO PV-NON-DISC-TAX-AMT.           15320000
154500                                                                  15330000
154600     IF AR001-NON-EMPLOYEE                                        15340000
154700         CONTINUE                                                 15350000
154800     ELSE                                                         15360000
154900*** WRITE OUT THE TAX AUDIT FILE ***                              15370000
155000         MOVE AR001-TAX-AMOUNT          TO PV-LINE-ITEM-TAX       15380000
155100         MOVE AR001-NET-CHARGED-AMOUNT TO PV-LI-NET-TAXABLE-AMT   15390000
155200                                           PV-LI-ORIG-N-TXBL-AMT  15400000
155300         MOVE ZERO                      TO PV-EMPLOYEE-DISCOUNT   15410000
155400     END-IF.                                                      15420000
155500                                                                  15430000
155600*** EMPLOYEE DISCOUNT ***                                         15440000
155700*   EMPLOYEE DISCOUNT DOES NOT APPLY TO SHIPPING                  15450000
150700                                                                  15460000
155800******************************************************************15470000
155900*  PROCESS A GIFT WRAP ITEM.                                     *15480000
156000******************************************************************15490000
156100 2290-PROCESS-GIFT-WRAP-ITEM.                                     15500000
156200                                                                  15510000
156300*** SALES CHECK DETAIL ***                                        15520000
156400     MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  15530000
JPGFX8     INITIALIZE AR020-O-OTHER-RECORD.                             15540000
156500     SET AR020-O-RECORD-ID-OTHER TO TRUE.                         15550000
156600     MOVE PC-SCD-OTHER-LENGTH    TO AR020-O-LENGTH.               15560000
156700     SET AR020-O-TRANS-GIFT-WRAP TO TRUE.                         15570000
156800     MOVE AR001-LINE-NUMBER      TO PV-LINE-NUMBER.               15580000
156900     MOVE PV-LINE-NUMBER         TO AR020-O-LINE-NUMBER.          15590000
157000     IF  AR001-POS-RETURN OR AR001-MIXED-MODE-OR-PRICE-ADJ        15600000
157100         MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  15610000
157200         MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  15620000
157300     END-IF.                                                      15630000
157400     MOVE AR001-TRANSACTION-AMOUNT                                15640000
157500                                 TO AR020-O-EXT-DOLLAR-AMT.       15650000
157600     IF AR001-TRANSACTION-AMOUNT >= ZERO                          15660000
157700         SET AR020-O-DEBIT       TO TRUE                          15670000
157800     ELSE                                                         15680000
157900         SET AR020-O-CREDIT      TO TRUE                          15690000
158000     END-IF.                                                      15700000
158100     PERFORM 2600-GET-DESCRIPTION.                                15710000
158200     MOVE PV-DESCRIPTION         TO AR020-O-DESCRIPTION.          15720000
158300                                                                  15730000
158400     MOVE ZERO TO AR020-O-DISCOUNT-PERCENT                        15740000
158500                                                                  15750000
158600     PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       15760000
P9696      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      15770000
158700                                                                  15780000
158800*** POSTING TOTAL ***                                             15790000
158900     ADD AR001-TRANSACTION-AMOUNT                                 15800000
159000                                TO PV-POSTING-TOTAL-AMT.          15810000
159100     ADD AR001-TRANSACTION-AMOUNT                                 15820000
159200                                TO PV-NON-DISC-TOTAL-AMT.         15830000
159300                                                                  15840000
159400     ADD AR001-TAX-AMOUNT       TO PV-NON-DISC-TAX-AMT.           15850000
159500                                                                  15860000
159600     IF AR001-NON-EMPLOYEE                                        15870000
159700         CONTINUE                                                 15880000
159800     ELSE                                                         15890000
159900*** WRITE OUT THE TAX AUDIT FILE ***                              15900000
160000         MOVE AR001-TAX-AMOUNT          TO PV-LINE-ITEM-TAX       15910000
160100         MOVE AR001-NET-CHARGED-AMOUNT TO PV-LI-NET-TAXABLE-AMT   15920000
160200                                           PV-LI-ORIG-N-TXBL-AMT  15930000
160300         MOVE ZERO                      TO PV-EMPLOYEE-DISCOUNT   15940000
160400     END-IF.                                                      15950000
160500                                                                  15960000
160600*** EMPLOYEE DISCOUNT ***                                         15970000
160700*   EMPLOYEE DISCOUNT DOES NOT APPLY TO GIFT WRAP                 15980000
160500                                                                  15990000
CFEES ******************************************************************16000000
CFEES *  PROCESS A FEE ITEM                                            *16010000
CFEES ******************************************************************16020000
CFEES  2295-PROCESS-FEE-ITEM.                                           16030000
CFEES                                                                   16040000
CFEES *** SALES CHECK DETAIL ***                                        16050000
CFEES      MOVE SPACES TO AR020-AR-SALES-CHECK-DETAIL.                  16060000
CFEES      INITIALIZE AR020-O-OTHER-RECORD.                             16070000
CFEES      SET AR020-O-RECORD-ID-OTHER    TO TRUE.                      16071000
CFEES      MOVE PC-SCD-OTHER-LENGTH       TO AR020-O-LENGTH.            16072000
CFEES      SET AR020-O-TRANS-FEE-AMOUNT   TO TRUE.                      16073000
CFEES      MOVE AR001-LINE-NUMBER         TO PV-LINE-NUMBER.            16074000
CFEES      MOVE PV-LINE-NUMBER            TO AR020-O-LINE-NUMBER.       16075000
CFEES      IF  AR001-POS-RETURN OR AR001-MIXED-MODE-OR-PRICE-ADJ        16076000
CFEES          MULTIPLY -1 BY AR001-TRANSACTION-AMOUNT                  16077000
CFEES          MULTIPLY -1 BY AR001-NET-CHARGED-AMOUNT                  16078000
CFEES      END-IF.                                                      16079000
CFEES      MOVE AR001-TRANSACTION-AMOUNT                                16079100
CFEES                                     TO AR020-O-EXT-DOLLAR-AMT.    16079200
CFEES      IF AR001-TRANSACTION-AMOUNT >= ZERO                          16079300
CFEES          SET AR020-O-DEBIT          TO TRUE                       16079400
CFEES      ELSE                                                         16079500
CFEES          SET AR020-O-CREDIT         TO TRUE                       16079600
CFEES      END-IF.                                                      16079700
CFEES                                                                   16079800
CFEES      MOVE AR001-FEE-DESC            TO AR020-O-DESCRIPTION.       16079900
CFEES                                                                   16080000
CFEES      MOVE ZERO TO AR020-O-DISCOUNT-PERCENT                        16080100
CFEES                                                                   16080200
CFEES      PERFORM 7300-WRITE-SALES-CHECK-DETAIL.                       16080300
CFEES      PERFORM 7400-WRITE-AJB-SLS-CHCK-DETAIL.                      16080400
CFEES                                                                   16080500
CFEES *** POSTING TOTAL ***                                             16080600
CFEES      ADD AR001-TRANSACTION-AMOUNT                                 16080700
CFEES                                 TO PV-POSTING-TOTAL-AMT.          16080800
CFEES      ADD AR001-TRANSACTION-AMOUNT                                 16080900
CFEES                                 TO PV-NON-DISC-TOTAL-AMT.         16081000
CFEES                                                                   16081100
CFEES      ADD AR001-TAX-AMOUNT       TO PV-NON-DISC-TAX-AMT.           16081200
CFEES                                                                   16081300
CFEES      IF AR001-NON-EMPLOYEE                                        16081400
CFEES          CONTINUE                                                 16081500
CFEES      ELSE                                                         16081600
CFEES *** WRITE OUT THE TAX AUDIT FILE ***                              16081700
CFEES          MOVE AR001-TAX-AMOUNT          TO PV-LINE-ITEM-TAX       16081800
CFEES          MOVE AR001-NET-CHARGED-AMOUNT TO PV-LI-NET-TAXABLE-AMT   16081900
CFEES                                            PV-LI-ORIG-N-TXBL-AMT  16082000
CFEES          MOVE ZERO                      TO PV-EMPLOYEE-DISCOUNT   16082100
CFEES      END-IF.                                                      16082200
CFEES *** EMPLOYEE DISCOUNT ***                                         16082300
CFEES *   EMPLOYEE DISCOUNT DOES NOT APPLY TO FEES                      16082400
CFEES                                                                   16082500
160800******************************************************************16082600
160900*  CREATE A POSTING FILE RECORD FOR A TRANSACTION THAT HAS NO    *16082700
161000*  MERCHANDISE DETAIL.                                           *16082800
161100******************************************************************16082900
161200                                                                  16083000
161300 2300-PROCESS-POSTING-ONLY.                                       16083100
161400                                                                  16083400
161500     MOVE SPACES                  TO AR021-AR-POSTING-RECORD.     16083500
161600     SET ES-INDEX TO 1.                                           16083600
161700     SEARCH PT-ECOMM-STORES                                       16083700
161800       AT END                                                     16083800
161900         MOVE AR001-STORE-NUMBER  TO PV-STORE-NUMBER              16083900
162000       WHEN PT-ECOMM-STORE (ES-INDEX) = AR001-STORE-NUMBER        16084000
162100         MOVE 0873                TO PV-STORE-NUMBER              16084100
162200       WHEN PT-ECOMM-STORE (ES-INDEX) = ZEROES                    16084200
162300         MOVE AR001-STORE-NUMBER  TO PV-STORE-NUMBER              16085000
162400     END-SEARCH.                                                  16086000
162500     MOVE PV-STORE-NUMBER         TO AR021-MERCHANT-ID.           16087000
162600     IF AR001-POS-TRANSACTION                                     16088000
162700         SET AR021-SS-ORIG-TRANS  TO TRUE                         16089000
162800     ELSE                                                         16090000
162900         SET AR021-SS-ORIG-TRANS-REVERSAL                         16100000
163000                                  TO TRUE                         16110000
163100     END-IF.                                                      16120000
163200     MOVE ZERO                    TO AR021-DEPT-ID.               16130000
163300     MOVE AR001-TERMINAL-NUMBER   TO PV-TERM-NUMBER.              16140000
163400     MOVE PV-TERM-NUMBER          TO AR021-POS-ID.                16150000
163500     MOVE AR001-TRN-DTE(1:2)      TO PV-TRANS-MM.                 16160000
163600     MOVE AR001-TRN-DTE(3:2)      TO PV-TRANS-DD.                 16170000
163700     MOVE AR001-TRN-DTE(5:2)      TO PV-TRANS-YY.                 16180000
163800     IF PV-TRANS-YY < 80                                          16190000
163900         MOVE 20                  TO PV-TRANS-CC                  16200000
164000     ELSE                                                         16210000
164100         MOVE 19                  TO PV-TRANS-CC                  16220000
164200     END-IF.                                                      16230000
164300     MOVE PV-TRANS-DATE           TO AR021-ENTRY-DATE.            16240000
164400     MOVE AR001-TRANSACTION-NUMBER                                16250000
164500                                  TO PV-TRANS-NUMBER.             16260000
164600     MOVE ZERO                    TO AR021-REF-SEQ.               16270000
164700     MOVE PV-TRANS-NUMBER         TO AR021-REF-NO.                16280000
164800     MOVE AR001-TRANSACTION-TIME TO AR021-TIME.                   16290000
P1043      MOVE AR001-BIN-NUMBER       TO AR021-BIN-NUMBER.             16300000
164900                                                                  16310000
165000     EVALUATE TRUE                                                16320000
165100         WHEN AR001-PAYMENT                                       16330000
165200             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   16340000
165300                                  TO AR021-CARD-NO                16350000
165400             MOVE AR001-ACCOUNT-NUMBER-11-12                      16360000
165500                                  TO AR021-CARD-LEVEL-OF-ISSUE    16370000
165600             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   16380000
165700                                  TO AR021-ACCOUNT-NUMBER         16390000
165800             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      16400000
165900                                  TO AR021-ACCOUNT-TYPE           16410000
166000                                                                  16420000
166100         WHEN AR001-ACCOUNT-NUMBER-11-12 NUMERIC                  16430000
166200            AND AR001-POS-TRANSACTION                             16440000
166300             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   16450000
166400                                  TO AR021-CARD-ACCOUNT           16460000
166500                                     AR021-ACCOUNT-NUMBER         16470000
166600             MOVE AR001-ACCOUNT-NUMBER-11-12                      16480000
166700                                  TO AR021-CARD-LEVEL-OF-ISSUE    16490000
166800             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      16500000
166900                                  TO AR021-ACCOUNT-TYPE           16510000
167000                                                                  16520000
167100         WHEN AR001-ACCOUNT-NUMBER-11-12 NUMERIC                  16530000
167200             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   16540000
167300                                  TO AR021-CARD-ACCOUNT           16550000
167400                                     AR021-ACCOUNT-NUMBER         16560000
167500             MOVE AR001-ACCOUNT-NUMBER-11-12                      16570000
167600                                  TO AR021-CARD-LEVEL-OF-ISSUE    16580000
167700             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      16590000
167800                                  TO AR021-ACCOUNT-TYPE           16600000
167900                                                                  16610000
168000         WHEN OTHER                                               16620000
168100             MOVE ZEROS           TO AR021-CARD-NO                16630000
168200             MOVE AR001-ACCOUNT-NUMBER-10-DIGIT                   16640000
168300                                  TO AR021-ACCOUNT-NUMBER         16650000
168400             MOVE AR004-DEFAULT-ACCOUNT-TYPE                      16660000
168500                                  TO AR021-ACCOUNT-TYPE           16670000
168600                                                                  16680000
168700     END-EVALUATE.                                                16690000
168800                                                                  16700000
168900     MOVE AR004-ISSUER            TO AR021-ISSUER.                16710000
169000     MOVE AR004-CARD-AGREEMENT    TO AR021-CARD-AGREEMENT.        16720000
169100     MOVE AR001-AUTH-NUMBER       TO AR021-AUTH-CODE.             16730000
169200     IF AR001-REFERRAL-TYPE IS NUMERIC                            16740000
169300         MOVE AR001-REFERRAL-TYPE                                 16750000
169400                                  TO AR021-REFERRAL-TYPE          16760000
169500     ELSE                                                         16770000
169600         MOVE ZERO                TO AR021-REFERRAL-TYPE          16780000
169700     END-IF.                                                      16790000
169800     MOVE AR001-ORD-NBR TO AR021-ECOMM-ORDER-NBR.                 16800000
169900                                                                  16810000
170000     EVALUATE TRUE                                                16820000
170100         WHEN AR001-DEBIT-ADJUSTMENT                              16830000
170200             MOVE AR001-TRANSACTION-AMOUNT                        16840000
170300                                  TO AR021-AMOUNT                 16850000
170400             MOVE AR004-TRANS-DEBIT-ADJ-CD                        16860000
170500                                  TO AR021-TRANS-TYPE             16870000
170600         WHEN AR001-PAYMENT                                       16880000
170700             IF AR001-POS-TRANSACTION                             16890000
170800                 MOVE AR001-TRANSACTION-AMOUNT                    16900000
170900                                  TO AR021-AMOUNT                 16910000
171000                 MOVE AR004-TRANS-STORE-PAYMENT-CD                16920000
171100                                  TO AR021-TRANS-TYPE             16930000
171200             ELSE                                                 16940000
171300                 IF AR001-LATE-VOID-TRANSACTION                   16950000
171400                    COMPUTE AR001-TRANSACTION-AMOUNT =            16960000
171410                            AR001-TRANSACTION-AMOUNT * -1         16970000
171420                    END-COMPUTE                                   16980000
171430                    MOVE AR001-TRANSACTION-AMOUNT                 16990000
171440                                  TO AR021-AMOUNT                 17000000
171450                    MOVE AR004-TRANS-LATE-VOID-CD                 17010000
171460                                  TO AR021-TRANS-TYPE             17020000
171470                 ELSE                                             17030000
171480                    MOVE AR001-TRANSACTION-AMOUNT                 17040000
171490                                  TO AR021-AMOUNT                 17050000
171500                    MOVE AR004-TRANS-SA-PAY-CR-ADJ-CD             17060000
171600                                  TO AR021-TRANS-TYPE             17070000
171700                 END-IF                                           17080000
171800             END-IF                                               17090000
171900     END-EVALUATE.                                                17100000
172000                                                                  17110000
P9696      MOVE AR001-PARTITION-NUMBER  TO PV-PARTN-NBR.                17120000
P9696      MOVE AR001-TRANSACTION-YEAR  TO PV-SALES-YY.                 17130000
P9696      MOVE AR001-TRANSACTION-MONTH TO PV-SALES-MM.                 17140000
P9696      MOVE AR001-TRANSACTION-DAY   TO PV-SALES-DD.                 17150000
P9696      MOVE AR001-ORG-STR-NBR       TO PV-ORG-STR-NBR.              17160000
P9696      MOVE AR001-START-TIME        TO PV-START-TIME.               17170000
P9696      MOVE AR001-SLS-CORR-SEQ-NBR  TO PV-SLS-CORR-SEQ-NBR.         17180000
P9696      MOVE AR001-ACCOUNT-NUMBER    TO PV-ACCOUNT-NUMBER.           17190000
P1043      MOVE AR001-BIN-NUMBER        TO PV-BIN-NUMBER.               17191000
P9696                                                                   17193000
172100     PERFORM 7200-WRITE-POSTING-TRANS.                            17194000
P9696      PERFORM 7500-WRITE-AJB-POSTING-TRANS.                        17195000
172200                                                                  17196000
172300******************************************************************17197000
172400*  UPDATE THE POSTING TRANSACTION RECORD WHICH WAS PREVIOUSLY    *17198000
172500*  CREATED FOR THIS TRANSACTION.  ADD THE APPROPRIATE AMOUNT     *17199000
172600*  AND TRANSACTION TYPE TO THE RECORD.                           *17200000
172700******************************************************************17210000
172800                                                                  17220000
172900 2400-UPDATE-POSTING-TRANS.                                       17230000
173000                                                                  17240000
173100     IF PV-POSTING-TOTAL-AMT >= ZERO                              17250000
173200         IF AR021-SS-ORIG-TRANS                                   17260000
173300             MOVE AR004-TRANS-STORE-SLS-CD                        17270000
173400                                  TO AR021-TRANS-TYPE             17280000
173500         ELSE                                                     17290000
173600             MOVE AR004-TRANS-SLS-AUD-SLS-ADJ-CD                  17300000
173700                                  TO AR021-TRANS-TYPE             17310000
173800         END-IF                                                   17320000
173900     ELSE                                                         17330000
174000         IF AR021-SS-ORIG-TRANS                                   17340000
174100             MOVE AR004-TRANS-STORE-RET-CD                        17350000
174200                                  TO AR021-TRANS-TYPE             17360000
174300         ELSE                                                     17370000
174400             MOVE AR004-TRANS-SLS-AUD-RET-ADJ-CD                  17380000
174500                                  TO AR021-TRANS-TYPE             17390000
174600         END-IF                                                   17400000
174700     END-IF.                                                      17410000
174800                                                                  17420000
174900     IF PV-POSTING-TOTAL-AMT < ZERO                               17430000
175000         MULTIPLY -1 BY PV-POSTING-TOTAL-AMT                      17440000
175100     END-IF.                                                      17450000
175200     MOVE PV-POSTING-TOTAL-AMT    TO AR021-AMOUNT.                17460000
175300                                                                  17470000
175400******************************************************************17480000
175500*  CREATE A POSTING FILE RECORD FOR EMPLOYEE DISCOUNT.           *17490000
175600*  SEE COMMENTS IN WORKING STORAGE FOR AN EXAMPLE OF THIS        *17500000
175700*  CALCULATION.                                                  *17510000
175800*  IF TOTAL TRANSACTION AMOUNT OR TOTAL AMOUNT PLUS COUPON ARE   *17520000
175900*  EQUAL TO ZERO, THERE WILL BE NO EMPLOYEE DISCOUNT (CAN'T DO   *17530000
176000*  DISCOUNT ON A ZERO AMOUNT).                                   *17540000
176100******************************************************************17550000
176200                                                                  17560000
176300 2500-CREATE-EMPL-DISCOUNT.                                       17570000
176400                                                                  17580000
176500*TDH001                                                           17590000
176600*    IF PV-TOTAL-ORIGINAL-AMT = ZERO OR                           17600000
176700*      (PV-TOTAL-ORIGINAL-AMT + PV-TOTAL-COUPON-AMT) = ZERO OR    17610000
176800*      (PV-TOTAL-ORIGINAL-AMT - PV-NON-DISC-TOTAL-AMT) = ZERO     17620000
176900*        CONTINUE                                                 17630000
177000*    ELSE                                                         17640000
177100*****                                                             17650000
177200***** COMPUTE TAX ADJUSTMENT AMOUNT                               17660000
JPGFX6          IF PS-ASSOC-CASH                                        17670000
177400              MOVE 0 TO PV-TAX-ADJUST-AMT                         17680000
177500          ELSE                                                    17690000
177600              COMPUTE PV-TAX-ADJUST-AMT ROUNDED                   17700000
177700                    = PV-ORIGINAL-TAX-AMT                         17710000
177800                    - PV-SAVE-TOTAL-TAX                           17720000
177900                    - PV-NON-DISC-TAX-AMT                         17730000
178000              END-COMPUTE                                         17740000
178100          END-IF                                                  17750000
178200*****                                                             17760000
178300***** COMPUTE FINAL DISCOUNT                                      17770000
178400*****                                                             17780000
178500         COMPUTE PV-FINAL-DISCOUNT-AMT                            17790000
178600               = (PV-TOTAL-DISCOUNT-AMT * -1)                     17800000
178700                 + PV-TAX-ADJUST-AMT                              17810000
178800         END-COMPUTE                                              17820000
178900                                                                  17830000
179000         IF PV-FINAL-DISCOUNT-AMT >= ZERO                         17840000
179100             MOVE AR004-TRANS-EMPL-DISC-SLS-CD                    17850000
179200                                TO AR021-TRANS-TYPE               17860000
179300         ELSE                                                     17870000
179400             MOVE AR004-TRANS-EMPL-DISC-RET-CD                    17880000
179500                                TO AR021-TRANS-TYPE               17890000
179600             MULTIPLY -1 BY PV-FINAL-DISCOUNT-AMT                 17900000
179700         END-IF                                                   17910000
179800                                                                  17920000
179900         MOVE PV-FINAL-DISCOUNT-AMT TO AR021-AMOUNT               17930000
180000                                                                  17940000
180100         IF AR021-AMOUNT = ZERO                                   17950000
180200             CONTINUE                                             17960000
180300         ELSE                                                     17970000
180400             PERFORM 7200-WRITE-POSTING-TRANS                     17980000
P9696              PERFORM 7500-WRITE-AJB-POSTING-TRANS                 17990000
180500         END-IF.                                                  18000000
180600*    END-IF.                                                      18010000
180700                                                                  18020000
180800******************************************************************18030000
180900*  GET THE POS DESCRIPTION OF THE DEPT/CLASS FROM THE TABLE      *18040000
181000*  IN WORKING-STORAGE.                                           *18041000
181100******************************************************************18042000
181200                                                                  18043000
181300 2600-GET-DESCRIPTION.                                            18044000
181400                                                                  18045000
181500     SEARCH ALL CD-CLASS-DESC-ENTRY                               18046000
181600         AT END                                                   18047000
181700             MOVE 'MISCELLANEOUS' TO PV-DESCRIPTION               18048000
181800         WHEN CD-DEPT-NUMBER  (CD-CLASS-IDX)                      18049000
181900                                 = AR001-ITEM-DEPARTMENT          18050000
182000          AND CD-CLASS-NUMBER (CD-CLASS-IDX)                      18060000
182100                                 = AR001-ITEM-CLASS               18070000
182200             MOVE CD-CLASS-POS-DESC (CD-CLASS-IDX)                18080000
182300                                TO PV-DESCRIPTION                 18090000
182400     END-SEARCH.                                                  18100000
182500                                                                  18110000
182600******************************************************************18120000
182700*  LOOKUP THE SALES TAX ROUNDING METHOD FROM THE TSTATE TABLE    *18130000
182800******************************************************************18140000
182900                                                                  18150000
183000 2700-LOOKUP-STORE-INFO.                                          18160000
JPGFX7     IF AR001-ORD-NBR > SPACES                                    18170000
JPGFX7         MOVE PC-EFC-LOC-873     TO XST00001-LOC-NBR              18180000
JPGFX7     ELSE                                                         18190000
JPGFX7         MOVE AR001-ORG-STR-NBR  TO XST00001-LOC-NBR              18200000
JPGFX7     END-IF.                                                      18210000
183100                                                                  18220000
183400     EXEC SQL                                                     18230000
183500         SELECT B.ST_TX_RND_MTHD_CDE                              18240000
183600           INTO :TSTATE-ST-TX-RND-MTHD-CDE                        18250000
183700           FROM XST_LOC A                                         18260000
183800           JOIN TSTATE  B                                         18270000
183900             ON A.ST_CDE  = B.STATE_CODE                          18280000
184000          WHERE A.LOC_NBR = :XST00001-LOC-NBR                     18290000
184100            WITH UR                                               18300000
184200     END-EXEC.                                                    18310000
184300                                                                  18320000
184400     EVALUATE SQLCODE                                             18330000
184500         WHEN ZERO                                                18340000
184600             MOVE TSTATE-ST-TX-RND-MTHD-CDE TO                    18350000
184700                  PV-SAVE-TX-RND-MTHD                             18360000
184800         WHEN OTHER                                               18370000
JPGFX7             MOVE XST00001-LOC-NBR TO PV-XST00001-LOC-NBR         18380000
JPGFX7             DISPLAY 'STORE NUMBER: ' PV-XST00001-LOC-NBR         18390000
185000             SET PV-SELECT-ROUND-ROW TO TRUE                      18400000
185100             PERFORM 9100-DB2-ERROR                               18410000
185200     END-EVALUATE.                                                18420000
185300                                                                  18430000
JPGFX7******************************************************************18440000
JPGFX7*  LOOKUP THE SALES TAX ROUNDING METHOD FROM THE TSTATE TABLE    *18450000
JPGFX7*  USING THE SHIP-TO STATE CODE IF AVAILABLE                     *18460000
JPGFX7******************************************************************18470000
JPGFX7 2720-LOOKUP-STORE-INFO-BY-ST.                                    18480000
JPGFX7     MOVE AR001-SHIP-ADDR-ST TO TSTATE-STATE-CODE.                18490000
JPGFX7                                                                  18500000
JPGFX7     EXEC SQL                                                     18510000
JPGFX7         SELECT B.ST_TX_RND_MTHD_CDE                              18520000
JPGFX7           INTO :TSTATE-ST-TX-RND-MTHD-CDE                        18520100
JPGFX7           FROM TSTATE B                                          18520200
JPGFX7          WHERE B.STATE_CODE = :TSTATE-STATE-CODE                 18520300
JPGFX7            WITH UR                                               18520400
JPGFX7     END-EXEC.                                                    18520500
JPGFX7                                                                  18520600
JPGFX7     EVALUATE SQLCODE                                             18520700
JPGFX7         WHEN ZERO                                                18520800
JPGFX7             CONTINUE                                             18520900
JPGFX7         WHEN OTHER                                               18521000
JPGFX7             DISPLAY 'STATE CODE: ' TSTATE-STATE-CODE             18521100
JPGFX7             SET PV-SELECT-ROUND-ROW-ST TO TRUE                   18521200
JPGFX7             PERFORM 9100-DB2-ERROR                               18521300
JPGFX7     END-EVALUATE.                                                18521400
185300                                                                  18521500
185400******************************************************************18521600
185500*  READ AN ACCOUNTS RECEIVABLE TRANSACTION RECORD.               *18521700
185600******************************************************************18521800
185700                                                                  18521900
185800 7000-READ-TRANSACTION-FILE.                                      18522000
185900     READ AR-TRANSACTION-FILE                                     18523000
186000         INTO AR001-AR-TRANSACTION-RECORD                         18524000
186100         AT END                                                   18525000
186200             SET PS-END-OF-TRANS-FILE TO TRUE                     18526000
186300         NOT AT END                                               18527000
186400             ADD +1 TO PA-INPUT-RCDS-READ                         18528000
186500     END-READ.                                                    18529000
186600                                                                  18530000
186700******************************************************************18540000
186800*  WRITE POSTING TRANSACTION RECORD.                             *18550000
186900******************************************************************18560000
187000                                                                  18570000
187100 7200-WRITE-POSTING-TRANS.                                        18580000
187200                                                                  18590000
187300     SET PT-FILE-IDX TO 1.                                        18600000
187400     SEARCH PT-POSTING-FILE-ENTRY VARYING PT-FILE-IDX             18610000
187500         AT END                                                   18620000
187600             MOVE PC-NBR-OF-POST-FILES TO PV-FILE-NUMBER          18630000
187700         WHEN (AR021-STORE-NO >= PT-BEGIN-STORE (PT-FILE-IDX)     18640000
187800           AND AR021-STORE-NO <= PT-END-STORE   (PT-FILE-IDX))    18650000
187900             SET PV-FILE-NUMBER TO PT-FILE-IDX                    18660000
188000     END-SEARCH.                                                  18670000
188100                                                                  18680000
188200     EVALUATE TRUE                                                18690000
188300         WHEN PV-FILE-NUMBER = 1                                  18700000
188400             WRITE POSTING-TRANS-RECORD-1                         18710000
188500                                FROM AR021-AR-POSTING-RECORD      18720000
188600             ADD +1 TO PA-POSTING-FILE-1                          18730000
188700         WHEN PV-FILE-NUMBER = 2                                  18740000
188800             WRITE POSTING-TRANS-RECORD-2                         18750000
188900                                FROM AR021-AR-POSTING-RECORD      18760000
189000             ADD +1 TO PA-POSTING-FILE-2                          18770000
189100         WHEN PV-FILE-NUMBER = 3                                  18780000
189200             WRITE POSTING-TRANS-RECORD-3                         18790000
189300                                FROM AR021-AR-POSTING-RECORD      18800000
189400             ADD +1 TO PA-POSTING-FILE-3                          18810000
189500         WHEN PV-FILE-NUMBER = 4                                  18820000
189600             WRITE POSTING-TRANS-RECORD-4                         18830000
189700                                FROM AR021-AR-POSTING-RECORD      18840000
189800             ADD +1 TO PA-POSTING-FILE-4                          18850000
189900         WHEN PV-FILE-NUMBER = 5                                  18860000
190000             WRITE POSTING-TRANS-RECORD-5                         18870000
190100                                FROM AR021-AR-POSTING-RECORD      18880000
190200             ADD +1 TO PA-POSTING-FILE-5                          18890000
190300         WHEN PV-FILE-NUMBER = 6                                  18900000
190400             WRITE POSTING-TRANS-RECORD-6                         18910000
190500                                FROM AR021-AR-POSTING-RECORD      18920000
190600             ADD +1 TO PA-POSTING-FILE-6                          18930000
190700         WHEN PV-FILE-NUMBER = 7                                  18940000
190800             WRITE POSTING-TRANS-RECORD-7                         18950000
190900                                FROM AR021-AR-POSTING-RECORD      18960000
191000             ADD +1 TO PA-POSTING-FILE-7                          18970000
191100         WHEN PV-FILE-NUMBER = 8                                  18980000
191200             WRITE POSTING-TRANS-RECORD-8                         18990000
191300                                FROM AR021-AR-POSTING-RECORD      19000000
191400             ADD +1 TO PA-POSTING-FILE-8                          19010000
191500     END-EVALUATE.                                                19020000
191600                                                                  19030000
191700******************************************************************19040000
191800*  WRITE SALES CHECK DETAIL RECORD.                              *19050000
191900******************************************************************19060000
192000                                                                  19070000
192100 7300-WRITE-SALES-CHECK-DETAIL.                                   19080000
192200                                                                  19090000
192300     WRITE SALES-CHECK-DETAIL-RECORD                              19100000
192400                                FROM AR020-AR-SALES-CHECK-DETAIL. 19110000
192500                                                                  19120000
192600     ADD +1 TO PA-SALES-CHK-DETAIL.                               19130000
192700                                                                  19140000
P9696 ******************************************************************19150000
P9696 *  WRITE AJB SALES CHECK DETAIL RECORD.                           19160000
P9696 ******************************************************************19170000
P9696  7400-WRITE-AJB-SLS-CHCK-DETAIL.                                  19180000
P9696                                                                   19190000
P9696      INITIALIZE  AR025-AR-SALES-CHECK-RECORD.                     19200000
P9696                                                                   19210000
P9696      MOVE AR020-AR-SALES-CHECK-DETAIL TO                          19220000
P9696                                    AR025-AR-SALES-CHECK-RECORD.   19230000
P9696                                                                   19240000
P9696      IF AR020-H-RECORD-ID-HEADER                                  19250000
P9696         MOVE PC-SCD-HDR-LEN-AJB-FILE TO AR025-H-LENGTH            19260000
P9696         MOVE PV-PARTN-NBR           TO AR025-H-PARTN-NBR          19270000
P9696         MOVE PV-SALES-DATE          TO AR025-H-SALES-DATE         19271000
P9696         MOVE PV-ORG-STR-NBR         TO AR025-H-ORG-STR-NBR        19272000
P9696         MOVE PV-START-TIME          TO AR025-H-START-TIME         19273000
P9696         MOVE PV-SLS-CORR-SEQ-NBR    TO AR025-H-SLS-CORR-SEQ-NBR   19274000
P9696         MOVE AR001-TNDR-SEQ-NBR     TO AR025-H-TNDR-SEQ-NBR       19275000
P9696         MOVE AR021-CARD-NO          TO AR025-H-CARD-NO            19276000
P9696         MOVE AR001-AUTH-NUMBER      TO AR025-H-AUTH-CODE          19277000
P9696         MOVE AR021-REFERRAL-TYPE    TO AR025-H-REFERRAL-TYPE      19278000
P9696         MOVE AR001-ORD-NBR          TO AR025-H-ORDER-NBR          19279000
P9696         MOVE AR001-CRS-EMPLOYEE-CODE                              19280000
P9696                                     TO AR025-H-CRS-EMPLOYEE-CDE   19280100
P9696         MOVE AR001-OMNI-CHL-FLMT-IND                              19280200
P9696                                     TO AR025-H-OMNI-CHL-FLMT-IND  19280300
P9696         MOVE AR001-AUTH-REF-NBR     TO AR025-H-AUTH-REF-NBR       19280400
P9696         MOVE AR001-TRN-GP-CDE       TO AR025-H-TRN-GP-CDE         19280500
P9696         MOVE PV-ACCOUNT-NUMBER      TO AR025-H-ORIG-ACCOUNT-NO    19280600
P1043         MOVE PV-BIN-NUMBER          TO AR025-BIN-NUMBER           19280700
P1043         MOVE AR020-H-OPERATOR-ID    TO AR025-H-OPERATOR-ID        19280800
P1043         MOVE AR020-H-DATE           TO AR025-H-DATE               19280900
P1043         MOVE AR020-H-MATCHING-REVERSAL TO                         19281000
P1043                                        AR025-H-MATCHING-REVERSAL  19281100
P1043         MOVE AR020-H-PROCESSED-DATE TO AR025-H-PROCESSED-DATE     19281200
P1043         MOVE AR020-H-DETAILS-LENGTH TO AR025-H-DETAILS-LENGTH     19281300
P1043         MOVE AR020-H-CARD-NO-RECEIVED  TO                         19281400
P1043                                        AR025-H-CARD-NO-RECEIVED   19281500
SHIP2         MOVE AR001-MULT-CLR-SEQ-NBR TO                            19281600
SHIP2                                    AR025-H-MULT-CLR-SEQ-NBR       19281700
SHIP2         MOVE AR001-TOT-SHP-NBR  TO AR025-H-TOT-SHP-NBR            19281800
SHIP2         MOVE AR001-PAR-SHP-IND  TO AR025-H-PAR-SHP-IND            19281900
P9696      END-IF.                                                      19282000
P9696                                                                   19283000
SHIP2      IF AR020-H-RECORD-ID-HEADER                                  19283300
SHIP2          MOVE AR025-AR-SALES-CHECK-RECORD                         19283500
SHIP2                           TO PV-HOLD-AJB-HEADER-RECORD            19283600
SHIP2      ELSE                                                         19283700
SHIP2          ADD +1 TO PV-AJB                                         19283900
SHIP2          MOVE AR025-AR-SALES-CHECK-RECORD                         19284000
SHIP2                           TO AJB-SALES-CHCK-DTL-REC(PV-AJB)       19284100
SHIP2          IF AR001-FULFILLMENT-TYPE = 'O'                          19284400
SHIP2             MOVE 'Y' TO PS-OMNI-SW                                19284500
SHIP2          END-IF                                                   19284700
SHIP2          IF AR001-MULT-CLR-SEQ-NBR = 1 AND                        19284800
SHIP2             AR001-FULFILLMENT-TYPE = 'S' AND                      19284900
SHIP2             PS-OMNI-SW = 'N'                                      19285000
SHIP2                MOVE 'Y' TO PS-FIRST-S2H-SHIPMENT                  19285100
SHIP2          END-IF                                                   19285200
SHIP2          IF AR001-MULT-CLR-SEQ-NBR = AR001-TOT-SHP-NBR AND        19285300
SHIP2             AR001-FULFILLMENT-TYPE = 'S' AND                      19285400
SHIP2             PS-OMNI-SW = 'N' AND                                  19285500
SHIP2             PS-FIRST-S2H-SHIPMENT = 'Y'                           19285700
SHIP2                MOVE 'N' TO PV-HOLD-H-PAR-SHP-IND                  19285800
SHIP2          ELSE                                                     19286000
SHIP2             MOVE AR001-PAR-SHP-IND  TO PV-HOLD-H-PAR-SHP-IND      19286100
SHIP2          END-IF                                                   19286200
SHIP2          MOVE AR001-MULT-CLR-SEQ-NBR TO                           19286300
SHIP2                                     PV-HOLD-H-MULT-CLR-SEQ-NBR    19286400
SHIP2          MOVE AR001-TOT-SHP-NBR  TO PV-HOLD-H-TOT-SHP-NBR         19286500
SHIP2          MOVE 'N' TO PS-FIRST-TIME-SW                             19286600
SHIP2      END-IF.                                                      19286800
P9696                                                                   19286900
P9696      ADD   1                        TO   PA-AJB-SALES-CHK-CNT.    19287000
P9696                                                                   19287100
P9696 ******************************************************************19287200
P9696 *  WRITE AJB POSTING TRANSACTION RECORD.                          19287300
P9696 ******************************************************************19287400
P9696  7500-WRITE-AJB-POSTING-TRANS.                                    19287500
P9696                                                                   19287800
P9696      INITIALIZE AR026-AR-POSTING-RECORD.                          19287900
P9696                                                                   19288000
P9696      MOVE AR021-AR-POSTING-RECORD   TO  AR026-AR-POSTING-RECORD.  19288100
P9696                                                                   19288200
P9696      MOVE PV-PARTN-NBR              TO  AR026-PARTN-NBR.          19288300
P9696      MOVE PV-SALES-DATE             TO  AR026-SALES-DATE.         19288400
P9696      MOVE PV-ORG-STR-NBR            TO  AR026-ORG-STR-NBR.        19288500
P9696      MOVE PV-START-TIME             TO  AR026-START-TIME.         19288600
P9696      MOVE PV-SLS-CORR-SEQ-NBR       TO  AR026-SLS-CORR-SEQ-NBR.   19288700
P9696      MOVE PV-ACCOUNT-NUMBER         TO  AR026-ACCOUNT-NO.         19288800
P1043      MOVE PV-BIN-NUMBER             TO  AR026-BIN-NUMBER.         19288900
P9696                                                                   19289000
P9696      WRITE AJB-POSTING-TRANS-RECORD                               19289100
P9696                              FROM AR026-AR-POSTING-RECORD.        19289200
P9696                                                                   19289300
P9696      ADD   1                        TO   PA-AJB-POSTNG-TRN-CNT.   19289400
P9696                                                                   19289500
204200                                                                  19289600
204300******************************************************************19293000
204400*  PROCESS LAST POSTING IF THE LAST TRANSACTION HAD MERCHANDISE. *19293100
204500*  CLOSE ALL FILES.                                              *19293200
204600******************************************************************19293300
204700                                                                  19294000
204800 9000-EOJ-ROUTINE.                                                19300000
204900                                                                  19310000
205000     IF PV-SAVE-TRANS-HAS-MERCHANDISE                             19320000
205100         PERFORM 2400-UPDATE-POSTING-TRANS                        19330000
205200         PERFORM 7200-WRITE-POSTING-TRANS                         19340000
205300         IF PV-SAVE-EMPLOYEE                                      19350000
205400             PERFORM 2500-CREATE-EMPL-DISCOUNT                    19360000
205500         END-IF                                                   19370000
SHIP3 * WRITE OUT THE HEADER                                            19371000
SHIP3          MOVE PV-HOLD-AJB-HEADER-RECORD                           19372000
SHIP3                               TO AR025-AR-SALES-CHECK-RECORD      19373000
SHIP3          WRITE AJB-SALES-CHCK-DTL-RECORD                          19374000
SHIP3                               FROM AR025-AR-SALES-CHECK-RECORD    19375000
SHIP3 * WRITE OUT ALL THE DETAIL RECORDS IN THE ARRAY                   19376000
SHIP3          MOVE PV-AJB TO PV-TOT-SUB                                19377000
SHIP3          PERFORM VARYING PV-AJB-SUB                               19378000
SHIP3                 FROM 1 BY 1 UNTIL PV-AJB-SUB > PV-TOT-SUB         19379000
SHIP3                 MOVE AJB-SALES-CHCK-DTL-REC(PV-AJB-SUB)           19379100
SHIP3                                 TO AR025-AR-SALES-CHECK-RECORD    19379200
SHIP3                 WRITE AJB-SALES-CHCK-DTL-RECORD                   19379300
SHIP3                               FROM AR025-AR-SALES-CHECK-RECORD    19379400
SHIP3          END-PERFORM                                              19379500
205600     END-IF.                                                      19380000
205700                                                                  19390000
205800     PERFORM 9050-DISPLAY-TOTALS.                                 19400000
205900                                                                  19410000
206000     CLOSE AR-TRANSACTION-FILE                                    19420000
206100           SALES-CHECK-DETAIL-FILE                                19430000
206200           POSTING-TRANS-FILE-1                                   19440000
206300           POSTING-TRANS-FILE-2                                   19450000
206400           POSTING-TRANS-FILE-3                                   19460000
206500           POSTING-TRANS-FILE-4                                   19470000
206600           POSTING-TRANS-FILE-5                                   19480000
206700           POSTING-TRANS-FILE-6                                   19490000
206800           POSTING-TRANS-FILE-7                                   19500000
JPGFX9           POSTING-TRANS-FILE-8.                                  19510000
207100                                                                  19520000
207200 9050-DISPLAY-TOTALS.                                             19530000
207300                                                                  19540000
209500     DISPLAY ' '.                                                 19550000
209600     DISPLAY 'INPUT RECORDS READ ' PA-INPUT-RCDS-READ.            19560000
209700     DISPLAY 'SALES CHK DETAIL   ' PA-SALES-CHK-DETAIL.           19570000
209800     DISPLAY 'POSTING FILE 1     ' PA-POSTING-FILE-1.             19580000
209900     DISPLAY 'POSTING FILE 2     ' PA-POSTING-FILE-2.             19590000
210000     DISPLAY 'POSTING FILE 3     ' PA-POSTING-FILE-3.             19600000
210100     DISPLAY 'POSTING FILE 4     ' PA-POSTING-FILE-4.             19610000
210200     DISPLAY 'POSTING FILE 5     ' PA-POSTING-FILE-5.             19620000
210300     DISPLAY 'POSTING FILE 6     ' PA-POSTING-FILE-6.             19630000
210400     DISPLAY 'POSTING FILE 7     ' PA-POSTING-FILE-7.             19640000
210500     DISPLAY 'POSTING FILE 8     ' PA-POSTING-FILE-8.             19650000
210500     DISPLAY 'AJB SALES CHECK FILE    '  PA-AJB-SALES-CHK-CNT.    19660000
210500     DISPLAY 'AJB POSTING TRANS FILE  ' PA-AJB-POSTNG-TRN-CNT.    19670000
210700                                                                  19680000
210800******************************************************************19690000
210900*  FORMAT A DB2 ERROR MESSAGE, AND ABEND THE PROGRAM.            *19700000
211000******************************************************************19710000
211100                                                                  19720000
211200 9100-DB2-ERROR.                                                  19730000
211300     DISPLAY '** ABEND **'.                                       19740000
211400     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - SQL ERROR'.             19750000
211500     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - ATTEMPTING TO '         19760000
211600               PV-LAST-DB2-ACTION.                                19770000
211700                                                                  19780000
211800*                                                                 19790000
211900*  ROUTINE TO CONVERT THE SQLCA INTO A READABLE FORMAT, USING     19800000
212000*  THE CALLED MODULE DSNTIAR.                                     19810000
212100*                                                                 19820000
212200                                                                  19830000
212300     COPY DPPD004.                                                19840000
212400                                                                  19850000
212500     SET AC-DB2-ERROR TO TRUE.                                    19860000
212600     CALL 'ILBOABN0' USING ABEND-CODE.                            19870000
212700                                                                  19880000
212800******************************************************************19890000
212900*  FORMAT AN ERROR MESSAGE, AND ABEND THE PROGRAM.               *19900000
213000*  THIS WILL BE CALLED IF MORE THAN 20 TAX RATES ARE ON 1        *19910000
213100*  TRANSACTION.                                                  *19920000
213200******************************************************************19930000
213300                                                                  19940000
213400 9200-TRAN-TAX-ERROR.                                             19950000
213500     DISPLAY '** ABEND **'.                                       19960000
213600     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - MAX OF '                19970000
213700             PC-MAX-TRAN-TAX-RATES ' TAX RATES FOR '.             19980000
213800     DISPLAY PC-CURRENT-PROGRAM-NAME  ' ONE TRANSACTION '         19990000
213900               'HAS BEEN EXCEEDED'.                               20000000
214000                                                                  20010000
214100     DISPLAY PC-CURRENT-PROGRAM-NAME  ' IF VALID, INCREASE'       20020000
214200               ' PC-MAX-TRAN-TAX-RATES IN THE PROGRAM.'           20030000
214300     DISPLAY PC-CURRENT-PROGRAM-NAME  ' LAST TRANSACTION='.       20040000
214400     DISPLAY PC-CURRENT-PROGRAM-NAME  ' ACCT #:'                  20050000
214500               AR001-ACCOUNT-NUMBER.                              20060000
214600     DISPLAY PC-CURRENT-PROGRAM-NAME  ' STORE/TERM/TRAN:'         20070000
214700               AR001-STORE-NUMBER '/'                             20080000
214800               AR001-TERMINAL-NUMBER '/'                          20090000
214900               AR001-TRANSACTION-NUMBER                           20100000
215000     SET AC-INVLD-DATA-ON-DATASET-ERROR TO TRUE.                  20110000
215100     CALL 'ILBOABN0' USING ABEND-CODE.                            20120000
215200                                                                  20130000
215300******************************************************************20140000
215400*  FORMAT AN ERROR MESSAGE, AND ABEND THE PROGRAM.               *20150000
215500*  THIS WILL BE CALLED WHEN MORE THAN 20000 ROWS ARE RETURNED    *20160000
215600*  FROM CLASS_CURSOR. CHANGED TO 25000                           *20170000
215700******************************************************************20180000
215800                                                                  20190000
215900 9400-CLASS-MAX-ERROR.                                            20200000
216000     DISPLAY '** ABEND **'.                                       20210000
216100     DISPLAY PC-CURRENT-PROGRAM-NAME  ' - MAX OF '                20220000
216200             PC-MAX-DEPT-CLASSES    ' HAS BEEN EXCEEDED'.         20230000
216300                                                                  20240000
216400     DISPLAY PC-CURRENT-PROGRAM-NAME  ' IF VALID, INCREASE'       20250000
216500               ' PC-MAX-DEPT-CLASSES IN THE PROGRAM'.             20260000
216600     SET AC-INVLD-DATA-ON-DATASET-ERROR TO TRUE.                  20270000
216700     CALL 'ILBOABN0' USING ABEND-CODE.                            20280000
216800                                                                  20290000
