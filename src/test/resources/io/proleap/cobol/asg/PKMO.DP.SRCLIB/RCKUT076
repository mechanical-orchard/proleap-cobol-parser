000100*--------------------------*                                      00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*--------------------------*                                      00030000
000400 PROGRAM-ID.    RCKUT076.                                         00040014
000500 AUTHOR.        JOHN HUTCHINSON.                                  00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  4/23/2003.                                        00070000
000800*----------------------------------------------------------------*00080031
000900*    THIS PROGRAM WILL UPDATE THE EXTRACT FILE CREATED BY        *00090031
001000*    RCKUT075 WITH  DC SPLIT QTY FROM DB2 TABLE TALLPLN.         *00100031
001100*----------------------------------------------------------------*00110031
001200*--------------------------*                                      00120014
001300 ENVIRONMENT DIVISION.                                            00130014
001400*--------------------------*                                      00140014
001500 INPUT-OUTPUT SECTION.                                            00150014
001600 FILE-CONTROL.                                                    00160014
001700     SELECT EXTRACT-FILE-IN    ASSIGN TO UT-S-INP01.              00170014
001800     SELECT EXTRACT-FILE-OUT   ASSIGN TO UT-S-OUT01.              00180014
001900*--------------------------*                                      00190000
002000 DATA DIVISION.                                                   00200000
002100*--------------------------*                                      00210000
002200 FILE SECTION.                                                    00220000
002300                                                                  00230000
002400 FD  EXTRACT-FILE-IN                                              00240000
002500     RECORDING MODE IS F                                          00250000
002600     LABEL RECORDS ARE STANDARD                                   00260000
002700     RECORD CONTAINS 400 CHARACTERS                               00270029
002800     BLOCK CONTAINS 0 CHARACTERS.                                 00280029
002900 01  EXTRACT-RECORD-IN           PIC X(400).                      00290034
003000                                                                  00300000
003100 FD  EXTRACT-FILE-OUT                                             00310000
003200     RECORDING MODE IS F                                          00320000
003300     LABEL RECORDS ARE STANDARD                                   00330000
003400     RECORD CONTAINS 400 CHARACTERS                               00340029
003500     BLOCK CONTAINS 0 CHARACTERS.                                 00350029
003600 01  EXTRACT-RECORD-OUT          PIC X(400).                      00360025
003700                                                                  00370000
003800*--------------------------*                                      00380003
003900 WORKING-STORAGE SECTION.                                         00390000
004000*--------------------------*                                      00400003
004100 01  PS-PROGRAM-SWITCHES.                                         00410000
004200     05  PS-INPUT-EOF-SW         PIC  X(01)  VALUE 'N'.           00420029
004300         88  PS-INPUT-EOF-YES                VALUE 'Y'.           00430029
004400         88  PS-INPUT-EOF-NO                 VALUE 'N'.           00440030
004500                                                                  00450000
004600 01  PV-PROGRAM-VARIABLES.                                        00460000
004700     05  PV-INPUT-COUNT          PIC S9(09)  VALUE +0.            00470031
004800     05  PV-OUTPUT-COUNT         PIC S9(09)  VALUE +0.            00480031
004900     05  PV-RETAIL-AMOUNT        PIC S9(09)  VALUE +0 COMP.       00490029
005000     05  PV-DISPLAY-COUNT        PIC  ZZZ,ZZZ,ZZ9.                00500029
005100                                                                  00510002
005200 01  PC-PROGRAM-CONSTANTS.                                        00520002
005300     05  PC-AC                   PIC  X(02)  VALUE 'AC'.          00530029
005400                                                                  00540000
005500 01  PV-ABEND-FIELDS.                                             00550000
005600     05  PV-ABEND-CODE           PIC S9(04)  VALUE +0 COMP.       00560029
005700     05  PV-SQLCODE              PIC  9(09)- VALUE ZERO.          00570029
005800     05  PV-ABEND-PROGRAM        PIC  X(08)  VALUE 'RCKUT076'.    00580029
005900     05  PV-ABEND-PARAGRAPH      PIC  X(50)  VALUE SPACES.        00590029
006000     05  PV-ABEND-OPERATION      PIC  X(50)  VALUE SPACES.        00600029
006100     05  PV-ABEND-STRUCT-1       PIC  X(08)  VALUE SPACES.        00610029
006200     05  PV-DB2-OPER-MESS-1      PIC  X(79)  VALUE SPACES.        00620029
006300     05  PV-DB2-OPER-MESS-2      PIC  X(79)  VALUE SPACES.        00630029
006400     05  PV-DB2-OPER-MESS-3      PIC  X(79)  VALUE SPACES.        00640029
006500     05  PV-DB2-TABLE-NAME       PIC  X(08)  VALUE SPACES.        00650029
006600                                                                  00660000
006700* -------------------------------------------------------------- *00670000
006800*    USED FOR DB2 ERROR MESSAGE BUILDING                         *00680000
006900* -------------------------------------------------------------- *00690000
007000     COPY DPWS004.                                                00700000
007100                                                                  00710000
007200* -------------------------------------------------------------- *00720000
007300*    DB2 SQL COMMUNICATION AREA                                  *00730000
007400* -------------------------------------------------------------- *00740000
007500     EXEC SQL                                                     00750000
007600          INCLUDE SQLCA                                           00760000
007700     END-EXEC.                                                    00770000
007800                                                                  00780005
007900* -------------------------------------------------------------- *00790005
008000*    DCLGEN FOR THE PO DETAIL TABLE                              *00800038
008100* -------------------------------------------------------------- *00810005
008200     EXEC SQL                                                     00820005
008300         INCLUDE TPURITM                                          00830038
008400     END-EXEC.                                                    00840005
008500                                                                  00850024
008600* -------------------------------------------------------------- *00860038
008700*    DCLGEN FOR THE ALL PLAN TABLE                               *00870038
008800* -------------------------------------------------------------- *00880038
008900     EXEC SQL                                                     00890038
009000         INCLUDE TALLPLN                                          00900038
009100     END-EXEC.                                                    00910038
009200                                                                  00920038
009300* -------------------------------------------------------------- *00930024
009400*    LAYOUT FOR LOGISTICS DOMAIN ITEM ACCESS MODULE              *00940024
009500* -------------------------------------------------------------- *00950024
009600     COPY XLWS001.                                                00960024
009700                                                                  00970000
009800* -------------------------------------------------------------- *00980000
009900*    COPYBOOK USED FOR INPUT AND OUTPUT EXTRACT FILE.            *00990029
010000* -------------------------------------------------------------- *01000000
010100     COPY RCRD065.                                                01010000
010200                                                                  01020000
010300*--------------------------*                                      01030003
010400 PROCEDURE DIVISION.                                              01040000
010500*--------------------------*                                      01050003
010600     PERFORM 1000-INITIALIZATION.                                 01060000
010700                                                                  01070000
010800     PERFORM 2000-PROCESS-EXTRACTS                                01080000
010900         UNTIL PS-INPUT-EOF-YES.                                  01090030
011000                                                                  01100000
011100     CLOSE EXTRACT-FILE-IN                                        01110000
011200           EXTRACT-FILE-OUT.                                      01120000
011300                                                                  01130000
011400     MOVE PV-INPUT-COUNT TO PV-DISPLAY-COUNT.                     01140009
011500                                                                  01150001
011600     DISPLAY 'NBR OF INPUT  RECORDS : ' PV-DISPLAY-COUNT.         01160029
011700                                                                  01170001
011800     MOVE PV-OUTPUT-COUNT TO PV-DISPLAY-COUNT.                    01180009
011900                                                                  01190001
012000     DISPLAY 'NBR OF OUTPUT RECORDS : ' PV-DISPLAY-COUNT.         01200029
012100     DISPLAY '                                      '.            01210000
012200     DISPLAY '--------------------------------------'.            01220000
012300                                                                  01230000
012400     GOBACK.                                                      01240000
012600                                                                  01260000
012700* -------------------------------------------------------------- *01270002
012800* -------------------------------------------------------------- *01280002
013000 1000-INITIALIZATION.                                             01300000
013200     MOVE '1000-INITIALIZATION '  TO PV-ABEND-PARAGRAPH.          01320000
013300                                                                  01330000
013400     OPEN INPUT  EXTRACT-FILE-IN                                  01340000
013500          OUTPUT EXTRACT-FILE-OUT.                                01350000
013600                                                                  01360000
013700     DISPLAY '--------------------------------------'.            01370000
013800     DISPLAY '-        PROGRAM - RCKUT076          -'.            01380014
013900     DISPLAY '--------------------------------------'.            01390000
014000     DISPLAY '                                      '.            01400000
014100                                                                  01410000
014200     PERFORM 7000-READ-INPUT.                                     01420000
014300                                                                  01430000
014500*--------------------------------------------------------------- *01450002
014600*    GET DC SPLIT QTY FROM TALLPLN.                              *01460021
014700*    UPDATE OVERAGE / SHORTAGE QTY.                              *01470021
014800*-----------------------------------------------------------------01480002
015000 2000-PROCESS-EXTRACTS.                                           01500000
015100                                                                  01510000
015200     ADD +1 TO  PV-INPUT-COUNT.                                   01520009
015300                                                                  01530022
015400     PERFORM 2100-SELECT-XL-ITEM.                                 01540029
015500                                                                  01550022
015600     PERFORM 2200-SELECT-TALLPLN.                                 01560029
015700                                                                  01570022
015800     IF RC065-CURR-SPLIT-QTY < RC065-VERIFY-ITM-QTY               01580026
015900         MOVE RC065-CURR-SPLIT-QTY TO RC065-TOT-UNITS-ORD-OVER    01590028
016000         COMPUTE RC065-OVERAGE-QTY =                              01600022
016100                 RC065-VERIFY-ITM-QTY - RC065-CURR-SPLIT-QTY      01610026
016200         COMPUTE RC065-OVERAGE-RETAIL-AMT =                       01620022
016300                 PV-RETAIL-AMOUNT * RC065-OVERAGE-QTY             01630022
016400     END-IF.                                                      01640022
016500                                                                  01650022
016600     IF RC065-CURR-SPLIT-QTY > RC065-VERIFY-ITM-QTY               01660026
016700         MOVE RC065-CURR-SPLIT-QTY TO RC065-TOT-UNITS-ORD-SHORT   01670026
016800         COMPUTE RC065-SHORTAGE-QTY =                             01680022
016900                 RC065-CURR-SPLIT-QTY - RC065-VERIFY-ITM-QTY      01690026
017000         COMPUTE RC065-SHORTAGE-RETAIL-AMT =                      01700022
017100                 PV-RETAIL-AMOUNT * RC065-SHORTAGE-QTY            01710022
017200     END-IF.                                                      01720022
017300                                                                  01730000
017400     WRITE EXTRACT-RECORD-OUT FROM RC065-RCVR-EXTRACT-RECORD.     01740000
017500                                                                  01750000
017600     ADD +1  TO  PV-OUTPUT-COUNT.                                 01760000
017700                                                                  01770000
017800     PERFORM 7000-READ-INPUT.                                     01780000
017900                                                                  01790022
018000* -------------------------------------------------------------- *01800022
018100*    CALL TPURITM TO OBTAIN UNIT RETAIL AMOUNT.                  *01810036
018200* -------------------------------------------------------------- *01820029
018300 2100-SELECT-XL-ITEM.                                             01830029
018310     MOVE '2100-SELECT-XL-ITEM  ' TO PV-ABEND-PARAGRAPH.          01831039
018400                                                                  01840029
018500     EXEC SQL                                                     01850036
018600         SELECT UNT_RTL_PR_AMT                                    01860036
018700              , GP_RTL_AMT                                        01870036
018800              , GP_QTY                                            01880036
018900           INTO :PURITM-UNT-RTL-PR-AMT                            01890036
019000              , :PURITM-GP-RTL-AMT                                01900036
019100              , :PURITM-GP-QTY                                    01910036
019200           FROM TPURITM A                                         01920036
019300          WHERE A.PO_NBR         = :RC065-ORD-NBR                 01930036
019400            AND A.PO_LNE_NBR     = :RC065-ORD-LNE-NBR             01940036
019500            AND A.VER_STATUS_CDE = 'A'                            01950036
019600     END-EXEC.                                                    01960036
019700                                                                  01970036
019800     EVALUATE TRUE                                                01980036
019900       WHEN SQLCODE = ZERO                                        01990036
020000           IF PURITM-GP-QTY > 0                                   02000037
020100               COMPUTE PV-RETAIL-AMOUNT = PURITM-GP-RTL-AMT       02010037
020200                                        / PURITM-GP-QTY           02020037
020300           ELSE                                                   02030036
020400               MOVE PURITM-UNT-RTL-PR-AMT TO PV-RETAIL-AMOUNT     02040037
020500           END-IF                                                 02050036
020600                                                                  02060038
020700       WHEN SQLCODE = +100                                        02070036
020800           MOVE +0 TO PV-RETAIL-AMOUNT                            02080037
020900***        DISPLAY '--------------------------------------'       02090040
021000           DISPLAY 'NF - ITEM#: ' RC065-ITM-NBR                   02100040
021100                   ' ORDER# : ' RC065-ORD-NBR                     02110040
021200                   ' OPER ID : ' RC065-OPER-UNT-ID                02120040
021300                   ' REC SEQ#: ' RC065-REC-SEQ-NBR                02130040
021400                   ' LINE#: ' RC065-ORD-LNE-NBR                   02140040
021500                                                                  02150038
021600       WHEN OTHER                                                 02160036
021700           MOVE 'SELECT TPURITM  ' TO PV-ABEND-OPERATION          02170038
021800           MOVE 'TPURITM'          TO PV-ABEND-STRUCT-1           02180038
021900           PERFORM 9900-DB2-ABEND                                 02190038
022000                                                                  02200036
022100     END-EVALUATE.                                                02210036
022200                                                                  02220036
022300* ----------------------------------------------------------------02230036
022400* ----------------------------------------------------------------02240036
022500 2200-SELECT-TALLPLN.                                             02250036
022700     MOVE '2200-SELECT-TALLPLN  ' TO PV-ABEND-PARAGRAPH.          02270031
022800                                                                  02280005
022900     EXEC SQL                                                     02290005
023100         SELECT CURR_SPLIT_QTY                                    02310027
023100               ,DC_SPLT_CNCLD_QTY                                 02320041
023300           INTO :ALLPLN-CURR-SPLIT-QTY                            02330026
023100               ,:ALLPLN-DC-SPLT-CNCLD-QTY                         02340041
023500           FROM TALLPLN                                           02350039
023700          WHERE PO_NBR       =  :RC065-ORD-NBR                    02370039
023800            AND PO_LNE_NBR   =  :RC065-ORD-LNE-NBR                02380039
023900            AND DEST_NBR     =  :RC065-OPER-UNT-ID                02390039
024000            AND STATUS_CDE   =  :PC-AC                            02400039
024200     END-EXEC.                                                    02420005
024400                                                                  02440005
024500     EVALUATE SQLCODE                                             02450005
024700       WHEN +0                                                    02470005
                 ADD ALLPLN-DC-SPLT-CNCLD-QTY TO ALLPLN-CURR-SPLIT-QTY  02471042
                                          GIVING RC065-CURR-SPLIT-QTY   02480042
024800*          MOVE ALLPLN-CURR-SPLIT-QTY TO RC065-CURR-SPLIT-QTY     02481042
024900                                                                  02490005
025000       WHEN +100                                                  02500005
025100           CONTINUE                                               02510005
025200                                                                  02520005
025300       WHEN OTHER                                                 02530005
025400           MOVE 'SELECT TALLPLN  ' TO PV-ABEND-OPERATION          02540033
025500           MOVE 'TALLPLN'          TO PV-ABEND-STRUCT-1           02550033
025600           PERFORM 9900-DB2-ABEND                                 02560005
025800     END-EVALUATE.                                                02580005
026000                                                                  02600000
026100* -------------------------------------------------------------- *02610003
026200* -------------------------------------------------------------- *02620003
026400 7000-READ-INPUT.                                                 02640000
026600     MOVE '7000-READ-INPUT' TO PV-ABEND-PARAGRAPH.                02660002
026700                                                                  02670000
026800     READ EXTRACT-FILE-IN  INTO  RC065-RCVR-EXTRACT-RECORD        02680000
026900         AT END                                                   02690000
027000             SET PS-INPUT-EOF-YES TO TRUE                         02700030
027100     END-READ.                                                    02710029
027300                                                                  02730000
027400* -------------------------------------------------------------- *02740003
027500* -------------------------------------------------------------- *02750003
027700 9900-DB2-ABEND.                                                  02770000
027800                                                                  02780000
027900     MOVE SQLCODE TO PV-SQLCODE.                                  02790000
028000                                                                  02800000
028100     DISPLAY '*** DB2 ERROR '.                                    02810000
028200     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       02820000
028300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02830000
028400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02840000
028500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02850000
028600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPER-MESS-1.               02860007
028700     DISPLAY '***           = ' PV-DB2-OPER-MESS-2.               02870007
028800     DISPLAY '***           = ' PV-DB2-OPER-MESS-3.               02880007
028900     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCT-1.                02890007
029100                                                                  02910000
029200     COPY DPPD004.                                                02920000
029400                                                                  02940000
029500     MOVE +4013  TO PV-ABEND-CODE.                                02950000
029600                                                                  02960000
029700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02970000
029900                                                                  02990000
030100* -------------------------------------------------------------- *03010000
