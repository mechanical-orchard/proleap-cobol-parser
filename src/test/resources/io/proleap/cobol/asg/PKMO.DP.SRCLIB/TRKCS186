000100*-----------------------*                                         00010101
000200 IDENTIFICATION DIVISION.                                         00010201
000300*-----------------------*                                         00010301
000400 PROGRAM-ID.    TRKCS186.                                         00010401
000500 AUTHOR.        NIRMAL KUMAR.                                     00010501
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00010601
000700 DATE-WRITTEN.  02-17-98.                                         00010701
000800 DATE-COMPILED.                                                   00010801
000900*----------------------------------------------------------------*00010901
001000*    Y186 - IMPORT CONTAINER CRITERIA SPEC.                      *00011001
001100*                                                                *00011101
001200*    THIS PROGRAM ALLOWS THE USER ENTER DATA TO BE USED BY       *00011201
001300*    SUBSEQUENT PROGRAMS TO CREATE A LIST OR TO BRING UP A       *00011301
001400*    SUMMARY OR DETAIL SCREENS.ALL OTHER EDITS ARE DONE IN THE   *00011402
001601*    DESTINATION PROGRAMS WHEN THE 'GO-TO' TYPE FUNCTION IS USED *00011601
001602*    (LOCAL-FUNC-01 THRU LOCAL-FUNC-12, WITH DISPOSITION 'G').   *00011701
001700*----------------------------------------------------------------*00011801
CICS  * CHANGED  1/16/2023    BY JIM HUNTER      WR: CHG0278495         00011912
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00012012
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00012112
CICS  *-----------------------------------------------------------------00012212
001800                                                                  00012301
002100 ENVIRONMENT DIVISION.                                            00012401
002200                                                                  00012501
002500 DATA DIVISION.                                                   00012601
002600                                                                  00012701
002800 WORKING-STORAGE SECTION.                                         00012901
002900                                                                  00013011
003000 01  PC-PROGRAM-CONSTANTS.                                        00013101
003100     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'TR186A  '. 00013202
003200     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'TRKM186 '. 00013302
003300     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'TRKCS186'. 00013402
003400     05  PC-TSYMSG-NUMBERS.                                       00013501
003500         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00013602
003800*                                                                 00013901
003900 01  PS-PROGRAM-SWITCHES.                                         00014001
004000     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00014101
004100         88  PS-ERROR                          VALUE  'Y'.        00014201
004200         88  PS-NO-ERROR                       VALUE  'N'.        00014301
004300*                                                                 00014407
004301 01  PM-PROGRAM-MESSAGES.                                         00068007
004303     05  PM-ABEND-INFO-A.                                         00068107
004304         10  FILLER                PIC X(15)   VALUE              00068207
004305                                   'DP020-SRC-AID: '.             00068307
004306         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00068407
004307         10  FILLER                PIC X(19)   VALUE              00068507
004308                                   '. DP020-FK-ACTION: '.         00068607
004309         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00068707
004310         10  FILLER                PIC X(22)   VALUE              00068807
004311                                   '. DP020-FK-DISPN-IND: '.      00068907
004312         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00069007
004313         10  FILLER                PIC X(01)   VALUE '.'.         00069107
004314         10  FILLER                PIC X(19)   VALUE SPACE.       00069207
004320                                                                  00069401
004400*----------------------------------------------------------------*00069501
004500*    MAP LAYOUT                                                  *00069601
004600*----------------------------------------------------------------*00069701
004700                                                                  00069801
004800     COPY TRKM186.                                                00069902
006100                                                                  00070011
004900 EJECT                                                            00070111
005000*----------------------------------------------------------------*00070201
005100*    ATTRIBUTE SETTINGS COPYBOOK.                                *00070301
005200*----------------------------------------------------------------*00070401
005300                                                                  00070501
005400     COPY DPWS015.                                                00070601
005500                                                                  00070701
006100 EJECT                                                            00070811
005600*----------------------------------------------------------------*00070901
005700*    FUNCTION KEYS COPYBOOK                                      *00071001
005800*----------------------------------------------------------------*00071101
005900                                                                  00071201
006000     COPY DPWS016.                                                00071301
005900                                                                  00071411
006100 EJECT                                                            00071501
006800*----------------------------------------------------------------*00071611
006900*  THE CALLING PARAMETER LIST (DPWS030) FOR THE CICS             *00071711
007000*  ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                     *00071811
007100*----------------------------------------------------------------*00071911
005900                                                                  00072011
007200     COPY DPWS030.                                                00072101
CICS       COPY DPWS930.                                                00072212
007300 EJECT                                                            00072301
007400*----------------------------------------------------------------*00072411
007500*    STANDARD COMMAREA.                                          *00072511
007600*----------------------------------------------------------------*00072611
007700                                                                  00072701
007800     COPY DPWS020.                                                00072801
007900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00072901
008000                                                                  00073001
008100*----------------------------------------------------------------*00073111
008200*    INTER-APPLICATION COMMAREA.                                 *00073211
008300*----------------------------------------------------------------*00073311
008400                                                                  00073401
008500         10  INTER-APPL-COMM-AREA PIC X(200).                     00073501
008600     COPY TRWS186.                                                00073603
008400                                                                  00073711
008700*----------------------------------------------------------------*00073811
008800*    SPECIFIC COMMMAREA FOR TRKCS186.                            *00073911
008900*----------------------------------------------------------------*00074011
008400                                                                  00074111
009000         10  ASC-SPECIFIC-COMMAREA.                               00074201
009100             15  ASC-CNTNR-NO                PIC  X(12).          00074302
009600         10  FILLER                          PIC  X(2853).        00074402
008400                                                                  00074511
009700 EJECT                                                            00074611
009800*----------------------------------------------------------------*00074701
009900*    ABEND PROCESSING COPYBOOK.                                  *00074801
010000*----------------------------------------------------------------*00074901
010100                                                                  00075001
010200     COPY DPWS013.                                                00075101
010400                                                                  00075301
010500 EJECT                                                            00075401
010400                                                                  00075511
010600 LINKAGE SECTION.                                                 00075601
010700                                                                  00075701
010800 01  DFHCOMMAREA.                                                 00075801
010900     05  FILLER                         OCCURS  1 TO 4072 TIMES   00075901
011000                                        DEPENDING ON EIBCALEN.    00076001
011100         10  FILLER                     PIC X.                    00076101
011300                                                                  00076301
011300*---------------------------------------------------------------* 00076411
011400 PROCEDURE DIVISION.                                              00076501
011500*---------------------------------------------------------------* 00076611
011600*  THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.  * 00076711
011700*  THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API   * 00076811
011800*  MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.             * 00076911
011900*                                                               * 00077011
012000*  THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE   * 00077111
012100*  LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.        * 00077211
012200*---------------------------------------------------------------* 00077311
012300 0000-MAIN-MODULE.                                                00077401
011300                                                                  00077511
012400     INITIALIZE DP030-CICS-API-FIELDS.                            00077601
012500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       00077701
012600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          00077801
012700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         00077901
012800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       00078001
012900     MOVE LENGTH OF TR186AI        TO DP030-MAP-LENGTH (1).       00078107
013000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     00078201
013100     PERFORM 0001-CALL-CICS-ARCH-API.                             00078301
013200*                                                                 00078401
013300     PERFORM 1000-CONTROL-PROCESSING                              00078501
013400*                                                                 00078601
013500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     00078701
013600     PERFORM 0001-CALL-CICS-ARCH-API.                             00078801
011300                                                                  00078911
013700*---------------------------------------------------------------* 00079009
013700*    CALL THE ARCHITECTURE API.                                 * 00079109
013700*---------------------------------------------------------------* 00079209
013800 0001-CALL-CICS-ARCH-API.                                         00079301
013700                                                                  00079409
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      00079512
014000                                    DFHCOMMAREA                   00079612
014100                                    DP030-CICS-API-FIELDS         00079712
014200                                    DP020-STANDARD-COMMAREA       00079812
014300                                    TR186AI.                      00079912
014400*                                                                 00080001
014500     IF  DP030-RC-CALL-SUCCESSFUL                                 00080101
014600         CONTINUE                                                 00080201
014700     ELSE                                                         00080301
014800         SET DP013-NO-ROLLBACK                                    00080401
014900             DP013-XCTL-DISPLAY-RESTART                           00080501
015000             DP013-CICS-ABEND      TO TRUE                        00080601
015100         MOVE 'BEFORE 0000-MAIN-MODULE'                           00080701
015200                                   TO DP013-PARAGRAPH             00080801
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O00080912
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      00081012
015500         MOVE DP030-RETURN-CODE                                   00081101
015600                                   TO DP013-MESSAGE-TEXT (3)      00081201
015700         PERFORM DP013-0000-PROCESS-ABEND                         00081301
015800     END-IF.                                                      00081401
015800                                                                  00081511
015900 EJECT                                                            00081601
016000*----------------------------------------------------------------*00081701
016100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *00081801
016200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *00081901
016300*----------------------------------------------------------------*00082001
016500 1000-CONTROL-PROCESSING.                                         00082201
016600                                                                  00082301
016700     EVALUATE TRUE                                                00082401
016800         WHEN DP020-NEXT-ACT-INITIAL                              00082501
016900             INITIALIZE ASC-SPECIFIC-COMMAREA                     00082601
017000             PERFORM 4000-BUILD-INITIAL-PANEL                     00082701
017100                                                                  00082801
017200         WHEN DP020-NEXT-ACT-READ-MAP                             00082901
017300             PERFORM 2000-FKEY-PROCESSING                         00083001
017400                                                                  00083101
017500         WHEN DP020-NEXT-ACT-RETURN                               00083201
017600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00083301
017700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   00083401
017800                                                                  00083501
017900         WHEN OTHER                                               00083601
018000             SET DP013-LOGIC-ABEND                                00083701
018100                 DP013-NO-ROLLBACK TO TRUE                        00083801
018200             MOVE '1000-CONTROL-PROCESSING'                       00083901
018300                                   TO  DP013-PARAGRAPH            00084001
018400             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   00084101
018500                                   TO  DP013-MESSAGE-TEXT(1)      00084201
018600             MOVE DP020-NEXT-APPL-ACTIVITY                        00084301
018700                                   TO DP013-MESSAGE-TEXT(2)       00084401
018800             PERFORM DP013-0000-PROCESS-ABEND                     00084501
018900     END-EVALUATE.                                                00084601
019000                                                                  00084701
015900 EJECT                                                            00084811
019100*----------------------------------------------------------------*00084901
019200* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*00085001
019300* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*00085101
019400* EDITS.                                                         *00085201
019500*----------------------------------------------------------------*00085301
019700 2000-FKEY-PROCESSING.                                            00085501
019800                                                                  00085601
019900     EVALUATE TRUE                                                00085701
020000                                                                  00085801
020100         WHEN DP020-SRC-AID = DP016-CLEAR                         00085901
020200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   00086001
020300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 00086101
020400                                                                  00086201
020500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     00086301
020600             INITIALIZE ASC-SPECIFIC-COMMAREA                     00086401
020700             PERFORM 4000-BUILD-INITIAL-PANEL                     00086501
020800             PERFORM 3200-RESET-ATTRIBUTES                        00086601
020900                                                                  00086701
021000         WHEN OTHER                                               00086801
021100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 00086901
021200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   00087001
021300             IF  PS-NO-ERROR                                      00087101
021400                 SET DP030-CONTINUE-GO TO TRUE                    00087201
021500                 PERFORM 2100-CHECK-FUNCTION-KEY                  00087301
021600             ELSE                                                 00087401
021700                 SET DP030-OVERRIDE-GO TO TRUE                    00087501
021800             END-IF                                               00087601
021900     END-EVALUATE.                                                00087701
019800                                                                  00087811
019800 EJECT                                                            00087911
022000*----------------------------------------------------------------*00088011
022100*  ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED      *00088111
022200*  FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED  *00088211
022300*  FROM THE CICS ARCHITECTURE API.                               *00088311
022400*----------------------------------------------------------------*00088411
022500 2100-CHECK-FUNCTION-KEY.                                         00088501
022900                                                                  00088611
022600     EVALUATE TRUE                                                00088701
022710         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   00088901
022800             PERFORM 2110-PREPARE-INTER-APPL-COMM                 00089001
022900                                                                  00089101
023000         WHEN DP020-SRC-AID = DP016-ENTER                         00089201
023100             CONTINUE                                             00089301
023200                                                                  00089401
023300         WHEN OTHER                                               00089501
023400             SET DP013-NO-ROLLBACK                                00089601
023500                 DP013-XCTL-DISPLAY-RESTART                       00089701
023600                 DP013-CICS-ABEND  TO TRUE                        00089801
023700             MOVE '2100-CHECK-FUNCTION-KEY'                       00089901
023800                                   TO DP013-PARAGRAPH             00090001
023900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      00090101
024000                                   TO DP013-MESSAGE-TEXT (1)      00090201
024010             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 00090301
024020                                   TO DP013-MESSAGE-TEXT (2)      00090401
024021             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                00090501
024022             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 00090601
024023                                   TO PM-A-FK-ACTION              00090701
024024             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              00090801
024025                                   TO PM-A-FK-DISPN               00090901
024030             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      00091001
024070             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        00091101
024080                                   TO DP013-MESSAGE-TEXT (4)      00091201
024100             PERFORM DP013-0000-PROCESS-ABEND                     00091301
024200     END-EVALUATE.                                                00091401
023200                                                                  00091511
023200 EJECT                                                            00091611
024300*----------------------------------------------------------------*00091708
024400*  MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE    *00091808
024500*  INTER-APPLICATION COMMAREA.                                   *00091908
024600*----------------------------------------------------------------*00092008
024700 2110-PREPARE-INTER-APPL-COMM.                                    00092101
023200                                                                  00092211
024800     INITIALIZE TR186-INTER-APPL-COMMAREA.                        00092306
024900     MOVE ASC-CNTNR-NO             TO TR186-CONTNR-NO.            00092406
023200                                                                  00092511
025300 EJECT                                                            00092601
025400*----------------------------------------------------------------*00092701
025500* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*00092801
025600* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *00092901
025700* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *00093001
025800*----------------------------------------------------------------*00093101
026000 2200-MOVE-SCREEN-TO-COMMAREA.                                    00093301
025900                                                                  00093411
026100     IF  ACNTRNOL > ZERO                                          00093503
026200         MOVE ACNTRNOI             TO ASC-CNTNR-NO                00093603
026300     ELSE                                                         00093701
026400         IF  ACNTRNOF = DP015-ERASE-EOF                           00093803
026500             MOVE SPACE            TO ASC-CNTNR-NO                00093903
026600         END-IF                                                   00094001
026700     END-IF.                                                      00094101
026800                                                                  00094201
025300 EJECT                                                            00094311
029200*----------------------------------------------------------------*00094401
029300* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *00094501
029400* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *00094601
029500* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*00094701
029600* IN THE DESTINATION PROGRAM, NOT HERE.                          *00094801
029700*----------------------------------------------------------------*00094901
029900 3000-EDIT-DATA-IN-COMMAREA.                                      00095101
029800                                                                  00095211
030000     PERFORM 3200-RESET-ATTRIBUTES.                               00095301
      *---TSYMSG-007-REQUIRED ENTRY                                     00095403
00717      IF  ASC-CNTNR-NO = SPACES                                    00095503
00720              SET PS-ERROR                                         00095603
00721                  DP020-MSG-FATAL   TO TRUE                        00095703
00722              MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            00095803
00723              MOVE DP015-UNP-ALP-BRT-OFF                           00095903
00724                                    TO ACNTRNOA                    00096003
00731              MOVE DP015-RED        TO ACNTRNOC                    00096103
00738              MOVE DP015-REVERSE    TO ACNTRNOH                    00096203
00745              MOVE -1               TO ACNTRNOL                    00096303
00752              SET DP030-SET-CURSOR-APPL-1 TO TRUE                  00096403
031700     ELSE                                                         00096503
031800             MOVE ASC-CNTNR-NO     TO ACNTRNOO                    00096603
032200     END-IF.                                                      00096701
032300                                                                  00096801
032500     IF  PS-NO-ERROR                                              00097001
032600         MOVE -1                   TO ACNTRNOL                    00097103
032700         SET DP030-SET-CURSOR-APPL-1                              00097201
032800                                   TO TRUE                        00097301
032900     END-IF.                                                      00097401
032300                                                                  00097511
032300 EJECT                                                            00097611
033000*----------------------------------------------------------------*00097711
033100*  MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE  *00097811
033200*  MAP.                                                          *00097911
033300*----------------------------------------------------------------*00098011
033400 3200-RESET-ATTRIBUTES.                                           00098101
034700                                                                  00098211
033500     MOVE DP015-UNP-ALP-NOR-OFF    TO ACNTRNOA.                   00098303
033900     MOVE DP015-GREEN              TO ACNTRNOC.                   00098403
034300     MOVE DP015-UNDERLINE          TO ACNTRNOH.                   00098503
034700                                                                  00098611
034700 EJECT                                                            00098711
034800*----------------------------------------------------------------*00098801
034900*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *00098901
035000*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *00099001
035100*  IT HERE.                                                      *00099101
035200*----------------------------------------------------------------*00099201
035300 4000-BUILD-INITIAL-PANEL.                                        00099301
035600                                                                  00099410
035600     MOVE SPACES                   TO ACNTRNOO.                   00099510
035400     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       00099610
035500     MOVE -1                       TO ACNTRNOL.                   00099703
035600                                                                  00099811
036500 EJECT                                                            00099911
035700*----------------------------------------------------------------*00100001
035800*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *00100101
035900*----------------------------------------------------------------*00100201
036000 4400-MOVE-COMMAREA-TO-SCREEN.                                    00100301
035600                                                                  00100411
036100     MOVE ASC-CNTNR-NO             TO ACNTRNOO.                   00100503
035600                                                                  00100611
036500 EJECT                                                            00100701
036600*----------------------------------------------------------------*00100801
036700*    ABEND PROCESSOR MODULE                                      *00100901
036800*----------------------------------------------------------------*00101001
036900                                                                  00102001
037000     COPY DPPD013.                                                00110001
