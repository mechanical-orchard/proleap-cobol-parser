000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.    XLKUT073.                                         00040001
000500 AUTHOR.        JOE LAROSA.                                       00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  01-2004.                                          00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000*        DEPT-CLASS DOMAIN MODULE - BLACK BOX PROGRAM            *00100001
001100*    THIS PROGRAM CAN BE CALLED IN BATCH AND IN CICS AND NEEDS   *00110008
001200*    TO BE COMPILED EACH WAY AND TWO MOVES MADE TO PRODUCTION    *00120008
001300*    (ONE BATCH & ONE ON-LINE).  THE PROGRAM EXPECTS A DEPT NBR  *00130008
001400*    (AND OPTIONALLY MAJOR CLASS AND SUBCLASS) AS INPUT.         *00140001
001500*    PROGRAM RETURNS SEVERAL ASSOCIATED FIELDS TO SENDER.        *00150001
001600******************************************************************00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800******************************************************************00180000
001900 DATA DIVISION.                                                   00190000
002000 WORKING-STORAGE SECTION.                                         00200000
002100 01  WS-WORKING-STOAGE-VALUE     PIC X(35) VALUE                  00210000
002200         '*** WORKING STORAGE STARTS HERE ***'.                   00220000
002300                                                                  00230000
002400 01  PC-PROGRAM-CONSTANTS.                                        00240000
002500     05  PC-CURRENT-PROGRAM-NAME PIC X(08) VALUE 'XLKUT073'.      00250001
002600                                                                  00260000
002700 01  PV-PROGRAM-VARIABLES.                                        00270000
002800     05  PV-DEPT                 PIC 9(04).                       00280001
002900     05  PV-MAJ-CL               PIC 9(04).                       00290001
003000     05  PV-SUB-CL               PIC 9(04).                       00300001
003100     05  PV-BUS-GP-NBR           PIC 9(03).                       00310005
003200     05  PV-BUS-AREA-ID          PIC 9(02).                       00320005
003300     05  PV-SQLCODE              PIC S9(9).                       00330001
003400     05  PV-DISPLAY-SQLCODE      PIC -------999.                  00340000
003500                                                                  00350000
003600******************************************************************00360000
003700*  COMMUNICATIONS AREA FOR DB2                                    00370000
003800******************************************************************00380000
003900     EXEC SQL                                                     00390000
004000         INCLUDE SQLCA                                            00400000
004100     END-EXEC.                                                    00410000
004200                                                                  00420000
004300******************************************************************00430000
004400* DCLGENS OF ASSOCIATED DEPT-CLASS TABLES.                        00440001
004500******************************************************************00450000
004600*XLT_BUS_AREA                                                     00460004
004700     EXEC SQL                                                     00470004
004800         INCLUDE XLT00000                                         00480004
004900     END-EXEC.                                                    00490004
005000                                                                  00500004
005100*XLT_BUS_GP                                                       00510004
005200     EXEC SQL                                                     00520004
005300         INCLUDE XLT00001                                         00530004
005400     END-EXEC.                                                    00540004
005500                                                                  00550004
005600*XLT_DEPT                                                         00560001
005700     EXEC SQL                                                     00570000
005800         INCLUDE XLT00002                                         00580001
005900     END-EXEC.                                                    00590000
006000                                                                  00600000
006100*XLT_MAJ_CL                                                       00610001
006200     EXEC SQL                                                     00620000
006300         INCLUDE XLT00022                                         00630001
006400     END-EXEC.                                                    00640000
006500                                                                  00650000
006600*XLT_SUB_CL                                                       00660001
006700     EXEC SQL                                                     00670000
006800         INCLUDE XLT00023                                         00680001
006900     END-EXEC.                                                    00690000
007000                                                                  00700000
007100******************************************************************00710000
007200 LINKAGE SECTION.                                                 00720000
007300     COPY XLWS073.                                                00730009
007400******************************************************************00740000
007500 PROCEDURE DIVISION USING XL073-COMMAREA-REC.                     00750008
007600******************************************************************00760000
007700 0000-MAIN-MODULE.                                                00770000
007800                                                                  00780001
007900     INITIALIZE XL073-RETURN-DATA.                                00790001
008000                                                                  00800007
008100     PERFORM 1000-GET-DEPT.                                       00810001
008200                                                                  00820007
008300     GOBACK.                                                      00830000
008400                                                                  00840000
008500******************************************************************00850000
008600*  SELECT XLT_DEPT                                               *00860001
008700******************************************************************00870000
008800 1000-GET-DEPT.                                                   00880001
008900                                                                  00890000
009000     MOVE XL073-DEPT-NBR TO XLT00002-DEPT-NBR.                    00900001
009100     EXEC SQL                                                     00910000
009200         SELECT DEPT_NM                                           00920001
009300              , MDSE_LNE_CDE                                      00930001
009400              , BUS_GP_NBR                                        00940001
009500              , STR_ZN_CDE                                        00950001
009600              , BYR_NBR                                           00960001
009700              , DMA_NBR                                           00970001
009800              , CONT_CLR_EXCLN_IND                                00980001
009900           INTO :XLT00002-DEPT-NM                                 00990001
010000              , :XLT00002-MDSE-LNE-CDE                            01000001
010100              , :XLT00002-BUS-GP-NBR                              01010001
010200              , :XLT00002-STR-ZN-CDE                              01020001
010300              , :XLT00002-BYR-NBR                                 01030001
010400              , :XLT00002-DMA-NBR                                 01040001
010500              , :XLT00002-CONT-CLR-EXCLN-IND                      01050001
010600           FROM XLT_DEPT                                          01060001
010700          WHERE DEPT_NBR = :XLT00002-DEPT-NBR                     01070001
010800     END-EXEC.                                                    01080000
010900                                                                  01090000
011000     EVALUATE TRUE                                                01100000
011100       WHEN SQLCODE = ZERO                                        01110000
011200           INITIALIZE DCLXLT00022                                 01120001
011300           INITIALIZE DCLXLT00023                                 01130001
011400           IF XL073-MAJ-CL-NBR > ZEROES                           01140001
011500               PERFORM 2000-GET-MAJ-CLASS                         01150001
011600           END-IF                                                 01160001
011700           PERFORM 4000-GET-BUS-GP                                01170005
011800           PERFORM 7000-LOAD-COMMAREA                             01180005
011900                                                                  01190000
012000       WHEN SQLCODE = +100                                        01200000
012100           SET XL073-DEPT-NOT-FND TO TRUE                         01210001
012200                                                                  01220000
012300       WHEN OTHER                                                 01230000
012400           INITIALIZE XL073-RETURN-DATA                           01240007
012500           MOVE SQLCODE             TO PV-SQLCODE                 01250007
012600           MOVE PV-SQLCODE          TO PV-DISPLAY-SQLCODE         01260007
012700           MOVE PV-DISPLAY-SQLCODE  TO XL073-SQLCODE              01270007
012800           SET XL073-BAD-DB2-RETURN TO TRUE                       01280007
012900           MOVE 'XLT00002'          TO XL073-DB2-TABLE            01290007
013000                                                                  01300000
013100     END-EVALUATE.                                                01310000
013200                                                                  01320000
013300******************************************************************01330000
013400*  SELECT XLT_MAJ_CL.                                            *01340001
013500******************************************************************01350000
013600 2000-GET-MAJ-CLASS.                                              01360001
013700                                                                  01370000
013800     MOVE XL073-DEPT-NBR   TO XLT00022-DEPT-NBR.                  01380001
013900     MOVE XL073-MAJ-CL-NBR TO XLT00022-MAJ-CL-NBR.                01390001
014000     EXEC SQL                                                     01400000
014100         SELECT MAJ_CL_NM                                         01410001
014200           INTO :XLT00022-MAJ-CL-NM                               01420001
014300           FROM XLT_MAJ_CL                                        01430001
014400          WHERE DEPT_NBR   = :XLT00022-DEPT-NBR                   01440001
014500            AND MAJ_CL_NBR = :XLT00022-MAJ-CL-NBR                 01450001
014600     END-EXEC.                                                    01460000
014700                                                                  01470000
014800     EVALUATE TRUE                                                01480000
014900       WHEN SQLCODE = ZERO                                        01490000
015000           IF XL073-SUB-CL-NBR > ZEROES                           01500001
015100               PERFORM 3000-GET-SUB-CLASS                         01510001
015200           END-IF                                                 01520001
015300                                                                  01530000
015400       WHEN SQLCODE = +100                                        01540000
015500           SET XL073-MAJ-CL-NOT-FND TO TRUE                       01550001
015600           MOVE SPACES TO XLT00022-MAJ-CL-NM                      01560001
015700                                                                  01570000
015800       WHEN OTHER                                                 01580000
015900           MOVE SQLCODE             TO PV-SQLCODE                 01590007
016000           MOVE PV-SQLCODE          TO PV-DISPLAY-SQLCODE         01600007
016100           MOVE PV-DISPLAY-SQLCODE  TO XL073-SQLCODE              01610007
016200           SET XL073-BAD-DB2-RETURN TO TRUE                       01620007
016300           MOVE 'XLT00022'          TO XL073-DB2-TABLE            01630007
016400           GOBACK                                                 01640007
016500                                                                  01650000
016600     END-EVALUATE.                                                01660000
016700                                                                  01670000
016800******************************************************************01680000
016900*  SELECT XLT_SUB_CL.                                            *01690001
017000******************************************************************01700000
017100 3000-GET-SUB-CLASS.                                              01710001
017200                                                                  01720000
017300     MOVE XL073-DEPT-NBR   TO XLT00023-DEPT-NBR.                  01730001
017400     MOVE XL073-MAJ-CL-NBR TO XLT00023-MAJ-CL-NBR.                01740001
017500     MOVE XL073-SUB-CL-NBR TO XLT00023-SUB-CL-NBR.                01750001
017600     EXEC SQL                                                     01760000
017700         SELECT SUB_CL_NM                                         01770001
017800              , POS_MDSE_DESC                                     01780001
017900              , TAX_DFLT_IND                                      01790001
018000              , DISC_ELIG_IND                                     01800001
018100           INTO :XLT00023-SUB-CL-NM                               01810001
018200              , :XLT00023-POS-MDSE-DESC                           01820001
018300              , :XLT00023-TAX-DFLT-IND                            01830001
018400              , :XLT00023-DISC-ELIG-IND                           01840001
018500           FROM XLT_SUB_CL                                        01850001
018600          WHERE DEPT_NBR   = :XLT00023-DEPT-NBR                   01860001
018700            AND MAJ_CL_NBR = :XLT00023-MAJ-CL-NBR                 01870001
018800            AND SUB_CL_NBR = :XLT00023-SUB-CL-NBR                 01880001
018900     END-EXEC.                                                    01890000
019000                                                                  01900000
019100     EVALUATE TRUE                                                01910000
019200       WHEN SQLCODE = ZERO                                        01920000
019300           CONTINUE                                               01930007
019400                                                                  01940000
019500       WHEN SQLCODE = +100                                        01950000
019600           SET XL073-SUB-CL-NOT-FND TO TRUE                       01960001
019700           MOVE SPACES TO XLT00023-SUB-CL-NM                      01970001
019800                          XLT00023-POS-MDSE-DESC                  01980001
019900                          XLT00023-TAX-DFLT-IND                   01990001
020000                          XLT00023-DISC-ELIG-IND                  02000001
020100                                                                  02010000
020200       WHEN OTHER                                                 02020000
020300           MOVE SQLCODE             TO PV-SQLCODE                 02030007
020400           MOVE PV-SQLCODE          TO PV-DISPLAY-SQLCODE         02040007
020500           MOVE PV-DISPLAY-SQLCODE  TO XL073-SQLCODE              02050007
020600           SET XL073-BAD-DB2-RETURN TO TRUE                       02060007
020700           MOVE 'XLT00023'          TO XL073-DB2-TABLE            02070007
020800           GOBACK                                                 02080007
020900                                                                  02090000
021000     END-EVALUATE.                                                02100000
021100                                                                  02110000
021200******************************************************************02120005
021300*  SELECT XLT_BUS_GP.                                            *02130005
021400******************************************************************02140005
021500 4000-GET-BUS-GP.                                                 02150005
021600                                                                  02160005
021700     MOVE XLT00002-BUS-GP-NBR TO XLT00001-BUS-GP-NBR.             02170005
021800     EXEC SQL                                                     02180005
021900         SELECT BUS_AREA_ID                                       02190005
022000              , BUS_GP_DESC                                       02200005
022100           INTO :XLT00001-BUS-AREA-ID                             02210005
022200              , :XLT00001-BUS-GP-DESC                             02220005
022300           FROM XLT_BUS_GP                                        02230005
022400          WHERE BUS_GP_NBR = :XLT00001-BUS-GP-NBR                 02240005
022500     END-EXEC.                                                    02250005
022600                                                                  02260005
022700     EVALUATE TRUE                                                02270005
022800       WHEN SQLCODE = ZERO                                        02280005
022900           PERFORM 5000-GET-BUS-AREA                              02290005
023000                                                                  02300005
023100       WHEN OTHER                                                 02310005
023200           MOVE SQLCODE             TO PV-SQLCODE                 02320007
023300           MOVE PV-SQLCODE          TO PV-DISPLAY-SQLCODE         02330007
023400           MOVE PV-DISPLAY-SQLCODE  TO XL073-SQLCODE              02340007
023500           SET XL073-BAD-DB2-RETURN TO TRUE                       02350007
023600           MOVE 'XLT00001'          TO XL073-DB2-TABLE            02360007
023700           GOBACK                                                 02370007
023800                                                                  02380005
023900     END-EVALUATE.                                                02390005
024000                                                                  02400005
024100******************************************************************02410005
024200*  SELECT XLT_BUS_AREA.                                          *02420005
024300******************************************************************02430005
024400 5000-GET-BUS-AREA.                                               02440005
024500                                                                  02450005
024600     MOVE XLT00001-BUS-AREA-ID TO XLT00000-BUS-AREA-ID.           02460005
024700     EXEC SQL                                                     02470005
024800         SELECT BUS_AREA_DESC                                     02480005
024900           INTO :XLT00000-BUS-AREA-DESC                           02490005
025000           FROM XLT_BUS_AREA                                      02500005
025100          WHERE BUS_AREA_ID = :XLT00000-BUS-AREA-ID               02510005
025200     END-EXEC.                                                    02520005
025300                                                                  02530005
025400     EVALUATE TRUE                                                02540005
025500       WHEN SQLCODE = ZERO                                        02550005
025600           CONTINUE                                               02560007
025700                                                                  02570005
025800       WHEN OTHER                                                 02580005
025900           MOVE SQLCODE             TO PV-SQLCODE                 02590007
026000           MOVE PV-SQLCODE          TO PV-DISPLAY-SQLCODE         02600007
026100           MOVE PV-DISPLAY-SQLCODE  TO XL073-SQLCODE              02610007
026200           SET XL073-BAD-DB2-RETURN TO TRUE                       02620007
026300           MOVE 'XLT00000'          TO XL073-DB2-TABLE            02630007
026400           GOBACK                                                 02640007
026500                                                                  02650005
026600     END-EVALUATE.                                                02660005
026700                                                                  02670005
026800******************************************************************02680000
026900*  MOVE DB2 DEPT-CLASS FIELDS TO COMMAREA                        *02690001
027000******************************************************************02700000
027100 7000-LOAD-COMMAREA.                                              02710005
027200                                                                  02720000
027300     MOVE XLT00002-DEPT-NM        TO XL073-DEPT-NAME.             02730001
027400     MOVE XLT00002-MDSE-LNE-CDE   TO XL073-MDSE-LNE-CDE.          02740001
027500     MOVE XLT00002-BUS-GP-NBR     TO XL073-BUS-GP-NBR.            02750001
027600     MOVE XLT00002-STR-ZN-CDE     TO XL073-STR-ZN-CDE.            02760001
027700     MOVE XLT00002-BYR-NBR        TO XL073-BUYER-NBR.             02770001
027800     MOVE XLT00002-DMA-NBR        TO XL073-DMA-NBR.               02780001
027900     MOVE XLT00002-CONT-CLR-EXCLN-IND                             02790001
028000                                  TO XL073-CONT-IND.              02800001
028100     MOVE XLT00022-MAJ-CL-NM      TO XL073-MAJ-CL-NAME.           02810001
028200     MOVE XLT00023-SUB-CL-NM      TO XL073-SUB-CL-NAME.           02820001
028300     MOVE XLT00023-POS-MDSE-DESC  TO XL073-POS-MDSE-DESC.         02830001
028400     MOVE XLT00023-TAX-DFLT-IND   TO XL073-TAX-DFLT-IND.          02840001
028500     MOVE XLT00023-DISC-ELIG-IND  TO XL073-DISC-ELIG-IND.         02850001
028600                                                                  02860000
028700     MOVE XLT00001-BUS-GP-DESC    TO XL073-BUS-GP-DESC.           02870006
028800     MOVE XLT00001-BUS-AREA-ID    TO XL073-BUS-AREA-ID.           02880006
028900     MOVE XLT00000-BUS-AREA-DESC  TO XL073-BUS-AREA-DESC.         02890006
029000                                                                  02900006
029100******************************************************************02910000
029200******************************************************************02920000
