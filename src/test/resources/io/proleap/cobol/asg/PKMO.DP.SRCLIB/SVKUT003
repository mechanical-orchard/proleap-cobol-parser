000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.         SVKUT003.                                    00020000
000300 AUTHOR.             BARB ERTL.                                   00030000
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040000
000500 DATE-WRITTEN.       OCTOBER 2007.                                00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080000
000900* THIS PROGRAM EXTRACTS THE DAILY ACTIVITY FROM THE KMC ACTIVITY *00090000
001000* TABLE, SVT_KOHLS_CRD_TXN, FOR ECOMM STORES.                    *00100000
001100*                                                                *00110000
001200*                                                                *00120000
001300* INPUT FILES:   DAILY-SALES-FILE          DDNAME = INP01        *00130000
001400*                                                                *00140000
001500* OUTPUT FILES:  KMC-DAILY-ACTIVITY        DDNAME = OUT01        *00150000
001600*                                                                *00160000
001700******************************************************************00170000
W3540C* MODIFICATION LOG:                                               00170116
W3540C* -----------------                                               00170216
W3540C*                                                                 00170316
W3540C* REQUIREMENT  : MAKE DATE AND TIMESTAMP RELATED CHANGES FOR     *00170516
W3540C*                FSH PROJECT                                     *00170616
W3540C* PROJECT ID   : W3540C                                          *00170716
W3540C* AUTHOR       : COGNIZANT                                       *00170816
W3540C* DATE CHANGED : 15-OCT-2012                                     *00170916
W3540C* CHANGES MADE : 1.MODIFIED THE CONTROL-RECORD FORMAT TO HANDLE  *00171016
W3540C*                  THE BEGIN AND END TIMESTAMPS                  *00171116
W3540C*                2.DATE FORMAT CHANGED FROM ISO-FMT TO TIMESTAMP *00171216
W3540C*                  FORMAT                                        *00171316
W3540C*                                                                 00171423
W3540C* REQUIREMENT  : MAKE DATE AND TIMESTAMP RELATED CHANGES FOR     *00171523
W3540C*                FSH PROJECT                                     *00171623
W3540C* PROJECT ID   : W3540C                                          *00171723
W3540C* AUTHOR       : COGNIZANT                                       *00171823
W3540C* DATE CHANGED : 15-NOV-2012                                     *00171923
W3540C* CHANGES MADE : MODIFIED THE ECOMM_ACTVY_CURSOR TO FETCH THE    *00172023
W3540C*                RECORDS WHERE TRN_AUTH_TMST IS BETWEEN THE      *00172123
W3540C*                (CURRENT DATE - 84 DAYS) AND CURRENT DATE.      *00172223
P10237*                                                                *00172325
P10237* REQUIREMENT  : MAKE DL# RELATED CHANGES FOR COSA DATA SECURITY *00172425
P10237*                PROJECT                                         *00172525
P10237* PROJECT ID   : P10237                                          *00172625
P10237* AUTHOR       : COGNIZANT                                       *00172725
P10237* DATE CHANGED : 15-JUN-2015                                     *00172825
P10237* CHANGES MADE : CHANGES MADE TO CONVERT THE DL# FROM            *00172925
P10237*                SVT_KOHLS_CRD_TXN TABLE TO ASCII FORMAT, THEN   *00173025
P10237*                ENCRYPT THIS ASCII VALUE USING PROTEGRITY MODULE*00173125
P10237*                AND THEN CONVERT THE ENCRYPTED DL# FROM BINARY  *00173225
P10237*                TO BASE-64 FORMAT AND CHANGES TO ACCOMMODATE    *00173325
P10237*                THE ENCRYPTED DL#.                              *00173425
P10237* WR/IR #      : CHG0104429                                      *00173525
      ******************************************************************00173637
P10237* PROJECT ID   : CHG0141575                                      *00173938
      * AUTHOR       : ACCENTURE                                        00174037
P10237* DATE CHANGED : 17-MAY-2016                                     *00174137
P10237* CHANGES MADE : RECOMPILE FOR SVWS004 AND SVRD022               *00174237
      ******************************************************************00174337
P12431* PROJECT ID   : CHG0208643                                      *00174443
P12431* AUTHOR       : COGNIZANT                                        00174543
P12431* DATE CHANGED : 03-SEP-2018                                     *00174643
P12431* CHANGES MADE : MODIFIED THE PROGRAM TO HANDLE NEWLY ADDED      *00174743
P12431*                ORD_NBR FIELD IN THE SVT TABLES.                *00174843
P12431******************************************************************00174943
001700******************************************************************00176043
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000                                                                  00200000
002100 CONFIGURATION SECTION.                                           00210000
002200                                                                  00220000
002300 SOURCE-COMPUTER.    IBM-3090.                                    00230000
002400 OBJECT-COMPUTER.    IBM-3090.                                    00240000
002500                                                                  00250000
002600 INPUT-OUTPUT SECTION.                                            00260000
002700                                                                  00270000
002800 FILE-CONTROL.                                                    00280000
002900                                                                  00290000
003000     SELECT KMC-DAILY-ACTIVITY   ASSIGN TO OUT01.                 00300000
003100     SELECT CONTROL-DATE-FILE    ASSIGN TO INP01.                 00310000
003200                                                                  00320000
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500******************************************************************00350000
003600                                                                  00360000
003700 FILE SECTION.                                                    00370000
003800                                                                  00380000
003900 FD  KMC-DAILY-ACTIVITY                                           00390000
004000     RECORDING MODE IS F                                          00400000
004100     BLOCK CONTAINS 0 RECORDS                                     00410000
004200     LABEL RECORDS ARE OMITTED.                                   00420000
004300                                                                  00430000
P12431 01  KMC-DAILY-RECORD            PIC  X(198).                     00441041
004500                                                                  00450000
004600 FD  CONTROL-DATE-FILE                                            00460000
004700     RECORDING MODE IS F                                          00470000
004800     BLOCK CONTAINS 0 RECORDS                                     00480000
004900     LABEL RECORDS ARE OMITTED.                                   00490000
005000                                                                  00500000
005100 01  CONTROL-DATE-RECORD         PIC  X(80).                      00510000
005200                                                                  00520000
005300 WORKING-STORAGE SECTION.                                         00530000
005400                                                                  00540000
005500 01  ABEND-CODE                  PIC S9(04)     VALUE +0  COMP.   00550000
005600                                                                  00560000
005700******************************************************************00570000
005800*    CR-CONTROL RECORD                                           *00580000
005900******************************************************************00590000
W3540C                                                                  00680109
W3540C 01  CR-CONTROL-RECORD.                                           00681006
W3540C     05  CR-CONTROL-BEG-TS.                                       00682006
W3540C         10  CR-CONTROL-BEG-DATE.                                 00683006
W3540C             15  CR-CONTROL-BEG-DATE-CC  PIC  X(02) VALUE SPACES. 00684006
W3540C             15  CR-CONTROL-BEG-DATE-YY  PIC  X(02) VALUE SPACES. 00685006
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00686006
W3540C             15  CR-CONTROL-BEG-DATE-MM  PIC  X(02) VALUE SPACES. 00687006
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00688006
W3540C             15  CR-CONTROL-BEG-DATE-DD  PIC  X(02) VALUE SPACES. 00689006
W3540C         10  FILLER                      PIC  X(01) VALUE SPACES. 00689106
W3540C         10  CR-CONTROL-BEG-TIME.                                 00689206
W3540C             15  CR-CONTROL-BEG-TIME-HH  PIC  X(02) VALUE SPACES. 00689306
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00689406
W3540C             15  CR-CONTROL-BEG-TIME-MM  PIC  X(02) VALUE SPACES. 00689506
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00689606
W3540C             15  CR-CONTROL-BEG-TIME-SS  PIC  X(02) VALUE SPACES. 00689706
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00689806
W3540C             15  CR-CONTROL-BEG-TIME-TT  PIC  X(06) VALUE SPACES. 00689906
W3540C     05  FILLER                          PIC  X(01) VALUE SPACES. 00690006
W3540C     05  CR-CONTROL-END-TS.                                       00690106
W3540C         10  CR-CONTROL-END-DATE.                                 00690206
W3540C             15  CR-CONTROL-END-DATE-YY  PIC  X(04) VALUE SPACES. 00690506
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00690606
W3540C             15  CR-CONTROL-END-DATE-MM  PIC  X(02) VALUE SPACES. 00690706
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00690806
W3540C             15  CR-CONTROL-END-DATE-DD  PIC  X(02) VALUE SPACES. 00690906
W3540C         10  FILLER                      PIC  X(01) VALUE SPACES. 00691006
W3540C         10  CR-CONTROL-END-TIME.                                 00691106
W3540C             15  CR-CONTROL-END-TIME-HH  PIC  X(02) VALUE SPACES. 00691206
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00691306
W3540C             15  CR-CONTROL-END-TIME-MM  PIC  X(02) VALUE SPACES. 00691406
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00691506
W3540C             15  CR-CONTROL-END-TIME-SS  PIC  X(02) VALUE SPACES. 00691606
W3540C             15  FILLER                  PIC  X(01) VALUE SPACES. 00691706
W3540C             15  CR-CONTROL-END-TIME-TT  PIC  X(06) VALUE SPACES. 00691806
W3540C     05  FILLER                          PIC  X(01) VALUE SPACES. 00691917
W3540C     05  CR-CONTROL-REST-IND             PIC  X(01) VALUE SPACES. 00692018
W3540C     05  FILLER                          PIC  X(25) VALUE SPACES. 00692117
006900                                                                  00693017
007000******************************************************************00700000
007100*    PC-PROGRAM CONSTANTS                                        *00710000
007200******************************************************************00720000
007300 01  PC-PROGRAM-CONSTANTS.                                        00730000
007400     05  PC-PROGRAM-NAME         PIC X(08)      VALUE 'SVKUT003'. 00740000
P10237     05  PC-DPKUT052             PIC X(08)      VALUE 'DPKUT052'. 00741033
007500     05  PC-JOB-NAME             PIC X(08)      VALUE 'SVK065  '. 00750000
007600     05  PC-DAYS-TO-INCREMENT    PIC 9(04)      VALUE 1.          00760000
007700     05  PC-DAYS-TO-DECREMENT    PIC 9(04)      VALUE 84.         00770000
007800                                                                  00780000
007900******************************************************************00790000
008000*    PV-PROGRAM VARIABLES                                        *00800000
008100******************************************************************00810000
008200 01  PV-PROGRAM-VARIABLES.                                        00820000
008300     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.00830000
008400     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.00840000
008500                                                                  00850000
008600     05  PV-CARD-BALANCE              PIC S9(07)V9(02)            00860000
008700                                                     VALUE ZEROES 00870000
008800                                                     COMP-3.      00880000
P10237     05  PV-ASCII                     PIC  X(21).                 00881024
P10237     05  PV-DL-LENGTH                 PIC  9(09)     VALUE ZEROES.00882033
P10237     05  PV-INPUT-TEXT                PIC  X(34).                 00883028
P10237     05  PV-OUTPUT-TEXT               PIC  X(48)     VALUE SPACES.00884028
P12431     05  PV-ORD-NBR-NULL-IND          PIC S9(04) COMP VALUE +0.   00885041
008900                                                                  00890000
W3540C     05  PV-BEGIN-TIMESTAMP-DTL.                                  01061007
W3540C         10  PV-BEGIN-DATE.                                       01062007
W3540C             15  PV-BEGIN-DATE-CC     PIC  X(02).                 01063007
W3540C             15  PV-BEGIN-DATE-YY     PIC  X(02).                 01064011
W3540C             15  FILLER               PIC  X(01).                 01065011
W3540C             15  PV-BEGIN-DATE-MM     PIC  X(02).                 01066011
W3540C             15  FILLER               PIC  X(01).                 01067011
W3540C             15  PV-BEGIN-DATE-DD     PIC  X(02).                 01068011
W3540C         10  FILLER                   PIC  X(01).                 01069007
W3540C         10  PV-BEGIN-TIME.                                       01069107
W3540C             15  PV-BEGIN-TIME-HH     PIC  X(02).                 01069207
W3540C             15  FILLER               PIC  X(01).                 01069307
W3540C             15  PV-BEGIN-TIME-MM     PIC  X(02).                 01069407
W3540C             15  FILLER               PIC  X(01).                 01069507
W3540C             15  PV-BEGIN-TIME-SS     PIC  X(02).                 01069607
W3540C             15  FILLER               PIC  X(01).                 01069707
W3540C             15  PV-BEGIN-TIME-TTTTTT PIC  X(06).                 01069807
W3540C                                                                  01069907
W3540C     05  PV-BEGIN-TIMESTAMP REDEFINES PV-BEGIN-TIMESTAMP-DTL      01070007
W3540C                                      PIC  X(26).                 01070107
010700                                                                  01071000
W3540C     05  PV-END-TIMESTAMP-DTL.                                    01241007
W3540C         10  PV-END-DATE.                                         01242007
W3540C             15  PV-END-DATE-YYYY     PIC  X(04).                 01244008
W3540C             15  FILLER               PIC  X(01).                 01245008
W3540C             15  PV-END-DATE-MM       PIC  X(02).                 01246008
W3540C             15  FILLER               PIC  X(01).                 01247008
W3540C             15  PV-END-DATE-DD       PIC  X(02).                 01248008
W3540C         10  FILLER                   PIC  X(01).                 01249007
W3540C         10  PV-END-TIME.                                         01249107
W3540C             15  PV-END-TIME-HH       PIC  X(02).                 01249207
W3540C             15  FILLER               PIC  X(01).                 01249307
W3540C             15  PV-END-TIME-MM       PIC  X(02).                 01249407
W3540C             15  FILLER               PIC  X(01).                 01249507
W3540C             15  PV-END-TIME-SS       PIC  X(02).                 01249607
W3540C             15  FILLER               PIC  X(01).                 01249707
W3540C             15  PV-END-TIME-TTTTTT   PIC  X(06).                 01249807
W3540C                                                                  01250007
W3540C     05  PV-END-TIMESTAMP REDEFINES                               01251007
W3540C         PV-END-TIMESTAMP-DTL   PIC  X(26).                       01252007
W3540C                                                                  01253007
W3540C     05  PV-TEMP-TIMESTAMP.                                       01254007
W3540C         10  PV-TEMP-DATE.                                        01255007
W3540C             15  PV-TEMP-DATE-CC      PIC  X(02).                 01256007
W3540C             15  PV-TEMP-DATE-YY      PIC  X(02).                 01257010
W3540C             15  FILLER               PIC  X(01).                 01258010
W3540C             15  PV-TEMP-DATE-MM      PIC  X(02).                 01259010
W3540C             15  FILLER               PIC  X(01).                 01259110
W3540C             15  PV-TEMP-DATE-DD      PIC  X(02).                 01259210
W3540C         10  FILLER                   PIC  X(01).                 01259307
W3540C         10  PV-TEMP-TIME.                                        01259407
W3540C             15  PV-TEMP-TIME-HH      PIC  X(02).                 01259507
W3540C             15  FILLER               PIC  X(01).                 01259607
W3540C             15  PV-TEMP-TIME-MM      PIC  X(02).                 01259707
W3540C             15  FILLER               PIC  X(01).                 01259807
W3540C             15  PV-TEMP-TIME-SS      PIC  X(02).                 01259907
W3540C             15  FILLER               PIC  X(01).                 01260007
W3540C             15  PV-TEMP-TIME-TTTTTT  PIC  X(06).                 01260107
W3540C                                                                  01260209
012600     05  PV-DATE-RETURNED-FROM-ROUTINE.                           01261000
012700         10  PV-DATE-RETURNED-CCYY    PIC  X(04)     VALUE ZERO.  01270000
012800         10  FILLER                   PIC  X(01)     VALUE '-'.   01280000
012900         10  PV-DATE-RETURNED-MM      PIC  X(02)     VALUE ZERO.  01290000
013000         10  FILLER                   PIC  X(01)     VALUE '-'.   01300000
013100         10  PV-DATE-RETURNED-DD      PIC  X(02)     VALUE ZERO.  01310000
013200                                                                  01320000
013300******************************************************************01330000
013400*    PS-PROGRAM SWITCHES                                         *01340000
013500******************************************************************01350000
013600 01  PS-PROGRAM-SWITCHES.                                         01360000
013700     05  PS-END-OF-ECOMM-CSR-SW       PIC  X(01)     VALUE 'N'.   01370000
013800         88  PS-END-OF-ECOMM-CURSOR                  VALUE 'Y'.   01380000
013900                                                                  01390000
014000******************************************************************01400000
014100*    PA-PROGRAM ACCUMULATORS                                     *01410000
014200******************************************************************01420000
014300 01  PA-PROGRAM-ACCUMULATORS.                                     01430000
014400     05  PA-ACTIVITY-ROWS-FETCHED     PIC S9(11)     COMP-3       01440000
014500                                                     VALUE ZEROES.01450000
014600     05  PA-ACTIVITY-ROWS-WRITTEN     PIC S9(11)     COMP-3       01460000
014700                                                     VALUE ZEROES.01470000
014800                                                                  01480000
P10237******************************************************************01490028
P10237*    LK52- EBCDIC/ASCII DATA FORMAT CONVERSION AREA.             *01490128
P10237******************************************************************01490228
P10237 01  LK52-DPKUT052-SUBRTN-WORK-AREA.                              01490328
P10237     05  LK52-CONVERSION-TYPE         PIC  X(01).                 01490432
P10237         88  EBCDIC-TO-ASCII                         VALUE '1'.   01490532
P10237         88  ASCII-TO-EBCDIC                         VALUE '2'.   01490632
P10237     05  LK52-LENGTH                  PIC S9(03)     COMP-3.      01490732
P10237     05  LK52-FROM-AREA               PIC  X(50)     VALUE SPACES.01490832
P10237     05  LK52-TO-AREA                 PIC  X(50)     VALUE SPACES.01490932
P10237     05  LK52-RETURN-CODE             PIC  X(02)     VALUE '00'.  01491032
P10237         88  GOOD-LK52-RET-CODE                      VALUE '00'.  01491132
P10237                                                                  01491526
014900******************************************************************01492026
015000*    KMC DAILY EXTRACT RECORD LAYOUT                             *01500000
015100******************************************************************01510000
015200     COPY SVRD022.                                                01520000
015300                                                                  01530000
015400******************************************************************01540000
015500*    REFUND AUTHORIZATION CONSTANTS                              *01550000
015600******************************************************************01560000
015700     COPY SVWS004.                                                01570000
015800                                                                  01580000
015900******************************************************************01590000
016000*    DATE ROUTINE COPY MEMBERS                                   *01600000
016100******************************************************************01610000
016200     COPY DPWS500.                                                01620000
016300                                                                  01630000
016400******************************************************************01640000
016500*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *01650000
016600******************************************************************01660000
016700     COPY DPWS004.                                                01670000
016800                                                                  01680000
P10237******************************************************************01680128
P10237*  VARIABLES TO CONVERT FROM BASE64 TO BINARY & VICE VERSA       *01680228
P10237******************************************************************01680328
P10237     COPY DPWS022.                                                01680428
P10237                                                                  01680528
P10237******************************************************************01681024
P10237* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY *01682024
P10237* MODULE                                                         *01683024
P10237******************************************************************01684024
P10237     COPY PTYCCSIP.                                               01685024
P10237                                                                  01686024
P10237******************************************************************01687024
P10237* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY *01688024
P10237* MODULE                                                         *01689024
P10237******************************************************************01689124
P10237     COPY DPWS031.                                                01689233
P10237                                                                  01689324
016900******************************************************************01690000
017000*    SV-KOHL'S STORED VALUE CARD ACTIVITY TABLE                  *01700000
017100******************************************************************01710000
017200     EXEC SQL                                                     01720000
017300         INCLUDE SVT00002                                         01730000
017400     END-EXEC.                                                    01740000
017500                                                                  01750000
017600******************************************************************01760000
017700*    SV-KOHL'S STORED VALUE CARD TABLE                           *01770000
017800******************************************************************01780000
017900     EXEC SQL                                                     01790000
018000         INCLUDE SVT00001                                         01800000
018100     END-EXEC.                                                    01810000
018200                                                                  01820000
018300******************************************************************01830000
018400*  SQL AND COBOL DECLARATIONS FOR THE STORE TABLE                *01840000
018500******************************************************************01850000
018600     EXEC SQL                                                     01860000
018700         INCLUDE XST00001                                         01870000
018800     END-EXEC.                                                    01880000
018900                                                                  01890000
019000******************************************************************01900000
019100*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *01910000
019200******************************************************************01920000
019300     EXEC SQL                                                     01930000
019400         INCLUDE SQLCA                                            01940000
019500     END-EXEC.                                                    01950000
019600                                                                  01960000
019700     COPY SQLCA2.                                                 01970000
019800                                                                  01980000
019900******************************************************************01990000
020000*    CURSOR DECLARATION FOR KMC ECOMMERCE ACTIVITY CURSOR        *02000000
020100******************************************************************02010000
020200     EXEC SQL                                                     02020000
020300         DECLARE  ECOMM_ACTVY_CURSOR CURSOR FOR                   02030000
020400          SELECT  A.CRD_NBR                                       02040000
020500                 ,TRN_AUTH_TMST                                   02050000
020600                 ,DRV_LIC_NBR                                     02060000
020700                 ,TRN_RVRSL_CDE                                   02070000
020800                 ,TRN_VOID_IND                                    02080000
020900                 ,ACTVY_TYP_CDE                                   02090000
021000                 ,POS_DTE                                         02100000
021100                 ,A.STR_NBR                                       02110000
021200                 ,POS_TRMNL_NBR                                   02120000
021300                 ,POS_TRN_NBR                                     02130000
021400                 ,APP_AUTH_AMT                                    02140000
021500                 ,POS_OPRT_ID                                     02150000
P12431                 ,ORD_NBR                                         02151041
021600                 ,APVL_USR_ID                                     02160000
021700                 ,ACTVY_STAT_CDE                                  02170000
021800                 ,ORIG_AUTH_AMT                                   02180000
021900                 ,CRD_TYP_CDE                                     02190000
022000                 ,A.ST_CDE                                        02200000
022100                 ,T.CRD_SPCTY_TYP_CDE                             02201004
022100                 ,S.BALANCE                                       02210000
022200            FROM  SVT_KOHLS_CRD_TXN A,                            02220000
022300                  SVT_KOHLS_CRD_ACCT T,                           02230000
022400                  XST_LOC L                                       02240000
022500                 ,(SELECT S.CRD_NBR                               02250000
022600                         ,SUM(S.APP_AUTH_AMT) AS BALANCE          02260000
022700                     FROM SVT_KOHLS_CRD_TXN S                     02270000
022800                     GROUP BY S.CRD_NBR) AS S                     02280000
022900           WHERE  A.CRD_NBR = T.CRD_NBR                           02290000
023000              AND A.CRD_NBR = S.CRD_NBR                           02300000
023100              AND A.STR_NBR = L.LOC_NBR                           02310000
023200              AND L.E_BUS_IND = 'Y'                               02320000
023300              AND ACTVY_STAT_CDE = 1                              02330000
W3540C              AND TRN_AUTH_TMST > :PV-BEGIN-TIMESTAMP             02351009
W3540C              AND TRN_AUTH_TMST <= :PV-END-TIMESTAMP              02352009
023600              AND ACTVY_TYP_CDE <> 4                              02360000
023610              AND TRN_VOID_IND = 'N'                              02361000
023700           WITH UR                                                02370000
023800     END-EXEC.                                                    02380000
023900                                                                  02390000
024000 PROCEDURE DIVISION.                                              02400000
024100                                                                  02410000
024200******************************************************************02420000
024300 A100-MAINLINE.                                                   02430000
024400******************************************************************02440000
024500                                                                  02450000
024600     PERFORM B100-INITIALIZE.                                     02460000
024700                                                                  02470000
024800     PERFORM B250-PROCESS-ECOMM-ACTIVITY                          02480000
024900         UNTIL PS-END-OF-ECOMM-CURSOR.                            02490000
025000                                                                  02500000
025100     PERFORM C350-CLOSE-ECOMM-CURSOR                              02510000
025200                                                                  02520000
025300     PERFORM B300-EOJ-ROUTINE.                                    02530000
025400                                                                  02540000
025500     GOBACK.                                                      02550000
025600******************************************************************02560000
025700*     B100-INITIALIZE                                            *02570000
025800* ==> PROCESSES:                                                 *02580000
025900*     -READS THE DAILY SALES FILE TO GET THE DATE                *02590000
026000*     -CALLS THE DATE ROUTINE TO CALCULATE THE CENTURY FOR THE   *02600000
026100*      CURRENT DATE AND ALSO TO CALCULATE THE NEXT DAY           *02610000
026200*     -OPENS THE CURSOR FOR THE KMC ACTIVITY TABLE AND FETCHES   *02620000
026300*      THE FIRST ROW                                             *02630000
026400* ==> PERFORMED FROM: A100-MAINLINE                              *02640000
026500******************************************************************02650000
026600 B100-INITIALIZE.                                                 02660000
026700                                                                  02670000
026800     OPEN INPUT  CONTROL-DATE-FILE.                               02680000
026900     OPEN OUTPUT KMC-DAILY-ACTIVITY.                              02690000
027000                                                                  02700000
027100     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                02710000
027200         AT END                                                   02720000
027300             DISPLAY ' '                                          02730000
027400             DISPLAY '** ABEND     **'                            02740000
027500             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        02750000
027600             DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'         02760000
027700             DISPLAY '** EMPTY CONTROL FILE'                      02770000
027800             DISPLAY DPG54-ERROR-MESSAGE                          02780000
027900             DISPLAY ' '                                          02790000
028000             MOVE +4003 TO ABEND-CODE                             02800000
028100             CALL 'ILBOABN0' USING ABEND-CODE                     02810000
028200     END-READ.                                                    02820000
028300                                                                  02830000
028600                                                                  02830315
P10237     MOVE PC-PROGRAM-NAME   TO DP031-PROGRAM-NAME.                02830434
W3540C     MOVE CR-CONTROL-BEG-TS TO PV-TEMP-TIMESTAMP.                 02831009
W3540C     PERFORM C050-DATE-DECRE-ROUTINE.                             02832123
W3540C     MOVE PV-TEMP-TIMESTAMP TO PV-BEGIN-TIMESTAMP-DTL.            02832219
W3540C                                                                  02833009
W3540C     INITIALIZE PV-TEMP-TIMESTAMP.                                02833123
W3540C                                                                  02833223
W3540C     MOVE CR-CONTROL-END-TS TO PV-TEMP-TIMESTAMP.                 02834009
W3540C     PERFORM C100-DATE-ROUTINE.                                   02835009
W3540C     MOVE PV-TEMP-TIMESTAMP TO PV-END-TIMESTAMP-DTL.              02835113
W3540C                                                                  02836009
W3540C     DISPLAY PC-PROGRAM-NAME ' DATE FROM: ' PV-BEGIN-TIMESTAMP-DTL02840014
W3540C             ' TO: ' PV-END-TIMESTAMP-DTL.                        02850009
028600                                                                  02860000
028900     PERFORM C250-OPEN-ECOMM-CURSOR.                              02890000
029000                                                                  02900000
029100     PERFORM D150-FETCH-ECOMM-CURSOR.                             02910000
029200                                                                  02920000
029300******************************************************************02930000
029400*     B250-PROCESS-ECOMM-ACTIVITY                                *02940000
029500* ==> PROCESSES:                                                 *02950000
029600*     -FETCHES THE NEXT ROW FROM THE CURSOR                      *02960000
029700* ==> PERFORMED FROM: A100-MAINLINE                              *02970000
029800******************************************************************02980000
029900 B250-PROCESS-ECOMM-ACTIVITY.                                     02990000
030000                                                                  03000000
030100     PERFORM E200-WRITE-SVT00002-ACTIVITY                         03010000
030200     PERFORM D150-FETCH-ECOMM-CURSOR.                             03020000
030300                                                                  03030000
030400******************************************************************03040000
030500*     B300-EOJ-ROUTINE                                           *03050000
030600* ==> PROCESSES:                                                 *03060000
030700*     -CLOSES THE KMC ACTIVITY CURSOR                            *03070000
030800* ==> PERFORMED FROM: A100-MAINLINE                              *03080000
030900******************************************************************03090000
031000 B300-EOJ-ROUTINE.                                                03100000
031100                                                                  03110000
031200     CLOSE CONTROL-DATE-FILE                                      03120000
031300           KMC-DAILY-ACTIVITY.                                    03130000
031400                                                                  03140000
031500     DISPLAY ' '.                                                 03150000
031600     DISPLAY PC-PROGRAM-NAME                                      03160000
031700             '  ROWS FETCHED FROM SVT_KOHLS_CRD_TXN  '            03170000
031800                                        PA-ACTIVITY-ROWS-FETCHED. 03180000
031900     DISPLAY PC-PROGRAM-NAME '  ROWS WRITTEN TO OUTPUT FILE:  '   03190000
032000                                        PA-ACTIVITY-ROWS-WRITTEN. 03200000
032100     DISPLAY ' '.                                                 03210000
032200                                                                  03220000
W3540C******************************************************************03230023
W3540C*     C050-DATE-DECRE-ROUTINE.                                   *03240023
W3540C* ==> PROCESSES:                                                 *03250023
W3540C*     - DECREMENT 84 DAYS FROM THE BEGIN DATE IN THE CONTROL     *03260023
W3540C*       CARD FILE AND ALSO VALIDATES IT.                         *03261023
W3540C* ==> PERFORMED FROM: B100-INITIALIZE                            *03270023
W3540C******************************************************************03280023
W3540C C050-DATE-DECRE-ROUTINE.                                         03290023
W3540C                                                                  03300023
W3540C     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03310023
W3540C                                                                  03320023
W3540C     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   03330023
W3540C     SET  DPG51-DECREMENT-DATE         TO TRUE.                   03340023
W3540C     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   03360023
W3540C     MOVE PC-DAYS-TO-DECREMENT         TO DPG51-INCR-DECR-DAYS-9. 03361023
W3540C     MOVE PV-TEMP-DATE                 TO DPG52-LK-DATE-INPUT.    03370023
W3540C                                                                  03371023
W3540C     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03380023
W3540C                                             DPG54 DPG55 DPG56.   03390023
W3540C     EVALUATE TRUE                                                03400023
W3540C         WHEN DPG54-SEVERE-ERROR                                  03410023
W3540C         WHEN DPG54-DATE-INVALID                                  03420023
W3540C             DISPLAY ' '                                          03430023
W3540C             DISPLAY '** ABEND     **'                            03440023
W3540C             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        03450023
W3540C             DISPLAY '** PARAGRAPH **  = C050-DATE-DECRE'         03460023
W3540C             DISPLAY '** BAD CALL TO CALENDAR MODULE '            03470023
W3540C             DISPLAY '** FOR BEGIN DATE VALIDATION    '           03480023
W3540C             DISPLAY DPG54-ERROR-MESSAGE                          03490023
W3540C             DISPLAY ' '                                          03491023
W3540C             MOVE +4019 TO ABEND-CODE                             03492023
W3540C             CALL 'ILBOABN0' USING ABEND-CODE                     03493023
W3540C     END-EVALUATE.                                                03500023
W3540C                                                                  03510023
W3540C     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-TEMP-DATE.           03530023
W3540C                                                                  03540023
W3540C     MOVE '00'                         TO PV-TEMP-TIME-HH         03700023
W3540C                                          PV-TEMP-TIME-MM         03700123
W3540C                                          PV-TEMP-TIME-SS.        03700223
W3540C                                                                  03700323
W3540C     MOVE '000000'                     TO PV-TEMP-TIME-TTTTTT.    03700423
W3540C                                                                  03701023
032300******************************************************************03710019
032400*     C100-DATE-ROUTINE.                                         *03720019
032500* ==> PROCESSES:                                                 *03730019
032600*     -VALIDATES THE DATE INPUT ON THE CONTROL FILE              *03740019
032700* ==> PERFORMED FROM: B100-INITIALIZE                            *03740119
032800******************************************************************03740219
032900 C100-DATE-ROUTINE.                                               03740319
033000                                                                  03740419
037000                                                                  03740519
W3540C******************************************************************03741015
W3540C** VALIDATING THE INPUT DATES.                                    03742015
W3540C******************************************************************03743015
W3540C                                                                  03744015
037500     INITIALIZE DPG51 DPG52 DPG53                                 03750015
037600                DPG54 DPG55 DPG56.                                03760015
037700                                                                  03770015
037800     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      03780015
W3540C     MOVE PV-TEMP-DATE              TO DPG52-LK-DATE-INPUT.       03831015
038400     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      03840015
038500                                                                  03850000
038600     CALL DP500-KOHLS-CALENDAR-ROUTINE                            03860000
038700       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 03870000
038800                                                                  03880000
038900     EVALUATE TRUE                                                03890000
039000         WHEN DPG54-SEVERE-ERROR                                  03900000
039100         WHEN DPG54-DATE-INVALID                                  03910000
039200             DISPLAY ' '                                          03920000
039300             DISPLAY '** ABEND     **'                            03930000
039400             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        03940000
039500             DISPLAY '** PARAGRAPH **  = C100-DATE-ROUTI'         03950000
039600             DISPLAY '** BAD CALL TO CALENDAR MODULE '            03960000
W3540C             DISPLAY '** FOR END DATE VALIDATION    '             03971023
039800             DISPLAY DPG54-ERROR-MESSAGE                          03980000
039900             DISPLAY ' '                                          03990000
040000             MOVE +4019 TO ABEND-CODE                             04000000
040100             CALL 'ILBOABN0' USING ABEND-CODE                     04010000
040200     END-EVALUATE.                                                04020000
040300                                                                  04030000
041100                                                                  04110000
041200                                                                  04120000
041300******************************************************************04130000
041400*     C250-OPEN-ECOMM-CURSOR.                                    *04140000
041500* ==> PROCESSES:                                                 *04150000
041600*     -OPENS THE ECOMM ACTIVITY CURSOR                           *04160000
041700* ==> PERFORMED FROM: B100-INITIALIZE                            *04170000
041800******************************************************************04180000
041900 C250-OPEN-ECOMM-CURSOR.                                          04190000
042000                                                                  04200000
042100     EXEC SQL                                                     04210000
042200         OPEN ECOMM_ACTVY_CURSOR                                  04220000
042300     END-EXEC.                                                    04230000
042400                                                                  04240000
042500     EVALUATE TRUE                                                04250000
042600         WHEN SQLCODE = +0                                        04260000
042700             CONTINUE                                             04270000
042800         WHEN OTHER                                               04280000
042900             MOVE 'C250-OPEN-ECOMM-CURSOR       '                 04290000
043000                               TO PV-PARAGRAPH-NAME               04300000
043100             MOVE 'OPEN ECOMM ACTIVITY CURSOR      '              04310000
043200                               TO PV-DB2-OPERATION-ATTEMPTED      04320000
043300             PERFORM Z900-SQL-ABEND                               04330000
043400     END-EVALUATE.                                                04340000
043500                                                                  04350000
043600******************************************************************04360000
043700*     C350-CLOSE-ECOMM-CURSOR.                                   *04370000
043800* ==> PROCESSES:                                                 *04380000
043900*     -CLOSES THE ECOMM ACTIVITY CURSOR                          *04390000
044000* ==> PERFORMED FROM: B300-EOJ-ROUTINE                           *04400000
044100******************************************************************04410000
044200 C350-CLOSE-ECOMM-CURSOR.                                         04420000
044300                                                                  04430000
044400     EXEC SQL                                                     04440000
044500         CLOSE ECOMM_ACTVY_CURSOR                                 04450000
044600     END-EXEC.                                                    04460000
044700                                                                  04470000
044800     EVALUATE TRUE                                                04480000
044900         WHEN SQLCODE = +0                                        04490000
045000             CONTINUE                                             04500000
045100         WHEN OTHER                                               04510000
045200             MOVE 'C350-CLOSE-ECOMM-CURSOR      '                 04520000
045300                               TO PV-PARAGRAPH-NAME               04530000
045400             MOVE 'CLOSE ECOMM ACTIVITY CURSOR     '              04540000
045500                               TO PV-DB2-OPERATION-ATTEMPTED      04550000
045600             PERFORM Z900-SQL-ABEND                               04560000
045700     END-EVALUATE.                                                04570000
045800                                                                  04580000
045900******************************************************************04590000
046000*     D150-FETCH-ECOMM-CURSOR.                                   *04600000
046100* ==> PROCESSES:                                                 *04610000
046200*     -FETCHES A ROW FROM THE KMC ACTIVITY CURSOR                *04620000
046300* ==> PERFORMED FROM: B100-INITIALIZE                            *04630000
046400*                     B200-PROCESS-CARD-ACTIVITY                 *04640000
046500******************************************************************04650000
046600 D150-FETCH-ECOMM-CURSOR.                                         04660000
046700                                                                  04670000
P12431      MOVE 0 TO PV-ORD-NBR-NULL-IND.                              04671041
P12431      MOVE SPACES TO SVT00002-ORD-NBR-TEXT.                       04672041
P12431                                                                  04673041
046800     EXEC SQL                                                     04680000
046900         FETCH  ECOMM_ACTVY_CURSOR                                04690000
047000          INTO  :SVT00002-CRD-NBR                                 04700000
047100               ,:SVT00002-TRN-AUTH-TMST                           04710000
047200               ,:SVT00002-DRV-LIC-NBR                             04720000
047300               ,:SVT00002-TRN-RVRSL-CDE                           04730000
047400               ,:SVT00002-TRN-VOID-IND                            04740000
047500               ,:SVT00002-ACTVY-TYP-CDE                           04750000
047600               ,:SVT00002-POS-DTE                                 04760000
047700               ,:SVT00002-STR-NBR                                 04770000
047800               ,:SVT00002-POS-TRMNL-NBR                           04780000
047900               ,:SVT00002-POS-TRN-NBR                             04790000
048000               ,:SVT00002-APP-AUTH-AMT                            04800000
048100               ,:SVT00002-POS-OPRT-ID                             04810000
P12431               ,:SVT00002-ORD-NBR :PV-ORD-NBR-NULL-IND            04811041
048200               ,:SVT00002-APVL-USR-ID                             04820000
048300               ,:SVT00002-ACTVY-STAT-CDE                          04830000
048400               ,:SVT00002-ORIG-AUTH-AMT                           04840000
048500               ,:SVT00001-CRD-TYP-CDE                             04850000
048600               ,:SVT00002-ST-CDE                                  04860000
048700               ,:SVT00001-CRD-SPCTY-TYP-CDE                       04861004
048700               ,:PV-CARD-BALANCE                                  04870000
048800     END-EXEC.                                                    04880000
048900                                                                  04890000
049000     EVALUATE TRUE                                                04900000
049100         WHEN SQLCODE = +0                                        04910000
049200             ADD +1 TO PA-ACTIVITY-ROWS-FETCHED                   04920000
049300         WHEN SQLCODE = +100                                      04930000
049400             SET PS-END-OF-ECOMM-CURSOR                           04940000
049500                               TO TRUE                            04950000
049600         WHEN OTHER                                               04960000
049700             MOVE 'D150-FETCH-ECOMM-CURSOR      '                 04970000
049800                               TO PV-PARAGRAPH-NAME               04980000
049900             MOVE 'FETCH ECOMM ACTIVITY CURSOR     '              04990000
050000                               TO PV-DB2-OPERATION-ATTEMPTED      05000000
050100             PERFORM Z900-SQL-ABEND                               05010000
050200     END-EVALUATE.                                                05020000
050300                                                                  05030000
050400******************************************************************05040000
050500*     E200-WRITE-SVT00002-ACTIVITY                               *05050000
050600* ==> PROCESSES:                                                 *05060000
050700*     -WRITES THE OUTPUT RECORD                                  *05070000
050800*     -THE EXTRACT FILE WILL NOT PASS THE VOID INDICATOR FOR     *05080000
050900*      THOSE TRANSACTIONS WHICH ARE ORIGINAL TRANSACTIONS WHICH  *05090000
051000*      WERE VOIDED.  THIS IS BECAUSE THE POS FILE WILL NOT PASS  *05100000
051100*      THE VOID INDICATOR ON THE ORIGINAL TRANSACTION, JUST ON   *05110000
051200*      THE VOID.                                                 *05120000
051300* ==> PERFORMED FROM:  D100-FETCH-SVT00002-CURSOR                *05130000
051400******************************************************************05140000
051500 E200-WRITE-SVT00002-ACTIVITY.                                    05150000
051600                                                                  05160000
051700     INITIALIZE SV022-KMCACT-EXTRACT-RECORD.                      05170000
051800                                                                  05180000
051900     MOVE SVT00001-CRD-TYP-CDE  TO SV022-CRD-TYP-CDE.             05190000
052000     MOVE SVT00002-CRD-NBR      TO SV022-CRD-NBR.                 05200000
P10237     IF SVT00002-DRV-LIC-NBR NOT EQUAL SPACES                     05211024
P10237         PERFORM E210-EBCDIC-ASCII                                05212024
P10237         PERFORM E220-ENCRYPT-DL                                  05213024
P10237         PERFORM E230-BINARY-BASE64                               05214024
P10237         MOVE PV-OUTPUT-TEXT    TO SV022-DRV-LIC-NBR              05215028
P10237     ELSE                                                         05216024
P10237         MOVE SPACES            TO SV022-DRV-LIC-NBR              05217024
P10237     END-IF                                                       05218024
052200     IF (SVT00002-TRN-RVRSL-CDE = SV004-REV-CDE-NORMAL            05220000
052300     AND SVT00002-TRN-VOID-IND = SV004-VOID-TRANS)                05230000
052400         MOVE 'N'               TO SV022-TRN-VOID-IND             05240000
052500     ELSE                                                         05250000
052600         MOVE SVT00002-TRN-VOID-IND                               05260000
052700                                TO SV022-TRN-VOID-IND             05270000
052800     END-IF.                                                      05280000
052900     MOVE SVT00002-TRN-RVRSL-CDE TO SV022-TRN-RVRSL-CDE.          05290000
053000     MOVE SVT00002-ACTVY-TYP-CDE TO SV022-ACTVY-TYP-CDE.          05300000
053100     MOVE SVT00002-TRN-AUTH-TMST TO SV022-TRN-AUTH-TMST.          05310000
053200     MOVE SVT00002-POS-DTE      TO SV022-POS-DTE.                 05320000
053300     MOVE SVT00002-STR-NBR      TO SV022-STR-NBR.                 05330000
053400     MOVE SVT00002-POS-TRMNL-NBR TO SV022-TRMNL-NBR.              05340000
053500     MOVE SVT00002-POS-TRN-NBR  TO SV022-TRN-NBR.                 05350000
053600     MOVE SVT00002-APP-AUTH-AMT TO SV022-APP-AUTH-AMT.            05360000
053700     MOVE SVT00002-ACTVY-STAT-CDE TO SV022-ACTVY-STAT-CDE.        05370000
053800     MOVE SVT00002-ORIG-AUTH-AMT TO SV022-ORIG-AUTH-AMT.          05380000
053900     MOVE SVT00002-POS-OPRT-ID  TO SV022-POS-OPER-ID.             05390000
P12431     IF PV-ORD-NBR-NULL-IND < +0                                  05391041
P12431        MOVE SPACES                TO SV022-ORD-NBR               05392041
P12431     ELSE                                                         05393041
P12431        MOVE SVT00002-ORD-NBR-TEXT TO SV022-ORD-NBR               05394041
P12431     END-IF.                                                      05395041
054000     MOVE SVT00002-APVL-USR-ID  TO SV022-APPR-USER-ID.            05400000
054100     MOVE SVT00002-ST-CDE       TO SV022-ST-CDE.                  05410003
054100     MOVE SVT00001-CRD-SPCTY-TYP-CDE TO SV022-CRD-SPCTY-TYP-CDE.  05412005
054200     IF PV-CARD-BALANCE NEGATIVE                                  05420000
054300         SET SV022-OVERTENDERED                                   05430000
054400                                TO TRUE                           05440000
054500     ELSE                                                         05450000
054600         SET SV022-NOT-OVER TO TRUE                               05460000
054700     END-IF.                                                      05470000
054800                                                                  05480000
054900     WRITE KMC-DAILY-RECORD                                       05490000
055000         FROM SV022-KMCACT-EXTRACT-RECORD.                        05500000
055100                                                                  05510000
055200     ADD +1 TO PA-ACTIVITY-ROWS-WRITTEN.                          05520000
055300                                                                  05530000
P10237******************************************************************05531024
P10237*     E210-EBCDIC-ASCII                                          *05532024
P10237* ==> PROCESSES:                                                 *05533024
P10237*     - CONVERTS THE DATA FROM EBCDIC TO ASCII FORMAT            *05534024
P10237* ==> PERFORMED FROM:  E200-WRITE-SVT00002-ACTIVITY              *05535024
P10237******************************************************************05536024
P10237 E210-EBCDIC-ASCII.                                               05537024
P10237     INITIALIZE LK52-DPKUT052-SUBRTN-WORK-AREA                    05538028
P10237                PV-ASCII                                          05539028
P10237                PV-DL-LENGTH.                                     05539128
P10237                                                                  05539228
P10237     INSPECT FUNCTION REVERSE(SVT00002-DRV-LIC-NBR)               05539531
P10237          TALLYING PV-DL-LENGTH FOR LEADING SPACES.               05539631
P10237     COMPUTE PV-DL-LENGTH = 21 - PV-DL-LENGTH.                    05539731
P10237     SET  EBCDIC-TO-ASCII       TO TRUE.                          05539828
P10237     MOVE SVT00002-DRV-LIC-NBR  TO LK52-FROM-AREA.                05539928
P10237     MOVE PV-DL-LENGTH          TO LK52-LENGTH.                   05540028
P10237                                                                  05540128
P10237     CALL PC-DPKUT052       USING LK52-CONVERSION-TYPE            05540233
P10237                                  LK52-LENGTH                     05540328
P10237                                  LK52-FROM-AREA                  05540428
P10237                                  LK52-TO-AREA                    05540528
P10237                                  LK52-RETURN-CODE.               05540628
P10237     IF GOOD-LK52-RET-CODE                                        05540728
P10237        MOVE LK52-TO-AREA       TO PV-ASCII                       05540828
P10237     ELSE                                                         05540924
P10237        DISPLAY 'ERROR WHILE CONVERTING DL# TO ASCII'             05541135
P10237        DISPLAY 'RETURN CODE     - ' LK52-RETURN-CODE             05541236
P10237        DISPLAY 'STORE-NBR       - ' SVT00002-STR-NBR             05541335
P10237        DISPLAY 'POS-DATE        - ' SVT00002-POS-DTE             05541435
P10237        DISPLAY 'TERMINAL-NBR    - ' SVT00002-POS-TRMNL-NBR       05541535
P10237        DISPLAY 'TRANSACTION-NBR - ' SVT00002-POS-TRN-NBR         05541635
P10237        DISPLAY 'INPUT DL LENGTH - ' PV-DL-LENGTH                 05541735
P10237        MOVE +4008 TO ABEND-CODE                                  05541835
P10237        CALL 'ILBOABN0' USING ABEND-CODE                          05541939
P10237     END-IF.                                                      05542035
P10237                                                                  05542135
P10237******************************************************************05542235
P10237*     E220-ENCRYPT-DL                                             05542335
P10237* ==> PROCESSES:                                                 *05542435
P10237*     - CALLS THE PROTEGRITY MODULE TO ENCRYPT THE DL#           *05542535
P10237*     - RETURNED DL# WILL BE IN BINARY FORMAT                    *05542635
P10237* ==> PERFORMED FROM:  E200-WRITE-SVT00002-ACTIVITY              *05542735
P10237******************************************************************05542835
P10237 E220-ENCRYPT-DL.                                                 05542935
P10237     INITIALIZE CSI-PARAMETERS                                    05543035
P10237                DP031-PROTEG-PGM-PARAMETERS.                      05543135
P10237     MOVE 'DRIVER-LICENSE'        TO DP031-FIELD.                 05543235
P10237     SET CSI-ENCRYPT-FUNCTION     TO TRUE.                        05543335
P10237     SET DP031-IDNBR              TO TRUE.                        05543435
P10237     MOVE LK52-LENGTH             TO CSI-CLEAR-TEXT-LENGTH.       05543535
P10237     MOVE 34                      TO CSI-CIPHER-TEXT-LENGTH.      05543635
P10237     MOVE PV-ASCII                TO DP031-CLEAR-TEXT.            05543735
P10237     PERFORM DP031-1000-PROTG-ENCRYP-DECRYP.                      05543835
P10237     IF CSI-RETURN-CODE NOT = ZERO                                05543935
P10237        DISPLAY 'ABEND IN THE FOLLOWING RECORD'                   05544035
P10237        DISPLAY 'STORE-NBR       - ' SVT00002-STR-NBR             05544135
P10237        DISPLAY 'POS-DATE        - ' SVT00002-POS-DTE             05544235
P10237        DISPLAY 'TERMINAL-NBR    - ' SVT00002-POS-TRMNL-NBR       05544335
P10237        DISPLAY 'TRANSACTION-NBR - ' SVT00002-POS-TRN-NBR         05544435
P10237        DISPLAY 'INPUT DL LENGTH - ' PV-DL-LENGTH                 05544535
P10237        PERFORM DP031-9999-ABEND                                  05544635
P10237     END-IF.                                                      05544735
P10237                                                                  05544835
P10237******************************************************************05544935
P10237*     E230-BINARY-BASE64                                         *05545035
P10237* ==> PROCESSES:                                                 *05545135
P10237*     - CONVERTS THE DATA FROM BINARY TO BASE64 FORMAT           *05545235
P10237* ==> PERFORMED FROM:  E200-WRITE-SVT00002-ACTIVITY              *05545335
P10237******************************************************************05545435
P10237 E230-BINARY-BASE64.                                              05545535
P10237     INITIALIZE PV-INPUT-TEXT                                     05545635
P10237                PV-OUTPUT-TEXT.                                   05545735
P10237     MOVE DP031-CIPHER-TEXT      TO PV-INPUT-TEXT.                05545835
P10237     MOVE CSI-CIPHER-TEXT-LENGTH TO DP022-INLEN.                  05545935
P10237     MOVE 48                     TO DP022-OUTLEN-IN.              05546035
P10237     CALL  DP022-MGCXB2R  USING DP022-PARMS,                      05546135
P10237                                PV-INPUT-TEXT,                    05546235
P10237                                PV-OUTPUT-TEXT.                   05546335
P10237     IF RETURN-CODE NOT EQUAL 0                                   05546435
P10237        DISPLAY 'ERROR WHILE CONVERTING DL# TO BASE64'            05546635
P10237        DISPLAY 'RETURN CODE     - ' RETURN-CODE                  05546736
P10237        DISPLAY 'STORE-NBR       - ' SVT00002-STR-NBR             05546835
P10237        DISPLAY 'POS-DATE        - ' SVT00002-POS-DTE             05546935
P10237        DISPLAY 'TERMINAL-NBR    - ' SVT00002-POS-TRMNL-NBR       05547035
P10237        DISPLAY 'TRANSACTION-NBR - ' SVT00002-POS-TRN-NBR         05547135
P10237        DISPLAY 'INPUT DL LENGTH - ' PV-DL-LENGTH                 05547235
P10237        MOVE +4008 TO ABEND-CODE                                  05547335
P10237        CALL 'ILBOABN0' USING ABEND-CODE                          05547439
P10237     END-IF.                                                      05547535
P10237                                                                  05547635
055400******************************************************************05548000
055500*     Z900-SQL-ABEND                                             *05550000
055600* ==> PROCESSES:                                                 *05560000
055700*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *05570000
055800* ==> PERFORMED FROM:                                            *05580000
055900******************************************************************05590000
056000 Z900-SQL-ABEND.                                                  05600000
056100                                                                  05610000
056200     DISPLAY 'Z900-SQL-ABEND'.                                    05620000
056300     DISPLAY '**  ABEND     **'.                                  05630000
056400     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               05640000
056500     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             05650000
056600     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    05660000
056700                                                                  05670000
056800******************************************************************05680000
056900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05690000
057000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *05700000
057100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *05710000
057200* FORMAT.                                                        *05720000
057300******************************************************************05730000
057400     COPY DPPD004.                                                05740000
057500                                                                  05750000
057600     MOVE +4013 TO ABEND-CODE.                                    05760000
057700     CALL 'ILBOABN0' USING ABEND-CODE.                            05770000
P10237                                                                  05780024
P10237******************************************************************05790024
P10237* COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE      * 05800033
P10237* PROTEGRITY MODULE FOR PROTECTION / UNPROTECTION               * 05810029
P10237******************************************************************05820024
P10237     COPY DPPD031.                                                05830033
P10237                                                                  05840024
