000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.         SVKRP017.                                    00020099
000300 AUTHOR.             ANGIE COLE.                                  00030099
000400 INSTALLATION.       KOHLS DEPARTMENT STORES.                     00040099
000500 DATE-WRITTEN.       NOVEMBER 1996.                               00050099
000600 DATE-COMPILED.                                                   00060099
000700                                                                  00070099
000800******************************************************************00080099
000900* THIS PROGRAM WAS COPIED FROM RDKRP009                           00090099
001000******************************************************************00100099
001100* THIS PROGRAM PRODUCES TWO DAILY REPORTS.                       *00110099
001200* THE PURPOSE OF THIS REPORT IS TO SHOW EACH STORE WHAT KMRC, OR *00120099
001300* GIFT CARDS WERE ISSUED BY REGISTER/STORE FOR A PARTICULAR DAY. *00130099
001400*                                                                *00140099
001500* THE CURSOR IS ONLY OPENED ONCE AT THE BEGINNING OF THE PROGRAM.*00150099
001600* IT SHOULD SELECT ALL KMRC, AND GIFT CARD CONTROL NUMBERS WHICH *00160099
001700* MEET THE GIVEN CRITERIA.                                       *00170099
001800******************************************************************00180099
001900**  REVISIONS:                                                  **00190099
002000* 12/96 - AMC -  WR NO. 4216                                     *00200099
002100*    - MODIFIED PROGRAM TO NOT ABEND IF NO RECORDS ARE FOUND     *00210099
002200*        BY THE FIRST FETCH.                                     *00220099
002300*                                                                *00230099
002400* 06/97 - SRB -  WR NO. 5220                                     *00240099
002500*    - MODIFIED PROGRAM TO PRODUCE A SECOND REPORT SIMILAR TO    *00250099
002600*        THE KMRC REPORT, EXCEPT THIS REPORT WILL BE FOR GIFT    *00260099
002700*        CARDS.                                                  *00270099
002800*                                                                *00280099
002900* 03/98 - DOUG ROUSAR-  PITS  NO. 169166                         *00290099
003000*    - INITIALIZED PV-CNTL-NBR-FMTD FIELD BEFORE POPULATING TO   *00300099
003100*        MAKE SURE ACCURASTE CNTL NUMBERS WERE BEING SHOWN       *00310099
003200*        PARAGRAPH AFFECTED;                                     *00320099
003300*              D300-DETERMINE-CNTL-NBR-PRINT                     *00330099
003400*        CHANGE IS INDICATED WITH **>> AT THE BEGINNING AND **<< *00340099
003500*        AT THE END                                              *00350099
003600*                                                                *00360099
003700* 02/99 - SCOTT BARTELT - WR NO. 6041                            *00370099
003800*    - CHANGED CODE TO MAKE THE CALENDAR ROUTINE CALL COMPLY WITH*00380099
003900*        KOHLS STANDARDS.                                        *00390099
004000*----------------------------------------------------------------*00400099
004100* 10/99 - JEFF BOLWERK  -  IR NO. 322592                         *00410099
004200*   IN PARAGRAPH B300-PROCESS-STORE WHEN CALLING PARAGRAPH       *00420099
004300*   B400-PROCESS-TERMINAL IT WAS NOT CHECKING FOR CHANGE IN      *00430099
004400*   STORE NUMBER, ONLY CHANGE IN TERMINAL NUMBER.  IF THE SAME   *00440099
004500*   TERMINAL NUMBER WAS FOUND FOR CONSECUTIVE STORES THE PROGRAM *00450099
004600*   WOULD GO INTO A LOOP.                                        *00460099
004700*                                                                *00470099
004800* 02/00 - DAVID COLOMBO - COMPUWARE           WR NO. 5220        *00480099
004900*   IN THE WHERE CLAUSE OF KMRC-CSR, CHANGED ACTVTY_TYP_CDE <> 3 *00490099
005000*   TO ACTVTY_TYP_CDE NOT IN (3,4).  THIS WAS TO KEEP FEES (TYPE *00500099
005100*   CODE 4) IN ADDITION TO TENDERS (TYPE CODE 3), OUT OF THE     *00510099
005200*   CURSOR SELECTION.                                            *00520099
005300*                                                                *00530099
005400* 03/31/02 - JACK WICZEK                                          00540099
005500*   MAKE CHANGES APPROPRIATE DUE TO DATABASE CHANGES FOR         *00550099
005600*   MULTI-CHANNEL GIFT CARD PROJECT.                             *00560099
005700*                                                                *00570099
005710* 06/08/09 - ROLF NOHE                                            00571099
005720*   PROJECT 2317 - GIFT CARD NUMBERING TO 30 DIGITS.             *00572099
005730*   WR# 29062.                                                    00573099
005731*   RECOMPILE TO PICK UP CHANGES IN SVWS004.                      00573199
005740*                                                                *00574099
005800******************************************************************00580099
005900 ENVIRONMENT DIVISION.                                            00590099
006000******************************************************************00600099
006100 CONFIGURATION SECTION.                                           00610099
006200                                                                  00620099
006300 SOURCE-COMPUTER.    IBM-3090.                                    00630099
006400 OBJECT-COMPUTER.    IBM-3090.                                    00640099
006500                                                                  00650099
006600 INPUT-OUTPUT SECTION.                                            00660099
006700                                                                  00670099
006800 FILE-CONTROL.                                                    00680099
006900                                                                  00690099
007000     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00700099
007100     SELECT REPORT-FILE               ASSIGN TO RPT01.            00710099
007200     SELECT REPORT-FILE-GFT-CRD       ASSIGN TO RPT02.            00720099
007300                                                                  00730099
007400******************************************************************00740099
007500 DATA DIVISION.                                                   00750099
007600******************************************************************00760099
007700                                                                  00770099
007800 FILE SECTION.                                                    00780099
007900                                                                  00790099
008000                                                                  00800099
008100 FD  CONTROL-DATE-FILE                                            00810099
008200     RECORDING MODE IS F                                          00820099
008300     BLOCK CONTAINS 0 RECORDS                                     00830099
008400     LABEL RECORDS ARE OMITTED.                                   00840099
008500                                                                  00850099
008600 01  CONTROL-DATE-RECORD              PIC X(80).                  00860099
008700                                                                  00870099
008800 FD  REPORT-FILE                                                  00880099
008900     RECORDING MODE IS F                                          00890099
009000     BLOCK CONTAINS 0 RECORDS                                     00900099
009100     LABEL RECORDS ARE OMITTED.                                   00910099
009200                                                                  00920099
009300 01  REPORT-RECORD                    PIC X(132).                 00930099
009400                                                                  00940099
009500 FD  REPORT-FILE-GFT-CRD                                          00950099
009600     RECORDING MODE IS F                                          00960099
009700     BLOCK CONTAINS 0 RECORDS                                     00970099
009800     LABEL RECORDS ARE OMITTED.                                   00980099
009900                                                                  00990099
010000 01  REPORT-RECORD-GFT-CRD            PIC X(132).                 01000099
010100                                                                  01010099
010200                                                                  01020099
010300 WORKING-STORAGE SECTION.                                         01030099
010400                                                                  01040099
010500 01  ABEND-CODE                       PIC S9(04)    VALUE +0 COMP.01050099
010600                                                                  01060099
010700******************************************************************01070099
010800*    CR-CONTROL RECORD   DATE IN MMDDCCYY FORMAT                 *01080099
010900******************************************************************01090099
011000 01  CR-CONTROL-RECORD.                                           01100099
011100     05  CR-CONTROL-DATE.                                         01110099
011200         10  CR-MM                    PIC  X(02)    VALUE SPACES. 01120099
011300         10  CR-DD                    PIC  X(02)    VALUE SPACES. 01130099
011400         10  CR-CC                    PIC  X(02)    VALUE SPACES. 01140099
011500         10  CR-YY                    PIC  X(02)    VALUE SPACES. 01150099
011600     05  FILLER                       PIC  X(72)    VALUE SPACES. 01160099
011700                                                                  01170099
011800******************************************************************01180099
011900*    PC-PROGRAM CONSTANTS                                        *01190099
012000******************************************************************01200099
012100 01  PC-PROGRAM-CONSTANTS.                                        01210099
012200     05  PC-PROGRAM-NAME              PIC  X(08)     VALUE        01220099
012300                                                      'SVKRP017'. 01230099
012400     05  PC-OPER-CO-NBR               PIC  X(02)     VALUE '03'.  01240099
012500     05  PC-ONE                       PIC  9(01)     VALUE 1.     01250099
012600     05  PC-TWO                       PIC  9(01)     VALUE 2.     01260099
012700     05  PC-THREE                     PIC  9(01)     VALUE 3.     01270099
012800     05  PC-FOUR                      PIC  9(01)     VALUE 4.     01280099
012900     05  PC-HEADER-LINE-COUNT         PIC S9(03)     VALUE +3     01290099
013000                                                     COMP.        01300099
013100     05  PC-MAX-LINES-BEFORE-TERM     PIC S9(03)     VALUE +59    01310099
013200                                                     COMP.        01320099
013300     05  PC-MAX-LINES-PER-PAGE        PIC S9(03)     VALUE +60    01330099
013400                                                     COMP.        01340099
013500                                                                  01350099
013600******************************************************************01360099
013700*    RESPROGRAM VARIABLES                                        *01370099
013800******************************************************************01380099
013900 01  PV-PROGRAM-VARIABLES.                                        01390099
014000     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01400099
014100     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01410099
014200                                                                  01420099
014300     05  PV-CURRENT-DATE.                                         01430099
014400         10  PV-CURRENT-YEAR          PIC  9(02)     VALUE ZERO.  01440099
014500         10  PV-CURRENT-MONTH         PIC  9(02)     VALUE ZERO.  01450099
014600         10  PV-CURRENT-DAY           PIC  9(02)     VALUE ZERO.  01460099
014700     05  PV-CURRENT-TIME.                                         01470099
014800         10  PV-CURRENT-HOUR          PIC  9(02)     VALUE ZERO.  01480099
014900         10  PV-CURRENT-MINUTE        PIC  9(02)     VALUE ZERO.  01490099
015000         10  FILLER                   PIC  9(04)     VALUE ZERO.  01500099
015100     05  PV-SALE-DATE.                                            01510099
015200         10  PV-SALE-DATE-CC          PIC  9(02).                 01520099
015300         10  PV-SALE-DATE-YY          PIC  9(02).                 01530099
015400         10  PV-SALE-DATE-DASH-1      PIC  X(01)     VALUE '-'.   01540099
015500         10  PV-SALE-DATE-MM          PIC  9(02).                 01550099
015600         10  PV-SALE-DATE-DASH-2      PIC  X(01)     VALUE '-'.   01560099
015700         10  PV-SALE-DATE-DD          PIC  9(02).                 01570099
015800     05  PV-SALE-DATE-CHAR            PIC  X(10)     VALUE SPACES.01580099
015900     05  PV-HOLD-PREV-CRD-PROD-YR     PIC  9(04)     VALUE ZERO.  01590099
016000     05  PV-HOLD-PREV-SHIPT-REQ-NBR   PIC  9(04)     VALUE ZERO.  01600099
016100     05  PV-HOLD-PREV-CNTL-NBR        PIC  9(06)     VALUE ZERO.  01610099
016200     05  PV-HOLD-NEXT-CNTL-NBR        PIC  9(06)     VALUE ZERO.  01620099
016300     05  PV-HOLD-POS-TRMNL-NBR        PIC  S9(4)     COMP         01630099
016400                                                     VALUE +0.    01640099
016500     05  PV-HOLD-STR-NAME             PIC  X(25)     VALUE SPACES.01650099
016600     05  PV-HOLD-STR-NBR              PIC  9(04)     VALUE ZERO.  01660099
016700     05  PV-HOLD-STR-NBR-X    REDEFINES  PV-HOLD-STR-NBR          01670099
016800                                      PIC  X(04).                 01680099
016900     05  PV-HOLD-PREV-CARD-TYPE-CDE   PIC  S9(1)V    COMP-3       01690099
017000                                                     VALUE +0.    01700099
017100                                                                  01710099
017200******************************************************************01720099
017300*    PS-PROGRAM SWITCHES                                         *01730099
017400******************************************************************01740099
017500 01  PS-PROGRAM-SWITCHES.                                         01750099
017600     05  PS-END-OF-CONTROL-FILE-SW    PIC  X(01)     VALUE 'N'.   01760099
017700         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   01770099
017800     05  PS-END-OF-KMRC-CSR-SW        PIC  X(01)     VALUE 'N'.   01780099
017900         88  PS-END-OF-KMRC-CSR                      VALUE 'Y'.   01790099
018000         88  PS-NOT-END-OF-KMRC-CSR                  VALUE 'N'.   01800099
018100     05  PS-END-OF-RANGE-SW           PIC  X(01)     VALUE 'N'.   01810099
018200         88  PS-END-OF-RANGE                         VALUE 'Y'.   01820099
018300         88  PS-NOT-END-OF-RANGE                     VALUE 'N'.   01830099
018400     05  PS-RANGE-NOT-FOUND-SW        PIC  X(01)     VALUE 'N'.   01840099
018500         88  PS-RANGE-FOUND                          VALUE 'Y'.   01850099
018600         88  PS-RANGE-NOT-FOUND                      VALUE 'N'.   01860099
018700     05  PS-FIRST-FETCH-SW            PIC  X(01)     VALUE 'N'.   01870099
018800         88  PS-FIRST-FETCH                          VALUE 'Y'.   01880099
018900         88  PS-NOT-FIRST-FETCH                      VALUE 'N'.   01890099
019000     05  PS-FIRST-LINE-PRINT-SW       PIC  X(01)     VALUE 'Y'.   01900099
019100         88  PS-FIRST-LINE-PRINT                     VALUE 'Y'.   01910099
019200         88  PS-NOT-FIRST-LINE-PRINT                 VALUE 'N'.   01920099
019300     05  PS-CARD-TYPE-CODE-SW         PIC S9(01)  COMP-3  VALUE 0.01930099
019400         88  PS-MERCHANDISE-RETURN-CREDIT            VALUE 1.     01940099
019500         88  PS-GIFT-CARD                            VALUE 2.     01950099
019600                                                                  01960099
019700******************************************************************01970099
019800*    PA-PROGRAM ACCUMULATORS                                     *01980099
019900******************************************************************01990099
020000 01  PA-PROGRAM-ACCUMULATORS.                                     02000099
020100     05  PA-STORE-TOTAL-KMRC          PIC S9(11)     COMP-3       02010099
020200                                                     VALUE ZEROES.02020099
020300     05  PA-TERMINAL-TOTAL-KMRC       PIC S9(11)     COMP-3       02030099
020400                                                     VALUE ZEROES.02040099
020500     05  PA-TOTAL-KMRC                PIC S9(11)     COMP-3       02050099
020600                                                     VALUE ZEROES.02060099
020700     05  PA-KMRC-RECS-READ            PIC S9(11)     COMP-3       02070099
020800                                                     VALUE ZEROES.02080099
020900     05  PA-REPORT-RECORDS-WRITTEN    PIC S9(11)     COMP-3       02090099
021000                                                     VALUE ZEROES.02100099
021100     05  PA-LINE-COUNTER              PIC S9(11)     COMP-3       02110099
021200                                                     VALUE ZEROES.02120099
021300     05  PA-PAGE-COUNTER              PIC S9(11)     COMP-3       02130099
021400                                                     VALUE ZEROES.02140099
021500     05  PA-RECS-READ-GFT-CRD         PIC S9(11)     COMP-3       02150099
021600                                                     VALUE ZEROES.02160099
021700     05  PA-REP-REC-WRITTEN-GFT-CRD   PIC S9(11)     COMP-3       02170099
021800                                                     VALUE ZEROES.02180099
021900     05  PA-LINE-COUNTER-GFT-CRD      PIC S9(11)     COMP-3       02190099
022000                                                     VALUE ZEROES.02200099
022100     05  PA-PAGE-COUNTER-GFT-CRD      PIC S9(11)     COMP-3       02210099
022200                                                     VALUE ZEROES.02220099
022300                                                                  02230099
022400******************************************************************02240099
022500*    STANDARD HEADER FOR 132 COLUMN REPORT                       *02250099
022600******************************************************************02260099
022700     COPY DPWS132O.                                               02270099
022800                                                                  02280099
022900 01  REPORT-TITLE-LINE.                                           02290099
023000     05  FILLER                         PIC  X(44)   VALUE SPACES.02300099
023100     05  FILLER                         PIC  X(47)   VALUE        02310099
023200         'KOHLS MERCHANDISE RETURN CREDIT CARD ISSUE LOG'.        02320099
023300     05  FILLER                         PIC  X(41)   VALUE SPACES.02330099
023400                                                                  02340099
023500 01  REPORT-TITLE-LINE-GFT-CRD.                                   02350099
023600     05  FILLER                         PIC  X(57)   VALUE SPACES.02360099
023700     05  FILLER                         PIC  X(19)   VALUE        02370099
023800         'GIFT CARD ISSUE LOG'.                                   02380099
023900     05  FILLER                         PIC  X(56)   VALUE SPACES.02390099
024000                                                                  02400099
024100 01  REPORT-SUBTITLE-LINE.                                        02410099
024200     05  FILLER                         PIC  X(57)   VALUE SPACES.02420099
024300     05  FILLER                         PIC  X(12)   VALUE        02430099
024400         'SALE DATE:  '.                                          02440099
024500     05  RSL-SALE-DATE-MM               PIC  X(02)   VALUE SPACES.02450099
024600     05  FILLER                         PIC  X(01)   VALUE '/'.   02460099
024700     05  RSL-SALE-DATE-DD               PIC  X(02)   VALUE SPACES.02470099
024800     05  FILLER                         PIC  X(01)   VALUE '/'.   02480099
024900     05  RSL-SALE-DATE-YY               PIC  X(02)   VALUE SPACES.02490099
025000     05  FILLER                         PIC  X(55)   VALUE SPACES.02500099
025100                                                                  02510099
025200******************************************************************02520099
025300*    HEADERS                                                     *02530099
025400******************************************************************02540099
025500 01  REPORT-STORE-LINE.                                           02550099
025600     05  FILLER                         PIC  X(04)   VALUE SPACES.02560099
025700     05  RSL-STORE-NUMBER               PIC  X(04)   VALUE SPACES.02570099
025800     05  FILLER                         PIC  X(03)   VALUE ' - '. 02580099
025900     05  RSL-STORE-NAME                 PIC  X(25)   VALUE SPACES.02590099
026000     05  FILLER                         PIC  X(96)   VALUE SPACES.02600099
026100                                                                  02610099
026200 01  REPORT-TERMINAL-LINE.                                        02620099
026300     05  FILLER                         PIC  X(07)   VALUE SPACES.02630099
026400     05  RTL-TERM-NBR                   PIC  X(04)   VALUE SPACES.02640099
026500     05  FILLER                         PIC  X(125)  VALUE SPACES.02650099
026600                                                                  02660099
026700 01  REPORT-TERMINAL-LINE-CONT.                                   02670099
026800     05  FILLER                         PIC  X(07)   VALUE SPACES.02680099
026900     05  RTLC-TERM-NBR                  PIC  X(04)   VALUE SPACES.02690099
027000     05  RTLC-TERM-DASH                 PIC  X(03)   VALUE ' - '. 02700099
027100     05  RTLC-TERM-CONT                 PIC  X(09)   VALUE        02710099
027200         'CONTINUED'.                                             02720099
027300     05  FILLER                         PIC  X(121)  VALUE SPACES.02730099
027400                                                                  02740099
027500******************************************************************02750099
027600*    CONTROL NUMBER DETAIL LINES                                 *02760099
027700******************************************************************02770099
027800 01  REPORT-DETAIL-LINE-SINGLE.                                   02780099
027900     05  FILLER                         PIC  X(12)   VALUE SPACES.02790099
028000     05  RDLS-CRD-PROD-YR               PIC  X(04)   VALUE SPACES.02800099
028100     05  RDLS-SHIPT-REQ-NBR             PIC  X(04)   VALUE SPACES.02810099
028200     05  RDLS-CNTL-NBR                  PIC  X(06)   VALUE SPACES.02820099
028300     05  FILLER                         PIC  X(106)  VALUE SPACES.02830099
028400                                                                  02840099
028500 01  REPORT-DETAIL-LINE-RANGE.                                    02850099
028600     05  FILLER                         PIC  X(12)   VALUE SPACES.02860099
028700     05  RDLR-CRD-PROD-YR-STRT          PIC  X(04)   VALUE SPACES.02870099
028800     05  RDLR-SHIPT-REQ-NBR-STRT        PIC  X(04)   VALUE SPACES.02880099
028900     05  RDLR-CNTL-NBR-STRT             PIC  X(06)   VALUE SPACES.02890099
029000     05  FILLER                         PIC  X(06)   VALUE        02900099
029100         ' THRU '.                                                02910099
029200     05  RDLR-CRD-PROD-YR-END           PIC  X(04)   VALUE SPACES.02920099
029300     05  RDLR-SHIPT-REQ-NBR-END         PIC  X(04)   VALUE SPACES.02930099
029400     05  RDLR-CNTL-NBR-END              PIC  X(06)   VALUE SPACES.02940099
029500     05  FILLER                         PIC  X(86)   VALUE SPACES.02950099
029600                                                                  02960099
029700******************************************************************02970099
029800*    TOTAL LINES                                                 *02980099
029900******************************************************************02990099
030000 01  REPORT-TOTAL-TERMINAL-LINE.                                  03000099
030100     05  FILLER                         PIC  X(39)   VALUE SPACES.03010099
030200     05  RTTL-TOTAL-CARDS               PIC  ZZZ,ZZ9.             03020099
030300     05  FILLER                         PIC  X(87)   VALUE SPACES.03030099
030400                                                                  03040099
030500 01  REPORT-TOTAL-STORE-LINE.                                     03050099
030600     05  FILLER                         PIC  X(04)   VALUE SPACES.03060099
030700     05  FILLER                         PIC  X(12)   VALUE        03070099
030800         'TOTAL CARDS:'.                                          03080099
030900     05  FILLER                         PIC  X(19)   VALUE SPACES.03090099
031000     05  RTSL-TOTAL-CARDS               PIC  ZZZ,ZZZ,ZZ9.         03100099
031100     05  FILLER                         PIC  X(91)   VALUE SPACES.03110099
031200                                                                  03120099
031300 01  REPORT-BLANK-LINE.                                           03130099
031400     05  FILLER                         PIC  X(132)  VALUE SPACES.03140099
031500                                                                  03150099
031600 01  REPORT-DASH-LINE.                                            03160099
031700     05  FILLER                         PIC  X(32)   VALUE SPACES.03170099
031800     05  FILLER                         PIC  X(14)   VALUE ALL    03180099
031900         '-'.                                                     03190099
032000     05  FILLER                         PIC  X(89)   VALUE SPACES.03200099
032100                                                                  03210099
032200******************************************************************03220099
032300*    DATE ROUTINE COPY MEMBERS                                   *03230099
032400******************************************************************03240099
032500     COPY DPWS500.                                                03250099
032600                                                                  03260099
032700******************************************************************03270099
032800*    KMRC CONSTANTS                                              *03280099
032900******************************************************************03290099
033000     COPY SVWS004.                                                03300099
033100                                                                  03310099
033200******************************************************************03320099
033300*    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004     *03330099
033400******************************************************************03340099
033500     COPY DPWS004.                                                03350099
033600                                                                  03360099
033700******************************************************************03370099
033800*    XST_LOC                                                     *03380099
033900******************************************************************03390099
034000     EXEC SQL                                                     03400099
034100         INCLUDE XST00001                                         03410099
034200     END-EXEC.                                                    03420099
034300                                                                  03430099
034400******************************************************************03440099
034500*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                              *03450099
034600*    SV-KOHL'S MERCHANDISE CARD ACTIVITY TABLE                   *03460099
034700******************************************************************03470099
034800     EXEC SQL                                                     03480099
034900         INCLUDE SVT00002                                         03490099
035000     END-EXEC.                                                    03500099
035100******************************************************************03510099
035200*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                             *03520099
035300*    SV-KOHL'S MERCHANDISE CARD TABLE                            *03530099
035400******************************************************************03540099
035500     EXEC SQL                                                     03550099
035600         INCLUDE SVT00001                                         03560099
035700     END-EXEC.                                                    03570099
036500******************************************************************03650099
036600*    CURSOR TO ACCESS ISSUED KMRC AND GIFT CARDS                 *03660099
036700******************************************************************03670099
036800     EXEC SQL                                                     03680099
036900       DECLARE KMRC-CSR CURSOR FOR                                03690099
037000           SELECT A.STR_NBR,                                      03700099
037100                  POS_TRMNL_NBR,                                  03710099
037200                  T.CRD_PROD_YR,                                  03720099
037300                  T.SHIPT_REQ_NBR,                                03730099
037400                  CNTL_NBR,                                       03740099
037500                  T.CRD_TYP_CDE                                   03750099
037600             FROM SVT_KOHLS_CRD_ACCT T                            03760099
037700                 ,SVT_KOHLS_CRD_TXN A                             03770099
037900            WHERE A.CRD_NBR = T.CRD_NBR                           03790099
038000              AND POS_DTE = :PV-SALE-DATE-CHAR                    03800099
038100              AND TRN_RVRSL_CDE = 0                               03810099
038200              AND ACTVY_TYP_CDE IN (:SV004-ISSUE-KMRC-ACT-TYP-N   03820099
038300                               ,:SV004-ISSUE-GIFT-CRD-ACT-TYP-N)  03830099
038600            ORDER BY A.STR_NBR, T.CRD_TYP_CDE, POS_TRMNL_NBR,     03860099
038700                    T.CRD_PROD_YR, T.SHIPT_REQ_NBR, CNTL_NBR      03870099
038800             WITH UR                                              03880099
038900     END-EXEC.                                                    03890099
039000                                                                  03900099
039100******************************************************************03910099
039200*    STANDARD LAYOUT FOR THE SQL COMMUNCATIONS AREA              *03920099
039300******************************************************************03930099
039400     EXEC SQL                                                     03940099
039500         INCLUDE SQLCA                                            03950099
039600     END-EXEC.                                                    03960099
039700                                                                  03970099
039800     COPY SQLCA2.                                                 03980099
039900                                                                  03990099
040000 PROCEDURE DIVISION.                                              04000099
040100                                                                  04010099
040200 A100-MAINLINE.                                                   04020099
040300                                                                  04030099
040400     PERFORM B100-INITIALIZE.                                     04040099
040500                                                                  04050099
040600     SET PS-NOT-END-OF-RANGE    TO TRUE.                          04060099
040700     PERFORM B200-PROCESS-KMRC                                    04070099
040800         UNTIL PS-END-OF-KMRC-CSR.                                04080099
040900                                                                  04090099
041000     PERFORM B900-EOJ-ROUTINE.                                    04100099
041100                                                                  04110099
041200     GOBACK.                                                      04120099
041300                                                                  04130099
041400******************************************************************04140099
041500*     B100-INITIALIZE                                            *04150099
041600* ==> PROCESSES:                                                 *04160099
041700*     - READS CONTROL DATE FROM CONTROL RECORD                   *04170099
041800*     - ACCEPTS THE CURRENT DATE AND TIME FOR THE REPORT HEADING *04180099
041900*     - OPENS KMRC-CSR (CURSOR).                                 *04190099
042000*     - READS FIRST KMRC, OR GIFT CARD CONTROL NUMBER.  IF ONE IS*04200099
042100*       NOT FOUND, ABEND THE PROGRAM.                            *04210099
042200* ==> PERFORMED FROM:  A100-MAINLINE                             *04220099
042300******************************************************************04230099
042400 B100-INITIALIZE.                                                 04240099
042500                                                                  04250099
042600     OPEN INPUT CONTROL-DATE-FILE.                                04260099
042700     OPEN OUTPUT REPORT-FILE.                                     04270099
042800     OPEN OUTPUT REPORT-FILE-GFT-CRD.                             04280099
042900                                                                  04290099
043000     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                04300099
043100         AT END                                                   04310099
043200             SET PS-END-OF-CONTROL-FILE TO TRUE.                  04320099
043300                                                                  04330099
043400     IF PS-END-OF-CONTROL-FILE                                    04340099
043500         DISPLAY ' '                                              04350099
043600         DISPLAY '** ABEND     **'                                04360099
043700         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04370099
043800         DISPLAY '** PARAGRAPH **  = B100-INITIALIZE      '       04380099
043900         DISPLAY '** CONTROL DATE FILE IS EMPTY  '                04390099
044000         DISPLAY ' '                                              04400099
044100         MOVE +4002 TO ABEND-CODE                                 04410099
044200         CALL 'ILBOABN0' USING ABEND-CODE                         04420099
044300     ELSE                                                         04430099
044400         DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '               04440099
044500                 CR-CONTROL-DATE                                  04450099
044600     END-IF.                                                      04460099
044700                                                                  04470099
044800     INITIALIZE DPG51 DPG52 DPG53                                 04480099
044900                DPG54 DPG55 DPG56.                                04490099
045000     SET DPG51-ACTUAL-CALENDAR-ONLY                               04500099
045100                                 TO TRUE.                         04510099
045200     SET DPG51-DO-NOT-INCR-DECR-DATE                              04520099
045300                                 TO TRUE.                         04530099
045400     MOVE ZEROES TO DPG51-INCR-DECR-DAYS-9                        04540099
045500                    DPG51-INCR-DECR-BUS-DAYS-9.                   04550099
045600     MOVE CR-CONTROL-DATE           TO DPG52-LK-DATE-INPUT.       04560099
045700     SET DPG52-LK-DTE-GREG-CC       TO TRUE.                      04570099
045800     CALL DP500-KOHLS-CALENDAR-ROUTINE                            04580099
045900       USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.                 04590099
046000                                                                  04600099
046100     EVALUATE TRUE                                                04610099
046200         WHEN DPG54-SEVERE-ERROR                                  04620099
046300         WHEN DPG54-DATE-INVALID                                  04630099
046400             DISPLAY ' '                                          04640099
046500             DISPLAY '** ABEND     **'                            04650099
046600             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        04660099
046700             DISPLAY '** PARAGRAPH **  = B100-INITIALIZE'         04670099
046800             DISPLAY '** BAD CALL TO CALENDAR MODULE '            04680099
046900             DISPLAY '** DETERMINE VALID DATE **'                 04690099
047000             DISPLAY DPG54-ERROR-MESSAGE                          04700099
047100             DISPLAY ' '                                          04710099
047200             MOVE +4019             TO ABEND-CODE                 04720099
047300             CALL 'ILBOABN0' USING ABEND-CODE                     04730099
047400     END-EVALUATE.                                                04740099
047500                                                                  04750099
047600     MOVE CR-CC               TO PV-SALE-DATE-CC.                 04760099
047700     MOVE CR-YY               TO RSL-SALE-DATE-YY                 04770099
047800                                 PV-SALE-DATE-YY.                 04780099
047900     MOVE CR-MM               TO RSL-SALE-DATE-MM                 04790099
048000                                 PV-SALE-DATE-MM.                 04800099
048100     MOVE CR-DD               TO RSL-SALE-DATE-DD                 04810099
048200                                 PV-SALE-DATE-DD.                 04820099
048300     MOVE PV-SALE-DATE        TO PV-SALE-DATE-CHAR.               04830099
048400                                                                  04840099
048500     ACCEPT PV-CURRENT-DATE      FROM DATE.                       04850099
048600     MOVE PV-CURRENT-YEAR          TO DP132O-RUN-YEAR.            04860099
048700     MOVE PV-CURRENT-MONTH         TO DP132O-RUN-MONTH.           04870099
048800     MOVE PV-CURRENT-DAY           TO DP132O-RUN-DAY.             04880099
048900                                                                  04890099
049000     ACCEPT PV-CURRENT-TIME      FROM TIME.                       04900099
049100     MOVE PV-CURRENT-HOUR          TO DP132O-RUN-HOUR.            04910099
049200     MOVE PV-CURRENT-MINUTE        TO DP132O-RUN-MINUTE.          04920099
049300                                                                  04930099
049400     MOVE PC-PROGRAM-NAME          TO DP132O-PROGRAM-NAME.        04940099
049500                                                                  04950099
049600     EXEC SQL                                                     04960099
049700         OPEN KMRC-CSR                                            04970099
049800     END-EXEC.                                                    04980099
049900                                                                  04990099
050000     EVALUATE TRUE                                                05000099
050100         WHEN SQLCODE NOT = 0                                     05010099
050200         WHEN SQLWARN0    = 'W'                                   05020099
050300             DISPLAY ' '                                          05030099
050400             DISPLAY '** ABEND     **'                            05040099
050500             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        05050099
050600             DISPLAY '** PARAGRAPH **  = B200-PROCESS-KMRC'       05060099
050700             DISPLAY '** OPEN CURSOR TO SVT00002 TABLE'           05070099
050800             PERFORM Z900-SQL-ABEND                               05080099
050900     END-EVALUATE.                                                05090099
051000                                                                  05100099
051100     SET PS-FIRST-FETCH TO TRUE.                                  05110099
051200     PERFORM D100-FETCH-KMRC-CURSOR.                              05120099
051300                                                                  05130099
051400     IF PS-END-OF-KMRC-CSR                                        05140099
051500         DISPLAY ' '                                              05150099
051600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05160099
051700         DISPLAY '** FIRST FETCH FOUND NO KMRC OR GIFT CARD '     05170099
051800         DISPLAY ' '                                              05180099
051900     ELSE                                                         05190099
052000         PERFORM F100-PROCESS-PAGE-BREAK                          05200099
052100         MOVE SVT00002-STR-NBR TO PV-HOLD-STR-NBR                 05210099
052110                                  XST00001-LOC-NBR                05211099
052200         PERFORM G100-GET-STORE-NAME                              05220099
052300         PERFORM F200-PRINT-STORE-LINE                            05230099
052400         MOVE SVT00002-POS-TRMNL-NBR TO PV-HOLD-POS-TRMNL-NBR     05240099
052500         PERFORM F210-PRINT-TERMINAL-LINE                         05250099
052600         SET PS-NOT-FIRST-FETCH TO TRUE.                          05260099
052700                                                                  05270099
052800******************************************************************05280099
052900*     B200-PROCESS-KMRC                                           05290099
053000* ==> PROCESSES:                                                 *05300099
053100*     - PROCESSES ISSUED CARDS FOR A GIVEN DAY.                  *05310099
053200* ==> PERFORMED FROM:  A100-MAINLINE                             *05320099
053300******************************************************************05330099
053400 B200-PROCESS-KMRC.                                               05340099
053500                                                                  05350099
053600     PERFORM B300-PROCESS-STORE                                   05360099
053700         UNTIL PS-END-OF-KMRC-CSR                                 05370099
053800           OR SVT00002-STR-NBR NOT = PV-HOLD-STR-NBR              05380099
053900           OR SVT00001-CRD-TYP-CDE NOT =                          05390099
054000                                   PV-HOLD-PREV-CARD-TYPE-CDE.    05400099
054100                                                                  05410099
054200     PERFORM F300-PRINT-TOTAL-STORE-LINE.                         05420099
054300     IF PS-END-OF-KMRC-CSR                                        05430099
054400         CONTINUE                                                 05440099
054500     ELSE                                                         05450099
054600         MOVE SVT00001-CRD-TYP-CDE TO PS-CARD-TYPE-CODE-SW        05460099
054700                                    PV-HOLD-PREV-CARD-TYPE-CDE    05470099
054800         PERFORM F100-PROCESS-PAGE-BREAK                          05480099
054900         INITIALIZE PA-STORE-TOTAL-KMRC                           05490099
055000         MOVE SVT00002-STR-NBR TO PV-HOLD-STR-NBR                 05500099
055010                                  XST00001-LOC-NBR                05501099
055100         PERFORM G100-GET-STORE-NAME                              05510099
055200         PERFORM F200-PRINT-STORE-LINE                            05520099
055300         MOVE SVT00002-POS-TRMNL-NBR TO PV-HOLD-POS-TRMNL-NBR     05530099
055400         PERFORM F210-PRINT-TERMINAL-LINE.                        05540099
055500                                                                  05550099
055600******************************************************************05560099
055700*     B300-PROCESS-STORE                                          05570099
055800* ==> PROCESSES:                                                 *05580099
055900*     - PROCESSES ISSUED CARDS FOR GIVEN STORE ON A GIVEN DAY.   *05590099
056000* ==> PERFORMED FROM:  B200-PROCESS-KMRC                         *05600099
056100******************************************************************05610099
056200 B300-PROCESS-STORE.                                              05620099
056300                                                                  05630099
056400     PERFORM B400-PROCESS-TERMINAL                                05640099
056500         UNTIL PS-END-OF-KMRC-CSR                                 05650099
056600           OR SVT00002-STR-NBR NOT = PV-HOLD-STR-NBR              05660099
056700           OR SVT00001-CRD-TYP-CDE NOT =                          05670099
056800                                   PV-HOLD-PREV-CARD-TYPE-CDE     05680099
056900           OR SVT00002-POS-TRMNL-NBR NOT = PV-HOLD-POS-TRMNL-NBR. 05690099
057000                                                                  05700099
057100     PERFORM F310-PRINT-TOTAL-TERMINAL-LINE.                      05710099
057200                                                                  05720099
057300     ADD PA-TERMINAL-TOTAL-KMRC TO PA-STORE-TOTAL-KMRC            05730099
057400                                                                  05740099
057500     INITIALIZE PA-TERMINAL-TOTAL-KMRC.                           05750099
057600                                                                  05760099
057700     IF PS-END-OF-KMRC-CSR                                        05770099
057800       CONTINUE                                                   05780099
057900     ELSE                                                         05790099
058000       IF SVT00002-STR-NBR NOT = PV-HOLD-STR-NBR                  05800099
058100         CONTINUE                                                 05810099
058200       ELSE                                                       05820099
058300         IF SVT00001-CRD-TYP-CDE NOT = PV-HOLD-PREV-CARD-TYPE-CDE 05830099
058400           CONTINUE                                               05840099
058500         ELSE                                                     05850099
058600           MOVE SVT00002-POS-TRMNL-NBR TO PV-HOLD-POS-TRMNL-NBR   05860099
058700           PERFORM F210-PRINT-TERMINAL-LINE.                      05870099
058800                                                                  05880099
058900******************************************************************05890099
059000*     B400-PROCESS-TERMINAL                                       05900099
059100* ==> PROCESSES:                                                 *05910099
059200*     - PROCESSES ISSUED CARDS FOR GIVEN TERMINAL.               *05920099
059300*     - AFTER END OF RANGE, THE CNTL NUMBERS ARE WRITTEN.        *05930099
059400*       THE PV-HOLD-PREV-CNTL-NBR IS THE CONTROL NUMBER WHICH    *05940099
059500*       IS WRITTEN.  THE CURRENT CNTL NUMBER WILL THEN BECOME    *05950099
059600*       THE PREVIOUS CNTL NBR AND WILL THEN BE PASSED TO         *05960099
059700*       B500-PROCESS-RANGE TO CHECK FOR IT'S RANGE.              *05970099
059800* ==> PERFORMED FROM:  B300-PROCESS-STORE                        *05980099
059900******************************************************************05990099
060000 B400-PROCESS-TERMINAL.                                           06000099
060100                                                                  06010099
060200     SET PS-NOT-END-OF-RANGE TO TRUE.                             06020099
060300     PERFORM B500-PROCESS-RANGE                                   06030099
060400         UNTIL PS-END-OF-KMRC-CSR                                 06040099
060500           OR PS-END-OF-RANGE                                     06050099
060600           OR SVT00002-STR-NBR NOT = PV-HOLD-STR-NBR              06060099
060700           OR SVT00001-CRD-TYP-CDE NOT =                          06070099
060800                                   PV-HOLD-PREV-CARD-TYPE-CDE     06080099
060900           OR SVT00002-POS-TRMNL-NBR NOT = PV-HOLD-POS-TRMNL-NBR. 06090099
061000                                                                  06100099
061100     ADD PA-TOTAL-KMRC TO PA-TERMINAL-TOTAL-KMRC.                 06110099
061200     IF (PS-END-OF-RANGE                                          06120099
061300           OR PS-END-OF-KMRC-CSR                                  06130099
061400           OR SVT00002-STR-NBR NOT = PV-HOLD-STR-NBR              06140099
061500           OR SVT00001-CRD-TYP-CDE NOT =                          06150099
061600                                   PV-HOLD-PREV-CARD-TYPE-CDE     06160099
061700           OR SVT00002-POS-TRMNL-NBR NOT = PV-HOLD-POS-TRMNL-NBR) 06170099
061800         AND (RDLR-CRD-PROD-YR-END > SPACES                       06180099
061900         AND  RDLR-SHIPT-REQ-NBR-END > SPACES                     06190099
062000         AND  RDLR-CNTL-NBR-END > SPACES)                         06200099
062100         PERFORM E100-PRINT-RANGE-DETAIL                          06210099
062200         MOVE SPACES TO RDLR-CRD-PROD-YR-END                      06220099
062300                        RDLR-SHIPT-REQ-NBR-END                    06230099
062400                        RDLR-CNTL-NBR-END                         06240099
062500     ELSE                                                         06250099
062600         PERFORM E110-PRINT-DETAIL                                06260099
062700         MOVE SPACES TO RDLR-CRD-PROD-YR-STRT                     06270099
062800                        RDLR-SHIPT-REQ-NBR-STRT                   06280099
062900                        RDLR-CNTL-NBR-STRT                        06290099
063000                        RDLR-CRD-PROD-YR-END                      06300099
063100                        RDLR-SHIPT-REQ-NBR-END                    06310099
063200                        RDLR-CNTL-NBR-END                         06320099
063300         SET PS-RANGE-NOT-FOUND TO TRUE                           06330099
063400     END-IF.                                                      06340099
063500     INITIALIZE PA-TOTAL-KMRC.                                    06350099
063600                                                                  06360099
063700******************************************************************06370099
063800*     B500-PROCESS-RANGE                                         *06380099
063900* ==> PROCESSES:                                                 *06390099
064000*     - READS THE NEXT ISSUED KMRC CARD, OR GIFT CARD.           *06400099
064100*     - FILLS IN FIELDS FOR PRINTING OF SINGLE CARD OR RANGE     *06410099
064200*       OF CARDS.                                                *06420099
064300* ==> PERFORMED FROM:  B400-PROCESS-TERMINAL.                    *06430099
064400******************************************************************06440099
064500 B500-PROCESS-RANGE.                                              06450099
064600                                                                  06460099
064700     MOVE SVT00001-CRD-PROD-YR TO PV-HOLD-PREV-CRD-PROD-YR.       06470099
064800     MOVE SVT00001-SHIPT-REQ-NBR TO PV-HOLD-PREV-SHIPT-REQ-NBR.   06480099
064900     MOVE SVT00001-CNTL-NBR   TO PV-HOLD-PREV-CNTL-NBR.           06490099
065000     PERFORM D100-FETCH-KMRC-CURSOR.                              06500099
065100                                                                  06510099
065200     IF PS-END-OF-KMRC-CSR AND PS-RANGE-FOUND                     06520099
065300        ADD +1 TO PA-TOTAL-KMRC                                   06530099
065400        MOVE PV-HOLD-PREV-CRD-PROD-YR TO RDLR-CRD-PROD-YR-END     06540099
065500        MOVE PV-HOLD-PREV-SHIPT-REQ-NBR TO RDLR-SHIPT-REQ-NBR-END 06550099
065600        MOVE PV-HOLD-PREV-CNTL-NBR TO RDLR-CNTL-NBR-END           06560099
065700     ELSE                                                         06570099
065800        IF PS-END-OF-KMRC-CSR                                     06580099
065900           ADD +1 TO PA-TOTAL-KMRC                                06590099
066000           MOVE PV-HOLD-PREV-CRD-PROD-YR TO RDLS-CRD-PROD-YR      06600099
066100           MOVE PV-HOLD-PREV-SHIPT-REQ-NBR TO RDLS-SHIPT-REQ-NBR  06610099
066200           MOVE PV-HOLD-PREV-CNTL-NBR TO RDLS-CNTL-NBR            06620099
066300           MOVE SPACES TO RDLR-CRD-PROD-YR-END                    06630099
066400                          RDLR-SHIPT-REQ-NBR-END                  06640099
066500                          RDLR-CNTL-NBR-END.                      06650099
066600                                                                  06660099
066700     IF RDLR-CRD-PROD-YR-STRT = RDLR-CRD-PROD-YR-END              06670099
066800        AND RDLR-SHIPT-REQ-NBR-STRT = RDLR-SHIPT-REQ-NBR-END      06680099
066900        AND RDLR-CNTL-NBR-STRT = RDLR-CNTL-NBR-END                06690099
067000        MOVE SPACES TO RDLR-CRD-PROD-YR-END                       06700099
067100                       RDLR-SHIPT-REQ-NBR-END                     06710099
067200                       RDLR-CNTL-NBR-END.                         06720099
067300                                                                  06730099
067400******************************************************************06740099
067500*     B900-EOJ-ROUTINE                                           *06750099
067600* ==> PROCESSES:                                                 *06760099
067700*     - WRITES AN END OF REPORT LINE TO THE REPORT               *06770099
067800*     - CLOSES THE FILES                                         *06780099
067900*     - DISPLAYS THE NUMBER OF RECORDS READ AND WRITTEN          *06790099
068000* ==> PERFORMED FROM:  A100-MAINLINE                             *06800099
068100******************************************************************06810099
068200 B900-EOJ-ROUTINE.                                                06820099
068300                                                                  06830099
068400     CLOSE CONTROL-DATE-FILE                                      06840099
068500           REPORT-FILE                                            06850099
068600           REPORT-FILE-GFT-CRD.                                   06860099
068700                                                                  06870099
068800     EXEC SQL                                                     06880099
068900        CLOSE KMRC-CSR                                            06890099
069000     END-EXEC.                                                    06900099
069100                                                                  06910099
069200     EVALUATE TRUE                                                06920099
069300         WHEN SQLCODE NOT = 0                                     06930099
069400         WHEN SQLWARN0    = 'W'                                   06940099
069500             DISPLAY ' '                                          06950099
069600             DISPLAY '** ABEND     **'                            06960099
069700             DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME        06970099
069800             DISPLAY '** PARAGRAPH **  = B200-PROCESS-EXCEPTIONS' 06980099
069900             DISPLAY '** CLOSE CURSOR TO SVT_KOHLS_CRD_TXN TABLE' 06990099
070000             PERFORM Z900-SQL-ABEND                               07000099
070100     END-EVALUATE.                                                07010099
070200     DISPLAY ' '.                                                 07020099
070300     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             07030099
070400     DISPLAY 'NUMBER OF KMRC RECORDS READ:       '                07040099
070500         PA-KMRC-RECS-READ.                                       07050099
070600     DISPLAY ' '.                                                 07060099
070700     DISPLAY 'MESSAGES FOR PROGRAM ' PC-PROGRAM-NAME.             07070099
070800     DISPLAY 'NUMBER OF GIFT CARD RECORDS READ:  '                07080099
070900         PA-RECS-READ-GFT-CRD.                                    07090099
071000     DISPLAY ' '.                                                 07100099
071100                                                                  07110099
071200******************************************************************07120099
071300*     D100-FETCH-KMRC-CURSOR                                     *07130099
071400* ==> PROCESSES:                                                 *07140099
071500*     - READS ACTIVITY FROM THE SVT00002/SVT00001 TABLES         *07150099
071600* ==> PERFORMED FROM:  B500-PROCESS-RANGE                        *07160099
071700******************************************************************07170099
071800 D100-FETCH-KMRC-CURSOR.                                          07180099
071900                                                                  07190099
072000     EXEC SQL                                                     07200099
072100         FETCH KMRC-CSR                                           07210099
072200           INTO  :SVT00002-STR-NBR,                               07220099
072300                 :SVT00002-POS-TRMNL-NBR,                         07230099
072400                 :SVT00001-CRD-PROD-YR,                           07240099
072500                 :SVT00001-SHIPT-REQ-NBR,                         07250099
072600                 :SVT00001-CNTL-NBR,                              07260099
072700                 :SVT00001-CRD-TYP-CDE                            07270099
072800     END-EXEC.                                                    07280099
072900                                                                  07290099
073000     EVALUATE TRUE                                                07300099
073100         WHEN SQLCODE = +0                                        07310099
073200             IF SVT00001-CRD-TYP-CDE = 1                          07320099
073300               ADD +1 TO PA-KMRC-RECS-READ                        07330099
073400             ELSE                                                 07340099
073500               IF SVT00001-CRD-TYP-CDE = 2                        07350099
073600                 ADD +1 TO PA-RECS-READ-GFT-CRD                   07360099
073700               END-IF                                             07370099
073800             END-IF                                               07380099
073900             PERFORM D200-PROCESS-CNTL-RANGE                      07390099
074000         WHEN SQLCODE = +100                                      07400099
074100             SET PS-END-OF-KMRC-CSR     TO TRUE                   07410099
074200         WHEN OTHER                                               07420099
074300             MOVE 'D100-FETCH-KMRC-CURSOR     '                   07430099
074400                               TO PV-PARAGRAPH-NAME               07440099
074500             MOVE 'READ ROWS FROM SVT00002        '               07450099
074600                               TO PV-DB2-OPERATION-ATTEMPTED      07460099
074700             PERFORM Z900-SQL-ABEND                               07470099
074800     END-EVALUATE.                                                07480099
074900                                                                  07490099
075000******************************************************************07500099
075100*     D200-PROCESS-CNTL-RANGE.                                   *07510099
075200* ==> PROCESSES:                                                 *07520099
075300*     - PROCESSES CNTL NUMBERS TO SEE IF THE RANGE IS BROKEN.    *07530099
075400*     - IF FIRST TIME, SET PREVIOUS HOLD FIELDS AND DO NOT CHECK *07540099
075500*       FOR RANGE.                                               *07550099
075600*     - AFTER THE END OF A RANGE, THE PREVIOUS CNTL NBR(S) IS    *07560099
075700*       WRITTEN, NOT THE CURRENT CNTL NBR WHICH WAS JUST READ.   *07570099
075800* ==> PERFORMED FROM:  D100-FETCH-KMRC-CURSOR                    *07580099
075900******************************************************************07590099
076000 D200-PROCESS-CNTL-RANGE.                                         07600099
076100                                                                  07610099
076200     IF PS-FIRST-FETCH                                            07620099
076300        MOVE SVT00001-CRD-TYP-CDE  TO PS-CARD-TYPE-CODE-SW        07630099
076400                                      PV-HOLD-PREV-CARD-TYPE-CDE  07640099
076500        MOVE SVT00001-CRD-PROD-YR TO PV-HOLD-PREV-CRD-PROD-YR     07650099
076600        MOVE SVT00001-SHIPT-REQ-NBR TO PV-HOLD-PREV-SHIPT-REQ-NBR 07660099
076700        MOVE SVT00001-CNTL-NBR     TO PV-HOLD-PREV-CNTL-NBR       07670099
076800        MOVE PV-HOLD-PREV-CRD-PROD-YR TO RDLS-CRD-PROD-YR         07680099
076900                                         RDLR-CRD-PROD-YR-STRT    07690099
077000        MOVE PV-HOLD-PREV-SHIPT-REQ-NBR TO RDLS-SHIPT-REQ-NBR     07700099
077100                                          RDLR-SHIPT-REQ-NBR-STRT 07710099
077200        MOVE PV-HOLD-PREV-CNTL-NBR TO RDLS-CNTL-NBR               07720099
077300                                      RDLR-CNTL-NBR-STRT          07730099
077400        COMPUTE PV-HOLD-NEXT-CNTL-NBR = PV-HOLD-PREV-CNTL-NBR + 1 07740099
077500     ELSE                                                         07750099
077600        IF PS-RANGE-FOUND                                         07760099
077700           PERFORM D210-CHECK-FOR-RANGE                           07770099
077800        ELSE                                                      07780099
077900           MOVE PV-HOLD-PREV-CRD-PROD-YR TO RDLS-CRD-PROD-YR      07790099
078000                                            RDLR-CRD-PROD-YR-STRT 07800099
078100           MOVE PV-HOLD-PREV-SHIPT-REQ-NBR TO RDLS-SHIPT-REQ-NBR  07810099
078200                                          RDLR-SHIPT-REQ-NBR-STRT 07820099
078300           MOVE PV-HOLD-PREV-CNTL-NBR TO RDLS-CNTL-NBR            07830099
078400                                         RDLR-CNTL-NBR-STRT       07840099
078500           PERFORM D210-CHECK-FOR-RANGE                           07850099
078600        END-IF                                                    07860099
078700     END-IF.                                                      07870099
078800                                                                  07880099
078900******************************************************************07890099
079000*     D210-CHECK-FOR-RANGE.                                      *07900099
079100* ==> PROCESSES:                                                 *07910099
079200*     - CHECK TO SEE IF NEW CNTL-NBR FALLS IN RANGE OF PREVIOUS  *07920099
079300*       CNTL NBR.                                                 07930099
079400* ==> PERFORMED FROM:  D200-PROCESS-CNTL-RANGE                   *07940099
079500******************************************************************07950099
079600 D210-CHECK-FOR-RANGE.                                            07960099
079700                                                                  07970099
079800     COMPUTE PV-HOLD-NEXT-CNTL-NBR = PV-HOLD-PREV-CNTL-NBR + 1.   07980099
079900     ADD +1 TO PA-TOTAL-KMRC.                                     07990099
080000     IF SVT00001-CRD-PROD-YR = PV-HOLD-PREV-CRD-PROD-YR           08000099
080100        AND SVT00001-SHIPT-REQ-NBR = PV-HOLD-PREV-SHIPT-REQ-NBR   08010099
080200        AND SVT00001-CNTL-NBR = PV-HOLD-NEXT-CNTL-NBR             08020099
080300        COMPUTE PV-HOLD-NEXT-CNTL-NBR = SVT00001-CNTL-NBR + 1     08030099
080400        SET PS-RANGE-FOUND TO TRUE                                08040099
080500     ELSE                                                         08050099
080600        MOVE PV-HOLD-PREV-CRD-PROD-YR TO RDLR-CRD-PROD-YR-END     08060099
080700        MOVE PV-HOLD-PREV-SHIPT-REQ-NBR TO RDLR-SHIPT-REQ-NBR-END 08070099
080800        MOVE PV-HOLD-PREV-CNTL-NBR TO RDLR-CNTL-NBR-END           08080099
080900        SET PS-END-OF-RANGE TO TRUE                               08090099
081000        SET PS-RANGE-NOT-FOUND TO TRUE                            08100099
081100     END-IF.                                                      08110099
081200                                                                  08120099
081300******************************************************************08130099
081400*     E100-PRINT-RANGE-DETAIL.                                   *08140099
081500* ==> PROCESSES:                                                 *08150099
081600*     - WRITES THE RANGE OF CNTL NBRS DETAIL LINE.               *08160099
081700* ==> PERFORMED FROM:  B400-PROCESS-TERMINAL                     *08170099
081800******************************************************************08180099
081900 E100-PRINT-RANGE-DETAIL.                                         08190099
082000                                                                  08200099
082100     IF PS-MERCHANDISE-RETURN-CREDIT                              08210099
082200                                                                  08220099
082300       IF PA-LINE-COUNTER > PC-MAX-LINES-PER-PAGE                 08230099
082400         PERFORM F100-PROCESS-PAGE-BREAK                          08240099
082500         PERFORM F200-PRINT-STORE-LINE                            08250099
082600         PERFORM F220-PRINT-TERMINAL-LINE-CONT                    08260099
082700       END-IF                                                     08270099
082800                                                                  08280099
082900       WRITE REPORT-RECORD                                        08290099
083000           FROM REPORT-DETAIL-LINE-RANGE                          08300099
083100           AFTER ADVANCING 1 LINE                                 08310099
083200                                                                  08320099
083300       ADD PC-ONE TO PA-LINE-COUNTER                              08330099
083400       ADD PC-ONE TO PA-REPORT-RECORDS-WRITTEN                    08340099
083500                                                                  08350099
083600     ELSE                                                         08360099
083700                                                                  08370099
083800       IF PS-GIFT-CARD                                            08380099
083900                                                                  08390099
084000         IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-PER-PAGE       08400099
084100           PERFORM F100-PROCESS-PAGE-BREAK                        08410099
084200           PERFORM F200-PRINT-STORE-LINE                          08420099
084300           PERFORM F220-PRINT-TERMINAL-LINE-CONT                  08430099
084400         END-IF                                                   08440099
084500                                                                  08450099
084600         WRITE REPORT-RECORD-GFT-CRD                              08460099
084700             FROM REPORT-DETAIL-LINE-RANGE                        08470099
084800             AFTER ADVANCING 1 LINE                               08480099
084900                                                                  08490099
085000         ADD PC-ONE TO PA-LINE-COUNTER-GFT-CRD                    08500099
085100         ADD PC-ONE TO PA-REP-REC-WRITTEN-GFT-CRD                 08510099
085200                                                                  08520099
085300       END-IF                                                     08530099
085400                                                                  08540099
085500     END-IF.                                                      08550099
085600                                                                  08560099
085700******************************************************************08570099
085800*     E110-PRINT-DETAIL.                                         *08580099
085900* ==> PROCESSES:                                                 *08590099
086000*     - WRITES THE SINGLE CONTROL NUMBER DETAIL LINE.            *08600099
086100* ==> PERFORMED FROM:  B400-PROCESS-TERMINAL                     *08610099
086200******************************************************************08620099
086300 E110-PRINT-DETAIL.                                               08630099
086400                                                                  08640099
086500     IF PS-MERCHANDISE-RETURN-CREDIT                              08650099
086600                                                                  08660099
086700       IF PA-LINE-COUNTER > PC-MAX-LINES-PER-PAGE                 08670099
086800         PERFORM F100-PROCESS-PAGE-BREAK                          08680099
086900         PERFORM F200-PRINT-STORE-LINE                            08690099
087000         PERFORM F220-PRINT-TERMINAL-LINE-CONT                    08700099
087100       END-IF                                                     08710099
087200                                                                  08720099
087300       WRITE REPORT-RECORD                                        08730099
087400           FROM REPORT-DETAIL-LINE-SINGLE                         08740099
087500           AFTER ADVANCING 1 LINE                                 08750099
087600                                                                  08760099
087700       ADD PC-ONE TO PA-LINE-COUNTER                              08770099
087800       ADD PC-ONE TO PA-REPORT-RECORDS-WRITTEN                    08780099
087900                                                                  08790099
088000     ELSE                                                         08800099
088100                                                                  08810099
088200       IF PS-GIFT-CARD                                            08820099
088300                                                                  08830099
088400         IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-PER-PAGE       08840099
088500           PERFORM F100-PROCESS-PAGE-BREAK                        08850099
088600           PERFORM F200-PRINT-STORE-LINE                          08860099
088700           PERFORM F220-PRINT-TERMINAL-LINE-CONT                  08870099
088800         END-IF                                                   08880099
088900                                                                  08890099
089000         WRITE REPORT-RECORD-GFT-CRD                              08900099
089100             FROM REPORT-DETAIL-LINE-SINGLE                       08910099
089200             AFTER ADVANCING 1 LINE                               08920099
089300                                                                  08930099
089400         ADD PC-ONE TO PA-LINE-COUNTER-GFT-CRD                    08940099
089500         ADD PC-ONE TO PA-REP-REC-WRITTEN-GFT-CRD                 08950099
089600                                                                  08960099
089700       END-IF                                                     08970099
089800                                                                  08980099
089900     END-IF.                                                      08990099
090000                                                                  09000099
090100******************************************************************09010099
090200*     F100-PROCESS-PAGE-BREAK.                                   *09020099
090300* ==> PROCESSES:                                                 *09030099
090400*     - ADVANCES TO A NEW PAGE AND WRITES THE REPORT HEADINGS    *09040099
090500* ==> PERFORMED FROM:  E100-PRINT-DETAIL-LINE                    *09050099
090600*                      E110-PRINT-DETAIL                         *09060099
090700******************************************************************09070099
090800 F100-PROCESS-PAGE-BREAK.                                         09080099
090900                                                                  09090099
091000     IF PS-MERCHANDISE-RETURN-CREDIT                              09100099
091100                                                                  09110099
091200       SET PS-FIRST-LINE-PRINT TO TRUE                            09120099
091300       ADD PC-ONE                TO PA-PAGE-COUNTER               09130099
091400       MOVE PA-PAGE-COUNTER      TO DP132O-PAGE-NUMBER            09140099
091500       MOVE PC-ONE               TO DP132O-REPORT-NUMBER          09150099
091600                                                                  09160099
091700       MOVE PC-HEADER-LINE-COUNT TO PA-LINE-COUNTER               09170099
091800                                                                  09180099
091900       WRITE REPORT-RECORD                                        09190099
092000           FROM DP132O-STANDRD-HEADER-132-COLS                    09200099
092100           AFTER ADVANCING PAGE                                   09210099
092200                                                                  09220099
092300       INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR                  09230099
092400                                                                  09240099
092500       WRITE REPORT-RECORD                                        09250099
092600           FROM REPORT-TITLE-LINE                                 09260099
092700           AFTER ADVANCING 1 LINE                                 09270099
092800                                                                  09280099
092900       WRITE REPORT-RECORD                                        09290099
093000           FROM REPORT-SUBTITLE-LINE                              09300099
093100           AFTER ADVANCING 1 LINE                                 09310099
093200                                                                  09320099
093300     ELSE                                                         09330099
093400                                                                  09340099
093500       IF PS-GIFT-CARD                                            09350099
093600                                                                  09360099
093700         SET PS-FIRST-LINE-PRINT TO TRUE                          09370099
093800         ADD PC-ONE                   TO PA-PAGE-COUNTER-GFT-CRD  09380099
093900         MOVE PA-PAGE-COUNTER-GFT-CRD TO DP132O-PAGE-NUMBER       09390099
094000         MOVE PC-TWO                  TO DP132O-REPORT-NUMBER     09400099
094100                                                                  09410099
094200         MOVE PC-HEADER-LINE-COUNT TO PA-LINE-COUNTER-GFT-CRD     09420099
094300                                                                  09430099
094400         WRITE REPORT-RECORD-GFT-CRD                              09440099
094500             FROM DP132O-STANDRD-HEADER-132-COLS                  09450099
094600             AFTER ADVANCING PAGE                                 09460099
094700                                                                  09470099
094800         INITIALIZE DP132O-LASER-NEW-PAGE-INDICATR                09480099
094900                                                                  09490099
095000         WRITE REPORT-RECORD-GFT-CRD                              09500099
095100             FROM REPORT-TITLE-LINE-GFT-CRD                       09510099
095200             AFTER ADVANCING 1 LINE                               09520099
095300                                                                  09530099
095400         WRITE REPORT-RECORD-GFT-CRD                              09540099
095500             FROM REPORT-SUBTITLE-LINE                            09550099
095600             AFTER ADVANCING 1 LINE                               09560099
095700                                                                  09570099
095800       END-IF                                                     09580099
095900                                                                  09590099
096000     END-IF.                                                      09600099
096100******************************************************************09610099
096200*     F200-PRINT-STORE-LINE.                                     *09620099
096300* ==> PROCESSES:                                                 *09630099
096400*     - WRITES THE STORE/STORE DESC LINE ON THE REPORT           *09640099
096500* ==> PERFORMED FROM:  B200-PROCESS-KMRC                         *09650099
096600******************************************************************09660099
096700 F200-PRINT-STORE-LINE.                                           09670099
096800                                                                  09680099
096900     MOVE PV-HOLD-STR-NBR  TO RSL-STORE-NUMBER.                   09690099
097000     MOVE PV-HOLD-STR-NAME TO RSL-STORE-NAME.                     09700099
097100                                                                  09710099
097200     IF PS-MERCHANDISE-RETURN-CREDIT                              09720099
097300                                                                  09730099
097400       IF PA-LINE-COUNTER > PC-MAX-LINES-PER-PAGE                 09740099
097500         PERFORM F100-PROCESS-PAGE-BREAK                          09750099
097600       END-IF                                                     09760099
097700                                                                  09770099
097800       WRITE REPORT-RECORD                                        09780099
097900           FROM REPORT-STORE-LINE                                 09790099
098000           AFTER ADVANCING 2 LINES                                09800099
098100                                                                  09810099
098200       ADD PC-TWO   TO PA-LINE-COUNTER                            09820099
098300                                                                  09830099
098400     ELSE                                                         09840099
098500                                                                  09850099
098600       IF PS-GIFT-CARD                                            09860099
098700                                                                  09870099
098800         IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-PER-PAGE       09880099
098900           PERFORM F100-PROCESS-PAGE-BREAK                        09890099
099000         END-IF                                                   09900099
099100                                                                  09910099
099200         WRITE REPORT-RECORD-GFT-CRD                              09920099
099300             FROM REPORT-STORE-LINE                               09930099
099400             AFTER ADVANCING 2 LINES                              09940099
099500                                                                  09950099
099600         ADD PC-TWO   TO PA-LINE-COUNTER-GFT-CRD                  09960099
099700                                                                  09970099
099800       END-IF                                                     09980099
099900                                                                  09990099
100000     END-IF.                                                      10000099
100100******************************************************************10010099
100200*     F210-PRINT-TERMINAL-LINE.                                  *10020099
100300* ==> PROCESSES:                                                 *10030099
100400*     - WRITES THE TERMINAL DESC LINE ON THE REPORT              *10040099
100500*     - ISSUES A PAGE BREAK IF THE NEW TERMINAL LINE WOULD BE    *10050099
100600*       WRITTEN AFTER THE 57TH LINE.  THIS WILL PREVENT A NEW    *10060099
100700*       TERMINAL LINE BEING THE LAST LINE ON A PAGE.             *10070099
100800* ==> PERFORMED FROM:  B100-INITIALIZE                           *10080099
100900*                      B200-PROCESS-KMRC                         *10090099
101000*                      B300-PROCESS-TERMINAL                     *10100099
101100******************************************************************10110099
101200 F210-PRINT-TERMINAL-LINE.                                        10120099
101300                                                                  10130099
101400     MOVE PV-HOLD-POS-TRMNL-NBR TO RTL-TERM-NBR.                  10140099
101500                                                                  10150099
101600     IF PS-MERCHANDISE-RETURN-CREDIT                              10160099
101700                                                                  10170099
101800       IF PA-LINE-COUNTER > PC-MAX-LINES-BEFORE-TERM              10180099
101900         PERFORM F100-PROCESS-PAGE-BREAK                          10190099
102000         PERFORM F200-PRINT-STORE-LINE                            10200099
102100       END-IF                                                     10210099
102200                                                                  10220099
102300       WRITE REPORT-RECORD                                        10230099
102400           FROM REPORT-TERMINAL-LINE                              10240099
102500           AFTER ADVANCING 1 LINES                                10250099
102600                                                                  10260099
102700       ADD PC-ONE TO PA-LINE-COUNTER                              10270099
102800                                                                  10280099
102900     ELSE                                                         10290099
103000                                                                  10300099
103100       IF PS-GIFT-CARD                                            10310099
103200                                                                  10320099
103300         IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-BEFORE-TERM    10330099
103400           PERFORM F100-PROCESS-PAGE-BREAK                        10340099
103500           PERFORM F200-PRINT-STORE-LINE                          10350099
103600         END-IF                                                   10360099
103700                                                                  10370099
103800         WRITE REPORT-RECORD-GFT-CRD                              10380099
103900             FROM REPORT-TERMINAL-LINE                            10390099
104000             AFTER ADVANCING 1 LINES                              10400099
104100                                                                  10410099
104200         ADD PC-ONE TO PA-LINE-COUNTER-GFT-CRD                    10420099
104300                                                                  10430099
104400       END-IF                                                     10440099
104500                                                                  10450099
104600     END-IF.                                                      10460099
104700******************************************************************10470099
104800*     F220-PRINT-TERMINAL-LINE-CONT.                             *10480099
104900* ==> PROCESSES:                                                 *10490099
105000*     - WRITES THE TERMINAL DESC LINE ON THE REPORT              *10500099
105100* ==> PERFORMED FROM:  B100-INITIALIZE                           *10510099
105200*                      B200-PROCESS-KMRC                         *10520099
105300*                      B300-PROCESS-TERMINAL                     *10530099
105400******************************************************************10540099
105500 F220-PRINT-TERMINAL-LINE-CONT.                                   10550099
105600                                                                  10560099
105700     MOVE PV-HOLD-POS-TRMNL-NBR TO RTLC-TERM-NBR.                 10570099
105800                                                                  10580099
105900     IF PS-MERCHANDISE-RETURN-CREDIT                              10590099
106000                                                                  10600099
106100       IF PA-LINE-COUNTER = PC-MAX-LINES-PER-PAGE                 10610099
106200         PERFORM F100-PROCESS-PAGE-BREAK                          10620099
106300         PERFORM F200-PRINT-STORE-LINE                            10630099
106400       END-IF                                                     10640099
106500                                                                  10650099
106600       WRITE REPORT-RECORD                                        10660099
106700           FROM REPORT-TERMINAL-LINE-CONT                         10670099
106800           AFTER ADVANCING 1 LINES                                10680099
106900                                                                  10690099
107000       ADD PC-ONE TO PA-LINE-COUNTER                              10700099
107100                                                                  10710099
107200     ELSE                                                         10720099
107300                                                                  10730099
107400       IF PS-GIFT-CARD                                            10740099
107500                                                                  10750099
107600         IF PA-LINE-COUNTER-GFT-CRD = PC-MAX-LINES-PER-PAGE       10760099
107700           PERFORM F100-PROCESS-PAGE-BREAK                        10770099
107800           PERFORM F200-PRINT-STORE-LINE                          10780099
107900         END-IF                                                   10790099
108000                                                                  10800099
108100         WRITE REPORT-RECORD-GFT-CRD                              10810099
108200             FROM REPORT-TERMINAL-LINE-CONT                       10820099
108300             AFTER ADVANCING 1 LINES                              10830099
108400                                                                  10840099
108500         ADD PC-ONE TO PA-LINE-COUNTER-GFT-CRD                    10850099
108600                                                                  10860099
108700       END-IF                                                     10870099
108800                                                                  10880099
108900     END-IF.                                                      10890099
109000******************************************************************10900099
109100*     F300-PRINT-TOTAL-STORE-LINE.                               *10910099
109200* ==> PROCESSES:                                                 *10920099
109300*     - WRITES THE STORE TOTAL OF KMRC, OR GIFT CARD ON THE RPT. *10930099
109400* ==> PERFORMED FROM:  B200-PROCESS-KMRC                         *10940099
109500******************************************************************10950099
109600 F300-PRINT-TOTAL-STORE-LINE.                                     10960099
109700                                                                  10970099
109800     MOVE PA-STORE-TOTAL-KMRC TO RTSL-TOTAL-CARDS.                10980099
109900                                                                  10990099
110000     IF PS-MERCHANDISE-RETURN-CREDIT                              11000099
110100       IF PA-LINE-COUNTER > PC-MAX-LINES-PER-PAGE                 11010099
110200         PERFORM F100-PROCESS-PAGE-BREAK                          11020099
110300         PERFORM F200-PRINT-STORE-LINE                            11030099
110400       END-IF                                                     11040099
110500                                                                  11050099
110600       WRITE REPORT-RECORD                                        11060099
110700           FROM REPORT-TOTAL-STORE-LINE                           11070099
110800           AFTER ADVANCING 2 LINES                                11080099
110900                                                                  11090099
111000       ADD PC-TWO TO PA-LINE-COUNTER                              11100099
111100                                                                  11110099
111200     ELSE                                                         11120099
111300                                                                  11130099
111400       IF PS-GIFT-CARD                                            11140099
111500                                                                  11150099
111600         IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-PER-PAGE       11160099
111700           PERFORM F100-PROCESS-PAGE-BREAK                        11170099
111800           PERFORM F200-PRINT-STORE-LINE                          11180099
111900         END-IF                                                   11190099
112000                                                                  11200099
112100         WRITE REPORT-RECORD-GFT-CRD                              11210099
112200             FROM REPORT-TOTAL-STORE-LINE                         11220099
112300             AFTER ADVANCING 2 LINES                              11230099
112400                                                                  11240099
112500         ADD PC-TWO TO PA-LINE-COUNTER-GFT-CRD                    11250099
112600                                                                  11260099
112700       END-IF                                                     11270099
112800                                                                  11280099
112900     END-IF.                                                      11290099
113000                                                                  11300099
113100******************************************************************11310099
113200*     F310-PRINT-TOTAL-TERMINAL-LINE.                            *11320099
113300* ==> PROCESSES:                                                 *11330099
113400*     - WRITES THE TERMINAL TOTAL LINE ON THE REPORT             *11340099
113500* ==> PERFORMED FROM:  B300-PROCESS-STORE                        *11350099
113600******************************************************************11360099
113700 F310-PRINT-TOTAL-TERMINAL-LINE.                                  11370099
113800                                                                  11380099
113900     MOVE PA-TERMINAL-TOTAL-KMRC TO RTTL-TOTAL-CARDS.             11390099
114000                                                                  11400099
114100     IF PS-MERCHANDISE-RETURN-CREDIT                              11410099
114200                                                                  11420099
114300       IF PA-LINE-COUNTER > PC-MAX-LINES-BEFORE-TERM              11430099
114400         PERFORM F100-PROCESS-PAGE-BREAK                          11440099
114500         PERFORM F200-PRINT-STORE-LINE                            11450099
114600         PERFORM F220-PRINT-TERMINAL-LINE-CONT                    11460099
114700       END-IF                                                     11470099
114800                                                                  11480099
114900       WRITE REPORT-RECORD                                        11490099
115000           FROM REPORT-DASH-LINE                                  11500099
115100           AFTER ADVANCING 1 LINE                                 11510099
115200                                                                  11520099
115300       WRITE REPORT-RECORD                                        11530099
115400           FROM REPORT-TOTAL-TERMINAL-LINE                        11540099
115500           AFTER ADVANCING 1 LINE                                 11550099
115600                                                                  11560099
115700       ADD PC-TWO TO PA-LINE-COUNTER                              11570099
115800                                                                  11580099
115900     ELSE                                                         11590099
116000                                                                  11600099
116100       IF PS-GIFT-CARD                                            11610099
116200                                                                  11620099
116300         IF PA-LINE-COUNTER-GFT-CRD > PC-MAX-LINES-BEFORE-TERM    11630099
116400           PERFORM F100-PROCESS-PAGE-BREAK                        11640099
116500           PERFORM F200-PRINT-STORE-LINE                          11650099
116600           PERFORM F220-PRINT-TERMINAL-LINE-CONT                  11660099
116700         END-IF                                                   11670099
116800                                                                  11680099
116900         WRITE REPORT-RECORD-GFT-CRD                              11690099
117000             FROM REPORT-DASH-LINE                                11700099
117100             AFTER ADVANCING 1 LINE                               11710099
117200                                                                  11720099
117300         WRITE REPORT-RECORD-GFT-CRD                              11730099
117400             FROM REPORT-TOTAL-TERMINAL-LINE                      11740099
117500             AFTER ADVANCING 1 LINE                               11750099
117600                                                                  11760099
117700         ADD PC-TWO TO PA-LINE-COUNTER-GFT-CRD                    11770099
117800                                                                  11780099
117900       END-IF                                                     11790099
118000                                                                  11800099
118100     END-IF.                                                      11810099
118200                                                                  11820099
118300******************************************************************11830099
118400*     G100-GET-STORE-NAME.                                       *11840099
118500* ==> PROCESSES:                                                 *11850099
118600*     - RETRIEVES THE STORE NAME FROM THE DB2 LOCATION TABLE.    *11860099
118700* ==> PERFORMED FROM:  B200-PROCESS-KMRC                         *11870099
118800******************************************************************11880099
118900 G100-GET-STORE-NAME.                                             11890099
119000     EXEC SQL                                                     11900099
119100        SELECT LOC_NM                                             11910099
119200          INTO  :XST00001-LOC-NM                                  11920099
119300          FROM  XST_LOC                                           11930099
119400         WHERE  LOC_NBR     = :XST00001-LOC-NBR                   11940099
119600     END-EXEC.                                                    11960099
119700                                                                  11970099
119800     EVALUATE TRUE                                                11980099
119900         WHEN SQLCODE = +0                                        11990099
120000             MOVE XST00001-LOC-NM    TO PV-HOLD-STR-NAME          12000099
120100         WHEN SQLCODE = +100                                      12010099
120200             MOVE SPACES             TO PV-HOLD-STR-NAME          12020099
120300         WHEN OTHER                                               12030099
120400             MOVE 'G100-GET-STORE-NAME           '                12040099
120500                               TO PV-PARAGRAPH-NAME               12050099
120600             MOVE 'SELECT LOC-NM FROM XST_LOC    '                12060099
120700                               TO PV-DB2-OPERATION-ATTEMPTED      12070099
120800             PERFORM Z900-SQL-ABEND                               12080099
120900     END-EVALUATE.                                                12090099
121000                                                                  12100099
121100******************************************************************12110099
121200*     Z900-SQL-ABEND                                             *12120099
121300* ==> PROCESSES:                                                 *12130099
121400*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *12140099
121500* ==> PERFORMED FROM:                                            *12150099
121600*                      B200-PROCESS-KMRC                         *12160099
121700*                      D000-FETCH-KMRC-CURSOR                    *12170099
121800*                      G100-GET-STORE-NAME                       *12180099
121900******************************************************************12190099
122000 Z900-SQL-ABEND.                                                  12200099
122100                                                                  12210099
122200     DISPLAY 'Z900-SQL-ABEND'.                                    12220099
122300     DISPLAY '**  ABEND     **'.                                  12230099
122400     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               12240099
122500     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             12250099
122600     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    12260099
122700                                                                  12270099
122800******************************************************************12280099
122900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *12290099
123000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *12300099
123100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *12310099
123200* FORMAT.                                                        *12320099
123300******************************************************************12330099
123400     COPY DPPD004.                                                12340099
123500                                                                  12350099
123600     MOVE +4013 TO ABEND-CODE.                                    12360099
123700     CALL 'ILBOABN0' USING ABEND-CODE.                            12370099
