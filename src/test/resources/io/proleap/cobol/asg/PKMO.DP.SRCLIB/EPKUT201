000100*----------------------------------------------------------------*00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*----------------------------------------------------------------*00030001
000400 PROGRAM-ID.    EPKUT201.                                         00040001
000500 AUTHOR.        CHUCK HERO.                                       00050001
000600 DATE-WRITTEN.  27 NOVEMBER 2007.                                 00060001
000700 DATE-COMPILED.                                                   00070001
000800                                                                  00080001
000900*----------------------------------------------------------------*00090001
001000*     **   CREATE OFFERS FULL FILE REFRESH EXTRACT FILE   **     *00100001
001100*                **   NEXT GENERATION STORE   **                 *00110001
001200*----------------------------------------------------------------*00120001
001300*  THIS PROGRAM USES A BATCH CONTROL FILE WITH STORE NUMBERS,     00130001
001400*  GROUP TYPE CODES AND STORE GROUP IDS TO EXTRACT ALL THE        00140001
001500*  OFFERS WHICH APPLY TO THOSE STORE(S), IN ORDER TO PROVIDE      00150001
001600*  A FULL REFRESH FOR THOSE STORES.                               00160001
001700*                                                                 00170001
001800*  THIS PROGRAM EXTRACTS THE OFFERS INFORMATION FROM THE OFFERS   00180001
001900*  MANAGEMENT DATABASE, WHICH IS IN ORACLE.                       00190001
002000*                                                                 00191005
002100*----------------------------------------------------------------*00210001
002200*  ORACLE TABLES:                         DCLGEN:                *00220001
002300*  --------------                         -------                *00230001
002400*   K_OM01.OMT_OFR                        OMT00001               *00240001
002500*   K_OM01.OMT_OFR_SECT                   OMT00002               *00250001
002600*   K_OM01.OMT_OFR_SECT_BWP               OMT00003               *00260001
002700*   K_OM01.OMT_OFR_LOC_GP                 OMT00004               *00270001
002800*   K_OM01.OMT_MDSE_SET                   OMT00005               *00280001
002900*   K_OM01.OMT_POS_BTN                    OMT00006               *00290001
003000*   K_OM01.OMT_EVNT_CTG                   OMT00007               *00300001
003100*   K_OM01.OMT_OFR_CUSTFACG_DESC          OMT00008               *00310001
003200*   K_OM01.OMT_EVNT                       OMT00009               *00320001
003300*                                                                *00330001
003400*----------------------------------------------------------------*00340001
003500* HISTORY LOG:                                                    00350001
003600*----------------------------------------------------------------*00360001
003700* DATE:        31 JANUARY 2008                                    00370001
003800* WR/IR#:      WR#33714                                           00380001
003900* PROGRAMMER:  CHUCK HERO                                         00390001
004000* DESCRIPTION: INITIAL PROGRAM CREATION                           00400001
004100*----------------------------------------------------------------*00410001
004200* DATE:        19 JUNE 2008                                       00420001
004300* WR/IR#:                                                         00430001
004400* PROGRAMMER:  MEDHA CHOUDHURY                                    00440001
004500* DESCRIPTION: SPRING 2009 RELEASE                                00450001
004600*              HARDCODE THE PROMO-SCHM-CDE BASED ON  EVNT_TYP_CDE 00460001
004700*              IN OMT_ENVT TABLE                                  00470001
004800*----------------------------------------------------------------*00480001
004900* DATE:        08/22/2008                                         00490001
005000* WR/IR#:      WR34938                                            00500001
005010* PROGRAMMER:  THOMAS HANSON                                      00501001
005020* DESCRIPTION: ADDED BWP_DLT_IND FIELD TO CURSOR, MUST BE 'N' TO  00502001
005030*              BE PULLED FOR THE EXTRACT. CHANGES MARKED '080822'.00503001
005031*----------------------------------------------------------------*00503101
214901*                                                                 00503206
214901* DATE: 12/19/2018                                                00503306
214901* WR/IR#: CHG0214901                                              00503406
214901* PROGRAMMER: JIM ARENDT                                          00503506
214901* DESCRIPTION: IN CURSROR OFFERCRSR ADDED 'TO_CHAR' TO CHANGE THE 00503606
214901*              INPUT FORMAT OF THE TIMESTAMP DATES.               00503706
005031*----------------------------------------------------------------*00503806
002000*                                                                 00503906
005032* DATE:                                                           00504001
005033* WR/IR#:                                                         00504101
005034* PROGRAMMER:                                                     00504201
005035* DESCRIPTION:                                                    00504301
005036*                                                                 00504401
005037*----------------------------------------------------------------*00504501
005038*                                                                 00504601
005039 ENVIRONMENT DIVISION.                                            00504701
005040*----------------------------------------------------------------*00504801
005050 CONFIGURATION SECTION.                                           00505001
005060 SOURCE-COMPUTER. IBM-3090.                                       00506001
005070 OBJECT-COMPUTER. IBM-3090.                                       00507001
005080                                                                  00508001
005090 INPUT-OUTPUT SECTION.                                            00509001
005100                                                                  00510001
005200 FILE-CONTROL.                                                    00520001
005300                                                                  00530001
005400     SELECT REFRESH-STORE-CARD-FILE           ASSIGN TO INP01.    00540001
005500                                                                  00550001
005600     SELECT CONTROL-CARD-NXT-FUT-DAY          ASSIGN TO INP02.    00560001
005700                                                                  00570001
005800     SELECT ORACLE-LOGIN-FILE                 ASSIGN TO ORALOGON. 00580001
005900                                                                  00590001
006000     SELECT CONTROL-CARD-BATCH-DATE           ASSIGN TO INP04.    00600001
006100                                                                  00610001
006200     SELECT OFFERS-FULL-REFRESH-FILE          ASSIGN TO OUT01.    00620001
006300                                                                  00630001
006400     SELECT REFRESH-STORE-LIST-FILE           ASSIGN TO OUT02.    00640001
006500                                                                  00650001
006600*----------------------------------------------------------------*00660001
006700 DATA DIVISION.                                                   00670001
006800*----------------------------------------------------------------*00680001
006900 FILE SECTION.                                                    00690001
007000 FD  REFRESH-STORE-CARD-FILE                                      00700001
007100     RECORDING MODE IS F                                          00710001
007200     LABEL RECORDS ARE STANDARD                                   00720001
007300     RECORD CONTAINS 080 CHARACTERS                               00730001
007400     BLOCK CONTAINS 0 RECORDS                                     00740001
007500     DATA RECORD IS REFRESH-STORE-CARD-RECORD.                    00750001
007600                                                                  00760001
007700 01  REFRESH-STORE-CARD-RECORD        PIC X(080).                 00770001
007800                                                                  00780001
007900 FD  CONTROL-CARD-NXT-FUT-DAY                                     00790001
008000     RECORDING MODE IS F                                          00800001
008100     LABEL RECORDS ARE STANDARD                                   00810001
008200     RECORD CONTAINS 080 CHARACTERS                               00820001
008300     BLOCK CONTAINS 0 RECORDS                                     00830001
008400     DATA RECORD IS CONTROL-NXT-FUT-DAY-RECORD.                   00840001
008500                                                                  00850001
008600 01  CONTROL-NXT-FUT-DAY-RECORD       PIC X(080).                 00860001
008700                                                                  00870001
008800 FD  ORACLE-LOGIN-FILE                                            00880001
008900     RECORDING MODE IS F                                          00890001
009000     LABEL RECORDS ARE STANDARD                                   00900001
009100     RECORD CONTAINS 080 CHARACTERS                               00910001
009200     BLOCK CONTAINS 0 RECORDS                                     00920001
009300     DATA RECORD IS ORACLE-LOGIN-RCD.                             00930001
009400                                                                  00940001
009500 01  ORACLE-LOGIN-RCD                 PIC X(080).                 00950001
009600                                                                  00960001
009700 FD  CONTROL-CARD-BATCH-DATE                                      00970001
009800     RECORDING MODE IS F                                          00980001
009900     LABEL RECORDS ARE STANDARD                                   00990001
010000     RECORD CONTAINS 080 CHARACTERS                               01000001
010100     BLOCK CONTAINS 0 RECORDS                                     01010001
010200     DATA RECORD IS CONTROL-BATCH-DATE-RECORD.                    01020001
010300                                                                  01030001
010400 01  CONTROL-BATCH-DATE-RECORD        PIC X(080).                 01040001
010500                                                                  01050001
010600 FD  OFFERS-FULL-REFRESH-FILE                                     01060001
010700     RECORDING MODE IS F                                          01070001
010800     LABEL RECORDS ARE STANDARD                                   01080001
010900     RECORD CONTAINS 176 CHARACTERS                               01090001
011000     BLOCK CONTAINS 0 RECORDS                                     01100001
011100     DATA RECORD IS OFFERS-FULL-REFRESH-RECORD.                   01110001
011200                                                                  01120001
011300 01  OFFERS-FULL-REFRESH-RECORD        PIC X(176).                01130001
011400                                                                  01140001
011500 FD  REFRESH-STORE-LIST-FILE                                      01150001
011600     RECORDING MODE IS F                                          01160001
011700     LABEL RECORDS ARE STANDARD                                   01170001
011800     RECORD CONTAINS 050 CHARACTERS                               01180001
011900     BLOCK CONTAINS 0 RECORDS                                     01190001
012000     DATA RECORD IS REFRESH-STORE-LIST-RECORD.                    01200001
012100                                                                  01210001
012200 01  REFRESH-STORE-LIST-RECORD        PIC X(050).                 01220001
012300                                                                  01230001
012400*----------------------------------------------------------------*01240001
012500                                                                  01250001
012600 WORKING-STORAGE SECTION.                                         01260001
012700                                                                  01270001
012800*----------------------------------------------------------------*01280001
012900                                                                  01290001
013000*----------------------------------------------------------------*01300001
013100* PC- PROGRAM CONSTANTS                                          *01310001
013200*----------------------------------------------------------------*01320001
013300 01  PC-PROGRAM-CONSTANTS.                                        01330001
013400     05  FILLER                       PIC  X(27) VALUE            01340001
013500        'WORKING STORAGE STARTS HERE'.                            01350001
013600     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'EPKUT201'.01360001
013700     05  PC-MAX-RETRIES               PIC  9(01) VALUE 5.         01370001
013800     05  PC-FIELD-LENGTH              PIC S9(03) VALUE +10 COMP-3.01380001
013900     05  PC-START-DTE-DECR-DAYS       PIC  9(03) VALUE 365.       01390001
014000     05  PC-NO-REFRESHES-FOUND        PIC  X(49) VALUE            01400001
014100             'NO STORES IDENTIFIED TO RECEIVE AN OFFERS REFRESH'. 01410001
014200     05  PC-DFLT-PROMO-SCHM-CDE-1008  PIC  9(04) VALUE 1008.      01420001
014300     05  PC-DFLT-PROMO-SCHM-CDE-1009  PIC  9(04) VALUE 1009.      01430001
014400     05  PC-DFLT-PROMO-SCHM-CDE-1010  PIC  9(04) VALUE 1010.      01440001
014500     05  PC-NULL-FIELD-VALUE          PIC  X(01) VALUE '~'.       01450001
014600     05  PC-ROW-NOT-FOUND             PIC  9(04) VALUE 1403.      01460001
014700     05  PC-STR-GP-TYP-SPECIFIC-STR   PIC  9(05) VALUE 5000.      01470001
014800     05  PC-MAX-BTN-INDEX-VALUE       PIC  9(04) VALUE 10.        01480001
014810     05  PC-AUTO-LOGON                PIC X(01)       VALUE '/'.  01481001
014820                                                                  01482001
014830*----------------------------------------------------------------*01483001
014840* PS- PROGRAM SWITCHES                                           *01484001
014850*----------------------------------------------------------------*01485001
014860 01  PS-PROGRAM-SWITCHES.                                         01486001
014870     05  PS-BATCH-DTE-CNTL-EOF-SW     PIC  X(01) VALUE 'N'.       01487001
014880         88  PS-END-OF-CC-BATCH-DTE              VALUE 'Y'.       01488001
014890         88  PS-NOT-EOF-CC-BATCH-DTE             VALUE 'N'.       01489001
014900     05  PS-END-OF-CC-NXT-FUT-DAY-SW  PIC  X(01) VALUE 'N'.       01490001
015000         88  PS-END-OF-CC-NXT-FUT-DAY            VALUE 'Y'.       01500001
015100         88  PS-NOT-END-OF-CC-NXT-FUT-DAY        VALUE 'N'.       01510001
015200     05  PS-END-OF-REFRESH-CSR-SW     PIC  X(01) VALUE 'N'.       01520001
015300         88  PS-END-OF-REFRESH-CSR               VALUE 'Y'.       01530001
015400         88  PS-NOT-END-OF-REFRESH-CSR           VALUE 'N'.       01540001
015500     05  PS-DATE-ROUTINE-1-SW         PIC  X(01) VALUE 'N'.       01550001
015600         88  PS-DATE-FOUND                       VALUE 'Y'.       01560001
015700         88  PS-DATE-NOT-FOUND                   VALUE 'N'.       01570001
015800     05  PS-DATE-ROUTINE-2-SW         PIC  X(01) VALUE 'N'.       01580001
015900         88  PS-DATE-VALID                       VALUE 'Y'.       01590001
016000         88  PS-DATE-NOT-VALID                   VALUE 'N'.       01600001
016100     05  PS-END-OF-STR-GP-FILE-SW     PIC  X(01) VALUE 'N'.       01610001
016200         88  PS-END-OF-STR-GP-FILE               VALUE 'Y'.       01620001
016300         88  PS-NOT-END-OF-STR-GP-FILE           VALUE 'N'.       01630001
016400     05  PS-END-OF-FETCH-BTN-SW       PIC  X(01) VALUE 'N'.       01640001
016500         88  PS-END-OF-FETCH-BTN                 VALUE 'Y'.       01650001
016600         88  PS-NOT-END-OF-FETCH-BTN             VALUE 'N'.       01660001
016700     05  PS-FIRST-READ-STR-GP-SW      PIC  X(01) VALUE 'Y'.       01670001
016800         88  PS-FIRST-READ-STR-GP                VALUE 'Y'.       01680001
016900         88  PS-NOT-FIRST-READ-STR-GP            VALUE 'N'.       01690001
016910     05  PS-ORACLE-LOGIN-EOF-SW     PIC X(01)       VALUE 'N'.    01691001
016920         88  ORACLE-LOGIN-EOF                       VALUE 'Y'.    01692001
016930                                                                  01693001
016940*--------------------------------------------------------------*  01694001
016950* PV- PROGRAM VARIABLES                                           01695001
016960*--------------------------------------------------------------*  01696001
016970 01  CC-ORACLE-CONNECTION.                                        01697001
016980     05  CC-ORACLE-USERID        PIC X(40).                       01698001
016990         88 CC-AUTO-LOGON                   VALUE '/'.            01699001
017000     05  CC-ORACLE-PASSWORD      PIC X(40).                       01700001
017100                                                                  01710001
017200 01  PV-PROGRAM-VARIABLES.                                        01720001
017300     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 01730001
017400     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      01740001
017500     05  PV-SPACE                     PIC  X(01) VALUE SPACE.     01750001
017600     05  PV-SQL-SUB                   PIC S9(04) VALUE 0  COMP.   01760001
017700     05  PV-DAYS-AHEAD                PIC  9(05) VALUE 0.         01770001
017800     05  PV-BATCH-DATE                PIC  X(10) VALUE SPACES.    01780001
017900     05  PV-EXTR-START-DTE            PIC  X(10) VALUE SPACES.    01790001
018000     05  PV-EFF-BEG-TMST.                                         01800001
018100         10  PV-EFF-BEG-DATE          PIC X(10).                  01810001
018200         10  PV-EFF-BEG-TIME          PIC X(09).                  01820001
018300     05  PV-EFF-END-TMST.                                         01830001
018400         10  PV-EFF-END-DATE          PIC X(10).                  01840001
018500         10  PV-EFF-END-TIME          PIC X(09).                  01850001
018600     05  PV-EFF-DATE.                                             01860001
018700         10 PV-DATE-CCYY              PIC X(04).                  01870001
018800         10 PV-DATE-MM                PIC X(02).                  01880001
018900         10 PV-DATE-DD                PIC X(02).                  01890001
019000     05  PV-FORMAT-DATE.                                          01900001
019100         10 PV-FORMAT-DATE-CCYY.                                  01910001
019200            15 PV-FORMAT-CC           PIC X(02).                  01920001
019300            15 PV-FORMAT-YY           PIC X(02).                  01930001
019400         10 PV-DASH1                  PIC X(01).                  01940001
019500         10 PV-FORMAT-DATE-MM         PIC X(02).                  01950001
019600         10 PV-DASH2                  PIC X(01).                  01960001
019700         10 PV-FORMAT-DATE-DD         PIC X(02).                  01970001
019800*                                                                 01980001
019900     05  PV-ORACLE-USERID-LEN       PIC S9(04)      VALUE ZEROS.  01990001
020000     05  PV-ORACLE-PASSWORD-LEN     PIC S9(04)      VALUE ZEROS.  02000001
020100                                                                  02010001
020200 01  PV-STORE-DATA.                                               02020001
020300     05  PV-SAVE-STR-NBR              PIC  9(05) VALUE 0.         02030001
020400     05  PV-STR-NBR                   PIC  9(05) VALUE 0.         02040001
020500     05  PV-STR-GP-TYP-CDE            PIC  9(05) VALUE 0.         02050001
020600     05  PV-STR-GRP-ID                PIC  9(10) VALUE 0.         02060001
020700                                                                  02070001
020800 01  PV-OFFER-DATA-WRITTEN.                                       02080001
020900     05  PV-OFR-ID                    PIC  9(10) VALUE ZEROS.     02090001
021000     05  PV-EVNT-ID                   PIC  9(10) VALUE ZEROS.     02100001
021100     05  PV-OFR-SECT-TYP-CDE          PIC  X(01) VALUE SPACE.     02110001
021200     05  PV-OFR-SECT-BWP-ID           PIC  9(10) VALUE ZEROS.     02120001
021300     05  PV-MDSE-SET-ID               PIC  9(10) VALUE ZEROS.     02130001
021400*                                                                 02140001
021500*----------------------------------------------------------------*02150001
021600* DF- DATE AND TIME FIELDS USED IN P9990-                        *02160001
021700*----------------------------------------------------------------*02170001
021800 01  DF-DATE-TIME-FIELDS.                                         02180001
021900     05  DF-CURRENT-DATE-TIME.                                    02190001
022000         10  DF-CURRENT-YR            PIC  9(04) VALUE ZEROS.     02200001
022100         10  DF-CURRENT-MO            PIC  9(02) VALUE ZEROS.     02210001
022200         10  DF-CURRENT-DY            PIC  9(02) VALUE ZEROS.     02220001
022300         10  DF-CURRENT-HR            PIC  9(02) VALUE ZEROS.     02230001
022400         10  DF-CURRENT-MIN           PIC  9(02) VALUE ZEROS.     02240001
022500         10  DF-CURRENT-SEC           PIC  9(02) VALUE ZEROS.     02250001
022600         10  DF-CURRENT-HSEC          PIC  9(02) VALUE ZEROS.     02260001
022700     05  DF-DISPLAY-DATE.                                         02270001
022800         10  DF-DD-YR                 PIC  X(04) VALUE SPACES.    02280001
022900         10  FILLER                   PIC  X(01) VALUE '-'.       02290001
023000         10  DF-DD-MO                 PIC  X(02) VALUE SPACES.    02300001
023100         10  FILLER                   PIC  X(01) VALUE '-'.       02310001
023200         10  DF-DD-DY                 PIC  X(02) VALUE SPACES.    02320001
023300     05  DF-DISPLAY-TIME.                                         02330001
023400         10  DF-DT-HR                 PIC  X(02) VALUE SPACES.    02340001
023500         10  FILLER                   PIC  X(01) VALUE ':'.       02350001
023600         10  DF-DT-MIN                PIC  X(02) VALUE SPACES.    02360001
023700         10  FILLER                   PIC  X(01) VALUE ':'.       02370001
023800         10  DF-DT-SEC                PIC  X(02) VALUE SPACES.    02380001
023900                                                                  02390001
024000*----------------------------------------------------------------*02400001
024100* NULL INDICATORS                                                 02410001
024200*    -1 INDICATES VALUE IS NULL                                   02420001
024300*    +0 INDICATES NON-NULL VALUE                                  02430001
024400*----------------------------------------------------------------*02440001
024500 01  PV-NULL-INDICATORS.                                          02450001
024600     05  PV-POS-RLTV-NUM-NULL-IND     PIC S9(4) COMP VALUE +0.    02460001
024700     05  PV-ITM-DISC-APL-NULL-IND     PIC S9(4) COMP VALUE +0.    02470001
024800     05  PV-POS-BTN-CDE-NULL-IND      PIC S9(4) COMP VALUE +0.    02480001
024900     05  PV-BWP-BUY-QTY-NULL-IND      PIC S9(4) COMP VALUE +0.    02490001
025000     05  PV-BWP-BUY-AMT-NULL-IND      PIC S9(4) COMP VALUE +0.    02500001
025100     05  PV-BWP-BUY-TOL-AMT-NULL-IND  PIC S9(4) COMP VALUE +0.    02510001
025200     05  PV-BWP-GET-QTY-NULL-IND      PIC S9(4) COMP VALUE +0.    02520001
025300     05  PV-BWP-GET-PCT-NULL-IND      PIC S9(4) COMP VALUE +0.    02530001
025400     05  PV-BWP-GET-DOL-NULL-IND      PIC S9(4) COMP VALUE +0.    02540001
025500     05  PV-BWP-GET-PRPT-NULL-IND     PIC S9(4) COMP VALUE +0.    02550001
025600     05  PV-MDSE-DEPT-NBR-NULL-IND    PIC S9(4) COMP VALUE +0.    02560001
025700     05  PV-MDSE-MAJ-CLS-NULL-IND     PIC S9(4) COMP VALUE +0.    02570001
025800     05  PV-MDSE-SUB-CLS-NULL-IND     PIC S9(4) COMP VALUE +0.    02580001
025900     05  PV-MDSE-STL-ID-NULL-IND      PIC S9(4) COMP VALUE +0.    02590001
026000     05  PV-MDSE-SKU-NB-NULL-IND      PIC S9(4) COMP VALUE +0.    02600001
026100     05  PV-MDSE-EMP-DS-NULL-IND      PIC S9(4) COMP VALUE +0.    02610001
026200     05  PV-MDSE-DSC-EL-NULL-IND      PIC S9(4) COMP VALUE +0.    02620001
026300     05  PV-MDSE-TKT-CL-NULL-IND      PIC S9(4) COMP VALUE +0.    02630001
026400*                                                                 02640001
026500*----------------------------------------------------------       02650001
026600* PV- PROGRAM VARIABLES                                           02660001
026700*     (THE BELOW TABLE WILL HOLD ALL THE ROWS OF                  02670001
026800*                       K_OM01.OMT_POS_BTN TABLE )                02680001
026900*----------------------------------------------------------       02690001
027000 01  PV-OMT-POS-BTN.                                              02700001
027100     05  PV-BTN-RECORD                OCCURS 10 TIMES             02710001
027200                                      INDEXED BY PV-BTN-INDEX.    02720001
027300         10  PV-POS-BTN-CDE           PIC X(03).                  02730001
027400         10  PV-POS-BTN-TEXT          PIC X(16).                  02740001
027500         10  PV-POS-BTN-RLTV-SEQ-NBR  PIC 9(10).                  02750001
027600         10  PV-POS-BTN-RLTV-SEQ-NBR-X REDEFINES                  02760001
027700             PV-POS-BTN-RLTV-SEQ-NBR  PIC X(10).                  02770001
027800*                                                                 02780001
027900*----------------------------------------------------------------*02790001
028000* PV- PROGRAM COUNT VARIABLES                                    *02800001
028100*----------------------------------------------------------------*02810001
028200 01  PV-PROGRAM-COUNTERS.                                         02820001
028300     05  PV-RECS-READ                 PIC  9(09) VALUE 0.         02830001
028400     05  PV-STORE-RFRSH-COUNT         PIC  9(09) VALUE 0.         02840001
028500     05  PV-POS-BTN-REC-FETCHED       PIC  9(09) VALUE 0.         02850001
028600     05  PV-OFR-CRSR-RECS-FETCHED     PIC  9(09) VALUE 0.         02860001
028700     05  PV-OFFER-RECS-OUT            PIC  9(09) VALUE 0.         02870001
028800     05  PV-OFRSECT-RECS-OUT          PIC  9(09) VALUE 0.         02880001
028900     05  PV-OFRBWP-RECS-OUT           PIC  9(09) VALUE 0.         02890001
029000     05  PV-MDSESET-RECS-OUT          PIC  9(09) VALUE 0.         02900001
029100     05  PV-STR-LIST-RECS-OUT         PIC  9(09) VALUE 0.         02910001
029200                                                                  02920001
029300*----------------------------------------------------------------*02930001
029400* ERROR HANDLING                                                  02940001
029500*----------------------------------------------------------------*02950001
029600 01  PV-MISC-ABEND-FIELDS.                                        02960001
029700     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     02970001
029800     05  PV-ORA-OPERATION             PIC  X(50) VALUE SPACES.    02980001
029900     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     02990001
030000     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     03000001
030100     05  PV-CALLING-FUNCTION          PIC  X(40) VALUE SPACE.     03010001
030200         88  PV-BATCH-DATE-CARD       VALUE 'BATCH DATE CARD'.    03020001
030300         88  PV-NEXT-FUTURE-DATE-CARD VALUE                       03030001
030400                                       'NEXT/FUTURE DATE CARD'.   03040001
030500                                                                  03050001
030600 01  AC-ABEND-CODE                    PIC S9(04) VALUE +0         03060001
030700                                                 COMP SYNC.       03070001
030800     88  AC-4003-CONTROL-CARD-ERROR              VALUE +4003.     03080001
030900     88  AC-4004-TABLE-OVERFLOW-ERROR            VALUE +4004.     03090001
031000     88  AC-4008-INVALID-DATA                    VALUE +4008.     03100001
031100     88  AC-4013-ORACLE-ERROR                    VALUE +4013.     03110001
031200     88  AC-4019-CAL-SUB-ERROR                   VALUE +4019.     03120001
031300                                                                  03130001
031400*----------------------------------------------------------------*03140001
031500* VARIABLES REQUIRED FOR THE KOHL'S DATE ROUTINE DPKUT500        *03150001
031600*----------------------------------------------------------------*03160001
031700     COPY DPWS500.                                                03170001
031800                                                                  03180001
031900*----------------------------------------------------------       03190001
032000* COPYBOOK FOR DATA VALIDATION ROUTINE EPPD208                    03200001
032100*----------------------------------------------------------       03210001
032200     COPY EPWS208.                                                03220001
032300                                                                  03230001
032400*----------------------------------------------------------       03240001
032500* NETCOOL ERROR MESSAGE COPYBOOK                                  03250001
032600*----------------------------------------------------------       03260001
032700     COPY ISWS003.                                                03270001
032800                                                                  03280001
032900*----------------------------------------------------------------*03290001
033000* COPYBOOK FOR INPUT REFRESH STORES FILE                         *03300001
033100*----------------------------------------------------------------*03310001
033200     COPY EPRD250.                                                03320001
033300                                                                  03330001
033400*----------------------------------------------------------------*03340001
033500* COPYBOOK FOR INPUT NEXT FUTURE DAY CONTROL CARD EPCC252.       *03350001
033600*----------------------------------------------------------------*03360001
033700     COPY EPRD252.                                                03370001
033800                                                                  03380001
033900*----------------------------------------------------------------*03390001
034000* COPYBOOK FOR INPUT BATCH DATE CONTROL CARD EPCC257             *03400001
034100*----------------------------------------------------------------*03410001
034200     COPY EPRD257.                                                03420001
034300                                                                  03430001
034400*----------------------------------------------------------------*03440001
034500* COPYBOOK FOR OUTPUT OFFERS REFRESH FILE - INTERMEDIATE         *03450001
034600*----------------------------------------------------------------*03460001
034700     COPY EPRD205.                                                03470001
034800                                                                  03480001
034900*----------------------------------------------------------------*03490001
035000* COPYBOOK FOR OUTPUT REFRESH STORE LIST FILE                    *03500001
035100*----------------------------------------------------------------*03510001
035200     COPY EPRD206.                                                03520001
035300                                                                  03530001
035400*----------------------------------------------------------------*03540001
035500* ORACLE DELARE SECTION START                                    *03550001
035600*----------------------------------------------------------------*03560001
035700     EXEC SQL                                                     03570001
035800        BEGIN DECLARE SECTION                                     03580001
035900     END-EXEC.                                                    03590001
036000                                                                  03600001
036100*----------------------------------------------------------------*03610001
036200* PD- ORA VARIABLES (NON DCLGEN)                                 *03620001
036300*----------------------------------------------------------------*03630001
036400 01  USERNAME                      PIC X(10)  VARYING.            03640001
036500 01  PASSWD                        PIC X(10)  VARYING.            03650001
036600 01  PV-ORACLE-ID                  PIC X(01)  VALUE '/'.          03660001
036700                                                                  03670001
036800*----------------------------------------------------------------*03680001
036900* OMT00001 - OMT_OFR  COPYBOOK                                   *03690001
037000* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR              *03700001
037100*----------------------------------------------------------------*03710001
037200     EXEC SQL                                                     03720001
037300         INCLUDE OMT00001                                         03730001
037400     END-EXEC.                                                    03740001
037500                                                                  03750001
037600*----------------------------------------------------------------*03760001
037700* OMT00002 - OMT_OFR_SECT COPYBOOK                               *03770001
037800* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_SECT         *03780001
037900*----------------------------------------------------------------*03790001
038000     EXEC SQL                                                     03800001
038100         INCLUDE OMT00002                                         03810001
038200     END-EXEC.                                                    03820001
038300                                                                  03830001
038400*----------------------------------------------------------------*03840001
038500* OMT00003 - OMT_OFR_SECT_BWP COPYBOOK                           *03850001
038600* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_SECT_BWP     *03860001
038700*----------------------------------------------------------------*03870001
038800     EXEC SQL                                                     03880001
038900         INCLUDE OMT00003                                         03890001
039000     END-EXEC.                                                    03900001
039100                                                                  03910001
039200*----------------------------------------------------------------*03920001
039300* OMT00004 - OMT_OFR_LOC_GP COPYBOOK                             *03930001
039400* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_LOC_GP       *03940001
039500*----------------------------------------------------------------*03950001
039600     EXEC SQL                                                     03960001
039700         INCLUDE OMT00004                                         03970001
039800     END-EXEC.                                                    03980001
039900                                                                  03990001
040000*----------------------------------------------------------------*04000001
040100* OMT00005 - OMT_MDSE_SET COPYBOOK                               *04010001
040200* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_MDSE_SET         *04020001
040300*----------------------------------------------------------------*04030001
040400     EXEC SQL                                                     04040001
040500         INCLUDE OMT00005                                         04050001
040600     END-EXEC.                                                    04060001
040700                                                                  04070001
040800*----------------------------------------------------------------*04080001
040900* OMT00006 - OMT_POS_BTN COPYBOOK                                *04090001
041000* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_POS_BTN          *04100001
041100*----------------------------------------------------------------*04110001
041200     EXEC SQL                                                     04120001
041300         INCLUDE OMT00006                                         04130001
041400     END-EXEC.                                                    04140001
041500                                                                  04150001
041600*----------------------------------------------------------------*04160001
041700* OMT00007 - OMT_EVNT_CTG COPYBOOK                               *04170001
041800* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_EVNT_CTG         *04180001
041900*----------------------------------------------------------------*04190001
042000     EXEC SQL                                                     04200001
042100         INCLUDE OMT00007                                         04210001
042200     END-EXEC.                                                    04220001
042300                                                                  04230001
042400*----------------------------------------------------------------*04240001
042500* OMT00008 - OMT_OFR_CUSTFACG_DESC COPYBOOK                      *04250001
042600* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_OFR_CUSTFACG_DESC*04260001
042700*----------------------------------------------------------------*04270001
042800     EXEC SQL                                                     04280001
042900         INCLUDE OMT00008                                         04290001
043000     END-EXEC.                                                    04300001
043100                                                                  04310001
043200*----------------------------------------------------------------*04320001
043300* OMT00009 - OMT_EVNT COPYBOOK                                   *04330001
043400* COBOL DECLARATION FOR ORACLE TABLE K_OM01.OMT_EVNT             *04340001
043500*----------------------------------------------------------------*04350001
043600     EXEC SQL                                                     04360001
043700         INCLUDE OMT00009                                         04370001
043800     END-EXEC.                                                    04380001
043900                                                                  04390001
044000*----------------------------------------------------------------*04400001
044100* ORACLE END OF DECLARATIVE SECTION                              *04410001
044200*----------------------------------------------------------------*04420001
044300     EXEC SQL                                                     04430001
044400       END DECLARE SECTION                                        04440001
044500     END-EXEC.                                                    04450001
044600                                                                  04460001
044700     EXEC SQL                                                     04470001
044800       INCLUDE SQLCACOB                                           04480001
044900     END-EXEC.                                                    04490001
045000*----------------------------------------------------------------*04500001
045100* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        *04510001
045200*----------------------------------------------------------------*04520001
045300     COPY DPWS004.                                                04530001
045400                                                                  04540001
045500*----------------------------------------------------------------*04550001
045600* ORA ABEND COPYBOOK                                             *04560001
045700*----------------------------------------------------------------*04570001
045800     COPY DPWS900.                                                04580001
045900                                                                  04590001
046000******************************************************************04600001
046100 PROCEDURE DIVISION.                                              04610001
046200******************************************************************04620001
046300 0000-MAINLINE.                                                   04630001
046400                                                                  04640001
046500     PERFORM 1000-INITIALIZATION.                                 04650001
046600                                                                  04660001
046700     PERFORM 2000-PROCESS-RFRSH-STRS                              04670001
046800       UNTIL PS-END-OF-STR-GP-FILE.                               04680001
046900                                                                  04690001
047000     PERFORM 9000-WRAPUP.                                         04700001
047100                                                                  04710001
047200     GOBACK.                                                      04720001
047300                                                                  04730001
047400*0000-EXIT.                                                       04740001
047500******************************************************************04750001
047600*   1000-INITIALIZATION.                                         *04760001
047700*     INTIALIZES VARIABLES, OPENS FILES, READS CONTROL CARDS,    *04770001
047800*     AND PERFORMS SET-UP ROUTINES.                              *04780001
047900******************************************************************04790001
048000 1000-INITIALIZATION.                                             04800001
048100     MOVE '1000-INITIALIZATION             ' TO PV-PARAGRAPH-NAME.04810001
048200                                                                  04820001
048300     PERFORM 9990-GET-CURRENT.                                    04830001
048400                                                                  04840001
048500     DISPLAY '****************************************'.          04850001
048600     DISPLAY '**          EPKUT201 STARTED          **'.          04860001
048700     DISPLAY '****************************************'.          04870001
048800     DISPLAY '** CURRENT DATE ' DF-DISPLAY-DATE                   04880001
048900             '            **'.                                    04890001
049000     DISPLAY '** CURRENT TIME ' DF-DISPLAY-TIME                   04900001
049100             '              **'.                                  04910001
049200     DISPLAY '****************************************'.          04920001
049300                                                                  04930001
049400     OPEN INPUT  REFRESH-STORE-CARD-FILE                          04940001
049500                 CONTROL-CARD-NXT-FUT-DAY                         04950001
049600                 ORACLE-LOGIN-FILE                                04960001
049700                 CONTROL-CARD-BATCH-DATE                          04970001
049800          OUTPUT OFFERS-FULL-REFRESH-FILE                         04980001
049900                 REFRESH-STORE-LIST-FILE.                         04990001
050000                                                                  05000001
050100     INITIALIZE EP250-CC-CONTROL-CARD.                            05010001
050200     INITIALIZE EP252-CC-CONTROL-CARD.                            05020001
050300     INITIALIZE EP257-CC-CONTROL-CARD.                            05030001
050400     INITIALIZE PS-PROGRAM-SWITCHES.                              05040001
050500     INITIALIZE PV-NULL-INDICATORS.                               05050001
050600     INITIALIZE PV-OMT-POS-BTN.                                   05060001
050700     INITIALIZE PV-PROGRAM-VARIABLES.                             05070001
050800     INITIALIZE PV-OFFER-DATA-WRITTEN.                            05080001
050900                                                                  05090001
051000     SET  PS-NOT-EOF-CC-BATCH-DTE      TO TRUE.                   05100001
051100     SET  PS-NOT-END-OF-CC-NXT-FUT-DAY TO TRUE.                   05110001
051200                                                                  05120001
051300** READ BATCH DATE CONTROL CARD                                   05130001
051400     PERFORM 8000-READ-BATCH-DATE-CNTL-CARD.                      05140001
051500                                                                  05150001
051600     DISPLAY '** INPUT BATCH DATE: ' EP257-CC-CRNT-DTE            05160001
051700             '            **'.                                    05170001
051800     DISPLAY '****************************************'.          05180001
051900                                                                  05190001
052000**  VALIDATE BATCH DATE CONTROL CARD                              05200001
052100     PERFORM 1100-VALIDATE-BATCH-DATE.                            05210001
052200                                                                  05220001
052300** READ NEXT/FUTURE DAY CONTROL CARD                              05230001
052400     PERFORM 8100-READ-CC-NXT-FUT-DAY.                            05240001
052500                                                                  05250001
052600     DISPLAY '** INPUT NEXT/FUTURE DAY CC: ' EP252-CC-CONTROL-CARD05260001
052700             '            **'.                                    05270001
052800     DISPLAY '****************************************'.          05280001
052900                                                                  05290001
053000     PERFORM 1200-DATE-ROUTINES.                                  05300001
053100                                                                  05310001
053200*   INITIAL READ OF INPUT STORE GROUP FILE                        05320001
053300     SET  PS-NOT-END-OF-STR-GP-FILE TO TRUE.                      05330001
053400     SET  PS-FIRST-READ-STR-GP      TO TRUE.                      05340001
053500                                                                  05350001
053600     PERFORM 8200-READ-STR-GRP-FILE.                              05360001
053700                                                                  05370001
053800     IF  PS-NOT-END-OF-STR-GP-FILE                                05380001
053900         PERFORM 1300-SETUP-FOR-ORACLE                            05390001
054000         PERFORM 1400-POPULATE-BTN-TBL                            05400001
054100     END-IF.                                                      05410001
054200                                                                  05420001
054300*1000-EXIT.                                                       05430001
054400******************************************************************05440001
054500* 1100-VALIDATE-BATCH-DATE.                                       05450001
054600*    VALIDATE THE INPUT BATCH DATE BY CALLING THE KOHLS CALENDAR  05460001
054700*    ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.      05470001
054800******************************************************************05480001
054900 1100-VALIDATE-BATCH-DATE.                                        05490001
055000                                                                  05500001
055100     IF  EP257-CC-CRNT-DTE  = SPACES                              05510001
055200         DISPLAY 'INVALID CONTROL CARD'                           05520001
055300         DISPLAY 'BATCH DATE: ' EP257-CC-CRNT-DTE                 05530001
055400         MOVE '1100-VALIDATE-BATCH-DATE' TO PV-PARAGRAPH-NAME     05540001
055500         MOVE 'CONTROL CARD IS INVALID'  TO PV-OPERATION-MSG-1    05550001
055600         SET  AC-4003-CONTROL-CARD-ERROR TO TRUE                  05560001
055700         PERFORM 9800-ABEND                                       05570001
055800     END-IF.                                                      05580001
055900                                                                  05590001
056000     INITIALIZE DPG51 DPG52 DPG53                                 05600001
056100                DPG54 DPG55 DPG56.                                05610001
056200                                                                  05620001
056300     SET  PV-BATCH-DATE-CARD    TO TRUE.                          05630001
056400     MOVE EP257-CC-CRNT-DTE          TO DPG52-LK-DATE-INPUT.      05640001
056500                                                                  05650001
056600     PERFORM 6000-VALIDATE-DATE-INPUT.                            05660001
056700                                                                  05670001
056800     IF  PS-DATE-VALID                                            05680001
056900         MOVE EP257-CC-CRNT-DTE      TO PV-BATCH-DATE             05690001
057000     END-IF.                                                      05700001
057100                                                                  05710001
057200*1100-EXIT.                                                       05720001
057300******************************************************************05730001
057400*1200-DATE-ROUTINES.                                             *05740001
057500*  VALIDATE INPUT NEXT FUTURE DATE - USED FOR EXTRACT END DATE,  *05750001
057600*  AND CALCULATE START DATE FOR EXTRACT.                         *05760001
057700******************************************************************05770001
057800 1200-DATE-ROUTINES.                                              05780001
057900     MOVE '1200-DATE-ROUTINES       ' TO PV-PARAGRAPH-NAME        05790001
058000                                                                  05800001
058100** ABEND IF BATCH DATE CONTROL CARD IS EMPTY                      05810001
058200     IF  EP252-CC-FUTURE-DATE  = SPACES                           05820001
058300         MOVE '1200-DATE-ROUTINES        ' TO PV-PARAGRAPH-NAME   05830001
058400         MOVE 'FUTURE DATE IS EMPTY '      TO PV-OPERATION-MSG-1  05840001
058500         SET  AC-4003-CONTROL-CARD-ERROR   TO TRUE                05850001
058600         PERFORM 9800-ABEND                                       05860001
058700     END-IF.                                                      05870001
058800                                                                  05880001
058900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05890001
059000     SET  PV-NEXT-FUTURE-DATE-CARD  TO TRUE.                      05900001
059100     MOVE EP252-CC-FUTURE-DATE      TO DPG52-LK-DATE-INPUT.       05910001
059200                                                                  05920001
059300     PERFORM 6000-VALIDATE-DATE-INPUT.                            05930001
059400                                                                  05940001
059500     PERFORM 6100-CALC-EXTR-START-DATE.                           05950001
059600                                                                  05960001
059700     MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-EXTR-START-DTE.         05970001
059800                                                                  05980001
059900     DISPLAY ' '.                                                 05990001
060000     DISPLAY '=================================================='.06000001
060100     DISPLAY ' *  EPKUT201  * '.                                  06010001
060200     DISPLAY ' NEXT FUTURE DATE ====> '   EP252-CC-FUTURE-DATE.   06020001
060300     DISPLAY ' EXTRACT START DATE ==> '   PV-EXTR-START-DTE.      06030001
060400     DISPLAY '=================================================='.06040001
060500     DISPLAY ' '.                                                 06050001
060600                                                                  06060001
060700*1200-EXIT.                                                       06070001
060800******************************************************************06080001
060900*   1300-SETUP-FOR-ORACLE.                                       *06090001
061000*     SET UP TO CONNECT TO THE ORACLE DATABASE.                  *06100001
061100******************************************************************06110001
061200 1300-SETUP-FOR-ORACLE.                                           06120001
061300     MOVE '1300-SETUP-FOR-ORACLE          ' TO  PV-PARAGRAPH-NAME.06130001
061400*                                                                 06140001
061500     READ ORACLE-LOGIN-FILE INTO CC-ORACLE-CONNECTION.            06150001
061600                                                                  06160001
061700     IF  ((ORACLE-LOGIN-EOF)                                      06170001
061800           OR ((CC-ORACLE-CONNECTION = SPACES)))                  06180001
061900           DISPLAY '** ABEND **'                                  06190001
062000           DISPLAY ' ORACLE LOGON NOT PROVIDED'                   06200001
062200           PERFORM 9900-ORA-ERROR                                 06220001
062300     END-IF.                                                      06230001
062310                                                                  06231001
062320     CLOSE ORACLE-LOGIN-FILE.                                     06232001
062330                                                                  06233001
062340*---------------------------------------------------------------  06234001
062350* IF USERNAME-LEN IS ZERO, THE LOGON ID IS MISSING FROM SYSIN.    06235001
062360* THEREFORE IT IS A PRODUCTION RUN WHERE THE LOGON INFO COMES     06236001
062370* FROM THE JCL                                                    06237001
062380*---------------------------------------------------------------  06238001
062390     PERFORM 7000-CONNECT-TO-ORACLE.                              06239001
062400                                                                  06240001
062500*1300-EXIT.                                                       06250001
062600******************************************************************06260001
062700*   1400-POPULATE-BTN-TBL.                                       *06270001
062800*     POPULATE THE INTERNAL BUTTON INFO TABLE.                   *06280001
062900******************************************************************06290001
063000 1400-POPULATE-BTN-TBL.                                           06300001
063100     MOVE '1400-POPULATE-BTN-TBL           ' TO PV-PARAGRAPH-NAME.06310001
063200                                                                  06320001
063300     PERFORM 7100-DEC-OPEN-BTN-CURSOR.                            06330001
063400                                                                  06340001
063500     SET PS-NOT-END-OF-FETCH-BTN TO TRUE.                         06350001
063600                                                                  06360001
063700     SET PV-BTN-INDEX TO 1.                                       06370001
063800                                                                  06380001
063900     PERFORM 2300-PROCESS-BTN-CSR                                 06390001
064000          UNTIL PS-END-OF-FETCH-BTN.                              06400001
064100                                                                  06410001
064200     PERFORM 7200-CLOSE-BTN-CURSOR.                               06420001
064300                                                                  06430001
064400     PERFORM 2450-DISPLAY-BTN-CSR.                                06440001
064500                                                                  06450001
064600*1400-EXIT.                                                       06460001
064700******************************************************************06470001
064800*   2000-PROCESS-RFRSH-STRS.                                     *06480001
064900*     MAIN DRIVING PARAGRAPH OF PROGRAM.                         *06490001
065000*   PROCESS AND READ INPUT STORE GROUP RECORDS.                  *06500001
065100*   THIS PARAGRAPH IS EXECUTED IF THERE ARE INPUT STR GRPS.      *06510001
065200*   - DECLARE AND OPEN OFFERS REFRESH CURSOR, FOR EACH INPUT     *06520001
065300*     STORE GROUP RECORD.                                        *06530001
065400*   - FETCH OFFERS DATA FOR EACH STORE GROUP IN INPUT.           *06540001
065500*   - READ NEXT RECORD.                                          *06550001
065600******************************************************************06560001
065700 2000-PROCESS-RFRSH-STRS.                                         06570001
065800     MOVE '2000-PROCESS-RFRSH-STRS      ' TO PV-PARAGRAPH-NAME.   06580001
065900                                                                  06590001
066000     IF  EP250-CC-STR-NBR  NOT EQUAL TO  PV-SAVE-STR-NBR          06600001
066100         ADD +1 TO   PV-STORE-RFRSH-COUNT                         06610001
066200         MOVE EP250-CC-STR-NBR    TO  PV-SAVE-STR-NBR             06620001
066300     END-IF.                                                      06630001
066400     MOVE EP250-CC-STR-NBR        TO  PV-STR-NBR.                 06640001
066500     MOVE EP250-CC-STR-GP-TYP-CDE TO  PV-STR-GP-TYP-CDE.          06650001
066600     MOVE EP250-CC-STR-GRP-ID     TO  PV-STR-GRP-ID.              06660001
066700                                                                  06670001
066800     PERFORM 7300-DEC-OPEN-OFFER-CURSOR.                          06680001
066900                                                                  06690001
067000     PERFORM 2100-PROCESS-OFFER-REFRESH-CSR                       06700001
067100           UNTIL PS-END-OF-REFRESH-CSR.                           06710001
067200                                                                  06720001
067300     PERFORM 7500-CLOSE-OFFER-CURSOR.                             06730001
067400                                                                  06740001
067500     SET  PS-NOT-END-OF-REFRESH-CSR TO TRUE.                      06750001
067600     PERFORM 8200-READ-STR-GRP-FILE.                              06760001
067700                                                                  06770001
067800*2000-EXIT.                                                       06780001
067900******************************************************************06790001
068000*  2100-PROCESS-OFFER-REFRESH-CSR.                               *06800001
068100*   PROCESS THE INPUT STORE GROUP RECORDS TO OBTAIN OFFERS       *06810001
068200*   - PROCESS THE INPUT STORE GROUP RECORDS                      *06820001
068300******************************************************************06830001
068400 2100-PROCESS-OFFER-REFRESH-CSR.                                  06840001
068500     MOVE '2100-PROCESS-OFFER-REFRESH-CSR  ' TO PV-PARAGRAPH-NAME.06850001
068600                                                                  06860001
068700     SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE.                     06870001
068800                                                                  06880001
068900     PERFORM 7400-FETCH-OFFER-REFRESH-CSR.                        06890001
069000                                                                  06900001
069100     EVALUATE TRUE                                                06910001
069200       WHEN SQLCODE IS EQUAL TO ZEROS                             06920001
069300           ADD 1             TO PV-OFR-CRSR-RECS-FETCHED          06930001
069400           PERFORM EP208-1000-DETERMNE-FLD-OVRFLW                 06940001
069500           IF EPWS208-OFFER-DATA-IN-RANGE                         06950001
069600              PERFORM 2200-PROCESS-OFFER-DATA                     06960001
069700           END-IF                                                 06970001
069800       WHEN SQLCODE IS EQUAL TO PC-ROW-NOT-FOUND                  06980001
069900           SET PS-END-OF-REFRESH-CSR TO TRUE                      06990001
070000       WHEN OTHER                                                 07000001
070100           DISPLAY '**  BAD SQLCODE IN FETCH FROM OFFERCRSR  **'  07010001
070200           DISPLAY '**  CALLED FROM ' PV-PARAGRAPH-NAME '  **'    07020001
070300           MOVE 'FETCH DATA FROM OFFERCRSR '                      07030001
070400                                   TO PV-ORA-OPERATION            07040001
070500           PERFORM 7500-CLOSE-OFFER-CURSOR                        07050001
070600           PERFORM 9900-ORA-ERROR                                 07060001
070700     END-EVALUATE.                                                07070001
070800                                                                  07080001
070900*2100-EXIT.                                                       07090001
071000******************************************************************07100001
071100*   2200-PROCESS-OFFER-DATA.                                     *07110001
071200*     PROCESS FETCHED OFFER DATA.                                *07120001
071300******************************************************************07130001
071400 2200-PROCESS-OFFER-DATA.                                         07140001
071500     MOVE '2200-PROCESS-OFFER-DATA         ' TO PV-PARAGRAPH-NAME.07150001
071600                                                                  07160001
071700     PERFORM 3000-MOVE-COMMON-VALUES.                             07170001
071800                                                                  07180001
071900     IF OFR-ID IN OMT00001 NOT = PV-OFR-ID                        07190001
072000        PERFORM 3100-BUILD-XST-OFR-DATA                           07200001
072100        PERFORM 3200-BUILD-XST-SEC-DATA                           07210001
072200        PERFORM 3300-BUILD-XST-BWP-DATA                           07220001
072300        PERFORM 3400-BUILD-XST-MDSE-DATA                          07230001
072400        PERFORM 3500-BUILD-STORE-LIST-REC                         07240001
072500     ELSE                                                         07250001
072600       IF OFR-ID IN OMT00001 = PV-OFR-ID AND                      07260001
072700          OFR-SECT-TYP-CDE IN OMT00002 NOT = PV-OFR-SECT-TYP-CDE  07270001
072800          PERFORM 3200-BUILD-XST-SEC-DATA                         07280001
072900          PERFORM 3300-BUILD-XST-BWP-DATA                         07290001
073000          PERFORM 3400-BUILD-XST-MDSE-DATA                        07300001
073100       ELSE                                                       07310001
073200         IF OFR-ID IN OMT00001 = PV-OFR-ID AND                    07320001
073300            OFR-SECT-TYP-CDE IN OMT00002  =                       07330001
073400                                      PV-OFR-SECT-TYP-CDE AND     07340001
073500            OFR-SECT-BWP-ID IN OMT00003 NOT = PV-OFR-SECT-BWP-ID  07350001
073600            PERFORM 3300-BUILD-XST-BWP-DATA                       07360001
073700            PERFORM 3400-BUILD-XST-MDSE-DATA                      07370001
073800         ELSE                                                     07380001
073900           IF OFR-ID IN OMT00001 = PV-OFR-ID AND                  07390001
074000              OFR-SECT-TYP-CDE IN OMT00002 =                      07400001
074100                                           PV-OFR-SECT-TYP-CDE AND07410001
074200              OFR-SECT-BWP-ID IN OMT00003  =                      07420001
074300                                           PV-OFR-SECT-BWP-ID AND 07430001
074400              MDSE-SET-ID IN OMT00005 NOT = PV-MDSE-SET-ID        07440001
074500              PERFORM 3400-BUILD-XST-MDSE-DATA                    07450001
074600           END-IF                                                 07460001
074700         END-IF                                                   07470001
074800       END-IF                                                     07480001
074900     END-IF.                                                      07490001
075000                                                                  07500001
075100*2200-EXIT.                                                       07510001
075200******************************************************************07520001
075300*   2300-PROCESS-BTN-CSR.                                        *07530001
075400*   PROCESS THE BTNCRSR CURSOR AND POPULATE THE PROGRAM TABLE    *07540001
075500*    (PV-OMT-POS-BTN)                                            *07550001
075600******************************************************************07560001
075700 2300-PROCESS-BTN-CSR.                                            07570001
075800     MOVE '2300-PROCESS-BTN-CSR           ' TO PV-PARAGRAPH-NAME. 07580001
075900*                                                                 07590001
076000     SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE.                     07600001
076100                                                                  07610001
076200     PERFORM 7150-FETCH-BTN-CURSOR.                               07620001
076300                                                                  07630001
076400     EVALUATE TRUE                                                07640001
076500        WHEN SQLCODE IS EQUAL TO ZEROS                            07650001
076600            ADD 1 TO PV-POS-BTN-REC-FETCHED                       07660001
076700            IF  PV-POS-RLTV-NUM-NULL-IND = -1                     07670001
076800                SET EPWS208-OFFER-DATA-IN-RANGE TO TRUE           07680001
076900            ELSE                                                  07690001
077000                PERFORM EP208-1100-DETERMNE-POS-OVRFLW            07700001
077100            END-IF                                                07710001
077200            IF  EPWS208-OFFER-DATA-IN-RANGE                       07720001
077300                PERFORM 2400-MOVE-BTNCRSR-VALUES                  07730001
077400            END-IF                                                07740001
077500        WHEN SQLCODE IS EQUAL TO PC-ROW-NOT-FOUND                 07750001
077600           SET  PS-END-OF-FETCH-BTN   TO TRUE                     07760001
077700        WHEN OTHER                                                07770001
077800           MOVE 'FETCH DATA FROM BTNCRSR   '                      07780001
077900                                   TO PV-ORA-OPERATION            07790001
078000           PERFORM 9900-ORA-ERROR                                 07800001
078100      END-EVALUATE.                                               07810001
078200                                                                  07820001
078300     IF PV-BTN-INDEX > PC-MAX-BTN-INDEX-VALUE                     07830001
078400        DISPLAY 'LIMIT OF POS-BTN-CURSOR ARRAY REACHED'           07840001
078500        MOVE '2300-PROCESS-BTN-CSR       ' TO PV-PARAGRAPH-NAME   07850001
078600        MOVE 'TABLE LIMIT REACHED FOR POS-BTN-ARRAY' TO           07860001
078700                             PV-OPERATION-MSG-1                   07870001
078800        SET AC-4004-TABLE-OVERFLOW-ERROR TO TRUE                  07880001
078900        PERFORM 9800-ABEND                                        07890001
079000     END-IF.                                                      07900001
079100                                                                  07910001
079200*2300-EXIT.                                                       07920001
079300******************************************************************07930001
079400*  2400-MOVE-BTNCRSR-VALUES.                                     *07940001
079500*  POPULATE INTERNAL TABLE OF POS BUTTONS                        *07950001
079600******************************************************************07960001
079700 2400-MOVE-BTNCRSR-VALUES.                                        07970001
079800                                                                  07980001
079900     MOVE POS-BTN-CDE IN OMT00006                                 07990001
080000                              TO PV-POS-BTN-CDE(PV-BTN-INDEX).    08000001
080100     MOVE POS-BTN-TXT IN OMT00006                                 08010001
080200                              TO PV-POS-BTN-TEXT(PV-BTN-INDEX).   08020001
080300*    THE OMT TABLE ALLOWS NULL IN POS-BTN-RLTV-SEQ-NBR,           08030001
080400*      SO MUST ACCOUNT FOR IT                                     08040001
080500     IF  PV-POS-RLTV-NUM-NULL-IND = -1                            08050001
080600         MOVE PC-NULL-FIELD-VALUE                                 08060001
080700           TO PV-POS-BTN-RLTV-SEQ-NBR-X(PV-BTN-INDEX)             08070001
080800     ELSE                                                         08080001
080900         MOVE POS-BTN-RLTV-SEQ-NBR IN OMT00006                    08090001
081000           TO PV-POS-BTN-RLTV-SEQ-NBR(PV-BTN-INDEX)               08100001
081100     END-IF.                                                      08110001
081200                                                                  08120001
081300     SET PV-BTN-INDEX UP BY 1.                                    08130001
081400                                                                  08140001
081500*2400-EXIT.                                                       08150001
081600******************************************************************08160001
081700*   2450-DISPLAY-BTN-CSR.                                        *08170001
081800*   DISPLAY CONTENTS OF BTNCRSR TABLE.                           *08180001
081900******************************************************************08190001
082000 2450-DISPLAY-BTN-CSR.                                            08200001
082100                                                                  08210001
082200     SET PV-BTN-INDEX TO 1.                                       08220001
082300     PERFORM VARYING PV-BTN-INDEX FROM 1 BY 1                     08230001
082400            UNTIL PV-BTN-INDEX > PC-MAX-BTN-INDEX-VALUE           08240001
082500              OR  PV-POS-BTN-CDE(PV-BTN-INDEX) = SPACES           08250001
082600                                                                  08260001
082700        DISPLAY                                                   08270001
082800            'POS BTN CDE > ' PV-POS-BTN-CDE(PV-BTN-INDEX)         08280001
082900           ' POS BTN TXT > ' PV-POS-BTN-TEXT(PV-BTN-INDEX)        08290001
083000           ' RLTV SEQ NBR> ' PV-POS-BTN-RLTV-SEQ-NBR(PV-BTN-INDEX)08300001
083100     END-PERFORM.                                                 08310001
083200                                                                  08320001
083300*2450-EXIT.                                                       08330001
083400******************************************************************08340001
083500* 3000-MOVE-COMMON-VALUES                                         08350001
083600* THIS PARAGRAPH WILL DETERMINE THE RECORD TYPE TO BE WRITTEN OUT 08360001
083700******************************************************************08370001
083800 3000-MOVE-COMMON-VALUES.                                         08380001
083900     MOVE '3000-MOVE-COMMON-VALUES         ' TO PV-PARAGRAPH-NAME.08390001
084000                                                                  08400001
084100     SET  EP205-TRIGGER-TYPE-ADD TO TRUE.                         08410001
084200     SET  EP205-FILE-TYPE-FUL    TO TRUE.                         08420001
084300                                                                  08430001
084400     MOVE PV-STR-NBR                   TO EP205-STR-NBR.          08440001
084500     MOVE OFR-ID           IN OMT00001 TO EP205-OFFER-ID.         08450001
084600     MOVE EVNT-ID          IN OMT00001 TO EP205-EVENT-ID.         08460001
084700     MOVE OFR-SECT-TYP-CDE IN OMT00002 TO EP205-OFR-SECT-TYP-CDE. 08470001
084800                                                                  08480001
084900*3000-EXIT.                                                       08490001
085000******************************************************************08500001
085100* 3100-BUILD-XST-OFR-DATA                                         08510001
085200* BUILD OFFER RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH         08520001
085300******************************************************************08530001
085400 3100-BUILD-XST-OFR-DATA.                                         08540001
085500     MOVE '3100-BUILD-XST-OFR-DATA         ' TO PV-PARAGRAPH-NAME.08550001
085600                                                                  08560001
085700     INITIALIZE EP205-VARIABLE-DATA.                              08570001
085800     SET  EP205-XST-OFFER TO TRUE.                                08580001
085900                                                                  08590001
086000*    MOVE PC-DFLT-PROMO-SCHM-CDE-1008  TO EP205-PROMO-SCHM-CDE.   08600001
086100                                                                  08610001
086200     EVALUATE TRUE                                                08620001
086300         WHEN EVNT-TYP-CDE   IN OMT00009 = 'SP'                   08630001
086400            MOVE PC-DFLT-PROMO-SCHM-CDE-1008  TO                  08640001
086500                                      EP205-PROMO-SCHM-CDE        08650001
086600         WHEN EVNT-TYP-CDE   IN OMT00009 = 'TR'                   08660001
086700            MOVE PC-DFLT-PROMO-SCHM-CDE-1009  TO                  08670001
086800                                      EP205-PROMO-SCHM-CDE        08680001
086900         WHEN EVNT-TYP-CDE   IN OMT00009 = 'BW'                   08690001
087000            MOVE PC-DFLT-PROMO-SCHM-CDE-1010  TO                  08700001
087100                                      EP205-PROMO-SCHM-CDE        08710001
087200     END-EVALUATE.                                                08720001
087300                                                                  08730001
087400     MOVE EVNT-TYP-CDE     IN OMT00009 TO EP205-EVENT-TYP-CODE.   08740001
087500     MOVE EVNT-CTG-NM      IN OMT00007 TO EP205-EVENT-NAME.       08750001
087600     MOVE OFR-NM           IN OMT00001 TO EP205-OFFER-NAME.       08760001
087700     MOVE DISC-LVL-CDE     IN OMT00001 TO EP205-DISC-LEVEL-CODE.  08770001
087800     MOVE OFR-USG-TYP-CDE  IN OMT00001                            08780001
087900                                   TO EP205-OFFER-USAGE-TYPE-CODE.08790001
088000     MOVE BRCDE-TYP-CDE    IN OMT00001 TO EP205-BARCODE-TYPE-CODE.08800001
088100     MOVE UNEARN-IND       IN OMT00001 TO EP205-UNEARN-IND.       08810001
088200     MOVE OFR-TRGR-TYP-CDE IN OMT00001 TO EP205-OFR-TRGR-TYP-CDE. 08820001
088300                                                                  08830001
088400     IF PV-ITM-DISC-APL-NULL-IND = -1                             08840001
088500        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-ITM-APPL-CDE        08850001
088600     ELSE                                                         08860001
088700        MOVE ITM-DISC-APPL-CDE IN OMT00001                        08870001
088800                                       TO EP205-BWP-ITM-APPL-CDE  08880001
088900     END-IF.                                                      08890001
089000                                                                  08900001
089100     MOVE SPACES TO EP205-OFFER-FILLER.                           08910001
089200                                                                  08920001
089300     PERFORM 8300-WRITE-XST-OFR-DATA.                             08930001
089400                                                                  08940001
089500     ADD 1 TO PV-OFFER-RECS-OUT.                                  08950001
089600                                                                  08960001
089700     MOVE OFR-ID  IN OMT00001  TO PV-OFR-ID.                      08970001
089800     MOVE EVNT-ID IN OMT00001  TO PV-EVNT-ID.                     08980001
089900                                                                  08990001
090000*3100-EXIT.                                                       09000001
090100******************************************************************09010001
090200* 3200-BUILD-XST-SEC-DATA                                         09020001
090300* BUILD OFFER-SECT RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH    09030001
090400******************************************************************09040001
090500 3200-BUILD-XST-SEC-DATA.                                         09050001
090600     MOVE '3200-BUILD-XST-SEC-DATA         ' TO PV-PARAGRAPH-NAME.09060001
090700                                                                  09070001
090800     INITIALIZE EP205-VARIABLE-DATA.                              09080001
090900     SET  EP205-XST-OFR-SECT   TO TRUE.                           09090001
091000                                                                  09100001
091100     PERFORM 4000-CALCULATE-DATES.                                09110001
091200     MOVE BWP-GET-CNCTR-CDE IN OMT00002                           09120001
091300                               TO EP205-BWP-GET-CNCTR-CDE.        09130001
091400     MOVE BWP-BUY-CNCTR-CDE IN OMT00002                           09140001
091500                               TO EP205-BWP-BUY-CNCTR-CDE.        09150001
091600     MOVE VLD-POS-TNDR-COMB-TYP-CDE IN OMT00002                   09160001
091700                               TO EP205-VLD-POS-TNDR-CMP-TYP-CDE. 09170001
091800     MOVE LMT-PER-TRN-QTY   IN OMT00002 TO EP205-LMT-PER-TRN-QTY. 09180001
091900     MOVE CUSTFACG-SHRT-DESC IN OMT00008                          09190001
092000                               TO EP205-CUSTFACG-SHRT-DESC.       09200001
092100                                                                  09210001
092200     IF PV-POS-BTN-CDE-NULL-IND = -1                              09220001
092300         MOVE PC-NULL-FIELD-VALUE TO EP205-POS-BTN-TXT            09230001
092400         MOVE PC-NULL-FIELD-VALUE                                 09240001
092500                               TO EP205-POS-BTN-RLTV-SEQ-NBR-X    09250001
092600     ELSE                                                         09260001
092700         PERFORM 6200-POPULATE-BTN-VALUE                          09270001
092800     END-IF.                                                      09280001
092900                                                                  09290001
093000     PERFORM 8300-WRITE-XST-OFR-DATA.                             09300001
093100                                                                  09310001
093200     ADD 1 TO PV-OFRSECT-RECS-OUT.                                09320001
093300     MOVE OFR-SECT-TYP-CDE IN OMT00002 TO PV-OFR-SECT-TYP-CDE.    09330001
093400                                                                  09340001
093500*3200-EXIT.                                                       09350001
093600******************************************************************09360001
093700* 3300-BUILD-XST-BWP-DATA                                         09370001
093800* BUILD OFFER BWP RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH     09380001
093900******************************************************************09390001
094000 3300-BUILD-XST-BWP-DATA.                                         09400001
094100     MOVE '3300-BUILD-XST-BWP-DATA         ' TO PV-PARAGRAPH-NAME.09410001
094200                                                                  09420001
094300     INITIALIZE EP205-VARIABLE-DATA.                              09430001
094400     SET  EP205-XST-OFR-BWP TO TRUE.                              09440001
094500                                                                  09450001
094600     MOVE OFR-SECT-BWP-ID  IN OMT00003 TO EP205-OFR-SECT-BWP-ID.  09460001
094700     MOVE TIER-LVL-NBR     IN OMT00003 TO EP205-TIER-LVL-NBR.     09470001
094800     MOVE BWP-SELN-TYP-CDE IN OMT00003 TO EP205-BWP-SELN-TYP-CDE. 09480001
094900                                                                  09490001
095000     IF PV-BWP-BUY-QTY-NULL-IND = -1                              09500001
095100        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-BUY-QTY-X           09510001
095200     ELSE                                                         09520001
095300        MOVE BWP-BUY-QTY IN OMT00003 TO EP205-BWP-BUY-QTY         09530001
095400     END-IF.                                                      09540001
095500                                                                  09550001
095600     IF PV-BWP-BUY-AMT-NULL-IND = -1                              09560001
095700        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-BUY-AMT-X           09570001
095800     ELSE                                                         09580001
095900        MOVE BWP-BUY-AMT IN OMT00003 TO EP205-BWP-BUY-AMT         09590001
096000     END-IF.                                                      09600001
096100                                                                  09610001
096200     IF PV-BWP-BUY-TOL-AMT-NULL-IND = -1                          09620001
096300        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-BUY-TOL-AMT-X       09630001
096400     ELSE                                                         09640001
096500        MOVE BWP-BUY-TOL-AMT IN OMT00003 TO EP205-BWP-BUY-TOL-AMT 09650001
096600     END-IF.                                                      09660001
096700                                                                  09670001
096800     IF PV-BWP-GET-QTY-NULL-IND = -1                              09680001
096900        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-QTY-X           09690001
097000     ELSE                                                         09700001
097100        MOVE BWP-GET-QTY   IN OMT00003 TO EP205-BWP-GET-QTY       09710001
097200     END-IF.                                                      09720001
097300                                                                  09730001
097400     IF PV-BWP-GET-PCT-NULL-IND = -1                              09740001
097500        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-PCT-OFF-PCT-X   09750001
097600     ELSE                                                         09760001
097700        MOVE BWP-GET-PCT-OFF-PCT IN OMT00003                      09770001
097800                                 TO EP205-BWP-GET-PCT-OFF-PCT     09780001
097900     END-IF.                                                      09790001
098000                                                                  09800001
098100     IF PV-BWP-GET-DOL-NULL-IND = -1                              09810001
098200        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-DOL-OFF-AMT-X   09820001
098300     ELSE                                                         09830001
098400        MOVE BWP-GET-DOL-OFF-AMT IN OMT00003                      09840001
098500                                 TO EP205-BWP-GET-DOL-OFF-AMT     09850001
098600     END-IF.                                                      09860001
098700                                                                  09870001
098800     IF PV-BWP-GET-PRPT-NULL-IND = -1                             09880001
098900        MOVE PC-NULL-FIELD-VALUE TO EP205-BWP-GET-PRPT-AMT-X      09890001
099000     ELSE                                                         09900001
099100        MOVE BWP-GET-PRPT-AMT    IN OMT00003                      09910001
099200                                 TO EP205-BWP-GET-PRPT-AMT        09920001
099300     END-IF.                                                      09930001
099400                                                                  09940001
099500     PERFORM 8300-WRITE-XST-OFR-DATA.                             09950001
099600                                                                  09960001
099700     ADD 1 TO PV-OFRBWP-RECS-OUT.                                 09970001
099800     MOVE OFR-SECT-BWP-ID IN OMT00003  TO PV-OFR-SECT-BWP-ID.     09980001
099900                                                                  09990001
100000*3300-EXIT.                                                       10000001
100100******************************************************************10010001
100200* 3400-BUILD-XST-MDSE-DATA                                        10020001
100300* BUILD OFFER MDSE RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH    10030001
100400******************************************************************10040001
100500 3400-BUILD-XST-MDSE-DATA.                                        10050001
100600     MOVE '3400-BUILD-XST-MDSE-DATA        ' TO PV-PARAGRAPH-NAME.10060001
100700                                                                  10070001
100800     INITIALIZE EP205-VARIABLE-DATA.                              10080001
100900     SET  EP205-XST-OFR-MDSE TO TRUE.                             10090001
101000                                                                  10100001
101100     MOVE OFR-SECT-BWP-ID  IN OMT00003 TO EP205-OFR-SECT-BWP-ID-M.10110001
101200     MOVE MDSE-SET-ID      IN OMT00005 TO EP205-MDSE-SET-ID.      10120001
101300     MOVE MDSE-HIER-CDE    IN OMT00005 TO EP205-MDSE-HIER-CDE.    10130001
101400                                                                  10140001
101500     IF PV-MDSE-DEPT-NBR-NULL-IND = -1                            10150001
101600        MOVE PC-NULL-FIELD-VALUE       TO EP205-DEPT-NBR-X        10160001
101700     ELSE                                                         10170001
101800        MOVE DEPT-NBR      IN OMT00005 TO EP205-DEPT-NBR          10180001
101900     END-IF.                                                      10190001
102000                                                                  10200001
102100     IF PV-MDSE-MAJ-CLS-NULL-IND = -1                             10210001
102200        MOVE PC-NULL-FIELD-VALUE       TO EP205-MAJ-CL-NBR-X      10220001
102300     ELSE                                                         10230001
102400        MOVE MAJ-CL-NBR    IN OMT00005 TO EP205-MAJ-CL-NBR        10240001
102500     END-IF.                                                      10250001
102600                                                                  10260001
102700     IF PV-MDSE-SUB-CLS-NULL-IND = -1                             10270001
102800        MOVE PC-NULL-FIELD-VALUE       TO EP205-SUB-CL-NBR-X      10280001
102900     ELSE                                                         10290001
103000        MOVE SUB-CL-NBR    IN OMT00005 TO EP205-SUB-CL-NBR        10300001
103100     END-IF.                                                      10310001
103200                                                                  10320001
103300     IF PV-MDSE-STL-ID-NULL-IND = -1                              10330001
103400        MOVE PC-NULL-FIELD-VALUE       TO EP205-STYL-ID-X         10340001
103500     ELSE                                                         10350001
103600        MOVE STYL-ID       IN OMT00005 TO EP205-STYL-ID           10360001
103700     END-IF.                                                      10370001
103800                                                                  10380001
103900     IF PV-MDSE-SKU-NB-NULL-IND = -1                              10390001
104000        MOVE PC-NULL-FIELD-VALUE       TO EP205-SKU-NBR-X         10400001
104100     ELSE                                                         10410001
104200        MOVE SKU-NBR       IN OMT00005 TO EP205-SKU-NBR           10420001
104300     END-IF.                                                      10430001
104400                                                                  10440001
104500     MOVE IE-IND           IN OMT00005 TO EP205-IE-IND.           10450001
104600                                                                  10460001
104700     IF PV-MDSE-EMP-DS-NULL-IND = -1                              10470001
104800        MOVE PC-NULL-FIELD-VALUE       TO EP205-EMP-DISC-CDE      10480001
104900     ELSE                                                         10490001
105000        MOVE EMP-DISC-CDE  IN OMT00005 TO EP205-EMP-DISC-CDE      10500001
105100     END-IF.                                                      10510001
105200                                                                  10520001
105300     IF PV-MDSE-DSC-EL-NULL-IND = -1                              10530001
105400        MOVE PC-NULL-FIELD-VALUE       TO EP205-DISC-ELIG-IND     10540001
105500     ELSE                                                         10550001
105600        MOVE DISC-ELIG-IND IN OMT00005 TO EP205-DISC-ELIG-IND     10560001
105700     END-IF.                                                      10570001
105800                                                                  10580001
105900     IF PV-MDSE-TKT-CL-NULL-IND = -1                              10590001
106000        MOVE PC-NULL-FIELD-VALUE       TO EP205-TKT-CLOR-CDE      10600001
106100     ELSE                                                         10610001
106200        MOVE TKT-CLOR-CDE  IN OMT00005 TO EP205-TKT-CLOR-CDE      10620001
106300     END-IF.                                                      10630001
106400                                                                  10640001
106500     PERFORM 8300-WRITE-XST-OFR-DATA.                             10650001
106600                                                                  10660001
106700     ADD 1 TO PV-MDSESET-RECS-OUT.                                10670001
106800     MOVE MDSE-SET-ID      IN OMT00005 TO PV-MDSE-SET-ID.         10680001
106900                                                                  10690001
107000*3400-EXIT.                                                       10700001
107100******************************************************************10710001
107200* 3500-BUILD-STORE-LIST-REC                                       10720001
107300* BUILD STORE LIST RECORD FOR OUTPUT, AND CALL WRITE PARAGRAPH    10730001
107400******************************************************************10740001
107500 3500-BUILD-STORE-LIST-REC.                                       10750001
107600     MOVE '3500-BUILD-STORE-LIST-REC       ' TO PV-PARAGRAPH-NAME.10760001
107700                                                                  10770001
107800     INITIALIZE EP206-STORE-LIST-RCD.                             10780001
107900                                                                  10790001
108000     SET  EP206-ADD                  TO TRUE.                     10800001
108100     MOVE PV-EVNT-ID                 TO EP206-EVENT-ID.           10810001
108200     MOVE PV-OFR-ID                  TO EP206-OFFER-ID.           10820001
108300     MOVE PV-OFR-SECT-TYP-CDE        TO EP206-OFR-SECT-TYP-CDE.   10830001
108400     MOVE PC-STR-GP-TYP-SPECIFIC-STR TO EP206-STR-GRP-TYP-CDE.    10840001
108500     MOVE PV-STR-NBR                 TO EP206-STR-GRP-ID.         10850001
108600     SET  EP206-STR-GP-INCLUDED      TO TRUE.                     10860001
108700     MOVE PV-STR-NBR                 TO EP206-STORE-NUMBER.       10870001
108800                                                                  10880001
108900     PERFORM 8400-WRITE-STR-LIST-REC.                             10890001
109000                                                                  10900001
109100*3500-EXIT.                                                       10910001
109200******************************************************************10920001
109300* 4000-CALCULATE-DATES                                            10930001
109400* CALCULATE DATES, BASED UPON TOL-STRT-NMOFDA-QTY                 10940001
109500******************************************************************10950001
109600 4000-CALCULATE-DATES.                                            10960001
109700     MOVE '4000-CALCULATE-DATES       ' TO PV-PARAGRAPH-NAME.     10970001
109800                                                                  10980001
109900     IF TOL-STRT-NMOFDA-QTY IN OMT00002 = 0                       10990001
110000        MOVE EFF-BEG-TMST IN OMT00002 TO PV-EFF-BEG-TMST          11000001
110100        MOVE PV-EFF-BEG-DATE          TO PV-FORMAT-DATE           11010001
110200        MOVE PV-FORMAT-DATE-CCYY      TO PV-DATE-CCYY             11020001
110300        MOVE PV-FORMAT-DATE-MM        TO PV-DATE-MM               11030001
110400        MOVE PV-FORMAT-DATE-DD        TO PV-DATE-DD               11040001
110500        MOVE PV-EFF-DATE              TO EP205-EFF-BEG-DTE        11050001
110600     ELSE                                                         11060001
110700        PERFORM 4100-CALC-EFF-BEG-DATE                            11070001
110800     END-IF.                                                      11080001
110900                                                                  11090001
111000     IF TOL-END-NMOFDA-QTY IN OMT00002 = 0                        11100001
111100        MOVE EFF-END-TMST IN OMT00002 TO PV-EFF-END-TMST          11110001
111200        MOVE PV-EFF-END-DATE          TO PV-FORMAT-DATE           11120001
111300        MOVE PV-FORMAT-DATE-CCYY      TO PV-DATE-CCYY             11130001
111400        MOVE PV-FORMAT-DATE-MM        TO PV-DATE-MM               11140001
111500        MOVE PV-FORMAT-DATE-DD        TO PV-DATE-DD               11150001
111600        MOVE PV-EFF-DATE              TO EP205-EFF-END-DTE        11160001
111700     ELSE                                                         11170001
111800        PERFORM 4200-CALC-EFF-END-DATE                            11180001
111900     END-IF.                                                      11190001
112000                                                                  11200001
112100     IF REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002 = 0             11210001
112200        MOVE EP205-EFF-END-DTE    TO EP205-REDMN-SUPVR-OVRRID-DTE 11220001
112300     ELSE                                                         11230001
112400        PERFORM 4300-CALC-SUP-END-DATE                            11240001
112500     END-IF.                                                      11250001
112600                                                                  11260001
112700*4000-EXIT.                                                       11270001
112800******************************************************************11280001
112900* 4100-CALC-EFF-BEG-DATE                                          11290001
113000* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     11300001
113100* THE EFFECTIVE BEGIN DATE FOR THE POS STORE SERVER DB.           11310001
113200* WHICH WILL BE THE (EFF-BEG-TMST - TOL-START-QTY)                11320001
113300******************************************************************11330001
113400 4100-CALC-EFF-BEG-DATE.                                          11340001
113500                                                                  11350001
113600     MOVE EFF-BEG-TMST IN OMT00002  TO PV-EFF-BEG-TMST.           11360001
113700     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11370001
113800     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      11380001
113900     SET DPG51-DECREMENT-DATE       TO TRUE.                      11390001
114000     MOVE TOL-STRT-NMOFDA-QTY  IN OMT00002                        11400001
114100                                    TO DPG51-INCR-DECR-DAYS-9.    11410001
114200     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      11420001
114300     MOVE PV-EFF-BEG-DATE           TO DPG52-LK-DATE-INPUT.       11430001
114400                                                                  11440001
114500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          11450001
114600                                             DPG53 DPG54          11460001
114700                                             DPG55 DPG56.         11470001
114800                                                                  11480001
114900     EVALUATE TRUE                                                11490001
115000         WHEN DPG54-NO-ERROR                                      11500001
115100             CONTINUE                                             11510001
115200         WHEN OTHER                                               11520001
115300             DISPLAY ' '                                          11530001
115400             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    11540001
115500                       ' TO CALCULATE EFFECTIVE BEGIN DATE'       11550001
115600             DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    11560001
115700             DISPLAY '** DPG51-CALENDAR-TYPE = '                  11570001
115800                                         DPG51-CALENDAR-TYPE      11580001
115900             DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE11590001
116000             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      11600001
116100                      ', INCREMENT/DECREMENT FLAG = '             11610001
116200                                  DPG51-INCREMENT-DECREMENT-FLAG  11620001
116300                      ', DECREMENT DAYS = '                       11630001
116400                                  DPG51-INCR-DECR-DAYS-9-X        11640001
116500             MOVE '4100-CALC-EFF-BEG-DATE' TO PV-PARAGRAPH-NAME   11650001
116600             MOVE 'ERROR CALCULATING EFF BEGIN DATE'              11660001
116700                                           TO PV-OPERATION-MSG-1  11670001
116800             SET  AC-4019-CAL-SUB-ERROR    TO TRUE                11680001
116900             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  11690001
117000             PERFORM 9800-ABEND                                   11700001
117100      END-EVALUATE.                                               11710001
117200                                                                  11720001
117300      MOVE DPG55-DB2-ISO-DATE     TO EP205-EFF-BEG-DTE.           11730001
117400                                                                  11740001
117500*4100-EXIT.                                                       11750001
117600******************************************************************11760001
117700* 4200-CALC-EFF-END-DATE                                          11770001
117800* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     11780001
117900* THE EFFECTIVE END DATE FOR THE POS STORE SERVER DB.             11790001
118000******************************************************************11800001
118100 4200-CALC-EFF-END-DATE.                                          11810001
118200     MOVE '4200-CALC-EFF-END-DATE     ' TO PV-PARAGRAPH-NAME.     11820001
118300                                                                  11830001
118400     MOVE EFF-END-TMST IN OMT00002    TO PV-EFF-END-TMST.         11840001
118500     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11850001
118600     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    11860001
118700     SET  DPG51-INCREMENT-DATE        TO TRUE.                    11870001
118800     MOVE TOL-END-NMOFDA-QTY IN OMT00002 TO                       11880001
118900                                    DPG51-INCR-DECR-DAYS-9.       11890001
119000     SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    11900001
119100     MOVE PV-EFF-END-DATE             TO DPG52-LK-DATE-INPUT.     11910001
119200                                                                  11920001
119300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          11930001
119400                                             DPG53 DPG54          11940001
119500                                             DPG55 DPG56.         11950001
119600                                                                  11960001
119700     EVALUATE TRUE                                                11970001
119800         WHEN DPG54-NO-ERROR                                      11980001
119900             CONTINUE                                             11990001
120000         WHEN OTHER                                               12000001
120100             DISPLAY ' '                                          12010001
120200             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    12020001
120300                       ' TO CALCULATE EFFECTIVE END DATE'         12030001
120400             DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE    12040001
120500             DISPLAY '** DPG51-CALENDAR-TYPE = '                  12050001
120600                                         DPG51-CALENDAR-TYPE      12060001
120700             DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE12070001
120800             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      12080001
120900                      ', INCREMENT/DECREMENT FLAG = '             12090001
121000                                  DPG51-INCREMENT-DECREMENT-FLAG  12100001
121100                      ', INCREMENT DAYS = '                       12110001
121200                                  DPG51-INCR-DECR-DAYS-9-X        12120001
121300             MOVE '4200-CALC-EFF-END-DATE'                        12130001
121400                                           TO PV-PARAGRAPH-NAME   12140001
121500             MOVE 'ERROR CALCULATING EFF END DATE'                12150001
121600                                           TO PV-OPERATION-MSG-1  12160001
121700             SET  AC-4019-CAL-SUB-ERROR    TO TRUE                12170001
121800             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  12180001
121900             PERFORM 9800-ABEND                                   12190001
122000      END-EVALUATE.                                               12200001
122100                                                                  12210001
122200      MOVE DPG55-DB2-ISO-DATE     TO EP205-EFF-END-DTE.           12220001
122300                                                                  12230001
122400*4200-EXIT.                                                       12240001
122500******************************************************************12250001
122600* 4300-CALC-SUP-END-DATE                                          12260001
122700* THIS PARAGRAPH WILL USE THE KOHLS DATE ROUTINE TO CALCULATE     12270001
122800* THE SUPERVISOR END DATE FOR THE POS STORE SERVER DB.            12280001
122900******************************************************************12290001
123000 4300-CALC-SUP-END-DATE.                                          12300001
123100     MOVE '4300-CALC-SUP-END-DATE     ' TO PV-PARAGRAPH-NAME.     12310001
123200                                                                  12320001
123300     MOVE EFF-END-TMST IN OMT00002   TO PV-EFF-END-TMST.          12330001
123400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              12340001
123500     SET  DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                     12350001
123600     SET  DPG51-INCREMENT-DATE       TO TRUE.                     12360001
123700     ADD  TOL-END-NMOFDA-QTY IN OMT00002   TO                     12370001
123800          REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002               12380001
123900     MOVE REDMN-SUPVR-OVRRID-NMOFDA-QTY IN OMT00002 TO            12390001
124000                                    DPG51-INCR-DECR-DAYS-9.       12400001
124100     SET  DPG52-LK-DTE-ISO-FMT       TO TRUE.                     12410001
124200     MOVE PV-EFF-END-DATE            TO DPG52-LK-DATE-INPUT.      12420001
124300                                                                  12430001
124400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52          12440001
124500                                             DPG53 DPG54          12450001
124600                                             DPG55 DPG56.         12460001
124700                                                                  12470001
124800     EVALUATE TRUE                                                12480001
124900         WHEN DPG54-NO-ERROR                                      12490001
125000             MOVE DPG55-DB2-ISO-DATE                              12500001
125100                                  TO EP205-REDMN-SUPVR-OVRRID-DTE 12510001
125200         WHEN OTHER                                               12520001
125300             DISPLAY ' '                                          12530001
125400             DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'    12540001
125500                     ' TO CALCULATE SUPERVISOR END DATE'          12550001
125600             DISPLAY '** CALLED BY 4300-CALC-SUP-END-DATE'        12560001
125700             DISPLAY '** ERROR MESSAGE = '                        12570001
125800                               DPG54-ERROR-MESSAGE                12580001
125900             DISPLAY '** DPG51-CALENDAR-TYPE = '                  12590001
126000                                         DPG51-CALENDAR-TYPE      12600001
126100             DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE12610001
126200             DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT      12620001
126300                      ', INCREMENT/DECREMENT FLAG = '             12630001
126400                                  DPG51-INCREMENT-DECREMENT-FLAG  12640001
126500                      ', INCREMENT DAYS = '                       12650001
126600                                  DPG51-INCR-DECR-DAYS-9-X        12660001
126700             MOVE '4300-CALC-SUP-END-DATE'                        12670001
126800                                           TO PV-PARAGRAPH-NAME   12680001
126900             MOVE 'ERROR CALCULATING SUP OVERRIDE END DATE'       12690001
127000                                           TO PV-OPERATION-MSG-1  12700001
127100             SET  AC-4019-CAL-SUB-ERROR    TO TRUE                12710001
127200             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  12720001
127300             PERFORM 9800-ABEND                                   12730001
127400      END-EVALUATE.                                               12740001
127500                                                                  12750001
127600*4300-EXIT.                                                       12760001
127700******************************************************************12770001
127800* 6000-VALIDATE-DATE-INPUT.                                       12780001
127900*     VALIDIATE THE DATE INPUT BY CALLING THE KOHLS CALENDAR      12790001
128000*     ROUTINE AND CHECKING TO SEE WHETHER IT THROWS AN ERROR.     12800001
128100******************************************************************12810001
128200 6000-VALIDATE-DATE-INPUT.                                        12820001
128300     MOVE '6000-VALIDATE-DATE-INPUT   ' TO PV-PARAGRAPH-NAME.     12830001
128400                                                                  12840001
128500     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      12850001
128600     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      12860001
128700     SET PS-DATE-NOT-VALID          TO TRUE.                      12870001
128800                                                                  12880001
128900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    12890001
129000                                             DPG54 DPG55 DPG56.   12900001
129100                                                                  12910001
129200     EVALUATE TRUE                                                12920001
129300        WHEN DPG54-NO-ERROR                                       12930001
129400           SET   PS-DATE-VALID      TO TRUE                       12940001
129500        WHEN OTHER                                                12950001
129600           SET   PS-DATE-NOT-VALID  TO TRUE                       12960001
129700           DISPLAY ' '                                            12970001
129800           DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'      12980001
129900           DISPLAY '** CALLED BY 6000-VALIDATE-DATE-INPUT'        12990001
130000           DISPLAY '** TO VALIDATE ' PV-CALLING-FUNCTION          13000001
130100           DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE      13010001
130200           DISPLAY '** CALENDAR TYPE = ' DPG51-CALENDAR-TYPE      13020001
130300           DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE  13030001
130400           DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT        13040001
130500           MOVE '6000-VALIDATE-DATE-INPUT' TO PV-PARAGRAPH-NAME   13050001
130600           MOVE 'INVALID DATE PASSED IN CNTL CARD'                13060001
130700                                            TO PV-OPERATION-MSG-1 13070001
130800           MOVE  DPG54-ERROR-MESSAGE        TO PV-OPERATION-MSG-2 13080001
130900           SET   AC-4019-CAL-SUB-ERROR      TO TRUE               13090001
131000           PERFORM 9800-ABEND                                     13100001
131100     END-EVALUATE.                                                13110001
131200                                                                  13120001
131300*6000-EXIT.                                                       13130001
131400******************************************************************13140001
131500* 6100-CALC-EXTR-START-DATE.                                      13150001
131600*     USE THE KOHLS DATE ROUTINE TO CALCULATE THE START DATE FOR  13160001
131700*     THE OFFERS EXTRACT.  AT THIS TIME, THE START DATE IS        13170001
131800*     365 DAYS PRIOR TO THE BATCH DATE.                           13180001
131900*     THIS DATE IS ADJUSTED BY TOLERANCES TO SELECT THE OFFERS.   13190001
132000******************************************************************13200001
132100 6100-CALC-EXTR-START-DATE.                                       13210001
132200     MOVE '6100-CALC-EXTR-START-DATE  ' TO PV-PARAGRAPH-NAME.     13220001
132300                                                                  13230001
132400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              13240001
132500     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      13250001
132600     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      13260001
132700     SET DPG51-DECREMENT-DATE       TO TRUE.                      13270001
132800     SET PS-DATE-NOT-FOUND          TO TRUE.                      13280001
132900                                                                  13290001
133000     MOVE PV-BATCH-DATE             TO DPG52-LK-DATE-INPUT.       13300001
133100                                                                  13310001
133200     MOVE PC-START-DTE-DECR-DAYS    TO DPG51-INCR-DECR-DAYS-9.    13320001
133300                                                                  13330001
133400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13340001
133500                                             DPG54 DPG55 DPG56.   13350001
133600                                                                  13360001
133700     EVALUATE TRUE                                                13370001
133800        WHEN DPG54-NO-ERROR                                       13380001
133900           SET    PS-DATE-FOUND     TO TRUE                       13390001
134000        WHEN OTHER                                                13400001
134100           SET    PS-DATE-NOT-FOUND TO TRUE                       13410001
134200           DISPLAY ' '                                            13420001
134300           DISPLAY '** INVALID RETURN FROM CALENDAR ROUTINE'      13430001
134400           DISPLAY '** CALLED BY 6100-CALC-EXTR-START-DATE '      13440001
134500           DISPLAY '** ERROR MESSAGE = ' DPG54-ERROR-MESSAGE      13450001
134600           DISPLAY '** DPG51-CALENDAR-TYPE = '                    13460001
134700                                       DPG51-CALENDAR-TYPE        13470001
134800           DISPLAY '** DATE FORMAT = ' DPG52-LK-DATE-FORMAT-CODE  13480001
134900           DISPLAY '** INPUT DATE  = ' DPG52-LK-DATE-INPUT        13490001
135000                    ', INCREMENT/DECREMENT FLAG = '               13500001
135100                                DPG51-INCREMENT-DECREMENT-FLAG    13510001
135200                    ', DECREMENT DAYS = '                         13520001
135300                                DPG51-INCR-DECR-DAYS-9-X          13530001
135400           MOVE '6100-CALC-EXTR-START-DATE'                       13540001
135500                                         TO PV-PARAGRAPH-NAME     13550001
135600           MOVE 'ERROR CALCULATING EXTRACT START DATE'            13560001
135700                                         TO PV-OPERATION-MSG-1    13570001
135800           MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2    13580001
135900           SET  AC-4019-CAL-SUB-ERROR    TO TRUE                  13590001
136000           PERFORM 9800-ABEND                                     13600001
136100     END-EVALUATE.                                                13610001
136200                                                                  13620001
136300*6100-EXIT.                                                       13630001
136400******************************************************************13640001
136500* 6200-POPULATE-BTN-VALUE                                         13650001
136600*  THIS PARAGRAPH WILL POPULATE THE POS-BTN-TXT AND THE           13660001
136700*  POS-BTN-RLTV-SEQ-NBR IN THE OUTPUT FILE, FOR A NON NULL        13670001
136800*  VALUE OF POS-BTN-CDE IN OMT_OFR_SECT TABLE.                    13680001
136900******************************************************************13690001
137000 6200-POPULATE-BTN-VALUE.                                         13700001
137100     MOVE '6200-POPULATE-BTN-VALUE  ' TO PV-PARAGRAPH-NAME.       13710001
137200                                                                  13720001
137300     SET PV-BTN-INDEX TO 1                                        13730001
137400     SEARCH PV-BTN-RECORD                                         13740001
137500       AT END                                                     13750001
137600          DISPLAY '*** POS-BTN-CDE NOT FOUND IN INTERNAL TBL ***' 13760001
137700          MOVE 'SEARCH FOR POS-BTN-CDE FAILED'                    13770001
137800                                     TO PV-OPERATION-MSG-1        13780001
137900          STRING 'POS-BTN-CDE > '         DELIMITED BY SIZE       13790001
138000                 POS-BTN-CDE IN OMT00002  DELIMITED BY SIZE       13800001
138100                                   INTO PV-OPERATION-MSG-2        13810001
138200          SET   AC-4008-INVALID-DATA TO TRUE                      13820001
138300          PERFORM 9800-ABEND                                      13830001
138400       WHEN POS-BTN-CDE IN OMT00002 = PV-POS-BTN-CDE(PV-BTN-INDEX)13840001
138500          MOVE PV-POS-BTN-TEXT(PV-BTN-INDEX)                      13850001
138600                                 TO EP205-POS-BTN-TXT             13860001
138700          MOVE PV-POS-BTN-RLTV-SEQ-NBR-X(PV-BTN-INDEX)            13870001
138800                                 TO EP205-POS-BTN-RLTV-SEQ-NBR-X  13880001
138900     END-SEARCH.                                                  13890001
139000                                                                  13900001
139100*6200-EXIT.                                                       13910001
139200******************************************************************13920001
139300*   7000-CONNECT-TO-ORACLE.                                      *13930001
139400*     CONNECT TO THE ORACLE DATABASE.                            *13940001
139500******************************************************************13950001
139600 7000-CONNECT-TO-ORACLE.                                          13960001
139700     MOVE '7000-CONNECT-TO-ORACLE          ' TO PV-PARAGRAPH-NAME.13970001
139800*                                                                 13980001
139900     IF CC-AUTO-LOGON                                             13990001
140000        DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'         14000001
140100        EXEC SQL                                                  14010001
140200             CONNECT :PC-AUTO-LOGON                               14020001
140300        END-EXEC                                                  14030001
140400     ELSE                                                         14040001
140500        INITIALIZE PV-ORACLE-USERID-LEN                           14050001
140600                   PV-ORACLE-PASSWORD-LEN                         14060001
140700        INSPECT CC-ORACLE-USERID                                  14070001
140800                TALLYING PV-ORACLE-USERID-LEN                     14080001
140900                FOR CHARACTERS BEFORE INITIAL SPACE               14090001
141000        INSPECT CC-ORACLE-PASSWORD                                14100001
141100                TALLYING PV-ORACLE-PASSWORD-LEN                   14110001
141200                FOR CHARACTERS BEFORE INITIAL SPACE               14120001
141300        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         14130001
141400                USERNAME-ARR                                      14140001
141410        MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                 14141001
141420        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     14142001
141430                PASSWD-ARR                                        14143001
141440        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 14144001
141450        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     14145001
141460             PASSWD-ARR                                           14146001
141470        MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                 14147001
141480        MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO         14148001
141490             USERNAME-ARR                                         14149001
141500        MOVE PV-ORACLE-USERID-LEN  TO USERNAME-LEN                14150001
141501        MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO     14150101
141502             PASSWD-ARR                                           14150201
141503        MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN                14150301
141504        DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '    14150401
141505             USERNAME-ARR                                         14150501
141506        EXEC SQL                                                  14150601
141507             CONNECT :USERNAME IDENTIFIED BY :PASSWD              14150701
141508        END-EXEC                                                  14150801
141509        INITIALIZE CC-ORACLE-PASSWORD                             14150901
141510                   PASSWD                                         14151001
141511     END-IF                                                       14151101
141512                                                                  14151201
141513     IF (SQLCODE NOT = 0)                                         14151301
141514         DISPLAY PV-PARAGRAPH-NAME                                14151401
141515         PERFORM 9900-ORA-ERROR                                   14151501
141516     END-IF.                                                      14151601
141517                                                                  14151701
141518*7000-EXIT.                                                       14151801
141519******************************************************************14151901
141520* 7100-DEC-OPEN-BTN-CURSOR.                                       14152001
141530* THIS PARAGRAPH WILL DECLARE AND OPEN BTNCRSR                    14153001
141540******************************************************************14154001
141550 7100-DEC-OPEN-BTN-CURSOR.                                        14155001
141560     MOVE '7100-DEC-OPEN-BTN-CURSOR        ' TO PV-PARAGRAPH-NAME.14156001
141570                                                                  14157001
141580        EXEC SQL  DECLARE BTNCRSR CURSOR FOR                      14158001
141590           SELECT                                                 14159001
141600               POS_BTN_CDE                                        14160001
141700              ,POS_BTN_TXT                                        14170001
141800              ,POS_BTN_RLTV_SEQ_NBR                               14180001
141900          FROM  OMT_POS_BTN                                       14190001
142000          WHERE POS_BTN_CDE IS NOT NULL                           14200001
142100        END-EXEC.                                                 14210001
142200                                                                  14220001
142300     PERFORM                                                      14230001
142400         WITH TEST AFTER                                          14240001
142500         VARYING PV-SQL-SUB                                       14250001
142600         FROM 1 BY 1                                              14260001
142700         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14270001
142800                   OR  SQLCODE = 0)                               14280001
142900                                                                  14290001
143000           EXEC SQL                                               14300001
143100              OPEN BTNCRSR                                        14310001
143200           END-EXEC                                               14320001
143300                                                                  14330001
143400           EVALUATE TRUE                                          14340001
143500               WHEN SQLCODE = 0                                   14350001
143600                    CONTINUE                                      14360001
143700               WHEN SQLWARN0 NOT EQUAL SPACE                      14370001
143800               WHEN SQLCODE NOT EQUAL ZERO                        14380001
143900                    MOVE 'OPEN CURSOR FOR BTNCRSR     '           14390001
144000                                       TO PV-ORA-OPERATION        14400001
144100                    PERFORM 9900-ORA-ERROR                        14410001
144200           END-EVALUATE                                           14420001
144300                                                                  14430001
144400     END-PERFORM.                                                 14440001
144500                                                                  14450001
144600*7100-EXIT.                                                       14460001
144700******************************************************************14470001
144800* 7150-FETCH-BTN-CURSOR                                           14480001
144900* FETCH DATA FROM THE BTNCRSR CURSOR TO POPULATE THE              14490001
145000*   PROGRAM TABLE (PV-OMT-POS-BTN)                                14500001
145100******************************************************************14510001
145200 7150-FETCH-BTN-CURSOR.                                           14520001
145300     MOVE '7150-FETCH-BTN-CURSOR           ' TO PV-PARAGRAPH-NAME.14530001
145400                                                                  14540001
145500     EXEC SQL                                                     14550001
145600         FETCH BTNCRSR                                            14560001
145700          INTO                                                    14570001
145800               :OMT00006.POS-BTN-CDE                              14580001
145900              ,:OMT00006.POS-BTN-TXT                              14590001
146000              ,:OMT00006.POS-BTN-RLTV-SEQ-NBR                     14600001
146100               :PV-POS-RLTV-NUM-NULL-IND                          14610001
146200     END-EXEC.                                                    14620001
146300                                                                  14630001
146400*7150-EXIT.                                                       14640001
146500******************************************************************14650001
146600*  7200-CLOSE-BTN-CURSOR.                                        *14660001
146700*  CLOSE BTNCRSR CURSOR                                          *14670001
146800******************************************************************14680001
146900 7200-CLOSE-BTN-CURSOR.                                           14690001
147000     MOVE '7200-CLOSE-BTN-CURSOR         ' TO  PV-PARAGRAPH-NAME. 14700001
147100                                                                  14710001
147200     PERFORM                                                      14720001
147300         WITH TEST AFTER                                          14730001
147400         VARYING PV-SQL-SUB                                       14740001
147500         FROM 1 BY 1                                              14750001
147600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 14760001
147700                   OR  SQLCODE = 0)                               14770001
147800                                                                  14780001
147900           EXEC SQL                                               14790001
148000              CLOSE BTNCRSR                                       14800001
148100           END-EXEC                                               14810001
148200                                                                  14820001
148300         EVALUATE TRUE                                            14830001
148400             WHEN SQLCODE = 0                                     14840001
148500                  CONTINUE                                        14850001
148600             WHEN SQLWARN0 NOT EQUAL SPACE                        14860001
148700             WHEN SQLCODE NOT EQUAL ZERO                          14870001
148800                  MOVE 'CLOSE CURSOR FOR OMT_POS_BTN'             14880001
148900                                     TO PV-ORA-OPERATION          14890001
149000                  PERFORM 9900-ORA-ERROR                          14900001
149100         END-EVALUATE                                             14910001
149200     END-PERFORM.                                                 14920001
149300                                                                  14930001
149400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         14940001
149500        MOVE 'CLOSE BTNCRSR CURSOR RETRIES EXCEEDED'              14950001
149600                              TO  PV-ORA-OPERATION                14960001
149700        PERFORM 9900-ORA-ERROR                                    14970001
149800     END-IF.                                                      14980001
149900                                                                  14990001
150000*7200-EXIT.                                                       15000001
150100******************************************************************15010001
150200* 7300-DEC-OPEN-OFFER-CURSOR.                                     15020001
150300*  DECLARE AND OPEN OFFERCRSR TO OBTAIN OFFERS FOR REFRESH STORES 15030001
150400*  NOTE: THIS IS IN THE PROCEDURE DIVISION BECAUSE OF THE WAY     15040001
150500*        COBOL AND ORACLE INTERACT.                               15050001
150600*  CURSOR WHERE CLAUSE CONDITION NOTES:                           15060001
150700*   - OMT_OFR_LOC_GP.LOC_DLT_IND = 'N' -> NON-DELETED STR GRPS    15070001
150800*   - OMT_MDSE_SET.MDSE_DLT_IND = 'N'  -> NON-DELETED MERCH SETS  15080001
150900*   - OMT_OFR_LOC_GP.IE_IND = 'Y' -> INCLUDED STORE GROUPS        15090001
151000*     (IE_IND = 'Y' MEANS INCLUDED, IE_IND = 'N' MEANS EXCLUDED)  15100001
151100*   - TO BE EXTRACTED, AN OFFER NEEDS TO END AFTER THE EXTRACT    15110001
151200*     END DATE, ALLOWING FOR END DATE TOLERANCE AND SUPERVISOR    15120001
151300*     OVERRIDE DAYS TOLERANCE, WHICH ARE ADDED ONTO THE END DATE. 15130001
151400*     RESULT: EXTRACT-START-DATE - SUM(TOLERANCES)                15140001
151500******************************************************************15150001
151600 7300-DEC-OPEN-OFFER-CURSOR.                                      15160001
151700     MOVE '7300-DEC-OPEN-OFFER-CURSOR      ' TO PV-PARAGRAPH-NAME.15170001
151800                                                                  15180001
151900        EXEC SQL DECLARE OFFERCRSR CURSOR FOR                     15190001
152000          SELECT C.EVNT_ID                                        15200001
152100                ,C.OFR_ID                                         15210001
152200                ,C.OFR_NM                                         15220001
152300                ,C.DISC_LVL_CDE                                   15230001
152400                ,C.OFR_USG_TYP_CDE                                15240001
152500                ,C.BRCDE_TYP_CDE                                  15250001
152600                ,C.UNEARN_IND                                     15260001
152700                ,C.OFR_TRGR_TYP_CDE                               15270001
152800                ,C.ITM_DISC_APPL_CDE                              15280001
152900                ,B.EVNT_TYP_CDE                                   15290001
153000                ,A.EVNT_CTG_NM                                    15300001
153100                ,D.OFR_SECT_TYP_CDE                               15310001
214901**              ,D.EFF_BEG_TMST                                   15320004
214901                ,TO_CHAR(D.EFF_BEG_TMST,'YYYY-MM-DD.HH24.MI.SS')  15321004
214901**              ,D.EFF_END_TMST                                   15330004
214901                ,TO_CHAR(D.EFF_END_TMST,'YYYY-MM-DD.HH24.MI.SS')  15331004
153400                ,D.TOL_STRT_NMOFDA_QTY                            15340001
153500                ,D.TOL_END_NMOFDA_QTY                             15350001
153600                ,D.REDMN_SUPVR_OVRRID_NMOFDA_QTY                  15360001
153700                ,D.BWP_GET_CNCTR_CDE                              15370001
153800                ,D.BWP_BUY_CNCTR_CDE                              15380001
153900                ,D.LMT_PER_TRN_QTY                                15390001
154000                ,D.VLD_POS_TNDR_COMB_TYP_CDE                      15400001
154100                ,D.POS_BTN_CDE                                    15410001
154200                ,E.CUSTFACG_SHRT_DESC                             15420001
154300                ,G.OFR_SECT_BWP_ID                                15430001
154400                ,G.TIER_LVL_NBR                                   15440001
154500                ,G.BWP_SELN_TYP_CDE                               15450001
154600                ,G.BWP_BUY_QTY                                    15460001
154700                ,G.BWP_BUY_AMT                                    15470001
154800                ,G.BWP_BUY_TOL_AMT                                15480001
154900                ,G.BWP_GET_QTY                                    15490001
155000                ,G.BWP_GET_PCT_OFF_PCT                            15500001
155100                ,G.BWP_GET_DOL_OFF_AMT                            15510001
155200                ,G.BWP_GET_PRPT_AMT                               15520001
155300                ,H.MDSE_SET_ID                                    15530001
155400                ,H.MDSE_HIER_CDE                                  15540001
155500                ,H.DEPT_NBR                                       15550001
155600                ,H.MAJ_CL_NBR                                     15560001
155700                ,H.SUB_CL_NBR                                     15570001
155800                ,H.STYL_ID                                        15580001
155900                ,H.SKU_NBR                                        15590001
156000                ,H.IE_IND                                         15600001
156100                ,H.EMP_DISC_CDE                                   15610001
156200                ,H.DISC_ELIG_IND                                  15620001
156300                ,H.TKT_CLOR_CDE                                   15630001
156400            FROM OMT_EVNT_CTG A                                   15640001
156500                ,OMT_EVNT B                                       15650001
156600                ,OMT_OFR C                                        15660001
156700                ,OMT_OFR_SECT D                                   15670001
156800                ,OMT_OFR_CUSTFACG_DESC E                          15680001
156900                ,OMT_OFR_SECT_BWP G                               15690001
157000                ,OMT_MDSE_SET H                                   15700001
157100                ,OMT_OFR_LOC_GP I                                 15710001
157200         WHERE   I.STR_GP_TYP_CDE   = :PV-STR-GP-TYP-CDE          15720001
157300             AND I.STR_GP_ID        = :PV-STR-GRP-ID              15730001
157400             AND (D.EFF_END_TMST >= TO_DATE(:PV-EXTR-START-DTE    15740001
157500                                       ,'YYYY-MM-DD HH24.MI.SS')  15750001
157600                             - ( D.TOL_END_NMOFDA_QTY +           15760001
157700                                 D.REDMN_SUPVR_OVRRID_NMOFDA_QTY )15770001
157800             AND  D.EFF_BEG_TMST <= TO_DATE(:EP252-CC-FUTURE-DATE 15780001
157900                                       ,'YYYY-MM-DD HH24.MI.SS')) 15790001
158000             AND I.IE_IND           = 'Y'                         15800001
158100             AND I.LOC_DLT_IND      = 'N'                         15810001
158200             AND I.EVNT_ID          = D.EVNT_ID                   15820001
158300             AND I.OFR_ID           = D.OFR_ID                    15830001
158400             AND C.EVNT_ID          = B.EVNT_ID                   15840001
158500             AND B.EVNT_CTG_ID      = A.EVNT_CTG_ID               15850001
158600             AND C.EVNT_ID          = D.EVNT_ID                   15860001
158700             AND C.OFR_ID           = D.OFR_ID                    15870001
158800             AND D.CUSTFACG_DESC_ID = E.CUSTFACG_DESC_ID          15880001
158900             AND D.OFR_ID           = G.OFR_ID                    15890001
159000             AND D.OFR_SECT_TYP_CDE = G.OFR_SECT_TYP_CDE          15900001
159100             AND D.OFR_ID           = H.OFR_ID                    15910001
159200             AND G.OFR_SECT_BWP_ID  = H.OFR_SECT_BWP_ID           15920001
159300             AND D.EVNT_ID          = G.EVNT_ID                   15930001
159400             AND G.OFR_SECT_TYP_CDE = H.OFR_SECT_TYP_CDE          15940001
159500             AND G.OFR_ID           = H.OFR_ID                    15950001
159600             AND G.EVNT_ID          = H.EVNT_ID                   15960001
159700             AND D.OFR_SECT_TYP_CDE = I.OFR_SECT_TYP_CDE          15970001
159800             AND G.BWP_DLT_IND      = 'N'                         15980001
159900             AND H.MDSE_DLT_IND     = 'N'                         15990001
160000             AND C.OFR_STAT_CDE     = 'A'                         16000001
160100         ORDER BY C.OFR_ID                                        16010001
160200                                                                  16020001
160300      END-EXEC.                                                   16030001
160400                                                                  16040001
160500     PERFORM                                                      16050001
160600         WITH TEST AFTER                                          16060001
160700         VARYING PV-SQL-SUB                                       16070001
160800         FROM 1 BY 1                                              16080001
160900         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 16090001
161000                   OR  SQLCODE = 0)                               16100001
161100                                                                  16110001
161200           EXEC SQL                                               16120001
161300              OPEN OFFERCRSR                                      16130001
161400           END-EXEC                                               16140001
161500                                                                  16150001
161600           EVALUATE TRUE                                          16160001
161700               WHEN SQLCODE = 0                                   16170001
161800                    CONTINUE                                      16180001
161900               WHEN SQLWARN0 NOT EQUAL SPACE                      16190001
162000               WHEN SQLCODE NOT EQUAL ZERO                        16200001
162100                    MOVE 'OPEN CURSOR FOR OFFERCRSR   '           16210001
162200                                       TO PV-ORA-OPERATION        16220001
162300                    PERFORM 9900-ORA-ERROR                        16230001
162400           END-EVALUATE                                           16240001
162500                                                                  16250001
162600      END-PERFORM.                                                16260001
162700                                                                  16270001
162800*7300-EXIT.                                                       16280001
162900******************************************************************16290001
163000* 7400-FETCH-OFFER-REFRESH-CSR                                    16300001
163100* THIS PARAGRAPH WILL FETCH DATA FROM THE OFFERCRSR CURSOR        16310001
163200******************************************************************16320001
163300 7400-FETCH-OFFER-REFRESH-CSR.                                    16330001
163400     MOVE '7400-FETCH-OFFER-REFRESH-CSR    ' TO PV-PARAGRAPH-NAME.16340001
163500                                                                  16350001
163600     INITIALIZE PV-NULL-INDICATORS.                               16360001
163700                                                                  16370001
163800     EXEC SQL                                                     16380001
163900         FETCH OFFERCRSR                                          16390001
164000          INTO                                                    16400001
164100               :OMT00001.EVNT-ID                                  16410001
164200              ,:OMT00001.OFR-ID                                   16420001
164300              ,:OMT00001.OFR-NM                                   16430001
164400              ,:OMT00001.DISC-LVL-CDE                             16440001
164500              ,:OMT00001.OFR-USG-TYP-CDE                          16450001
164600              ,:OMT00001.BRCDE-TYP-CDE                            16460001
164700              ,:OMT00001.UNEARN-IND                               16470001
164800              ,:OMT00001.OFR-TRGR-TYP-CDE                         16480001
164900              ,:OMT00001.ITM-DISC-APPL-CDE                        16490001
165000               :PV-ITM-DISC-APL-NULL-IND                          16500001
165100              ,:OMT00009.EVNT-TYP-CDE                             16510001
165200              ,:OMT00007.EVNT-CTG-NM                              16520001
165300              ,:OMT00002.OFR-SECT-TYP-CDE                         16530001
165400              ,:OMT00002.EFF-BEG-TMST                             16540001
165500              ,:OMT00002.EFF-END-TMST                             16550001
165600              ,:OMT00002.TOL-STRT-NMOFDA-QTY                      16560001
165700              ,:OMT00002.TOL-END-NMOFDA-QTY                       16570001
165800              ,:OMT00002.REDMN-SUPVR-OVRRID-NMOFDA-QTY            16580001
165900              ,:OMT00002.BWP-GET-CNCTR-CDE                        16590001
166000              ,:OMT00002.BWP-BUY-CNCTR-CDE                        16600001
166100              ,:OMT00002.LMT-PER-TRN-QTY                          16610001
166200              ,:OMT00002.VLD-POS-TNDR-COMB-TYP-CDE                16620001
166300              ,:OMT00002.POS-BTN-CDE                              16630001
166400               :PV-POS-BTN-CDE-NULL-IND                           16640001
166500              ,:OMT00008.CUSTFACG-SHRT-DESC                       16650001
166600              ,:OMT00003.OFR-SECT-BWP-ID                          16660001
166700              ,:OMT00003.TIER-LVL-NBR                             16670001
166800              ,:OMT00003.BWP-SELN-TYP-CDE                         16680001
166900              ,:OMT00003.BWP-BUY-QTY                              16690001
167000               :PV-BWP-BUY-QTY-NULL-IND                           16700001
167100              ,:OMT00003.BWP-BUY-AMT                              16710001
167200               :PV-BWP-BUY-AMT-NULL-IND                           16720001
167300              ,:OMT00003.BWP-BUY-TOL-AMT                          16730001
167400               :PV-BWP-BUY-TOL-AMT-NULL-IND                       16740001
167500              ,:OMT00003.BWP-GET-QTY                              16750001
167600               :PV-BWP-GET-QTY-NULL-IND                           16760001
167700              ,:OMT00003.BWP-GET-PCT-OFF-PCT                      16770001
167800               :PV-BWP-GET-PCT-NULL-IND                           16780001
167900              ,:OMT00003.BWP-GET-DOL-OFF-AMT                      16790001
168000               :PV-BWP-GET-DOL-NULL-IND                           16800001
168100              ,:OMT00003.BWP-GET-PRPT-AMT                         16810001
168200               :PV-BWP-GET-PRPT-NULL-IND                          16820001
168300              ,:OMT00005.MDSE-SET-ID                              16830001
168400              ,:OMT00005.MDSE-HIER-CDE                            16840001
168500              ,:OMT00005.DEPT-NBR                                 16850001
168600               :PV-MDSE-DEPT-NBR-NULL-IND                         16860001
168700              ,:OMT00005.MAJ-CL-NBR                               16870001
168800               :PV-MDSE-MAJ-CLS-NULL-IND                          16880001
168900              ,:OMT00005.SUB-CL-NBR                               16890001
169000               :PV-MDSE-SUB-CLS-NULL-IND                          16900001
169100              ,:OMT00005.STYL-ID                                  16910001
169200               :PV-MDSE-STL-ID-NULL-IND                           16920001
169300              ,:OMT00005.SKU-NBR                                  16930001
169400               :PV-MDSE-SKU-NB-NULL-IND                           16940001
169500              ,:OMT00005.IE-IND                                   16950001
169600              ,:OMT00005.EMP-DISC-CDE                             16960001
169700               :PV-MDSE-EMP-DS-NULL-IND                           16970001
169800              ,:OMT00005.DISC-ELIG-IND                            16980001
169900               :PV-MDSE-DSC-EL-NULL-IND                           16990001
170000              ,:OMT00005.TKT-CLOR-CDE                             17000001
170100               :PV-MDSE-TKT-CL-NULL-IND                           17010001
170200     END-EXEC.                                                    17020001
170300                                                                  17030001
170400*7400-EXIT.                                                       17040001
170500******************************************************************17050001
170600*  7500-CLOSE-OFFER-CURSOR.                                      *17060001
170700*  CLOSE OFFERCRSR CURSOR                                        *17070001
170800******************************************************************17080001
170900 7500-CLOSE-OFFER-CURSOR.                                         17090001
171000     MOVE '7500-CLOSE-OFFER-CURSOR   ' TO      PV-PARAGRAPH-NAME. 17100001
171100                                                                  17110001
171200     PERFORM                                                      17120001
171300         WITH TEST AFTER                                          17130001
171400         VARYING PV-SQL-SUB                                       17140001
171500         FROM 1 BY 1                                              17150001
171600         UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 17160001
171700                   OR  SQLCODE = 0)                               17170001
171800                                                                  17180001
171900           EXEC SQL                                               17190001
172000              CLOSE OFFERCRSR                                     17200001
172100           END-EXEC                                               17210001
172200                                                                  17220001
172300         EVALUATE TRUE                                            17230001
172400             WHEN SQLCODE = 0                                     17240001
172500                  CONTINUE                                        17250001
172600             WHEN SQLWARN0 NOT EQUAL SPACE                        17260001
172700             WHEN SQLCODE NOT EQUAL ZERO                          17270001
172800                  MOVE 'CLOSE CURSOR FOR OFFERS EXTRACT'          17280001
172900                                     TO PV-ORA-OPERATION          17290001
173000                  PERFORM 9900-ORA-ERROR                          17300001
173100         END-EVALUATE                                             17310001
173200     END-PERFORM.                                                 17320001
173300                                                                  17330001
173400     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         17340001
173500        MOVE 'CLOSE OFFER CURSOR RETRIES EXCEEDED'                17350001
173600                              TO  PV-ORA-OPERATION                17360001
173700        PERFORM 9900-ORA-ERROR                                    17370001
173800     END-IF.                                                      17380001
173900                                                                  17390001
174000*7500-EXIT.                                                       17400001
174100***********************************************************       17410001
174200* 8000-READ-BATCH-DATE-CNTL-CARD                                  17420001
174300*     READ INPUT BATCH DATE CONTROL CARD - TODAY'S DATE           17430001
174400***********************************************************       17440001
174500 8000-READ-BATCH-DATE-CNTL-CARD.                                  17450001
174600                                                                  17460001
174700     READ CONTROL-CARD-BATCH-DATE INTO EP257-CC-CONTROL-CARD      17470001
174800        AT END SET PS-END-OF-CC-BATCH-DTE TO TRUE                 17480001
174900     END-READ.                                                    17490001
175000                                                                  17500001
175100     IF  PS-END-OF-CC-BATCH-DTE                                   17510001
175200        MOVE '8000-READ-BATCH-DATE-CNTL-CARD' TO PV-PARAGRAPH-NAME17520001
175300        MOVE 'BATCH DATE CARD IS EMPTY' TO PV-OPERATION-MSG-1     17530001
175400        SET   AC-4008-INVALID-DATA TO TRUE                        17540001
175500        PERFORM 9800-ABEND                                        17550001
175600     END-IF.                                                      17560001
175700                                                                  17570001
175800*8000-EXIT.                                                       17580001
175900******************************************************************17590001
176000* 8100-READ-CC-NXT-FUT-DAY                                        17600001
176100*     READ SALES PROCESSING DATE FROM INPUT CONTROL CARD          17610001
176200******************************************************************17620001
176300 8100-READ-CC-NXT-FUT-DAY.                                        17630001
176400                                                                  17640001
176500     INITIALIZE EP252-CC-CONTROL-CARD.                            17650001
176600                                                                  17660001
176700     READ CONTROL-CARD-NXT-FUT-DAY INTO EP252-CC-CONTROL-CARD     17670001
176800        AT END SET PS-END-OF-CC-NXT-FUT-DAY TO TRUE.              17680001
176900                                                                  17690001
177000     IF  PS-END-OF-CC-NXT-FUT-DAY                                 17700001
177100         MOVE '8100-READ-CC-NXT-FUT-DAY  ' TO PV-PARAGRAPH-NAME   17710001
177200         MOVE 'FUTURE DATE CARD IS EMPTY ' TO PV-OPERATION-MSG-1  17720001
177300         SET  AC-4008-INVALID-DATA         TO TRUE                17730001
177400         PERFORM 9800-ABEND                                       17740001
177500     END-IF.                                                      17750001
177600                                                                  17760001
177700*8100-EXIT.                                                       17770001
177800******************************************************************17780001
177900*  8200-READ-STR-GRP-FILE.                                       *17790001
178000*    READ STORE GROUP DRIVER FILE.                               *17800001
178100******************************************************************17810001
178200 8200-READ-STR-GRP-FILE.                                          17820001
178300     MOVE '8200-READ-STR-GRP-FILE       ' TO PV-PARAGRAPH-NAME.   17830001
178400                                                                  17840001
178500     READ REFRESH-STORE-CARD-FILE INTO EP250-CC-CONTROL-CARD      17850001
178600       AT END                                                     17860001
178700          SET PS-END-OF-STR-GP-FILE TO TRUE                       17870001
178800          IF  PS-FIRST-READ-STR-GP                                17880001
178900              DISPLAY PC-NO-REFRESHES-FOUND                       17890001
179000              DISPLAY 'NO REFRESH OF OFFERS DATA TODAY'           17900001
179100          END-IF                                                  17910001
179200                                                                  17920001
179300       NOT AT END                                                 17930001
179400          ADD 1 TO PV-RECS-READ                                   17940001
179500          SET PS-NOT-FIRST-READ-STR-GP TO TRUE                    17950001
179600     END-READ.                                                    17960001
179700                                                                  17970001
179800*8200-EXIT.                                                       17980001
179900******************************************************************17990001
180000* 8300-WRITE-XST-OFR-DATA                                         18000001
180100*     WRITE OFFER DATA RECORD                                     18010001
180200*     ALL RECORD TYPES WILL USE THIS WRITE STATEMENT              18020001
180300******************************************************************18030001
180400 8300-WRITE-XST-OFR-DATA.                                         18040001
180500     MOVE '8300-WRITE-XST-OFR-DATA      ' TO PV-PARAGRAPH-NAME.   18050001
180600                                                                  18060001
180700     MOVE SPACES TO OFFERS-FULL-REFRESH-RECORD.                   18070001
180800                                                                  18080001
180900     WRITE OFFERS-FULL-REFRESH-RECORD FROM EP205-OFFER-EXTRACT.   18090001
181000                                                                  18100001
181100*8300-EXIT.                                                       18110001
181200******************************************************************18120001
181300* 8400-WRITE-STR-LIST-REC                                         18130001
181400*     WRITE STORE LIST RECORD                                     18140001
181500******************************************************************18150001
181600 8400-WRITE-STR-LIST-REC.                                         18160001
181700     MOVE '8400-WRITE-STR-LIST-REC      ' TO PV-PARAGRAPH-NAME.   18170001
181800                                                                  18180001
181900     MOVE SPACES TO REFRESH-STORE-LIST-RECORD.                    18190001
182000                                                                  18200001
182100     WRITE  REFRESH-STORE-LIST-RECORD  FROM EP206-STORE-LIST-RCD. 18210001
182200                                                                  18220001
182300     ADD 1 TO PV-STR-LIST-RECS-OUT.                               18230001
182400                                                                  18240001
182500*8400-EXIT.                                                       18250001
182600******************************************************************18260001
182700*   9000-WRAPUP.                                                 *18270001
182800*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *18280001
182900******************************************************************18290001
183000 9000-WRAPUP.                                                     18300001
183100     MOVE '9000-WRAPUP                     ' TO PV-PARAGRAPH-NAME.18310001
183200                                                                  18320001
183300     PERFORM EP208-1200-DETERMINE-IF-ALERT.                       18330001
183400     PERFORM 9920-DISPLAY-TOTALS.                                 18340001
183500                                                                  18350001
183600     PERFORM 9990-GET-CURRENT.                                    18360001
183700                                                                  18370001
183800     DISPLAY '****************************************'.          18380001
183900     DISPLAY '**          EPKUT201 END              **'.          18390001
184000     DISPLAY '****************************************'.          18400001
184100     DISPLAY '**     END DATE ' DF-DISPLAY-DATE                   18410001
184200             '            **'.                                    18420001
184300     DISPLAY '**     END TIME ' DF-DISPLAY-TIME                   18430001
184400             '              **'.                                  18440001
184500     DISPLAY '****************************************'.          18450001
184600                                                                  18460001
184700     CLOSE REFRESH-STORE-CARD-FILE                                18470001
184800           CONTROL-CARD-NXT-FUT-DAY                               18480001
184900           CONTROL-CARD-BATCH-DATE                                18490001
185000           OFFERS-FULL-REFRESH-FILE                               18500001
185100           REFRESH-STORE-LIST-FILE.                               18510001
185200                                                                  18520001
185300*9000-EXIT.                                                       18530001
185400******************************************************************18540001
185500*     DATA RANGE VALIDATION ROUTINE AND NETCOOL ALERT CALL       *18550001
185600******************************************************************18560001
185700      COPY EPPD208.                                               18570001
185800                                                                  18580001
185900******************************************************************18590001
186000* 9800-ABEND.                                                    *18600001
186100*     ABEND PROGRAM WHEN A NON-ORACLE ERROR OCCURS.              *18610001
186200*     ROLLBACK ORACLE IN THE EVENT THAT THE ABEND OCCURS AFTER   *18620001
186300*     ORACLE PROCESSING IS UNDER WAY, TO CLOSE CURSOR(S) AND     *18630001
186400*     RELEASE RESOURCES.                                         *18640001
186500******************************************************************18650001
186600 9800-ABEND.                                                      18660001
186700                                                                  18670001
186800     EXEC SQL                                                     18680001
186900        ROLLBACK                                                  18690001
187000     END-EXEC.                                                    18700001
187100                                                                  18710001
187200     PERFORM 9920-DISPLAY-TOTALS.                                 18720001
187300     PERFORM 9990-GET-CURRENT.                                    18730001
187400                                                                  18740001
187500     DISPLAY '** ABEND           **'.                             18750001
187600     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          18760001
187700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        18770001
187800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       18780001
187900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       18790001
188000     DISPLAY '** TIME            ** = ' DF-DISPLAY-TIME.          18800001
188100                                                                  18810001
188200     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         18820001
188300                                                                  18830001
188400*9800-EXIT.                                                       18840001
188500***************************************************************** 18850001
188600*   9900-ORA-ERROR.                                             * 18860001
188700*     ORACLE ABEND ROUTINE.                                     * 18870001
188800***************************************************************** 18880001
188900 9900-ORA-ERROR.                                                  18890001
189000                                                                  18900001
189100     EXEC SQL                                                     18910001
189200        ROLLBACK                                                  18920001
189300     END-EXEC.                                                    18930001
189400                                                                  18940001
189500     PERFORM 9920-DISPLAY-TOTALS.                                 18950001
189600     PERFORM 9990-GET-CURRENT.                                    18960001
189700                                                                  18970001
189800     SET AC-4013-ORACLE-ERROR      TO TRUE.                       18980001
189900     DISPLAY '** ABEND     **'.                                   18990001
190000     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                19000001
190100     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              19010001
190200     DISPLAY '** OPERATION ** = ' PV-ORA-OPERATION.               19020001
190300     DISPLAY '** TIME      ** = ' DF-DISPLAY-TIME.                19030001
190400                                                                  19040001
190500     COPY DPPD004.                                                19050001
190600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         19060001
190700                                                                  19070001
190800*9900-EXIT.                                                       19080001
190900******************************************************************19090001
191000*   9920-DISPLAY-TOTALS.                                         *19100001
191100*     DISPLAY END OF JOB TOTALS                                  *19110001
191200******************************************************************19120001
191300 9920-DISPLAY-TOTALS.                                             19130001
191400                                                                  19140001
191500     DISPLAY '****************************************'.          19150001
191600     DISPLAY '**     EOJ STATISTICS FOR EPKUT201    **'           19160001
191700     DISPLAY '****************************************'.          19170001
191800                                                                  19180001
191900     DISPLAY '** STR GRP CNTL RCDS READ ==> '                     19190001
192000             PV-RECS-READ                                         19200001
192100             ' **'.                                               19210001
192200     DISPLAY '** BUTTON RECS FETCHED =====> '                     19220001
192300             PV-POS-BTN-REC-FETCHED                               19230001
192400             ' **'.                                               19240001
192500     DISPLAY '** STORE REFRESH COUNT =====> '                     19250001
192600             PV-STORE-RFRSH-COUNT                                 19260001
192700             ' **'.                                               19270001
192800     DISPLAY '** OFFER CRSR RECS FETCHED => '                     19280001
192900             PV-OFR-CRSR-RECS-FETCHED                             19290001
193000             ' **'.                                               19300001
193100     DISPLAY '** OFFER RCDS WRITTEN ======> '                     19310001
193200             PV-OFFER-RECS-OUT                                    19320001
193300             ' **'.                                               19330001
193400     DISPLAY '** OFFER SECT RCDS WRITTEN => '                     19340001
193500             PV-OFRSECT-RECS-OUT                                  19350001
193600             ' **'.                                               19360001
193700     DISPLAY '** OFFER BWP RCDS WRITTEN ==> '                     19370001
193800             PV-OFRBWP-RECS-OUT                                   19380001
193900             ' **'.                                               19390001
194000     DISPLAY '** MDSE SET RCDS WRITTEN ===> '                     19400001
194100             PV-MDSESET-RECS-OUT                                  19410001
194200             ' **'.                                               19420001
194300     DISPLAY '** STR LIST RCDS WRITTEN ===> '                     19430001
194400             PV-STR-LIST-RECS-OUT                                 19440001
194500             ' **'.                                               19450001
194600     DISPLAY '** ERROR RECORDS ===========> '                     19460001
194700             EP208-ERROR-RCD-COUNT                                19470001
194800             ' **'.                                               19480001
194900     DISPLAY '** ALERT RECORDS ===========> '                     19490001
195000             EP208-ALERT-RECS-OUT                                 19500001
195100             ' **'.                                               19510001
195200     DISPLAY '****************************************'.          19520001
195300                                                                  19530001
195400     IF PV-STORE-RFRSH-COUNT > ZERO                               19540001
195500        AND  PV-OFR-CRSR-RECS-FETCHED = ZERO                      19550001
195600           DISPLAY '*********************************************'19560001
195700           DISPLAY '**  NO OFFERS FOUND FOR REQUESTED STORES   **'19570001
195800           DISPLAY '**  NUMBER OF STORES: ' PV-STORE-RFRSH-COUNT  19580001
195900                                                  '            **'19590001
196000           DISPLAY '*********************************************'19600001
196100     END-IF.                                                      19610001
196200                                                                  19620001
196300*9920-EXIT.                                                       19630001
196400******************************************************************19640001
196500*  9990-GET-CURRENT.                                             *19650001
196600*     GET CURRENT DATE, TIME AND TIMESTAMP FROM ORA / SYSTEM     *19660001
196700******************************************************************19670001
196800 9990-GET-CURRENT.                                                19680001
196900                                                                  19690001
197000     MOVE FUNCTION CURRENT-DATE(1:16) TO DF-CURRENT-DATE-TIME.    19700001
197100                                                                  19710001
197200     MOVE DF-CURRENT-YR            TO DF-DD-YR.                   19720001
197300     MOVE DF-CURRENT-MO            TO DF-DD-MO.                   19730001
197400     MOVE DF-CURRENT-DY            TO DF-DD-DY.                   19740001
197500     MOVE DF-CURRENT-HR            TO DF-DT-HR.                   19750001
197600     MOVE DF-CURRENT-MIN           TO DF-DT-MIN.                  19760001
197700     MOVE DF-CURRENT-SEC           TO DF-DT-SEC.                  19770001
197800                                                                  19780001
197900*9990-EXIT.                                                       19790001
198000************************  END OF PROGRAM  ************************19800001
