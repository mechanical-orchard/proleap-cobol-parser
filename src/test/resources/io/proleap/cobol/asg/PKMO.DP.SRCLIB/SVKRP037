000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SVKRP037.                                00050099
000600 AUTHOR.                 DANIEL OKYERE.                           00060099
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            JULY 2005.                               00080099
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200* * * *>>>   THIS PROGRAM MUST BE COMPILED COBOL/390   <<<* * * * 00120000
001300***************************************************************** 00130099
001400*                                                                 00140000
001500*  THIS PROGRAM WILL CREATE MONTHLY STORED VALUE CARD AGING       00150099
001600*  REPORTS FROM AN INPUT FILE CONTAINING CARD ACTIVITY.           00160000
001700*                                                                 00170000
001800*  THE INPUT ACTIVITY FILE (INP01) CONTAINS CARD ACTIVITY DATA,   00180000
001900*  IN THE FORM OF ISSUE RECORDS AND TENDER RECORDS.  AN ISSUE     00190000
002000*  RECORD HOLDS ISSUE DATA SUCH AS ISSUE DATE AND ISSUE AMOUNT.   00200000
002100*  TENDER RECORDS HOLD TENDER DATA SUCH AS DATES TENDERED, AND    00210000
002200*  TENDERED AMOUNTS.  EACH CARD HAS ONE OR MANY ISSUE RECORD,     00220099
002300*  AND ZERO OR MANY TENDER RECORDS, DEPENDING ON HOW MANY TIMES   00230099
002400*  THE CARD WAS TENDERED.                                         00240099
002500*                                                                 00250000
002600*  THIS CARD ACTIVITY IS ACCUMULATED BY FISCAL PERIOD IN          00260000
002700*  WORKING STORAGE TABLES AND THEN PRINTED ON AN OUTPUT REPORT.   00270099
002800*  - SVKRP037-1  AGING REPORT IN DOLLARS (RPT01).                 00280099
003000*                                                                 00300000
003100*  THE REPORT IS BROKEN INTO KCK, KMRC, AND ALL OTHER CARDS       00310099
003400*                                                                 00340000
003410*  THE INPUT CARD DATE FILE (INP02) CONTAINS A FISCAL MONTH BEGIN 00341099
003420*  DATE, WHICH WILL BE USED TO DETERMINE THE FIRST FISCAL PERIOD  00342099
003430*  TO BE USED FOR THE REPORTS.                                    00343099
003440*                                                                 00344099
003500*  THE INPUT CARD DATE FILE (INP03) CONTAINS A FISCAL MONTH END   00350099
003600*  DATE, WHICH WILL BE USED TO DETERMINE THE LAST FISCAL PERIOD   00360000
003700*  TO BE USED FOR THE REPORTS.                                    00370000
003800*                                                                 00380000
003900******************************************************************00390099
015900 ENVIRONMENT DIVISION.                                            01590000
016000***************************************************************** 01600000
016100                                                                  01610000
016200 CONFIGURATION SECTION.                                           01620000
016300                                                                  01630000
016400 SOURCE-COMPUTER.        IBM-3090.                                01640000
016500 OBJECT-COMPUTER.        IBM-3090.                                01650000
016600                                                                  01660000
016700 INPUT-OUTPUT SECTION.                                            01670000
016800                                                                  01680000
016900 FILE-CONTROL.                                                    01690000
017000                                                                  01700000
017100     SELECT ACTIVITY-FILE                                         01710000
017200         ASSIGN TO INP01.                                         01720000
017300                                                                  01730000
017400     SELECT DATE-BEG-FILE                                         01740099
017500         ASSIGN TO INP02.                                         01750000
017600                                                                  01760000
017700     SELECT DATE-END-FILE                                         01770099
017800         ASSIGN TO INP03.                                         01780099
017900                                                                  01790099
018300     SELECT DOLLAR-REPORT-FILE                                    01830000
018400         ASSIGN TO RPT01.                                         01840000
018500                                                                  01850000
018900******************************************************************01890000
019000 DATA DIVISION.                                                   01900000
019100******************************************************************01910000
019200                                                                  01920000
019300 FILE SECTION.                                                    01930000
019400                                                                  01940000
019500 FD  ACTIVITY-FILE                                                01950000
019600     RECORDING MODE IS F                                          01960000
019700     LABEL RECORDS ARE STANDARD                                   01970000
019800     BLOCK CONTAINS 0 RECORDS.                                    01980000
019900                                                                  01990000
020000 01  ACTIVITY-RECORD                 PIC  X(125).                 02000099
020100                                                                  02010000
020200 FD  DATE-BEG-FILE                                                02020099
020300     RECORDING MODE IS F                                          02030000
020400     BLOCK CONTAINS 0 RECORDS                                     02040000
020500     LABEL RECORDS ARE STANDARD.                                  02050000
020600                                                                  02060000
020700 01  DATE-BEG-RECORD                 PIC X(80).                   02070099
020800                                                                  02080000
020900 FD  DATE-END-FILE                                                02090099
021000     RECORDING MODE IS F                                          02100099
021100     BLOCK CONTAINS 0 RECORDS                                     02110099
021200     LABEL RECORDS ARE STANDARD.                                  02120099
021300                                                                  02130099
021400 01  DATE-END-RECORD                 PIC X(80).                   02140099
021500                                                                  02150099
022300 FD  DOLLAR-REPORT-FILE                                           02230000
022400     RECORDING MODE IS F                                          02240000
022500     BLOCK CONTAINS 0  RECORDS.                                   02250000
022600                                                                  02260000
022700 01  DOLLAR-REPORT-RECORD            PIC  X(200).                 02270099
022800                                                                  02280000
023500******************************************************************02350000
023600 WORKING-STORAGE SECTION.                                         02360000
023700******************************************************************02370000
024100******************************************************************02410099
024200* RECORD LAYOUT FOR INPUT ACTIVITY FILE                           02420099
024300******************************************************************02430099
024400     COPY SVRD036.                                                02440099
024900******************************************************************02490099
025000* RECORD LAYOUT FOR INPUT DATE CARD                               02500099
025100******************************************************************02510099
025200  01  CC-CONTROL-CARD.                                            02520099
025300      05  FILLER                       PIC X(01)  VALUE SPACE.    02530099
025400      05  CC-MONTH-END-CCYY-MM-DD      PIC X(10)  VALUE SPACES.   02540000
025500      05  FILLER                       PIC X(69)  VALUE SPACES.   02550099
027000                                                                  02700000
027010******************************************************************02701099
027020*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             02702099
027030******************************************************************02703099
027040     COPY DPWS500.                                                02704099
027050                                                                  02705099
027100 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      02710000
027200                                                  COMP.           02720099
027300     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    02730000
027400     88  AC-TABLE-OVERFLOW-ERROR                  VALUE +4004.    02740000
027500     88  AC-DATASET-DATA-ERROR                    VALUE +4008.    02750000
027600     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    02760099
027700                                                                  02770000
027800 01  PS-PROGRAM-SWITCHES.                                         02780000
027900     05  PS-END-OF-ACTVY-FILE-SW       PIC X(01)  VALUE 'N'.      02790000
028000         88  PS-END-OF-ACTVY-FILE                 VALUE 'Y'.      02800000
028100     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      02810000
028200         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      02820000
028900     05  PS-TABLE-2-DATE-FOUND-SW      PIC X(01)  VALUE 'N'.      02890000
029000         88  PS-TABLE-2-DATE-FOUND                VALUE 'Y'.      02900000
029100         88  PS-TABLE-2-DATE-NOT-FOUND            VALUE 'N'.      02910000
030400     05  PS-END-OF-FISCAL-DATE-CSR-SW  PIC X(01)  VALUE 'N'.      03040099
030500         88  PS-END-OF-FISCAL-DATE-CSR            VALUE 'Y'.      03050099
030600         88  PS-NOT-END-OF-FISCAL-DATE-CSR        VALUE 'N'.      03060099
031300                                                                  03130099
031400 01  PC-CONSTANTS.                                                03140000
031500     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +73.     03150094
031600     05  PC-TABLE-LIMIT              PIC S9(04)    VALUE +999.    03160099
031700     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          03170000
031800                                                   'SVKRP037'.    03180099
031900     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       03190000
032300     05  PC-GIFT-CARDS-DESC          PIC  X(36)    VALUE          03230070
032400         'ALL GIFT CARDS EXCEPT KCK'.                             03240070
032410     05  PC-KCK-CARD-DESC            PIC  X(36)    VALUE          03241099
032420         'KCK - KOHLS CARES FOR KIDS'.                            03242099
032430     05  PC-KMRC-CARD-DESC           PIC  X(36)    VALUE          03243099
032440         'KMRC - MERCHANDISE RETURN CREDIT'.                      03244099
032500     05  PC-H2-DESC-DOLLARS          PIC  X(07)    VALUE          03250000
032600         'DOLLARS'.                                               03260000
033100     05  PC-H4-DESC-2-DOLLARS        PIC  X(08)    VALUE          03310000
033200         ' DOLLARS'.                                              03320000
034100                                                                  03410000
034200 01  PV-MISC-COUNT-FIELDS.                                        03420000
034300     05  PV-SVKRP037-1-PAGE-CNT      PIC S9(04)    VALUE ZERO     03430099
034400                                                   COMP-3.        03440000
034500     05  PV-SVKRP037-1-LINE-CNT      PIC S9(04)    VALUE ZERO     03450099
034600                                                   COMP.          03460099
037200******************************************************************03720000
037300*  FIELDS TO HOLD TOTALS FOR PRINTING A REPORT TOTAL LINE.        03730000
037400******************************************************************03740000
037500 01  PV-TOT-ACCUM-FIELDS.                                         03750000
037600     05  PV-TOT-DLR-ISSUED           PIC S9(11)V99 COMP-3         03760000
037700                                                   VALUE ZERO.    03770000
040200     05  PV-TOT-MO-DATA              OCCURS 12 TIMES              04020099
040300                                     INDEXED BY PV-TOT-IDX.       04030000
040400         10  PV-TOT-DLR-MO-QTY       PIC S9(09)V99 COMP-3         04040000
040500                                                   VALUE ZERO.    04050000
041200                                                                  04120000
048500******************************************************************04850094
048600*  FIELDS TO HOLD GRAND TOTAL FOR ALL CARDS.                     *04860094
048700******************************************************************04870094
048800 01  PV-GT-TOT-ACCUM-FIELDS.                                      04880094
048900     05  PV-GT-TOT-DLR-ISSUED        PIC S9(11)V99 COMP-3         04890099
049000                                                   VALUE ZERO.    04900094
049100     05  PV-GT-TOT-MO-DATA           OCCURS 12 TIMES              04910099
049200                                     INDEXED BY PV-GT-TOT-IDX.    04920094
049300         10  PV-GT-TOT-DLR-MO        PIC S9(09)V99 COMP-3         04930094
049400                                                   VALUE ZERO.    04940094
053300                                                                  05330000
053400******************************************************************05340000
053500*  FIELDS USED TO DETERMINE CONTROL BREAKS.                       05350000
053600******************************************************************05360000
053700 01  PV-SAVE-FIELDS.                                              05370000
054000     05  PV-SAVE-ISSUE-DATE          PIC X(10)     VALUE SPACE.   05400000
054200     05  PV-SAVE-FST-DATE            PIC X(10)     VALUE SPACE.   05420065
054300     05  PV-SAVE-LST-DATE            PIC X(10)     VALUE SPACE.   05430065
055100     05  PV-SAVE-LST-ACTVY-DTE       PIC X(10)     VALUE SPACE.   05510000
056400                                                                  05640000
056500 01  PV-MISC-FIELDS.                                              05650000
056600     05  PV-PRINT-RECORD             PIC X(200)    VALUE SPACE.   05660099
056700     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     05670000
056800                                                   COMP.          05680099
056900     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   05690000
057000     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   05700000
057100     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   05710000
057200     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACE.   05720080
058100     05  PV-TB2-IDX                  PIC S9(04)    VALUE ZERO     05810099
058200                                                   COMP.          05820099
058300                                                                  05830000
058400 01  PV-DATE-AND-TIME-FIELDS.                                     05840000
059100*****  REUSEABLE DATE WORK FIELD IN CCYY-MM-DD FORMAT.            05910000
059200     05  PV-WORK-CCYY-MM-DD          PIC X(10)     VALUE SPACE.   05920000
060500*****  FIELDS FOR REPORT HEADINGS.                                06050000
060600     05  PV-CURR-DATE-CCYYMMDD.                                   06060000
060700         10  PV-CURR-DATE-CCYY       PIC  9(04).                  06070000
060800         10  PV-CURR-DATE-MM         PIC  9(02).                  06080000
060900         10  PV-CURR-DATE-DD         PIC  9(02).                  06090000
061000     05  PV-CURR-TIME.                                            06100000
061100         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    06110000
061200         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    06120000
061300         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    06130000
061310     05  PV-BEG-DATE                 PIC  X(10)    VALUE SPACE.   06131099
061320     05  PV-END-DATE                 PIC  X(10)    VALUE SPACE.   06132099
061330     05  FILLER REDEFINES PV-END-DATE.                            06133099
061340         10  PV-END-CCYY             PIC  X(04).                  06134099
061350         10  FILLER                  PIC  X(01).                  06135099
061360         10  PV-END-MM               PIC  X(02).                  06136099
061370         10  FILLER                  PIC  X(01).                  06137099
061380         10  PV-END-DD               PIC  X(02).                  06138099
061400                                                                  06140000
061500******************************************************************06150000
061600*  TOP OF PAGE HEADING LINE FOR PRINTING A 200 CHARACTER REPORT.  06160099
061700******************************************************************06170000
061800     COPY DPWS200.                                                06180099
061900                                                                  06190000
062000******************************************************************06200000
062100*  HEADING LINES FOR THE STORED VALUE AGING REPORTS.              06210099
062200******************************************************************06220000
062300 01  H2-HEADING-LINE-2.                                           06230000
062400     05  FILLER                      PIC  X(67)   VALUE SPACE.    06240099
062500     05  FILLER                      PIC  X(41)    VALUE          06250099
062600        'STORED VALUE MONTHLY ACTIVITY REPORT FOR '.              06260099
062700     05  H2-MONTH                    PIC  X(09)    VALUE SPACE.   06270000
062820     05  FILLER                      PIC  X(01)    VALUE SPACE.   06282099
062900     05  H2-YEAR                     PIC  X(04)    VALUE SPACE.   06290000
063200     05  FILLER                      PIC  X(78)   VALUE SPACE.    06320099
063300                                                                  06330000
063400 01  H3-HEADING-LINE-3.                                           06340000
063500     05  FILLER                      PIC  X(18)    VALUE          06350000
063600        'CARD STOCK TYPE:  '.                                     06360000
063700     05  H3-CRD-STK-DESC             PIC  X(36)    VALUE SPACE.   06370000
063800     05  FILLER                      PIC  X(146)   VALUE SPACE.   06380099
063900                                                                  06390000
064000 01  H4-HEADING-LINE-4.                                           06400000
064100     05  FILLER                      PIC  X(16)    VALUE          06410000
064200        'MONTH/YR        '.                                       06420000
064300     05  H4-RPT-DESC-1               PIC  X(07)    VALUE SPACE.   06430000
064400     05  FILLER                      PIC  X(06)    VALUE SPACE.   06440000
064500     05  FILLER                      PIC  X(77)    VALUE ALL '-'. 06450099
064600     05  H4-RPT-DESC-2               PIC  X(08)    VALUE SPACE.   06460000
064700     05  FILLER                      PIC  X(10)    VALUE          06470000
064800        ' TENDERED '.                                             06480000
064900     05  FILLER                      PIC  X(76)    VALUE ALL '-'. 06490099
066300                                                                  06630000
066400 01  H5-HEADING-LINE-5.                                           06640000
066500     05  FILLER                      PIC  X(28)    VALUE          06650099
066600        ' ISSUED          ISSUED    '.                            06660099
066700     05  H5-MO-DATA                  PIC  X(172)   VALUE SPACE.   06670099
068200                                                                  06820000
068300******************************************************************06830000
068400*  DETAIL LINE FOR DOLLARS STORED VALUE AGING REPORT.             06840000
068500******************************************************************06850000
068600 01  DL1-DETAIL-LINE-1.                                           06860000
068700     05  DL1-MO-1                    PIC  X(03)    VALUE SPACE.   06870000
069000     05  FILLER                      PIC  X(01)    VALUE '-'.     06900099
069010     05  DL1-YR-1                    PIC  X(04)    VALUE SPACE.   06901099
069020     05  FILLER                      PIC  X(03)    VALUE SPACE.   06902099
069100     05  DL1-ISSUED-QTY-1            PIC  Z,ZZZ,ZZZ,ZZ9.99        06910099
069200                                                   VALUE ZERO.    06920000
069300     05  FILLER                      PIC  X(01)    VALUE SPACE.   06930099
069700     05  DL1-MO-DATA-1               PIC  X(172)   VALUE SPACE.   06970099
069800                                                                  06980099
077200******************************************************************07720000
077300*  TOTAL LINE FOR DOLLARS STORED VALUE AGING REPORT.              07730000
077400******************************************************************07740000
077500 01  TL1-TOTAL-LINE-1.                                            07750000
077600     05  TL1-TOT-DESC                PIC  X(11)    VALUE SPACE.   07760099
077700     05  TL1-ISSUED-QTY-1            PIC  Z,ZZZ,ZZZ,ZZ9.99        07770000
077800                                                   VALUE ZERO.    07780000
078100     05  FILLER                      PIC  X(01)    VALUE SPACE.   07810000
078500     05  TL1-MO-DATA-1               PIC  X(172)   VALUE SPACE.   07850099
086300******************************************************************08630000
086400*  TABLE TO PRINT 12 DOLLAR COLUMNS OF MONTHLY DATA ON A DETAIL   08640099
086500*  TOTAL LINE.                                                    08650000
086600******************************************************************08660000
086700 01  PL-PRINT-LINE-TABLE.                                         08670000
086800     05  PL-PRINT-LINE-ENTRY         OCCURS 12 TIMES              08680099
086900                                     INDEXED BY PL-IDX.           08690000
087000         10  PL-MO-QTY               PIC  ZZ,ZZZ,ZZ9.99           08700099
087100                                                   VALUE ZERO.    08710000
087200         10  FILLER                  PIC  X(01)    VALUE SPACE.   08720000
087300                                                                  08730000
088500******************************************************************08850000
088600*  TABLE TO PRINT 12 COLUMNS OF MONTHLY HEADINGS ON A HEADING LINE08860099
088700******************************************************************08870000
088800 01  HL-HEADING-LINE-TABLE.                                       08880000
088900     05  HL-HEADING-LINE-ENTRY       OCCURS 12 TIMES              08890099
089000                                     INDEXED BY HL-IDX.           08900000
089100         10  FILLER                  PIC  X(04)    VALUE SPACE.   08910099
089200         10  HL-MO-ABBR              PIC  X(03)    VALUE SPACE.   08920000
089210         10  FILLER                  PIC  X(01)    VALUE '-'.     08921099
089510         10  HL-CCYY                 PIC  X(04)    VALUE SPACE.   08951099
089520         10  FILLER                  PIC  X(02)    VALUE SPACE.   08952099
089600                                                                  08960000
089700******************************************************************08970000
089800*  UNDER LINES FOR DOLLAR STORED VALUE AGING REPORT.              08980000
089900******************************************************************08990000
090000 01  UL-UNDER-LINE.                                               09000000
090100     05  FILLER                      PIC  X(11)    VALUE SPACE.   09010099
090200     05  FILLER                      PIC  X(16)    VALUE ALL '-'. 09020000
090300     05  FILLER                      PIC  X(01)    VALUE SPACE.   09030099
090600     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09060099
090700     05  FILLER                      PIC  X(01)    VALUE SPACE.   09070099
090800     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09080099
090900     05  FILLER                      PIC  X(01)    VALUE SPACE.   09090099
091000     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09100099
091100     05  FILLER                      PIC  X(01)    VALUE SPACE.   09110099
091200     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09120099
091300     05  FILLER                      PIC  X(01)    VALUE SPACE.   09130099
091400     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09140099
091500     05  FILLER                      PIC  X(01)    VALUE SPACE.   09150099
091600     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09160099
091700     05  FILLER                      PIC  X(01)    VALUE SPACE.   09170099
091800     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09180099
091900     05  FILLER                      PIC  X(01)    VALUE SPACE.   09190099
092000     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09200099
092100     05  FILLER                      PIC  X(01)    VALUE SPACE.   09210099
092200     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09220099
092300     05  FILLER                      PIC  X(01)    VALUE SPACE.   09230099
092400     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09240099
092500     05  FILLER                      PIC  X(01)    VALUE SPACE.   09250099
092600     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09260099
092610     05  FILLER                      PIC  X(01)    VALUE SPACE.   09261099
092620     05  FILLER                      PIC  X(13)    VALUE ALL '-'. 09262099
092800                                                                  09280099
095800******************************************************************09580000
095900*  BLANK LINE FOR THE STORED VALUE AGING REPORTS.                 09590099
096000******************************************************************09600000
096100 01  BL-BLANK-LINE.                                               09610000
096200     05  FILLER                      PIC  X(200)   VALUE SPACE.   09620099
096300                                                                  09630000
096400******************************************************************09640000
096500*  COPYBOOK OF MERCHANDISE CARD CONSTANTS                         09650000
096600******************************************************************09660000
096700     COPY SVWS004.                                                09670091
096800******************************************************************09680000
096900* TABLE TO HOLD DATA FOR ALL CARDS EXCEPT KCK.                    09690099
097000******************************************************************09700000
097100 01  TB1-PART-1-TABLE.                                            09710099
097200     05  TB1-PART-1-ENTRY            OCCURS 999 TIMES.            09720099
097500         10  TB1-FISCAL-CCYY     PIC 9(04).                       09750099
097700         10  TB1-FISCAL-PER-ABBR     PIC X(03)     VALUE SPACE.   09770000
097720         10  TB1-FISCAL-FST-DATE     PIC X(10)     VALUE SPACE.   09772099
097730         10  TB1-FISCAL-LST-DATE     PIC X(10)     VALUE SPACE.   09773099
097740         10  TB1-DLR-ISSUED          PIC S9(10)V99 COMP-3         09774099
097750                                                   VALUE ZERO.    09775099
100400         10  TB1-MO-DATA             OCCURS 12 TIMES              10040099
100500                                     INDEXED BY TB1-M-IDX.        10050000
100600             15  TB1-DLR-MO-QTY      PIC S9(08)V99 COMP-3         10060099
100700                                                   VALUE ZERO.    10070000
101400******************************************************************10140000
101500* TABLE TO HOLD KCK DATA.                                         10150099
101600******************************************************************10160000
101700 01  TB2-PART-2-TABLE.                                            10170000
101800     05  TB2-PART-2-ENTRY            OCCURS 999 TIMES.            10180099
102100         10  TB2-FISCAL-CCYY         PIC 9(04).                   10210099
102300         10  TB2-FISCAL-PER-ABBR     PIC X(03)     VALUE SPACE.   10230000
102400         10  TB2-FISCAL-FST-DATE     PIC X(10)     VALUE SPACE.   10240000
102500         10  TB2-FISCAL-LST-DATE     PIC X(10)     VALUE SPACE.   10250000
102600         10  TB2-DLR-ISSUED          PIC S9(10)V99 COMP-3         10260099
102700                                                   VALUE ZERO.    10270000
105200         10  TB2-MO-DATA             OCCURS 12 TIMES              10520099
105300                                     INDEXED BY TB2-M-IDX.        10530000
105400             15  TB2-DLR-MO-QTY      PIC S9(08)V99 COMP-3         10540099
105500                                                   VALUE ZERO.    10550000
105600******************************************************************10560099
105700* TABLE TO HOLD KMRC DATA.                                        10570099
105800******************************************************************10580099
105900 01  TB3-PART-3-TABLE.                                            10590099
106000     05  TB3-PART-3-ENTRY            OCCURS 999 TIMES.            10600099
106120         10  TB3-FISCAL-CCYY     PIC 9(04).                       10612099
106150         10  TB3-FISCAL-PER-ABBR     PIC X(03)     VALUE SPACE.   10615099
106170         10  TB3-FISCAL-FST-DATE     PIC X(10)     VALUE SPACE.   10617099
106180         10  TB3-FISCAL-LST-DATE     PIC X(10)     VALUE SPACE.   10618099
106190         10  TB3-DLR-ISSUED          PIC S9(10)V99 COMP-3         10619099
106191                                                   VALUE ZERO.    10619199
106194         10  TB3-MO-DATA             OCCURS 12 TIMES              10619499
106195                                     INDEXED BY TB3-M-IDX.        10619599
106196             15  TB3-DLR-MO-QTY      PIC S9(08)V99 COMP-3         10619699
106197                                                   VALUE ZERO.    10619799
106200 01  TB2-TABLE-CONTROLS.                                          10620000
106300     05  TB2-NBR-ENTRIES             PIC S9(4)     VALUE ZERO     10630099
106400                                                   COMP.          10640099
106500******************************************************************10650000
106600* TABLE TO HOLD RANGE OF FISCAL DATES TO BE SHOWN ON REPORTS.     10660000
106700******************************************************************10670000
106800 01  TB3-FISCAL-DATE-TABLE.                                       10680000
106900     05  TB3-FISCAL-DATE-ENTRY       OCCURS 12 TIMES              10690099
107000                                     INDEXED BY TB3-IDX.          10700000
107100         10  TB3-FIRST-DATE          PIC X(10)     VALUE SPACE.   10710000
107200         10  TB3-LAST-DATE           PIC X(10)     VALUE SPACE.   10720000
107300                                                                  10730000
112200******************************************************************11220099
112300* STANDARD DB2 ERROR HANDLING AREA                                11230099
112400******************************************************************11240099
112500     COPY DPWS004.                                                11250099
112600                                                                  11260099
112700******************************************************************11270099
112800*    STANDARD LAYOUT FOR THE SQL COMMUNICATIONS AREA             *11280099
112900******************************************************************11290099
113000     EXEC SQL                                                     11300099
113100          INCLUDE SQLCA                                           11310099
113200     END-EXEC.                                                    11320099
113300                                                                  11330099
113500******************************************************************11350099
113600*    DB2 TABLE DB2PDBA.TDTATTR                                   *11360099
113700*              - MAIN DATE TABLE (TDTATTR)                       *11370099
113800******************************************************************11380099
113900     EXEC SQL                                                     11390099
114000          INCLUDE TDTATTR                                         11400099
114100     END-EXEC.                                                    11410099
116000******************************************************************11600099
116100*    CURSOR TO EXTRACT ALL FISCAL MONTHS FOR THE DEFINED DATES   *11610099
116200******************************************************************11620099
116300     EXEC SQL                                                     11630099
116400        DECLARE FISCAL-DATE-CSR CURSOR FOR                        11640099
116500            SELECT DISTINCT FSCL_MN_BEG_DTE,                      11650099
116600                            FSCL_MN_END_DTE,                      11660099
116700                            FSCL_MN_NM                            11670099
116900              FROM TDTATTR                                        11690099
116910             WHERE KY_DTE >= :PV-BEG-DATE                         11691099
116920               AND KY_DTE <= :PV-END-DATE                         11692099
117000              WITH UR                                             11700099
117010     END-EXEC.                                                    11701099
117100                                                                  11710099
117200***************************************************************** 11720099
117300* PROCEDURE DIVISION.                                           * 11730000
117400***************************************************************** 11740000
117500 PROCEDURE DIVISION.                                              11750000
117600                                                                  11760000
117700 0000-MAINLINE-PROCESSING.                                        11770000
117800                                                                  11780000
117900     PERFORM 1000-INITIALIZE-PROGRAM.                             11790000
118000     PERFORM 2000-PRODUCE-MONTHLY-REPORT.                         11800099
118300                                                                  11830000
120400     CLOSE ACTIVITY-FILE                                          12040000
120700           DOLLAR-REPORT-FILE.                                    12070099
120900                                                                  12090000
121000     STOP RUN.                                                    12100000
121100                                                                  12110000
121200******************************************************************12120000
121300* 1000-INITIALIZE-PROGRAM                                         12130000
121400* OPEN FILES, GET CONTROL CARD, FORMAT GLOBAL REPORT HEADINGS.    12140000
121600******************************************************************12160000
121700 1000-INITIALIZE-PROGRAM.                                         12170000
121800                                                                  12180000
121900     OPEN INPUT  DATE-BEG-FILE                                    12190099
121910                 DATE-END-FILE                                    12191099
122000                 ACTIVITY-FILE                                    12200099
122300          OUTPUT DOLLAR-REPORT-FILE.                              12230099
122500                                                                  12250000
122600     PERFORM 1100-PROCESS-CONTROL-CARD.                           12260000
122700     PERFORM 1200-GET-FISCAL-PERIOD-RANGE.                        12270000
122800     PERFORM 1300-FORMAT-FISCAL-HEADINGS.                         12280000
122900     PERFORM 1400-FORMAT-DATE-TIME-HEADING.                       12290000
123000                                                                  12300099
123100******************************************************************12310000
123200* 1100-PROCESS-CONTROL-CARD                                       12320000
123300* READ DATE CONTROL CARDS FOR FISCAL START AND END DATES.         12330099
123500******************************************************************12350000
123600 1100-PROCESS-CONTROL-CARD.                                       12360000
123700                                                                  12370000
123800     PERFORM 1110-READ-DATE-BEG-FILE.                             12380099
123900     CLOSE DATE-BEG-FILE.                                         12390099
124000     IF PS-END-OF-CARD-FILE                                       12400000
124100         MOVE '1110-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   12410099
124200         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  12420000
124300         SET AC-CONTROL-CARD-ERROR TO TRUE                        12430000
124400         PERFORM 9999-ABEND                                       12440000
124500     END-IF.                                                      12450000
124600                                                                  12460000
124610     MOVE CC-MONTH-END-CCYY-MM-DD TO PV-BEG-DATE.                 12461099
124620                                                                  12462099
124700     PERFORM 1120-READ-DATE-END-FILE.                             12470099
124800     CLOSE DATE-END-FILE.                                         12480099
124810     IF PS-END-OF-CARD-FILE                                       12481099
124820         MOVE '1120-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   12482099
124830         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  12483099
124840         SET AC-CONTROL-CARD-ERROR TO TRUE                        12484099
124850         PERFORM 9999-ABEND                                       12485099
124860     END-IF.                                                      12486099
124870                                                                  12487099
124881     MOVE CC-MONTH-END-CCYY-MM-DD TO PV-WORK-CCYY-MM-DD           12488199
124882                                     PV-END-DATE.                 12488299
124890                                                                  12489099
124900     DISPLAY 'SVKRP037 CONTROL CARD DATE = ' PV-WORK-CCYY-MM-DD.  12490099
124910     PERFORM 1500-GET-FISCAL-445-DATES.                           12491099
125000                                                                  12500099
125001     MOVE DPG56-FISCAL-YEAR-CCYY       TO H2-YEAR.                12500199
125010     MOVE DPG56-FISCAL-PERIOD-NAME     TO H2-MONTH.               12501099
125600                                                                  12560000
126400******************************************************************12640000
126500* 1110-READ-DATE-BEG-FILE                                         12650099
126600* READ DATE CONTROL CARD.                                         12660000
126700******************************************************************12670000
126800 1110-READ-DATE-BEG-FILE.                                         12680099
126900     READ DATE-BEG-FILE INTO CC-CONTROL-CARD                      12690099
127000        AT END                                                    12700000
127100           SET PS-END-OF-CARD-FILE TO TRUE.                       12710000
127200                                                                  12720000
127210******************************************************************12721099
127220* 1120-READ-DATE-END-FILE                                         12722099
127230* READ DATE CONTROL CARD.                                         12723099
127240******************************************************************12724099
127250 1120-READ-DATE-END-FILE.                                         12725099
127251                                                                  12725199
127252     INITIALIZE CC-CONTROL-CARD.                                  12725299
127260     READ DATE-END-FILE INTO CC-CONTROL-CARD                      12726099
127270        AT END                                                    12727099
127280           SET PS-END-OF-CARD-FILE TO TRUE.                       12728099
127290                                                                  12729099
127300******************************************************************12730000
127400* 1200-GET-FISCAL-PERIOD-RANGE                                    12740000
127500* LOAD THE RANGE OF DATE KEYS INTO DATA TABLES.                   12750099
127700* THE RANGE BEGINS WITH THE FISCAL DATE DERIVED FROM THE          12770099
127800* INPUT CONTROL CARD (INP02) AND ENDS WITH THE FISCAL DATE DERIVED12780099
127900* FROM THE INPUT CONTROL CARD DATE (INP03).                       12790099
128000******************************************************************12800000
128100 1200-GET-FISCAL-PERIOD-RANGE.                                    12810000
128200                                                                  12820000
128310     PERFORM 1610-OPEN-FISCAL-DATE-CSR.                           12831099
128320     PERFORM 1650-FETCH-FISCAL-DATE-CSR.                          12832099
128330                                                                  12833099
128400     PERFORM 1210-LOAD-TABLE-2-ENTRY                              12840000
128500     VARYING PV-TB2-IDX FROM +1 BY +1                             12850099
128600       UNTIL PS-END-OF-FISCAL-DATE-CSR.                           12860099
128700                                                                  12870099
128710     PERFORM 1675-CLOSE-FISCAL-DATE-CSR.                          12871099
128720                                                                  12872099
128800******************************************************************12880000
128900* 1210-LOAD-TABLE-2-ENTRY                                         12890000
129000* TB2-NBR-ENTRIES HAS AN INITIAL VALUE OF +1.                     12900000
129100******************************************************************12910000
129200 1210-LOAD-TABLE-2-ENTRY.                                         12920000
129300                                                                  12930000
129400     ADD +1 TO TB2-NBR-ENTRIES.                                   12940099
129500                                                                  12950099
130000     IF TB2-NBR-ENTRIES > PC-TABLE-LIMIT                          13000099
130100         MOVE '1210-LOAD-TABLE-2-ENTRY ' TO PV-PARAGRAPH-NAME     13010099
130200         MOVE 'TABLE 2 EXCEEDED MAX NUMBER OF ENTRIES '           13020099
130300                                         TO PV-OPERATION-MSG-1    13030099
130400         SET AC-TABLE-OVERFLOW-ERROR     TO TRUE                  13040099
130500         PERFORM 9999-ABEND                                       13050099
130600     END-IF.                                                      13060099
130900                                                                  13090000
130910     MOVE DTATTR-FSCL-MN-END-DTE TO PV-WORK-CCYY-MM-DD.           13091099
130920     PERFORM 1500-GET-FISCAL-445-DATES.                           13092099
130930                                                                  13093099
131000     MOVE DPG56-FISCAL-YEAR-CCYY TO TB2-FISCAL-CCYY(PV-TB2-IDX)   13100099
131100                                    TB1-FISCAL-CCYY(PV-TB2-IDX)   13110099
131200                                    TB3-FISCAL-CCYY(PV-TB2-IDX).  13120099
131600     MOVE DTATTR-FSCL-MN-NM(1:3) TO                               13160099
131700                                 TB2-FISCAL-PER-ABBR(PV-TB2-IDX)  13170099
131800                                 TB1-FISCAL-PER-ABBR(PV-TB2-IDX)  13180099
131900                                 TB3-FISCAL-PER-ABBR(PV-TB2-IDX). 13190099
132000     MOVE DTATTR-FSCL-MN-BEG-DTE TO                               13200099
132100                                 TB2-FISCAL-FST-DATE(PV-TB2-IDX)  13210099
132200                                 TB1-FISCAL-FST-DATE(PV-TB2-IDX)  13220099
132210                                 TB3-FISCAL-FST-DATE(PV-TB2-IDX). 13221099
132300     MOVE DTATTR-FSCL-MN-END-DTE TO                               13230099
132400                                 TB2-FISCAL-LST-DATE(PV-TB2-IDX)  13240099
132500                                 TB1-FISCAL-LST-DATE(PV-TB2-IDX)  13250099
132510                                 TB3-FISCAL-LST-DATE(PV-TB2-IDX). 13251099
132600                                                                  13260070
132610                                                                  13261099
132620     PERFORM 1650-FETCH-FISCAL-DATE-CSR.                          13262099
132630                                                                  13263099
133100******************************************************************13310000
133200* 1300-FORMAT-FISCAL-HEADINGS                                     13320000
133300*    FORMAT H5-HEADING-LINE-5 MONTH AND YEAR DATA BY UNLOADING    13330099
133400*    FISCAL PERIOD ABBR AND FISCAL YEAR FROM THE LAST 12 TABLE 2  13340099
133500*    ENTRIES.                                                     13350000
133800******************************************************************13380000
133900 1300-FORMAT-FISCAL-HEADINGS.                                     13390000
134000                                                                  13400000
134100     MOVE TB2-NBR-ENTRIES TO PV-TB2-IDX.                          13410099
134110                                                                  13411099
134200     PERFORM                                                      13420000
134300     VARYING HL-IDX FROM +12 BY -1                                13430099
134400       UNTIL HL-IDX < +1                                          13440099
134500         SET TB3-IDX    TO HL-IDX                                 13450099
134600         MOVE TB2-FISCAL-PER-ABBR(PV-TB2-IDX) TO                  13460099
134700                                              HL-MO-ABBR(HL-IDX)  13470099
134820         MOVE TB2-FISCAL-CCYY(PV-TB2-IDX)     TO HL-CCYY(HL-IDX)  13482099
134900         MOVE TB2-FISCAL-FST-DATE(PV-TB2-IDX) TO                  13490099
135000                                           TB3-FIRST-DATE(TB3-IDX)13500099
135100         MOVE TB2-FISCAL-LST-DATE(PV-TB2-IDX) TO                  13510099
135200                                           TB3-LAST-DATE(TB3-IDX) 13520099
135300         COMPUTE PV-TB2-IDX = PV-TB2-IDX - 1                      13530099
135400     END-PERFORM.                                                 13540000
135500     MOVE HL-HEADING-LINE-TABLE               TO H5-MO-DATA.      13550099
135600                                                                  13560000
135700******************************************************************13570000
135800* 1400-FORMAT-DATE-TIME-HEADING                                   13580000
135900*    GET CURRENT DATE AND TIME FROM SYSTEM.                       13590000
136000*    FORMAT DATE AND TIME FIELDS IN THE TOP PAGE HEADING LINE     13600000
136100*    (USED BY BOTH REPORTS).                                      13610000
136200******************************************************************13620000
136300 1400-FORMAT-DATE-TIME-HEADING.                                   13630000
136400                                                                  13640000
136500     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   13650000
136600     ACCEPT PV-CURR-TIME FROM TIME.                               13660000
136700                                                                  13670000
136800     MOVE PV-CURR-DATE-MM             TO DP200-RUN-MONTH.         13680099
136900     MOVE PV-CURR-DATE-DD             TO DP200-RUN-DAY.           13690099
137000     MOVE PV-CURR-DATE-CCYY           TO DP200-RUN-YEAR.          13700099
137100                                                                  13710000
137200     MOVE PV-CURR-TIME-HH             TO DP200-RUN-HOUR.          13720099
137300     MOVE PV-CURR-TIME-MM             TO DP200-RUN-MINUTE.        13730099
137400     MOVE PC-CURRENT-PROGRAM-NAME     TO DP200-PROGRAM-NAME.      13740099
137500                                                                  13750000
137600******************************************************************13760099
137700* 1500-GET-FISCAL-445-DATES                                       13770099
137800* CALL KOHLS CALENDAR ROUTINE TO TAKE A DATE IN DB2 ISO FORMAT    13780099
137900* (CCYY-MM-DD) AND RETURN 4-4-5 (JAN - DEC) FISCAL DATE FIELDS.   13790099
138000******************************************************************13800099
138100 1500-GET-FISCAL-445-DATES.                                       13810099
138200                                                                  13820099
138300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              13830099
138400                                                                  13840099
138500     SET DPG51-FISCAL-JAN-DEC-F2       TO TRUE.                   13850099
138600     SET DPG51-DO-NOT-INCR-DECR-DATE   TO TRUE.                   13860099
138700     MOVE PV-WORK-CCYY-MM-DD           TO DPG52-LK-DATE-INPUT.    13870099
138800     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   13880099
138900                                                                  13890099
139000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    13900099
139100                                             DPG54 DPG55 DPG56.   13910099
139200     EVALUATE TRUE                                                13920099
139300         WHEN DPG54-SEVERE-ERROR                                  13930099
139400         WHEN DPG54-DATE-INVALID                                  13940099
139500             MOVE '1500-GET-FISCAL-445-DATES'                     13950099
139600                                           TO PV-PARAGRAPH-NAME   13960099
140600             MOVE DPG54-ERROR-MESSAGE      TO PV-OPERATION-MSG-2  14060099
140610             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                14061099
140700             PERFORM 9999-ABEND                                   14070099
140800     END-EVALUATE.                                                14080099
140900                                                                  14090099
146700******************************************************************14670099
146800*    OPEN THE TDTATTR CURSOR                                     *14680099
146900******************************************************************14690099
147000 1610-OPEN-FISCAL-DATE-CSR.                                       14700099
147100     EXEC SQL                                                     14710099
147200         OPEN FISCAL-DATE-CSR                                     14720099
147300     END-EXEC.                                                    14730099
147400                                                                  14740099
147500     EVALUATE TRUE                                                14750099
147600        WHEN SQLCODE = ZERO                                       14760099
147700             CONTINUE                                             14770099
147800        WHEN OTHER                                                14780099
147900             MOVE '1610-OPEN-FISCAL-DATE-CSR'                     14790099
148000                               TO PV-PARAGRAPH-NAME               14800099
148100             MOVE 'OPEN FISCAL DATE CURSOR - '                    14810099
148200                               TO PV-DB2-OPERATION-ATTEMPTED      14820099
148300             PERFORM 9999-SQL-ABEND                               14830099
148400     END-EVALUATE.                                                14840099
148500                                                                  14850099
150900******************************************************************15090099
151000*      1650-FETCH-FISCAL-DATE-CSR                                *15100099
151100* ==>  PROCESSES:                                                *15110099
151200*      - FETCH FROM THE TDTATTR TABLE.                           *15120099
151300******************************************************************15130099
151400 1650-FETCH-FISCAL-DATE-CSR.                                      15140099
151410                                                                  15141099
151500     EXEC SQL                                                     15150099
151600         FETCH FISCAL-DATE-CSR                                    15160099
151700          INTO :DTATTR-FSCL-MN-BEG-DTE,                           15170099
151800               :DTATTR-FSCL-MN-END-DTE,                           15180099
151900               :DTATTR-FSCL-MN-NM                                 15190099
152000     END-EXEC.                                                    15200099
152100                                                                  15210099
152200     EVALUATE SQLCODE                                             15220099
152300         WHEN ZERO                                                15230099
152400             CONTINUE                                             15240099
152500         WHEN +100                                                15250099
152700             SET PS-END-OF-FISCAL-DATE-CSR TO TRUE                15270099
152800         WHEN OTHER                                               15280099
152900             MOVE '1650-FETCH-FISCAL-DATE-CSR'                    15290099
153000                                    TO PV-PARAGRAPH-NAME          15300099
153100             MOVE 'FETCH FISAL DATE CURSOR - '                    15310099
153200                                    TO PV-DB2-OPERATION-ATTEMPTED 15320099
153300             PERFORM 9999-SQL-ABEND                               15330099
153400     END-EVALUATE.                                                15340099
153500                                                                  15350099
153600******************************************************************15360099
153700*      1675-CLOSE-FISCAL-DATE-CSR                                *15370099
153800* ==>  PROCESSES:                                                *15380099
153900*      - CLOSE THE TDTATTR CURSOR                                *15390099
154000******************************************************************15400099
154100 1675-CLOSE-FISCAL-DATE-CSR.                                      15410099
154110                                                                  15411099
154200     EXEC SQL                                                     15420099
154300         CLOSE FISCAL-DATE-CSR                                    15430099
154400     END-EXEC.                                                    15440099
154500                                                                  15450099
154600     EVALUATE TRUE                                                15460099
154700         WHEN SQLCODE = ZERO                                      15470099
154800             CONTINUE                                             15480099
154900         WHEN OTHER                                               15490099
155000             MOVE '1675-CLOSE-FISCAL-DATE-CSR'                    15500099
155100                                TO PV-PARAGRAPH-NAME              15510099
155200             MOVE 'CLOSE FISCAL DATE CURSOR - '                   15520099
155300                                TO PV-DB2-OPERATION-ATTEMPTED     15530099
155400             PERFORM 9999-SQL-ABEND                               15540099
155500     END-EVALUATE.                                                15550099
155600                                                                  15560099
155700******************************************************************15570000
155800* 2000-PRODUCE-MONTHLY-REPORT                                     15580099
155900******************************************************************15590000
156000 2000-PRODUCE-MONTHLY-REPORT.                                     15600099
156100                                                                  15610000
156200     PERFORM 2100-PREPARE-FOR-MNLY-REPORT.                        15620099
156300     PERFORM 2200-PROCESS-ACTIVITY-RECS                           15630000
156400       UNTIL PS-END-OF-ACTVY-FILE.                                15640000
156600                                                                  15660099
156610     PERFORM 2700-PRINT-ALL-REPORTS.                              15661099
157000     PERFORM 4700-PRINT-RPT-TOTAL-LINE.                           15700099
157200                                                                  15720000
157300******************************************************************15730000
157400* 2100-PREPARE-FOR-MNLY-REPORT.                                   15740099
157500*   DO PRIME READ OF ACTIVITY FILE, SET UP CONTROL BREAK FIELDS.  15750000
157600*   FIND THE TABLE 2 ENTRY WITH THE FISCAL PERIOD THE FIRST INPUT 15760000
157700*   RECORD WAS ISSUED.  SET THE 1ST ENTRY IN TABLE 1 TO POINT TO  15770000
157800*   FISCAL PERIOD FOUND IN TABLE 2.                               15780000
158000******************************************************************15800000
158100 2100-PREPARE-FOR-MNLY-REPORT.                                    15810099
158200                                                                  15820000
158300     PERFORM 7000-READ-ACTIVITY-FILE.                             15830000
158400     IF PS-END-OF-ACTVY-FILE                                      15840000
158500         MOVE '2100-PREPARE-FOR-MNLY-REPORT' TO PV-PARAGRAPH-NAME 15850099
158600         MOVE 'NO INPUT DATA TO PROCESS'   TO PV-OPERATION-MSG-1  15860000
158700         SET AC-DATASET-DATA-ERROR TO TRUE                        15870000
158800         PERFORM 9999-ABEND                                       15880000
158900     END-IF.                                                      15890000
159000                                                                  15900000
159400     MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-SAVE-ISSUE-DATE.      15940012
159900                                                                  15990099
160000     MOVE +1                          TO PV-TB2-IDX.              16000099
160010     IF PV-SAVE-ISSUE-DATE >= PV-BEG-DATE AND                     16001099
160020        PV-SAVE-ISSUE-DATE <= PV-END-DATE                         16002099
160100         PERFORM 6000-FIND-FISCAL-PERIOD                          16010099
160110     END-IF.                                                      16011099
160200                                                                  16020099
160900******************************************************************16090000
161000* 2200-PROCESS-ACTIVITY-RECS.                                     16100000
161100*  PROCESS THE STORED VALUE CARD ACTIVITY FILE.                   16110000
161200*  INPUT FILE IS SORTED IN FOLLOWING ORDER:                       16120000
161300*     CARD STOCK TYPE ID, CARD NUMBER, ISSUE DATE                 16130099
161400******************************************************************16140000
161500 2200-PROCESS-ACTIVITY-RECS.                                      16150000
161600                                                                  16160000
161610     IF PV-SAVE-ISSUE-DATE >= PV-BEG-DATE AND                     16161099
161620        PV-SAVE-ISSUE-DATE <= PV-END-DATE                         16162099
161900         MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-WORK-CCYY-MM-DD   16190099
162000         IF PV-WORK-CCYY-MM-DD >= PV-SAVE-FST-DATE AND            16200099
162100            PV-WORK-CCYY-MM-DD <= PV-SAVE-LST-DATE                16210099
162200             CONTINUE                                             16220099
162300         ELSE                                                     16230099
162400             PERFORM 2400-PROCESS-BREAK-ON-DATE                   16240099
162500         END-IF                                                   16250099
164100         PERFORM 2600-ACCUM-TOTALS                                16410099
164110     END-IF.                                                      16411099
164120                                                                  16412099
164200     PERFORM 7000-READ-ACTIVITY-FILE.                             16420000
164300                                                                  16430000
166900******************************************************************16690000
167000* 2400-PROCESS-BREAK-ON-DATE                                      16700000
167100*  PROCESS CONTROL BREAK ON ISSUE DATE:                           16710000
167500******************************************************************16750000
167600 2400-PROCESS-BREAK-ON-DATE.                                      16760000
167700                                                                  16770000
167800     MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-SAVE-ISSUE-DATE.      16780012
168000                                                                  16800099
168001     MOVE +1                          TO PV-TB2-IDX.              16800199
168030     PERFORM 6000-FIND-FISCAL-PERIOD.                             16803099
168200                                                                  16820000
172600******************************************************************17260000
172700* 2600-ACCUM-TOTALS.                                              17270000
172800*  ADD AMOUNTS FROM CURRENT INPUT REC TO RUNNING DOLLAR TOTALS    17280000
172900******************************************************************17290000
173000 2600-ACCUM-TOTALS.                                               17300000
173100                                                                  17310000
173200     EVALUATE TRUE                                                17320000
173300         WHEN SV036-ACTVY-TYP-CDE = SV004-TENDER-ACT-TYP-N        17330012
173900             PERFORM 2610-ACCUM-TENDER-TOTALS                     17390000
174100         WHEN SV036-ACTVY-TYP-CDE = SV004-SRV-FEE-ACT-TYP-N       17410012
174900             CONTINUE                                             17490099
175100         WHEN OTHER                                               17510000
175800             PERFORM 2650-ACCUM-ISSUE-TOTALS                      17580099
177600     END-EVALUATE.                                                17760000
177700                                                                  17770005
177800******************************************************************17780000
177900* 2610-ACCUM-TENDER-TOTALS                                        17790000
178000*  ADD AMOUNTS FROM CURRENT INPUT REC TO RUNNING DOLLAR TOTALS    17800000
178100******************************************************************17810000
178200 2610-ACCUM-TENDER-TOTALS.                                        17820000
178300                                                                  17830099
178400     MOVE SV036-TENDER-TIMESTAMP(1:10) TO PV-SAVE-LST-ACTVY-DTE.  17840012
178410                                                                  17841099
178500     PERFORM                                                      17850000
178600     VARYING TB1-M-IDX FROM +1 BY +1                              17860099
178700       UNTIL TB1-M-IDX > +12                                      17870099
178800         SET TB2-M-IDX TO TB1-M-IDX                               17880000
178810         SET TB3-M-IDX TO TB1-M-IDX                               17881099
178820         SET TB3-IDX   TO TB1-M-IDX                               17882099
179400         IF  PV-SAVE-LST-ACTVY-DTE >= TB3-FIRST-DATE(TB3-IDX)     17940000
179500         AND PV-SAVE-LST-ACTVY-DTE <= TB3-LAST-DATE(TB3-IDX)      17950000
179600             PERFORM 2615-ACCUM-MONTHLY-TOTALS                    17960099
180200         END-IF                                                   18020000
180300     END-PERFORM.                                                 18030000
180400                                                                  18040000
180500******************************************************************18050000
180600* 2615-ACCUM-MONTHLY-TOTALS                                       18060099
180700*  ADD AMOUNTS FROM CURRENT INPUT REC TO TABLED MONTHLY TOTALS    18070099
180800******************************************************************18080000
180900 2615-ACCUM-MONTHLY-TOTALS.                                       18090099
181000                                                                  18100000
181100     IF SV036-ACTVY-TYP-CDE = SV004-SRV-FEE-ACT-TYP-N             18110099
181200         CONTINUE                                                 18120099
181300     ELSE                                                         18130099
181400         IF SV036-CRD-TYP-CDE = 2                                 18140099
181500             IF SV036-CRD-STK-TYP-ID = 'KCK'                      18150099
181600                 ADD SV036-APP-AUTH-AMT TO                        18160099
181700                            TB2-DLR-MO-QTY(PV-TB2-IDX, TB2-M-IDX) 18170099
181800             ELSE                                                 18180099
184500                 ADD SV036-APP-AUTH-AMT TO                        18450099
184600                            TB1-DLR-MO-QTY(PV-TB2-IDX, TB1-M-IDX) 18460099
184700             END-IF                                               18470099
184800         ELSE                                                     18480099
187700             ADD SV036-APP-AUTH-AMT TO                            18770099
187800                            TB3-DLR-MO-QTY(PV-TB2-IDX, TB3-M-IDX) 18780099
188000         END-IF                                                   18800099
188100     END-IF.                                                      18810099
188300                                                                  18830000
195000***************************************************************** 19500099
195100* 2650-ACCUM-ISSUE-TOTALS                                       * 19510099
195200* ACCUMULATE ISSUE TOTALS                                       * 19520099
195300***************************************************************** 19530099
195400 2650-ACCUM-ISSUE-TOTALS.                                         19540099
195500                                                                  19550099
195600     IF SV036-CRD-TYP-CDE = 2                                     19560099
195700         IF SV036-CRD-STK-TYP-ID = 'KCK'                          19570099
195800             ADD SV036-APP-AUTH-AMT TO TB2-DLR-ISSUED(PV-TB2-IDX) 19580099
196000         ELSE                                                     19600099
196100             ADD SV036-APP-AUTH-AMT TO TB1-DLR-ISSUED(PV-TB2-IDX) 19610099
196300         END-IF                                                   19630099
196400     ELSE                                                         19640099
196500         ADD SV036-APP-AUTH-AMT TO TB3-DLR-ISSUED(PV-TB2-IDX)     19650099
196700     END-IF.                                                      19670099
196800                                                                  19680099
196900***************************************************************** 19690099
197000* 2700-PRINT-ALL-REPORTS                                          19700099
197100****************************************************************  19710099
197200 2700-PRINT-ALL-REPORTS.                                          19720099
197300                                                                  19730099
197301     MOVE SPACES             TO H3-CRD-STK-DESC.                  19730199
197302     MOVE PC-GIFT-CARDS-DESC TO H3-CRD-STK-DESC.                  19730299
197310     PERFORM 4000-FORMAT-RPT-HEADINGS.                            19731099
197320     PERFORM 8000-PRINT-RPT-HEADINGS.                             19732099
197330                                                                  19733099
197400     PERFORM 3000-PRINT-REPORT-DETAIL-1                           19740099
197500         VARYING PV-TB2-IDX FROM +1 BY +1                         19750099
197600         UNTIL PV-TB2-IDX > TB2-NBR-ENTRIES.                      19760099
197700                                                                  19770099
197701     PERFORM 5000-PRINT-CARD-STOCK-TOTALS.                        19770199
197702                                                                  19770299
197703     MOVE SPACES             TO H3-CRD-STK-DESC.                  19770399
197710     MOVE PC-KCK-CARD-DESC   TO H3-CRD-STK-DESC.                  19771099
197711     PERFORM 4000-FORMAT-RPT-HEADINGS.                            19771199
197712     PERFORM 8000-PRINT-RPT-HEADINGS.                             19771299
197720                                                                  19772099
197800     PERFORM 3100-PRINT-REPORT-DETAIL-2                           19780099
197900         VARYING PV-TB2-IDX FROM +1 BY +1                         19790099
198000         UNTIL PV-TB2-IDX > TB2-NBR-ENTRIES.                      19800099
198100                                                                  19810099
198101     PERFORM 5000-PRINT-CARD-STOCK-TOTALS.                        19810199
198102                                                                  19810299
198103     MOVE SPACES             TO H3-CRD-STK-DESC.                  19810399
198110     MOVE PC-KMRC-CARD-DESC  TO H3-CRD-STK-DESC.                  19811099
198111     PERFORM 4000-FORMAT-RPT-HEADINGS.                            19811199
198112     PERFORM 8000-PRINT-RPT-HEADINGS.                             19811299
198120                                                                  19812099
198200     PERFORM 3200-PRINT-REPORT-DETAIL-3                           19820099
198300         VARYING PV-TB2-IDX FROM +1 BY +1                         19830099
198400         UNTIL PV-TB2-IDX > TB2-NBR-ENTRIES.                      19840099
198500                                                                  19850099
198600     PERFORM 5000-PRINT-CARD-STOCK-TOTALS.                        19860099
198700                                                                  19870099
209000******************************************************************20900000
209100* 3000-PRINT-REPORT-DETAIL-1                                      20910099
209200*  PRINT A DETAIL LINE FOR PART 1 OF THE REPORT                   20920099
209400******************************************************************20940000
209500 3000-PRINT-REPORT-DETAIL-1.                                      20950099
209600                                                                  20960000
209700     IF (PV-SVKRP037-1-LINE-CNT + 2) > PC-LINE-LIMIT              20970099
209800         PERFORM 8000-PRINT-RPT-HEADINGS                          20980099
209900     END-IF.                                                      20990000
210000                                                                  21000000
210100     MOVE BL-BLANK-LINE     TO  PV-PRINT-RECORD.                  21010000
210200     MOVE +1                TO PV-LINE-SPACING.                   21020000
210300     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          21030099
210400                                                                  21040000
210500     MOVE TB1-FISCAL-PER-ABBR(PV-TB2-IDX) TO DL1-MO-1.            21050099
210600     MOVE TB1-FISCAL-CCYY(PV-TB2-IDX)     TO DL1-YR-1.            21060099
210700                                                                  21070000
211100     PERFORM                                                      21110000
211200       VARYING TB1-M-IDX FROM +1 BY +1                            21120000
211300       UNTIL TB1-M-IDX > +12                                      21130099
211400         SET PL-IDX       TO TB1-M-IDX                            21140000
211500         SET PV-TOT-IDX   TO TB1-M-IDX                            21150000
211600         ADD  TB1-DLR-MO-QTY (PV-TB2-IDX, TB1-M-IDX)              21160099
211700                                 TO PV-TOT-DLR-MO-QTY(PV-TOT-IDX) 21170000
211800         MOVE TB1-DLR-MO-QTY (PV-TB2-IDX, TB1-M-IDX)              21180099
211900                                       TO  PL-MO-QTY(PL-IDX)      21190000
212000     END-PERFORM.                                                 21200000
212100     MOVE PL-PRINT-LINE-TABLE          TO  DL1-MO-DATA-1          21210000
212200                                                                  21220000
212300     ADD  TB1-DLR-ISSUED(PV-TB2-IDX)   TO  PV-TOT-DLR-ISSUED.     21230099
212400     MOVE TB1-DLR-ISSUED(PV-TB2-IDX)   TO  DL1-ISSUED-QTY-1.      21240099
212600                                                                  21260000
216400     MOVE DL1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                  21640000
216500     MOVE +1                TO  PV-LINE-SPACING.                  21650000
216600     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          21660099
216700                                                                  21670000
216800******************************************************************21680099
216900* 3100-PRINT-REPORT-DETAIL-2                                      21690099
217000*  PRINT A DETAIL LINE FOR PART 2 OF THE REPORT                   21700099
217200******************************************************************21720099
217300 3100-PRINT-REPORT-DETAIL-2.                                      21730099
217400                                                                  21740099
217500     IF (PV-SVKRP037-1-LINE-CNT + 2) > PC-LINE-LIMIT              21750099
217600         PERFORM 8000-PRINT-RPT-HEADINGS                          21760099
217700     END-IF.                                                      21770099
217800                                                                  21780099
217900     MOVE BL-BLANK-LINE     TO  PV-PRINT-RECORD.                  21790099
218000     MOVE +1                TO PV-LINE-SPACING.                   21800099
218100     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          21810099
218200                                                                  21820099
218300     MOVE TB2-FISCAL-PER-ABBR(PV-TB2-IDX) TO DL1-MO-1.            21830099
218500     MOVE TB2-FISCAL-CCYY(PV-TB2-IDX)     TO DL1-YR-1.            21850099
218600                                                                  21860099
219000     PERFORM                                                      21900099
219100       VARYING TB2-M-IDX FROM +1 BY +1                            21910099
219200       UNTIL TB2-M-IDX > +12                                      21920099
219300         SET PL-IDX       TO TB2-M-IDX                            21930099
219400         SET PV-TOT-IDX   TO TB2-M-IDX                            21940099
219500         ADD  TB2-DLR-MO-QTY (PV-TB2-IDX, TB2-M-IDX)              21950099
219600                                 TO PV-TOT-DLR-MO-QTY(PV-TOT-IDX) 21960099
219700         MOVE TB2-DLR-MO-QTY (PV-TB2-IDX, TB2-M-IDX)              21970099
219800                                       TO  PL-MO-QTY(PL-IDX)      21980099
219900     END-PERFORM.                                                 21990099
220000     MOVE PL-PRINT-LINE-TABLE          TO  DL1-MO-DATA-1          22000099
220100                                                                  22010099
220200     ADD  TB2-DLR-ISSUED(PV-TB2-IDX)   TO  PV-TOT-DLR-ISSUED.     22020099
220300     MOVE TB2-DLR-ISSUED(PV-TB2-IDX)   TO  DL1-ISSUED-QTY-1.      22030099
220500                                                                  22050099
220600     MOVE DL1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                  22060099
220700     MOVE +1                TO  PV-LINE-SPACING.                  22070099
220800     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          22080099
220900                                                                  22090099
221000******************************************************************22100099
221100* 3200-PRINT-REPORT-DETAIL-3                                      22110099
221200*  PRINT A DETAIL LINE FOR PART 3 OF THE REPORT                   22120099
221400******************************************************************22140099
221500 3200-PRINT-REPORT-DETAIL-3.                                      22150099
221600                                                                  22160099
221700     IF (PV-SVKRP037-1-LINE-CNT + 2) > PC-LINE-LIMIT              22170099
221800         PERFORM 8000-PRINT-RPT-HEADINGS                          22180099
221900     END-IF.                                                      22190099
222000                                                                  22200099
222100     MOVE BL-BLANK-LINE     TO  PV-PRINT-RECORD.                  22210099
222200     MOVE +1                TO PV-LINE-SPACING.                   22220099
222300     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          22230099
222400                                                                  22240099
222500     MOVE TB3-FISCAL-PER-ABBR(PV-TB2-IDX) TO DL1-MO-1.            22250099
222700     MOVE TB3-FISCAL-CCYY(PV-TB2-IDX)     TO DL1-YR-1.            22270099
222800                                                                  22280099
223200     PERFORM                                                      22320099
223300       VARYING TB3-M-IDX FROM +1 BY +1                            22330099
223400       UNTIL TB3-M-IDX > +12                                      22340099
223500         SET PL-IDX       TO TB3-M-IDX                            22350099
223600         SET PV-TOT-IDX   TO TB3-M-IDX                            22360099
223700         ADD  TB3-DLR-MO-QTY (PV-TB2-IDX, TB3-M-IDX)              22370099
223800                                 TO PV-TOT-DLR-MO-QTY(PV-TOT-IDX) 22380099
223900         MOVE TB3-DLR-MO-QTY (PV-TB2-IDX, TB3-M-IDX)              22390099
224000                                       TO  PL-MO-QTY(PL-IDX)      22400099
224100     END-PERFORM.                                                 22410099
224200     MOVE PL-PRINT-LINE-TABLE          TO  DL1-MO-DATA-1          22420099
224300                                                                  22430099
224400     ADD  TB3-DLR-ISSUED(PV-TB2-IDX)   TO  PV-TOT-DLR-ISSUED.     22440099
224500     MOVE TB3-DLR-ISSUED(PV-TB2-IDX)   TO  DL1-ISSUED-QTY-1.      22450099
224700                                                                  22470099
224800     MOVE DL1-DETAIL-LINE-1 TO  PV-PRINT-RECORD.                  22480099
224900     MOVE +1                TO  PV-LINE-SPACING.                  22490099
225000     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          22500099
225100                                                                  22510099
267400******************************************************************26740053
267500* 4000-FORMAT-RPT-HEADINGS                                        26750099
267600*  MOVE HEADING DESCRIPTIONS SPECIFIC TO THE DOLLARS REPORT.      26760000
267700******************************************************************26770000
267800 4000-FORMAT-RPT-HEADINGS.                                        26780099
267900                                                                  26790000
268000     MOVE PC-REPORT-NBR-1        TO  DP200-REPORT-NUMBER.         26800099
268200     MOVE PC-H2-DESC-DOLLARS     TO  H4-RPT-DESC-1.               26820099
268300     MOVE PC-H4-DESC-2-DOLLARS   TO  H4-RPT-DESC-2.               26830000
268500                                                                  26850000
269800******************************************************************26980000
269900* 4700-PRINT-RPT-TOTAL-LINE                                       26990099
270000*  THIS PARAGRAPH WILL PRINT A REPORT DOLLAR TOTAL LINE.          27000000
270100******************************************************************27010000
270200 4700-PRINT-RPT-TOTAL-LINE.                                       27020099
270300                                                                  27030000
270400     IF (PV-SVKRP037-1-LINE-CNT + 1) > PC-LINE-LIMIT              27040099
270500         PERFORM 8000-PRINT-RPT-HEADINGS                          27050099
270600     END-IF.                                                      27060000
270700                                                                  27070000
277500     MOVE 'GRAND TOT'             TO  TL1-TOT-DESC.               27750099
277600     MOVE PV-GT-TOT-DLR-ISSUED    TO  TL1-ISSUED-QTY-1.           27760099
277620                                                                  27762099
277700     PERFORM                                                      27770099
277800       VARYING PV-GT-TOT-IDX FROM +1 BY +1                        27780099
277900       UNTIL PV-GT-TOT-IDX > +12                                  27790099
278000         SET PL-IDX TO PV-GT-TOT-IDX                              27800099
278100         MOVE PV-GT-TOT-DLR-MO(PV-GT-TOT-IDX) TO PL-MO-QTY(PL-IDX)27810099
278200     END-PERFORM.                                                 27820099
278210                                                                  27821099
278300     MOVE PL-PRINT-LINE-TABLE               TO TL1-MO-DATA-1.     27830099
279200                                                                  27920099
279600     MOVE TL1-TOTAL-LINE-1        TO  PV-PRINT-RECORD.            27960099
279700     MOVE +1                      TO  PV-LINE-SPACING.            27970099
279800     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          27980099
279900                                                                  27990099
280000     MOVE DP200-CNFDL-HDR-200-COLS TO  PV-PRINT-RECORD.           28000099
280100     MOVE +2                       TO  PV-LINE-SPACING.           28010099
280200     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          28020099
280300                                                                  28030099
282600***************************************************************** 28260099
282700* 5000-PRINT-CARD-STOCK-TOTALS                                  * 28270099
282800*                                                               * 28280099
282900***************************************************************** 28290099
283000 5000-PRINT-CARD-STOCK-TOTALS.                                    28300099
283100                                                                  28310099
283500     PERFORM                                                      28350099
283600       VARYING PV-TOT-IDX FROM +1 BY +1                           28360099
283700       UNTIL PV-TOT-IDX > +12                                     28370099
283800         SET PL-IDX TO PV-TOT-IDX                                 28380099
283900         SET PV-GT-TOT-IDX TO PV-TOT-IDX                          28390099
284000         MOVE PV-TOT-DLR-MO-QTY(PV-TOT-IDX) TO PL-MO-QTY(PL-IDX)  28400099
284100         ADD PV-TOT-DLR-MO-QTY(PV-TOT-IDX)  TO                    28410099
284200                                  PV-GT-TOT-DLR-MO(PV-GT-TOT-IDX) 28420099
284300     END-PERFORM.                                                 28430099
284400     MOVE PL-PRINT-LINE-TABLE               TO TL1-MO-DATA-1.     28440099
284500                                                                  28450099
284501     MOVE 'TOTALS'                TO  TL1-TOT-DESC.               28450199
284510     ADD  PV-TOT-DLR-ISSUED       TO  PV-GT-TOT-DLR-ISSUED.       28451099
284600     MOVE PV-TOT-DLR-ISSUED       TO  TL1-ISSUED-QTY-1.           28460099
284800                                                                  28480099
284900     MOVE UL-UNDER-LINE           TO  PV-PRINT-RECORD.            28490099
285000     MOVE +1                      TO  PV-LINE-SPACING.            28500099
285100     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          28510099
285200                                                                  28520099
286100     MOVE TL1-TOTAL-LINE-1        TO  PV-PRINT-RECORD.            28610099
286200     MOVE +1                      TO  PV-LINE-SPACING.            28620099
286300     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          28630099
286400                                                                  28640099
286500     INITIALIZE TL1-TOTAL-LINE-1                                  28650099
286600                PV-TOT-ACCUM-FIELDS.                              28660099
286700                                                                  28670099
323300******************************************************************32330000
323400* 6000-FIND-FISCAL-PERIOD.                                        32340000
323500*  STARTING AT THE FIRST ENTRY IN TABLE 2, COMPARE THE INPUT ISSUE32350000
323600*  DATE WITH THE FIRST AND LAST DATES OF EACH ENTRY, UNTIL THE    32360000
323700*  TABLE ENTRY IS FOUND THAT HAS THE ISSUE DATE IN RANGE.         32370000
323800******************************************************************32380000
323900 6000-FIND-FISCAL-PERIOD.                                         32390000
324000                                                                  32400000
324100     SET PS-TABLE-2-DATE-NOT-FOUND TO TRUE.                       32410000
324200                                                                  32420099
324300     PERFORM                                                      32430000
324400       UNTIL PS-TABLE-2-DATE-FOUND                                32440000
324500         IF  PV-SAVE-ISSUE-DATE >= TB2-FISCAL-FST-DATE(PV-TB2-IDX)32450099
324600         AND PV-SAVE-ISSUE-DATE <= TB2-FISCAL-LST-DATE(PV-TB2-IDX)32460099
324700             SET PS-TABLE-2-DATE-FOUND TO TRUE                    32470000
325200             MOVE TB2-FISCAL-FST-DATE(PV-TB2-IDX)                 32520099
325300                                         TO PV-SAVE-FST-DATE      32530000
325400             MOVE TB2-FISCAL-LST-DATE(PV-TB2-IDX)                 32540099
325500                                         TO PV-SAVE-LST-DATE      32550000
327400         ELSE                                                     32740000
327500             PERFORM 6200-INCREMENT-TABLE-2                       32750000
327600         END-IF                                                   32760000
327700     END-PERFORM.                                                 32770000
327800                                                                  32780000
327900******************************************************************32790000
328000* 6200-INCREMENT-TABLE-2                                          32800000
328100*  INCREMENT PV-TB2-IDX TO POINT TO THE NEXT TABLE 2 ENTRY.       32810099
328200******************************************************************32820000
328300 6200-INCREMENT-TABLE-2.                                          32830000
328400                                                                  32840000
328500     COMPUTE PV-TB2-IDX = PV-TB2-IDX + 1.                         32850099
328600     IF PV-TB2-IDX > TB2-NBR-ENTRIES                              32860099
328700         MOVE '6200-INCREMENT-TABLE-2 '     TO PV-PARAGRAPH-NAME  32870000
328800         MOVE 'TABLE 2 INDEX EXCEEDED MAX ENTRIES  '              32880000
328900                                            TO PV-OPERATION-MSG-1 32890000
329000         SET AC-TABLE-OVERFLOW-ERROR        TO TRUE               32900000
329100         PERFORM 9999-ABEND                                       32910000
329200     END-IF.                                                      32920000
329300                                                                  32930000
329400******************************************************************32940000
329500* 7000-READ-ACTIVITY-FILE                                         32950000
329600*  READ THE CARD ACTIVITY RECORDS.                                32960000
329700******************************************************************32970000
329800 7000-READ-ACTIVITY-FILE.                                         32980000
329900                                                                  32990000
330000     READ ACTIVITY-FILE INTO SV036-RECORD                         33000012
330100         AT END                                                   33010000
330200           SET PS-END-OF-ACTVY-FILE TO TRUE.                      33020000
330300                                                                  33030000
330400     MOVE SV036-ISSUE-TIMESTAMP(1:10) TO PV-SAVE-ISSUE-DATE.      33040099
330500                                                                  33050099
343300******************************************************************34330000
343400* 8000-PRINT-RPT-HEADINGS                                         34340099
343500*  PRINT THE HEADINGS FOR THE REPORT.                             34350099
343600******************************************************************34360000
343700 8000-PRINT-RPT-HEADINGS.                                         34370099
343800                                                                  34380000
343900     ADD +1                      TO PV-SVKRP037-1-PAGE-CNT.       34390099
344000     MOVE PV-SVKRP037-1-PAGE-CNT TO DP200-PAGE-NUMBER.            34400099
344100     MOVE DP200-STANDRD-HEADER-200-COLS                           34410099
344200                                 TO PV-PRINT-RECORD.              34420000
344300     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          34430099
344400                                                                  34440000
344500     MOVE H2-HEADING-LINE-2      TO PV-PRINT-RECORD.              34450000
344600     MOVE +1                     TO PV-LINE-SPACING.              34460000
344700     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          34470099
344800                                                                  34480000
346200     MOVE H3-HEADING-LINE-3      TO PV-PRINT-RECORD.              34620099
346300     MOVE +2                     TO PV-LINE-SPACING.              34630099
346400     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          34640099
346500                                                                  34650000
346600     MOVE H4-HEADING-LINE-4      TO PV-PRINT-RECORD.              34660000
346700     MOVE +2                     TO PV-LINE-SPACING.              34670000
346800     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          34680099
346900                                                                  34690000
347000     MOVE H5-HEADING-LINE-5      TO PV-PRINT-RECORD.              34700000
347100     MOVE +1                     TO PV-LINE-SPACING.              34710000
347200     PERFORM 8200-WRITE-RPT-REPORT-LINE.                          34720099
347300                                                                  34730000
347400******************************************************************34740051
347500* 8100-WRITE-RPT-TOP-OF-PAGE                                      34750099
347600*  WRITE FIRST REPORT LINE AFTER PAGE BREAK.                      34760000
347700******************************************************************34770000
347800 8100-WRITE-RPT-TOP-OF-PAGE.                                      34780099
347900                                                                  34790000
348000     WRITE DOLLAR-REPORT-RECORD                                   34800000
348100       FROM PV-PRINT-RECORD                                       34810000
348200         AFTER ADVANCING PAGE.                                    34820000
348300     MOVE +1             TO PV-SVKRP037-1-LINE-CNT.               34830099
348400                                                                  34840000
348500******************************************************************34850000
348600* 8200-WRITE-RPT-REPORT-LINE                                      34860099
348700*  WRITE REPORT LINE AFTER ADVANCING LINE SPACING.                34870000
348800******************************************************************34880000
348900 8200-WRITE-RPT-REPORT-LINE.                                      34890099
349000                                                                  34900000
349100     WRITE DOLLAR-REPORT-RECORD                                   34910000
349200       FROM PV-PRINT-RECORD                                       34920000
349300         AFTER ADVANCING PV-LINE-SPACING.                         34930000
349400                                                                  34940000
349500     ADD PV-LINE-SPACING TO PV-SVKRP037-1-LINE-CNT.               34950099
349600                                                                  34960099
363200******************************************************************36320000
363300* 9999-ABEND - PERFORMS A NON-SQL-ABEND                           36330000
363400******************************************************************36340000
363500 9999-ABEND.                                                      36350000
363600     DISPLAY '** ABEND           **'.                             36360000
363700     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  36370000
363800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        36380000
363900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       36390000
364000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       36400000
364100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         36410000
364200                                                                  36420099
364300******************************************************************36430085
364400*     9999-SQL-ABEND                                             *36440099
364500* ==> PROCESSES:                                                 *36450085
364600*     -PERFORMS ABEND PROCESSING FOR SQL ERRORS.                 *36460085
364700******************************************************************36470085
364800 9999-SQL-ABEND.                                                  36480099
364900                                                                  36490085
365000     DISPLAY '9999-SQL-ABEND'.                                    36500099
365100     DISPLAY '**  ABEND     **'.                                  36510085
365200     DISPLAY '**  PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.       36520085
365300     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             36530085
365400     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    36540085
365500******************************************************************36550088
365600* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    36560088
365700* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         36570088
365800* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     36580088
365900* FORMAT.                                                         36590088
366000******************************************************************36600088
366100     COPY DPPD004.                                                36610091
366200                                                                  36620088
366300     MOVE +4013 TO AC-ABEND-CODE.                                 36630089
366400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         36640089
366500                                                                  36650088
