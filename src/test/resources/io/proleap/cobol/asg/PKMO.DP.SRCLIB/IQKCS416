000100*-----------------------*                                         00010053
000200 IDENTIFICATION DIVISION.                                         00020053
000300*-----------------------*                                         00030053
000400 PROGRAM-ID.    IQKCS416.                                         00040053
000500 AUTHOR.        LINDA FRIESS.                                     00050053
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060053
000700 DATE-WRITTEN.  03-14-2005.                                       00070053
000800 DATE-COMPILED.                                                   00080053
000900                                                                  00090053
001000*---------------------------------------------------------------* 00100053
001100*    I416 - ON HAND LIST PROGRAM.                               * 00110053
001200*                                                               * 00120053
001300*    DISPLAYS A UPC LIST ASSOCIATED WITH A PARTICULAR           * 00130053
001400*    DEPARTMENT, MAJOR OR SUB CLASS, AND POSSIBLY STATUS.       * 00140053
001500*    STORE ONHAND IS DISPLAYED, ALTERNATING WITH COLOR/SIZE.    * 00150053
001600*                                                               * 00160053
001700*    THE STORE NUMBER FIELD WILL BE ENTERABLE.                  * 00170060
001800*    A SPECIFIC STORE CAN BE DISPLAYED OR CORPORATE TOTALS.     * 00180060
001900*                                                               * 00190065
002000*    THIS SCREEN IS ACCESSED BY:                                * 00200066
002100*        F16 FROM IQSVEND  - IQKCS401                           * 00210066
002200*                                                               * 00220066
002300*    FUNCTION OF THE KEYS IS AS FOLLOWS:                        * 00230066
002400*       F17 - TRANSFER TO UPC INQUIRY SCREEN (IQKCS414)         * 00240066
002500*       F22 - DISPLAY STORE ONHAND                              * 00250066
002600*       F23 - DISPLAY COLOR/SIZE                                * 00260066
002700*                                                               * 00270066
002800*---------------------------------------------------------------* 00280066
002820* DATE:        09/14/2021                                         00282067
002830* WR/IR#:      CHG0261678                                         00283068
002840* PROGRAMMER:  GERMAN BANDA                                       00284067
002850* DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00285067
002860*              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00286067
002870*              MAKING THE CALL DYNAMIC VS STATIC                  00287067
002880*---------------------------------------------------------------* 00288067
CICS  * CHANGED 11/01/2022    BY JIM HUNTER      WR: CHG0277565         00289069
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00289169
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00289269
CICS  ******************************************************************00289369
002900 EJECT                                                            00290066
003000 ENVIRONMENT DIVISION.                                            00300066
003100                                                                  00310066
003200 DATA DIVISION.                                                   00320066
003300                                                                  00330066
003400 WORKING-STORAGE SECTION.                                         00340066
003500                                                                  00350066
003600 01  DK-DB2-KEYS.                                                 00360066
003700     05  DK-DEPT-NBR                    PIC S9(04)V COMP-3.       00370066
003800     05  DK-MAJ-CL                      PIC S9(04)V COMP-3.       00380066
003900     05  DK-SUB-CL                      PIC S9(04)V COMP-3.       00390066
004000     05  DK-STORE-NBR-PIC9              PIC  9(04)  VALUE 0.      00400066
004100     05  DK-INTR-UPC-ID-PIC9            PIC  9(10)  VALUE 0.      00410066
004200     05  DK-SKU-NBR                     PIC S9(09)  VALUE 0.      00420066
004300                                                                  00430066
004400 01  PC-PROGRAM-CONSTANTS.                                        00440066
004500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00450066
004600                                                    'IQ416A  '.   00460066
004700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00470066
004800                                                    'IQKM416 '.   00480066
004900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00490066
005000                                                    'IQKCS416'.   00500066
005100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00510066
005200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00520066
005300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +13     00530066
005400                                                    COMP SYNC.    00540066
005500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00550066
005600                                                    COMP SYNC.    00560066
005700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00570066
005800                                                    +1000000      00580066
005900                                                    COMP-3.       00590066
006000     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00600066
006100                                                    COMP-3.       00610066
006200     05  PC-XMKCS001                    PIC  X(08)                00620066
006300                                             VALUE 'XMKCS001'.    00630066
006400     05  PC-XMKCS004                    PIC  X(08)                00640066
006500                                             VALUE 'XMKCS004'.    00650066
006600     05  PC-ONHAND-HDR                  PIC  X(10)                00660066
006700                                             VALUE 'STR ONHAND'.  00670066
006800     05  PC-COLOR-HDR                   PIC  X(10)                00680066
006900                                             VALUE '  COLOR   '.  00690066
007000     05  PC-SIZE-HDR                    PIC  X(04)  VALUE 'SIZE'. 00700066
007100     05  PC-CORP-LOCATION               PIC  9(04)  VALUE 90.     00710066
007200     05  PC-STATUS-20                   PIC  X(02)  VALUE '20'.   00720066
007300     05  PC-STATUS-25                   PIC  X(02)  VALUE '25'.   00730066
007400*                                                                 00740066
007500     05  PC-TSYMSG-NUMBERS.                                       00750066
007600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00760066
007700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00770066
007800         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  00780066
007900         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00790066
008000         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00800066
008100         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00810066
008200         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00820066
008300         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00830066
008400         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00840066
008500         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00850066
008600         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00860066
008700         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00870066
008800         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00880066
008900         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00890066
009000         10  PC-TSYMSG-03388            PIC  9(05)  VALUE 03388.  00900066
009100         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00910066
009200*                                                                 00920066
009300 01  PS-PROGRAM-SWITCHES.                                         00930066
009400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00940066
009500         88  PS-NO-ERROR                            VALUE 'Y'.    00950066
009600         88  PS-ERROR                               VALUE 'N'.    00960066
009700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00970066
009800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00980066
009900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00990066
010000     05  PS-CURRENT-RETAIL-SW           PIC  X(01)  VALUE 'N'.    01000066
010100         88  PS-CURRENT-RETAIL-FOUND                VALUE 'Y'.    01010066
010200         88  PS-CURRENT-RETAIL-NOT-FOUND            VALUE 'N'.    01020066
010300     05  PS-STATUS-MATCH-SW             PIC  X(01)  VALUE 'N'.    01030066
010400         88  PS-STATUS-MATCH                        VALUE 'Y'.    01040066
010500         88  PS-STATUS-NO-MATCH                     VALUE 'N'.    01050066
010600     05  PS-NEW-STORE-ENTERED-SW        PIC  X(01)  VALUE 'N'.    01060066
010700         88  PS-NEW-STORE-ENTERED                   VALUE 'Y'.    01070066
010800         88  PS-NEW-STORE-NOT-ENTERED               VALUE 'N'.    01080066
010900*                                                                 01090066
011000     05  PS-CURSOR-SW                   PIC  X(01)  VALUE SPACE.  01100066
011100         88 CSR-CLASS                               VALUE 'C'.    01110066
011200         88 CSR-MAJOR-CLASS                         VALUE 'M'.    01120066
011300         88 CSR-SUB-CLASS                           VALUE 'S'.    01130066
011400*                                                                 01140066
011500 01  PV-PROGRAM-VARIABLES.                                        01150066
011600     05  PV-SUB                         PIC S9(04)  VALUE +0      01160066
011700                                                    COMP SYNC.    01170066
011800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01180066
011900                                                    COMP SYNC.    01190066
012000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01200066
012100                                                    COMP-3.       01210066
012200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01220066
012300                                                    COMP-3.       01230066
012400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01240066
012500                                                    COMP-3.       01250066
012600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01260066
012700                                                    COMP-3.       01270066
012800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01280066
012900                                                    COMP-3.       01290066
013000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01300066
013100                                                    COMP-3.       01310066
013200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01320066
013300                                                    COMP-3.       01330066
013400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01340066
013500                                                    COMP SYNC.    01350066
013600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01360066
013700                                                    COMP SYNC.    01370066
013800     05  PV-ITEM                        PIC S9(04)  VALUE +0      01380066
013900                                                    COMP SYNC.    01390066
014000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01400066
014100                                                    COMP SYNC.    01410066
014200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01420066
014300                                                    COMP SYNC.    01430066
014400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01440066
014500                                                    COMP SYNC.    01450066
014600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01460066
014700                                                    COMP SYNC.    01470066
014800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01480066
014900                                                    COMP SYNC.    01490066
015000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01500066
015100                                                    COMP SYNC.    01510066
015200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01520066
015300                                                    COMP SYNC.    01530066
015400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01540066
015500                                                    COMP SYNC.    01550066
015600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01560066
015700                                                    COMP SYNC.    01570066
015800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01580066
015900                                                    COMP SYNC.    01590066
016000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01600066
016100                                                    COMP SYNC.    01610066
016200     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01620066
016300                                                    COMP SYNC.    01630066
016400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01640066
016500                                                    COMP SYNC.    01650066
016600     05  PV-CURSOR-NAME                 PIC  X(16)  VALUE SPACES. 01660066
016700     05  PV-STATUS-CODE                 PIC  X(02)  VALUE SPACES. 01670066
016800     05  PV-STORE-NUMBER                PIC S9(04)  VALUE +0      01680066
016900                                                    COMP.         01690066
017000     05  PV-INTR-UPC-ID                 PIC S9(09)  VALUE +0      01700066
017100                                                    COMP.         01710066
017200     05  PV-UNT-RTL-AMT                 PIC S9(07)V99 VALUE +0    01720066
017300                                                      COMP-3.     01730066
017400     05  PV-ONHAND-QTY                  PIC S9(09)  VALUE 0       01740066
017500                                                    COMP-3.       01750066
017600     05  PV-STORE-EXPECTED-QTY          PIC S9(09)  VALUE 0       01760066
017700                                                    COMP-3.       01770066
017800     05  PV-WORK-QTY-X                  PIC  X(10)  VALUE SPACES. 01780066
017900     05  PV-WORK-QTY-NUM REDEFINES PV-WORK-QTY-X  PIC S9(10).     01790066
018000     05  PV-CICS-RESPONSE          PIC S9(09)  VALUE  0 COMP.     01800066
018100     05  PV-CICS-RESPONSE-9        PIC S9(09)  VALUE  0.          01810066
018200     05  PV-COMMAREA-LENGTH        PIC S9(04)  VALUE  0 COMP.     01820066
018300*                                                                 01830066
018400******************************************************************01840066
018500**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01850066
018600**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01860066
018700**  APPLICATION-SPECIFIC COMMAREA.                              **01870066
018800******************************************************************01880066
018900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01890066
019000     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01900066
019100     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           01910066
019200                                        INDEXED BY LQW-IDX.       01920066
019300         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01930066
019400         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01940066
019500         10  LQW-SELECTED-SW            PIC  X(01).               01950066
019600             88  LQW-SELECT                         VALUE 'S'.    01960066
019700             88  LQW-DESELECT                       VALUE ' '.    01970066
019800         10  LQW-MAJ-CL                 PIC S9(04)  COMP-3.       01980066
019900         10  LQW-SUB-CL                 PIC S9(04)  COMP-3.       01990066
020000         10  LQW-SKU-DESC               PIC X(16).                02000066
020100         10  LQW-UPC-NBR                PIC S9(15)  COMP-3.       02010066
020200         10  LQW-STAT-CDE               PIC X(02).                02020066
020300         10  LQW-CUR-RTL-AMT            PIC S9(07)V99 COMP-3.     02030066
020400         10  LQW-STR-ONHAND             PIC S9(09).               02040066
020500         10  LQW-COLOR                  PIC X(10).                02050066
020600         10  LQW-SIZE                   PIC X(10).                02060066
020700                                                                  02070066
020800     EJECT                                                        02080066
020900*---------------------------------------------------------------* 02090066
021000*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 02100066
021100*---------------------------------------------------------------* 02110066
021200                                                                  02120066
021300     COPY IQWS014.                                                02130066
021400                                                                  02140066
021500     EJECT                                                        02150066
021600*---------------------------------------------------------------* 02160066
021700*    MAP LAYOUT                                                 * 02170066
021800*---------------------------------------------------------------* 02180066
021900                                                                  02190066
022000     COPY IQKM416.                                                02200066
022100*                                                                 02210066
022200 01  MR-OCCURS-LAYOUT                   REDEFINES  IQ416AO.       02220066
022300     05  FILLER                         PIC X(134).               02230066
022400     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          02240066
022500         10  MR-SELECTL                 PIC S9(04) COMP.          02250066
022600         10  MR-SELECTA                 PIC  X(01).               02260066
022700         10  MR-SELECTC                 PIC  X(01).               02270066
022800         10  MR-SELECTH                 PIC  X(01).               02280066
022900         10  MR-SELECTI                 PIC  X(01).               02290066
023000                                                                  02300066
023100         10  MR-MAJ-CLL                 PIC S9(04) COMP.          02310066
023200         10  MR-MAJ-CLA                 PIC  X(01).               02320066
023300         10  MR-MAJ-CLC                 PIC  X(01).               02330066
023400         10  MR-MAJ-CLH                 PIC  X(01).               02340066
023500         10  MR-MAJ-CLX.                                          02350066
023600             15  MR-MAJ-CL              PIC  9(04).               02360066
023700                                                                  02370066
023800         10  MR-SUB-CLL                 PIC S9(04) COMP.          02380066
023900         10  MR-SUB-CLA                 PIC  X(01).               02390066
024000         10  MR-SUB-CLC                 PIC  X(01).               02400066
024100         10  MR-SUB-CLH                 PIC  X(01).               02410066
024200         10  MR-SUB-CLX.                                          02420066
024300             15  MR-SUB-CL              PIC  9(04).               02430066
024400                                                                  02440066
024500         10  MR-SKU-DESCL               PIC S9(04) COMP.          02450066
024600         10  MR-SKU-DESCA               PIC  X(01).               02460066
024700         10  MR-SKU-DESCC               PIC  X(01).               02470066
024800         10  MR-SKU-DESCH               PIC  X(01).               02480066
024900         10  MR-SKU-DESC                PIC  X(16).               02490066
025000                                                                  02500066
025100         10  MR-UPC-NBRL                PIC S9(04) COMP.          02510066
025200         10  MR-UPC-NBRA                PIC  X(01).               02520066
025300         10  MR-UPC-NBRC                PIC  X(01).               02530066
025400         10  MR-UPC-NBRH                PIC  X(01).               02540066
025500         10  MR-UPC-NBR                 PIC  X(15).               02550066
025600                                                                  02560066
025700         10  MR-STAT-CDEL               PIC S9(04) COMP.          02570066
025800         10  MR-STAT-CDEA               PIC  X(01).               02580066
025900         10  MR-STAT-CDEC               PIC  X(01).               02590066
026000         10  MR-STAT-CDEH               PIC  X(01).               02600066
026100         10  MR-STAT-CDE                PIC  X(02).               02610066
026200                                                                  02620066
026300         10  MR-UNT-RTL-AMTL            PIC S9(04) COMP.          02630066
026400         10  MR-UNT-RTL-AMTA            PIC  X(01).               02640066
026500         10  MR-UNT-RTL-AMTC            PIC  X(01).               02650066
026600         10  MR-UNT-RTL-AMTH            PIC  X(01).               02660066
026700         10  MR-UNT-RTL-AMTX.                                     02670066
026800             15  MR-UNT-RTL-AMT         PIC  Z(05).99.            02680066
026900                                                                  02690066
027000         10  MR-OH-COLORL               PIC S9(04) COMP.          02700066
027100         10  MR-OH-COLORA               PIC  X(01).               02710066
027200         10  MR-OH-COLORC               PIC  X(01).               02720066
027300         10  MR-OH-COLORH               PIC  X(01).               02730066
027400         10  MR-OH-COLOR.                                         02740066
027500             15  MR-ONHAND              PIC  ---------9.          02750066
027600                                                                  02760066
027700         10  MR-SIZE-DESCL              PIC S9(04) COMP.          02770066
027800         10  MR-SIZE-DESCA              PIC  X(01).               02780066
027900         10  MR-SIZE-DESCC              PIC  X(01).               02790066
028000         10  MR-SIZE-DESCH              PIC  X(01).               02800066
028100         10  MR-SIZE-DESC               PIC  X(10).               02810066
028200     EJECT                                                        02820066
028300                                                                  02830066
028400*---------------------------------------------------------------* 02840066
028500*    COMMAREA USED TO CALL XMKCS001.                              02850066
028600*---------------------------------------------------------------* 02860066
028700     COPY XMWS003.                                                02870066
028800                                                                  02880066
028900*---------------------------------------------------------------* 02890066
029000*    COMMAREA USED TO CALL XLKCS074.                              02900066
029100*---------------------------------------------------------------* 02910066
029200     COPY XLWS074.                                                02920066
029300                                                                  02930066
029400*---------------------------------------------------------------* 02940066
029500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02950066
029600*---------------------------------------------------------------* 02960066
029700                                                                  02970066
029800     COPY DPWS015.                                                02980066
029900                                                                  02990066
030000*---------------------------------------------------------------* 03000066
030100*    FUNCTION KEYS COPYBOOK.                                    * 03010066
030200*---------------------------------------------------------------* 03020066
030300                                                                  03030066
030400     COPY DPWS016.                                                03040066
030500                                                                  03050066
030600*---------------------------------------------------------------* 03060066
030700*    NUMERIC EDIT LAYOUT.                                       * 03070066
030800*---------------------------------------------------------------* 03080066
030900                                                                  03090066
031000     COPY DPWS010I.                                               03100066
031100 EJECT                                                            03110066
031200*---------------------------------------------------------------* 03120066
031300*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03130069
031400*---------------------------------------------------------------* 03140066
031500                                                                  03150066
031600     COPY DPWS030.                                                03160066
CICS       COPY DPWS930.                                                03161069
031700 EJECT                                                            03170066
031800*---------------------------------------------------------------* 03180066
031900*    STANDARD COMMAREA.                                         * 03190066
032000*---------------------------------------------------------------* 03200066
032100                                                                  03210066
032200     COPY DPWS020.                                                03220066
032300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03230066
032400                                                                  03240066
032500*---------------------------------------------------------------* 03250066
032600* INTER-APPLICATION COMMAREA.                                   * 03260066
032700*   IQWS016 - IS THE INPUT LAYOUT WHEN COMING FROM THE PREVIOUS * 03270066
032800*             PROGRAM.                                          * 03280066
032900*   IQWS016 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 03290066
033000*             THIS LIST PROGRAM.                                * 03300066
033100*---------------------------------------------------------------* 03310066
033200                                                                  03320066
033300         10  INTER-APPL-COMM-AREA       PIC X(200).               03330066
033400     COPY IQWS016.                                                03340066
033500*---------------------------------------------------------------* 03350066
033600*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03360066
033700*---------------------------------------------------------------* 03370066
033800         10  ASC-SPECIFIC-COMMAREA.                               03380066
033900             15  ASC-LIST-KEYS.                                   03390066
034000                 20  ASC-DEPT-NBR                    PIC  9(04).  03400066
034100                 20  ASC-MAJ-CL                      PIC  9(04).  03410066
034200                 20  ASC-SUB-CL                      PIC  9(04).  03420066
034300                 20  ASC-STATUS                      PIC  X(02).  03430066
034400                 20  ASC-LOCATION-NBR-X.                          03440066
034500                     25  ASC-LOCATION-NBR            PIC  9(04).  03450066
034600                 20  ASC-INT-APPL-FORMAT-IND         PIC  X(01).  03460066
034700             15  ASC-DEPT-DESC                       PIC  X(20).  03470066
034800             15  ASC-STORE-NAME                      PIC  X(20).  03480066
034900             15  ASC-TOTAL-ONHANDS                   PIC S9(09).  03490066
035000*                                                                 03500066
035100             15  ASC-CHANGE-DISPLAY-SW               PIC  X(01).  03510066
035200                 88  ASC-CHANGE-DISPLAY              VALUE 'Y'.   03520066
035300                 88  ASC-DO-NOT-CHANGE-DISPLAY       VALUE 'N'.   03530066
035400             15  ASC-DISPLAY-ONHAND-SW               PIC  X(01).  03540066
035500                 88  ASC-DISPLAY-ONHAND              VALUE 'Y'.   03550066
035600                 88  ASC-DISPLAY-COLOR-SIZE          VALUE 'N'.   03560066
035700*                                                                 03570066
035800             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03580066
035900                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03590066
036000                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03600066
036100                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03610066
036200                                                                  03620066
036300                 20  ASC-ITEM-ARRAY.                              03630066
036400                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03640066
036500                         30  ASC-LIST-ITEM-NUMBER                 03650066
036600                                                     PIC S9(09)   03660066
036700                                                     COMP-3.      03670066
036800                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03680066
036900                             88  ASC-VALID-SELECT    VALUE ' '    03690066
037000                                                           'S'    03700066
037100                                                           'B'    03710066
037200                                                           'E'.   03720066
037300                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03730066
037400                             88  ASC-TEMP-SELECT     VALUE 'S'.   03740066
037500                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03750066
037600                             88  ASC-TEMP-END        VALUE 'E'.   03760066
037700                         30  ASC-SELECTED-SW         PIC  X(01).  03770066
037800                             88  ASC-NO-SELECT       VALUE ' '.   03780066
037900                             88  ASC-SELECT          VALUE 'S'.   03790066
038000                             88  ASC-BEGIN           VALUE 'B'.   03800066
038100                             88  ASC-END             VALUE 'E'.   03810066
038200                         30 ASC-DET-MAJ-CL  PIC S9(04) COMP-3.    03820066
038300                         30 ASC-DET-SUB-CL  PIC S9(04) COMP-3.    03830066
038400                         30 ASC-SKU-DESC    PIC X(16).            03840066
038500                         30 ASC-UPC-NBR     PIC S9(15) COMP-3.    03850066
038600                         30 ASC-STAT-CDE    PIC X(02).            03860066
038700                         30 ASC-CUR-RTL-AMT PIC S9(07)V99 COMP-3. 03870066
038800                         30 ASC-STR-ONHAND  PIC S9(09).           03880066
038900                         30 ASC-COLOR       PIC X(10).            03890066
039000                         30 ASC-SIZE        PIC X(10).            03900066
039100             15  ASC-BLK-SUB                         PIC S9(04)   03910066
039200                                                          COMP    03920066
039300                                                          SYNC.   03930066
039400             15  ASC-ITEM-SUB                        PIC S9(04)   03940066
039500                                                          COMP    03950066
039600                                                          SYNC.   03960066
039700             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03970066
039800                                                          COMP-3. 03980066
039900             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03990066
040000                                                          COMP-3. 04000066
040100             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   04010066
040200                                                          COMP-3. 04020066
040300             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   04030066
040400                                                          COMP-3. 04040066
040500             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   04050066
040600                                                          COMP-3. 04060066
040700             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   04070066
040800                                                          COMP    04080066
040900                                                          SYNC.   04090066
041000             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   04100066
041100                                                          COMP-3. 04110066
041200             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   04120066
041300                                                          COMP-3. 04130066
041400             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  04140066
041500                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   04150066
041600                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   04160066
041700             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  04170066
041800                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   04180066
041900                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   04190066
042000             15  ASC-LIST-QUEUE-NAME.                             04200066
042100                 20  ASC-LIST-TERM-ID                PIC  X(04).  04210066
042200                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   04220066
042300                                                          COMP-3. 04230066
042400                 20  ASC-LIST-SEQ                    PIC  9(01).  04240066
042500             15  ASC-SEL-QUEUE-NAME.                              04250066
042600                 20  ASC-SEL-TERM-ID                 PIC  X(04).  04260066
042700                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   04270066
042800                                                          COMP-3. 04280066
042900                 20  ASC-SEL-SEQ                     PIC  9(01).  04290066
043000                                                                  04300066
043100             15  ASC-CURSOR-SW                       PIC  X(01).  04310066
043200             15  ASC-START-ITEM-REQUEST.                          04320066
043300                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  04330066
043400             15  FILLER                              PIC  X(15).  04340066
043500     EJECT                                                        04350066
043600*---------------------------------------------------------------* 04360066
043700*    ABEND PROCESSING COPYBOOK.                                 * 04370066
043800*---------------------------------------------------------------* 04380066
043900                                                                  04390066
044000     COPY DPWS013.                                                04400066
044100                                                                  04410066
044200 EJECT                                                            04420066
044300*---------------------------------------------------------------* 04430066
044400*    DB2 AREA FOR XST_LOC                                         04440066
044500*---------------------------------------------------------------* 04450066
044600     EXEC SQL                                                     04460066
044700          INCLUDE XST00001                                        04470066
044800     END-EXEC.                                                    04480066
044900*---------------------------------------------------------------* 04490066
045000*    DB2 AREA FOR XST_SKU_LOC                                   * 04500066
045100*---------------------------------------------------------------* 04510066
045200     EXEC SQL                                                     04520066
045300          INCLUDE XST00008                                        04530066
045400     END-EXEC.                                                    04540066
045500*---------------------------------------------------------------* 04550066
045600*    DB2 AREA FOR XST_SKU                                         04560066
045700*---------------------------------------------------------------* 04570066
045800     EXEC SQL                                                     04580066
045900          INCLUDE XST00010                                        04590066
046000     END-EXEC.                                                    04600066
046100*---------------------------------------------------------------* 04610066
046200*    DB2 AREA FOR XST_UPC                                         04620066
046300*---------------------------------------------------------------* 04630066
046400     EXEC SQL                                                     04640066
046500          INCLUDE XST00012                                        04650066
046600     END-EXEC.                                                    04660066
046700*---------------------------------------------------------------* 04670066
046800*    DB2 AREA FOR XST_VND_STYL                                    04680066
046900*---------------------------------------------------------------* 04690066
047000     EXEC SQL                                                     04700066
047100          INCLUDE XST00013                                        04710066
047200     END-EXEC.                                                    04720066
047300*---------------------------------------------------------------* 04730066
047400*    DB2 AREA FOR XST_DEPT                                        04740066
047500*---------------------------------------------------------------* 04750066
047600     EXEC SQL                                                     04760066
047700          INCLUDE XST00015                                        04770066
047800     END-EXEC.                                                    04780066
047900*---------------------------------------------------------------* 04790066
048000*    DB2 AREA FOR COMMUNICATIONS                                * 04800066
048100*---------------------------------------------------------------* 04810066
048200     EXEC SQL                                                     04820066
048300          INCLUDE SQLCA                                           04830066
048400     END-EXEC.                                                    04840066
048500                                                                  04850066
048600*---------------------------------------------------------------* 04860066
048700*    CURSOR WHEN DEPT, MAJOR CLASS, & SUBCLASS ARE ENTERED      * 04870066
048800*---------------------------------------------------------------* 04880066
048900     EXEC SQL                                                     04890066
049000          DECLARE CSR-CLS CURSOR FOR                              04900066
049100            SELECT  H.UPC_NBR,                                    04910066
049200                    D.DEPT_NBR,                                   04920066
049300                    D.MAJ_CL_NBR,                                 04930066
049400                    D.SUB_CL_NBR,                                 04940066
049500                    F.SKU_NBR,                                    04950066
049600                    F.SIZE_DESC,                                  04960066
049700                    F.SKU_DESC,                                   04970066
049800                    F.NRF_CLOR_DESC,                              04980066
049900                    F.INTR_UPC_ID,                                04990066
050000                    F.REGN_PRIC_IND                               05000066
050100                 FROM  XST_VND_STYL  D,                           05010066
050200                       XST_SKU       F,                           05020066
050300                       XST_UPC       H                            05030066
050400                   WHERE  D.DEPT_NBR       = :DK-DEPT-NBR         05040066
050500                     AND  D.MAJ_CL_NBR     = :DK-MAJ-CL           05050066
050600                     AND  D.SUB_CL_NBR     = :DK-SUB-CL           05060066
050700                     AND  D.STYL_ID        =  F.STYL_ID           05070066
050800                     AND  F.INTR_UPC_ID    =  H.INTR_UPC_ID       05080066
050900                     AND  H.UPC_TYP_CDE    = 'I'                  05090066
051000                   ORDER BY D.MAJ_CL_NBR,                         05100066
051100                            D.SUB_CL_NBR,                         05110066
051200                            D.STYL_ID,                            05120066
051300                            H.UPC_NBR                             05130066
051400     END-EXEC.                                                    05140066
051500                                                                  05150066
051600*---------------------------------------------------------------* 05160066
051700*    CURSOR WHEN DEPT & MAJOR CLASS ARE ENTERED                   05170066
051800*---------------------------------------------------------------* 05180066
051900     EXEC SQL                                                     05190066
052000          DECLARE CSR-MAJOR-CLASS CURSOR FOR                      05200066
052100            SELECT  H.UPC_NBR,                                    05210066
052200                    D.DEPT_NBR,                                   05220066
052300                    D.MAJ_CL_NBR,                                 05230066
052400                    D.SUB_CL_NBR,                                 05240066
052500                    F.SKU_NBR,                                    05250066
052600                    F.SIZE_DESC,                                  05260066
052700                    F.SKU_DESC,                                   05270066
052800                    F.NRF_CLOR_DESC,                              05280066
052900                    F.INTR_UPC_ID,                                05290066
053000                    F.REGN_PRIC_IND                               05300066
053100                 FROM  XST_VND_STYL  D,                           05310066
053200                       XST_SKU       F,                           05320066
053300                       XST_UPC       H                            05330066
053400                   WHERE  D.DEPT_NBR       = :DK-DEPT-NBR         05340066
053500                     AND  D.MAJ_CL_NBR     = :DK-MAJ-CL           05350066
053600                     AND  D.STYL_ID        =  F.STYL_ID           05360066
053700                     AND  F.INTR_UPC_ID    =  H.INTR_UPC_ID       05370066
053800                     AND  H.UPC_TYP_CDE    = 'I'                  05380066
053900                   ORDER BY D.SUB_CL_NBR,                         05390066
054000                            D.STYL_ID,                            05400066
054100                            H.UPC_NBR                             05410066
054200     END-EXEC.                                                    05420066
054300                                                                  05430066
054400*---------------------------------------------------------------* 05440066
054500*    CURSOR WHEN DEPT & SUBCLASS ARE ENTERED                      05450066
054600*---------------------------------------------------------------* 05460066
054700     EXEC SQL                                                     05470066
054800          DECLARE CSR-SUB-CLASS CURSOR FOR                        05480066
054900            SELECT  H.UPC_NBR,                                    05490066
055000                    D.DEPT_NBR,                                   05500066
055100                    D.MAJ_CL_NBR,                                 05510066
055200                    D.SUB_CL_NBR,                                 05520066
055300                    F.SKU_NBR,                                    05530066
055400                    F.SIZE_DESC,                                  05540066
055500                    F.SKU_DESC,                                   05550066
055600                    F.NRF_CLOR_DESC,                              05560066
055700                    F.INTR_UPC_ID,                                05570066
055800                    F.REGN_PRIC_IND                               05580066
055900                 FROM  XST_VND_STYL  D,                           05590066
056000                       XST_SKU       F,                           05600066
056100                       XST_UPC       H                            05610066
056200                   WHERE  D.DEPT_NBR       = :DK-DEPT-NBR         05620066
056300                     AND  D.SUB_CL_NBR     = :DK-SUB-CL           05630066
056400                     AND  D.STYL_ID        =  F.STYL_ID           05640066
056500                     AND  F.INTR_UPC_ID    =  H.INTR_UPC_ID       05650066
056600                     AND  H.UPC_TYP_CDE    = 'I'                  05660066
056700                   ORDER BY D.MAJ_CL_NBR,                         05670066
056800                            D.STYL_ID,                            05680066
056900                            H.UPC_NBR                             05690066
057000     END-EXEC.                                                    05700066
057100                                                                  05710066
057200 EJECT                                                            05720066
057300 LINKAGE SECTION.                                                 05730066
057400                                                                  05740066
057500 01  DFHCOMMAREA.                                                 05750066
057600     05  FILLER                         OCCURS  1 TO 4072 TIMES   05760066
057700                                        DEPENDING ON EIBCALEN.    05770066
057800         10  FILLER                     PIC X.                    05780066
057900                                                                  05790066
058000 EJECT                                                            05800066
058100 PROCEDURE DIVISION.                                              05810066
058200******************************************************************05820066
058300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05830066
058400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05840066
058500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05850066
058600******************************************************************05860066
058700 0000-MAIN-MODULE.                                                05870066
058800     INITIALIZE DP030-CICS-API-FIELDS.                            05880066
058900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05890066
059000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05900066
059100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05910066
059200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05920066
059300     MOVE LENGTH OF IQ416AI        TO DP030-MAP-LENGTH (1).       05930066
059400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05940066
059500     PERFORM 0001-CALL-CICS-ARCH-API.                             05950066
059600*                                                                 05960066
059700     PERFORM 1000-CONTROL-PROCESSING                              05970066
059800*                                                                 05980066
059900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05990066
060000     PERFORM 0001-CALL-CICS-ARCH-API.                             06000066
060100                                                                  06010066
060200******************************************************************06020066
060300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06030066
060400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06040066
060500******************************************************************06050066
060600 0001-CALL-CICS-ARCH-API.                                         06060066
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      06070069
060800                                    DFHCOMMAREA                   06080069
060900                                    DP030-CICS-API-FIELDS         06090069
061000                                    DP020-STANDARD-COMMAREA       06100069
061100                                    IQ416AI.                      06110069
061200*                                                                 06120066
061300     IF  DP030-RC-CALL-SUCCESSFUL                                 06130066
061400         CONTINUE                                                 06140066
061500     ELSE                                                         06150066
061600         SET DP013-NO-ROLLBACK                                    06160066
061700             DP013-XCTL-DISPLAY-RESTART                           06170066
061800             DP013-CICS-ABEND      TO TRUE                        06180066
061900         MOVE '0001-CALL-CICS-ARCH-API'                           06190066
062000                                   TO DP013-PARAGRAPH             06200066
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06201069
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06202069
062300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06230066
062400         PERFORM DP013-0000-PROCESS-ABEND                         06240066
062500     END-IF.                                                      06250066
062600*----------------------------------------------------------------*06260066
062700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06270066
062800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06280066
062900*                                                                *06290066
063000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06300066
063100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06310066
063200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06320066
063300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06330066
063400*----------------------------------------------------------------*06340066
063500                                                                  06350066
063600 1000-CONTROL-PROCESSING.                                         06360066
063700                                                                  06370066
063800     EVALUATE TRUE                                                06380066
063900         WHEN DP020-NEXT-ACT-INITIAL                              06390066
064000             INITIALIZE ASC-SPECIFIC-COMMAREA                     06400066
064100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06410066
064200                                      ASC-SEL-TERM-ID             06420066
064300             MOVE DP020-SRC-TASK-NUMBER                           06430066
064400                                   TO ASC-LIST-TASK-NUMBER        06440066
064500                                      ASC-SEL-TASK-NUMBER         06450066
064600             MOVE PC-LIST-QUEUE-SEQ                               06460066
064700                                   TO ASC-LIST-SEQ                06470066
064800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06480066
064900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06490066
065000***-----$TEMPLATE NOTE$-------------------------------------------06500066
065100*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06510066
065200*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06520066
065300*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06530066
065400***---------------------------------------------------------------06540066
065500             IF  PS-COMMAREA-NOT-VALID                            06550066
065600                 SET DP020-NEXT-ACT-APPL-ERROR                    06560066
065700                                   TO TRUE                        06570066
065800             ELSE                                                 06580066
065900                 PERFORM 4000-BUILD-INITIAL-PANEL                 06590066
066000             END-IF                                               06600066
066100                                                                  06610066
066200         WHEN DP020-NEXT-ACT-READ-MAP                             06620066
066300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06630066
066400                                   TO PV-TOP-ITEM                 06640066
066500             PERFORM 2000-PROCESS-PANEL                           06650066
066600                                                                  06660066
066700         WHEN DP020-NEXT-ACT-RETURN                               06670066
066800             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        06680066
066900                                   TO PV-TOP-ITEM                 06690066
067000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06700066
067100             MOVE ASC-CURSOR-SW    TO PS-CURSOR-SW                06710066
067200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06720066
067300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06730066
067400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06740066
067500                                                                  06750066
067600         WHEN OTHER                                               06760066
067700             SET DP013-LOGIC-ABEND TO TRUE                        06770066
067800             SET DP013-NO-ROLLBACK TO TRUE                        06780066
067900             MOVE '1000-CONTROL-PROCESSING'                       06790066
068000                                   TO DP013-PARAGRAPH             06800066
068100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06810066
068200                                   TO DP013-MESSAGE-TEXT(1)       06820066
068300             PERFORM DP013-0000-PROCESS-ABEND                     06830066
068400     END-EVALUATE.                                                06840066
068500                                                                  06850066
068600 EJECT                                                            06860066
068700*----------------------------------------------------------------*06870066
068800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06880066
068900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06890066
069000*----------------------------------------------------------------*06900066
069100                                                                  06910066
069200 1100-PROCESS-INTER-APPL-COMM.                                    06920066
069300                                                                  06930066
069400     SET PS-COMMAREA-VALID          TO TRUE.                      06940066
069500     MOVE SPACE                     TO ASC-START-ITEM-REQUEST.    06950066
069600     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   06960066
069700*                                                                 06970066
069800     SET ASC-DO-NOT-CHANGE-DISPLAY                                06980066
069900         ASC-DISPLAY-ONHAND        TO TRUE.                       06990066
070000*                                                                 07000066
070100     IF IQ016-STORE-NO = PC-CORP-LOCATION                         07010066
070200        MOVE 0 TO ASC-LOCATION-NBR                                07020066
070300     ELSE                                                         07030066
070400        MOVE IQ016-STORE-NO TO ASC-LOCATION-NBR                   07040066
070500     END-IF.                                                      07050066
070600*                                                                 07060066
070700     MOVE IQ016-DEPT-NBR     TO ASC-DEPT-NBR                      07070066
070800                                DK-DEPT-NBR.                      07080066
070900     MOVE IQ016-MAJ-CL       TO ASC-MAJ-CL                        07090066
071000                                DK-MAJ-CL.                        07100066
071100     MOVE IQ016-SUB-CL       TO ASC-SUB-CL                        07110066
071200                                DK-SUB-CL.                        07120066
071300     MOVE IQ016-STATUS       TO ASC-STATUS.                       07130066
071400                                                                  07140066
071500     PERFORM 7600-GET-DEPT-NAME.                                  07150066
071600     MOVE XST00015-DEPT-NM   TO ASC-DEPT-DESC.                    07160066
071700                                                                  07170066
071800 EJECT                                                            07180066
071900*----------------------------------------------------------------*07190066
072000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07200066
072100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07210066
072200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07220066
072300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07230066
072400* FUNCTION KEYS CAN GET THIS FAR.                                *07240066
072500*----------------------------------------------------------------*07250066
072600                                                                  07260066
072700 2000-PROCESS-PANEL.                                              07270066
072800     EVALUATE TRUE                                                07280066
072900         WHEN DP020-SRC-AID = DP016-CLEAR                         07290066
073000             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07300066
073100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07310066
073200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07320066
073300                                                                  07330066
073400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07340066
073500             MOVE ASC-DEPT-NBR  TO DK-DEPT-NBR                    07350066
073600             MOVE ASC-MAJ-CL    TO DK-MAJ-CL                      07360066
073700             MOVE ASC-SUB-CL    TO DK-SUB-CL                      07370066
073800                                                                  07380066
073900             SET ASC-DO-NOT-CHANGE-DISPLAY                        07390066
074000                 ASC-DISPLAY-ONHAND  TO TRUE                      07400066
074100                                                                  07410066
074200             IF DP020-LOCATION-NBR = PC-CORP-LOCATION             07420066
074300                MOVE 0 TO ASC-LOCATION-NBR                        07430066
074400             ELSE                                                 07440066
074500                MOVE DP020-LOCATION-NBR TO ASC-LOCATION-NBR       07450066
074600             END-IF                                               07460066
074700                                                                  07470066
074800             PERFORM 2050-DELETE-LIST-QUEUE                       07480066
074900             PERFORM 4000-BUILD-INITIAL-PANEL                     07490066
075000                                                                  07500066
075100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07510066
075200             PERFORM 2140-DESELECT-ALL-ITEMS                      07520066
075300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07530066
075400                                                                  07540066
075500         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07550066
075600             PERFORM 2150-SELECT-ALL-ITEMS                        07560066
075700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07570066
075800                                                                  07580066
075900         WHEN OTHER                                               07590066
076000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07600066
076100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07610066
076200             IF  PS-NO-ERROR                                      07620066
076300                 IF PS-NEW-STORE-ENTERED                          07630066
076400                    MOVE ASC-DEPT-NBR TO DK-DEPT-NBR              07640066
076500                    MOVE ASC-MAJ-CL   TO DK-MAJ-CL                07650066
076600                    MOVE ASC-SUB-CL   TO DK-SUB-CL                07660066
076700                                                                  07670066
076800                    PERFORM 2050-DELETE-LIST-QUEUE                07680066
076900                    PERFORM 4000-BUILD-INITIAL-PANEL              07690066
077000                 END-IF                                           07700066
077100                                                                  07710066
077200                 SET DP030-CONTINUE-GO                            07720066
077300                                 TO TRUE                          07730066
077400                 PERFORM 2100-CHECK-FUNCTION-KEY                  07740066
077500             ELSE                                                 07750066
077600                 SET DP030-OVERRIDE-GO                            07760066
077700                                 TO TRUE                          07770066
077800             END-IF                                               07780066
077900     END-EVALUATE.                                                07790066
078000 EJECT                                                            07800066
078100*----------------------------------------------------------------*07810066
078200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07820066
078300*----------------------------------------------------------------*07830066
078400 2050-DELETE-LIST-QUEUE.                                          07840066
078500                                                                  07850066
078600     EXEC CICS                                                    07860066
078700         DELETEQ TS                                               07870066
078800             QUEUE (ASC-LIST-QUEUE-NAME)                          07880066
078900             RESP  (PV-CICS-RESP)                                 07890066
079000     END-EXEC.                                                    07900066
079100                                                                  07910066
079200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07920066
079300        (PV-CICS-RESP = DFHRESP(QIDERR))                          07930066
079400         CONTINUE                                                 07940066
079500     ELSE                                                         07950066
079600         SET DP013-CICS-ABEND      TO TRUE                        07960066
079700         SET DP013-NO-ROLLBACK     TO TRUE                        07970066
079800                                                                  07980066
079900         MOVE '2050-DELETE-LIST-QUEUE'                            07990066
080000                                   TO DP013-PARAGRAPH             08000066
080100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08010066
080200                                   TO DP013-MESSAGE-TEXT (1)      08020066
080300         PERFORM DP013-0000-PROCESS-ABEND                         08030066
080400     END-IF.                                                      08040066
080500                                                                  08050066
080600     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08060066
080700 EJECT                                                            08070066
080800*----------------------------------------------------------------*08080066
080900* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08090066
081000* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08100066
081100* CICS ARCHITECTURE API.                                         *08110066
081200*----------------------------------------------------------------*08120066
081300 2100-CHECK-FUNCTION-KEY.                                         08130066
081400     SET ASC-DO-NOT-CHANGE-DISPLAY TO TRUE.                       08140066
081500*                                                                 08150066
081600     EVALUATE TRUE                                                08160066
081700         WHEN DP020-FK-LOCAL-FUNC-01(DP020-SRC-AID)               08170066
081800**           LOCAL-01 - UPC INQ - IQIUPCST - F17 - IQKCS414       08180066
081900             IF  ASC-NUMBER-OF-SELECTED-ITEMS = ZERO              08190066
082000**               --  A LIST ITEM MUST BE SELECTED --              08200066
082100                 MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER        08210066
082200                 SET DP020-MSG-WARNING                            08220066
082300                     DP030-OVERRIDE-GO TO TRUE                    08230066
082400             ELSE                                                 08240066
082500                 INITIALIZE IQ016-INTER-APPL-COMMAREA             08250066
082600                                                                  08260066
082700                 MOVE ASC-LOCATION-NBR TO IQ016-STORE-NO          08270066
082800                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                08280066
082900                                TO IQ016-NUMBER-OF-SELECTED-ITEMS 08290066
083000                 PERFORM 5000-PREPARE-SEL-QUEUE                   08300066
083100             END-IF                                               08310066
083200                                                                  08320066
083300         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              08330066
083400**  F22   --- DISPLAY ONHAND QUANTITIES                           08340066
083500             SET ASC-CHANGE-DISPLAY                               08350066
083600                 ASC-DISPLAY-ONHAND TO TRUE                       08360066
083700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08370066
083800                                                                  08380066
083900         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              08390066
084000**  F23   --- DISPLAY COLOR/SIZE                                  08400066
084100             SET ASC-CHANGE-DISPLAY                               08410066
084200                 ASC-DISPLAY-COLOR-SIZE TO TRUE                   08420066
084300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08430066
084400                                                                  08440066
084500         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08450066
084600             MOVE +1               TO PV-TOP-ITEM                 08460066
084700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08470066
084800                                                                  08480066
084900         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08490066
085000             PERFORM 2110-BROWSE-BACKWARD                         08500066
085100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08510066
085200                                                                  08520066
085300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08530066
085400             PERFORM 2120-BROWSE-FORWARD                          08540066
085500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08550066
085600                                                                  08560066
085700         WHEN DP020-SRC-AID = DP016-ENTER                         08570066
085800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08580066
085900             IF  PS-ERROR                                         08590066
086000                 CONTINUE                                         08600066
086100             ELSE                                                 08610066
086200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08620066
086300             END-IF                                               08630066
086400                                                                  08640066
086500         WHEN OTHER                                               08650066
086600             SET DP013-NO-ROLLBACK                                08660066
086700                 DP013-XCTL-DISPLAY-RESTART                       08670066
086800                 DP013-CICS-ABEND  TO TRUE                        08680066
086900             MOVE '2100-CHECK-FUNCTION-KEY'                       08690066
087000                                   TO DP013-PARAGRAPH             08700066
087100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08710066
087200                                   TO DP013-MESSAGE-TEXT (1)      08720066
087300             PERFORM DP013-0000-PROCESS-ABEND                     08730066
087400     END-EVALUATE.                                                08740066
087500*                                                                 08750066
087600*----------------------------------------------------------------*08760066
087700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08770066
087800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08780066
087900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08790066
088000*    MESSAGE.                                                    *08800066
088100*----------------------------------------------------------------*08810066
088200                                                                  08820066
088300 2110-BROWSE-BACKWARD.                                            08830066
088400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08840066
088500         GIVING PV-TOP-ITEM.                                      08850066
088600*                                                                 08860066
088700     IF  ((PV-TOP-ITEM < +1)                                      08870066
088800       OR (PV-TOP-ITEM = +1))                                     08880066
088900         MOVE +1                   TO PV-TOP-ITEM                 08890066
089000*        -- TOP OF LIST --                                        08900066
089100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08910066
089200         SET DP020-MSG-INFORMATIONAL TO TRUE                      08920066
089300     END-IF.                                                      08930066
089400                                                                  08940066
089500 EJECT                                                            08950066
089600*----------------------------------------------------------------*08960066
089700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08970066
089800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08980066
089900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08990066
090000*----------------------------------------------------------------*09000066
090100                                                                  09010066
090200 2120-BROWSE-FORWARD.                                             09020066
090300                                                                  09030066
090400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09040066
090500         GIVING PV-TOP-ITEM.                                      09050066
090600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   09060066
090700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09070066
090800                                   TO PV-TOP-ITEM                 09080066
090900*        -- BOTTOM OF LIST --                                     09090066
091000         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09100066
091100         SET DP020-MSG-INFORMATIONAL                              09110066
091200                                   TO TRUE                        09120066
091300     ELSE                                                         09130066
091400         COMPUTE PV-BOTTOM-ITEM =                                 09140066
091500             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09150066
091600         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            09160066
091700*            -- BOTTOM OF LIST --                                 09170066
091800             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09180066
091900             SET DP020-MSG-INFORMATIONAL                          09190066
092000                                   TO TRUE                        09200066
092100         END-IF                                                   09210066
092200     END-IF.                                                      09220066
092300 EJECT                                                            09230066
092400*----------------------------------------------------------------*09240066
092500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09250066
092600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09260066
092700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09270066
092800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09280066
092900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09290066
093000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09300066
093100*----------------------------------------------------------------*09310066
093200                                                                  09320066
093300 2130-CHECK-FOR-JUMP-BROWSE.                                      09330066
093400     SET PS-NO-ERROR               TO TRUE.                       09340066
093500     IF (ASC-START-ITEM-REQUEST = SPACE)                          09350066
093600         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            09360066
093700                                   TO PV-TOP-ITEM                 09370066
093800     ELSE                                                         09380066
093900         MOVE ASC-START-ITEM-REQUEST                              09390066
094000                                   TO DP010I-UNEDITED-FIELD       09400066
094100         MOVE +5                   TO DP010I-MAXIMUM-DIGITS       09410066
094200         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09420066
094300         SET DP010I-NEGATIVE-NOT-ALLOWED                          09430066
094400                                   TO TRUE                        09440066
094510         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09451066
094520                         USING DP010I-NUMERIC-EDIT-AREA           09452066
094600                                                                  09460066
094700         IF  NOT DP010I-ERROR-DETECTED                            09470066
094800             MOVE DP010I-NUMERIC-FIELD                            09480066
094900                                   TO  ASC-START-ITEM-REQUEST-N   09490066
095000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09500066
095100                 IF  ASC-START-ITEM-REQUEST-N >                   09510066
095200                                          ASC-NUMBER-OF-ITEMS-READ09520066
095300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09530066
095400                     COMPUTE PV-TOP-ITEM =                        09540066
095500                             ASC-NUMBER-OF-ITEMS-READ             09550066
095600                             - PC-ITEMS-PER-PANEL + 1             09560066
095700                     IF  PV-TOP-ITEM < +1                         09570066
095800                         MOVE +1   TO PV-TOP-ITEM                 09580066
095900                         MOVE PC-TSYMSG-00070                     09590066
096000                                   TO DP020-MSG-NUMBER            09600066
096100                         SET DP020-MSG-INFORMATIONAL              09610066
096200                                   TO TRUE                        09620066
096300                     END-IF                                       09630066
096400                 ELSE                                             09640066
096500                     MOVE ASC-START-ITEM-REQUEST-N                09650066
096600                                   TO PV-TOP-ITEM                 09660066
096700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09670066
096800                     COMPUTE PV-BOTTOM-ITEM =                     09680066
096900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09690066
097000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09700066
097100*                        -- BOTTOM OF LIST --                     09710066
097200                         MOVE PC-TSYMSG-00070                     09720066
097300                                   TO DP020-MSG-NUMBER            09730066
097400                         SET DP020-MSG-INFORMATIONAL              09740066
097500                                   TO TRUE                        09750066
097600                     END-IF                                       09760066
097700                 END-IF                                           09770066
097800             ELSE                                                 09780066
097900*                --- VALUE OUT OF RANGE ----                      09790066
098000                 MOVE PC-TSYMSG-00101                             09800066
098100                                   TO DP020-MSG-NUMBER            09810066
098200                 MOVE -1           TO ASTRTITL                    09820066
098300                 SET DP030-SET-CURSOR-APPL-1                      09830066
098400                                   TO TRUE                        09840066
098500                 MOVE DP015-REVERSE                               09850066
098600                                   TO ASTRTITH                    09860066
098700                 MOVE DP015-RED    TO ASTRTITC                    09870066
098800                 MOVE DP015-UNP-NUM-BRT-MDT                       09880066
098900                                   TO ASTRTITA                    09890066
099000                 SET DP020-MSG-FATAL                              09900066
099100                                   TO TRUE                        09910066
099200                 SET PS-ERROR      TO TRUE                        09920066
099300             END-IF                                               09930066
099400                                                                  09940066
099500         ELSE                                                     09950066
099600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09960066
099700             MOVE -1               TO ASTRTITL                    09970066
099800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09980066
099900             MOVE DP015-REVERSE    TO ASTRTITH                    09990066
100000             MOVE DP015-RED        TO ASTRTITC                    10000066
100100             MOVE DP015-UNP-NUM-BRT-MDT                           10010066
100200                                   TO ASTRTITA                    10020066
100300             SET DP020-MSG-FATAL   TO TRUE                        10030066
100400             SET PS-ERROR          TO TRUE                        10040066
100500         END-IF                                                   10050066
100600     END-IF.                                                      10060066
100700 EJECT                                                            10070066
100800*----------------------------------------------------------------*10080066
100900*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10090066
101000*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10100066
101100*----------------------------------------------------------------*10110066
101200 2140-DESELECT-ALL-ITEMS.                                         10120066
101300     MOVE +1                       TO ASC-BLK-SUB.                10130066
101400                                                                  10140066
101500     PERFORM 2141-CLEAR-SELECTED-INDS                             10150066
101600         VARYING ASC-ITEM-SUB                                     10160066
101700         FROM 1 BY 1                                              10170066
101800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10180066
101900                                                                  10190066
102000     ADD +1                        TO ASC-BLK-SUB.                10200066
102100                                                                  10210066
102200     PERFORM 2141-CLEAR-SELECTED-INDS                             10220066
102300         VARYING ASC-ITEM-SUB                                     10230066
102400         FROM 1 BY 1                                              10240066
102500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10250066
102600                                                                  10260066
102700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10270066
102800                                   TO PV-LIST-ITEM-NUMBER.        10280066
102900                                                                  10290066
103000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10300066
103100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10310066
103200                                                                  10320066
103300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10330066
103400        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10340066
103500         MOVE +1                   TO ASC-BLK-SUB                 10350066
103600                                                                  10360066
103700         PERFORM 5100-WRITE-TEMP-STORAGE                          10370066
103800                                                                  10380066
103900         MOVE +1                   TO PV-BLOCK-NUMBER             10390066
104000                                                                  10400066
104100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10410066
104200             PV-FIRST-BLOCK-IN-ARRAY - 1                          10420066
104300                                                                  10430066
104400         PERFORM                                                  10440066
104500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10450066
104600                                                                  10460066
104700             PERFORM 4410-READ-TEMP-STORAGE                       10470066
104800                                                                  10480066
104900             PERFORM 2141-CLEAR-SELECTED-INDS                     10490066
105000                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10500066
105100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10510066
105200                                                                  10520066
105300             PERFORM 5100-WRITE-TEMP-STORAGE                      10530066
105400                                                                  10540066
105500             ADD +1                TO PV-BLOCK-NUMBER             10550066
105600                                                                  10560066
105700         END-PERFORM                                              10570066
105800                                                                  10580066
105900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10590066
106000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10600066
106100                                                                  10610066
106200         PERFORM                                                  10620066
106300             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10630066
106400                   ASC-HIGHEST-BLOCK-WRITTEN                      10640066
106500                                                                  10650066
106600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10660066
106700                                   TO PV-BLOCK-NUMBER             10670066
106800                                                                  10680066
106900             PERFORM 4410-READ-TEMP-STORAGE                       10690066
107000                                                                  10700066
107100             PERFORM 2141-CLEAR-SELECTED-INDS                     10710066
107200                 VARYING ASC-ITEM-SUB                             10720066
107300                 FROM 1 BY 1                                      10730066
107400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10740066
107500                                                                  10750066
107600             PERFORM 5100-WRITE-TEMP-STORAGE                      10760066
107700                                                                  10770066
107800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10780066
107900                                                                  10790066
108000         END-PERFORM                                              10800066
108100                                                                  10810066
108200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10820066
108300                                   TO PV-BLOCK-NUMBER             10830066
108400                                                                  10840066
108500         PERFORM 4410-READ-TEMP-STORAGE                           10850066
108600     END-IF.                                                      10860066
108700                                                                  10870066
108800                                                                  10880066
108900     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 10890066
109000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.10900066
109100     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  10910066
109200                                                                  10920066
109300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10930066
109400                                                                  10940066
109500 EJECT                                                            10950066
109600*----------------------------------------------------------------*10960066
109700*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10970066
109800*----------------------------------------------------------------*10980066
109900                                                                  10990066
110000 2141-CLEAR-SELECTED-INDS.                                        11000066
110100                                                                  11010066
110200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11020066
110300             NOT EQUAL ZERO                                       11030066
110400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11040066
110500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11050066
110600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11060066
110700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11070066
110800                                   TO TRUE                        11080066
110900         END-IF                                                   11090066
111000     END-IF.                                                      11100066
111100                                                                  11110066
111200 EJECT                                                            11120066
111300*----------------------------------------------------------------*11130066
111400*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11140066
111500*  FOR ALL ITEMS.                                                *11150066
111600*----------------------------------------------------------------*11160066
111700                                                                  11170066
111800 2150-SELECT-ALL-ITEMS.                                           11180066
111900                                                                  11190066
112000     MOVE +1                       TO ASC-BLK-SUB.                11200066
112100                                                                  11210066
112200     PERFORM 2151-SET-SELECTED-INDS                               11220066
112300         VARYING ASC-ITEM-SUB                                     11230066
112400         FROM 1 BY 1                                              11240066
112500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11250066
112600                                                                  11260066
112700     ADD +1                        TO ASC-BLK-SUB.                11270066
112800                                                                  11280066
112900     PERFORM 2151-SET-SELECTED-INDS                               11290066
113000         VARYING ASC-ITEM-SUB                                     11300066
113100         FROM 1 BY 1                                              11310066
113200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11320066
113300                                                                  11330066
113400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11340066
113500                                   TO PV-LIST-ITEM-NUMBER.        11350066
113600                                                                  11360066
113700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11370066
113800         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11380066
113900                                                                  11390066
114000     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11400066
114100        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11410066
114200         MOVE +1                   TO ASC-BLK-SUB                 11420066
114300                                                                  11430066
114400         PERFORM 5100-WRITE-TEMP-STORAGE                          11440066
114500                                                                  11450066
114600         MOVE +1                   TO PV-BLOCK-NUMBER             11460066
114700                                                                  11470066
114800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11480066
114900             PV-FIRST-BLOCK-IN-ARRAY - 1                          11490066
115000                                                                  11500066
115100         PERFORM                                                  11510066
115200             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11520066
115300                                                                  11530066
115400             PERFORM 4410-READ-TEMP-STORAGE                       11540066
115500                                                                  11550066
115600             PERFORM 2151-SET-SELECTED-INDS                       11560066
115700                 VARYING ASC-ITEM-SUB                             11570066
115800                 FROM 1 BY 1                                      11580066
115900                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11590066
116000                                                                  11600066
116100             PERFORM 5100-WRITE-TEMP-STORAGE                      11610066
116200                                                                  11620066
116300             ADD +1                TO PV-BLOCK-NUMBER             11630066
116400                                                                  11640066
116500         END-PERFORM                                              11650066
116600                                                                  11660066
116700         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11670066
116800             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11680066
116900                                                                  11690066
117000         PERFORM                                                  11700066
117100             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11710066
117200                   ASC-HIGHEST-BLOCK-WRITTEN                      11720066
117300                                                                  11730066
117400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11740066
117500                                   TO PV-BLOCK-NUMBER             11750066
117600                                                                  11760066
117700             PERFORM 4410-READ-TEMP-STORAGE                       11770066
117800                                                                  11780066
117900             PERFORM 2151-SET-SELECTED-INDS                       11790066
118000                 VARYING ASC-ITEM-SUB                             11800066
118100                 FROM 1 BY 1                                      11810066
118200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11820066
118300                                                                  11830066
118400             PERFORM 5100-WRITE-TEMP-STORAGE                      11840066
118500                                                                  11850066
118600             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11860066
118700                                                                  11870066
118800         END-PERFORM                                              11880066
118900                                                                  11890066
119000         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11900066
119100                                   TO PV-BLOCK-NUMBER             11910066
119200                                                                  11920066
119300         PERFORM 4410-READ-TEMP-STORAGE                           11930066
119400     END-IF.                                                      11940066
119500                                                                  11950066
119600                                                                  11960066
119700     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11970066
119800                       ASC-NUMBER-OF-SELECTED-ITEMS.              11980066
119900                                                                  11990066
120000     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12000066
120100                                                                  12010066
120200 EJECT                                                            12020066
120300*----------------------------------------------------------------*12030066
120400*    MARK EACH ITEM AS BEING SELECTED.                           *12040066
120500*----------------------------------------------------------------*12050066
120600                                                                  12060066
120700 2151-SET-SELECTED-INDS.                                          12070066
120800                                                                  12080066
120900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12090066
121000             NOT EQUAL ZERO                                       12100066
121100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12110066
121200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12120066
121300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12130066
121400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12140066
121500                               TO  TRUE                           12150066
121600         END-IF                                                   12160066
121700     END-IF.                                                      12170066
121800******************************************************************12180066
121900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12190066
122000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12200066
122100******************************************************************12210066
122200 2200-MOVE-SCREEN-TO-COMMAREA.                                    12220066
122300                                                                  12230066
122400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12240066
122500     MOVE +1                       TO PV-SUB.                     12250066
122600*                                                                 12260066
122700     PERFORM 3100-SET-SUBSCRIPTS.                                 12270066
122800     IF  ASTRTITL > ZERO                                          12280066
122900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          12290066
123000     ELSE                                                         12300066
123100         IF  ASTRTITF = DP015-ERASE-EOF                           12310066
123200             INITIALIZE ASC-START-ITEM-REQUEST                    12320066
123300         END-IF                                                   12330066
123400     END-IF.                                                      12340066
123500*                                                                 12350066
123600*    --- CHECK FOR STORE NUMBER ENTERED ---                       12360066
123700     IF  ASTOREL > ZERO                                           12370066
123800         MOVE ASTOREI  TO ASC-LOCATION-NBR-X                      12380066
123900         SET PS-NEW-STORE-ENTERED TO TRUE                         12390066
124000     ELSE                                                         12400066
124100         IF  ASTOREF = DP015-ERASE-EOF                            12410066
124200             MOVE ZERO TO ASC-LOCATION-NBR                        12420066
124300             SET PS-NEW-STORE-ENTERED TO TRUE                     12430066
124400         END-IF                                                   12440066
124500     END-IF.                                                      12450066
124600*                                                                 12460066
124700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12470066
124800         VARYING PV-SUB                                           12480066
124900         FROM 1 BY 1                                              12490066
125000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12500066
125100******************************************************************12510066
125200** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12520066
125300******************************************************************12530066
125400 2210-MOVE-LINES-TO-COMMAREA.                                     12540066
125500     IF  MR-SELECTL (PV-SUB) > ZERO                               12550066
125600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12560066
125700         MOVE MR-SELECTI (PV-SUB)                                 12570066
125800                                   TO ASC-TEMP-SELECTED-SW        12580066
125900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12590066
126000     ELSE                                                         12600066
126100         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12610066
126200                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     12620066
126300                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        12630066
126400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12640066
126500         END-IF                                                   12650066
126600     END-IF.                                                      12660066
126700     ADD +1                        TO ASC-ITEM-SUB.               12670066
126800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12680066
126900         ADD +1                    TO ASC-BLK-SUB                 12690066
127000         MOVE +1                   TO ASC-ITEM-SUB                12700066
127100     END-IF.                                                      12710066
127200******************************************************************12720066
127300** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12730066
127400** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12740066
127500******************************************************************12750066
127600 3000-EDIT-DATA-IN-COMMAREA.                                      12760066
127700     SET PS-NO-ERROR               TO TRUE.                       12770066
127800     PERFORM 3200-RESET-ATTRIBUTES.                               12780066
127900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12790066
128000**                                                                12800066
128100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12810066
128200* EDITTING IS DONE FROM THE BOTTOM UP.                            12820066
128300**                                                                12830066
128400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12840066
128500         ASC-ITEMS-DISPLAYED - 1.                                 12850066
128600     PERFORM 3100-SET-SUBSCRIPTS.                                 12860066
128700     PERFORM 3300-EDIT-SELECTIONS                                 12870066
128800         VARYING PV-SUB                                           12880066
128900         FROM PV-SUB BY -1                                        12890066
129000         UNTIL PV-SUB < +1.                                       12900066
129100*                                                                 12910066
129200*    --- EDIT & VALIDATE STORE NUMBER ---                         12920066
129300     MOVE ASC-LOCATION-NBR-X   TO DP010I-UNEDITED-FIELD.          12930066
129400     MOVE 4                    TO DP010I-MAXIMUM-DIGITS.          12940066
129500     MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS.        12950066
129600     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     12960066
129700*                                                                 12970066
129810     CALL DP010I-NUMERIC-EDIT-ROUTINE                             12981066
129820                         USING DP010I-NUMERIC-EDIT-AREA           12982066
129900     IF DP010I-ERROR-DETECTED                                     12990066
130000        MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                 13000066
130100        SET PS-ERROR                                              13010066
130200            DP020-MSG-FATAL   TO TRUE                             13020066
130300                                                                  13030066
130400        MOVE DP015-UNP-ALP-BRT-OFF TO ASTOREA                     13040066
130500        MOVE DP015-RED             TO ASTOREC                     13050066
130600        MOVE DP015-REVERSE         TO ASTOREH                     13060066
130700        MOVE -1                    TO ASTOREL                     13070066
130800        SET DP030-SET-CURSOR-APPL-1 TO TRUE                       13080066
130900     ELSE                                                         13090066
131000        MOVE DP010I-NUMERIC-FIELD TO ASC-LOCATION-NBR             13100066
131100        MOVE ASC-LOCATION-NBR     TO ASTOREO                      13110066
131200                                                                  13120066
131300*       --- VALIDATE STORE & GET NAME; SET ERROR IF NOT FOUND --- 13130066
131400        PERFORM 7700-GET-STORE-NAME                               13140066
131500        MOVE XST00001-LOC-NM TO ASC-STORE-NAME                    13150066
131600     END-IF.                                                      13160066
131700*                                                                 13170066
131800     IF  PS-NO-ERROR                                              13180066
131900         PERFORM 3400-CHECK-RANGE-SEQUENCE                        13190066
132000     END-IF.                                                      13200066
132100*                                                                 13210066
132200     IF  ((PS-NO-ERROR)                                           13220066
132300       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   13230066
132400       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    13240066
132500             PERFORM 3500-MARK-RANGE-AS-SELECTED                  13250066
132600     END-IF.                                                      13260066
132700 EJECT                                                            13270066
132800*----------------------------------------------------------------*13280066
132900*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13290066
133000*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13300066
133100*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13310066
133200*                                                                *13320066
133300*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13330066
133400*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13340066
133500*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13350066
133600*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13360066
133700*----------------------------------------------------------------*13370066
133800                                                                  13380066
133900 3100-SET-SUBSCRIPTS.                                             13390066
134000                                                                  13400066
134100     COMPUTE ASC-ITEM-SUB =                                       13410066
134200         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13420066
134300                                                                  13430066
134400     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13440066
134500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13450066
134600                                                                  13460066
134700         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13470066
134800     ELSE                                                         13480066
134900         MOVE +1                     TO ASC-BLK-SUB               13490066
135000     END-IF.                                                      13500066
135100******************************************************************13510066
135200** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13520066
135300******************************************************************13530066
135400                                                                  13540066
135500 3200-RESET-ATTRIBUTES.                                           13550066
135600     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA                    13560066
135700                                      ASTOREA.                    13570066
135800     MOVE DP015-GREEN              TO ASTRTITC                    13580066
135900                                      ASTOREC.                    13590066
136000     MOVE DP015-UNDERLINE          TO ASTRTITH                    13600061
136100                                      ASTOREH.                    13610066
136200*                                                                 13620053
136300     PERFORM                                                      13630053
136400         VARYING PV-SUB                                           13640053
136500         FROM 1 BY 1                                              13650053
136600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13660053
136700         MOVE DP015-UNP-ALP-NOR-OFF                               13670053
136800                                   TO MR-SELECTA (PV-SUB)         13680053
136900         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         13690053
137000         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         13700053
137100     END-PERFORM.                                                 13710053
137200******************************************************************13720053
137300** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13730053
137400** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13740053
137500** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13750053
137600** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13760053
137700******************************************************************13770053
137800 3300-EDIT-SELECTIONS.                                            13780053
137900     EVALUATE TRUE                                                13790053
138000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13800053
138100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13810053
138200                 CONTINUE                                         13820053
138300         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13830053
138400             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13840053
138500                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13850053
138600                 MOVE ASC-TEMP-SELECTED-SW                        13860053
138700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13870053
138800                                TO ASC-SELECTED-SW                13880053
138900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13890053
139000             END-IF                                               13900053
139100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13910053
139200                 = SPACE                                          13920053
139300             EVALUATE TRUE                                        13930053
139400                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13940053
139500                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13950053
139600                     MOVE SPACE TO ASC-SELECTED-SW                13960053
139700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13970053
139800                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13980053
139900                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13990053
140000                     MOVE SPACE TO ASC-SELECTED-SW                14000053
140100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14010053
140200                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14020053
140300                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14030053
140400                     MOVE SPACE TO ASC-SELECTED-SW                14040053
140500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14050053
140600             END-EVALUATE                                         14060053
140700         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14070053
140800             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14080053
140900                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14090053
141000             END-IF                                               14100053
141100             PERFORM 3310-EDIT-RANGE                              14110053
141200         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14120053
141300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14130053
141400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14140053
141500             END-IF                                               14150053
141600             PERFORM 3310-EDIT-RANGE                              14160053
141700         WHEN OTHER                                               14170053
141800             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14180053
141900             SET DP020-MSG-FATAL    TO TRUE                       14190053
142000             MOVE -1                TO MR-SELECTL (PV-SUB)        14200053
142100             SET DP030-SET-CURSOR-APPL-1                          14210053
142200                                    TO TRUE                       14220053
142300             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14230053
142400             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14240053
142500             SET PS-ERROR TO TRUE                                 14250053
142600             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14260053
142700                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14270053
142800                 MOVE SPACE         TO ASC-SELECTED-SW            14280053
142900                                        (ASC-BLK-SUB ASC-ITEM-SUB)14290053
143000             END-IF                                               14300053
143100     END-EVALUATE.                                                14310053
143200                                                                  14320053
143300     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14330053
143400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14340053
143500     IF  ASC-ITEM-SUB < 1                                         14350053
143600         SUBTRACT +1 FROM ASC-BLK-SUB                             14360053
143700         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14370053
143800     END-IF.                                                      14380053
143900******************************************************************14390053
144000** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14400053
144100** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14410053
144200** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14420053
144300** THE ENDING.                                                  **14430053
144400******************************************************************14440053
144500 3310-EDIT-RANGE.                                                 14450053
144600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14460053
144700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14470053
144800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14480053
144900                                   TO ASC-SELECTED-SW             14490053
145000                                        (ASC-BLK-SUB ASC-ITEM-SUB)14500053
145100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14510053
145200         ELSE                                                     14520053
145300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14530053
145400                 CONTINUE                                         14540053
145500             ELSE                                                 14550053
145600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14560053
145700                 MOVE PC-TSYMSG-00054                             14570053
145800                                   TO DP020-MSG-NUMBER            14580053
145900                 SET DP020-MSG-FATAL                              14590053
146000                                   TO TRUE                        14600053
146100                 MOVE -1           TO MR-SELECTL (PV-SUB)         14610053
146200                 SET DP030-SET-CURSOR-APPL-1                      14620053
146300                                   TO TRUE                        14630053
146400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14640053
146500                 MOVE DP015-UNDERLINE                             14650053
146600                                   TO MR-SELECTH (PV-SUB)         14660053
146700                 SET PS-ERROR      TO TRUE                        14670053
146800             END-IF                                               14680053
146900         END-IF                                                   14690053
147000     ELSE                                                         14700053
147100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14710053
147200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14720053
147300                                   TO ASC-SELECTED-SW             14730053
147400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14740053
147500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14750053
147600         ELSE                                                     14760053
147700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14770053
147800                 CONTINUE                                         14780053
147900             ELSE                                                 14790053
148000*                -- ONLY ONE END-OF-RANGE ALLOWED --              14800053
148100                 MOVE PC-TSYMSG-00055                             14810053
148200                                   TO DP020-MSG-NUMBER            14820053
148300                 SET DP020-MSG-FATAL                              14830053
148400                                   TO TRUE                        14840053
148500                 MOVE -1           TO MR-SELECTL (PV-SUB)         14850053
148600                 SET DP030-SET-CURSOR-APPL-1                      14860053
148700                                   TO TRUE                        14870053
148800                 SET PS-ERROR      TO TRUE                        14880053
148900             END-IF                                               14890053
149000         END-IF                                                   14900053
149100     END-IF.                                                      14910053
149200*                                                                 14920053
149300******************************************************************14930053
149400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14940053
149500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14950053
149600******************************************************************14960053
149700 3400-CHECK-RANGE-SEQUENCE.                                       14970053
149800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14980053
149900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14990053
150000       AND  ASC-START-OF-SELECTED-RANGE >                         15000053
150100                                         ASC-END-OF-SELECTED-RANGE15010053
150200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15020053
150300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15030053
150400         SET DP020-MSG-FATAL TO TRUE                              15040053
150500         SET PS-ERROR TO TRUE                                     15050053
150600         PERFORM 3410-POSITION-AT-ERROR                           15060053
150700     END-IF.                                                      15070053
150800******************************************************************15080053
150900** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15090053
151000** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15100053
151100** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15110053
151200******************************************************************15120053
151300 3410-POSITION-AT-ERROR.                                          15130053
151400     SET DP030-SET-CURSOR-APPL-1                                  15140053
151500                                   TO TRUE.                       15150053
151600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15160053
151700                    - PV-TOP-ITEM + 1.                            15170053
151800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15180053
151900         CONTINUE                                                 15190053
152000     ELSE                                                         15200053
152100         MOVE -1                   TO MR-SELECTL (PV-SUB)         15210053
152200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15220053
152300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15230053
152400     END-IF.                                                      15240053
152500*                                                                 15250053
152600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15260053
152700                    - PV-TOP-ITEM + 1.                            15270053
152800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15280053
152900         CONTINUE                                                 15290053
153000     ELSE                                                         15300053
153100         MOVE -1                   TO MR-SELECTL (PV-SUB)         15310053
153200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15320053
153300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15330053
153400     END-IF.                                                      15340053
153500 EJECT                                                            15350053
153600*----------------------------------------------------------------*15360053
153700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15370053
153800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15380053
153900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15390053
154000*----------------------------------------------------------------*15400053
154100                                                                  15410053
154200 3500-MARK-RANGE-AS-SELECTED.                                     15420053
154300     MOVE +1                       TO  ASC-BLK-SUB.               15430053
154400     PERFORM 3510-MARK-SELECTED-INDS                              15440053
154500         VARYING ASC-ITEM-SUB                                     15450053
154600         FROM 1 BY 1                                              15460053
154700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15470053
154800                                                                  15480053
154900     ADD +1                        TO ASC-BLK-SUB.                15490053
155000     PERFORM 3510-MARK-SELECTED-INDS                              15500053
155100         VARYING ASC-ITEM-SUB                                     15510053
155200         FROM 1 BY 1                                              15520053
155300         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15530053
155400                                                                  15540053
155500     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15550053
155600                                   TO  PV-LIST-ITEM-NUMBER.       15560053
155700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15570053
155800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15580053
155900               PC-ITEMS-PER-PANEL).                               15590053
156000                                                                  15600053
156100     MOVE ASC-START-OF-SELECTED-RANGE                             15610053
156200                                   TO PV-START-OF-SELECTED-RANGE. 15620053
156300     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15630053
156400         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15640053
156500               PC-ITEMS-PER-PANEL).                               15650053
156600                                                                  15660053
156700     MOVE ASC-END-OF-SELECTED-RANGE                               15670053
156800                                   TO  PV-END-OF-SELECTED-RANGE.  15680053
156900     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15690053
157000         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15700053
157100               PC-ITEMS-PER-PANEL).                               15710053
157200     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15720053
157300         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15730053
157400                                                                  15740053
157500     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15750053
157600        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15760053
157700         MOVE +1                   TO ASC-BLK-SUB                 15770053
157800         PERFORM 5100-WRITE-TEMP-STORAGE                          15780053
157900         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15790053
158000             PV-FIRST-BLOCK-IN-ARRAY - 1                          15800053
158100                                                                  15810053
158200         PERFORM                                                  15820053
158300             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15830053
158400                   PV-PREV-BLOCK-IN-ARRAY                         15840053
158500             MOVE PV-FIRST-BLOCK-IN-RANGE                         15850053
158600                                   TO PV-BLOCK-NUMBER             15860053
158700             PERFORM 4410-READ-TEMP-STORAGE                       15870053
158800             PERFORM 3510-MARK-SELECTED-INDS                      15880053
158900                 VARYING ASC-ITEM-SUB                             15890053
159000                 FROM 1 BY 1                                      15900053
159100                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15910053
159200             PERFORM 5100-WRITE-TEMP-STORAGE                      15920053
159300             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15930053
159400         END-PERFORM                                              15940053
159500                                                                  15950053
159600         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15960053
159700             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15970053
159800         PERFORM                                                  15980053
159900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15990053
160000                   PV-LAST-BLOCK-IN-RANGE                         16000053
160100             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16010053
160200                                   TO PV-BLOCK-NUMBER             16020053
160300             PERFORM 4410-READ-TEMP-STORAGE                       16030053
160400             PERFORM 3510-MARK-SELECTED-INDS                      16040053
160500                 VARYING ASC-ITEM-SUB                             16050053
160600                 FROM 1 BY 1                                      16060053
160700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16070053
160800             PERFORM 5100-WRITE-TEMP-STORAGE                      16080053
160900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16090053
161000         END-PERFORM                                              16100053
161100                                                                  16110053
161200         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16120053
161300                                   TO PV-BLOCK-NUMBER             16130053
161400         PERFORM 4410-READ-TEMP-STORAGE                           16140053
161500     END-IF.                                                      16150053
161600                                                                  16160053
161700     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16170053
161800                                      ASC-END-OF-SELECTED-RANGE.  16180053
161900                                                                  16190053
162000 EJECT                                                            16200053
162100*----------------------------------------------------------------*16210053
162200* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16220053
162300*----------------------------------------------------------------*16230053
162400                                                                  16240053
162500 3510-MARK-SELECTED-INDS.                                         16250053
162600                                                                  16260053
162700     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16270053
162800                                ASC-ITEM-SUB) >                   16280053
162900         ASC-START-OF-SELECTED-RANGE)                             16290053
163000     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16300053
163100                                ASC-ITEM-SUB) =                   16310053
163200         ASC-START-OF-SELECTED-RANGE)                             16320053
163300                                                                  16330053
163400         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16340053
163500                                    ASC-ITEM-SUB) <               16350053
163600             ASC-END-OF-SELECTED-RANGE)                           16360053
163700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16370053
163800                                    ASC-ITEM-SUB) =               16380053
163900             ASC-END-OF-SELECTED-RANGE)                           16390053
164000                                                                  16400053
164100             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16410053
164200                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16420053
164300                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16430053
164400                               TO TRUE                            16440053
164500                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16450053
164600                               TO TRUE                            16460053
164700                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16470053
164800             END-IF                                               16480053
164900         END-IF                                                   16490053
165000     END-IF.                                                      16500053
165100                                                                  16510053
165200 EJECT                                                            16520053
165300*----------------------------------------------------------------*16530053
165400*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16540053
165500*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16550053
165600*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16560053
165700*    DISPLAY THE PANEL TO USER.                                  *16570053
165800*----------------------------------------------------------------*16580053
165900                                                                  16590053
166000 4000-BUILD-INITIAL-PANEL.                                        16600053
166100                                                                  16610053
166200     INITIALIZE    ASC-BLOCK-ENTRIES (1)                          16620053
166300                   ASC-BLOCK-ENTRIES (2).                         16630053
166400     MOVE +1                 TO ASC-BLK-SUB.                      16640053
166500     SET ASC-ITEMS-LEFT-ON-DB                                     16650053
166600                             TO TRUE.                             16660053
166700                                                                  16670053
166800     MOVE +0                 TO ASC-ITEM-SUB                      16680053
166900                                ASC-NUMBER-OF-ITEMS-READ          16690053
167000                                ASC-NUMBER-OF-SELECTED-ITEMS      16700053
167100                                ASC-HIGHEST-BLOCK-WRITTEN         16710053
167200                                ASC-START-OF-SELECTED-RANGE       16720053
167300                                ASC-END-OF-SELECTED-RANGE         16730053
167400                                ASC-ITEM-AT-TOP-OF-PANEL          16740053
167500                                ASC-TOTAL-ONHANDS.                16750053
167600                                                                  16760053
167700     PERFORM 7700-GET-STORE-NAME.                                 16770053
167800     MOVE XST00001-LOC-NM TO ASC-STORE-NAME.                      16780053
167900                                                                  16790053
168000     PERFORM 4100-PREPARE-CURSOR.                                 16800053
168100                                                                  16810053
168200     PERFORM 4010-OPEN-CURSOR.                                    16820053
168300                                                                  16830053
168400     PERFORM 4300-READ-ITEMS-FROM-DB.                             16840053
168500                                                                  16850053
168600     PERFORM 4020-CLOSE-CURSOR.                                   16860053
168700     MOVE PS-CURSOR-SW TO ASC-CURSOR-SW.                          16870053
168800                                                                  16880053
168900     MOVE +1                   TO  PV-TOP-ITEM.                   16890053
169000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16900053
169100         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16910053
169200         SET DP020-MSG-FATAL   TO  TRUE                           16920053
169300         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               16930053
169400     ELSE                                                         16940053
169500         MOVE -1               TO MR-SELECTL (1)                  16950053
169600         SET DP030-SET-CURSOR-APPL-1                              16960053
169700                               TO TRUE                            16970053
169800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     16980053
169900     END-IF.                                                      16990053
170000 EJECT                                                            17000053
170100*----------------------------------------------------------------*17010053
170200* OPEN THE CURSOR.                                               *17020053
170300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17030053
170400*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17040053
170500*   USER.                                                        *17050053
170600*----------------------------------------------------------------*17060053
170700                                                                  17070053
170800 4010-OPEN-CURSOR.                                                17080053
170900     PERFORM                                                      17090053
171000         WITH TEST AFTER                                          17100053
171100         VARYING PV-RETRY-COUNTER                                 17110053
171200         FROM 1 BY 1                                              17120053
171300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17130053
171400                   OR (SQLCODE = ZERO))                           17140053
171500         EVALUATE TRUE                                            17150053
171600             WHEN CSR-CLASS                                       17160053
171700                 MOVE 'CURSOR:  CSR-CLS'                          17170053
171800                                   TO DP013-MESSAGE-TEXT (2)      17180053
171900                 EXEC SQL                                         17190053
172000                      OPEN CSR-CLS                                17200053
172100                 END-EXEC                                         17210053
172200                                                                  17220053
172300             WHEN CSR-MAJOR-CLASS                                 17230053
172400                 MOVE 'CURSOR:  CSR-MAJOR-CLASS'                  17240053
172500                                   TO DP013-MESSAGE-TEXT (2)      17250053
172600                 EXEC SQL                                         17260053
172700                      OPEN CSR-MAJOR-CLASS                        17270053
172800                 END-EXEC                                         17280053
172900                                                                  17290053
173000             WHEN CSR-SUB-CLASS                                   17300053
173100                 MOVE 'CURSOR:  CSR-SUB-CLASS'                    17310053
173200                                   TO DP013-MESSAGE-TEXT (2)      17320053
173300                 EXEC SQL                                         17330053
173400                      OPEN CSR-SUB-CLASS                          17340053
173500                 END-EXEC                                         17350053
173600         END-EVALUATE                                             17360053
173700                                                                  17370053
173800         EVALUATE TRUE                                            17380053
173900             WHEN SQLCODE = ZERO                                  17390053
174000             WHEN SQLCODE = -904                                  17400053
174100             WHEN SQLCODE = -913                                  17410053
174200                 CONTINUE                                         17420053
174300             WHEN SQLWARN0 NOT = SPACES                           17430053
174400             WHEN SQLCODE < ZERO                                  17440053
174500             WHEN SQLCODE > ZERO                                  17450053
174600                 MOVE '4010-OPEN-CURSOR'                          17460053
174700                                   TO DP013-PARAGRAPH             17470053
174800                 MOVE 'OPEN CLASS CURSOR - '                      17480053
174900                                   TO DP013-MESSAGE-TEXT (1)      17490053
175000                 MOVE SQLCA        TO DP013-SQLCA                 17500053
175100                 MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)    17510053
175200                 SET DP013-DB2-ABEND                              17520053
175300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17530053
175400                 PERFORM DP013-0000-PROCESS-ABEND                 17540053
175500         END-EVALUATE                                             17550053
175600     END-PERFORM.                                                 17560053
175700*                                                                 17570053
175800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17580053
175900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17590053
176000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17600053
176100                                   TO DP013-MESSAGE-TEXT (1)      17610053
176200         MOVE SQLCA                TO DP013-SQLCA                 17620053
176300         MOVE 'TSYMSG  '           TO DP013-DB2-TABLE-NAME (1)    17630053
176400         SET DP013-DB2-ABEND                                      17640053
176500             DP013-XCTL-DISPLAY-RESTART                           17650053
176600                                   TO TRUE                        17660053
176700         PERFORM DP013-0000-PROCESS-ABEND                         17670053
176800     END-IF.                                                      17680053
176900                                                                  17690053
177000 EJECT                                                            17700053
177100*----------------------------------------------------------------*17710053
177200* CLOSE THE CURSOR.                                              *17720053
177300*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17730053
177400*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17740053
177500*   USER.                                                        *17750053
177600*----------------------------------------------------------------*17760053
177700                                                                  17770053
177800 4020-CLOSE-CURSOR.                                               17780053
177900     EVALUATE TRUE                                                17790053
178000         WHEN CSR-CLASS                                           17800053
178100             EXEC SQL                                             17810053
178200                 CLOSE CSR-CLS                                    17820053
178300             END-EXEC                                             17830053
178400                                                                  17840053
178500         WHEN CSR-MAJOR-CLASS                                     17850053
178600             EXEC SQL                                             17860053
178700                 CLOSE CSR-MAJOR-CLASS                            17870053
178800             END-EXEC                                             17880053
178900                                                                  17890053
179000         WHEN CSR-SUB-CLASS                                       17900053
179100             EXEC SQL                                             17910053
179200                 CLOSE CSR-SUB-CLASS                              17920053
179300             END-EXEC                                             17930053
179400     END-EVALUATE.                                                17940053
179500*                                                                 17950053
179600     EVALUATE TRUE                                                17960053
179700         WHEN SQLCODE = ZERO                                      17970053
179800             CONTINUE                                             17980053
179900         WHEN SQLWARN0 NOT = SPACES                               17990053
180000         WHEN SQLCODE < ZERO                                      18000053
180100         WHEN SQLCODE > ZERO                                      18010053
180200             MOVE '4020-CLOSE-CURSOR'                             18020053
180300                               TO DP013-PARAGRAPH                 18030053
180400             MOVE 'CLOSE SYSTEM MESSAGE CURSOR '                  18040053
180500                               TO DP013-MESSAGE-TEXT (1)          18050053
180600             MOVE SQLCA        TO DP013-SQLCA                     18060053
180700             MOVE 'TSYMSG  '   TO DP013-DB2-TABLE-NAME (1)        18070053
180800             SET DP013-DB2-ABEND                                  18080053
180900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18090053
181000             PERFORM DP013-0000-PROCESS-ABEND                     18100053
181100     END-EVALUATE.                                                18110053
181200                                                                  18120053
181300 EJECT                                                            18130053
181400*----------------------------------------------------------------*18140053
181500*    SET UP THE HOST VARIABLES.                                  *18150053
181600*----------------------------------------------------------------*18160053
181700                                                                  18170053
181800 4100-PREPARE-CURSOR.                                             18180053
181900                                                                  18190053
182000     IF ASC-SUB-CL = 0                                            18200053
182100        SET CSR-MAJOR-CLASS       TO TRUE                         18210053
182200        MOVE 'CSR-MAJOR-CLASS ' TO PV-CURSOR-NAME                 18220053
182300     ELSE                                                         18230053
182400        IF ASC-MAJ-CL = 0                                         18240053
182500           SET CSR-SUB-CLASS         TO TRUE                      18250053
182600           MOVE 'CSR-SUB-CLASS   ' TO PV-CURSOR-NAME              18260053
182700        ELSE                                                      18270053
182800           SET CSR-CLASS TO TRUE                                  18280053
182900           MOVE 'CSR-CLASS       ' TO PV-CURSOR-NAME              18290053
183000        END-IF.                                                   18300053
183100                                                                  18310053
183200 EJECT                                                            18320053
183300*--------------------------------------------------------------*  18330053
183400*    IF THE REGION PRICE INDICATOR IS SET TO "Y"               *  18340053
183500*       TRY TO READ THE XST_SKU_LOC ROW FOR THAT SPECIFIC      *  18350053
183600*       STORE.  IF IT IS FOUND, THAT'S THE CURRENT RETAIL TO   *  18360053
183700*       DISPLAY ON THE SCREEN.  IF IT ISN'T FOUND, READ THE    *  18370053
183800*       ROW FOR STORE 0 AND DISPLAY THAT PRICE FOR CURRENT     *  18380053
183900*       RETAIL.                                                *  18390053
184000*    ELSE                                                      *  18400053
184100*       READ THE ROW FOR STORE 0 AND DISPLAY THAT PRICE FOR    *  18410053
184200*       THE CURRENT RETAIL.                                    *  18420053
184300*                                                              *  18430053
184400*--------------------------------------------------------------*  18440053
184500 4200-GET-STATUS-AND-RETAIL.                                      18450053
184600                                                                  18460053
184700     MOVE XST00010-INTR-UPC-ID TO PV-INTR-UPC-ID.                 18470053
184800                                                                  18480053
184900     IF XST00010-REGN-PRIC-IND = 'Y'                              18490053
185000        MOVE ASC-LOCATION-NBR TO PV-STORE-NUMBER                  18500053
185100                                                                  18510053
185200        PERFORM 4220-SELECT-CURRENT-RETAIL                        18520053
185300        IF PS-CURRENT-RETAIL-FOUND                                18530053
185400           IF ASC-LOCATION-NBR NOT = ZERO                         18540053
185500              AND PV-STATUS-CODE = PC-STATUS-25                   18550053
185600                MOVE PC-STATUS-20 TO PV-STATUS-CODE               18560053
185700           END-IF                                                 18570053
185800        ELSE                                                      18580053
185900           MOVE 0 TO PV-STORE-NUMBER                              18590053
186000           PERFORM 4220-SELECT-CURRENT-RETAIL                     18600053
186100           IF ASC-LOCATION-NBR NOT = ZERO                         18610053
186200              AND PV-STATUS-CODE = PC-STATUS-25                   18620053
186300                MOVE PC-STATUS-20 TO PV-STATUS-CODE               18630053
186400           END-IF                                                 18640053
186500        END-IF                                                    18650053
186600     ELSE                                                         18660053
186700        MOVE 0 TO PV-STORE-NUMBER                                 18670053
186800        PERFORM 4220-SELECT-CURRENT-RETAIL                        18680053
186900     END-IF.                                                      18690053
187000                                                                  18700053
187100*--------------------------------------------------------------*  18710053
187200*    NOTE: STORE 0 IS ALWAYS PRESENT FOR ALL UPCS.             *  18720053
187300*          THERE MAY BE OR MAY NOT BE ROWS FOR STORES FOR A    *  18730053
187400*          SPECIFIC UPC.                                       *  18740053
187500*                                                              *  18750053
187600*--------------------------------------------------------------*  18760053
187700 4220-SELECT-CURRENT-RETAIL.                                      18770053
187800                                                                  18780053
187900     EXEC SQL                                                     18790053
188000        SELECT LOC_SKU_STAT_CDE                                   18800053
188100              ,UNT_RTL_AMT                                        18810053
188200          INTO :XST00008-LOC-SKU-STAT-CDE                         18820053
188300              ,:XST00008-UNT-RTL-AMT                              18830053
188400          FROM XST_SKU_LOC                                        18840053
188500         WHERE INTR_UPC_ID = :PV-INTR-UPC-ID                      18850053
188600           AND LOC_NBR     = :PV-STORE-NUMBER                     18860053
188700           AND ((BEG_TMST <= CURRENT TIMESTAMP                    18870053
188800           AND   END_TMST >= CURRENT TIMESTAMP)                   18880053
188900            OR  (BEG_TMST <= CURRENT TIMESTAMP                    18890053
189000           AND   END_TMST IS NULL))                               18900053
189100     END-EXEC                                                     18910053
189200                                                                  18920053
189300     EVALUATE TRUE                                                18930053
189400         WHEN SQLCODE = ZERO                                      18940053
189500              SET PS-CURRENT-RETAIL-FOUND TO TRUE                 18950053
189600              MOVE XST00008-LOC-SKU-STAT-CDE                      18960053
189700                                    TO PV-STATUS-CODE             18970053
189800              MOVE XST00008-UNT-RTL-AMT                           18980053
189900                                     TO PV-UNT-RTL-AMT            18990053
190000                                                                  19000053
190100         WHEN SQLCODE = +100                                      19010053
190200              SET PS-CURRENT-RETAIL-NOT-FOUND TO TRUE             19020053
190300              MOVE 0 TO PV-UNT-RTL-AMT                            19030053
190400                                                                  19040053
190500         WHEN OTHER                                               19050053
190600              MOVE '4220-SELECT-CURRENT-RETAIL' TO                19060053
190700                                        DP013-PARAGRAPH           19070053
190800              SET  DP013-DB2-ABEND                                19080053
190900                   DP013-XCTL-DISPLAY-RESTART TO TRUE             19090053
191000              MOVE SQLCA            TO DP013-SQLCA                19100053
191100              MOVE 'XST_SKU_LOC  ' TO DP013-DB2-TABLE-NAME (1)    19110053
191200              STRING 'SELECT STATUS FROM '                        19120053
191300                      DP013-DB2-TABLE-NAME (1)                    19130053
191400                     ' TABLE HAD BAD SQLCODE '                    19140053
191500                     ' - '                                        19150053
191600                      DELIMITED BY SIZE                           19160053
191700                      INTO DP013-MESSAGE-TEXT (1)                 19170053
191800              MOVE PV-INTR-UPC-ID  TO DK-INTR-UPC-ID-PIC9         19180053
191900              MOVE PV-STORE-NUMBER TO DK-STORE-NBR-PIC9           19190053
192000              STRING 'KEYS ARE - INTR UPC ID - '                  19200053
192100                      DK-INTR-UPC-ID-PIC9                         19210053
192200                     ' STORE NBR - '                              19220053
192300                      DK-STORE-NBR-PIC9                           19230053
192400                      DELIMITED BY SIZE                           19240053
192500                      INTO DP013-MESSAGE-TEXT (2)                 19250053
192600              PERFORM DP013-0000-PROCESS-ABEND                    19260053
192700                                                                  19270053
192800     END-EVALUATE.                                                19280053
192900                                                                  19290053
193000 EJECT                                                            19300053
193100*----------------------------------------------------------------*19310053
193200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *19320053
193300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *19330053
193400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *19340053
193500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *19350053
193600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *19360053
193700*                                                                *19370053
193800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *19380053
193900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *19390053
194000*    UPON INITIALIZATION.                                        *19400053
194100*----------------------------------------------------------------*19410053
194200                                                                  19420053
194300 4300-READ-ITEMS-FROM-DB.                                         19430053
194400                                                                  19440053
194500     PERFORM                                                      19450053
194600         VARYING PV-READ-COUNT                                    19460053
194700         FROM 1 BY 1                                              19470053
194800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    19480053
194900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         19490053
195000                                                                  19500053
195100         PERFORM 4310-FETCH                                       19510053
195200         PERFORM 4200-GET-STATUS-AND-RETAIL                       19520053
195300                                                                  19530053
195400*       --- IF STATUS ENTERED ON CRITERIA SCREEN, CHECK FOR MATCH 19540053
195500         IF ASC-STATUS = SPACES                                   19550053
195600            SET PS-STATUS-MATCH TO TRUE                           19560053
195700         ELSE                                                     19570053
195800            IF ASC-STATUS = PV-STATUS-CODE                        19580053
195900               SET PS-STATUS-MATCH TO TRUE                        19590053
196000            ELSE                                                  19600053
196100               SET PS-STATUS-NO-MATCH TO TRUE                     19610053
196200            END-IF                                                19620053
196300         END-IF                                                   19630053
196400                                                                  19640053
196500         IF  ASC-ITEMS-LEFT-ON-DB                                 19650053
196600               AND PS-STATUS-MATCH                                19660053
196700             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                19670053
196800                 ADD +1            TO ASC-ITEM-SUB                19680053
196900             ELSE                                                 19690053
197000                 ADD +1            TO ASC-BLK-SUB                 19700053
197100                 MOVE +1           TO ASC-ITEM-SUB                19710053
197200                                                                  19720053
197300                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         19730053
197400                     MOVE +1       TO ASC-BLK-SUB                 19740053
197500                     SET ASC-BLOCK-MODIFIED (1)                   19750053
197600                                   TO TRUE                        19760053
197700                     PERFORM 5100-WRITE-TEMP-STORAGE              19770053
197800                     MOVE ASC-BLOCK-ENTRIES                       19780053
197900                               (PC-MAX-BLOCKS-IN-ARRAY)           19790053
198000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 19800053
198100                     ADD +1        TO ASC-BLK-SUB                 19810053
198200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   19820053
198300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      19830053
198400                                   TO TRUE                        19840053
198500                 END-IF                                           19850053
198600             END-IF                                               19860053
198700                                                                  19870053
198800             ADD +1                   TO ASC-NUMBER-OF-ITEMS-READ 19880053
198900             MOVE ASC-NUMBER-OF-ITEMS-READ                        19890053
199000                                      TO ASC-LIST-ITEM-NUMBER     19900053
199100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19910053
199200             MOVE XST00013-MAJ-CL-NBR TO ASC-DET-MAJ-CL           19920053
199300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19930053
199400             MOVE XST00013-SUB-CL-NBR TO ASC-DET-SUB-CL           19940053
199500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19950053
199600             MOVE XST00010-SKU-DESC   TO ASC-SKU-DESC             19960053
199700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19970053
199800             MOVE XST00012-UPC-NBR    TO ASC-UPC-NBR              19980053
199900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19990053
200000             MOVE PV-STATUS-CODE      TO ASC-STAT-CDE             20000053
200100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20010053
200200             MOVE PV-UNT-RTL-AMT      TO ASC-CUR-RTL-AMT          20020053
200300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20030053
200400             MOVE XST00010-NRF-CLOR-DESC TO ASC-COLOR             20040053
200500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20050053
200600             MOVE XST00010-SIZE-DESC  TO ASC-SIZE                 20060053
200700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20070053
200800                                                                  20080053
200900*            --- GET STORE ONHAND ---                             20090053
201000             PERFORM 7000-CALL-XMKCS001                           20100053
201100             PERFORM 7400-CALL-XLKCS074                           20110053
201200                                                                  20120053
201300             COMPUTE PV-WORK-QTY-NUM = PV-ONHAND-QTY -            20130065
201400                                         PV-STORE-EXPECTED-QTY    20140065
201500                                                                  20150053
201600             MOVE PV-WORK-QTY-NUM TO ASC-STR-ONHAND               20160065
201700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 20170053
201800             ADD PV-WORK-QTY-NUM  TO ASC-TOTAL-ONHANDS            20180065
201900         END-IF                                                   20190053
202000     END-PERFORM.                                                 20200053
202100                                                                  20210053
202200     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          20220053
202300         MOVE +1               TO ASC-BLK-SUB                     20230053
202400         PERFORM 5100-WRITE-TEMP-STORAGE                          20240053
202500         ADD +1                TO ASC-BLK-SUB                     20250053
202600         PERFORM 5100-WRITE-TEMP-STORAGE                          20260053
202700                                                                  20270053
202800         MOVE 1                TO ASC-BLK-SUB                     20280053
202900                                  PV-BLOCK-NUMBER                 20290053
203000         PERFORM 4410-READ-TEMP-STORAGE                           20300053
203100         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             20310053
203200             MOVE 2            TO ASC-BLK-SUB                     20320053
203300                                  PV-BLOCK-NUMBER                 20330053
203400             PERFORM 4410-READ-TEMP-STORAGE                       20340053
203500         END-IF                                                   20350053
203600     END-IF.                                                      20360053
203700 EJECT                                                            20370053
203800*----------------------------------------------------------------*20380053
203900*    FETCH THE CURSOR.                                            20390053
204000*----------------------------------------------------------------*20400053
204100                                                                  20410053
204200 4310-FETCH.                                                      20420053
204300                                                                  20430053
204400     EVALUATE TRUE                                                20440053
204500         WHEN CSR-CLASS                                           20450053
204600              EXEC SQL                                            20460053
204700                   FETCH CSR-CLS                                  20470053
204800                    INTO :XST00012-UPC-NBR,                       20480053
204900                         :XST00013-DEPT-NBR,                      20490053
205000                         :XST00013-MAJ-CL-NBR,                    20500053
205100                         :XST00013-SUB-CL-NBR,                    20510053
205200                         :XST00010-SKU-NBR,                       20520053
205300                         :XST00010-SIZE-DESC,                     20530053
205400                         :XST00010-SKU-DESC,                      20540053
205500                         :XST00010-NRF-CLOR-DESC,                 20550053
205600                         :XST00010-INTR-UPC-ID,                   20560053
205700                         :XST00010-REGN-PRIC-IND                  20570053
205800              END-EXEC                                            20580053
205900                                                                  20590053
206000         WHEN CSR-MAJOR-CLASS                                     20600053
206100              EXEC SQL                                            20610053
206200                   FETCH CSR-MAJOR-CLASS                          20620053
206300                    INTO :XST00012-UPC-NBR,                       20630053
206400                         :XST00013-DEPT-NBR,                      20640053
206500                         :XST00013-MAJ-CL-NBR,                    20650053
206600                         :XST00013-SUB-CL-NBR,                    20660053
206700                         :XST00010-SKU-NBR,                       20670053
206800                         :XST00010-SIZE-DESC,                     20680053
206900                         :XST00010-SKU-DESC,                      20690053
207000                         :XST00010-NRF-CLOR-DESC,                 20700053
207100                         :XST00010-INTR-UPC-ID,                   20710053
207200                         :XST00010-REGN-PRIC-IND                  20720053
207300              END-EXEC                                            20730053
207400                                                                  20740053
207500         WHEN CSR-SUB-CLASS                                       20750053
207600              EXEC SQL                                            20760053
207700                   FETCH CSR-SUB-CLASS                            20770053
207800                   INTO  :XST00012-UPC-NBR,                       20780053
207900                         :XST00013-DEPT-NBR,                      20790053
208000                         :XST00013-MAJ-CL-NBR,                    20800053
208100                         :XST00013-SUB-CL-NBR,                    20810053
208200                         :XST00010-SKU-NBR,                       20820053
208300                         :XST00010-SIZE-DESC,                     20830053
208400                         :XST00010-SKU-DESC,                      20840053
208500                         :XST00010-NRF-CLOR-DESC,                 20850053
208600                         :XST00010-INTR-UPC-ID,                   20860053
208700                         :XST00010-REGN-PRIC-IND                  20870053
208800              END-EXEC                                            20880053
208900     END-EVALUATE.                                                20890053
209000                                                                  20900053
209100     EVALUATE TRUE                                                20910053
209200         WHEN SQLCODE = ZERO                                      20920053
209300         WHEN SQLCODE = +100                                      20930053
209400              CONTINUE                                            20940053
209500         WHEN SQLWARN0 NOT = SPACE                                20950053
209600         WHEN SQLCODE NOT = ZERO                                  20960053
209700              MOVE '4310-FETCH'   TO DP013-PARAGRAPH              20970053
209800              STRING 'FETCH FOR CURSOR '                          20980053
209900                     PV-CURSOR-NAME                               20990053
210000                     DELIMITED BY SIZE                            21000053
210100                INTO DP013-MESSAGE-TEXT (1)                       21010053
210200              MOVE SQLCA          TO DP013-SQLCA                  21020053
210300              SET DP013-DB2-ABEND TO TRUE                         21030053
210400              PERFORM DP013-0000-PROCESS-ABEND                    21040053
210500     END-EVALUATE.                                                21050053
210600                                                                  21060053
210700     IF  SQLCODE EQUAL +100                                       21070053
210800         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      21080053
210900     END-IF.                                                      21090053
211000                                                                  21100053
211100 EJECT                                                            21110053
211200*----------------------------------------------------------------*21120053
211300* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *21130053
211400*----------------------------------------------------------------*21140053
211500                                                                  21150053
211600 4400-MOVE-COMMAREA-TO-SCREEN.                                    21160053
211700     MOVE ASC-DEPT-NBR      TO ADEPTO.                            21170053
211800     MOVE ASC-DEPT-DESC     TO ADPTDSCO.                          21180053
211900     MOVE ASC-LOCATION-NBR  TO ASTOREO.                           21190053
212000     MOVE ASC-STORE-NAME    TO ASTRNAMO.                          21200053
212100     MOVE ASC-TOTAL-ONHANDS TO ATOTLOHO.                          21210053
212200                                                                  21220053
212300     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             21230053
212400         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          21240053
212500         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          21250053
212600             MOVE +1    TO ASC-BLK-SUB                            21260053
212700             PERFORM 5100-WRITE-TEMP-STORAGE                      21270053
212800             ADD +1     TO ASC-BLK-SUB                            21280053
212900             PERFORM 5100-WRITE-TEMP-STORAGE                      21290053
213000             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             21300053
213100                 GIVING PV-BLOCK-NUMBER                           21310053
213200                 REMAINDER PV-REMAINDER                           21320053
213300             IF  PV-REMAINDER > ZERO                              21330053
213400                 ADD +1 TO PV-BLOCK-NUMBER                        21340053
213500             END-IF                                               21350053
213600             MOVE +1    TO ASC-BLK-SUB                            21360053
213700             PERFORM 4410-READ-TEMP-STORAGE                       21370053
213800             ADD +1     TO ASC-BLK-SUB                            21380053
213900                           PV-BLOCK-NUMBER                        21390053
214000             PERFORM 4410-READ-TEMP-STORAGE                       21400053
214100     END-IF.                                                      21410053
214200     MOVE +1            TO ASC-BLK-SUB.                           21420053
214300     COMPUTE ASC-ITEM-SUB =                                       21430053
214400         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              21440053
214500         + PC-ITEMS-PER-PANEL).                                   21450053
214600*                                                                 21460053
214700     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        21470053
214800         ADD +1         TO ASC-BLK-SUB                            21480053
214900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            21490053
215000     END-IF.                                                      21500053
215100*                                                                 21510053
215200     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           21520053
215300         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                21530053
215400     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        21540053
215500     PERFORM 4420-FORMAT-LIST-LINES                               21550053
215600         VARYING PV-SUB                                           21560053
215700         FROM PC-ITEMS-PER-PANEL BY -1                            21570053
215800         UNTIL PV-SUB < +1.                                       21580053
215900*                                                                 21590053
216000     COMPUTE ASC-ITEMS-DISPLAYED =                                21600053
216100         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          21610053
216200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    21620053
216300                                      ASTRTITO.                   21630053
216400     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    21640053
216500     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    21650053
216600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21660053
216700                                   TO ASELITO.                    21670053
216800*                                                                 21680053
216900     IF  DP020-MSG-NUMBER-X = SPACE                               21690053
217000         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  21700053
217100*            --- MORE ITEMS TO DISPLAY ----                       21710053
217200             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            21720053
217300             SET DP020-MSG-INFORMATIONAL TO TRUE                  21730053
217400         END-IF                                                   21740053
217500     END-IF.                                                      21750053
217600*----------------------------------------------------------------*21760053
217700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *21770053
217800*----------------------------------------------------------------*21780053
217900                                                                  21790053
218000 4410-READ-TEMP-STORAGE.                                          21800053
218100                                                                  21810053
218200     EXEC CICS                                                    21820053
218300         READQ TS                                                 21830053
218400             QUEUE (ASC-LIST-QUEUE-NAME)                          21840053
218500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21850053
218600             ITEM  (PV-BLOCK-NUMBER)                              21860053
218700             RESP  (PV-CICS-RESP)                                 21870053
218800     END-EXEC.                                                    21880053
218900                                                                  21890053
219000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       21900053
219100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     21910053
219200         CONTINUE                                                 21920053
219300     ELSE                                                         21930053
219400         SET DP013-CICS-ABEND     TO TRUE                         21940053
219500         SET DP013-NO-ROLLBACK    TO TRUE                         21950053
219600         MOVE '4410-READ-TEMP-STORAGE'                            21960053
219700                                  TO DP013-PARAGRAPH              21970053
219800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      21980053
219900                                  TO DP013-MESSAGE-TEXT(1)        21990053
220000         PERFORM DP013-0000-PROCESS-ABEND                         22000053
220100     END-IF.                                                      22010053
220200                                                                  22020053
220300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22030053
220400*                                                                 22040053
220500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         22050053
220600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               22060053
220700     END-IF.                                                      22070053
220800 EJECT                                                            22080053
220900*----------------------------------------------------------------*22090053
221000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *22100053
221100*----------------------------------------------------------------*22110053
221200                                                                  22120053
221300 4420-FORMAT-LIST-LINES.                                          22130053
221400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      22140053
221500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                22150053
221600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           22160053
221700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           22170053
221800         MOVE SPACE              TO MR-SELECTI (PV-SUB)           22180053
221900                                    MR-MAJ-CLX (PV-SUB)           22190053
222000                                    MR-SUB-CLX (PV-SUB)           22200053
222100                                    MR-SKU-DESC (PV-SUB)          22210053
222200                                    MR-UPC-NBR (PV-SUB)           22220053
222300                                    MR-STAT-CDE (PV-SUB)          22230053
222400                                    MR-UNT-RTL-AMTX (PV-SUB)      22240053
222500                                    MR-OH-COLOR (PV-SUB)          22250053
222600                                    MR-SIZE-DESC (PV-SUB)         22260053
222700     ELSE                                                         22270053
222800         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22280053
222900                                                   > SPACE        22290053
223000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 22300053
223100                                 TO MR-SELECTI (PV-SUB)           22310053
223200         ELSE                                                     22320053
223300             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      22330053
223400                                 TO MR-SELECTI (PV-SUB)           22340053
223500         END-IF                                                   22350053
223600*                                                                 22360053
223700         IF  DP030-SET-CURSOR-TRAILER                             22370053
223800             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)22380053
223900                 > SPACE)                                         22390053
224000               OR (PV-SUB = 1))                                   22400053
224100                SET DP030-SET-CURSOR-APPL-1 TO TRUE               22410053
224200                MOVE -1          TO MR-SELECTL (PV-SUB)           22420053
224300             END-IF                                               22430053
224400         END-IF                                                   22440053
224500*                                                                 22450053
224600*        --- CHECK IF CHANGING DISPLAY BETWEEN OH & COLOR/SIZE    22460053
224700         IF ASC-CHANGE-DISPLAY OR                                 22470053
224800            (PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL)          22480053
224900             MOVE ASC-DET-MAJ-CL (ASC-BLK-SUB ASC-ITEM-SUB)       22490053
225000                                   TO MR-MAJ-CL (PV-SUB)          22500053
225100             MOVE ASC-DET-SUB-CL (ASC-BLK-SUB ASC-ITEM-SUB)       22510053
225200                                   TO MR-SUB-CL (PV-SUB)          22520053
225300             MOVE ASC-SKU-DESC (ASC-BLK-SUB ASC-ITEM-SUB)         22530053
225400                                   TO MR-SKU-DESC (PV-SUB)        22540053
225500             MOVE ASC-UPC-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          22550053
225600                                   TO MR-UPC-NBR (PV-SUB)         22560053
225700             MOVE ASC-STAT-CDE (ASC-BLK-SUB ASC-ITEM-SUB)         22570053
225800                                   TO MR-STAT-CDE (PV-SUB)        22580053
225900             MOVE ASC-CUR-RTL-AMT (ASC-BLK-SUB ASC-ITEM-SUB)      22590053
226000                                   TO MR-UNT-RTL-AMT (PV-SUB)     22600053
226100             IF ASC-DISPLAY-ONHAND                                22610053
226200                MOVE ASC-STR-ONHAND (ASC-BLK-SUB ASC-ITEM-SUB)    22620053
226300                                   TO MR-ONHAND (PV-SUB)          22630053
226400                MOVE SPACES        TO MR-SIZE-DESC (PV-SUB)       22640053
226500                                      ASIZHDRO                    22650053
226600                MOVE PC-ONHAND-HDR TO AOHCOLRO                    22660053
226700             ELSE                                                 22670053
226800*               --- DISPLAY COLOR/SIZE ---                        22680053
226900                MOVE ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)         22690053
227000                                   TO MR-OH-COLOR (PV-SUB)        22700053
227100                MOVE ASC-SIZE (ASC-BLK-SUB ASC-ITEM-SUB)          22710053
227200                                   TO MR-SIZE-DESC (PV-SUB)       22720053
227300                MOVE PC-COLOR-HDR  TO AOHCOLRO                    22730053
227400                MOVE PC-SIZE-HDR   TO ASIZHDRO                    22740053
227500             END-IF                                               22750053
227600         END-IF                                                   22760053
227700     END-IF.                                                      22770053
227800                                                                  22780053
227900     SUBTRACT +1 FROM ASC-ITEM-SUB                                22790053
228000     IF  ASC-ITEM-SUB < + 1                                       22800053
228100         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  22810053
228200         MOVE +1                 TO ASC-BLK-SUB                   22820053
228300     END-IF.                                                      22830053
228400******************************************************************22840053
228500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **22850053
228600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **22860053
228700** ISSUE A WARNING.                                             **22870053
228800******************************************************************22880053
228900 4430-CHECK-FOR-BEGIN-AND-END.                                    22890053
229000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       22900053
229100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     22910053
229200*            -- NO END-OF-RANGE SPECFIED ---                      22920053
229300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            22930053
229400             SET DP020-MSG-WARNING TO TRUE                        22940053
229500             PERFORM 4431-POSITION-AT-WARNING                     22950053
229600         END-IF                                                   22960053
229700     ELSE                                                         22970053
229800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     22980053
229900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                22990053
230000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            23000053
230100             SET DP020-MSG-WARNING TO TRUE                        23010053
230200             PERFORM 4431-POSITION-AT-WARNING                     23020053
230300         END-IF                                                   23030053
230400     END-IF.                                                      23040053
230500******************************************************************23050053
230600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **23060053
230700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **23070053
230800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **23080053
230900** POSITION THE CURSOR THERE.                                   **23090053
231000******************************************************************23100053
231100 4431-POSITION-AT-WARNING.                                        23110053
231200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 23120053
231300                    - PV-TOP-ITEM + 1.                            23130053
231400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23140053
231500         CONTINUE                                                 23150053
231600     ELSE                                                         23160053
231700         SET DP030-SET-CURSOR-APPL-1                              23170053
231800                                   TO TRUE                        23180053
231900         MOVE -1                   TO MR-SELECTL (PV-SUB)         23190053
232000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23200053
232100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23210053
232200     END-IF.                                                      23220053
232300*                                                                 23230053
232400     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   23240053
232500                    - PV-TOP-ITEM + 1.                            23250053
232600     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      23260053
232700         CONTINUE                                                 23270053
232800     ELSE                                                         23280053
232900         SET DP030-SET-CURSOR-APPL-1                              23290053
233000                                   TO TRUE                        23300053
233100         MOVE -1                   TO MR-SELECTL (PV-SUB)         23310053
233200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         23320053
233300         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         23330053
233400     END-IF.                                                      23340053
233500 EJECT                                                            23350053
233600*----------------------------------------------------------------*23360053
233700* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *23370053
233800* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *23380053
233900* FOR THE SELECTED ITEMS QUEUE.                                  *23390053
234000*                                                                *23400053
234100* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *23410053
234200* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *23420053
234300* THE ARRAY IS FULL.                                             *23430053
234400*----------------------------------------------------------------*23440053
234500                                                                  23450053
234600 5000-PREPARE-SEL-QUEUE.                                          23460053
234700                                                                  23470053
234800     MOVE +1                   TO  ASC-BLK-SUB.                   23480053
234900     PERFORM 5100-WRITE-TEMP-STORAGE.                             23490053
235000     ADD +1                    TO  ASC-BLK-SUB.                   23500053
235100     PERFORM 5100-WRITE-TEMP-STORAGE.                             23510053
235200                                                                  23520053
235300     MOVE ASC-SEL-QUEUE-NAME   TO  IQ016-SEL-QUEUE-NAME.          23530053
235400     PERFORM 6010-DELETE-SEL-QUEUE.                               23540053
235500                                                                  23550053
235600     SET ASC-UPDATE-TSQ        TO  TRUE.                          23560053
235700                                                                  23570053
235800     SET IQ014-IDX             TO  1.                             23580053
235900     MOVE ZERO                 TO IQ016-NUMBER-OF-TS-ITEMS.       23590053
236000     INITIALIZE IQ014-SELECTED-ITEM-ARRAY.                        23600053
236100                                                                  23610053
236200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           23620053
236300             VARYING PV-ITEM                                      23630053
236400             FROM 1 BY 1                                          23640053
236500             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     23650053
236600                                                                  23660053
236700     IF  IQ014-IDX > 1                                            23670053
236800         PERFORM 5205-WRITE-SEL-QUEUE                             23680053
236900         ADD +1                TO IQ016-NUMBER-OF-TS-ITEMS        23690053
237000     END-IF.                                                      23700053
237100 EJECT                                                            23710053
237200*----------------------------------------------------------------*23720053
237300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *23730053
237400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *23740053
237500*----------------------------------------------------------------*23750053
237600                                                                  23760053
237700 5100-WRITE-TEMP-STORAGE.                                         23770053
237800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     23780053
237900                                   TO PV-LIST-ITEM-NUMBER.        23790053
238000     COMPUTE PV-BLOCK-NUMBER =                                    23800053
238100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    23810053
238200                                                                  23820053
238300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             23830053
238400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             23840053
238500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      23850053
238600             PERFORM 5105-REWRITE-ASC-LISTQ                       23860053
238700         END-IF                                                   23870053
238800     ELSE                                                         23880053
238900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       23890053
239000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            23900053
239100         PERFORM 5110-WRITE-ASC-LISTQ                             23910053
239200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   23920053
239300     END-IF.                                                      23930053
239400                                                                  23940053
239500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             23950053
239600******************************************************************23960053
239700** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **23970053
239800** SPECIFIC COMMAREA.                                           **23980053
239900******************************************************************23990053
240000 5105-REWRITE-ASC-LISTQ.                                          24000053
240100     EXEC CICS                                                    24010053
240200         WRITEQ TS                                                24020053
240300             QUEUE (ASC-LIST-QUEUE-NAME)                          24030053
240400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24040053
240500             ITEM  (PV-BLOCK-NUMBER)                              24050053
240600             REWRITE                                              24060053
240700             RESP  (PV-CICS-RESP)                                 24070053
240800     END-EXEC.                                                    24080053
240900                                                                  24090053
241000     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           24100053
241100         CONTINUE                                                 24110053
241200     ELSE                                                         24120053
241300         SET DP013-CICS-ABEND            TO TRUE                  24130053
241400         SET DP013-NO-ROLLBACK           TO TRUE                  24140053
241500         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       24150053
241600         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     24160053
241700                                         TO DP013-MESSAGE-TEXT(1) 24170053
241800         PERFORM DP013-0000-PROCESS-ABEND                         24180053
241900     END-IF.                                                      24190053
242000                                                                  24200053
242100******************************************************************24210053
242200** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **24220053
242300** SPECIFIC COMMAREA.                                           **24230053
242400******************************************************************24240053
242500 5110-WRITE-ASC-LISTQ.                                            24250053
242600     EXEC CICS                                                    24260053
242700         WRITEQ TS                                                24270053
242800             QUEUE (ASC-LIST-QUEUE-NAME)                          24280053
242900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               24290053
243000             ITEM  (PV-BLOCK-NUMBER)                              24300053
243100             RESP  (PV-CICS-RESP)                                 24310053
243200     END-EXEC.                                                    24320053
243300     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      24330053
243400         SET DP013-CICS-ABEND      TO TRUE                        24340053
243500         SET DP013-NO-ROLLBACK     TO TRUE                        24350053
243600         MOVE '5110-WRITE-ASC-LISTQ'                              24360053
243700                                   TO DP013-PARAGRAPH             24370053
243800         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           24380053
243900                                   TO DP013-MESSAGE-TEXT(1)       24390053
244000         PERFORM DP013-0000-PROCESS-ABEND                         24400053
244100     END-IF.                                                      24410053
244200 EJECT                                                            24420053
244300*----------------------------------------------------------------*24430053
244400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *24440053
244500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *24450053
244600*----------------------------------------------------------------*24460053
244700                                                                  24470053
244800 5200-FILL-SEL-QUEUE-RECORD.                                      24480053
244900                                                                  24490053
245000     PERFORM 6112-READ-LIST-QUEUE.                                24500053
245100                                                                  24510053
245200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       24520053
245300         PERFORM                                                  24530053
245400         VARYING LQW-IDX                                          24540053
245500         FROM 1 BY 1                                              24550053
245600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            24560053
245700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          24570053
245800                                                                  24580053
245900             IF  LQW-SELECT (LQW-IDX)                             24590053
246000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              24600053
246100                             TO IQ014-ITEM (IQ014-IDX)            24610053
246200                 MOVE LQW-MAJ-CL      (LQW-IDX)                   24620053
246300                             TO IQ014-MAJ-CL    (IQ014-IDX)       24630053
246400                 MOVE LQW-SUB-CL      (LQW-IDX)                   24640053
246500                             TO IQ014-SUB-CL    (IQ014-IDX)       24650053
246600                 MOVE LQW-UPC-NBR     (LQW-IDX)                   24660053
246700                             TO IQ014-UPC-NBR   (IQ014-IDX)       24670053
246800                 MOVE LQW-STAT-CDE    (LQW-IDX)                   24680053
246900                             TO IQ014-STAT-CDE  (IQ014-IDX)       24690053
247000                 MOVE LQW-COLOR       (LQW-IDX)                   24700053
247100                             TO IQ014-CLOR-DESC (IQ014-IDX)       24710053
247200                 MOVE LQW-SIZE        (LQW-IDX)                   24720053
247300                             TO IQ014-SIZE-DESC (IQ014-IDX)       24730053
247400                 MOVE LQW-CUR-RTL-AMT (LQW-IDX)                   24740053
247500                             TO IQ014-RTL-AMT   (IQ014-IDX)       24750053
247600                 SET IQ014-IDX UP BY 1                            24760053
247700                 IF  IQ014-IDX > IQ014-MAX-ITEMS                  24770053
247800                     PERFORM 5205-WRITE-SEL-QUEUE                 24780053
247900                     ADD +1        TO IQ016-NUMBER-OF-TS-ITEMS    24790053
248000                     INITIALIZE IQ014-SELECTED-ITEM-ARRAY         24800053
248100                     SET IQ014-IDX TO  1                          24810053
248200                 END-IF                                           24820053
248300             END-IF                                               24830053
248400         END-PERFORM                                              24840053
248500     END-IF.                                                      24850053
248600                                                                  24860053
248700*----------------------------------------------------------------*24870053
248800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *24880053
248900*----------------------------------------------------------------*24890053
249000                                                                  24900053
249100 5205-WRITE-SEL-QUEUE.                                            24910053
249200                                                                  24920053
249300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            24930053
249400                                   TO IQ014-SELECTED-ITEMS.       24940053
249500                                                                  24950053
249600     EXEC CICS                                                    24960053
249700          WRITEQ TS                                               24970053
249800              QUEUE (ASC-SEL-QUEUE-NAME)                          24980053
249900              FROM  (IQ014-MESSAGE-SEL-REC)                       24990053
250000              ITEM  (PV-SEL-QUEUE-ITEM)                           25000053
250100              RESP  (PV-CICS-RESP)                                25010053
250200     END-EXEC.                                                    25020053
250300                                                                  25030053
250400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25040053
250500         CONTINUE                                                 25050053
250600     ELSE                                                         25060053
250700         SET DP013-CICS-ABEND      TO TRUE                        25070053
250800         SET DP013-NO-ROLLBACK     TO TRUE                        25080053
250900         MOVE '5205-WRITE-SEL-QUEUE'                              25090053
251000                                   TO DP013-PARAGRAPH             25100053
251100         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          25110053
251200                                   TO DP013-MESSAGE-TEXT(1)       25120053
251300         PERFORM DP013-0000-PROCESS-ABEND                         25130053
251400     END-IF.                                                      25140053
251500 EJECT                                                            25150053
251600******************************************************************25160053
251700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **25170053
251800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **25180053
251900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **25190053
252000** THE USER.                                                    **25200053
252100******************************************************************25210053
252200 6000-REFRESH-PANEL-FROM-TEMP.                                    25220053
252300     IF  ASC-UPDATE-TSQ                                           25230053
252400         SET ASC-NO-TSQ-UPDATE TO TRUE                            25240053
252500         MOVE ZERO                 TO PV-SAVE-ITEM                25250053
252600                                      PV-SEL-QUEUE-ITEM           25260053
252700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        25270053
252800                                   TO PV-HOLD-SELECTED-ITEMS      25280053
252900         MOVE +1                   TO PV-ITEMS-PROCESSED          25290053
253000         PERFORM 6100-UPDATE-TSQ                                  25300053
253100             UNTIL PV-ITEMS-PROCESSED >                           25310053
253200                                     PV-HOLD-SELECTED-ITEMS       25320053
253300         PERFORM 6010-DELETE-SEL-QUEUE                            25330053
253400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         25340053
253500                    ASC-BLOCK-ENTRIES (2)                         25350053
253600     END-IF.                                                      25360053
253700                                                                  25370053
253800*----------------------------------------------------------------*25380053
253900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *25390053
254000*----------------------------------------------------------------*25400053
254100 6010-DELETE-SEL-QUEUE.                                           25410053
254200                                                                  25420053
254300     EXEC CICS                                                    25430053
254400         DELETEQ TS                                               25440053
254500             QUEUE (ASC-SEL-QUEUE-NAME)                           25450053
254600             RESP  (PV-CICS-RESP)                                 25460053
254700     END-EXEC.                                                    25470053
254800*                                                                 25480053
254900     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      25490053
255000        (PV-CICS-RESP = DFHRESP(QIDERR)))                         25500053
255100         CONTINUE                                                 25510053
255200     ELSE                                                         25520053
255300         SET DP013-CICS-ABEND TO TRUE                             25530053
255400         SET DP013-NO-ROLLBACK TO TRUE                            25540053
255500         MOVE '6010-DELETE-SEL-QUEUE'                             25550053
255600                        TO DP013-PARAGRAPH                        25560053
255700         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         25570053
255800                        TO DP013-MESSAGE-TEXT (1)                 25580053
255900         PERFORM DP013-0000-PROCESS-ABEND                         25590053
256000     END-IF.                                                      25600053
256100                                                                  25610053
256200*----------------------------------------------------------------*25620053
256300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *25630053
256400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *25640053
256500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *25650053
256600*    THE TEMP QUEUE.                                             *25660053
256700*----------------------------------------------------------------*25670053
256800                                                                  25680053
256900 6100-UPDATE-TSQ.                                                 25690053
257000                                                                  25700053
257100     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             25710053
257200     PERFORM 6105-READ-SEL-QUEUE.                                 25720053
257300     PERFORM                                                      25730053
257400         VARYING IQ014-IDX                                        25740053
257500         FROM 1 BY 1                                              25750053
257600         UNTIL ((PV-ITEMS-PROCESSED >                             25760053
257700                              PV-HOLD-SELECTED-ITEMS)             25770053
257800         OR (IQ014-IDX GREATER THAN IQ014-MAX-ITEMS))             25780053
257900           PERFORM 6110-PROCESS-ITEMS                             25790053
258000           ADD +1                TO PV-ITEMS-PROCESSED            25800053
258100     END-PERFORM.                                                 25810053
258200     PERFORM 6111-WRITE-LIST-QUEUE.                               25820053
258300*----------------------------------------------------------------*25830053
258400*    READ THE LIST QUEUE RECORD.                                 *25840053
258500*----------------------------------------------------------------*25850053
258600                                                                  25860053
258700 6105-READ-SEL-QUEUE.                                             25870053
258800                                                                  25880053
258900     EXEC CICS                                                    25890053
259000          READQ TS                                                25900053
259100              QUEUE (ASC-SEL-QUEUE-NAME)                          25910053
259200              INTO  (IQ014-MESSAGE-SEL-REC)                       25920053
259300              ITEM  (PV-SEL-QUEUE-ITEM)                           25930053
259400              RESP  (PV-CICS-RESP)                                25940053
259500     END-EXEC.                                                    25950053
259600*                                                                 25960053
259700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25970053
259800         CONTINUE                                                 25980053
259900     ELSE                                                         25990053
260000         SET DP013-CICS-ABEND      TO  TRUE                       26000053
260100         SET DP013-NO-ROLLBACK     TO  TRUE                       26010053
260200         MOVE '6105-READ-SEL-QUEUE'                               26020053
260300                                   TO  DP013-PARAGRAPH            26030053
260400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           26040053
260500                                   TO  DP013-MESSAGE-TEXT(1)      26050053
260600         PERFORM DP013-0000-PROCESS-ABEND                         26060053
260700     END-IF.                                                      26070053
260800 EJECT                                                            26080053
260900*----------------------------------------------------------------*26090053
261000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*26100053
261100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*26110053
261200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *26120053
261300*----------------------------------------------------------------*26130053
261400                                                                  26140053
261500 6110-PROCESS-ITEMS.                                              26150053
261600                                                                  26160053
261700     COMPUTE PV-ITEM = 1 + ((IQ014-ITEM (IQ014-IDX) - 1)          26170053
261800                     / PC-ITEMS-PER-PANEL).                       26180053
261900                                                                  26190053
262000     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           26200053
262100         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          26210053
262200             PERFORM 6111-WRITE-LIST-QUEUE                        26220053
262300         END-IF                                                   26230053
262400         MOVE PV-ITEM          TO PV-SAVE-ITEM                    26240053
262500                                                                  26250053
262600         PERFORM 6112-READ-LIST-QUEUE                             26260053
262700         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               26270053
262800             CONTINUE                                             26280053
262900         END-IF                                                   26290053
263000     END-IF.                                                      26300053
263100                                                                  26310053
263200     COMPUTE PV-SUB = (IQ014-ITEM (IQ014-IDX)                     26320053
263300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              26330053
263400     SET LQW-DESELECT (PV-SUB) TO    TRUE                         26340053
263500     MOVE LQW-SELECTED-SW (PV-SUB)                                26350053
263600                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  26360053
263700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                26370053
263800                                                                  26380053
263900*----------------------------------------------------------------*26390053
264000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *26400053
264100*----------------------------------------------------------------*26410053
264200                                                                  26420053
264300 6111-WRITE-LIST-QUEUE.                                           26430053
264400                                                                  26440053
264500     EXEC CICS                                                    26450053
264600         WRITEQ TS                                                26460053
264700             QUEUE (ASC-LIST-QUEUE-NAME)                          26470053
264800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     26480053
264900             ITEM  (PV-SAVE-ITEM)                                 26490053
265000             REWRITE                                              26500053
265100             RESP  (PV-CICS-RESP)                                 26510053
265200     END-EXEC.                                                    26520053
265300*                                                                 26530053
265400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26540053
265500         CONTINUE                                                 26550053
265600     ELSE                                                         26560053
265700         SET DP013-CICS-ABEND  TO  TRUE                           26570053
265800         SET DP013-NO-ROLLBACK TO  TRUE                           26580053
265900         MOVE '6111-WRITE-LIST-QUEUE'                             26590053
266000                               TO  DP013-PARAGRAPH                26600053
266100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  26610053
266200                               TO  DP013-MESSAGE-TEXT(1)          26620053
266300         PERFORM DP013-0000-PROCESS-ABEND                         26630053
266400     END-IF.                                                      26640053
266500                                                                  26650053
266600 EJECT                                                            26660053
266700*----------------------------------------------------------------*26670053
266800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*26680053
266900*----------------------------------------------------------------*26690053
267000                                                                  26700053
267100 6112-READ-LIST-QUEUE.                                            26710053
267200                                                                  26720053
267300     EXEC CICS                                                    26730053
267400         READQ TS                                                 26740053
267500             QUEUE (ASC-LIST-QUEUE-NAME)                          26750053
267600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     26760053
267700             ITEM  (PV-ITEM)                                      26770053
267800             RESP  (PV-CICS-RESP)                                 26780053
267900     END-EXEC.                                                    26790053
268000*                                                                 26800053
268100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          26810053
268200         CONTINUE                                                 26820053
268300     ELSE                                                         26830053
268400         SET DP013-CICS-ABEND        TO TRUE                      26840053
268500         SET DP013-NO-ROLLBACK       TO TRUE                      26850053
268600         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           26860053
268700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    26870053
268800                                     TO DP013-MESSAGE-TEXT(1)     26880053
268900         PERFORM DP013-0000-PROCESS-ABEND                         26890053
269000     END-IF.                                                      26900053
269100                                                                  26910053
269200 EJECT                                                            26920053
269300*--------------------------------------------------------------*  26930053
269400*    XMKCS001 RETRIEVES THE ON HAND, ON ORDER QUANTITIES,      *  26940053
269500*        LAST RECEIVED DATE AND LAST SALE DATE.                *  26950053
269600*                                                              *  26960053
269700*--------------------------------------------------------------*  26970053
269800 7000-CALL-XMKCS001.                                              26980053
269900                                                                  26990053
270000     INITIALIZE XM003-ITEM-COMMAREA.                              27000053
270100     SET XM003-ONORDER-NO TO TRUE.                                27010053
270200     SET XM003-ONHAND-YES TO TRUE.                                27020053
270300                                                                  27030053
270400     MOVE ASC-LOCATION-NBR TO XM003-KEY-STR-NBR.                  27040053
270500     MOVE XST00010-SKU-NBR TO XM003-KEY-SKU.                      27050053
270600     MOVE LENGTH OF XM003-ITEM-COMMAREA TO PV-COMMAREA-LENGTH.    27060053
270700                                                                  27070053
270800     EXEC CICS                                                    27080053
270900          LINK                                                    27090053
271000               PROGRAM (PC-XMKCS001)                              27100053
271100              COMMAREA (XM003-ITEM-COMMAREA)                      27110053
271200                LENGTH (PV-COMMAREA-LENGTH)                       27120053
271300                  RESP (PV-CICS-RESPONSE)                         27130053
271400     END-EXEC.                                                    27140053
271500                                                                  27150053
271600     EVALUATE TRUE                                                27160053
271700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 27170053
271800              EVALUATE TRUE                                       27180053
271900                  WHEN XM003-SUCCESSFUL                           27190053
272000                      MOVE XM003-ONHAND TO PV-ONHAND-QTY          27200053
272100                                                                  27210053
272200                  WHEN OTHER                                      27220053
272300                      IF XM003-RETURN-SQLCODE = +100              27230053
272400                         MOVE ZERO TO PV-ONHAND-QTY               27240053
272500                      ELSE                                        27250053
272600                         MOVE ZERO TO PV-ONHAND-QTY               27260053
272700                         MOVE PC-TSYMSG-03388 TO DP020-MSG-NUMBER 27270053
272800                         SET DP020-MSG-INFORMATIONAL TO TRUE      27280053
272900*                                                                 27290053
273000*                        STRING 'INVALID RETURN CODE '            27300053
273100*                                'FROM XMKCS001 '                 27310053
273200*                                 XM003-RETURN-SQLCODE            27320053
273300*                                ' - '                            27330053
273400*                                 XM003-RETURN-ONORDER            27340053
273500*                                ' - '                            27350053
273600*                                 XM003-RETURN-ONHAND             27360053
273700*                                 DELIMITED BY SIZE               27370053
273800*                                 INTO DP013-MESSAGE-TEXT (2)     27380053
273900*                         PERFORM 7100-FORMAT-ERROR               27390053
274000                       END-IF                                     27400053
274100                                                                  27410053
274200              END-EVALUATE                                        27420053
274300                                                                  27430053
274400         WHEN OTHER                                               27440053
274500             MOVE ZERO TO PV-ONHAND-QTY                           27450053
274600             MOVE PC-TSYMSG-03388 TO DP020-MSG-NUMBER             27460053
274700             SET DP020-MSG-INFORMATIONAL TO TRUE                  27470053
274800*                                                                 27480053
274900*             MOVE PV-CICS-RESPONSE TO PV-CICS-RESPONSE-9         27490053
275000*             STRING 'INVALID CICS RETURN CODE ON CALL '          27500053
275100*                    'TO XMKCS001 - '                             27510053
275200*                     PV-CICS-RESPONSE-9                          27520053
275300*                     DELIMITED BY SIZE                           27530053
275400*                     INTO DP013-MESSAGE-TEXT (2)                 27540053
275500*             PERFORM 7100-FORMAT-ERROR                           27550053
275600                                                                  27560053
275700     END-EVALUATE.                                                27570053
275800                                                                  27580053
275900                                                                  27590053
276000*--------------------------------------------------------------*  27600053
276100*    ERROR HANDLING FOR XMKCS001                               *  27610053
276200*--------------------------------------------------------------*  27620053
276300 7100-FORMAT-ERROR.                                               27630053
276400                                                                  27640053
276500     MOVE '7000-CALL-XMKCS001        '                            27650053
276600                                  TO DP013-PARAGRAPH.             27660053
276700     MOVE 'RETRIEVE ONHAND QUANTITIES ERROR'                      27670053
276800                      TO DP013-MESSAGE-TEXT (1).                  27680053
276900     SET   DP013-DB2-ABEND                                        27690053
277000           DP013-XCTL-DISPLAY-RESTART TO TRUE.                    27700053
277100     PERFORM DP013-0000-PROCESS-ABEND.                            27710053
277200                                                                  27720053
277300 EJECT                                                            27730053
277400*--------------------------------------------------------------*  27740053
277500*    XLKCS074 RETRIEVES THE INTRANSIT QUANTITY AND STORE       *  27750053
277600*        EXPECTED QUANTITY.                                    *  27760053
277700*                                                              *  27770053
277800*--------------------------------------------------------------*  27780053
277900 7400-CALL-XLKCS074.                                              27790053
278000                                                                  27800053
278100     INITIALIZE XL074-ITEM-COMMAREA.                              27810053
278200     SET XL074-BY-SKU       TO TRUE.                              27820057
278300     MOVE XST00010-SKU-NBR  TO XL074-KEY-SKU.                     27830057
278400                                                                  27840053
278500     MOVE ASC-LOCATION-NBR  TO XL074-KEY-LOC-NBR.                 27850055
278600                                                                  27860056
278700     IF ASC-LOCATION-NBR = ZERO                                   27870053
278800        SET XL074-BY-ALL-LOCATIONS TO TRUE                        27880053
278900     ELSE                                                         27890053
279000        SET XL074-BY-STORE         TO TRUE                        27900053
279100     END-IF.                                                      27910053
279200                                                                  27920053
279300     CALL XL074-ONLINE-PGM USING DFHEIBLK                         27930053
279400                                 XL074-COMMAREA                   27940053
279500                                 XL074-ITEM-COMMAREA.             27950053
279600                                                                  27960053
279700     EVALUATE TRUE                                                27970053
279800         WHEN XL074-SUCCESSFUL                                    27980053
279900              MOVE XL074-SE-QTY TO PV-STORE-EXPECTED-QTY          27990053
280000                                                                  28000053
280100         WHEN XL074-SQL-ERROR                                     28010053
280200             MOVE ZERO TO PV-STORE-EXPECTED-QTY                   28020053
280300             MOVE PC-TSYMSG-03388 TO DP020-MSG-NUMBER             28030053
280400             SET DP020-MSG-INFORMATIONAL TO TRUE                  28040053
280500*                                                                 28050053
280600*             MOVE XL074-KEY-SKU TO DK-SKU-NBR                    28060053
280700*             STRING 'INVALID RETURN CODE FROM XLKCS074 '         28070053
280800*                     XL074-SQLCODE                               28080053
280900*                    ' - '                                        28090053
281000*                     DK-SKU-NBR                                  28100053
281100*                    ' - '                                        28110053
281200*                     DELIMITED BY SIZE                           28120053
281300*                     INTO DP013-MESSAGE-TEXT (2)                 28130053
281400*             PERFORM 7500-FORMAT-ERROR                           28140053
281500                                                                  28150053
281600         WHEN OTHER                                               28160053
281700             IF XL074-SKU-NOT-FOUND                               28170059
281800                MOVE ZERO TO PV-STORE-EXPECTED-QTY                28180059
281900             ELSE                                                 28190059
282000                MOVE ZERO TO PV-STORE-EXPECTED-QTY                28200059
282100                MOVE PC-TSYMSG-03388 TO DP020-MSG-NUMBER          28210059
282200                SET DP020-MSG-INFORMATIONAL TO TRUE               28220059
282300             END-IF                                               28230059
282400                                                                  28240053
282500     END-EVALUATE.                                                28250053
282600                                                                  28260053
282700                                                                  28270053
282800*--------------------------------------------------------------*  28280053
282900*    ERROR HANDLING FOR XLKCS074                               *  28290053
283000*--------------------------------------------------------------*  28300053
283100 7500-FORMAT-ERROR.                                               28310053
283200                                                                  28320053
283300     MOVE '7400-CALL-XLKCS074        '                            28330053
283400                                  TO DP013-PARAGRAPH.             28340053
283500     STRING 'RETRIEVE INTRANSIT AND STORE EXPECTED QTY ERROR'     28350053
283600            'IN PARAGRAPH '                                       28360053
283700             XL074-ERROR-PARAGRAPH-NBR                            28370053
283800             DELIMITED BY SIZE                                    28380053
283900             INTO DP013-MESSAGE-TEXT (1).                         28390053
284000     SET   DP013-DB2-ABEND                                        28400053
284100           DP013-XCTL-DISPLAY-RESTART TO TRUE.                    28410053
284200     MOVE XL074-SQLCA   TO SQLCA.                                 28420053
284300     MOVE XL074-SQLCODE TO SQLCODE.                               28430053
284400     PERFORM DP013-0000-PROCESS-ABEND.                            28440053
284500                                                                  28450053
284600 EJECT                                                            28460053
284700*----------------------------------------------------------------*28470053
284800*    READ XST_DEPT TABLE TO GET DEPARTMENT NAME                   28480053
284900*----------------------------------------------------------------*28490053
285000 7600-GET-DEPT-NAME.                                              28500053
285100     PERFORM                                                      28510053
285200         WITH TEST AFTER                                          28520053
285300         VARYING PV-RETRY-COUNTER                                 28530053
285400         FROM 1 BY 1                                              28540053
285500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               28550053
285600               OR SQLCODE = ZERO                                  28560053
285700               OR SQLCODE = +100)                                 28570053
285800                                                                  28580053
285900         EXEC SQL                                                 28590053
286000              SELECT DEPT_NM                                      28600053
286100                INTO :XST00015-DEPT-NM                            28610053
286200                FROM  XST_DEPT                                    28620053
286300               WHERE  DEPT_NBR = :DK-DEPT-NBR                     28630053
286400         END-EXEC                                                 28640053
286500                                                                  28650053
286600         EVALUATE TRUE                                            28660053
286700            WHEN SQLCODE = ZERO                                   28670053
286800            WHEN SQLCODE = -911                                   28680053
286900            WHEN SQLCODE = -913                                   28690053
287000                 CONTINUE                                         28700053
287100             WHEN SQLCODE = +100                                  28710053
287200                 MOVE SPACES TO XST00015-DEPT-NM                  28720053
287300             WHEN SQLWARN0 NOT = SPACES                           28730053
287400             WHEN SQLCODE  NOT = ZERO                             28740053
287500                 MOVE 'SELECT FROM XST_DEPT HAD BAD SQLCODE '     28750053
287600                                   TO DP013-MESSAGE-TEXT(1)       28760053
287700                 MOVE SQLCA        TO DP013-SQLCA                 28770053
287800                 SET DP013-DB2-ABEND                              28780053
287900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28790053
288000                 PERFORM DP013-0000-PROCESS-ABEND                 28800053
288100         END-EVALUATE                                             28810053
288200     END-PERFORM.                                                 28820053
288300*                                                                 28830053
288400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         28840053
288500        MOVE 'MAX RETRIES EXCEEDED ON SELECT'                     28850053
288600                        TO DP013-MESSAGE-TEXT (1)                 28860053
288700        MOVE SQLCA      TO DP013-SQLCA                            28870053
288800        MOVE 'XST_DEPT' TO DP013-DB2-TABLE-NAME (1)               28880053
288900        SET DP013-DB2-ABEND                                       28890053
289000            DP013-XCTL-DISPLAY-RESTART TO TRUE                    28900053
289100        PERFORM DP013-0000-PROCESS-ABEND                          28910053
289200     END-IF.                                                      28920053
289300 EJECT                                                            28930053
289400*----------------------------------------------------------------*28940053
289500*    READ XST_LOC TABLE TO GET STORE NAME                         28950053
289600*----------------------------------------------------------------*28960053
289700 7700-GET-STORE-NAME.                                             28970053
289800     MOVE ASC-LOCATION-NBR TO XST00001-LOC-NBR.                   28980053
289900                                                                  28990053
290000     PERFORM                                                      29000053
290100         WITH TEST AFTER                                          29010053
290200         VARYING PV-RETRY-COUNTER                                 29020053
290300         FROM 1 BY 1                                              29030053
290400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29040053
290500               OR SQLCODE = ZERO                                  29050053
290600               OR SQLCODE = +100)                                 29060053
290700                                                                  29070053
290800         EXEC SQL                                                 29080053
290900              SELECT LOC_NM                                       29090053
291000                INTO :XST00001-LOC-NM                             29100053
291100                FROM  XST_LOC LOC                                 29110053
291200               WHERE  LOC_NBR = :XST00001-LOC-NBR                 29120053
291300                 AND (LOC.OCPNC_DTE <= CURRENT DATE               29130053
291400                  OR  LOC.OPN_DTE <= CURRENT DATE)                29140053
291500                 AND (LOC.CLO_DTE >= CURRENT DATE                 29150053
291600                  OR  LOC.CLO_DTE IS NULL)                        29160053
291700         END-EXEC                                                 29170053
291800                                                                  29180053
291900         EVALUATE TRUE                                            29190053
292000            WHEN SQLCODE = ZERO                                   29200053
292100            WHEN SQLCODE = -911                                   29210053
292200            WHEN SQLCODE = -913                                   29220053
292300                 CONTINUE                                         29230053
292400            WHEN SQLCODE = +100                                   29240053
292500                 MOVE SPACES TO XST00001-LOC-NM                   29250053
292600                                ASTRNAMO                          29260062
292700                 MOVE PC-TSYMSG-00017  TO DP020-MSG-NUMBER        29270053
292800                 SET PS-ERROR                                     29280053
292900                     DP020-MSG-FATAL   TO TRUE                    29290053
293000                                                                  29300053
293100                 MOVE DP015-UNP-ALP-BRT-OFF TO ASTOREA            29310053
293200                 MOVE DP015-RED             TO ASTOREC            29320053
293300                 MOVE DP015-REVERSE         TO ASTOREH            29330053
293400                 MOVE -1                    TO ASTOREL            29340053
293500                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              29350053
293600            WHEN SQLWARN0 NOT = SPACES                            29360053
293700            WHEN SQLCODE  NOT = ZERO                              29370053
293800                 MOVE 'SELECT FROM XST_LOC HAD BAD SQLCODE '      29380053
293900                                   TO DP013-MESSAGE-TEXT(1)       29390053
294000                 MOVE SQLCA        TO DP013-SQLCA                 29400053
294100                 SET DP013-DB2-ABEND                              29410053
294200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29420053
294300                 PERFORM DP013-0000-PROCESS-ABEND                 29430053
294400         END-EVALUATE                                             29440053
294500     END-PERFORM.                                                 29450053
294600*                                                                 29460053
294700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         29470053
294800        MOVE 'MAX RETRIES EXCEEDED ON SELECT'                     29480053
294900                       TO DP013-MESSAGE-TEXT (1)                  29490053
295000        MOVE SQLCA     TO DP013-SQLCA                             29500053
295100        MOVE 'XST_LOC' TO DP013-DB2-TABLE-NAME (1)                29510053
295200        SET DP013-DB2-ABEND                                       29520053
295300            DP013-XCTL-DISPLAY-RESTART TO TRUE                    29530053
295400        PERFORM DP013-0000-PROCESS-ABEND                          29540053
295500     END-IF.                                                      29550053
295600 EJECT                                                            29560053
295700*----------------------------------------------------------------*29570053
295800*    ABEND PROCESSOR MODULE                                      *29580053
295900*----------------------------------------------------------------*29590053
296000                                                                  29600053
296100     COPY DPPD013.                                                29610053
