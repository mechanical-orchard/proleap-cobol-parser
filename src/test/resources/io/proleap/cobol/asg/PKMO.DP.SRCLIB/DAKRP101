       IDENTIFICATION DIVISION.                                         00010000
                                                                        00020000
       PROGRAM-ID.             DAKRP101.                                00030004
       AUTHOR.                 BOB MCASEY.                              00040000
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
       DATE-WRITTEN.           JULY 2000.                               00060000
       DATE-COMPILED.                                                   00070000
                                                                        00080000
      ***************************************************************** 00090000
      *  PROGRAM NARRATIVE:                                           * 00100000
      *  THIS PROGRAM READS AN EXTRACT FROM THE DEBIT ALLOWANCE ORACLE* 00110000
      *  ONLINE APPLICATION AND CREATES A REPORT OF DEBIT ALLOWANCE   * 00120000
      *  PRICE CHANGE AMOUNTS IN ASCENDING ORDER BY PRINT CHANGE #    * 00130000
      ***************************************************************** 00140000
      ***************************************************************** 00150012
      *    WR/PITS#     DATE        DESCRIPTION                       * 00160012
      *    --------   ----------   ---------------------------------  * 00170012
0701RM*   WR22467     07/20/2001   CHANGED RECORD LENGTH OF AP TRANS  * 00180012
      *                            FILE AND ALL PROCESSING ASSOCIATE  * 00190012
      *                            WITH IT.                           * 00200012
      *   WR23724     05/15/2002   RECOMPILED FOR CHANGES IN COPYBOOK * 00210013
      *                            APRD045                            * 00220013
      *---------------------------------------------------------------* 00230012
      *                                                                 00240000
      /                                                                 00250000
       ENVIRONMENT DIVISION.                                            00260000
                                                                        00270000
       CONFIGURATION SECTION.                                           00280000
                                                                        00290000
       SOURCE-COMPUTER.                        IBM-3090.                00300000
       OBJECT-COMPUTER.                        IBM-3090.                00310000
                                                                        00320000
       INPUT-OUTPUT SECTION.                                            00330000
                                                                        00340000
       FILE-CONTROL.                                                    00350000
                                                                        00360000
           SELECT  AP-TRANS-FILE             ASSIGN TO INP01.           00370007
           SELECT CONTROL-CARD-FILE          ASSIGN TO INP02.           00380005
           SELECT  REPORT-FILE               ASSIGN RPT01.              00390005
                                                                        00400000
      ******************************************************************00410000
       DATA DIVISION.                                                   00420000
      ******************************************************************00430000
                                                                        00440000
       FILE SECTION.                                                    00450000
      *                                                                 00460000
       FD  AP-TRANS-FILE                                                00470007
           LABEL RECORDS ARE STANDARD                                   00480000
           RECORDING MODE IS F                                          00490000
           BLOCK CONTAINS 0 RECORDS.                                    00500000
0701RM*01  AP-TRANS-REC                  PIC X(450).                    00510012
0701RM 01  AP-TRANS-REC                  PIC X(550).                    00520012
                                                                        00530000
       FD  CONTROL-CARD-FILE                                            00540005
           RECORDING MODE IS F                                          00550005
           LABEL RECORDS ARE STANDARD                                   00560005
           BLOCK CONTAINS 0 RECORDS.                                    00570005
                                                                        00580005
       01  CONTROL-CARD-RECORD           PIC X(80).                     00590005
                                                                        00600005
       FD  REPORT-FILE                                                  00610000
           RECORDING MODE F                                             00620000
           LABEL RECORDS OMITTED                                        00630000
           BLOCK CONTAINS  0 RECORDS.                                   00640000
       01  REPORT-RECORD.                                               00650000
           05  REPORT-LINE               PIC X(80).                     00660000
      *                                                                 00670000
                                                                        00680000
      *                                                                 00690000
       WORKING-STORAGE SECTION.                                         00700000
                                                                        00710000
       01  ABEND-CODE                PIC S9(04) VALUE ZERO              00720000
                                                       COMP SYNC.       00730000
                                                                        00740000
       01  PA-PROGRAM-ACCUMULATORS.                                     00750000
           05  PA-LINE-COUNT         PIC S9(03)    COMP-3 VALUE 0.      00760000
           05  PA-LINE-NO            PIC S9(03)    COMP-3 VALUE 0.      00770000
           05  PA-PAGE-COUNT         PIC S9(05)    COMP-3 VALUE 0.      00780000
           05  PA-IN-COUNT           PIC S9(09)    COMP-3 VALUE 0.      00790000
           05  PA-TOTAL-READ         PIC S9(09)    COMP-3 VALUE 0.      00800000
           05  PA-AP-TOTAL-WRITTEN   PIC S9(09)    COMP-3 VALUE 0.      00810000
           05  PA-DA-TOTAL-WRITTEN   PIC S9(09)    COMP-3 VALUE 0.      00820000
           05  PA-TOTAL-CREDIT-AMT   PIC S9(09)V99 COMP-3 VALUE 0.      00830000
           05  PA-TOTAL-RTL-AMT      PIC S9(09)V99 COMP-3 VALUE 0.      00840000
           05  PA-TOTAL-RTL          PIC S9(09)V99 COMP-3 VALUE 0.      00850000
           05  PA-TOTAL-COST         PIC S9(09)V99 COMP-3 VALUE 0.      00860000
                                                                        00870000
       01  PC-CONSTANTS.                                                00880000
           05  PC-OPERCO-NBR         PIC  X(02) VALUE '03'.             00890000
           05  PC-MDSELV-DPT         PIC  X(03) VALUE 'DPT'.            00900000
           05  PC-DAK001-JOB         PIC  X(06) VALUE 'DAK001'.         00910004
           05  PC-DAKRP101-PGM       PIC  X(08) VALUE 'DAKRP101'.       00920004
           05  PC-TOTAL-DESC         PIC  X(13) VALUE 'REPORT TOTAL:'.  00930000
           05  PC-NO-INPUT-MSG       PIC  X(80) VALUE                   00940000
               '          =====> NO INPUT <====                      '. 00950000
           05  PC-END-RPT-MSG        PIC  X(80) VALUE                   00960000
               '          * * *  END OF REPORT  * * *                '. 00970000
           05  PC-MAX-LINES          PIC S9(03)  VALUE 79.              00980000
                                                                        00990000
       01  PS-SWITCHES.                                                 01000000
           05  PS-EOF-EXTRACT-SWITCH PIC  X(01)   VALUE 'N'.            01010003
               88  PS-EOF-EXTRACT                 VALUE 'Y'.            01020003
                                                                        01030000
       01  PV-VARIABLES.                                                01040000
           05  PV-BTCH-SRC-CDE         PIC X(03)  VALUE SPACES.         01050000
           05  PV-RUN-TIME             PIC X(08)  VALUE SPACES.         01060000
           05  PV-RUN-DATE             PIC X(10)  VALUE SPACES.         01070000
           05  PV-EFF-DTE-TIME.                                         01080003
               10  PV-EFF-DTE          PIC X(10).                       01090003
               10  PV-EFF-TIME         PIC X(09).                       01100003
           05  PV-PARAGRAPH            PIC X(30)  VALUE SPACES.         01110000
           05  PV-OPERATION-ATTEMPTED  PIC X(40)  VALUE SPACES.         01120000
           05  PV-ABEND-MESSAGE        PIC X(75)  VALUE SPACES.         01130000
           05  PV-DISP-NUMBER          PIC Z,ZZZ,ZZ9.                   01140003
           05  PV-TOTAL-CREDITS        PIC S9(09)V99 COMP-3 VALUE 0.    01150000
           05  PV-TOTAL-CREDIT-AMT     PIC S9(09)V99 COMP-3 VALUE 0.    01160000
           05  PV-STMT-DTL-SEQ-NBR     PIC S9(05)    COMP-3 VALUE 0.    01170000
                                                                        01180000
      ***************************************************************** 01190000
      *  KOHL'S STANDARD FIRST HEADING LINE                             01200000
      ***************************************************************** 01210000
           COPY DPWS075O.                                               01220000
      *                                                                 01230000
       01  H2-HEADING2.                                                 01240000
           05  FILLER                PIC X(06) VALUE SPACES.            01250000
           05  FILLER                PIC X(54) VALUE                    01260000
           'DEBIT ALLOWANCE PRICE CHANGES BY PRICE CHANGE DOCUMENT'.    01270000
           05  FILLER                PIC X(04) VALUE SPACES.            01280000
           05  FILLER                PIC X(05) VALUE 'JOB: '.           01290000
           05  H2-JOB-NAME           PIC X(06) VALUE SPACES.            01300000
                                                                        01310000
       01  H3-HEADING3.                                                 01320000
           05  FILLER                PIC X(33) VALUE SPACES.            01330000
           05  FILLER                PIC X(07) VALUE 'BATCH: '.         01340000
           05  H3-BATCH-NBR          PIC X(03) VALUE SPACES.            01350000
           05  FILLER                PIC X(32) VALUE SPACES.            01360000
                                                                        01370000
                                                                        01380000
       01  H4-HEADING4.                                                 01390000
           05  FILLER                PIC X(02) VALUE SPACES.            01400000
           05  FILLER                PIC X(12) VALUE 'PRICE CHANGE'.    01410000
           05  FILLER                PIC X(03) VALUE SPACES.            01420001
           05  FILLER                PIC X(15) VALUE                    01430000
              'DEBIT ALLOWANCE'.                                        01440000
           05  FILLER                PIC X(06) VALUE SPACES.            01450001
           05  FILLER                PIC X(04) VALUE 'DEPT'.            01460001
           05  FILLER                PIC X(06) VALUE SPACES.            01470002
           05  FILLER                PIC X(04) VALUE 'COST'.            01480001
           05  FILLER                PIC X(12) VALUE SPACES.            01490002
           05  FILLER                PIC X(06) VALUE 'RETAIL'.          01500000
           05  FILLER                PIC X(05) VALUE SPACES.            01510000
                                                                        01520000
       01  DL1-DETAIL-LINE-1.                                           01530000
           05  FILLER                PIC X(05)     VALUE SPACES.        01540000
           05  DL1-CENPPC-NBR        PIC ZZZZZZ9   VALUE SPACES.        01550011
           05  FILLER                PIC X(05)     VALUE SPACES.        01560001
           05  DL1-DR-ALW-NBR        PIC X(16)     VALUE SPACES.        01570000
           05  FILLER                PIC X(05)     VALUE SPACES.        01580000
           05  DL1-DEPT-NBR          PIC X(03)     VALUE SPACES.        01590001
           05  FILLER                PIC X(02)     VALUE SPACES.        01600001
           05  DL1-COST-AMT          PIC ZZZZZZZZ9.99-.                 01610009
           05  FILLER                PIC X(05)     VALUE SPACES.        01620000
           05  DL1-RETAIL-AMT        PIC ZZZZZZZZ9.99-.                 01630009
           05  FILLER                PIC X(01)     VALUE SPACES.        01640000
                                                                        01650000
       01  TL1-TOTAL-LINE-1.                                            01660000
           05  FILLER                PIC X(02)     VALUE SPACES.        01670000
           05  TL1-DESC              PIC X(13)     VALUE SPACES.        01680000
           05  FILLER                PIC X(28)     VALUE SPACES.        01690001
           05  TL1-COST-AMT          PIC ZZZZZZZZ9.99-.                 01700009
           05  FILLER                PIC X(05)     VALUE SPACES.        01710000
           05  TL1-RETAIL-AMT        PIC ZZZZZZZZ9.99-.                 01720009
           05  FILLER                PIC X(01)     VALUE SPACES.        01730000
                                                                        01740000
      ***************************************************************** 01750007
      *  INPUT A/P RECORD LAYOUT  PLUS ADDITIONAL FIELDS              * 01760007
      ***************************************************************** 01770007
           COPY APRD045.                                                01780007
           05  PV-APRD045-BATCH-NBR    PIC X(03).                       01790007
           05  PV-APRD045-CENPPC-NBR   PIC S9(07)    COMP-3.            01800007
           05  PV-APRD045-RTL-AMT      PIC S9(09)V99 COMP-3.            01810007
           05  PV-APRD045-NET-CST-AMT  PIC S9(09)V99 COMP-3.            01820007
           05  PV-APRD045-EFF-DTE      PIC X(19).                       01830007
           05  FILLER                  PIC X(12).                       01840007
                                                                        01850007
      ****************************************************************  01860005
      * RECORD LAYOUT FOR CONTROL CARD FILE.                            01870005
      ****************************************************************  01880005
       01  CC-CONTROL-CARD.                                             01890005
           05  CC-CTL-DTE                   PIC X(10).                  01900005
           05  CC-CTL-FILLER                PIC X(70).                  01910005
      *                                                                 01920000
       PROCEDURE DIVISION.                                              01930000
                                                                        01940000
       0000-DAKRP101.                                                   01950004
                                                                        01960000
           PERFORM 1000-INITIALIZE                                      01970000
                                                                        01980000
           PERFORM 2000-PROCESS-EXTRACT                                 01990000
               UNTIL PS-EOF-EXTRACT.                                    02000000
                                                                        02010000
           PERFORM 9000-EOJ.                                            02020000
                                                                        02030000
           GOBACK.                                                      02040000
                                                                        02050000
                                                                        02060000
       1000-INITIALIZE.                                                 02070000
                                                                        02080000
           OPEN INPUT  AP-TRANS-FILE                                    02090007
                INPUT  CONTROL-CARD-FILE                                02100005
           OPEN OUTPUT REPORT-FILE.                                     02110000
                                                                        02120005
           PERFORM 8000-READ-CONTROL-CARD-FILE.                         02130005
           PERFORM 8200-READ-EXTRACT.                                   02140005
                                                                        02150000
           MOVE CC-CTL-DTE   (3:2)           TO DP075O-RUN-YEAR.        02160005
           MOVE CC-CTL-DTE   (6:2)           TO DP075O-RUN-MONTH.       02170005
           MOVE CC-CTL-DTE   (9:2)           TO DP075O-RUN-DAY.         02180005
           MOVE FUNCTION CURRENT-DATE (9:2)  TO DP075O-RUN-HOUR.        02190000
           MOVE FUNCTION CURRENT-DATE (11:2) TO DP075O-RUN-MINUTE.      02200000
           MOVE PC-DAKRP101-PGM              TO DP075O-PROGRAM-NAME.    02210004
           MOVE 1                            TO DP075O-REPORT-NUMBER.   02220000
                                                                        02230000
           PERFORM 4000-WRITE-REPORT-HEADING.                           02240000
           IF PS-EOF-EXTRACT                                            02250000
               DISPLAY 'NO DA INPUT -- REPORT WILL BE EMPTY'            02260000
           END-IF.                                                      02270000
                                                                        02280000
       2000-PROCESS-EXTRACT.                                            02290000
                                                                        02300000
                                                                        02310000
           MOVE PV-APRD045-CENPPC-NBR  TO DL1-CENPPC-NBR.               02320007
           MOVE AP045-DOC-NBR          TO DL1-DR-ALW-NBR.               02330007
           MOVE AP045-DEPT-NBR         TO DL1-DEPT-NBR.                 02340007
           MOVE PV-APRD045-NET-CST-AMT TO DL1-COST-AMT.                 02350007
                                                                        02360000
           MOVE PV-APRD045-RTL-AMT     TO DL1-RETAIL-AMT.               02370007
                                                                        02380000
           ADD PV-APRD045-RTL-AMT      TO PA-TOTAL-RTL.                 02390007
           ADD PV-APRD045-NET-CST-AMT  TO PA-TOTAL-COST.                02400007
                                                                        02410000
           PERFORM 5000-WRITE-REPORT-LINE.                              02420000
           PERFORM 8200-READ-EXTRACT.                                   02430005
                                                                        02440000
                                                                        02450000
       4000-WRITE-REPORT-HEADING.                                       02460000
      ******************************************************************02470000
      *   4000-WRITE-REPORT-HEADING                                    *02480000
      *      PRINT HEADING LINES                                       *02490000
      ******************************************************************02500000
                                                                        02510000
           ADD 1                               TO PA-PAGE-COUNT.        02520000
           MOVE PA-PAGE-COUNT                  TO DP075O-PAGE-NUMBER.   02530000
           MOVE DP075O-STANDARD-HEADER-75-COLS TO REPORT-RECORD.        02540000
           WRITE REPORT-RECORD                                          02550000
               AFTER ADVANCING PAGE.                                    02560000
                                                                        02570000
           MOVE PC-DAK001-JOB                  TO H2-JOB-NAME.          02580004
           MOVE H2-HEADING2                    TO REPORT-RECORD.        02590000
           WRITE REPORT-RECORD                                          02600000
               AFTER ADVANCING 1 LINE.                                  02610000
                                                                        02620000
           MOVE PV-APRD045-BATCH-NBR TO H3-BATCH-NBR.                   02630007
           MOVE H3-HEADING3          TO REPORT-RECORD.                  02640007
           WRITE REPORT-RECORD                                          02650000
               AFTER ADVANCING 1 LINE.                                  02660000
                                                                        02670000
           MOVE H4-HEADING4    TO REPORT-RECORD.                        02680000
           WRITE REPORT-RECORD                                          02690000
               AFTER ADVANCING 2 LINE.                                  02700001
                                                                        02710000
           MOVE 5                              TO PA-LINE-NO.           02720001
                                                                        02730000
       5000-WRITE-REPORT-LINE.                                          02740000
                                                                        02750000
           IF PA-LINE-NO > PC-MAX-LINES                                 02760000
               PERFORM 4000-WRITE-REPORT-HEADING                        02770000
           END-IF.                                                      02780000
                                                                        02790000
           WRITE REPORT-RECORD FROM DL1-DETAIL-LINE-1                   02800000
                  AFTER ADVANCING 1 LINES.                              02810000
           ADD 1 TO PA-LINE-NO.                                         02820000
                                                                        02830000
                                                                        02840000
       5600-WRITE-RPT-TOTALS.                                           02850000
           MOVE PC-TOTAL-DESC   TO TL1-DESC.                            02860000
           MOVE PA-TOTAL-RTL    TO TL1-RETAIL-AMT.                      02870000
           MOVE PA-TOTAL-COST   TO TL1-COST-AMT.                        02880000
                                                                        02890000
           WRITE REPORT-RECORD FROM TL1-TOTAL-LINE-1                    02900000
                  AFTER ADVANCING 3 LINES.                              02910000
                                                                        02920000
      *----------------------------------------------------------------*02930005
      *  READ CONTROL CARD FILE                                         02940005
      *----------------------------------------------------------------*02950005
       8000-READ-CONTROL-CARD-FILE.                                     02960005
                                                                        02970005
           READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD.                 02980005
                                                                        02990005
      *----------------------------------------------------------------*03000007
      *  READ INPUT AP-TRANS FILE                                       03010007
      *----------------------------------------------------------------*03020007
       8200-READ-EXTRACT.                                               03030005
           READ AP-TRANS-FILE INTO AP045-TRANSACTION-FILE               03040007
           AT END                                                       03050000
               SET PS-EOF-EXTRACT           TO TRUE                     03060000
           NOT AT END                                                   03070000
               ADD 1                        TO PA-TOTAL-READ            03080000
           END-READ.                                                    03090000
                                                                        03100000
      *************************************************************     03110000
      *  9000-EOJ IS PERFORMED FROM 0000-DAKRP101.  IT PRODUCES   *     03120004
      *  A 'NO INPUT' MESSAGE ON THE REPORT IF NONE WERE FOUND    *     03130007
      *  A DISPLAY OF THE NUMBER OF INPUT RECORDS IS DIAPLAYED    *     03140007
      *************************************************************     03150000
       9000-EOJ.                                                        03160000
                                                                        03170000
           IF PA-TOTAL-READ = ZERO                                      03180000
              WRITE REPORT-RECORD FROM PC-NO-INPUT-MSG                  03190000
                    AFTER ADVANCING 5 LINES                             03200000
           ELSE                                                         03210000
               PERFORM 5600-WRITE-RPT-TOTALS                            03220000
           END-IF.                                                      03230000
                                                                        03240000
           WRITE REPORT-RECORD FROM PC-END-RPT-MSG                      03250000
                AFTER ADVANCING 5 LINES.                                03260001
                                                                        03270000
           DISPLAY SPACES.                                              03280000
           MOVE PA-TOTAL-READ        TO PV-DISP-NUMBER.                 03290000
           DISPLAY 'RECORDS READ ' PV-DISP-NUMBER.                      03300007
                                                                        03310000
           CLOSE AP-TRANS-FILE                                          03320007
                 CONTROL-CARD-FILE                                      03330005
                 REPORT-FILE.                                           03340001
                                                                        03350001
