000010******************************************************************00001001
000020 IDENTIFICATION DIVISION.                                         00002001
000030******************************************************************00003001
000040                                                                  00004001
000050 PROGRAM-ID.    SUKUT201.                                         00005001
000060 AUTHOR.        DENISE HAHN                                       00006001
000070 INSTALLATION.  KOHLS.                                            00007001
000080 DATE-WRITTEN   DECEMBER 2019.                                    00008001
000090 DATE-COMPILED.                                                   00009001
000091                                                                  00009101
000092******************************************************************00009201
000093*                                                                 00009301
000094*  READS EXTRACT FILE (CREATED BY SUKUT200) AND DETERMINES IF THE 00009401
000095*  TRIP NEEDS TO BE RESUMMARIZED.                                 00009501
000096*                                                                 00009601
000097*  1.  IF EXTRACT RECORD DOES NOT HAVE LAST SUMMARY TMST          00009701
000098*        A.  CHECK TO SEE IF THERE IS A SUMMARY SINCE THE EXTRACT.00009801
000099*            IF THERE IS A SUMMARY (+0)                           00009901
000100*               -  BYPASS THE TRIP                                00010001
000101*               -  READ THE NEXT RECORD FROM EXTRACT              00010101
000102*                                                                 00010201
000103*            IF THERE IS NOT A SUMMARY (+100)                     00010301
000104*               - CALL THE BATCH TRLR SUMMARY MODULE (SUKUT576)   00010401
000105*               - READ THE NEXT RECORD FROM EXTRACT               00010501
000107*                                                                 00010701
000108*  2.  IF EXTRACT RECORD DOES HAVE LAST SUMMART TMST              00010801
000109*        A.  CHECK TO SEE IF THERE IS A SUMMARY SINCE THE EXTRACT.00010901
000110*            IF THERE IS A SUMMARY (+0)                           00011001
000111*               -  BYPASS THE TRIP                                00011101
000112*               -  READ THE NEXT RECORD FROM EXTRACT              00011201
000113*                                                                 00011301
000114*            IF THERE IS NOT A NEW SUMMARY (+100)                 00011401
000115*               - CONTINUE CHECKING                               00011501
000116*                                                                 00011601
000117*        B.  CHECK TO SEE IF THERE DIVERTS FOR DC/DOOR SINCE THE  00011701
000118*            LAST SUMMARIZATION                                   00011801
000119*            IF THERE ARE NO DIVERTS FOR THE DC/DOOR              00011901
000120*               -  BYPASS THE TRIP                                00012001
000121*               -  READ THE NEXT RECORD FROM EXTRACT              00012101
000122*                                                                 00012201
000123*            IF THERE ARE DIVERTS FOR THE DC/DOOR                 00012301
000124*               - CONTINUE CHECKING                               00012401
000125*                                                                 00012501
000126*        C.  CHECK TO MAKE SURE THE TRIP STATUS IS STILL DO/DC    00012601
000128*            IF THE CURRENT STATUS IS NOT 'DC' OR 'DO'            00012801
000130*               -  BYPASS THE TRIP                                00013001
000131*               -  READ THE NEXT RECORD FROM EXTRACT              00013101
000132*                                                                 00013201
000133*            IF THE CURRENT STATUS IS 'DC' OR 'DO'                00013301
000134*               - CONTINUE CHECKING                               00013401
000135*                                                                 00013501
000136*        D.  SELECT THE CURRENT NUMBER OF CARTONS MANIFESTED TO   00013601
000137*            THE TRAILER                                          00013701
000138*            IF THE CURRENT CARTON COUNT <> EXTRACT CARTON COUNT  00013801
000139*               - CALL THE BATCH TRLR SUMMARY MODULE (SUKUT576)   00013901
000140*               - READ THE NEXT RECORD FROM EXTRACT               00014001
000143*                                                                 00014301
000144*             IF THE CURRENT CARTON COUNT = EXTRACT CARTON COUNT  00014401
000145*               - CONTINUE CHECKING                               00014501
000146*                                                                 00014601
000147*        E.  SELECT THE CURRENT NUMBER OF UNITS MANIFESTED TO     00014701
000148*            THE TRAILER                                          00014801
000149*            IF THE CURRENT UNIT COUNT <> EXTRACT UNIT COUNT      00014901
000150*               - CALL THE BATCH TRLR SUMMARY MODULE (SUKUT576)   00015001
000151*               - READ THE NEXT RECORD FROM EXTRACT               00015101
000152*                                                                 00015201
000153*             IF THE CURRENT UNIT COUNT = EXTRACT UNIT COUNT      00015301
000154*               -  BYPASS THE TRIP                                00015401
000155*               -  READ THE NEXT RECORD FROM EXTRACT              00015501
000157*                                                                 00015701
000171*                                                                 00017101
000172*  INPUT FILE IS IN SURD166 FORMAT                                00017201
000173*  TRAILER SUMMARIZATION MODULE:  SUKUT576 COMMAREA: PCWS047      00017301
000174*                                                                 00017401
000178******************************************************************00017801
000179                                                                  00017901
000180******************************************************************00018001
000181 ENVIRONMENT DIVISION.                                            00018101
000182******************************************************************00018201
000183                                                                  00018301
000184 CONFIGURATION SECTION.                                           00018401
000185                                                                  00018501
000186 SOURCE-COMPUTER.        IBM-3090.                                00018601
000187 OBJECT-COMPUTER.        IBM-3090.                                00018701
000188                                                                  00018801
000189 INPUT-OUTPUT SECTION.                                            00018901
000190                                                                  00019001
000191 FILE-CONTROL.                                                    00019101
000192                                                                  00019201
000193     SELECT INPUT-FILE                                            00019301
000194            ASSIGN TO INP01.                                      00019401
000195                                                                  00019501
000214                                                                  00021401
000215******************************************************************00021501
000216 DATA DIVISION.                                                   00021601
000217******************************************************************00021701
000218                                                                  00021801
000219 FILE SECTION.                                                    00021901
000220                                                                  00022001
000221 FD  INPUT-FILE                                                   00022101
000222     RECORDING MODE IS F                                          00022201
000223     LABEL RECORDS ARE STANDARD                                   00022301
000224     BLOCK CONTAINS 0 RECORDS.                                    00022401
000225 01  INPUT-RECORD               PIC X(100).                       00022501
000262                                                                  00026201
000263                                                                  00026301
000264******************************************************************00026401
000265 WORKING-STORAGE SECTION.                                         00026501
000266******************************************************************00026601
000268                                                                  00026801
000269 01  DB2-KEYS.                                                    00026901
000270     05  DK-TRIP                        PIC S9(09)  COMP.         00027004
000271     05  DK-EXTRACT-TMST                PIC  X(26).               00027101
000272     05  DK-OPER                        PIC S9(04)  COMP.         00027202
000273     05  DK-DEST                        PIC S9(04)  COMP.         00027302
000274                                                                  00027401
000275 01  PROGRAM-CONSTANTS.                                           00027536
000276     05  PC-TRLR-SUM                    PIC  X(08)                00027636
000277                                             VALUE 'SUKUT576'.    00027736
000278                                                                  00027836
000279 01  PROGRAM-VARIABLES.                                           00027936
000280     05  PV-PARAGRAPH-NAME              PIC  X(40).               00028036
000281     05  PV-DB2-OPERATION               PIC  X(40).               00028136
000282*                                                                 00028236
000283     05  PV-MESSAGE-1                   PIC  X(100).              00028336
000284     05  PV-MESSAGE-2                   PIC  X(100).              00028436
000285*                                                                 00028536
000286     05  PV-DISP-SQLCODE                PIC  -999.                00028636
000287     05  PV-DISP-TRIP                   PIC  Z(09).               00028736
000288     05  PV-DISP-TRLR-SRL               PIC  Z(09).               00028836
000289     05  PV-DISP-OPER                   PIC  Z(04).               00028936
000290     05  PV-DISP-DEST                   PIC  Z(04).               00029036
000291     05  PV-DISP-QTY                    PIC  ZZZ,ZZZ,ZZZ.         00029136
000292     05  PV-DISP-UNIT                   PIC  ZZZ,ZZZ,ZZZ.         00029236
000293     05  PV-DISP-CNT                    PIC  ZZZ,ZZZ,ZZZ.         00029336
000294     05  PV-RESULT                      PIC  X(36).               00029443
000295*                                                                 00029536
000299     05  PV-DIVERT-COUNT                PIC S9(09) COMP.          00029904
000300     05  PV-NEW-CURR-DIVERT-CNT         PIC S9(09) COMP.          00030043
000301     05  PV-NEW-SCAN-ON-CNT             PIC S9(09) COMP.          00030143
000302     05  PV-NEW-MFST-CART-CNT           PIC S9(09) COMP.          00030243
000303                                                                  00030343
000307     05  PV-NEW-CURR-DIVERT-UNT         PIC S9(09) COMP.          00030743
000308     05  PV-NEW-SCAN-ON-UNT             PIC S9(09) COMP.          00030843
000309     05  PV-NEW-MFST-UNIT-CNT           PIC S9(09) COMP.          00030943
000310                                                                  00031043
000316     05  PV-NULL-IND-1                  PIC S9(04) VALUE ZEROS    00031643
000317                                                   COMP SYNC.     00031743
000318     05  PV-NULL-IND-2                  PIC S9(04) VALUE ZEROS    00031843
000319                                                   COMP SYNC.     00031943
000320     05  PV-NULL-IND-3                  PIC S9(04) VALUE ZEROS    00032043
000321                                                   COMP SYNC.     00032143
000322     05  PV-NULL-IND-4                  PIC S9(04) VALUE ZEROS    00032243
000323                                                   COMP SYNC.     00032343
000324     05  PV-NULL-IND-5                  PIC S9(04) VALUE ZEROS    00032443
000325                                                   COMP SYNC.     00032543
000326*                                                                 00032643
000327     05  PV-INPUT-COUNT                 PIC  9(09).               00032743
000328     05  PV-NO-SUMMARY                  PIC  9(09).               00032843
000329     05  PV-NULL-SUMMARIZED             PIC  9(09).               00032943
000330     05  PV-NULL-NOT-SUMMARIZED         PIC  9(09).               00033043
000331     05  PV-HAS-SUMMARY                 PIC  9(09).               00033143
000332                                                                  00033243
000333                                                                  00033343
000334     05  PV-BYPASS-RESUMMARIZED         PIC  9(09).               00033443
000335     05  PV-BYPASS-NO-DIVERTS           PIC  9(09).               00033543
000336     05  PV-BYPASS-STATUS-CHG           PIC  9(09).               00033643
000337     05  PV-RESUM-CARTON-CNT-CHG        PIC  9(09).               00033743
000338     05  PV-RESUM-UNIT-CNT-CHG          PIC  9(09).               00033843
000339     05  PV-BYPASS-NO-CRTN-UNT-CHG      PIC  9(09).               00033943
000340     05  PV-TOTAL-BYPASSED              PIC  9(09).               00034043
000341     05  PV-TOTAL-RESUM                 PIC  9(09).               00034143
000350*                                                                 00035001
000352*                                                                 00035201
000353 01  ABEND-CODE                         PIC S9(04) VALUE +0       00035301
000354                                                   COMP SYNC.     00035401
000355 01  PROGRAM-SWITCHES.                                            00035501
000356     05  PS-EOF-INPUT-SW                    PIC X(01) VALUE 'N'.  00035601
000357         88  PS-EOF-INPUT                             VALUE 'Y'.  00035701
000358         88  PS-EOF-INPUT-NO                          VALUE 'N'.  00035801
000359     05  PS-BYPASS-TRIP-SW                  PIC X(01) VALUE 'N'.  00035901
000360         88  PS-BYPASS-TRIP                           VALUE 'Y'.  00036001
000361         88  PS-BYPASS-TRIP-NO                        VALUE 'N'.  00036101
000362     05  PS-TRIP-HAS-NEW-SUMMARY-SW         PIC X(01) VALUE 'N'.  00036201
000363         88  PS-TRIP-HAS-NEW-SUMMARY                  VALUE 'Y'.  00036301
000364         88  PS-TRIP-HAS-NEW-SUMMARY-NO               VALUE 'N'.  00036401
000368                                                                  00036801
000369*-----------------------------------------------------------------00036901
000370* INPUT FILE LAYOUT                                               00037001
000371*-----------------------------------------------------------------00037101
000372     COPY SURD166.                                                00037201
000373                                                                  00037301
000374*-----------------------------------------------------------------00037401
000375* COMMAREA FOR TRAILER SUMMARIZATION MODULE (SUKUT576)            00037501
000376*-----------------------------------------------------------------00037601
000377     COPY PCWS047.                                                00037701
000378                                                                  00037801
000388*-----------------------------------------------------------------00038801
000389* SUT_TRIP_SUM - OUTBOUND TRIP SUMMARY                            00038901
000390*-----------------------------------------------------------------00039001
000391     EXEC SQL                                                     00039101
000392          INCLUDE SUT00007                                        00039201
000393     END-EXEC.                                                    00039301
000394                                                                  00039401
000395*-----------------------------------------------------------------00039501
000396* TSUCRDV - CARTON DIVERTS                                        00039601
000397*-----------------------------------------------------------------00039701
000398     EXEC SQL                                                     00039801
000399          INCLUDE TSUCRDV                                         00039901
000400     END-EXEC.                                                    00040001
000401                                                                  00040101
000402*-----------------------------------------------------------------00040201
000403* TSUOBTR - OUTBOUND TRIP                                         00040301
000404*-----------------------------------------------------------------00040401
000405     EXEC SQL                                                     00040501
000406          INCLUDE TSUOBTR                                         00040601
000407     END-EXEC.                                                    00040701
000408                                                                  00040801
000409*-----------------------------------------------------------------00040901
000410* TSUOBTS - OUTBOUND TRIP STATUS                                  00041001
000411*-----------------------------------------------------------------00041101
000412     EXEC SQL                                                     00041201
000413          INCLUDE TSUOBTS                                         00041305
000414     END-EXEC.                                                    00041401
000415                                                                  00041501
000416*-----------------------------------------------------------------00041605
000417* TSUCDOT - OUTBOUND TRIP CONVEYOR CUTOFF                         00041705
000418*-----------------------------------------------------------------00041805
000419     EXEC SQL                                                     00041905
000420          INCLUDE TSUCDOT                                         00042005
000421     END-EXEC.                                                    00042105
000422                                                                  00042205
000423*-----------------------------------------------------------------00042301
000424* SUT_OTBND_LOC - OUTBOUND CARTON LOCATION                        00042401
000425*-----------------------------------------------------------------00042501
000426     EXEC SQL                                                     00042601
000427          INCLUDE SUT00027                                        00042701
000428     END-EXEC.                                                    00042801
000429                                                                  00042901
000430*-----------------------------------------------------------------00043001
000431* SUT_OTBND_UPC - OUTBOUND CARTON UPC (CARTON CONTENTS)           00043101
000432*-----------------------------------------------------------------00043201
000433     EXEC SQL                                                     00043301
000434          INCLUDE SUT00028                                        00043401
000435     END-EXEC.                                                    00043501
000436                                                                  00043601
000437*-----------------------------------------------------------------00043701
000438*                                                                 00043801
000439*-----------------------------------------------------------------00043901
000440     EXEC SQL                                                     00044001
000441          INCLUDE SQLCA                                           00044101
000442     END-EXEC.                                                    00044201
000443                                                                  00044301
000444                                                                  00044401
000445*-----------------------------------------------------------------00044501
000446*  DB2 FORMATTED MESSAGE AREA                                     00044601
000447*-----------------------------------------------------------------00044701
000448     COPY DPWS004.                                                00044801
000449                                                                  00044901
000450                                                                  00045001
000451                                                                  00045101
000452 PROCEDURE DIVISION.                                              00045201
000453                                                                  00045301
000454*-----------------------------------------------------------------00045401
000455*                                                                 00045501
000456*-----------------------------------------------------------------00045601
000457 0000-PROGRAM-MAINLINE.                                           00045701
000458                                                                  00045801
000459     DISPLAY ' '.                                                 00045901
000460     DISPLAY '********************************************'       00046001
000461     DISPLAY '**** START OF SUKUT201 ****'.                       00046101
000462     DISPLAY '*'.                                                 00046201
000463                                                                  00046301
000464     PERFORM 1000-INITIALIZE.                                     00046401
000470                                                                  00047001
000471     PERFORM 2000-PROCESS-FILE                                    00047101
000472       UNTIL PS-EOF-INPUT.                                        00047201
000474*                                                                 00047401
000475     MOVE PV-INPUT-COUNT             TO  PV-DISP-QTY.             00047501
000476     DISPLAY '* INPUT COUNT:          '  PV-DISP-QTY              00047626
000477             ' *****'.                                            00047731
000478     DISPLAY '*'.                                                 00047826
000479     DISPLAY '*'.                                                 00047926
000480                                                                  00048026
000481     MOVE PV-NO-SUMMARY              TO  PV-DISP-QTY.             00048126
000482     DISPLAY '* NO INITIAL SUMMARY:   ' PV-DISP-QTY               00048228
000484             ' ****'.                                             00048431
000485                                                                  00048527
000486     MOVE PV-NULL-SUMMARIZED         TO  PV-DISP-QTY.             00048627
000487     DISPLAY '* BYPASSED HAS SUMMARY:      '                      00048729
000488             '                        '  PV-DISP-QTY              00048833
000489             ' **'.                                               00048932
000490                                                                  00049027
000491     MOVE PV-NULL-NOT-SUMMARIZED     TO  PV-DISP-QTY.             00049127
000492     DISPLAY '* REQUESTED SUMMARY:    '                           00049227
000493             '               '           PV-DISP-QTY              00049329
000494             ' ***'.                                              00049431
000495     DISPLAY '*'.                                                 00049527
000496     DISPLAY '*'.                                                 00049627
000497                                                                  00049727
000498     MOVE PV-HAS-SUMMARY             TO  PV-DISP-QTY.             00049827
000499     DISPLAY '* HAS INITIAL SUMMARY:  '  PV-DISP-QTY              00049927
000500             ' ****'.                                             00050031
000501                                                                  00050127
000502     MOVE PV-BYPASS-RESUMMARIZED     TO  PV-DISP-QTY.             00050227
000503     DISPLAY '* RESUM BYPASS:              '                      00050329
000504             '                        '  PV-DISP-QTY              00050432
000505             ' **'.                                               00050532
000506                                                                  00050627
000507     MOVE PV-BYPASS-NO-DIVERTS       TO  PV-DISP-QTY.             00050727
000508     DISPLAY '* NO DIVERT BYPASS:          '                      00050829
000509             '                        '  PV-DISP-QTY              00050932
000510             ' **'.                                               00051032
000511                                                                  00051127
000512     MOVE PV-BYPASS-STATUS-CHG       TO  PV-DISP-QTY.             00051227
000513     DISPLAY '* TRIP STAT CHG BYPASS:      '                      00051329
000514             '                        '  PV-DISP-QTY              00051432
000515             ' **'.                                               00051532
000516                                                                  00051627
000517     MOVE PV-BYPASS-NO-CRTN-UNT-CHG  TO  PV-DISP-QTY.             00051727
000518     DISPLAY '* NO CTN/UNT CHG BYPASS:     '                      00051829
000519             '                        '  PV-DISP-QTY              00051932
000520             ' **'.                                               00052032
000521                                                                  00052127
000522     MOVE PV-TOTAL-BYPASSED          TO  PV-DISP-QTY.             00052218
000523     DISPLAY '* TOTAL BYPASSED:            '                      00052329
000524             '                        '  PV-DISP-QTY              00052432
000525             ' **'.                                               00052532
000526     DISPLAY '*'                                                  00052629
000527                                                                  00052729
000528     MOVE PV-RESUM-CARTON-CNT-CHG    TO  PV-DISP-QTY.             00052829
000529     DISPLAY '* NEW SUM CARTON COUNT: '                           00052929
000530             '               '           PV-DISP-QTY              00053029
000531             ' ***'.                                              00053131
000532                                                                  00053229
000533     MOVE PV-RESUM-UNIT-CNT-CHG      TO  PV-DISP-QTY.             00053329
000534     DISPLAY '* NEW SUM UNIT QTY:     '                           00053429
000535             '               '           PV-DISP-QTY              00053529
000536             ' ***'.                                              00053631
000537                                                                  00053729
000538     DISPLAY '*'                                                  00053829
000539                                                                  00053929
000540     MOVE PV-TOTAL-RESUM             TO  PV-DISP-QTY.             00054029
000541     DISPLAY '* TOTAL RESUMMARIZED:   '                           00054129
000542             '               '           PV-DISP-QTY              00054229
000543             ' ***'.                                              00054331
000544     DISPLAY '*'                                                  00054429
000545                                                                  00054529
000546     CLOSE INPUT-FILE.                                            00054629
000547                                                                  00054729
000548     DISPLAY '********************************************'.      00054829
000549                                                                  00054929
000550     STOP RUN.                                                    00055029
000551                                                                  00055129
000552                                                                  00055229
000553*-----------------------------------------------------------------00055329
000554*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    00055429
000555*    -- OPEN INPUT FILE                                           00055529
000556*    -- INITIAL READ OF INPUT                                     00055629
000557*-----------------------------------------------------------------00055729
000558 1000-INITIALIZE.                                                 00055829
000559                                                                  00055929
000560     OPEN INPUT  INPUT-FILE.                                      00056029
000561                                                                  00056129
000562     PERFORM 8000-READ-INPUT-REC.                                 00056229
000563                                                                  00056329
000564                                                                  00056429
000565*-----------------------------------------------------------------00056529
000566*  LOOP THROUGH THE RESULTS TABLE.                                00056629
000567*  FORMAT THE OUTPUT RECORD.  WRITE THE RECORDS THAT MEET CRITERIA00056729
000568*-----------------------------------------------------------------00056829
000569 2000-PROCESS-FILE.                                               00056929
000570                                                                  00057029
000571     IF  SU166-LAST-SUM-TMST  =  SPACES                           00057129
000572         PERFORM 2010-NO-INITIAL-SUMMARY                          00057229
000573     ELSE                                                         00057329
000574         PERFORM 2020-HAS-INITIAL-SUMMARY                         00057429
000580     END-IF.                                                      00058012
000654                                                                  00065401
000655     PERFORM 8000-READ-INPUT-REC.                                 00065501
000656                                                                  00065601
000657                                                                  00065701
000658*-----------------------------------------------------------------00065801
000659*  TRIP FROM EXTRACT DOES NOT HAVE AN INITIAL SUMMARY             00065901
000660*  - CHECK IF THERE IS STILL NOT SUMMARY                          00066001
000661*  - IF THERE IS A SUMMARY THIS TRIP CAN BE BYPASSED              00066101
000662*  - IF THERE IS NOT A SUMMARY - SUMMARIZATION MODUEL IS CALLED   00066201
000663*-----------------------------------------------------------------00066301
000664 2010-NO-INITIAL-SUMMARY.                                         00066401
000665                                                                  00066501
000666     ADD  1                           TO  PV-NO-SUMMARY.          00066601
000667     SET  PS-TRIP-HAS-NEW-SUMMARY-NO  TO  TRUE.                   00066701
000668                                                                  00066801
000671*                                                                 00067101
000672     PERFORM 3000-CHECK-FOR-SUMMARY.                              00067201
000673                                                                  00067301
000674     IF  PS-TRIP-HAS-NEW-SUMMARY                                  00067401
000675         ADD  1                       TO  PV-NULL-SUMMARIZED      00067501
000676                                          PV-TOTAL-BYPASSED       00067619
000677         MOVE 'BYPASS-HAS NEW SUMMARY   ' TO  PV-RESULT           00067718
000678         PERFORM 4010-SUMMARY-STATUS                              00067821
000679     ELSE                                                         00067918
000680         ADD  1                       TO  PV-NULL-NOT-SUMMARIZED  00068018
000681         MOVE 'INITIAL SUMMARIZATION    ' TO  PV-RESULT           00068134
000682         DISPLAY '                                          '     00068240
000683         DISPLAY '------------------------------------------'     00068340
000684         PERFORM 4010-SUMMARY-STATUS                              00068421
000685         PERFORM 4000-SUMMARIZE-TRAILER                           00068518
000686     END-IF.                                                      00068618
000690                                                                  00069001
000905                                                                  00090501
000906*-----------------------------------------------------------------00090601
000907* - CHECK IF THERE IS A NEW SUMMARY SINCE THE EXTRACT             00090701
000908*   - IF THERE IS A SUMMARY THIS TRIP CAN BE BYPASSED             00090801
000909*                                                                 00090901
000910* - CHECK IF THERE ARE NEW DIVERTS SINCE THE SUMMARY              00091001
000911*   - IF THERE IS A SUMMARY THIS TRIP CAN BE BYPASSED             00091101
000912*                                                                 00091201
000913* - CHECK THE CURRENT STATUS OF THE TRIP                          00091301
000914*   - IF THE STATUS IS NOT 'DO' OR 'DC' THIS TRIP CAN BE BYPASSED 00091401
000915*                                                                 00091501
000916* - CHECK IF THE CURRENT CARTON MANIFEST COUNT = COUNT FROM       00091612
000917*   EXTRACT.  IF THE COUNTS DO NOT MATCH - THEN CALL THE          00091712
000918*   TRIP SUMMARIZATION MODULE                                     00091812
000919*                                                                 00091901
000920* - IF CARTON COUNTS =, CHECK IF THE CURRENT MANIFESTED UNIT QTY  00092013
000921*   MATCHES THE EXTRACT.  IF THE QTYLS DO NOT MATCH - THEN CALL   00092113
000922*   THE TRIP SUMMARIZATION MODULE                                 00092213
000924*-----------------------------------------------------------------00092413
000925 2020-HAS-INITIAL-SUMMARY.                                        00092513
000930                                                                  00093001
000931     ADD  1                           TO  PV-HAS-SUMMARY.         00093112
000932     SET  PS-TRIP-HAS-NEW-SUMMARY-NO  TO  TRUE.                   00093201
000933     SET  PS-BYPASS-TRIP-NO           TO  TRUE.                   00093301
000934                                                                  00093401
000935*                                                                 00093501
000936*** CHECK IF TRIP HAS BEEN SUMMARIZED SINCE EXTRACT               00093601
000937*** IF THE TRIP HAS BEEN SUMMARIZED SINCE THE EXTRACT THEN THIS   00093701
000938*** TRIP CAN BE BYPASSED.                                         00093801
000939*                                                                 00093901
000940     PERFORM 3010-CHECK-FOR-SUMMARY.                              00094001
000941                                                                  00094101
000942     IF  PS-TRIP-HAS-NEW-SUMMARY                                  00094201
000943         ADD  1                       TO  PV-BYPASS-RESUMMARIZED  00094301
000944                                          PV-TOTAL-BYPASSED       00094401
000945             MOVE 'BYPASS-TRIP HAS RESUMMARY' TO  PV-RESULT       00094525
000946             SET  PS-BYPASS-TRIP      TO  TRUE                    00094625
000947             PERFORM 4010-SUMMARY-STATUS                          00094725
000949     END-IF.                                                      00094901
000950                                                                  00095001
000951*                                                                 00095101
000952*** CHECK IF THERE ARE ANY DIVERTS FOR THE DC/STORE SINCE         00095201
000953*** THE LAST SUMMARY.                                             00095301
000954*** IF THERE ARE NO NEW DIVERTS SINCE THE LAST SUMMARY, THEN      00095401
000955*** THIS TRIP CAN BE BYPASSED.                                    00095501
000956*                                                                 00095601
000957     IF  PS-BYPASS-TRIP-NO                                        00095701
000958         PERFORM 3020-CHECK-FOR-DIVERTS                           00095801
000959                                                                  00095901
000960         IF  PV-DIVERT-COUNT  > 0                                 00096001
000961             CONTINUE                                             00096101
000962         ELSE                                                     00096201
000963             ADD  1                   TO  PV-BYPASS-NO-DIVERTS    00096301
000964                                          PV-TOTAL-BYPASSED       00096418
000965             MOVE 'BYPASS-NO NEW DIVERTS    ' TO  PV-RESULT       00096518
000966             SET  PS-BYPASS-TRIP      TO  TRUE                    00096601
000967             PERFORM 4010-SUMMARY-STATUS                          00096721
000968         END-IF                                                   00096801
000969     END-IF.                                                      00096901
000970                                                                  00097001
000971*                                                                 00097101
000972*** CHECK IF THE TRIP IS STILL IN 'DO' OR 'DC' STATUS             00097201
000973*** IF THE TRIP STATUS IS NO LONGER IN 'DO' OR 'DC' STATUS THEN   00097301
000974*** THIS TRIP CAN BE BYPASSED.                                    00097401
000975*                                                                 00097501
000976     IF  PS-BYPASS-TRIP-NO                                        00097601
000977         PERFORM 3030-CHECK-CURRENT-STATUS                        00097701
000978                                                                  00097801
000979         IF  SUOBTS-TRIP-STAT-CDE = 'DO'  OR                      00097901
000980             SUOBTS-TRIP-STAT-CDE = 'DC'                          00098005
000981             CONTINUE                                             00098101
000982         ELSE                                                     00098201
000983             ADD  1                   TO  PV-BYPASS-STATUS-CHG    00098301
000984                                          PV-TOTAL-BYPASSED       00098418
000985             MOVE 'BYPASS-TRIP STATUS CHANGE' TO  PV-RESULT       00098518
000986             SET  PS-BYPASS-TRIP      TO  TRUE                    00098601
000987             PERFORM 4010-SUMMARY-STATUS                          00098721
000988         END-IF                                                   00098801
000989     END-IF.                                                      00098901
000990                                                                  00099001
000991*                                                                 00099101
000992*** CHECK IF THE CARTON MANIFESTED CARTON COUNT HAS CHANGED       00099201
000993*** IF THE CARTON COUNT HAS CHANGED - THEN CHECK THE TRIP CAN BE  00099301
000994*** SUMMARIZED                                                    00099401
000995***                                                               00099501
000996*** IF THE CARTON COUNT IS THE SAME - CHECK IF THE UNIT QTY HAS   00099601
000997*** CHANGED                                                       00099701
000998*** IF THE UNIT QTY HAS CHANGED - THEN THE TRIP CAN BE SUMMARIZED 00099801
000999*** IF THE UNIT QTY HAS NOT CHANGED - THEN BYPASS THE TRIP        00099901
001000*                                                                 00100001
001001                                                                  00100101
001002     IF  PS-BYPASS-TRIP-NO                                        00100201
001003         PERFORM 3040-GET-CARTON-COUNT                            00100301
001004                                                                  00100401
001005         IF  PV-NEW-MFST-CART-CNT  =  SU166-LAST-SUM-CRTN-CNT     00100501
001006             PERFORM 3050-GET-UNIT-QTY                            00100601
001007                                                                  00100701
001008             IF  PV-NEW-MFST-UNIT-CNT  =                          00100801
001009                 SU166-LAST-SUM-UNT-QTY                           00100901
001010                 ADD  1           TO  PV-BYPASS-NO-CRTN-UNT-CHG   00101012
001011                                      PV-TOTAL-BYPASSED           00101101
001012                 SET  PS-BYPASS-TRIP  TO  TRUE                    00101225
001013                 MOVE 'BYPASS-NO CTN/UNIT CHANGE' TO  PV-RESULT   00101318
001014                 PERFORM 4010-SUMMARY-STATUS                      00101421
001015             ELSE                                                 00101501
001016                 ADD  1           TO  PV-RESUM-UNIT-CNT-CHG       00101601
001017                 MOVE PV-NEW-MFST-UNIT-CNT  TO  PV-DISP-CNT       00101743
001018                 MOVE SPACES  TO  PV-RESULT                       00101843
001019                 STRING 'RESUM-UNIT CHANGE        '               00101943
001020                        PV-DISP-CNT DELIMITED BY SIZE             00102045
001021                                              INTO  PV-RESULT     00102143
001022                 PERFORM 4010-SUMMARY-STATUS                      00102243
001023             END-IF                                               00102343
001024         ELSE                                                     00102443
001025             ADD  1               TO  PV-RESUM-CARTON-CNT-CHG     00102543
001026             MOVE PV-NEW-MFST-CART-CNT  TO  PV-DISP-CNT           00102643
001027             MOVE SPACES  TO  PV-RESULT                           00102743
001028                                                                  00102843
001029             STRING 'RESUM-CARTON COUNT CHANGE'                   00102945
001030                    PV-DISP-CNT  DELIMITED BY SIZE                00103043
001031                                              INTO  PV-RESULT     00103143
001032             PERFORM 4010-SUMMARY-STATUS                          00103243
001033         END-IF                                                   00103343
001034     END-IF.                                                      00103443
001035                                                                  00103543
001040     IF  PS-BYPASS-TRIP-NO                                        00104001
001041         DISPLAY '                                          '     00104140
001042         DISPLAY '------------------------------------------'     00104240
001043         PERFORM 4000-SUMMARIZE-TRAILER                           00104301
001044     END-IF.                                                      00104401
001045                                                                  00104501
001046                                                                  00104601
001047*-----------------------------------------------------------------00104701
001048* THIS CHECK IF FOR TRIPS THAT HAVE NOT BEEN SUMMARIZED.          00104801
001049* CHECK TO SEE IF THERE IS A SUMMARY ROW FOR THE TRIP SINCE THE   00104901
001050* EXTRACT WAS CREATED.                                            00105001
001051*-----------------------------------------------------------------00105101
001052 3000-CHECK-FOR-SUMMARY.                                          00105201
001053                                                                  00105301
001054     EXEC SQL                                                     00105401
001055         SELECT CRE_TMST                                          00105501
001056           INTO :SUT00007-CRE-TMST :PV-NULL-IND-1                 00105611
001057           FROM SUT_TRIP_SUM                                      00105701
001058          WHERE OTBND_TRIP_ID = :DK-TRIP                          00105808
001059          FETCH FIRST 1 ROW ONLY                                  00105911
001060           WITH UR                                                00106001
001086     END-EXEC.                                                    00108601
001087                                                                  00108701
001088     EVALUATE TRUE                                                00108801
001089         WHEN SQLCODE = ZERO                                      00108901
001090         WHEN SQLCODE = -305                                      00109011
001100              IF  PV-NULL-IND-1  =  -1                            00110011
001110                  MOVE SPACES    TO  SUT00007-CRE-TMST            00111011
001111                  SET  PS-TRIP-HAS-NEW-SUMMARY-NO  TO  TRUE       00111111
001112              ELSE                                                00111211
001113                  SET  PS-TRIP-HAS-NEW-SUMMARY  TO  TRUE          00111311
001114              END-IF                                              00111411
001115                                                                  00111501
001116         WHEN SQLCODE = +100                                      00111615
001117              MOVE SPACES    TO  SUT00007-CRE-TMST                00111715
001119              SET  PS-TRIP-HAS-NEW-SUMMARY-NO  TO  TRUE           00111915
001123                                                                  00112315
001124         WHEN SQLWARN0 NOT = SPACES                               00112401
001125         WHEN SQLCODE < ZERO                                      00112501
001126         WHEN SQLCODE > ZERO                                      00112601
001127              MOVE SQLCODE              TO PV-DISP-SQLCODE        00112701
001128              MOVE DK-TRIP              TO PV-DISP-TRIP           00112804
001129*                                                                 00112901
001130              STRING '3000-'                                      00113001
001131                     ' SQL:'   PV-DISP-SQLCODE                    00113101
001132                     ' TRIP:'  PV-DISP-TRIP                       00113206
001133                               DELIMITED BY SIZE                  00113301
001134                          INTO PV-MESSAGE-1                       00113401
001135                                                                  00113501
001136             DISPLAY PV-MESSAGE-1                                 00113601
001137                                                                  00113701
001138             MOVE '3000-CHECK-FOR-SUMMARY     '                   00113801
001139                                 TO PV-PARAGRAPH-NAME             00113901
001140             MOVE 'CHECK TO SEE IF TRIP SUMMRARIZED '             00114001
001141                                 TO PV-DB2-OPERATION              00114101
001142             PERFORM 9100-SQL-ABEND                               00114201
001143     END-EVALUATE.                                                00114301
001144                                                                  00114401
001145                                                                  00114501
001146*-----------------------------------------------------------------00114601
001147* THIS CHECK IF FOR TRIPS THAT HAVE BEEN SUMMARIZED.              00114701
001148* CHECK TO SEE IF THERE IS A SUMMARY ROW FOR THE TRIP SINCE THE   00114801
001149* EXTRACT WAS CREATED.                                            00114901
001150*-----------------------------------------------------------------00115001
001151 3010-CHECK-FOR-SUMMARY.                                          00115101
001152                                                                  00115201
001153     EXEC SQL                                                     00115301
001154         SELECT CRE_TMST                                          00115401
001155           INTO :SUT00007-CRE-TMST :PV-NULL-IND-1                 00115510
001156           FROM SUT_TRIP_SUM                                      00115601
001157          WHERE OTBND_TRIP_ID  =  :DK-TRIP                        00115704
001158            AND CRE_TMST       >  :DK-EXTRACT-TMST                00115801
001159          FETCH FIRST 1 ROW ONLY                                  00115901
001160           WITH UR                                                00116001
001161     END-EXEC.                                                    00116101
001162                                                                  00116201
001163     EVALUATE TRUE                                                00116301
001164         WHEN SQLCODE = ZERO                                      00116401
001165         WHEN SQLCODE = -305                                      00116503
001166              IF  PV-NULL-IND-1  =  -1                            00116601
001167                  MOVE SPACES    TO  SUT00007-CRE-TMST            00116706
001168                  SET  PS-TRIP-HAS-NEW-SUMMARY-NO  TO  TRUE       00116801
001169              ELSE                                                00116903
001171                  SET  PS-TRIP-HAS-NEW-SUMMARY  TO  TRUE          00117103
001172              END-IF                                              00117201
001173                                                                  00117301
001174         WHEN SQLCODE = +100                                      00117415
001175              MOVE SPACES    TO  SUT00007-CRE-TMST                00117515
001176              SET  PS-TRIP-HAS-NEW-SUMMARY-NO  TO  TRUE           00117615
001177                                                                  00117715
001178         WHEN SQLWARN0 NOT = SPACES                               00117801
001179         WHEN SQLCODE < ZERO                                      00117901
001180         WHEN SQLCODE > ZERO                                      00118001
001181              MOVE SQLCODE              TO PV-DISP-SQLCODE        00118101
001182              MOVE DK-TRIP              TO PV-DISP-TRIP           00118204
001183*                                                                 00118301
001184              STRING '3010-'                                      00118401
001185                     ' SQL:'   PV-DISP-SQLCODE                    00118501
001186                     ' TRIP:'  PV-DISP-TRIP                       00118601
001187                     ' TMST:'  DK-EXTRACT-TMST                    00118701
001188                               DELIMITED BY SIZE                  00118801
001189                          INTO PV-MESSAGE-1                       00118901
001190                                                                  00119001
001191             DISPLAY PV-MESSAGE-1                                 00119101
001192                                                                  00119201
001193             MOVE '3010-CHECK-FOR-SUMMARY     '                   00119301
001194                                 TO PV-PARAGRAPH-NAME             00119401
001195             MOVE 'CHECK TO SEE IF NEW TRIP SUMMARY '             00119501
001196                                 TO PV-DB2-OPERATION              00119601
001197             PERFORM 9100-SQL-ABEND                               00119701
001198     END-EVALUATE.                                                00119801
001199                                                                  00119901
001200                                                                  00120001
001201*-----------------------------------------------------------------00120101
001202* THIS CHECK IF THERE ARE ANY NEW DIVERTS FOR THE DC/STORE SINCE  00120201
001203* THE LAST SMMARIZATION                                           00120301
001204*-----------------------------------------------------------------00120401
001205 3020-CHECK-FOR-DIVERTS.                                          00120501
001206                                                                  00120601
001207     EXEC SQL                                                     00120701
001208         SELECT COUNT(*)                                          00120801
001209           INTO :PV-DIVERT-COUNT                                  00120910
001210           FROM TSUCRDV                                           00121001
001211          WHERE OPER_UNT_ID       =  :DK-OPER                     00121101
001212            AND DEST_OPER_UNT_ID  =  :DK-DEST                     00121242
001213            AND ACTV_CDE          =  'A'                          00121342
001214            AND DIVERT_TMST       >  :DK-EXTRACT-TMST             00121404
001215          FETCH FIRST 1 ROW ONLY                                  00121501
001216           WITH UR                                                00121601
001217     END-EXEC.                                                    00121701
001218                                                                  00121801
001219     EVALUATE TRUE                                                00121901
001220         WHEN SQLCODE = ZERO                                      00122001
001221              CONTINUE                                            00122101
001222                                                                  00122201
001223         WHEN SQLWARN0 NOT = SPACES                               00122301
001224         WHEN SQLCODE < ZERO                                      00122401
001225         WHEN SQLCODE > ZERO                                      00122501
001226              MOVE SQLCODE              TO PV-DISP-SQLCODE        00122601
001227              MOVE DK-TRIP              TO PV-DISP-TRIP           00122704
001228*                                                                 00122801
001229              STRING '3020-'                                      00122901
001230                     ' SQL:'   PV-DISP-SQLCODE                    00123006
001231                     ' TRIP:'  PV-DISP-TRIP                       00123101
001232                     ' TMST:'  DK-EXTRACT-TMST                    00123201
001233                               DELIMITED BY SIZE                  00123301
001234                          INTO PV-MESSAGE-1                       00123401
001235                                                                  00123501
001236             DISPLAY PV-MESSAGE-1                                 00123601
001237                                                                  00123701
001238             MOVE '3020-CHECK-FOR-DIVERTS     '                   00123801
001239                                 TO PV-PARAGRAPH-NAME             00123901
001240             MOVE 'CHECK DC/STORE DIVERTS SINCE LAST SUMMARY'     00124001
001241                                 TO PV-DB2-OPERATION              00124101
001242             PERFORM 9100-SQL-ABEND                               00124201
001243     END-EVALUATE.                                                00124301
001244                                                                  00124401
001245                                                                  00124501
001246*-----------------------------------------------------------------00124601
001247* THIS CHECK IS TO SEE IF THE CURRENT STATUS OF THE TRAILER IS    00124701
001248* IN 'DC' OR 'DO' STATUS                                          00124801
001249*-----------------------------------------------------------------00124901
001250 3030-CHECK-CURRENT-STATUS.                                       00125001
001251                                                                  00125101
001252     EXEC SQL                                                     00125201
001253         SELECT B.TRIP_STAT_CDE                                   00125301
001254           INTO :SUOBTS-TRIP-STAT-CDE                             00125410
001255           FROM TSUOBTR A                                         00125501
001256              , TSUOBTS B                                         00125601
001257          WHERE A.OTBND_TRIP_ID   =  :DK-TRIP                     00125704
001258            AND A.OTBND_TRIP_ID   =  B.OTBND_TRIP_ID              00125804
001259            AND B.OTBND_STAT_TMST IN                              00125904
001260                (SELECT MAX(C.OTBND_STAT_TMST)                    00126004
001261                   FROM TSUOBTS C                                 00126104
001262                  WHERE B.OTBND_TRIP_ID  =  C.OTBND_TRIP_ID)      00126204
001263           WITH UR                                                00126304
001264     END-EXEC.                                                    00126404
001265                                                                  00126504
001266     EVALUATE TRUE                                                00126604
001267         WHEN SQLCODE = ZERO                                      00126704
001268              CONTINUE                                            00126804
001269                                                                  00126904
001270         WHEN SQLWARN0 NOT = SPACES                               00127004
001271         WHEN SQLCODE < ZERO                                      00127104
001272         WHEN SQLCODE > ZERO                                      00127204
001273              MOVE SQLCODE              TO PV-DISP-SQLCODE        00127304
001274              MOVE DK-TRIP              TO PV-DISP-TRIP           00127404
001275              MOVE DK-OPER              TO PV-DISP-OPER           00127504
001276              MOVE DK-DEST              TO PV-DISP-DEST           00127604
001277*                                                                 00127704
001278              STRING '3030-'                                      00127804
001279                     ' SQL:'   PV-DISP-SQLCODE                    00127906
001280                     ' TRIP:'  PV-DISP-TRIP                       00128004
001281                     ' TMST:'  DK-EXTRACT-TMST                    00128104
001282                     ' OPER:'  PV-DISP-OPER                       00128204
001283                     ' DEST:'  PV-DISP-DEST                       00128304
001284                               DELIMITED BY SIZE                  00128404
001285                          INTO PV-MESSAGE-1                       00128504
001286                                                                  00128604
001287             DISPLAY PV-MESSAGE-1                                 00128704
001288                                                                  00128804
001289             MOVE '3030-CHECK-CURRENT-STATUS  '                   00128904
001290                                 TO PV-PARAGRAPH-NAME             00129004
001291             MOVE 'CHECK CURRENT TRIP STATUS                '     00129104
001292                                 TO PV-DB2-OPERATION              00129204
001293             PERFORM 9100-SQL-ABEND                               00129304
001294     END-EVALUATE.                                                00129404
001295                                                                  00129504
001296                                                                  00129604
001297*-----------------------------------------------------------------00129704
001298* THIS SQL IS TO GET THE CURRENT CARTON COUNT FOR THE TRIP        00129804
001299*-----------------------------------------------------------------00129901
001300 3040-GET-CARTON-COUNT.                                           00130001
001301                                                                  00130101
001302     EXEC SQL                                                     00130201
001303         SELECT                                                   00130343
001304                 T1.CURR_DIVERT_COUNT                             00130443
001305              ,  T2.CURR_SCAN_ON_COUNT                            00130543
001307           INTO :PV-NEW-CURR-DIVERT-CNT :PV-NULL-IND-2            00130743
001308              , :PV-NEW-SCAN-ON-CNT     :PV-NULL-IND-4            00130843
001310           FROM                                                   00131043
001311         (SELECT A.OTBND_TRIP_ID                                  00131143
001312               , COUNT(DISTINCT(C.SHIPT_UNT_ID))                  00131243
001313                 AS CURR_DIVERT_COUNT                             00131343
001314            FROM TSUOBTR A                                        00131443
001315               , TSUCDOT B                                        00131543
001316               , TSUCRDV C                                        00131643
001317               , SUT_OTBND_CART G                                 00131743
001318           WHERE A.OTBND_TRIP_ID     =  :DK-TRIP                  00131843
001319             AND A.OTBND_TRIP_ID     =  B.OTBND_TRIP_ID           00131943
001320             AND B.OPER_UNT_ID       =  C.OPER_UNT_ID             00132043
001321             AND B.DOOR_ID           =  C.DOOR_ID                 00132143
001322             AND A.DEST_OPER_UNT_ID  =  C.DEST_OPER_UNT_ID        00132243
001323             AND C.DIVERT_TMST      >=  B.STRT_DIVERT_TMST        00132343
001324             AND C.DIVERT_TMST      <=  B.END_DIVERT_TMST         00132443
001325             AND C.DIVERT_TMST  IN                                00132543
001326                 (SELECT MAX(D.DIVERT_TMST)                       00132643
001327                    FROM TSUCRDV D                                00132743
001328                   WHERE C.SHIPT_UNT_ID  =  D.SHIPT_UNT_ID        00132843
001329                     AND D.ACTV_CDE      = 'A')                   00132943
001330             AND C.ACTV_CDE = 'A'                                 00133043
001331             AND C.SHIPT_UNT_ID  =  G.SHIPT_UNT_ID                00133143
001332             AND G.ACTV_IND      = 'Y'                            00133243
001333           GROUP BY A.OTBND_TRIP_ID                               00133343
001334         ) AS T1                                                  00133443
001335         LEFT OUTER JOIN                                          00133543
001336         (SELECT E.OTBND_TRIP_ID                                  00133643
001337               , COUNT(DISTINCT(F.SHIPT_UNT_ID))                  00133743
001338                 AS CURR_SCAN_ON_COUNT                            00133843
001339            FROM TSUOBTR E                                        00133943
001340               , SUT_OTBND_LOC F                                  00134043
001341           WHERE E.OTBND_TRIP_ID      = :DK-TRIP                  00134143
001342             AND E.OTBND_TRIP_ID      =  F.OTBND_TRIP_ID          00134243
001343             AND F.SCN_CDE            = 'SHON'                    00134343
001344             AND F.ACTV_CDE = 'A'                                 00134443
001345           GROUP BY E.OTBND_TRIP_ID                               00134543
001346         ) AS T2                                                  00134643
001347         ON T1.OTBND_TRIP_ID  =  T2.OTBND_TRIP_ID                 00134743
001349           WITH UR                                                00134901
001350     END-EXEC.                                                    00135001
001351                                                                  00135101
001352     EVALUATE TRUE                                                00135201
001353         WHEN SQLCODE = ZERO                                      00135301
001354         WHEN SQLCODE = -305                                      00135417
001355              IF  PV-NULL-IND-2  =  -1                            00135517
001356                  MOVE ZEROES  TO  PV-NEW-CURR-DIVERT-CNT         00135643
001357              END-IF                                              00135746
001358              IF  PV-NULL-IND-4  =  -1                            00135843
001360                  MOVE ZEROES  TO  PV-NEW-SCAN-ON-CNT             00136043
001362              END-IF                                              00136243
001363                                                                  00136343
001364              ADD PV-NEW-CURR-DIVERT-CNT  TO                      00136443
001365                  PV-NEW-SCAN-ON-CNT                              00136543
001366                  GIVING           PV-NEW-MFST-CART-CNT           00136643
001367                                                                  00136717
001368         WHEN SQLCODE = +100                                      00136817
001369              MOVE ZEROES  TO  PV-NEW-MFST-CART-CNT               00136917
001370                                                                  00137017
001371         WHEN SQLWARN0 NOT = SPACES                               00137117
001372         WHEN SQLCODE < ZERO                                      00137217
001373         WHEN SQLCODE > ZERO                                      00137317
001374              MOVE SQLCODE              TO PV-DISP-SQLCODE        00137417
001375              MOVE DK-TRIP              TO PV-DISP-TRIP           00137517
001376              MOVE DK-OPER              TO PV-DISP-OPER           00137617
001377              MOVE DK-DEST              TO PV-DISP-DEST           00137717
001378*                                                                 00137817
001379              STRING '3040-'                                      00137917
001380                     ' SQL:'   PV-DISP-SQLCODE                    00138017
001381                     ' TRIP:'  PV-DISP-TRIP                       00138117
001382                     ' TMST:'  DK-EXTRACT-TMST                    00138217
001383                     ' OPER:'  PV-DISP-OPER                       00138317
001384                     ' DEST:'  PV-DISP-DEST                       00138417
001385                               DELIMITED BY SIZE                  00138517
001386                          INTO PV-MESSAGE-1                       00138617
001387                                                                  00138717
001388             DISPLAY PV-MESSAGE-1                                 00138817
001389                                                                  00138917
001390             MOVE '3040-GET-CARTON-COUNT      '                   00139017
001391                                 TO PV-PARAGRAPH-NAME             00139117
001392             MOVE 'GET CURRENT CARTON COUNT FOR TRIP        '     00139217
001393                                 TO PV-DB2-OPERATION              00139317
001394             PERFORM 9100-SQL-ABEND                               00139417
001395     END-EVALUATE.                                                00139517
001396                                                                  00139617
001397                                                                  00139717
001398*-----------------------------------------------------------------00139817
001399* THIS SQL IS TO GET THE CURRENT UNIT QTY FOR THE TRIP            00139917
001400*-----------------------------------------------------------------00140017
001401 3050-GET-UNIT-QTY.                                               00140117
001410                                                                  00141001
001438     EXEC SQL                                                     00143801
001439         SELECT  T1.CURR_DIVERT_UNITS                             00143943
001440              ,  T2.CURR_SCAN_ON_QTY                              00144043
001442           INTO :PV-NEW-CURR-DIVERT-UNT :PV-NULL-IND-3            00144244
001443              , :PV-NEW-SCAN-ON-UNT     :PV-NULL-IND-5            00144344
001449         FROM                                                     00144943
001450         (SELECT A.OTBND_TRIP_ID                                  00145043
001451               , SUM(D.SHPD_UNT_QTY) AS CURR_DIVERT_UNITS         00145143
001452            FROM TSUOBTR A                                        00145243
001453               , TSUCDOT B                                        00145343
001454               , TSUCRDV C                                        00145443
001455               , SUT_OTBND_UPC D                                  00145543
001456               , SUT_OTBND_CART I                                 00145643
001457           WHERE A.OTBND_TRIP_ID      = :DK-TRIP                  00145743
001458             AND A.OTBND_TRIP_ID      =  B.OTBND_TRIP_ID          00145843
001459             AND B.OPER_UNT_ID        =  C.OPER_UNT_ID            00145943
001460             AND B.DOOR_ID            =  C.DOOR_ID                00146043
001461             AND A.DEST_OPER_UNT_ID   =  C.DEST_OPER_UNT_ID       00146143
001462             AND C.DIVERT_TMST       >=  B.STRT_DIVERT_TMST       00146243
001463             AND C.DIVERT_TMST       <=  B.END_DIVERT_TMST        00146343
001464             AND C.DIVERT_TMST  IN                                00146443
001465                (SELECT MAX(E.DIVERT_TMST)                        00146543
001466                   FROM TSUCRDV E                                 00146643
001467                  WHERE C.SHIPT_UNT_ID   =  E.SHIPT_UNT_ID        00146743
001468                    AND E.ACTV_CDE       = 'A')                   00146843
001469             AND C.ACTV_CDE = 'A'                                 00146943
001470             AND C.SHIPT_UNT_ID  = D.SHIPT_UNT_ID                 00147043
001471             AND C.SHIPT_UNT_ID  = I.SHIPT_UNT_ID                 00147143
001472             AND I.ACTV_IND      = 'Y'                            00147243
001473           GROUP BY A.OTBND_TRIP_ID                               00147343
001474         ) AS T1                                                  00147443
001475         LEFT OUTER JOIN                                          00147543
001476         (SELECT F.OTBND_TRIP_ID                                  00147643
001477               , SUM(H.SHPD_UNT_QTY)                              00147743
001478                 AS CURR_SCAN_ON_QTY                              00147843
001479            FROM TSUOBTR F                                        00147943
001480               , SUT_OTBND_LOC G                                  00148043
001481               , SUT_OTBND_UPC H                                  00148143
001482               , SUT_OTBND_CART J                                 00148248
001483           WHERE F.OTBND_TRIP_ID     = :DK-TRIP                   00148348
001484             AND F.OTBND_TRIP_ID     =  G.OTBND_TRIP_ID           00148448
001485             AND G.SCN_CDE           = 'SHON'                     00148548
001486             AND G.ACTV_CDE = 'A'                                 00148648
001487             AND G.SHIPT_UNT_ID      = H.SHIPT_UNT_ID             00148748
001488             AND G.SHIPT_UNT_ID      = J.SHIPT_UNT_ID             00148848
001489             AND J.ACTV_IND          = 'Y'                        00148948
001490           GROUP BY F.OTBND_TRIP_ID                               00149048
001491         ) AS T2                                                  00149148
001500         ON T1.OTBND_TRIP_ID =  T2.OTBND_TRIP_ID                  00150043
001501           WITH UR                                                00150101
001502     END-EXEC.                                                    00150201
001503                                                                  00150301
001504     EVALUATE TRUE                                                00150401
001505         WHEN SQLCODE = ZERO                                      00150501
001507         WHEN SQLCODE = -305                                      00150717
001508              IF  PV-NULL-IND-3  =  -1                            00150817
001509                  MOVE ZEROES  TO  PV-NEW-CURR-DIVERT-UNT         00150943
001511              END-IF                                              00151117
001512              IF  PV-NULL-IND-5  =  -1                            00151243
001513                  MOVE ZEROES  TO  PV-NEW-SCAN-ON-UNT             00151343
001514              END-IF                                              00151443
001515                                                                  00151517
001516              ADD  PV-NEW-CURR-DIVERT-UNT  TO                     00151643
001517                   PV-NEW-SCAN-ON-UNT                             00151743
001518                   GIVING PV-NEW-MFST-UNIT-CNT                    00151843
001519                                                                  00151943
001520         WHEN SQLCODE = +100                                      00152017
001521              MOVE ZEROES  TO  PV-NEW-MFST-UNIT-CNT               00152117
001522                                                                  00152217
001523         WHEN SQLWARN0 NOT = SPACES                               00152317
001524         WHEN SQLCODE < ZERO                                      00152417
001525         WHEN SQLCODE > ZERO                                      00152517
001526              MOVE SQLCODE              TO PV-DISP-SQLCODE        00152617
001527              MOVE DK-TRIP              TO PV-DISP-TRIP           00152717
001528              MOVE DK-OPER              TO PV-DISP-OPER           00152817
001529              MOVE DK-DEST              TO PV-DISP-DEST           00152917
001530*                                                                 00153017
001531              STRING '3050-'                                      00153117
001532                     ' SQL:'   PV-DISP-SQLCODE                    00153217
001533                     ' TRIP:'  PV-DISP-TRIP                       00153317
001534                     ' TMST:'  DK-EXTRACT-TMST                    00153417
001535                     ' OPER:'  PV-DISP-OPER                       00153517
001536                     ' DEST:'  PV-DISP-DEST                       00153617
001537                               DELIMITED BY SIZE                  00153717
001538                          INTO PV-MESSAGE-1                       00153817
001539                                                                  00153917
001540             DISPLAY PV-MESSAGE-1                                 00154017
001541                                                                  00154117
001542             MOVE '3050-GET-UNIT-QTY          '                   00154217
001543                                 TO PV-PARAGRAPH-NAME             00154317
001544             MOVE 'GET CURRENT UNIT QUANTITY FOR TRIP       '     00154417
001545                                 TO PV-DB2-OPERATION              00154517
001546             PERFORM 9100-SQL-ABEND                               00154617
001547     END-EVALUATE.                                                00154717
001548                                                                  00154817
001549                                                                  00154917
001550*-----------------------------------------------------------------00155001
001551* CALL BATCH OUTBOUND TRAILER SUMMARIZATION MODULE - SUKUT576     00155101
001552*-----------------------------------------------------------------00155201
001553 4000-SUMMARIZE-TRAILER.                                          00155337
001554                                                                  00155436
001555     SET  PC047-BOTH-TOTAL       TO TRUE.                         00155536
001556     MOVE 'SUKUT201'             TO PC047-CALLING-PROGRAM.        00155636
001557     MOVE SPACES                 TO PC047-DOOR-ID.                00155736
001560     MOVE ZEROES                 TO PC047-SCANNED-CTN-COUNT       00156036
001561                                    PC047-DIVERTED-CTN-COUNT      00156136
001562                                    PC047-TOTAL-CTN-COUNT         00156236
001563                                    PC047-MISDIRECT-COUNT         00156336
001564                                    PC047-NO-DATA-COUNT.          00156436
001565     MOVE SU166-OTBND-TRIP-ID    TO PC047-OTBND-TRIP-ID.          00156536
001570     MOVE SU166-DOOR-TYPE        TO PC047-DOOR-TYPE-CDE.          00157036
001574     MOVE SU166-DEST-OPER-UNT-ID TO PC047-DEST-OPER-UNT-ID.       00157436
001576     MOVE SU166-OPER-UNT-ID      TO PC047-OPER-UNT-ID.            00157636
001580                                                                  00158049
001584     CALL PC-TRLR-SUM USING PC047-COMMAREA.                       00158449
001585                                                                  00158549
001586     IF  PC047-SUCCESSFUL                                         00158649
001587         ADD  1  TO  PV-TOTAL-RESUM                               00158748
001588                                                                  00158849
001589         EXEC SQL                                                 00158949
001590             COMMIT                                               00159049
001591         END-EXEC                                                 00159149
001592                                                                  00159249
001593     ELSE                                                         00159349
001594         DISPLAY ' BAD RETURN FROM SUKUT576'                      00159449
001595         DISPLAY ' PC047-CRA-RET-CDE:     '   PC047-CRA-RET-CDE   00159549
001596         DISPLAY ' PC047-CRA-RET-MSG:     '   PC047-CRA-RET-MSG   00159649
001597         DISPLAY ' PC047-CRA-REQ-ID:      '   PC047-CRA-REQ-ID    00159749
001598         DISPLAY ' PC047-CRA-RET-CDE:     '   PC047-CRA-RET-CDE   00159849
001599         DISPLAY ' '                                              00159949
001600                                                                  00160049
001601         MOVE PC047-OTBND-TRIP-ID         TO  PV-DISP-TRIP        00160149
001602         DISPLAY ' PC047-OTBND-TRIP-ID:   '   PV-DISP-TRIP        00160249
001603                                                                  00160349
001604         MOVE PC047-SCANNED-CTN-COUNT     TO  PV-DISP-CNT         00160449
001605         DISPLAY ' PC047-SCANNED-CTN-CNT: '   PV-DISP-CNT         00160549
001606                                                                  00160649
001607         MOVE PC047-DIVERTED-CTN-COUNT    TO  PV-DISP-CNT         00160749
001608         DISPLAY ' PC047-DIVERTED-CTN-CNT:'   PV-DISP-CNT         00160849
001609                                                                  00160949
001610         MOVE PC047-TOTAL-CTN-COUNT       TO  PV-DISP-CNT         00161049
001611         DISPLAY ' PC047-TOTAL-CTN-COUNT  '   PV-DISP-CNT         00161149
001612         DISPLAY ' '                                              00161249
001613                                                                  00161349
001614         MOVE  PC047-SQLCODE             TO  PV-DISP-SQLCODE      00161449
001615         DISPLAY ' PC047-SQLCODE:       '    PV-DISP-SQLCODE      00161549
001616                                                                  00161649
001617         DISPLAY ' PC047-SQLCA:         ' PC047-SQLCA             00161749
001618         DISPLAY ' PC047-PARAGRAPH      ' PC047-PARAGRAPH         00161849
001619         DISPLAY ' PC047-DB2-TABLE-NAME:' PC047-DB2-TABLE-NAME(1) 00161949
001620         DISPLAY '                      ' PC047-DB2-TABLE-NAME(2) 00162049
001621         DISPLAY '                      ' PC047-DB2-TABLE-NAME(3) 00162149
001622         DISPLAY '                      ' PC047-DB2-TABLE-NAME(4) 00162249
001623         DISPLAY '                      ' PC047-DB2-TABLE-NAME(5) 00162349
001624         DISPLAY ' '                                              00162449
001625                                                                  00162549
001626         DISPLAY ' PC047-DOOR-TYPE-CDE:   ' PC047-DOOR-TYPE-CDE   00162649
001627                                                                  00162749
001628         MOVE  PC047-DEST-OPER-UNT-ID    TO PV-DISP-DEST          00162849
001629         DISPLAY 'PC047-DEST-OPER-UNT-ID: ' PV-DISP-DEST          00162949
001630                                                                  00163049
001631         MOVE  PC047-OPER-UNT-ID         TO PV-DISP-OPER          00163149
001632         DISPLAY 'PC047-OPER-UNT-ID:      ' PV-DISP-OPER          00163249
001633         DISPLAY 'PC047-DOOR-ID:          ' PC047-DOOR-ID         00163349
001634                                                                  00163449
001635         MOVE  PC047-MISDIRECT-COUNT     TO PV-DISP-CNT           00163549
001636         DISPLAY 'PC047-MISDIRECT-COUNT:  ' PV-DISP-CNT           00163649
001637                                                                  00163749
001638         MOVE  PC047-NO-DATA-COUNT       TO PV-DISP-CNT           00163849
001639         DISPLAY 'PC047-NO-DATA-COUNT:    ' PV-DISP-CNT           00163949
001640                                                                  00164049
001641                                                                  00164149
001642         PERFORM 9100-SQL-ABEND                                   00164249
001643     END-IF.                                                      00164349
001644                                                                  00164438
001645     DISPLAY '                                          '.        00164538
001646                                                                  00164638
001647                                                                  00164738
001648*-----------------------------------------------------------------00164838
001649* DISPLAY SUMMARIZATION STATUS                                    00164938
001650*-----------------------------------------------------------------00165038
001651 4010-SUMMARY-STATUS.                                             00165138
001652                                                                  00165238
001653     MOVE  SU166-OPER-UNT-ID        TO  PV-DISP-OPER.             00165338
001654     MOVE  SU166-OTBND-TRIP-ID      TO  PV-DISP-TRIP.             00165438
001655     MOVE  SU166-DEST-OPER-UNT-ID   TO  PV-DISP-DEST.             00165538
001656     MOVE  SU166-TRLR-SRL-NBR       TO  PV-DISP-TRLR-SRL.         00165638
001657     MOVE  SU166-LAST-SUM-CRTN-CNT  TO  PV-DISP-QTY               00165738
001658     MOVE  SU166-LAST-SUM-UNT-QTY   TO  PV-DISP-UNIT.             00165838
001659     MOVE PV-INPUT-COUNT            TO  PV-DISP-QTY               00165938
001660                                                                  00166038
001661     DISPLAY   ' OPER:' PV-DISP-OPER                              00166138
001662               ' TRIP:' PV-DISP-TRIP                              00166238
001663               ' DEST:' PV-DISP-DEST                              00166338
001664               ' SRL:'  PV-DISP-TRLR-SRL                          00166438
001665               ' ST:'   SU166-TRIP-ST                             00166538
001666               '  '     PV-DISP-QTY                               00166638
001667               '     :' PV-RESULT.                                00166738
001670                                                                  00167038
001700                                                                  00170018
001796*-----------------------------------------------------------------00179601
001797*  READ INPUT FILE                                                00179701
001798*-----------------------------------------------------------------00179801
001799 8000-READ-INPUT-REC.                                             00179901
001800                                                                  00180001
001801     READ INPUT-FILE   INTO                                       00180141
001802                       SU166-OTBND-TRLR-RECORD                    00180241
001803         AT END                                                   00180341
001804             SET PS-EOF-INPUT             TO TRUE                 00180441
001805             DISPLAY ' SUKUT201 '                                 00180541
001806                     'END OF INPUT FILE'                          00180641
001807             DISPLAY SPACES                                       00180741
001808         NOT AT END                                               00180841
001809                                                                  00180914
001810             MOVE SU166-OTBND-TRIP-ID    TO  DK-TRIP              00181014
001811             MOVE SU166-LAST-SUM-TMST    TO  DK-EXTRACT-TMST      00181114
001812             MOVE SU166-OPER-UNT-ID      TO  DK-OPER              00181214
001813             MOVE SU166-DEST-OPER-UNT-ID TO  DK-DEST              00181314
001814                                                                  00181414
001815             ADD  1                 TO  PV-INPUT-COUNT            00181541
001837     END-READ.                                                    00183704
001838                                                                  00183804
001839                                                                  00183904
001840*-----------------------------------------------------------------00184004
001841*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    00184104
001842*  ERROR OR WARNING CODE OCCURS.                                  00184204
001843*-----------------------------------------------------------------00184304
001844 9100-SQL-ABEND.                                                  00184404
001845     DISPLAY '9100-SQL-ABEND'.                                    00184504
001846     DISPLAY '** ABEND     **'.                                   00184604
001847     DISPLAY '** PROGRAM   ** =  SUKUT201'.                       00184704
001848     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              00184804
001849     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               00184904
001850                                                                  00185004
001851                                                                  00185104
001852******************************************************************00185204
001853* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    00185304
001854* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         00185404
001855* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     00185504
001856* FORMAT.                                                         00185604
001857******************************************************************00185704
001858     COPY DPPD004.                                                00185804
001859                                                                  00185904
001860     MOVE +4013                  TO ABEND-CODE.                   00186004
