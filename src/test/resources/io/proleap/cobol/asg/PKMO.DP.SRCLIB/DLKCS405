000100 TITLE  'SHIP DOOR TEMPLATE ADD'.                                         
000200 IDENTIFICATION DIVISION.                                                 
000300 PROGRAM-ID.    DLKCS405.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  DECEMBER 2003.                                            
000700 DATE-COMPILED.                                                           
000800                                                                          
263627*----------------------------------------------------------------*        
263627* CHANGED 11/04/2021    BY JIM HUNTER      WR: CHG0263627                 
263627* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
263627* MAKING THE CALL DYNAMIC VS STATIC.                                      
      *                                                                         
009461* CHANGED 10/24/2022    BY BOB MCASEY      WR: CHG0279137                 
009491* ADD COPYBOOK DPWS930 CHANGE CICS ARCHITECTURE CALL TO                   
009491* CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API                
263627*----------------------------------------------------------------*        
000900 ENVIRONMENT DIVISION.                                                    
001000 DATA DIVISION.                                                           
001100 WORKING-STORAGE SECTION.                                                 
001200                                                                          
001300 01  DK-DB2-KEYS.                                                         
001400     05  DK-DC-NBR                    PIC S9(04) COMP VALUE ZERO.         
001500                                                                          
001600                                                                          
001700 01  PC-PROGRAM-CONSTANTS.                                                
001800     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE                 
001900                                                    'DLK405  '.           
002000     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE                 
002100                                                    'DLKM405 '.           
002200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE                 
002300                                                    'DLKCS405'.           
002400     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.              
002500     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.              
002600     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.            
002700     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +65             
002800                                                    COMP SYNC.            
002900     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2              
003000                                                    COMP SYNC.            
003100     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE                 
003200                                                    +1000000              
003300                                                    COMP-3.               
003400     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5              
003500                                                    COMP SYNC.            
003600     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3               
003700                                                    COMP-3.               
003800     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.            
003900     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.          
004000     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.          
004100     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.          
004200     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.          
004300*                                                                         
004400     05  PC-TSYMSG-NUMBERS.                                               
004500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.          
004600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.          
004700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.          
004800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.          
004900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.          
005000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.          
005100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.          
005200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.          
005300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.          
005400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.          
005500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.          
005600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.          
005700         10  PC-TSYMSG-01305            PIC  9(05)  VALUE 01305.          
005800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.          
005900         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.          
006000         10  PC-TSYMSG-03181            PIC  9(05)  VALUE 03181.          
006100         10  PC-TSYMSG-03182            PIC  9(05)  VALUE 03182.          
006200         10  PC-TSYMSG-03183            PIC  9(05)  VALUE 03183.          
006300         10  PC-TSYMSG-03185            PIC  9(05)  VALUE 03185.          
006400         10  PC-TSYMSG-03186            PIC  9(05)  VALUE 03186.          
006500         10  PC-TSYMSG-03187            PIC  9(05)  VALUE 03187.          
006600         10  PC-TSYMSG-03199            PIC  9(05)  VALUE 03199.          
006700         10  PC-TSYMSG-03201            PIC  9(05)  VALUE 03201.          
006800         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.          
006900*                                                                         
007000 01  PS-PROGRAM-SWITCHES.                                                 
007100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.            
007200         88  PS-NO-ERROR                            VALUE 'Y'.            
007300         88  PS-ERROR                               VALUE 'N'.            
007400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.            
007500         88  PS-COMMAREA-VALID                      VALUE 'Y'.            
007600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.            
007700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.            
007800         88  PS-DONE                                VALUE 'Y'.            
007900         88  PS-NOT-DONE                            VALUE 'N'.            
008000     05  PS-ACCESS-SW                   PIC  X(01)  VALUE 'N'.            
008100         88  PS-ACCESS-ALLOWED                      VALUE 'Y'.            
008200         88  PS-ACCESS-NOT-ALLOWED                  VALUE 'N'.            
008300                                                                          
008400     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.            
008500         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.            
008600         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.            
008700*                                                                         
008800 01  PV-PROGRAM-VARIABLES.                                                
008900     05  PV-SUB                         PIC S9(04)  VALUE +0              
009000                                                    COMP SYNC.            
009100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0              
009200                                                    COMP SYNC.            
009300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0              
009400                                                    COMP-3.               
009500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0              
009600                                                    COMP-3.               
009700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0              
009800                                                    COMP-3.               
009900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0              
010000                                                    COMP-3.               
010100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0              
010200                                                    COMP-3.               
010300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0              
010400                                                    COMP-3.               
010500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0              
010600                                                    COMP-3.               
010700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0              
010800                                                    COMP SYNC.            
010900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0              
011000                                                    COMP SYNC.            
011100     05  PV-ITEM                        PIC S9(04)  VALUE +0              
011200                                                    COMP SYNC.            
011300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0              
011400                                                    COMP SYNC.            
011500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0              
011600                                                    COMP SYNC.            
011700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0              
011800                                                    COMP SYNC.            
011900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0              
012000                                                    COMP SYNC.            
012100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0              
012200                                                    COMP SYNC.            
012300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
012400                                                    COMP SYNC.            
012500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0              
012600                                                    COMP SYNC.            
012700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0              
012800                                                    COMP SYNC.            
012900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0              
013000                                                    COMP SYNC.            
013100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0              
013200                                                    COMP SYNC.            
013300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0              
013400                                                    COMP SYNC.            
013500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0              
013600                                                    COMP SYNC.            
013700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0              
013800                                                    COMP SYNC.            
013900                                                                          
014000                                                                          
014100                                                                          
014200     05  PV-TEMPLATE-STATUS           PIC X(08) VALUE SPACE.              
014300     05  PV-LENGTH                    PIC S9(05) COMP-3.                  
014400     05  PV-END                       PIC S9(05) COMP-3.                  
014500     05  PV-TEMPLATE-DOOR-COUNT       PIC S9(05) COMP-3.                  
014600     05  PV-DOOR-COUNT                PIC S9(05) COMP-3.                  
014700     05  PV-GROUP-COUNT               PIC S9(05) COMP-3.                  
014800     05  PV-COMMAREA-LENGTH           PIC S9(04) COMP VALUE ZERO.         
014900     05  PV-SOFT-ABORT-MSG.                                               
015000         10  FILLER            PIC X(12) VALUE ' DLKCS405 - '.            
015100         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.               
015200         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                            
015300         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.            
015400         10  PV-SOFT-PARAGRAPH PIC X(30).                                 
015500     05  PV-CICS-MSG-AREA2            PIC  X(100) VALUE SPACE.            
015600     05  PT-DESC-AREA.                                                    
015700         10  PT-DESC-BYTE OCCURS 40 TIMES PIC X(01).                      
015800                                                                          
015900******************************************************************        
016000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **        
016100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **        
016200**  APPLICATION-SPECIFIC COMMAREA.                              **        
016300******************************************************************        
016400 01  LQW-LIST-QUEUE-WORK-AREA.                                            
016500     05  LQW-BLOCK-MODIFIED-SW        PIC  X(01)  VALUE SPACE.            
016600         88  LQW-BLOCK-NOT-MODIFIED      VALUE 'N'.                       
016700         88  LQW-BLOCK-MODIFIED          VALUE 'Y'.                       
016800                                                                          
016900     05  LQW-ITEM-ENTRIES             OCCURS 65 TIMES                     
017000                                      INDEXED BY LQW-IDX.                 
017100         10  LQW-LIST-ITEM-NUMBER     PIC S9(09)  COMP-3.                 
017200                                                                          
017300         10  LQW-ERROR-SW             PIC X(01).                          
017400             88  LQW-ERROR-YES                  VALUE 'Y'.                
017500             88  LQW-ERROR-NO                   VALUE SPACE.              
017600                                                                          
017700         10  LQW-NUMERIC-ERROR-SW     PIC X(01).                          
017800             88  LQW-NUMERIC-ERROR-YES           VALUE 'Y'.               
017900             88  LQW-NUMERIC-ERROR-NO            VALUE SPACE.             
018000                                                                          
018100         10  LQW-DOOR-ID              PIC  X(04).                         
018200         10  LQW-GROUP-NBR            PIC  X(04).                         
018300         10  LQW-GROUP-NBR-N REDEFINES LQW-GROUP-NBR                      
018400                                      PIC 9999.                           
018500/                                                                         
018600*---------------------------------------------------------------*         
018700*  RECORD LAYOUT FOR THE MESSAGE SELECTION TEMP STORAGE QUEUE.  *         
018800*---------------------------------------------------------------*         
018900                                                                          
019000     COPY DPWS057.                                                        
019100                                                                          
019200/                                                                         
019300*---------------------------------------------------------------*         
019400*    MAP LAYOUT                                                 *         
019500*---------------------------------------------------------------*         
019600                                                                          
019700     COPY DLKM405.                                                        
019800*                                                                         
019900 01  MR-OCCURS-LAYOUT                   REDEFINES  DLK405O.               
020000     05  FILLER                         PIC X(169).                       
020100     05  MR-SCROLL-AREA                 OCCURS 65 TIMES.                  
020200                                                                          
020300         10  MR-DOOR-NBR-L            PIC S9(04) COMP.                    
020400         10  MR-DOOR-NBRA             PIC  X(01).                         
020500         10  MR-DOOR-NBRC             PIC  X(01).                         
020600         10  MR-DOOR-NBRH             PIC  X(01).                         
020700         10  MR-DOOR-NBR              PIC  X(04).                         
020800                                                                          
020900         10  MR-GROUP-NBR-L           PIC S9(04) COMP.                    
021000         10  MR-GROUP-NBRA            PIC  X(01).                         
021100         10  MR-GROUP-NBRC            PIC  X(01).                         
021200         10  MR-GROUP-NBRH            PIC  X(01).                         
021300         10  MR-GROUP-NBR.                                                
021400             15  MR-GROUP-NBR-N       PIC Z(04).                          
021500                                                                          
021600/                                                                         
021700*---------------------------------------------------------------*         
021800*    ATTRIBUTE SETTINGS COPYBOOK.                               *         
021900*---------------------------------------------------------------*         
022000                                                                          
022100     COPY DPWS015.                                                        
022200                                                                          
022300*---------------------------------------------------------------*         
022400*    FUNCTION KEYS COPYBOOK.                                    *         
022500*---------------------------------------------------------------*         
022600                                                                          
022700     COPY DPWS016.                                                        
022800                                                                          
022900*---------------------------------------------------------------*         
023000*    NUMERIC EDIT LAYOUT.                                       *         
023100*---------------------------------------------------------------*         
023200                                                                          
023300     COPY DPWS010I.                                                       
023400 EJECT                                                                    
023500*---------------------------------------------------------------*         
023600*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   *         
023700*---------------------------------------------------------------*         
023800                                                                          
023900     COPY DPWS030.                                                        
1022RM     COPY DPWS930.                                                        
024000 EJECT                                                                    
024100*---------------------------------------------------------------*         
024200*    STANDARD COMMAREA.                                         *         
024300*---------------------------------------------------------------*         
024400                                                                          
024500     COPY DPWS020.                                                        
024600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                        
024700                                                                          
024800*---------------------------------------------------------------*         
024900* INTER-APPLICATION COMMAREA.                                   *         
025000*   DPWS054 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    *         
025100*             SPEC SCREEN.                                      *         
025200*   DPWS056 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     *         
025300*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    *         
025400*---------------------------------------------------------------*         
025500                                                                          
025600         10  INTER-APPL-COMM-AREA       PIC X(200).                       
025700     COPY DLWS002.                                                        
025800*---------------------------------------------------------------*         
025900*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   *         
026000*---------------------------------------------------------------*         
026100         10  ASC-SPECIFIC-COMMAREA.                                       
026200             15  ASC-LIST-KEYS.                                           
026300                 20  ASC-KEY-OPER-UNT-ID                                  
026400                                      PIC S9(04) COMP.                    
026500                 20  ASC-KEY-OPER-DESC                                    
026600                                      PIC X(40).                          
026700                 20  ASC-KEY-TEMPLATE-DESC                                
026800                                      PIC X(40).                          
026900                 20  ASC-KEY-DOOR-COUNT                                   
027000                                      PIC S9(04) COMP.                    
027100                 20 ASC-DOOR-GP-TMPL-ID                                   
027200                                      PIC  S9(9) COMP.                    
027300                                                                          
027400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                        
027500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).          
027600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.           
027700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.           
027800                                                                          
027900                 20  ASC-ITEM-ARRAY.                                      
028000                     25  ASC-ITEM-ENTRIES OCCURS 65 TIMES.                
028100                         30  ASC-LIST-ITEM-NUMBER                         
028200                                                     PIC S9(09)           
028300                                                     COMP-3.              
028400                         30  ASC-ERROR-SW            PIC X(01).           
028500                             88   ASC-ERROR-YES      VALUE 'Y'.           
028600                             88   ASC-ERROR-NO       VALUE SPACE.         
028700                                                                          
028800                         30  ASC-NUMERIC-ERROR-SW     PIC X(01).          
028900                             88  ASC-NUMERIC-ERROR-YES VALUE 'Y'.         
029000                             88  ASC-NUMERIC-ERROR-NO VALUE SPACE.        
029100                                                                          
029200                         30  ASC-DOOR-ID             PIC  X(04).          
029300                         30  ASC-GROUP-NBR-X.                             
029400                             35 ASC-GROUP-NBR        PIC  9(04).          
029500                                                                          
029600             15  ASC-BLK-SUB                         PIC S9(04)           
029700                                                          COMP            
029800                                                          SYNC.           
029900             15  ASC-ITEM-SUB                        PIC S9(04)           
030000                                                          COMP            
030100                                                          SYNC.           
030200             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)           
030300                                                          COMP-3.         
030400             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)           
030500                                                          COMP-3.         
030600             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)           
030700                                                          COMP-3.         
030800             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)           
030900                                                          COMP-3.         
031000             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)           
031100                                                          COMP-3.         
031200             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)           
031300                                                          COMP            
031400                                                          SYNC.           
031500             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)           
031600                                                          COMP-3.         
031700             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)           
031800                                                          COMP-3.         
031900             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).          
032000                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.           
032100                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.           
032200             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).          
032300                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.           
032400                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.           
032500             15  ASC-LIST-QUEUE-NAME.                                     
032600                 20  ASC-LIST-TERM-ID                PIC  X(04).          
032700                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)           
032800                                                          COMP-3.         
032900                 20  ASC-LIST-SEQ                    PIC  9(01).          
033000             15  ASC-SEL-QUEUE-NAME.                                      
033100                 20  ASC-SEL-TERM-ID                 PIC  X(04).          
033200                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)           
033300                                                          COMP-3.         
033400                 20  ASC-SEL-SEQ                     PIC  9(01).          
033500                                                                          
033600             15  ASC-CURSOR-SW                       PIC  X(01).          
033700                 88  ASC-NO-CURSOR                   VALUE 'Z'.           
033800                 88  ASC-SYSTEM-ID-CURSOR            VALUE 'S'.           
033900                 88  ASC-MESSAGE-NUMBER-CURSOR       VALUE 'N'.           
034000                 88  ASC-MESSAGE-TEXT-CURSOR         VALUE 'T'.           
034100             15  ASC-START-ITEM-REQUEST.                                  
034200                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).          
034300             15  ASC-PROTECT-ALL-FIELDS-SW           PIC X.               
034400                 88  ASC-PROTECT-YES         VALUE 'Y'.                   
034500                 88  ASC-PROTECT-NO          VALUE 'N'.                   
034600             15  ASC-DISABLE-F5-SW                   PIC X.               
034700                 88  ASC-DISABLE-F5-YES      VALUE 'Y'.                   
034800                 88  ASC-DISABLE-F5-NO       VALUE 'N'.                   
034900/                                                                         
035000*---------------------------------------------------------------*         
035100*    ABEND PROCESSING COPYBOOK.                                 *         
035200*---------------------------------------------------------------*         
035300                                                                          
035400     COPY DPWS013.                                                        
035500*----------------------------------------------------------------*        
035600**  SECURITY SUBROUTINE PARAMETERS                                        
035700*----------------------------------------------------------------*        
035800     COPY DPWS008.                                                        
035900                                                                          
036000/                                                                         
036100     EXEC SQL                                                             
036200          INCLUDE TCNDCDR                                                 
036300     END-EXEC.                                                            
036400                                                                          
036500*    DLT_DOOR_GP_TMPL                                                     
036600     EXEC SQL                                                             
036700          INCLUDE DLT00000                                                
036800     END-EXEC.                                                            
036900                                                                          
037000*    DLT_DOOR_GP                                                          
037100     EXEC SQL                                                             
037200          INCLUDE DLT00001                                                
037300     END-EXEC.                                                            
037400                                                                          
037500*    XLT_LOC                                                              
037600     EXEC SQL                                                             
037700          INCLUDE XLT00010                                                
037800     END-EXEC.                                                            
037900                                                                          
038000*    DB2 AREA FOR COMMUNICATIONS                                *         
038100     EXEC SQL                                                             
038200          INCLUDE SQLCA                                                   
038300     END-EXEC.                                                            
038400/                                                                         
038500*    TEMPLATE CURSOR                                                      
038600     EXEC SQL                                                             
038700         DECLARE DOOR-CSR CURSOR FOR                                      
038800             SELECT  DOOR_ID                                              
038900             FROM   TCNDCDR                                               
039000             WHERE   OPER_UNT_ID  = :DK-DC-NBR                            
039100               AND   DOOR_TYP_CDE IN ('SH', 'DS', 'ST')                   
039200             ORDER BY                                                     
039300                 DOOR_ID                                                  
039400*            FETCH FIRST 066 ROWS ONLY                                    
039500     END-EXEC.                                                            
039600/                                                                         
039700 LINKAGE SECTION.                                                         
039800                                                                          
039900 01  DFHCOMMAREA.                                                         
040000     05  FILLER                         OCCURS  1 TO 4072 TIMES           
040100                                        DEPENDING ON EIBCALEN.            
040200         10  FILLER                     PIC X.                            
040300                                                                          
040400 EJECT                                                                    
040500 PROCEDURE DIVISION.                                                      
040600******************************************************************        
040700**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **        
040800**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **        
040900**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **        
041000******************************************************************        
041100 0000-MAIN-MODULE.                                                        
041200     INITIALIZE DP030-CICS-API-FIELDS.                                    
041300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.               
041400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.                  
041500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).                 
041600     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                               
041700     MOVE LENGTH OF DLK405I        TO DP030-MAP-LENGTH (1).               
041800     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).             
041900     PERFORM 0001-CALL-CICS-ARCH-API.                                     
042000*                                                                         
042100     PERFORM 1000-CONTROL-PROCESSING                                      
042200*                                                                         
042300     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).             
042400     PERFORM 0001-CALL-CICS-ARCH-API.                                     
042500                                                                          
042600******************************************************************        
042700**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **        
042800**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **        
042900******************************************************************        
043000 0001-CALL-CICS-ARCH-API.                                                 
043100     CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
043200                                    DFHCOMMAREA                           
043300                                    DP030-CICS-API-FIELDS                 
043400                                    DP020-STANDARD-COMMAREA               
043500                                    DLK405I.                              
043600*                                                                         
043700     IF  DP030-RC-CALL-SUCCESSFUL                                         
043800         CONTINUE                                                         
043900     ELSE                                                                 
044000         SET DP013-NO-ROLLBACK                                            
044100             DP013-XCTL-DISPLAY-RESTART                                   
044200             DP013-CICS-ABEND      TO TRUE                                
044300         MOVE '0001-CALL-CICS-ARCH-API'                                   
044400                                   TO DP013-PARAGRAPH                     
1022RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1022RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
044700         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)              
044800         PERFORM DP013-0000-PROCESS-ABEND                                 
044900     END-IF.                                                              
045000*----------------------------------------------------------------*        
045100* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *        
045200* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *        
045300*                                                                *        
045400* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *        
045500*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *        
045600*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *        
045700*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *        
045800*----------------------------------------------------------------*        
045900                                                                          
046000 1000-CONTROL-PROCESSING.                                                 
046100                                                                          
046200     EVALUATE TRUE                                                        
046300         WHEN DP020-NEXT-ACT-INITIAL                                      
046400             INITIALIZE ASC-SPECIFIC-COMMAREA                             
046500             SET ASC-DISABLE-F5-NO    TO TRUE                             
046600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID                    
046700                                      ASC-SEL-TERM-ID                     
046800             MOVE DP020-SRC-TASK-NUMBER                                   
046900                                   TO ASC-LIST-TASK-NUMBER                
047000                                      ASC-SEL-TASK-NUMBER                 
047100             MOVE PC-LIST-QUEUE-SEQ                                       
047200                                   TO ASC-LIST-SEQ                        
047300             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                         
047400             PERFORM 1100-PROCESS-INTER-APPL-COMM                         
047500***-----$TEMPLATE NOTE$-------------------------------------------        
047600*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,        
047700*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO          
047800*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.        
047900***---------------------------------------------------------------        
048000             IF  PS-COMMAREA-NOT-VALID                                    
048100***              MOVE PC-TSYMSG-99901                                     
048200***                                TO DP020-MSG-NUMBER                    
048300***              SET DP020-MSG-FATAL                                      
048400***                                TO TRUE                                
048500                 SET DP020-NEXT-ACT-APPL-ERROR                            
048600                                   TO TRUE                                
048700             ELSE                                                         
048800                 PERFORM 4000-BUILD-INITIAL-PANEL                         
048900             END-IF                                                       
049000                                                                          
049100             MOVE -1                  TO ADESCL                           
049200             SET DP030-SET-CURSOR-APPL-1                                  
049300                                      TO TRUE                             
049400                                                                          
049500         WHEN DP020-NEXT-ACT-READ-MAP                                     
049600             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
049700                                   TO PV-TOP-ITEM                         
049800             PERFORM 2000-PROCESS-PANEL                                   
049900                                                                          
050000         WHEN DP020-NEXT-ACT-RETURN                                       
050100             MOVE ASC-ITEM-AT-TOP-OF-PANEL                                
050200                                   TO PV-TOP-ITEM                         
050300             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
050400             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                         
050500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
050600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
050700                                                                          
050800         WHEN OTHER                                                       
050900             SET DP013-LOGIC-ABEND TO TRUE                                
051000             SET DP013-NO-ROLLBACK TO TRUE                                
051100             MOVE '1000-CONTROL-PROCESSING'                               
051200                                   TO DP013-PARAGRAPH                     
051300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'            
051400                                   TO DP013-MESSAGE-TEXT(1)               
051500             PERFORM DP013-0000-PROCESS-ABEND                             
051600     END-EVALUATE.                                                        
051700                                                                          
051800 EJECT                                                                    
051900*----------------------------------------------------------------*        
052000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *        
052100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *        
052200*----------------------------------------------------------------*        
052300                                                                          
052400 1100-PROCESS-INTER-APPL-COMM.                                            
052500                                                                          
052600     SET PS-COMMAREA-VALID         TO TRUE.                               
052700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.             
052800*    IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT                  
052900*        MOVE DP054-MESSAGE-TEXT                                          
053000*                                  TO ASC-KEY-MESSAGE-TEXT                
053100*                                     DK-MESSAGE-TEXT                     
053200*        MOVE DP054-MESSAGE-NUMBER                                        
053300*                                  TO ASC-KEY-MESSAGE-NUMBER              
053400*                                     DK-MESSAGE-NUMBER                   
053500*        MOVE DP054-SYSTEM-ID      TO ASC-KEY-SYSTEM-ID                   
053600*                                     DK-SYSTEM-ID                        
053700*        MOVE DP054-REVIEW-IND     TO ASC-KEY-REVIEW-IND                  
053800*                                     DK-REVIEW-IND                       
053900*    ELSE                                                                 
054000                                                                          
054100     MOVE DP020-LOCATION-NBR          TO DK-DC-NBR                        
054200                                         ADCO                             
054300                                         ASC-KEY-OPER-UNT-ID.             
054400                                                                          
054500     PERFORM 7000-LOCATION-DESC.                                          
054600     MOVE ASC-KEY-OPER-DESC           TO ADCNMEO.                         
054700                                                                          
054800     MOVE DL002-DOOR-COUNT            TO                                  
054900                                         ASC-KEY-DOOR-COUNT               
055000                                         ATDOORO.                         
055100                                                                          
055200                                                                          
055300*    IF  DP020-NAV-KEY-DATA > SPACE                                       
055400*        MOVE DP020-NAV-KEY-DATA                                          
055500*                                  TO DK-MESSAGE-TEXT                     
055600*                                     ASC-KEY-MESSAGE-TEXT                
055700*    END-IF.                                                              
055800*    END-IF.                                                              
055900/                                                                         
056000*----------------------------------------------------------------*        
056100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *        
056200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *        
056300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *        
056400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *        
056500* FUNCTION KEYS CAN GET THIS FAR.                                *        
056600*----------------------------------------------------------------*        
056700                                                                          
056800 2000-PROCESS-PANEL.                                                      
056900     EVALUATE TRUE                                                        
057000         WHEN DP020-SRC-AID = DP016-CLEAR                                 
057100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL            
057200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
057300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
057400                                                                          
057500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                            
057600             IF ASC-DISABLE-F5-NO                                         
057700                 MOVE ASC-KEY-OPER-UNT-ID                                 
057800                                      TO DK-DC-NBR                        
057900                 MOVE SPACES          TO ADESCO                           
058000                 PERFORM 2050-DELETE-LIST-QUEUE                           
058100                 PERFORM 4000-BUILD-INITIAL-PANEL                         
058200                                                                          
058300                 MOVE -1              TO ADESCL                           
058400                 SET DP030-SET-CURSOR-APPL-1                              
058500                                      TO TRUE                             
058600             ELSE                                                         
058700*                MOVE ASC-DOOR-GP-TMPL-ID                                 
058800*                                     TO ATMPLO                           
058900                 PERFORM 6000-REFRESH-PANEL-FROM-TEMP                     
059000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
059100                 SET DP020-MSG-INFORMATIONAL  TO  TRUE                    
059200                 MOVE PC-TSYMSG-03201     TO DP020-MSG-NUMBER             
059300             END-IF                                                       
059400                                                                          
059500         WHEN OTHER                                                       
059600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                         
059700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                           
059800             IF  PS-NO-ERROR                                              
059900                 SET DP030-CONTINUE-GO                                    
060000                                 TO TRUE                                  
060100                 PERFORM 2100-CHECK-FUNCTION-KEY                          
060200             ELSE                                                         
060300                 SET DP030-OVERRIDE-GO                                    
060400                                 TO TRUE                                  
060500             END-IF                                                       
060600     END-EVALUATE.                                                        
060700/                                                                         
060800 2001-NUM-EDIT.                                                           
060900     MOVE ASC-GROUP-NBR-X (ASC-BLK-SUB ASC-ITEM-SUB)                      
061000                                      TO DP010I-UNEDITED-FIELD            
061100     MOVE +4                          TO DP010I-MAXIMUM-DIGITS            
061200     MOVE ZERO                        TO DP010I-MAXIMUM-DECIMALS          
061300     SET DP010I-NEGATIVE-NOT-ALLOWED  TO TRUE                             
061400                                                                          
263627     CALL DP010I-NUMERIC-EDIT-ROUTINE                                     
263627          USING DP010I-NUMERIC-EDIT-AREA                                  
061600                                                                          
061700     IF NOT DP010I-ERROR-DETECTED                                         
061800         MOVE DP010I-NUMERIC-FIELD    TO ASC-GROUP-NBR                    
061900                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
062000     END-IF.                                                              
062100                                                                          
062200*----------------------------------------------------------------*        
062300*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *        
062400*----------------------------------------------------------------*        
062500 2050-DELETE-LIST-QUEUE.                                                  
062600                                                                          
062700     EXEC CICS                                                            
062800         DELETEQ TS                                                       
062900             QUEUE (ASC-LIST-QUEUE-NAME)                                  
063000             RESP  (PV-CICS-RESP)                                         
063100     END-EXEC.                                                            
063200                                                                          
063300     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                               
063400        (PV-CICS-RESP = DFHRESP(QIDERR))                                  
063500         CONTINUE                                                         
063600     ELSE                                                                 
063700         SET DP013-CICS-ABEND      TO TRUE                                
063800         SET DP013-NO-ROLLBACK     TO TRUE                                
063900                                                                          
064000         MOVE '2050-DELETE-LIST-QUEUE'                                    
064100                                   TO DP013-PARAGRAPH                     
064200         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'            
064300                                   TO DP013-MESSAGE-TEXT (1)              
064400         PERFORM DP013-0000-PROCESS-ABEND                                 
064500     END-IF.                                                              
064600                                                                          
064700     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.          
064800/                                                                         
064900*----------------------------------------------------------------*        
065000* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*        
065100* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *        
065200* CICS ARCHITECTURE API.                                         *        
065300*----------------------------------------------------------------*        
065400 2100-CHECK-FUNCTION-KEY.                                                 
065500     EVALUATE TRUE                                                        
065600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                      
065700             IF ASC-PROTECT-YES                                           
065800                 MOVE ASC-DOOR-GP-TMPL-ID                                 
065900                                      TO ATMPLO                           
066000                 SET DP020-MSG-INFORMATIONAL  TO  TRUE                    
066100                 MOVE PC-TSYMSG-03201     TO DP020-MSG-NUMBER             
066200             ELSE                                                         
066300             PERFORM 2100A-FUNC01-EDITS                                   
066400             IF PS-NO-ERROR                                               
066500                 PERFORM 2100B-DO-FUNC01                                  
066600             END-IF                                                       
066700                                                                          
066800             IF PS-NO-ERROR                                               
066900                 SET ASC-PROTECT-YES                                      
067000                     ASC-DISABLE-F5-YES TO TRUE                           
067100                 MOVE ASC-DOOR-GP-TMPL-ID                                 
067200                                      TO ATMPLO                           
067300                 SET DP020-MSG-INFORMATIONAL  TO  TRUE                    
067400                 MOVE PC-TSYMSG-03183     TO DP020-MSG-NUMBER             
067500                 MOVE DP015-ASK-NOR-OFF   TO ADESCA                       
067600                 MOVE DP015-BLUE          TO ADESCC                       
067700             END-IF                                                       
067800                                                                          
067900             END-IF                                                       
068000                                                                          
068100             MOVE +1               TO PV-TOP-ITEM                         
068200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
068300                                                                          
068400         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)                      
068500             SET ASC-PROTECT-NO       TO TRUE                             
068600             MOVE ASC-KEY-OPER-UNT-ID                                     
068700                                      TO DK-DC-NBR                        
068800             MOVE ZERO                TO ATMPLO                           
068900                                         ASC-DOOR-GP-TMPL-ID              
069000             MOVE SPACES              TO ADESCO                           
069100             MOVE DP015-UNP-ALP-NOR-OFF TO ADESCA                         
069200             MOVE DP015-GREEN         TO ADESCC                           
069300             PERFORM 2050-DELETE-LIST-QUEUE                               
069400             PERFORM 4000-BUILD-INITIAL-PANEL                             
069500                                                                          
069600             MOVE -1                  TO ADESCL                           
069700             SET DP030-SET-CURSOR-APPL-1                                  
069800                                      TO TRUE                             
069900             SET ASC-DISABLE-F5-NO    TO TRUE                             
070000                                                                          
070100         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                          
070200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      
070300                 INITIALIZE DL002-INTER-APPL-COMMAREA                     
070400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        
070500                                TO DL002-NUMBER-OF-SELECTED-ITEMS         
070600                 PERFORM 5000-PREPARE-SEL-QUEUE                           
070700             ELSE                                                         
070800                 SET DP030-OVERRIDE-GO                                    
070900                                   TO TRUE                                
071000                 MOVE PC-TSYMSG-00057                                     
071100                                   TO DP020-MSG-NUMBER                    
071200                 SET DP020-MSG-WARNING                                    
071300                                   TO TRUE                                
071400             END-IF                                                       
071500                                                                          
071600         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                          
071700             MOVE +1               TO PV-TOP-ITEM                         
071800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
071900                                                                          
072000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                           
072100             PERFORM 2110-BROWSE-BACKWARD                                 
072200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
072300                                                                          
072400         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                           
072500             PERFORM 2120-BROWSE-FORWARD                                  
072600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                         
072700                                                                          
072800         WHEN DP020-SRC-AID = DP016-ENTER                                 
072900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                           
073000             IF  PS-ERROR                                                 
073100                 CONTINUE                                                 
073200             ELSE                                                         
073300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     
073400             END-IF                                                       
073500                                                                          
073600         WHEN OTHER                                                       
073700             SET DP013-NO-ROLLBACK                                        
073800                 DP013-XCTL-DISPLAY-RESTART                               
073900                 DP013-CICS-ABEND  TO TRUE                                
074000             MOVE '2100-CHECK-FUNCTION-KEY'                               
074100                                   TO DP013-PARAGRAPH                     
074200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'              
074300                                   TO DP013-MESSAGE-TEXT (1)              
074400             PERFORM DP013-0000-PROCESS-ABEND                             
074500     END-EVALUATE.                                                        
074600/                                                                         
074700 2100A-FUNC01-EDITS.                                                      
074800                                                                          
074900     IF ASC-KEY-TEMPLATE-DESC = SPACES OR LOW-VALUES                      
075000         SET PS-ERROR                                                     
075100             DP020-MSG-FATAL                                              
075200             DP030-SET-CURSOR-APPL-1                                      
075300             DP030-OVERRIDE-GO       TO TRUE                              
075400         MOVE -1                  TO ADESCL                               
075500*              'MUST KEY TEMPLATE DESCRIPTION AND                         
075600*                           ASSIGN ALL DOORS TO GROUP'                    
075700         MOVE PC-TSYMSG-03182 TO DP020-MSG-NUMBER                         
075800     END-IF                                                               
075900                                                                          
076000                                                                          
076100     PERFORM 4600-EDIT-EACH-GROUP                                         
076200             VARYING PV-ITEM  FROM 1 BY 1                                 
076300             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN                    
076400*            OR PS-ERROR                                                  
076500                                                                          
076600*    IF PS-NO-ERROR                                                       
076700*        PERFORM 2050-DELETE-LIST-QUEUE                                   
076800*        PERFORM 4000-BUILD-INITIAL-PANEL                                 
076900*        SET DP020-MSG-INFORMATIONAL  TO  TRUE                            
077000*        MOVE PC-TSYMSG-01305         TO DP020-MSG-NUMBER                 
077100*                ELSE                                                     
077200*                    MOVE PC-TSYMSG-02848 TO DP020-MSG-NUMBER             
077300*                    SET DP030-OVERRIDE-GO TO TRUE                        
077400*                    SET DP020-MSG-WARNING TO TRUE                        
077500*    END-IF                                                               
077600                                                                          
077700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
077800/                                                                         
077900 2100B-DO-FUNC01.                                                         
078000     MOVE LENGTH OF ASC-KEY-TEMPLATE-DESC TO PV-LENGTH                    
078100                                             PV-END                       
078200     MOVE ASC-KEY-TEMPLATE-DESC       TO                                  
078300                                DLT00000-DOOR-GP-TMPL-DESC-TEX            
078400                                PT-DESC-AREA                              
078500                                                                          
078600     PERFORM                                                              
078700             UNTIL PT-DESC-BYTE (PV-LENGTH)                               
078800                                   NOT = SPACE                            
078900                OR PV-LENGTH < ZERO                                       
079000             SUBTRACT 1 FROM PV-LENGTH                                    
079100      END-PERFORM                                                         
079200                                                                          
079300     IF PV-LENGTH < ZERO                                                  
079400         MOVE ZERO      TO      DLT00000-DOOR-GP-TMPL-DESC-LEN            
079500     ELSE                                                                 
079600         MOVE PV-LENGTH TO      DLT00000-DOOR-GP-TMPL-DESC-LEN            
079700     END-IF                                                               
079800                                                                          
079900     MOVE DP020-LOCATION-NBR          TO DLT00000-DC-NBR                  
080000     MOVE DP020-USERID                TO DLT00000-CRE-BY-USR-ID           
080100                                                                          
080200     PERFORM 7200-INSERT-TEMPLATE-HDR.                                    
080300                                                                          
080400     PERFORM 7205-SELECT-NEW-TMPL-ID.                                     
080500                                                                          
080600     PERFORM 4601-CREATE-GROUPS                                           
080700             VARYING PV-ITEM  FROM 1 BY 1                                 
080800             UNTIL PV-ITEM > ASC-HIGHEST-BLOCK-WRITTEN.                   
080900*            OR PS-ERROR                                                  
081000/                                                                         
081100 4600-EDIT-EACH-GROUP.                                                    
081200                                                                          
081300     MOVE +1                       TO ASC-BLK-SUB.                        
081400     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
081500     ADD +1                        TO ASC-BLK-SUB.                        
081600     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
081700                                                                          
081800     PERFORM 6112-READ-LIST-QUEUE.                                        
081900                                                                          
082000     SET  LQW-IDX  TO   1.                                                
082100                                                                          
082200     PERFORM 6112-READ-LIST-QUEUE.                                        
082300                                                                          
082400     IF PV-CICS-RESP = DFHRESP (NORMAL)                                   
082500         PERFORM                                                          
082600         VARYING LQW-IDX  FROM 1 BY 1                                     
082700         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL                             
082800            OR   LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO                    
082900            OR   PS-ERROR                                                 
083000                 SET LQW-BLOCK-MODIFIED                                   
083100                                      TO TRUE                             
083200                 SET LQW-ERROR-NO  (LQW-IDX)                              
083300                     LQW-NUMERIC-ERROR-NO  (LQW-IDX) TO TRUE              
083400                 MOVE LQW-GROUP-NBR (LQW-IDX)                             
083500                                      TO DP010I-UNEDITED-FIELD            
083600                 MOVE +4              TO DP010I-MAXIMUM-DIGITS            
083700                 MOVE ZERO            TO DP010I-MAXIMUM-DECIMALS          
083800                 SET DP010I-NEGATIVE-NOT-ALLOWED                          
083900                                      TO TRUE                             
084000                                                                          
263627                 CALL DP010I-NUMERIC-EDIT-ROUTINE                         
263627                      USING DP010I-NUMERIC-EDIT-AREA                      
084200                                                                          
084300                 IF NOT DP010I-ERROR-DETECTED                             
084400                     MOVE DP010I-NUMERIC-FIELD                            
084500                                      TO LQW-GROUP-NBR-N (LQW-IDX)        
084600                     IF LQW-GROUP-NBR-N (LQW-IDX) = ZERO                  
084700                         SET PS-ERROR                                     
084800                             DP020-MSG-FATAL                              
084900                             DP030-SET-CURSOR-APPL-1                      
085000                             DP030-OVERRIDE-GO       TO TRUE              
085100                         SET LQW-ERROR-YES (LQW-IDX) TO TRUE              
085200*                           'MUST KEY TEMPLATE DESCRIPTION AND            
085300*                                 ASSIGN ALL DOORS TO GROUP'              
085400                         MOVE PC-TSYMSG-03182 TO DP020-MSG-NUMBER         
085500                     END-IF                                               
085600                 ELSE                                                     
085700                     SET PS-ERROR                                         
085800                         DP020-MSG-FATAL                                  
085900                         DP030-SET-CURSOR-APPL-1                          
086000                         DP030-OVERRIDE-GO       TO TRUE                  
086100                     SET LQW-NUMERIC-ERROR-YES (LQW-IDX) TO TRUE          
086200*                           'GROUP NUMBERS MUST BE NUMERIC'               
086300                         MOVE PC-TSYMSG-03187 TO DP020-MSG-NUMBER         
086400                 END-IF                                                   
086500         END-PERFORM                                                      
086600     END-IF                                                               
086700                                                                          
086800     MOVE PV-ITEM      TO PV-SAVE-ITEM.                                   
086900     PERFORM 6111-WRITE-LIST-QUEUE.                                       
087000                                                                          
087100     MOVE +1                     TO  ASC-BLK-SUB.                         
087200     PERFORM 4410-READ-TEMP-STORAGE.                                      
087300                                                                          
087400     ADD +1                      TO  ASC-BLK-SUB                          
087500                                     PV-BLOCK-NUMBER.                     
087600                                                                          
087700     PERFORM 4410-READ-TEMP-STORAGE.                                      
087800                                                                          
087900 4600A-CHECK-DOOR-TOTALS.                                                 
088000                                                                          
088100     PERFORM 7010-COUNT-TEMPLATE-DOORS                                    
088200                                                                          
088300     IF PV-TEMPLATE-DOOR-COUNT = ASC-KEY-DOOR-COUNT                       
088400         CONTINUE                                                         
088500     ELSE                                                                 
088600         SET PS-ERROR                                                     
088700             DP020-MSG-FATAL                                              
088800             DP030-SET-CURSOR-APPL-1                                      
088900             DP030-OVERRIDE-GO       TO TRUE                              
089000*                'TEMPLATE MUST BE UPDATED - NOT ALL                      
089100*                      DOORS ARE GROUPED IN TEMPLATE'                     
089200             MOVE PC-TSYMSG-03181 TO DP020-MSG-NUMBER                     
089300     END-IF.                                                              
089400                                                                          
089500 4601-CREATE-GROUPS.                                                      
089600                                                                          
089700     MOVE +1                       TO ASC-BLK-SUB.                        
089800     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
089900     ADD +1                        TO ASC-BLK-SUB.                        
090000     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
090100                                                                          
090200     PERFORM 6112-READ-LIST-QUEUE.                                        
090300                                                                          
090400     SET  LQW-IDX  TO   1.                                                
090500                                                                          
090600     PERFORM 6112-READ-LIST-QUEUE.                                        
090700                                                                          
090800     IF PV-CICS-RESP = DFHRESP (NORMAL)                                   
090900         PERFORM                                                          
091000         VARYING LQW-IDX  FROM 1 BY 1                                     
091100         UNTIL   LQW-IDX > PC-ITEMS-PER-PANEL                             
091200            OR   LQW-LIST-ITEM-NUMBER (LQW-IDX) = ZERO                    
091300            OR   PS-ERROR                                                 
091400                                                                          
091500                 MOVE DLT00000-DOOR-GP-TMPL-ID                            
091600                                      TO DLT00001-DOOR-GP-TMPL-ID         
091700                                         ASC-DOOR-GP-TMPL-ID              
091800                 MOVE LQW-DOOR-ID  (LQW-IDX)                              
091900                                      TO DLT00001-DOOR-ID                 
092000                 MOVE LQW-GROUP-NBR-N (LQW-IDX)                           
092100                                      TO DLT00001-DOOR-GP-NBR             
092200                 PERFORM 7215-INSERT-DOOR-GRP                             
092300         END-PERFORM                                                      
092400     END-IF                                                               
092500                                                                          
092600     MOVE PV-ITEM      TO PV-SAVE-ITEM.                                   
092700     PERFORM 6111-WRITE-LIST-QUEUE.                                       
092800                                                                          
092900     MOVE +1                     TO  ASC-BLK-SUB.                         
093000     PERFORM 4410-READ-TEMP-STORAGE.                                      
093100                                                                          
093200     ADD +1                      TO  ASC-BLK-SUB                          
093300                                     PV-BLOCK-NUMBER.                     
093400                                                                          
093500     PERFORM 4410-READ-TEMP-STORAGE.                                      
093600                                                                          
093700*----------------------------------------------------------------*        
093800*                                                                         
093900*----------------------------------------------------------------*        
094000 4605-PROCESS-SELECTED-LINES.                                             
094100                                                                          
094200     PERFORM 4620-PROCESS-LINES.                                          
094300                                                                          
094400*    IF  PS-NO-ERROR                                                      
094500*        SET  LQW-DESELECT (LQW-IDX) TO TRUE                              
094600*        MOVE PC-UPD      TO LQW-ACTION (LQW-IDX)                         
094700*                                                                         
094800*        SUBTRACT  1                                                      
094900*            FROM  ASC-NUMBER-OF-SELECTED-ITEMS                           
095000*        MOVE LQW-SELECTED-SW (LQW-IDX)                                   
095100*                             TO LQW-TEMP-SELECTED-SW (LQW-IDX)           
095200*    END-IF.                                                              
095300                                                                          
095400 4620-PROCESS-LINES.                                                      
095500     CONTINUE.                                                            
095600*    IF  PS-NO-ERROR                                                      
095700*        IF  LQW-SELECT (LQW-IDX)                                         
095800*            MOVE LQW-TEMPLATE-NBR (LQW-IDX)                              
095900*                                     TO DLT00000-DOOR-GP-TMPL-ID         
096000*                PERFORM 7210-ACTIVATE-SELECTED-TEMPL                     
096100*        END-IF                                                           
096200*    END-IF.                                                              
096300                                                                          
096400*----------------------------------------------------------------*        
096500* CHECK TO SEE IF USER HAS RACF AUTHORIZATION                             
096600*----------------------------------------------------------------*        
096700 2105-RACF-ACCESS.                                                        
096800                                                                          
096900      SET DP008-RSRC-TYPE-FUNC           TO TRUE                          
097000      SET DP008-ACCESS-TYPE-USE          TO TRUE                          
097100                                                                          
097200      EXEC CICS                                                           
097300         LINK PROGRAM (DP008-SECURITY-SUBROUTINE)                         
097400              COMMAREA (DP008-SECURITY-COMMAREA)                          
097500              LENGTH (DP008-SECURITY-COMMAREA-LENGTH)                     
097600      END-EXEC                                                            
097700                                                                          
097800      IF DP008-CALL-SUCCESSFUL                                            
097900         IF DP008-ACCESS-ALLOWED                                          
098000             SET PS-ACCESS-ALLOWED TO TRUE                                
098100         ELSE                                                             
098200             SET PS-ACCESS-NOT-ALLOWED TO TRUE                            
098300         END-IF                                                           
098400     ELSE                                                                 
098500         MOVE '2105-RACF-ACCESS'                                          
098600                               TO DP013-PARAGRAPH                         
098700          MOVE 'UNABLE TO ACCESS CICS'                                    
098800                               TO DP013-MESSAGE-TEXT (1)                  
098900          MOVE SQLCA                 TO DP013-SQLCA                       
099000          SET DP013-DB2-ABEND                                             
099100              DP013-XCTL-DISPLAY-RESTART                                  
099200                               TO TRUE                                    
099300          PERFORM DP013-0000-PROCESS-ABEND                                
099400      END-IF.                                                             
099500                                                                          
099600*                                                                         
099700*----------------------------------------------------------------*        
099800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *        
099900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *        
100000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *        
100100*    MESSAGE.                                                    *        
100200*----------------------------------------------------------------*        
100300                                                                          
100400 2110-BROWSE-BACKWARD.                                                    
100500     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL            
100600         GIVING PV-TOP-ITEM.                                              
100700*                                                                         
100800     IF  ((PV-TOP-ITEM < +1)                                              
100900       OR (PV-TOP-ITEM = +1))                                             
101000         MOVE +1                   TO PV-TOP-ITEM                         
101100*        -- TOP OF LIST --                                                
101200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER                    
101300         SET DP020-MSG-INFORMATIONAL TO TRUE                              
101400     END-IF.                                                              
101500                                                                          
101600/                                                                         
101700*----------------------------------------------------------------*        
101800*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *        
101900*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *        
102000*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *        
102100*----------------------------------------------------------------*        
102200                                                                          
102300 2120-BROWSE-FORWARD.                                                     
102400                                                                          
102500     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL                      
102600         GIVING PV-TOP-ITEM.                                              
102700     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                           
102800         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
102900                                   TO PV-TOP-ITEM                         
103000*        -- BOTTOM OF LIST --                                             
103100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER                    
103200         SET DP020-MSG-INFORMATIONAL                                      
103300                                   TO TRUE                                
103400     ELSE                                                                 
103500         COMPUTE PV-BOTTOM-ITEM =                                         
103600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                         
103700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ                    
103800*            -- BOTTOM OF LIST --                                         
103900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER                    
104000             SET DP020-MSG-INFORMATIONAL                                  
104100                                   TO TRUE                                
104200         END-IF                                                           
104300     END-IF.                                                              
104400 EJECT                                                                    
104500*----------------------------------------------------------------*        
104600*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *        
104700*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *        
104800*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *        
104900*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *        
105000*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *        
105100*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *        
105200*----------------------------------------------------------------*        
105300                                                                          
105400 2130-CHECK-FOR-JUMP-BROWSE.                                              
105500     SET PS-NO-ERROR               TO TRUE.                               
105600     IF (ASC-START-ITEM-REQUEST = SPACE)                                  
105700         MOVE ASC-ITEM-AT-TOP-OF-PANEL                                    
105800                                   TO PV-TOP-ITEM                         
105900     ELSE                                                                 
106000         MOVE ASC-START-ITEM-REQUEST                                      
106100                                   TO DP010I-UNEDITED-FIELD               
106200         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS               
106300         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS             
106400         SET DP010I-NEGATIVE-NOT-ALLOWED                                  
106500                                   TO TRUE                                
263627         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
263627              USING DP010I-NUMERIC-EDIT-AREA                              
106700                                                                          
106800         IF  NOT DP010I-ERROR-DETECTED                                    
106900             MOVE DP010I-NUMERIC-FIELD                                    
107000                                   TO  ASC-START-ITEM-REQUEST-N           
107100             IF  ASC-START-ITEM-REQUEST-N > ZERO                          
107200                 IF  ASC-START-ITEM-REQUEST-N >                           
107300                                          ASC-NUMBER-OF-ITEMS-READ        
107400                     MOVE SPACE TO ASC-START-ITEM-REQUEST                 
107500                     COMPUTE PV-TOP-ITEM =                                
107600                             ASC-NUMBER-OF-ITEMS-READ                     
107700                             - PC-ITEMS-PER-PANEL + 1                     
107800                     IF  PV-TOP-ITEM < +1                                 
107900                         MOVE +1   TO PV-TOP-ITEM                         
108000                         MOVE PC-TSYMSG-00070                             
108100                                   TO DP020-MSG-NUMBER                    
108200                         SET DP020-MSG-INFORMATIONAL                      
108300                                   TO TRUE                                
108400                     END-IF                                               
108500                 ELSE                                                     
108600                     MOVE ASC-START-ITEM-REQUEST-N                        
108700                                   TO PV-TOP-ITEM                         
108800                     MOVE SPACE    TO ASC-START-ITEM-REQUEST              
108900                     COMPUTE PV-BOTTOM-ITEM =                             
109000                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             
109100                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        
109200*                        -- BOTTOM OF LIST --                             
109300                         MOVE PC-TSYMSG-00070                             
109400                                   TO DP020-MSG-NUMBER                    
109500                         SET DP020-MSG-INFORMATIONAL                      
109600                                   TO TRUE                                
109700                     END-IF                                               
109800                 END-IF                                                   
109900             ELSE                                                         
110000*                --- VALUE OUT OF RANGE ----                              
110100                 MOVE PC-TSYMSG-00101                                     
110200                                   TO DP020-MSG-NUMBER                    
110300                 MOVE -1           TO ASTRTITL                            
110400                 SET DP030-SET-CURSOR-APPL-1                              
110500                                   TO TRUE                                
110600                 MOVE DP015-REVERSE                                       
110700                                   TO ASTRTITH                            
110800                 MOVE DP015-RED    TO ASTRTITC                            
110900                 MOVE DP015-UNP-NUM-BRT-MDT                               
111000                                   TO ASTRTITA                            
111100                 SET DP020-MSG-FATAL                                      
111200                                   TO TRUE                                
111300                 SET PS-ERROR      TO TRUE                                
111400             END-IF                                                       
111500                                                                          
111600         ELSE                                                             
111700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER                    
111800             MOVE -1               TO ASTRTITL                            
111900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
112000             MOVE DP015-REVERSE    TO ASTRTITH                            
112100             MOVE DP015-RED        TO ASTRTITC                            
112200             MOVE DP015-UNP-NUM-BRT-MDT                                   
112300                                   TO ASTRTITA                            
112400             SET DP020-MSG-FATAL   TO TRUE                                
112500             SET PS-ERROR          TO TRUE                                
112600         END-IF                                                           
112700     END-IF.                                                              
112800 EJECT                                                                    
112900*----------------------------------------------------------------*        
113000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *        
113100*  FOR ALL ITEMS.                                                *        
113200*----------------------------------------------------------------*        
113300                                                                          
113400*2150-SELECT-ALL-ITEMS.                                                   
113500*                                                                         
113600*    MOVE +1                       TO ASC-BLK-SUB.                        
113700*                                                                         
113800*    PERFORM 2151-SET-SELECTED-INDS                                       
113900*        VARYING ASC-ITEM-SUB                                             
114000*        FROM 1 BY 1                                                      
114100*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
114200*                                                                         
114300*    ADD +1                        TO ASC-BLK-SUB.                        
114400*                                                                         
114500*    PERFORM 2151-SET-SELECTED-INDS                                       
114600*        VARYING ASC-ITEM-SUB                                             
114700*        FROM 1 BY 1                                                      
114800*        UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                         
114900*                                                                         
115000*    MOVE ASC-LIST-ITEM-NUMBER(1 1)                                       
115100*                                  TO PV-LIST-ITEM-NUMBER.                
115200*                                                                         
115300*    COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                                    
115400*        1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
115500*                                                                         
115600*    IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                             
115700*       (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)            
115800*        MOVE +1                   TO ASC-BLK-SUB                         
115900*                                                                         
116000*        PERFORM 5100-WRITE-TEMP-STORAGE                                  
116100*                                                                         
116200*        MOVE +1                   TO PV-BLOCK-NUMBER                     
116300*                                                                         
116400*        COMPUTE PV-PREV-BLOCK-IN-ARRAY =                                 
116500*            PV-FIRST-BLOCK-IN-ARRAY - 1                                  
116600*                                                                         
116700*        PERFORM                                                          
116800*            UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY               
116900*                                                                         
117000*            PERFORM 4410-READ-TEMP-STORAGE                               
117100*                                                                         
117200*            PERFORM 2151-SET-SELECTED-INDS                               
117300*                VARYING ASC-ITEM-SUB                                     
117400*                FROM 1 BY 1                                              
117500*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
117600*                                                                         
117700*            PERFORM 5100-WRITE-TEMP-STORAGE                              
117800*                                                                         
117900*            ADD +1                TO PV-BLOCK-NUMBER                     
118000*                                                                         
118100*        END-PERFORM                                                      
118200*                                                                         
118300*        COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                 
118400*            PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY             
118500*                                                                         
118600*        PERFORM                                                          
118700*            UNTIL PV-NEXT-BLOCK-IN-ARRAY >                               
118800*                  ASC-HIGHEST-BLOCK-WRITTEN                              
118900*                                                                         
119000*            MOVE PV-NEXT-BLOCK-IN-ARRAY                                  
119100*                                  TO PV-BLOCK-NUMBER                     
119200*                                                                         
119300*            PERFORM 4410-READ-TEMP-STORAGE                               
119400*                                                                         
119500*            PERFORM 2151-SET-SELECTED-INDS                               
119600*                VARYING ASC-ITEM-SUB                                     
119700*                FROM 1 BY 1                                              
119800*                UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                  
119900*                                                                         
120000*            PERFORM 5100-WRITE-TEMP-STORAGE                              
120100*                                                                         
120200*            ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY              
120300*                                                                         
120400*        END-PERFORM                                                      
120500*                                                                         
120600*        MOVE PV-FIRST-BLOCK-IN-ARRAY                                     
120700*                                  TO PV-BLOCK-NUMBER                     
120800*                                                                         
120900*        PERFORM 4410-READ-TEMP-STORAGE                                   
121000*    END-IF.                                                              
121100*                                                                         
121200*                                                                         
121300*    MOVE ASC-NUMBER-OF-ITEMS-READ TO                                     
121400*                      ASC-NUMBER-OF-SELECTED-ITEMS.                      
121500*                                                                         
121600*    PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                                
121700*                                                                         
121800 EJECT                                                                    
121900*----------------------------------------------------------------*        
122000*    MARK EACH ITEM AS BEING SELECTED.                           *        
122100*----------------------------------------------------------------*        
122200                                                                          
122300*2151-SET-SELECTED-INDS.                                                  
122400*                                                                         
122500*    IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)                   
122600*            NOT EQUAL ZERO                                               
122700*        IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
122800*            SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)                     
122900*                ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                          
123000*                              TO  TRUE                                   
123100*        END-IF                                                           
123200*    END-IF.                                                              
123300******************************************************************        
123400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **        
123500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **        
123600******************************************************************        
123700 2200-MOVE-SCREEN-TO-COMMAREA.                                            
123800                                                                          
123900     MOVE ADESCI                   TO ASC-KEY-TEMPLATE-DESC               
124000                                                                          
124100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.                     
124200     MOVE +1                       TO PV-SUB.                             
124300*                                                                         
124400     PERFORM 3100-SET-SUBSCRIPTS.                                         
124500     IF  ASTRTITL > ZERO                                                  
124600         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST                  
124700     ELSE                                                                 
124800         IF  ASTRTITF = DP015-ERASE-EOF                                   
124900             INITIALIZE ASC-START-ITEM-REQUEST                            
125000         END-IF                                                           
125100     END-IF.                                                              
125200     PERFORM 2210-MOVE-LINES-TO-COMMAREA                                  
125300         VARYING PV-SUB                                                   
125400         FROM 1 BY 1                                                      
125500         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                              
125600******************************************************************        
125700** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**        
125800******************************************************************        
125900 2210-MOVE-LINES-TO-COMMAREA.                                             
126000     IF  MR-GROUP-NBR-L (PV-SUB) > ZERO                                   
126100         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE                     
126200         MOVE MR-GROUP-NBR (PV-SUB)                                       
126300                                   TO ASC-GROUP-NBR-X                     
126400                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
126500     ELSE                                                                 
126600         IF  MR-GROUP-NBRA (PV-SUB) = DP015-ERASE-EOF                     
126700                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             
126800                 MOVE SPACE        TO ASC-GROUP-NBR-X                     
126900                                 (ASC-BLK-SUB, ASC-ITEM-SUB)              
127000         END-IF                                                           
127100     END-IF.                                                              
127200                                                                          
127300     ADD +1                        TO ASC-ITEM-SUB.                       
127400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
127500         ADD +1                    TO ASC-BLK-SUB                         
127600         MOVE +1                   TO ASC-ITEM-SUB                        
127700     END-IF.                                                              
127800******************************************************************        
127900** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **        
128000** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **        
128100******************************************************************        
128200 3000-EDIT-DATA-IN-COMMAREA.                                              
128300     SET PS-NO-ERROR               TO TRUE.                               
128400     PERFORM 3200-RESET-ATTRIBUTES.                                       
128500     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                             
128600**                                                                        
128700* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.                      
128800* EDITTING IS DONE FROM THE BOTTOM UP.                                    
128900**                                                                        
129000     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                               
129100         ASC-ITEMS-DISPLAYED - 1.                                         
129200     PERFORM 3100-SET-SUBSCRIPTS.                                         
129300*    PERFORM 3300-EDIT-SELECTIONS                                         
129400*        VARYING PV-SUB                                                   
129500*        FROM PV-SUB BY -1                                                
129600*        UNTIL PV-SUB < +1                                                
129700*                                                                         
129800     IF  PS-NO-ERROR                                                      
129900         PERFORM 3400-CHECK-RANGE-SEQUENCE                                
130000     END-IF.                                                              
130100*                                                                         
130200/                                                                         
130300*----------------------------------------------------------------*        
130400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *        
130500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*        
130600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *        
130700*                                                                *        
130800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *        
130900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *        
131000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *        
131100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *        
131200*----------------------------------------------------------------*        
131300                                                                          
131400 3100-SET-SUBSCRIPTS.                                                     
131500                                                                          
131600     COMPUTE ASC-ITEM-SUB =                                               
131700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.                
131800                                                                          
131900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                 
132000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
132100                                                                          
132200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB                       
132300     ELSE                                                                 
132400         MOVE +1                     TO ASC-BLK-SUB                       
132500     END-IF.                                                              
132600******************************************************************        
132700** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **        
132800******************************************************************        
132900                                                                          
133000 3200-RESET-ATTRIBUTES.                                                   
133100     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                           
133200     MOVE DP015-GREEN              TO ASTRTITC.                           
133300     MOVE DP015-UNDERLINE          TO ASTRTITH.                           
133400                                                                          
133500     PERFORM                                                              
133600         VARYING PV-SUB                                                   
133700         FROM 1 BY 1                                                      
133800         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                                
133900         MOVE DP015-UNP-ALP-NOR-OFF                                       
134000                                   TO MR-GROUP-NBRA (PV-SUB)              
134100         MOVE DP015-GREEN          TO MR-GROUP-NBRC (PV-SUB)              
134200         MOVE DP015-UNDERLINE      TO MR-GROUP-NBRH (PV-SUB)              
134300     END-PERFORM.                                                         
134400******************************************************************        
134500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **        
134600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **        
134700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **        
134800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **        
134900******************************************************************        
135000*3300-EDIT-SELECTIONS.                                                    
135100*    EVALUATE TRUE                                                        
135200*        WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
135300*            = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)                 
135400*                CONTINUE                                                 
135500*        WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)                 
135600*            IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                
135700*                ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS           
135800*                MOVE ASC-TEMP-SELECTED-SW                                
135900*                                     (ASC-BLK-SUB ASC-ITEM-SUB)          
136000*                               TO ASC-SELECTED-SW                        
136100*                                     (ASC-BLK-SUB ASC-ITEM-SUB)          
136200*            END-IF                                                       
136300*        WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)             
136400*                = SPACE                                                  
136500*            EVALUATE TRUE                                                
136600*                WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)               
136700*                    SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS        
136800*                    MOVE SPACE TO ASC-SELECTED-SW                        
136900*                                     (ASC-BLK-SUB ASC-ITEM-SUB)          
137000*                WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                
137100*                    MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE            
137200*                    MOVE SPACE TO ASC-SELECTED-SW                        
137300*                                     (ASC-BLK-SUB ASC-ITEM-SUB)          
137400*                WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)                  
137500*                    MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE              
137600*                    MOVE SPACE TO ASC-SELECTED-SW                        
137700*                                     (ASC-BLK-SUB ASC-ITEM-SUB)          
137800*            END-EVALUATE                                                 
137900*        WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                   
138000*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
138100*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
138200*            END-IF                                                       
138300*            PERFORM 3310-EDIT-RANGE                                      
138400*        WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)                     
138500*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
138600*                SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS            
138700*            END-IF                                                       
138800*            PERFORM 3310-EDIT-RANGE                                      
138900*        WHEN OTHER                                                       
139000*            MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER                   
139100*            SET DP020-MSG-FATAL    TO TRUE                               
139200*            SET DP030-SET-CURSOR-APPL-1                                  
139300*                                   TO TRUE                               
139400*            SET PS-ERROR TO TRUE                                         
139500*            IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)                    
139600*                SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS             
139700*                MOVE SPACE         TO ASC-SELECTED-SW                    
139800*                                       (ASC-BLK-SUB ASC-ITEM-SUB)        
139900*            END-IF                                                       
140000*    END-EVALUATE.                                                        
140100*                                                                         
140200*    SUBTRACT +1             FROM PV-ITEM-IN-USE.                         
140300*    SUBTRACT +1 FROM ASC-ITEM-SUB.                                       
140400*    IF  ASC-ITEM-SUB < 1                                                 
140500*        SUBTRACT +1 FROM ASC-BLK-SUB                                     
140600*        MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                        
140700*    END-IF.                                                              
140800*                                                                         
140900******************************************************************        
141000** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **        
141100** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **        
141200******************************************************************        
141300 3400-CHECK-RANGE-SEQUENCE.                                               
141400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
141500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                              
141600       AND  ASC-START-OF-SELECTED-RANGE >                                 
141700                                         ASC-END-OF-SELECTED-RANGE        
141800*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                        
141900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                         
142000         SET DP020-MSG-FATAL TO TRUE                                      
142100         SET PS-ERROR TO TRUE                                             
142200         PERFORM 3410-POSITION-AT-ERROR                                   
142300     END-IF.                                                              
142400******************************************************************        
142500** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **        
142600** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **        
142700** SHOULD BE POSITIONED ON A RANGE ERROR.                       **        
142800******************************************************************        
142900 3410-POSITION-AT-ERROR.                                                  
143000     SET DP030-SET-CURSOR-APPL-1                                          
143100                                   TO TRUE.                               
143200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
143300                    - PV-TOP-ITEM + 1.                                    
143400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
143500         CONTINUE                                                         
143600     ELSE                                                                 
143700         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
143800         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
143900         MOVE DP015-RED            TO MR-GROUP-NBRC (PV-SUB)              
144000     END-IF.                                                              
144100*                                                                         
144200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
144300                    - PV-TOP-ITEM + 1.                                    
144400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
144500         CONTINUE                                                         
144600     ELSE                                                                 
144700         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
144800         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
144900         MOVE DP015-RED            TO MR-GROUP-NBRC (PV-SUB)              
145000     END-IF.                                                              
145100/                                                                         
145200*----------------------------------------------------------------*        
145300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *        
145400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *        
145500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *        
145600*    DISPLAY THE PANEL TO USER.                                  *        
145700*----------------------------------------------------------------*        
145800                                                                          
145900 4000-BUILD-INITIAL-PANEL.                                                
146000                                                                          
146100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)                    
146200                                 ASC-BLOCK-ENTRIES (2).                   
146300     MOVE +1                 TO ASC-BLK-SUB.                              
146400     SET ASC-ITEMS-LEFT-ON-DB                                             
146500                             TO TRUE.                                     
146600                                                                          
146700     MOVE +0                 TO ASC-ITEM-SUB                              
146800                                ASC-NUMBER-OF-ITEMS-READ                  
146900                                ASC-NUMBER-OF-SELECTED-ITEMS              
147000                                ASC-HIGHEST-BLOCK-WRITTEN                 
147100                                ASC-START-OF-SELECTED-RANGE               
147200                                ASC-END-OF-SELECTED-RANGE                 
147300                                ASC-ITEM-AT-TOP-OF-PANEL.                 
147400     PERFORM 4100-PREPARE-CURSOR                                          
147500                                                                          
147600     PERFORM 4010-OPEN-CURSOR.                                            
147700                                                                          
147800     PERFORM 4300-READ-ITEMS-FROM-DB.                                     
147900                                                                          
148000     PERFORM 4020-CLOSE-CURSOR.                                           
148100                                                                          
148200     MOVE +1                   TO  PV-TOP-ITEM.                           
148300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                                  
148400         MOVE -1               TO MR-GROUP-NBR-L (1)                      
148500         MOVE ASC-KEY-OPER-UNT-ID         TO ADCO                         
148600         MOVE ASC-KEY-OPER-DESC           TO ADCNMEO                      
148700         PERFORM VARYING PV-SUB                                           
148800                 FROM PC-ITEMS-PER-PANEL BY -1                            
148900                 UNTIL PV-SUB < +1                                        
149000             MOVE DP015-ASK-DRK-OFF  TO MR-GROUP-NBRA (PV-SUB)            
149100                                        MR-DOOR-NBRA (PV-SUB)             
149200         END-PERFORM                                                      
149300         SET DP020-MSG-FATAL                                              
149400             DP030-SET-CURSOR-APPL-1                                      
149500             DP030-OVERRIDE-APPL-ERROR TO TRUE                            
149600         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                       
149700     ELSE                                                                 
149800         MOVE -1               TO MR-GROUP-NBR-L (1)                      
149900         SET DP030-SET-CURSOR-APPL-1                                      
150000                               TO TRUE                                    
150100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                             
150200     END-IF.                                                              
150300/                                                                         
150400 4010-OPEN-CURSOR.                                                        
150500                                                                          
150600     MOVE ASC-KEY-OPER-UNT-ID         TO DK-DC-NBR                        
150700     PERFORM 7100-OPEN-DOOR-CSR.                                          
150800/                                                                         
150900                                                                          
151000 4020-CLOSE-CURSOR.                                                       
151100     PERFORM 7120-CLOSE-DOOR-CSR.                                         
151200/                                                                         
151300*----------------------------------------------------------------*        
151400*    SET UP THE HOST VARIABLES.                                  *        
151500*----------------------------------------------------------------*        
151600                                                                          
151700 4100-PREPARE-CURSOR.                                                     
151800     CONTINUE.                                                            
151900                                                                          
152000                                                                          
152100/                                                                         
152200*----------------------------------------------------------------*        
152300*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *        
152400*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *        
152500*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *        
152600*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *        
152700*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *        
152800*                                                                *        
152900*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *        
153000*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *        
153100*    UPON INITIALIZATION.                                        *        
153200*----------------------------------------------------------------*        
153300                                                                          
153400 4300-READ-ITEMS-FROM-DB.                                                 
153500                                                                          
153600     PERFORM                                                              
153700         VARYING PV-READ-COUNT                                            
153800         FROM 1 BY 1                                                      
153900         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                            
154000            OR (ASC-NO-ITEMS-LEFT-ON-DB))                                 
154100                                                                          
154200         PERFORM 4310-FETCH                                               
154300                                                                          
154400         IF  ASC-ITEMS-LEFT-ON-DB                                         
154500             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                        
154600                 ADD +1            TO ASC-ITEM-SUB                        
154700             ELSE                                                         
154800                 ADD +1            TO ASC-BLK-SUB                         
154900                 MOVE +1           TO ASC-ITEM-SUB                        
155000                                                                          
155100                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY                 
155200                     MOVE +1       TO ASC-BLK-SUB                         
155300                     SET ASC-BLOCK-MODIFIED (1)                           
155400                                   TO TRUE                                
155500                     PERFORM 5100-WRITE-TEMP-STORAGE                      
155600                     MOVE ASC-BLOCK-ENTRIES                               
155700                               (PC-MAX-BLOCKS-IN-ARRAY)                   
155800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)         
155900                     ADD +1        TO ASC-BLK-SUB                         
156000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)           
156100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)              
156200                                   TO TRUE                                
156300                 END-IF                                                   
156400             END-IF                                                       
156500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ            
156600             MOVE ASC-NUMBER-OF-ITEMS-READ                                
156700                                   TO ASC-LIST-ITEM-NUMBER                
156800                                      (ASC-BLK-SUB ASC-ITEM-SUB)          
156900*            LOAD CURSOR FIELDS TO ASC                                    
157000             MOVE CNDCDR-DOOR-ID      TO ASC-DOOR-ID                      
157100                                       (ASC-BLK-SUB ASC-ITEM-SUB)         
157200         END-IF                                                           
157300     END-PERFORM.                                                         
157400                                                                          
157500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                                  
157600         MOVE +1               TO ASC-BLK-SUB                             
157700         PERFORM 5100-WRITE-TEMP-STORAGE                                  
157800         ADD +1                TO ASC-BLK-SUB                             
157900         PERFORM 5100-WRITE-TEMP-STORAGE                                  
158000                                                                          
158100         MOVE 1                TO ASC-BLK-SUB                             
158200                                  PV-BLOCK-NUMBER                         
158300         PERFORM 4410-READ-TEMP-STORAGE                                   
158400         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1                     
158500             MOVE 2            TO ASC-BLK-SUB                             
158600                                  PV-BLOCK-NUMBER                         
158700             PERFORM 4410-READ-TEMP-STORAGE                               
158800         END-IF                                                           
158900     END-IF.                                                              
159000/                                                                         
159100 4310-FETCH.                                                              
159200                                                                          
159300     PERFORM 7110-FETCH-DOOR-CSR.                                         
159400/                                                                         
159500*----------------------------------------------------------------*        
159600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *        
159700*----------------------------------------------------------------*        
159800                                                                          
159900 4400-MOVE-COMMAREA-TO-SCREEN.                                            
160000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))                     
160100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))                  
160200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))                  
160300             MOVE +1    TO ASC-BLK-SUB                                    
160400             PERFORM 5100-WRITE-TEMP-STORAGE                              
160500             ADD +1     TO ASC-BLK-SUB                                    
160600             PERFORM 5100-WRITE-TEMP-STORAGE                              
160700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     
160800                 GIVING PV-BLOCK-NUMBER                                   
160900                 REMAINDER PV-REMAINDER                                   
161000             IF  PV-REMAINDER > ZERO                                      
161100                 ADD +1 TO PV-BLOCK-NUMBER                                
161200             END-IF                                                       
161300             MOVE +1    TO ASC-BLK-SUB                                    
161400             PERFORM 4410-READ-TEMP-STORAGE                               
161500             ADD +1     TO ASC-BLK-SUB                                    
161600                           PV-BLOCK-NUMBER                                
161700             PERFORM 4410-READ-TEMP-STORAGE                               
161800     END-IF.                                                              
161900     MOVE +1            TO ASC-BLK-SUB.                                   
162000     COMPUTE ASC-ITEM-SUB =                                               
162100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))                      
162200         + PC-ITEMS-PER-PANEL).                                           
162300*                                                                         
162400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                                
162500         ADD +1         TO ASC-BLK-SUB                                    
162600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB                    
162700     END-IF.                                                              
162800*                                                                         
162900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                                   
163000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                        
163100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                                
163200     PERFORM 4420-FORMAT-LIST-LINES                                       
163300         VARYING PV-SUB                                                   
163400         FROM PC-ITEMS-PER-PANEL BY -1                                    
163500         UNTIL PV-SUB < +1.                                               
163600*                                                                         
163700     PERFORM VARYING PV-SUB                                               
163800         FROM PC-ITEMS-PER-PANEL BY -1                                    
163900              UNTIL PV-SUB < +1                                           
164000             EVALUATE TRUE                                                
164100             WHEN MR-GROUP-NBR-N(PV-SUB) = SPACE                          
164200                 CONTINUE                                                 
164300             WHEN ASC-PROTECT-YES                                         
164400             WHEN ASC-DISABLE-F5-YES                                      
164500                 MOVE DP015-ASK-NOR-OFF                                   
164600                                      TO MR-GROUP-NBRA (PV-SUB)           
164700                 MOVE DP015-BLUE      TO MR-GROUP-NBRC (PV-SUB)           
164800                 MOVE DP015-UNDERLINE TO MR-GROUP-NBRH (PV-SUB)           
164900             WHEN OTHER                                                   
165000                 MOVE DP015-UNP-ALP-NOR-OFF                               
165100                                      TO MR-GROUP-NBRA (PV-SUB)           
165200                 MOVE DP015-GREEN     TO MR-GROUP-NBRC (PV-SUB)           
165300                 MOVE DP015-UNDERLINE TO MR-GROUP-NBRH (PV-SUB)           
165400             END-EVALUATE                                                 
165500                                                                          
165600     END-PERFORM                                                          
165700                                                                          
165800     COMPUTE ASC-ITEMS-DISPLAYED =                                        
165900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).                  
166000     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL            
166100                                      ASTRTITO.                           
166200     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                            
166300     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                            
166400*    MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
166500*                                  TO ASELITO.                            
166600                                                                          
166700*    HEADINGS                                                             
166800                                                                          
166900     MOVE ASC-KEY-OPER-UNT-ID         TO ADCO                             
167000     MOVE ASC-KEY-OPER-DESC           TO ADCNMEO.                         
167100     MOVE ASC-KEY-DOOR-COUNT          TO ATDOORO.                         
167200                                                                          
167300*                                                                         
167400     IF  DP020-MSG-NUMBER-X = SPACE                                       
167500         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ          
167600*            --- MORE ITEMS TO DISPLAY ----                               
167700             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER                    
167800             SET DP020-MSG-INFORMATIONAL TO TRUE                          
167900         END-IF                                                           
168000     END-IF.                                                              
168100*----------------------------------------------------------------*        
168200*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *        
168300*----------------------------------------------------------------*        
168400                                                                          
168500 4410-READ-TEMP-STORAGE.                                                  
168600                                                                          
168700     EXEC CICS                                                            
168800         READQ TS                                                         
168900             QUEUE (ASC-LIST-QUEUE-NAME)                                  
169000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
169100             ITEM  (PV-BLOCK-NUMBER)                                      
169200             RESP  (PV-CICS-RESP)                                         
169300     END-EXEC.                                                            
169400                                                                          
169500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                               
169600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                             
169700         CONTINUE                                                         
169800     ELSE                                                                 
169900         SET DP013-CICS-ABEND     TO TRUE                                 
170000         SET DP013-NO-ROLLBACK    TO TRUE                                 
170100         MOVE '4410-READ-TEMP-STORAGE'                                    
170200                                  TO DP013-PARAGRAPH                      
170300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'              
170400                                  TO DP013-MESSAGE-TEXT(1)                
170500         PERFORM DP013-0000-PROCESS-ABEND                                 
170600     END-IF.                                                              
170700                                                                          
170800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
170900*                                                                         
171000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                                 
171100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)                       
171200     END-IF.                                                              
171300 EJECT                                                                    
171400*----------------------------------------------------------------*        
171500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *        
171600*----------------------------------------------------------------*        
171700                                                                          
171800 4420-FORMAT-LIST-LINES.                                                  
171900     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ              
172000         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                        
172100         MOVE DP015-ASK-DRK-OFF  TO MR-GROUP-NBRA (PV-SUB)                
172200                                    MR-DOOR-NBRA (PV-SUB)                 
172300         MOVE DP015-HL-OFF       TO MR-GROUP-NBRH (PV-SUB)                
172400                                    MR-DOOR-NBRH (PV-SUB)                 
172500         MOVE SPACE              TO MR-GROUP-NBR (PV-SUB)                 
172600                                    MR-DOOR-NBR (PV-SUB)                  
172700     ELSE                                                                 
172800                                                                          
172900*        IF  DP030-SET-CURSOR-TRAILER                                     
173000*               SET DP030-SET-CURSOR-APPL-1 TO TRUE                       
173100*               MOVE -1          TO MR-GROUP-NBR-L (PV-SUB)               
173200*        END-IF                                                           
173300                                                                          
173400         PERFORM 2001-NUM-EDIT                                            
173500                                                                          
173600                                                                          
173700         EVALUATE TRUE                                                    
173800         WHEN ASC-ERROR-YES (ASC-BLK-SUB ASC-ITEM-SUB)                    
173900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
174000             MOVE -1                  TO MR-GROUP-NBR-L (PV-SUB)          
174100             MOVE DP015-RED           TO MR-GROUP-NBRC (PV-SUB)           
174200             MOVE ASC-GROUP-NBR   (ASC-BLK-SUB ASC-ITEM-SUB)              
174300                                      TO MR-GROUP-NBR-N (PV-SUB)          
174400                                                                          
174500         WHEN ASC-NUMERIC-ERROR-YES (ASC-BLK-SUB ASC-ITEM-SUB)            
174600         WHEN DP010I-ERROR-DETECTED                                       
174700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
174800             MOVE -1                  TO MR-GROUP-NBR-L (PV-SUB)          
174900             MOVE DP015-RED           TO MR-GROUP-NBRC (PV-SUB)           
175000             MOVE ASC-GROUP-NBR-X (ASC-BLK-SUB ASC-ITEM-SUB)              
175100                                      TO MR-GROUP-NBR (PV-SUB)            
175200         WHEN PS-NO-ERROR                                                 
175300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                          
175400             MOVE -1                  TO MR-GROUP-NBR-L (1)               
175500         END-EVALUATE                                                     
175600*                                                                         
175700         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL                   
175800             MOVE ASC-DOOR-ID (ASC-BLK-SUB ASC-ITEM-SUB)                  
175900                                      TO MR-DOOR-NBR (PV-SUB)             
176000             IF ASC-GROUP-NBR (ASC-BLK-SUB ASC-ITEM-SUB)                  
176100                     NUMERIC                                              
176200                 MOVE ASC-GROUP-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            
176300                                      TO MR-GROUP-NBR-N (PV-SUB)          
176400             ELSE                                                         
176500                 MOVE ASC-GROUP-NBR-X (ASC-BLK-SUB ASC-ITEM-SUB)          
176600                                      TO MR-GROUP-NBR (PV-SUB)            
176700             END-IF                                                       
176800             MOVE DP015-ASK-NOR-OFF   TO MR-DOOR-NBRA (PV-SUB)            
176900             MOVE DP015-BLUE          TO MR-DOOR-NBRC (PV-SUB)            
177000                                                                          
177100         END-IF                                                           
177200     END-IF.                                                              
177300                                                                          
177400     SUBTRACT +1 FROM ASC-ITEM-SUB                                        
177500     IF  ASC-ITEM-SUB < + 1                                               
177600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                          
177700         MOVE +1                 TO ASC-BLK-SUB                           
177800     END-IF.                                                              
177900******************************************************************        
178000** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **        
178100** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **        
178200** ISSUE A WARNING.                                             **        
178300******************************************************************        
178400 4430-CHECK-FOR-BEGIN-AND-END.                                            
178500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                               
178600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                             
178700*            -- NO END-OF-RANGE SPECFIED ---                              
178800             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER                    
178900             SET DP020-MSG-WARNING TO TRUE                                
179000             PERFORM 4431-POSITION-AT-WARNING                             
179100         END-IF                                                           
179200     ELSE                                                                 
179300         IF  ASC-END-OF-SELECTED-RANGE > ZERO                             
179400*            -- NO BEGINNING-OF-RANGE SPECFIED ---                        
179500             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER                    
179600             SET DP020-MSG-WARNING TO TRUE                                
179700             PERFORM 4431-POSITION-AT-WARNING                             
179800         END-IF                                                           
179900     END-IF.                                                              
180000******************************************************************        
180100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **        
180200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **        
180300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **        
180400** POSITION THE CURSOR THERE.                                   **        
180500******************************************************************        
180600 4431-POSITION-AT-WARNING.                                                
180700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                         
180800                    - PV-TOP-ITEM + 1.                                    
180900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
181000         CONTINUE                                                         
181100     ELSE                                                                 
181200         SET DP030-SET-CURSOR-APPL-1                                      
181300                                   TO TRUE                                
181400         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
181500         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
181600         MOVE DP015-YELLOW         TO MR-GROUP-NBRC (PV-SUB)              
181700     END-IF.                                                              
181800*                                                                         
181900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                           
182000                    - PV-TOP-ITEM + 1.                                    
182100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                              
182200         CONTINUE                                                         
182300     ELSE                                                                 
182400         SET DP030-SET-CURSOR-APPL-1                                      
182500                                   TO TRUE                                
182600         MOVE -1                   TO MR-GROUP-NBR-L (PV-SUB)             
182700         MOVE DP015-REVERSE        TO MR-GROUP-NBRH (PV-SUB)              
182800         MOVE DP015-YELLOW         TO MR-GROUP-NBRC (PV-SUB)              
182900     END-IF.                                                              
183000 EJECT                                                                    
183100*----------------------------------------------------------------*        
183200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *        
183300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *        
183400* FOR THE SELECTED ITEMS QUEUE.                                  *        
183500*                                                                *        
183600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *        
183700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *        
183800* THE ARRAY IS FULL.                                             *        
183900*----------------------------------------------------------------*        
184000                                                                          
184100 5000-PREPARE-SEL-QUEUE.                                                  
184200                                                                          
184300     MOVE +1                   TO  ASC-BLK-SUB.                           
184400     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
184500     ADD +1                    TO  ASC-BLK-SUB.                           
184600     PERFORM 5100-WRITE-TEMP-STORAGE.                                     
184700                                                                          
184800     MOVE ASC-SEL-QUEUE-NAME   TO  DL002-SEL-QUEUE-NAME.                  
184900     PERFORM 6010-DELETE-SEL-QUEUE.                                       
185000                                                                          
185100     SET ASC-UPDATE-TSQ        TO  TRUE.                                  
185200                                                                          
185300     SET DP057-IDX             TO  1.                                     
185400     MOVE ZERO                 TO DL002-NUMBER-OF-TS-ITEMS.               
185500     INITIALIZE DP057-SELECTED-ITEM-ARRAY.                                
185600                                                                          
185700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                                   
185800             VARYING PV-ITEM                                              
185900             FROM 1 BY 1                                                  
186000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.             
186100                                                                          
186200     IF  DP057-IDX > 1                                                    
186300         PERFORM 5205-WRITE-SEL-QUEUE                                     
186400         ADD +1                TO DL002-NUMBER-OF-TS-ITEMS                
186500     END-IF.                                                              
186600 EJECT                                                                    
186700*----------------------------------------------------------------*        
186800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *        
186900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *        
187000*----------------------------------------------------------------*        
187100                                                                          
187200 5100-WRITE-TEMP-STORAGE.                                                 
187300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                             
187400                                   TO PV-LIST-ITEM-NUMBER.                
187500     COMPUTE PV-BLOCK-NUMBER =                                            
187600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).            
187700                                                                          
187800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)                     
187900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)                     
188000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                              
188100             PERFORM 5105-REWRITE-ASC-LISTQ                               
188200         END-IF                                                           
188300     ELSE                                                                 
188400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                               
188500         ASC-HIGHEST-BLOCK-WRITTEN + 1                                    
188600         PERFORM 5110-WRITE-ASC-LISTQ                                     
188700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN           
188800     END-IF.                                                              
188900                                                                          
189000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.                     
189100******************************************************************        
189200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **        
189300** SPECIFIC COMMAREA.                                           **        
189400******************************************************************        
189500 5105-REWRITE-ASC-LISTQ.                                                  
189600     EXEC CICS                                                            
189700         WRITEQ TS                                                        
189800             QUEUE (ASC-LIST-QUEUE-NAME)                                  
189900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
190000             ITEM  (PV-BLOCK-NUMBER)                                      
190100             REWRITE                                                      
190200             RESP  (PV-CICS-RESP)                                         
190300     END-EXEC.                                                            
190400                                                                          
190500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                                   
190600         CONTINUE                                                         
190700     ELSE                                                                 
190800         SET DP013-CICS-ABEND            TO TRUE                          
190900         SET DP013-NO-ROLLBACK           TO TRUE                          
191000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH               
191100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'             
191200                                         TO DP013-MESSAGE-TEXT(1)         
191300         PERFORM DP013-0000-PROCESS-ABEND                                 
191400     END-IF.                                                              
191500                                                                          
191600******************************************************************        
191700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **        
191800** SPECIFIC COMMAREA.                                           **        
191900******************************************************************        
192000 5110-WRITE-ASC-LISTQ.                                                    
192100     EXEC CICS                                                            
192200         WRITEQ TS                                                        
192300             QUEUE (ASC-LIST-QUEUE-NAME)                                  
192400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))                       
192500             ITEM  (PV-BLOCK-NUMBER)                                      
192600             RESP  (PV-CICS-RESP)                                         
192700     END-EXEC.                                                            
192800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                              
192900         SET DP013-CICS-ABEND      TO TRUE                                
193000         SET DP013-NO-ROLLBACK     TO TRUE                                
193100         MOVE '5110-WRITE-ASC-LISTQ'                                      
193200                                   TO DP013-PARAGRAPH                     
193300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'                   
193400                                   TO DP013-MESSAGE-TEXT(1)               
193500         PERFORM DP013-0000-PROCESS-ABEND                                 
193600     END-IF.                                                              
193700 EJECT                                                                    
193800*----------------------------------------------------------------*        
193900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *        
194000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *        
194100*----------------------------------------------------------------*        
194200                                                                          
194300 5200-FILL-SEL-QUEUE-RECORD.                                              
194400                                                                          
194500     PERFORM 6112-READ-LIST-QUEUE.                                        
194600                                                                          
194700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                               
194800         PERFORM                                                          
194900         VARYING LQW-IDX                                                  
195000         FROM 1 BY 1                                                      
195100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL                    
195200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO                  
195300                                                                          
195400*            IF  LQW-SELECT (LQW-IDX)                                     
195500*                MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)                      
195600*                                  TO DP057-ITEM (DP057-IDX)              
195700*                MOVE LQW-MESSAGE-NUMBER (LQW-IDX)                        
195800*                                  TO DP057-MESSAGE-NUMBER                
195900*                                       (DP057-IDX)                       
196000*                MOVE SPACE        TO DP057-ACTION-SW (DP057-IDX)         
196100*                SET DP057-IDX UP BY 1                                    
196200*                IF  DP057-IDX > DP057-MAX-ITEMS                          
196300*                    PERFORM 5205-WRITE-SEL-QUEUE                         
196400*                    ADD +1        TO DL002-NUMBER-OF-TS-ITEMS            
196500*                    INITIALIZE DP057-SELECTED-ITEM-ARRAY                 
196600*                    SET DP057-IDX TO  1                                  
196700*                END-IF                                                   
196800*            END-IF                                                       
196900         END-PERFORM                                                      
197000     END-IF.                                                              
197100                                                                          
197200*----------------------------------------------------------------*        
197300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *        
197400*----------------------------------------------------------------*        
197500                                                                          
197600 5205-WRITE-SEL-QUEUE.                                                    
197700                                                                          
197800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                    
197900                                   TO DP057-SELECTED-ITEMS.               
198000                                                                          
198100     EXEC CICS                                                            
198200          WRITEQ TS                                                       
198300              QUEUE (ASC-SEL-QUEUE-NAME)                                  
198400              FROM  (DP057-MESSAGE-SEL-REC)                               
198500              ITEM  (PV-SEL-QUEUE-ITEM)                                   
198600              RESP  (PV-CICS-RESP)                                        
198700     END-EXEC.                                                            
198800                                                                          
198900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
199000         CONTINUE                                                         
199100     ELSE                                                                 
199200         SET DP013-CICS-ABEND      TO TRUE                                
199300         SET DP013-NO-ROLLBACK     TO TRUE                                
199400         MOVE '5205-WRITE-SEL-QUEUE'                                      
199500                                   TO DP013-PARAGRAPH                     
199600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'                  
199700                                   TO DP013-MESSAGE-TEXT(1)               
199800         PERFORM DP013-0000-PROCESS-ABEND                                 
199900     END-IF.                                                              
200000 EJECT                                                                    
200100******************************************************************        
200200** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **        
200300** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **        
200400** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **        
200500** THE USER.                                                    **        
200600******************************************************************        
200700 6000-REFRESH-PANEL-FROM-TEMP.                                            
200800     IF  ASC-UPDATE-TSQ                                                   
200900         SET ASC-NO-TSQ-UPDATE TO TRUE                                    
201000         MOVE ZERO                 TO PV-SAVE-ITEM                        
201100                                      PV-SEL-QUEUE-ITEM                   
201200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                                
201300                                   TO PV-HOLD-SELECTED-ITEMS              
201400         MOVE +1                   TO PV-ITEMS-PROCESSED                  
201500         PERFORM 6100-UPDATE-TSQ                                          
201600             UNTIL PV-ITEMS-PROCESSED >                                   
201700                                     PV-HOLD-SELECTED-ITEMS               
201800         PERFORM 6010-DELETE-SEL-QUEUE                                    
201900         INITIALIZE ASC-BLOCK-ENTRIES (1)                                 
202000                    ASC-BLOCK-ENTRIES (2)                                 
202100     END-IF.                                                              
202200                                                                          
202300*----------------------------------------------------------------*        
202400*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *        
202500*----------------------------------------------------------------*        
202600 6010-DELETE-SEL-QUEUE.                                                   
202700                                                                          
202800     EXEC CICS                                                            
202900         DELETEQ TS                                                       
203000             QUEUE (ASC-SEL-QUEUE-NAME)                                   
203100             RESP  (PV-CICS-RESP)                                         
203200     END-EXEC.                                                            
203300*                                                                         
203400     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                              
203500        (PV-CICS-RESP = DFHRESP(QIDERR)))                                 
203600         CONTINUE                                                         
203700     ELSE                                                                 
203800         SET DP013-CICS-ABEND TO TRUE                                     
203900         SET DP013-NO-ROLLBACK TO TRUE                                    
204000         MOVE '6010-DELETE-SEL-QUEUE'                                     
204100                        TO DP013-PARAGRAPH                                
204200         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'                 
204300                        TO DP013-MESSAGE-TEXT (1)                         
204400         PERFORM DP013-0000-PROCESS-ABEND                                 
204500     END-IF.                                                              
204600                                                                          
204700*----------------------------------------------------------------*        
204800*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *        
204900*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *        
205000*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *        
205100*    THE TEMP QUEUE.                                             *        
205200*----------------------------------------------------------------*        
205300                                                                          
205400 6100-UPDATE-TSQ.                                                         
205500                                                                          
205600     ADD 1                     TO  PV-SEL-QUEUE-ITEM.                     
205700     PERFORM 6105-READ-SEL-QUEUE.                                         
205800     PERFORM                                                              
205900         VARYING DP057-IDX                                                
206000         FROM 1 BY 1                                                      
206100         UNTIL ((PV-ITEMS-PROCESSED >                                     
206200                              PV-HOLD-SELECTED-ITEMS)                     
206300         OR (DP057-IDX GREATER THAN DP057-MAX-ITEMS))                     
206400         IF  DP057-ACTION-SW (DP057-IDX) > SPACE                          
206500             PERFORM 6110-PROCESS-ITEMS                                   
206600         END-IF                                                           
206700         ADD +1                TO PV-ITEMS-PROCESSED                      
206800     END-PERFORM.                                                         
206900     PERFORM 6111-WRITE-LIST-QUEUE.                                       
207000*----------------------------------------------------------------*        
207100*    READ THE LIST QUEUE RECORD.                                 *        
207200*----------------------------------------------------------------*        
207300                                                                          
207400 6105-READ-SEL-QUEUE.                                                     
207500                                                                          
207600     EXEC CICS                                                            
207700          READQ TS                                                        
207800              QUEUE (ASC-SEL-QUEUE-NAME)                                  
207900              INTO  (DP057-MESSAGE-SEL-REC)                               
208000              ITEM  (PV-SEL-QUEUE-ITEM)                                   
208100              RESP  (PV-CICS-RESP)                                        
208200     END-EXEC.                                                            
208300*                                                                         
208400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
208500         CONTINUE                                                         
208600     ELSE                                                                 
208700         SET DP013-CICS-ABEND      TO  TRUE                               
208800         SET DP013-NO-ROLLBACK     TO  TRUE                               
208900         MOVE '6105-READ-SEL-QUEUE'                                       
209000                                   TO  DP013-PARAGRAPH                    
209100         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'                   
209200                                   TO  DP013-MESSAGE-TEXT(1)              
209300         PERFORM DP013-0000-PROCESS-ABEND                                 
209400     END-IF.                                                              
209500 EJECT                                                                    
209600                                                                          
209700 6110-PROCESS-ITEMS.                                                      
209800                                                                          
209900     COMPUTE PV-ITEM = 1 + ((DP057-ITEM (DP057-IDX) - 1)                  
210000                     / PC-ITEMS-PER-PANEL).                               
210100                                                                          
210200     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                                   
210300         IF  PV-SAVE-ITEM NOT EQUAL ZERO                                  
210400             PERFORM 6111-WRITE-LIST-QUEUE                                
210500         END-IF                                                           
210600         MOVE PV-ITEM          TO PV-SAVE-ITEM                            
210700                                                                          
210800         PERFORM 6112-READ-LIST-QUEUE                                     
210900         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                       
211000             CONTINUE                                                     
211100         END-IF                                                           
211200     END-IF.                                                              
211300                                                                          
211400     COMPUTE PV-SUB = (DP057-ITEM (DP057-IDX)                             
211500                    - LQW-LIST-ITEM-NUMBER (1)) + 1.                      
211600*    SET LQW-DESELECT (PV-SUB) TO    TRUE                                 
211700*    MOVE LQW-SELECTED-SW (PV-SUB)                                        
211800*                              TO LQW-TEMP-SELECTED-SW (PV-SUB).          
211900*    EVALUATE TRUE                                                        
212000*        WHEN DP057-INQ (DP057-IDX)                                       
212100*             MOVE PC-INQ      TO LQW-ACTION (PV-SUB)                     
212200*                                                                         
212300*        WHEN DP057-UPD (DP057-IDX)                                       
212400*             MOVE PC-UPD      TO LQW-ACTION (PV-SUB)                     
212500*                                                                         
212600*        WHEN DP057-DEL (DP057-IDX)                                       
212700*             MOVE PC-DEL      TO LQW-ACTION (PV-SUB)                     
212800*                                                                         
212900*        WHEN DP057-ERR (DP057-IDX)                                       
213000*             MOVE PC-ERR      TO LQW-ACTION (PV-SUB)                     
213100*    END-EVALUATE.                                                        
213200                                                                          
213300     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                        
213400                                                                          
213500*----------------------------------------------------------------*        
213600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *        
213700*----------------------------------------------------------------*        
213800                                                                          
213900 6111-WRITE-LIST-QUEUE.                                                   
214000                                                                          
214100     EXEC CICS                                                            
214200         WRITEQ TS                                                        
214300             QUEUE (ASC-LIST-QUEUE-NAME)                                  
214400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                             
214500             ITEM  (PV-SAVE-ITEM)                                         
214600             REWRITE                                                      
214700             RESP  (PV-CICS-RESP)                                         
214800     END-EXEC.                                                            
214900*                                                                         
215000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
215100         CONTINUE                                                         
215200     ELSE                                                                 
215300         SET DP013-CICS-ABEND  TO  TRUE                                   
215400         SET DP013-NO-ROLLBACK TO  TRUE                                   
215500         MOVE '6111-WRITE-LIST-QUEUE'                                     
215600                               TO  DP013-PARAGRAPH                        
215700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                          
215800                               TO  DP013-MESSAGE-TEXT(1)                  
215900         PERFORM DP013-0000-PROCESS-ABEND                                 
216000     END-IF.                                                              
216100                                                                          
216200 EJECT                                                                    
216300*----------------------------------------------------------------*        
216400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*        
216500*----------------------------------------------------------------*        
216600                                                                          
216700 6112-READ-LIST-QUEUE.                                                    
216800                                                                          
216900     EXEC CICS                                                            
217000         READQ TS                                                         
217100             QUEUE (ASC-LIST-QUEUE-NAME)                                  
217200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                             
217300             ITEM  (PV-ITEM)                                              
217400             RESP  (PV-CICS-RESP)                                         
217500     END-EXEC.                                                            
217600*                                                                         
217700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                                  
217800         CONTINUE                                                         
217900     ELSE                                                                 
218000         SET DP013-CICS-ABEND        TO TRUE                              
218100         SET DP013-NO-ROLLBACK       TO TRUE                              
218200         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH                   
218300         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                            
218400                                     TO DP013-MESSAGE-TEXT(1)             
218500         PERFORM DP013-0000-PROCESS-ABEND                                 
218600     END-IF.                                                              
218700/                                                                         
218800 7000-LOCATION-DESC.                                                      
218900     MOVE DP020-LOCATION-NBR          TO XLT00010-LOC-NBR                 
219000                                                                          
219100     EXEC SQL                                                             
219200         SELECT  LOC_NM                                                   
219300           INTO  :XLT00010-LOC-NM                                         
219400           FROM  XLT_LOC                                                  
219500         WHERE LOC_NBR        = :XLT00010-LOC-NBR                         
219600     END-EXEC                                                             
219700                                                                          
219800     EVALUATE TRUE                                                        
219900         WHEN SQLCODE = ZERO                                              
220000             MOVE XLT00010-LOC-NM     TO ASC-KEY-OPER-DESC                
220100         WHEN SQLCODE = +100                                              
220200             MOVE ALL '?'             TO ASC-KEY-OPER-DESC                
220300         WHEN SQLCODE = -904                                              
220400         WHEN SQLCODE = -911                                              
220500         WHEN SQLCODE = -913                                              
220600             MOVE SQLCODE                   TO PV-SOFT-SQLCODE            
220700             MOVE '7000-LOCATION-DESC'      TO PV-SOFT-PARAGRAPH          
220800             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2          
220900             MOVE LENGTH OF PV-CICS-MSG-AREA2                             
221000               TO PV-COMMAREA-LENGTH                                      
221100             EXEC CICS                                                    
221200                  WRITEQ TD                                               
221300                   QUEUE  ('CSSL')                                        
221400                    FROM  (PV-CICS-MSG-AREA2)                             
221500                  LENGTH  (PV-COMMAREA-LENGTH)                            
221600                    RESP  (PV-CICS-RESP)                                  
221700             END-EXEC                                                     
221800             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER                  
221900             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE                      
222000             PERFORM 9900-SOFT-ABORT                                      
222100         WHEN OTHER                                                       
222200              MOVE '7000-LOCATION-DESC'                                   
222300                               TO DP013-PARAGRAPH                         
222400              MOVE 'GET LOCATION DESCRIPTION'                             
222500                               TO DP013-MESSAGE-TEXT (1)                  
222600              MOVE SQLCA       TO DP013-SQLCA                             
222700              MOVE 'XLT_LOC '  TO DP013-DB2-TABLE-NAME (1)                
222800              SET DP013-DB2-ABEND                                         
222900                  DP013-XCTL-DISPLAY-RESTART                              
223000                                   TO TRUE                                
223100                  PERFORM DP013-0000-PROCESS-ABEND                        
223200     END-EVALUATE.                                                        
223300                                                                          
223400 7010-COUNT-TEMPLATE-DOORS.                                               
223500                                                                          
223600     MOVE ZERO                        TO PV-TEMPLATE-DOOR-COUNT           
223700     EXEC SQL                                                             
223800         SELECT  COUNT(*)                                                 
223900           INTO  :PV-TEMPLATE-DOOR-COUNT                                  
224000           FROM  DLT_DOOR_GP                                              
224100         WHERE DOOR_GP_TMPL_ID = :DLT00001-DOOR-GP-TMPL-ID                
224200     END-EXEC                                                             
224300                                                                          
224400     EVALUATE TRUE                                                        
224500         WHEN SQLCODE = ZERO                                              
224600         WHEN SQLCODE = +100                                              
224700             CONTINUE                                                     
224800         WHEN SQLCODE = -904                                              
224900         WHEN SQLCODE = -911                                              
225000         WHEN SQLCODE = -913                                              
225100             MOVE SQLCODE             TO PV-SOFT-SQLCODE                  
225200             MOVE '7010-COUNT-TEMPLATE-DOORS'                             
225300                                      TO PV-SOFT-PARAGRAPH                
225400             MOVE PV-SOFT-ABORT-MSG   TO PV-CICS-MSG-AREA2                
225500             MOVE LENGTH OF PV-CICS-MSG-AREA2                             
225600               TO PV-COMMAREA-LENGTH                                      
225700             EXEC CICS                                                    
225800                  WRITEQ TD                                               
225900                   QUEUE  ('CSSL')                                        
226000                    FROM  (PV-CICS-MSG-AREA2)                             
226100                  LENGTH  (PV-COMMAREA-LENGTH)                            
226200                    RESP  (PV-CICS-RESP)                                  
226300             END-EXEC                                                     
226400             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER                  
226500             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE                      
226600             PERFORM 9900-SOFT-ABORT                                      
226700         WHEN OTHER                                                       
226800              MOVE '7010-COUNT-TEMPLATE-DOORS'                            
226900                                      TO DP013-PARAGRAPH                  
227000              MOVE 'COUNT GROUPS WITHIN TEMPLATE'                         
227100                                      TO DP013-MESSAGE-TEXT (1)           
227200              MOVE SQLCA              TO DP013-SQLCA                      
227300              MOVE 'DLT_DOOR_GP'      TO DP013-DB2-TABLE-NAME (1)         
227400              SET DP013-DB2-ABEND                                         
227500                  DP013-XCTL-DISPLAY-RESTART                              
227600                                   TO TRUE                                
227700                  PERFORM DP013-0000-PROCESS-ABEND                        
227800     END-EVALUATE.                                                        
227900/                                                                         
228000 7100-OPEN-DOOR-CSR.                                                      
228100                                                                          
228200     EXEC SQL                                                             
228300         OPEN DOOR-CSR                                                    
228400     END-EXEC                                                             
228500                                                                          
228600     EVALUATE TRUE                                                        
228700         WHEN SQLCODE = ZERO                                              
228800             CONTINUE                                                     
228900         WHEN SQLCODE = -904                                              
229000         WHEN SQLCODE = -911                                              
229100         WHEN SQLCODE = -913                                              
229200             MOVE '7100-OPEN-DOOR-CSR'                                    
229300                                      TO DP013-PARAGRAPH                  
229400             MOVE 'DB2 TIMEOUT ATTEMPTING TO OPEN CSR'                    
229500                                      TO DP013-MESSAGE-TEXT (1)           
229600             MOVE SQLCA               TO DP013-SQLCA                      
229700             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
229800             SET DP013-DB2-ABEND                                          
229900                 DP013-XCTL-DISPLAY-RESTART                               
230000                                      TO TRUE                             
230100             PERFORM DP013-0000-PROCESS-ABEND                             
230200         WHEN SQLWARN0 NOT = SPACES                                       
230300         WHEN SQLCODE < ZERO                                              
230400         WHEN SQLCODE > ZERO                                              
230500             MOVE '7100-OPEN-DOOR-CSR'                                    
230600                                      TO DP013-PARAGRAPH                  
230700             MOVE 'OPEN DOOR CURSOR - '                                   
230800                                      TO DP013-MESSAGE-TEXT (1)           
230900             MOVE SQLCA               TO DP013-SQLCA                      
231000             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
231100             SET DP013-DB2-ABEND                                          
231200                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
231300             PERFORM DP013-0000-PROCESS-ABEND                             
231400     END-EVALUATE.                                                        
231500*                                                                         
231600 7110-FETCH-DOOR-CSR.                                                     
231700                                                                          
231800     EXEC SQL                                                             
231900         FETCH DOOR-CSR                                                   
232000         INTO                                                             
232100             :CNDCDR-DOOR-ID                                              
232200     END-EXEC                                                             
232300                                                                          
232400     EVALUATE TRUE                                                        
232500         WHEN SQLCODE = ZERO                                              
232600             CONTINUE                                                     
232700         WHEN SQLCODE = +100                                              
232800              SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                         
232900                                                                          
233000         WHEN SQLCODE = -904                                              
233100         WHEN SQLCODE = -911                                              
233200         WHEN SQLCODE = -913                                              
233300             MOVE '7110-FETCH-DOOR-CSR'                                   
233400                                      TO DP013-PARAGRAPH                  
233500             MOVE 'DB2 TIMEOUT ATTEMPTING TO FETCH CSR'                   
233600                                      TO DP013-MESSAGE-TEXT (1)           
233700             MOVE SQLCA               TO DP013-SQLCA                      
233800             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
233900             SET DP013-DB2-ABEND                                          
234000                 DP013-XCTL-DISPLAY-RESTART                               
234100                                      TO TRUE                             
234200             PERFORM DP013-0000-PROCESS-ABEND                             
234300         WHEN SQLWARN0 NOT = SPACE                                        
234400         WHEN SQLCODE NOT = ZERO                                          
234500              MOVE '7110-FETCH-DOOR-CSR'                                  
234600                               TO DP013-PARAGRAPH                         
234700              MOVE 'FETCH TEMPLATE CURSOR'                                
234800                               TO DP013-MESSAGE-TEXT (1)                  
234900              MOVE SQLCA       TO DP013-SQLCA                             
235000              SET DP013-DB2-ABEND                                         
235100                               TO TRUE                                    
235200              PERFORM DP013-0000-PROCESS-ABEND                            
235300     END-EVALUATE.                                                        
235400                                                                          
235500 7120-CLOSE-DOOR-CSR.                                                     
235600                                                                          
235700     EXEC SQL                                                             
235800         CLOSE DOOR-CSR                                                   
235900     END-EXEC                                                             
236000                                                                          
236100     EVALUATE TRUE                                                        
236200         WHEN SQLCODE = ZERO                                              
236300             CONTINUE                                                     
236400         WHEN SQLWARN0 NOT = SPACES                                       
236500         WHEN SQLCODE < ZERO                                              
236600         WHEN SQLCODE > ZERO                                              
236700             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
236800             MOVE '7120-CLOSE-DOOR-CSR'                                   
236900                                      TO DP013-PARAGRAPH                  
237000             MOVE 'CLOSE TEMPLATE CURSOR '                                
237100                                      TO DP013-MESSAGE-TEXT (1)           
237200             MOVE SQLCA               TO DP013-SQLCA                      
237300             SET DP013-DB2-ABEND                                          
237400                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
237500             PERFORM DP013-0000-PROCESS-ABEND                             
237600     END-EVALUATE.                                                        
237700/                                                                         
237800 7200-INSERT-TEMPLATE-HDR.                                                
237900     EXEC SQL                                                             
238000         INSERT INTO DLT_DOOR_GP_TMPL                                     
238100           (                                                              
238200             DOOR_GP_TMPL_DESC                                            
238300            ,DC_NBR                                                       
238400            ,CRE_BY_USR_ID                                                
238500            ,CRE_TMST                                                     
238600           )                                                              
238700         VALUES                                                           
238800         (                                                                
238900             :DLT00000-DOOR-GP-TMPL-DESC                                  
239000           , :DLT00000-DC-NBR                                             
239100           , :DLT00000-CRE-BY-USR-ID                                      
239200           , CURRENT TIMESTAMP                                            
239300           )                                                              
239400     END-EXEC                                                             
239500                                                                          
239600     EVALUATE TRUE                                                        
239700         WHEN SQLCODE = ZERO                                              
239800             CONTINUE                                                     
239900         WHEN SQLCODE = -904                                              
240000         WHEN SQLCODE = -911                                              
240100         WHEN SQLCODE = -913                                              
240200             MOVE '7200-INSERT-TEMPLATE-HDR'                              
240300                                      TO DP013-PARAGRAPH                  
240400             MOVE 'DB2 TIMEOUT ATTEMPTING TO INSERT TEMPLATE'             
240500                                      TO DP013-MESSAGE-TEXT (1)           
240600             MOVE SQLCA               TO DP013-SQLCA                      
240700             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
240800             SET DP013-DB2-ABEND                                          
240900                 DP013-XCTL-DISPLAY-RESTART                               
241000                                      TO TRUE                             
241100             PERFORM DP013-0000-PROCESS-ABEND                             
241200         WHEN SQLWARN0 NOT = SPACES                                       
241300         WHEN SQLCODE < ZERO                                              
241400         WHEN SQLCODE > ZERO                                              
241500             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
241600             MOVE '7200-INSERT-TEMPLATE-HDR'                              
241700                                      TO DP013-PARAGRAPH                  
241800             MOVE 'INSERT NEW TEMPLATE'                                   
241900                                      TO DP013-MESSAGE-TEXT (1)           
242000             MOVE SQLCA               TO DP013-SQLCA                      
242100             SET DP013-DB2-ABEND                                          
242200                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
242300             PERFORM DP013-0000-PROCESS-ABEND                             
242400     END-EVALUATE.                                                        
242500/                                                                         
242600 7205-SELECT-NEW-TMPL-ID.                                                 
242700                                                                          
242800     EXEC SQL                                                             
242900         SET :DLT00000-DOOR-GP-TMPL-ID = IDENTITY_VAL_LOCAL ()            
243000     END-EXEC                                                             
243100                                                                          
243200     EVALUATE TRUE                                                        
243300         WHEN SQLCODE = ZERO                                              
243400         WHEN SQLCODE = +100                                              
243500             CONTINUE                                                     
243600         WHEN SQLCODE = -904                                              
243700         WHEN SQLCODE = -911                                              
243800         WHEN SQLCODE = -913                                              
243900             MOVE SQLCODE             TO PV-SOFT-SQLCODE                  
244000             MOVE '7205-SELECT-NEW-TMPL-ID'                               
244100                                      TO PV-SOFT-PARAGRAPH                
244200             MOVE PV-SOFT-ABORT-MSG   TO PV-CICS-MSG-AREA2                
244300             MOVE LENGTH OF PV-CICS-MSG-AREA2                             
244400               TO PV-COMMAREA-LENGTH                                      
244500             EXEC CICS                                                    
244600                  WRITEQ TD                                               
244700                   QUEUE  ('CSSL')                                        
244800                    FROM  (PV-CICS-MSG-AREA2)                             
244900                  LENGTH  (PV-COMMAREA-LENGTH)                            
245000                    RESP  (PV-CICS-RESP)                                  
245100             END-EXEC                                                     
245200             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER                  
245300             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE                      
245400             PERFORM 9900-SOFT-ABORT                                      
245500         WHEN OTHER                                                       
245600              MOVE '7010-COUNT-TEMPLATE-DOORS'                            
245700                                      TO DP013-PARAGRAPH                  
245800              MOVE 'SELECT NEWEST TEMPLATE JUST CREATED'                  
245900                                      TO DP013-MESSAGE-TEXT (1)           
246000              MOVE SQLCA              TO DP013-SQLCA                      
246100              MOVE 'DLT_DOOR_GP_TMPL' TO DP013-DB2-TABLE-NAME (1)         
246200              SET DP013-DB2-ABEND                                         
246300                  DP013-XCTL-DISPLAY-RESTART                              
246400                                   TO TRUE                                
246500                  PERFORM DP013-0000-PROCESS-ABEND                        
246600     END-EVALUATE.                                                        
246700/                                                                         
246800 7215-INSERT-DOOR-GRP.                                                    
246900                                                                          
247000     EXEC SQL                                                             
247100         INSERT INTO DLT_DOOR_GP                                          
247200           (                                                              
247300             DOOR_GP_TMPL_ID                                              
247400            ,DOOR_ID                                                      
247500            ,DOOR_GP_NBR                                                  
247600           )                                                              
247700         VALUES                                                           
247800         (                                                                
247900             :DLT00001-DOOR-GP-TMPL-ID                                    
248000           , :DLT00001-DOOR-ID                                            
248100           , :DLT00001-DOOR-GP-NBR                                        
248200           )                                                              
248300     END-EXEC                                                             
248400                                                                          
248500*            DOOR_GP_TMPL_ID                                              
248600*            DLT00000-ACTV-IND                                            
248700*            DLT00000-LAST-GP-MNT-TMST                                    
248800*            DLT00000-LAST-GP-MNT-USR-ID                                  
248900*            DLT00000-LAST-ACTV-USR-ID                                    
249000*            DLT00000-LAST-ACTV-TMST                                      
249100*          ,ACTV_IND                                                      
249200*          ,LAST_GP_MNT_TMST   TIMESTAMP                                  
249300*          ,LAST_GP_MNT_USR_ID CHAR(0008)                                 
249400*          ,LAST_ACTV_USR_ID   CHAR(0008)                                 
249500*          ,LAST_ACTV_TMST     TIMESTAMP                                  
249600                                                                          
249700     EVALUATE TRUE                                                        
249800         WHEN SQLCODE = ZERO                                              
249900             CONTINUE                                                     
250000         WHEN SQLCODE = -904                                              
250100         WHEN SQLCODE = -911                                              
250200         WHEN SQLCODE = -913                                              
250300             MOVE '7200-INSERT-TEMPLATE-HDR'                              
250400                                      TO DP013-PARAGRAPH                  
250500             MOVE 'DB2 TIMEOUT ATTEMPTING TO INSERT TEMPLATE'             
250600                                      TO DP013-MESSAGE-TEXT (1)           
250700             MOVE SQLCA               TO DP013-SQLCA                      
250800             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
250900             SET DP013-DB2-ABEND                                          
251000                 DP013-XCTL-DISPLAY-RESTART                               
251100                                      TO TRUE                             
251200             PERFORM DP013-0000-PROCESS-ABEND                             
251300         WHEN SQLWARN0 NOT = SPACES                                       
251400         WHEN SQLCODE < ZERO                                              
251500         WHEN SQLCODE > ZERO                                              
251600             MOVE 'DLT_DOOR_GP_TMPL'  TO DP013-DB2-TABLE-NAME (1)         
251700             MOVE '7200-INSERT-TEMPLATE-HDR'                              
251800                                      TO DP013-PARAGRAPH                  
251900             MOVE 'INSERT NEW TEMPLATE'                                   
252000                                      TO DP013-MESSAGE-TEXT (1)           
252100             MOVE SQLCA               TO DP013-SQLCA                      
252200             SET DP013-DB2-ABEND                                          
252300                 DP013-XCTL-DISPLAY-RESTART TO TRUE                       
252400             PERFORM DP013-0000-PROCESS-ABEND                             
252500     END-EVALUATE.                                                        
252600/                                                                         
252700 9900-SOFT-ABORT.                                                         
252800                                                                          
252900     EXEC CICS SYNCPOINT                                                  
253000          ROLLBACK                                                        
253100     END-EXEC.                                                            
253200                                                                          
253300     SET  PS-ERROR                                                        
253400          PS-SOFT-ABORT-ERROR                                             
253500          DP020-MSG-FATAL       TO  TRUE.                                 
253600/                                                                         
253700*----------------------------------------------------------------*        
253800*    ABEND PROCESSOR MODULE                                      *        
253900*----------------------------------------------------------------*        
254000                                                                          
254100     COPY DPPD013.                                                        
