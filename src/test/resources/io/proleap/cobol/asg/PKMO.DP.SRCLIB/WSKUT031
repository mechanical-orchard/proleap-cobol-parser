000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    WSKUT031.                                         00040000
000500 AUTHOR.        RON KRIER.                                        00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   MAY 2007.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM WAS CREATED FROM A COPY OF CEKUT009 TO PROCESS  * 00100000
001010*  INVENTORY ADJUSTMENT INFORMATION FROM THE WMOS APPLICATION   * 00101000
001100*  IN PREPARATION FOR REPORT WFKRP004.                          * 00110000
001200*  INPUT FILE (WSRD022) WILL BE READ IN BY THE PROGRAM AND      * 00120000
001300*  EVERY RECORD READ WILL BE WRITTEN TO THE OUTPUT FILE         * 00130000
001400*  WSRD043).                                                    * 00140000
001900***************************************************************** 00190000
002600***************************************************************** 00260000
002700 ENVIRONMENT DIVISION.                                            00270000
002800***************************************************************** 00280000
002900 INPUT-OUTPUT SECTION.                                            00290000
003000                                                                  00300000
003100 FILE-CONTROL.                                                    00310000
003200                                                                  00320000
003300     SELECT INVNTRY-ADJST-FILE                                    00330000
003400         ASSIGN TO IN01.                                          00340000
003500                                                                  00350000
003600     SELECT INVNTRY-PROCESS-FILE                                  00360000
003700         ASSIGN TO OUT01.                                         00370000
004100******************************************************************00410000
004200 DATA DIVISION.                                                   00420000
004300******************************************************************00430000
004400                                                                  00440000
004500 FILE SECTION.                                                    00450000
004600                                                                  00460000
004700 FD  INVNTRY-ADJST-FILE                                           00470000
004800     RECORDING MODE IS F                                          00480000
004900     LABEL RECORDS ARE STANDARD                                   00490000
005000     BLOCK CONTAINS 0 RECORDS.                                    00500000
005100                                                                  00510000
005200 01  INVNTRY-ADJST-RECORD       PIC  X(85).                       00520000
005300                                                                  00530000
005400 FD  INVNTRY-PROCESS-FILE                                         00540000
005500     RECORDING MODE IS F                                          00550000
005600     LABEL RECORDS ARE STANDARD                                   00560000
005700     BLOCK CONTAINS 0 RECORDS.                                    00570000
005800                                                                  00580000
005900 01  INVNTRY-PROCESS-RECORD     PIC  X(150).                      00590000
006000*                                                                 00600000
006800***************************************************************** 00680000
006900 WORKING-STORAGE SECTION.                                         00690000
007000                                                                  00700000
007100 01  PS-PROGRAM-SWITCHES.                                         00710000
007200     05  PS-END-OF-INPUT-SW           PIC X(01)  VALUE 'N'.       00720000
007300         88  PS-END-OF-INPUT                     VALUE 'Y'.       00730000
007400         88  PS-NOT-END-OF-INPUT                 VALUE 'N'.       00740000
007500     05  PS-SKU-FOUND-SW              PIC X(01)  VALUE 'N'.       00750000
007600         88  PS-SKU-FOUND                        VALUE 'Y'.       00760000
007700         88  PS-SKU-NOT-FOUND                    VALUE 'N'.       00770000
007800     05  PS-UPC-PRICE-SW              PIC X(01)  VALUE 'N'.       00780000
007900         88  PS-UPC-PRICE                        VALUE 'Y'.       00790000
008000         88  PS-NO-UPC-PRICE                     VALUE 'N'.       00800000
008100     05  PS-SKU-SW                    PIC X(01)  VALUE 'N'.       00810000
008200         88  PS-SAME-SKU                         VALUE 'Y'.       00820000
008300         88  PS-DIFF-SKU                         VALUE 'N'.       00830000
008400     05  PS-VALID-TYPE-CDE-SW         PIC X(01)  VALUE 'N'.       00840000
008500         88  PS-VALID-TYPE-CDE                   VALUE 'Y'.       00850000
008600         88  PS-INVALID-TYPE-CDE                 VALUE 'N'.       00860000
009000     05  PS-ECOMMERCE-SW              PIC X(01)  VALUE 'N'.       00900000
009100         88  PS-ECOMMERCE                        VALUE 'Y'.       00910000
009200         88  PS-NOT-ECOMMERCE                    VALUE 'N'.       00920000
009300*                                                                 00930000
009400 01  DK-DB2-KEY-FIELDS.                                           00940000
009500     05  DK-STORE-NBR                 PIC S9(04)  COMP.           00950000
009600     05  DK-TSK-KEY.                                              00960000
009700         10  DK-SKU                   PIC 9(08).                  00970000
009800         10  FILLER                   PIC X(08).                  00980000
009900     05  DK-TUPCPLS-KEY.                                          00990000
010000         10  DK-UPC-ITM-NBR           PIC S9(15)V COMP-3.         01000000
010100         10  DK-UPC-STORE             PIC S9(04)  COMP.           01010000
010200     05  DK-TRECITM-KEY.                                          01020000
010300         10  DK-ORD-NBR               PIC  S9(9) COMP.            01030000
010400         10  DK-ORD-LNE-NBR           PIC  S9(9) COMP.            01040000
010500         10  DK-REC-SEQ-NBR           PIC  S9(9) COMP.            01050000
010600*                                                                 01060000
010700 01  PV-PROGRAM-VARIABLES.                                        01070000
010800     05  PV-SQLCODE                   PIC 9(9)  VALUE ZERO.       01080000
010900     05  PV-RECORDS-READ              PIC S9(8) VALUE ZERO.       01090000
011100     05  PV-RECORDS-WRITTEN           PIC S9(8) VALUE ZERO.       01110000
011500     05  PV-DISPLAY-AMT               PIC ZZZ,ZZZ.99-.            01150000
011600     05  PV-DISPLAY-ITEM              PIC 999999999999999.        01160000
011700     05  PV-DISPLAY-RECORD            PIC ZZ,ZZZ,ZZ9-.            01170000
011800                                                                  01180000
011900     05  PV-SAVE-SKU                  PIC 9(08).                  01190000
012000     05  PV-UNT-RTL-AMT               PIC S9(7)V9(2) COMP-3.      01200000
012100                                                                  01210000
012200     05  PV-CURR-DATE.                                            01220000
012300         10 PV-CURRENT-DB2-CCYY.                                  01230000
012400            15 PV-CURRENT-DB2-CC      PIC  9(02) VALUE 0.         01240000
012500            15 PV-CURRENT-DB2-YY      PIC  9(02) VALUE 0.         01250000
012600         10 FILLER                    PIC  X(01) VALUE '-'.       01260000
012700         10 PV-CURRENT-DB2-MM         PIC  9(02) VALUE 0.         01270000
012800         10 FILLER                    PIC  X(01) VALUE '-'.       01280000
012900         10 PV-CURRENT-DB2-DD         PIC  9(02) VALUE 0.         01290000
013000*                                                                 01300000
013100      05 PV-EXTRACT-DATE              PIC  X(26) VALUE SPACE.     01310000
013200      05 FILLER  REDEFINES PV-EXTRACT-DATE.                       01320000
013300         10 PV-EXTRACT-DATE-YYYY      PIC  9999.                  01330000
013400         10 PV-EXTRACT-DATE-1ST       PIC  X.                     01340000
013500         10 PV-EXTRACT-DATE-MM        PIC  99.                    01350000
013600         10 PV-EXTRACT-DATE-2ND       PIC  X.                     01360000
013700         10 PV-EXTRACT-DATE-DD        PIC  99.                    01370000
013800         10 PV-EXTRACT-TIMESTAMP      PIC  X(16).                 01380000
013900                                                                  01390000
014000     05  PV-CURRENT-DB2-DATE          PIC  X(10).                 01400000
014100*                                                                 01410000
014200     05  PV-BATCH-NUMBER.                                         01420000
014300         10 PV-BTCH-NUMBER-CONST      PIC  X(02) VALUE '07'.      01430000
014400         10 PV-BTCH-DATE              PIC  X(02) VALUE SPACE.     01440000
014500*                                                                 01450000
014600     05  PV-HOLD-NUMBER.                                          01460007
014700         10  PV-HN-POS-1            PIC  X(01).                   01470007
014800         10  PV-HN-POS-2            PIC  X(01).                   01480007
014900         10  PV-HN-POS-3            PIC  X(01).                   01490007
015000         10  PV-HN-POS-4            PIC  X(01).                   01500007
015010         10  PV-HN-POS-5            PIC  X(01).                   01501007
015020         10  PV-HN-POS-6            PIC  X(01).                   01502007
015030         10  PV-HN-POS-7            PIC  X(01).                   01503007
015040         10  PV-HN-POS-8            PIC  X(01).                   01504007
015050         10  PV-HN-POS-9            PIC  X(01).                   01505007
015060         10  PV-HN-POS-10           PIC  X(01).                   01506007
015070                                                                  01507007
015110*                                                                 01511007
015120     05  PV-OH-QTY-X.                                             01512007
015130         10  PV-OH-QTY-X1           PIC  X(01).                   01513007
015140         10  PV-OH-QTY-X3           PIC  X(07).                   01514007
015150         10  PV-OH-QTY-X4           PIC  X(05).                   01515007
015160     05  PV-OH-QTY                  PIC S9(07).                   01516007
015200*                                                                 01520000
015300     05  PV-WS022-HOLD-LOC            PIC  9(04) VALUE 0.         01530000
015400     05  PV-WS022-HOLD-ITEM           PIC  X(16) VALUE SPACES.    01540000
015500     05  PV-WS022-UNIT-QTY-ADJ        PIC  X(14) VALUE SPACES.    01550000
015600     05 FILLER  REDEFINES PV-WS022-UNIT-QTY-ADJ.                  01560000
015700        10 PV-WS022-UNIT-QTY-HLD-1    PIC  9(01).                 01570000
015800        10 PV-WS022-UNIT-QTY-HLD-2    PIC  9(01).                 01580000
015900        10 PV-WS022-UNIT-QTY-HLD-3    PIC  9(07).                 01590000
016000        10 PV-WS022-UNIT-QTY-HLD-4    PIC  9(05).                 01600000
016100     05 PV-WS022-UNIT-QTY.                                        01610000
016200        10 PV-WS022-UNIT-QTY-SIGN     PIC  9(01).                 01620000
016300        10 PV-WS022-UNIT-QTY-BASE     PIC  9(07).                 01630000
016400*                                                                 01640000
016500 01 PC-PROGRAM-CONSTANTS.                                         01650000
016600     05 PC-PROGRAM-NAME               PIC X(08) VALUE 'WSKUT031'. 01660000
016700                                                                  01670000
016800*                                                                 01680000
016900 01  PV-ABEND-FIELDS.                                             01690000
017000     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01700000
017100                                                 COMP SYNC.       01710000
017200     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'WSKUT031'.01720000
017300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01730000
017400     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    01740000
017500     05  PV-ABEND-STRUCTURE-1         PIC  X(08) VALUE SPACES.    01750000
017600     05  PV-ABEND-STRUCTURE-2         PIC  X(08) VALUE SPACES.    01760000
017700     05  PV-ABEND-STRUCTURE-3         PIC  X(08) VALUE SPACES.    01770000
017800     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    01780000
017900     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    01790000
018000     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    01800000
018100     05  PV-DB2-OPERATION-MESSAGE-4   PIC  X(79) VALUE SPACES.    01810000
018200     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    01820000
018300*                                                                 01830000
018400******************************************************************01840000
018500*  USED FOR DB2 ERROR MESSAGE BUILDING                            01850000
018600******************************************************************01860000
018700     COPY DPWS004.                                                01870000
018800                                                                  01880000
018900******************************************************************01890000
019000*   DB2 SQL COMMUNICATION AREA                                    01900000
019100******************************************************************01910000
019200     EXEC SQL                                                     01920000
019300          INCLUDE SQLCA                                           01930000
019400     END-EXEC.                                                    01940000
019500                                                                  01950000
019600******************************************************************01960000
019700*   DB2 DCLGEN FOR XLT_LOCATION TABLE                             01970000
019800******************************************************************01980000
019900     EXEC SQL                                                     01990000
020000         INCLUDE XLT00010                                         02000000
020100     END-EXEC.                                                    02010000
020200                                                                  02020000
021000******************************************************************02100000
021100*   DB2 DCLGEN FOR COMPANY CONTROL TABLE                          02110000
021200******************************************************************02120000
021300     EXEC SQL                                                     02130000
021400          INCLUDE TCOCNTL                                         02140000
021500     END-EXEC.                                                    02150000
021600                                                                  02160000
021700***********************************************************       02170000
021800*  COPYBOOK USED BY INPUT FILE                            *       02180000
021900***********************************************************       02190000
022000     COPY WSRD022.                                                02200000
022100                                                                  02210000
022200***********************************************************       02220000
022300*  COPYBOOK USED IN CREATING OUTPUT FILE                  *       02230000
022400***********************************************************       02240000
022500     COPY WSRD043.                                                02250000
022600                                                                  02260000
023200*COPYBOOK FOR LOGISTIC DOMAIN MODULE              **              02320000
023300                                                                  02330000
023400     COPY XLWS001.                                                02340000
023500                                                                  02350000
023600/**********************************************************       02360000
023700 PROCEDURE DIVISION.                                              02370000
023800***********************************************************       02380000
023900     DISPLAY '*** BEGINNING WSKUT031 ***'.                        02390000
024000*                                                                 02400000
024100     OPEN INPUT  INVNTRY-ADJST-FILE.                              02410000
024200     OPEN OUTPUT INVNTRY-PROCESS-FILE.                            02420000
024400                                                                  02440000
024500*GET EXTRACT DATE.                                                02450000
024600     EXEC SQL                                                     02460000
024700         SELECT  BTCH_PRC_DTE                                     02470000
024800           INTO  :PV-CURRENT-DB2-DATE                             02480000
024900           FROM  TCOCNTL                                          02490000
025000          WHERE  OPER_UNT_ID = 90                                 02500000
025100     END-EXEC.                                                    02510000
025200                                                                  02520000
025300     EVALUATE TRUE                                                02530000
025400       WHEN SQLCODE = ZERO                                        02540000
025500           MOVE PV-CURRENT-DB2-DATE   TO PV-CURR-DATE             02550000
025600           MOVE PV-CURRENT-DB2-CCYY   TO PV-EXTRACT-DATE-YYYY     02560000
025700           MOVE PV-CURRENT-DB2-MM     TO PV-EXTRACT-DATE-MM       02570000
025800           MOVE PV-CURRENT-DB2-DD     TO PV-EXTRACT-DATE-DD       02580000
025900                                         PV-BTCH-DATE             02590000
026000           MOVE '-'                   TO PV-EXTRACT-DATE-1ST      02600000
026100                                         PV-EXTRACT-DATE-2ND      02610000
026200                                                                  02620000
026300       WHEN OTHER                                                 02630000
026400           MOVE 'INITIALIZATION' TO PV-ABEND-PARAGRAPH            02640000
026500           MOVE 'TCOCNTL'      TO PV-DB2-TABLE-NAME               02650000
026600           MOVE 'EXTRACT DATE' TO PV-DB2-OPERATION-MESSAGE-1      02660000
026700           PERFORM Z999-SQL-ERROR                                 02670000
026800     END-EVALUATE.                                                02680000
026900                                                                  02690000
027000                                                                  02700000
027100*                                                                 02710000
027200*READ FIRST INPUT RECORD.                                         02720000
027300     SET PS-NOT-END-OF-INPUT TO TRUE.                             02730000
027400     READ INVNTRY-ADJST-FILE                                      02740000
027500       INTO WS022-INV-ADJ-UPLOAD-RECORD                           02750000
027600         AT END                                                   02760000
027700           SET PS-END-OF-INPUT TO TRUE.                           02770000
027800*                                                                 02780000
027900*PROCESS INPUT FILE.                                              02790000
028000     IF PS-END-OF-INPUT                                           02800000
028100         DISPLAY '**** NO INPUT FILE FOUND FOR WSKUT031 ****'     02810000
028200     ELSE                                                         02820000
028300         PERFORM 3500-PROCESS-INPUT                               02830000
028400             UNTIL PS-END-OF-INPUT                                02840000
028500     END-IF.                                                      02850000
028600*                                                                 02860000
028700     MOVE PV-RECORDS-READ        TO PV-DISPLAY-RECORD.            02870000
028800     DISPLAY '*** RECORDS READ        ==> ' PV-DISPLAY-RECORD.    02880000
028900     MOVE PV-RECORDS-WRITTEN     TO PV-DISPLAY-RECORD.            02890000
029000     DISPLAY '*** RECORDS WRITTEN     ==> ' PV-DISPLAY-RECORD.    02900002
029500*                                                                 02950000
029600*CLOSE FILES.                                                     02960000
029700     CLOSE INVNTRY-ADJST-FILE                                     02970000
029800           INVNTRY-PROCESS-FILE.                                  02980000
030000     GOBACK.                                                      03000000
030100*                                                                 03010000
030200***************************************************************** 03020000
030300 2000-READ-INPUT-FILE.                                            03030000
030400***************************************************************** 03040000
030500     MOVE '2000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       03050000
030600*                                                                 03060000
030700     READ INVNTRY-ADJST-FILE                                      03070000
030800       INTO WS022-INV-ADJ-UPLOAD-RECORD                           03080000
030900         AT END                                                   03090000
031000           SET PS-END-OF-INPUT TO TRUE.                           03100000
031100                                                                  03110000
031200                                                                  03120000
031300****************************************************************  03130000
031400*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  03140000
031500****************************************************************  03150000
031600 3000-VALIDATE-TYPE-CODE.                                         03160000
031700                                                                  03170000
031800     MOVE WS022-LOCATION TO DK-STORE-NBR.                         03180000
031900                                                                  03190000
032000     EXEC SQL                                                     03200000
032100        SELECT  LOC_TYP_CDE                                       03210000
032200             ,  E_BUS_IND                                         03220000
032300             ,  LOC_NM                                            03230000
032400          INTO :XLT00010-LOC-TYP-CDE                              03240000
032500             , :XLT00010-E-BUS-IND                                03250000
032600             , :XLT00010-LOC-NM                                   03260000
032700          FROM  XLT_LOC                                           03270000
032800         WHERE  LOC_NBR = :DK-STORE-NBR                           03280000
032900     END-EXEC.                                                    03290000
033000                                                                  03300000
033100     EVALUATE TRUE                                                03310000
033200       WHEN SQLCODE = +0                                          03320000
033300           IF XLT00010-LOC-TYP-CDE  = 'DS'                        03330000
033400             AND XLT00010-E-BUS-IND = 'Y'                         03340000
033500               SET PS-ECOMMERCE TO TRUE                           03350000
033600           ELSE                                                   03360000
033700               SET PS-NOT-ECOMMERCE TO TRUE                       03370000
033800           END-IF                                                 03380000
033900                                                                  03390000
034000       WHEN SQLCODE = +100                                        03400000
034100           SET PS-INVALID-TYPE-CDE TO TRUE                        03410000
034200                                                                  03420000
034300       WHEN OTHER                                                 03430000
034400           MOVE '3000-VALIDATE-TYPE-CODE     '                    03440000
034500             TO PV-ABEND-PARAGRAPH                                03450000
034600           MOVE 'SELECT TYPE CODE FROM XLT_LOC  '                 03460000
034700             TO PV-ABEND-OPERATION                                03470000
034800           PERFORM Z999-SQL-ERROR                                 03480000
034900     END-EVALUATE.                                                03490000
035000                                                                  03500000
035100***************************************************************** 03510000
035200 3500-PROCESS-INPUT.                                              03520000
035300***************************************************************** 03530000
035400     MOVE '3500-PROCESS-INPUT      ' TO PV-ABEND-PARAGRAPH.       03540000
035500     ADD +1 TO PV-RECORDS-READ.                                   03550000
035600*                                                                 03560000
035700     IF WS022-LOCATION NOT EQUAL PV-WS022-HOLD-LOC                03570000
035800         SET PS-VALID-TYPE-CDE  TO TRUE                           03580000
035900         PERFORM 3000-VALIDATE-TYPE-CODE                          03590000
036000                                                                  03600000
036100         IF (XLT00010-LOC-TYP-CDE  = 'CS') OR                     03610000
036110            (XLT00010-LOC-TYP-CDE  = 'DS' AND                     03611000
036120                XLT00010-E-BUS-IND = 'Y')                         03612000
036130             CONTINUE                                             03613000
036140         ELSE                                                     03614000
036150             SET PS-INVALID-TYPE-CDE TO TRUE                      03615000
036160         END-IF                                                   03616000
036170         DISPLAY 'TYPE-SW   ==> ' PS-VALID-TYPE-CDE-SW            03617000
036180         MOVE WS022-LOCATION    TO   PV-WS022-HOLD-LOC            03618000
036190     END-IF                                                       03619000
036200*                                                                 03620000
036300*GET SKU.                                                         03630000
036400     IF WS022-ITEM-NBR NOT EQUAL PV-WS022-HOLD-ITEM               03640000
036500         MOVE WS022-ITEM-NBR TO PV-WS022-HOLD-ITEM                03650000
036600         SET PS-SKU-FOUND TO TRUE                                 03660000
036700         MOVE 0 TO DK-UPC-STORE                                   03670000
036800                   PV-UNT-RTL-AMT                                 03680000
036900         PERFORM 3700-SELECT-XLV-SKU                              03690000
037000         IF PS-SKU-FOUND                                          03700000
037100           AND XL001-REGN-PRIC-IND = 'Y'                          03710000
037200*SAVE ZERO STORE PRICE - JPL 11/8                                 03720000
037300***          DISPLAY '** REGIONAL PRICING FOR ' DK-SKU            03730000
037400***                  ' /STORE-ZERO PRICE = ' XL001-UNT-RTL-AMT    03740000
037500             IF XL001-UNT-RTL-AMT > 0                             03750000
037600                 MOVE XL001-UNT-RTL-AMT TO PV-UNT-RTL-AMT         03760000
037700             END-IF                                               03770000
037800                                                                  03780000
037900             SET PS-UPC-PRICE    TO TRUE                          03790000
038000             MOVE WS022-LOCATION TO DK-UPC-STORE                  03800000
038100             PERFORM 3700-SELECT-XLV-SKU                          03810000
038200*IF NUMBER STORE NOT FOUND, USE ZERO STORE PRICE - JPL 11/8       03820000
038300***          DISPLAY '** REGIONAL PRICING - '                     03830000
038400***                  'STORE-0873 = ' XL001-UNT-RTL-AMT            03840000
038500             IF XL001-UNT-RTL-AMT NOT > 0                         03850000
038600               AND PV-UNT-RTL-AMT > 0                             03860000
038700                 MOVE PV-UNT-RTL-AMT TO XL001-UNT-RTL-AMT         03870000
038800             END-IF                                               03880000
038900         END-IF                                                   03890000
039000      END-IF                                                      03900000
039100*                                                                 03910000
041600     PERFORM 4500-REFORMAT-ADJ-UPLOAD.                            04160000
041700*                                                                 04170000
041800*READ NEXT INPUT RECORD.                                          04180000
041900     PERFORM 2000-READ-INPUT-FILE.                                04190000
042000*                                                                 04200000
042100***************************************************************** 04210000
042200 3700-SELECT-XLV-SKU.                                             04220000
042300***************************************************************** 04230000
042400     MOVE '3700-SELECT-XLV-SKU     ' TO PV-ABEND-PARAGRAPH.       04240000
042500     MOVE WS022-ITEM-NBR             TO DK-TSK-KEY.               04250000
042600                                                                  04260000
042700     INITIALIZE XL001-ITEM-COMMAREA.                              04270000
042800                                                                  04280000
042900     SET XL001-BY-NUMERIC-SKU                                     04290000
043000         XL001-SELECT-SKU                                         04300000
043100         XL001-SELECT-VND-STYL                                    04310000
043200         XL001-SELECT-SKU-STR        TO TRUE.                     04320000
043300                                                                  04330000
043400      MOVE DK-SKU                    TO XL001-KEY-SKU.            04340000
043500      MOVE DK-UPC-STORE              TO XL001-KEY-STR-NBR.        04350000
043600                                                                  04360000
043700      CALL 'XLKUT001'     USING         XL001-ITEM-COMMAREA.      04370000
043800                                                                  04380000
043900      EVALUATE TRUE                                               04390000
044000        WHEN XL001-SKU-SQLCODE   = +0                             04400000
044100             PERFORM  3700-VND-CHECK-PARA                         04410000
044200        WHEN XL001-SKU-SQLCODE   = +100                           04420000
044300          SET PS-SKU-NOT-FOUND TO TRUE                            04430000
044400          DISPLAY '*** SKU NOT FOUND ==> ' DK-SKU                 04440000
044500                                                                  04450000
044600       WHEN XL001-SKU-CONTENTION                                  04460000
044700           MOVE '3700-SELECT-XLV-SKU   '   TO PV-ABEND-PARAGRAPH  04470000
044800           MOVE 'XLV-SKU '          TO PV-ABEND-STRUCTURE-1       04480000
044900           MOVE 'SKU CONTENTION'    TO PV-ABEND-OPERATION         04490000
045000           MOVE XL001-SKU-SQLCODE   TO SQLCODE                    04500000
045100           PERFORM Z999-SQL-ERROR                                 04510000
045200                                                                  04520000
045300       WHEN OTHER                                                 04530000
045400           MOVE '3700-SELECT-XLV-SKU   '   TO PV-ABEND-PARAGRAPH  04540000
045500           MOVE 'XLV-SKU '          TO PV-ABEND-STRUCTURE-1       04550000
045600           MOVE 'INVALID SKU ACCESS'   TO PV-ABEND-OPERATION      04560000
045700           MOVE XL001-SKU-SQLCODE   TO SQLCODE                    04570000
045800           PERFORM Z999-SQL-ERROR                                 04580000
045900      END-EVALUATE.                                               04590000
046000                                                                  04600000
046100 3700-VND-CHECK-PARA.                                             04610000
046200                                                                  04620000
046300      EVALUATE TRUE                                               04630000
046400        WHEN XL001-VND-STYL-SQLCODE = +0                          04640000
046500             PERFORM  3700-STR-CHECK-PARA                         04650000
046600                                                                  04660000
046700        WHEN XL001-VND-STYL-SQLCODE = +100                        04670000
046800          CONTINUE                                                04680000
046900                                                                  04690000
047000       WHEN XL001-VND-STYL-CONTENTION                             04700000
047100           MOVE '3700-SELECT-VND-STYL'   TO PV-ABEND-PARAGRAPH    04710000
047200           MOVE 'XLV-VND-STYL'      TO PV-ABEND-STRUCTURE-1       04720000
047300           MOVE 'VND CONTENTION'    TO PV-ABEND-OPERATION         04730000
047400           MOVE XL001-VND-STYL-SQLCODE TO SQLCODE                 04740000
047500           PERFORM Z999-SQL-ERROR                                 04750000
047600                                                                  04760000
047700       WHEN OTHER                                                 04770000
047800           MOVE '3700-SELECT-VND-STYL'   TO PV-ABEND-PARAGRAPH    04780000
047900           MOVE 'XLV-VND-STYL'      TO PV-ABEND-STRUCTURE-1       04790000
048000           MOVE XL001-VND-STYL-SQLCODE TO SQLCODE                 04800000
048100           MOVE 'INVALID VND ACCESS'   TO PV-ABEND-OPERATION      04810000
048200           MOVE XL001-VND-STYL-SQLCODE TO SQLCODE                 04820000
048300           PERFORM Z999-SQL-ERROR                                 04830000
048400                                                                  04840000
048500      END-EVALUATE.                                               04850000
048600                                                                  04860000
048700 3700-STR-CHECK-PARA.                                             04870000
048800                                                                  04880000
048900      EVALUATE TRUE                                               04890000
049000        WHEN XL001-SKU-STR-SQLCODE = +0                           04900000
049100             CONTINUE                                             04910000
049200                                                                  04920000
049300        WHEN XL001-SKU-STR-SQLCODE = +100                         04930000
049400            SET PS-NO-UPC-PRICE TO TRUE                           04940000
049500            MOVE 0 TO XL001-UNT-RTL-AMT                           04950000
049600                                                                  04960000
049700       WHEN XL001-SKU-STR-CONTENTION                              04970000
049800           MOVE '3700-SELECT-SKU-STR'   TO PV-ABEND-PARAGRAPH     04980000
049900           MOVE 'XLV-SKU-STR'      TO PV-ABEND-STRUCTURE-1        04990000
050000           MOVE 'STR CONTENTION'    TO PV-ABEND-OPERATION         05000000
050100           MOVE XL001-SKU-STR-SQLCODE TO SQLCODE                  05010000
050200           PERFORM Z999-SQL-ERROR                                 05020000
050300                                                                  05030000
050400       WHEN OTHER                                                 05040000
050500           MOVE '3700-SELECT-SKU-STR'   TO PV-ABEND-PARAGRAPH     05050000
050600           MOVE 'XLV-STR-STYL'      TO PV-ABEND-STRUCTURE-1       05060000
050700           MOVE XL001-SKU-STR-SQLCODE TO SQLCODE                  05070000
050800           MOVE 'INVALID STR ACCESS'    TO PV-ABEND-OPERATION     05080000
050900           PERFORM Z999-SQL-ERROR                                 05090000
051000                                                                  05100000
051100      END-EVALUATE.                                               05110000
051200                                                                  05120000
051300******************************************************************05130000
051400*  REFORMAT INVENTORY ADJUSTMENT UPLOAD                           05140000
051500******************************************************************05150000
051600 4500-REFORMAT-ADJ-UPLOAD.                                        05160000
051700******************************************************************05170000
051800     MOVE '4500-REFORMAT-ADJ-UPLOAD ' TO PV-ABEND-PARAGRAPH.      05180000
051900     INITIALIZE  WS043-INV-ADJ-UPLOAD-RECORD.                     05190000
052000                                                                  05200000
052100     MOVE WS022-LOCATION       TO WS043-CNSTK-LOC-ID              05210000
052200                                                                  05220000
052800     MOVE 'ECOM'               TO WS043-BTCH-NBR                  05280000
053000                                                                  05300000
053100     MOVE PV-CURRENT-DB2-MM    TO WS043-BTCH-PRC-DTE-MM           05310000
053200     MOVE PV-CURRENT-DB2-DD    TO WS043-BTCH-PRC-DTE-DD           05320000
053300     MOVE PV-CURRENT-DB2-CCYY  TO WS043-BTCH-PRC-DTE-YYYY         05330000
053400     MOVE WS022-ITEM-NBR (1:8) TO WS043-ITEM-NBR                  05340000
053500                                  PV-SAVE-SKU.                    05350000
053600     MOVE XL001-DEPT-NBR       TO WS043-DEPT-NBR                  05360000
053700     MOVE XL001-MAJ-CL-NBR     TO WS043-CLASS-NBR                 05370000
053800     MOVE XL001-SUB-CL-NBR     TO WS043-SUB-CLASS-NBR             05380000
053900                                                                  05390000
054000     MOVE XL001-SKU-DESC       TO WS043-ITEM-DESCRIPTION          05400000
054100                                                                  05410000
054200     MOVE WS022-UNIT-QTY-ADJ   TO  PV-OH-QTY-X.                   05420000
054300     MOVE PV-OH-QTY-X3         TO  PV-OH-QTY.                     05430000
054400     IF PV-OH-QTY-X1 = '-'                                        05440000
054500        COMPUTE PV-OH-QTY = PV-OH-QTY * -1                        05450000
054600     END-IF.                                                      05460000
054700     MOVE PV-OH-QTY            TO WS043-ADJ-UNIT-QTY              05470000
054800     MOVE XL001-UNT-RTL-AMT    TO WS043-UNIT-PRICE                05480000
054900     MOVE WS022-REASON-CDE     TO WS043-ADJ-REASON-CDE            05490000
055000                                                                  05500000
055100     COMPUTE WS043-UNIT-PRICE-EXT =                               05510000
055200               PV-OH-QTY * WS043-UNIT-PRICE                       05520000
055300     EVALUATE TRUE                                                05530000
055400       WHEN PS-INVALID-TYPE-CDE                                   05540000
055500            MOVE '01' TO WS043-ERROR-REASON-CDE                   05550000
055600       WHEN PS-SKU-NOT-FOUND                                      05560000
055700            MOVE '02' TO WS043-ERROR-REASON-CDE                   05570000
055800     END-EVALUATE                                                 05580000
055900                                                                  05590000
055902     MOVE WS022-TRAN-TYP        TO WS043-TRAN-TYP                 05590201
055905     MOVE WS022-TRAN-CDE        TO WS043-TRAN-CDE                 05590501
055906     MOVE WS022-ACTN-CDE        TO WS043-ACTN-CDE                 05590605
055907                                                                  05590707
055908*    MOVE WS022-TRAN-NBR        TO WS043-TRAN-NBR                 05590807
055909     MOVE WS022-TRAN-NBR        TO PV-HOLD-NUMBER.                05590907
055910     PERFORM 4510-CHECK-FOR-SPACES.                               05591007
055911     MOVE PV-HOLD-NUMBER        TO WS043-TRAN-NBR.                05591107
055912                                                                  05591207
055913*    MOVE WS022-PIX-SEQ-NBR     TO WS043-PIX-SEQ-NBR              05591307
055914     MOVE WS022-PIX-SEQ-NBR     TO PV-HOLD-NUMBER.                05591407
055915     PERFORM 4510-CHECK-FOR-SPACES.                               05591507
055916     MOVE PV-HOLD-NUMBER        TO WS043-PIX-SEQ-NBR.             05591607
055917                                                                  05591704
055918     IF  WS022-FROM-FSHN-ADAPTER                                  05591804
055919         MOVE 1                 TO WS043-FSHN-ADAPTER-CDE         05591904
055920         MOVE 0                 TO WS043-PUTAWAY-ADAPTER-CDE      05592004
055921     END-IF                                                       05592104
055922                                                                  05592204
055923     IF  WS022-FROM-PUTAWAY-ADAPTER                               05592304
055924         MOVE 0                 TO WS043-FSHN-ADAPTER-CDE         05592404
055925         MOVE 1                 TO WS043-PUTAWAY-ADAPTER-CDE      05592504
055926     END-IF                                                       05592604
055927                                                                  05592704
055930                                                                  05593001
056000     WRITE INVNTRY-PROCESS-RECORD                                 05600000
056100          FROM WS043-INV-ADJ-UPLOAD-RECORD                        05610000
056200     ADD +1 TO PV-RECORDS-WRITTEN.                                05620000
056300                                                                  05630000
059300 4510-CHECK-FOR-SPACES.                                           05930007
059301                                                                  05930107
059302     IF  PV-HN-POS-1 = SPACE                                      05930207
059303         MOVE 0 TO PV-HN-POS-1                                    05930307
059304     END-IF.                                                      05930407
059305     IF  PV-HN-POS-2 = SPACE                                      05930507
059306         MOVE 0 TO PV-HN-POS-2                                    05930607
059307     END-IF.                                                      05930707
059308     IF  PV-HN-POS-3 = SPACE                                      05930807
059309         MOVE 0 TO PV-HN-POS-3                                    05930907
059310     END-IF.                                                      05931007
059311     IF  PV-HN-POS-4 = SPACE                                      05931107
059312         MOVE 0 TO PV-HN-POS-4                                    05931207
059313     END-IF.                                                      05931307
059314     IF  PV-HN-POS-5 = SPACE                                      05931407
059315         MOVE 0 TO PV-HN-POS-5                                    05931507
059316     END-IF.                                                      05931607
059317     IF  PV-HN-POS-6 = SPACE                                      05931707
059318         MOVE 0 TO PV-HN-POS-6                                    05931807
059319     END-IF.                                                      05931907
059320     IF  PV-HN-POS-7 = SPACE                                      05932007
059321         MOVE 0 TO PV-HN-POS-7                                    05932107
059322     END-IF.                                                      05932207
059323     IF  PV-HN-POS-8 = SPACE                                      05932307
059324         MOVE 0 TO PV-HN-POS-8                                    05932407
059325     END-IF.                                                      05932507
059326     IF  PV-HN-POS-9 = SPACE                                      05932607
059327         MOVE 0 TO PV-HN-POS-9                                    05932707
059328     END-IF.                                                      05932807
059329     IF  PV-HN-POS-10 = SPACE                                     05932907
059330         MOVE 0 TO PV-HN-POS-10                                   05933007
059331     END-IF.                                                      05933107
059332                                                                  05933207
059340 Z999-SQL-ERROR.                                                  05934007
059400***************************************************************** 05940000
059500                                                                  05950000
059600     MOVE SQLCODE TO PV-SQLCODE.                                  05960000
059700     DISPLAY '*** DB2 ERROR '.                                    05970000
059800     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       05980000
059900     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 05990000
060000     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               06000000
060100     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               06010000
060200     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       06020000
060300     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       06030000
060400     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       06040000
060500     DISPLAY '*** TABLE 1   = ' PV-ABEND-STRUCTURE-1.             06050000
061000                                                                  06100000
061100     COPY DPPD004.                                                06110000
061200                                                                  06120000
061300     MOVE +4013                  TO PV-ABEND-CODE.                06130000
061400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         06140000
