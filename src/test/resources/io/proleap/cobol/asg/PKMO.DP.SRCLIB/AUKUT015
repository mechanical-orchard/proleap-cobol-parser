000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.      AUKUT015.                                       00020067
000300 AUTHOR.          TOM HANSON.                                     00030000
000400 DATE-WRITTEN.    JUNE, 2004.                                     00040000
000500                                                                  00050000
000600*----------------------------------------------------------------*00060000
000700*            REWARDS ACTIVATION PARAMETER FILE EXTRACT            00070000
000800*----------------------------------------------------------------*00080000
000810*  MODULE TYPE: COBOL2 ORACLE BATCH                               00090000
000820*                                                                 00100000
000830*    OVERVIEW.                                                    00110032
000840*    THIS PROGRAM WILL EXTRACT AND FORMAT ALL REWARD EVENT        00120033
000850*    RECORDS WHICH ARE CURRENTLY SET AS ACTIVE. DEPENDING ON      00130032
000860*    A CONTROL CARD, THE PROGRAM WILL EITHER AUTOMATICALLY        00140032
000870*    RUN THE FULL EXTRACT PROCESS, OR IT WILL CHECK FOR ANY       00150032
000880*    UPDATES ON THE APPROPRIATE TABLES.  IF IT DOES FIND ANY      00160032
000890*    CHANGES HAVE BEEN MADE, IT WILL RUN THE FULL EXTRACT.        00170032
000900*----------------------------------------------------------------*00180000
001000* HISTORY LOG:                                                    00190000
001100*----------------------------------------------------------------*00200000
001200* DATE:        07/30/2004 *CHANGES DENOTED BY 073004              00210000
001300* WR/IR#:      P000679532                                         00220000
001400* PROGRAMMER:  THOMAS HANSON                                      00230000
001500* DESCRIPTION: MINOR IMPROVEMENTS TO SQL CURSOR CALLS.            00240000
001600*----------------------------------------------------------------*00250000
001700* DATE:        09/02/2004 *CHANGES DENOTED BY 090204              00260000
001800* WR/IR#:      P000693930                                         00270000
001900* PROGRAMMER:  THOMAS HANSON                                      00280000
002000* DESCRIPTION: EXTENDED FIXED LENGTH PORTION OF THE ACTIVATION    00290000
002100*              FILE BY 1 CHARACTER FOR THE MAX-RWD QTY FIELD.     00300000
002200*----------------------------------------------------------------*00310000
002300* DATE:        09/14/2005                                         00320000
002310* WR/IR#:      WR28518                                            00330000
002320* PROGRAMMER:  SCOTT BARTELT                                      00340000
002330* DESCRIPTION: CHANGES FOR THE RETURN AUTOMATION PROJECT WHICH    00350000
002340*              INCLUDE:                                           00360000
002341*                - THE REWARD VALUE FIELD ON THE OUTPUT RECORD    00370000
002342*                  IS BEING CHANGED FROM A 7 CHARACTER VARIABLE   00380000
002343*                  LENGTH FIELD TO A 5 DIGIT NUMERIC FIELD.       00390000
002344*                  PRIOR TO RETURN AUTOMATION THIS FIELD WAS      00400000
002345*                  USED FOR DISPLAY PURPOSES ONLY.  NOW IT WILL   00410000
002346*                  BE USED WITHIN A FORMULA TO CALCULATE THE      00420000
002347*                  ACTIVATION AMOUNT.                             00430000
002348*                - AN ADDITIONAL FIELD ADDED TO THE OUTPUT RECORD 00440000
002349*                  WHICH WILL BE FOR A VARIABLE LENGTH RECEIPT    00450000
002350*                  MESSAGE LINE.                                  00460000
002351*                - ALL PAST EVENTS SHOULD NOW BE INCLUDED ON THE  00470000
002352*                  FILE.                                          00480000
002353*                - ONLY THOSE STORES WITH A POS CAPABILITY I.D.   00490000
002354*                  GREATER THAN 14 (15 IS BEING USED FOR RETURN   00500000
002355*                  AUTOMATION ROLLOUT) SHOULD BE INCLUDED.        00510000
061306*----------------------------------------------------------------*00520000
061306* DATE:        06/13/2006 *CHANGES DENOTED BY 061306              00530000
061306* WR/IR#:      P000890326                                         00540000
061306* PROGRAMMER:  STEVEN NOWAK                                       00550000
061306* DESCRIPTION: UPDATE DATE IN CURSOR                              00560000
062106*----------------------------------------------------------------*00570000
062106* DATE:        06/21/2006 *CHANGES DENOTED BY 062106              00580000
062106* WR/IR#:      WR30039                                            00590000
062106* PROGRAMMER:  STEVEN NOWAK                                       00600000
062106* DESCRIPTION: FINAL DOS POS RELEASE CHANGES                      00610000
W36690*----------------------------------------------------------------*00620000
W36690* DATE:        06/02/2009 *CHANGES DENOTED BY W36690              00630000
W36690* WR/IR#:      WR36690                                            00640000
W36690* PROGRAMMER:  THOMAS HANSON                                      00650000
W36690* DESCRIPTION: FOR STORES NOT INCLUDED IN AN ACTIVATION EVENT     00660000
W36690*              WE WILL NOW BE INCLUDING ALL OF THE EVENT'S ENTERED00670000
W36690*              FIELDS EXCEPT FOR THE BEGIN / END DATE. THIS CHANGE00680000
W36690*              IS REQUIRED FOR RETURN PROCESSING IN THOSE STORES. 00690000
W36690*              THIS APPLIES TO THE 'DEFAULT' LINE PRINT.          00700000
062309*----------------------------------------------------------------*00710000
062309* DATE:        06/23/2009 *CHANGES DENOTED BY '062309'            00720000
062309* WR/IR#:      INC000000852057                                    00730000
062309* PROGRAMMER:  THOMAS HANSON                                      00740000
062309* DESCRIPTION: THE OUTPUT FILES APPARENTLY STILL HAD A FILE SIZE  00750000
062309*              RESTRICTION AT POS AND THE ACTIVATE.TXT FILE WENT  00760000
062309*              PAST THE 20K LIMIT CAUSING GPFS AT THE REGISTERS.  00770000
062309*              THIS CHANGE WILL LIMIT THE EVENTS INCLUDED TO THE  00780000
062309*              ONES WITH AN END DATE GREATER THAN CURRENT DATE    00790000
062309*              MINUS 18 MONTHS. PREVIOUSLY WE HAD USED A STATIC   00800000
062309*              HARDCODED DATE OF '2005-11-30'.                    00810000
W36988*----------------------------------------------------------------*00820000
W36988* DATE:        07/28/2009 *CHANGES DENOTED BY 'W36988'            00830000
W36988* WR/IR#:      WR36988                                            00840000
W36988* PROGRAMMER:  THOMAS HANSON                                      00850000
W36988* DESCRIPTION: AS A FOLLOW-UP EFFORT TO THE FILE SIZE LIMIT ISSUE 00860000
W36988*              WE WILL PREVENT THE FILE FROM GETTING PAST THE     00870000
W36988*              EXTRACT PROGRAM IF IT WOULD BE LARGE ENOUGH TO     00880000
W36988*              CAUSE A PROBLEM AT POS. IF WE ARE NEARING THE FILE 00890000
W36988*              RECORD COUNT LIMIT, WE WILL SEND AN EMAIL TO THE   00900000
W36988*              SUPPORT TEAM TO INFORM THEM OF THE POTENTIAL RISK. 00910000
W36988*----------------------------------------------------------------*00920000
PK8161* DATE:        06/16/2011 *CHANGES DENOTED BY 'PK8161'            00930000
PK8161* WR/IR#:      PKE000000008161                                    00940000
PK8161* PROGRAMMER:  COGNIZANT                                          00950000
PK8161* DESCRIPTION: TO INCREASE THE FILE RECORD COUNT LIMIT TO 250 FOR 00960000
PK8161*              WARNINGS AND 300 TO ABEND.                         00970000
PK8161*----------------------------------------------------------------*00980000
      * DATE:        07/25/2016 CHG0146560                              00990099
      * WR/IR#:      11082d - Kohl's Cash project - EPKUT148 - old pgm  01000002
      * PROGRAMMER:  Baskaran Srinivasan                                01010000
      * DESCRIPTION: Convert existing DB2 calls to Oracle using the     01020003
      *              DBLinks for XST tables.                            01030003
      *              Combines both Oracle tables and DB2 views.         01040003
      *              Since the Oracle tables are defined in AU instance 01050000
      *              and belong to AU, the program was moved from       01060000
      *              EPKUT148 to AUKUT015. Existing Tender-Type-Code    01070099
      *              will be replaced with Validity Period days if RKC. 01080099
      *              The Job and Proc names didn't change.              01090099
      *----------------------------------------------------------------*01100000
002380                                                                  01110000
002390 ENVIRONMENT DIVISION.                                            01120000
002400 CONFIGURATION SECTION.                                           01130000
002500                                                                  01140000
002600 SOURCE-COMPUTER.        IBM-3090.                                01150000
002700 OBJECT-COMPUTER.        IBM-3090.                                01160000
002800                                                                  01170000
002900 INPUT-OUTPUT SECTION.                                            01180000
003000 FILE-CONTROL.                                                    01190000
003100                                                                  01200000
003200     SELECT CTRL-CRD-PGM-LAST-RUN                                 01210000
003300       FILE STATUS IS FS-CTRL-CRD-PGM-LAST-RUN                    01220000
003400       ASSIGN TO INP01.                                           01230000
003500                                                                  01240000
003600     SELECT CTRL-CRD-IDENT-TYP                                    01250000
003700       FILE STATUS IS FS-CTRL-CRD-IDENT-TYP                       01260000
003800       ASSIGN TO INP02.                                           01270000
003900                                                                  01280000
004000     SELECT CTRL-CRD-CUR-BTCH-DTE                                 01290000
004100       FILE STATUS IS FS-CTRL-CRD-CUR-BTCH-DTE                    01300000
004200       ASSIGN TO INP03.                                           01310000
004300                                                                  01320000
004400     SELECT CTRL-CRD-ADV-OPN-DAYS                                 01330000
004500       FILE STATUS IS FS-CTRL-CRD-ADV-OPN-DAYS                    01340000
004600       ASSIGN TO INP04.                                           01350000
004700                                                                  01360000
           SELECT CONTROL-CARD-ORACLE-LOGIN                             01370000
             ASSIGN TO ORALOGON.                                        01380099
                                                                        01390000
004800     SELECT RWD-ISUD-EXTRCT-FLE                                   01400000
004900       FILE STATUS IS FS-RWD-ISUD-EXTRCT-FLE                      01410000
005000       ASSIGN TO OUT01.                                           01420000
005100                                                                  01430000
005200     SELECT RWD-ISUD-EXTRCT-RPT                                   01440000
005300       FILE STATUS IS FS-RWD-ISUD-EXTRCT-RPT                      01450000
005400       ASSIGN TO RPT01.                                           01460000
005500                                                                  01470000
005600 DATA DIVISION.                                                   01480000
005700 FILE SECTION.                                                    01490000
005800                                                                  01500000
005900 FD  CTRL-CRD-PGM-LAST-RUN                                        01510000
006000     RECORDING MODE F                                             01520000
006100     BLOCK CONTAINS 0 RECORDS                                     01530000
006200     LABEL RECORDS ARE OMITTED                                    01540000
006300     DATA RECORD IS CTRL-CRD-PGM-LAST-RUN-REC.                    01550000
006400 01  CTRL-CRD-PGM-LAST-RUN-REC          PIC X(80).                01560000
006500                                                                  01570000
006600 FD  CTRL-CRD-IDENT-TYP                                           01580000
006700     RECORDING MODE F                                             01590000
006800     BLOCK CONTAINS 0 RECORDS                                     01600000
006900     LABEL RECORDS ARE OMITTED                                    01610000
007000     DATA RECORD IS CTRL-CRD-IDENT-TYP-REC.                       01620000
007100 01  CTRL-CRD-IDENT-TYP-REC             PIC X(80).                01630000
007200                                                                  01640000
007300 FD  CTRL-CRD-CUR-BTCH-DTE                                        01650000
007400     RECORDING MODE F                                             01660000
007500     BLOCK CONTAINS 0 RECORDS                                     01670000
007600     LABEL RECORDS ARE OMITTED                                    01680000
007700     DATA RECORD IS CTRL-CRD-CUR-BTCH-DTE-REC.                    01690000
007800 01  CTRL-CRD-CUR-BTCH-DTE-REC          PIC X(80).                01700000
007900                                                                  01710000
008000 FD  CTRL-CRD-ADV-OPN-DAYS                                        01720000
008100     RECORDING MODE F                                             01730000
008200     BLOCK CONTAINS 0 RECORDS                                     01740000
008300     LABEL RECORDS ARE OMITTED                                    01750000
008400     DATA RECORD IS CTRL-CRD-ADV-OPN-DAYS-REC.                    01760000
008500 01  CTRL-CRD-ADV-OPN-DAYS-REC          PIC X(80).                01770000
008600                                                                  01780000
       FD  CONTROL-CARD-ORACLE-LOGIN                                    01790000
           RECORDING MODE IS F                                          01800000
           LABEL RECORDS ARE STANDARD                                   01810000
           RECORD CONTAINS 080 CHARACTERS                               01820000
           BLOCK CONTAINS 0 RECORDS                                     01830000
           DATA RECORD IS CONTROL-CARD-ORACLE-LOGIN-RCD.                01840000
                                                                        01850000
       01  CONTROL-CARD-ORACLE-LOGIN-RCD      PIC X(80).                01860043
                                                                        01870000
008700 FD  RWD-ISUD-EXTRCT-FLE                                          01880000
008800     RECORDING MODE IS V                                          01890000
008900     LABEL RECORDS ARE STANDARD                                   01900000
009000     RECORD IS VARYING FROM 1 TO 198                              01910085
009100     DEPENDING ON PV-RWD-ISD-REC-BYTE-CNT                         01920000
009200     DATA RECORD IS RWD-ISUD-EXTRCT-RECORD.                       01930000
009300 01  RWD-ISUD-EXTRCT-RECORD.                                      01940000
009400   05  RWD-ISUD-EXTRCT-BYTE             PIC X(01)                 01950000
009500         OCCURS 1 TO 198 TIMES                                    01960085
009600         DEPENDING ON PV-RWD-ISD-REC-BYTE-CNT.                    01970000
009700                                                                  01980000
009800 FD  RWD-ISUD-EXTRCT-RPT                                          01990000
009900     RECORDING MODE IS F                                          02000000
010000     LABEL RECORDS ARE STANDARD                                   02010000
010100     BLOCK CONTAINS 0 RECORDS                                     02020000
010200     RECORD CONTAINS 200 CHARACTERS.                              02030000
010300 01  RWD-ISUD-EXTRCT-RPT-REC            PIC X(200).               02040000
010400                                                                  02050000
010500 WORKING-STORAGE SECTION.                                         02060000
010600                                                                  02070000
010700*----------------------------------------------------------------*02080000
010800*  AB- ABEND CODES                                                02090000
010900*----------------------------------------------------------------*02100000
011000 01  AB-ABEND-CODE                      PIC S9(04) VALUE ZERO     02110000
011100                                                   COMP SYNC.     02120000
011300   88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003.   02130000
011400   88  ABEND-4004-TBL-OVERFLOW-ERROR               VALUE +4004.   02140000
011500   88  ABEND-4013-DB2-ERROR                        VALUE +4013.   02150041
         88  ABEND-4013-ORACLE-ERROR                     VALUE +4013.   02160041
011600   88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019.   02170000
W36988   88  ABEND-4444-FORCED-ABEND                     VALUE +4444.   02180000
W36988   88  ABEND-4013-DB-ERROR                         VALUE +4013.   02190040
011700                                                                  02200000
      *----------------------------------------------------------------*02210003
      *  CC- CONTROL CARD VARIABLES                                     02220003
      *----------------------------------------------------------------*02230003
       01  CC-ORACLE-CONNECTION.                                        02240003
           05  CC-ORACLE-USERID             PIC  X(40) VALUE SPACES.    02250041
               88 CC-AUTO-LOGON                        VALUE '/'.       02260003
           05  CC-ORACLE-PASSWORD           PIC  X(40) VALUE SPACES.    02270041
                                                                        02280003
011800*----------------------------------------------------------------*02290000
011900*  FS- FILE STATUS CODE VARIABLES                                 02300000
012000*----------------------------------------------------------------*02310000
012100 01  FS-FILE-STATUS-CODES.                                        02320000
012200   05  FS-CTRL-CRD-PGM-LAST-RUN         PIC X(02).                02330000
012300     88  FS-CTRL-CRD-PGM-LAST-RUN-OK               VALUE '00'.    02340000
012400     88  FS-CTRL-CRD-PGM-LAST-RUN-EOF              VALUE '10'.    02350000
012500                                                                  02360000
012600   05  FS-CTRL-CRD-IDENT-TYP            PIC X(02).                02370000
012700     88  FS-CTRL-CRD-IDENT-TYP-OK                  VALUE '00'.    02380000
012800     88  FS-CTRL-CRD-IDENT-TYP-EOF                 VALUE '10'.    02390000
012900                                                                  02400000
013000   05  FS-CTRL-CRD-CUR-BTCH-DTE         PIC X(02).                02410000
013100     88  FS-CTRL-CRD-CUR-BTCH-DTE-OK               VALUE '00'.    02420000
013200     88  FS-CTRL-CRD-CUR-BTCH-DTE-EOF              VALUE '10'.    02430000
013300                                                                  02440000
013400   05  FS-CTRL-CRD-ADV-OPN-DAYS         PIC X(02).                02450000
013500     88  FS-CTRL-CRD-DAYS-TILL-OPN-OK              VALUE '00'.    02460000
013600     88  FS-CTRL-CRD-DAYS-TILL-OPN-EOF             VALUE '10'.    02470000
013700                                                                  02480000
013800   05  FS-RWD-ISUD-EXTRCT-FLE           PIC X(02).                02490000
013900     88  FS-RWD-ISUD-EXTRCT-FLE-OK                 VALUE '00'.    02500000
014000     88  FS-RWD-ISUD-EXTRCT-FLE-EOF                VALUE '10'.    02510000
014100                                                                  02520000
014200   05  FS-RWD-ISUD-EXTRCT-RPT           PIC X(02).                02530000
014300     88  FS-RWD-ISUD-EXTRCT-RPT-OK                 VALUE '00'.    02540000
014400     88  FS-RWD-ISUD-EXTRCT-RPT-EOF                VALUE '10'.    02550000
014500                                                                  02560000
014600*----------------------------------------------------------------*02570000
014700*  PC- PROGRAM CONSTANTS                                          02580000
014800*----------------------------------------------------------------*02590000
014900 01  PC-PROGRAM-CONSTANTS.                                        02600000
015000   05  PC-PROGRAM-NAME                  PIC X(08)                 02610000
015100                                            VALUE 'AUKUT015'.     02620067
018107   05  PC-DFLT-PAST-DTE                 PIC X(10)                 02630000
018108                                            VALUE '1962-01-01'.   02640000
015200   05  PC-RWD-ISUD-FIXED-LENGTH         PIC 9(02)  VALUE 54.      02650099
015400   05  PC-EVNT-MAX-SIZE                 PIC 9(02)  VALUE 30.      02660000
015600   05  PC-0-DEPT-SIZE                   PIC 9(02)  VALUE 4.       02670000
015800   05  PC-1-DEPT-SIZE                   PIC 9(02)  VALUE 8.       02680000
016000   05  PC-2-DEPT-SIZE                   PIC 9(02)  VALUE 12.      02690000
016200   05  PC-3-DEPT-SIZE                   PIC 9(02)  VALUE 16.      02700000
016400   05  PC-4-DEPT-SIZE                   PIC 9(02)  VALUE 20.      02710000
016600   05  PC-5-DEPT-SIZE                   PIC 9(02)  VALUE 24.      02720000
016800   05  PC-SQL-MAX-RETRIES               PIC 9(01)  VALUE 5.       02730000
017000   05  PC-MDSE-MAX-DEPTS                PIC 9(01)  VALUE 5.       02740000
017200   05  PC-MDSE-ALL-DEPTS                PIC 9(01)  VALUE 2.       02750000
017400   05  PC-EXCL-ALL-DEPTS                PIC 9(01)  VALUE 1.       02760000
017600   05  PC-REPORT-NUMBER                 PIC 9(01)  VALUE 1.       02770000
017800   05  PC-LINES-PER-PAGE                PIC 9(2)   VALUE 50.      02780000
018000   05  PC-LINES-FOR-HDRS                PIC 9(01)  VALUE 9.       02790000
018101   05  PC-CMNT-LNE-MAX-SIZE             PIC 9(02)  VALUE 42.      02800000
018103   05  PC-DEC-ONE                       PIC 9(01)  VALUE 1.       02810000
018105   05  PC-MAX-RWD-TBL-NDX               PIC 9(04)  VALUE 9999.    02820000
         05  PC-AUTO-LOGON                    PIC X(1)   VALUE '/'.     02830003
W36988                                                                  02840000
W36988*-->   IN ORDER TO AVOID SENDING A FILE THAT IS TOO LARGE FOR     02850000
W36988*-->   THE POS REGISTER APP TO HANDLE, WE WILL BE PREVENTING THE  02860000
W36988*-->   FILE TRANSMISSION DURING THE EXTRACT PROGRAMS THEMSELVES.  02870000
PK8161   05  PC-FILE-COUNT-LIMIT-ABEND        PIC 9(03)  VALUE 300.     02880099
PK8161   05  PC-FILE-COUNT-LIMIT-EMAIL        PIC 9(03)  VALUE 250.     02890000
W36988   05  PC-EMAIL-RETURN-CODE             PIC 9(02)  VALUE 04.      02900000
018109                                                                  02910000
018110*----------------------------------------------------------------*02920000
018120*  PS - PROGRAM SWITCHES                                          02930000
018130*----------------------------------------------------------------*02940000
018140 01  PS-PROGRAM-SWITCHES.                                         02950000
018150   05  PS-END-OF-CNTL-CRD-SW            PIC X(01).                02960000
018160     88  PS-END-OF-CNTL-CRD-FILE                   VALUE 'Y'.     02970000
018170     88  PS-NOT-END-OF-CNTL-CRD-FILE               VALUE 'N'.     02980000
018180                                                                  02990000
018190   05  PS-EXTRACT-DATA-SW               PIC X(01).                03000000
018200     88  PS-EXTRACT-DATA                           VALUE 'Y'.     03010000
018300     88  PS-DONT-EXTRACT-DATA                      VALUE 'N'.     03020000
018400                                                                  03030000
018500   05  PS-RWD-EVNT-CSR-SW               PIC X(01).                03040000
018600     88  PS-END-OF-RWD-EVNT-CSR                    VALUE 'Y'.     03050000
018700     88  PS-NOT-END-OF-RWD-EVNT-CSR                VALUE 'N'.     03060000
018800                                                                  03070000
018900   05  PS-MAX-RWD-REDM-DTE-SW           PIC X(01).                03080000
019000     88  PS-MAX-RWD-REDM-DTE-FOUND                 VALUE 'Y'.     03090000
019100     88  PS-MAX-RWD-REDM-DTE-NOT-FOUND             VALUE 'N'.     03100000
019200                                                                  03110000
019300   05  PS-RWD-ISUD-CSR-SW               PIC X(01).                03120000
019400     88  PS-END-OF-RWD-ISUD-CSR                    VALUE 'Y'.     03130000
019500     88  PS-NOT-END-OF-RWD-ISUD-CSR                VALUE 'N'.     03140000
019600                                                                  03150000
019700   05  PS-STR-LOC-CSR-SW                PIC X(01).                03160041
019800     88  PS-END-OF-STR-LOC-CSR                     VALUE 'Y'.     03170041
019900     88  PS-NOT-END-OF-STR-LOC-CSR                 VALUE 'N'.     03180041
020000                                                                  03190000
020100   05  PS-IE-MDSE-DEPTS-SW              PIC X(01).                03200000
020200     88  PS-END-OF-DEPTS-CSR                       VALUE 'Y'.     03210000
020300     88  PS-NOT-END-OF-DEPTS-CSR                   VALUE 'N'.     03220000
020400                                                                  03230000
020500   05  PS-LINE-TERM-FOUND-SW            PIC X(01).                03240000
020600     88  PS-LINE-END-FOUND                         VALUE 'Y'.     03250000
020700     88  PS-LINE-END-NOT-FOUND                     VALUE 'N'.     03260000
020800                                                                  03270000
W36690   05  PS-DEFAULT-VALUE-REC-SW          PIC X(01).                03280000
W36690     88  PS-DFLT-VALUE-REC                         VALUE 'Y'.     03290000
W36690     88  PS-NOT-DFLT-VALUE-REC                     VALUE 'N'.     03300000
020930                                                                  03310000
W36988   05  PS-SET-EMAIL-RC-FLAG-SW          PIC X(01).                03320000
W36988     88  PS-SET-EMAIL-RC                           VALUE 'Y'.     03330000
W36988     88  PS-DO-NOT-SET-EMAIL-RC                    VALUE 'N'.     03340000
W36988                                                                  03350000
020940*----------------------------------------------------------------*03360000
020950*  PT- PROGRAM TABLES                                             03370000
020960*----------------------------------------------------------------*03380000
020970 01  PT-VALID-RWD-EVENTS-TBL.                                     03390000
020980   05  PT-VALID-RWD-EVENTS-DATA                                   03400000
020990         OCCURS 9999 TIMES                                        03410000
021000         INDEXED BY PT-RWD-NDX.                                   03420000
021010     10  PT-RWD-ID                      PIC X(05).                03430000
021020     10  PT-QUALD-PRCH-AMT              PIC S9(3)V9(2)            03440000
021030                                                   COMP-3.        03450000
021040     10  PT-QUALD-TOL-AMT               PIC S9(2)V9(2)            03460000
021050                                                   COMP-3.        03470000
021060     10  PT-MAX-RWD-QTY                 PIC S9(3)V COMP-3.        03480000
021080     10  PT-RWD-DISC-AMT                PIC S9(3)V9(2)            03490000
021090                                                   COMP-3.        03500000
021100     10  PT-RWD-EVNT-NM                 PIC X(30)  VALUE SPACES.  03510000
W36690     10  PT-TNDR-TYP-CDE                PIC 999    VALUE ZERO.    03520085
W36690     10  PT-MDSE-IE-CDE                 PIC 9      VALUE ZERO.    03530085
W36690     10  PT-RCPT-CMNT-LNE1-TXT          PIC X(42)  VALUE SPACES.  03540000
W36690     10  PT-RCPT-CMNT-LNE2-TXT          PIC X(42)  VALUE SPACES.  03550000
021101                                                                  03560000
021102*----------------------------------------------------------------*03570000
021103*  PV- WORKING PROGRAM VARIABLES                                  03580000
021104*----------------------------------------------------------------*03590000
021105 01  PV-PROGRAM-VARIABLES.                                        03600000
021106   05  PV-PROCESSING-VARIABLES.                                   03610000
021107     10  PV-RWD-EVNT-ID                 PIC X(05).                03620000
021110     10  PV-RWD-EVNT-NM                 PIC X(30).                03630000
021120     10  PV-ISUD-BEG-DTE                PIC X(19).                03640033
021130     10  PV-ISUD-END-DTE                PIC X(19).                03650033
021130     10  PV-EDIT-DATE                   PIC X(10).                03660054
021130     10  PV-END-DATE                    PIC X(10).                03670033
021140     10  PV-PRE-BEG-DAYS-QTY            PIC S9(2)V COMP-3.        03680000
021160     10  PV-POST-END-DAYS-QTY           PIC S9(2)V COMP-3.        03690000
021180     10  PV-TNDR-TYP-CDE                PIC S9(3)V COMP-3.        03700085
021420     10  PV-MAX-RWD-QTY                 PIC S9(3)V COMP-3.        03710000
021108     10  PV-RWD-DISC-AMT                PIC S9(3)V9(2)            03720000
021109                                                   COMP-3.        03730000
021200     10  PV-QUALD-PRCH-AMT              PIC S9(3)V9(2)            03740000
021300                                                   COMP-3.        03750000
021400     10  PV-QUALD-TOL-AMT               PIC S9(2)V9(2)            03760000
021410                                                   COMP-3.        03770000
021440     10  PV-MDSE-IE-CDE                 PIC S9(1)V COMP-3.        03780000
021442     10  PV-RCPT-CMNT-LNE1-TXT          PIC X(42).                03790000
021443     10  PV-RCPT-CMNT-LNE2-TXT          PIC X(42).                03800000
           10  PV-ORACLE-USERID-LEN           PIC S9(4)  VALUE ZEROS    03810041
                                                          COMP SYNC.    03820041
           10  PV-ORACLE-PASSWORD-LEN         PIC S9(4)  VALUE ZEROS    03830041
                                                          COMP SYNC.    03840041
021444                                                                  03850000
021445   05  PV-RWD-FORMATTING-VARIABLES.                               03860000
021446     10  PV-RWD-EVNT-ID-HELD            PIC X(05)  VALUE SPACES.  03870000
021448     10  PV-RWD-EVNT-ID-CHARS           PIC X(05) JUSTIFIED RIGHT.03880000
021450     10  PV-RWD-EVNT-NM-RVRS            PIC X(30)  VALUE SPACES.  03890000
021470     10  PV-MDSE-IE-CDE-INT             PIC 9(01)  VALUE ZERO.    03900000
021490     10  PV-RWD-CMNT-LNE-RVRS           PIC X(42)  VALUE SPACES.  03910000
021600     10  PV-RWD-RECEIPT-MSG-LINE        PIC X(85)  VALUE SPACES.  03920000
021800                                                                  03930000
021900   05  PV-DEPT-PROCESSING-VARIABLES.                              03940000
022000     10  PV-DEPT-LIST                   PIC X(24)  VALUE SPACES.  03950000
022200     10  PV-DEPT-FIELD-LENGTH           PIC 9(02)  VALUE ZERO.    03960000
022400     10  PV-DEPT-VAR-1                  PIC 9(04)  VALUE ZERO.    03970000
022600     10  PV-DEPT-VAR-2                  PIC 9(04)  VALUE ZERO.    03980000
022800     10  PV-DEPT-VAR-3                  PIC 9(04)  VALUE ZERO.    03990000
023000     10  PV-DEPT-VAR-4                  PIC 9(04)  VALUE ZERO.    04000000
023200     10  PV-DEPT-VAR-5                  PIC 9(04)  VALUE ZERO.    04010000
023400                                                                  04020000
023500   05  PV-VAR-REC-VARIABLES.                                      04030000
023600     10  PV-VAR-LNGTH                   PIC 9(03)  VALUE ZERO.    04040000
023800     10  PV-SQL-SUB                     PIC 9(01)  VALUE ZERO.    04050000
024000     10  PV-RWD-CHGS-EXIST              PIC X(01)  VALUE SPACE.   04060000
024200     10  PV-RWD-ISD-REC-BYTE-CNT        PIC 9(03)  VALUE ZERO.    04070000
024220     10  PV-WRITE-RECORD-LENGTH         PIC 9(03)  VALUE ZERO.    04080000
024240                                                                  04090000
024250   05  PV-DATE-AND-TIME-VARIABLES.                                04100000
024260     10  PV-CUR-SYS-TMST                PIC X(26)  VALUE SPACE.   04110000
024280     10  PV-CUR-SYS-DATE                PIC X(10)  VALUE SPACE.   04120000
024300     10  PV-MOD-ISUD-BEG-DTE            PIC X(10)  VALUE SPACE.   04130000
024500     10  PV-MOD-ISUD-END-DTE            PIC X(10)  VALUE SPACE.   04140000
024700     10  PV-OPEN-SOON-DATE              PIC X(10)  VALUE SPACE.   04150000
024900     10  PV-CONV-DTE.                                             04160000
025000       15  PV-CONV-DTE-MM               PIC X(02)  VALUE SPACE.   04170000
025200       15  PV-CONV-DTE-DD               PIC X(02)  VALUE SPACE.   04180000
025400       15  PV-CONV-DTE-CCYY             PIC X(04)  VALUE SPACE.   04190000
025600                                                                  04200000
025700   05  PV-COUNTER-VARIABLES.                                      04210000
025800     10  PV-RWD-STR-WRITES              PIC 9(06)  VALUE ZERO.    04220000
025820     10  PV-DEPTS-CT                    PIC 9(01)  VALUE ZERO.    04230000
025840     10  PV-DEPTS-FOUND                 PIC 9(02)  VALUE ZERO.    04240000
025860     10  PV-EVNT-NM-TRLNG               PIC 9(02)  VALUE ZERO.    04250000
025880     10  PV-CMNT-LNE1-TRLNG             PIC 9(02)  VALUE ZERO.    04260000
025900     10  PV-CMNT-LNE2-TRLNG             PIC 9(02)  VALUE ZERO.    04270000
026100     10  PV-COMB-CMNT-LNE-LENGTH        PIC 9(02)  VALUE ZERO.    04280000
026120     10  PV-PAGE-COUNT                  PIC 9(06)  VALUE ZERO.    04290000
026140     10  PV-LINE-COUNT                  PIC 9(06)  VALUE ZERO.    04300000
W36988     10  PV-RWD-EVNTS-COUNT             PIC 9(06)  VALUE ZERO.    04310000
026160                                                                  04320000
026170   05  PV-NULL-INDICATORS.                                        04330000
026180     10  PV-RWD-PRE-DYS-IND             PIC S9(04) VALUE +0 COMP. 04340000
026300       88  PV-PRE-DYS-NULL                         VALUE -1.      04350000
026400     10  PV-RWD-PST-DYS-IND             PIC S9(04) VALUE +0 COMP. 04360000
026700       88  PV-PST-DYS-NULL                         VALUE -1.      04370000
026800     10  PV-RWD-QUA-TOL-IND             PIC S9(04) VALUE +0 COMP. 04380000
027100       88  PV-QUA-TOL-NULL                         VALUE -1.      04390000
027110     10  PV-RWD-RCPT-LNE1-IND           PIC S9(04) VALUE +0 COMP. 04400000
027113       88  PV-RWD-RCPT-LNE1-NULL                   VALUE -1.      04410000
027114     10  PV-RWD-RCPT-LNE2-IND           PIC S9(04) VALUE +0 COMP. 04420000
027117       88  PV-RWD-RCPT-LNE2-NULL                   VALUE -1.      04430000
W36690     10  PV-RWD-DEF-CMNT-LNE1-IND       PIC S9(04) VALUE +0 COMP. 04440000
W36690       88  PV-DEF-CMNT-LNE1-NULL                   VALUE -1.      04450000
W36690     10  PV-RWD-DEF-CMNT-LNE2-IND       PIC S9(04) VALUE +0 COMP. 04460000
W36690       88  PV-DEF-CMNT-LNE2-NULL                   VALUE -1.      04470000
W36690                                                                  04480000
027119   05  PV-ABEND-VARIABLES.                                        04490000
027120     10  PV-PARAGRAPH-NAME              PIC X(30)  VALUE SPACES.  04500000
027140     10  PV-OPERATION-MSG-1             PIC X(40)  VALUE SPACES.  04510000
027160     10  PV-MSG-TEXT                    PIC X(40)  VALUE SPACES.  04520000
027180     10  PV-DB2-OPERATION               PIC X(30)  VALUE SPACES.  04530041
027180     10  PV-ORA-OPERATION               PIC X(30)  VALUE SPACES.  04540041
027200                                                                  04550000
027300*----------------------------------------------------------------*04560000
027400*  RP- REPORT HEADER & DETAIL LINES                               04570000
027500*----------------------------------------------------------------*04580000
027600 01  RP-EP-SYSTEM-ID-LINE.                                        04590000
027700   05  FILLER                           PIC X(53)  VALUE SPACES.  04600000
027900   05  FILLER                           PIC X(25)                 04610000
028000         VALUE 'ENTERPRISE POS MANAGEMENT'.                       04620000
028100   05  FILLER                           PIC X(54)  VALUE SPACES.  04630000
028300                                                                  04640000
028400 01  RP-EP-TITLE-LINE.                                            04650000
028500   05  FILLER                           PIC X(53)  VALUE SPACES.  04660000
028700   05  FILLER                           PIC X(26)                 04670000
028800         VALUE 'REWARDS ACTIVATION SUMMARY'.                      04680000
028900   05  FILLER                           PIC X(53)  VALUE SPACES.  04690000
029100                                                                  04700000
029200 01  RP-EP-STORE-GROUP-LINE.                                      04710000
029300   05  FILLER                           PIC X(02)  VALUE SPACES.  04720000
029500   05  FILLER                           PIC X(12)                 04730000
029600         VALUE 'STORE LOC #:'.                                    04740000
029700   05  FILLER                           PIC X(02)  VALUE SPACES.  04750000
029800                                                                  04760000
029900   05  RP-STORE-LOC-NBR                 PIC X(05).                04770000
030000   05  FILLER                           PIC X(111) VALUE SPACES.  04780000
030200                                                                  04790000
030300 01  RP-EP-HEADER-LINE-A.                                         04800000
030400   05  FILLER                           PIC X(02)  VALUE SPACES.  04810000
030420   05  FILLER                           PIC X(05)                 04820000
030430         VALUE 'EVENT'.                                           04830000
030440   05  FILLER                           PIC X(03)  VALUE SPACES.  04840000
030460   05  FILLER                           PIC X(08)                 04850000
030470         VALUE 'STRT DTE'.                                        04860000
030480   05  FILLER                           PIC X(03)  VALUE SPACES.  04870000
030500   05  FILLER                           PIC X(08)                 04880000
030600         VALUE 'END DATE'.                                        04890000
030700   05  FILLER                           PIC X(03)  VALUE SPACES.  04900000
030900   05  FILLER                           PIC X(04)                 04910000
031000         VALUE 'TNDR'.                                            04920000
031100   05  FILLER                           PIC X(03)  VALUE SPACES.  04930000
031300   05  FILLER                           PIC X(05)                 04940000
031400         VALUE 'PURCH'.                                           04950000
031500   05  FILLER                           PIC X(03)  VALUE SPACES.  04960000
031700   05  FILLER                           PIC X(05)                 04970000
031710         VALUE 'TLNCE'.                                           04980000
031720   05  FILLER                           PIC X(03)  VALUE SPACES.  04990000
031740   05  FILLER                           PIC X(03)                 05000000
031750         VALUE 'MAX'.                                             05010000
031760   05  FILLER                           PIC X(03)  VALUE SPACES.  05020000
031780   05  FILLER                           PIC X(03)                 05030000
031790         VALUE 'I-E'.                                             05040000
031800   05  FILLER                           PIC X(03)  VALUE SPACES.  05050000
032000   05  FILLER                           PIC X(05)                 05060000
032100         VALUE 'VALUE'.                                           05070000
032200   05  FILLER                           PIC X(04)  VALUE SPACES.  05080000
032400   05  FILLER                           PIC X(09)                 05090000
032500         VALUE 'DEPT LIST'.                                       05100000
032600   05  FILLER                           PIC X(16)  VALUE SPACES.  05110000
032800   05  FILLER                           PIC X(10)                 05120000
032900         VALUE 'EVENT NAME'.                                      05130000
033000                                                                  05140000
033100 01  RP-EP-HEADER-LINE-B.                                         05150000
033200   05  FILLER                           PIC X(02)  VALUE SPACES.  05160000
033220   05  FILLER                           PIC X(05)                 05170000
033230         VALUE '====='.                                           05180000
033240   05  FILLER                           PIC X(03)  VALUE SPACES.  05190000
033260   05  FILLER                           PIC X(08)                 05200000
033270         VALUE '========'.                                        05210000
033280   05  FILLER                           PIC X(03)  VALUE SPACES.  05220000
033300   05  FILLER                           PIC X(08)                 05230000
033400         VALUE '========'.                                        05240000
033500   05  FILLER                           PIC X(03)  VALUE SPACES.  05250000
033700   05  FILLER                           PIC X(04)                 05260000
033800         VALUE '===='.                                            05270000
033900   05  FILLER                           PIC X(03)  VALUE SPACES.  05280000
034100   05  FILLER                           PIC X(05)                 05290000
034200         VALUE '====='.                                           05300000
034300   05  FILLER                           PIC X(03)  VALUE SPACES.  05310000
034500   05  FILLER                           PIC X(05)                 05320000
034510         VALUE '====='.                                           05330000
034520   05  FILLER                           PIC X(03)  VALUE SPACES.  05340000
034540   05  FILLER                           PIC X(03)                 05350000
034550         VALUE '==='.                                             05360000
034560   05  FILLER                           PIC X(03)  VALUE SPACES.  05370000
034580   05  FILLER                           PIC X(03)                 05380000
034590         VALUE '==='.                                             05390000
034600   05  FILLER                           PIC X(03)  VALUE SPACES.  05400000
034800   05  FILLER                           PIC X(07)                 05410000
034900         VALUE '======='.                                         05420000
035000   05  FILLER                           PIC X(02)  VALUE SPACES.  05430000
035200   05  FILLER                           PIC X(24)                 05440000
035300         VALUE '========================'.                        05450000
035400   05  FILLER                           PIC X(01)  VALUE SPACES.  05460000
035600   05  FILLER                           PIC X(30)                 05470000
035700         VALUE '=============================='.                  05480000
035800                                                                  05490000
035900 01  RP-EP-DETAIL-LINE.                                           05500000
036000   05  FILLER                           PIC X(02)  VALUE SPACES.  05510000
036020   05  RP-EVENT-ID                      PIC X(05)  VALUE SPACES.  05520000
036040   05  FILLER                           PIC X(03)  VALUE SPACES.  05530000
036060   05  RP-STRT-DTE                      PIC X(08)  VALUE SPACES.  05540000
036080   05  FILLER                           PIC X(03)  VALUE SPACES.  05550000
036100   05  RP-END-DATE                      PIC X(08)  VALUE SPACES.  05560000
036300   05  FILLER                           PIC X(04)  VALUE SPACES.  05570000
036500   05  RP-TNDR-TYP                      PIC 9(03)  VALUE ZERO.    05580086
036700   05  FILLER                           PIC X(03)  VALUE SPACES.  05590086
036900   05  RP-QUAL-AMT                      PIC 9(3)V9(2).            05600000
037000   05  FILLER                           PIC X(03)  VALUE SPACES.  05610000
037020   05  RP-QUAL-TOL                      PIC 9(2)V9(2).            05620000
037030   05  FILLER                           PIC X(04)  VALUE SPACES.  05630000
037050   05  RP-MAX-RWDS                      PIC 9(03)  VALUE ZERO.    05640000
037070   05  FILLER                           PIC X(04)  VALUE SPACES.  05650000
037090   05  RP-I-E-TYP-CDE                   PIC X(01)  VALUE SPACES.  05660000
037200   05  FILLER                           PIC X(04)  VALUE SPACES.  05670000
037400   05  RP-RWD-VALUE                     PIC 9(3)V9(2).            05680000
037500   05  FILLER                           PIC X(02)  VALUE SPACES.  05690000
037700   05  RP-DEPT-LIST                     PIC X(24)  VALUE SPACES.  05700000
037900   05  FILLER                           PIC X(01)  VALUE SPACES.  05710000
038100   05  RP-EVENT-NAME                    PIC X(30)  VALUE SPACES.  05720000
038120                                                                  05730000
       01  WS-MSG-TEXT                        PIC X(512) VALUE SPACES.  05740006
       01  WS-MAX-SIZE                        PIC S9(9) VALUE +512 COMP.05750006
       01  WS-MSG-LENGTH                      PIC S9(9) VALUE ZERO COMP.05760006
038130*----------------------------------------------------------------*05770000
038140*  EXTRACT RECORD LAYOUT - RECORD VARIABLE IDENTIFIERS            05780000
038150*----------------------------------------------------------------*05790000
038160     COPY EPRD139.                                                05800000
038170                                                                  05810000
038180*----------------------------------------------------------------*05820000
038190*  EPCC148 CONTROL CARD LAYOUT - LAST DATE AUKUT015 WAS RAN       05830067
038200*----------------------------------------------------------------*05840000
038300     COPY EPRD148.                                                05850000
038400                                                                  05860000
038500*----------------------------------------------------------------*05870000
038600*  EPCC165 CONTROL CARD LAYOUT - RUN TYPE IDENTIFIER              05880000
038700*----------------------------------------------------------------*05890000
038800     COPY EPRD165.                                                05900000
038900                                                                  05910000
039000*----------------------------------------------------------------*05920000
039100*  EPCC111 CONTROL CARD LAYOUT - CURRENT BATCH DATE               05930000
039200*----------------------------------------------------------------*05940000
039300     COPY EPRD111.                                                05950000
039400                                                                  05960000
039500*----------------------------------------------------------------*05970000
039600*  EPCC045 CONTROL CARD LAYOUT - ADV. DAYS AHEAD OF STORE OPEN    05980000
039700*----------------------------------------------------------------*05990000
039800     COPY EPRD045.                                                06000000
039900                                                                  06010000
040000*----------------------------------------------------------------*06020000
040100*  DATE ROUTINE COPYBOOK                                          06030000
040200*----------------------------------------------------------------*06040000
040300     COPY DPWS500.                                                06050000
040400                                                                  06060000
040500*----------------------------------------------------------------*06070000
040600*  REPORT HEADER FOR A 200 COLUMN REPORT                          06080000
040700*----------------------------------------------------------------*06090000
040800     COPY DPWS200O.                                               06100000
040900                                                                  06110000
041000*----------------------------------------------------------------*06120000
041100*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        06130000
041200*----------------------------------------------------------------*06140000
041300     COPY DPWS004.                                                06150000
041400                                                                  06160000
041500*----------------------------------------------------------------*06170000
041600*  DB2 ABEND COPYBOOK                                             06180000
041700*----------------------------------------------------------------*06190000
041800     COPY DPWS900.                                                06200000
041900                                                                  06210000
042000*----------------------------------------------------------------*06220000
042100*  DB2 MESSAGE AREA                                               06230000
042200*----------------------------------------------------------------*06240000
042300     COPY SQLCA2.                                                 06250036
042400                                                                  06260000
      *----------------------------------------------------------------*06270048
      * ORACLE DELARE SECTION START                                    *06280048
      *----------------------------------------------------------------*06290048
           EXEC SQL                                                     06300048
              BEGIN DECLARE SECTION                                     06310048
           END-EXEC.                                                    06320048
                                                                        06330048
042500*----------------------------------------------------------------*06340000
042600*  DB2 COMMUNICATIONS AREA                                        06350000
042700*----------------------------------------------------------------*06360000
042800     EXEC SQL                                                     06370042
042900       INCLUDE SQLCA                                              06380042
043000     END-EXEC.                                                    06390042
043100                                                                  06400000
      *----------------------------------------------------------------*06410000
      * PD- ORA VARIABLES (NON DCLGEN)                                 *06420000
      *----------------------------------------------------------------*06430000
       01  USERNAME                      PIC X(10)  VARYING.            06440000
       01  PASSWD                        PIC X(10)  VARYING.            06450000
                                                                        06460000
043200*----------------------------------------------------------------*06470000
043300*  DB2 TABLE XST_LOC - STORE LOCATION TABLE                       06480000
043400*----------------------------------------------------------------*06490000
043500     EXEC SQL                                                     06500003
043600         INCLUDE XST00001                                         06510003
043700     END-EXEC.                                                    06520003
043800                                                                  06530000
043900*----------------------------------------------------------------*06540000
044000*  DB2 TABLE XST_LOC_ATTR - LOCATION ATTRIBUTE TABLE              06550000
044100*----------------------------------------------------------------*06560000
044200     EXEC SQL                                                     06570003
044300          INCLUDE XST00025                                        06580003
044400     END-EXEC.                                                    06590003
044500                                                                  06600000
044600*----------------------------------------------------------------*06610000
044700*  DB2 TABLE XST_STR_GP_MBSHP - STORE GROUP MEMBERSHIP TABLE      06620000
044800*----------------------------------------------------------------*06630000
044900                                                                  06640000
045000     EXEC SQL                                                     06650003
045100         INCLUDE XST00023                                         06660003
045200     END-EXEC.                                                    06670003
045300                                                                  06680000
045400                                                                  06690000
045500*----------------------------------------------------------------*06700000
045600*  ORA TABLE AUT_RWD_EVNT - MAIN REWARD EVENT TABLE               06710085
045700*----------------------------------------------------------------*06720000
045800     EXEC SQL                                                     06730000
045900       INCLUDE AUT00001                                           06740000
046000     END-EXEC.                                                    06750000
046100                                                                  06760000
046200*----------------------------------------------------------------*06770000
046300*  ORA TABLE AUT_RWD_ISUD - REWARD ISSUED TABLE                   06780085
046400*----------------------------------------------------------------*06790000
046500     EXEC SQL                                                     06800000
046600       INCLUDE AUT00002                                           06810000
046700     END-EXEC.                                                    06820000
046800                                                                  06830000
046900*----------------------------------------------------------------*06840000
047000*  ORA TABLE AUT_RWD_ISUD_MDSE - REWARD ISSUED MERCHANDISE TABLE  06850085
047100*----------------------------------------------------------------*06860000
047200     EXEC SQL                                                     06870000
047300       INCLUDE AUT00003                                           06880000
047400     END-EXEC.                                                    06890000
047500                                                                  06900000
      *----------------------------------------------------------------*06910085
      *  ORA TABLE AUT_RWD_REDM_RETD - REWARD REDEEM RETURNED TABLE     06920085
      *----------------------------------------------------------------*06930085
           EXEC SQL                                                     06940085
             INCLUDE AUT00015                                           06950085
           END-EXEC.                                                    06960085
                                                                        06970085
047600*----------------------------------------------------------------*06980000
047700*  DB2 AREA FOR SYSDUMMY                                          06990000
047800*----------------------------------------------------------------*07000000
047900***  EXEC SQL                                                     07010057
048000***    INCLUDE SYSDUMMY                                           07020057
048100***  END-EXEC.                                                    07030057
048200                                                                  07040000
      *----------------------------------------------------------------*07050000
      * ORACLE END OF DECLARATIVE SECTION                              *07060000
      *----------------------------------------------------------------*07070000
           EXEC SQL                                                     07080042
             END DECLARE SECTION                                        07090042
           END-EXEC.                                                    07100042
                                                                        07110000
      *----------------------------------------------------------------*07120000
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        *07130000
      *----------------------------------------------------------------*07140000
      *    COPY DPWS004.                                                07150039
      *                                                                 07160039
      *----------------------------------------------------------------*07170000
      * ORA ABEND COPYBOOK                                             *07180000
      *----------------------------------------------------------------*07190000
           COPY DPWS900.                                                07200000
048300*----------------------------------------------------------------*07210000
048400*  REWARD EVENT CURSOR                                            07220000
048500*  - PULLS IN ALL REWARD EVENTS WHICH HAVE AN END DATE WITHIN     07230000
048600*    THE PAST 18 MONTHS. IMPLEMENTED TO REDUCE FILE SIZE IN THE   07240000
048700*    PARAM FILES THEMSELVES. ALSO USED TO HELP POPULATE DEFAULT   07250000
048800*    ROW PRINTS FOR STORES NOT ACTUALLY IN A GIVEN REWARD EVENT.  07260000
049000*----------------------------------------------------------------*07270000
049100     EXEC SQL                                                     07280014
049200       DECLARE RWD_EVNT_CSR CURSOR FOR                            07290033
049300         SELECT DISTINCT                                          07300014
049400                EVNT.RWD_EVNT_ID                                  07310014
049500               ,MAX(ISUD.QUALD_PRCH_AMT)                          07320014
049600               ,MAX(ISUD.QUALD_TOL_AMT)                           07330014
049610               ,MIN(MAX_RWD_QTY)                                  07340014
049620               ,MIN(EVNT.RWD_DISC_AMT)                            07350014
049630               ,MIN(EVNT.RWD_EVNT_NM)                             07360095
W36690               ,MAX(ISUD.TNDR_TYP_CDE)                            07370014
W36690               ,MAX(ISUD.MDSE_IE_CDE)                             07380014
W36690               ,MAX(ISUD.RCPT_CMNT_LNE1_TXT)                      07390014
W36690               ,MAX(ISUD.RCPT_CMNT_LNE2_TXT)                      07400014
049640         FROM  AUT_RWD_EVNT     EVNT                              07410014
049641              ,AUT_RWD_ISUD     ISUD                              07420014
049642         WHERE EVNT.RWD_EVNT_ID  = ISUD.RWD_EVNT_ID               07430049
062309           AND ISUD.ISUD_END_DTE >=                               07440060
                          TO_DATE(:PV-END-DATE,'YYYY-MM-DD')            07450051
049644           AND EVNT.STAT_CDE    IN ('S')                          07460051
                 AND ISUD.STAT_CDE    IN ('S')                          07470051
               GROUP BY EVNT.RWD_EVNT_ID                                07480049
               ORDER BY EVNT.RWD_EVNT_ID                                07490093
           END-EXEC.                                                    07500014
049660*                                                                 07510010
049670*----------------------------------------------------------------*07520000
049680*  STORE LOCATION CURSOR                                          07530000
049690*  - PULLS IN ALL STORE LOCATIONS OPEN NOW OR WHICH WILL BE       07540000
049700*    OPENING IN THE NEAR FUTURE AS DICTATED BY EPCC045.           07550000
049800*----------------------------------------------------------------*07560000
049900     EXEC SQL                                                     07570066
050000       DECLARE STR_LOC_CSR CURSOR FOR                             07580066
050100         SELECT LOCN.LOC_NBR                                      07590066
050200         FROM   XST_LOC      LOCN                                 07600066
050300               ,XST_LOC_ATTR ATTR                                 07610066
050400         WHERE  LOCN.LOC_TYP_CDE = 'DS'                           07620066
050500           AND  LOCN.LOC_NBR     = ATTR.LOC_NBR                   07630066
050600           AND  (                                                 07640066
050700                 LOCN.OPN_DTE <=                                  07650066
                            TO_DATE(:PV-CUR-SYS-DATE,'YYYY-MM-DD')      07660066
050800                  AND LOCN.CLO_DTE >=                             07670066
                            TO_DATE(:PV-CUR-SYS-DATE,'YYYY-MM-DD')      07680066
050810                 OR                                               07690066
050820                 LOCN.OPN_DTE <=                                  07700066
                            TO_DATE(:PV-OPEN-SOON-DATE,'YYYY-MM-DD')    07710066
050830                  AND LOCN.CLO_DTE >=                             07720066
                            TO_DATE(:PV-OPEN-SOON-DATE,'YYYY-MM-DD')    07730066
050840                )                                                 07740066
050850           AND  (ATTR.POS_CAP_LVL_ID    = 5                       07750066
050860                 OR ATTR.POS_CAP_LVL_ID > 14)                     07760066
050870         ORDER BY LOCN.LOC_NBR                                    07770066
050900     END-EXEC.                                                    07780066
051000*                                                                 07790000
051100*----------------------------------------------------------------*07800000
051200*  REWARD ISSUED EVENT CURSOR                                     07810000
051300*  - RETURNS THE REWARD ACTIVATION INFORMATION FOR ALL REWARDS    07820000
051400*    EVENTS FOR A PARTICULAR STORE LOCATION NUMBER.               07830000
051500*----------------------------------------------------------------*07840000
051600     EXEC SQL                                                     07850000
051700       DECLARE RWD_ISUD_EVNT_CSR CURSOR FOR                       07860007
051800         SELECT EVNT.RWD_EVNT_ID                                  07870000
051900               ,NVL(EVNT.RWD_DISC_AMT,0)                          07880078
052000               ,NVL(EVNT.RWD_TYP_CDE,' ')                         07890078
052100               ,NVL(EVNT.RWD_EVNT_NM,' ')                         07900078
052200               ,NVL(EVNT.LAST_UPD_BY_USR_ID,' ')                  07910078
052300               ,ISUD.STR_GP_TYP_CDE                               07920000
052400               ,ISUD.STR_GP_ID                                    07930000
052500               ,ISUD.ISUD_BEG_DTE                                 07940064
052600               ,ISUD.ISUD_END_DTE                                 07950064
052700               ,NVL(ISUD.PRE_BEG_DAYS_QTY,0)                      07960078
052800               ,NVL(ISUD.POST_END_DAYS_QTY,0)                     07970078
052900               ,NVL(ISUD.TNDR_TYP_CDE,0)                          07980079
053000               ,NVL(ISUD.QUALD_PRCH_AMT,0)                        07990078
053100               ,NVL(ISUD.QUALD_TOL_AMT,0)                         08000078
053200               ,NVL(ISUD.MAX_RWD_QTY,0)                           08010078
053300               ,NVL(ISUD.MDSE_IE_CDE,0)                           08020079
053400               ,NVL(ISUD.LAST_UPD_BY_USR_ID,' ')                  08030078
053500               ,NVL(ISUD.RCPT_CMNT_LNE1_TXT,' ')                  08040078
053600               ,NVL(ISUD.RCPT_CMNT_LNE2_TXT,' ')                  08050078
053700         FROM  AUT_RWD_EVNT     EVNT                              08060000
053800              ,AUT_RWD_ISUD     ISUD                              08070000
053900              ,XST_STR_GP_MBSHP MBSHP                             08080054
054000         WHERE EVNT.RWD_EVNT_ID    = ISUD.RWD_EVNT_ID             08090049
054100           AND EVNT.STAT_CDE      IN ('S')                        08100049
054200           AND ISUD.STAT_CDE      IN ('S')                        08110049
062309           AND ISUD_END_DTE       >=                              08120098
                                      TO_DATE(:PV-END-DATE,'YYYY-MM-DD')08130098
054400           AND MBSHP.STR_NBR       = :DCLXST00001.XST00001-LOC-NBR08140054
054500           AND ISUD.STR_GP_TYP_CDE = MBSHP.STR_GP_TYP_CDE         08150049
054600           AND ISUD.STR_GP_ID      = MBSHP.STR_GP_ID              08160049
054700           AND MBSHP.EFF_BEG_DTE  <=                              08170064
                                  TO_DATE(:PV-CUR-SYS-DATE,'YYYY-MM-DD')08180064
054800           AND (MBSHP.EFF_END_DTE  >=                             08190064
                                  TO_DATE(:PV-CUR-SYS-DATE,'YYYY-MM-DD')08200064
054900                OR MBSHP.EFF_END_DTE IS NULL)                     08210049
055000         ORDER BY EVNT.RWD_EVNT_ID                                08220049
055100                 ,ISUD.STR_SELN_HIER_CDE DESC                     08230049
055400     END-EXEC.                                                    08240000
055500                                                                  08250000
055600*----------------------------------------------------------------*08260000
055700*  INCLUDE / EXCLUDE DEPTS CURSOR                                 08270000
055800*  - SELECTS ALL DEPARTMENTS EITHER INCLUDED OR EXCLUDED IN THE   08280000
055900*    SELECTED SALES REWARD EVENT. MAY RETURN UP TO 5 DEPTS.       08290000
056000*----------------------------------------------------------------*08300000
056100     EXEC SQL                                                     08310000
056200       DECLARE I_E_MDSE_DEPT_CSR CURSOR FOR                       08320007
056300         SELECT MDSE.DEPT_NBR                                     08330000
056400         FROM   AUT_RWD_ISUD_MDSE MDSE                            08340000
056500         WHERE MDSE.RWD_EVNT_ID    = :AUT00001.RWD-EVNT-ID        08350049
056600           AND MDSE.STR_GP_TYP_CDE = :AUT00002.STR-GP-TYP-CDE     08360049
056700           AND MDSE.STR_GP_ID      = :AUT00002.STR-GP-ID          08370049
056800           AND MDSE.STAT_CDE       = 'S'                          08380049
056900         ORDER BY MDSE.DEPT_NBR                                   08390049
057200     END-EXEC.                                                    08400000
                                                                        08410000
W36690*----------------------------------------------------------------*08420000
W36690*  DEFAULT ROW INCLUDE / EXCLUDE DEPTS CURSOR                     08430000
W36690*  - SELECTS ALL DEPARTMENTS EITHER INCLUDED OR EXCLUDED IN THE   08440000
W36690*    SELECTED SALES REWARD EVENT AT A GENERIC LEVEL.              08450000
W36690*----------------------------------------------------------------*08460000
W36690     EXEC SQL                                                     08470000
W36690       DECLARE I_E_DEPT_DFLT_CSR CURSOR FOR                       08480007
W36690         SELECT DISTINCT MDSE.DEPT_NBR                            08490000
W36690         FROM   AUT_RWD_ISUD_MDSE MDSE                            08500000
W36690         WHERE MDSE.RWD_EVNT_ID    = :PV-RWD-EVNT-ID              08510049
W36690           AND MDSE.STAT_CDE       = 'S'                          08520049
W36690         ORDER BY MDSE.DEPT_NBR                                   08530049
W36690     END-EXEC.                                                    08540000
057300                                                                  08550000
      *----------------------------------------------------------------*08560099
      *  DIGITAL KOHLS CASH                                             08570099
W36690*  - SELECTS ALL DEPARTMENTS EITHER INCLUDED OR EXCLUDED IN THE   08580099
W36690*    SELECTED SALES REWARD EVENT AT A GENERIC LEVEL.              08590099
W36690*----------------------------------------------------------------*08600099
           EXEC SQL                                                     08610099
                DECLARE  REWARD_REDM_RETD CURSOR FOR                    08620099
                                                                        08630099
                 SELECT  RWD_EVNT_ID                                    08640099
                      ,  STR_GP_TYP_CDE                                 08650099
                      ,  STR_GP_ID                                      08660099
                      ,  REDM_BEG_DTE                                   08670099
                      ,  REDM_END_DTE                                   08680099
                                                                        08690099
                   FROM  AUT_RWD_REDM_RETD RETD                         08700099
                                                                        08710099
                  WHERE  RWD_EVNT_ID    = :AUT00015.RWD-EVNT-ID         08720099
                    AND  STR_GP_TYP_CDE = :AUT00015.STR-GP-TYP-CDE      08730099
                    AND  STR_GP_ID      = :AUT00015.STR-GP-ID           08740099
           END-EXEC.                                                    08750099
057300                                                                  08760099
057400*----------------------------------------------------------------*08770000
057500                                                                  08780000
057600 LINKAGE SECTION.                                                 08790000
057700                                                                  08800000
057800*----------------------------------------------------------------*08810000
057900 PROCEDURE DIVISION.                                              08820000
058000*----------------------------------------------------------------*08830000
058100 0000-MAINLINE.                                                   08840000
058200                                                                  08850000
058300     PERFORM 1000-INITIALIZATION.                                 08860000
058400                                                                  08870000
058500     IF PS-EXTRACT-DATA                                           08880000
058600       PERFORM 2000-PROCESS-STR-EVENTS                            08890000
058700     END-IF.                                                      08900000
058800                                                                  08910000
058900     PERFORM 9999-WRAPUP.                                         08920000
059000                                                                  08930000
059100     GOBACK.                                                      08940000
059200                                                                  08950000
059300*0000-EXIT.                                                       08960000
059500                                                                  08970000
059600*----------------------------------------------------------------*08980000
059700*  1000-INITIALIZATION.                                           08990000
059800*  - OPENS INPUT & OUTPUT FILES, READS THROUGH ALL THE CONTROL    09000000
059900*    CARDS, AND SETS UP ALL THE INITIAL TIMESTAMP VALUES.         09010000
060000*----------------------------------------------------------------*09020000
060100 1000-INITIALIZATION.                                             09030000
060200                                                                  09040000
060300     DISPLAY '*-----------------------------------*'.             09050000
060400     DISPLAY '*         AUKUT015 - REWARDS        *'.             09060067
060500     DISPLAY '*         ACTIVATION EXTRACT        *'.             09070000
060600     DISPLAY '*-----------------------------------*'.             09080000
060700     DISPLAY ' '.                                                 09090000
060800                                                                  09100000
060900     OPEN INPUT CTRL-CRD-PGM-LAST-RUN                             09110000
061000                CTRL-CRD-IDENT-TYP                                09120000
061100                CTRL-CRD-CUR-BTCH-DTE                             09130000
061200                CTRL-CRD-ADV-OPN-DAYS                             09140000
                      CONTROL-CARD-ORACLE-LOGIN.                        09150003
061300                                                                  09160000
061400     OPEN OUTPUT RWD-ISUD-EXTRCT-FLE                              09170000
061500                 RWD-ISUD-EXTRCT-RPT.                             09180000
061600                                                                  09190000
           PERFORM 1050-SETUP-FOR-ORACLE.                               09200068
061700     PERFORM 1100-GET-CURRENT-SYSTEM-TMST.                        09210000
061900     PERFORM 1200-READ-PGM-LAST-RUN-CARD.                         09220000
062000     PERFORM 1300-READ-CUR-BTCH-DTE-CARD.                         09230000
062100     PERFORM 1400-PROCESS-IDENT-TYP-CARD.                         09240000
W36988     IF PS-EXTRACT-DATA                                           09250000
062200        PERFORM 1500-READ-DAYS-TILL-STR-OPN-CD                    09260000
062400        PERFORM 1600-INCR-CUR-OPEN-DTE                            09270000
062600        PERFORM 1700-LOAD-VALID-EVNT-IDS                          09280000
062800        PERFORM 1800-INIT-EP-SELF-REPORTING                       09290000
W36988                                                                  09300000
W36988        EVALUATE TRUE                                             09310000
W36988           WHEN PV-RWD-EVNTS-COUNT >= PC-FILE-COUNT-LIMIT-ABEND   09320000
W36988              DISPLAY '** PASSED ABEND LIMIT THRESHOLD !!    **'  09330000
W36988              DISPLAY '** ABENDING DUE TO EVENT RECORD COUNT **'  09340000
W36988              DISPLAY '** REWARD EVENT COUNT: ' PV-RWD-EVNTS-COUNT09350000
W36988              MOVE '1000-INITIALIZATION'     TO PV-PARAGRAPH-NAME 09360000
W36988              MOVE 'DO NOT SEND FILE TO STR' TO PV-OPERATION-MSG-109370000
W36988              MOVE 'WILL CAUSE REGS TO GPF!' TO PV-MSG-TEXT       09380000
W36988              SET ABEND-4444-FORCED-ABEND TO TRUE                 09390000
W36988              PERFORM 9010-ABEND                                  09400000
W36988           WHEN PV-RWD-EVNTS-COUNT >= PC-FILE-COUNT-LIMIT-EMAIL   09410000
W36988              DISPLAY '** PASSED EMAIL THRESHOLD, SETTING RC04 **'09420000
W36988              SET PS-SET-EMAIL-RC TO TRUE                         09430000
W36988           WHEN OTHER                                             09440000
W36988              DISPLAY '** ACTIVATE FILE REWARD EVENTS COUNT OK **'09450000
W36988        END-EVALUATE                                              09460000
W36988     END-IF.                                                      09470000
062900                                                                  09480000
063000*1000-EXIT.                                                       09490000
063200                                                                  09500000
      ******************************************************************09510068
      *   1050-SETUP-FOR-ORACLE.                                       *09520068
      *     SET UP TO CONNECT TO THE ORACLE DATABASE.                  *09530068
      ******************************************************************09540068
       1050-SETUP-FOR-ORACLE.                                           09550068
           MOVE '1050-SETUP-FOR-ORACLE          ' TO  PV-PARAGRAPH-NAME.09560068
      *                                                                 09570068
           READ CONTROL-CARD-ORACLE-LOGIN INTO CC-ORACLE-CONNECTION.    09580068
                                                                        09590068
            IF CC-AUTO-LOGON                                            09600068
               DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'        09610068
               EXEC SQL                                                 09620068
                    CONNECT :PC-AUTO-LOGON                              09630068
               END-EXEC                                                 09640068
            ELSE                                                        09650068
               INITIALIZE PV-ORACLE-USERID-LEN                          09660068
                          PV-ORACLE-PASSWORD-LEN                        09670068
               INSPECT CC-ORACLE-USERID                                 09680068
                       TALLYING PV-ORACLE-USERID-LEN                    09690068
                       FOR CHARACTERS BEFORE INITIAL SPACE              09700068
               INSPECT CC-ORACLE-PASSWORD                               09710068
                       TALLYING PV-ORACLE-PASSWORD-LEN                  09720068
                       FOR CHARACTERS BEFORE INITIAL SPACE              09730068
               MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO    09740068
                       USERNAME-ARR                                     09750068
               MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN             09760068
               MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    09770068
                       PASSWD-ARR                                       09780068
               MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN               09790068
               MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    09800068
                    PASSWD-ARR                                          09810068
               MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN               09820068
               MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN)     TO    09830068
                    USERNAME-ARR                                        09840068
               MOVE PV-ORACLE-USERID-LEN    TO USERNAME-LEN             09850068
               MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    09860068
                    PASSWD-ARR                                          09870068
               MOVE PV-ORACLE-PASSWORD-LEN  TO PASSWD-LEN               09880068
               DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER '   09890068
                    USERNAME-ARR                                        09900068
               EXEC SQL                                                 09910068
                    CONNECT :USERNAME IDENTIFIED BY :PASSWD             09920068
               END-EXEC                                                 09930068
               INITIALIZE CC-ORACLE-PASSWORD                            09940068
                          PASSWD                                        09950068
            END-IF.                                                     09960068
                                                                        09970068
            IF (SQLCODE NOT = 0)                                        09980068
                MOVE 'CONNECT TO ORACLE DATABASE'                       09990068
                                           TO PV-ORA-OPERATION          10000068
                PERFORM 9900-ORA-ERROR                                  10010068
            END-IF.                                                     10020068
                                                                        10030068
      *1050-EXIT.                                                       10040068
063300*----------------------------------------------------------------*10050000
063400*  1100-GET-CURRENT-SYSTEM-TMST.                                  10060000
063500*  - RETREIVE THE CURRENT SYSTEM TIMESTAMP. THIS WILL BE USED     10070000
063600*    LATER TO IDENTIFY ANY UPDATES WHICH WOULD NEED TO TRIGGER A  10080000
063700*    NEW EXTRACT CREATION.  IT WILL ALSO BE USED TO UPDATE        10090000
063800*    EPCC148 ON PROGRAM EXIT TO MARK THE LAST RUN OF THIS         10100000
063900*    PROGRAM.                                                     10110000
064000*----------------------------------------------------------------*10120000
064100 1100-GET-CURRENT-SYSTEM-TMST.                                    10130000
064200                                                                  10140000
             EXEC SQL                                                   10150017
                ALTER SESSION                                           10160017
                  SET NLS_DATE_FORMAT = 'YYYY-MM-DD.HH24.MI.SS'         10170017
             END-EXEC.                                                  10180017
                                                                        10190017
064600                                                                  10200000
           EXEC SQL                                                     10210075
             SELECT TO_CHAR(CURRENT_TIMESTAMP,'YYYY-MM-DD HH24:MI:SS')  10220074
               INTO :PV-CUR-SYS-TMST                                    10230074
               FROM DUAL                                                10240074
064500     END-EXEC.                                                    10250074
064600                                                                  10260074
064700     MOVE PV-CUR-SYS-TMST(1:10) TO PV-CUR-SYS-DATE.               10270075
064800     DISPLAY '** CURRENT SYSTEM TIMESTAMP = ' PV-CUR-SYS-TMST.    10280074
064900     DISPLAY ' '.                                                 10290074
065000                                                                  10300074
065100     IF SQLCODE NOT EQUAL ZERO                                    10310000
065200       MOVE 'GET CURRENT TIMESTAMP'         TO PV-ORA-OPERATION   10320000
065300       MOVE '1100-GET-CURRENT-SYSTEM-TMST'  TO PV-PARAGRAPH-NAME  10330000
065400       PERFORM 9900-ORA-ERROR                                     10340000
065500     END-IF.                                                      10350000
                                                                        10360033
           EXEC SQL                                                     10370033
             SELECT ADD_MONTHS(CURRENT_DATE,-18)                        10380033
               INTO :PV-EDIT-DATE                                       10390033
               FROM DUAL                                                10400033
           END-EXEC.                                                    10410033
                                                                        10420033
           MOVE PV-EDIT-DATE (1:10) TO PV-END-DATE.                     10430033
           DISPLAY '** END DATE IS = ' PV-END-DATE.                     10440033
           DISPLAY ' '.                                                 10450033
065600                                                                  10460000
065700*1100-EXIT.                                                       10470000
065900                                                                  10480000
066000*----------------------------------------------------------------*10490000
066100*  1200-READ-PGM-LAST-RUN-CARD.                                   10500000
066200*  - READ CONTROL CARD EPCC148. THIS CONTROL CARD CONTAINS THE    10510000
066300*    TIMESTAMP FROM THE LAST RUN OF AUKUT015                      10520067
066400*----------------------------------------------------------------*10530000
066500 1200-READ-PGM-LAST-RUN-CARD.                                     10540000
066600                                                                  10550000
066700     READ CTRL-CRD-PGM-LAST-RUN                                   10560000
066800       INTO EP148-CC-CONTROL-CARD                                 10570000
066900         AT END                                                   10580000
067000           SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                   10590000
067100                                                                  10600000
067200     IF PS-END-OF-CNTL-CRD-FILE                                   10610000
067300       MOVE '1200-READ-PGM-LAST-RUN-CARD' TO PV-PARAGRAPH-NAME    10620000
067400       MOVE 'ATTEMPTING TO READ CTRL CRD' TO PV-OPERATION-MSG-1   10630000
067500       MOVE 'EMPTY CONTROL CARD !       ' TO PV-MSG-TEXT          10640000
067600       SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                     10650000
067700       PERFORM 9010-ABEND                                         10660000
067800     ELSE                                                         10670000
067900       DISPLAY '** PROGRAM LAST RUN CONTROL CARD |FS = '          10680000
068000                   FS-CTRL-CRD-PGM-LAST-RUN ' **'                 10690000
068100       DISPLAY '** EPCC148     **  =' EP148-CC-PREV-ACT-CUTOFF    10700000
068200       DISPLAY ' '                                                10710000
068300     END-IF.                                                      10720000
068400                                                                  10730000
068500*1200-EXIT.                                                       10740000
068700                                                                  10750000
068800*----------------------------------------------------------------*10760000
068900* 1300-READ-CUR-BTCH-DTE-CARD.                                    10770000
069000*     READ CONTROL CARD EPCC111. THIS CONTROL CARD CONTAINS THE   10780000
069100*     CURRENT BATCH DATE.                                         10790000
069200*----------------------------------------------------------------*10800000
069300 1300-READ-CUR-BTCH-DTE-CARD.                                     10810000
069400                                                                  10820000
069500     READ CTRL-CRD-CUR-BTCH-DTE                                   10830000
069600       INTO EP111-CC-CONTROL-CARD                                 10840000
069700         AT END                                                   10850000
069800           SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                   10860000
069900                                                                  10870000
070000     IF PS-END-OF-CNTL-CRD-FILE                                   10880000
070100       MOVE '1300-READ-CUR-BTCH-DTE-CARD' TO PV-PARAGRAPH-NAME    10890000
070200       MOVE 'ATTEMPTING TO READ CTRL CRD' TO PV-OPERATION-MSG-1   10900000
070300       MOVE 'EMPTY CONTROL CARD !       ' TO PV-MSG-TEXT          10910000
070400       SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                     10920000
070500       PERFORM 9010-ABEND                                         10930000
070600     ELSE                                                         10940000
070700       DISPLAY '** CURRENT BATCH DATE CTRL CARD  |FS = '          10950000
070800                   FS-CTRL-CRD-CUR-BTCH-DTE ' **'                 10960000
070900       DISPLAY '** EPCC111     **  =' EP111-CC-CRNT-DTE           10970000
071000       DISPLAY ' '                                                10980000
071100     END-IF.                                                      10990000
071200                                                                  11000000
071300*1300-EXIT.                                                       11010000
071500                                                                  11020000
071600*----------------------------------------------------------------*11030000
071700*  1400-PROCESS-IDENT-TYP-CARD.                                   11040000
071800*  - PERFORM THE ROUTINES TO EVALUATE WHAT TYPE OF BATCH JOB RUN  11050000
071900*    IS EXECUTING ("CHECK FOR UPDATES" OR "AUTOMATIC EXTRACT"),   11060000
072000*    AND DETERMINE IF THE DATA EXTRACT SHOULD BE PERFORMED.       11070000
072100*----------------------------------------------------------------*11080000
072200 1400-PROCESS-IDENT-TYP-CARD.                                     11090000
072300                                                                  11100000
072400     PERFORM 1410-READ-IDENT-TYP-CRD.                             11110000
072500                                                                  11120000
072600     EVALUATE TRUE                                                11130000
072700       WHEN EP165-CC-CHK-FOR-UPDATES                              11140000
072800         PERFORM 1420-CHK-FOR-RWD-EVENT-CHGS                      11150000
072900         IF PS-EXTRACT-DATA                                       11160000
073000           DISPLAY '** CHANGES FOUND **'                          11170000
073100         ELSE                                                     11180000
073200           DISPLAY '** NO CHANGES FOUND **'                       11190000
073300         END-IF                                                   11200000
073400                                                                  11210000
073500       WHEN EP165-CC-AUTO-EXTRACT                                 11220000
073600         SET PS-EXTRACT-DATA TO TRUE                              11230000
073700         DISPLAY '** SCHEDULED EXTRACT **'                        11240000
073800                                                                  11250000
073900       WHEN OTHER                                                 11260000
074000         MOVE '1400-PROCESS-IDENT-TYP-CARD'                       11270000
074100          TO PV-PARAGRAPH-NAME                                    11280000
074200         MOVE 'INVALID VALUE IN CTRL CD' TO PV-MSG-TEXT           11290000
074300         SET ABEND-4003-CTRL-CARD-ERROR  TO TRUE                  11300000
074400         PERFORM 9010-ABEND                                       11310000
074500     END-EVALUATE.                                                11320000
074600                                                                  11330000
074700*1400-EXIT.                                                       11340000
074900                                                                  11350000
075000*----------------------------------------------------------------*11360000
075100*  1410-READ-IDENT-TYP-CRD.                                       11370000
075200*  - READ CONTROL CARD EPCC149. THIS CONTROL CARD CONTAINS THE    11380000
075300*    BATCH JOB RUN TYPE.                                          11390000
075400*----------------------------------------------------------------*11400000
075500 1410-READ-IDENT-TYP-CRD.                                         11410000
075600                                                                  11420000
075700     READ CTRL-CRD-IDENT-TYP                                      11430000
075800       INTO EP165-CC-CONTROL-CARD                                 11440000
075900         AT END                                                   11450000
076000           SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                   11460000
076100                                                                  11470000
076200     IF PS-END-OF-CNTL-CRD-FILE                                   11480000
076300       MOVE '1410-READ-IDENT-TYP-CRD    ' TO PV-PARAGRAPH-NAME    11490000
076400       MOVE 'ATTEMPTING TO READ CTRL CRD' TO PV-OPERATION-MSG-1   11500000
076500       MOVE 'EMPTY CONTROL CARD !       ' TO PV-MSG-TEXT          11510000
076600       SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                     11520000
076700       PERFORM 9010-ABEND                                         11530000
076800     ELSE                                                         11540000
076900       DISPLAY '** JOB RUN TYPE ID CONTROL CARD  |FS = '          11550000
077000                   FS-CTRL-CRD-IDENT-TYP ' **'                    11560000
077100       DISPLAY '** EPCC165     **  =' EP165-CC-JOB-RUN-TYP        11570000
077200       DISPLAY ' '                                                11580000
077300     END-IF.                                                      11590000
077400                                                                  11600000
077500*1410-EXIT.                                                       11610000
077700                                                                  11620000
077800*----------------------------------------------------------------*11630000
077900*  1420-CHK-FOR-RWD-EVENT-CHGS.                                   11640000
078000*  - CHECK IF ANY CHANGES HAVE OCCURRED TO THE REWARD EVENT       11650000
078100*    OR REWARD ISSUANCE INFORMATION SINCE THE LAST TIME THIS      11660000
078200*    PROGRAM RAN.                                                 11670000
078300*----------------------------------------------------------------*11680000
078400 1420-CHK-FOR-RWD-EVENT-CHGS.                                     11690000
078500                                                                  11700000
078600     PERFORM                                                      11710060
078700       WITH TEST AFTER                                            11720060
078710       VARYING PV-SQL-SUB                                         11730060
078720       FROM 1 BY 1                                                11740060
078721       UNTIL (PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES               11750060
078722              OR  SQLCODE = +0                                    11760060
078723              OR  SQLCODE = +100                                  11770071
                    OR  SQLCODE = +1403)                                11780071
078724                                                                  11790060
078725         EXEC SQL                                                 11800060
078726           SELECT '1'                                             11810064
078727           INTO :PV-RWD-CHGS-EXIST                                11820063
078728           FROM AUT_RWD_EVNT                                      11830060
078729           WHERE LAST_UPD_TMST BETWEEN                            11840061
                       TO_TIMESTAMP(:EP148-CC-PREV-ACT-CUTOFF,          11850061
                                'YYYY-MM-DD HH24:MI:SS.FF') AND         11860061
078730                 TO_TIMESTAMP(:PV-CUR-SYS-TMST,                   11870061
                                'YYYY-MM-DD HH24:MI:SS.FF')             11880061
078731             AND RWD_EVNT_ID IN                                   11890060
078732                           (SELECT RWD_EVNT_ID                    11900060
078733                            FROM AUT_RWD_ISUD                     11910060
061306                            WHERE                                 11920060
                                     ISUD_BEG_DTE >=                    11930060
                                     TO_DATE('2005-11-30','YYYY-MM-DD'))11940061
078735                                                                  11950060
078736           UNION                                                  11960065
078737                                                                  11970065
078738           SELECT '1'                                             11980065
078739***        INTO :PV-RWD-CHGS-EXIST                                11990065
078740           FROM AUT_RWD_ISUD                                      12000065
078750           WHERE LAST_UPD_TMST BETWEEN                            12010065
                       TO_TIMESTAMP(:EP148-CC-PREV-ACT-CUTOFF,          12020065
                                    'YYYY-MM-DD HH24:MI:SS.FF') AND     12030065
078730                 TO_TIMESTAMP(:PV-CUR-SYS-TMST,                   12040065
                                    'YYYY-MM-DD HH24:MI:SS.FF')         12050065
                   AND ISUD_BEG_DTE >=                                  12060065
                                     TO_DATE('2005-11-30','YYYY-MM-DD') 12070065
078753                                                                  12080065
078754           UNION                                                  12090065
078755                                                                  12100065
078756           SELECT '1'                                             12110065
078757*          INTO :PV-RWD-CHGS-EXIST                                12120065
078758           FROM AUT_RWD_ISUD_MDSE                                 12130065
078759           WHERE LAST_UPD_TMST BETWEEN                            12140065
                       TO_TIMESTAMP(:EP148-CC-PREV-ACT-CUTOFF,          12150065
                                    'YYYY-MM-DD HH24:MI:SS.FF') AND     12160065
078730                 TO_TIMESTAMP(:PV-CUR-SYS-TMST,                   12170065
                                    'YYYY-MM-DD HH24:MI:SS.FF')         12180065
078761             AND RWD_EVNT_ID IN                                   12190065
078762                           (SELECT RWD_EVNT_ID                    12200065
078763                            FROM AUT_RWD_ISUD                     12210065
061306                            WHERE                                 12220065
                                     ISUD_BEG_DTE >=                    12230065
                                     TO_DATE('2005-11-30','YYYY-MM-DD'))12240065
078765                                                                  12250065
078766         END-EXEC                                                 12260060
078767                                                                  12270060
078768        EVALUATE TRUE                                             12280060
078769          WHEN SQLCODE = -904                                     12290060
078770          WHEN SQLCODE = -911                                     12300060
078771          WHEN SQLCODE = -913                                     12310060
078772             CONTINUE                                             12320060
078773                                                                  12330060
078774          WHEN SQLCODE = +0                                       12340060
078775            SET PS-EXTRACT-DATA TO TRUE                           12350060
078776                                                                  12360060
078777          WHEN SQLCODE = +100                                     12370060
                WHEN SQLCODE = +1403                                    12380071
078778            SET PS-DONT-EXTRACT-DATA TO TRUE                      12390060
078779                                                                  12400060
078780          WHEN OTHER                                              12410060
078790            MOVE '1420-CHK-FOR-RWD-EVENT-CHGS'                    12420060
078791             TO PV-PARAGRAPH-NAME                                 12430060
078792            MOVE 'CHECK FOR FUTURE CHGS' TO PV-ORA-OPERATION      12440060
078793            PERFORM 9900-ORA-ERROR                                12450060
078794        END-EVALUATE                                              12460060
078795     END-PERFORM.                                                 12470060
078796                                                                  12480060
078797     IF PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES                     12490060
078798       MOVE '1420-CHK-FOR-RWD-EVENT-CHGS' TO PV-PARAGRAPH-NAME    12500060
078799       MOVE 'SELECT RETRIES EXCEEDED'     TO PV-ORA-OPERATION     12510060
078800       PERFORM 9900-ORA-ERROR                                     12520060
078801     END-IF.                                                      12530060
078802*                                                                 12540060
078803*1420-EXIT.                                                       12550000
078805                                                                  12560000
078806*----------------------------------------------------------------*12570000
078807*  1500-READ-DAYS-TILL-STR-OPN-CD.                                12580000
078808*  - READ CONTROL CARD EPCC045. THIS CONTROL CARD CONTAINS THE    12590000
078809*    NUMBER OF DAYS BEFORE A NEW STORE OPENS FOR IT TO BE         12600000
078810*    INCLUDED IN THIS PROGRAM'S STORE CURSOR.                     12610000
078820*----------------------------------------------------------------*12620000
078830 1500-READ-DAYS-TILL-STR-OPN-CD.                                  12630000
078840                                                                  12640000
078850     READ CTRL-CRD-ADV-OPN-DAYS                                   12650000
078860       INTO EP045-ADVDAYS-TO-SND-RECORD                           12660000
078870         AT END                                                   12670000
078880           SET PS-END-OF-CNTL-CRD-FILE TO TRUE.                   12680000
078890                                                                  12690000
078900     IF PS-END-OF-CNTL-CRD-FILE                                   12700000
079000       MOVE '1500-READ-DAYS-TILL-STR-OPN-CD' TO PV-PARAGRAPH-NAME 12710000
079100       MOVE 'ATTEMPTING TO READ CTRL CRD' TO PV-OPERATION-MSG-1   12720000
079200       MOVE 'EMPTY CONTROL CARD !       ' TO PV-MSG-TEXT          12730000
079300       SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                     12740000
079400       PERFORM 9010-ABEND                                         12750000
079500     ELSE                                                         12760000
079600       DISPLAY '** STR ADV DYS OPN CONTROL CARD  |FS = '          12770000
079700                   FS-CTRL-CRD-ADV-OPN-DAYS ' **'                 12780000
079800       DISPLAY '** EPCC045     **  =' EP045-DAYS-TILL-STORE-OPN   12790000
079900       DISPLAY ' '                                                12800000
080000     END-IF.                                                      12810000
080100                                                                  12820000
080200*1500-EXIT.                                                       12830000
080400                                                                  12840000
080500*----------------------------------------------------------       12850000
080600*  1600-INCR-CUR-OPEN-DTE                                         12860000
080700*  - ADDS THE NUMBER OF DAYS TO TODAY'S DATE FOR AN               12870000
080800*    UPCOMING STORE OPENING DATE ALLOWANCE. USED IN               12880000
080900*    THE STORE CURSOR TO ALLOW ADVANCE STORE OPENINGS             12890000
081000*    TO BE INCLUDED IN THE REWARDS PROCESSING.                    12900000
081100*----------------------------------------------------------       12910000
081200 1600-INCR-CUR-OPEN-DTE.                                          12920000
081300                                                                  12930000
081400     INITIALIZE DPG51 DPG52 DPG53                                 12940069
081500                DPG54 DPG55 DPG56.                                12950069
081600*                                                                 12960069
081700     MOVE EP111-CC-CRNT-DTE            TO DPG52-LK-DATE-INPUT.    12970069
081800     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   12980069
081900     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   12990069
082000     SET  DPG51-INCREMENT-DATE         TO TRUE.                   13000069
082100     MOVE EP045-DAYS-TILL-STORE-OPN    TO DPG51-INCR-DECR-DAYS-9. 13010069
082200     PERFORM 7010-DATE-ROUTINE.                                   13020069
082300     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-OPEN-SOON-DATE.            13030069
082400     DISPLAY '** ADVANCE ON OPENING DATE : ' PV-OPEN-SOON-DATE.   13040000
082500     DISPLAY ' '.                                                 13050000
082600                                                                  13060000
082700*1600-EXIT.                                                       13070000
082900                                                                  13080000
083000*----------------------------------------------------------------*13090000
083100*  1700-LOAD-VALID-EVNT-IDS.                                      13100000
083200*  - PERFORM THE ROUTINES TO LOAD ALL OF THE VALID REWARD ID'S TO 13110000
083300*    AN INTERNAL TABLE.                                           13120000
083400*----------------------------------------------------------------*13130000
083500 1700-LOAD-VALID-EVNT-IDS.                                        13140000
083600                                                                  13150000
083700     SET PT-RWD-NDX TO PC-DEC-ONE.                                13160000
083800     SET PS-NOT-END-OF-RWD-EVNT-CSR TO TRUE.                      13170000
083900                                                                  13180000
084000     PERFORM 1710-OPEN-RWD-EVNT-CSR.                              13190000
084100                                                                  13200000
084200     PERFORM                                                      13210000
084300       UNTIL PS-END-OF-RWD-EVNT-CSR                               13220000
084400                                                                  13230000
084500         PERFORM 1720-FETCH-RWD-EVNT-CSR                          13240000
084600                                                                  13250000
084700         IF PS-NOT-END-OF-RWD-EVNT-CSR                            13260000
084800           PERFORM 1740-LOAD-RWD-EVNTS                            13270000
W36988           ADD +1 TO PV-RWD-EVNTS-COUNT                           13280080
084900         END-IF                                                   13290000
085000                                                                  13300000
085100     END-PERFORM.                                                 13310000
085200                                                                  13320000
085300     PERFORM 1750-CLOSE-RWD-EVNT-CSR.                             13330000
085400                                                                  13340000
085500*1700-EXIT.                                                       13350000
085700                                                                  13360000
085800*----------------------------------------------------------------*13370000
085900*  1710-OPEN-RWD-EVNT-CSR.                                        13380000
086000*  - OPEN THE RWD-EVNT-CSR CURSOR.                                13390000
086100*----------------------------------------------------------------*13400000
086200 1710-OPEN-RWD-EVNT-CSR.                                          13410000
086300                                                                  13420000
086400     EXEC SQL                                                     13430000
086500       OPEN RWD_EVNT_CSR                                          13440033
086600     END-EXEC.                                                    13450000
086601                                                                  13460000
086602     EVALUATE TRUE                                                13470000
086603       WHEN SQLCODE = +0                                          13480000
086604         CONTINUE                                                 13490000
086605                                                                  13500000
086606       WHEN OTHER                                                 13510000
086607         MOVE 'OPENING RWD-EVNT-CSR  ' TO PV-ORA-OPERATION        13520000
086608         MOVE '1710-OPEN-RWD-EVNT-CSR' TO PV-PARAGRAPH-NAME       13530000
086609         PERFORM 9900-ORA-ERROR                                   13540000
086610     END-EVALUATE.                                                13550015
086611                                                                  13560015
086612*1710-EXIT.                                                       13570000
086614                                                                  13580000
086615*----------------------------------------------------------------*13590000
086616*  1720-FETCH-RWD-EVNT-CSR.                                       13600000
086617*  - FETCHES THE REWARD EVENT ID'S.                               13610000
086618*----------------------------------------------------------------*13620000
086619 1720-FETCH-RWD-EVNT-CSR.                                         13630000
086620                                                                  13640000
086630     PERFORM                                                      13650000
086640       WITH TEST AFTER                                            13660000
086650       VARYING PV-SQL-SUB                                         13670000
086660       FROM 1 BY 1                                                13680000
086661       UNTIL (PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES               13690000
086662              OR SQLCODE = +0                                     13700000
086663              OR SQLCODE = +100                                   13710071
086663              OR SQLCODE = +1403)                                 13720071
086664                                                                  13730000
086665         EXEC SQL                                                 13740000
086666           FETCH RWD_EVNT_CSR                                     13750033
086667             INTO :AUT00001.RWD-EVNT-ID                           13760020
086668                , :AUT00002.QUALD-PRCH-AMT                        13770020
086669                , :AUT00002.QUALD-TOL-AMT                         13780020
086670                     :PV-RWD-QUA-TOL-IND                          13790000
086671                , :AUT00002.MAX-RWD-QTY                           13800020
086672                , :AUT00001.RWD-DISC-AMT                          13810020
086673                , :AUT00001.RWD-EVNT-NM                           13820020
W36690                , :AUT00002.TNDR-TYP-CDE                          13830020
W36690                , :AUT00002.MDSE-IE-CDE                           13840020
W36690                , :AUT00002.RCPT-CMNT-LNE1-TXT                    13850020
W36690                     :PV-RWD-DEF-CMNT-LNE1-IND                    13860000
W36690                , :AUT00002.RCPT-CMNT-LNE2-TXT                    13870020
W36690                     :PV-RWD-DEF-CMNT-LNE2-IND                    13880000
086674         END-EXEC                                                 13890000
086675                                                                  13900000
086676         EVALUATE TRUE                                            13910000
086677           WHEN SQLCODE = +0                                      13920000
                 WHEN SQLCODE = -1405                                   13930099
086678             SET PS-NOT-END-OF-RWD-EVNT-CSR TO TRUE               13940095
086679                                                                  13950000
086680           WHEN SQLCODE = +100                                    13960000
                 WHEN SQLCODE = +1403                                   13970071
086690             MOVE SPACES TO PT-RWD-ID(PT-RWD-NDX)                 13980000
086700             SET PS-END-OF-RWD-EVNT-CSR TO TRUE                   13990000
086710                                                                  14000000
086711           WHEN OTHER                                             14010000
086712             MOVE 'FETCHING RWD-EVNT-CSR'   TO PV-ORA-OPERATION   14020000
086713             MOVE '1720-FETCH-RWD-EVNT-CSR' TO PV-PARAGRAPH-NAME  14030000
086714             PERFORM 9900-ORA-ERROR                               14040000
086715         END-EVALUATE                                             14050000
086716     END-PERFORM.                                                 14060000
086717                                                                  14070000
086718     IF PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES                     14080000
086719       MOVE '1720-FETCH-RWD-EVNT-CSR' TO PV-PARAGRAPH-NAME        14090000
086720       MOVE 'SELECT RETRIES EXCEEDED' TO PV-ORA-OPERATION         14100000
086721       PERFORM 9900-ORA-ERROR                                     14110000
086722     END-IF.                                                      14120000
086723                                                                  14130000
086724*1720-EXIT.                                                       14140000
086726                                                                  14150000
086727*----------------------------------------------------------------*14160000
086728*  1740-LOAD-RWD-EVNTS.                                           14170000
086729*  - LOADS THE REWARD EVENT ID INFORMATION TO AN INTERNAL TABLE.  14180000
086730*----------------------------------------------------------------*14190000
086740 1740-LOAD-RWD-EVNTS.                                             14200000
086750                                                                  14210000
086760     MOVE RWD-EVNT-ID  OF AUT00001 TO PT-RWD-ID      (PT-RWD-NDX).14220074
086770     MOVE MAX-RWD-QTY  OF AUT00002 TO PT-MAX-RWD-QTY (PT-RWD-NDX).14230074
086780     MOVE RWD-DISC-AMT OF AUT00001 TO PT-RWD-DISC-AMT(PT-RWD-NDX).14240016
086790     MOVE RWD-EVNT-NM  OF AUT00001 TO PT-RWD-EVNT-NM (PT-RWD-NDX).14250074
W36690     MOVE TNDR-TYP-CDE OF AUT00002 TO PT-TNDR-TYP-CDE(PT-RWD-NDX).14260084
W36690     MOVE MDSE-IE-CDE  OF AUT00002 TO PT-MDSE-IE-CDE (PT-RWD-NDX).14270074
086800                                                                  14280000
086810     MOVE QUALD-PRCH-AMT  OF AUT00002                             14290016
086811      TO PT-QUALD-PRCH-AMT(PT-RWD-NDX).                           14300000
086812                                                                  14310000
086813     IF PV-QUA-TOL-NULL                                           14320000
086814       MOVE 0 TO PT-QUALD-TOL-AMT(PT-RWD-NDX)                     14330000
086815     ELSE                                                         14340000
086816       MOVE QUALD-TOL-AMT OF AUT00002                             14350016
                                TO PT-QUALD-TOL-AMT(PT-RWD-NDX)         14360016
086817     END-IF.                                                      14370000
                                                                        14380000
W36690     IF PV-DEF-CMNT-LNE1-NULL                                     14390000
W36690       MOVE SPACES TO PT-RCPT-CMNT-LNE1-TXT(PT-RWD-NDX)           14400000
W36690     ELSE                                                         14410000
W36690       MOVE RCPT-CMNT-LNE1-TXT OF AUT00002                        14420016
W36690         TO PT-RCPT-CMNT-LNE1-TXT(PT-RWD-NDX)                     14430000
W36690     END-IF.                                                      14440000
                                                                        14450000
W36690     IF PV-DEF-CMNT-LNE2-NULL                                     14460000
W36690       MOVE SPACES TO PT-RCPT-CMNT-LNE2-TXT(PT-RWD-NDX)           14470000
W36690     ELSE                                                         14480000
W36690       MOVE RCPT-CMNT-LNE2-TXT OF AUT00002                        14490016
W36690         TO PT-RCPT-CMNT-LNE2-TXT(PT-RWD-NDX)                     14500000
W36690     END-IF.                                                      14510000
086818                                                                  14520000
086819                                                                  14530000
086820     SET PT-RWD-NDX UP BY PC-DEC-ONE.                             14540000
086821     IF PT-RWD-NDX > PC-MAX-RWD-TBL-NDX                           14550000
086822       MOVE '1740-LOAD-RWD-EVNTS'        TO PV-PARAGRAPH-NAME     14560000
086823       MOVE 'TRYING TO INCREASE INDEX'   TO PV-OPERATION-MSG-1    14570000
086824       MOVE 'INDEX IS TOO SMALL'         TO PV-MSG-TEXT           14580000
086825       SET ABEND-4004-TBL-OVERFLOW-ERROR TO TRUE                  14590000
086826       PERFORM 9010-ABEND                                         14600000
086827     END-IF.                                                      14610000
086828                                                                  14620000
086829*1740-EXIT.                                                       14630000
086831                                                                  14640000
086832*----------------------------------------------------------------*14650000
086833*  1750-CLOSE-RWD-EVNT-CSR.                                       14660000
086834*  - CLOSES THE RWD-EVNT-CSR CURSOR.                              14670000
086835*----------------------------------------------------------------*14680000
086836 1750-CLOSE-RWD-EVNT-CSR.                                         14690000
086837                                                                  14700000
086838     EXEC SQL                                                     14710000
086839       CLOSE RWD_EVNT_CSR                                         14720033
086840     END-EXEC.                                                    14730000
086841                                                                  14740000
086842     EVALUATE TRUE                                                14750000
086843       WHEN SQLCODE = +0                                          14760000
086844         CONTINUE                                                 14770000
086845                                                                  14780000
086846       WHEN OTHER                                                 14790000
086847         MOVE 'CLOSING RWD-EVNT-CSR  '  TO PV-ORA-OPERATION       14800000
086848         MOVE '1750-CLOSE-RWD-EVNT-CSR' TO PV-PARAGRAPH-NAME      14810000
086849         PERFORM 9900-ORA-ERROR                                   14820000
086850     END-EVALUATE.                                                14830000
086851                                                                  14840000
086852*1750-EXIT.                                                       14850000
086854                                                                  14860000
086855*----------------------------------------------------------------*14870000
086856*  1800-INIT-EP-SELF-REPORTING.                                   14880000
086857*  - SETS UP THE HEADER FOR A REPORT WHICH WILL LOG THE           14890000
086858*    REWARD EVENTS EACH STORE RECEIVES.                           14900000
086859*    REPORTING IS FOR SUPPORT PURPOSES ONLY.                      14910000
086860*----------------------------------------------------------------*14920000
086870 1800-INIT-EP-SELF-REPORTING.                                     14930000
086880                                                                  14940000
086890*    //MOVE DEFAULT INFORMATION INTO THE STD HEADER LINES         14950000
086900     MOVE PC-PROGRAM-NAME       TO DP200O-PROGRAM-NAME.           14960000
087000     MOVE PC-REPORT-NUMBER      TO DP200O-REPORT-NUMBER.          14970000
087100     MOVE PV-CUR-SYS-TMST(15:2) TO DP200O-RUN-MINUTE.             14980000
087200     MOVE PV-CUR-SYS-TMST(12:2) TO DP200O-RUN-HOUR.               14990000
087300     MOVE PV-CUR-SYS-TMST(9:2)  TO DP200O-RUN-DAY.                15000000
087400     MOVE PV-CUR-SYS-TMST(6:2)  TO DP200O-RUN-MONTH.              15010000
087500     MOVE PV-CUR-SYS-TMST(1:4)  TO DP200O-RUN-YEAR.               15020000
087600                                                                  15030000
087700*1800-EXIT.                                                       15040000
087900                                                                  15050000
088000*----------------------------------------------------------------*15060000
088100*  2000-PROCESS-STR-EVENTS.                                       15070000
088200*  - PERFORM THE NECESSARY ROUTINES TO EXTRACT THE DATA AND THEN  15080000
088300*    CREATE THE PARAMETER FILES.                                  15090000
088400*----------------------------------------------------------------*15100000
088500 2000-PROCESS-STR-EVENTS.                                         15110000
088600                                                                  15120000
088700     SET PS-NOT-END-OF-STR-LOC-CSR TO TRUE.                       15130003
088800                                                                  15140003
088900     PERFORM 2010-OPEN-STR-LOCN-CSR.                              15150060
089000                                                                  15160003
089100     PERFORM                                                      15170003
089200       UNTIL PS-END-OF-STR-LOC-CSR                                15180003
089300         PERFORM 2020-FETCH-STR-LOC-CSR                           15190003
089400                                                                  15200003
089500         IF PS-NOT-END-OF-STR-LOC-CSR                             15210003
089600           INITIALIZE PV-PAGE-COUNT                               15220003
089700                      PV-LINE-COUNT                               15230003
089800                                                                  15240003
089900           MOVE XST00001-LOC-NBR TO RP-STORE-LOC-NBR              15250003
090000           PERFORM 7020-WRITE-REPORT-HEADERS                      15260003
090100                                                                  15270003
090200           SET PT-RWD-NDX TO PC-DEC-ONE                           15280003
090300           PERFORM 3000-PROCESS-RWD-EVENTS                        15290003
090400             UNTIL PT-RWD-ID(PT-RWD-NDX) = SPACES                 15300003
090500         END-IF                                                   15310003
090600     END-PERFORM.                                                 15320003
090700                                                                  15330003
090800     PERFORM 2030-CLOSE-STR-LOC-CSR.                              15340003
090900                                                                  15350003
091000*2000-EXIT.                                                       15360003
091200                                                                  15370000
091300*----------------------------------------------------------------*15380000
091400*  2010-OPEN-STR-LOCN-CSR.                                        15390003
091500*  - OPENS THE STORE LOCATION CURSOR FOR PROCESSING.              15400000
091600*----------------------------------------------------------------*15410000
091700 2010-OPEN-STR-LOCN-CSR.                                          15420003
091800                                                                  15430003
091900     EXEC SQL                                                     15440003
092000       OPEN STR_LOC_CSR                                           15450007
092100     END-EXEC.                                                    15460003
092200                                                                  15470003
092300     IF SQLCODE NOT EQUAL ZERO                                    15480003
092400       MOVE 'OPENING STR LOC CSR   '        TO PV-DB2-OPERATION   15490003
092500       MOVE '2010-OPEN-STR-LOCN-CSR'        TO PV-PARAGRAPH-NAME  15500003
092600       PERFORM 9020-SQL-ABEND-ROUTINE                             15510003
092700     END-IF.                                                      15520003
092800                                                                  15530003
092900*2010-EXIT.                                                       15540000
093100                                                                  15550000
093200*----------------------------------------------------------------*15560000
093300*  2020-FETCH-STR-LOC-CSR.                                        15570000
093400*  - FETCHES THE NEXT STORE LOCATION FOUND IN THE CURSOR.         15580000
093500*----------------------------------------------------------------*15590000
093600 2020-FETCH-STR-LOC-CSR.                                          15600003
093700                                                                  15610003
093800     PERFORM                                                      15620003
093900         WITH TEST AFTER                                          15630003
094000         VARYING PV-SQL-SUB                                       15640003
094100         FROM 1 BY 1                                              15650003
094200         UNTIL (PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES             15660003
094300                   OR  SQLCODE = +0                               15670003
094400                   OR  SQLCODE = +100                             15680071
094400                   OR  SQLCODE = +1403)                           15690071
094500                                                                  15700003
094600         EXEC SQL                                                 15710003
094700           FETCH STR_LOC_CSR                                      15720008
094800             INTO :XST00001-LOC-NBR                               15730003
094900         END-EXEC                                                 15740003
095000                                                                  15750003
095100         EVALUATE TRUE                                            15760003
095200           WHEN SQLCODE = +0                                      15770003
095300             CONTINUE                                             15780099
095400           WHEN SQLCODE = +100                                    15790003
095500           WHEN SQLCODE = +1403                                   15800003
095600             SET PS-END-OF-STR-LOC-CSR      TO TRUE               15810003
095700           WHEN OTHER                                             15820003
095800             SET PS-END-OF-STR-LOC-CSR      TO TRUE               15830003
095900             MOVE 'FETCHING STR GP CSR'     TO PV-DB2-OPERATION   15840003
096000             MOVE '2020-FETCH-STR-GP-CSR'   TO PV-PARAGRAPH-NAME  15850003
096100             PERFORM 9020-SQL-ABEND-ROUTINE                       15860003
096200         END-EVALUATE                                             15870003
096300     END-PERFORM.                                                 15880003
096400                                                                  15890003
096500     IF PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES                     15900003
096600       MOVE '2020-FETCH-STR-LOC-CSR ' TO PV-PARAGRAPH-NAME        15910003
096700       MOVE 'SELECT RETRIES EXCEEDED' TO PV-DB2-OPERATION         15920003
096800       PERFORM 9020-SQL-ABEND-ROUTINE                             15930003
096900     END-IF.                                                      15940003
097000                                                                  15950003
097100*2020-EXIT.                                                       15960000
097300*                                                                 15970000
097400*----------------------------------------------------------------*15980000
097500*  2030-CLOSE-STR-LOC-CSR.                                        15990000
097600*  - CLOSES THE STORE LOCATION CURSOR.                            16000000
097700*----------------------------------------------------------------*16010000
097800 2030-CLOSE-STR-LOC-CSR.                                          16020003
097900                                                                  16030003
098000     EXEC SQL                                                     16040003
098100       CLOSE STR_LOC_CSR                                          16050007
098200     END-EXEC.                                                    16060003
098300                                                                  16070003
098400     IF SQLCODE NOT EQUAL ZERO                                    16080003
098500       MOVE 'CLOSING STR LOC CSR'         TO PV-DB2-OPERATION     16090003
098600       MOVE '2030-CLOSE-STR-LOC-CSR'      TO PV-PARAGRAPH-NAME    16100003
098700       PERFORM 9020-SQL-ABEND-ROUTINE                             16110003
098800     END-IF.                                                      16120003
098900                                                                  16130003
099000*2030-EXIT.                                                       16140000
099200                                                                  16150000
099300*----------------------------------------------------------------*16160000
099400*  3000-PROCESS-RWD-EVENTS.                                       16170000
099500*  - PERFORM THE NECESSARY ROUTINES TO PROCESS EACH REWARD EVENT  16180000
099600*    THE STORE IS PART OF WITH THE DATABASE VALUES, AND TO CREATE 16190000
099700*    A 'DEFAULT' RECORD FOR THOSE REWARD EVENTS WHICH THE STORE   16200000
099800*    IS NOT PART OF.                                              16210000
099900*----------------------------------------------------------------*16220000
100000 3000-PROCESS-RWD-EVENTS.                                         16230000
100100                                                                  16240000
100200     INITIALIZE PV-RWD-EVNT-ID-HELD                               16250000
100300                RWD-EVNT-ID OF AUT00001.                          16260016
100400     SET PS-NOT-END-OF-RWD-ISUD-CSR TO TRUE.                      16270003
100500                                                                  16280003
100600     PERFORM 3010-OPEN-RWD-ISUD-CSR.                              16290003
100700                                                                  16300003
100800     PERFORM                                                      16310000
100900       VARYING PT-RWD-NDX FROM 1 BY 1                             16320000
101000       UNTIL PT-RWD-ID(PT-RWD-NDX) = SPACES                       16330000
101100                                                                  16340098
101200         IF PT-RWD-ID(PT-RWD-NDX) > PV-RWD-EVNT-ID-HELD           16350000
101300          AND PS-NOT-END-OF-RWD-ISUD-CSR                          16360003
101400            PERFORM 3020-FETCH-RWD-ISUD-CSR                       16370003
101500              UNTIL RWD-EVNT-ID OF AUT00001 > PV-RWD-EVNT-ID-HELD 16380016
101600                 OR PS-END-OF-RWD-ISUD-CSR                        16390003
101700            MOVE RWD-EVNT-ID OF AUT00001 TO PV-RWD-EVNT-ID-HELD   16400016
101800         END-IF                                                   16410003
101900                                                                  16420003
102000         IF PV-RWD-EVNT-ID-HELD = PT-RWD-ID(PT-RWD-NDX)           16430003
102100          AND PS-NOT-END-OF-RWD-ISUD-CSR                          16440003
102200            PERFORM 3040-POP-WITH-DATABASE-VALUES                 16450003
102300         ELSE                                                     16460003
102400            PERFORM 3050-POP-WITH-DEFAULT-VALUES                  16470003
102500         END-IF                                                   16480003
102600                                                                  16490003
102700         PERFORM 3100-CREATE-RWD-EVNTS                            16500003
102800                                                                  16510003
102900     END-PERFORM.                                                 16520003
103000                                                                  16530003
103100     PERFORM 3030-CLOSE-RWD-ISUD-CSR.                             16540003
103200                                                                  16550003
103300*3000-EXIT.                                                       16560003
103500                                                                  16570000
103600*----------------------------------------------------------------*16580000
103700*  3010-OPEN-RWD-ISUD-CSR.                                        16590000
103800*  - OPENS THE REWARD EVENTS ACTIVIATION EXTRACT CURSOR           16600000
103900*    RELEVANT ON A SPECIFIED STORE LOCATION NUMBER.               16610000
104000*----------------------------------------------------------------*16620000
104100 3010-OPEN-RWD-ISUD-CSR.                                          16630000
104200                                                                  16640000
104300     EXEC SQL                                                     16650000
104400       OPEN RWD_ISUD_EVNT_CSR                                     16660007
104500     END-EXEC.                                                    16670000
104600                                                                  16680000
104700     IF SQLCODE NOT EQUAL ZERO                                    16690000
104800       MOVE 'OPENING RWD ISUD CSR'          TO PV-ORA-OPERATION   16700000
104900       MOVE '3010-OPEN-RWD-ISUD-CSR'        TO PV-PARAGRAPH-NAME  16710000
105000       PERFORM 9900-ORA-ERROR                                     16720000
105100     END-IF.                                                      16730000
105200                                                                  16740000
105300*3010-EXIT.                                                       16750000
105500                                                                  16760000
105600*----------------------------------------------------------------*16770000
105700*  3020-FETCH-RWD-ISUD-CSR.                                       16780000
105800*  - FETCHES THE REWARD EVENT INFORMATION INTO LOCAL VARIABLES.   16790000
105900*----------------------------------------------------------------*16800000
106000 3020-FETCH-RWD-ISUD-CSR.                                         16810000
106100                                                                  16820000
106200     INITIALIZE AUT00001                                          16830016
106300                AUT00002.                                         16840016
106400                                                                  16850000
106500     PERFORM                                                      16860000
106600         WITH TEST AFTER                                          16870000
106700         VARYING PV-SQL-SUB                                       16880000
106800         FROM 1 BY 1                                              16890000
106900         UNTIL (PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES             16900000
107000                   OR  SQLCODE = +0                               16910000
107100                   OR  SQLCODE = +100                             16920071
107100                   OR  SQLCODE = +1403)                           16930071
107200                                                                  16940000
107300         EXEC SQL                                                 16950000
107400           FETCH RWD_ISUD_EVNT_CSR                                16960008
107500             INTO :AUT00001.RWD-EVNT-ID                           16970020
107600                , :AUT00001.RWD-DISC-AMT                          16980020
107700                , :AUT00001.RWD-TYP-CDE                           16990020
107800                , :AUT00001.RWD-EVNT-NM                           17000020
107900                , :AUT00002.LAST-UPD-BY-USR-ID                    17010020
108000                , :AUT00002.STR-GP-TYP-CDE                        17020025
108100                , :AUT00002.STR-GP-ID                             17030025
108200                , :AUT00002.ISUD-BEG-DTE                          17040020
108300                , :AUT00002.ISUD-END-DTE                          17050020
108400                , :AUT00002.PRE-BEG-DAYS-QTY                      17060020
108500                     :PV-RWD-PRE-DYS-IND                          17070000
108600                , :AUT00002.POST-END-DAYS-QTY                     17080020
108700                     :PV-RWD-PST-DYS-IND                          17090000
108800                , :AUT00002.TNDR-TYP-CDE                          17100020
108900                , :AUT00002.QUALD-PRCH-AMT                        17110021
109000                , :AUT00002.QUALD-TOL-AMT                         17120021
109100                     :PV-RWD-QUA-TOL-IND                          17130000
109200                , :AUT00002.MAX-RWD-QTY                           17140020
109300                , :AUT00002.MDSE-IE-CDE                           17150020
109400                , :AUT00002.LAST-UPD-BY-USR-ID                    17160020
109500                , :AUT00002.RCPT-CMNT-LNE1-TXT                    17170020
109600                     :PV-RWD-RCPT-LNE1-IND                        17180000
109700                , :AUT00002.RCPT-CMNT-LNE2-TXT                    17190020
109800                     :PV-RWD-RCPT-LNE2-IND                        17200000
109900         END-EXEC                                                 17210000
110000                                                                  17220000
110100         EVALUATE TRUE                                            17230000
110200           WHEN SQLCODE = +0                                      17240000
110200           WHEN SQLCODE = -1405                                   17250076
110300             CONTINUE                                             17260092
110400           WHEN SQLCODE = +100                                    17270000
110500           WHEN SQLCODE = +1403                                   17280000
110600             SET PS-END-OF-RWD-ISUD-CSR     TO TRUE               17290000
110700           WHEN OTHER                                             17300000
110800             SET PS-END-OF-RWD-ISUD-CSR     TO TRUE               17310000
110900             MOVE 'FETCHING RWD ISUD CSR'   TO PV-ORA-OPERATION   17320000
111000             MOVE '3020-FETCH-RWD-ISUD-CSR' TO PV-PARAGRAPH-NAME  17330000
111100             PERFORM 9900-ORA-ERROR                               17340000
111200         END-EVALUATE                                             17350000
111300     END-PERFORM.                                                 17360000
111400                                                                  17370000
111500     IF PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES                     17380000
111600       MOVE '3020-FETCH-RWD-ISUD-CSR' TO PV-PARAGRAPH-NAME        17390000
111700       MOVE 'SELECT RETRIES EXCEEDED' TO PV-ORA-OPERATION         17400000
111710       PERFORM 9900-ORA-ERROR                                     17410000
111720     END-IF.                                                      17420000
111730                                                                  17430000
111740*3020-EXIT.                                                       17440000
111742                                                                  17450000
111743*----------------------------------------------------------------*17460000
111744*  3030-CLOSE-RWD-ISUD-CSR.                                       17470000
111745*  - CLOSES THE REWARDS ACTIVATION EXTRACT CURSOR.                17480000
111746*----------------------------------------------------------------*17490000
111747 3030-CLOSE-RWD-ISUD-CSR.                                         17500000
111748                                                                  17510000
111749     EXEC SQL                                                     17520000
111750       CLOSE RWD_ISUD_EVNT_CSR                                    17530007
111751     END-EXEC.                                                    17540000
111752                                                                  17550000
111753     IF SQLCODE NOT EQUAL ZERO                                    17560000
111754       MOVE 'CLOSING RWD ISUD CSR'          TO PV-ORA-OPERATION   17570000
111755       MOVE '3030-CLOSE-RWD-ISUD-CSR'       TO PV-PARAGRAPH-NAME  17580000
111756       PERFORM 9900-ORA-ERROR                                     17590000
111757     END-IF.                                                      17600000
111758                                                                  17610000
111759*3030-EXIT.                                                       17620000
111761                                                                  17630000
111810*----------------------------------------------------------------*17640000
111820*  3040-POP-WITH-DATABASE-VALUES.                                 17650000
111821*  - USE VALUES RETURNED FROM THE CURSOR FETCH.                   17660000
111822*----------------------------------------------------------------*17670000
111823 3040-POP-WITH-DATABASE-VALUES.                                   17680000
111824                                                                  17690000
W36690     SET PS-NOT-DFLT-VALUE-REC TO TRUE.                           17700000
111826                                                                  17710000
111827*    //WHEN ONE OF THE FOLLOWING FIELDS IS NULL. . .              17720000
111828     IF PV-PRE-DYS-NULL                                           17730000
111829        MOVE 0 TO PRE-BEG-DAYS-QTY OF AUT00002                    17740016
111830     END-IF.                                                      17750000
111831     IF PV-PST-DYS-NULL                                           17760000
111832        MOVE 0 TO POST-END-DAYS-QTY OF AUT00002                   17770016
111833     END-IF.                                                      17780000
111834     IF PV-QUA-TOL-NULL                                           17790000
111835        MOVE 0 TO QUALD-TOL-AMT     OF AUT00002                   17800016
111836     END-IF.                                                      17810000
111837                                                                  17820000
111838     MOVE RWD-EVNT-ID  OF AUT00001 TO PV-RWD-EVNT-ID.             17830016
111839     MOVE RWD-DISC-AMT OF AUT00001 TO PV-RWD-DISC-AMT.            17840016
111840     MOVE RWD-EVNT-NM  OF AUT00001 TO PV-RWD-EVNT-NM              17850016
111850                                                                  17860000
111860     MOVE ISUD-BEG-DTE  OF AUT00002 TO PV-ISUD-BEG-DTE.           17870016
111861     MOVE ISUD-END-DTE  OF AUT00002 TO PV-ISUD-END-DTE.           17880016
111862     MOVE PRE-BEG-DAYS-QTY  OF AUT00002 TO PV-PRE-BEG-DAYS-QTY.   17890016
111863     MOVE POST-END-DAYS-QTY OF AUT00002 TO PV-POST-END-DAYS-QTY.  17900016
111864                                                                  17910000
111865     MOVE QUALD-PRCH-AMT OF AUT00002 TO PV-QUALD-PRCH-AMT.        17920016
111866     MOVE QUALD-TOL-AMT  OF AUT00002 TO PV-QUALD-TOL-AMT.         17930016
111867     MOVE TNDR-TYP-CDE   OF AUT00002 TO PV-TNDR-TYP-CDE.          17940016
111868     MOVE MAX-RWD-QTY    OF AUT00002 TO PV-MAX-RWD-QTY.           17950016
111869     MOVE MDSE-IE-CDE    OF AUT00002 TO PV-MDSE-IE-CDE.           17960016
111870                                                                  17970000
111871     MOVE RCPT-CMNT-LNE1-TXT OF AUT00002 TO PV-RCPT-CMNT-LNE1-TXT.17980016
111872     MOVE RCPT-CMNT-LNE2-TXT OF AUT00002 TO PV-RCPT-CMNT-LNE2-TXT.17990016
111873                                                                  18000000
      //* Replace the Tender-Type-Code with Validity Period days if RKC 18010087
           MOVE RWD-EVNT-ID  OF AUT00001 TO                             18020087
                RWD-EVNT-ID  OF AUT00015.                               18030087
           MOVE STR-GP-TYP-CDE  OF AUT00002                             18040087
             TO STR-GP-TYP-CDE  OF AUT00015.                            18050087
           MOVE STR-GP-ID       OF AUT00002                             18060087
             TO STR-GP-ID       OF AUT00015.                            18070087
           PERFORM 5000-GET-REWARD-RETD-DAYS.                           18080087
           IF SQLCODE = +0                                              18090087
              PERFORM 5500-GET-VALIDITY-PERIOD-DAYS                     18100099
              IF SQLCODE = +0                                           18110087
                 MOVE VLDY-PERD-DAYS OF AUT00015                        18120087
                   TO PV-TNDR-TYP-CDE                                   18130087
              ELSE                                                      18140087
                 MOVE 99 TO PV-TNDR-TYP-CDE                             18150087
              END-IF                                                    18160091
           END-IF.                                                      18170087
111874*3040-EXIT.                                                       18180000
                                                                        18190000
W36690*----------------------------------------------------------------*18200000
W36690*  3050-POP-WITH-DEFAULT-VALUES.                                  18210000
W36690*  - POPULATE THE DB2 VARIABLES WITH DEFAULT VALUES FOR STORES    18220000
W36690*    WHICH ARE NOT PART OF THE REWARD EVENT.                      18230000
W36690*----------------------------------------------------------------*18240000
W36690 3050-POP-WITH-DEFAULT-VALUES.                                    18250000
W36690                                                                  18260000
W36690     SET PS-DFLT-VALUE-REC TO TRUE.                               18270000
W36690                                                                  18280000
W36690     MOVE PT-RWD-ID(PT-RWD-NDX)       TO PV-RWD-EVNT-ID.          18290000
W36690     MOVE PT-RWD-DISC-AMT(PT-RWD-NDX) TO PV-RWD-DISC-AMT.         18300000
W36690     MOVE PT-RWD-EVNT-NM(PT-RWD-NDX)  TO PV-RWD-EVNT-NM.          18310000
W36690                                                                  18320000
           MOVE SPACES           TO PV-ISUD-BEG-DTE PV-ISUD-END-DTE.    18330033
W36690     MOVE PC-DFLT-PAST-DTE TO PV-ISUD-BEG-DTE.                    18340000
W36690     MOVE PC-DFLT-PAST-DTE TO PV-ISUD-END-DTE.                    18350000
W36690     MOVE 0                TO PV-PRE-BEG-DAYS-QTY.                18360000
W36690     MOVE 0                TO PV-POST-END-DAYS-QTY.               18370000
W36690                                                                  18380000
W36690     MOVE PT-QUALD-PRCH-AMT(PT-RWD-NDX) TO PV-QUALD-PRCH-AMT.     18390000
W36690     MOVE PT-QUALD-TOL-AMT(PT-RWD-NDX)  TO PV-QUALD-TOL-AMT.      18400000
W36690     MOVE PT-TNDR-TYP-CDE(PT-RWD-NDX)   TO PV-TNDR-TYP-CDE.       18410000
W36690     MOVE PT-MAX-RWD-QTY(PT-RWD-NDX)    TO PV-MAX-RWD-QTY.        18420000
W36690     MOVE PT-MDSE-IE-CDE(PT-RWD-NDX)    TO PV-MDSE-IE-CDE.        18430000
W36690                                                                  18440000
W36690     MOVE PT-RCPT-CMNT-LNE1-TXT(PT-RWD-NDX)                       18450000
W36690       TO PV-RCPT-CMNT-LNE1-TXT.                                  18460000
W36690     MOVE PT-RCPT-CMNT-LNE2-TXT(PT-RWD-NDX)                       18470000
W36690       TO PV-RCPT-CMNT-LNE2-TXT.                                  18480000
W36690                                                                  18490000
W36690*3050-EXIT.                                                       18500000
111876                                                                  18510000
111877*----------------------------------------------------------------*18520000
111878*  3100-CREATE-RWD-EVNTS.                                         18530000
111879*  - PROCESS THE ISSUED REWARD EVENTS WHICH THE STORE IS PART OF, 18540000
111880*    MAKING CALLS TO FORMAT THE LOCAL VARIABLES AND TO EVENTUALLY 18550000
111890*    PRINT OUT THE RECORD.                                        18560000
111900*----------------------------------------------------------------*18570000
112000 3100-CREATE-RWD-EVNTS.                                           18580000
112100                                                                  18590000
112200     PERFORM 6010-PROCESS-EVENT-ID-FIELD.                         18600000
112300     PERFORM 6020-PROCESS-BEG-AND-END-DATES.                      18610000
112400     PERFORM 6030-PROCESS-EVENT-NM-FIELD.                         18620000
112500     PERFORM 6040-PROCESS-CMNT-LNE-FIELD.                         18630000
112600                                                                  18640000
112700     MOVE ZERO TO PV-DEPTS-FOUND.                                 18650000
112800     SET PS-NOT-END-OF-DEPTS-CSR TO TRUE.                         18660000
112900                                                                  18670000
113000     IF PV-MDSE-IE-CDE EQUAL TO PC-MDSE-ALL-DEPTS                 18680000
113200       SET PS-END-OF-DEPTS-CSR TO TRUE                            18690000
113300     ELSE                                                         18700000
W36690       IF PS-DFLT-VALUE-REC                                       18710000
W36690          PERFORM 4110-OPEN-I-E-DEPT-DFLT-CSR                     18720000
W36690       ELSE                                                       18730000
W36690          PERFORM 3110-OPEN-I-E-MDSE-DEPT-CSR                     18740000
W36690       END-IF                                                     18750000
113500     END-IF.                                                      18760000
113600                                                                  18770000
113700     INITIALIZE PV-DEPT-VAR-1 PV-DEPT-VAR-2                       18780000
113800                PV-DEPT-VAR-3 PV-DEPT-VAR-4 PV-DEPT-VAR-5.        18790000
113900                                                                  18800000
114000     PERFORM VARYING PV-DEPTS-CT FROM 1 BY 1                      18810000
114100       UNTIL (PV-DEPTS-CT GREATER THAN PC-MDSE-MAX-DEPTS          18820000
114200              OR PS-END-OF-DEPTS-CSR)                             18830000
114300                                                                  18840000
W36690       IF PS-DFLT-VALUE-REC                                       18850000
W36690          PERFORM 4120-FETCH-I-E-DEPT-DFLT-CSR                    18860000
W36690       ELSE                                                       18870000
114400         PERFORM 3120-FETCH-I-E-MDSE-DEPT-CSR                     18880000
W36690       END-IF                                                     18890000
114500                                                                  18900000
114600         IF SQLCODE = ZERO                                        18910000
114700           ADD +1 TO PV-DEPTS-FOUND                               18920000
114800           EVALUATE PV-DEPTS-CT                                   18930000
114900             WHEN 1                                               18940000
115000               MOVE DEPT-NBR OF AUT00003 TO PV-DEPT-VAR-1         18950016
115100             WHEN 2                                               18960000
115200               MOVE DEPT-NBR OF AUT00003 TO PV-DEPT-VAR-2         18970016
115300             WHEN 3                                               18980000
115400               MOVE DEPT-NBR OF AUT00003 TO PV-DEPT-VAR-3         18990016
115500             WHEN 4                                               19000000
115600               MOVE DEPT-NBR OF AUT00003 TO PV-DEPT-VAR-4         19010016
115700             WHEN 5                                               19020000
115800               MOVE DEPT-NBR OF AUT00003 TO PV-DEPT-VAR-5         19030016
115900           END-EVALUATE                                           19040000
116000         END-IF                                                   19050000
116100                                                                  19060000
116200     END-PERFORM.                                                 19070000
116300                                                                  19080000
116400     IF PV-MDSE-IE-CDE NOT EQUAL TO PC-MDSE-ALL-DEPTS             19090000
W36690       IF PS-DFLT-VALUE-REC                                       19100000
W36690          PERFORM 4130-CLOSE-I-E-DEPT-DFLT-CSR                    19110000
W36690       ELSE                                                       19120000
116600          PERFORM 3130-CLOSE-I-E-MDSE-DEPT-CSR                    19130000
W36690       END-IF                                                     19140000
116700     END-IF.                                                      19150000
116800                                                                  19160000
116900     PERFORM 6050-EVALUATE-DEPTS-FOUND.                           19170000
117000                                                                  19180000
117100     PERFORM 6060-BUILD-RWD-ISUD-RECORD.                          19190000
117200     PERFORM 6070-WRITE-RWD-ISUD-RECORD.                          19200000
117300     PERFORM 6080-BUILD-AND-WRITE-RPT-REC.                        19210000
117400                                                                  19220000
117500     MOVE SPACES TO RWD-ISUD-EXTRCT-RPT-REC.                      19230000
117600     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        19240000
117700                                                                  19250000
117800*3100-EXIT.                                                       19260000
118000                                                                  19270000
118100*----------------------------------------------------------------*19280000
118200*  3110-OPEN-I-E-MDSE-DEPT-CSR.                                   19290000
118300*  - OPENS THE INCLUDE / EXCLUDE DEPARTMENTS CURSOR.              19300000
118400*----------------------------------------------------------------*19310000
118500 3110-OPEN-I-E-MDSE-DEPT-CSR.                                     19320000
118600                                                                  19330000
118700     EXEC SQL                                                     19340000
118800       OPEN I_E_MDSE_DEPT_CSR                                     19350007
118900     END-EXEC.                                                    19360000
119000                                                                  19370000
119100     IF SQLCODE NOT EQUAL ZERO                                    19380000
119200       MOVE 'OPENING I/E MDSE DEPT CSR'     TO PV-ORA-OPERATION   19390000
119300       MOVE '3110-OPEN-I-E-MDSE-DEPT-CSR'   TO PV-PARAGRAPH-NAME  19400000
119400       PERFORM 9900-ORA-ERROR                                     19410000
119500     END-IF.                                                      19420000
119600                                                                  19430000
119700*3110-EXIT.                                                       19440000
119900                                                                  19450000
120000*----------------------------------------------------------------*19460000
120100*  3120-FETCH-I-E-MDSE-DEPT-CSR.                                  19470000
120200*  - FETCHES A DEPARTMENT NUMBER AS IT RELATES TO A               19480000
120300*    SPECIFIC REWARD EVENT AND STORE LOCATION.                    19490000
120400*----------------------------------------------------------------*19500000
120500 3120-FETCH-I-E-MDSE-DEPT-CSR.                                    19510000
120600                                                                  19520000
120700     PERFORM                                                      19530000
120800         WITH TEST AFTER                                          19540000
120900         VARYING PV-SQL-SUB                                       19550000
121000         FROM 1 BY 1                                              19560000
121100         UNTIL (PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES             19570000
121200                   OR  SQLCODE = +0                               19580000
121300                   OR  SQLCODE = +100                             19590071
121300                   OR  SQLCODE = +1403)                           19600071
121400                                                                  19610000
121500         EXEC SQL                                                 19620000
121600           FETCH I_E_MDSE_DEPT_CSR                                19630008
121700             INTO :AUT00003.DEPT-NBR                              19640021
121800         END-EXEC                                                 19650000
121900                                                                  19660000
122000         EVALUATE TRUE                                            19670000
122100           WHEN SQLCODE = +0                                      19680000
122200             CONTINUE                                             19690000
122300           WHEN SQLCODE = +100                                    19700000
122400           WHEN SQLCODE = +1403                                   19710000
122500             SET PS-END-OF-DEPTS-CSR        TO TRUE               19720000
122600           WHEN OTHER                                             19730000
122700             SET PS-END-OF-RWD-ISUD-CSR     TO TRUE               19740000
122800             MOVE 'FETCHING IE DEPTS CSR'   TO PV-ORA-OPERATION   19750000
122900             MOVE '6300-FETCH-IE-DEPTS-CSR' TO PV-PARAGRAPH-NAME  19760000
123000             PERFORM 9900-ORA-ERROR                               19770041
123100         END-EVALUATE                                             19780000
123200     END-PERFORM.                                                 19790000
123300                                                                  19800000
123400     IF PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES                     19810000
123500       MOVE '3120-FETCH-IE-DEPTS-CSR' TO PV-PARAGRAPH-NAME        19820000
123600       MOVE 'SELECT RETRIES EXCEEDED' TO PV-ORA-OPERATION         19830000
123700       PERFORM 9900-ORA-ERROR                                     19840000
123800     END-IF.                                                      19850000
123900                                                                  19860000
124000*3120-EXIT.                                                       19870000
124200                                                                  19880000
124300*----------------------------------------------------------------*19890000
124400*  3130-CLOSE-I-E-MDSE-DEPT-CSR.                                  19900000
124500*  - CLOSES THE INCLUDE / EXCLUDE DEPARTMENT LIST CURSOR.         19910000
124600*----------------------------------------------------------------*19920000
124700 3130-CLOSE-I-E-MDSE-DEPT-CSR.                                    19930000
124800                                                                  19940000
124900     EXEC SQL                                                     19950000
125000       CLOSE I_E_MDSE_DEPT_CSR                                    19960007
125100     END-EXEC.                                                    19970000
125200                                                                  19980000
125300     IF SQLCODE NOT EQUAL ZERO                                    19990000
125400       MOVE 'CLOSING MDSE DEPT CSR'        TO PV-ORA-OPERATION    20000000
125500       MOVE '3130-CLOSE-I-E-MDSE-DEPT-CSR' TO PV-PARAGRAPH-NAME   20010000
125600       PERFORM 9900-ORA-ERROR                                     20020000
125700     END-IF.                                                      20030000
125800                                                                  20040000
125900*3130-EXIT.                                                       20050000
126100                                                                  20060000
W36690*----------------------------------------------------------------*20070000
W36690*  4110-OPEN-I-E-DEPT-DFLT-CSR.                                   20080000
W36690*  - OPENS THE DEFAULT ROW INCLUDE / EXCLUDE DEPARTMENTS CURSOR.  20090000
W36690*----------------------------------------------------------------*20100000
W36690 4110-OPEN-I-E-DEPT-DFLT-CSR.                                     20110000
W36690                                                                  20120000
W36690     EXEC SQL                                                     20130000
W36690       OPEN I_E_DEPT_DFLT_CSR                                     20140010
W36690     END-EXEC.                                                    20150000
W36690                                                                  20160000
W36690     IF SQLCODE NOT EQUAL ZERO                                    20170000
W36690       MOVE 'OPENING I/E DEPT DFLT CSR'     TO PV-ORA-OPERATION   20180000
W36690       MOVE '4110-OPEN-I-E-DEPT-DFLT-CSR'   TO PV-PARAGRAPH-NAME  20190000
W36690       PERFORM 9900-ORA-ERROR                                     20200000
W36690     END-IF.                                                      20210000
W36690                                                                  20220000
W36690*4110-EXIT.                                                       20230000
W36690                                                                  20240000
W36690*----------------------------------------------------------------*20250000
W36690*  4120-FETCH-I-E-DEPT-DFLT-CSR.                                  20260000
W36690*  - ACROSS THE EVENT ID FOR ALL STORES...                        20270000
W36690*  - SELECT THE DISTINCT DEPARTMENTS SET-UP.                      20280000
W36690*----------------------------------------------------------------*20290000
W36690 4120-FETCH-I-E-DEPT-DFLT-CSR.                                    20300000
W36690                                                                  20310000
W36690     PERFORM                                                      20320000
W36690         WITH TEST AFTER                                          20330000
W36690         VARYING PV-SQL-SUB                                       20340000
W36690         FROM 1 BY 1                                              20350000
W36690         UNTIL (PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES             20360000
W36690                   OR  SQLCODE = +0                               20370000
W36690                   OR  SQLCODE = +100                             20380071
W36690                   OR  SQLCODE = +1403)                           20390071
W36690                                                                  20400000
W36690         EXEC SQL                                                 20410000
W36690           FETCH I_E_DEPT_DFLT_CSR                                20420008
W36690             INTO :AUT00003.DEPT-NBR                              20430021
W36690         END-EXEC                                                 20440000
W36690                                                                  20450000
W36690         EVALUATE TRUE                                            20460000
W36690           WHEN SQLCODE = +0                                      20470000
W36690             CONTINUE                                             20480000
W36690           WHEN SQLCODE = +100                                    20490000
W36690           WHEN SQLCODE = +1403                                   20500000
W36690             SET PS-END-OF-DEPTS-CSR        TO TRUE               20510000
W36690           WHEN OTHER                                             20520000
W36690             SET PS-END-OF-RWD-ISUD-CSR     TO TRUE               20530000
W36690             MOVE 'FETCHING IE DEPTS CSR'   TO PV-ORA-OPERATION   20540000
W36690             MOVE '4120-FETCH-IE-DEPTS-CSR' TO PV-PARAGRAPH-NAME  20550000
W36690             DISPLAY 'ERROR ON EVNT ID: ' PV-RWD-EVNT-ID          20560000
W36690             PERFORM 9900-ORA-ERROR                               20570000
W36690         END-EVALUATE                                             20580000
W36690     END-PERFORM.                                                 20590000
W36690                                                                  20600000
W36690     IF PV-SQL-SUB GREATER PC-SQL-MAX-RETRIES                     20610000
W36690       MOVE '4120-FETCH-IE-DEPTS-CSR' TO PV-PARAGRAPH-NAME        20620000
W36690       MOVE 'SELECT RETRIES EXCEEDED' TO PV-ORA-OPERATION         20630000
W36690       PERFORM 9900-ORA-ERROR                                     20640000
W36690     END-IF.                                                      20650000
W36690                                                                  20660000
W36690*4120-EXIT.                                                       20670000
W36690                                                                  20680000
W36690*----------------------------------------------------------------*20690000
W36690*  4130-CLOSE-I-E-DEPT-DFLT-CSR.                                  20700000
W36690*  - CLOSES THE DEFAULT INCLUDE / EXCLUDE DEPARTMENT LIST CURSOR. 20710000
W36690*----------------------------------------------------------------*20720000
W36690 4130-CLOSE-I-E-DEPT-DFLT-CSR.                                    20730000
W36690                                                                  20740000
W36690     EXEC SQL                                                     20750000
W36690       CLOSE I_E_DEPT_DFLT_CSR                                    20760007
W36690     END-EXEC.                                                    20770000
W36690                                                                  20780000
W36690     IF SQLCODE NOT EQUAL ZERO                                    20790000
W36690       MOVE 'CLOSING MDSE DEPT CSR'        TO PV-ORA-OPERATION    20800000
W36690       MOVE '4130-CLOSE-I-E-DEPT-DFLT-CSR' TO PV-PARAGRAPH-NAME   20810000
W36690       PERFORM 9900-ORA-ERROR                                     20820000
W36690     END-IF.                                                      20830000
W36690                                                                  20840000
W36690*4130-EXIT.                                                       20850000
126100                                                                  20860000
      ******************************************************************20870084
      * TO DETERMINE THE RETURNED VALIDITY DAYS, FIRST ENSURE THAT THE  20880084
      * ROW EXISTS IN AUT_RWD_REDM_RETD TABLE. IF YES, ENSURE THAT THE  20890084
      * CURRENT DATE FALLS IN THE DATE RANGE.                           20900084
      *           5000-GET-REWARD-RETD-DAYS.                            20910084
      ******************************************************************20920084
       5000-GET-REWARD-RETD-DAYS.                                       20930084
                                                                        20940083
           EXEC SQL                                                     20950083
                                                                        20960083
                SELECT  DISTINCT RWD_EVNT_ID                            20970086
                  INTO :AUT00015.RWD-EVNT-ID                            20980085
                                                                        20990083
                  FROM AUT_RWD_REDM_RETD                                21000083
                                                                        21010083
                 WHERE RWD_EVNT_ID    = :AUT00015.RWD-EVNT-ID           21020083
                   AND STR_GP_TYP_CDE = :AUT00015.STR-GP-TYP-CDE        21030085
                   AND STR_GP_ID      = :AUT00015.STR-GP-ID             21040083
                                                                        21050083
           END-EXEC.                                                    21060083
                                                                        21070083
           EVALUATE TRUE                                                21080083
             WHEN SQLCODE = +0                                          21090083
             WHEN SQLCODE = +100                                        21100083
             WHEN SQLCODE = +1403                                       21110084
                  CONTINUE                                              21120084
             WHEN OTHER                                                 21130083
                  MOVE 'AUT_RWD_REDM_RETD READ'  TO PV-ORA-OPERATION    21140084
                  MOVE '5000-GET-REWARD-RETD-DAYS' TO PV-PARAGRAPH-NAME 21150084
                  DISPLAY 'ERROR ON EVNT ID: ' PV-RWD-EVNT-ID           21160084
                  PERFORM 9900-ORA-ERROR                                21170084
           END-EVALUATE.                                                21180083
                                                                        21190083
      ******************************************************************21200084
      * ENSURE THAT THE CURRENT DATE IS BETWEEN THE DATE RANGE          21210084
      ******************************************************************21220084
       5500-GET-VALIDITY-PERIOD-DAYS.                                   21230099
                                                                        21240084
           EXEC SQL                                                     21250083
                                                                        21260083
                SELECT VLDY_PERD_DAYS                                   21270084
                  INTO :AUT00015.VLDY-PERD-DAYS                         21280083
                                                                        21290083
                  FROM AUT_RWD_REDM_RETD                                21300083
                                                                        21310083
                 WHERE RWD_EVNT_ID    = :AUT00015.RWD-EVNT-ID           21320083
                   AND STR_GP_TYP_CDE = :AUT00015.STR-GP-TYP-CDE        21330085
                   AND STR_GP_ID      = :AUT00015.STR-GP-ID             21340083
                   AND CURRENT_DATE   BETWEEN REDM_BEG_DTE              21350084
                                          AND REDM_END_DTE              21360085
                                                                        21370083
           END-EXEC.                                                    21380083
                                                                        21390083
           EVALUATE TRUE                                                21400083
               WHEN SQLCODE = +0                                        21410084
               WHEN SQLCODE = +100                                      21420084
               WHEN SQLCODE = +1403                                     21430084
                    CONTINUE                                            21440084
               WHEN OTHER                                               21450084
                    MOVE 'AUT_RWD_REDM_RETD READ'    TO PV-ORA-OPERATION21460084
                    MOVE '5500-GET-VALIDITY-PERIOD' TO PV-PARAGRAPH-NAME21470099
                    DISPLAY 'ERROR ON EVNT ID: ' PV-RWD-EVNT-ID         21480084
                    PERFORM 9900-ORA-ERROR                              21490084
           END-EVALUATE.                                                21500083
      * 5500-EXIT.                                                      21510099
126200*----------------------------------------------------------------*21520000
126300*  6010-PROCESS-EVENT-ID-FIELD                                    21530000
126400*  - FORMATS THE EVENT ID FIELD FROM LEFT JUSTIFIED PIC X(5)      21540000
126500*    INTO A LEADING ZEROES EDITED ALPHANUMERIC FIELD.             21550000
126600*    NECESSARY DUE TO THE WAY THE FIELD IS STORE IN THE DB.       21560000
126700*----------------------------------------------------------------*21570000
126800 6010-PROCESS-EVENT-ID-FIELD.                                     21580000
126900                                                                  21590000
127000*    //MAY PROCESS EITHER NUMERIC OR ALPHANUMERIC EVNT IDS        21600000
127100     UNSTRING PV-RWD-EVNT-ID DELIMITED BY SPACES                  21610000
127200              INTO PV-RWD-EVNT-ID-CHARS                           21620000
127300     END-UNSTRING.                                                21630000
127400                                                                  21640000
127500     INSPECT PV-RWD-EVNT-ID-CHARS REPLACING ALL " " BY "0".       21650000
127600     MOVE PV-RWD-EVNT-ID-CHARS TO EP139-RWD-ISUD-EVNT-ID.         21660000
127700                                                                  21670000
127800*6010-EXIT.                                                       21680000
128000                                                                  21690000
128100*----------------------------------------------------------------*21700000
128200*  6020-PROCESS-BEG-AND-END-DATES.                                21710000
128300*  - EACH REWARD EVENT HAS SPECIFIED START AND END DATES          21720000
128400*    WHICH MAY BE ALTERED FOR CERTAIN STORES OR DISTRICTS.        21730000
128500*    IN EACH REWARD EVENT RECORD IS A PRE-OPEN AND POST-CLOSE     21740000
128600*    NUMERIC FIELD WHICH WOULD BE THE NUMBER OF DAYS TO ADJUST    21750000
128700*    HOW SOON THE AWARDS WOULD BEGIN ACTIVATING, OR HOW MUCH      21760000
128800*    LONGER THEY WOULD ACTIVATE AT SPECIFIED LOCATIONS.           21770000
128900*----------------------------------------------------------------*21780000
129000 6020-PROCESS-BEG-AND-END-DATES.                                  21790000
129100                                                                  21800000
129200*    //COPY ISUD BEG AND END DATES TO MOD IN CASE NO CHANGES EXIST21810000
129300     MOVE PV-ISUD-BEG-DTE (1:10) TO PV-MOD-ISUD-BEG-DTE.          21820033
129400     MOVE PV-ISUD-END-DTE (1:10) TO PV-MOD-ISUD-END-DTE.          21830033
129500                                                                  21840000
129600     IF PV-PRE-BEG-DAYS-QTY NOT EQUAL TO ZERO                     21850000
129700*      //DECREMENT ISSUED BEG DATE BY X DAYS                      21860000
129800       INITIALIZE DPG51 DPG52 DPG53                               21870000
129900                  DPG54 DPG55 DPG56                               21880000
130000                                                                  21890000
130100       SET DPG51-FISCAL-454-CALENDAR  TO TRUE                     21900000
130200       SET DPG51-DECREMENT-DATE       TO TRUE                     21910000
130300       SET DPG52-LK-DTE-ISO-FMT       TO TRUE                     21920000
130400       MOVE PV-PRE-BEG-DAYS-QTY       TO DPG51-INCR-DECR-DAYS-9   21930000
130500       MOVE PV-ISUD-BEG-DTE (1:10)    TO DPG52-DB2-ISO-DATE-FMT   21940033
130600                                                                  21950000
130700       MOVE 'DECREMENT BEG ISSUED DATE' TO PV-OPERATION-MSG-1     21960000
130800       PERFORM 7010-DATE-ROUTINE                                  21970000
130900       MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-MOD-ISUD-BEG-DTE      21980000
131000                                                                  21990000
131100     END-IF.                                                      22000000
131200                                                                  22010000
131300     IF PV-POST-END-DAYS-QTY NOT EQUAL TO ZERO                    22020000
131400*      //INCREMENT ISSUED END DATE BY X DAYS                      22030000
131500       INITIALIZE DPG51 DPG52 DPG53                               22040000
131600                  DPG54 DPG55 DPG56                               22050000
131700                                                                  22060000
131800       SET DPG51-FISCAL-454-CALENDAR  TO TRUE                     22070000
131900       SET DPG51-INCREMENT-DATE       TO TRUE                     22080000
132000       SET DPG52-LK-DTE-ISO-FMT       TO TRUE                     22090000
132100       MOVE PV-POST-END-DAYS-QTY      TO DPG51-INCR-DECR-DAYS-9   22100000
132200       MOVE PV-ISUD-END-DTE           TO DPG52-DB2-ISO-DATE-FMT   22110000
132300                                                                  22120000
132400       MOVE 'INCREMENT END ISSUED DATE' TO PV-OPERATION-MSG-1     22130000
132500       PERFORM 7010-DATE-ROUTINE                                  22140000
132600       MOVE DPG55-DB2-ISO-DATE-FMT    TO PV-MOD-ISUD-END-DTE      22150000
132700                                                                  22160000
132800     END-IF.                                                      22170000
132900                                                                  22180000
133000*6020-EXIT.                                                       22190000
133200                                                                  22200000
133300*----------------------------------------------------------------*22210000
133400*  6030-PROCESS-EVENT-NM-FIELD.                                   22220000
133500*  - THE MAXIMUM ALLOWABLE LENGTH OF THIS FIELD IS 30 CHARACTERS  22230000
133600*    BUT THE ENTIRE LENGTH WILL MOST OFTEN NOT BE USED.           22240000
133700*    IN ORDER FOR THE 6060-BUILD-RWD-ISUD-RECORD PARAGRAPH        22250000
133800*    TO FIGURE OUT HOW MUCH OF THE EVENT NAME TO COPY OVER        22260000
133900*    INTO THE VARIABLE LENGTH EXTRACT RECORD, IT IS NECESSARY     22270000
134000*    TO FIGURE OUT HOW MANY TRAILING SPACES EXIST.                22280000
134100*----------------------------------------------------------------*22290000
134200 6030-PROCESS-EVENT-NM-FIELD.                                     22300000
134300                                                                  22310000
134400     MOVE ZERO TO PV-EVNT-NM-TRLNG.                               22320000
134500     MOVE SPACES TO PV-RWD-EVNT-NM-RVRS.                          22330000
134600     MOVE FUNCTION REVERSE(PV-RWD-EVNT-NM) TO                     22340000
134700                           PV-RWD-EVNT-NM-RVRS.                   22350000
134800     INSPECT PV-RWD-EVNT-NM-RVRS TALLYING PV-EVNT-NM-TRLNG        22360000
134900                                 FOR LEADING " ".                 22370000
135000                                                                  22380000
135100*6030-EXIT                                                        22390000
135300                                                                  22400000
135400*----------------------------------------------------------------*22410000
135500*  6040-PROCESS-CMNT-LNE-FIELD.                                   22420000
135600*  - THE COMMENT FIELD ON THE OUTPUT RECORD IS COMPOSED OF UP TO  22430000
135700*    TWO DATABASE FIELDS.  EACH DATABASE FIELD CAN BE UP TO 42    22440000
135800*    CHARACTERS AND IF BOTH DATABASE FIELDS EXIST THEY NEED TO    22450000
135900*    HAVE A '|' CHARACTER BETWEEN THEM WHICH INDICATES WHERE ON   22460000
136000*    THE RECEIPT THE SECOND LINE SHOULD BEGIN.  ALSO, EACH COMMENT22470000
136100*    LINE IS CENTERED ON THE RECEIPT SO TRAILING SPACES MUST BE   22480000
136200*    REMOVED.                                                     22490000
136300*----------------------------------------------------------------*22500000
136400 6040-PROCESS-CMNT-LNE-FIELD.                                     22510000
136500                                                                  22520000
136600     INITIALIZE PV-RWD-RECEIPT-MSG-LINE                           22530000
136700                PV-CMNT-LNE1-TRLNG                                22540000
136800                PV-CMNT-LNE2-TRLNG                                22550000
136900                PV-COMB-CMNT-LNE-LENGTH                           22560000
137000                PV-RWD-RCPT-LNE1-IND                              22570000
137100                PV-RWD-RCPT-LNE2-IND.                             22580000
137200                                                                  22590000
137300     IF PV-RCPT-CMNT-LNE1-TXT EQUAL SPACES                        22600000
137400       SET PV-RWD-RCPT-LNE1-NULL TO TRUE                          22610000
137500     END-IF                                                       22620000
137600     IF PV-RCPT-CMNT-LNE2-TXT EQUAL SPACES                        22630000
137700       SET PV-RWD-RCPT-LNE2-NULL TO TRUE                          22640000
137800     END-IF                                                       22650000
137900                                                                  22660000
138000     IF NOT PV-RWD-RCPT-LNE1-NULL                                 22670000
138100       INITIALIZE PV-RWD-CMNT-LNE-RVRS                            22680000
138200                                                                  22690000
138300       MOVE FUNCTION REVERSE(PV-RCPT-CMNT-LNE1-TXT)               22700000
138400         TO PV-RWD-CMNT-LNE-RVRS                                  22710000
138500       INSPECT PV-RWD-CMNT-LNE-RVRS TALLYING                      22720000
138600         PV-CMNT-LNE1-TRLNG FOR LEADING " "                       22730000
138700                                                                  22740000
138800       COMPUTE PV-COMB-CMNT-LNE-LENGTH = PV-COMB-CMNT-LNE-LENGTH  22750000
138900               + (PC-CMNT-LNE-MAX-SIZE - PV-CMNT-LNE1-TRLNG)      22760000
139000     END-IF.                                                      22770000
139100                                                                  22780000
139200     IF NOT PV-RWD-RCPT-LNE2-NULL                                 22790000
139300       INITIALIZE PV-RWD-CMNT-LNE-RVRS                            22800000
139400                                                                  22810000
139500       MOVE FUNCTION REVERSE(PV-RCPT-CMNT-LNE2-TXT)               22820000
139600         TO PV-RWD-CMNT-LNE-RVRS                                  22830000
139700       INSPECT PV-RWD-CMNT-LNE-RVRS TALLYING                      22840000
139800         PV-CMNT-LNE2-TRLNG FOR LEADING " "                       22850000
139900                                                                  22860000
140000       COMPUTE PV-COMB-CMNT-LNE-LENGTH = PV-COMB-CMNT-LNE-LENGTH  22870000
140100               + (PC-CMNT-LNE-MAX-SIZE - PV-CMNT-LNE2-TRLNG)      22880000
140200     END-IF.                                                      22890000
140300                                                                  22900000
140400     EVALUATE TRUE                                                22910000
140500                                                                  22920000
140600       WHEN NOT PV-RWD-RCPT-LNE1-NULL                             22930000
140700         AND NOT PV-RWD-RCPT-LNE2-NULL                            22940000
140710           STRING PV-RCPT-CMNT-LNE1-TXT                           22950000
140720                  (1:PC-CMNT-LNE-MAX-SIZE - PV-CMNT-LNE1-TRLNG)   22960000
140730                  '|'                                             22970000
140740                  PV-RCPT-CMNT-LNE2-TXT                           22980000
140750                  (1:PC-CMNT-LNE-MAX-SIZE - PV-CMNT-LNE2-TRLNG)   22990000
140751             DELIMITED BY SIZE                                    23000000
140752             INTO PV-RWD-RECEIPT-MSG-LINE                         23010000
140753           END-STRING                                             23020000
140754***   NEED TO ADD 1 MORE DUE TO THE '|' CHARACTER                 23030000
140755           COMPUTE PV-COMB-CMNT-LNE-LENGTH =                      23040000
140756                          PV-COMB-CMNT-LNE-LENGTH + 1             23050000
140757                                                                  23060000
140758       WHEN NOT PV-RWD-RCPT-LNE1-NULL                             23070000
140759         AND PV-RWD-RCPT-LNE2-NULL                                23080000
140760           STRING PV-RCPT-CMNT-LNE1-TXT                           23090000
140770                  (1:PC-CMNT-LNE-MAX-SIZE - PV-CMNT-LNE1-TRLNG)   23100000
140771                  '| '                                            23110000
140772             DELIMITED BY SIZE                                    23120000
140773             INTO PV-RWD-RECEIPT-MSG-LINE                         23130000
140774           END-STRING                                             23140000
140775***   NEED TO ADD 2 MORE DUE TO THE '| ' CHARACTERS               23150000
140776           COMPUTE PV-COMB-CMNT-LNE-LENGTH =                      23160000
140777                          PV-COMB-CMNT-LNE-LENGTH + 2             23170000
140778                                                                  23180000
140779       WHEN PV-RWD-RCPT-LNE1-NULL                                 23190000
140780         AND NOT PV-RWD-RCPT-LNE2-NULL                            23200000
140781           STRING ' |' PV-RCPT-CMNT-LNE2-TXT                      23210000
140782                  (1:PC-CMNT-LNE-MAX-SIZE - PV-CMNT-LNE2-TRLNG)   23220000
140783             DELIMITED BY SIZE                                    23230000
140784             INTO PV-RWD-RECEIPT-MSG-LINE                         23240000
140785           END-STRING                                             23250000
140786***   NEED TO ADD 2 MORE DUE TO THE ' |' CHARACTERS               23260000
140787           COMPUTE PV-COMB-CMNT-LNE-LENGTH =                      23270000
140788                          PV-COMB-CMNT-LNE-LENGTH + 2             23280000
140789                                                                  23290000
140790       WHEN PV-RWD-RCPT-LNE1-NULL AND PV-RWD-RCPT-LNE2-NULL       23300000
140791           STRING ' | '                                           23310000
140792             DELIMITED BY SIZE                                    23320000
140793             INTO PV-RWD-RECEIPT-MSG-LINE                         23330000
140794           END-STRING                                             23340000
140795***   NEED TO ADD 3 MORE DUE TO THE ' | ' CHARACTERS              23350000
140796           COMPUTE PV-COMB-CMNT-LNE-LENGTH =                      23360000
140797                          PV-COMB-CMNT-LNE-LENGTH + 3             23370000
140798                                                                  23380000
140799       WHEN OTHER                                                 23390000
140800         CONTINUE                                                 23400000
140801                                                                  23410000
140802     END-EVALUATE.                                                23420000
140803                                                                  23430000
140804*6040-EXIT                                                        23440000
140806                                                                  23450000
140807*----------------------------------------------------------------*23460000
140808*  6050-EVALUATE-DEPTS-FOUND.                                     23470000
140809*  - BUILDS THE DEPT-LIST & CALCULATES THE LIST'S LENGTH.         23480000
140810*----------------------------------------------------------------*23490000
140820 6050-EVALUATE-DEPTS-FOUND.                                       23500000
140830                                                                  23510000
140840     INITIALIZE PV-DEPT-LIST.                                     23520000
140850     EVALUATE PV-DEPTS-FOUND                                      23530000
140860       WHEN 0                                                     23540000
140870         STRING ',,,,' DELIMITED BY SIZE                          23550000
140880         INTO PV-DEPT-LIST                                        23560000
140890         END-STRING                                               23570000
140900         MOVE PC-0-DEPT-SIZE TO PV-DEPT-FIELD-LENGTH              23580000
141000       WHEN 1                                                     23590000
141100         STRING PV-DEPT-VAR-1 ',,,,' DELIMITED BY SIZE            23600000
141200         INTO PV-DEPT-LIST                                        23610000
141300         END-STRING                                               23620000
141400         MOVE PC-1-DEPT-SIZE TO PV-DEPT-FIELD-LENGTH              23630000
141500       WHEN 2                                                     23640000
141600         STRING PV-DEPT-VAR-1 ',' PV-DEPT-VAR-2 ',,,'             23650000
141700                DELIMITED BY SIZE                                 23660000
141800         INTO PV-DEPT-LIST                                        23670000
141900         END-STRING                                               23680000
142000         MOVE PC-2-DEPT-SIZE TO PV-DEPT-FIELD-LENGTH              23690000
142100       WHEN 3                                                     23700000
142200         STRING PV-DEPT-VAR-1 ',' PV-DEPT-VAR-2 ','               23710000
142300                PV-DEPT-VAR-3 ',,' DELIMITED BY SIZE              23720000
142400         INTO PV-DEPT-LIST                                        23730000
142500         END-STRING                                               23740000
142600         MOVE PC-3-DEPT-SIZE TO PV-DEPT-FIELD-LENGTH              23750000
142700       WHEN 4                                                     23760000
142800         STRING PV-DEPT-VAR-1 ',' PV-DEPT-VAR-2 ','               23770000
142900                PV-DEPT-VAR-3 ',' PV-DEPT-VAR-4 ','               23780000
143000                DELIMITED BY SIZE                                 23790000
143100         INTO PV-DEPT-LIST                                        23800000
143200         END-STRING                                               23810000
143300         MOVE PC-4-DEPT-SIZE TO PV-DEPT-FIELD-LENGTH              23820000
143400       WHEN 5                                                     23830000
143500         STRING PV-DEPT-VAR-1 ',' PV-DEPT-VAR-2 ','               23840000
143600                PV-DEPT-VAR-3 ',' PV-DEPT-VAR-4 ','               23850000
143700                PV-DEPT-VAR-5                                     23860000
143800                DELIMITED BY SIZE                                 23870000
143900         INTO PV-DEPT-LIST                                        23880000
144000         END-STRING                                               23890000
144100         MOVE PC-5-DEPT-SIZE TO PV-DEPT-FIELD-LENGTH              23900000
144200     END-EVALUATE.                                                23910000
144300                                                                  23920000
144400*6050-EXIT.                                                       23930000
144600                                                                  23940000
144700*----------------------------------------------------------------*23950000
144800*  6060-BUILD-RWD-ISUD-RECORD                                     23960000
144900*  - BUILDS THE REWARDS ACTIVATION EXTRACT RECORD BY MOVING       23970000
145000*    MANY LOCAL VARIABLES TO THE EXTRACT RECORD LAYOUT FOUND      23980000
145100*    IN EPRD139.  THE VARIABLE LENGTH LATTER HALF OF THIS         23990000
145200*    RECORD IS STRUNG TOGETHER USING THE STRING COMMAND.          24000000
145300*    THE EXTRACT RECORD IS COMMA DELIMITED AND EACH LINE          24010000
145400*    ENDS WITH A SEMICOLON (";").                                 24020000
145500*----------------------------------------------------------------*24030000
145600 6060-BUILD-RWD-ISUD-RECORD.                                      24040000
145700                                                                  24050000
145800*    //COPY EACH FIELD OVER TO THE LAYOUT IN EPRD139              24060000
145900     MOVE XST00001-LOC-NBR  TO EP139-RWD-ISUD-STR-LOC.            24070003
146000     MOVE PV-TNDR-TYP-CDE   TO EP139-RWD-ISUD-TNDR-TYP-CDE.       24080000
146100     MOVE PV-QUALD-PRCH-AMT TO EP139-RWD-ISUD-QUALD-PRCH-AMT      24090000
146200     MOVE PV-QUALD-TOL-AMT  TO EP139-RWD-ISUD-QUALD-TOL-AMT.      24100000
146300     MOVE PV-MAX-RWD-QTY    TO EP139-RWD-ISUD-MAX-RWD-QTY.        24110000
146400     MOVE PV-RWD-DISC-AMT   TO EP139-RWD-ISUD-VALUE-AMT.          24120000
146500                                                                  24130000
146600*    //IF THE MDSE CDE ON MVS IS 2, CHANGE IT TO 0 FOR POS        24140000
146700     MOVE PV-MDSE-IE-CDE TO PV-MDSE-IE-CDE-INT.                   24150000
146800     IF PV-MDSE-IE-CDE EQUAL TO PC-MDSE-ALL-DEPTS                 24160000
146900       MOVE 0 TO PV-MDSE-IE-CDE-INT                               24170000
147000     END-IF.                                                      24180000
147100                                                                  24190000
147200     MOVE PV-MOD-ISUD-BEG-DTE(1:4) TO PV-CONV-DTE-CCYY.           24200000
147300     MOVE PV-MOD-ISUD-BEG-DTE(6:2) TO PV-CONV-DTE-MM.             24210000
147400     MOVE PV-MOD-ISUD-BEG-DTE(9:2) TO PV-CONV-DTE-DD.             24220000
147500     MOVE PV-CONV-DTE              TO EP139-RWD-ISUD-BEG-DTE.     24230000
147600                                                                  24240000
147700     MOVE PV-MOD-ISUD-END-DTE(1:4) TO PV-CONV-DTE-CCYY.           24250000
147800     MOVE PV-MOD-ISUD-END-DTE(6:2) TO PV-CONV-DTE-MM.             24260000
147900     MOVE PV-MOD-ISUD-END-DTE(9:2) TO PV-CONV-DTE-DD.             24270000
148000     MOVE PV-CONV-DTE              TO EP139-RWD-ISUD-END-DTE.     24280000
148100                                                                  24290000
148200     STRING PV-MDSE-IE-CDE-INT ','                                24300000
148300            PV-DEPT-LIST(1:PV-DEPT-FIELD-LENGTH) ','              24310000
148400            PV-RWD-EVNT-NM                                        24320000
148500                  (1:PC-EVNT-MAX-SIZE - PV-EVNT-NM-TRLNG) ','     24330000
148600            PV-RWD-RECEIPT-MSG-LINE                               24340000
148700                  (1:PV-COMB-CMNT-LNE-LENGTH)                     24350000
148800            ';'                                                   24360000
148900            DELIMITED BY SIZE                                     24370000
149000            INTO EP139-RWD-ISUD-EXTR-VAR                          24380000
149100     END-STRING.                                                  24390000
149200                                                                  24400000
149300*6060-EXIT.                                                       24410000
149500                                                                  24420000
149600*----------------------------------------------------------------*24430000
149700*  6070-WRITE-RWD-ISUD-RECORD.                                    24440000
149800*  - WRITE OUT THE VARIABLE LENGTH REWARD ACTIVATION RECORD.      24450000
149900*----------------------------------------------------------------*24460000
150000 6070-WRITE-RWD-ISUD-RECORD.                                      24470000
150100                                                                  24480000
150200*    //DETERMINE VARIABLE RECORD LENGTH                           24490000
150300     INITIALIZE PV-VAR-LNGTH.                                     24500000
150400     SET PS-LINE-END-NOT-FOUND TO TRUE.                           24510000
150500     PERFORM VARYING PV-VAR-LNGTH FROM 1 BY 1                     24520000
150600             UNTIL ( PS-LINE-END-FOUND )                          24530000
150700      IF EP139-RWD-ISUD-EXTR-VAR-TABLE (PV-VAR-LNGTH) EQUAL TO ';'24540000
150800          SET PS-LINE-END-FOUND TO TRUE                           24550000
150900          SUBTRACT 1 FROM PV-VAR-LNGTH                            24560000
151000       END-IF                                                     24570000
151100     END-PERFORM.                                                 24580000
151200                                                                  24590000
151300*    //SUB-SELECT EXTRACT RECORD UP TO CALCULATED LENGTH          24600000
151400     INITIALIZE PV-WRITE-RECORD-LENGTH.                           24610000
151500     ADD PC-RWD-ISUD-FIXED-LENGTH  TO PV-WRITE-RECORD-LENGTH.     24620000
151600     ADD PV-VAR-LNGTH              TO PV-WRITE-RECORD-LENGTH.     24630000
151700     MOVE PV-WRITE-RECORD-LENGTH   TO PV-RWD-ISD-REC-BYTE-CNT.    24640000
151800     MOVE EP139-RWD-ISUD-EXTRCT-REC(1:PV-RWD-ISD-REC-BYTE-CNT)    24650000
151900                                   TO RWD-ISUD-EXTRCT-RECORD.     24660000
152000                                                                  24670000
152100*    //WRITE & CLEAR THE EXTRACT RECORD LAYOUT                    24680000
152200     WRITE RWD-ISUD-EXTRCT-RECORD.                                24690000
152300     MOVE SPACES TO RWD-ISUD-EXTRCT-RECORD.                       24700000
152400     INITIALIZE EP139-RWD-ISUD-EXTRCT-REC.                        24710000
152500                                                                  24720000
152600*    //INCREMENT RECORDS WRITTEN                                  24730000
152700     ADD 1 TO PV-RWD-STR-WRITES.                                  24740000
152800                                                                  24750000
152900*6070-EXIT.                                                       24760000
153100                                                                  24770000
153200*----------------------------------------------------------------*24780000
153300*  6080-BUILD-AND-WRITE-RPT-REC.                                  24790000
153400*  - BUILDS A REPORT RECORD FOR A SPECIFIC REWARD EVENT ID        24800000
153500*    AS IT RELATES TO A SPECIFIC STORE LOCATION NUMBER.           24810000
153600*    THIS REPORTING IS SOLELY FOR SUPPORT PURPOSES.               24820000
153700*----------------------------------------------------------------*24830000
153800 6080-BUILD-AND-WRITE-RPT-REC.                                    24840000
153900                                                                  24850000
154000*    //CREATE A REPORT FORMATTED VERSION OF THE CUR RWD REC       24860000
154100     MOVE PV-RWD-EVNT-ID    TO RP-EVENT-ID.                       24870000
154200     MOVE PV-TNDR-TYP-CDE   TO RP-TNDR-TYP.                       24880000
154300     MOVE PV-QUALD-PRCH-AMT TO RP-QUAL-AMT.                       24890000
154400     MOVE PV-QUALD-TOL-AMT  TO RP-QUAL-TOL.                       24900000
154500     MOVE PV-MAX-RWD-QTY    TO RP-MAX-RWDS.                       24910000
154600     MOVE PV-MDSE-IE-CDE    TO RP-I-E-TYP-CDE.                    24920000
154700     MOVE PV-RWD-DISC-AMT   TO RP-RWD-VALUE.                      24930000
154800     MOVE PV-DEPT-LIST      TO RP-DEPT-LIST.                      24940000
154900     MOVE PV-RWD-EVNT-NM    TO RP-EVENT-NAME.                     24950000
155000                                                                  24960000
155100     MOVE PV-MOD-ISUD-BEG-DTE(1:4) TO PV-CONV-DTE-CCYY.           24970000
155200     MOVE PV-MOD-ISUD-BEG-DTE(6:2) TO PV-CONV-DTE-MM.             24980000
155300     MOVE PV-MOD-ISUD-BEG-DTE(9:2) TO PV-CONV-DTE-DD.             24990000
155400     MOVE PV-CONV-DTE              TO RP-STRT-DTE.                25000000
155500                                                                  25010000
155600     MOVE PV-MOD-ISUD-END-DTE(1:4) TO PV-CONV-DTE-CCYY.           25020000
155700     MOVE PV-MOD-ISUD-END-DTE(6:2) TO PV-CONV-DTE-MM.             25030000
155800     MOVE PV-MOD-ISUD-END-DTE(9:2) TO PV-CONV-DTE-DD.             25040000
155900     MOVE PV-CONV-DTE              TO RP-END-DATE.                25050000
156000                                                                  25060000
156100     IF PV-LINE-COUNT >= PC-LINES-PER-PAGE                        25070000
156200       INITIALIZE PV-LINE-COUNT                                   25080000
156300       PERFORM 7020-WRITE-REPORT-HEADERS                          25090000
156400     END-IF.                                                      25100000
156500                                                                  25110000
156600     MOVE RP-EP-DETAIL-LINE TO RWD-ISUD-EXTRCT-RPT-REC.           25120000
156700     WRITE RWD-ISUD-EXTRCT-RPT-REC.                               25130000
156800                                                                  25140000
156900*6080-EXIT.                                                       25150000
157100                                                                  25160000
157200*----------------------------------------------------------------*25170000
157300*  7010-DATE-ROUTINE.                                             25180000
157400*  - PERFORMS A CALL TO DPKUT500, KOHLS CALENDAR DATE ROUTINE.    25190000
157500*----------------------------------------------------------------*25200000
157600 7010-DATE-ROUTINE.                                               25210000
157700                                                                  25220000
157800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    25230000
157900                                             DPG54 DPG55 DPG56.   25240000
158000                                                                  25250000
158100     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  25260000
158200       MOVE '7010-DATE-ROUTINE'     TO PV-PARAGRAPH-NAME          25270000
158300       MOVE DPG54-ERROR-MESSAGE     TO PV-MSG-TEXT                25280000
158400       SET ABEND-4019-CAL-SUB-ERROR TO TRUE                       25290000
158500       PERFORM 9010-ABEND                                         25300000
158600     END-IF.                                                      25310000
158700                                                                  25320000
158800*7010-EXIT.                                                       25330000
159000                                                                  25340000
159100*----------------------------------------------------------------*25350000
159200*  7020-WRITE-REPORT-HEADERS.                                     25360000
159300*  - WRITES REPORT HEADERS OUT TO THE FLAT FILE AS A MEANS TO     25370000
159400*    SEPARATE EACH STORE'S REWARD EVENTS INFORMATION.             25380000
159500*----------------------------------------------------------------*25390000
159600 7020-WRITE-REPORT-HEADERS.                                       25400000
159700                                                                  25410000
159800     ADD +1 TO PV-PAGE-COUNT.                                     25420000
159900                                                                  25430000
160000*    //PRINT THE KOHLS STD HEADER LINE                            25440000
160100     MOVE PV-PAGE-COUNT TO DP200O-PAGE-NUMBER.                    25450000
160200     MOVE DP200O-STANDRD-HEADER-200-COLS                          25460000
160300                        TO RWD-ISUD-EXTRCT-RPT-REC.               25470000
160400     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING PAGE.          25480000
160500                                                                  25490000
160600*    //PRINT THE REPORT HEADER LINES                              25500000
160700     MOVE RP-EP-SYSTEM-ID-LINE TO RWD-ISUD-EXTRCT-RPT-REC.        25510000
160800     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25520000
160900                                                                  25530000
161000     MOVE SPACES TO RWD-ISUD-EXTRCT-RPT-REC.                      25540000
161100     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25550000
161200                                                                  25560000
161300     MOVE RP-EP-TITLE-LINE TO RWD-ISUD-EXTRCT-RPT-REC.            25570000
161400     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25580000
161500                                                                  25590000
161600     MOVE SPACES TO RWD-ISUD-EXTRCT-RPT-REC.                      25600000
161700     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25610000
161800                                                                  25620000
161900     MOVE RP-EP-STORE-GROUP-LINE TO RWD-ISUD-EXTRCT-RPT-REC.      25630000
162000     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25640000
162100                                                                  25650000
162200     MOVE RP-EP-HEADER-LINE-A TO RWD-ISUD-EXTRCT-RPT-REC.         25660000
162300     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25670000
162400                                                                  25680000
162500     MOVE RP-EP-HEADER-LINE-B TO RWD-ISUD-EXTRCT-RPT-REC.         25690000
162600     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25700000
162700                                                                  25710000
162800     MOVE SPACES TO RWD-ISUD-EXTRCT-RPT-REC.                      25720000
162900     WRITE RWD-ISUD-EXTRCT-RPT-REC AFTER ADVANCING 1 LINE.        25730000
163000                                                                  25740000
163100     MOVE PC-LINES-FOR-HDRS TO PV-LINE-COUNT.                     25750000
163200                                                                  25760000
163300*7020-EXIT.                                                       25770000
163500                                                                  25780000
163600*----------------------------------------------------------------*25790000
163700*  9010-ABEND                                                     25800000
163800*  - ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                   25810000
163900*----------------------------------------------------------------*25820000
164000 9010-ABEND.                                                      25830000
164100                                                                  25840000
164200     DISPLAY ' '.                                                 25850000
164300     DISPLAY '** ABEND           **'.                             25860000
164400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          25870000
164500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        25880000
164600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       25890000
164700     DISPLAY '** MESSAGE         ** = ' PV-MSG-TEXT.              25900000
164800                                                                  25910000
164900     CALL 'ILBOABN0' USING AB-ABEND-CODE.                         25920000
165000                                                                  25930000
165100*9010-EXIT.                                                       25940000
165200                                                                  25950041
165300                                                                  25960000
165400*----------------------------------------------------------------*25970041
165500*  9020-SQL-ABEND-ROUTINE.                                        25980041
165600*  - SQL ABEND ROUTINE.                                           25990041
165700*----------------------------------------------------------------*26000041
165800 9020-SQL-ABEND-ROUTINE.                                          26010041
165900                                                                  26020041
166000     DISPLAY ' '.                                                 26030041
166100     DISPLAY '** ABEND     **'.                                   26040041
166200     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                26050041
166300     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              26060041
166400     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               26070041
166500                                                                  26080041
166600     COPY DPPD004.                                                26090041
166700     SET ABEND-4013-DB2-ERROR TO TRUE.                            26100041
166800     CALL 'ILBOABN0' USING AB-ABEND-CODE.                         26110041
166900                                                                  26120041
167000*9020-EXIT.                                                       26130041
      ***************************************************************** 26140000
      *   9900-ORA-ERROR.                                             * 26150000
      *     ORACLE ABEND ROUTINE.                                     * 26160000
      ***************************************************************** 26170000
       9900-ORA-ERROR.                                                  26180000
                                                                        26190000
           MOVE SQLCODE    TO SQLCODE2.                                 26200005
           MOVE SQLERRD(3) TO SQLERRD3.                                 26210005
           DISPLAY '** ABEND **       ** = SQLERROR'.                   26220005
           DISPLAY '** PROGRAM        ** = ' PC-PROGRAM-NAME.           26230005
           DISPLAY '** PARAGRAPH      ** = ' PV-PARAGRAPH-NAME.         26240005
           DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  26250005
           DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  26260005
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   26270005
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  26280005
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                26290005
           DISPLAY '** OPERATION ** = ' PV-ORA-OPERATION.               26300000
                                                                        26310000
           MOVE SPACES TO WS-MSG-TEXT.                                  26320005
      *    GET FULL TEXT OF ERROR MESSAGE                               26330005
                                                                        26340005
           CALL 'SQLGLM' USING WS-MSG-TEXT,                             26350005
                               WS-MAX-SIZE,                             26360005
                               WS-MSG-LENGTH.                           26370005
           DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               26380005
                                                                        26390005
           EXEC SQL                                                     26400005
                ROLLBACK WORK RELEASE                                   26410005
           END-EXEC.                                                    26420005
                                                                        26430005
           SET ABEND-4013-ORACLE-ERROR  TO TRUE.                        26440041
                                                                        26450005
           CALL 'ILBOABN0' USING AB-ABEND-CODE.                         26460005
                                                                        26470000
      *9900-EXIT.                                                       26480000
167300*----------------------------------------------------------------*26490000
167400*  9999-WRAPUP.                                                   26500000
167500*  - END OF PROGRAM ROUTINE. CLOSES ALL FILES AND DISPLAYS        26510000
167600*    ANY DATA FROM THE PROGRAM.                                   26520000
167700*----------------------------------------------------------------*26530000
167800 9999-WRAPUP.                                                     26540000
167900                                                                  26550000
168000*    //UPDATE THE PROGRAM LAST RUN TIMESTAMP CONTROL CARD         26560000
168100     CLOSE CTRL-CRD-PGM-LAST-RUN.                                 26570000
168200     OPEN OUTPUT CTRL-CRD-PGM-LAST-RUN.                           26580000
168300     MOVE PV-CUR-SYS-TMST TO EP148-CC-PREV-ACT-CUTOFF.            26590000
168400     WRITE CTRL-CRD-PGM-LAST-RUN-REC FROM EP148-CC-CONTROL-CARD.  26600000
168500                                                                  26610000
168600*    //CLOSE ALL OPEN INPUT / OUTPUT FILES                        26620000
168700     CLOSE CTRL-CRD-PGM-LAST-RUN                                  26630000
168800           CTRL-CRD-IDENT-TYP                                     26640000
168900           CTRL-CRD-CUR-BTCH-DTE                                  26650000
169000           CTRL-CRD-ADV-OPN-DAYS                                  26660000
                 CONTROL-CARD-ORACLE-LOGIN                              26670000
169100           RWD-ISUD-EXTRCT-FLE                                    26680000
169200           RWD-ISUD-EXTRCT-RPT.                                   26690000
W36988                                                                  26700000
W36988     IF PS-SET-EMAIL-RC                                           26710000
W36988        MOVE PC-EMAIL-RETURN-CODE TO RETURN-CODE                  26720000
W36988     END-IF                                                       26730000
169300                                                                  26740000
169400     DISPLAY ' '.                                                 26750000
169500     DISPLAY '*********************************************'.     26760000
169600     DISPLAY 'PROGRAM NAME: ' PC-PROGRAM-NAME.                    26770000
169700     DISPLAY '*********************************************'.     26780000
W36988     DISPLAY 'NUMBER OF VALID REWARD EVENTS: ' PV-RWD-EVNTS-COUNT.26790000
169800     DISPLAY 'NUMBER OF REWARD RECS WRITTEN: ' PV-RWD-STR-WRITES. 26800000
169900     DISPLAY '*********************************************'.     26810000
170000                                                                  26820000
170100*9999-EXIT.                                                       26830000
170300                                                                  26840000
167700*----------------------------------------------------------------*26850000
