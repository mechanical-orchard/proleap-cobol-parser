000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MFKUT001.                                00050002
000600 AUTHOR.                 PAUL STROEDE.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            03-04-2012.                              00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*   THIS PROGRAM CREATES AN EXTRACT FILE OF EMAIL RECORDS FROM    00120031
001300*   THE FIRST DATA DELTA FILE.                                    00130000
001400******************************************************************00140002
001500                                                                  00150002
003800******************************************************************00151033
003900* CHANGE LOG:                                                    *00152033
004000*                                                                *00153033
004100* 03/04/12  INITIAL IMPLEMENTATION                                00154033
004500*           BY: PAUL STROEDE               WR/IR#: CRQ00000002065400158033
004600*                                                                *00159033
001600******************************************************************00160002
001700 ENVIRONMENT DIVISION.                                            00170002
001800******************************************************************00180002
001900                                                                  00190002
002000 CONFIGURATION SECTION.                                           00200002
002100                                                                  00210002
002200 SOURCE-COMPUTER.        IBM-3090.                                00220002
002300 OBJECT-COMPUTER.        IBM-3090.                                00230002
002400                                                                  00240002
002500 INPUT-OUTPUT SECTION.                                            00250002
002600                                                                  00260002
002700 FILE-CONTROL.                                                    00270002
002800                                                                  00280002
002900     SELECT FD-DELTA-FILE                                         00290002
003000         ASSIGN TO INP01.                                         00300002
003100                                                                  00310002
003200     SELECT EMAIL-OUTPUT-FILE                                     00320002
003300         ASSIGN TO OUT01.                                         00330002
003400                                                                  00340002
003500******************************************************************00350002
003600 DATA DIVISION.                                                   00360002
003700******************************************************************00370002
003800                                                                  00380002
003900 FILE SECTION.                                                    00390002
004000                                                                  00400002
004100 FD FD-DELTA-FILE                                                 00410002
004200     RECORDING MODE IS V                                          00420032
004300     BLOCK CONTAINS 0 RECORDS                                     00430002
004400     LABEL RECORDS ARE STANDARD.                                  00440024
004500                                                                  00450002
004600 01 FD-DELTA-REC                      PIC X(573).                 00460024
004700                                                                  00470002
004800 FD EMAIL-OUTPUT-FILE                                             00480002
004900     RECORDING MODE IS F                                          00490002
005000     BLOCK CONTAINS 0 RECORDS                                     00500002
005100     LABEL RECORDS ARE STANDARD.                                  00510002
005200                                                                  00520002
005300 01 EMAIL-OUTPUT-REC                  PIC X(273).                 00530002
005400                                                                  00540002
005500 WORKING-STORAGE SECTION.                                         00550002
005600                                                                  00560002
005700 01 ABEND-CODE                      PIC S9(4)  VALUE ZEROES.      00570024
                                                                        00571024
       01 PC-PROGRAM-COUNTERS.                                          00572024
          05 PC-ROW-COUNT                 PIC S9(30) VALUE ZEROES.      00573024
005800                                                                  00580024
005900 01 PS-PROGRAM-SWITCHES.                                          00590002
006000    05 PS-END-OF-FILE-SW            PIC X      VALUE SPACES.      00600026
006100       88 PS-END-OF-FILE                       VALUE 'Y'.         00610002
006200       88 PS-NOT-END-OF-FILE                   VALUE 'N'.         00620002
006300                                                                  00630002
006310 01  PROGRAM-VARIABLES.                                           00631002
006311     05  PV-CUSTOMER                PIC X(273) VALUE SPACES.      00631102
006312     05  PV-CUSTOMER-OUTPUT REDEFINES PV-CUSTOMER.                00631202
006320         10  PV-FIRST-NAME          PIC X(20).                    00632002
006321         10  PV-LAST-NAME           PIC X(20).                    00632102
006322         10  PV-ADDR-LINE1          PIC X(50).                    00632202
006323         10  PV-ADDR-LINE2          PIC X(50).                    00632302
006324         10  PV-CITY-NAME           PIC X(25).                    00632402
006325         10  PV-STATE-NAME          PIC X(25).                    00632502
006326         10  PV-POSTAL-CODE         PIC X(14).                    00632602
006327         10  PV-PHONE-NUMBER        PIC X(19).                    00632702
006328         10  PV-EMAIL-ADDRESS       PIC X(50).                    00632802
006350                                                                  00635002
006400*----------------------------------------------------------------*00640002
006500*    COPYBOOK FOR FIRST DATA CAP FILE                             00650002
006600*----------------------------------------------------------------*00660002
006700     COPY MFRD001.                                                00670034
006800                                                                  00680002
006900******************************************************************00690002
007000 PROCEDURE DIVISION.                                              00700002
007100******************************************************************00710002
007200                                                                  00720002
007300*--------------*                                                  00730002
007400 0000-MAINLINE.                                                   00740002
007500*--------------*                                                  00750002
007600     PERFORM 1000-INITIALIZATION.                                 00760002
007700                                                                  00770002
007800     PERFORM 2000-READ-DELTA-FILE                                 00780002
007900        UNTIL PS-END-OF-FILE.                                     00790002
008000                                                                  00800002
008100     PERFORM 5000-CLOSE-FILES.                                    00810002
                                                                        00820013
           STOP RUN.                                                    00830013
008400*----------------------------------------------------------       00840002
008500* 1000-INITIALIZATION.                                            00850002
008600*----------------------------------------------------------       00860002
008700 1000-INITIALIZATION.                                             00870002
008800                                                                  00880002
008900     OPEN OUTPUT EMAIL-OUTPUT-FILE.                               00890002
008910     OPEN INPUT  FD-DELTA-FILE.                                   00891002
           SET PS-NOT-END-OF-FILE TO TRUE.                              00892026
009000                                                                  00900002
009100*-------------------------------*                                 00910002
009200 2000-READ-DELTA-FILE.                                            00920002
009300*-------------------------------*                                 00930002
009500     READ FD-DELTA-FILE INTO DBASE-DATA-GROUP-RECORD              00950002
009600         AT END                                                   00960008
                   SET PS-END-OF-FILE TO TRUE.                          01000008
                                                                        01000124
           IF PS-NOT-END-OF-FILE                                        01001008
              IF PC-ROW-COUNT > 0                                       01001229
 10100           PERFORM 3000-EVALUATE-RECORD                           01010024
              END-IF                                                    01010124
           END-IF.                                                      01011008
010200                                                                  01020002
           ADD +1 TO PC-ROW-COUNT.                                      01021029
                                                                        01022029
010300*---------------------------------*                               01030002
010400 3000-EVALUATE-RECORD.                                            01040002
010500*---------------------------------*                               01050002
010600     IF CAP-GROUP-ID = "CURL001"                                  01060020
010610        INITIALIZE PV-CUSTOMER                                    01061002
010630     END-IF.                                                      01063002
010700                                                                  01070002
010710     IF CAP-GROUP-ID = "CUEX002"                                  01071026
010720        MOVE CUEX-OUT-FRST-NM TO PV-FIRST-NAME                    01072002
010721        MOVE CUEX-OUT-LAST-NM TO PV-LAST-NAME                     01072102
010740     END-IF.                                                      01074002
010750                                                                  01075002
010760     IF CAP-GROUP-ID = "ADEX007"                                  01076026
              IF ADEX-OUT-ADDR-TYPE-CD = "BLL1" OR                      01076130
                 PV-ADDR-LINE1 = SPACE                                  01076230
010770              MOVE ADST-OUT-LINE-1-TX TO PV-ADDR-LINE1            01077030
010771              MOVE ADST-OUT-LINE-2-TX TO PV-ADDR-LINE2            01077130
010780              MOVE ADST-OUT-CITY-NM   TO PV-CITY-NAME             01078030
010781              MOVE ADST-OUT-SBDV-1-TX TO PV-STATE-NAME            01078130
010782              MOVE ADST-OUT-PSTL-CD   TO PV-POSTAL-CODE           01078230
              END-IF                                                    01078330
010791     END-IF.                                                      01079102
010792                                                                  01079202
010793     IF CAP-GROUP-ID = "PHON008" OR                               01079330
              PV-PHONE-NUMBER = SPACE                                   01079430
010794           MOVE PHON-OUT-CMNC-TX   TO PV-PHONE-NUMBER             01079630
010800     END-IF.                                                      01080002
010801                                                                  01080102
010802     IF CAP-GROUP-ID = "EMAL009"                                  01080226
010803        MOVE EMAL-OUT-ADDR-TX   TO PV-EMAIL-ADDRESS               01080502
010805        PERFORM 4000-WRITE-OUTPUT-RECORD                          01080602
010806     END-IF.                                                      01080702
010807                                                                  01080802
010810*-----------------------------*                                   01081002
010900 4000-WRITE-OUTPUT-RECORD.                                        01090002
011000*-----------------------------*                                   01100002
012310     WRITE EMAIL-OUTPUT-REC FROM PV-CUSTOMER-OUTPUT.              01231002
012320*    INITIALIZE PV-CUSTOMER.                                      01232029
012400                                                                  01240002
012500*-----------------------------*                                   01250002
012600 5000-CLOSE-FILES.                                                01260002
012700*-----------------------------*                                   01270002
012900     CLOSE FD-DELTA-FILE.                                         01290002
013000     CLOSE EMAIL-OUTPUT-FILE.                                     01300002
021200     EJECT.                                                       02120013
