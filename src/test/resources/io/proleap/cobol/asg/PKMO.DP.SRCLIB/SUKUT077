000100******************************************************************00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300******************************************************************00030001
000400                                                                  00040001
000500 PROGRAM-ID.             SUKUT077.                                00050099
000600 AUTHOR.                 LYNN MCADAMS.                            00060001
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070001
000800 DATE-WRITTEN            FEBRUARY, 2003.                          00080099
000900 DATE-COMPILED.                                                   00090001
001000                                                                  00100001
001100*----------------------------------------------------------------*00110001
001200* THIS PROGRAM WILL PICK UP PO LINES THAT WERE VERIFIED AT ZERO. *00120099
001300* IT WILL CHECK PCT_RCVR_LNE_DTL FOR AN ACTION CODE OF 'W'.      *00130099
001400*                                                                *00140099
001500*                                                                *00150099
001600*----------------------------------------------------------------*00160001
001700                                                                  00170001
001800***************************************************************** 00180001
001900 ENVIRONMENT DIVISION.                                            00190001
002000***************************************************************** 00200001
002100 INPUT-OUTPUT SECTION.                                            00210001
002200                                                                  00220001
002300 FILE-CONTROL.                                                    00230001
002400                                                                  00240001
002500     SELECT EXTRACT-FILE1 ASSIGN TO OUT01.                        00250007
002600                                                                  00260001
002700***************************************************************** 00270001
002800 DATA DIVISION.                                                   00280001
002900***************************************************************** 00290001
003000 FILE SECTION.                                                    00300001
003100*                                                                 00310001
003200*                                                                 00320001
003300 FD  EXTRACT-FILE1                                                00330007
003400     RECORDING MODE IS F                                          00340001
003500     LABEL RECORDS ARE STANDARD                                   00350001
003600     BLOCK CONTAINS 0 RECORDS.                                    00360001
003700 01  EXTRACT-RECORD1             PIC X(300).                      00370056
003800*                                                                 00380001
003900***************************************************************** 00390001
004000 WORKING-STORAGE SECTION.                                         00400001
004100                                                                  00410001
004200 01  PS-PROGRAM-SWITCHES.                                         00420001
004300     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE 'N'.       00430001
004400         88  PS-EOF-EXTRACT-CSR                  VALUE 'Y'.       00440001
004500         88  PS-NOT-EOF-EXTRACT-CSR              VALUE 'N'.       00450001
004600     05  PS-EOF-TKRPRPM-SW            PIC X(01)  VALUE 'N'.       00460099
004700         88  PS-EOF-TKRPRPM-CSR                  VALUE 'Y'.       00470099
004800         88  PS-NOT-EOF-TKRPRPM-CSR              VALUE 'N'.       00480099
004900     05  PS-MANIFEST-DC-SW            PIC X(01)  VALUE 'N'.       00490041
005000         88  PS-MANIFEST-DC-FOUND                VALUE 'Y'.       00500041
005100         88  PS-MANIFEST-DC-NOT-FND              VALUE 'N'.       00510041
005200                                                                  00520099
005300 01  PV-PROGRAM-VARIABLES.                                        00530001
005400     05 PV-EXTRACT-DTE                PIC X(10).                  00540001
005500                                                                  00550099
005600     05 PV-CRE-DATE-TMST              PIC X(10).                  00560001
005700     05 PV-CRE-TIME-TMST              PIC X(8).                   00570001
005800                                                                  00580099
005900     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      00590001
006000                                                                  00600099
006100     05  PV-FETCH-COUNT               PIC S9(09) VALUE ZERO       00610087
006200                                                  COMP SYNC.      00620001
006300     05  PV-WRITE-EXTR1-COUNT         PIC S9(09) VALUE ZERO       00630086
006400                                                  COMP SYNC.      00640001
006500     05  PV-DISPLAY-FETCH-CNT         PIC ZZZ,ZZZ,ZZ9.            00650086
006600     05  PV-DISPLAY-WRITE-CNT1        PIC ZZZ,ZZZ,ZZ9.            00660086
006700     05  PV-DISPLAY-PO-NBR               PIC 999999999-.          00670099
006800     05  PV-DISPLAY-PO-LINE-NBR          PIC 999999999-.          00680099
006900     05  PV-DISPLAY-RCVR-SEQ-NBR         PIC 999999999-.          00690099
007000                                                                  00700099
007100     05  PV-DB2-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACE.     00710082
007200     05  PV-DB2-TABLE-NAME            PIC  X(08) VALUE SPACES.    00720099
007300     05  PV-DB2-TABLE-NAME1           PIC  X(08) VALUE SPACES.    00730099
007400     05  PV-DB2-FUNCTION             PIC X(30) VALUE SPACE.       00740099
007500                                                                  00750099
007600     05  PV-BEGIN-TMST.                                           00760099
007700         10   PV-BEGIN-DATE             PIC X(10).                00770099
007800         10   FILLER                    PIC X(01) VALUE '-'.      00780099
007900         10   PV-BEGIN-TIME             PIC X(15).                00790099
008000                                                                  00800099
008100     05  PV-END-TMST.                                             00810099
008200         10   PV-END-DATE               PIC X(10).                00820099
008300         10   FILLER                    PIC X(01) VALUE '-'.      00830099
008400         10   PV-END-TIME               PIC X(15).                00840099
008500                                                                  00850099
008600 01  PV-BEGIN-TIMESTAMP             PIC X(26).                    00860099
008700 01  PV-END-TIMESTAMP               PIC X(26).                    00870099
008800                                                                  00880082
008900 01  DK-DB-KEYS.                                                  00890082
009000     05  DK-OPER-UNT-ID              PIC S9(04) COMP.             00900082
009100     05  DK-PO-NBR                   PIC S9(09) COMP.             00910082
009200     05  DK-REC-SEQ-NBR              PIC S9(09) COMP.             00920082
009300     05  DK-LINE-NBR                 PIC S9(09) COMP.             00930082
009400                                                                  00940082
009500 01 PC-PROGRAM-CONSTANTS.                                         00950099
009600     05 PC-PROGRAM-NAME              PIC X(08)  VALUE 'SUKUT077'. 00960099
009700     05 PC-DEFAULT-TMST              PIC X(26)                    00970082
009800             VALUE '9999-09-09-09.09.09.999999'.                  00980082
009900     05 PC-C                         PIC X(01)  VALUE 'C'.        00990099
010000     05 PC-P                         PIC X(01)  VALUE 'P'.        01000099
010100     05 PC-V                         PIC X(01)  VALUE 'V'.        01010099
010200     05 PC-BEGIN-DATE                PIC X(10).                   01020099
010300     05 PC-BEGIN-TIME                PIC X(15)                    01030099
010400             VALUE '00.00.00.000000'.                             01040099
010500     05 PC-END-DATE                  PIC X(10).                   01050099
010600     05 PC-END-TIME                  PIC X(15)                    01060099
010700             VALUE '23.59.59.999999'.                             01070099
010800                                                                  01080099
010900 01  PV-ABEND-FIELDS.                                             01090099
011000     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         01100099
011100                                                 COMP SYNC.       01110099
011200     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT077'.01120099
011300     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    01130099
011400     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    01140099
011500     05  PV-ABEND-OPERATION1          PIC  X(51) VALUE SPACES.    01150099
011600     05  PV-ABEND-OPERATION2          PIC  X(51) VALUE SPACES.    01160099
011700     05  PV-ABEND-OPERATION3          PIC  X(51) VALUE SPACES.    01170099
011800     05  PV-ABEND-PO-NBR              PIC  X(10) VALUE SPACES.    01180099
011900     05  PV-ABEND-RCVR                PIC  X(10) VALUE SPACES.    01190099
012000     05  PV-ABEND-PO-LNE              PIC  X(10) VALUE SPACES.    01200099
012100     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01210099
012200     05  PV-DISPLAY-SQLCODE           PIC -9(05) VALUE ZEROES.    01220099
012300     05  PV-SQL-RETURN-CD             PIC  999-.                  01230099
012400                                                                  01240099
012500 01  CC-CONTROL-CARD.                                             01250099
012600     05  CC-CONSTANT                 PIC  X(07)      VALUE SPACE. 01260099
012700     05  FILLER                      PIC  X(01)      VALUE SPACE. 01270099
012800*    05  CC-DAYS                     PIC  9(03)      VALUE ZERO.  01280099
012900     05  CC-TIME-ZONE                PIC  X(25)      VALUE SPACE. 01290099
013000     05  FILLER                      PIC  X(44)      VALUE SPACE. 01300099
013100                                                                  01310099
013200******************************************************************01320099
013300*  USED FOR DB2 ERROR MESSAGE BUILDING                            01330099
013400******************************************************************01340099
013500     COPY DPWS004.                                                01350099
013600                                                                  01360099
013700******************************************************************01370099
013800*   DB2 SQL COMMUNICATION AREA                                    01380099
013900******************************************************************01390099
014000     EXEC SQL                                                     01400099
014100          INCLUDE SQLCA                                           01410099
014200     END-EXEC.                                                    01420099
014300*DB2 AREA FOR COMMUNICATIONS AREA2                                01430099
014400     COPY SQLCA2.                                                 01440099
014500                                                                  01450099
014600******************************************************************01460099
014700*   DB2 DCLGEN FOR PC - RECEIVER LINE DETAIL TABLE                01470099
014800*   PCT_RCVR_LNE_DTL                                              01480099
014900******************************************************************01490099
015000     EXEC SQL                                                     01500099
015100          INCLUDE PCT00007                                        01510099
015200     END-EXEC.                                                    01520099
015300                                                                  01530099
015400******************************************************************01540099
015500*   DB2 DCLGEN FOR PO-PURCHASE TABLE                              01550099
015600******************************************************************01560099
015700     EXEC SQL                                                     01570099
015800          INCLUDE TPURCHS                                         01580099
015900     END-EXEC.                                                    01590099
016000                                                                  01600099
016100******************************************************************01610099
016200*   DB2 DCLGEN FOR RC-RECEIPT ITEM TABLE                          01620099
016300******************************************************************01630099
016400     EXEC SQL                                                     01640099
016500          INCLUDE TRECITM                                         01650099
016600     END-EXEC.                                                    01660099
016700                                                                  01670099
016800******************************************************************01680099
016900*   DB2 DCLGEN FOR RC-RECEIVER TABLE                              01690099
017000******************************************************************01700099
017100     EXEC SQL                                                     01710099
017200          INCLUDE TRECEIV                                         01720099
017300     END-EXEC.                                                    01730099
017400                                                                  01740099
017500******************************************************************01750099
017600*   DB2 DCLGEN FOR DC-DISTRIBUTION TRANSACTION HEADER TABLE       01760099
017700******************************************************************01770099
017800     EXEC SQL                                                     01780099
017900          INCLUDE TDISTHD                                         01790099
018000     END-EXEC.                                                    01800099
018100                                                                  01810099
018200******************************************************************01820099
018300*   DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PARM TABLE TO     01830099
018400*   CHECK IF DC IS MANIFESTING                                    01840099
018500******************************************************************01850099
018600     EXEC SQL                                                     01860099
018700          INCLUDE TKRPRPM                                         01870099
018800     END-EXEC.                                                    01880099
018900                                                                  01890099
019000*DB2 AREA FOR THE LOGISTICS LOCATION TABLE                        01900099
019100*  XLT_LOC                                                        01910099
019200     EXEC SQL                                                     01920099
019300          INCLUDE XLT00010                                        01930099
019400     END-EXEC.                                                    01940099
019500                                                                  01950099
019600******************************************************************01960099
019700*   DB2 DCLGEN FOR COMPANY CONTROL TABLE                          01970099
019800******************************************************************01980099
019900     EXEC SQL                                                     01990099
020000          INCLUDE TCOCNTL                                         02000099
020100     END-EXEC.                                                    02010099
020200                                                                  02020099
020300                                                                  02030099
020400                                                                  02040099
020500******************************************************************02050099
020600* EXTRACT CURSOR                                                 *02060099
020700******************************************************************02070099
020800     EXEC SQL                                                     02080099
020900          DECLARE EXTRACT-CSR CURSOR FOR                          02090099
021000          SELECT A.PO_NBR                                         02100099
021100               , A.RCVR_SEQ_NBR                                   02110099
021200               , A.ACTN_CDE                                       02120099
021300               , B.ORD_LNE_NBR                                    02130099
021400               , B.STATUS_CDE                                     02140099
021500               , B.VERFYD_TMST                                    02150099
021600               , C.REC_TYP_CDE                                    02160099
021700            FROM PCT_RCVR_LNE_DTL A                               02170099
021800               , TRECITM          B                               02180099
021900               , TRECEIV          C                               02190099
022000           WHERE A.PO_NBR          = B.ORD_NBR                    02200099
022100             AND B.ORD_NBR         = C.ORD_NBR                    02210099
022200             AND A.RCVR_SEQ_NBR    = B.REC_SEQ_NBR                02220099
022300             AND B.REC_SEQ_NBR     = C.REC_SEQ_NBR                02230099
022400             AND A.OPER_UNT_ID     = :DK-OPER-UNT-ID              02240099
022500             AND A.WRKD_UNT_TMST  >= :PV-BEGIN-TIMESTAMP          02250099
022600             AND A.WRKD_UNT_TMST  <= :PV-END-TIMESTAMP            02260099
022700             AND A.ACTN_CDE = 'W'                                 02270099
022800             AND NOT C.REC_TYP_CDE IN ('AP', 'CD')                02280099
022900             WITH UR                                              02290099
023000     END-EXEC.                                                    02300099
023100                                                                  02310099
023200******************************************************************02320099
023300*  TKRPRPM CURSOR - GET DC'S IN TIMEZONE                         *02330099
023400******************************************************************02340099
023500     EXEC SQL                                                     02350099
023600          DECLARE TKRPRPM_CSR CURSOR FOR                          02360099
023700            SELECT A.LOC_NBR,                                     02370099
023800                   A.OPN_DTE,                                     02380099
023900                   A.CLO_DTE                                      02390099
024000            FROM   XLT_LOC A,                                     02400099
024100                   TKRPRPM B                                      02410099
024200            WHERE  A.LOC_TYP_CDE      = 'DC'                      02420099
024300              AND  A.LOC_NBR          = B.LOC_ID                  02430099
024400              AND  B.SYS_PRC_FUNC_CDE = 'STATZN'                  02440099
024500              AND  B.INTFC_SYS_CDE    = 'KHL'                     02450099
024600              AND  B.FUNC_TXT         = :CC-TIME-ZONE             02460099
024700            ORDER BY 1                                            02470099
024800            WITH UR                                               02480099
024900     END-EXEC.                                                    02490099
025000***********************************************************       02500099
025100*  RECORD LAYOUT FOR THE CARTON EXCEPTION EXTRACT FILE            02510099
025200***********************************************************       02520099
025300     COPY SURD036.                                                02530099
025400                                                                  02540099
025500 EJECT                                                            02550099
025600***********************************************************       02560099
025700 PROCEDURE DIVISION.                                              02570099
025800***********************************************************       02580099
025900*    DISPLAY '***BEGINNING SUKUT077***'.                          02590099
026000                                                                  02600099
026100     PERFORM 1000-INITIALIZE.                                     02610099
026200                                                                  02620099
026300     PERFORM 2000-PROCESS-EXTRACTS                                02630099
026400*        UNTIL PS-EOF-EXTRACT-CSR.                                02640099
026500         UNTIL PS-EOF-TKRPRPM-CSR.                                02650099
026600                                                                  02660099
026700     PERFORM 3530-CLOSE-TKRPRPM-CSR.                              02670099
026800                                                                  02680099
026900     PERFORM 9000-CLOSE-FILES                                     02690099
027000                                                                  02700099
027100                                                                  02710099
027200     GOBACK.                                                      02720099
027300                                                                  02730099
027400                                                                  02740099
027500******************************************************************02750099
027600*  DO FIRST TIME PROGRAM INITIALIZE TASKS.                        02760099
027700 1000-INITIALIZE.                                                 02770099
027800******************************************************************02780099
027900     OPEN OUTPUT EXTRACT-FILE1.                                   02790099
028000                                                                  02800099
028100     INITIALIZE SU036-RECORD.                                     02810099
028200                                                                  02820099
028300     ACCEPT CC-CONTROL-CARD FROM SYSIN                            02830099
028400         DISPLAY '** TIMEZONE = ' CC-TIME-ZONE                    02840099
028500                                                                  02850099
028600*FIRST FETCH                                                      02860099
028700     SET PS-NOT-EOF-TKRPRPM-CSR TO TRUE                           02870099
028800     PERFORM 3510-OPEN-TKRPRPM-CSR                                02880099
028900     PERFORM 3520-FETCH-TKRPRPM-CSR                               02890099
029000                                                                  02900099
029100     IF SQLCODE = +0                                              02910099
029200        PERFORM 2150-CHECK-IF-MFST-DC                             02920099
029300     ELSE                                                         02930099
029400        SET PS-MANIFEST-DC-NOT-FND TO TRUE                        02940099
029500     END-IF                                                       02950099
029600                                                                  02960099
029700     IF PS-MANIFEST-DC-FOUND                                      02970099
029800        PERFORM 1800-GET-BEG-END-DATES                            02980099
029900                                                                  02990099
030000        PERFORM 1850-GET-2-DAY-TMST                               03000099
030100                                                                  03010099
030200*FIRST FETCH                                                      03020099
030300        SET PS-NOT-EOF-EXTRACT-CSR TO TRUE                        03030099
030400        PERFORM 1910-OPEN-EXTRACT-CURSOR                          03040099
030500        PERFORM 1920-FETCH-EXTRACT-CSR                            03050099
030600           UNTIL PS-EOF-EXTRACT-CSR                               03060099
030700        PERFORM 1930-CLOSE-EXTRACT-CSR                            03070099
030800     ELSE                                                         03080099
030900        CONTINUE                                                  03090099
031000     END-IF.                                                      03100099
031100                                                                  03110099
031200                                                                  03120099
031300******************************************************************03130099
031400 1800-GET-BEG-END-DATES.                                          03140099
031500******************************************************************03150099
031600     EXEC SQL                                                     03160099
031700          SELECT BTCH_PRC_DTE                                     03170099
031800               , DATE(BTCH_PRC_DTE + 1 DAYS)                      03180099
031900          INTO  :PC-BEGIN-DATE                                    03190099
032000               ,:PC-END-DATE                                      03200099
032100          FROM   TCOCNTL                                          03210099
032200          WHERE  OPER_UNT_ID = 90                                 03220099
032300     END-EXEC.                                                    03230099
032400                                                                  03240099
032500     EVALUATE TRUE                                                03250099
032600         WHEN SQLCODE = ZERO                                      03260099
032700             CONTINUE                                             03270099
032800         WHEN SQLCODE = +100                                      03280099
032900             CONTINUE                                             03290099
033000         WHEN SQLWARN0 NOT = SPACES                               03300099
033100         WHEN SQLCODE < ZERO                                      03310099
033200         WHEN SQLCODE > ZERO                                      03320099
033300             MOVE '1800-GET-BEG-END-DATES'                        03330099
033400                 TO PV-PARAGRAPH-NAME                             03340099
033500             MOVE 'SELECT OF TCOCNTL TABLE'                       03350099
033600                 TO PV-ABEND-OPERATION                            03360099
033700             PERFORM Z999-SQL-ABEND                               03370099
033800     END-EVALUATE.                                                03380099
033900                                                                  03390099
034000***************************************************************** 03400099
034100 1850-GET-2-DAY-TMST.                                             03410099
034200***************************************************************** 03420099
034300     MOVE PC-BEGIN-DATE TO PV-BEGIN-DATE                          03430099
034400     MOVE PC-BEGIN-TIME TO PV-BEGIN-TIME                          03440099
034500     MOVE PV-BEGIN-TMST TO PV-BEGIN-TIMESTAMP.                    03450099
034600                                                                  03460099
034700     MOVE PC-END-DATE   TO PV-END-DATE                            03470099
034800     MOVE PC-END-TIME   TO PV-END-TIME.                           03480099
034900     MOVE PV-END-TMST   TO PV-END-TIMESTAMP.                      03490099
035000                                                                  03500099
035100                                                                  03510099
035200***************************************************************** 03520099
035300 1910-OPEN-EXTRACT-CURSOR.                                        03530099
035400***************************************************************** 03540099
035500                                                                  03550099
035600     EXEC SQL                                                     03560099
035700         OPEN EXTRACT-CSR                                         03570099
035800     END-EXEC.                                                    03580099
035900                                                                  03590099
036000     EVALUATE TRUE                                                03600099
036100         WHEN SQLCODE = +0                                        03610099
036200             CONTINUE                                             03620099
036300         WHEN SQLWARN0 NOT = SPACE                                03630099
036400         WHEN SQLCODE  NOT = +0                                   03640099
036500             MOVE '1910-OPEN-EXTRACT-CURSOR'                      03650099
036600                                 TO PV-ABEND-PARAGRAPH            03660099
036700             PERFORM Z999-SQL-ABEND                               03670099
036800     END-EVALUATE.                                                03680099
036900                                                                  03690099
037000                                                                  03700099
037100***************************************************************** 03710099
037200* GET ROWS WHERE DATE IS > CURRENT DATE MINUS 1 DAY               03720099
037300* AND ACTION CODE = 'W' AT PO/RECEIVER LEVEL                      03730099
037400 1920-FETCH-EXTRACT-CSR.                                          03740099
037500***************************************************************** 03750099
037600     MOVE '1920-FETCH-EXTRACT-CSR  ' TO PV-ABEND-PARAGRAPH.       03760099
037700                                                                  03770099
037800     EXEC SQL                                                     03780099
037900          FETCH EXTRACT-CSR                                       03790099
038000           INTO  :PCT00007-PO-NBR                                 03800099
038100               , :PCT00007-RCVR-SEQ-NBR                           03810099
038200               , :PCT00007-ACTN-CDE                               03820099
038300               , :RECITM-ORD-LNE-NBR                              03830099
038400               , :RECITM-STATUS-CDE                               03840099
038500               , :RECITM-VERFYD-TMST                              03850099
038600     END-EXEC.                                                    03860099
038700                                                                  03870099
038800     EVALUATE TRUE                                                03880099
038900         WHEN SQLCODE = +0                                        03890099
039000              ADD +1 TO PV-FETCH-COUNT                            03900099
039100              IF RECITM-STATUS-CDE = 'VE'                         03910099
039200                 PERFORM 2350-SELECT-PCT00007                     03920099
039300              ELSE                                                03930099
039400                 CONTINUE                                         03940099
039500              END-IF                                              03950099
039600         WHEN SQLCODE = +100                                      03960099
039700              SET PS-EOF-EXTRACT-CSR TO TRUE                      03970099
039800         WHEN SQLWARN0 NOT = SPACE                                03980099
039900         WHEN SQLCODE  NOT = +0                                   03990099
040000              MOVE '1920-FETCH-EXTRACT-CSR'                       04000099
040100                                   TO PV-ABEND-PARAGRAPH          04010099
040200              MOVE 'ATTEMPTING TO FETCH EXTRACT CURSOR'           04020099
040300                                   TO PV-ABEND-OPERATION          04030099
040400              MOVE PCT00007-PO-NBR     TO PV-DISPLAY-PO-NBR       04040099
040500              STRING 'PO NBR: '         DELIMITED BY SIZE         04050099
040600                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         04060099
040700                            INTO PV-ABEND-OPERATION1              04070099
040800              MOVE PCT00007-RCVR-SEQ-NBR                          04080099
040900                              TO PV-DISPLAY-RCVR-SEQ-NBR          04090099
041000              STRING 'RECV SEQ: '       DELIMITED BY SIZE         04100099
041100                  PV-DISPLAY-RCVR-SEQ-NBR                         04110099
041200                                        DELIMITED BY SIZE         04120099
041300                            INTO PV-ABEND-OPERATION2              04130099
041400              MOVE RECITM-ORD-LNE-NBR  TO PV-DISPLAY-PO-LINE-NBR  04140099
041500              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         04150099
041600                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         04160099
041700                            INTO PV-ABEND-OPERATION3              04170099
041800              PERFORM Z999-SQL-ABEND                              04180099
041900     END-EVALUATE.                                                04190099
042000                                                                  04200099
042100                                                                  04210099
042200***************************************************************** 04220099
042300 1930-CLOSE-EXTRACT-CSR.                                          04230099
042400***************************************************************** 04240099
042500                                                                  04250099
042600     EXEC SQL                                                     04260099
042700         CLOSE EXTRACT-CSR                                        04270099
042800     END-EXEC                                                     04280099
042900                                                                  04290099
043000                                                                  04300099
043100     EVALUATE TRUE                                                04310099
043200         WHEN SQLCODE = ZERO                                      04320099
043300             CONTINUE                                             04330099
043400         WHEN OTHER                                               04340099
043500             PERFORM Z999-SQL-ABEND                               04350099
043600     END-EVALUATE.                                                04360099
043700                                                                  04370099
043800                                                                  04380099
043900***************************************************************** 04390099
044000 2000-PROCESS-EXTRACTS.                                           04400099
044100***************************************************************** 04410099
044200     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       04420099
044300*NEXT FETCH                                                       04430099
044400     PERFORM 3520-FETCH-TKRPRPM-CSR                               04440099
044500     IF SQLCODE = +0                                              04450099
044600        PERFORM 2150-CHECK-IF-MFST-DC                             04460099
044700     ELSE                                                         04470099
044800        SET PS-MANIFEST-DC-NOT-FND TO TRUE                        04480099
044900     END-IF                                                       04490099
045000                                                                  04500099
045100     IF PS-MANIFEST-DC-FOUND                                      04510099
045200        PERFORM 1800-GET-BEG-END-DATES                            04520099
045300                                                                  04530099
045400        PERFORM 1850-GET-2-DAY-TMST                               04540099
045500                                                                  04550099
045600        SET PS-NOT-EOF-EXTRACT-CSR TO TRUE                        04560099
045700                                                                  04570099
045800        PERFORM 1910-OPEN-EXTRACT-CURSOR                          04580099
045900        PERFORM 1920-FETCH-EXTRACT-CSR                            04590099
046000           UNTIL PS-EOF-EXTRACT-CSR                               04600099
046100        PERFORM 1930-CLOSE-EXTRACT-CSR                            04610099
046200     ELSE                                                         04620099
046300        CONTINUE                                                  04630099
046400     END-IF.                                                      04640099
046500                                                                  04650099
046600                                                                  04660099
046700***************************************************************** 04670099
046800*CHECK TO SEE IF CARTON WAS CREATED AT MANIFESTING DC             04680099
046900 2150-CHECK-IF-MFST-DC.                                           04690099
047000***************************************************************** 04700099
047100                                                                  04710099
047200     MOVE XLT00010-LOC-NBR TO DK-OPER-UNT-ID                      04720099
047300                                                                  04730099
047400     EXEC SQL                                                     04740099
047500          SELECT FUNC_END_TMST                                    04750099
047600               , FUNC_TXT                                         04760099
047700          INTO  :KRPRPM-FUNC-END-TMST                             04770099
047800               ,:KRPRPM-FUNC-TXT                                  04780099
047900          FROM   TKRPRPM                                          04790099
048000          WHERE  SYS_PRC_FUNC_CDE  = 'DCMFST'                     04800099
048100            AND  LOC_ID            = :DK-OPER-UNT-ID              04810099
048200            AND  INTFC_SYS_CDE     = 'KHL'                        04820099
048300            AND  FUNC_PRC_STAT_CDE = 'AC'                         04830099
048400            AND  FUNC_TXT          = 'Y'                          04840099
048500            WITH UR                                               04850099
048600     END-EXEC.                                                    04860099
048700                                                                  04870099
048800     EVALUATE TRUE                                                04880099
048900         WHEN SQLCODE = ZERO                                      04890099
049000             SET PS-MANIFEST-DC-FOUND  TO TRUE                    04900099
049100         WHEN SQLCODE = +100                                      04910099
049200             SET PS-MANIFEST-DC-NOT-FND TO TRUE                   04920099
049300         WHEN SQLWARN0 NOT = SPACES                               04930099
049400         WHEN SQLCODE < ZERO                                      04940099
049500         WHEN SQLCODE > ZERO                                      04950099
049600             MOVE '2150-CHECK-IF-MFST-DC'                         04960099
049700                 TO PV-PARAGRAPH-NAME                             04970099
049800             MOVE 'SELECT OF TKRPRPM TABLE'                       04980099
049900                 TO PV-ABEND-OPERATION                            04990099
050000             PERFORM Z999-SQL-ABEND                               05000099
050100     END-EVALUATE.                                                05010099
050200                                                                  05020099
050300***************************************************************** 05030099
050400 2200-LOAD-EXTRACT-RECORD.                                        05040099
050500***************************************************************** 05050099
050600     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       05060099
050700                                                                  05070099
050800     MOVE XLT00010-LOC-NBR         TO SU036-OPER-UNT-ID.          05080099
050900     MOVE PCT00007-PO-NBR          TO SU036-PO-NUMBER.            05090099
051000     MOVE PCT00007-RCVR-SEQ-NBR    TO SU036-REC-SEQ-NBR.          05100099
051100     MOVE RECITM-ORD-LNE-NBR       TO SU036-LINE-NBR.             05110099
051200     MOVE RECITM-STATUS-CDE        TO SU036-LINE-STATUS.          05120099
051300     MOVE PURCHS-SEASET-SHRT-NM    TO SU036-SEASONAL-NAME.        05130099
051400                                                                  05140099
051500     IF RECITM-STATUS-CDE = 'VE'                                  05150099
051600       MOVE RECITM-VERFYD-TMST                                    05160099
051700            TO SU036-TMST-LINE-VERIFIED                           05170099
051800     END-IF.                                                      05180099
051900                                                                  05190099
052000     MOVE DISTHD-FCSE-CNFRMN-TMST  TO SU036-TMST-LINE-CONFIRMED.  05200099
052100     MOVE DISTHD-RSLTS-RCVD-TMST   TO SU036-TMST-LINE-P2L-UPLD.   05210099
052200     MOVE PV-DB2-CURRENT-TIMESTAMP TO SU036-TMST-CREATED.         05220099
052300                                                                  05230099
052400                                                                  05240099
052500                                                                  05250099
052600                                                                  05260099
052700***************************************************************** 05270099
052800*USING PO/RCVR/LINE FROM EXTRACT CSR:                             05280099
052900*CHECK TO SEE IF LINE IS 'C','P' OR 'V' ON PCT_RCVR_LNE_DTL       05290099
053000*IF IT IS, GET NEXT RECORD.  IF +100, WRITE TO FILE               05300099
053100 2350-SELECT-PCT00007.                                            05310099
053200***************************************************************** 05320099
053300     MOVE PCT00007-PO-NBR       TO DK-PO-NBR                      05330099
053400     MOVE PCT00007-RCVR-SEQ-NBR TO DK-REC-SEQ-NBR                 05340099
053500     MOVE RECITM-ORD-LNE-NBR    TO DK-LINE-NBR                    05350099
053600                                                                  05360099
053700     EXEC SQL                                                     05370099
053800          SELECT A.PO_NBR                                         05380099
053900               , A.RCVR_SEQ_NBR                                   05390099
054000               , A.PO_LNE_NBR                                     05400099
054100               , A.ACTN_CDE                                       05410099
054200               , B.REC_TYP_CDE                                    05420099
054300            INTO  :PCT00007-PO-NBR                                05430099
054400               ,  :PCT00007-RCVR-SEQ-NBR                          05440099
054500               ,  :PCT00007-PO-LNE-NBR                            05450099
054600               ,  :PCT00007-ACTN-CDE                              05460099
054700               ,  :RECEIV-REC-TYP-CDE                             05470099
054800            FROM PCT_RCVR_LNE_DTL A                               05480099
054900               , TRECEIV          B                               05490099
055000           WHERE A.PO_NBR       = :DK-PO-NBR                      05500099
055100             AND A.PO_NBR       = B.ORD_NBR                       05510099
055200             AND A.RCVR_SEQ_NBR = B.REC_SEQ_NBR                   05520099
055300             AND A.RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                 05530099
055400             AND A.PO_LNE_NBR   = :DK-LINE-NBR                    05540099
055500             AND A.ACTN_CDE IN ('C','P','V')                      05550099
055600             AND NOT B.REC_TYP_CDE IN ('AP', 'CD')                05560099
055700             WITH UR                                              05570099
055800     END-EXEC.                                                    05580099
055900                                                                  05590099
056000     EVALUATE TRUE                                                05600099
056100         WHEN SQLCODE = +0                                        05610099
056200         WHEN SQLCODE = -811                                      05620099
056300              CONTINUE                                            05630099
056400         WHEN SQLCODE = +100                                      05640099
056500              PERFORM 2360-SELECT-TPURCHS                         05650099
056600              PERFORM 2370-SELECT-TDISTHD                         05660099
056700              PERFORM 2200-LOAD-EXTRACT-RECORD                    05670099
056800              ADD +1 TO PV-WRITE-EXTR1-COUNT                      05680099
056900              PERFORM 8000-WRITE-EXTRACT1                         05690099
057000         WHEN SQLWARN0 NOT = SPACE                                05700099
057100         WHEN SQLCODE  NOT = +0                                   05710099
057200              MOVE '2350-SELECT-PCT00007'                         05720099
057300                                   TO PV-ABEND-PARAGRAPH          05730099
057400              MOVE 'ATTEMPTING TO SELECT PCT_RCVR_LNE_DTL'        05740099
057500                                   TO PV-ABEND-OPERATION          05750099
057600             MOVE PCT00007-PO-NBR     TO PV-DISPLAY-PO-NBR        05760099
057700             STRING 'PO NBR: '         DELIMITED BY SIZE          05770099
057800                 PV-DISPLAY-PO-NBR     DELIMITED BY SIZE          05780099
057900                           INTO PV-ABEND-OPERATION1               05790099
058000             MOVE PCT00007-RCVR-SEQ-NBR                           05800099
058100                             TO PV-DISPLAY-RCVR-SEQ-NBR           05810099
058200             STRING 'RECV SEQ: '       DELIMITED BY SIZE          05820099
058300                 PV-DISPLAY-RCVR-SEQ-NBR                          05830099
058400                                       DELIMITED BY SIZE          05840099
058500                           INTO PV-ABEND-OPERATION2               05850099
058600             MOVE PCT00007-PO-LNE-NBR TO PV-DISPLAY-PO-LINE-NBR   05860099
058700             STRING 'PO LINE NBR: '    DELIMITED BY SIZE          05870099
058800                PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE          05880099
058900                           INTO PV-ABEND-OPERATION3               05890099
059000              PERFORM Z999-SQL-ABEND                              05900099
059100     END-EVALUATE.                                                05910099
059200                                                                  05920099
059300                                                                  05930099
059400***************************************************************** 05940099
059500*GET SEASONAL SHORT NAME                                          05950099
059600 2360-SELECT-TPURCHS.                                             05960099
059700***************************************************************** 05970099
059800     EXEC SQL                                                     05980099
059900          SELECT SEASET_SHRT_NM                                   05990099
060000            INTO  :PURCHS-SEASET-SHRT-NM                          06000099
060100            FROM TPURCHS                                          06010099
060200           WHERE PO_NBR          = :DK-PO-NBR                     06020099
060300             AND VER_STATUS_CDE  = 'A'                            06030099
060400             WITH UR                                              06040099
060500     END-EXEC.                                                    06050099
060600                                                                  06060099
060700     EVALUATE TRUE                                                06070099
060800         WHEN SQLCODE = +0                                        06080099
060900              CONTINUE                                            06090099
061000         WHEN SQLCODE = +100                                      06100099
061100              CONTINUE                                            06110099
061200         WHEN SQLWARN0 NOT = SPACE                                06120099
061300         WHEN SQLCODE  NOT = +0                                   06130099
061400              MOVE '2360-SELECT-TPURCHS'                          06140099
061500                                   TO PV-ABEND-PARAGRAPH          06150099
061600              MOVE 'ATTEMPTING TO SELECT TPURCHS'                 06160099
061700                                   TO PV-ABEND-OPERATION          06170099
061800              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       06180099
061900              STRING 'PO NBR: '         DELIMITED BY SIZE         06190099
062000                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         06200099
062100                            INTO PV-ABEND-OPERATION1              06210099
062200              PERFORM Z999-SQL-ABEND                              06220099
062300     END-EVALUATE.                                                06230099
062400                                                                  06240099
062500***************************************************************** 06250099
062600*GET DATES                                                        06260099
062700 2370-SELECT-TDISTHD.                                             06270099
062800***************************************************************** 06280099
062900     EXEC SQL                                                     06290099
063000          SELECT P2L_CART_CNT                                     06300099
063100               , RSLTS_RCVD_TMST                                  06310099
063200               , FCSE_CNFRMN_TMST                                 06320099
063300            INTO  :DISTHD-P2L-CART-CNT                            06330099
063400               ,  :DISTHD-RSLTS-RCVD-TMST                         06340099
063500               ,  :DISTHD-FCSE-CNFRMN-TMST                        06350099
063600            FROM TDISTHD                                          06360099
063700           WHERE ORD_NBR      = :DK-PO-NBR                        06370099
063800             AND RCVR_SEQ_NBR = :DK-REC-SEQ-NBR                   06380099
063900             AND ORD_LNE_NBR  = :DK-LINE-NBR                      06390099
064000             WITH UR                                              06400099
064100     END-EXEC.                                                    06410099
064200                                                                  06420099
064300     EVALUATE TRUE                                                06430099
064400         WHEN SQLCODE = +0                                        06440099
064500              IF DISTHD-P2L-CART-CNT > 0                          06450099
064600                 CONTINUE                                         06460099
064700              END-IF                                              06470099
064800                                                                  06480099
064900              IF DISTHD-P2L-CART-CNT = 0                          06490099
065000                 MOVE PC-DEFAULT-TMST TO DISTHD-RSLTS-RCVD-TMST   06500099
065100              END-IF                                              06510099
065200         WHEN SQLCODE = +100                                      06520099
065300              CONTINUE                                            06530099
065400         WHEN SQLWARN0 NOT = SPACE                                06540099
065500         WHEN SQLCODE  NOT = +0                                   06550099
065600              MOVE '2370-SELECT-TDISTHD'                          06560099
065700                                   TO PV-ABEND-PARAGRAPH          06570099
065800              MOVE 'ATTEMPTING TO SELECT TDISTHD'                 06580099
065900                                   TO PV-ABEND-OPERATION          06590099
066000              MOVE DK-PO-NBR           TO PV-DISPLAY-PO-NBR       06600099
066100              STRING 'PO NBR: '         DELIMITED BY SIZE         06610099
066200                  PV-DISPLAY-PO-NBR     DELIMITED BY SIZE         06620099
066300                            INTO PV-ABEND-OPERATION1              06630099
066400              MOVE DK-REC-SEQ-NBR                                 06640099
066500                              TO PV-DISPLAY-RCVR-SEQ-NBR          06650099
066600              STRING 'RECV SEQ: '       DELIMITED BY SIZE         06660099
066700                  PV-DISPLAY-RCVR-SEQ-NBR                         06670099
066800                                        DELIMITED BY SIZE         06680099
066900                            INTO PV-ABEND-OPERATION2              06690099
067000              MOVE DK-LINE-NBR         TO PV-DISPLAY-PO-LINE-NBR  06700099
067100              STRING 'PO LINE NBR: '    DELIMITED BY SIZE         06710099
067200                 PV-DISPLAY-PO-LINE-NBR DELIMITED BY SIZE         06720099
067300                            INTO PV-ABEND-OPERATION3              06730099
067400              PERFORM Z999-SQL-ABEND                              06740099
067500     END-EVALUATE.                                                06750099
067600                                                                  06760099
067700                                                                  06770099
067800***************************************************************** 06780099
067900 3510-OPEN-TKRPRPM-CSR.                                           06790099
068000***************************************************************** 06800099
068100     MOVE '3510-OPEN-TKRPRPM-CSR'                                 06810099
068200         TO PV-ABEND-PARAGRAPH.                                   06820099
068300     MOVE 'OPEN THE TKRPRPM_CSR'                                  06830099
068400         TO PV-ABEND-OPERATION.                                   06840099
068500                                                                  06850099
068600     EXEC SQL                                                     06860099
068700         OPEN TKRPRPM_CSR                                         06870099
068800     END-EXEC.                                                    06880099
068900                                                                  06890099
069000     EVALUATE TRUE                                                06900099
069100         WHEN SQLWARN0 NOT = SPACE                                06910099
069200         WHEN SQLCODE < ZERO                                      06920099
069300         WHEN SQLCODE > ZERO                                      06930099
069400             PERFORM Z999-SQL-ABEND                               06940099
069500         WHEN SQLCODE = ZEROS                                     06950099
069600              CONTINUE                                            06960099
069700     END-EVALUATE.                                                06970099
069800                                                                  06980099
069900***************************************************************** 06990099
070000 3520-FETCH-TKRPRPM-CSR.                                          07000099
070100***************************************************************** 07010099
070200                                                                  07020099
070300     MOVE '3520-FETCH-TKRPRPM'                                    07030099
070400         TO PV-ABEND-PARAGRAPH.                                   07040099
070500     MOVE 'FETCH THE TKRPRPM_CSR'                                 07050099
070600         TO PV-ABEND-OPERATION.                                   07060099
070700                                                                  07070099
070800     EXEC SQL                                                     07080099
070900          FETCH TKRPRPM_CSR                                       07090099
071000             INTO  :XLT00010-LOC-NBR,                             07100099
071100                   :XLT00010-OPN-DTE,                             07110099
071200                   :XLT00010-CLO-DTE                              07120099
071300     END-EXEC.                                                    07130099
071400                                                                  07140099
071500     EVALUATE TRUE                                                07150099
071600         WHEN SQLCODE = +0                                        07160099
071700              CONTINUE                                            07170099
071800         WHEN SQLCODE = +100                                      07180099
071900              SET PS-EOF-TKRPRPM-CSR TO TRUE                      07190099
072000         WHEN SQLWARN0 NOT = SPACE                                07200099
072100         WHEN SQLCODE < ZERO                                      07210099
072200         WHEN SQLCODE > ZERO                                      07220099
072300             PERFORM Z999-SQL-ABEND                               07230099
072400     END-EVALUATE.                                                07240099
072500                                                                  07250099
072600                                                                  07260099
072700***************************************************************** 07270099
072800 3530-CLOSE-TKRPRPM-CSR.                                          07280099
072900***************************************************************** 07290099
073000                                                                  07300099
073100     MOVE '3530-CLOSE-TKRPRPM-CSR.'                               07310099
073200         TO PV-ABEND-PARAGRAPH.                                   07320099
073300     MOVE 'CLOSE THE TKRPRPM_CSR'                                 07330099
073400         TO PV-ABEND-OPERATION.                                   07340099
073500                                                                  07350099
073600     EXEC SQL                                                     07360099
073700         CLOSE TKRPRPM_CSR                                        07370099
073800     END-EXEC.                                                    07380099
073900                                                                  07390099
074000     EVALUATE TRUE                                                07400099
074100         WHEN SQLWARN0 NOT = SPACE                                07410099
074200         WHEN SQLCODE < ZERO                                      07420099
074300         WHEN SQLCODE > ZERO                                      07430099
074400             PERFORM Z999-SQL-ABEND                               07440099
074500         WHEN SQLCODE = ZEROS                                     07450099
074600             CONTINUE                                             07460099
074700     END-EVALUATE.                                                07470099
074800                                                                  07480099
074900***************************************************************** 07490099
075000 8000-WRITE-EXTRACT1.                                             07500099
075100***************************************************************** 07510099
075200     WRITE EXTRACT-RECORD1                                        07520099
075300       FROM SU036-RECORD.                                         07530099
075400     INITIALIZE SU036-RECORD.                                     07540099
075500                                                                  07550099
075600                                                                  07560099
075700***************************************************************** 07570099
075800 9000-CLOSE-FILES.                                                07580099
075900     DISPLAY 'BEGIN TIMESTAMP = ' PV-BEGIN-TIMESTAMP.             07590099
076000     DISPLAY 'END TIMESTAMP   = ' PV-END-TIMESTAMP.               07600099
076100                                                                  07610099
076200     MOVE PV-FETCH-COUNT          TO PV-DISPLAY-FETCH-CNT.        07620099
076300     DISPLAY 'TOTAL RECORDS FETCHED  '   PV-DISPLAY-FETCH-CNT.    07630099
076400                                                                  07640099
076500     MOVE PV-WRITE-EXTR1-COUNT    TO PV-DISPLAY-WRITE-CNT1.       07650099
076600     DISPLAY 'TOTAL VERIFIED RECS WRITTEN ' PV-DISPLAY-WRITE-CNT1.07660099
076700                                                                  07670099
076800*DISPLAY FETCH TOTAL SHOULD EQUAL WRITE TOTAL                     07680099
076900     CLOSE EXTRACT-FILE1.                                         07690099
077000                                                                  07700099
077100***************************************************************** 07710099
077200 Z999-SQL-ABEND.                                                  07720099
077300***************************************************************** 07730099
077400     MOVE SQLCODE                     TO SQLCODE2.                07740099
077500     MOVE SQLERRD(3)                  TO SQLERRD3.                07750099
077600                                                                  07760099
077700     DISPLAY '** ABEND **         ** = SQLERROR'.                 07770099
077800     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                07780099
077900     DISPLAY '** PO NUMBER ** = ' PV-DISPLAY-PO-NBR.              07790099
078000     DISPLAY '** RECEIVER  ** = ' PV-DISPLAY-RCVR-SEQ-NBR.        07800099
078100     DISPLAY '** PO LNE NBR** = ' PV-DISPLAY-PO-LINE-NBR.         07810099
078200                                                                  07820099
078300                                                                  07830099
078400     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             07840099
078500     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                07850099
078600     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME.              07860099
078700     DISPLAY '** DB2 TABLE ** = ' PV-DB2-TABLE-NAME1.             07870099
078800     DISPLAY '** SQLCODE          ** = ' SQLCODE2.                07880099
078900     DISPLAY '** ROWS PROCESSED   ** = ' SQLERRD3.                07890099
079000     DISPLAY '** SQLERRM          ** = ' SQLERRM.                 07900099
079100     DISPLAY '** SQLERRMC         ** = ' SQLERRMC.                07910099
079200                                                                  07920099
079300                                                                  07930099
079400     MOVE +4013                  TO PV-ABEND-CODE.                07940099
079500     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07950099
