000100*----------------------------------------------------------       00010000
000200 IDENTIFICATION DIVISION.                                         00020001
000300*----------------------------------------------------------       00030001
000400 PROGRAM-ID.    SVKUT078.                                         00040001
000500 AUTHOR.        CHUCK HERO.                                       00050001
000600 DATE-WRITTEN   SEPTEMBER, 2008.                                  00060001
000700                                                                  00070001
000800*----------------------------------------------------------       00080001
000900*  THIS PROGRAM TAKES THE SV CARD CHANGES FILES AND DETECTS       00090001
001000*  CHANGES IN THE METRO NUMBER, STORE NUMBER, AND FULL/CHG        00100001
001100*  INDICATOR TO DETERMINE WHEN HEADERS NEED TO BE WRITTEN.        00110001
001200*  DETAIL RECORDS ARE WRITTEN OUT AS THEY ARE RECEIVED, WITH      00120001
001300*  THE EXCEPTION THAT THE FIRST ELEVEN BYTES                      00130001
001400*  (METRO #, STORE # AND ADD/CHG IND) ARE NOT INCLUDED.           00140001
001500*----------------------------------------------------------       00150001
001600* HISTORY LOG:                                                    00160001
001700*----------------------------------------------------------       00170001
003000* DATE:                                                           00300001
003100* WR/IR#: #####                                                   00310001
003200* PROGRAMMER:                                                     00320001
003300* DESCRIPTION:                                                    00330001
003400*                                                                 00340001
003500*----------------------------------------------------------       00350001
003600                                                                  00360001
003700*----------------------------------------------------------       00370001
003800 ENVIRONMENT DIVISION.                                            00380001
003900*----------------------------------------------------------       00390001
004000 CONFIGURATION SECTION.                                           00400001
004100 SOURCE-COMPUTER.        IBM-3090.                                00410001
004200 OBJECT-COMPUTER.        IBM-3090.                                00420001
004300                                                                  00430001
004400 INPUT-OUTPUT SECTION.                                            00440001
004500                                                                  00450001
004600 FILE-CONTROL.                                                    00460001
004700                                                                  00470001
004800     SELECT SV-CARD-FILE                                          00480001
004900         ASSIGN TO INP01.                                         00490001
005000                                                                  00500001
005100     SELECT SV-CARD-FILE-WITHHDRS                                 00510001
005200       ASSIGN TO OUT01.                                           00520001
005300                                                                  00530001
005400*----------------------------------------------------------       00540001
005500 DATA DIVISION.                                                   00550001
005600*----------------------------------------------------------       00560001
005700 FILE SECTION.                                                    00570001
005800                                                                  00580001
005900*----------------------------------------------------------       00590001
006000*  INP01                                                          00600001
006100*----------------------------------------------------------       00610001
006200 FD  SV-CARD-FILE                                                 00620001
006300     BLOCK CONTAINS 0 RECORDS                                     00630001
006400     LABEL RECORDS ARE STANDARD                                   00640001
006500     RECORDING MODE IS F                                          00650001
006600     DATA RECORD IS SV-CARD-RECORD.                               00660001
006700                                                                  00670001
006800 01  SV-CARD-RECORD                    PIC X(41).                 00680002
006900                                                                  00690001
007000*----------------------------------------------------------       00700001
007100*  OUT01                                                          00710001
007200*----------------------------------------------------------       00720001
007300 FD  SV-CARD-FILE-WITHHDRS                                        00730001
007400     BLOCK CONTAINS 0 RECORDS                                     00740001
007500     LABEL RECORDS ARE STANDARD                                   00750001
007600     RECORDING MODE IS V                                          00760001
007700     DATA RECORD IS SV-OUTPUT-CARD-RECORD.                        00770001
007800                                                                  00780001
007900 01  SV-OUTPUT-CARD-RECORD.                                       00790001
008000     05 SV-OUT-CARD-DATA-RECORD                PIC  X(01)         00800001
008100                      OCCURS 1 TO 64 TIMES                        00810002
008200                      DEPENDING ON PV-OUTPUT-LENGTH.              00820001
008300                                                                  00830001
008400 WORKING-STORAGE SECTION.                                         00840001
008500                                                                  00850001
008600 01  FILLER                        PIC X(35) VALUE                00860001
008700     '*** WORKING STORAGE STARTS HERE ***'.                       00870001
008800                                                                  00880001
008900*----------------------------------------------------------       00890001
009000* DETAIL RECORD FORMAT FOR CARD FILE                              00900001
009100*----------------------------------------------------------       00910001
009200     COPY SVRD060.                                                00920001
009300                                                                  00930001
009400*----------------------------------------------------------       00940001
009500* DISTRIBUTION HEADER RECORD LAYOUT                               00950001
009600*----------------------------------------------------------       00960001
009700     COPY SVRD064.                                                00970001
009800                                                                  00980001
009900*----------------------------------------------------------       00990001
010000* WORKING STORAGE SECTION FOR CALENDAR ROUTINE                    01000001
010100*----------------------------------------------------------       01010001
010200     COPY DPWS500.                                                01020001
010300                                                                  01030001
011800*--------------------------------------------------------------*  01180001
011900* DF- DATE AND TIME FIELDS USED IN 9700-GET-CURRENT             * 01190001
012000*--------------------------------------------------------------*  01200001
012100 01  DF-DATE-TIME-FIELDS.                                         01210001
012200     05  DF-CURRENT-DATE-TIME.                                    01220001
012300         10  DF-CURRENT-DATE.                                     01230001
012400             15 DF-CURRENT-YR        PIC 9(04) VALUE ZEROES.      01240001
012500             15 DF-CURRENT-MO        PIC 9(02) VALUE ZEROES.      01250001
012600             15 DF-CURRENT-DY        PIC 9(02) VALUE ZEROES.      01260001
012700         10  DF-CURRENT-TIME.                                     01270001
012800             15 DF-CURRENT-HR        PIC 9(02) VALUE ZEROES.      01280001
012900             15 DF-CURRENT-MIN       PIC 9(02) VALUE ZEROES.      01290001
013000             15 DF-CURRENT-SEC       PIC 9(02) VALUE ZEROES.      01300001
013100     05  DF-DISPLAY-DATE.                                         01310001
013200         10  DF-DD-YR                PIC X(04) VALUE SPACES.      01320001
013300         10  FILLER                  PIC X(01) VALUE '-'.         01330001
013400         10  DF-DD-MO                PIC X(02) VALUE SPACES.      01340001
013500         10  FILLER                  PIC X(01) VALUE '-'.         01350001
013600         10  DF-DD-DY                PIC X(02) VALUE SPACES.      01360001
013700     05  DF-DISPLAY-TIME.                                         01370001
013800         10  DF-DD-HR                PIC X(02) VALUE SPACES.      01380001
013900         10  FILLER                  PIC X(01) VALUE ':'.         01390001
014000         10  DF-DD-MIN               PIC X(02) VALUE SPACES.      01400001
014100         10  FILLER                  PIC X(01) VALUE ':'.         01410001
014200         10  DF-DD-SEC               PIC X(02) VALUE SPACES.      01420001
014300                                                                  01430001
014400*----------------------------------------------------------       01440001
014500* PS- PROGRAM SWITCHES                                            01450001
014600*----------------------------------------------------------       01460001
014700 01 PROGRAM-SWITCHES.                                             01470001
014800    05 PS-SV-CARD-FILE-SW             PIC  X(01) VALUE 'N'.       01480001
014900       88 PS-END-OF-SV-CARD-FILE                 VALUE 'Y'.       01490001
015000                                                                  01500001
017000*----------------------------------------------------------       01700001
017100* PA- PROGRAM ACCUMULATORS                                        01710001
017200*----------------------------------------------------------       01720001
017300 01 PA-PROGRAM-ACCUMULATORS.                                      01730001
017400    05 PA-INPUT-CARD-RECORDS          PIC  9(09)  VALUE ZEROES.   01740001
017500    05 PA-CARD-DETAIL-WRITTEN         PIC  9(09)  VALUE ZEROES.   01750001
017600    05 PA-CHG-RCDS-DROP-CNT           PIC  9(09)  VALUE ZEROES.   01760001
017700    05 PA-HEADERS-WRITTEN             PIC  9(09)  VALUE ZEROES.   01770001
017800                                                                  01780001
017900*----------------------------------------------------------       01790001
018000* PV- PROGRAM VARIABLES                                           01800001
018100*----------------------------------------------------------       01810001
018200 01 PROGRAM-VARIABLES.                                            01820001
018300     05  PV-HOLD-METRO                PIC  X(04)  VALUE SPACES.   01830001
018400     05  PV-HOLD-STORE                PIC  X(04)  VALUE SPACES.   01840001
018500     05  PV-HOLD-ADD-CHG-IND          PIC  X(03)  VALUE SPACES.   01850001
018600     05  PV-HOLD-DAY-NIGHT            PIC  X(01)  VALUE SPACE.    01860001
018700     05  PV-INPUT-LAYOUT.                                         01870001
018800         10 FILLER                    PIC  X(11)  VALUE SPACES.   01880001
018900         10 PV-IN-DATA                PIC  X(64)  VALUE SPACES.   01890001
019000     05  PV-OUTPUT-LENGTH             PIC  9(04)  VALUE ZEROS     01900001
019100                                                  COMP.           01910001
019200                                                                  01920001
019300     05 PV-TIME-CALC                  PIC  9(06)  VALUE ZEROES.   01930001
019400     05 PV-TIME-CALC-HHMM             PIC  9(04)  VALUE ZEROES.   01940001
019500     05 PV-TIME.                                                  01950001
019600         10 PV-TIME-HH                PIC  9(02)  VALUE ZEROES.   01960001
019700         10 PV-TIME-MM                PIC  9(02)  VALUE ZEROES.   01970001
019800         10 PV-TIME-SS                PIC  9(02)  VALUE ZEROES.   01980001
019900     05 PV-TIME-HHMM.                                             01990001
020000         10 PV-TIME-HHMM-HH           PIC  9(02)  VALUE ZEROES.   02000001
020100         10 PV-TIME-HHMM-MM           PIC  9(02)  VALUE ZEROES.   02010001
020200                                                                  02020001
020300     05  PV-PARAGRAPH-NAME            PIC  X(30)  VALUE SPACES.   02030001
020400     05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.   02040001
020500     05  PV-OPERATION-MSG-2           PIC  X(40)  VALUE SPACES.   02050001
020600                                                                  02060001
020700 01  PV-VARIABLE-OUTPUT-AREA.                                     02070001
020800     05  PV-VOA-ELEMENT               OCCURS 75 TIMES             02080001
020900                                      INDEXED BY PV-VOADEX        02090001
021000                                      PIC X(01) VALUE SPACE.      02100001
021100                                                                  02110001
021200*----------------------------------------------------------       02120001
021300* PC- PROGRAM CONSTANTS                                           02130001
021400*----------------------------------------------------------       02140001
021500 01  PC-PROGRAM-CONSTANTS.                                        02150001
021600     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'SVKUT078'.02160001
021700     05  PC-HDR                       PIC  X(03) VALUE 'HDR'.     02170001
021800     05  PC-FIELD-TERM                PIC  X(01) VALUE '_'.       02180001
021900     05  PC-HDR-SUFFIX                PIC  X(01) VALUE 'N'.       02190001
022000                                                                  02200001
022100*----------------------------------------------------------       02210001
022200* ABEND CODES                                                     02220001
022300*----------------------------------------------------------       02230001
022400 01 ABEND-CODE                        PIC S9(04) VALUE +0 COMP.   02240001
022500    88 ABEND-4003-INPUT-DATA                     VALUE +4003.     02250001
022800                                                                  02280001
022900***********************************************************       02290001
023000 PROCEDURE DIVISION.                                              02300001
023100***********************************************************       02310001
023200                                                                  02320001
023300***********************************************************       02330001
023400* 0000-MAINLINE.                                                  02340001
023500*   - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.                02350001
023600***********************************************************       02360001
023700 0000-MAINLINE.                                                   02370001
023800                                                                  02380001
023900     PERFORM 1000-INITIALIZE.                                     02390001
024000                                                                  02400001
024100     PERFORM 2000-PROCESS-CARD-FILES                              02410001
024200       UNTIL PS-END-OF-SV-CARD-FILE.                              02420001
024300                                                                  02430001
024400     PERFORM 9000-END-OF-JOB.                                     02440001
024500                                                                  02450001
024600     STOP RUN.                                                    02460001
024700                                                                  02470001
024800***********************************************************       02480001
024900*   - OPEN FILES, READ FIRST RECORD OF INPUT FILE                 02490001
025000***********************************************************       02500001
025100 1000-INITIALIZE.                                                 02510001
025200     MOVE '1000-INITIALIZE'              TO PV-PARAGRAPH-NAME.    02520001
025300                                                                  02530001
025400     PERFORM 9700-GET-CURRENT.                                    02540001
025500                                                                  02550001
025600     DISPLAY '********* BEGIN ' PC-PROGRAM-NAME ' *********'.     02560001
025700     DISPLAY ' '                                                  02570001
025800     DISPLAY '**  START DATE: ' DF-DISPLAY-DATE.                  02580001
025900     DISPLAY '**  START TIME: ' DF-DISPLAY-TIME.                  02590001
026000     DISPLAY ' '                                                  02600001
026100     DISPLAY '***********************************'.               02610001
026200                                                                  02620001
026300     OPEN INPUT  SV-CARD-FILE                                     02630001
026400          OUTPUT SV-CARD-FILE-WITHHDRS.                           02640001
026500                                                                  02650001
026700     MOVE DF-CURRENT-TIME TO PV-TIME-CALC.                        02670001
026800                                                                  02680001
026900     PERFORM 7000-READ-SV-CARD-FILE.                              02690001
027000                                                                  02700001
027100     IF PS-END-OF-SV-CARD-FILE                                    02710001
027200                                                                  02720001
027300         DISPLAY '** ' PC-PROGRAM-NAME                            02730001
027400                            '                          **'        02740001
027500         DISPLAY '** NO RECORDS TO PROCESS IN THIS RUN **'        02750001
027600     ELSE                                                         02760001
027700         CONTINUE                                                 02770001
030000     END-IF.                                                      03000001
030100                                                                  03010001
030200***********************************************************       03020001
030300*  2000-PROCESS-CARD-FILES.                                       03030001
030400*     - EVALUATE HEADER DATA TO DETERMINE WHETHER A DISTRIBUTION  03040001
030500*        HEADER IS REQUIRED                                       03050001
030600*        - CALL ROUTINE TO BUILD AND WRITE IF TRUE                03060001
030700*     - BUILD OUT RECORD FOR DETAIL RECORD                        03070001
030800*     - CALL READ FOR NEXT RECORD WHEN DONE                       03080001
030900*     - DROP CHG RECORDS FOR FUL FILE METRO/STORE                 03090001
031000***********************************************************       03100001
031100 2000-PROCESS-CARD-FILES.                                         03110001
031200     MOVE '2000-PROCESS-CARD-FILES'      TO PV-PARAGRAPH-NAME.    03120001
031300                                                                  03130001
031400     IF SV060-METRO-AREA = PV-HOLD-METRO AND                      03140001
031500        SV060-EXC-STORE  = PV-HOLD-STORE AND                      03150001
031600        SV060-FUL-CHG    = PV-HOLD-ADD-CHG-IND                    03160001
031710          PERFORM 3100-BUILD-CARD-RCD                             03171001
031800     ELSE                                                         03180001
031900        IF SV060-METRO-AREA = PV-HOLD-METRO AND                   03190001
032000           SV060-EXC-STORE  = PV-HOLD-STORE AND                   03200001
032100           SV060-FUL-CHG    = 'CHG'         AND                   03210001
032200           PV-HOLD-ADD-CHG-IND = 'FUL'                            03220001
032400             DISPLAY 'CHG RCDS DROPPED FOR METRO '                03240001
032500                     SV060-METRO-AREA ', EXC STR ' SV060-EXC-STORE03250001
032600             ADD +1 TO PA-CHG-RCDS-DROP-CNT                       03260001
032800        ELSE                                                      03280001
032900             PERFORM 3000-BUILD-HEADERS                           03290001
033000             MOVE SV060-METRO-AREA TO  PV-HOLD-METRO              03300001
033100             MOVE SV060-EXC-STORE  TO  PV-HOLD-STORE              03310001
033200             MOVE SV060-FUL-CHG    TO  PV-HOLD-ADD-CHG-IND        03320001
033210             PERFORM 3100-BUILD-CARD-RCD                          03321001
033300        END-IF                                                    03330001
033400     END-IF.                                                      03340001
033500                                                                  03350001
035000     PERFORM 7000-READ-SV-CARD-FILE.                              03500001
035100                                                                  03510001
035200***********************************************************       03520001
035300*  3000-BUILD-HEADERS.                                            03530001
035400*   - POPULATES THE HEADER RECORD THAT WILL BE USED TO            03540001
035500*     SPLIT THE FILE INTO MULTIPLE FILES.                         03550001
035600*   - CALLS ROUTINE TO ADVANCE TIME FOR EACH HEADER RECORD.       03560001
035700*   - CALLS THE WRITE ROUTINE FOR THE HEADER RECORD.              03570001
035800***********************************************************       03580001
035900 3000-BUILD-HEADERS.                                              03590001
036000     MOVE '3000-BUILD-HEADERS'           TO PV-PARAGRAPH-NAME.    03600001
036100                                                                  03610001
036200     INITIALIZE SV064-SV-HEADER-RECORD.                           03620001
036300                                                                  03630001
036400     MOVE PC-HDR               TO SV064-HDR-IND.                  03640001
036500     SET  SV064-FIL-NAM-PMU    TO TRUE.                           03650001
036600     SET  SV064-FIL-NAM-TBL-SV TO TRUE.                           03660001
036700     MOVE PC-FIELD-TERM        TO SV064-UNDERSCORE-1              03670001
036800                                  SV064-UNDERSCORE-2              03680001
036900                                  SV064-UNDERSCORE-3              03690001
037000                                  SV064-UNDERSCORE-4              03700001
037100                                  SV064-UNDERSCORE-5.             03710001
037200     MOVE PC-HDR-SUFFIX        TO SV064-FILE-APPLY-TYP.           03720001
037300     MOVE ZEROES               TO SV064-STR-GP-OUT.               03730001
037400     MOVE DF-CURRENT-DATE      TO SV064-FILE-DIST-DTE             03740001
037500                                  SV064-CRT-DATE.                 03750001
037600*-- CURRENT TIME - STEP UP ONE SECOND FOR EACH HEADER             03760001
037700     MOVE PV-TIME-CALC         TO SV064-CRT-TIME.                 03770001
037800     PERFORM 6000-CALC-TIME.                                      03780001
037900                                                                  03790001
038000*    SV064-METRO-GRP  TRUE  ==> SV064-STR-GP-TYP = '02000'.       03800001
038100*    SV064-STR-GRP    TRUE  ==> SV064-STR-GP-TYP = '05000'.       03810001
038200     IF SV060-METRO-AREA = SPACES                                 03820001
038300         SET  SV064-STR-GRP    TO TRUE                            03830001
038400         MOVE SV060-EXC-STORE  TO SV064-STR-GP-ID                 03840001
038500         MOVE ZEROES           TO SV064-EXCP-STR-NBR              03850001
038600     ELSE                                                         03860001
038700         SET  SV064-METRO-GRP  TO TRUE                            03870001
038800         MOVE SV060-METRO-AREA TO SV064-STR-GP-ID                 03880001
038900                                                                  03890001
039000         IF SV060-EXC-STORE = SPACES                              03900001
039100             MOVE ZEROES          TO SV064-EXCP-STR-NBR           03910001
039200         ELSE                                                     03920001
039300             MOVE SV060-EXC-STORE TO SV064-EXCP-STR-NBR           03930001
039400         END-IF                                                   03940001
039500     END-IF.                                                      03950001
039600                                                                  03960001
039700     EVALUATE TRUE                                                03970001
039800        WHEN SV060-FUL-CHG = 'FUL'                                03980001
039900            SET SV064-FIL-TYP-FUL TO TRUE                         03990001
040000        WHEN SV060-FUL-CHG = 'CHG'                                04000001
040100            SET SV064-FIL-TYP-CHG TO TRUE                         04010001
040200        WHEN OTHER                                                04020001
040300            DISPLAY '** INVALID FILE TYPE IN INPUT CARD RECORD'   04030001
040400            DISPLAY 'RCD > ' SV060-CARD-RCD                       04040001
040500            MOVE 'INPUT FILE TYPE INVALID' TO PV-OPERATION-MSG-1  04050001
040600            MOVE SV060-FUL-CHG             TO PV-OPERATION-MSG-2  04060001
040700            SET ABEND-4003-INPUT-DATA      TO TRUE                04070001
040710            PERFORM 9900-ABEND                                    04071002
040800     END-EVALUATE.                                                04080001
040900                                                                  04090001
041000     MOVE LENGTH OF SV064-SV-HEADER-RECORD TO PV-OUTPUT-LENGTH.   04100001
041100                                                                  04110001
041200     PERFORM 7100-WRITE-HEADER-RCD.                               04120001
041300                                                                  04130001
041301***********************************************************       04130101
041302*  3100-BUILD-CARD-RCD.                                           04130201
041303*   - POPULATES THE CARD DETAIL RECORD.                           04130301
041306*   - CALLS THE WRITE ROUTINE FOR THE CARD DETAIL RECORD.         04130601
041307***********************************************************       04130701
041308 3100-BUILD-CARD-RCD.                                             04130801
041309     MOVE '3100-BUILD-CARD-RCD'          TO PV-PARAGRAPH-NAME.    04130901
041310                                                                  04131001
041320     MOVE SPACES TO PV-INPUT-LAYOUT                               04132001
041330                    PV-VARIABLE-OUTPUT-AREA.                      04133001
041340                                                                  04134001
041350     MOVE SV060-CARD-RCD TO PV-INPUT-LAYOUT.                      04135001
041360     MOVE PV-IN-DATA     TO PV-VARIABLE-OUTPUT-AREA.              04136001
041370                                                                  04137001
041390     PERFORM VARYING PV-VOADEX  FROM 75 BY -1                     04139003
041391          UNTIL PV-VOA-ELEMENT(PV-VOADEX) NOT = SPACE             04139103
041392     END-PERFORM.                                                 04139204
041393                                                                  04139301
041394     SET PV-OUTPUT-LENGTH          TO PV-VOADEX.                  04139401
041395                                                                  04139501
041396     PERFORM 7200-WRITE-CARD-DETAIL.                              04139601
041397                                                                  04139701
041400******************************************************************04140001
041500*          ADD 1 SECOND TO TIME FOR EACH HEADER RECORD WRITTEN    04150001
041600******************************************************************04160001
041700 6000-CALC-TIME.                                                  04170001
041800                                                                  04180001
041900     MOVE PV-TIME-CALC TO PV-TIME.                                04190001
042000                                                                  04200001
042100     IF PV-TIME-SS = 59                                           04210001
042200        IF PV-TIME-MM = 59                                        04220001
042300           IF PV-TIME-HH = 24                                     04230001
042400              MOVE ZEROES TO PV-TIME-HH                           04240001
042500           ELSE                                                   04250001
042600              ADD +1 TO PV-TIME-HH                                04260001
042700           END-IF                                                 04270001
042800           MOVE ZEROES TO PV-TIME-MM                              04280001
042900        ELSE                                                      04290001
043000           ADD +1 TO PV-TIME-MM                                   04300001
043100        END-IF                                                    04310001
043200        MOVE ZEROES TO PV-TIME-SS                                 04320001
043300     ELSE                                                         04330001
043400        ADD +1 TO PV-TIME-SS                                      04340001
043500     END-IF.                                                      04350001
043600                                                                  04360001
043700     MOVE PV-TIME TO PV-TIME-CALC.                                04370001
043800                                                                  04380001
043900     MOVE PV-TIME-HH TO PV-TIME-HHMM-HH.                          04390001
044000     MOVE PV-TIME-MM TO PV-TIME-HHMM-MM.                          04400001
044100                                                                  04410001
044200     MOVE PV-TIME-HHMM TO PV-TIME-CALC-HHMM.                      04420001
044300                                                                  04430001
044400 EJECT.                                                           04440001
044500***********************************************************       04450001
044600*   - READS THE SV-CARD-FILE SEQUENTIALLY.                        04460001
044700***********************************************************       04470001
044800 7000-READ-SV-CARD-FILE.                                          04480001
044900     MOVE '7000-READ-SV-CARD-FILE'       TO PV-PARAGRAPH-NAME.    04490001
045000                                                                  04500001
045100     READ SV-CARD-FILE INTO SV060-CARD-RCD                        04510001
045200         AT END                                                   04520001
045300           SET PS-END-OF-SV-CARD-FILE TO TRUE                     04530001
045400     END-READ.                                                    04540001
045500                                                                  04550001
045600     IF NOT PS-END-OF-SV-CARD-FILE                                04560001
045700        ADD +1 TO PA-INPUT-CARD-RECORDS                           04570001
045800     END-IF.                                                      04580001
045900                                                                  04590001
046000***********************************************************       04600001
046100*   - WRITES A DISTRIBUTION HEADER RECORD.                        04610001
046200***********************************************************       04620001
046300 7100-WRITE-HEADER-RCD.                                           04630001
046400     MOVE '7100-WRITE-HEADER-RCD '       TO PV-PARAGRAPH-NAME.    04640001
046500                                                                  04650001
046600     WRITE SV-OUTPUT-CARD-RECORD FROM SV064-SV-HEADER-RECORD.     04660001
046700                                                                  04670001
046800     ADD +1 TO PA-HEADERS-WRITTEN.                                04680001
046900                                                                  04690001
047000***********************************************************       04700001
047100*   - WRITES A CARD DETAIL RECORD.                                04710001
047200***********************************************************       04720001
047300 7200-WRITE-CARD-DETAIL.                                          04730001
047400     MOVE '7200-WRITE-CARD-DETAIL'       TO PV-PARAGRAPH-NAME.    04740001
047500                                                                  04750001
047600     WRITE SV-OUTPUT-CARD-RECORD FROM PV-IN-DATA.                 04760001
047700                                                                  04770001
047800     ADD +1 TO PA-CARD-DETAIL-WRITTEN.                            04780001
047900                                                                  04790001
049000***********************************************************       04900001
049100*  9000-END-OF-JOB.                                               04910001
049200*   - CLOSES INPUT AND OUTPUT FILES                               04920001
049300***********************************************************       04930001
049400 9000-END-OF-JOB.                                                 04940001
049500     MOVE '9000-END-OF-JOB'              TO PV-PARAGRAPH-NAME.    04950001
049600                                                                  04960001
049700     PERFORM 9990-DISPLAY-TOTALS.                                 04970001
049800                                                                  04980001
049900     CLOSE SV-CARD-FILE                                           04990001
050000           SV-CARD-FILE-WITHHDRS.                                 05000001
050100                                                                  05010001
050200***************************************************************** 05020001
050300*     GET CURRENT DATE AND TIME                                 * 05030001
050400***************************************************************** 05040001
050500 9700-GET-CURRENT.                                                05050001
050600                                                                  05060001
050700     MOVE FUNCTION CURRENT-DATE(1:14)                             05070001
050800       TO DF-CURRENT-DATE-TIME.                                   05080001
050900                                                                  05090001
051000     DISPLAY '  DF-CURRENT-DATE-TIME  ' DF-CURRENT-DATE-TIME      05100001
051100                                                                  05110001
051200     MOVE DF-CURRENT-YR TO DF-DD-YR.                              05120001
051300     MOVE DF-CURRENT-MO TO DF-DD-MO.                              05130001
051400     MOVE DF-CURRENT-DY TO DF-DD-DY.                              05140001
051500     MOVE DF-CURRENT-HR TO DF-DD-HR.                              05150001
051600     MOVE DF-CURRENT-MIN TO DF-DD-MIN.                            05160001
051700     MOVE DF-CURRENT-SEC TO DF-DD-SEC.                            05170001
051800                                                                  05180001
052100******************************************************************05210001
052200*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   05220001
052300******************************************************************05230001
052400 9900-ABEND.                                                      05240001
052500                                                                  05250001
052600     PERFORM 9990-DISPLAY-TOTALS.                                 05260001
052700                                                                  05270001
052800     DISPLAY '** ABEND           **'.                             05280001
052900     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          05290001
053000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05300001
053100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05310001
053200     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05320001
053300                                                                  05330001
053400     CALL 'ILBOABN0' USING ABEND-CODE.                            05340001
053500                                                                  05350001
053700**************************************************************    05370001
053800*  9990-DISPLAY-TOTALS.                                           05380001
053900**************************************************************    05390001
054000 9990-DISPLAY-TOTALS.                                             05400001
054100     MOVE '9990-DISPLAY-TOTALS'          TO PV-PARAGRAPH-NAME.    05410001
054200                                                                  05420001
054300     DISPLAY '***********************************************'.   05430001
054400     DISPLAY '**     EOJ STATISTICS FOR SVKUT078           **'    05440001
054500     DISPLAY '***********************************************'.   05450001
054600                                                                  05460001
054700     DISPLAY ' '.                                                 05470001
054800     DISPLAY 'CARD RECORDS IN =========> ' PA-INPUT-CARD-RECORDS. 05480001
054900     DISPLAY 'CARD DETAIL WRITTEN =====> ' PA-CARD-DETAIL-WRITTEN.05490001
055000     DISPLAY 'CHG CARD DETAIL DROPPED => ' PA-CHG-RCDS-DROP-CNT.  05500001
055100     DISPLAY 'HEADER RECORDS WRITTEN ==> ' PA-HEADERS-WRITTEN.    05510001
055200     DISPLAY '***********************************************'.   05520001
055300                                                                  05530001
055400***************************  END OF PROGRAM  *****************    05540001
