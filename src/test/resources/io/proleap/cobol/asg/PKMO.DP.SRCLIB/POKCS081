000100 IDENTIFICATION DIVISION.                                         00010030
000200 PROGRAM-ID.    POKCS081.                                         00020030
000300 AUTHOR.        DENNIS STEFFEN - OMNI RESOURCES.                  00030030
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040030
000500 DATE-WRITTEN.  MAY 1996.                                         00050030
000600 DATE-COMPILED.                                                   00060030
000700                                                                  00070030
000800*---------------------------------------------------------------* 00080030
000900*    W081 - SHIPPING WINDOW INQUIRY LIST                        * 00090030
001000*                                                               * 00100030
001100*    THIS PROGRAM GENERATES A HISTORY LIST OF SHIPPING WINDOW   * 00110030
001200*    CHANGES.                                                   * 00120030
001300*---------------------------------------------------------------* 00130030
C98147* 11/17/14 - LINDA FRIESS          - CHG0098147                   00140055
C98147*    - EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND INCREASED        00150055
C98147*      MAP FILLER                                                 00160055
C98147*----------------------------------------------------------------*00170055
076319* DATE  10/27/2021                                                00171057
076320*            - CHANGE CALL OF 'DPKUT100' TO                     * 00172057
076321*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00173057
076322*              MAKING THE CALL DYNAMIC VS STATIC                * 00174057
076323*     MADE BY: GERMAN BANDA            WR/IR #: CHG0263126        00175058
076312*                                                               * 00176057
076318*---------------------------------------------------------------* 00177057
CICS  *  CHANGED 11/15/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00178060
CICS  *                                                               * 00179059
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00179159
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00179259
CICS  *---------------------------------------------------------------* 00179359
001400                                                                  00180030
001500 ENVIRONMENT DIVISION.                                            00190030
001600 DATA DIVISION.                                                   00200030
001700                                                                  00210030
001800 WORKING-STORAGE SECTION.                                         00220030
001900                                                                  00230030
002000 01  DK-DB2-KEYS.                                                 00240030
002100     05  DK-REC-SEQ-NBR          PIC S9(09) COMP VALUE +0.        00250030
002200                                                                  00260030
002300 01  PC-PROGRAM-CONSTANTS.                                        00270030
002400     05  PC-CURRENT-MAP-NAME     PIC  X(08)  VALUE  'PO081A  '.   00280030
002500     05  PC-CURRENT-MAPSET-NAME  PIC  X(08)  VALUE  'POKM081 '.   00290030
002600     05  PC-CURRENT-PROGRAM-NAME PIC  X(08)  VALUE  'POKCS081'.   00300030
002700     05  PC-LIST-QUEUE-SEQ       PIC  9(01)  VALUE 1.             00310030
002800     05  PC-SEL-QUEUE-SEQ        PIC  9(01)  VALUE 2.             00320030
002900     05  PC-A                    PIC  X(01)  VALUE 'A'.           00330030
003000     05  PC-SPACES               PIC  X(08) VALUE SPACES.         00340030
003100     05  PC-NULL-TMST            PIC X(26) VALUE                  00350030
003200                                  '0001-01-01-01.01.01.000000'.   00360030
003300     05  PC-ITEMS-PER-PANEL      PIC S9(04)  VALUE +8             00370030
003400                                             COMP SYNC.           00380030
003500     05  PC-MAX-BLOCKS-IN-ARRAY  PIC S9(04)  VALUE +2             00390030
003600                                                    COMP SYNC.    00400030
003700     05  PC-MAX-ITEMS            PIC S9(09)  VALUE  +1000000      00410030
003800                                                    COMP-3.       00420030
003900     05  PC-MSG-NUMBER-LENGTH    PIC S9(04)  VALUE +7             00430030
004000                                             COMP SYNC.           00440030
004100     05  PC-TSYMSG-NUMBERS.                                       00450030
004200         10  PC-TSYMSG-00008     PIC  9(05)  VALUE 00008.         00460030
004300         10  PC-TSYMSG-00050     PIC  9(05)  VALUE 00050.         00470030
004400         10  PC-TSYMSG-00052     PIC  9(05)  VALUE 00052.         00480030
004500         10  PC-TSYMSG-00069     PIC  9(05)  VALUE 00069.         00490030
004600         10  PC-TSYMSG-00070     PIC  9(05)  VALUE 00070.         00500030
004700         10  PC-TSYMSG-00101     PIC  9(05)  VALUE 00101.         00510030
004800         10  PC-TSYMSG-00279     PIC  9(05)  VALUE 00279.         00520030
004900         10  PC-TSYMSG-00984     PIC  9(05)  VALUE 00984.         00530030
005000                                                                  00540030
005100 01  PS-PROGRAM-SWITCHES.                                         00550030
005200     05  PS-ERROR-SW             PIC  X(01)  VALUE 'Y'.           00560030
005300         88  PS-NO-ERROR                     VALUE 'Y'.           00570030
005400         88  PS-ERROR                        VALUE 'N'.           00580030
005500     05  PS-COMMAREA-SW          PIC  X(01)  VALUE 'N'.           00590030
005600         88  PS-COMMAREA-VALID               VALUE 'Y'.           00600030
005700         88  PS-COMMAREA-NOT-VALID           VALUE 'N'.           00610030
005800                                                                  00620030
005900 01  PV-PROGRAM-VARIABLES.                                        00630030
006000     05  PV-DPKUT038             PIC X(08)  VALUE 'DPKUT038'.     00640030
006100     05  PV-DPKUT038-CA-LENGTH   PIC S9(04) VALUE +1237           00650030
006200                                                COMP.             00660030
006300     05  PV-NULL-IND             PIC S9(04) VALUE +0 COMP SYNC.   00670030
006400     05  PV-DB2-DATE-HOST        PIC  X(10).                      00680030
006500     05  PV-CICS-RESPONSE        PIC S9(04) VALUE +0              00690030
006600                                                 COMP SYNC.       00700030
006700     05  PV-SUB                  PIC S9(04)  VALUE +0             00710030
006800                                                 COMP SYNC.       00720030
006900     05  PV-REMAINDER            PIC S9(04)  VALUE +0             00730030
007000                                                 COMP SYNC.       00740030
007100     05  PV-READ-COUNT           PIC S9(09)  VALUE +0             00750030
007200                                                    COMP-3.       00760030
007300     05  PV-ITEMS-PROCESSED      PIC S9(09)  VALUE +0             00770030
007400                                                    COMP-3.       00780030
007500     05  PV-HOLD-SELECTED-ITEMS  PIC S9(09)  VALUE +0             00790030
007600                                                    COMP-3.       00800030
007700     05  PV-ITEM-IN-USE          PIC S9(09)  VALUE +0             00810030
007800                                                    COMP-3.       00820030
007900     05  PV-TOP-ITEM             PIC S9(09)  VALUE +0             00830030
008000                                                    COMP-3.       00840030
008100     05  PV-BOTTOM-ITEM          PIC S9(09)  VALUE +0             00850030
008200                                                    COMP-3.       00860030
008300     05  PV-TEMP-BLOCK-NUMBER    PIC S9(09)  VALUE +0             00870030
008400                                                    COMP-3.       00880030
008500     05  PV-BLOCK-NUMBER         PIC S9(04)  VALUE +0             00890030
008600                                                    COMP SYNC.    00900030
008700     05  PV-CICS-RESP            PIC S9(04)  VALUE +0             00910030
008800                                                    COMP SYNC.    00920030
008900     05  PV-ITEM                 PIC S9(04)  VALUE +0             00930030
009000                                                    COMP SYNC.    00940030
009100     05  PV-SEL-QUEUE-ITEM       PIC S9(04)  VALUE +0             00950030
009200                                                    COMP SYNC.    00960030
009300     05  PV-HIGHEST-BLOCK-WRITTEN PIC S9(04)  VALUE +0            00970030
009400                                                    COMP SYNC.    00980030
009500     05  PV-LIST-ITEM-NUMBER     PIC S9(04)  VALUE +0             00990030
009600                                                    COMP SYNC.    01000030
009700     05  PV-FIRST-BLOCK-IN-ARRAY PIC S9(04)  VALUE +0             01010030
009800                                                    COMP SYNC.    01020030
009900     05  PV-NEXT-BLOCK-IN-ARRAY  PIC S9(04)  VALUE +0             01030030
010000                                                    COMP SYNC.    01040030
010100     05  PV-PREV-BLOCK-IN-ARRAY  PIC S9(04)  VALUE +0             01050030
010200                                                    COMP SYNC.    01060030
010300     05  PV-FIRST-BLOCK-IN-RANGE PIC S9(04)  VALUE +0             01070030
010400                                                    COMP SYNC.    01080030
010500     05  PV-LAST-BLOCK-IN-RANGE  PIC S9(04)  VALUE +0             01090030
010600                                                    COMP SYNC.    01100030
010700     05  PV-START-OF-SELECTED-RANGE                               01110030
010800                                 PIC S9(04)  VALUE +0             01120030
010900                                                    COMP SYNC.    01130030
011000     05  PV-END-OF-SELECTED-RANGE                                 01140030
011100                                 PIC S9(04)  VALUE +0             01150030
011200                                                    COMP SYNC.    01160030
011300     05  PV-RETRY-COUNTER        PIC S9(04)  VALUE +0             01170030
011400                                                    COMP SYNC.    01180030
011500     05  PV-DB2-HH               PIC S9(8) COMP VALUE ZERO.       01190030
011600     05  PV-DB2-MM               PIC S9(8) COMP VALUE ZERO.       01200030
011700     05  PV-UPD-DATE             PIC X(10) VALUE SPACES.          01210030
011800     05  PV-UPD-TIME.                                             01220030
011900         10  PV-UPD-HH           PIC 99.                          01230030
012000         10  FILLER              PIC X VALUE ':'.                 01240030
012100         10  PV-UPD-MM           PIC 99.                          01250030
012200     05  PV-CURRENT-DATE         PIC X(06)  VALUE SPACE.          01260030
012300     05  FILLER  REDEFINES  PV-CURRENT-DATE.                      01270030
012400         10  PV-CURRENT-YEAR     PIC X(02).                       01280030
012500         10  PV-CURRENT-MONTH    PIC X(02).                       01290030
012600         10  PV-CURRENT-DAY      PIC X(02).                       01300030
026900     05  PV-CHANGED-DTE          PIC X(08).                       01310046
027100     05  PV-CHANGED-TME          PIC X(05).                       01320046
027300     05  PV-CULPRIT              PIC X(20).                       01330046
 27400     05  PV-START-X-FCTR-DTE     PIC X(10).                       01340049
027400     05  PV-LAST-X-FCTR-DTE      PIC X(10).                       01350049
027400     05  PV-DONT-SHIP-BEF-DTE    PIC X(10).                       01360049
027600     05  PV-CANCEL-DTE           PIC X(10).                       01370049
027800     05  PV-EXT-CAN-DTE          PIC X(10).                       01380049
012700 01  ST-SYSTEM-TIME-AREA.                                         01390030
012800     05  ST-ABSTIME              PIC S9(16) VALUE +0              01400030
012900                                                 COMP SYNC.       01410030
013000     05  ST-TIME-EDIT.                                            01420030
013100         10  ST-TIME-HHMM        PIC X(05)  VALUE SPACES.         01430030
013200         10  FILLER              PIC X(03)  VALUE SPACES.         01440030
013300                                                                  01450030
013400*---------------------------------------------------------------* 01460030
013500*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01470030
013600*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01480030
013700*   APPLICATION-SPECIFIC COMMAREA.                              * 01490030
013800*---------------------------------------------------------------* 01500030
013900 01  LQW-LIST-QUEUE-WORK-AREA.                                    01510030
014000     05  LQW-BLOCK-MODIFIED      PIC  X(01)  VALUE SPACE.         01520030
014100     05  LQW-ITEM-ENTRIES               OCCURS 8 TIMES            01530030
014200                                        INDEXED BY LQW-IDX.       01540030
014300         10  LQW-LIST-ITEM-NUMBER                                 01550030
014400                                 PIC S9(09)  COMP-3.              01560030
014500         10  LQW-CHANGED-DTE     PIC  X(08).                      01570030
014600         10  LQW-CHANGED-TME     PIC  X(05).                      01580030
014700         10  LQW-CULPRIT         PIC  X(20).                      01590030
014800         10  LQW-DO-NOT-SHIP-DTE PIC  X(08).                      01600030
014900         10  LQW-CANCEL-DTE      PIC  X(08).                      01610030
015000         10  LQW-EXTCAN-DTE      PIC  X(08).                      01620030
015800                                                                  01630030
015900/                                                                 01640030
016000*---------------------------------------------------------------* 01650030
016100*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 01660030
016200*---------------------------------------------------------------* 01670030
016300     COPY RCWS013.                                                01680030
016400/                                                                 01690030
016500*---------------------------------------------------------------* 01700030
016600*    MAP LAYOUT                                                 * 01710030
016700*---------------------------------------------------------------* 01720030
016800     COPY POKM081.                                                01730030
016900                                                                  01740030
017000 01  MR-OCCURS-LAYOUT            REDEFINES  PO081AO.              01750035
C98147     05  FILLER                  PIC X(209).                      01760055
017200                                                                  01770030
017300     05  MR-SCROLL-AREA          OCCURS 8 TIMES.                  01780030
017400                                                                  01790030
017500         10  MR-CHANGED-DTEL     PIC S9(04) COMP.                 01800030
017600         10  MR-CHANGED-DTEA     PIC  X(01).                      01810030
017700         10  MR-CHANGED-DTEC     PIC  X(01).                      01820030
017800         10  MR-CHANGED-DTEH     PIC  X(01).                      01830030
017900         10  MR-CHANGED-DTE      PIC  X(08).                      01840030
018000                                                                  01850030
018100         10  MR-CHANGED-TMEL     PIC S9(04) COMP.                 01860030
018200         10  MR-CHANGED-TMEA     PIC  X(01).                      01870030
018300         10  MR-CHANGED-TMEC     PIC  X(01).                      01880030
018400         10  MR-CHANGED-TMEH     PIC  X(01).                      01890030
018500         10  MR-CHANGED-TME      PIC  X(05).                      01900030
018600                                                                  01910030
018700         10  MR-CULPRIT-L        PIC S9(04) COMP.                 01920030
018800         10  MR-CULPRIT-A        PIC  X(01).                      01930030
018900         10  MR-CULPRIT-C        PIC  X(01).                      01940030
019000         10  MR-CULPRIT-H        PIC  X(01).                      01950030
019100         10  MR-CULPRIT          PIC  X(18).                      01960032
019110                                                                  01970032
019120         10  MR-START-X-FACT-DTEL PIC S9(04) COMP.                01980035
019130         10  MR-START-X-FACT-DTEA PIC X(01).                      01990035
019140         10  MR-START-X-FACT-DTEC PIC X(01).                      02000035
019150         10  MR-START-X-FACT-DTEH PIC X(01).                      02010035
019160         10  MR-START-X-FACT-DTE PIC  X(08).                      02020035
019170                                                                  02030033
019180         10  MR-LAST-X-FACT-DTEL PIC S9(04) COMP.                 02040035
019190         10  MR-LAST-X-FACT-DTEA PIC X(01).                       02050035
019191         10  MR-LAST-X-FACT-DTEC PIC X(01).                       02060035
019192         10  MR-LAST-X-FACT-DTEH PIC X(01).                       02070035
019193         10  MR-LAST-X-FACT-DTE  PIC  X(08).                      02080035
019200                                                                  02090030
019300         10  MR-DO-NOT-SHIP-DTEL PIC S9(04) COMP.                 02100030
019400         10  MR-DO-NOT-SHIP-DTEA PIC  X(01).                      02110030
019500         10  MR-DO-NOT-SHIP-DTEC PIC  X(01).                      02120030
019600         10  MR-DO-NOT-SHIP-DTEH PIC  X(01).                      02130030
019700         10  MR-DO-NOT-SHIP-DTE  PIC  X(08).                      02140030
019800                                                                  02150030
019900         10  MR-CANCEL-DTEL      PIC S9(04) COMP.                 02160030
020000         10  MR-CANCEL-DTEA      PIC  X(01).                      02170030
020100         10  MR-CANCEL-DTEC      PIC  X(01).                      02180030
020200         10  MR-CANCEL-DTEH      PIC  X(01).                      02190030
020300         10  MR-CANCEL-DTE       PIC  X(08).                      02200030
020400                                                                  02210030
020500         10  MR-EXTCAN-DTEL      PIC S9(04) COMP.                 02220030
020600         10  MR-EXTCAN-DTEA      PIC  X(01).                      02230030
020700         10  MR-EXTCAN-DTEC      PIC  X(01).                      02240030
020800         10  MR-EXTCAN-DTEH      PIC  X(01).                      02250030
020900         10  MR-EXTCAN-DTE       PIC  X(08).                      02260030
021000                                                                  02270030
021100/                                                                 02280030
021200*---------------------------------------------------------------* 02290030
021300*    ATTRIBUTE SETTINGS                                         * 02300030
021400*---------------------------------------------------------------* 02310030
021500     COPY DPWS015.                                                02320030
021600/                                                                 02330030
021700*---------------------------------------------------------------* 02340030
021800*    FUNCTION KEYS                                              * 02350030
021900*---------------------------------------------------------------* 02360030
022000     COPY DPWS016.                                                02370030
022100/                                                                 02380030
022200*---------------------------------------------------------------* 02390030
022300*    NUMERIC EDIT LAYOUT.                                       * 02400030
022400*---------------------------------------------------------------* 02410030
022500     COPY DPWS010I.                                               02420030
022600/                                                                 02430030
022700*---------------------------------------------------------------* 02440030
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02450059
022900*---------------------------------------------------------------* 02460030
023000     COPY DPWS030.                                                02470030
CICS       COPY DPWS930.                                                02471059
023100/                                                                 02480030
023200*---------------------------------------------------------------* 02490030
023300*    STANDARD COMMAREA.                                         * 02500030
023400*---------------------------------------------------------------* 02510030
023500     COPY DPWS020.                                                02520030
023600     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02530030
023700/                                                                 02540030
023800*---------------------------------------------------------------* 02550030
023900* INTER-APPLICATION COMMAREA.                                   * 02560030
024000*---------------------------------------------------------------* 02570030
024100         10  INTER-APPL-COMM-AREA PIC X(200).                     02580030
024200     COPY POWS017.                                                02590030
024300/                                                                 02600030
024400*---------------------------------------------------------------* 02610030
024500*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02620030
024600*---------------------------------------------------------------* 02630030
024700         10  ASC-SPECIFIC-COMMAREA.                               02640030
024800             15  ASC-HEADING-STUFF.                               02650030
024900                 20  ASC-KEY-PO-NBR      PIC S9(09) COMP.         02660030
025000                 20  ASC-ORDER-DTE       PIC X(08).               02670030
025100                 20  ASC-DEPT            PIC 9(03).               02680030
025200                 20  ASC-DEPT-DESC       PIC X(20).               02690030
025300                 20  ASC-RELEASE-DTE     PIC X(08).               02700030
025400                 20  ASC-BUYER-NAME      PIC X(20).               02710030
025500                 20  ASC-EARLY-AD-DTE    PIC X(08).               02720030
025600                 20  ASC-ENT-NAME-DESC   PIC X(27).               02730030
025700                 20  ASC-STATUS-DESC     PIC X(20).               02740030
025800                                                                  02750030
025900             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                02760030
026000                 20  ASC-BLOCK-MODIFIED-SW                        02770030
026100                                        PIC X(01).                02780030
026200                     88  ASC-BLOCK-NOT-MODIFIED     VALUE 'N'.    02790030
026300                     88  ASC-BLOCK-MODIFIED         VALUE 'Y'.    02800030
026400                                                                  02810030
026500                 20  ASC-ITEM-ARRAY.                              02820030
026600                     25  ASC-ITEM-ENTRIES OCCURS 8 TIMES.         02830030
026700                         30  ASC-LIST-ITEM-NUMBER                 02840030
026800                                        PIC S9(09)  COMP-3.       02850030
026900                         30  ASC-CHANGED-DTE                      02860030
027000                                        PIC  X(08).               02870030
027100                         30  ASC-CHANGED-TME                      02880030
027200                                        PIC  X(05).               02890030
027300                         30  ASC-CULPRIT PIC  X(20).              02900030
 27400                         30  ASC-START-X-FCTR-DTE                 02910035
027500                                        PIC  X(08).               02920034
027400                         30  ASC-LAST-X-FCTR-DTE                  02930034
027500                                        PIC  X(08).               02940034
027400                         30  ASC-DO-NOT-SHIP-DTE                  02950030
027500                                        PIC  X(08).               02960030
027600                         30  ASC-CANCEL-DTE                       02970030
027700                                        PIC  X(08).               02980030
027800                         30  ASC-EXT-CAN-DTE                      02990030
027900                                        PIC  X(08).               03000030
028000                                                                  03010030
028100             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     03020030
028200             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     03030030
028300             15  ASC-NUMBER-OF-ITEMS-READ                         03040030
028400                                        PIC S9(09) COMP-3.        03050030
028500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     03060030
028600                                        PIC S9(09) COMP-3.        03070030
028700             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        03080030
028800             15  ASC-ITEM-AT-TOP-OF-PANEL                         03090030
028900                                        PIC S9(09) COMP-3.        03100030
029000             15  ASC-ITEM-AT-BOT-OF-PANEL                         03110030
029100                                        PIC S9(09) COMP-3.        03120030
029200             15  ASC-HIGHEST-BLOCK-WRITTEN                        03130030
029300                                        PIC S9(04) COMP SYNC.     03140030
029400             15  ASC-START-OF-SELECTED-RANGE                      03150030
029500                                        PIC S9(09) COMP-3.        03160030
029600             15  ASC-END-OF-SELECTED-RANGE                        03170030
029700                                        PIC S9(09) COMP-3.        03180030
029800             15  ASC-ITEMS-LEFT-INDICATOR                         03190030
029900                                        PIC X(01).                03200030
030000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03210030
030100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03220030
030200             15  ASC-TEMP-QUEUE-UPDATE-SW                         03230030
030300                                        PIC X(01).                03240030
030400                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03250030
030500                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03260030
030600             15  ASC-LIST-QUEUE-NAME.                             03270030
030700                 20  ASC-LIST-TERM-ID   PIC X(04).                03280030
030800                 20  ASC-LIST-TASK-NUMBER                         03290030
030900                                        PIC S9(05) COMP-3.        03300030
031000                 20  ASC-LIST-SEQ       PIC 9(01).                03310030
031100             15  ASC-SEL-QUEUE-NAME.                              03320030
031200                 20  ASC-SEL-TERM-ID    PIC X(04).                03330030
031300                 20  ASC-SEL-TASK-NUMBER                          03340030
031400                                        PIC S9(05) COMP-3.        03350030
031500                 20  ASC-SEL-SEQ        PIC 9(01).                03360030
031600                                                                  03370030
031700             15  ASC-START-ITEM-REQUEST.                          03380030
031800                 20  ASC-START-ITEM-REQUEST-N                     03390030
031900                                        PIC 9(07).                03400030
032000             15  ASC-HOLD-ITEM          PIC S9(04).               03410030
032100             15  ASC-HOLD-INTER-APPL    PIC X(200).               03420030
032200/                                                                 03430030
032300*----------------------------------------------------------------*03440030
032400*     USED BY MBS SYSTEM TO GET BUYER NAME                       *03450030
032500*----------------------------------------------------------------*03460030
032600                                                                  03470030
032700     COPY DPWS003.                                                03480030
032800                                                                  03490030
032900*---------------------------------------------------------------* 03500030
033000*    ABEND PROCESSING                                           * 03510030
033100*---------------------------------------------------------------* 03520030
033200     COPY DPWS013.                                                03530030
033300/                                                                 03540030
033400*---------------------------------------------------------------* 03550030
033500*    DB2 AREA FOR PURCHASING TABLE                              * 03560030
033600*---------------------------------------------------------------* 03570030
033700     EXEC SQL                                                     03580030
033800          INCLUDE TPURCHS                                         03590030
033900     END-EXEC.                                                    03600030
034000/                                                                 03610030
034100*---------------------------------------------------------------* 03620030
034200*    DB2 AREA FOR PURCHASE ITEM TABLE                           * 03630030
034300*---------------------------------------------------------------* 03640030
034400     EXEC SQL                                                     03650030
034500          INCLUDE TPURITM                                         03660030
034600     END-EXEC.                                                    03670030
034700/                                                                 03680030
034800*---------------------------------------------------------------* 03690030
034900*    DB2 AREA FOR PURCHASE ORDER DATE TABLE                     * 03700030
035000*---------------------------------------------------------------* 03710030
035100     EXEC SQL                                                     03720030
035200          INCLUDE TPLNSHP                                         03730030
035300     END-EXEC.                                                    03740030
035400/                                                                 03750030
035500*---------------------------------------------------------------* 03760030
035600*    DB2 AREA FOR                                                 03770030
035700*---------------------------------------------------------------* 03780030
035800     EXEC SQL                                                     03790030
035900          INCLUDE TWORKER                                         03800030
036000     END-EXEC.                                                    03810030
036100/                                                                 03820030
036200*----------------------------------------------------------------*03830030
036300*    DB2 DCLGEN FOR PO STATUS CODES TABLE                         03840030
036400*----------------------------------------------------------------*03850030
036500     EXEC SQL                                                     03860030
036600          INCLUDE TSTATCD                                         03870030
036700     END-EXEC.                                                    03880030
036800                                                                  03890030
036900/                                                                 03900030
037000*---------------------------------------------------------------* 03910030
037100*    DB2 AREA FOR COMMUNICATIONS                                * 03920030
037200*---------------------------------------------------------------* 03930030
037300     EXEC SQL                                                     03940030
037400          INCLUDE SQLCA                                           03950030
037500     END-EXEC.                                                    03960030
037600/                                                                 03970030
037700*---------------------------------------------------------------* 03980030
037800*  CURSOR TO SELECT RECEIVERS                                   * 03990030
037900*---------------------------------------------------------------* 04000030
038000     EXEC SQL                                                     04010030
038100          DECLARE CULPRIT-CSR CURSOR FOR                          04020030
038200     SELECT                                                       04030030
038300        A.STRT_FCTRY_DTE                                          04040034
038300       ,A.LAST_FCTRY_DTE                                          04050034
038300       ,A.DONT_SHIP_BEF_DTE                                       04060034
038400       ,A.CAN_IFNOT_SHIP_DTE                                      04070030
038500       ,A.EXT_CAN_DTE                                             04080030
038600       ,DATE(A.LAST_UPD_TMST)                                     04090030
038700       ,HOUR(A.LAST_UPD_TMST)                                     04100030
038800       ,MINUTE(A.LAST_UPD_TMST)                                   04110030
038900       ,A.LAST_UPD_BY_UID                                         04120030
039000       ,A.LAST_UPD_TMST                                           04130030
039100       FROM TPLNSHP A                                             04140030
039200       WHERE                                                      04150030
039300        A.PO_NBR          = :ASC-KEY-PO-NBR                       04160030
039400        ORDER BY A.LAST_UPD_TMST DESC                             04170040
039500     END-EXEC.                                                    04180030
039600/                                                                 04190030
039700*---------------------------------------------------------------* 04200030
039800 LINKAGE SECTION.                                                 04210030
039900*---------------------------------------------------------------* 04220030
040000 01  DFHCOMMAREA.                                                 04230030
040100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04240030
040200                                        DEPENDING ON EIBCALEN.    04250030
040300         10  FILLER                     PIC X.                    04260030
040400/                                                                 04270030
040500*---------------------------------------------------------------* 04280030
040600 PROCEDURE DIVISION.                                              04290030
040700*---------------------------------------------------------------* 04300030
040800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 04310030
040900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 04320030
041000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 04330030
041100*---------------------------------------------------------------* 04340030
041200 0000-MAIN-MODULE.                                                04350030
041300                                                                  04360030
041400     INITIALIZE DP030-CICS-API-FIELDS.                            04370030
041500                                                                  04380030
041600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04390030
041700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04400030
041800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04410030
041900                                                                  04420030
042000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04430030
042100                                                                  04440030
042200     MOVE LENGTH OF PO081AI        TO DP030-MAP-LENGTH (1).       04450030
042300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04460030
042400                                                                  04470030
042401     PERFORM 9000-CALL-CICS-ARCH-API.                             04480030
042402*                                                                 04490000
042405     PERFORM 1000-CONTROL-PROCESSING                              04500030
042406                                                                  04510030
042407     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04520030
042408     PERFORM 9000-CALL-CICS-ARCH-API.                             04530030
042409/                                                                 04540030
042410*----------------------------------------------------------------*04550030
042420* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04560030
042430* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04570030
042440*                                                                *04580030
042450* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04590030
042460*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04600030
042470*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04610030
042480*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04620030
042490*----------------------------------------------------------------*04630030
042500 1000-CONTROL-PROCESSING.                                         04640030
042600                                                                  04650030
042700     EVALUATE TRUE                                                04660030
042800                                                                  04670030
042900         WHEN DP020-NEXT-ACT-INITIAL                              04680030
043000             INITIALIZE ASC-SPECIFIC-COMMAREA                     04690030
043100                                                                  04700030
043200             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            04710030
043300                                      ASC-SEL-TERM-ID             04720030
043400             MOVE DP020-SRC-TASK-NUMBER                           04730030
043500                                   TO ASC-LIST-TASK-NUMBER        04740030
043600                                      ASC-SEL-TASK-NUMBER         04750030
043700             MOVE PC-LIST-QUEUE-SEQ                               04760030
043800                                   TO ASC-LIST-SEQ                04770030
043900             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 04780030
044000                                                                  04790030
044100             SET PS-COMMAREA-VALID    TO TRUE                     04800030
044200             MOVE SPACE               TO ASC-START-ITEM-REQUEST   04810030
044201*JS 3 LINES                                                       04820031
044210             MOVE PO017-PO-NBR       TO ASC-KEY-PO-NBR            04830031
044220             MOVE PO017-ENT-NAME-DESC                             04840031
044230                                     TO ASC-ENT-NAME-DESC         04850031
044300                                                                  04860030
044400             PERFORM 4000-BUILD-INITIAL-PANEL                     04870030
044500                                                                  04880030
044600         WHEN DP020-NEXT-ACT-READ-MAP                             04890030
044700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04900030
044800                                   TO PV-TOP-ITEM                 04910030
044900             PERFORM 2000-PROCESS-PANEL                           04920030
045000                                                                  04930030
045100         WHEN DP020-NEXT-ACT-RETURN                               04940030
045200             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        04950030
045300                                   TO PV-TOP-ITEM                 04960030
045400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    04970030
045500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 04980030
045600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04990030
045700                                                                  05000030
045800         WHEN OTHER                                               05010030
045900             SET DP013-LOGIC-ABEND TO TRUE                        05020030
046000             SET DP013-NO-ROLLBACK TO TRUE                        05030030
046100             MOVE '1000-CONTROL-PROCESSING'                       05040030
046200                                   TO DP013-PARAGRAPH             05050030
046300             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05060030
046400                                   TO DP013-MESSAGE-TEXT(1)       05070030
046500             PERFORM DP013-0000-PROCESS-ABEND                     05080030
046600     END-EVALUATE.                                                05090030
046700                                                                  05100030
046800/                                                                 05110030
046900*----------------------------------------------------------------*05120030
047000* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05130030
047100* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05140030
047200* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05150030
047300* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05160030
047400* FUNCTION KEYS CAN GET THIS FAR.                                *05170030
047500*----------------------------------------------------------------*05180030
047600 2000-PROCESS-PANEL.                                              05190030
047700                                                                  05200030
047800     MOVE INTER-APPL-COMM-AREA TO  ASC-HOLD-INTER-APPL.           05210030
047900     EVALUATE TRUE                                                05220030
048000         WHEN DP020-SRC-AID = DP016-CLEAR                         05230030
048100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05240030
048200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05250030
048300                                                                  05260030
048400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05270030
048500             PERFORM 2050-DELETE-LIST-QUEUE                       05280030
048600             PERFORM 4000-BUILD-INITIAL-PANEL                     05290030
048700                                                                  05300030
048800         WHEN OTHER                                               05310030
048900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05320030
049000             PERFORM 2100-CHECK-FUNCTION-KEY                      05330030
049100     END-EVALUATE.                                                05340030
049200/                                                                 05350030
049300*----------------------------------------------------------------*05360030
049400*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *05370030
049500*----------------------------------------------------------------*05380030
049600 2050-DELETE-LIST-QUEUE.                                          05390030
049700                                                                  05400030
049800     EXEC CICS                                                    05410030
049900         DELETEQ TS                                               05420030
050000           QUEUE (ASC-LIST-QUEUE-NAME)                            05430030
050100            RESP (PV-CICS-RESP)                                   05440030
050200     END-EXEC.                                                    05450030
050300                                                                  05460030
050400     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       05470030
050500        (PV-CICS-RESP = DFHRESP(QIDERR))                          05480030
050600         CONTINUE                                                 05490030
050700     ELSE                                                         05500030
050800         SET DP013-CICS-ABEND      TO TRUE                        05510030
050900         SET DP013-NO-ROLLBACK     TO TRUE                        05520030
051000                                                                  05530030
051100         MOVE '2050-DELETE-LIST-QUEUE'                            05540030
051200                                   TO DP013-PARAGRAPH             05550030
051300         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    05560030
051400                                   TO DP013-MESSAGE-TEXT (1)      05570030
051500         PERFORM DP013-0000-PROCESS-ABEND                         05580030
051600     END-IF.                                                      05590030
051700                                                                  05600030
051800     MOVE ZERO                     TO ASC-HIGHEST-BLOCK-WRITTEN.  05610030
051900/                                                                 05620030
052000*----------------------------------------------------------------*05630030
052100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*05640030
052200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *05650030
052300* CICS ARCHITECTURE API.                                         *05660030
052400*----------------------------------------------------------------*05670030
052500 2100-CHECK-FUNCTION-KEY.                                         05680030
052600                                                                  05690030
052700     EVALUATE TRUE                                                05700030
052800                                                                  05710030
052900         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  05720030
053000             MOVE +1               TO PV-TOP-ITEM                 05730030
053100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05740030
053200             PERFORM 3200-RESET-ATTRIBUTES                        05750030
053300                                                                  05760030
053400         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   05770030
053500             PERFORM 2110-BROWSE-BACKWARD                         05780030
053600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05790030
053700             PERFORM 3200-RESET-ATTRIBUTES                        05800030
053800                                                                  05810030
053900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   05820030
054000             PERFORM 2120-BROWSE-FORWARD                          05830030
054100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05840030
054200             PERFORM 3200-RESET-ATTRIBUTES                        05850030
054300                                                                  05860030
054400         WHEN DP020-SRC-AID = DP016-ENTER                         05870030
054500             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   05880030
054600             IF  PS-ERROR                                         05890030
054700                 CONTINUE                                         05900030
054800             ELSE                                                 05910030
054900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05920030
055000             END-IF                                               05930030
055100                                                                  05940030
055200         WHEN OTHER                                               05950030
055300             SET DP013-NO-ROLLBACK                                05960030
055400                 DP013-XCTL-DISPLAY-RESTART                       05970030
055500                 DP013-CICS-ABEND  TO TRUE                        05980030
055600             MOVE '2100-CHECK-FUNCTION-KEY1'                      05990030
055700                                   TO DP013-PARAGRAPH             06000030
055800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06010030
055900                                   TO DP013-MESSAGE-TEXT (1)      06020030
056000             PERFORM DP013-0000-PROCESS-ABEND                     06030030
056100     END-EVALUATE.                                                06040030
056200/                                                                 06050030
056300*----------------------------------------------------------------*06060030
056400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06070030
056500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06080030
056600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06090030
056700*    MESSAGE.                                                    *06100030
056800*----------------------------------------------------------------*06110030
056900 2110-BROWSE-BACKWARD.                                            06120030
057000                                                                  06130030
057100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    06140030
057200         GIVING PV-TOP-ITEM.                                      06150030
057300                                                                  06160030
057400     IF  ((PV-TOP-ITEM < +1)                                      06170030
057500       OR (PV-TOP-ITEM = +1))                                     06180030
057600         MOVE +1                   TO PV-TOP-ITEM                 06190030
057700*        -- TOP OF LIST --                                        06200030
057800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            06210030
057900         SET DP020-MSG-INFORMATIONAL                              06220030
058000                                   TO TRUE                        06230030
058100     END-IF.                                                      06240030
058200/                                                                 06250030
058300*----------------------------------------------------------------*06260030
058400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *06270030
058500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *06280030
058600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *06290030
058700*----------------------------------------------------------------*06300030
058800 2120-BROWSE-FORWARD.                                             06310030
058900                                                                  06320030
059000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              06330030
059100         GIVING PV-TOP-ITEM.                                      06340030
059200                                                                  06350030
059300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   06360030
059400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06370030
059500                                   TO PV-TOP-ITEM                 06380030
059600*        -- BOTTOM OF LIST --                                     06390030
059700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06400030
059800         SET DP020-MSG-INFORMATIONAL                              06410030
059900                                   TO TRUE                        06420030
060000     ELSE                                                         06430030
060100         COMPUTE PV-BOTTOM-ITEM =                                 06440030
060200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 06450030
060300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            06460030
060400*            -- BOTTOM OF LIST --                                 06470030
060500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06480030
060600             SET DP020-MSG-INFORMATIONAL                          06490030
060700                                   TO TRUE                        06500030
060800         END-IF                                                   06510030
060900     END-IF.                                                      06520030
061000/                                                                 06530030
061100*----------------------------------------------------------------*06540030
061200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *06550030
061300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *06560030
061400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *06570030
061500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *06580030
061600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *06590030
061700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *06600030
061800*----------------------------------------------------------------*06610030
061900 2130-CHECK-FOR-JUMP-BROWSE.                                      06620030
062000                                                                  06630030
062100     SET PS-NO-ERROR               TO TRUE.                       06640030
062200     IF (ASC-START-ITEM-REQUEST = SPACE)                          06650030
062300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            06660030
062400                                   TO PV-TOP-ITEM                 06670030
062500     ELSE                                                         06680030
062600         MOVE ASC-START-ITEM-REQUEST                              06690030
062700                                   TO DP010I-UNEDITED-FIELD       06700030
062800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       06710030
062900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     06720030
063000         SET DP010I-NEGATIVE-NOT-ALLOWED                          06730030
063100                                   TO TRUE                        06740030
264220         CALL DP010I-NUMERIC-EDIT-ROUTINE                         06751056
264230                         USING DP010I-NUMERIC-EDIT-AREA           06752056
063300                                                                  06760030
063400         IF  NOT DP010I-ERROR-DETECTED                            06770030
063500             MOVE DP010I-NUMERIC-FIELD                            06780030
063600                                   TO ASC-START-ITEM-REQUEST-N    06790030
063700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  06800030
063800                 IF  ASC-START-ITEM-REQUEST-N >                   06810030
063900                                          ASC-NUMBER-OF-ITEMS-READ06820030
064000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         06830030
064100                     COMPUTE PV-TOP-ITEM =                        06840030
064200                             ASC-NUMBER-OF-ITEMS-READ             06850030
064300                             - PC-ITEMS-PER-PANEL + 1             06860030
064400                     IF  PV-TOP-ITEM < +1                         06870030
064500                         MOVE +1   TO PV-TOP-ITEM                 06880030
064600                         MOVE PC-TSYMSG-00070                     06890030
064700                                   TO DP020-MSG-NUMBER            06900030
064800                         SET DP020-MSG-INFORMATIONAL              06910030
064900                                   TO TRUE                        06920030
065000                     END-IF                                       06930030
065100                 ELSE                                             06940030
065200                     MOVE ASC-START-ITEM-REQUEST-N                06950030
065300                                   TO PV-TOP-ITEM                 06960030
065400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      06970030
065500                     COMPUTE PV-BOTTOM-ITEM =                     06980030
065600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     06990030
065700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07000030
065800*                        -- BOTTOM OF LIST --                     07010030
065900                         MOVE PC-TSYMSG-00070                     07020030
066000                                   TO DP020-MSG-NUMBER            07030030
066100                         SET DP020-MSG-INFORMATIONAL              07040030
066200                                   TO TRUE                        07050030
066300                     END-IF                                       07060030
066400                 END-IF                                           07070030
066500             ELSE                                                 07080030
066600*                --- VALUE OUT OF RANGE ----                      07090030
066700                 MOVE PC-TSYMSG-00101                             07100030
066800                                   TO DP020-MSG-NUMBER            07110030
066900                 MOVE -1           TO ASTRTITL                    07120030
067000*                SET DP030-SET-CURSOR-APPL-1                      07130030
067100*                                  TO TRUE                        07140030
067200                 MOVE DP015-REVERSE                               07150030
067300                                   TO ASTRTITH                    07160030
067400                 MOVE DP015-RED    TO ASTRTITC                    07170030
067500                 MOVE DP015-UNP-NUM-BRT-MDT                       07180030
067600                                   TO ASTRTITA                    07190030
067700                 SET DP020-MSG-FATAL                              07200030
067800                                   TO TRUE                        07210030
067900                 SET PS-ERROR      TO TRUE                        07220030
068000             END-IF                                               07230030
068100                                                                  07240030
068200         ELSE                                                     07250030
068300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07260030
068400             MOVE -1               TO ASTRTITL                    07270030
068500*            SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07280030
068600             MOVE DP015-REVERSE    TO ASTRTITH                    07290030
068700             MOVE DP015-RED        TO ASTRTITC                    07300030
068800             MOVE DP015-UNP-NUM-BRT-MDT                           07310030
068900                                   TO ASTRTITA                    07320030
069000             SET DP020-MSG-FATAL   TO TRUE                        07330030
069100             SET PS-ERROR          TO TRUE                        07340030
069200         END-IF                                                   07350030
069300     END-IF.                                                      07360030
069400/                                                                 07370030
069500*----------------------------------------------------------------*07380030
069600*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *07390030
069700*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *07400030
069800*----------------------------------------------------------------*07410030
069900 2200-MOVE-SCREEN-TO-COMMAREA.                                    07420030
070000                                                                  07430030
070100     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             07440030
070200     MOVE +1                       TO PV-SUB.                     07450030
070300                                                                  07460030
070400     PERFORM 3100-SET-SUBSCRIPTS.                                 07470030
070500                                                                  07480030
070600     IF  ASTRTITL > ZERO                                          07490030
070700         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      07500030
070800     ELSE                                                         07510030
070900         IF  ASTRTITF = DP015-ERASE-EOF                           07520030
071000             INITIALIZE ASC-START-ITEM-REQUEST                    07530030
071100         END-IF                                                   07540030
071200     END-IF.                                                      07550030
071300                                                                  07560030
071400     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          07570030
071500         VARYING PV-SUB                                           07580030
071600         FROM 1 BY 1                                              07590030
071700         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      07600030
071800/                                                                 07610030
071900*----------------------------------------------------------------*07620030
072000*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *07630030
072100*----------------------------------------------------------------*07640030
072200 2210-MOVE-LINES-TO-COMMAREA.                                     07650030
072300                                                                  07660030
072400     ADD +1                        TO ASC-ITEM-SUB.               07670030
072500                                                                  07680030
072600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        07690030
072700         ADD +1                    TO ASC-BLK-SUB                 07700030
072800         MOVE +1                   TO ASC-ITEM-SUB                07710030
072900     END-IF.                                                      07720030
073000/                                                                 07730030
073100*----------------------------------------------------------------*07740030
073200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *07750030
073300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*07760030
073400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *07770030
073500*                                                                *07780030
073600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *07790030
073700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *07800030
073800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *07810030
073900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *07820030
074000*----------------------------------------------------------------*07830030
074100 3100-SET-SUBSCRIPTS.                                             07840030
074200                                                                  07850030
074300     COMPUTE ASC-ITEM-SUB =                                       07860030
074400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        07870030
074500                                                                  07880030
074600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         07890030
074700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            07900030
074800                                                                  07910030
074900         MOVE PC-MAX-BLOCKS-IN-ARRAY                              07920030
075000                                   TO ASC-BLK-SUB                 07930030
075100     ELSE                                                         07940030
075200         MOVE +1                   TO ASC-BLK-SUB                 07950030
075300     END-IF.                                                      07960030
075400/                                                                 07970030
075500*----------------------------------------------------------------*07980030
075600*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *07990030
075700*----------------------------------------------------------------*08000030
075800 3200-RESET-ATTRIBUTES.                                           08010030
075900                                                                  08020030
076000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   08030030
076100     MOVE DP015-GREEN              TO ASTRTITC.                   08040030
076200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   08050030
076300/                                                                 08060030
076400*----------------------------------------------------------------*08070030
076500*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *08080030
076600*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *08090030
076700*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *08100030
076800*----------------------------------------------------------------*08110030
076900 3410-POSITION-AT-ERROR.                                          08120030
077000                                                                  08130030
077100*    SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       08140030
077200                                                                  08150030
077300     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 08160030
077400                    - PV-TOP-ITEM + 1.                            08170030
077500                                                                  08180030
077600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   08190030
077700                    - PV-TOP-ITEM + 1.                            08200030
077800/                                                                 08210030
077900*----------------------------------------------------------------*08220030
078000*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *08230030
078100*    INITIALIZE ALL COUNTERS AND FLAGS.                          *08240030
078200*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *08250030
078300*    DISPLAY THE PANEL TO USER.                                  *08260030
078400*----------------------------------------------------------------*08270030
078500 4000-BUILD-INITIAL-PANEL.                                        08280030
078600                                                                  08290030
078700     INITIALIZE ASC-BLOCK-ENTRIES (1)                             08300030
078800                ASC-BLOCK-ENTRIES (2).                            08310030
078900                                                                  08320030
079000     MOVE +1                       TO ASC-BLK-SUB.                08330030
079100                                                                  08340030
079200     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       08350030
079300                                                                  08360030
079400     MOVE ZERO                   TO ASC-ITEM-SUB                  08370030
079500                                    ASC-NUMBER-OF-ITEMS-READ      08380030
079600                                    ASC-NUMBER-OF-SELECTED-ITEMS  08390030
079700                                    ASC-HIGHEST-BLOCK-WRITTEN     08400030
079800                                    ASC-START-OF-SELECTED-RANGE   08410030
079900                                    ASC-END-OF-SELECTED-RANGE     08420030
080000                                    ASC-ITEM-AT-TOP-OF-PANEL.     08430030
080100                                                                  08440030
080200*    IF DP020-FK-REFRESH (DP020-SRC-AID)                          08450031
080300*        CONTINUE                                                 08460031
080400*    ELSE                                                         08470031
080500*        MOVE PO017-PO-NBR       TO ASC-KEY-PO-NBR                08480031
080600*        MOVE PO017-ENT-NAME-DESC                                 08490031
080700*                                TO ASC-ENT-NAME-DESC             08500031
080800*    END-IF                                                       08510031
080900                                                                  08520030
081000     PERFORM 4100-BUILD-HEADERS.                                  08530030
081100                                                                  08540030
081200     PERFORM 7100-OPEN-CURSOR.                                    08550030
081300                                                                  08560046
150500***  PERFORM 7112-FIRST-RECORD.                                   08570051
081300                                                                  08580030
081400     PERFORM 4300-READ-ITEMS-FROM-DB.                             08590030
081500                                                                  08600030
081600     PERFORM 7120-CLOSE-CURSOR.                                   08610030
081700                                                                  08620030
081800     MOVE +1                       TO PV-TOP-ITEM.                08630030
081900                                                                  08640030
082000     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          08650030
082100         SET DP020-NEXT-ACT-APPL-ERROR                            08660030
082200                                   TO TRUE                        08670030
082300         SET DP020-MSG-FATAL       TO TRUE                        08680030
082400         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            08690030
082500     ELSE                                                         08700030
082600*        SET DP030-SET-CURSOR-APPL-1                              08710030
082700*                                  TO TRUE                        08720030
082800         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     08730030
082900     END-IF.                                                      08740030
083000/                                                                 08750030
083100 4100-BUILD-HEADERS.                                              08760030
083200     PERFORM 7000-TPURCHS-INFO.                                   08770030
083300     PERFORM 7010-TPURITM-INFO.                                   08780030
083400     PERFORM 7020-DEPT-BUYER-NAMES.                               08790030
083500     PERFORM 7030-STATUS-DESC.                                    08800030
083600/                                                                 08810030
083700*----------------------------------------------------------------*08820030
083800 4300-READ-ITEMS-FROM-DB.                                         08830030
083900                                                                  08840030
084000     PERFORM                                                      08850030
084100         VARYING PV-READ-COUNT                                    08860030
084200         FROM 1 BY 1                                              08870030
084300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    08880030
084400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         08890030
084500                                                                  08900030
084600         PERFORM 7110-FETCH                                       08910030
                                                                        08920042
                                                                        08930042
               IF  ASC-ITEMS-LEFT-ON-DB AND                             08940042
               ((PLNSHP-STRT-FCTRY-DTE NOT = PV-START-X-FCTR-DTE) OR    08950050
                (PLNSHP-LAST-FCTRY-DTE NOT = PV-LAST-X-FCTR-DTE) OR     08960050
                (PLNSHP-DONT-SHIP-BEF-DTE NOT =                         08970050
                                            PV-DONT-SHIP-BEF-DTE) OR    08980050
                (PLNSHP-CAN-IFNOT-SHIP-DTE NOT = PV-CANCEL-DTE) OR      08990050
                (PLNSHP-EXT-CAN-DTE NOT = PV-EXT-CAN-DTE))              09000050
091500            MOVE ASC-CHANGED-DTE (ASC-BLK-SUB ASC-ITEM-SUB)       09010046
                                             TO PV-CHANGED-DTE          09020046
091800            MOVE ASC-CHANGED-TME (ASC-BLK-SUB ASC-ITEM-SUB)       09030047
                                             TO PV-CHANGED-TME          09040046
                  MOVE ASC-CULPRIT (ASC-BLK-SUB ASC-ITEM-SUB)           09050046
                                             TO PV-CULPRIT              09060046
                  MOVE PLNSHP-STRT-FCTRY-DTE TO PV-START-X-FCTR-DTE     09070046
                  MOVE PLNSHP-LAST-FCTRY-DTE TO PV-LAST-X-FCTR-DTE      09080046
                  MOVE PLNSHP-DONT-SHIP-BEF-DTE TO                      09090044
                                                PV-DONT-SHIP-BEF-DTE    09100047
                  MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-CANCEL-DTE       09110046
                  MOVE PLNSHP-EXT-CAN-DTE    TO PV-EXT-CAN-DTE          09120044
                                                                        09130044
084900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                09140030
085000                 ADD +1            TO ASC-ITEM-SUB                09150030
085100             ELSE                                                 09160030
085200                 ADD +1            TO ASC-BLK-SUB                 09170030
085300                 MOVE +1           TO ASC-ITEM-SUB                09180030
085400                                                                  09190030
085500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         09200030
085600                     MOVE +1       TO ASC-BLK-SUB                 09210030
085700                     SET ASC-BLOCK-MODIFIED (1)                   09220030
085800                                   TO TRUE                        09230030
085900                     PERFORM 5100-WRITE-TEMP-STORAGE              09240030
086000                     MOVE ASC-BLOCK-ENTRIES                       09250030
086100                               (PC-MAX-BLOCKS-IN-ARRAY)           09260030
086200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 09270030
086300                     ADD +1        TO ASC-BLK-SUB                 09280030
086400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   09290030
086500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      09300030
086600                                   TO TRUE                        09310030
086700                 END-IF                                           09320030
086800             END-IF                                               09330030
086900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    09340030
087000             MOVE ASC-NUMBER-OF-ITEMS-READ                        09350030
087100                                   TO ASC-LIST-ITEM-NUMBER        09360030
087200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  09370030
087300                                                                  09380030
087400                                                                  09390034
087500             IF PLNSHP-STRT-FCTRY-DTE = '0001-01-01'              09400034
087600                 MOVE SPACES      TO ASC-START-X-FCTR-DTE         09410036
087700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09420034
087800             ELSE                                                 09430034
087900             STRING PLNSHP-STRT-FCTRY-DTE(6:2) '/'                09440034
088000                    PLNSHP-STRT-FCTRY-DTE(9:2) '/'                09450034
088100                    PLNSHP-STRT-FCTRY-DTE(3:2)                    09460034
088200                    DELIMITED BY SIZE                             09470034
088300                                INTO ASC-START-X-FCTR-DTE         09480036
088400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09490034
088500             END-IF                                               09500034
087400                                                                  09510034
087500             IF PLNSHP-LAST-FCTRY-DTE = '0001-01-01'              09520034
087600                 MOVE SPACES      TO ASC-LAST-X-FCTR-DTE          09530034
087700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09540034
087800             ELSE                                                 09550034
087900             STRING PLNSHP-LAST-FCTRY-DTE(6:2) '/'                09560034
088000                    PLNSHP-LAST-FCTRY-DTE(9:2) '/'                09570034
088100                    PLNSHP-LAST-FCTRY-DTE(3:2)                    09580034
088200                    DELIMITED BY SIZE                             09590034
088300                                INTO ASC-LAST-X-FCTR-DTE          09600034
088400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09610034
088500             END-IF                                               09620034
087400                                                                  09630030
087500             IF PLNSHP-DONT-SHIP-BEF-DTE = '0001-01-01'           09640030
087600                 MOVE SPACES      TO ASC-DO-NOT-SHIP-DTE          09650030
087700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09660030
087800             ELSE                                                 09670030
087900             STRING PLNSHP-DONT-SHIP-BEF-DTE(6:2) '/'             09680030
088000                    PLNSHP-DONT-SHIP-BEF-DTE(9:2) '/'             09690030
088100                    PLNSHP-DONT-SHIP-BEF-DTE(3:2)                 09700030
088200                    DELIMITED BY SIZE                             09710030
088300                                INTO ASC-DO-NOT-SHIP-DTE          09720030
088400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09730030
088500             END-IF                                               09740030
088600                                                                  09750030
088700             IF PLNSHP-CAN-IFNOT-SHIP-DTE = '0001-01-01'          09760030
088800                 MOVE SPACES      TO ASC-CANCEL-DTE               09770030
088900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09780030
089000             ELSE                                                 09790030
089100             STRING PLNSHP-CAN-IFNOT-SHIP-DTE(6:2) '/'            09800030
089200                    PLNSHP-CAN-IFNOT-SHIP-DTE(9:2) '/'            09810030
089300                    PLNSHP-CAN-IFNOT-SHIP-DTE(3:2)                09820030
089400                    DELIMITED BY SIZE                             09830030
089500                                INTO ASC-CANCEL-DTE               09840030
089600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09850030
089700             END-IF                                               09860030
089800                                                                  09870030
089900             IF PLNSHP-EXT-CAN-DTE = '0001-01-01'                 09880030
090000                 MOVE SPACES      TO ASC-EXT-CAN-DTE              09890030
090100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09900030
090200             ELSE                                                 09910030
090300             STRING PLNSHP-EXT-CAN-DTE(6:2) '/'                   09920030
090400                    PLNSHP-EXT-CAN-DTE(9:2) '/'                   09930030
090500                    PLNSHP-EXT-CAN-DTE(3:2)                       09940030
090600                    DELIMITED BY SIZE                             09950030
090700                                INTO ASC-EXT-CAN-DTE              09960030
090800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 09970030
090900             END-IF                                               09980030
091000                                                                  09990030
091100             STRING PV-UPD-DATE(6:2) '/'                          10000030
091200                    PV-UPD-DATE(9:2) '/'                          10010030
091300                    PV-UPD-DATE(3:2)                              10020030
091400                    DELIMITED BY SIZE                             10030030
091500                                INTO ASC-CHANGED-DTE              10040030
091600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10050030
091700                                                                  10060030
091800             MOVE PV-UPD-TIME     TO ASC-CHANGED-TME              10070030
091900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10080030
092000                                                                  10090030
092100* IF PLNSHP-LAST-UPD-TMST IS NULL, THE FETCH PARAGRAPH HAS        10100030
092200* ALREADY SUBSTITUTED DATA FROM TPURCHS                           10110030
092300             IF PLNSHP-LAST-UPD-TMST = PC-NULL-TMST               10120030
092400                 CONTINUE                                         10130030
092500             ELSE                                                 10140030
092600                 MOVE PLNSHP-LAST-UPD-BY-UID                      10150030
092700                                 TO WORKER-UID-NBR                10160030
092800                 PERFORM 7050-GET-TWORKER                         10170030
092900             END-IF                                               10180030
093000                                                                  10190030
093100             STRING WORKER-FIR-NAME        DELIMITED BY '  '      10200030
093200                    SPACE                  DELIMITED BY SIZE      10210030
093300                    WORKER-LAST-NAME       DELIMITED BY SIZE      10220030
093400                                 INTO ASC-CULPRIT                 10230030
093500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10240030
093600         ELSE                                                     10250052
      *****      IF XXX ASSHOLE                                         10260052
                IF ((PLNSHP-STRT-FCTRY-DTE = PV-START-X-FCTR-DTE) AND   10270052
                (PLNSHP-LAST-FCTRY-DTE = PV-LAST-X-FCTR-DTE) AND        10280052
                (PLNSHP-DONT-SHIP-BEF-DTE = PV-DONT-SHIP-BEF-DTE) AND   10290052
                (PLNSHP-CAN-IFNOT-SHIP-DTE = PV-CANCEL-DTE) AND         10300052
                (PLNSHP-EXT-CAN-DTE = PV-EXT-CAN-DTE))                  10310052
091100             STRING PV-UPD-DATE(6:2) '/'                          10320052
091200                    PV-UPD-DATE(9:2) '/'                          10330052
091300                    PV-UPD-DATE(3:2)                              10340052
091400                    DELIMITED BY SIZE                             10350052
091500                                INTO ASC-CHANGED-DTE              10360052
091600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10370052
091700                                                                  10380052
091800             MOVE PV-UPD-TIME     TO ASC-CHANGED-TME              10390052
091900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10400052
092000                                                                  10410052
092100* IF PLNSHP-LAST-UPD-TMST IS NULL, THE FETCH PARAGRAPH HAS        10420052
092200* ALREADY SUBSTITUTED DATA FROM TPURCHS                           10430052
092300             IF PLNSHP-LAST-UPD-TMST = PC-NULL-TMST               10440052
092400                 CONTINUE                                         10450052
092500             ELSE                                                 10460052
092600                 MOVE PLNSHP-LAST-UPD-BY-UID                      10470052
092700                                 TO WORKER-UID-NBR                10480052
092800                 PERFORM 7050-GET-TWORKER                         10490052
092900             END-IF                                               10500052
093000                                                                  10510052
093100             STRING WORKER-FIR-NAME        DELIMITED BY '  '      10520052
093200                    SPACE                  DELIMITED BY SIZE      10530052
093300                    WORKER-LAST-NAME       DELIMITED BY SIZE      10540052
093400                                 INTO ASC-CULPRIT                 10550052
093500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 10560052
                END-IF                                                  10570052
093600         END-IF                                                   10580052
093700     END-PERFORM.                                                 10590030
093800                                                                  10600030
093900     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          10610030
094000         MOVE +1                   TO ASC-BLK-SUB                 10620030
094100         PERFORM 5100-WRITE-TEMP-STORAGE                          10630030
094200         ADD +1                    TO ASC-BLK-SUB                 10640030
094300         PERFORM 5100-WRITE-TEMP-STORAGE                          10650030
094400                                                                  10660030
094500         MOVE 1                    TO ASC-BLK-SUB                 10670030
094600                                      PV-BLOCK-NUMBER             10680030
094700         PERFORM 4410-READ-TEMP-STORAGE                           10690030
094800         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             10700030
094900             MOVE 2                TO ASC-BLK-SUB                 10710030
095000                                      PV-BLOCK-NUMBER             10720030
095100             PERFORM 4410-READ-TEMP-STORAGE                       10730030
095200         END-IF                                                   10740030
095300     END-IF.                                                      10750030
095400/                                                                 10760030
095500*----------------------------------------------------------------*10770030
095600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *10780030
095700*----------------------------------------------------------------*10790030
095800 4400-MOVE-COMMAREA-TO-SCREEN.                                    10800030
095900                                                                  10810030
096000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             10820030
096100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          10830030
096200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          10840030
096300             MOVE +1               TO ASC-BLK-SUB                 10850030
096400             PERFORM 5100-WRITE-TEMP-STORAGE                      10860030
096500             ADD +1                TO ASC-BLK-SUB                 10870030
096600             PERFORM 5100-WRITE-TEMP-STORAGE                      10880030
096700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             10890030
096800                 GIVING PV-BLOCK-NUMBER                           10900030
096900                 REMAINDER PV-REMAINDER                           10910030
097000             IF  PV-REMAINDER > ZERO                              10920030
097100                 ADD +1            TO PV-BLOCK-NUMBER             10930030
097200             END-IF                                               10940030
097300             MOVE +1               TO ASC-BLK-SUB                 10950030
097400             PERFORM 4410-READ-TEMP-STORAGE                       10960030
097500             ADD +1                TO ASC-BLK-SUB                 10970030
097600                                      PV-BLOCK-NUMBER             10980030
097700             PERFORM 4410-READ-TEMP-STORAGE                       10990030
097800     END-IF.                                                      11000030
097900                                                                  11010030
098000     MOVE +1                       TO ASC-BLK-SUB.                11020030
098100                                                                  11030030
098200     COMPUTE ASC-ITEM-SUB =                                       11040030
098300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              11050030
098400         + PC-ITEMS-PER-PANEL).                                   11060030
098500                                                                  11070030
098600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11080030
098700         ADD +1                    TO ASC-BLK-SUB                 11090030
098800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            11100030
098900     END-IF.                                                      11110030
099000                                                                  11120030
099100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           11130030
099200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                11140030
099300                                                                  11150030
099400     PERFORM 4420-FORMAT-LIST-LINES                               11160030
099500         VARYING PV-SUB                                           11170030
099600         FROM PC-ITEMS-PER-PANEL BY -1                            11180030
099700         UNTIL PV-SUB < +1.                                       11190030
099800                                                                  11200030
099900     COMPUTE ASC-ITEMS-DISPLAYED =                                11210030
100000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          11220030
100100                                                                  11230030
100200     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    11240030
100300                                      ASTRTITO.                   11250030
100400                                                                  11260030
100500     MOVE ASC-KEY-PO-NBR           TO APOO.                       11270030
100600     MOVE ASC-ORDER-DTE            TO APODTEO.                    11280030
100700     MOVE ASC-DEPT                 TO ADEPTO                      11290030
100800     MOVE ASC-DEPT-DESC            TO ADEPTNMO                    11300030
100900     MOVE ASC-RELEASE-DTE          TO ARELDTEO                    11310030
101000     MOVE ASC-BUYER-NAME           TO ABUYERO                     11320030
101100     MOVE ASC-EARLY-AD-DTE         TO AADDATEO                    11330030
101200     MOVE ASC-STATUS-DESC          TO ASTATO                      11340030
101300     MOVE ASC-ENT-NAME-DESC        TO AVENDORO.                   11350030
101400                                                                  11360030
101500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    11370030
101600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    11380030
101700                                                                  11390030
101800     IF  DP020-MSG-NUMBER-X = SPACE                               11400030
101900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  11410030
102000*            --- MORE ITEMS TO DISPLAY ----                       11420030
102100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            11430030
102200             SET DP020-MSG-INFORMATIONAL                          11440030
102300                                   TO TRUE                        11450030
102400         END-IF                                                   11460030
102500     END-IF.                                                      11470030
102600/                                                                 11480030
102700*----------------------------------------------------------------*11490030
102800*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *11500030
102900*----------------------------------------------------------------*11510030
103000 4410-READ-TEMP-STORAGE.                                          11520030
103100                                                                  11530030
103200     EXEC CICS                                                    11540030
103300         READQ TS                                                 11550030
103400             QUEUE (ASC-LIST-QUEUE-NAME)                          11560030
103500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               11570030
103600             ITEM  (PV-BLOCK-NUMBER)                              11580030
103700             RESP  (PV-CICS-RESP)                                 11590030
103800     END-EXEC.                                                    11600030
103900                                                                  11610030
104000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       11620030
104100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     11630030
104200         CONTINUE                                                 11640030
104300     ELSE                                                         11650030
104400         SET DP013-CICS-ABEND      TO TRUE                        11660030
104500         SET DP013-NO-ROLLBACK     TO TRUE                        11670030
104600         MOVE '4410-READ-TEMP-STORAGE'                            11680030
104700                                   TO DP013-PARAGRAPH             11690030
104800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      11700030
104900                                   TO DP013-MESSAGE-TEXT(1)       11710030
105000         PERFORM DP013-0000-PROCESS-ABEND                         11720030
105100     END-IF.                                                      11730030
105200                                                                  11740030
105300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      11750030
105400                                   TO TRUE.                       11760030
105500                                                                  11770030
105600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         11780030
105700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               11790030
105800     END-IF.                                                      11800030
105900/                                                                 11810030
106000*----------------------------------------------------------------*11820030
106100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *11830030
106200*----------------------------------------------------------------*11840030
106300 4420-FORMAT-LIST-LINES.                                          11850030
106400                                                                  11860030
106500     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      11870030
106600         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                11880030
106700         MOVE SPACE              TO MR-CHANGED-DTE (PV-SUB)       11890030
106800                                    MR-CHANGED-TME (PV-SUB)       11900030
106900                                    MR-CULPRIT (PV-SUB)           11910030
108700                                    MR-START-X-FACT-DTE(PV-SUB)   11920034
108700                                    MR-LAST-X-FACT-DTE(PV-SUB)    11930034
107000                                    MR-DO-NOT-SHIP-DTE(PV-SUB)    11940030
107100                                    MR-CANCEL-DTE(PV-SUB)         11950030
107200                                    MR-EXTCAN-DTE(PV-SUB)         11960030
107300                                                                  11970030
107400     ELSE                                                         11980030
107500         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           11990030
107600             MOVE ASC-CHANGED-DTE                                 12000030
107700                          (ASC-BLK-SUB ASC-ITEM-SUB)              12010030
107800                                 TO MR-CHANGED-DTE (PV-SUB)       12020030
107900             MOVE ASC-CHANGED-TME                                 12030030
108000                          (ASC-BLK-SUB ASC-ITEM-SUB)              12040030
108100                                 TO MR-CHANGED-TME (PV-SUB)       12050030
108200             MOVE ASC-CULPRIT                                     12060030
108300                          (ASC-BLK-SUB ASC-ITEM-SUB)              12070030
108400                                 TO MR-CULPRIT (PV-SUB)           12080030
088300             MOVE ASC-START-X-FCTR-DTE                            12090034
108600                          (ASC-BLK-SUB ASC-ITEM-SUB)              12100034
108700                                 TO MR-START-X-FACT-DTE(PV-SUB)   12110034
088300             MOVE ASC-LAST-X-FCTR-DTE                             12120034
108600                          (ASC-BLK-SUB ASC-ITEM-SUB)              12130034
108700                                 TO MR-LAST-X-FACT-DTE(PV-SUB)    12140034
108500             MOVE ASC-DO-NOT-SHIP-DTE                             12150030
108600                          (ASC-BLK-SUB ASC-ITEM-SUB)              12160030
108700                                 TO MR-DO-NOT-SHIP-DTE(PV-SUB)    12170030
108800             MOVE ASC-CANCEL-DTE                                  12180030
108900                          (ASC-BLK-SUB ASC-ITEM-SUB)              12190030
109000                                 TO MR-CANCEL-DTE(PV-SUB)         12200030
109100             MOVE ASC-EXT-CAN-DTE                                 12210030
109200                          (ASC-BLK-SUB ASC-ITEM-SUB)              12220030
109300                                 TO MR-EXTCAN-DTE(PV-SUB)         12230030
109400         END-IF                                                   12240030
109500     END-IF.                                                      12250030
109600                                                                  12260030
109700     SUBTRACT +1 FROM ASC-ITEM-SUB.                               12270030
109800                                                                  12280030
109900     IF  ASC-ITEM-SUB < + 1                                       12290030
110000         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                12300030
110100         MOVE +1                   TO ASC-BLK-SUB                 12310030
110200     END-IF.                                                      12320030
110300/                                                                 12330030
110400*----------------------------------------------------------------*12340030
110500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *12350030
110600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *12360030
110700*----------------------------------------------------------------*12370030
110800 5100-WRITE-TEMP-STORAGE.                                         12380030
110900                                                                  12390030
111000     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     12400030
111100                                   TO PV-LIST-ITEM-NUMBER.        12410030
111200     COMPUTE PV-BLOCK-NUMBER =                                    12420030
111300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12430030
111400                                                                  12440030
111500     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             12450030
111600     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             12460030
111700         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      12470030
111800             PERFORM 5105-REWRITE-ASC-LISTQ                       12480030
111900         END-IF                                                   12490030
112000     ELSE                                                         12500030
112100         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       12510030
112200         ASC-HIGHEST-BLOCK-WRITTEN + 1                            12520030
112300         PERFORM 5110-WRITE-ASC-LISTQ                             12530030
112400         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   12540030
112500     END-IF.                                                      12550030
112600                                                                  12560030
112700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      12570030
112800                                   TO TRUE.                       12580030
112900/                                                                 12590030
113000*----------------------------------------------------------------*12600030
113100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *12610030
113200*  SPECIFIC COMMAREA.                                            *12620030
113300*----------------------------------------------------------------*12630030
113400 5105-REWRITE-ASC-LISTQ.                                          12640030
113500                                                                  12650030
113600     EXEC CICS                                                    12660030
113700         WRITEQ TS                                                12670030
113800             QUEUE (ASC-LIST-QUEUE-NAME)                          12680030
113900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12690030
114000             ITEM  (PV-BLOCK-NUMBER)                              12700030
114100             REWRITE                                              12710030
114200             RESP  (PV-CICS-RESP)                                 12720030
114300     END-EXEC.                                                    12730030
114400                                                                  12740030
114500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           12750030
114600         CONTINUE                                                 12760030
114700     ELSE                                                         12770030
114800         SET DP013-CICS-ABEND      TO TRUE                        12780030
114900         SET DP013-NO-ROLLBACK     TO TRUE                        12790030
115000         MOVE '5105-REWRITE-ASC-LISTQ'                            12800030
115100                                   TO DP013-PARAGRAPH             12810030
115200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     12820030
115300                                   TO DP013-MESSAGE-TEXT(1)       12830030
115400         PERFORM DP013-0000-PROCESS-ABEND                         12840030
115500     END-IF.                                                      12850030
115600         MOVE PV-BLOCK-NUMBER      TO ASC-HOLD-ITEM.              12860030
115700/                                                                 12870030
115800*----------------------------------------------------------------*12880030
115900*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *12890030
116000*  SPECIFIC COMMAREA.                                            *12900030
116100*----------------------------------------------------------------*12910030
116200 5110-WRITE-ASC-LISTQ.                                            12920030
116300                                                                  12930030
116400     EXEC CICS                                                    12940030
116500         WRITEQ TS                                                12950030
116600             QUEUE (ASC-LIST-QUEUE-NAME)                          12960030
116700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               12970030
116800             ITEM  (PV-BLOCK-NUMBER)                              12980030
116900             RESP  (PV-CICS-RESP)                                 12990030
117000     END-EXEC.                                                    13000030
117100                                                                  13010030
117200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      13020030
117300         SET DP013-CICS-ABEND      TO TRUE                        13030030
117400         SET DP013-NO-ROLLBACK     TO TRUE                        13040030
117500         MOVE '5110-WRITE-ASC-LISTQ'                              13050030
117600                                   TO DP013-PARAGRAPH             13060030
117700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           13070030
117800                                   TO DP013-MESSAGE-TEXT(1)       13080030
117900         PERFORM DP013-0000-PROCESS-ABEND                         13090030
118000     END-IF.                                                      13100030
118100     MOVE PV-BLOCK-NUMBER      TO ASC-HOLD-ITEM.                  13110030
118200/                                                                 13120030
118300*----------------------------------------------------------------*13130030
118400*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *13140030
118500*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *13150030
118600*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *13160030
118700*  THE USER.                                                     *13170030
118800*----------------------------------------------------------------*13180030
118900 6000-REFRESH-PANEL-FROM-TEMP.                                    13190030
119000                                                                  13200030
119100     INITIALIZE ASC-BLOCK-ENTRIES (1)                             13210030
119200                ASC-BLOCK-ENTRIES (2)                             13220030
119300                                                                  13230030
119400     DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                     13240030
119500                GIVING PV-BLOCK-NUMBER                            13250030
119600                REMAINDER PV-REMAINDER                            13260030
119700                                                                  13270030
119800     IF  PV-REMAINDER > ZERO                                      13280030
119900             ADD +1                TO PV-BLOCK-NUMBER             13290030
120000     END-IF                                                       13300030
120100                                                                  13310030
120200     MOVE +1                   TO ASC-BLK-SUB                     13320030
120300     PERFORM 4410-READ-TEMP-STORAGE                               13330030
120400     ADD +1                    TO ASC-BLK-SUB                     13340030
120500                                      PV-BLOCK-NUMBER             13350030
120600     PERFORM 4410-READ-TEMP-STORAGE.                              13360030
120700/                                                                 13370030
120800 7000-TPURCHS-INFO.                                               13380030
120900                                                                  13390030
121000     EXEC SQL                                                     13400030
121100         SELECT                                                   13410030
121200             DEPT_NBR                                             13420030
121300            ,STATUS_CDE                                           13430030
121400            ,ORD_DTE                                              13440030
121500            ,RLSE_DTE                                             13450030
121600         INTO                                                     13460030
121700             :PURCHS-DEPT-NBR                                     13470030
121800            ,:PURCHS-STATUS-CDE                                   13480030
121900            ,:PURCHS-ORD-DTE                                      13490030
122000            ,:PURCHS-RLSE-DTE                                     13500030
122100         FROM TPURCHS                                             13510030
122200         WHERE PO_NBR            = :ASC-KEY-PO-NBR                13520030
122300          AND VER_STATUS_CDE     = 'A'                            13530030
122400              AND PO_CATEG_CDE   = 'MR'                           13540030
122500         END-EXEC                                                 13550030
122600                                                                  13560030
122700     EVALUATE TRUE                                                13570030
122800                                                                  13580030
122900         WHEN SQLCODE = ZERO                                      13590030
123000             MOVE PURCHS-DEPT-NBR TO ASC-DEPT                     13600030
123100                                                                  13610030
                  IF PURCHS-ORD-DTE = '0001-01-01'                      13620041
                     MOVE SPACES          TO ASC-ORDER-DTE              13630041
                  ELSE                                                  13640041
                     MOVE PURCHS-ORD-DTE(6:2)                           13650041
                                          TO ASC-ORDER-DTE(1:2)         13660041
                     MOVE '/'             TO ASC-ORDER-DTE(3:1)         13670041
                     MOVE PURCHS-ORD-DTE(9:2)                           13680041
                                          TO ASC-ORDER-DTE(4:2)         13690041
                     MOVE '/'             TO ASC-ORDER-DTE(6:1)         13700041
                     MOVE PURCHS-ORD-DTE(3:2)                           13710041
                                          TO ASC-ORDER-DTE(7:2)         13720041
                  END-IF                                                13730041
                                                                        13740038
                  IF PURCHS-RLSE-DTE = '0001-01-01'                     13750038
                     MOVE SPACES          TO ASC-RELEASE-DTE            13760039
                  ELSE                                                  13770038
                     MOVE PURCHS-RLSE-DTE(6:2)                          13780039
                                          TO ASC-RELEASE-DTE(1:2)       13790039
                     MOVE '/'             TO ASC-RELEASE-DTE(3:1)       13800039
                     MOVE PURCHS-RLSE-DTE(9:2)                          13810039
                                          TO ASC-RELEASE-DTE(4:2)       13820039
                     MOVE '/'             TO ASC-RELEASE-DTE(6:1)       13830039
                     MOVE PURCHS-RLSE-DTE(3:2)                          13840039
                                          TO ASC-RELEASE-DTE(7:2)       13850039
                  END-IF                                                13860038
                                                                        13870038
125100         WHEN SQLCODE = +100                                      13880030
125200             MOVE ALL '?'          TO PURCHS-ORD-DTE              13890030
125300                                      PURCHS-RLSE-DTE             13900030
125400                                                                  13910030
125500         WHEN SQLCODE = -904                                      13920030
125600         WHEN SQLCODE = -911                                      13930030
125700         WHEN SQLCODE = -913                                      13940030
125800              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       13950030
125900              SET PS-ERROR                                        13960030
126000                  DP020-NEXT-ACT-APPL-ERROR                       13970030
126100                  DP020-MSG-FATAL                                 13980030
126200                                 TO TRUE                          13990030
126300                                                                  14000030
126400         WHEN SQLWARN0 NOT = SPACES                               14010030
126500         WHEN SQLCODE < ZERO                                      14020030
126600         WHEN SQLCODE > ZERO                                      14030030
126700             MOVE '7000-TPURCHS-INFO'                             14040030
126800                               TO DP013-PARAGRAPH                 14050030
126900             MOVE 'ERROR SELECTING TPURCHS INFO'                  14060030
127000                               TO DP013-MESSAGE-TEXT (1)          14070030
127100             MOVE SQLCA        TO DP013-SQLCA                     14080030
127200             MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)        14090030
127300             SET DP013-DB2-ABEND                                  14100030
127400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14110030
127500             PERFORM DP013-0000-PROCESS-ABEND                     14120030
127600     END-EVALUATE.                                                14130030
127700/                                                                 14140030
127800 7010-TPURITM-INFO.                                               14150030
127900                                                                  14160030
128000     EXEC SQL                                                     14170030
128100         SELECT MIN(AD_EVNT_DTE)                                  14180030
128200         INTO :PURITM-AD-EVNT-DTE:PV-NULL-IND                     14190030
128300         FROM TPURITM                                             14200030
128400         WHERE PO_NBR         = :ASC-KEY-PO-NBR                   14210030
128500             AND VER_STATUS_CDE = 'A'                             14220030
128600             AND AD_EVNT_DTE > '0001-01-01'                       14230030
128700             AND STATUS_CDE NOT IN ('CA')                         14240030
128800     END-EXEC                                                     14250030
128900                                                                  14260030
129000     EVALUATE TRUE                                                14270030
129100         WHEN SQLCODE = ZERO                                      14280030
129200             IF  PV-NULL-IND < ZERO                               14290030
129300                 MOVE SPACES           TO ASC-EARLY-AD-DTE        14300030
129400             ELSE                                                 14310030
129500             STRING PURITM-AD-EVNT-DTE(6:2) '/'                   14320030
129600                    PURITM-AD-EVNT-DTE(9:2) '/'                   14330030
129700                    PURITM-AD-EVNT-DTE(3:2)                       14340030
129800                    DELIMITED BY SIZE                             14350030
129900                                     INTO ASC-EARLY-AD-DTE        14360030
130000             END-IF                                               14370030
130100                                                                  14380030
130200         WHEN SQLCODE = +100                                      14390030
130300             MOVE SPACES           TO ASC-EARLY-AD-DTE            14400030
130400                                                                  14410030
130500         WHEN SQLCODE = -904                                      14420030
130600         WHEN SQLCODE = -911                                      14430030
130700         WHEN SQLCODE = -913                                      14440030
130800              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       14450030
130900              SET PS-ERROR                                        14460030
131000                  DP020-NEXT-ACT-APPL-ERROR                       14470030
131100                  DP020-MSG-FATAL                                 14480030
131200                                 TO TRUE                          14490030
131300                                                                  14500030
131400         WHEN SQLWARN0 NOT = SPACES                               14510030
131500         WHEN SQLCODE < ZERO                                      14520030
131600         WHEN SQLCODE > ZERO                                      14530030
131700             MOVE '7010-TPURITM-INFO'                             14540030
131800                               TO DP013-PARAGRAPH                 14550030
131900             MOVE 'ERROR SELECTING TPURCHS INFO'                  14560030
132000                               TO DP013-MESSAGE-TEXT (1)          14570030
132100             MOVE SQLCA        TO DP013-SQLCA                     14580030
132200             MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)        14590030
132300             SET DP013-DB2-ABEND                                  14600030
132400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               14610030
132500             PERFORM DP013-0000-PROCESS-ABEND                     14620030
132600     END-EVALUATE.                                                14630030
132700                                                                  14640030
132800/                                                                 14650030
132900 7020-DEPT-BUYER-NAMES.                                           14660030
133000                                                                  14670030
133100     INITIALIZE ASC-BUYER-NAME                                    14680030
133200                DP003-MBS-SUBROUTINE-FIELDS.                      14690030
133300                                                                  14700030
133400     EXEC CICS                                                    14710030
133500         ASKTIME ABSTIME (ST-ABSTIME)                             14720030
133600     END-EXEC.                                                    14730030
133700                                                                  14740030
133800     EXEC CICS                                                    14750030
133900         FORMATTIME ABSTIME (ST-ABSTIME)                          14760030
134000                    YYMMDD  (PV-CURRENT-DATE)                     14770030
134100     END-EXEC.                                                    14780030
134200                                                                  14790030
134300     MOVE ASC-DEPT                     TO DP003-DPT-INPUT.        14800030
134400     SET DP003-BYR-LOOKUP-NAME                                    14810030
134500         DP003-BYR-NAME-FIRST-LAST     TO TRUE                    14820030
134600                                                                  14830030
134700     MOVE 'MP'                         TO DP003-SYSTEM-CODE.      14840030
134800     MOVE '03'                         TO DP003-OP-CO-NMBR.       14850030
134900     MOVE PV-CURRENT-DATE              TO DP003-CURRENT-DATE      14860030
135000                                          DP003-EFF-DATE.         14870030
135100                                                                  14880030
135200     EXEC CICS                                                    14890030
135300         LINK PROGRAM  (PV-DPKUT038)                              14900030
135400              COMMAREA (DP003-MBS-SUBROUTINE-FIELDS)              14910030
135500              LENGTH   (PV-DPKUT038-CA-LENGTH)                    14920030
135600              RESP     (PV-CICS-RESPONSE)                         14930030
135700     END-EXEC.                                                    14940030
135800                                                                  14950030
135900     EVALUATE TRUE                                                14960030
136000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14970030
136100              CONTINUE                                            14980030
136200         WHEN OTHER                                               14990030
136300              MOVE '7000-GET-BUYER-NAME' TO DP013-PARAGRAPH       15000030
136400              MOVE 'CANNOT LINK TO DPKUT038'                      15010030
136500                                         TO DP013-MESSAGE-TEXT (1)15020030
136600              SET DP013-CICS-ABEND       TO TRUE                  15030030
136700              SET DP013-NO-ROLLBACK      TO TRUE                  15040030
136800             PERFORM DP013-0000-PROCESS-ABEND                     15050030
136900     END-EVALUATE.                                                15060030
137000                                                                  15070030
137100     EVALUATE TRUE                                                15080030
137200         WHEN DP003-SUCCESSFUL                                    15090030
137300              MOVE DP003-BYR-NAME      TO ASC-BUYER-NAME          15100030
137400              MOVE DP003-DPT-DESCRIPTION                          15110030
137500                                   TO ASC-DEPT-DESC               15120030
137600                                                                  15130030
137700         WHEN DP003-DPT-NOT-FOUND                                 15140030
137800              MOVE '* NO DEPT NAME FOUND * '                      15150030
137900                                   TO ASC-DEPT-DESC               15160030
138000         WHEN DP003-BYR-NAME-NOT-FOUND                            15170030
138100              MOVE '* NO BUYER NAME FOUND * '                     15180030
138200                                   TO ASC-BUYER-NAME              15190030
138300                                                                  15200030
138400         WHEN DP003-BYR-NAME-DB2-ERROR                            15210030
138500         WHEN DP003-DPT-DB2-ERROR                                 15220030
138600              MOVE '7020-DEPT-BUYER-NAMES'                        15230030
138700                                   TO DP013-PARAGRAPH             15240030
138800              MOVE DP003-RETURN-MSG                               15250030
138900                                   TO DP013-MESSAGE-TEXT (1)      15260030
139000              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      15270030
139100              MOVE DP003-SQLCA         TO DP013-SQLCA             15280030
139200              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)15290030
139300              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)15300030
139400              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)15310030
139500              SET DP013-DB2-ABEND        TO TRUE                  15320030
139600              SET DP013-NO-ROLLBACK      TO TRUE                  15330030
139700             PERFORM DP013-0000-PROCESS-ABEND                     15340030
139800                                                                  15350030
139900         WHEN DP003-BYR-NAME-MAX-RETRIES                          15360030
140000         WHEN DP003-DPT-MAX-RETRIES                               15370030
140100              MOVE '7020-DEPT-BUYER-NAMES'                        15380030
140200                                   TO DP013-PARAGRAPH             15390030
140300              MOVE DP003-RETURN-MSG                               15400030
140400                                   TO DP013-MESSAGE-TEXT (1)      15410030
140500              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      15420030
140600              MOVE DP003-SQLCA         TO DP013-SQLCA             15430030
140700              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)15440030
140800              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)15450030
140900              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)15460030
141000              SET DP013-DB2-ABEND         TO TRUE                 15470030
141100              SET DP013-NO-ROLLBACK       TO TRUE                 15480030
141200             PERFORM DP013-0000-PROCESS-ABEND                     15490030
141300                                                                  15500030
141400         WHEN OTHER                                               15510030
141500              MOVE '7020-DEPT-BUYER-NAMES'                        15520030
141600                                   TO DP013-PARAGRAPH             15530030
141700              MOVE DP003-RETURN-MSG                               15540030
141800                  TO DP013-MESSAGE-TEXT (1)                       15550030
141900              MOVE DP003-DPT-INPUT TO DP013-MESSAGE-TEXT (2)      15560030
142000              MOVE DP003-SQLCA         TO DP013-SQLCA             15570030
142100              MOVE 'TMDSEAR'           TO DP013-DB2-TABLE-NAME (1)15580030
142200              MOVE 'TAPLAVL'           TO DP013-DB2-TABLE-NAME (2)15590030
142300              MOVE 'TRSPBAR'           TO DP013-DB2-TABLE-NAME (3)15600030
142400              SET DP013-OTHER-ABEND      TO TRUE                  15610030
142500              SET DP013-NO-ROLLBACK      TO TRUE                  15620030
142600             PERFORM DP013-0000-PROCESS-ABEND                     15630030
142700     END-EVALUATE.                                                15640030
142800/                                                                 15650030
142900 7030-STATUS-DESC.                                                15660030
143000                                                                  15670030
143100     EXEC SQL                                                     15680030
143200     SELECT STATUS_DESC                                           15690030
143300         INTO :STATCD-STATUS-DESC                                 15700030
143400         FROM TSTATCD                                             15710030
143500         WHERE STATUS_TYP_CDE = 'P'                               15720030
143600         AND STATUS_CDE     = :PURCHS-STATUS-CDE                  15730030
143700     END-EXEC                                                     15740030
143800                                                                  15750030
143900     EVALUATE TRUE                                                15760030
144000                                                                  15770030
144100         WHEN SQLCODE = ZERO                                      15780030
144200             MOVE STATCD-STATUS-DESC TO ASC-STATUS-DESC           15790030
144300         WHEN SQLCODE = +100                                      15800030
144400             MOVE ALL '?'          TO ASC-STATUS-DESC             15810030
144500                                                                  15820030
144600         WHEN SQLCODE = -904                                      15830030
144700         WHEN SQLCODE = -911                                      15840030
144800         WHEN SQLCODE = -913                                      15850030
144900              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       15860030
145000              SET PS-ERROR                                        15870030
145100                  DP020-NEXT-ACT-APPL-ERROR                       15880030
145200                  DP020-MSG-FATAL                                 15890030
145300                                 TO TRUE                          15900030
145400                                                                  15910030
145500         WHEN SQLWARN0 NOT = SPACES                               15920030
145600         WHEN SQLCODE < ZERO                                      15930030
145700         WHEN SQLCODE > ZERO                                      15940030
145800             MOVE '7030-STATUS-DESC'                              15950030
145900                               TO DP013-PARAGRAPH                 15960030
146000             MOVE 'ERROR SELECTING TSTATCD INFO'                  15970030
146100                               TO DP013-MESSAGE-TEXT (1)          15980030
146200             MOVE SQLCA        TO DP013-SQLCA                     15990030
146300             MOVE 'TSTATCD '   TO DP013-DB2-TABLE-NAME (1)        16000030
146400             SET DP013-DB2-ABEND                                  16010030
146500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16020030
146600             PERFORM DP013-0000-PROCESS-ABEND                     16030030
146700     END-EVALUATE.                                                16040030
146800/                                                                 16050030
146900/                                                                 16060030
147000 7100-OPEN-CURSOR.                                                16070030
147100                                                                  16080030
147200     EXEC SQL                                                     16090030
147300         OPEN CULPRIT-CSR                                         16100030
147400     END-EXEC                                                     16110030
147500                                                                  16120030
147600     EVALUATE TRUE                                                16130030
147700         WHEN SQLCODE = ZERO                                      16140030
147800                 CONTINUE                                         16150030
147900                                                                  16160030
148000         WHEN SQLCODE = -904                                      16170030
148100         WHEN SQLCODE = -911                                      16180030
148200         WHEN SQLCODE = -913                                      16190030
148300              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       16200030
148400              SET PS-ERROR                                        16210030
148500                  DP020-NEXT-ACT-APPL-ERROR                       16220030
148600                  DP020-MSG-FATAL                                 16230030
148700                      TO TRUE                                     16240030
148800                                                                  16250030
148900         WHEN SQLWARN0 NOT = SPACES                               16260030
149000         WHEN SQLCODE < ZERO                                      16270030
149100         WHEN SQLCODE > ZERO                                      16280030
149200             MOVE '7100-OPEN-CURSOR'                              16290030
149300                               TO DP013-PARAGRAPH                 16300030
149400             MOVE 'OPEN CULPRIT-CSR CURSOR'                       16310030
149500                               TO DP013-MESSAGE-TEXT (1)          16320030
149600             MOVE SQLCA        TO DP013-SQLCA                     16330030
149700             MOVE 'TRECEIV '   TO DP013-DB2-TABLE-NAME (1)        16340030
149800             MOVE 'TRECITM '   TO DP013-DB2-TABLE-NAME (2)        16350030
149900             MOVE 'TRECDIS '   TO DP013-DB2-TABLE-NAME (3)        16360030
150000             SET DP013-DB2-ABEND                                  16370030
150100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16380030
150200             PERFORM DP013-0000-PROCESS-ABEND                     16390030
150300     END-EVALUATE.                                                16400030
ZZZZZZ**ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ                    16410046
150500 7112-FIRST-RECORD.                                               16420046
                                                                        16430046
084600         PERFORM 7110-FETCH                                       16440046
                                                                        16450046
                                                                        16460046
               IF  ASC-ITEMS-LEFT-ON-DB                                 16470046
                                                                        16480046
                  MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO PV-CANCEL-DTE       16490046
                  MOVE PLNSHP-EXT-CAN-DTE    TO PV-EXT-CAN-DTE          16500046
087500            MOVE PLNSHP-STRT-FCTRY-DTE TO PV-START-X-FCTR-DTE     16510046
087500            MOVE PLNSHP-LAST-FCTRY-DTE TO PV-LAST-X-FCTR-DTE      16520047
087500            MOVE PLNSHP-DONT-SHIP-BEF-DTE TO                      16530046
                                               PV-DONT-SHIP-BEF-DTE     16540047
088700            MOVE PLNSHP-CAN-IFNOT-SHIP-DTE TO                     16550046
                                               PV-CANCEL-DTE            16560048
092300             IF PLNSHP-LAST-UPD-TMST = PC-NULL-TMST               16570046
092400                 CONTINUE                                         16580046
092500             ELSE                                                 16590046
092600                 MOVE PLNSHP-LAST-UPD-BY-UID                      16600046
092700                                 TO WORKER-UID-NBR                16610046
092800                 PERFORM 7050-GET-TWORKER                         16620046
092900             END-IF                                               16630046
093000                                                                  16640046
093100             STRING WORKER-FIR-NAME        DELIMITED BY '  '      16650046
093200                    SPACE                  DELIMITED BY SIZE      16660046
093300                    WORKER-LAST-NAME       DELIMITED BY SIZE      16670046
093400                                 INTO ASC-CULPRIT                 16680046
093500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 16690046
093600         END-IF.                                                  16700048
 ZZZZZ**ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ                   16710046
150400                                                                  16720030
150500 7110-FETCH.                                                      16730030
150600                                                                  16740030
150700     EXEC SQL                                                     16750030
150800         FETCH CULPRIT-CSR                                        16760030
038300          INTO :PLNSHP-STRT-FCTRY-DTE                             16770034
038300             , :PLNSHP-LAST-FCTRY-DTE                             16780034
150900             , :PLNSHP-DONT-SHIP-BEF-DTE                          16790034
151000             , :PLNSHP-CAN-IFNOT-SHIP-DTE                         16800030
151100             , :PLNSHP-EXT-CAN-DTE                                16810030
151200             , :PV-UPD-DATE                                       16820030
151300             , :PV-DB2-HH                                         16830030
151400             , :PV-DB2-MM                                         16840030
151500             , :PLNSHP-LAST-UPD-BY-UID                            16850030
151600             , :PLNSHP-LAST-UPD-TMST                              16860030
151700     END-EXEC.                                                    16870030
151800                                                                  16880030
151900* IF THE LAST UPDATE TIMESTAMP IN TPLNSHP IS NULL, THEN GET       16890030
152000* THE DATES AND USERID FROM TPURCHS.                              16900030
152100     EVALUATE TRUE                                                16910030
152200         WHEN SQLCODE = ZERO                                      16920030
152300             IF PLNSHP-LAST-UPD-TMST = PC-NULL-TMST               16930030
152400                 PERFORM 7040-TPURCHS-TMST-USER                   16940030
152500                 MOVE PURCHS-LAST-UPD-BY-UID                      16950030
152600                                TO WORKER-UID-NBR                 16960030
152700                 PERFORM 7050-GET-TWORKER                         16970030
152800                 MOVE PV-DB2-HH TO PV-UPD-HH                      16980030
152900                 MOVE PV-DB2-MM TO PV-UPD-MM                      16990030
153000             ELSE                                                 17000030
153100                 MOVE PV-DB2-HH TO PV-UPD-HH                      17010030
153200                 MOVE PV-DB2-MM TO PV-UPD-MM                      17020030
153300             END-IF                                               17030030
153400         WHEN SQLCODE = +100                                      17040030
153500              SET ASC-NO-ITEMS-LEFT-ON-DB                         17050030
153600                                   TO TRUE                        17060030
153700         WHEN SQLWARN0 NOT = SPACE                                17070030
153800         WHEN SQLCODE < +0                                        17080030
153900         WHEN SQLCODE > +0                                        17090030
154000              MOVE '7110-FETCH'                                   17100030
154100                                   TO DP013-PARAGRAPH             17110030
154200              MOVE 'FETCH CULPRIT CURSOR'                         17120030
154300                                   TO DP013-MESSAGE-TEXT (1)      17130030
154400              MOVE SQLCA           TO DP013-SQLCA                 17140030
154500              MOVE 'TPLNSHP'       TO DP013-DB2-TABLE-NAME (1)    17150030
154600              MOVE 'TWORKER'       TO DP013-DB2-TABLE-NAME (2)    17160030
154700              SET DP013-DB2-ABEND  TO TRUE                        17170030
154800              PERFORM DP013-0000-PROCESS-ABEND                    17180030
154900     END-EVALUATE.                                                17190030
155000                                                                  17200030
155100/                                                                 17210030
155200 7040-TPURCHS-TMST-USER.                                          17220030
155300                                                                  17230030
155400     EXEC SQL                                                     17240030
155500         SELECT                                                   17250030
155600             DATE(A.LAST_UPD_TMST)                                17260030
155700            ,HOUR(A.LAST_UPD_TMST)                                17270030
155800            ,MINUTE(A.LAST_UPD_TMST)                              17280030
155900            ,A.LAST_UPD_BY_UID                                    17290030
156000         INTO                                                     17300030
156100               :PV-UPD-DATE                                       17310030
156200             , :PV-DB2-HH                                         17320030
156300             , :PV-DB2-MM                                         17330030
156400             , :PURCHS-LAST-UPD-BY-UID                            17340030
156500         FROM TPURCHS A                                           17350030
156600         WHERE A.PO_NBR             = :ASC-KEY-PO-NBR             17360030
156700              AND A.PO_CATEG_CDE    = 'MR'                        17370030
156800              AND A.VER_NBR IN                                    17380030
156900             (SELECT MIN(B.VER_NBR)                               17390030
157000               FROM TPURCHS B                                     17400030
157100               WHERE B.PO_NBR       = :ASC-KEY-PO-NBR             17410030
157200               AND B.PO_CATEG_CDE   = 'MR')                       17420030
157300     END-EXEC                                                     17430030
157400                                                                  17440030
157500     EVALUATE TRUE                                                17450030
157600                                                                  17460030
157700         WHEN SQLCODE = ZERO                                      17470030
157800         WHEN SQLCODE = +100                                      17480030
157900             CONTINUE                                             17490030
158000                                                                  17500030
158100         WHEN SQLCODE = -904                                      17510030
158200         WHEN SQLCODE = -911                                      17520030
158300         WHEN SQLCODE = -913                                      17530030
158400              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       17540030
158500              SET PS-ERROR                                        17550030
158600                  DP020-NEXT-ACT-APPL-ERROR                       17560030
158700                  DP020-MSG-FATAL                                 17570030
158800                                 TO TRUE                          17580030
158900                                                                  17590030
159000         WHEN SQLWARN0 NOT = SPACES                               17600030
159100         WHEN SQLCODE < ZERO                                      17610030
159200         WHEN SQLCODE > ZERO                                      17620030
159300             MOVE '7040-TPURCHS-TMST-USER'                        17630030
159400                               TO DP013-PARAGRAPH                 17640030
159500             MOVE 'ERROR SELECTING TPURCHS INFO'                  17650030
159600                               TO DP013-MESSAGE-TEXT (1)          17660030
159700             MOVE SQLCA        TO DP013-SQLCA                     17670030
159800             MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)        17680030
159900             SET DP013-DB2-ABEND                                  17690030
160000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17700030
160100             PERFORM DP013-0000-PROCESS-ABEND                     17710030
160200     END-EVALUATE.                                                17720030
160300                                                                  17730030
160400 7050-GET-TWORKER.                                                17740030
160500     EXEC SQL                                                     17750030
160600         SELECT A.FIR_NAME                                        17760030
160700               ,A.LAST_NAME                                       17770030
160800         INTO  :WORKER-FIR-NAME                                   17780030
160900             , :WORKER-LAST-NAME                                  17790030
161000         FROM TWORKER A                                           17800030
161100         WHERE                                                    17810030
161200               A.UID_NBR         = :WORKER-UID-NBR                17820030
161300         END-EXEC                                                 17830030
161400                                                                  17840030
161500     EVALUATE TRUE                                                17850030
161600                                                                  17860030
161700         WHEN SQLCODE = ZERO                                      17870030
161800             CONTINUE                                             17880030
161900         WHEN SQLCODE = +100                                      17890030
162000         MOVE WORKER-UID-NBR     TO WORKER-FIR-NAME               17900053
162100         MOVE SPACES             TO WORKER-LAST-NAME              17910053
162200         WHEN SQLCODE = -904                                      17920030
162300         WHEN SQLCODE = -911                                      17930030
162400         WHEN SQLCODE = -913                                      17940030
162500              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       17950030
162600              SET PS-ERROR                                        17960030
162700                  DP020-NEXT-ACT-APPL-ERROR                       17970030
162800                  DP020-MSG-FATAL                                 17980030
162900                                 TO TRUE                          17990030
163000                                                                  18000030
163100         WHEN SQLWARN0 NOT = SPACES                               18010030
163200         WHEN SQLCODE < ZERO                                      18020030
163300         WHEN SQLCODE > ZERO                                      18030030
163400             MOVE '7050-GET-TWORKER'                              18040030
163500                               TO DP013-PARAGRAPH                 18050030
163600             MOVE 'ERROR SELECTING TWORKER INFO'                  18060030
163700                               TO DP013-MESSAGE-TEXT (1)          18070030
163800             MOVE SQLCA        TO DP013-SQLCA                     18080030
163900             MOVE 'TWORKER '   TO DP013-DB2-TABLE-NAME (1)        18090030
164000             SET DP013-DB2-ABEND                                  18100030
164100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18110030
164200             PERFORM DP013-0000-PROCESS-ABEND                     18120030
164300     END-EVALUATE.                                                18130030
164400/                                                                 18140030
164500 7120-CLOSE-CURSOR.                                               18150030
164600                                                                  18160030
164700     EXEC SQL                                                     18170030
164800         CLOSE CULPRIT-CSR                                        18180030
164900     END-EXEC.                                                    18190030
165000                                                                  18200030
165100     EVALUATE TRUE                                                18210030
165200         WHEN SQLCODE = ZERO                                      18220030
165300             CONTINUE                                             18230030
165400         WHEN SQLCODE = -904                                      18240030
165500         WHEN SQLCODE = -911                                      18250030
165600         WHEN SQLCODE = -913                                      18260030
165700              MOVE PC-TSYMSG-00984      TO DP020-MSG-NUMBER       18270030
165800              SET PS-ERROR                                        18280030
165900                  DP020-NEXT-ACT-APPL-ERROR                       18290030
166000                  DP020-MSG-FATAL                                 18300030
166100                      TO TRUE                                     18310030
166200                                                                  18320030
166300         WHEN SQLWARN0 NOT = SPACES                               18330030
166400         WHEN SQLCODE < ZERO                                      18340030
166500         WHEN SQLCODE > ZERO                                      18350030
166600             MOVE '7120-CLOSE-CURSOR'                             18360030
166700                                   TO DP013-PARAGRAPH             18370030
166800             MOVE 'CLOSE CULPRIT-CSR CURSOR'                      18380030
166900                                   TO DP013-MESSAGE-TEXT (1)      18390030
167000             MOVE SQLCA            TO DP013-SQLCA                 18400030
167100             MOVE 'TPLNSHP'    TO DP013-DB2-TABLE-NAME (1)        18410030
167200             MOVE 'TWORKER'    TO DP013-DB2-TABLE-NAME (2)        18420030
167300             SET DP013-DB2-ABEND                                  18430030
167400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18440030
167500             PERFORM DP013-0000-PROCESS-ABEND                     18450030
167600     END-EVALUATE.                                                18460030
167700/                                                                 18470030
167800*---------------------------------------------------------------* 18480030
167900*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 18490030
168000*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 18500030
168100*---------------------------------------------------------------* 18510030
168200 9000-CALL-CICS-ARCH-API.                                         18520030
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      18530059
168400                                    DFHCOMMAREA                   18540059
168500                                    DP030-CICS-API-FIELDS         18550059
168600                                    DP020-STANDARD-COMMAREA       18560059
168700                                    PO081AI.                      18570059
168800                                                                  18580030
168900     IF DP030-RC-CALL-SUCCESSFUL OR                               18590030
169000        DP030-RC-APPL-ERROR                                       18600030
169100         CONTINUE                                                 18610030
169200     ELSE                                                         18620030
169300         SET DP013-NO-ROLLBACK                                    18630030
169400             DP013-XCTL-DISPLAY-RESTART                           18640030
169500             DP013-CICS-ABEND      TO TRUE                        18650030
169600         MOVE '9000-CALL-CICS-ARCH-API'                           18660030
169700                                   TO DP013-PARAGRAPH             18670030
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O18680059
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      18690059
170000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      18700030
170100         PERFORM DP013-0000-PROCESS-ABEND                         18710030
170200     END-IF.                                                      18720030
170300/                                                                 18730030
170400 EJECT                                                            18740030
170500                                                                  18750030
171400*----------------------------------------------------------------*18760030
171500*    ABEND PROCESSOR MODULE                                      *18770030
171600*----------------------------------------------------------------*18780030
171700     COPY DPPD013.                                                18790030
