000100*----------------------------------------------------------       00000102
000200 IDENTIFICATION DIVISION.                                         00000202
000300*----------------------------------------------------------       00000302
000400 PROGRAM-ID.    XSKUT125.                                         00000402
000500 AUTHOR.        CHERI PARMLEY.                                    00000502
000600 DATE-WRITTEN.  MAY 3, 2010.                                      00000602
000700                                                                  00000702
000800*----------------------------------------------------------       00000802
000900*            PRICING BUSINESS EVENT EXTRACT                       00000902
001000*----------------------------------------------------------       00001002
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00002002
001020* EXTRACT FOR THE REBATE FORM BUSINESS EVENT.                     00003002
001124*                                                                 00004002
001125*----------------------------------------------------------       00005002
001126* HISTORY LOG:                                                    00006002
001127*                                                                 00007002
001128*----------------------------------------------------------       00008002
001129* DATE:        09/15/2010                                         00009037
001130* WR/IR#:      PKE#000000005095                                   00010039
001131* PROGRAMMER:  CHERI PARMLEY                                      00020037
001140* DESCRIPTION: EXCLUDE 'D' STAT CODE IN THE CURSOR                00030037
001150*                                                                 00040002
001160*----------------------------------------------------------       00050002
001170 ENVIRONMENT DIVISION.                                            00060002
001180*----------------------------------------------------------       00070002
001190 CONFIGURATION SECTION.                                           00080002
001200 SOURCE-COMPUTER. IBM-3090.                                       00090002
001300 OBJECT-COMPUTER. IBM-3090.                                       00100002
001400                                                                  00110002
001500 INPUT-OUTPUT SECTION.                                            00120002
001600                                                                  00130002
001700 FILE-CONTROL.                                                    00140002
001800                                                                  00150002
004900     SELECT DATE-RANGE-FILE                                       00160002
005000         ASSIGN TO INP01.                                         00170002
                                                                        00180002
004900     SELECT TMST-FILE                                             00190002
005000         ASSIGN TO INP02.                                         00191002
                                                                        00192002
004900     SELECT EXTRACT-FILE                                          00193002
005000         ASSIGN TO OUT01.                                         00194002
001900*----------------------------------------------------------       00195002
002000 DATA DIVISION.                                                   00196002
002100*----------------------------------------------------------       00197002
002200 FILE SECTION.                                                    00198002
002300                                                                  00199002
008000 FD  EXTRACT-FILE                                                 00200002
008100     RECORDING MODE IS F                                          00210002
008200     LABEL RECORDS ARE OMITTED                                    00220002
008300     RECORD CONTAINS 160 CHARACTERS                               00230036
008400     DATA RECORD IS REBATE-REC.                                   00240003
008500 01  REBATE-REC            PIC X(160).                            00250036
                                                                        00251002
005800 FD  DATE-RANGE-FILE                                              00260002
005900     RECORDING MODE IS F                                          00270002
006000     LABEL RECORDS ARE OMITTED                                    00280002
006100     RECORD CONTAINS 80 CHARACTERS                                00290002
006200     BLOCK CONTAINS 0 RECORDS.                                    00300002
       01  DATE-RANGE-LINE             PIC  X(80).                      00310002
006500                                                                  00320002
005800 FD  TMST-FILE                                                    00330002
005900     RECORDING MODE IS F                                          00331002
006000     LABEL RECORDS ARE OMITTED                                    00332002
006100     RECORD CONTAINS 80 CHARACTERS                                00333002
006200     BLOCK CONTAINS 0 RECORDS.                                    00334002
       01  TMST-LINE                        PIC  X(80).                 00335002
008600                                                                  00336002
006500                                                                  00337002
002500*---------------------------------------------------------        00338002
002600                                                                  00339002
002700 WORKING-STORAGE SECTION.                                         00340002
002800*---------------------------------------------------------        00350002
003500* PC- PROGRAM CONSTANTS                                           00360002
003600*----------------------------------------------------------       00370002
003700 01  PC-PROGRAM-CONSTANTS.                                        00380002
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT125'. 00390002
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00400002
004000                                                                  00410002
004100*----------------------------------------------------------       00420002
004200* PS- PROGRAM SWITCHES                                            00430002
004300*----------------------------------------------------------       00440002
004400 01  PS-PROGRAM-SWITCHES.                                         00450002
004500     05  PS-EOF-EXTRACT-SW           PIC X(01)  VALUE SPACE.      00460002
004600         88  PS-EOF-EXTRACT                      VALUE 'Y'.       00470002
004600         88  PS-NOT-EOF-EXTRACT                  VALUE 'N'.       00480002
           05  PS-DATE-RANGE-FILE-SW        PIC  X(01)  VALUE 'N'.      00520002
               88  PS-DATE-RANGE-FILE-END               VALUE 'Y'.      00530002
               88  PS-DATE-RANGE-FILE-START             VALUE 'N'.      00540002
           05  PS-TMST-FILE-SW              PIC  X(01)  VALUE 'N'.      00550002
               88  PS-TMST-FILE-END                     VALUE 'Y'.      00560002
               88  PS-TMST-FILE-START                   VALUE 'N'.      00570002
004800                                                                  00580002
004900*----------------------------------------------------------       00590002
005000* PV- PROGRAM VARIABLES                                           00600002
005100*----------------------------------------------------------       00610002
       01  CC-DATE-RANGE-FILE.                                          00620002
           05  CC-START-DATE                PIC X(10).                  00630002
           05  FILLER                       PIC X(01).                  00630102
           05  CC-END-DATE                  PIC X(10).                  00630202
                                                                        00630302
      *FORMAT OF TMST CCYY-MM-DD-HH.MM.SS                               00630423
       01  CC-TMST-FILE.                                                00630502
           05  CC-LAST-UPD-TMST             PIC X(19).                  00630602
                                                                        00630702
005200 01 PV-PROGRAM-VARIABLES.                                         00632802
006000    05  PV-RECORD-COUNT               PIC 9(10) VALUE ZEROS.      00632902
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00633002
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00634002
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00635002
005700    05  PV-LAST-UPD-TMST              PIC X(26)  VALUE SPACES.    00636002
005710    05  PV-AD-EVNT-ID                 PIC S9(09) VALUE +0.        00637002
                                                                        00638002
007100    05  PV-STRT-PARM.                                             00639002
007200        10  PV-STRT-DTE-CC            PIC X(02).                  00640002
007200        10  PV-STRT-DTE-YY            PIC X(02).                  00650002
007400        10  PV-STRT-DTE-MM            PIC X(02).                  00660002
007600        10  PV-STRT-DTE-DD            PIC X(02).                  00670002
007400        10  FILLER                    PIC X.                      00680002
007400        10  PV-DECREMENT              PIC X(02).                  00690002
007400        10  FILLER                    PIC X(69).                  00700002
007700                                                                  00710002
007100    05  PV-EVNT-STRT-DTE              PIC X(10).                  00720002
008500                                                                  00740002
008600    05  PV-EVNT-END-DTE-TM.                                       00750002
008700        10  PV-EVNT-END-DTE.                                      00760002
008800            15  PV-EVNT-DTE-TM2-CCYY      PIC X(04).              00770002
008900            15  FILLER                    PIC X(01).              00780002
009000            15  PV-EVNT-DTE-TM2-MM        PIC X(02).              00790002
009100            15  FILLER                    PIC X(01).              00800002
009200            15  PV-EVNT-DTE-TM2-DD        PIC X(02).              00810002
009300        10  PV-EVNT-END-TM                PIC X(16).              00820002
009400                                                                  00830002
          05  PV-NULL                      PIC  S9(4)  VALUE -1.        00929202
          05  PV-OPERATION-MSG             PIC  X(60)  VALUE SPACES.    00929302
          05  PV-OPERATION-MSG-1           PIC  X(40)  VALUE SPACES.    00929402
                                                                        00929502
       01 PV-TOTAL-RECORD.                                              00929902
          05 PV-BUSINESS-EVNT-ID              PIC 9(03) VALUE 130.      00930013
          05 PV-ACTION-CDE                    PIC X(01) VALUE 'T'.      00930102
          05 PV-TOTAL-NBR-OF-RECS             PIC 9(11) VALUE ZERO.     00930202
                                                                        00930322
004600*----------------------------------------------------------       00930902
004700* REBATE FORM BUSINESS EVENT RECORD LAYOUT                        00931002
004800*----------------------------------------------------------       00931102
004900     COPY XSRD122.                                                00931202
005000                                                                  00931302
006800*---------------------------------------------                    00931402
006900*  DB2 TABLE XST00026(XST_PROMO) - PROMOTION TABLE                00931502
007000*---------------------------------------------                    00931602
007100     EXEC SQL                                                     00931702
007200          INCLUDE XST00026                                        00931802
007300     END-EXEC.                                                    00931902
007400                                                                  00932002
007500*---------------------------------------------                    00932102
007600*  DB2 TABLE XST00130(XST_REBT_FM) -                              00932202
007700*---------------------------------------------                    00932302
007800     EXEC SQL                                                     00932402
007900          INCLUDE XST00130                                        00932502
008000     END-EXEC.                                                    00932602
008100                                                                  00933002
008200*---------------------------------------------                    00934002
008300*  DB2 TABLE XST00131(XST_REBT_FM_TXT) - TEXT                     00935002
008400*---------------------------------------------                    00936002
008500     EXEC SQL                                                     00937002
008600          INCLUDE XST00131                                        00938002
008700     END-EXEC.                                                    00939002
008800                                                                  00940002
011400*----------------------------------------------------------       00980202
011500* DATE ROUTINE COPY MEMBERS                                       00980302
011600*----------------------------------------------------------       00980402
011700     COPY DPWS500.                                                00980502
011800                                                                  00980602
011900*----------------------------------------------------------       00980702
012000* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         00980802
012100*----------------------------------------------------------       00980902
012200     COPY DPWS004.                                                00981002
012300                                                                  00981102
030160*---------------------------------------------                    00981202
030170*  DB2 COMMUNICATION AREA.                                        00981302
030180*---------------------------------------------                    00981402
030190     EXEC SQL                                                     00981502
030191          INCLUDE SQLCA                                           00981602
030192     END-EXEC.                                                    00981702
030193                                                                  00981802
023000     COPY SQLCA2.                                                 00981902
030194*---------------------------------------------                    01070002
023300*   EXTRACT CURSOR  DB2 SELECT                                    01080002
030194*---------------------------------------------                    01090002
023400     EXEC SQL                                                     01100002
023500       DECLARE EXTRACT CURSOR FOR                                 01110002
              SELECT A.PROMO_INTFC_ID                                   01120009
                    ,A.MDSE_LNE_ID                                      01130009
                    ,B.REBT_PROMO_ID                                    01140009
                    ,B.REBT_FM_ID                                       01150009
                    ,B.FM_SECT_TYP_CDE                                  01160009
                    ,B.FM_LNE_TYP_CDE                                   01170009
                    ,B.FM_LNE_NBR                                       01180009
                    ,B.EFF_END_DTE                                      01190009
                    ,B.FM_TXT                                           01191012
                    ,B.STAT_CDE                                         01200009
                    ,B.SOR_LAST_UPD_TMST                                01280009
024100        FROM XST_REBT_FM A                                        01281009
024100            ,XST_REBT_FM_TXT B                                    01281110
02410             ,XST_PROMO C                                          01282009
024200        WHERE  A.REBT_FM_ID     = B.REBT_FM_ID                    01283202
024200        AND    B.REBT_PROMO_ID  = C.PROMO_ID                      01283302
              AND    DATE(C.DFLT_END_TMST)                              01284002
                          >= :CC-START-DATE                             01285002
              AND    DATE(C.DFLT_STRT_TMST)                             01285102
                          <= :CC-END-DATE                               01285202
              AND A.SOR_LAST_UPD_TMST <=                                01285302
                     :CC-LAST-UPD-TMST                                  01285402
091510        AND B.STAT_CDE <> 'D'                                     01285537
               WITH UR                                                  01285602
024400     END-EXEC.                                                    01285702
030310                                                                  01285802
031400*----------------------------------------------------------       01285902
031500 PROCEDURE DIVISION.                                              01286002
032100*----------------------------------------------------------       01286102
032200 0000-MAINLINE.                                                   01287002
032300                                                                  01288002
032400     PERFORM 1000-INITIALIZATION.                                 01289002
032500                                                                  01290002
032600     PERFORM 2000-EXTRACT-DATA                                    01300002
032700             UNTIL PS-EOF-EXTRACT.                                01301002
035000                                                                  01302002
035100     PERFORM 9990-WRITE-RECORD-CNT.                               01303002
                                                                        01304002
035100     PERFORM 9999-WRAPUP.                                         01305002
035200                                                                  01306002
035500     GOBACK.                                                      01307002
035700                                                                  01308002
035701*0000-EXIT.                                                       01309002
035702 EJECT.                                                           01310002
035703                                                                  01320002
035800*----------------------------------------------------------       01330002
035900* 1000-INITIALIZATION.                                            01340002
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01350002
036100*     UPDATE OR INSERT A RECORD.                                  01360002
036200*----------------------------------------------------------       01370002
036300 1000-INITIALIZATION.                                             01380002
                                                                        01390002
           SET PS-NOT-EOF-EXTRACT TO TRUE.                              01400002
                                                                        01410002
026600     OPEN INPUT DATE-RANGE-FILE                                   01420002
026600                TMST-FILE                                         01430002
026600          OUTPUT EXTRACT-FILE.                                    01440002
                                                                        01450002
051100     PERFORM 6000-COMPUTE-STRT-DTE                                01460021
051200        THRU 6000-EXIT.                                           01470021
038000                                                                  01480002
027900     EXEC SQL                                                     01490002
028000         OPEN EXTRACT                                             01500002
028100     END-EXEC.                                                    01510002
                                                                        01520002
055500     IF SQLCODE < 0                                               01530002
055600        DISPLAY 'OPEN  FAILED FOR CURSOR EXTRACT'                 01540002
055700         PERFORM U9980-SQL-ERROR                                  01550002
055800            THRU U9980-EXIT.                                      01560002
055900                                                                  01570002
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               01580002
056100           SQLWARN0 = 'W'                                         01590002
056200         DISPLAY 'FETCH WARNING FOR CURSOR EXTRACT'               01600002
056300         PERFORM U9990-SQL-WARNING                                01610002
056400            THRU U9990-EXIT.                                      01620002
056500                                                                  01630002
036410     INITIALIZE DCLXST00026.                                      01660005
036410     INITIALIZE DCLXST00130.                                      01670004
036410     INITIALIZE DCLXST00131.                                      01680004
036515                                                                  01700002
037240*1100-EXIT.                                                       01710002
037250 EJECT.                                                           01720002
037251                                                                  01730002
037260*----------------------------------------------------------       01740002
037300* 2000-EXTRACT-DATA.                                              01750002
037800*----------------------------------------------------------       01800002
037900 2000-EXTRACT-DATA.                                               01810002
                                                                        01820002
051100     PERFORM 2100-FETCH-EXTRACT                                   01830002
051200        THRU 2100-EXIT.                                           01840002
038000                                                                  01850002
           IF PS-NOT-EOF-EXTRACT                                        01860002
051100         PERFORM 2200-FORMAT-EXTRACT-FILE                         01870002
051200            THRU 2200-EXIT                                        01880002
                                                                        01890002
051100         PERFORM 3000-WRITE-REBATE-EXTRACT                        01891003
051200            THRU 3000-EXIT                                        01892003
                                                                        01900002
           END-IF.                                                      01910002
038000                                                                  01920002
038110*2000-EXIT.                                                       01930002
038200 EJECT.                                                           01931002
038300*------------------------------------------------------           02039702
038400* 2100-FETCH-EXTRACT                                              02039802
038500*     EXTRACTS THE REBATE RECORD.                                 02039931
038600*------------------------------------------------------           02040002
038210                                                                  02041002
054400 2100-FETCH-EXTRACT.                                              02042002
054500                                                                  02043002
054600     EXEC SQL                                                     02044002
054700         FETCH EXTRACT                                            02045002
                   INTO :XST00130-PROMO-INTFC-ID                        02046112
                       ,:XST00130-MDSE-LNE-ID                           02047012
                       ,:XST00131-REBT-PROMO-ID                         02047112
                       ,:XST00131-REBT-FM-ID                            02048012
                       ,:XST00131-FM-SECT-TYP-CDE                       02050012
                       ,:XST00131-FM-LNE-TYP-CDE                        02060012
                       ,:XST00131-FM-LNE-NBR                            02070012
                       ,:XST00131-EFF-END-DTE                           02080012
                       ,:XST00131-FM-TXT                                02081012
                       ,:XST00131-STAT-CDE                              02090012
                       ,:XST00131-SOR-LAST-UPD-TMST                     02100012
055300     END-EXEC.                                                    02180002
055400                                                                  02190002
055500     IF SQLCODE < 0                                               02200002
055600         DISPLAY 'FETCH FAILED FOR CURSOR EXTRACT'                02210002
055700         PERFORM U9980-SQL-ERROR                                  02211002
055800            THRU U9980-EXIT.                                      02212002
055900                                                                  02213002
056000     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02214002
056100           SQLWARN0 = 'W'                                         02215002
056200         DISPLAY 'FETCH WARNING FOR TABLE XST_REBT_FORM_TXT'      02216003
056300         PERFORM U9990-SQL-WARNING                                02217002
056400            THRU U9990-EXIT.                                      02218002
056500                                                                  02219002
056600     IF SQLCODE = +100                                            02220002
056700         MOVE 'Y' TO PS-EOF-EXTRACT-SW.                           02230002
056800                                                                  02240002
                                                                        02250002
056900 2100-EXIT.                                                       02260002
057000     EXIT.                                                        02270002
038300*------------------------------------------------------           02280002
038400* 2200-FORMAT-EXTRACT-FILE                                        02290002
038500*     FORMATS THE REBATE COPY BOOK.                               02300003
038600*------------------------------------------------------           02310002
038700 2200-FORMAT-EXTRACT-FILE.                                        02320002
           INITIALIZE XS122-REBT-FORM-RECORD.                           02330003
                                                                        02350002
           MOVE 130                      TO XS122-BUSINESS-EVNT-ID.     02351018
           MOVE 'U'                      TO XS122-ACTION-CDE.           02352018
                                                                        02353003
           MOVE XST00130-PROMO-INTFC-ID  TO XS122-INCTV-PROMO-INTFC-ID. 02370020
           MOVE XST00130-MDSE-LNE-ID     TO XS122-MDSE-SELN-SEQ-NBR.    02380018
           MOVE XST00131-REBT-PROMO-ID   TO XS122-REBT-PROMO-ID.        02390018
           MOVE XST00131-REBT-FM-ID      TO XS122-REBT-FM-ID.           02400018
           MOVE XST00131-FM-SECT-TYP-CDE TO XS122-FM-SECT-TYP-CDE.      02410004
           MOVE XST00131-FM-LNE-TYP-CDE  TO XS122-FM-LNE-TYP-CDE.       02420018
           MOVE XST00131-FM-LNE-NBR      TO XS122-FM-LNE-NBR.           02430018
           MOVE XST00131-EFF-END-DTE     TO XS122-EFF-END-TMST.         02440030
           MOVE XST00131-FM-TXT          TO XS122-FM-TXT.               02441018
           MOVE XST00131-STAT-CDE        TO XS122-STAT-CDE.             02450018
           MOVE XST00131-SOR-LAST-UPD-TMST TO                           02460003
                XS122-LAST-UPD-TMST.                                    02470003
038800                                                                  02580502
043510 2200-EXIT.                                                       02580602
           EXIT.                                                        02580702
043600 EJECT.                                                           02580802
043610                                                                  02580902
036801                                                                  02593002
043700*------------------------------------------------------           02593102
043800* 3000-WRITE-REBATE-EXTRACT                                       02593204
043900*     WRITE EXTRACT FILE.                                         02593302
044000*------------------------------------------------------           02593402
044100 3000-WRITE-REBATE-EXTRACT.                                       02593504
           ADD 1 TO PV-RECORD-COUNT.                                    02593602
062300     WRITE REBATE-REC FROM XS122-REBT-FORM-RECORD.                02593703
                                                                        02593802
047710 3000-EXIT.                                                       02593902
           EXIT.                                                        02594002
047800 EJECT.                                                           02594102
047810                                                                  02594202
056020                                                                  02594302
                                                                        02597221
030000 6000-COMPUTE-STRT-DTE.                                           02597321
030100                                                                  02597421
           READ DATE-RANGE-FILE INTO CC-DATE-RANGE-FILE                 02597521
              AT END                                                    02597621
                 SET PS-DATE-RANGE-FILE-END TO TRUE                     02597721
           END-READ.                                                    02597821
                                                                        02597921
           IF PS-DATE-RANGE-FILE-END                                    02598021
               MOVE 'NO DATE RANGE FILE TO PROCESS'                     02598121
                                                 TO PV-OPERATION-MSG-1  02598221
               PERFORM Z910-ABEND                                       02598321
           ELSE                                                         02598421
      **************************************************************    02598535
      *        NOTE: WHEN CALLING DATE ROUTINE MULTIPLE TIMES WITHIN    02598635
      *        PROGRAM MUST DO THE FOLLOWING RIGHT BEFORE 7000- IS      02598735
      *        PERFORMED (INITALIZE AND SET AND MOVE OF DATE TO         02598835
      *        DPG52- FIELD)                                            02598935
268700         INITIALIZE DPG51 DPG52 DPG53                             02599035
268800                    DPG54 DPG55 DPG56                             02599135
268900                                                                  02599235
269000         SET DPG51-FISCAL-454-CALENDAR  TO TRUE                   02599335
269100         SET DPG52-LK-DTE-ISO-FMT       TO TRUE                   02599435
               MOVE CC-START-DATE TO DPG52-DB2-ISO-DATE-FMT             02599535
      ***************************************************************   02599635
               DISPLAY CC-START-DATE ' ' DPG52-DB2-ISO-DATE-FMT         02599735
               PERFORM 7000-DATE-ROUTINE                                02599835
268700         INITIALIZE DPG51 DPG52 DPG53                             02599935
268800                    DPG54 DPG55 DPG56                             02600035
269000         SET DPG51-FISCAL-454-CALENDAR  TO TRUE                   02600135
269100         SET DPG52-LK-DTE-ISO-FMT       TO TRUE                   02600235
               MOVE CC-END-DATE TO DPG52-DB2-ISO-DATE-FMT               02600335
               PERFORM 7000-DATE-ROUTINE                                02600535
               DISPLAY 'CC-START-DATE = ' CC-START-DATE                 02600635
               DISPLAY 'CC-END-DATE   = ' CC-END-DATE                   02600735
           END-IF.                                                      02600835
                                                                        02600935
           READ TMST-FILE INTO CC-TMST-FILE                             02601035
              AT END                                                    02601135
                 SET PS-TMST-FILE-END TO TRUE                           02601235
           END-READ.                                                    02601335
                                                                        02601435
           IF PS-TMST-FILE-END                                          02601535
               MOVE 'NO TMST FILE TO PROCESS'                           02601635
                                                 TO PV-OPERATION-MSG-1  02601735
               PERFORM Z910-ABEND                                       02601835
           ELSE                                                         02601935
268700         INITIALIZE DPG51 DPG52 DPG53                             02602035
268800                    DPG54 DPG55 DPG56                             02602135
269000         SET DPG51-FISCAL-454-CALENDAR  TO TRUE                   02602235
269100         SET DPG52-LK-DTE-ISO-FMT       TO TRUE                   02602335
               MOVE CC-LAST-UPD-TMST(1:10) TO                           02602435
                                     DPG52-DB2-ISO-DATE-FMT             02602535
               PERFORM 7000-DATE-ROUTINE                                02602635
               DISPLAY 'CC-LAST-UPD-TMST = ' CC-LAST-UPD-TMST           02602735
           END-IF.                                                      02602835
 35100                                                                  02602935
038110 6000-EXIT.                                                       02603035
           EXIT.                                                        02603135
268140*----------------------------------------------------------       02603235
      *    THIS IS CALLED MULTIPLE TIMES MUST DO THE INITIALIZE         02603535
      *    SET OF SWITCHES AND MOVE TO DPG52 PRIOR TO THE PERFORM       02603635
268400*----------------------------------------------------------       02603835
268500 7000-DATE-ROUTINE.                                               02603935
268600                                                                  02604035
268700*    INITIALIZE DPG51 DPG52 DPG53                                 02604135
268800*               DPG54 DPG55 DPG56.                                02604235
268900*                                                                 02604335
269000*    SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      02604435
269100*    SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      02604535
269300                                                                  02604635
      *    MOVE CC-START-DATE TO DPG52-DB2-ISO-DATE-FMT                 02604735
                                                                        02604835
269400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    02604935
269500                                             DPG54 DPG55 DPG56.   02605035
269600                                                                  02605135
269700     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  02605235
269800       DISPLAY '** ABEND **'                                      02605335
269900       DISPLAY '** PROGRAM = XSKUT125'                            02605435
270000       DISPLAY 'DATE = ' DPG52-DB2-ISO-DATE-FMT                   02605535
270100       DISPLAY DPG54-ERROR-MESSAGE                                02605635
270200       MOVE 4019 TO ABEND-CODE                                    02605735
270300       CALL 'ILBOABN0' USING ABEND-CODE                           02605835
270400     END-IF.                                                      02605935
270500                                                                  02606035
270800*7000-EXIT.                                                       02606135
038200 EJECT.                                                           02606235
059800*----------------------------------------------------------       02606335
073900 U9980-SQL-ERROR.                                                 02606435
059800*----------------------------------------------------------       02606535
074000                                                                  02606635
074100     MOVE SQLCODE    TO SQLCODE2.                                 02606735
074200     MOVE SQLERRD(3) TO SQLERRD3.                                 02606835
074300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02606935
074400     DISPLAY '** PROGRAM        ** = XSKUT125'.                   02607035
074500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02607135
074600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02607235
074700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02607335
074800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02607435
      ******************************************************************02607535
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02607635
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02607735
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02607835
      * FORMAT.                                                         02607935
      ******************************************************************02608035
           COPY DPPD004.                                                02608135
           MOVE +4013 TO ABEND-CODE.                                    02608235
           CALL 'ILBOABN0' USING ABEND-CODE.                            02608335
075200                                                                  02608435
075300 U9980-EXIT.                                                      02608535
075400     EXIT.                                                        02608635
                                                                        02608735
059800*----------------------------------------------------------       02608835
075600 U9990-SQL-WARNING.                                               02608935
059800*----------------------------------------------------------       02609035
075700                                                                  02609135
075800     MOVE SQLCODE    TO SQLCODE2.                                 02609202
075900     MOVE SQLERRD(3) TO SQLERRD3.                                 02610002
076000     DISPLAY '** ABEND **       ** = SQLWARNING'.                 02620002
076100     DISPLAY '** PROGRAM        ** = XSKUT125'.                   02630002
      ******************************************************************02640002
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02650002
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02660002
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02670002
      * FORMAT.                                                         02680002
      ******************************************************************02690002
           COPY DPPD004.                                                02700002
           MOVE +4013 TO ABEND-CODE.                                    02710002
           CALL 'ILBOABN0' USING ABEND-CODE.                            02720002
077500                                                                  02730002
077600 U9990-EXIT.                                                      02740002
077700     EXIT.                                                        02750002
                                                                        02760002
060100 9990-WRITE-RECORD-CNT.                                           02770002
           MOVE PV-RECORD-COUNT TO PV-TOTAL-NBR-OF-RECS.                02800013
           ADD 1 TO PV-RECORD-COUNT.                                    02831013
062300     WRITE REBATE-REC FROM PV-TOTAL-RECORD.                       02832013
060710*9990-EXIT.                                                       02840002
                                                                        02850002
059800*----------------------------------------------------------       02860002
059900* 9999-WRAPUP.                                                    02870002
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           02880002
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           02881002
059930*     PROGRAM.                                                    02882002
060000*----------------------------------------------------------       02883002
*                                                                       02884002
060100 9999-WRAPUP.                                                     02885002
           CLOSE DATE-RANGE-FILE                                        02886002
                 TMST-FILE                                              02887002
                 EXTRACT-FILE.                                          02888002
                                                                        02889002
072200     EXEC SQL                                                     02890002
072300         CLOSE EXTRACT                                            02900002
072400     END-EXEC.                                                    02910002
060200                                                                  02920002
060500                                                                  02930002
060710*9999-EXIT.                                                       02940002
060800 EJECT.                                                           02950002
060900                                                                  02960002
      ******************************************************************02970002
      * Z910-ABEND - PERFORMS A NON-SQL-ABEND                          *02980002
      ******************************************************************02990002
       Z910-ABEND.                                                      03000002
                                                                        03010002
           DISPLAY '** ABEND           **'.                             03020002
           DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG.         03030002
           DISPLAY '**                 ** = ' PV-OPERATION-MSG-1.       03040002
                                                                        03050002
           CALL 'ILBOABN0' USING ABEND-CODE.                            03060002
