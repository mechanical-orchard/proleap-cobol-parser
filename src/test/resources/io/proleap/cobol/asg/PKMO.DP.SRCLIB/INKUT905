      *************************                                                 
       IDENTIFICATION DIVISION.                                                 
      *************************                                                 
       PROGRAM-ID.    INKUT905.                                                 
       AUTHOR.        RONNA MCDONALD                                            
       DATE-WRITTEN.  JANUARY 14, 2021.                                         
      *****************************************************************         
      *    THIS PROGRAM WAS CLONED AFTER INKUT172 AND THE PURPOSE IS            
      *    TO CREATE MASS ADD/DELETE ADJSTMENTS FOR THE ALASKA                  
      *    STORE THAT WILL BE COUNTING THE FLOOR OVER A FEW DAYS.               
      *****************************************************************         
      *    THIS PROGRAM WILL IDENTIFY ITEMS SOLD AFTER AN ITEM HAS    *         
      *    BEEN INVENTORIED.                                          *         
      *                                                               *         
      *    RETAIL DOES NOT NEED TO BE LOOKED UP.  THE ONLY DATA NEEDED*         
      *    FOR A MASS ADD/DELETE IS SKU/ITEM NUMBER, QTY, AND STORE   *         
      *                                                                         
      *                                                                         
      *    THIS PROGRAM USES DYNAMIC ALLOCATION CALLS FOR THE POS FILE*         
      *    AND TIMESTAMP FILES.                                       *         
      *                                                               *         
      *****************************************************************         
      *****************************************************************         
      * CHANGE HISTORY:                                                         
      *                                                                         
      * 06/01/99 JULIE SEIDLER                                                  
      *    CHANGED PROGRAM TO READ THE DATA WAREHOUSE SALES FILE.               
      *    THIS FILE HAS REMOVED ABORTED AND VOID TRANSACTIONS.  ALSO           
      *    THIS SALES FILE IDENTIFIES WHICH ITEMS ARE SALE OR RETURN            
      *    ITEMS.                                                               
      *                                                                         
      *    MADE ANOTHER CHANGE TO BRING IN ALL RETURNS FOR THE DAY FOR          
      *    SALES REPORTING AND SALE ADJUSTMENTS.                                
      *                                                                         
      * 06/23/99 JULIE SEIDLER                                                  
      *    CORRECTED MISS-SPELLING OF DSN NAME                                  
      *                                                                         
      * 06/23/00 JULIE SEIDLER                                                  
      *    !!!!!!!  MAJOR CHANGES WERE DONE TO THIS PROGRAM TO GET THE          
      *    TOTAL SALES FOR A STORE !!!!!!!!!                                    
      *                                                                         
      *    TO IMPROVE RUN-TIME, TSUMINV DB2 LOGIC WILL BE REPLACED              
      *    BY READING A PLATINUM UNLOAD FILE OF TSUMINV                         
      *                                                                         
      *    ALSO ADDED LOGIC TO READ A NEW STORE'S TOTAL SALES AND THEN          
      *    COMPARE IT WITH THE SALES ADJUSTMENT ABOUT.                          
      *                                                                         
      *    THE STORES THAT ERROR-OUT CANNOT BE INCLUDED IN THE                  
      *    SALES ADJUST UPDATE AND REPORTING PROCESSES. THE STORES              
      *    THAT DO ERROR OUT, MUST BE INCLUDED IN THE ERROR REPORT.             
      *                                                                         
      *    THE INSR027, INSR028, INSR043 SORT CARDS WILL BE CREATED             
      *    IN THIS PROGRAM TO INCLUDE/OMIT THE INVALID STORES.                  
      *                                                                         
      *    IN THE EVENT THAT A STORE'S SALES ADJUSMTMENTS ARE OVER              
      *    THE 'TOLERANCE PERCENT', AN E-MAIL MESSAGE WILL BE WRITTEN           
      *                                                                         
      * 08/01/00 JULIE SEIDLER                                                  
      *    SUPPORT WAS ADDED TO THE THE SALES ADJUSTMENT PROCESSING             
      *    TO 'BACK OUT' AND 'ADD BACK' SALES ADJUSTMENTS FOR A STORE.          
      *    AS PART OF THE 'ADD BACK' PROCESS, THIS PROGRAM NEEDED TO            
      *    BE CHANGED TO CREATE A FASHION SALES ON-HAND ADJUSTMENT FILE.        
      *    THIS FASHION SALES FILE WILL BE DUMMIED OUT DURING NORMAL            
      *    PROCESSING; IT WILL ONLY BE USED AS PART OF THE SPECIAL              
      *    'ADD BACK' PROCESS.                                                  
21015 *                                                                         
  |   * 01/19/2001  MADE BY: ROD JANSSEN         WR/PITS: 21015                 
  |   *    SALES ADJUSTMENT VERBIAGE CHANGE FOR REPORT INKRP169....             
21015 *                                                                         
RB1002* 10/2002     MADE BY: RONNA BUTZ          WR/PITS:                       
RB1002*    USING THE CONDENSEC VERSION OF COSA'S DAILY SALES FILE.              
RB1002*    CHANGES WERE MADE TO THE LAYOUT OF INRD016 AND INRD017 TO            
RB1002*    IDENTIFY A SALES OR RETURN TRANSACTION.                              
RB1002*    ALSO, THE TRANSACTION DATE FORMAT WAS CHANGED FROM YYMMDD            
RB1002*    TO MMDDYY                                                            
RB1002*                                                                         
W21732* 11/15/2002  CHANGED BY SUKUMAR,IGSI    WR# W21732                       
W21732* CHANGED CURRENT DEPT/CLASS/SEQ NUMBER TO NON-INTELLIGENT SKU.           
W21732* AND 4 DIGIT DEPT,CLASS ARE ADDED. IN SORT CARDS,SORT FIELDS             
W21732* ARE CHANGED TO 4 DIGIT DEPT, CLASS AND 8 DIGIT NON-INTELLIGENT          
W21732* SKU INSTEAD OF 3 DIGIT DEPT,2 DIGIT CLASS AND 3 DIGIT SEQ NO            
R21732*                                                                         
R21732* 04/24/2003  CHANGED BY ROD JANSSEN     WR# W21732                       
R21732*    FOR DUMMY SKUS, MOVE ZEROS TO ITEM NUMBER.                           
RMCD01*                                                                         
RMCD01* 06/23/2003  CHANGED BY R. MCDONALD     WR# W24521                       
RMCD01*    COMMENT OUT TEST FILES AND UNCOMMENT PROD FILES                      
RMCD02*                                                                         
RMCD02* 06/23/2003  CHANGED BY R. MCDONALD     WR# W24521                       
RMCD02*    TEMP FIX FOR STORE 542 THAT DOES NOT HAVE SALES ON SUNDAY            
      *****************************************************************         
W26600*                                                                         
W26600* 06/08/2004  CHANGED BY D. THEEL        WR# W26600                       
W26600*  PI STORE EXPANSION PROJECT CHANGES.                                    
W26600*                                                                         
W26600*  PROVIDE HIGH LEVEL QUALIFIER FOR INP02/INP03 WHICH ARE                 
W26600*  DYNAMICALLY ALLOCATED IN THIS PROGRAM.  TO PROVIDE A DIFFERENT         
W26600*  QUALIFIER OTHER THAN PKMO.IN (UP TO 19 CHARACTERS), SEE CONTROL        
W26600*  CARD INPUT FILE (INP05).  TWO FULL DSN (UP TO 32 CHARS) CAN            
W26600*  BE SPECIFIED FOR DSN REPLACEMENT MODE.                                 
W26600*                                                                         
W26600*  CHANGE SORT CONTROL CARD TO BUILD ONLY THE INCLUDE/OMIT                
W26600*  CONDITIONS AND THE SORT CRITERIA WILL BE PROVIDED BY A SEPARATE        
W26600*  CONTROL CARD OUTSIDE THIS PROGRAM.  THIS WILL ELIMINATE ONE            
W26600*  OF THE TWO OMIT DD.                                                    
      *****************************************************************         
W33304* CHANGED 11/04/2008    BY THERESE RAMSEYER WR#  W33304                   
W33304*                       HILO - HOLD INVENTORY LEDGER OPEN                 
W33304*                     --> ADD OUT07 TO HOLD RECS WHERE ITEM               
W33304*                         TIMESTAMP DOES NOT HAVE A MATCH ON              
W33304*                         TINVPAR - THE PROC DOES AN MTCHECK              
W33304*                         AND SENDS AN EMAIL NOTIFICATION                 
W33304*                     --> ADD 7110-CHECK-TINVPAR TO RETRIEVE              
W33304*                         2 NEW FIELDS ON INRD019                         
W33304*                     --> EXPAND INRD019 FROM 90 TO 100 BYTES             
W33304*                         AND ADD IN019-INV-ID AND                        
W33304*                         IN019-FINCL-INV-STAT-CDE                        
W33304*                     --> INCREASE IN-ITEM-REC TO                         
W33304*                         ACCOMMODATE NEW FIELDS                          
W33304*                     --> ADD DCLGENS : TINCNTL & TINVPAR                 
W33304*                     --> ADD 8100-BYPASS-ITM-TIMESTMP-RECS               
W33304*                         AND LOGIC TO BYPASS THE ITM-TIMESTMP REC        
W33304*                         WHEN THERE IS NO CORRESPONDING MATCH            
W33304*                         ON TINVPAR                                      
W33304*                     --> ADD TTL-INV-ID & TTL-FINCL-INV-STAT-CDE         
W33304*                         TO TTL-TIMESTMP-DETAIL IN THE PROGRAM           
W33304*                         IN019-TTL-INV-ID &                              
W33304*                         IN019-TTL-FINCL-INV-STAT-CDE IN THE             
W33304*                         INRD019 COPYBOOK. THESE 'TTL' FIELDS            
W33304*                         ARE USED FOR A SORT DOWNSTREAM TO               
W33304*                         KEEP THE ORDER OF THE 03 LEVEL DETAIL &         
W33304*                         TTL RECORDS THAT ARE OUT01 - THESE NEED         
W33304*                         TO BE KEPT TOGETHER IN PAIRS FOR                
W33304*                         REPORTING PURPOSES.                             
W33304*                                                                         
PE6906*****************************************************************         
PE6906* CHANGED 03/18/2011    BY LALITHA(COGNIZANT) PKE6906                     
PE6906*                       INCLUDED LOGIC TO INCLUDE THOSE                   
PE6906*                       RETURNS WHICH ARE OMITTED IN THE                  
PE6906*                       COUNT ON THE DAY OF THE PHYSICAL INVENTORY        
PE6906*                       OF THE STORE , WHERE THE ITEM BEING               
PE6906*                       RETURNED IS NOT PRESENT IN THE STORE.             
PE6906*                       IN OTHER WORDS, ITEM IS PRESENT IN THE            
PE6906*                       POS FILE AND NOT IN THE TIMESTAMP FILE.           
PE6906* CHANGED 03/22/2011    BY LALITHA(COGNIZANT) INC000001637626             
PE6906*                       CHANGED THE PROCESSING FOR UNCOUNTED              
PE6906*                       RETURNS TO FETCH FOR RET-INV-ID AND               
PE6906*                       RET-FINCL-INV-STAT-CDE                            
      * CHANGED 10/20/2016    COGNIZANT - CHANGES TO INCREASE THE               
      *                       PERCENTAGE FIELD FROM 2 DIGIT TO 3 DIGIT          
      *****************************************************************         
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       SOURCE-COMPUTER. IBM-3090.                                               
       OBJECT-COMPUTER. IBM-3090.                                               
      *                                                                         
      ***************************************************************           
       INPUT-OUTPUT SECTION.                                                    
      ***************************************************************           
      *                                                                         
       FILE-CONTROL.                                                            
                                                                                
           SELECT SALES-ADJ-CAND-STORE-FILE                                     
               ASSIGN TO  INP01.                                                
                                                                                
           SELECT ITEM-TIMESTAMP-FILE                                           
               ASSIGN TO INP02.                                                 
                                                                                
           SELECT POS-FILE                                                      
               ASSIGN TO INP03.                                                 
                                                                                
JS0600     SELECT TSUMINV-PLAT-FILE                                             
               ASSIGN TO INP04.                                                 
                                                                                
W26600     SELECT REQUEST-CNTL-FILE                                             
               ASSIGN TO INP05.                                                 
                                                                                
JS0600     SELECT STR-TTL-SLS-FILE                                              
               ASSIGN TO INP06.                                                 
                                                                                
           SELECT SALES-ADJUST-FILE                                             
               ASSIGN TO OUT01.                                                 
                                                                                
           SELECT TRAN-TIMESTAMP-FILE                                           
               ASSIGN TO OUT02.                                                 
                                                                                
JS0600     SELECT SORT-OMIT-STORE-FILE                                          
               ASSIGN TO OUT03.                                                 
                                                                                
JS0600     SELECT SORT-INCLUDE-STORE-FILE                                       
               ASSIGN TO OUT04.                                                 
                                                                                
JS0600     SELECT EMAIL-MESSAGE                                                 
               ASSIGN TO OUT05.                                                 
                                                                                
JS0800     SELECT FASHION-ADJUSTMENTS                                           
               ASSIGN TO OUT06.                                                 
                                                                                
W33304     SELECT ITEM-TIMESTAMP-ERROR-FILE                                     
W33304         ASSIGN TO OUT07.                                                 
W33304                                                                          
W33304                                                                          
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *                                                                         
       FD  SALES-ADJ-CAND-STORE-FILE                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
       01  SALES-ADJ-CAND-REC              PIC X(80).                           
                                                                                
       FD  ITEM-TIMESTAMP-FILE                                                  
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W21732 01  ITEM-TIMESTAMP-REC              PIC X(100).                          
                                                                                
       FD  POS-FILE                                                             
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W21732 01  POS-REC                         PIC X(50).                           
                                                                                
JS0600 FD  TSUMINV-PLAT-FILE                                                    
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W26600 01  TSUMINV-PLAT-REC                PIC X(32).                           
                                                                                
W26600 FD  REQUEST-CNTL-FILE                                                    
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W26600 01  REQUEST-CNTL-REC                PIC X(80).                           
                                                                                
JS0600 FD  STR-TTL-SLS-FILE                                                     
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
       01  STR-TTL-SLS-REC                 PIC X(30).                           
                                                                                
       FD  SALES-ADJUST-FILE                                                    
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W21732 01  SALES-ADJUST-REC                PIC X(100).                          
                                                                                
       FD  TRAN-TIMESTAMP-FILE                                                  
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W26600 01  TRAN-TIMESTAMP-REC              PIC X(50).                           
                                                                                
JS0600 FD  SORT-OMIT-STORE-FILE                                                 
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W26600 01  SORT-OMIT-STORE-REC             PIC X(80).                           
                                                                                
JS0600 FD  SORT-INCLUDE-STORE-FILE                                              
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
W26600 01  SORT-INCLUDE-STORE-REC          PIC X(80).                           
                                                                                
JS0600 FD  EMAIL-MESSAGE                                                        
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 CHARACTERS                                          
           LABEL RECORDS ARE STANDARD.                                          
       01  EMAIL-MESSAGE-REC               PIC X(80).                           
                                                                                
W33304 FD  ITEM-TIMESTAMP-ERROR-FILE                                            
W33304     RECORDING MODE IS F                                                  
W33304     BLOCK CONTAINS 0 CHARACTERS                                          
W33304     LABEL RECORDS ARE STANDARD.                                          
W33304 01  ITEM-TIMESTAMP-ERROR-REC        PIC X(100).                          
                                                                                
      *                                                                         
JS0800***************************************************************           
      * THIS FS FILE IS NOT USED DURING NORMAL SALES ADJUST PROCESSING.         
      * THIS FILE IS ONLY USED IN THE SPECIAL 'RERUN' PROCESSING OF             
      * A STORE THAT HAS ALREADY COMPLETED ITS UNIT BOOKINGS                    
      ***************************************************************           
                                                                        INKUT115
JS0800 FD  FASHION-ADJUSTMENTS                                          INKUT115
           RECORDING MODE IS F                                          INKUT115
           BLOCK CONTAINS 0 CHARACTERS                                  INKUT115
           LABEL RECORDS ARE STANDARD.                                  INKUT115
W21732 01  FASHION-ADJUSTMENTS-RECORD      PIC X(200).                     CL*12
                                                                        INKUT115
      *                                                                         
      ***************************************************************           
       WORKING-STORAGE SECTION.                                                 
      ***************************************************************           
      *                                                                         
      ** WORKING STORAGE FOR AFTER INVENTORY SALES TIMESTAMP                    
           COPY INRD017.                                                        
                                                                                
      ** WORKING STORAGE ITEM TIMESTAMP/SALES ADJ FILES                         
           COPY INRD019.                                                        
                                                                                
      ** WORKING STORAGE FOR CANDIDATES FOR SALES ADJ. FILE                     
           COPY INRD018.                                                        
                                                                                
      ** WORKING STORAGE FOR POS FILE FOR INVENTORY                             
           COPY INRD016.                                                        
                                                                                
      ** WORKING STORAGE FOR STORE TOTAL SALES FILE                             
           COPY INRD027.                                                        
                                                                                
W26600 01  CC-PROCESS-CONTROL.                                                  
W26600     05  FILLER                      PIC X(08)       VALUE SPACES.        
W26600         88  CC-VALID-CATCHER                        VALUE                
W26600             'PERCENT '.                                                  
           05  CC-PERCENT-LIMIT            PIC 9(03)       VALUE ZEROES.        
W26600     05  FILLER                      PIC X(03)       VALUE SPACES.        
W26600     05  CC-DSN-TYPE-IND             PIC X(01)       VALUE SPACE.         
W26600         88  CC-DSN-BUILD-TYPE                       VALUES ARE           
W26600             'B' SPACE.                                                   
W26600         88  CC-DSN-REPLACE-TYPE                     VALUE 'R'.           
W26600     05  FILLER                      PIC X(01)       VALUE SPACE.         
W26600     05  CC-DSN-OVERRIDE.                                                 
W26600         10  CC-DSN-HIGH-QUALIFIER   PIC X(20)       VALUE SPACES.        
W26600         10  FILLER                  PIC X(12)       VALUE SPACES.        
W26600     05  CC-TIMESTAMP-FILE-NAME REDEFINES CC-DSN-OVERRIDE                 
W26600                                     PIC X(32).                           
W26600     05  CC-POS-FILE-NAME            PIC X(32)       VALUE SPACES.        
                                                                                
      *****************************************************************         
      * TSUMINV INPUT PLATINUM UNLOAD                                 *         
      *****************************************************************         
                                                                                
JS0600 01  WS-TSUMINV.                                                          
           05 WS-SUMINV-KEY.                                                    
W26600*       10 WS-SUMINV-STORE-NBR           PIC   X(3).                      
W26600        10 WS-SUMINV-STORE-NBR           PIC  S9(4) COMP.                 
W21732        10 WS-SUMINV-DEPT-NBR            PIC  S9(4)V COMP-3.              
W21732        10 WS-SUMINV-MAJ-CL-NBR          PIC  S9(4)V COMP-3.              
W21732        10 WS-SUMINV-SUB-CL-NBR          PIC  S9(4)V COMP-3.              
W21732        10 WS-SUMINV-SKU-NBR             PIC  S9(8)V COMP-3.              
           05 WS-SUMINV-AREA-NBR               PIC  S9(9) COMP.                 
           05 WS-SUMINV-INV-UNIT-PR-AMT        PIC  S9(5)V9(2) COMP-3.          
           05 WS-SUMINV-INV-QTY                PIC  S9(9) COMP.                 
           05 WS-SUMINV-DKEY-NBR               PIC  S9(9) COMP.                 
                                                                                
      ***************************************************************           
      **  INPUT/OUPUT - COPY OF INRD019                                         
      ***************************************************************           
       01  IN-ITEM-REC.                                                         
           05  IN-ITEM-REC-KEY.                                                 
W26600*        10  IN-STR-NBR              PIC X(03) VALUE SPACE.               
W26600         10  IN-STR-NBR              PIC S9(4) COMP VALUE +0.             
W21732         10  IN-SKU                  PIC X(08) VALUE SPACE.               
           05  IN-ACTL-INV-DTE             PIC 9(06) VALUE ZERO.                
           05  IN-SCAN-AREA                PIC 9(06) VALUE ZERO.                
           05  IN-SCAN-DTE                 PIC 9(04) COMP-3 VALUE 0.            
           05  IN-SCAN-TIMESTAMP           PIC 9(06) COMP-3 VALUE 0.            
           05  IN-TTL-PHY-COUNT            PIC 9(06) COMP-3 VALUE 0.            
           05  IN-UNIT-PRICE               PIC 9(05)V99                         
                                                     COMP-3 VALUE 0.            
           05  IN-FIRST-SLS-TIMESTAMP      PIC 9(06) COMP-3 VALUE 0.            
           05  IN-UNITS-SLD-AFT-TIMESTAMP  PIC S9(06)                           
                                                     COMP-3 VALUE +0.           
           05  IN-NEG-INV-ADJUST           PIC S9(06)                           
                                                     COMP-3 VALUE +0.           
           05  IN-SALES-ADJ-QTY            PIC S9(06)                           
                                                     COMP-3 VALUE +0.           
           05  IN-SALES-ADJ-EXT-RTL-AMT    PIC S9(09)V99                        
                                                     COMP-3 VALUE +0.           
           05  IN-INVLD-STKRMW             PIC S9(06)                           
                                                     COMP-3 VALUE +0.           
           05  IN-DKEY-NBR                 PIC  S9(9) COMP.                     
W21732     05  IN-DEPT-NBR                 PIC X(04)  VALUE SPACE.              
W21732     05  IN-CL-NBR                   PIC X(04)  VALUE SPACE.              
W33304     05  IN-INV-ID                   PIC S9(9) COMP.                      
W33304     05  IN-FINCL-INV-STAT-CDE       PIC X(02) VALUE SPACE.               
RONNA      05  IN-IN016-TRAN-DTE                 PIC 9(07)                      
RONNA                                            COMP-3 VALUE ZERO.             
RONNA      05  IN-IN016-TRAN-TIMESTAMP           PIC 9(05)                      
RONNA                                            COMP-3 VALUE ZERO.             
           05  FILLER                     PIC X(12)   VALUE SPACE.              
W33042*    05  FILLER                      PIC X(19)  VALUE SPACE.              
W21732*    05  FILLER                      PIC X(14)  VALUE SPACE.              
                                                                                
PE6906***************************************************************           
PE6906**  RETURN RECORD - COPY OF INRD019                                       
PE6906***************************************************************           
PE6906 01  RET-ITEM-REC.                                                        
PE6906     05  RET-ITEM-REC-KEY.                                                
PE6906         10  RET-STR-NBR             PIC S9(4) COMP VALUE +0.             
PE6906         10  RET-SKU                 PIC X(08) VALUE SPACE.               
PE6906     05  RET-ACTL-INV-DTE            PIC 9(06) VALUE ZERO.                
PE6906     05  RET-SCAN-AREA               PIC 9(06) VALUE ZERO.                
PE6906     05  RET-SCAN-DTE                PIC 9(04) COMP-3 VALUE 0.            
PE6906     05  RET-SCAN-TIMESTAMP          PIC 9(06) COMP-3 VALUE 0.            
PE6906     05  RET-TTL-PHY-COUNT           PIC 9(06) COMP-3 VALUE 0.            
PE6906     05  RET-UNIT-PRICE              PIC 9(05)V99                         
PE6906                                               COMP-3 VALUE 0.            
PE6906     05  RET-FIRST-SLS-TIMESTAMP     PIC 9(06) COMP-3 VALUE 0.            
PE6906     05  RET-UNITS-SLD-AFT-TIMESTAMP PIC S9(06)                           
PE6906                                               COMP-3 VALUE +0.           
PE6906     05  RET-NEG-INV-ADJUST          PIC S9(06)                           
PE6906                                               COMP-3 VALUE +0.           
PE6906     05  RET-SALES-ADJ-QTY           PIC S9(06)                           
PE6906                                               COMP-3 VALUE +0.           
PE6906     05  RET-SALES-ADJ-EXT-RTL-AMT   PIC S9(09)V99                        
PE6906                                               COMP-3 VALUE +0.           
PE6906     05  RET-INVLD-STKRMW            PIC S9(06)                           
PE6906                                               COMP-3 VALUE +0.           
PE6906     05  RET-DKEY-NBR                PIC  S9(9) COMP.                     
PE6906     05  RET-DEPT-NBR                PIC X(04)  VALUE SPACE.              
PE6906     05  RET-CL-NBR                  PIC X(04)  VALUE SPACE.              
PE6906     05  RET-INV-ID                  PIC S9(9) COMP  VALUE ZEROES.        
PE6906     05  RET-FINCL-INV-STAT-CDE      PIC X(02) VALUE SPACE.               
           05  RET-IN016-TRAN-DTE                 PIC 9(07)                     
                                                 COMP-3 VALUE ZERO.             
           05  RET-IN016-TRAN-TIMESTAMP           PIC 9(05)                     
                                                 COMP-3 VALUE ZERO.             
           05  FILLER                     PIC X(12)   VALUE SPACE.              
PE6906                                                                          
PE6906***************************************************************           
      **  OUTPUT - COPY OF INRD019                                              
      ***************************************************************           
       01  TTL-TIMESTMP-DETAIL.                                                 
W26600*    05  TTL-STR-NBR                 PIC X(3).                            
W26600     05  TTL-STR-NBR                 PIC S9(4)       VALUE ZEROES         
                               COMP.                                            
           05  FILLER                      PIC X(08)      VALUE ALL '9'.        
           05  TTL-ACTL-INV-DTE            PIC 9(06)       VALUE ZEROES.        
           05  FILLER                      PIC X(06)      VALUE ALL '9'.        
W26600     05  TTL-SALES-ADJ-QTY           PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  TTL-SALES-ADJ-EXT-RTL-AMT   PIC S9(09)V99   VALUE ZEROES         
                               COMP-3.                                          
W26600     05  TTL-TRAN-QTY                PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  TTL-RTL-AMT                 PIC S9(09)V99   VALUE ZEROES         
                               COMP-3.                                          
           05  TTL-SALES-ADJ-PCT           PIC S9(03)V99   VALUE ZEROES         
                               COMP-3.                                          
W26600     05  TTL-RETURN-QTY              PIC S9(07)      VALUE ZEROES         
                               COMP-3.                                          
           05  TTL-RETURN-RTL-AMT          PIC S9(09)V99   VALUE ZEROES         
                               COMP-3.                                          
W33304     05  FILLER                      PIC X(20)       VALUE SPACES.        
W33304     05  TTL-INV-ID                  PIC S9(9) COMP  VALUE ZEROES.        
W33304     05  TTL-FINCL-INV-STAT-CDE      PIC X(02) VALUE SPACE.               
W33304     05  TTL-FILLER1                 PIC X(19) VALUE SPACE.               
                                                                                
                                                                                
W26600 01  SC-SORT-CONTROL-CARD.                                                
W26600     05  SC-INCLUDE-OMIT-CARD.                                            
W26600         10  FILLER                  PIC X(17)       VALUE SPACES.        
W26600             88  SC-INCLUDE-COND                     VALUE                
W26600                 '   INCLUDE COND=('.                                     
W26600             88  SC-OMIT-COND                        VALUE                
W26600                 '      OMIT COND=('.                                     
W26600             88  SC-NO-COND                          VALUE SPACES.        
W26600         10  FILLER                  PIC X(10)       VALUE                
W26600             '1,2,BI,EQ,'.                                                
W26600         10  SC-STORE-NBR            PIC 9(05)       VALUE ZEROES.        
W26600         10  FILLER                  PIC X(48)       VALUE SPACES.        
W26600             88  SC-MORE-STORE                       VALUE                
W26600                 ',OR,           * STORE'.                                
W26600             88  SC-NO-MORE-STORE                    VALUE                
W26600                 ')'.                                                     
W26600     05  SC-END-CARD.                                                     
W26600         10  FILLER                  PIC X(80)       VALUE                
W26600             '   END'.                                                    
                                                                                
      ***************************************************************           
      **  OUTPUT - EMAIL MESSAGE                                                
      ***************************************************************           
       01  EM-MESSAGE-TEXT1.                                                    
           05  FILLER                  PIC X(44)  VALUE                         
               '  THE FOLLOWING STORES HAD SALES ADJUSTMENTS'.                  
           05  FILLER                  PIC X(14)  VALUE                         
               ' OF MORE THAN '.                                                
           05  EM-PERCENT              PIC ZZ9.99 VALUE ZERO.                   
W26600     05  FILLER                  PIC X(16)  VALUE                         
W26600         '% OR EQUAL TO 0%'.                                              
                                                                                
       01  EM-MESSAGE-TEXT2.                                                    
W26600     05  FILLER                  PIC X(60)  VALUE                         
W26600         '      OF THEIR TOTAL RETAIL SALES. '.                           
           05  FILLER                  PIC X(20)  VALUE SPACES.                 
                                                                                
       01  EM-MESSAGE-TEXT3.                                                    
           05  EM-DATASET-HEADER3      PIC X(60)  VALUE                         
21015         '   PLEASE REVIEW RDS RPTS, INK097 - INKRP169-3 & -4'.            
21015 ******* '   PLEASE REVIEW RDS REPORT - INK087?? - INKRP169-6'.            
                                                                                
       01  EM-MESSAGE-BLANK-LINE       PIC X(80)  VALUE SPACES.                 
                                                                                
       01  EM-MESSAGE-DETAIL.                                                   
           05  EM-MESSAGE-STORES.                                               
               10  FILLER              PIC X(02)  VALUE SPACES.                 
               10  FILLER              PIC X(04)  VALUE 'STR '.                 
W26600*        10  EM-MESSAGE-STR      PIC X(03)  VALUE SPACES.                 
W26600         10  EM-MESSAGE-STR      PIC 9(04)  VALUE ZEROES.                 
               10  FILLER              PIC X(26)  VALUE                         
                   ' - SALES ADJUSTMENTS WERE '.                                
               10  EM-STR-PCT          PIC ZZ9.99 VALUE ZEROES.                 
               10  FILLER              PIC X(23)  VALUE                         
                  '% OF TOTAL RETAIL SALES'.                                    
W26600*        10  FILLER              PIC X(49)  VALUE SPACES.                 
W26600         10  FILLER              PIC X(48)  VALUE SPACES.                 
                                                                                
      *                                                                         
00087 ***************************************************************** INKUT115
00088 *    OUTPUT -- FASHION SALES ADJUSTMENT DATA STRUCTURE            INKUT115
00088 *              FILE IS CREATED TO BACKOUT SALES ADJUSTMENTS       INKUT115
      *****************************************************************         
00089 *                                                                 INKUT115
W21732     COPY FSRD035.                                                   CL*12
      *                                                                         
PE6906******************************************************************        
PE6906* COPYBOOK - PRICING MODULE                                               
PE6906******************************************************************        
PE6906     COPY INWS400.                                                        
      *                                                                         
      ***************************************************************           
      **  TEMP INPUT AREA FOR IN018 COPYBOOK                                    
      ***************************************************************           
      *****************************************************************         
      *    INRD018 - CANDIDATES FOR SALE ADJUSTMENT CALC PROCESSING   *         
      *****************************************************************         
      *                                                                         
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-PARAGRAPH-NAME         PIC X(30)  VALUE SPACE.                
           05  PV-DB2-OPER-ATTEMPTED     PIC X(30)  VALUE SPACE.                
           05  PV-DISPLAY-ERROR          PIC X(45)  VALUE SPACE.                
           05  PV-SQL-SUB                PIC S9(4)  VALUE ZERO                  
                                                    COMP.                       
W33304     05  PV-HOLD-IN019-STORE-NBR   PIC S9(4) COMP VALUE +0.               
W33304     05  PV-HOLD-INV-ID            PIC S9(09) COMP VALUE +0.              
W33304     05  PV-HOLD-FINCL-INV-STAT-CDE PIC X(02) VALUE SPACE.                
031900     05  PV-RETRY-COUNTER           PIC S9(04) VALUE +0 COMP SYNC.        
           05  PV-HOLD-FIRST-TIME.                                              
               10  PV-HOUR-MIN           PIC 9(04) VALUE ZERO.                  
               10  FILLER                PIC 9(02) VALUE ZERO.                  
           05  PV-HOLD-TIME-POS          PIC 9(06) VALUE ZERO.                  
           05  PV-TIME-ITEM.                                                    
W21732         07  PV-TIME-DEPT          PIC 9(04)  VALUE ZEROES.               
W21732         07  PV-TIME-CLS           PIC 9(04)  VALUE ZEROES.               
W21732         07  PV-TIME-SKU           PIC 9(08)  VALUE ZEROES.               
           05  PV-POS-ITEM.                                                     
W21732         07  PV-POS-DEPT           PIC 9(04)  VALUE ZEROES.               
W21732         07  PV-POS-CLS            PIC 9(04)  VALUE ZEROES.               
W21732         07  PV-POS-SKU            PIC 9(08)  VALUE ZEROES.               
W26600*    05  PV-STORE-NUMBER           PIC X(03)  VALUE SPACES.               
W26600     05  PV-STORE-NUMBER           PIC 9(04)  VALUE ZEROES.               
W26600*    05  PV-PREV-POS-STR           PIC X(03)  VALUE SPACES.               
W26600     05  PV-PREV-POS-STR           PIC S9(4)  COMP VALUE +0.              
JS0600*    05  PV-PREV-CALC-STORE        PIC X(03)  VALUE SPACES.               
JS0600*    05  PV-IN018-PREV-CAND-STORE  PIC X(03)  VALUE SPACES.               
W26600     05  PV-IN018-PREV-CAND-STORE  PIC S9(4)  COMP VALUE +0.              
W21732     05  PV-HOLD-DEPT              PIC X(04)  VALUE SPACES.               
W21732     05  PV-HOLD-CLASS             PIC X(04)  VALUE SPACES.               
W21732     05  PV-HOLD-SKU               PIC X(08)  VALUE SPACES.               
           05  PV-TRAN-QTY               PIC S9(06) VALUE ZEROES.               
PE6906     05  PV-TRAN-QTY-RET           PIC S9(06) VALUE ZEROES.               
                                                                                
W26600     05  PV-STR-SLS-ADJ-TRAN-QTY     PIC S9(07)      VALUE ZEROES.        
W26600     05  PV-STR-SLS-ADJ-RTL-AMT      PIC S9(09)V99   VALUE ZEROES.        
JS0600     05  PV-STR-SLS-ADJ-PCT          PIC 999V999     VALUE ZEROES.        
                                                                                
W26600     05  PV-STR-TRAN-QTY-P           PIC Z,ZZZ,ZZ9-  VALUE ZEROES.        
W26600     05  PV-STR-RTL-SLS-P            PIC ZZZ,ZZZ,ZZ9.99-                  
W26600                                                     VALUE ZEROES.        
W26600     05  PV-STR-RETURN-QTY-P         PIC Z,ZZZ,ZZ9-  VALUE ZEROES.        
W26600     05  PV-STR-RETURN-RTL-AMT-P     PIC ZZZ,ZZZ,ZZ9.99-                  
W26600                                                     VALUE ZEROES.        
W26600     05  PV-STR-SLS-ADJ-TRAN-QTY-P   PIC Z,ZZZ,ZZ9-  VALUE ZEROES.        
W26600     05  PV-STR-SLS-ADJ-RTL-AMT-P    PIC ZZZ,ZZZ,ZZ9.99-                  
W26600                                                     VALUE ZEROES.        
JS0600     05  PV-STR-SLS-ADJ-PCT-P        PIC ZZ9.9       VALUE ZEROES.        
                                                                                
           05  PV-SUMINV-INV-QTY         PIC S9(06) VALUE ZEROES.               
           05  PV-ADJDTL-ADJ-QTY         PIC S9(06) VALUE ZEROES.               
           05  PV-STKRMW-INV-QTY         PIC S9(06) VALUE ZEROES.               
           05  PV-SALES-ADJ-QTY          PIC S9(06) VALUE ZEROES.               
           05  PV-POS-TIME               PIC 9(04)  VALUE ZEROES.               
           05  PV-ITEM-TIME              PIC 9(06)  VALUE ZEROES.               
           05  PV-HOLD-TIME.                                                    
               10  PV-STAMP-TIME         PIC 9(04)  VALUE ZEROES.               
               10  PV-STAMP-SEC          PIC 9(02)  VALUE ZEROES.               
           05  PV-STAMP-DATE             PIC 9(04)  VALUE ZEROES.               
           05  PV-HOLD-DATE.                                                    
RB1002*        10  PV-POS-YY             PIC 9(02)  VALUE ZEROES.               
RB1002*        10  PV-POS-DATE           PIC 9(04)  VALUE ZEROES.               
RB1002         10  PV-POS-DATE           PIC 9(04)  VALUE ZEROES.               
RB1002         10  PV-POS-YY             PIC 9(02)  VALUE ZEROES.               
           05  PV-HOLD-DATE-NUM REDEFINES PV-HOLD-DATE                          
                                         PIC 9(6).                              
           05  PV-HOLD-DATE2.                                                   
               10  PV-HOLD-YY2           PIC 9(02)  VALUE ZEROES.               
               10  PV-HOLD-MMDD2         PIC 9(04)  VALUE ZEROES.               
           05  PV-HOLD-DATE3.                                                   
RB1002*        10  PV-HOLD-YY3           PIC 9(02)  VALUE ZEROES.               
RB1002*        10  PV-HOLD-MMDD3         PIC 9(04)  VALUE ZEROES.               
RB1102         10  PV-HOLD-MMDD3         PIC 9(04)  VALUE ZEROES.               
RB1102         10  PV-HOLD-YY3           PIC 9(02)  VALUE ZEROES.               
           05  PV-HOLD-DATE3-NUM REDEFINES PV-HOLD-DATE3                        
                                         PIC 9(6).                              
           05  PV-TEMP-DATE.                                                    
               10  PV-TEMP-DATE-CC       PIC  X(02) VALUE SPACES.               
               10  PV-TEMP-DATE-YY       PIC  X(02) VALUE SPACES.               
               10  FILLER                PIC  X(01) VALUE SPACE.                
               10  PV-TEMP-DATE-MM       PIC  X(02) VALUE SPACES.               
               10  FILLER                PIC  X(01) VALUE SPACE.                
               10  PV-TEMP-DATE-DD       PIC  X(02) VALUE SPACES.               
                                                                                
W26600     05  PV-DISPLAY-LOC            PIC 9(4)   VALUE ZERO.                 
                                                                                
W26600*    05  PV-STORE-NUMBER-FS.                                         CL*12
W26600*        10  FILLER                PIC X(1)   VALUE '0'.             CL*12
W26600*        10  PV-STORE-NUMBER-3     PIC X(3).                         CL*12
JS0800     05  PV-WORK-QTY               PIC 9(7).                         CL*17
W21732     05  PV-SUMINV-KEY.                                                   
W21732*        10 PV-SUMINV-STORE-NBR    PIC X(3)   VALUE SPACES.               
W26600         10 PV-SUMINV-STORE-NBR    PIC S9(4)  COMP VALUE +0.              
W21732         10 PV-SUMINV-DEPT-NBR     PIC 9(4)   VALUE ZEROES.               
W21732         10 PV-SUMINV-CL-NBR       PIC 9(4)   VALUE ZEROES.               
W21732         10 PV-SUMINV-SKU-NBR      PIC 9(8)   VALUE ZEROES.               
                                                                                
W21732     05  PV-IN019-KEY.                                                    
W21732*        10 PV-IN019-STORE-NBR     PIC X(3)   VALUE SPACES.               
W26600         10 PV-IN019-STORE-NBR     PIC S9(4)  COMP VALUE +0.              
W21732         10 PV-IN019-DEPT-NBR      PIC 9(4)   VALUE ZEROES.               
W21732         10 PV-IN019-CL-NBR        PIC 9(4)   VALUE ZEROES.               
W21732         10 PV-IN019-SKU-NBR       PIC 9(8)   VALUE ZEROES.               
W21732                                                                          
W21732     05  PV-UPC-LOW.                                                      
W21732         10  FILLER                PIC S9(04) VALUE 0400.                 
W21732         10  PV-UPC-SKU-MIN        PIC  9(08) VALUE ZEROES.               
W21732         10  FILLER                PIC  9     VALUE 0.                    
W21732     05  PV-SIGN-UPC-MIN REDEFINES PV-UPC-LOW                             
W21732                                   PIC S9(13).                            
W21732                                                                          
W21732     05  PV-UPC-HIGH.                                                     
W21732         10  FILLER                PIC S9(04) VALUE 0400.                 
W21732         10  PV-UPC-SKU-MAX        PIC  9(08) VALUE ZEROES.               
W21732         10  FILLER                PIC  9     VALUE 9.                    
W21732     05  PV-SIGN-UPC-MAX REDEFINES PV-UPC-HIGH                            
W21732                                   PIC S9(13).                            
W21732                                                                          
W21732     05  PV-UPCSKU-UPC-MIN         PIC S9(13)V COMP-3.                    
W21732     05  PV-UPCSKU-UPC-MAX         PIC S9(13)V COMP-3.                    
W21732                                                                          
W21732     05  PV-ITEM-NBR               PIC  9(15) VALUE ZEROES.               
                                                                                
W26600 01  PT-PROGRAM-TABLE-AREA.                                               
W26600     05  PT-STR-ERR-INDEX            PIC 9(05)       VALUE ZEROES.        
W26600     05  PT-STR-ERR-COUNT            PIC 9(05)       VALUE ZEROES.        
W26600     05  PT-STR-ERR-TBL OCCURS 99999 TIMES.                               
W26600         10  PT-ERR-STORE-NBR        PIC S9(4)       VALUE ZEROES         
W26600                         COMP.                                            
W26600         10  PT-ERR-SLS-ADJ-PCT      PIC 999V99      VALUE ZEROES.        
W26600                                                                          
W26600     05  PT-TTL-SLS-INDEX            PIC 9(05)       VALUE ZEROES.        
W26600     05  PT-TTL-SLS-TBL OCCURS 99999 TIMES.                               
W26600*        10  PT-TTL-STR-NBR          PIC X(03)     VALUE SPACES.          
W26600         10  PT-TTL-STR-NBR          PIC S9(4)       VALUE ZEROES         
W26600                         COMP.                                            
W26600         10  PT-TTL-TRAN-QTY         PIC S9(07)      VALUE ZEROES         
W26600                         COMP-3.                                          
W26600         10  PT-TTL-RTL-AMT          PIC S9(09)V99   VALUE ZEROES         
W26600                         COMP-3.                                          
W26600         10  PT-TTL-POS-DATE         PIC S9(07)      VALUE ZEROES         
W26600                         COMP-3.                                          
W26600         10  PT-TTL-RETURN-QTY       PIC S9(07)      VALUE ZEROES         
W26600                         COMP-3.                                          
W26600         10  PT-TTL-RETURN-RTL-AMT   PIC S9(09)V99   VALUE ZEROES         
W26600                         COMP-3.                                          
                                                                                
       01  PA-PROGRAM-ACCUMULATORS.                                             
           05  PA-INNOV-RECORDS-IN       PIC S9(9)  VALUE ZEROS                 
                                                    COMP-3.                     
           05  PA-RECS-NOT-FOUND         PIC S9(9)  VALUE ZEROS                 
                                                    COMP-3.                     
           05  PA-PMU-RECORD-WRITTEN     PIC S9(9)  VALUE ZEROS                 
                                                    COMP-3.                     
           05  PA-DUMMY-PRICE-WRITTEN    PIC S9(9)  VALUE ZEROS                 
                                                    COMP-3.                     
W33304     05  PA-TOT-ITM-RECS-BYP       PIC S9(9)  VALUE ZEROS                 
W33304                                              COMP-3.                     
W33304     05  PA-TOT-ITM-RECS-WRIT      PIC S9(9)  VALUE ZEROS                 
W33304                                              COMP-3.                     
W33304     05  PA-TOT-ITM-RECS-READ      PIC S9(9)  VALUE ZEROS                 
W33304                                              COMP-3.                     
       01  PS-PROGRAM-SWITCHES.                                                 
W33304     05  PS-ITEM-TIMESTAMP-REC-SW  PIC X(01)  VALUE 'Y'.                  
W33304         88  PS-BAD-ITEM-TIMESTAMP-REC        VALUE 'N'.                  
W33304         88  PS-GOOD-ITEM-TIMESTAMP-REC       VALUE 'Y'.                  
           05  PS-FIRST-SALE-SW          PIC X(01)  VALUE 'Y'.                  
               88  PS-NOT-FIRST-SALE                VALUE 'N'.                  
               88  PS-FIRST-SALE                    VALUE 'Y'.                  
           05  PS-FIRST-TIME-SW          PIC X(01)  VALUE 'Y'.                  
               88  PS-NOT-FIRST-TIME                VALUE 'N'.                  
               88  PS-FIRST-TIME                    VALUE 'Y'.                  
PE6906     05  PS-INCLUDE-RETURN-SW              PIC X(01)  VALUE 'Y'.          
PE6906         88  PS-INCLUDE-RETURN                VALUE 'N'.                  
PE6906         88  PS-NOT-INCLUDE-RETURN            VALUE 'Y'.                  
           05  PS-ALLOCATE-SW            PIC X(01)  VALUE 'N'.                  
               88  PS-FILE-EXISTS                   VALUE 'Y'.                  
               88  PS-FILE-DOESNT-EXIST             VALUE 'N'.                  
           05  PS-SALES-ADJ-CAND-SW      PIC X(01)  VALUE 'N'.                  
               88  PS-END-OF-SALES-ADJ-CAND         VALUE 'Y'.                  
JS0600         88  PS-NOT-END-OF-SALES-ADJ-CAND     VALUE 'N'.                  
JS0600     05  PS-END-OF-TSUMINV-SW      PIC X      VALUE 'N'.                  
JS0600         88  PS-END-OF-TSUMINV                VALUE 'Y'.                  
JS0600         88  PS-NOT-END-OF-TSUMINV            VALUE 'N'.                  
           05  PS-MORE-TADJDTL-ROWS-SW   PIC X      VALUE 'Y'.                  
               88  PS-MORE-TADJDTL-ROWS             VALUE 'Y'.                  
               88  PS-NO-MORE-TADJDTL-ROWS          VALUE 'N'.                  
           05  PS-MORE-TSTKRMW-ROWS-SW   PIC X      VALUE 'Y'.                  
               88  PS-MORE-TSTKRMW-ROWS             VALUE 'Y'.                  
               88  PS-NO-MORE-TSTKRMW-ROWS          VALUE 'N'.                  
           05  PS-END-OF-POS-SW          PIC X      VALUE 'N'.                  
               88  PS-END-POS-FILE                  VALUE 'Y'.                  
JS0600     05  PS-END-OF-STR-TTL-SLS-SW  PIC X      VALUE 'N'.                  
JS0600         88  PS-END-OF-STR-TTL-SLS-FILE       VALUE 'Y'.                  
           05  PS-END-OF-ITEM-TIMESTAMP-SW PIC X    VALUE 'N'.                  
               88  PS-END-ITEM-TIMESTAMP            VALUE 'Y'.                  
W26600         88  PS-NOT-END-ITEM-TIMESTAMP        VALUE 'N'.                  
JS0600     05  PS-NEXT-ITEM-FOUND-SW       PIC X    VALUE 'N'.                  
JS0600         88  PS-NEXT-ITEM-FOUND               VALUE 'Y'.                  
JS0600         88  PS-NEXT-ITEM-NOT-FOUND           VALUE 'N'.                  
JS0600     05  PS-CUR-ITEM-FOUND-SW        PIC X    VALUE 'N'.                  
JS0600         88  PS-CUR-ITEM-FOUND                VALUE 'Y'.                  
JS0600         88  PS-CUR-ITEM-NOT-FOUND            VALUE 'N'.                  
JS0600     05  PS-STORE-TOLERANCE-ERROR-SW PIC X    VALUE 'N'.                  
JS0600         88  PS-STORE-TOLERANCE-ERROR         VALUE 'Y'.                  
JS0600     05  PS-FIRST-STR-ON-POS-FILE-SW PIC X    VALUE 'Y'.                  
JS0600         88  PS-FIRST-STR-ON-POS-FILE         VALUE 'Y'.                  
JS0600         88  PS-NOT-FIRST-STR-ON-POS-FILE     VALUE 'N'.                  
JS0600     05  PS-FIRST-STR-ON-CAND-FILE-SW PIC X   VALUE 'Y'.                  
JS0600         88  PS-FIRST-STR-ON-CAND-FILE        VALUE 'Y'.                  
JS0600         88  PS-NOT-FIRST-STR-ON-CAND-FILE    VALUE 'N'.                  
JS0600     05  PS-STORE-TTL-REC-WRITTEN-SW  PIC X   VALUE 'N'.                  
               88  PS-STORE-TTL-REC-WRITTEN         VALUE 'Y'.                  
               88  PS-STORE-TTL-REC-NOT-WRITTEN     VALUE 'N'.                  
           05  PS-DONE-WITH-POS-STORE-SW    PIC X   VALUE 'N'.                  
               88  PS-DONE-WITH-POS-STORE           VALUE 'Y'.                  
               88  PS-NOT-DONE-WITH-POS-STORE       VALUE 'N'.                  
           05  PS-UPD-PREV-CAND-STR-LATER-SW PIC X   VALUE 'N'.                 
               88  PS-UPD-PREV-CAND-STR-LATER        VALUE 'Y'.                 
               88  PS-UPD-PREV-CAND-STR-UPD          VALUE 'N'.                 
      *                                                                         
       01  PC-PROGRAM-CONSTANTS-AREA.                                           
           05  PC-MAX-RETRIES            PIC S9(1)  VALUE +3                    
                                                    COMP-3.                     
           05  PC-GWP-PRICE              PIC SV99    VALUE +.03.                
           05  PC-ITEM-TIMESTAMP-DDNAME  PIC X(8)   VALUE 'INP02'.              
           05  PC-POS-DDNAME             PIC X(8)   VALUE 'INP03'.              
W33304     05  PC-DEFAULT-NINES          PIC X(10)  VALUE '9999-09-09'.         
W33304     05  PC-ACTIVE                 PIC X(1)   VALUE 'Y'.                  
W33304     05  PC-INITIAL-STATUS         PIC X(2)   VALUE 'IN'.                 
W33304     05  PC-WILL-BOOK              PIC X(2)   VALUE 'BK'.                 
W33304     05  PC-BOOK-DELAYED           PIC X(2)   VALUE 'BD'.                 
PE6906     05  PC-DEFAULT-SEVENS         PIC S9(9)  VALUE 777777.               
                                                                                
      *                                                                         
      *  PARAMETER LIST FOR THE DYNAMIC ALLOCATION ROUTINE                      
      *                                                                         
           COPY DPWS023.                                                        
                                                                                
      *                                                                         
      * ALLOCATED FILE NAME                                                     
      *                                                                         
                                                                                
W26600 01  FN-FILE-NAMES.                                                       
W26600     05  FN-DS-FILE-NAME             PIC X(44)       VALUE SPACES.        
W26600     05  FN-HIGH-LVL-QUALIFIER       PIC X(20)       VALUE                
W26600         'PKMO.IN'.                                                       
W26600     05  FN-TIMESTMP-QUALIFIER       PIC X(20)       VALUE                
W26600         'ITEM.TIMESTMP.DT'.                                              
W26600     05  FN-POS-QUALIFIER            PIC X(20)       VALUE                
W26600         'POS.SALES.DT'.                                                  
                                                                                
           05  FN-FILE-DATE.                                                    
W26600         10  FN-FILE-DATE-YY         PIC X(02)       VALUE SPACES.        
W26600         10  FN-FILE-DATE-MM         PIC X(02)       VALUE SPACES.        
W26600         10  FN-FILE-DATE-DD         PIC X(02)       VALUE SPACES.        
                                                                                
       01  ABEND-CODE                    PIC S9(4)  VALUE ZERO                  
                                                    COMP.                       
           88  ABEND-4001                           VALUE 4001.                 
           88  ABEND-4002                           VALUE 4002.                 
           88  ABEND-4003                           VALUE 4003.                 
           88  ABEND-4004                           VALUE 4004.                 
           88  ABEND-4005                           VALUE 4005.                 
           88  ABEND-4006                           VALUE 4006.                 
           88  ABEND-4007                           VALUE 4007.                 
           88  ABEND-4008                           VALUE 4008.                 
           88  ABEND-4013                           VALUE 4013.                 
           88  ABEND-4019                           VALUE 4019.                 
      *                                                                         
      *                                                                         
      *****************************************************************         
      * TADJDTL DCLGEN                                                *         
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
              INCLUDE TADJDTL                                                   
           END-EXEC.                                                            
                                                                                
      *****************************************************************         
      * TSTKRMW DCLGEN                                                *         
      *****************************************************************         
                                                                                
           EXEC SQL                                                             
              INCLUDE TSTKRMW                                                   
           END-EXEC.                                                            
                                                                                
PE6906*****************************************************************         
PE6906*COMMENTED THE DECLARATION FOR TUPCSKU AND TSKXREF AS THEY ARE            
PE6906*DECLARED IN INPD400 MODULE CODED AS PART OF PBI3966 CHANGES              
W21732*****************************************************************         
W21732* TSKXREF DCLGEN                                                *         
W21732*****************************************************************         
W21732*                                                                         
W21732*    EXEC SQL                                                             
W21732*       INCLUDE TSKXREF                                                   
W21732*    END-EXEC.                                                            
W21732*                                                                         
W21732*****************************************************************         
W21732* TUPCSKU DCLGEN                                                *         
W21732*****************************************************************         
W21732*                                                                         
W21732*    EXEC SQL                                                             
W21732*       INCLUDE TUPCSKU                                                   
W21732*    END-EXEC.                                                            
W21732*                                                                         
W33304*****************************************************************         
W33304* TINCNTL DCLGEN                                                          
W33304*****************************************************************         
W33304     EXEC SQL                                                             
W33304        INCLUDE TINCNTL                                                   
W33304     END-EXEC.                                                            
W33304                                                                          
W33304*****************************************************************         
W33304* TINVPAR DCLGEN                                                          
W33304*****************************************************************         
W33304     EXEC SQL                                                             
W33304        INCLUDE TINVPAR                                                   
W33304     END-EXEC.                                                            
W33304                                                                          
W33304*****************************************************************         
      *    SQL COMMUNICATIONS AREA DCLGEN                             *         
      *****************************************************************         
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
                                                                                
           COPY SQLCA2.                                                         
                                                                                
      *****************************************************************         
      *    ERROR MESSAGE AREA FOR DB2                                 *         
      *****************************************************************         
           COPY DPWS004.                                                        
      *                                                                         
                                                                                
                                                                                
      ******************************************************************01500000
      * DB2 CURSOR.                                                             
      *****************************************************************         
           EXEC SQL                                                             
              DECLARE TADJDTL_CURSOR CURSOR FOR                                 
                SELECT A.ADJ_QTY                                                
                FROM TADJDTL A                                                  
W26600          WHERE (A.LOC_NBR   = :ADJDTL-LOC-NBR) AND                       
W21732                (A.SKU_NBR   = :ADJDTL-SKU-NBR) AND                       
W21732                (A.ADJ_TYPE_CDE  = :ADJDTL-ADJ-TYPE-CDE)                  
           END-EXEC.                                                            
      *                                                                         
      *****************************************************************         
      * DB2 CURSOR.                                                             
      *****************************************************************         
           EXEC SQL                                                             
              DECLARE TSTKRMW_CURSOR CURSOR FOR                                 
                SELECT A.INV_QTY                                                
                FROM TSTKRMW A                                                  
W21732*         WHERE (A.STORE_NBR = :STKRMW-STORE-NBR) AND                     
W26600          WHERE (A.LOC_NBR   = :STKRMW-LOC-NBR) AND                       
W21732                (A.SKU_NBR   = :STKRMW-SKU-NBR)                           
           END-EXEC.                                                            
                                                                                
      ***************************************************************           
       PROCEDURE DIVISION.                                                      
      ***************************************************************           
      *                                                                         
           PERFORM A100-MAINLINE.                                               
           GOBACK.                                                              
      *                                                                         
      ***************************************************************           
       A100-MAINLINE.                                                           
      ***************************************************************           
      *                                                                         
           PERFORM 1000-OPEN-FILES.                                             
           DISPLAY '**---------------------------------------------**'          
W26600     PERFORM 1100-READ-REQUEST-CNTL-FILE.                                 
                                                                                
W26600     PERFORM 7000-PROCESS-SALES-ADJ-CAND.                                 
           IF PS-END-OF-SALES-ADJ-CAND                                          
               DISPLAY '*************************************'                  
               DISPLAY '*************************************'                  
               DISPLAY '* CANDIDATE FILE IS EMPTY.  NO SALE *'                  
               DISPLAY '* ADJUSTMENTS WILL BE CREATED       *'                  
               DISPLAY '*************************************'                  
               DISPLAY '*************************************'                  
           ELSE                                                                 
W26600         PERFORM 1250-READ-STR-TTL-SLS-FILE                               
W26600*        IF IN018-STR-NBR = 542 AND                                       
RMCD02*           PS-END-OF-STR-TTL-SLS-FILE                                    
RMCD02*            DISPLAY '** STR-TTL-SLS-FILE IS EMPTY      '                 
RMCD02*            DISPLAY '** STORE NUMBER IS 542            '                 
RMCD02*            DISPLAY '** STORE IS CLOSED ON SUNDAYS     '                 
RMCD02*            DISPLAY ' A100-MAINLINE'                                     
RMCD02*        ELSE                                                             
21015 *        IF PS-END-OF-STR-TTL-SLS-FILE                                    
21015 *            DISPLAY '** ABEND - PROGRAM INKUT905 **'                     
21015 *            DISPLAY '** STR-TTL-SLS-FILE IS EMPTY      '                 
21015 *            DISPLAY '** STR-TTL-SLS-FILE IS EMPTY      '                 
21015 *            DISPLAY '** STR-TTL-SLS-FILE IS EMPTY      '                 
21015 *            DISPLAY ' A100-MAINLINE'                                     
21015 *            MOVE +4001 TO ABEND-CODE                                     
W26600*            PERFORM 9900-ABEND                                           
21015 *        END-IF                                                           
               DISPLAY ' '                                                      
W26600         PERFORM 1200-LOAD-STR-TTL-SLS                                    
21015              UNTIL PS-END-OF-STR-TTL-SLS-FILE                             
21015                                                                           
               PERFORM 3000-INITIALIZE                                          
               PERFORM 4000-PROCESS-FILES                                       
                   UNTIL PS-END-ITEM-TIMESTAMP                                  
                      OR PS-END-POS-FILE                                        
                      OR PS-END-OF-SALES-ADJ-CAND                               
                                                                                
W26600         MOVE PV-IN018-PREV-CAND-STORE TO PV-DISPLAY-LOC                  
               DISPLAY '   ===> EOJ ROUTINE   --- '                             
W26600*             ' PREV CAND STR: ' PV-IN018-PREV-CAND-STORE                 
W26600              ' PREV CAND STR: ' PV-DISPLAY-LOC                           
                      ' PS-FIRST-TIME-SW: ' PS-FIRST-TIME-SW                    
W26600         PERFORM 4500-PROCESS-PHYSICAL                                    
W26600         PERFORM 4600-CREATE-SALES-ADJ-TOTAL                              
                                                                                
               IF PS-NOT-END-OF-SALES-ADJ-CAND                                  
      *          ** VERIFY THE LAST STORE ON THE CANDIDATE CONTROL              
      *          ** HAS BEEN PROCESSED                                          
W26600             PERFORM 7050-READ-SALES-ADJ-CAND                             
                   IF PS-NOT-END-OF-SALES-ADJ-CAND                              
                       AND PS-NOT-END-ITEM-TIMESTAMP                            
                       DISPLAY '** POTENTIAL ISSUE WITH CONTROL CARD'           
W26600*          *** CREATE TOTAL RECORDS FOR REMAINING CANDIDATES              
W26600                 PERFORM                                                  
W26600                     UNTIL PS-END-OF-SALES-ADJ-CAND                       
W26600                     MOVE IN018-STR-NBR                                   
W26600                         TO PV-IN018-PREV-CAND-STORE                      
W26600                     PERFORM 4600-CREATE-SALES-ADJ-TOTAL                  
W26600                     PERFORM 7050-READ-SALES-ADJ-CAND                     
W26600                 END-PERFORM                                              
      *                DISPLAY                                                  
      *                  '** ABEND - PROGRAM INKUT905             **'           
W26600*                MOVE IN018-STR-NBR         TO PV-DISPLAY-LOC             
      *                DISPLAY                                                  
      *                  '** PROBLEM PROCESSING CONTROL CARD STORE: '           
W26600*                  PV-DISPLAY-LOC                                         
      *                DISPLAY '** VERIFY THE STORE IS ON THE CORRECT'          
      *                  ' POS AND/OR CUTOFF TIMESTAMPS FILES'                  
      *                DISPLAY                                                  
      *                  '**---------------------------------------**'          
      *                MOVE +4001 TO ABEND-CODE                                 
W26600*                PERFORM 9900-ABEND                                       
                   END-IF                                                       
               END-IF                                                           
           END-IF.                                                              
                                                                                
W33304     DISPLAY ' '                                                          
W33304     DISPLAY '***********************************'                        
W33304     DISPLAY '    INKUT905 SUMMARY STATISTICS    '                        
W33304     DISPLAY '       FOR BYPASSED ITM RECS       '                        
W33304     DISPLAY '***********************************'                        
W33304     DISPLAY 'TOTAL ITM RECS BYPASSED....: ' PA-TOT-ITM-RECS-BYP          
W33304     DISPLAY 'TOTAL BYPASSED RECS WRITTEN: ' PA-TOT-ITM-RECS-WRIT         
W33304     DISPLAY '***********************************'                        
W33304                                                                          
      *    *----------------------------------------------                      
      *    * IN THE 8800- ROUTINE                                               
      *    *    .. SORT CARDS ARE WRITTEN                                       
      *    *    .. EMAIL MESSAGE IS WRITTEN IF AN INVALID                       
      *    *       STORES EXIST                                                 
      *    *----------------------------------------------                      
           PERFORM 8800-WRITE-SORT-CARDS.                                       
                                                                                
           PERFORM 8900-CLOSE-FILES.                                            
                                                                                
       EJECT                                                                    
      ****************************************************************          
      *                                                              *          
      *    THIS ROUTINE OPENS THE INVENTORY SHEET CONTROL FILE,      *          
      *    SALES ADJUSTMENT CANDIDATE STORE FILE, AND THE SALES      *          
      *    ADJUSTMENT FILE.                                          *          
      *                                                              *          
      ****************************************************************          
       1000-OPEN-FILES.                                                         
      *                                                                         
           OPEN INPUT  SALES-ADJ-CAND-STORE-FILE                                
W26600                 REQUEST-CNTL-FILE                                        
JS0600                 TSUMINV-PLAT-FILE                                        
JS0600                 STR-TTL-SLS-FILE                                         
                OUTPUT SALES-ADJUST-FILE                                        
                       TRAN-TIMESTAMP-FILE                                      
JS0600                 SORT-OMIT-STORE-FILE                                     
JS0600                 SORT-INCLUDE-STORE-FILE                                  
JS0600                 EMAIL-MESSAGE                                            
JS0800                 FASHION-ADJUSTMENTS.                                     
      *1000-EXIT.                                                               
           EJECT                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
W26600 1100-READ-REQUEST-CNTL-FILE.                                             
                                                                                
           MOVE 1                           TO PA-INNOV-RECORDS-IN.             
                                                                                
W26600     READ REQUEST-CNTL-FILE INTO CC-PROCESS-CONTROL                       
               AT END                                                           
                   DISPLAY '** ABEND - PROGRAM INKUT905 **'                     
                   DISPLAY '** PERCENT LIMIT RECORD IS MISSING'                 
                   DISPLAY ' 1100-READ-REQUEST-CNTL-FILE'                       
                   MOVE +4001 TO ABEND-CODE                                     
W26600             PERFORM 9900-ABEND                                           
W26600     END-READ.                                                            
                                                                                
           IF CC-PERCENT-LIMIT IS NUMERIC                                       
               AND CC-VALID-CATCHER                                             
               DISPLAY 'SALES ADJUST PERCENT LIMIT: '                           
                       CC-PERCENT-LIMIT '%'                                     
           ELSE                                                                 
               DISPLAY '** ABEND - PROGRAM INKUT905 **'                         
               DISPLAY '** PERCENT LIMIT REQUEST IS NOT VALID'                  
               DISPLAY ' 1100-READ-REQUEST-CNTL-FILE'                           
               MOVE +4001 TO ABEND-CODE                                         
W26600         PERFORM 9900-ABEND                                               
           END-IF.                                                              
                                                                                
      *                                                                         
      ****************************************************************          
      * LOAD THE STORE TOTAL SALES RECORD INTO WORKING STORAGE TABLE            
      ****************************************************************          
W26600 1200-LOAD-STR-TTL-SLS.                                                   
      *                                                                         
W26600     DISPLAY ' LOADING SALES TOTAL FOR ' IN027-STR-NBR.                   
           MOVE IN027-STR-NBR      TO PT-TTL-SLS-INDEX.                         
           MOVE IN027-STR-NBR                                                   
               TO PT-TTL-STR-NBR (PT-TTL-SLS-INDEX).                            
           MOVE IN027-POS-TRAN-DTE                                              
               TO PT-TTL-POS-DATE (PT-TTL-SLS-INDEX).                           
           MOVE IN027-TRAN-QTY                                                  
               TO PT-TTL-TRAN-QTY (PT-TTL-SLS-INDEX).                           
           MOVE IN027-RTL-AMT                                                   
               TO PT-TTL-RTL-AMT (PT-TTL-SLS-INDEX).                            
           MOVE IN027-RETURN-QTY                                                
               TO PT-TTL-RETURN-QTY (PT-TTL-SLS-INDEX).                         
           MOVE IN027-RETURN-RTL-AMT                                            
               TO PT-TTL-RETURN-RTL-AMT (PT-TTL-SLS-INDEX).                     
                                                                                
           PERFORM 1250-READ-STR-TTL-SLS-FILE.                                  
                                                                                
      ****************************************************************          
      * READ THE STORE TOTAL SALES FILE                                         
      ****************************************************************          
W26600 1250-READ-STR-TTL-SLS-FILE.                                              
                                                                                
            READ STR-TTL-SLS-FILE INTO IN027-TOTAL-SALES-REC                    
              AT END                                                            
                SET PS-END-OF-STR-TTL-SLS-FILE TO TRUE                          
            END-READ.                                                           
                                                                                
                                                                                
      ****************************************************************          
      * 3000-INITIALIZE - INITIALIZE ALL WORK AREAS, VALIDATES THE   *          
      * CONTROL CARD INFORMATION.                                    *          
      ****************************************************************          
       3000-INITIALIZE.                                                         
                                                                                
           INITIALIZE PA-PROGRAM-ACCUMULATORS.                                  
                                                                                
           MOVE PV-TEMP-DATE-YY             TO FN-FILE-DATE-YY.                 
           MOVE PV-TEMP-DATE-MM             TO FN-FILE-DATE-MM.                 
           MOVE PV-TEMP-DATE-DD             TO FN-FILE-DATE-DD.                 
                                                                                
           PERFORM 8600-ALLOCATE-AND-OPEN-RQST.                                 
                                                                                
W33304     PERFORM 7100-READ-ITEM-TIMESTAMP.                                    
                                                                                
W33304     IF PS-END-ITEM-TIMESTAMP AND PA-TOT-ITM-RECS-READ = +0               
               DISPLAY '*************************************'                  
               DISPLAY '*************************************'                  
               DISPLAY '* TIMESTAMP FILE IS EMPTY FOR DATE '                    
                       IN018-ACTL-INV-DTE                                       
               DISPLAY '*************************************'                  
               DISPLAY '*************************************'                  
               MOVE +4001 TO ABEND-CODE                                         
W26600         PERFORM 9900-ABEND                                               
W26600     END-IF.                                                              
                                                                                
           MOVE IN019-ACTL-INV-DTE TO PV-HOLD-DATE2.                            
           MOVE PV-HOLD-YY2 TO PV-HOLD-YY3.                                     
           MOVE PV-HOLD-MMDD2 TO PV-HOLD-MMDD3.                                 
                                                                                
           PERFORM 7200-READ-POS.                                               
           IF PS-END-POS-FILE                                                   
               DISPLAY '*************************************'                  
               DISPLAY '*************************************'                  
               DISPLAY '* POS SALES FILE IS EMPTY FOR DATE '                    
                       IN018-ACTL-INV-DTE                                       
               DISPLAY '*************************************'                  
               DISPLAY '*************************************'                  
      *        MOVE +4001 TO ABEND-CODE                                         
W26600*        PERFORM 9900-ABEND                                               
W26600     ELSE                                                                 
RONNA *  THE PV-HOLD-DATE IS THE ACTUAL INVENTORY DATE                          
RONNA *  WE ARE REALLY PROCESSING ADJUSTMENTS FOR SALES BEFORE THE              
RONNA *  INVENTORY DATE SO CHANGE THIS CHECK FOR THE IN016 TRAN                 
RONNA *  DATE TO BE LESS THAN THE PV HOLD DATE (INV DATE)                       
      *        IF PV-HOLD-DATE3-NUM NOT = IN016-TRAN-DTE                        
               IF PV-HOLD-DATE3-NUM <=    IN016-TRAN-DTE                        
                   DISPLAY '** ABEND - PROGRAM INKUT905 **'                     
                   DISPLAY '** DATE MISMATCH BETWEEN '                          
                           'POS AND TIMESTAMP FILES **'                         
                           'THIS IS A SPECIAL RUN WHERE '                       
                           'POS TRANSACTION ARE BEFORE THE '                    
                           'INV DATE AND CANNOT BE ON OR AFTER '                
                           'THE INVENTORY DATE '                                
                   DISPLAY 'POS DATE: '                                         
                           IN016-TRAN-DTE                                       
                           '   ACTL-INV-DTE: '                                  
                           PV-HOLD-DATE3                                        
                   DISPLAY ' 3000-INITIALIZE'                                   
                   MOVE +4001 TO ABEND-CODE                                     
W26600             PERFORM 9900-ABEND                                           
W26600         END-IF                                                           
W26600     END-IF.                                                              
                                                                                
      *3000-EXIT.                                                               
           EJECT                                                                
      ****************************************************************          
      * 4000-PROCESS-FILES - READS TIMESTAMP FILE AND POS FILE       *          
      * SEQUENTIALLY.                                                *          
      ****************************************************************          
       4000-PROCESS-FILES.                                                      
                                                                                
      *     *-------------------------------------------------------            
      *     * THE CANDIDATE FILE (INRD018) IS THE DRIVING FILE.                 
      *     * IT IS COMPARED AGAINST THE TIMESTAMP FILE (INRD019)               
      *     *-------------------------------------------------------            
            EVALUATE TRUE                                                       
            WHEN IN018-STR-NBR = IN019-STR-NBR                                  
                 PERFORM 4050-PROCESS-POS-FILE                                  
            WHEN IN018-STR-NBR < IN019-STR-NBR                                  
W26600           PERFORM 7000-PROCESS-SALES-ADJ-CAND                            
            WHEN IN018-STR-NBR > IN019-STR-NBR                                  
                 PERFORM 7100-READ-ITEM-TIMESTAMP                               
            END-EVALUATE.                                                       
                                                                                
      *4000-EXIT.                                                               
           EJECT                                                                
      ****************************************************************          
      * 4050-PROCESS-POS-FILE                                        *          
      ****************************************************************          
       4050-PROCESS-POS-FILE.                                                   
                                                                                
RONNA *    DISPLAY ' IN 4050-PROCESS-POS-FILE'.                                 
                                                                                
           MOVE IN016-STR-NBR TO PV-PREV-POS-STR.                               
                                                                                
           EVALUATE TRUE                                                        
               WHEN IN019-STR-NBR = PV-PREV-POS-STR                             
RONNA *            DISPLAY ' PV-TIME-ITEM IS ' PV-TIME-ITEM                     
RONNA *            DISPLAY ' PV-POS-ITEM IS ' PV-POS-ITEM                       
                   IF PV-TIME-ITEM = PV-POS-ITEM                                
                       IF IN016-SALE                                            
                           MOVE IN016-TRAN-TIMESTAMP TO PV-POS-TIME             
                           MOVE IN019-SCAN-TIMESTAMP TO PV-ITEM-TIME            
                           MOVE PV-ITEM-TIME TO PV-HOLD-TIME                    
RONNA**COMPARE THE DATE AND TIME SINCE THERE CAN BE MULTIPLE DAYS               
RONNA**        NEED TO COMPARE BOTH THE DATE AND TIME, NOT JUST THE             
RONNA**        TIME BUT THIS LOGIC DOES LOOK LIKE IT IS DOING THAT.             
RONNA**                                                                         
RONNA**                                                                         
RONNA**                                                                         
                           IF (PV-POS-TIME > PV-STAMP-TIME  AND                 
                               PV-POS-DATE = PV-STAMP-DATE) OR                  
                               (PV-POS-DATE > PV-STAMP-DATE)                    
RONNA *                        DISPLAY ' 4050- CHECK #1 '                       
RONNA *                        DISPLAY ' POS DATE ' PV-POS-DATE                 
RONNA *                        DISPLAY ' STAMP DATE ' PV-STAMP-DATE             
RONNA *                        DISPLAY ' POS TIME ' PV-POS-TIME                 
RONNA *                        DISPLAY ' STAMP TIME ' PV-STAMP-TIME             
                               PERFORM 4100-STORE-DATA                          
W26600                         IF PS-FIRST-SALE                                 
RONNA *                            DISPLAY ' 4050- CHECK #1 FIRST SALE'         
                                   MOVE IN016-TRAN-TIMESTAMP                    
                                       TO PV-HOUR-MIN                           
                                   MOVE PV-HOLD-FIRST-TIME                      
                                       TO PV-HOLD-TIME-POS                      
                                   MOVE PV-HOLD-TIME-POS                        
                                       TO IN-FIRST-SLS-TIMESTAMP                
W26600                             SET PS-NOT-FIRST-SALE   TO TRUE              
                               END-IF                                           
                               PERFORM 8050-WRITE-SALE-TIME-FILE                
                           END-IF                                               
                       ELSE                                                     
                           IF IN016-RETURN                                      
                               AND NOT IN016-PRICE-ADJUSTMENT                   
RONNA *                       MOVE IN016-TRAN-TIMESTAMP TO PV-POS-TIME          
RONNA *                       MOVE IN019-SCAN-TIMESTAMP TO PV-ITEM-TIME         
RONNA *                       MOVE PV-ITEM-TIME TO PV-HOLD-TIME                 
RONNA *                       IF (PV-POS-TIME > PV-STAMP-TIME  AND              
RONNA *                           PV-POS-DATE = PV-STAMP-DATE) OR               
RONNA *                          (PV-POS-DATE > PV-STAMP-DATE)                  
RONNA *                        DISPLAY ' 4050- CHECK #2 '                       
                               PERFORM 4100-STORE-DATA                          
W26600                         IF PS-FIRST-SALE                                 
RONNA *                        DISPLAY ' 4050- CHECK #2 FIRST SALE'             
                                   MOVE ZERO TO IN-FIRST-SLS-TIMESTAMP          
                               END-IF                                           
                               PERFORM 8050-WRITE-SALE-TIME-FILE                
RONNA *                      END-IF                                             
                           END-IF                                               
                       END-IF                                                   
                       PERFORM 7200-READ-POS                                    
                   ELSE                                                         
                       IF PV-TIME-ITEM < PV-POS-ITEM                            
RONNA *                        DISPLAY ' 4050- CHECK #3 TM ITM < PS ITM'        
W26600                     PERFORM 4500-PROCESS-PHYSICAL                        
                           PERFORM 7100-READ-ITEM-TIMESTAMP                     
                       ELSE                                                     
                           IF PV-TIME-ITEM > PV-POS-ITEM                        
RONNA *                        DISPLAY ' 4050- CHECK #3 TM ITM > PS ITM'        
PE6906                         IF (IN016-RETURN                                 
PE6906                            AND NOT IN016-PRICE-ADJUSTMENT)               
RONNA *                        DISPLAY ' 4050- CHECK #3 NOT CNT RETURN'         
PE6906                            PERFORM 8150-NOT-COUNTED-RETURN               
PE6906                            SET PS-INCLUDE-RETURN TO TRUE                 
PE6906                         END-IF                                           
                               PERFORM 7200-READ-POS                            
                           END-IF                                               
                       END-IF                                                   
                   END-IF                                                       
               WHEN IN019-STR-NBR < PV-PREV-POS-STR                             
W26600             PERFORM 4500-PROCESS-PHYSICAL                                
                   PERFORM 7100-READ-ITEM-TIMESTAMP                             
               WHEN IN019-STR-NBR > PV-PREV-POS-STR                             
                   PERFORM 7200-READ-POS                                        
           END-EVALUATE.                                                        
                                                                                
                                                                                
      *4050-EXIT.                                                               
           EJECT                                                                
                                                                                
      ******************************************************************        
      * MOVE DATA FROM POS FILE TO SALE ADJUSTMENT FORMAT.             *        
      ******************************************************************        
       4100-STORE-DATA.                                                         
                                                                                
W26600     IF PS-FIRST-TIME                                                     
               SET PS-NOT-FIRST-TIME   TO TRUE                                  
               MOVE IN016-STR-NBR        TO PV-STORE-NUMBER                     
                                            IN-STR-NBR                          
               MOVE IN016-DEPT-NBR       TO IN-DEPT-NBR                         
                                            PV-HOLD-DEPT                        
               MOVE IN016-CL-NBR         TO IN-CL-NBR                           
                                            PV-HOLD-CLASS                       
W21732         MOVE IN016-SKU            TO IN-SKU                              
W21732                                      PV-HOLD-SKU                         
RONNA          MOVE IN016-TRAN-DTE       TO IN-IN016-TRAN-DTE                   
RONNA          MOVE IN016-TRAN-TIMESTAMP TO IN-IN016-TRAN-TIMESTAMP             
               MOVE IN019-ACTL-INV-DTE   TO IN-ACTL-INV-DTE                     
               MOVE IN019-SCAN-AREA      TO IN-SCAN-AREA                        
               MOVE IN019-SCAN-DTE       TO IN-SCAN-DTE                         
               MOVE IN019-SCAN-TIMESTAMP TO IN-SCAN-TIMESTAMP                   
               MOVE IN019-UNIT-PRICE     TO IN-UNIT-PRICE                       
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************        
W26600* PROCESS PHYSICAL INVENTORY DATA                                *        
W26600******************************************************************        
W26600 4500-PROCESS-PHYSICAL.                                                   
W26600                                                                          
W26600     IF PS-NOT-FIRST-TIME                                                 
W26600         PERFORM 5000-PHYSICAL-COUNT                                      
W26600         PERFORM 5100-CORRECTIONS                                         
W26600         PERFORM 5200-STCKRM-WTHDRWL                                      
W26600         PERFORM 5300-SALES-ADJ                                           
W26600         PERFORM 8000-WRITE-FIRST-SALE                                    
W26600         SET PS-FIRST-TIME   TO TRUE                                      
W26600         SET PS-FIRST-SALE   TO TRUE                                      
W26600     END-IF.                                                              
                                                                                
      ******************************************************************        
W26600* CREATE SALES ADJ TOTAL                                         *        
W26600******************************************************************        
W26600 4600-CREATE-SALES-ADJ-TOTAL.                                             
W26600                                                                          
W26600     MOVE PV-IN018-PREV-CAND-STORE TO PT-TTL-SLS-INDEX.                   
W26600     PERFORM 8005-CHECK-SLS-ADJ-PCT.                                      
RONNA *    PERFORM 8010-WRITE-TOTAL-SALES-REC.                                  
                                                                                
      ******************************************************************        
      * GET INV-QTY FOR ITEM/STORE/AREA, EXCLUDING AREAS FROM CONTROL  *        
      * CARD.                                                          *        
      ******************************************************************        
       5000-PHYSICAL-COUNT.                                                     
                                                                                
W21732     IF PV-SUMINV-KEY = PV-IN019-KEY                                      
JS0600        AND (PS-NOT-END-OF-TSUMINV)                                       
JS0600         CONTINUE                                                         
JS0600     ELSE                                                                 
W21732         IF PV-SUMINV-KEY < PV-IN019-KEY                                  
                  AND (PS-NOT-END-OF-TSUMINV)                                   
JS0600             SET PS-CUR-ITEM-NOT-FOUND TO TRUE                            
JS0600             PERFORM 7300-FIND-SKU-ON-INV-FILE                            
JS0600             UNTIL PS-END-OF-TSUMINV                                      
JS0600                OR PS-CUR-ITEM-FOUND                                      
               ELSE                                                             
JS0600             DISPLAY 'CANNOT FIND TIMESTAMP ITEM ON TSUMINV'              
JS0600                     ' INVENTORY INPUT FILE'                              
W21732             DISPLAY 'INV KEY: ' PV-SUMINV-KEY                            
W21732                     '  TIMESTAMP KEY: ' PV-IN019-KEY                     
JS0600                     '  POS KEY: ' IN016-POS-KEY                          
                   DISPLAY ' 5000-PHYSICAL-COUNT'                               
                   DISPLAY                                                      
                   '**---------------------------------------------**'          
                   MOVE +4001 TO ABEND-CODE                                     
W26600             PERFORM 9900-ABEND                                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
           SET PS-NEXT-ITEM-NOT-FOUND TO TRUE.                                  
JS0600     PERFORM 6000-READ-AND-SUM-INVENTORY                                  
JS0600         UNTIL PS-END-OF-TSUMINV                                          
JS0600            OR PS-NEXT-ITEM-FOUND.                                        
                                                                                
           EJECT                                                                
      ******************************************************************        
      * GET ADJ-QTY FOR ITEM/STORE AND ADJ-TYPE-CDE = CO               *        
      ******************************************************************        
       5100-CORRECTIONS.                                                        
                                                                                
           SET PS-MORE-TADJDTL-ROWS TO TRUE.                                    
           PERFORM 8200-OPEN-TADJDTL-CURSOR.                                    
           PERFORM 8250-FETCH-TADJDTL-ROW.                                      
           PERFORM 6100-PROCESS-TADJDTL-ROWS                                    
               UNTIL PS-NO-MORE-TADJDTL-ROWS.                                   
           PERFORM 8275-CLOSE-TADJDTL-CURSOR.                                   
                                                                                
           EJECT                                                                
      ******************************************************************        
      * GET INV-QTY FOR ITEM/STORE.                                    *        
      ******************************************************************        
       5200-STCKRM-WTHDRWL.                                                     
                                                                                
           SET PS-MORE-TSTKRMW-ROWS TO TRUE.                                    
           PERFORM 8300-OPEN-TSTKRMW-CURSOR.                                    
           PERFORM 8350-FETCH-TSTKRMW-ROW.                                      
           PERFORM 6200-PROCESS-TSTKRMW-ROWS                                    
               UNTIL PS-NO-MORE-TSTKRMW-ROWS.                                   
           PERFORM 8375-CLOSE-TSTKRMW-CURSOR.                                   
                                                                                
           EJECT                                                                
      ******************************************************************        
      * DO CALCULATIONS FOR SALES ADJUSTMENT.                          *        
      *                                                                         
      * THE SALES ADJUSTMENT CANNOT CAUSE THE PHYSICAL COUNT GO                 
      * BELOW ZERO.                                                             
      ******************************************************************        
       5300-SALES-ADJ.                                                          
                                                                                
           MOVE PV-SUMINV-INV-QTY TO IN-TTL-PHY-COUNT.                          
           COMPUTE PV-STKRMW-INV-QTY = PV-STKRMW-INV-QTY * -1.                  
           COMPUTE IN-INVLD-STKRMW =                                            
                             PV-STKRMW-INV-QTY + PV-ADJDTL-ADJ-QTY.             
           COMPUTE PV-SALES-ADJ-QTY = IN-TTL-PHY-COUNT +                        
               (-1 * PV-TRAN-QTY) + IN-INVLD-STKRMW .                           
           IF PV-SALES-ADJ-QTY >= 0                                             
              COMPUTE IN-SALES-ADJ-QTY = PV-TRAN-QTY * -1                       
           ELSE                                                                 
              COMPUTE IN-NEG-INV-ADJUST = PV-SALES-ADJ-QTY * -1                 
              COMPUTE IN-SALES-ADJ-QTY =                                        
                      (PV-TRAN-QTY + PV-SALES-ADJ-QTY) * -1                     
           END-IF.                                                              
                                                                                
      *   **************************************************************        
      *   **GIFT WITH PURCHASE ITEMS MUST HAVE 0.00 RETAIL ADJUSTMENT,          
      *   **BECAUSE GWP SALES ARE ZERO.  HOWEVER THE QUANTITY MUST BE           
      *   **ACCOUNTED FOR ON THE SALES ADJUSTMENT.                              
      *   **************************************************************        
           IF IN-UNIT-PRICE < PC-GWP-PRICE                                      
               MOVE ZERO TO IN-SALES-ADJ-EXT-RTL-AMT                            
                            IN-UNIT-PRICE                                       
           ELSE                                                                 
               COMPUTE IN-SALES-ADJ-EXT-RTL-AMT =                               
                       IN-UNIT-PRICE * IN-SALES-ADJ-QTY                         
JS0600         ADD IN-SALES-ADJ-EXT-RTL-AMT TO PV-STR-SLS-ADJ-RTL-AMT           
           END-IF.                                                              
                                                                                
           MOVE PV-TRAN-QTY TO IN-UNITS-SLD-AFT-TIMESTAMP.                      
JS0600     ADD  IN-SALES-ADJ-QTY TO PV-STR-SLS-ADJ-TRAN-QTY.                    
                                                                                
           EJECT                                                                
                                                                                
                                                                                
      ******************************************************************        
      *  SUM INVENTORY QUANTITY FOR ITEM/STORE                                  
      ******************************************************************        
JS0600 6000-READ-AND-SUM-INVENTORY.                                             
                                                                                
      *    *--------------------------------------------------------            
      *    *  MUST FIND D-KEY ASSOCIATED WITH STORE/ITEM/AREA/PRICE             
      *    *--------------------------------------------------------            
W21732     IF PV-SUMINV-KEY                = PV-IN019-KEY                       
             AND WS-SUMINV-AREA-NBR        = IN019-SCAN-AREA                    
             AND WS-SUMINV-INV-UNIT-PR-AMT = IN019-UNIT-PRICE                   
               MOVE WS-SUMINV-DKEY-NBR TO IN-DKEY-NBR                           
           END-IF.                                                              
                                                                                
W21732     IF PV-SUMINV-KEY = PV-IN019-KEY                                      
TEST  **>      DISPLAY 'INV KEY: ' WS-SUMINV-KEY                                
TEST  **>            '  TIMESTMP KEY: ' IN019-TIMESTMP-KEY                      
TEST  **>            '  POS KEY: ' IN016-POS-KEY                                
               COMPUTE PV-SUMINV-INV-QTY =                                      
                       WS-SUMINV-INV-QTY + PV-SUMINV-INV-QTY                    
               PERFORM 7310-READ-INVENTORY-FILE                                 
           ELSE                                                                 
              SET PS-NEXT-ITEM-FOUND TO TRUE                                    
           END-IF.                                                              
                                                                                
      *                                                                         
           EJECT                                                                
      ******************************************************************        
      * SUM ADJUSTED QUANTITY FO ITEM/STORE AND ADJ-TYP-CDE = CO,      *        
      ******************************************************************        
       6100-PROCESS-TADJDTL-ROWS.                                               
                                                                                
           COMPUTE PV-ADJDTL-ADJ-QTY =                                          
                   ADJDTL-ADJ-QTY + PV-ADJDTL-ADJ-QTY                           
           PERFORM 8250-FETCH-TADJDTL-ROW.                                      
                                                                                
      *                                                                         
           EJECT                                                                
      ******************************************************************        
      *  SUM INVENTORY QUANTITY FOR ITEM/STORE.                        *        
      ******************************************************************        
       6200-PROCESS-TSTKRMW-ROWS.                                               
                                                                                
           COMPUTE PV-STKRMW-INV-QTY =                                          
                   STKRMW-INV-QTY + PV-STKRMW-INV-QTY                           
           PERFORM 8350-FETCH-TSTKRMW-ROW.                                      
                                                                                
      *                                                                         
           EJECT                                                                
      ****************************************************************          
      * 7000-PROCESS-SALES-ADJ-CAND - READS THE CANDIDATES FOR SALES *          
      * ADJUSTMENTS FILE.                                            *          
      ****************************************************************          
W26600 7000-PROCESS-SALES-ADJ-CAND.                                             
                                                                                
W26600     PERFORM 7050-READ-SALES-ADJ-CAND.                                    
                                                                                
           IF PS-END-OF-SALES-ADJ-CAND                                          
               DISPLAY '   ===> END OF SALE CAND FILE '                         
           ELSE                                                                 
      *        *******************************************************          
      *        *  PV-TEMP-DATE IS USED TO GET DATED FILES                       
      *        *******************************************************          
               MOVE IN018-ACTL-INV-DTE TO PV-TEMP-DATE                          
JS0600         IF PS-FIRST-STR-ON-CAND-FILE                                     
JS0600             MOVE IN018-STR-NBR TO PV-IN018-PREV-CAND-STORE               
JS0600             SET PS-NOT-FIRST-STR-ON-CAND-FILE TO TRUE                    
JS0600         END-IF                                                           
      *        *******************************************************          
      *        *  WRITE OUT TOTAL RECORD FROM PREVIOUS CAND STORE               
      *        *******************************************************          
JS0600         IF IN018-STR-NBR NOT = PV-IN018-PREV-CAND-STORE                  
                   PERFORM 4600-CREATE-SALES-ADJ-TOTAL                          
                   SET PS-STORE-TTL-REC-WRITTEN TO TRUE                         
                   DISPLAY '   ===> READ NEXT CAND STR NBR: '                   
                           IN018-STR-NBR                                        
                           '  INV DATE: ' IN018-ACTL-INV-DTE                    
                           ' <=== '                                             
                   MOVE IN018-STR-NBR      TO PV-IN018-PREV-CAND-STORE          
               END-IF                                                           
           END-IF.                                                              
                                                                                
      *7000-EXIT.                                                               
           EJECT                                                                
                                                                                
      ****************************************************************          
W26600* 7050-READ-SALES-ADJ-CAND                                     *          
      *  THIS ROUTINE IS TO CHECK IF ANOTHER CANDIDATE STORE EXISTS  *          
      *  THE INPUT WILL NOT BE READ INTO THE IN018 COPY BOOK         *          
      ****************************************************************          
W26600 7050-READ-SALES-ADJ-CAND.                                                
                                                                                
            READ SALES-ADJ-CAND-STORE-FILE                                      
                INTO IN018-PREV-CALC-STORES                                     
            AT END                                                              
                SET PS-END-OF-SALES-ADJ-CAND    TO TRUE                         
            END-READ.                                                           
                                                                                
      ****************************************************************          
      * 7100-READ-ITEM-TIMESTAMP - READS THE ITEM TIMESTAMP FILE     *          
      ****************************************************************          
       7100-READ-ITEM-TIMESTAMP.                                                
                                                                                
           READ ITEM-TIMESTAMP-FILE INTO                                        
                IN019-ITEM-REC                                                  
           AT END                                                               
                SET PS-END-ITEM-TIMESTAMP TO TRUE                               
W33304     NOT AT END                                                           
W33304          ADD +1 TO PA-TOT-ITM-RECS-READ                                  
           END-READ.                                                            
                                                                                
W33304     SET PS-BAD-ITEM-TIMESTAMP-REC TO TRUE                                
                                                                                
           IF PS-END-ITEM-TIMESTAMP                                             
               DISPLAY '   ===> END OF CUTOFF TIMESTAMP FILE'                   
           ELSE                                                                 
W33304         IF IN019-STR-NBR NOT = PV-HOLD-IN019-STORE-NBR                   
W33304            PERFORM 7110-GET-TINVPAR                                      
W33304              UNTIL PS-GOOD-ITEM-TIMESTAMP-REC                            
W33304                 OR PS-END-ITEM-TIMESTAMP                                 
W33304         ELSE                                                             
W33304*           THESE ARE TO KEEP THE SAME VALUES THROUGH OUT THE             
W33304*           FILE WHEN THE REST OF THE REC IS INITIALIZED.                 
W33304*           THESE VALUES ONLY CHANGE WHEN LOC CHANGES ABOVE THIS          
W33304            MOVE PV-HOLD-INV-ID TO IN-INV-ID                              
W33304                                   TTL-INV-ID                             
PE6906                                   RET-INV-ID                             
W33304            MOVE PV-HOLD-FINCL-INV-STAT-CDE                               
W33304                                TO IN-FINCL-INV-STAT-CDE                  
W33304                                   TTL-FINCL-INV-STAT-CDE                 
PE6906                                   RET-FINCL-INV-STAT-CDE                 
W33304         END-IF                                                           
               MOVE IN019-DEPT-NBR TO PV-TIME-DEPT                              
               MOVE IN019-CL-NBR   TO PV-TIME-CLS                               
W21732         MOVE IN019-SKU      TO PV-TIME-SKU                               
               MOVE IN019-SCAN-DTE TO PV-STAMP-DATE                             
           END-IF.                                                              
W21732     MOVE IN019-STR-NBR    TO PV-IN019-STORE-NBR.                         
W21732     MOVE IN019-SKU        TO PV-IN019-SKU-NBR.                           
W21732     MOVE IN019-DEPT-NBR   TO PV-IN019-DEPT-NBR.                          
W21732     MOVE IN019-CL-NBR     TO PV-IN019-CL-NBR.                            
                                                                                
                                                                                
W33304****************************************************************          
W33304* GET TINVPAR FIELDS FOR OUTPUT FILE (INRD019)                            
W33304****************************************************************          
W33304 7110-GET-TINVPAR.                                                        
W33304                                                                          
W33304     INITIALIZE INVPAR-INV-ID                                             
W33304                INVPAR-FINCL-INV-STAT-CDE.                                
W33304                                                                          
W33304     MOVE IN019-STR-NBR TO INVPAR-LOC-NBR.                                
W33304                                                                          
W33304     SET PS-BAD-ITEM-TIMESTAMP-REC TO TRUE.                               
W33304                                                                          
W33304     PERFORM WITH TEST AFTER                                              
W33304             VARYING PV-RETRY-COUNTER FROM 1 BY 1                         
W33304             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR                 
W33304                     SQLCODE = ZERO OR                                    
W33304                     SQLCODE = +100                                       
W33304        EXEC SQL                                                          
W33304             SELECT B.INV_ID                                              
W33304                  , FINCL_INV_STAT_CDE                                    
PE6906                  , B.ACTL_INV_DTE                                        
W33304             INTO  :INVPAR-INV-ID                                         
W33304                  ,:INVPAR-FINCL-INV-STAT-CDE                             
PE6906                  ,:INVPAR-ACTL-INV-DTE                                   
W33304             FROM   TINCNTL  A                                            
W33304                  , TINVPAR  B                                            
W33304             WHERE  B.LOC_NBR          = :INVPAR-LOC-NBR                  
W33304             AND    A.ACTV_IND         = :PC-ACTIVE                       
W33304             AND    ACTL_FIN_BK_DTE    = :PC-DEFAULT-NINES                
W33304             AND    B.INV_ID           = A.INV_ID                         
W33304             AND    LOC_INV_STAT_CDE   = :PC-INITIAL-STATUS               
W33304             AND   (FINCL_INV_STAT_CDE = :PC-WILL-BOOK                    
W33304              OR    FINCL_INV_STAT_CDE = :PC-BOOK-DELAYED)                
W33304        END-EXEC                                                          
W33304                                                                          
W33304        EVALUATE SQLCODE                                                  
W33304            WHEN +0                                                       
W33304                 MOVE IN019-STR-NBR TO PV-HOLD-IN019-STORE-NBR            
W33304                 MOVE INVPAR-INV-ID   TO IN-INV-ID                        
W33304                                         PV-HOLD-INV-ID                   
W33304                                         IN019-INV-ID                     
PE6906                                         RET-INV-ID                       
W33304                 MOVE INVPAR-FINCL-INV-STAT-CDE                           
W33304                                      TO IN-FINCL-INV-STAT-CDE            
W33304                                         IN019-FINCL-INV-STAT-CDE         
W33304                                        PV-HOLD-FINCL-INV-STAT-CDE        
PE6906                                        RET-FINCL-INV-STAT-CDE            
W33304                 SET PS-GOOD-ITEM-TIMESTAMP-REC TO TRUE                   
W33304                                                                          
W33304            WHEN +100                                                     
W33304                 PERFORM 7120-GET-TINVPAR-TTL-ONLY                        
W33304                 MOVE IN019-STR-NBR TO PV-HOLD-IN019-STORE-NBR            
W33304                 SET PS-BAD-ITEM-TIMESTAMP-REC TO TRUE                    
W33304                 PERFORM 8100-BYPASS-ITM-TIMESTMP-RECS                    
W33304                   UNTIL IN019-STR-NBR NOT =                              
W33304                                       PV-HOLD-IN019-STORE-NBR            
W33304                      OR PS-END-ITEM-TIMESTAMP                            
W33304                                                                          
W33304            WHEN -911                                                     
W33304            WHEN -913                                                     
W33304                  CONTINUE                                                
W33304                                                                          
W33304            WHEN OTHER                                                    
W33304                 MOVE '7110-GET-TINVPAR'                                  
W33304                                  TO  PV-PARAGRAPH-NAME                   
W33304                 MOVE 'SELECT ON TINVPAR TABLE'                           
W33304                                  TO  PV-DB2-OPER-ATTEMPTED               
W33304                 DISPLAY 'LOC_NBR: ' INVPAR-LOC-NBR                       
W33304                 PERFORM 9000-SQL-ABEND                                   
W33304                                                                          
W33304        END-EVALUATE                                                      
W33304     END-PERFORM.                                                         
W33304                                                                          
W33304     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
W33304         SQLCODE NOT = ZERO AND                                           
W33304         SQLCODE NOT = +100                                               
W33304         MOVE '7110-GET-TINVPAR'                                          
W33304                          TO  PV-PARAGRAPH-NAME                           
W33304         MOVE 'SELECT ON TINVPAR TABLE'                                   
W33304                          TO  PV-DB2-OPER-ATTEMPTED                       
W33304         DISPLAY 'LOC_NBR: ' INVPAR-LOC-NBR                               
W33304         PERFORM 9000-SQL-ABEND                                           
W33304     END-IF.                                                              
W33304                                                                          
W33304****************************************************************          
W33304* GET TINVPAR FIELDS FOR OUTPUT FILE (INRD019) FOR TTL LINE ONLY          
W33304****************************************************************          
W33304 7120-GET-TINVPAR-TTL-ONLY.                                               
W33304                                                                          
W33304     INITIALIZE TTL-INV-ID                                                
W33304                TTL-FINCL-INV-STAT-CDE.                                   
W33304                                                                          
W33304     MOVE IN019-STR-NBR TO INVPAR-LOC-NBR.                                
W33304                                                                          
W33304     PERFORM WITH TEST AFTER                                              
W33304             VARYING PV-RETRY-COUNTER FROM 1 BY 1                         
W33304             UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR                 
W33304                     SQLCODE = ZERO                                       
W33304                                                                          
W33304        EXEC SQL                                                          
W33304             SELECT B.INV_ID                                              
W33304                  , FINCL_INV_STAT_CDE                                    
W33304             INTO  :INVPAR-INV-ID                                         
W33304                  ,:INVPAR-FINCL-INV-STAT-CDE                             
W33304             FROM   TINCNTL A                                             
W33304                  , TINVPAR  B                                            
W33304             WHERE  B.LOC_NBR          = :INVPAR-LOC-NBR                  
W33304             AND    A.ACTV_IND         = :PC-ACTIVE                       
W33304             AND    ACTL_FIN_BK_DTE    = :PC-DEFAULT-NINES                
W33304             AND    B.INV_ID           = A.INV_ID                         
W33304             AND    LOC_INV_STAT_CDE   = :PC-INITIAL-STATUS               
W33304        END-EXEC                                                          
W33304                                                                          
W33304        EVALUATE SQLCODE                                                  
W33304            WHEN +0                                                       
W33304                 MOVE INVPAR-INV-ID   TO TTL-INV-ID                       
W33304                 MOVE INVPAR-FINCL-INV-STAT-CDE                           
W33304                                      TO TTL-FINCL-INV-STAT-CDE           
W33304                                                                          
W33304            WHEN -911                                                     
W33304            WHEN -913                                                     
W33304                  CONTINUE                                                
W33304                                                                          
W33304            WHEN OTHER                                                    
W33304                 MOVE '7120-GET-TINVPAR-TTL-ONLY'                         
W33304                                  TO  PV-PARAGRAPH-NAME                   
W33304                 MOVE 'SELECT ON TINVPAR TABLE'                           
W33304                                  TO  PV-DB2-OPER-ATTEMPTED               
W33304                 DISPLAY 'LOC_NBR: ' INVPAR-LOC-NBR                       
W33304                 PERFORM 9000-SQL-ABEND                                   
W33304                                                                          
W33304        END-EVALUATE                                                      
W33304     END-PERFORM.                                                         
W33304                                                                          
W33304     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                            
W33304         SQLCODE NOT = ZERO                                               
W33304         MOVE '7120-GET-TINVPAR-TTL-ONLY'                                 
W33304                          TO  PV-PARAGRAPH-NAME                           
W33304         MOVE 'SELECT ON TINVPAR TABLE'                                   
W33304                          TO  PV-DB2-OPER-ATTEMPTED                       
W33304         DISPLAY 'LOC_NBR: ' INVPAR-LOC-NBR                               
W33304         PERFORM 9000-SQL-ABEND                                           
W33304     END-IF.                                                              
W33304                                                                          
                                                                                
      ****************************************************************          
      * 7200-READ-POS - READS THE POS FILE.                          *          
      ****************************************************************          
       7200-READ-POS.                                                           
                                                                                
           READ POS-FILE INTO                                                   
                IN016-POS-ITEM-DETAIL                                           
           AT END                                                               
               SET PS-END-POS-FILE TO TRUE                                      
           END-READ.                                                            
PE6906                                                                          
PE6906     IF PS-INCLUDE-RETURN                                                 
PE6906        IF IN019-STR-NBR NOT = PV-HOLD-IN019-STORE-NBR                    
PE6906           PERFORM 7110-GET-TINVPAR                                       
PE6906             UNTIL PS-GOOD-ITEM-TIMESTAMP-REC                             
PE6906                OR PS-END-ITEM-TIMESTAMP                                  
PE6906        ELSE                                                              
PE6906           MOVE PV-HOLD-INV-ID    TO  RET-INV-ID                          
PE6906           MOVE PV-HOLD-FINCL-INV-STAT-CDE                                
PE6906                                  TO  RET-FINCL-INV-STAT-CDE              
PE6906        END-IF                                                            
PE6906        ADD  RET-SALES-ADJ-QTY TO PV-STR-SLS-ADJ-TRAN-QTY                 
PE6906        ADD RET-SALES-ADJ-EXT-RTL-AMT TO PV-STR-SLS-ADJ-RTL-AMT           
PE6906        WRITE SALES-ADJUST-REC                                            
PE6906          FROM RET-ITEM-REC                                               
PE6906        MOVE RET-SKU           TO PV-HOLD-SKU                             
PE6906        INITIALIZE RET-ITEM-REC                                           
PE6906                   PV-TRAN-QTY-RET                                        
PE6906        SET PS-NOT-INCLUDE-RETURN TO TRUE                                 
PE6906     END-IF.                                                              
PE6906                                                                          
                                                                                
           MOVE IN016-DEPT-NBR  TO PV-POS-DEPT.                                 
           MOVE IN016-CL-NBR    TO PV-POS-CLS.                                  
W21732     MOVE IN016-SKU       TO PV-POS-SKU.                                  
           MOVE IN016-TRAN-DTE  TO PV-HOLD-DATE-NUM.                            
                                                                                
                                                                                
      ****************************************************************          
      *                                                                         
      ****************************************************************          
       7300-FIND-SKU-ON-INV-FILE.                                               
                                                                                
           PERFORM 7310-READ-INVENTORY-FILE.                                    
                                                                                
W21732     IF PV-SUMINV-KEY = PV-IN019-KEY                                      
JS0600        AND (PS-NOT-END-OF-TSUMINV)                                       
JS0600         SET PS-CUR-ITEM-FOUND TO TRUE                                    
JS0600     ELSE                                                                 
W21732         IF (PV-SUMINV-KEY > PV-IN019-KEY)                                
W21732            OR  (PV-SUMINV-KEY < PV-IN019-KEY                             
JS0600                 AND (PS-END-OF-TSUMINV))                                 
JS0600             DISPLAY 'CANNOT FIND TIMESTAMP ITEM ON INVENTORY'            
JS0600                     ' INPUT FILE'                                        
W21732             DISPLAY 'INV KEY: ' PV-SUMINV-KEY                            
W21732                     '  TIMESTAMP KEY: ' PV-IN019-KEY                     
JS0600                     '  POS KEY: ' IN016-POS-KEY                          
                   DISPLAY ' 7300-FIND-SKU-ON-INV-FILE'                         
                   DISPLAY                                                      
                   '**---------------------------------------------**'          
                   MOVE +4001 TO ABEND-CODE                                     
W26600             PERFORM 9900-ABEND                                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
      ****************************************************************          
      *                                                                         
      *                                                                         
      ****************************************************************          
       7310-READ-INVENTORY-FILE.                                                
                                                                                
JS0600     READ TSUMINV-PLAT-FILE INTO WS-TSUMINV                               
JS0600       AT END                                                             
JS0600         SET PS-END-OF-TSUMINV TO TRUE                                    
JS0600     END-READ.                                                            
W21732     MOVE WS-SUMINV-STORE-NBR   TO PV-SUMINV-STORE-NBR.                   
W21732     MOVE WS-SUMINV-DEPT-NBR    TO PV-SUMINV-DEPT-NBR.                    
W21732     MOVE WS-SUMINV-SUB-CL-NBR  TO PV-SUMINV-CL-NBR.                      
W21732     MOVE WS-SUMINV-SKU-NBR     TO PV-SUMINV-SKU-NBR.                     
                                                                                
      ****************************************************************          
      * 8000-WRITE-FIRST-SALE.  WRITES THE FIRST SALE  AFTER         *          
      * INVENTORY FOR EACH ITEM IN A STORE.                          *          
      ****************************************************************          
       8000-WRITE-FIRST-SALE.                                                   
                                                                                
            WRITE SALES-ADJUST-REC                                              
              FROM IN-ITEM-REC.                                                 
                                                                                
            INITIALIZE IN-ITEM-REC.                                             
            MOVE ZEROES TO PV-SUMINV-INV-QTY                                    
                           PV-ADJDTL-ADJ-QTY                                    
                           PV-STKRMW-INV-QTY                                    
                           PV-TRAN-QTY.                                         
                                                                                
      *                                                                         
      * -- WRITE FASHION SALES ON-HAND ADJUSTMENT RECORDS                       
      * -- THIS FILE IS ONLY NEED FOR THE BACKOUT OF SALES ADJUSTMENTS          
      *                                                                         
           PERFORM 8001-WRITE-FASHION.                                     CL**2
                                                                                
      *8000-EXIT.                                                               
           EJECT                                                                
                                                                                
      *                                                                         
      ******************************************************************        
      * WRITE THE FASHION SALES ON-HAND UPDATE FILE                             
      *                                                                         
      * THIS FILE IS NOT USED DURING NORMAL SALES ADJUSTMENT PROCESSIN          
      * THIS FILE IS ONLY USED IN THE SPECIAL 'RERUN' PROCESSING OF             
      * A STORE THAT HAS ALREADY COMPLETED ITS UNIT BOOKINGS                    
      ******************************************************************        
       8001-WRITE-FASHION.                                                 CL**2
                                                                        INKUT115
W21732     PERFORM 8400-GET-ITM-NBR-FROM-TSKXREF.                               
W21732                                                                          
W21732     MOVE PV-ITEM-NBR            TO  FS035-ITM-NBR.                       
W26600*    MOVE ADJDTL-STORE-NBR       TO  PV-STORE-NUMBER-3.              CL*12
W26600     MOVE ADJDTL-LOC-NBR         TO  FS035-LOC-NBR.                  CL*12
W21732*    MOVE PV-STORE-NUMBER-FS     TO  FS035-LOC-NBR.                  CL*12
W21732     MOVE '123'                  TO  FS035-ADJ-TYP.                  CL*12
           MOVE ADJDTL-ADJ-QTY         TO  PV-WORK-QTY.                    CL*17
W21732     MOVE PV-WORK-QTY            TO  FS035-ADJ-QTY.                  CL*17
W21732     MOVE 'INOL'                 TO  FS035-BTCH-NBR.                 CL*12
W21732     MOVE 'Y'                    TO  FS035-UNT-BKG-IND.              CL*17
W21732     MOVE 'INKUT905'             TO  FS035-ADJ-SRC-PGM-NM.                
                                                                        INKUT115
                                                                                
           IF  ADJDTL-ADJ-QTY POSITIVE                                  INKCS012
W21732         MOVE '+' TO FS035-ACTN-CDE                               INKCS012
           ELSE                                                         INKCS012
W21732         MOVE '-' TO FS035-ACTN-CDE                               INKCS012
           END-IF.                                                      INKCS012
                                                                        INKCS012
                                                                        INKUT115
W21732     WRITE FASHION-ADJUSTMENTS-RECORD                                CL**2
W21732      FROM FS035-ADJUSTMENT-RECORD.                                       
                                                                        INKUT115
      ****************************************************************          
      *                                                                         
      *                                                                         
      ****************************************************************          
JS0600 8005-CHECK-SLS-ADJ-PCT.                                                  
                                                                                
      *    **-------------------------------------------------------            
      *    * THE STORE'S TTL RETAIL SALES MAY BE ZERO FOR THE FOLLOWING         
      *    * REASONS: 1) STORE WAS MISSING FROM POS FILE                        
      *    *          2) STORE WAS MISSING FROM CUTOFF TIMESTAMP FILE           
      *    *          3) ALL SALES TOOK PLACE BEFORE THE INVENTORY              
      *    *             WAS STARTED                                            
      *    **-------------------------------------------------------            
                                                                                
           IF PT-TTL-STR-NBR (PT-TTL-SLS-INDEX)                                 
               = PV-IN018-PREV-CAND-STORE                                       
               CONTINUE                                                         
           ELSE                                                                 
      *        DISPLAY '** ABEND - PROGRAM INKUT905                **'          
W26600         MOVE PT-TTL-SLS-INDEX TO PV-DISPLAY-LOC                          
               DISPLAY '** STORE TOTAL RECORD MISSING FOR STR '                 
W26600              PV-DISPLAY-LOC                                              
               DISPLAY '** CHECK THE INPUT STORE TOTAL FILE  '                  
               DISPLAY '** 8005-CHECK-SLS-ADJ-PCT ROUTINE          **'          
               DISPLAY                                                          
                   '**---------------------------------------------**'          
      *        MOVE +4001 TO ABEND-CODE                                         
W26600*        PERFORM 9900-ABEND                                               
           END-IF.                                                              
                                                                                
           IF PT-TTL-RTL-AMT (PT-TTL-SLS-INDEX) = ZEROES                        
W26600         OR PT-TTL-RTL-AMT (PT-TTL-SLS-INDEX)                             
W26600             = PT-TTL-RETURN-RTL-AMT (PT-TTL-SLS-INDEX)                   
      *        DISPLAY '** ABEND - PROGRAM INKUT905                **'          
W26600         MOVE PT-TTL-SLS-INDEX TO PV-DISPLAY-LOC                          
W26600         DISPLAY '** NET RETAIL SALES IS $'                               
W26600                 PT-TTL-RTL-AMT (PT-TTL-SLS-INDEX)                        
W26600                 ' RETURN IS $'                                           
W26600                 PT-TTL-RETURN-RTL-AMT (PT-TTL-SLS-INDEX)                 
W26600                 ' FOR STORE '                                            
W26600              PV-DISPLAY-LOC                                              
               DISPLAY '** VERIFY THE STORE IS ON THE CORRECT'                  
                       ' POS AND/OR CUTOFF TIMESTAMPS FILES'                    
               DISPLAY '** 8005-CHECK-SLS-ADJ-PCT ROUTINE          **'          
W26600         DISPLAY ' CAND STR  ' PV-DISPLAY-LOC                             
                       ' STR TTL SLS DTE '                                      
                       PT-TTL-POS-DATE (PT-TTL-SLS-INDEX)                       
               DISPLAY                                                          
                   '**---------------------------------------------**'          
      *        MOVE +4001 TO ABEND-CODE                                         
W26600*        PERFORM 9900-ABEND                                               
           END-IF.                                                              
           COMPUTE PV-STR-SLS-ADJ-PCT =                                         
              (PV-STR-SLS-ADJ-RTL-AMT /                                         
W26600          (PT-TTL-RTL-AMT (PT-TTL-SLS-INDEX) -                            
W26600           PT-TTL-RETURN-RTL-AMT (PT-TTL-SLS-INDEX)) * 100)               
W26600         ON SIZE ERROR                                                    
W26600             MOVE 999.9 TO PV-STR-SLS-ADJ-PCT                             
W26600     END-COMPUTE.                                                         
           IF PV-STR-SLS-ADJ-PCT > CC-PERCENT-LIMIT                             
RONNA3* THIS PROGRAM WAS DESIGNED TO RUN DAILY AND CAN HAVE NO                  
RONNA3* ADJUSTMENTS HAPPEN                                                      
RONNA3*        OR PV-STR-SLS-ADJ-PCT = ZEROES                                   
               SET PS-STORE-TOLERANCE-ERROR TO TRUE                             
               ADD 1 TO PT-STR-ERR-COUNT                                        
               MOVE PV-IN018-PREV-CAND-STORE                                    
                   TO PT-ERR-STORE-NBR(PT-STR-ERR-COUNT)                        
               MOVE PV-STR-SLS-ADJ-PCT                                          
                   TO PT-ERR-SLS-ADJ-PCT(PT-STR-ERR-COUNT)                      
           END-IF.                                                              
                                                                                
      ****************************************************************          
      * 8010-WRITE-TOTAL-STORE-SALES RECORD                                     
      ****************************************************************          
JS0600 8010-WRITE-TOTAL-SALES-REC.                                              
                                                                                
           MOVE PV-IN018-PREV-CAND-STORE TO TTL-STR-NBR.                        
           MOVE FN-FILE-DATE            TO TTL-ACTL-INV-DTE.                    
                                                                                
           MOVE PV-STR-SLS-ADJ-TRAN-QTY TO TTL-SALES-ADJ-QTY.                   
           MOVE PV-STR-SLS-ADJ-RTL-AMT                                          
               TO TTL-SALES-ADJ-EXT-RTL-AMT.                                    
                                                                                
           MOVE PT-TTL-TRAN-QTY (PT-TTL-SLS-INDEX)                              
               TO TTL-TRAN-QTY.                                                 
           MOVE PT-TTL-RTL-AMT (PT-TTL-SLS-INDEX)                               
               TO TTL-RTL-AMT.                                                  
                                                                                
           MOVE PT-TTL-RETURN-QTY (PT-TTL-SLS-INDEX)                            
               TO TTL-RETURN-QTY.                                               
           MOVE PT-TTL-RETURN-RTL-AMT (PT-TTL-SLS-INDEX)                        
               TO TTL-RETURN-RTL-AMT.                                           
                                                                                
           MOVE PV-STR-SLS-ADJ-PCT      TO TTL-SALES-ADJ-PCT.                   
                                                                                
           WRITE SALES-ADJUST-REC FROM TTL-TIMESTMP-DETAIL.                     
                                                                                
           MOVE PV-STR-SLS-ADJ-TRAN-QTY                                         
               TO PV-STR-SLS-ADJ-TRAN-QTY-P.                                    
           MOVE PV-STR-SLS-ADJ-RTL-AMT                                          
               TO PV-STR-SLS-ADJ-RTL-AMT-P.                                     
           MOVE PT-TTL-TRAN-QTY (PT-TTL-SLS-INDEX)                              
               TO PV-STR-TRAN-QTY-P.                                            
           MOVE PT-TTL-RTL-AMT (PT-TTL-SLS-INDEX)                               
               TO PV-STR-RTL-SLS-P.                                             
           MOVE PT-TTL-RETURN-QTY (PT-TTL-SLS-INDEX)                            
               TO PV-STR-RETURN-QTY-P.                                          
           MOVE PT-TTL-RETURN-RTL-AMT (PT-TTL-SLS-INDEX)                        
               TO PV-STR-RETURN-RTL-AMT-P.                                      
           MOVE PV-STR-SLS-ADJ-PCT      TO PV-STR-SLS-ADJ-PCT-P.                
                                                                                
           DISPLAY ' '                                                          
           DISPLAY '**-----------------------------------------------'          
                   '-----------------------------------------------**'          
           DISPLAY '** STORE TOTAL RECORD: '                                    
W26600     MOVE TTL-STR-NBR TO PV-DISPLAY-LOC                                   
W26600*    DISPLAY '** STR: ' TTL-STR-NBR                                       
W26600     DISPLAY '** STR: ' PV-DISPLAY-LOC                                    
                   ' PCT: ' PV-STR-SLS-ADJ-PCT-P                                
                 '%     UNTS SLS: '        PV-STR-TRAN-QTY-P                    
                 ' SLS AMT:      $'        PV-STR-RTL-SLS-P                     
           DISPLAY '**                  '                                       
                 '    SLS ADJ UNTS: ' PV-STR-SLS-ADJ-TRAN-QTY-P                 
                 ' SLS ADJ AMT:  $'   PV-STR-SLS-ADJ-RTL-AMT-P.                 
W26600     DISPLAY '**                  '                                       
W26600           '    RETURN UNITS: ' PV-STR-RETURN-QTY-P                       
W26600           ' RETURN AMT:   $'   PV-STR-RETURN-RTL-AMT-P.                  
           DISPLAY '**-----------------------------------------------'          
                   '-----------------------------------------------**'          
           DISPLAY ' '                                                          
                                                                                
                                                                                
JS0600     MOVE ZERO TO PV-STR-SLS-ADJ-TRAN-QTY.                                
JS0600     MOVE ZERO TO PV-STR-SLS-ADJ-RTL-AMT.                                 
W33304     INITIALIZE TTL-INV-ID                                                
W33304                TTL-FINCL-INV-STAT-CDE.                                   
                                                                                
      *8010-EXIT.                                                               
           EJECT                                                                
      ****************************************************************          
      * 8050-WRITE-SALE-TIME-FILE.  WRITES ALL THE SALES OF AN ITEM  *          
      * AFTER IT HAS BEEN INVENTORIED.                               *          
      ****************************************************************          
       8050-WRITE-SALE-TIME-FILE.                                               
                                                                                
           MOVE IN019-STR-NBR        TO IN017-STR-NBR.                          
W21732     MOVE IN019-SKU            TO IN017-SKU.                              
           MOVE IN019-SCAN-DTE       TO IN017-SCAN-DTE.                         
           MOVE IN019-SCAN-TIMESTAMP TO IN017-SCAN-TIMESTAMP.                   
           MOVE IN016-TRAN-TIMESTAMP TO PV-HOUR-MIN.                            
           MOVE PV-HOLD-FIRST-TIME   TO PV-HOLD-TIME-POS.                       
           MOVE PV-HOLD-TIME-POS     TO IN017-SALE-TIMESTAMP.                   
           MOVE PV-POS-DATE          TO IN017-SALE-DTE.                         
           IF IN016-SALE                                                        
               COMPUTE IN017-SALES-QTY = IN016-TRAN-QTY * -1                    
           ELSE                                                                 
               IF IN016-RETURN                                                  
                   COMPUTE IN017-SALES-QTY = IN016-TRAN-QTY                     
               END-IF                                                           
           END-IF.                                                              
                                                                                
           IF IN016-SALE                                                        
               COMPUTE PV-TRAN-QTY = IN016-TRAN-QTY    + PV-TRAN-QTY            
           ELSE                                                                 
               IF IN016-RETURN                                                  
                   COMPUTE PV-TRAN-QTY =                                        
                       (IN016-TRAN-QTY * -1) + PV-TRAN-QTY                      
               END-IF                                                           
           END-IF.                                                              
                                                                                
           MOVE IN016-TRAN-TYPE TO IN017-TRAN-TYPE.                             
                                                                                
RB1002     MOVE IN016-SALE-RETURN-CDE TO IN017-SALE-RETURN-CDE.                 
                                                                                
            WRITE TRAN-TIMESTAMP-REC                                            
              FROM IN017-SALE-TIMESTAMPS.                                       
                                                                                
W33304******************************************************************        
W33304* WRITE THE ERROR OUTPUT IF THE ITEM-TIMESTAMP REC DOES NOT HAVE          
W33304* A STORE MATCH ON TINVPAR AND BYPASS EVERY REC ON THE ITEM               
W33304* TIMESTAMP FILE THAT HAS THAT STORE REC.                                 
W33304******************************************************************        
W33304 8100-BYPASS-ITM-TIMESTMP-RECS.                                      CL**2
W33304                                                                  INKUT115
W33304     INITIALIZE ITEM-TIMESTAMP-ERROR-REC.                         INKUT115
W33304                                                                  INKUT115
W33304     WRITE ITEM-TIMESTAMP-ERROR-REC                                  CL**2
W33304      FROM IN019-ITEM-REC.                                                
W33304                                                                  INKUT115
W33304     ADD +1 TO PA-TOT-ITM-RECS-WRIT                               INKUT115
W33304               PA-TOT-ITM-RECS-BYP.                                       
W33304                                                                  INKUT115
W33304     READ ITEM-TIMESTAMP-FILE INTO                                INKUT115
W33304          IN019-ITEM-REC                                          INKUT115
W33304     AT END                                                       INKUT115
W33304          SET PS-END-ITEM-TIMESTAMP TO TRUE                       INKUT115
W33304     END-READ.                                                    INKUT115
W33304                                                                  INKUT115
PE6906****************************************************************          
PE6906* 8150-WRITE-NOT-COUNTED-RETURN                                *          
PE6906*   - WRITES OUT ALL RETURNS POS RETURNS THAT DO NOT HAVE A    *          
PE6906*     CORRESPONDING PHYSICAL INVENTORY/COUNTED RECORD          *          
PE6906****************************************************************          
PE6906 8150-NOT-COUNTED-RETURN.                                                 
PE6906                                                                          
PE6906         MOVE IN016-STR-NBR        TO RET-STR-NBR                         
PE6906         MOVE IN016-DEPT-NBR       TO RET-DEPT-NBR                        
PE6906         MOVE IN016-CL-NBR         TO RET-CL-NBR                          
PE6906         MOVE IN016-SKU            TO RET-SKU                             
PE6906         MOVE IN016-TRAN-QTY       TO RET-SALES-ADJ-QTY                   
PE6906         MOVE PV-POS-DATE          TO RET-ACTL-INV-DTE                    
RONNA          MOVE IN016-TRAN-DTE       TO RET-IN016-TRAN-DTE                  
RONNA          MOVE IN016-TRAN-TIMESTAMP TO RET-IN016-TRAN-TIMESTAMP            
PE6906         MOVE INVPAR-ACTL-INV-DTE  TO IN400-PV-EFF-DTE-IN                 
PE6906         SET  IN400-PV-SKU-LOOKUP  TO TRUE                                
PE6906         MOVE RET-SKU              TO IN400-PV-SKU-IN-NUM                 
PE6906         MOVE RET-STR-NBR          TO IN400-PV-LOC-IN-NUM                 
PE6906****************************************************************          
PE6906* CALL INPD400 MODULE TO GET THE UNIT RETAIL PRICE FOR A SKU              
PE6906* IF UNIT RETAIL PRICE NOT FOUND FROM INPD400 MODULE USE RTL AMT          
PE6906* FROM POS FILE                                                           
PE6906****************************************************************          
PE6906     PERFORM IN400-LOOKUP-RETAIL                                          
PE6906      IF IN400-PV-ATT-FOUND                                       03970036
PE6906         IF IN016-SKU(6:3) = '999' OR '000'                               
PE6906            MOVE IN016-RTL-AMT                                            
PE6906                          TO RET-UNIT-PRICE                               
PE6906            COMPUTE RET-SALES-ADJ-EXT-RTL-AMT =                           
PE6906              (RET-UNIT-PRICE * RET-SALES-ADJ-QTY)                        
PE6906         ELSE                                                             
PE6906            MOVE IN400-PRC-UNIT-RTL-OUT TO RET-UNIT-PRICE                 
PE6906            MOVE ZERO                   TO RET-UNIT-PRICE                 
PE6906            COMPUTE RET-SALES-ADJ-EXT-RTL-AMT =                   04570036
PE6906                      RET-UNIT-PRICE * RET-SALES-ADJ-QTY          04570036
PE6906         END-IF                                                           
PE6906      ELSE                                                        04130036
PE6906         IF (IN400-PV-ATT-NOT-FOUND) OR                           04140036
PE6906                (IN016-SKU(6:3) = '999' OR '000')                         
PE6906            MOVE IN016-RTL-AMT                                            
PE6906                            TO RET-UNIT-PRICE                             
PE6906            COMPUTE RET-SALES-ADJ-EXT-RTL-AMT =                           
PE6906              (RET-UNIT-PRICE * RET-SALES-ADJ-QTY)                        
PE6906         END-IF                                                           
PE6906      END-IF                                                              
PE6906         MOVE PC-DEFAULT-SEVENS    TO RET-SCAN-AREA                       
PE6906         MOVE ZERO                 TO RET-SCAN-DTE                        
PE6906         MOVE ZERO                 TO RET-SCAN-TIMESTAMP                  
PE6906         MOVE ZERO                 TO RET-DKEY-NBR                        
PE6906         MOVE ZERO                 TO RET-INVLD-STKRMW                    
PE6906         MOVE ZERO                 TO RET-NEG-INV-ADJUST                  
PE6906         MOVE ZERO                 TO RET-FIRST-SLS-TIMESTAMP             
PE6906                                                                          
PE6906         COMPUTE  RET-UNITS-SLD-AFT-TIMESTAMP =                           
PE6906                                      (IN016-TRAN-QTY * -1)               
PE6906                                                                          
PE6906                                                                          
PE6906         MOVE IN016-STR-NBR        TO IN017-STR-NBR.                      
PE6906         MOVE IN016-SKU            TO IN017-SKU.                          
PE6906         MOVE ZEROS                TO IN017-SCAN-DTE.                     
PE6906         MOVE ZEROS                TO IN017-SCAN-TIMESTAMP.               
PE6906         MOVE IN016-TRAN-TIMESTAMP TO PV-HOUR-MIN.                        
PE6906         MOVE PV-HOLD-FIRST-TIME   TO PV-HOLD-TIME-POS.                   
PE6906         MOVE PV-HOLD-TIME-POS     TO IN017-SALE-TIMESTAMP.               
PE6906         MOVE PV-POS-DATE          TO IN017-SALE-DTE.                     
PE6906         COMPUTE IN017-SALES-QTY = IN016-TRAN-QTY.                        
PE6906         MOVE IN016-TRAN-TYPE TO IN017-TRAN-TYPE.                         
PE6906         MOVE IN016-SALE-RETURN-CDE TO IN017-SALE-RETURN-CDE.             
PE6906                                                                          
PE6906         WRITE TRAN-TIMESTAMP-REC FROM IN017-SALE-TIMESTAMPS.             
PE6906*                                                                         
      ******************************************************************        
      *  OPEN THE TADJDTL CURSOR.                                      *        
      ******************************************************************        
       8200-OPEN-TADJDTL-CURSOR.                                                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
W21732         MOVE PV-HOLD-SKU          TO ADJDTL-SKU-NBR                      
W21732         MOVE PV-STORE-NUMBER      TO ADJDTL-LOC-NBR                      
W21732         MOVE 'CO'                 TO ADJDTL-ADJ-TYPE-CDE                 
                                                                                
               EXEC SQL                                                         
                   OPEN TADJDTL_CURSOR                                          
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = +100                                          
                       CONTINUE                                                 
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '8200-OPEN-TADJDTL-CURSOR'                          
                                     TO  PV-PARAGRAPH-NAME                      
                       MOVE 'OPEN ON TADJDTL CURSOR'                            
                                     TO  PV-DB2-OPER-ATTEMPTED                  
                       PERFORM 9000-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                                
               MOVE '8200-OPEN-TADJDTL-CURSOR'                                  
                                     TO  PV-PARAGRAPH-NAME                      
               MOVE 'OPEN RETRIES EXCEEDED'                                     
                                     TO  PV-DB2-OPER-ATTEMPTED                  
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * GET THE ADJUSTED QUANTITY.                                     *        
      ******************************************************************        
       8250-FETCH-TADJDTL-ROW.                                                  
                                                                                
           EXEC SQL                                                             
               FETCH TADJDTL_CURSOR                                             
               INTO  :ADJDTL-ADJ-QTY                                            
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +100                                                    
               SET PS-NO-MORE-TADJDTL-ROWS        TO TRUE                       
           ELSE                                                                 
               IF SQLCODE NOT = 0                                               
                    MOVE '8250-FETCH-TADJDTL-ROW'                               
                                             TO PV-PARAGRAPH-NAME               
                    MOVE 'FETCH ROW FROM TADJDTL CURSOR'                        
                                            TO PV-DB2-OPER-ATTEMPTED            
                   PERFORM 9000-SQL-ABEND                                       
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * CLOSE THE TADJDTL CURSOR.                                      *        
      ******************************************************************        
       8275-CLOSE-TADJDTL-CURSOR.                                               
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
               EXEC SQL                                                         
                   CLOSE TADJDTL_CURSOR                                         
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = +100                                          
                       CONTINUE                                                 
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '8275-CLOSE-TADJDTL-CURSOR'                         
                                     TO  PV-PARAGRAPH-NAME                      
                       MOVE 'CLOSE ON TADJDTL CURSOR'                           
                                     TO  PV-DB2-OPER-ATTEMPTED                  
                       PERFORM 9000-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                                
               MOVE '8275-CLOSE-TADJDTL-CURSOR'                                 
                                     TO  PV-PARAGRAPH-NAME                      
               MOVE 'CLOSE RETRIES EXCEEDED'                                    
                                     TO  PV-DB2-OPER-ATTEMPTED                  
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * OPEN THE TSTKRMW CURSOR.                                       *        
      ******************************************************************        
       8300-OPEN-TSTKRMW-CURSOR.                                                
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
W21732*        MOVE PV-STORE-NUMBER TO STKRMW-STORE-NBR                         
W26600         MOVE PV-STORE-NUMBER TO STKRMW-LOC-NBR                           
W21732         MOVE PV-HOLD-SKU     TO STKRMW-SKU-NBR                           
                                                                                
               EXEC SQL                                                         
                   OPEN TSTKRMW_CURSOR                                          
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = +100                                          
                       CONTINUE                                                 
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '8300-OPEN-TSTKRMW-CURSOR'                          
                                     TO  PV-PARAGRAPH-NAME                      
                       MOVE 'OPEN ON TSTKRMW CURSOR'                            
                                     TO  PV-DB2-OPER-ATTEMPTED                  
                       PERFORM 9000-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                                
               MOVE '8300-OPEN-TSTKRMW-CURSOR'                                  
                                     TO  PV-PARAGRAPH-NAME                      
               MOVE 'OPEN RETRIES EXCEEDED'                                     
                                     TO  PV-DB2-OPER-ATTEMPTED                  
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * GET THE INVENTORY QUANTITY.                                    *        
      ******************************************************************        
       8350-FETCH-TSTKRMW-ROW.                                                  
                                                                                
           EXEC SQL                                                             
               FETCH TSTKRMW_CURSOR                                             
               INTO  :STKRMW-INV-QTY                                            
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +100                                                    
               SET PS-NO-MORE-TSTKRMW-ROWS        TO TRUE                       
           ELSE                                                                 
               IF SQLCODE NOT = 0                                               
                    MOVE '8350-FETCH-TSTKRMW-ROW'                               
                                             TO PV-PARAGRAPH-NAME               
                    MOVE 'FETCH ROW FROM TSTKRMW CURSOR'                        
                                            TO PV-DB2-OPER-ATTEMPTED            
                   PERFORM 9000-SQL-ABEND                                       
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      ******************************************************************        
      * CLOSE THE TSTKRMW CURSOR.                                      *        
      ******************************************************************        
       8375-CLOSE-TSTKRMW-CURSOR.                                               
                                                                                
           PERFORM                                                              
               WITH TEST AFTER                                                  
               VARYING PV-SQL-SUB                                               
               FROM 1 BY 1                                                      
               UNTIL (PV-SQL-SUB > PC-MAX-RETRIES                               
                         OR SQLCODE = 0                                         
                         OR SQLCODE = +100)                                     
                                                                                
               EXEC SQL                                                         
                   CLOSE TSTKRMW_CURSOR                                         
               END-EXEC                                                         
                                                                                
               EVALUATE TRUE                                                    
                   WHEN SQLCODE = -904                                          
                   WHEN SQLCODE = -911                                          
                   WHEN SQLCODE = 0                                             
                   WHEN SQLCODE = +100                                          
                       CONTINUE                                                 
                   WHEN SQLWARN NOT = SPACES                                    
                   WHEN SQLCODE NOT = ZERO                                      
                       MOVE '8375-CLOSE-TSTKRMW-CURSOR'                         
                                     TO  PV-PARAGRAPH-NAME                      
                       MOVE 'CLOSE ON TSTKRMW CURSOR'                           
                                     TO  PV-DB2-OPER-ATTEMPTED                  
                       PERFORM 9000-SQL-ABEND                                   
               END-EVALUATE                                                     
           END-PERFORM.                                                         
      *                                                                         
           IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                                
               MOVE '8375-CLOSE-TSTKRMW-CURSOR'                                 
                                     TO  PV-PARAGRAPH-NAME                      
               MOVE 'CLOSE RETRIES EXCEEDED'                                    
                                     TO  PV-DB2-OPER-ATTEMPTED                  
               PERFORM 9000-SQL-ABEND                                           
           END-IF.                                                              
      *                                                                         
W21732*****************************************************************         
W21732*                                                               *         
W21732* GET ITEM NUMBER FROM TSKXREF TABLE BY GIVING SKU.             *         
W21732*                                                               *         
W21732*****************************************************************         
W21732 8400-GET-ITM-NBR-FROM-TSKXREF.                                           
W21732*                                                                         
W21732     MOVE  ADJDTL-SKU-NBR TO  SKXREF-SKU.                                 
W21732                                                                          
W21732     EXEC SQL                                                             
W21732          SELECT ITM_NBR                                                  
W21732          INTO   :SKXREF-ITM-NBR                                          
W21732          FROM   TSKXREF                                                  
W21732          WHERE  SKU = :SKXREF-SKU                                        
W21732     END-EXEC.                                                            
W21732                                                                          
W21732     EVALUATE SQLCODE                                                     
W21732         WHEN +0                                                          
W21732              MOVE  SKXREF-ITM-NBR TO PV-ITEM-NBR                         
W21732         WHEN +100                                                        
W21732              PERFORM 8450-GET-ITM-NBR-FROM-TUPCSKU                       
W21732         WHEN OTHER                                                       
W21732              MOVE '8400-GET-ITM-NBR-FROM-TSKXREF'                        
W21732                               TO  PV-PARAGRAPH-NAME                      
W21732              MOVE 'SELECT ON TSKXREF TABLE'                              
W21732                               TO  PV-DB2-OPER-ATTEMPTED                  
W21732              DISPLAY 'INV KEY: ' PV-SUMINV-KEY                           
W21732                     '  TIMESTAMP KEY: ' PV-IN019-KEY                     
W21732                     '  POS KEY: ' IN016-POS-KEY                          
W21732                     '  ADJDTL: ' ADJDTL-SKU-NBR                          
W21732              PERFORM 9000-SQL-ABEND                                      
W21732                                                                          
W21732     END-EVALUATE.                                                        
W21732*                                                                         
W21732*****************************************************************         
W21732*                                                               *         
W21732* GET ITEM NUMBER FROM TUPCSKU TABLE.  IF DATA IS NOT FOUND,    *         
W21732* ABEND THE PROGRAM.                                            *         
W21732*                                                               *         
W21732*****************************************************************         
W21732 8450-GET-ITM-NBR-FROM-TUPCSKU.                                           
W21732*                                                                         
W21732     MOVE  ADJDTL-SKU-NBR   TO PV-UPC-SKU-MIN                             
W21732                               PV-UPC-SKU-MAX.                            
W21732                                                                          
W21732     MOVE  PV-SIGN-UPC-MIN  TO PV-UPCSKU-UPC-MIN.                         
W21732     MOVE  PV-SIGN-UPC-MAX  TO PV-UPCSKU-UPC-MAX.                         
W21732                                                                          
W21732     EXEC SQL                                                             
W21732          SELECT ITEM_NBR                                                 
W21732            INTO :TUPCSKU-ITEM-NBR                                        
W21732            FROM TUPCSKU                                                  
W21732           WHERE UPC_NBR BETWEEN                                          
W21732                 :PV-UPCSKU-UPC-MIN AND :PV-UPCSKU-UPC-MAX                
W21732     END-EXEC.                                                            
W21732                                                                          
W21732     EVALUATE SQLCODE                                                     
W21732         WHEN +0                                                          
W21732              MOVE TUPCSKU-ITEM-NBR TO PV-ITEM-NBR                        
R21732         WHEN +100                                                        
R21732              MOVE ZEROS            TO PV-ITEM-NBR                        
W21732         WHEN OTHER                                                       
W21732              MOVE '8450-GET-ITM-NBR-FROM-TUPCSKU'                        
W21732                               TO  PV-PARAGRAPH-NAME                      
W21732              MOVE 'SELECT ON TUPCSKU TABLE'                              
W21732                               TO  PV-DB2-OPER-ATTEMPTED                  
W21732              DISPLAY 'INV KEY: ' PV-SUMINV-KEY                           
W21732                     '  TIMESTAMP KEY: ' PV-IN019-KEY                     
W21732                     '  POS KEY: ' IN016-POS-KEY                          
W21732                     '  ADJDTL: ' ADJDTL-SKU-NBR                          
W21732              PERFORM 9000-SQL-ABEND                                      
W21732                                                                          
W21732     END-EVALUATE.                                                        
      *                                                                         
      ****************************************************************          
      *                                                              *          
      *    ALLOCATE THE REQUEST PDS MEMBER, AND OPEN THE MEMBER      *          
      *    FOR WRITTING.                                             *          
      *    THE FIRST RECORD OF THE PDS MEMBER IS A HEADER RECORD, SO *          
      *    THE DATA WAITING TO BE WRITTEN MUST BE HELD UNTIL THE     *          
      *    HEADER IS WRITTEN.  THEN IT IS MOVED BACK TO THE OUTPUT   *          
      *    RECORD.                                                   *          
      *                                                              *          
      ****************************************************************          
       8600-ALLOCATE-AND-OPEN-RQST.                                             
                                                                                
W26600     IF CC-DSN-HIGH-QUALIFIER = SPACES                                    
W26600         SET CC-DSN-BUILD-TYPE      TO TRUE                               
W26600     ELSE                                                                 
W26600         MOVE CC-DSN-HIGH-QUALIFIER TO FN-HIGH-LVL-QUALIFIER              
W26600         IF CC-DSN-REPLACE-TYPE                                           
W26600             CONTINUE                                                     
W26600         ELSE                                                             
W26600             SET CC-DSN-BUILD-TYPE      TO TRUE                           
W26600         END-IF                                                           
W26600     END-IF.                                                              
W26600                                                                          
W26600     IF CC-DSN-REPLACE-TYPE                                               
W26600         MOVE CC-TIMESTAMP-FILE-NAME  TO FN-DS-FILE-NAME                  
W26600     ELSE                                                                 
W26600         MOVE SPACES                  TO FN-DS-FILE-NAME                  
W26600         STRING FN-HIGH-LVL-QUALIFIER                                     
W26600                '.'                                                       
W26600                FN-TIMESTMP-QUALIFIER                                     
W26600             DELIMITED BY SPACE                                           
W26600                FN-FILE-DATE                                              
W26600             DELIMITED BY SIZE                                            
W26600             INTO FN-DS-FILE-NAME                                         
W26600             ON OVERFLOW                                                  
W26600                 MOVE SPACES          TO FN-DS-FILE-NAME                  
W26600         END-STRING                                                       
W26600         INSPECT FN-DS-FILE-NAME                                          
W26600             REPLACING ALL LOW-VALUES  BY SPACES                          
W26600                       ALL HIGH-VALUES BY SPACES                          
W26600     END-IF.                                                              
                                                                                
           IF FN-DS-FILE-NAME = SPACES                                          
               DISPLAY '**      INKUT905 ABEND      **'                         
               DISPLAY '** '  PC-ITEM-TIMESTAMP-DDNAME                          
                         ' DATASET NAME IS BLANK  **'                           
               SET ABEND-4003 TO TRUE                                           
               PERFORM 9900-ABEND                                               
           END-IF.                                                              
                                                                                
           INITIALIZE DP023-DYNALC-PARMS.                                       
           MOVE PC-ITEM-TIMESTAMP-DDNAME TO DP023-DDNAME.                       
           MOVE FN-DS-FILE-NAME TO DP023-DSNAME.                                
           SET DP023-DISP-SHARE TO TRUE.                                        
           SET DP023-FREE-CLOSE-YES TO TRUE.                                    
           SET DP023-RECFM-FIXED-BLOCK TO TRUE.                                 
           MOVE LENGTH OF ITEM-TIMESTAMP-REC TO DP023-RECSZ.                    
           MOVE 500000 TO DP023-RECOUNT.                                        
                                                                                
           DISPLAY ' ALLOCATING ' DP023-DDNAME                                  
                     ' TO ' DP023-DSNAME.                                       
                                                                                
           PERFORM DP023-0000-DYNALC.                                           
                                                                                
           OPEN INPUT ITEM-TIMESTAMP-FILE.                                      
W33304     OPEN OUTPUT ITEM-TIMESTAMP-ERROR-FILE.                               
                                                                                
W26600     IF CC-DSN-REPLACE-TYPE                                               
W26600         MOVE CC-POS-FILE-NAME    TO FN-DS-FILE-NAME                      
W26600     ELSE                                                                 
W26600         MOVE SPACES              TO FN-DS-FILE-NAME                      
W26600         STRING FN-HIGH-LVL-QUALIFIER                                     
W26600                '.'                                                       
W26600                FN-POS-QUALIFIER                                          
W26600             DELIMITED BY SPACE                                           
W26600                FN-FILE-DATE                                              
W26600             DELIMITED BY SIZE                                            
W26600             INTO FN-DS-FILE-NAME                                         
W26600             ON OVERFLOW                                                  
W26600                 MOVE SPACES      TO FN-DS-FILE-NAME                      
W26600         END-STRING                                                       
W26600         INSPECT FN-DS-FILE-NAME                                          
W26600             REPLACING ALL LOW-VALUES  BY SPACES                          
W26600                       ALL HIGH-VALUES BY SPACES                          
W26600     END-IF.                                                              
                                                                                
           IF FN-DS-FILE-NAME = SPACES                                          
               DISPLAY '**      INKUT905 ABEND      **'                         
               DISPLAY '** '  PC-POS-DDNAME                                     
                         ' DATASET NAME IS BLANK  **'                           
               SET ABEND-4003 TO TRUE                                           
               PERFORM 9900-ABEND                                               
           END-IF.                                                              
                                                                                
           INITIALIZE DP023-DYNALC-PARMS.                                       
           MOVE PC-POS-DDNAME TO DP023-DDNAME.                                  
           MOVE FN-DS-FILE-NAME TO DP023-DSNAME.                                
           SET DP023-DISP-SHARE TO TRUE.                                        
           SET DP023-FREE-CLOSE-YES TO TRUE.                                    
           SET DP023-RECFM-FIXED-BLOCK TO TRUE.                                 
           MOVE LENGTH OF POS-REC TO DP023-RECSZ.                               
           MOVE 500000 TO DP023-RECOUNT.                                        
                                                                                
           DISPLAY ' ALLOCATING ' DP023-DDNAME                                  
                     ' TO ' DP023-DSNAME.                                       
                                                                                
           PERFORM DP023-0000-DYNALC.                                           
                                                                                
           OPEN INPUT POS-FILE.                                                 
                                                                                
      ****************************************************************          
      *                                                              *          
      ****************************************************************          
JS0600 8800-WRITE-SORT-CARDS.                                                   
                                                                                
           IF PS-STORE-TOLERANCE-ERROR                                          
               MOVE CC-PERCENT-LIMIT TO EM-PERCENT                              
               WRITE EMAIL-MESSAGE-REC FROM EM-MESSAGE-TEXT1                    
                                                                                
               WRITE EMAIL-MESSAGE-REC FROM EM-MESSAGE-TEXT2                    
               WRITE EMAIL-MESSAGE-REC FROM EM-MESSAGE-TEXT3                    
               WRITE EMAIL-MESSAGE-REC FROM EM-MESSAGE-BLANK-LINE               
               DISPLAY 'THE FOLLOWING STORES HAD ERRORS:'                       
               PERFORM 8850-WRITE-STR-IN-SORT-CARDS                             
                   VARYING PT-STR-ERR-INDEX FROM 1 BY 1                         
                   UNTIL PT-STR-ERR-INDEX > PT-STR-ERR-COUNT                    
           ELSE                                                                 
               DISPLAY '**   NO STORE ERRORS FOUND   ***'                       
               DISPLAY ' '                                                      
               DISPLAY '**-------------------------------------'                
                       '--------------------'                                   
                       '-------------------------------------**'                
                                                                                
W26600         MOVE ZEROES             TO SC-STORE-NBR                          
W26600         SET SC-NO-MORE-STORE    TO TRUE                                  
                                                                                
W26600         SET SC-OMIT-COND            TO TRUE                              
W26600         WRITE SORT-OMIT-STORE-REC    FROM SC-INCLUDE-OMIT-CARD           
                                                                                
W26600         SET SC-INCLUDE-COND         TO TRUE                              
W26600         WRITE SORT-INCLUDE-STORE-REC FROM SC-INCLUDE-OMIT-CARD           
           END-IF.                                                              
                                                                                
           WRITE SORT-OMIT-STORE-REC    FROM SC-END-CARD.                       
           WRITE SORT-INCLUDE-STORE-REC FROM SC-END-CARD.                       
                                                                                
                                                                                
      ****************************************************************          
      *         .. SORT CARDS ARE WRITTEN                                       
      *         .. EMAIL MESSAGE IS WRITTEN IF AN INVALID                       
      *            STORES EXIST                                                 
      ****************************************************************          
JS0600 8850-WRITE-STR-IN-SORT-CARDS.                                            
                                                                                
           MOVE PT-ERR-STORE-NBR(PT-STR-ERR-INDEX) TO SC-STORE-NBR.             
           IF PT-STR-ERR-INDEX = PT-STR-ERR-COUNT                               
               SET SC-NO-MORE-STORE    TO TRUE                                  
           ELSE                                                                 
               SET SC-MORE-STORE       TO TRUE                                  
           END-IF.                                                              
                                                                                
           SET SC-NO-COND              TO TRUE                                  
           IF PT-STR-ERR-INDEX = 1                                              
               SET SC-OMIT-COND            TO TRUE                              
           END-IF.                                                              
           WRITE SORT-OMIT-STORE-REC    FROM SC-INCLUDE-OMIT-CARD.              
                                                                                
           IF PT-STR-ERR-INDEX = 1                                              
               SET SC-INCLUDE-COND         TO TRUE                              
           END-IF.                                                              
           WRITE SORT-INCLUDE-STORE-REC FROM SC-INCLUDE-OMIT-CARD.              
                                                                                
           MOVE PT-ERR-STORE-NBR(PT-STR-ERR-INDEX)                              
               TO EM-MESSAGE-STR.                                               
           MOVE PT-ERR-SLS-ADJ-PCT(PT-STR-ERR-INDEX)                            
               TO EM-STR-PCT.                                                   
           WRITE EMAIL-MESSAGE-REC   FROM EM-MESSAGE-DETAIL.                    
           DISPLAY EM-MESSAGE-DETAIL.                                           
                                                                                
      ****************************************************************          
      * 8900-CLOSE-FILES.                                                       
      *                                                              *          
      *    THIS ROUTINE CLOSES THE INPUT/OUTPUT FILES.               *          
      *                                                              *          
      ****************************************************************          
       8900-CLOSE-FILES.                                                        
                                                                                
           CLOSE SALES-ADJ-CAND-STORE-FILE                                      
W26600           REQUEST-CNTL-FILE                                              
JS0600           TSUMINV-PLAT-FILE                                              
                 SALES-ADJUST-FILE                                              
                 TRAN-TIMESTAMP-FILE                                            
JS0600           SORT-OMIT-STORE-FILE                                           
JS0600           SORT-INCLUDE-STORE-FILE                                        
JS0600           EMAIL-MESSAGE                                                  
JS0800           FASHION-ADJUSTMENTS.                                           
      *                                                                         
       EJECT                                                                    
      *                                                                         
      ****************************************************************          
      *                                                              *          
      *    THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.        *          
      *                                                              *          
      ****************************************************************          
       9000-SQL-ABEND.                                                          
      *                                                                         
           SET ABEND-4013             TO TRUE.                                  
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  INKUT905'.                             
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.                
      *                                                                         
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
      *                                                                         
           COPY DPPD004.                                                        
                                                                                
W26600     PERFORM 9900-ABEND.                                                  
                                                                                
W26600 9900-ABEND.                                                              
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
                                                                                
      *                                                                         
      *  DYNAMIC ALLOCATION ROUTINE                                             
      *                                                                         
           COPY DPPD023.                                                        
PE6906******************************************************************        
PE6906*  PRICING MODULE.                                                        
PE6906******************************************************************        
PE6906     COPY INPD400.                                                        
