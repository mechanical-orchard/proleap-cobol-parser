000100 IDENTIFICATION DIVISION.                                         00010017
000200 PROGRAM-ID.     APKUT408.                                        00020017
000300 AUTHOR.         JILL JUEL.                                       00030017
000400 DATE-WRITTEN.   JUNE 19, 2000.                                   00040017
000500 DATE-COMPILED.                                                   00050017
000600*************************************************************     00060017
000700*    COBOL 2                                                *     00070017
000800*                                                           *     00080017
000900*    THIS PROGRAM BUMPS THE PO DETAIL FILE WITH THE         *     00090017
001000*    PO FILE TO CREATE THE INVOICE DETAIL.                  *     00100017
001100*                                                           *     00110017
001200* INPUT:                                                    *     00120017
001300* 1.  PO FILE                                               *     00130017
001400* 2.  PO DETAIL FILE                                        *     00140017
001500*                                                           *     00150017
001600* OUTPUT:                                                   *     00160017
001700* 1.  EDI INVOICE DETAIL FILE                               *     00170017
001800*                                                           *     00180017
001900*************************************************************     00190017
002000* CHANGE LOG:                                               *     00200017
002100*                                                           *     00210017
002200* 06/19/2000  INITIAL VERSION.                              *     00220017
002300* 10/03/2000  JILL JUEL                     WR# 20741       *     00230017
002400*             REMOVED THE READ OF THE PO FILE WHEN THE      *     00240017
002500*             PAYT-REQ-SEQ-NBR ARE EQUAL BECAUSE THERE      *     00250017
002600*             MAY BE MORE THAN ONE DETAIL RECORD FOR        *     00260017
002700*             EACH PO RECORD.                               *     00270017
002800*                                                           *     00280017
002900* 06/17/2002                                                *     00290017
003000*    ARK PO PROJECT PHASE 1.  RECOMPILE FROM PRODUCTION.    *     00300017
003100* MADE BY: KEVIN CATLIN                    WR# 23500        *     00310017
003200*                                                           *     00320017
003300*  DATE  05/02/2003                                         *     00330017
003400*      CHANGE MADE: CHANGE NEEDED FOR ARK PO NI-SKU.        *     00340017
003500*      REMOVED DEPT-NBR, CL-CDE, AND SKU-SEQ-NBR FROM       *     00350017
003600*      APRD408 COPYBOOK AND THIS PROGRAM.                   *     00360017
003700*      MADE BY: ROLLIN KRING            WR/IR #: WR22557    *     00370017
003701*                                                           *     00370118
003710* 08/07/2006                                                *     00371022
003722*    COPYBOOK APRD410 HAS BEEN MOTIFIED TO HAVE THE # OF    *     00372219
003723*    ALLOWANCE CHARGES INCREASED FROM 5 TO 12 OCCURANCES    *     00372320
003724*    WHICH INCREASED THE SIZE OF THE INPUT-PO-FILE FROM     *     00372419
003725*    347 TO 522.                                            *     00372520
003730*    MADE BY: MICHELE RINDFLEISCH       WR# 31102           *     00373019
003800*************************************************************     00380017
003900                                                                  00390017
004000 ENVIRONMENT DIVISION.                                            00400017
004100                                                                  00410017
004200 INPUT-OUTPUT SECTION.                                            00420017
004300                                                                  00430017
004400 FILE-CONTROL.                                                    00440017
004500                                                                  00450017
004600     SELECT INPUT-PO-FILE                                         00460017
004700         ASSIGN TO UT-S-INP01.                                    00470017
004800                                                                  00480017
004900     SELECT PO-DETAIL-FILE                                        00490017
005000         ASSIGN TO UT-S-INP02.                                    00500017
005100                                                                  00510017
005200     SELECT INVOICE-DETAIL-FILE                                   00520017
005300         ASSIGN TO UT-S-OUT01.                                    00530017
005400                                                                  00540017
005500 DATA DIVISION.                                                   00550017
005600                                                                  00560017
005700 FILE SECTION.                                                    00570017
005800                                                                  00580017
005900 FD  INPUT-PO-FILE                                                00590017
006000     LABEL RECORDS  ARE STANDARD                                  00600017
006100     RECORDING MODE IS  F                                         00610017
006200     RECORD CONTAINS 522 CHARACTERS                               00620021
006300     BLOCK CONTAINS 0 RECORDS.                                    00630017
006400 01  INPUT-PO-RECORD               PIC X(522).                    00640021
006500                                                                  00650017
006600 FD  PO-DETAIL-FILE                                               00660017
006700     LABEL RECORDS  ARE STANDARD                                  00670017
006800     RECORDING MODE IS  F                                         00680017
006900     RECORD CONTAINS 161 CHARACTERS                               00690017
007000     BLOCK CONTAINS 0 RECORDS.                                    00700017
007100 01  PO-DETAIL-RECORD              PIC X(161).                    00710017
007200                                                                  00720017
007300 FD  INVOICE-DETAIL-FILE                                          00730017
007400     LABEL RECORDS  ARE STANDARD                                  00740017
007500     RECORDING MODE IS  F                                         00750017
007600     RECORD CONTAINS 220 CHARACTERS                               00760017
007700     BLOCK CONTAINS 0 RECORDS.                                    00770017
007800 01  INVOICE-DETAIL-RECORD         PIC X(220).                    00780017
007900                                                                  00790017
008000***************************                                       00800017
008100 WORKING-STORAGE SECTION.                                         00810017
008200***************************                                       00820017
008300 01  WS-SWITCH-AREA.                                              00830017
008400     05  WS-PO-EOF-SW                 PIC X(01)  VALUE 'N'.       00840017
008500         88  PO-EOF                              VALUE 'Y'.       00850017
008600         88  NOT-PO-EOF                          VALUE 'N'.       00860017
008700     05  WS-PO-DETAIL-EOF-SW          PIC X(01)  VALUE 'N'.       00870017
008800         88  PO-DETAIL-EOF                       VALUE 'Y'.       00880017
008900         88  NOT-PO-DETAIL-EOF                   VALUE 'N'.       00890017
009000                                                                  00900017
009100 01  WS-PROGRAM-COUNTERS.                                         00910017
009200     05  PO-COUNT                     PIC  9(11) VALUE ZEROS.     00920017
009300     05  PO-DETAIL-COUNT              PIC  9(11) VALUE ZEROS.     00930017
009400     05  INVOICE-DETAIL-COUNT         PIC  9(11) VALUE ZEROS.     00940017
009500     05  SKIP-REC-COUNT               PIC  9(11) VALUE ZEROS.     00950017
009600                                                                  00960017
009700******************************************************************00970017
009800**  THIS IS THE LAYOUT FOR THE PO DETAIL FILE                   **00980017
009900***************************************************************** 00990017
010000     COPY APRD407.                                                01000017
010100                                                                  01010017
010200***************************************************************** 01020017
010300**  THIS IS THE LAYOUT FOR THE INVOICE DETAIL FILE.            ** 01030017
010400***************************************************************** 01040017
010500     COPY APRD408.                                                01050017
010600                                                                  01060017
010700***************************************************************** 01070017
010800** INVOICE EXTRACT FILE LAYOUT FOR YEARLY CONTINGENCY AUDIT.   ** 01080017
010900***************************************************************** 01090017
011000     COPY APRD410.                                                01100017
011100                                                                  01110017
011200***************************************************************** 01120017
011300** DPWS004 CONTAINS THE FIELDS NECESSARY TO CALL THE SQLCA     ** 01130017
011400** MESSAGE MODULE 'DSNTIAR' AND DISPLAY THE FORMATTED RESULTS. ** 01140017
011500***************************************************************** 01150017
011600*    COPY DPWS004.                                                01160017
011700                                                                  01170017
011800 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01180017
011900                                             VALUE ZEROS.         01190017
012000                                                                  01200017
012100 01  WS-RETRY-COUNT                PIC S9(4) COMP VALUE ZERO.     01210017
012200 01  WS-RETRY-MAX                  PIC S9(4) COMP VALUE 3.        01220017
012300                                                                  01230017
012400 01  WS-ABEND-FIELDS.                                             01240017
012500     05  AA-ABEND-LIT            PIC  X(40)     VALUE             01250017
012600             '*****       ABEND'.                                 01260017
012700     05  AA-PROGRAM-LIT          PIC  X(40)     VALUE             01270017
012800             '*****   PROGRAM: APKUT408'.                         01280017
012900     05  AA-PARAGRAPH-LIT.                                        01290017
013000         10  FILLER              PIC  X(17)     VALUE             01300017
013100             '***** PARAGRAPH: '.                                 01310017
013200         10  AA-PARAGRAPH-NAME   PIC  X(35)     VALUE SPACES.     01320017
013300     05  AA-MESSAGE-LINE.                                         01330017
013400         10  FILLER              PIC  X(06)     VALUE '*****'.    01340017
013500         10  AA-MESSAGE          PIC  X(80)     VALUE SPACES.     01350017
013600                                                                  01360017
013700**********************                                            01370017
013800 PROCEDURE DIVISION.                                              01380017
013900**********************                                            01390017
014000                                                                  01400017
014100     PERFORM B100-INITIALIZATION.                                 01410017
014200                                                                  01420017
014300     PERFORM B200-CREATE-INVOICE-DETAIL                           01430017
014400       UNTIL PO-EOF OR                                            01440017
014500             PO-DETAIL-EOF.                                       01450017
014600                                                                  01460017
014700     PERFORM B300-TERMINATION.                                    01470017
014800                                                                  01480017
014900     GOBACK.                                                      01490017
015000                                                                  01500017
015100*************************************************************     01510017
015200*  INITIALIZATION ROUTINE                                   *     01520017
015300*************************************************************     01530017
015400 B100-INITIALIZATION.                                             01540017
015500                                                                  01550017
015600     DISPLAY ' '.                                                 01560017
015700     DISPLAY '*---------- PROGRAM:  APKUT408 ----------*'         01570017
015800     DISPLAY 'SYSTEM DATE ' FUNCTION CURRENT-DATE(1:8)            01580017
015900                  '  TIME ' FUNCTION CURRENT-DATE(9:6).           01590017
016000                                                                  01600017
016100     OPEN INPUT INPUT-PO-FILE                                     01610017
016200                PO-DETAIL-FILE                                    01620017
016300         OUTPUT INVOICE-DETAIL-FILE.                              01630017
016400                                                                  01640017
016500     PERFORM R100-READ-PO-FILE.                                   01650017
016600     PERFORM R200-READ-PO-DETAIL.                                 01660017
016700                                                                  01670017
016800     IF  PO-EOF                                                   01680017
016900         MOVE 'B100-INITIALIZATION'       TO AA-PARAGRAPH-NAME    01690017
017000         MOVE 'EMPTY PO FILE '            TO AA-MESSAGE           01700017
017100         PERFORM Z998-ABEND                                       01710017
017200     END-IF.                                                      01720017
017300                                                                  01730017
017400     IF  PO-DETAIL-EOF                                            01740017
017500         MOVE 'B100-INITIALIZATION'       TO AA-PARAGRAPH-NAME    01750017
017600         MOVE 'EMPTY PO DETAIL FILE'      TO AA-MESSAGE           01760017
017700         PERFORM Z998-ABEND                                       01770017
017800     END-IF.                                                      01780017
017900                                                                  01790017
018000 EJECT                                                            01800017
018100                                                                  01810017
018200*************************************************************     01820017
018300*  MAIN PROCESSING FOR CREATING INVOICE DETAIL FILE         *     01830017
018400*************************************************************     01840017
018500 B200-CREATE-INVOICE-DETAIL.                                      01850017
018600                                                                  01860017
018700     IF AP410-PAYT-REQ-SEQ-NBR = AP407-PAYT-REQ-SEQ-NBR           01870017
018800        MOVE AP410-INVC-ID           TO AP408-INVC-ID             01880017
018900        MOVE AP407-PAYT-REQ-SEQ-NBR  TO AP408-PAYT-REQ-SEQ-NBR    01890017
019000        MOVE AP407-PAYT-REQ-LNE-NBR  TO AP408-PAYT-REQ-LNE-NBR    01900017
019100        MOVE AP407-PO-NBR            TO AP408-PO-NBR              01910017
019200        MOVE AP407-VER-NBR           TO AP408-VER-NBR             01920017
019300        MOVE AP407-PO-LNE-NBR        TO AP408-PO-LNE-NBR          01930017
019400        MOVE AP407-PAY-REQ-LNE-QTY   TO AP408-PAY-REQ-LNE-QTY     01940017
019500        MOVE AP407-QTY-UNT-OF-MSMT   TO AP408-QTY-UNT-OF-MSMT     01950017
019600        MOVE AP407-UNT-COST-AMT      TO AP408-UNT-COST-AMT        01960017
019700        MOVE AP407-UPC-EAN-QUAL-CDE  TO AP408-UPC-EAN-QUAL-CDE    01970017
019800        MOVE AP407-UPC-EAN-CDE       TO AP408-UPC-EAN-CDE         01980017
019900        MOVE AP407-VEND-STYL-CDE     TO AP408-VEND-STYL-CDE       01990017
020000        MOVE AP407-COLOR-CDE         TO AP408-COLOR-CDE           02000017
020100        MOVE AP407-COLOR-DESC        TO AP408-COLOR-DESC          02010017
020200        MOVE AP407-SIZE-CDE          TO AP408-SIZE-CDE            02020017
020300        MOVE AP407-SIZE-DESC         TO AP408-SIZE-DESC           02030017
020400        MOVE AP407-SKU-DESC          TO AP408-SKU-DESC            02040017
020500        PERFORM W100-WRITE-INVOICE-DETAIL                         02050017
020600*       PERFORM R100-READ-PO-FILE                                 02060017
020700        PERFORM R200-READ-PO-DETAIL                               02070017
020800     ELSE                                                         02080017
020900        IF AP410-PAYT-REQ-SEQ-NBR > AP407-PAYT-REQ-SEQ-NBR        02090017
021000           ADD 1 TO SKIP-REC-COUNT                                02100017
021100           PERFORM R200-READ-PO-DETAIL                            02110017
021200        ELSE                                                      02120017
021300           ADD 1 TO SKIP-REC-COUNT                                02130017
021400           PERFORM R100-READ-PO-FILE                              02140017
021500        END-IF                                                    02150017
021600     END-IF.                                                      02160017
021700                                                                  02170017
021800 EJECT                                                            02180017
021900                                                                  02190017
022000*************************************************************     02200017
022100*  TERMINATION ROUTINE                                      *     02210017
022200*************************************************************     02220017
022300 B300-TERMINATION.                                                02230017
022400     CLOSE INPUT-PO-FILE                                          02240017
022500           PO-DETAIL-FILE                                         02250017
022600           INVOICE-DETAIL-FILE.                                   02260017
022700                                                                  02270017
022800     DISPLAY '*****************************************'.         02280017
022900     DISPLAY '**        TOTALS FOR APKUT408          **'.         02290017
023000     DISPLAY '*****************************************'.         02300017
023100     DISPLAY 'TOTAL PO FILE READ    = ' PO-COUNT.                 02310017
023200     DISPLAY 'TOTAL PO DETAIL READ  = ' PO-DETAIL-COUNT.          02320017
023300     DISPLAY 'TOTAL RECORDS WRITTEN = ' INVOICE-DETAIL-COUNT.     02330017
023400     DISPLAY 'SKIPPED RECORDS       = ' SKIP-REC-COUNT.           02340017
023500     DISPLAY '*****************************************'.         02350017
023600                                                                  02360017
023700*************************************************************     02370017
023800*  READ MERGE FILE                                          *     02380017
023900*************************************************************     02390017
024000 R100-READ-PO-FILE.                                               02400017
024100                                                                  02410017
024200     READ INPUT-PO-FILE INTO AP410-INVOICE-EXTRACT-RECORD         02420017
024300       AT END                                                     02430017
024400          SET PO-EOF TO TRUE                                      02440017
024500          MOVE +999999999 TO AP410-PAYT-REQ-SEQ-NBR               02450017
024600       NOT AT END                                                 02460017
024700          ADD 1 TO PO-COUNT                                       02470017
024800     END-READ.                                                    02480017
024900                                                                  02490017
025000*************************************************************     02500017
025100*  READ TPREQIT FILE                                        *     02510017
025200*************************************************************     02520017
025300 R200-READ-PO-DETAIL.                                             02530017
025400                                                                  02540017
025500     READ PO-DETAIL-FILE INTO AP407-PO-DETAIL-RECORD              02550017
025600       AT END                                                     02560017
025700          SET PO-DETAIL-EOF TO TRUE                               02570017
025800          MOVE +999999999 TO AP407-PAYT-REQ-SEQ-NBR               02580017
025900       NOT AT END                                                 02590017
026000          ADD 1 TO PO-DETAIL-COUNT                                02600017
026100     END-READ.                                                    02610017
026200                                                                  02620017
026300*************************************************************     02630017
026400*  WRITE INVOICE DETAIL FILE                                *     02640017
026500*************************************************************     02650017
026600 W100-WRITE-INVOICE-DETAIL.                                       02660017
026700                                                                  02670017
026800     WRITE INVOICE-DETAIL-RECORD                                  02680017
026900           FROM AP408-INVOICE-DETAIL-RECORD.                      02690017
027000     ADD 1 TO INVOICE-DETAIL-COUNT.                               02700017
027100                                                                  02710017
027200*************************************************************     02720017
027300*    ABEND ROUTINE FOR NON DB2 ERRORS                       *     02730017
027400*************************************************************     02740017
027500 Z998-ABEND.                                                      02750017
027600                                                                  02760017
027700     DISPLAY ' '.                                                 02770017
027800     DISPLAY AA-ABEND-LIT.                                        02780017
027900     DISPLAY AA-PROGRAM-LIT.                                      02790017
028000     DISPLAY AA-PARAGRAPH-LIT.                                    02800017
028100     DISPLAY AA-MESSAGE.                                          02810017
028200                                                                  02820017
028300     CALL 'ILBOABN0' USING ABEND-CODE.                            02830017
028400                                                                  02840017
028500                                                                  02850017
