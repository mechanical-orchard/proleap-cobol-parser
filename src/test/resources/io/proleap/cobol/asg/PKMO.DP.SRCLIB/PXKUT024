000100 IDENTIFICATION DIVISION.                                         00010000
000110******************************************************************00020099
000120 PROGRAM-ID.    PXKUT024.                                         00030099
000130 AUTHOR.        JOYCE KNOKE.                                      00040099
000140 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050099
000150 DATE-WRITTEN.  NOVEMBER 2006.                                    00060099
000160 DATE-COMPILED.                                                   00070099
000170******************************************************************00080099
000180* THIS PROGRAM READS IN THE OUTPUT FROM PXKUT023 AND DETERMINES   00090099
000190* THE FIRST MARKDOWN DATES FOR EACH EVENT ID AND CREATES AN       00100099
000200* OUTPUT FILE OF EACH EVENT, THE EFFECTIVE DATE AND THE MOS EVENT 00110099
000300* DATE.                                                           00120099
000400*                                                                 00130099
000500* ORACLE TABLE:                                                   00140099
000600* PET_CLR_MKDN_EVNT.                                              00150099
002400******************************************************************00160000
002500 ENVIRONMENT DIVISION.                                            00170000
002600******************************************************************00180099
002601                                                                  00190099
002602 CONFIGURATION SECTION.                                           00200000
002603                                                                  00210099
002604 INPUT-OUTPUT SECTION.                                            00220099
002605                                                                  00230099
002606 FILE-CONTROL.                                                    00240099
002607                                                                  00250099
002608     SELECT IN-EVENT-FILE                                         00260099
002609         ASSIGN TO INP01.                                         00270099
002610                                                                  00280099
CHG016     SELECT ORACLE-LOGON-FILE                                     00290099
CHG016         ASSIGN TO ORALOGON.                                      00300099
002640                                                                  00310099
002650     SELECT OUT-EVENT-FILE                                        00320099
002660         ASSIGN TO OUT01.                                         00330099
002661                                                                  00340099
002662******************************************************************00350000
002663 DATA DIVISION.                                                   00360099
002664******************************************************************00370000
002665 FILE SECTION.                                                    00380099
002666                                                                  00390099
002667 FD  IN-EVENT-FILE                                                00400099
002668     RECORDING MODE F                                             00410099
002669     LABEL RECORDS ARE STANDARD                                   00420099
002670     BLOCK CONTAINS 0 RECORDS.                                    00430099
002680 01  IN-EVENT-RECORD                     PIC  X(16).              00440099
002690                                                                  00450099
CHG016 FD  ORACLE-LOGON-FILE                                            00460099
CHG016     RECORDING MODE IS F                                          00470099
CHG016     LABEL RECORDS ARE STANDARD                                   00480099
CHG016     BLOCK CONTAINS 0 RECORDS                                     00490099
CHG016     RECORD CONTAINS 80 CHARACTERS                                00500099
CHG016     DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00510099
CHG016 01  OL-ORACLE-LOGON-RECORD              PIC X(80).               00512099
003300                                                                  00520099
003300 FD  OUT-EVENT-FILE                                               00521099
003400     RECORDING MODE F                                             00530099
003500     LABEL RECORDS ARE STANDARD                                   00540099
003600     BLOCK CONTAINS 0 RECORDS.                                    00550099
003700 01  OUT-EVENT-RECORD                    PIC  X(20).              00560099
003800                                                                  00570099
003900****************************************************************  00580099
004000 WORKING-STORAGE SECTION.                                         00590099
004100****************************************************************  00600099
004200 01  FILLER                            PIC X(50)  VALUE           00610099
004300     ' *** WORKING STORAGE STARTS HERE FOR PXKUT024 *** '.        00620099
004400                                                                  00630099
004500******************************************************************00640099
004900*      ORACLE CONNECTION VARIABLES                                00680099
005000******************************************************************00690099
005100 01  CC-ORACLE-CONNECTION.                                        00700099
CHG016     05  CC-ORACLE-USERID             PIC X(40).                  00710099
CHG016         88 CC-AUTO-LOGON                            VALUE '/'.   00720099
CHG016     05  CC-ORACLE-PASSWORD           PIC X(40).                  00730099
006000                                                                  00790099
006100****************************************************************  00800099
006200**DATE FIELDS                                                     00810099
006300****************************************************************  00820099
006400 01  DF-WORK-DATE    PIC X(19).                                   00830099
006500 01  DF-WORK-DATE-R   REDEFINES   DF-WORK-DATE.                   00840099
006600     05  DF-DATE-1-10                 PIC X(10).                  00850099
006601     05  FILLER                       PIC X(09).                  00860099
006602                                                                  00870000
006603****************************************************************  00880099
006604**PROGRAM ACCUMULATORS                                            00890099
006605****************************************************************  00900099
006606 01  PA-PROGRAM-ACCUMULATORS.                                     00910099
006607     05  PA-TOT-EVNT-REC-READS        PIC 9(09) VALUE ZEROS.      00920099
006608     05  PA-TOT-OUTPUT-WRITTEN        PIC 9(09) VALUE ZEROS.      00930099
006609                                                                  00940099
006610****************************************************************  00950099
006620**PROGRAM VARIABLES.                                              00960099
006630****************************************************************  00970099
006640 01  PV-PROGRAM-VARIABLES.                                        00980099
006650     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00990099
006660     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     01000099
006670     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     01010099
006680     05  PV-OPERATION-MSG             PIC  X(30) VALUE SPACE.     01020099
006681     05  PV-NBR-OF-MRDWN-DAYS         PIC  9(03) VALUE ZERO.      01021099
CHG016     05  PV-ORACLE-USERID-LEN         PIC S9(4)  VALUE ZEROS      01022099
CHG016                                                 COMP SYNC.       01023099
CHG016     05  PV-ORACLE-PASSWORD-LEN       PIC S9(4)  VALUE ZEROS      01024099
CHG016                                                 COMP SYNC.       01025099
006690                                                                  01030099
006700****************************************************************  01040099
006800**PROGRAM SWITCHES.                                               01050099
006801****************************************************************  01060099
006802 01  PS-PROGRAM-SWITCHES.                                         01070000
006803     05  PS-END-OF-FILE-SW            PIC  X(01) VALUE 'N'.       01080000
006804         88 PS-END-OF-FILE-N                     VALUE 'N'.       01090000
006805         88 PS-END-OF-FILE-Y                     VALUE 'Y'.       01100000
006806     05  PS-END-OF-CSR-SW             PIC  X(01) VALUE 'N'.       01110000
006807         88 PS-END-OF-CSR-N                      VALUE 'N'.       01120000
006808         88 PS-END-OF-CSR-Y                      VALUE 'Y'.       01130000
006809     05  PS-END-OF-LOGON-FILE-SW      PIC  X(01) VALUE 'N'.       01140099
006810         88 PS-END-OF-LOGON-FILE                 VALUE 'Y'.       01150099
CHG016     05  PS-ORA-SRC-CTL-DONE-SW       PIC  X(01) VALUE 'N'.       01153099
CHG016         88  PS-ORA-SRC-EMPTY                    VALUE 'Y'.       01154099
006820                                                                  01160000
006830****************************************************************  01170099
006840**PROGRAM CONSTANTS.                                              01180099
006841****************************************************************  01190099
006842 01  PC-PROGRAM-CONSTANTS.                                        01200000
006843     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PXKUT024'.01210000
006844     05 PC-CALENDAR-MODULE      PIC X(8)        VALUE 'DPKUT500'. 01211099
CHG016     05  PC-AUTO-LOGON                PIC X(1)      VALUE '/'.    01212099
006845                                                                  01220000
006846****************************************************************  01230099
006847**ABEND INFORMATION                                               01240099
006848****************************************************************  01250099
006849 01  AC-ABEND-CODE                    PIC S9(04) VALUE ZERO       01260099
006850                                                 COMP SYNC.       01270099
006851     88  AC-NO-CONTROL-CARD                      VALUE +4002.     01280099
006860     88  AC-INVALID-CONTROL-CARD                 VALUE +4003.     01290099
006870     88  AC-ORACLE-BAD-LOGON-4004                VALUE +4004.     01300099
006880     88  AC-DB2-ERROR                            VALUE +4013.     01310099
006890                                                                  01320099
006900************************************************************      01330099
007000* MOS EVENTS FIRST MARKDOWN                                       01340099
007100************************************************************      01350099
007200     COPY PXRD030.                                                01360099
007300                                                                  01370099
007400************************************************************      01380099
007500* MOS EVENT EXTRACT                                               01390099
007600************************************************************      01400099
007700     COPY PXRD029.                                                01410099
007800                                                                  01420099
010600***************************************************************** 01430000
010900*  ABEND ROUTINE INFORMATION                                      01440000
010910***************************************************************** 01450099
011000     COPY DPWS900.                                                01460000
011001                                                                  01470099
011002***************************************************************** 01480000
011100*  ABEND ROUTINE INFORMATION                                      01490000
011110***************************************************************** 01500099
011200     COPY DPWS004.                                                01510000
011201                                                                  01520099
011202******************************************************************01530000
011203*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01540000
011204******************************************************************01550000
011205     COPY DPWS500.                                                01560000
011206                                                                  01570000
011207****************************************************************  01580099
011208**ORACLE DECLARE SECTION                                          01590099
011209****************************************************************  01600099
011210     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01610099
011220 01  USERNAME                         PIC X(10)  VARYING.         01620099
011230 01  PASSWD                           PIC X(10)  VARYING.         01630099
011240 01  PV-ORACLE-ID                     PIC X(01)  VALUE '/'.       01640099
011250                                                                  01650099
012200****************************************************************  01660000
012300**ORACLE TABLE INCLUSIONS                                         01670000
012400****************************************************************  01680000
012500***TABLE PET_CLR_MKDN_EVNT                                        01690099
012600     EXEC SQL                                                     01700099
012700          INCLUDE PET00001                                        01710099
012800     END-EXEC.                                                    01720099
012900                                                                  01730099
014500     EXEC SQL END DECLARE SECTION END-EXEC.                       01740000
014600     EXEC SQL INCLUDE SQLCACOB END-EXEC.                          01750000
014700                                                                  01760000
014710****************************************************************  01770099
014800 PROCEDURE DIVISION.                                              01780000
014900******************************************************************01790000
015000 0000-MAINLINE.                                                   01800000
015100                                                                  01810000
015200     PERFORM 1000-HOUSEKEEPING.                                   01820000
015300                                                                  01830099
015400     PERFORM 2000-PROCESS-INPUT-FILE                              01840099
261400         UNTIL PS-END-OF-FILE-Y.                                  01850000
261401                                                                  01860099
261402     PERFORM 9000-END-OF-JOB.                                     01870000
261403                                                                  01880000
261404     STOP RUN.                                                    01890000
261405                                                                  01900000
261406****************************************************************  01910000
261407*     OPEN FILES, READ IN AND VALIDATE CONTROL DATE.              01920000
261408****************************************************************  01930000
261409 1000-HOUSEKEEPING.                                               01940000
261410     OPEN INPUT  ORACLE-LOGON-FILE                                01950099
CHG016                                                                  01970199
CHG016     DISPLAY 'ORACLE FILE READ'.                                  01971099
CHG016     PERFORM 8000-READ-ORACLE-LOGON.                              01972099
CHG016                                                                  01973099
CHG016     DISPLAY 'ORACLE FILE CLOSE'.                                 01974099
CHG016     CLOSE ORACLE-LOGON-FILE.                                     01975099
CHG016                                                                  01975199
CHG016     IF ((PS-END-OF-LOGON-FILE)                                   01975299
CHG016              OR (CC-ORACLE-CONNECTION = SPACES))                 01975399
CHG016           DISPLAY '** ABEND **'                                  01975499
CHG016           DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '01975599
CHG016               'NOT PROVIDED'                                     01975699
CHG016           SET PS-ORA-SRC-EMPTY TO TRUE                           01975799
CHG016           CALL 'ILBOABN0' USING AC-ABEND-CODE                    01975899
CHG016     END-IF.                                                      01975999
CHG016                                                                  01990099
261500         IF CC-AUTO-LOGON                                         02130099
261600             DISPLAY PC-PROGRAM-NAME  ' - AUTO LOGON TO ORACLE'   02140099
261700             EXEC SQL                                             02150099
261800               CONNECT  :PC-AUTO-LOGON                            02160099
261900             END-EXEC                                             02170099
CHG016     ELSE                                                         02171099
CHG016         INITIALIZE PV-ORACLE-USERID-LEN                          02172099
CHG016                    PV-ORACLE-PASSWORD-LEN                        02173099
CHG016           INSPECT    CC-ORACLE-USERID                            02174099
CHG016             TALLYING   PV-ORACLE-USERID-LEN                      02175099
CHG016             FOR CHARACTERS BEFORE INITIAL SPACE                  02176099
CHG016           INSPECT    CC-ORACLE-PASSWORD                          02177099
CHG016             TALLYING   PV-ORACLE-PASSWORD-LEN                    02178099
CHG016             FOR CHARACTERS BEFORE INITIAL SPACE                  02179099
CHG016         MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO        02179199
CHG016                    USERNAME-ARR                                  02179299
CHG016         MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                02179399
CHG016         MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO    02179499
CHG016                      PASSWD-ARR                                  02179599
CHG016         MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                02179699
CHG016           DISPLAY PC-PROGRAM-NAME  ' - LOGON TO ORACLE AS USER ' 02179799
CHG016                      USERNAME-ARR                                02179899
CHG016            EXEC SQL                                              02179999
CHG016                 CONNECT :USERNAME IDENTIFIED BY :PASSWD          02180099
CHG016            END-EXEC                                              02180199
CHG016         INITIALIZE CC-ORACLE-PASSWORD                            02180299
CHG016                    PASSWD                                        02180399
CHG016     END-IF.                                                      02180499
CHG016                                                                  02180599
263600         IF SQLCODE NOT = 0                                       02180699
263700               DISPLAY '** CONNECTING TO ORACLE BY USERID **'     02180799
263800               DISPLAY 'TRIED TO CONNECT TO ORACLE UNDER: '       02180899
263900                                  PASSWD                          02180999
264000            SET AC-ORACLE-BAD-LOGON-4004 TO TRUE                  02181099
264100               PERFORM 9999-SQL-ABEND                             02181299
264200         END-IF.                                                  02181399
264300                                                                  02181499
CHG016     OPEN   INPUT  IN-EVENT-FILE                                  02181599
CHG016     OPEN   OUTPUT OUT-EVENT-FILE.                                02181699
CHG016                                                                  02182099
265001     PERFORM 3000-READ-INPUT-FILE.                                02490099
265002                                                                  02500000
265003     IF PS-END-OF-FILE-Y                                          02510000
265004         DISPLAY SPACES                                           02520099
265005         DISPLAY ALL '*'                                          02530099
265006         DISPLAY '  INPUT FILE IS EMPTY '                         02540099
265007         DISPLAY ALL '*'                                          02550099
265008         DISPLAY SPACES                                           02560099
265009     END-IF.                                                      02570099
265010                                                                  02580099
265011****************************************************************  02590000
265012*     PROCESS INPUT FILE                                          02600000
265013****************************************************************  02610000
265014 2000-PROCESS-INPUT-FILE.                                         02620000
265015     PERFORM 2000-DECLARE-CURSOR.                                 02630000
265016                                                                  02640000
265017     PERFORM 2200-OPEN-CURSOR.                                    02650000
265018                                                                  02660000
265019     PERFORM 2500-FETCH-CURSOR.                                   02670099
265020                                                                  02680000
265021     PERFORM 2400-PROCESS-CURSOR                                  02690000
265022             UNTIL PS-END-OF-CSR-Y.                               02700000
265023     SET PS-END-OF-CSR-N TO TRUE.                                 02710000
265024                                                                  02720099
265025     PERFORM 2600-CLOSE-CURSOR.                                   02730000
265026                                                                  02740000
265027     PERFORM 3000-READ-INPUT-FILE.                                02750099
265028                                                                  02760099
265029****************************************************************  02770000
265030*     DECLARE CURSOR. THE CURSOR EXCLUDES MARK1 SINCE NO QUERY    02780000
265031*     WILL BE RUN FOR IT. IT INCLUDES MARK2/FINAL ONLY IF ITS     02790000
265032*     CLR_LAST_EF_DTE FALLS BETWEEN THE FIRST DAY OF THE          02800000
265033*     CALCULATED WEEK (PV-1STDAY-ADVANCE-TO-WK) AND THE LAST DAY  02810000
265034*     OF THE CALCULATED DATE (PV-LSTDAY-ADVANCE-TO-DATE).         02820000
265035****************************************************************  02830000
265036 2000-DECLARE-CURSOR.                                             02840000
265037     EXEC SQL                                                     02850000
265038        DECLARE MARKDOWN CURSOR FOR                               02860000
265039         SELECT CLR_FRST_EFF_DTE                                  02870099
265040               ,CLR_LAST_EFF_DTE                                  02880099
265041               ,(CLR_LAST_EFF_DTE - CLR_FRST_EFF_DTE)             02890099
265042           FROM PET_CLR_MKDN_EVNT                                 02900099
265043          WHERE CLR_EVNT_ID      = :PX029-EVENT-ID                02910099
265044            AND ACTV_IND         = 'Y'                            02920099
265045            AND CLR_MKDN_CDE     = '1'                            02930099
265046          ORDER BY                                                02940099
265047                CLR_EVNT_ID,                                      02950099
265048                CLR_MKDN_CDE                                      02960099
265049     END-EXEC.                                                    02970099
265050                                                                  02980099
265051     EVALUATE TRUE                                                02990099
265052        WHEN SQLCODE NOT EQUAL ZERO                               03000099
265053           MOVE '2000-DECLARE-CURSOR' TO PV-PARAGRAPH-NAME        03010099
265054           MOVE 'CURSOR DECLARE ERROR' TO PV-OPERATION-MSG        03020099
265055           PERFORM 9999-SQL-ABEND                                 03030099
265056     END-EVALUATE.                                                03040099
265057                                                                  03050099
265058****************************************************************  03060099
265059*     OPEN CURSOR.                                                03070099
265060****************************************************************  03080099
265061 2200-OPEN-CURSOR.                                                03090099
265062     EXEC SQL                                                     03100099
265063        OPEN MARKDOWN                                             03110099
265064     END-EXEC.                                                    03120099
265065                                                                  03130099
265066     EVALUATE TRUE                                                03140099
265067        WHEN SQLCODE NOT EQUAL ZERO                               03150099
265068           MOVE '2200-OPEN-CURSOR'    TO PV-PARAGRAPH-NAME        03160099
265069           MOVE 'CURSOR OPEN ERROR'   TO PV-OPERATION-MSG         03170099
265070           PERFORM 9999-SQL-ABEND                                 03180099
265071     END-EVALUATE.                                                03190099
265072                                                                  03200099
265073****************************************************************  03210099
265074**    PROCESS CURSOR                                              03220099
265075****************************************************************  03230099
265076 2400-PROCESS-CURSOR.                                             03240099
265077     PERFORM 4000-WRITE-OUTPUT-FILE.                              03250099
265078                                                                  03260099
265079     PERFORM 2500-FETCH-CURSOR.                                   03270099
265080                                                                  03280099
265081****************************************************************  03290099
265082**    FETCH CURSOR                                                03300099
265083****************************************************************  03310099
265084 2500-FETCH-CURSOR.                                               03320099
265085     EXEC SQL                                                     03330099
265086        FETCH MARKDOWN                                            03340099
265087         INTO :CLR-FRST-EFF-DTE                                   03350099
265088             ,:CLR-LAST-EFF-DTE                                   03360099
265089             ,:PV-NBR-OF-MRDWN-DAYS                               03370099
265090     END-EXEC.                                                    03380099
265091                                                                  03390099
265092     EVALUATE TRUE                                                03400099
265093        WHEN SQLCODE EQUAL ZERO                                   03410099
265094            CONTINUE                                              03420099
265095        WHEN SQLCODE = +1403                                      03430099
265096           SET PS-END-OF-CSR-Y        TO TRUE                     03440099
265097        WHEN OTHER                                                03450099
265098           MOVE '2500-FETCH-CURSOR'   TO PV-PARAGRAPH-NAME        03460099
265099           MOVE 'CURSOR FETCH ERROR'  TO PV-OPERATION-MSG         03470099
265100           PERFORM 9999-SQL-ABEND                                 03480099
265101     END-EVALUATE.                                                03490099
265102                                                                  03500099
265103****************************************************************  03510099
265104**    CLOSE MARKDOWN CURSOR.                                      03520099
265105****************************************************************  03530099
265106 2600-CLOSE-CURSOR.                                               03540099
265107     EXEC SQL                                                     03550099
265108        CLOSE MARKDOWN                                            03560099
265109     END-EXEC.                                                    03570099
265110                                                                  03580099
265111     EVALUATE TRUE                                                03590099
265112        WHEN SQLCODE EQUAL ZERO                                   03600099
265113           CONTINUE                                               03610099
265114        WHEN OTHER                                                03620099
265115           MOVE '2600-CLOSE-CURSOR'   TO PV-PARAGRAPH-NAME        03630099
265116           MOVE 'CURSOR CLOSE ERROR'  TO PV-OPERATION-MSG         03640099
265117           PERFORM 9999-SQL-ABEND                                 03650099
265118     END-EVALUATE.                                                03660099
265119                                                                  03670099
265120****************************************************************  03680099
265121*     READ AND PROCESS INPUT FILE.                                03690099
265122****************************************************************  03700099
265123 3000-READ-INPUT-FILE.                                            03710099
265124     READ IN-EVENT-FILE INTO PX029-MOS-EVENT-EXTRACT              03720099
265125        AT END                                                    03730099
265126           SET PS-END-OF-FILE-Y      TO TRUE                      03740099
265127     END-READ.                                                    03750099
265128                                                                  03760099
265129     IF PS-END-OF-FILE-N                                          03770099
265130         ADD 1 TO PA-TOT-EVNT-REC-READS                           03780099
265131     END-IF.                                                      03790099
265132                                                                  03800099
265133****************************************************************  03810099
265134**    WRITE OUTPUT FILE                                           03820099
265140****************************************************************  03830000
265150 4000-WRITE-OUTPUT-FILE.                                          03840099
265151     INITIALIZE PX030-MARKDOWN-DATE-EXTRACT.                      03850099
265152     IF PV-NBR-OF-MRDWN-DAYS = 0                                  03851099
265153       MOVE CLR-FRST-EFF-DTE     TO DF-WORK-DATE                  03860099
265154       MOVE DF-DATE-1-10         TO PX030-FRST-MKDN-DATE          03870099
265155       MOVE PX029-MOS-EFF-DATE   TO PX030-MOS-EFF-DATE            03880099
265156       WRITE OUT-EVENT-RECORD FROM PX030-MARKDOWN-DATE-EXTRACT    03890099
265157       ADD 1 TO  PA-TOT-OUTPUT-WRITTEN                            03900099
265158     ELSE                                                         03901099
265159       MOVE CLR-FRST-EFF-DTE     TO DF-WORK-DATE                  03901199
265160       MOVE DF-DATE-1-10         TO PX030-FRST-MKDN-DATE          03901299
265170       MOVE PX029-MOS-EFF-DATE   TO PX030-MOS-EFF-DATE            03901399
265180       WRITE OUT-EVENT-RECORD FROM PX030-MARKDOWN-DATE-EXTRACT    03901499
265190       ADD 1 TO  PA-TOT-OUTPUT-WRITTEN                            03901699
265200       INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56             03901799
265300       MOVE CLR-FRST-EFF-DTE       TO DPG52-LK-DATE-INPUT.        03902099
265400       PERFORM                                                    03902599
265500         UNTIL PV-NBR-OF-MRDWN-DAYS = 0                           03902699
265600         SET DPG51-ACTUAL-CALENDAR-ONLY                           03902799
265700             DPG51-INCREMENT-DATE                                 03902899
265800             DPG52-LK-DTE-ISO-FMT TO TRUE                         03902999
265900         MOVE 1 TO DPG51-INCR-DECR-BUS-DAYS-9                     03903099
266000         CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52      03903299
266100                                                 DPG53 DPG54      03903399
266200                                                 DPG55 DPG56      03903499
266300         IF DPG54-NO-ERROR                                        03903599
266400           MOVE '-' TO DPG56-FIRST-FD-DB2-ISO-FMT-S1              03903699
266500                       DPG56-FIRST-FD-DB2-ISO-FMT-S2              03903799
266600           MOVE DPG55-DB2-ISO-DATE-FMT                            03903899
266700                                 TO PX030-FRST-MKDN-DATE          03903999
266800           MOVE PX029-MOS-EFF-DATE   TO PX030-MOS-EFF-DATE        03904099
266900           WRITE OUT-EVENT-RECORD FROM PX030-MARKDOWN-DATE-EXTRACT03904199
267000           ADD 1 TO  PA-TOT-OUTPUT-WRITTEN                        03904399
267100           SUBTRACT 1 FROM PV-NBR-OF-MRDWN-DAYS                   03904499
267200           MOVE DPG55-DB2-ISO-DATE-FMT     TO                     03904599
267300                DPG52-LK-DATE-INPUT                               03904699
267400         ELSE                                                     03904799
267500           DISPLAY '** ABEND ** IN PXKUT024'                      03904899
267600           DISPLAY 'DATE ERROR : ' DPG54-ERROR-MESSAGE            03904999
267700           DISPLAY '** DPG51 = ' DPG51                            03905099
267800           DISPLAY '** DPG52 = ' DPG52                            03905199
267900           DISPLAY '** DPG53 = ' DPG53                            03905299
268000           DISPLAY '** DPG54 = ' DPG54                            03905399
268100           DISPLAY '** DPG55 = ' DPG55                            03905499
268200           DISPLAY '** DPG56 = ' DPG56                            03905599
268300           MOVE +4001 TO AC-ABEND-CODE                            03905699
268400           CALL 'ILBOABN0' USING AC-ABEND-CODE                    03905799
268500         END-IF                                                   03905899
268501       END-PERFORM.                                               03907099
268502                                                                  03910000
268503 4100-INCREMENT-DATE.                                             03911099
268504***************************************************************** 03912099
268505*  USE THE CALENDAR ROUTINE TO ADD 1 TO DATE                    * 03913099
268506***************************************************************** 03915099
268507                                                                  03916099
268508     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03917099
268509     SET DPG51-FISCAL-454-CALENDAR                                03918099
268510         DPG51-DECREMENT-DATE                                     03919099
268520         DPG52-LK-DTE-FISC-PRD-CC TO TRUE.                        03919199
268530     MOVE 1 TO DPG51-INCR-DECR-FISCAL-PRD-9.                      03919499
268540     PERFORM 4200-FISCAL-CALENDAR-ROUTINE.                        03919599
268550     IF DPG54-NO-ERROR                                            03919699
268560         NEXT SENTENCE                                            03919799
268570     ELSE                                                         03920299
268580         DISPLAY '** ABEND ** IN PXKUT024'                        03920399
268590         DISPLAY 'DATE ERROR : ' DPG54-ERROR-MESSAGE              03920499
268600         MOVE +4001 TO AC-ABEND-CODE                              03920599
268700         CALL 'ILBOABN0' USING AC-ABEND-CODE                      03920699
268800     END-IF.                                                      03920799
268900                                                                  03922699
269000 4200-FISCAL-CALENDAR-ROUTINE.                                    03922799
269100***************************************************************** 03922899
269200*  READ THE CALENDAR DATABASE DIRECTLY FOR A PARTICULAR DATE.   * 03922999
269300***************************************************************** 03923099
269400      CALL PC-CALENDAR-MODULE USING DPG51                         03923199
269500                                    DPG52                         03923299
269600                                    DPG53                         03923399
269700                                    DPG54                         03923499
269800                                    DPG55                         03923599
269801                                    DPG56.                        03923699
CHG016****************************************************************  03923799
CHG016* LOGON TO ORACLE                                                 03923899
CHG016****************************************************************  03923999
CHG016 8000-READ-ORACLE-LOGON.                                          03924099
CHG016                                                                  03924199
CHG016     READ ORACLE-LOGON-FILE                                       03924299
CHG016         INTO CC-ORACLE-CONNECTION                                03924399
CHG016         AT END                                                   03924499
CHG016             SET PS-END-OF-LOGON-FILE TO TRUE                     03924599
CHG016     END-READ.                                                    03924699
CHG016                                                                  03924799
269802****************************************************************  03925000
269803*     CLOSE FILES.                                                03930000
269804****************************************************************  03940000
269805 9000-END-OF-JOB.                                                 03950000
269806     CLOSE IN-EVENT-FILE                                          03960000
269807*          ORACLE-LOGON-FILE                                      03970099
269808           OUT-EVENT-FILE.                                        03980000
269809                                                                  03990000
269810     DISPLAY ' '.                                                 04000099
269811     DISPLAY '*********************************************'.     04010099
269812     DISPLAY '    PXKUT024 SUMMARY STATISTICS              '      04020099
269813     DISPLAY '*********************************************'.     04030099
269814     DISPLAY 'EVENT RECORDS READ........: ' PA-TOT-EVNT-REC-READS 04040099
269815     DISPLAY 'OUTPUT RECS WRITTEN.......: ' PA-TOT-OUTPUT-WRITTEN 04050099
269816     DISPLAY '*********************************************'.     04060099
269817                                                                  04070000
269818****************************************************************  04080000
269819*     NON-DATABASE ABEND.                                         04090000
269820****************************************************************  04100000
269821 9800-ABEND.                                                      04110000
269822     DISPLAY '** ABEND     **'.                                   04120000
269823     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04130000
269824     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04140000
269825     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               04150000
269826                                                                  04160000
269827     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         04170000
269828                                                                  04180099
269829******************************************************************04190000
269830*     SQL ABEND PARAGRAPH.                                        04200000
269831******************************************************************04210000
269832 9999-SQL-ABEND.                                                  04220000
269833     DISPLAY '** ABEND     **'.                                   04230000
269834     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                04240000
269835     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              04250000
269836     DISPLAY '** OPERATION ** = ' PV-OPERATION-MSG.               04260000
269837                                                                  04270000
269838******************************************************************04280000
269839* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     04290000
269840* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      04300000
269841******************************************************************04310000
269842     COPY DPPD004.                                                04320000
269843     SET AC-DB2-ERROR TO TRUE.                                    04330000
269844     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         04340000
269845                                                                  04350099
