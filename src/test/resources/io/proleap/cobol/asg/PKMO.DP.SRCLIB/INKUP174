       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    INKUP174.                                         00020000
       AUTHOR.        JULIE SEIDLER.                                    00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  08/20/99.                                         00050000
       DATE-COMPILED.                                                   00060000
                                                                        00070000
      ******************************************************************00080000
      *                                                                 00090000
      *PURPOSE:                                                         00100000
      *                                                                 00110000
      *    THE COBOL CREATES THE JOB LETTERS AND THE INVENTORY          00120000
      *  DATE. THE JOB LETTERS ASSIGNED TO THE STORE TRANSMISSION       00130000
      *  JOB, INK908, MUST BE THE SAME AS THE JOB LETTERS IN THE        00140000
      *  WEBSIT JOBS, INK913, 911, AND 912.                             00150000
      *                                                                 00160000
W33304*  HILO PROJECT: THE RUN FREQUENCY AND DATE REQUIREMENTS CHANGED  00170000
W33304*  THIS OLD RB0404 DOCUMENTATION IS NOT ACCURATE ANY LONGER       00180000
W33304*  ------------------------------------------------------------   00190000
RB0404*  THE PROGRAM USES THE DB2 TINVPAR TO DETERMINE WHICH OF THE 3   00200000
RB0404*  WEBSIT JOBS A STORES BELONGS TO.  RGIS IS THE DEFAULT          00210000
RB0404*  SCANNING SERVICE BECAUSE IT IS KOHLS PRIMARY SCANNING SERVICE. 00220000
RB0404*                                                                 00230000
RB0404*  THERE IS AN OPTIONAL CONTROL CARD USED FOR OVER RIDING THE     00240000
RB0404*  DATE USED IN THIS PROGRAM.  WHEN THE CONTROL CARD IS BLANK     00250000
RB0404*  THE JOBS WILL BE SET UP FOR STORES DOING INVENTORY IN THE      00260000
RB0404*  NEXT FISCAL MONTH,                                             00270000
RB0404*  AND WHEN THE CONTROL CARD IS FILLED IN, THE JOBS WILL BE SET   00280000
RB0404*  UP FOR THE STORES DOING INVENTORY DURING THE CURRENT FISCAL    00290000
RB0404*  MONTH.                                                         00300000
W33304*                --------------------------                       00310000
W33304*  HILO PROJECT: HOLD INVENTORY LEDGER OPEN                       00320000
W33304*                --------------------------                       00330000
W33304* >THIS USED TO BE A STAND ALONE MONTHLY RUN PROCESS THAT DID     00340000
W33304*  NOT REQUIRE AN INPUT RUN DATE. NOW THIS WILL BE A WEEKLY       00350000
W33304*  SCHEDULED PROCESS AND AN INPUT RUN DATA IS MANDATORY TO        00360000
W33304*  DETERMINE THE NEXT FISCAL WEEK RELATIVE TO THE INPUT DATE.     00370000
W33304* >ADDED 'DELETE LOCATION' LOGIC TO THE TINVPAR_CSR WHICH IS      00380000
W33304*  THE FOLLLOWING WHERE CLAUSE ADDITION:                          00390000
W33304*  (ADD A.LOC_INV_STAT_CDE = 'IN').                               00400000
W33304* >CHANGED THE 'IND' OF SCHD_PHY_CNT_IND TO 'CDE'.                00410000
W33304* >ADDED A CHECK FOR NUMERICS AND DASHES FOR THE INPUT DATE.      00420000
W33304* >ADDED PARA 1100- TO GET NEXT FISCAL WEEK RELATIVE TO INPUT.    00430000
W33304*                                                                 00440000
      ******************** HISTORY OF CHANGES **************************00450000
      * CHG ID/                                                        *00460000
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00470000
      * -------  ----------  ----------------------------------------  *00480000
      *          12/08/99    ADDED A REPORT THAT LISTS THE STORES,     *00490000
      *                      THEIR INVENTORY DATES, AND THE JOB LETTER *00500000
      *                      ASSIGNED TO IT.         - JULIE SEIDLER   *00510000
      *                                                                *00520000
      *          03/24/00    CHANGED PROGRAM TO FORMAT JOBTRAC         *00530000
      *                      DATE IN YYMMDD FORMAT INSTEAD OF MMDDYY   *00540000
      *                      FORMAT.  ALSO, CHANGED ALL REFERENCES     *00550000
      *                      TO INK910 TO INK913.    - AMY LAWSON      *00560000
RWJ01 *                                                                *00570000
RWJ01 *          12/11/00    ESP PROGRAM CHANGES TO HANDLE DATE        *00580000
RWJ01 *                      GENERATION AS ESP REQUIRES.               *00590000
RWJ01 *                                              - ROD JANSSEN     *00600000
RB0404*                                                                *00610000
RB0404*          04/04/01    MODIFY PROGRAM TO USE TINVPAR TABLE TO    *00620000
RB0404*                      DETERMINE THE INVENTORY SERVICE.          *00630000
RB0404*                      ELIMINATE THE CONTROL CARD.  THIS PROGRAM *00640000
RB0404*                      WILL BE SET UP TO RUN CYCLICAL.           *00650000
RB0404*                                              - RONNA BUTZ      *00660000
RB0404*                                                                *00670000
RB0409*          04/09/01    MODIFY PROGRAM UPDATE TINVPAR TABLE       *00680000
RB0409*                      WITH THE JOB NUMBER THAT IS ASSIGNED      *00690000
RB0409*                      TO THE STORE.  PROGRAM NAME WAS CHANGED   *00700000
RB0409*                      FROM INKUT174 TO INKUP174.                *00710000
RB0409*                                              - RONNA BUTZ      *00720000
RB1101*          11/29/01    MODIFY PROGRAM TO CREATE INK908 JOB       *00730000
RB1101*                      MEMBERS FOR WESTERN.  WESTERN WILL BE     *00740000
RB1101*                      SENDING TRANSMISSIONS DIRECTLY FROM THE   *00750000
RB1101*                      THE STORE TO THE MAINFRAME LIKE RGIS.     *00760000
RB1101*                      NOW WESTERN WILL HAVE INK908 AND          *00770000
RB1101*                      INK913 JOBS.            - RONNA BUTZ      *00780000
22960 * 22960    01-07-2002  CHANGE PROGRAM TO USE COPYBOOK AND COPY   *00790000
22960 * 23511                CODE FOR GENERATING THE 2-CHARACTERS      *00800000
22960 *                      CODE IN THE JOB NAMES.  THE PREVIOUS      *00810000
22960 *                      METHOD HAS A LIMITATION OF 60 JOBS, AND   *00820000
22960 *                      THIS ONE WILL HAVE A LIMITATION OF 260.   *00830000
447299*PBM 447299 2-06-2002  SINGLE DIGIT DATES DO NOT PROCESS IN ESP.  00840000
447299*                      WHY?                    - ROD JANSSEN     *00850000
24029 * 24029    10/28/2002  MODIFY PROGRAM TO CREATE INK908 JOB       *00860000
24029 *                      MEMBERS FOR WIS. WASHINGTON WILL BE       *00870000
24029 *                      SENDING TRANSMISSIONS DIRECTLY FROM THE   *00880000
24029 *                      THE STORE TO THE MAINFRAME LIKE RGIS.     *00890000
21732 * 21732    03/28/2003  UCC11 REMOVAL.          - ROD JANSSEN      00900000
25248 * 25248    10-23-2003  UPC CAPABILITIES & STORE NUMBER EXPANSION  00910000
25248 *                      -ROD JANSSEN                               00920000
28545 * 28545    08-10-2006  DEPARTMENT LEVEL INVENTORY                *00930000
28545 *                      JOIN TINVPAR/TINCNTL                      *00940000
28545 *                      B. GRAHAM - STRATAGEM                     *00950000
28545 *                                                                *00960000
W33304*W33304    06-27-2008  HILO - HOLD INVENTORY LEDGER OPEN         *00961000
W33304*                      ---------------------------------         *00962000
W33304*                      INPUT DATE IS NOW MANDATORY.              *00962100
W33304*                      GO FROM MONTHLY STAND ALONE TO WEEKLY     *00962200
W33304*                      SCHEDULED PROCESS. DELETE LOGIC FILTER    *00962300
W33304*                      ADDED TO TINVPAR_CSR. CHANGED VARIABLE    *00962400
W33304*                      NAME SCHD_PHY_CNT_IND TO '_CDE'. ADDED    R00962500
W33304*                      CHECK FOR NUMERICS AND DASHES FOR THE     *00962600
W33304*                      INPUT DATE. ADDED PARAGRAPH 1100- TO      *00962700
W33304*                      GET THE NEXT FISCAL WEEK RELATIVE TO      *00962800
W33304*                      THE INPUT DATE.                           *00962900
W33304*                                                                *00963000
W33304*                      THERESE RAMSEYER                          *00963100
W33304*                                                                *00964000
216916*C216916   01-31-2019  INK911 AND INK912 ARCHIVAL CHANGES        *00965000
      ***************************************************************** 00970000
       ENVIRONMENT DIVISION.                                            00980000
       CONFIGURATION SECTION.                                           00990000
       SOURCE-COMPUTER. IBM-3090.                                       01000000
       OBJECT-COMPUTER. IBM-3090.                                       01010000
       INPUT-OUTPUT SECTION.                                            01020000
       FILE-CONTROL.                                                    01030000
                                                                        01040000
RB0404     SELECT CC-OVERRIDE-FILE                                      01050000
RB0404         ASSIGN TO INP01.                                         01060000
           SELECT REPORT-FILE                                           01070000
               ASSIGN TO RPT01.                                         01080000
                                                                        01090000
       DATA DIVISION.                                                   01100000
       FILE SECTION.                                                    01110000
                                                                        01120000
RB0404 FD  CC-OVERRIDE-FILE                                             01130000
RB0404     RECORDING MODE IS F                                          01140000
RB0404     LABEL RECORDS ARE STANDARD                                   01150000
RB0404     BLOCK CONTAINS 0 RECORDS                                     01160000
RB0404     RECORD CONTAINS 80 CHARACTERS                                01170000
RB0404     DATA RECORD IS CC-OVERRIDE-RECORD.                           01180000
RB0404 01  CC-OVERRIDE-RECORD                   PIC X(80).              01190000
                                                                        01200000
       FD  REPORT-FILE                                                  01210000
           RECORDING MODE IS F                                          01220000
           LABEL RECORDS ARE STANDARD                                   01230000
           BLOCK CONTAINS 0 RECORDS                                     01240000
           RECORD CONTAINS 132 CHARACTERS                               01250000
           DATA RECORD IS REPORT-REC.                                   01260000
       01  REPORT-REC                         PIC X(132).               01270000
                                                                        01280000
      /*****************************************************************01290000
       WORKING-STORAGE SECTION.                                         01300000
      ******************************************************************01310000
RB0404 01  CC-CONTROL-CARD.                                             01320000
RB0404    05  CC-CONTROL-DATE.                                          01330000
RB0404        10  CC-CONTROL-CCYY              PIC X(04)  VALUE SPACES. 01340000
W33304        10  CC-CONTROL-HYPHEN1           PIC X(01)  VALUE SPACES. 01350000
RB0404        10  CC-CONTROL-MM                PIC X(02)  VALUE SPACES. 01360000
W33304        10  CC-CONTROL-HYPHEN2           PIC X(01)  VALUE SPACES. 01370000
RB0404        10  CC-CONTROL-DD                PIC X(02)  VALUE SPACES. 01380000
RB0404    05  FILLER                           PIC X(70)  VALUE SPACES. 01390000
                                                                        01400000
       01  PC-PROGRAM-CONSTANTS.                                        01410000
23511      05  PC-MAX-STR-PER-DAY               PIC 9(04) VALUE 260.    01420000
RB0404     05  PC-MAX-INVENTORY-DAYS            PIC 9(02)  VALUE 25.    01430000
           05  PC-DEFAULT-DTE                   PIC X(10)               01440000
                                                VALUE '9999-09-09'.     01450000
                                                                        01460000
      *01  IN089-LETTER-TBL-WORK-AREA.                                  01470000
           COPY INWS089.                                                01480000
                                                                        01490000
       01  PV-PROGRAM-VARIABLES.                                        01500000
25248      05  PV-EDIT-LOC-NBR            PIC 9(04)   VALUE ZEROS.      01510000
25248      05  PV-EDIT-LOC-NBR-ALPH REDEFINES                           01520000
25248          PV-EDIT-LOC-NBR            PIC X(04).                    01530000
           05  PV-PARAGRAPH-NAME          PIC X(30)   VALUE SPACE.      01540000
           05  PV-ABEND-MESSAGE           PIC X(75)   VALUE SPACE.      01550000
           05  ABEND-CODE                 PIC S9(04)  VALUE +0          01560000
                                                      COMP.             01570000
           05  PV-DB2-OPERATION-ATTEMPTED PIC X(30)   VALUE SPACE.      01580000
           05  PV-RETRY-COUNT             PIC S9(04)  VALUE +0          01590000
                                                      COMP.             01600000
           05  PV-NBR-OF-STR-IN-DAY       PIC S9(04)  VALUE +0          01610000
                                                      COMP.             01620000
           05  PV-DB2-DATE.                                             01630000
               10 PV-DB2-CC                     PIC X(02)  VALUE SPACE. 01640000
               10 PV-DB2-YY                     PIC X(02)  VALUE SPACE. 01650000
               10 FILLER                        PIC X(01).              01660000
               10 PV-DB2-MM                     PIC X(02)  VALUE SPACE. 01670000
               10 FILLER                        PIC X(01).              01680000
               10 PV-DB2-DD                     PIC X(02)  VALUE SPACE. 01690000
           05  PV-CUR-PLND-INV-DTE              PIC X(10)  VALUE ZERO.  01700000
                                                                        01710000
RB0409     05  PV-JOB-NAME.                                             01720000
RB0409         10 FILLER                        PIC X(03)  VALUE 'INK'. 01730000
RB0409         10 PV-INV-SRVC-JOB-CDE           PIC X(03)  VALUE SPACE. 01740000
RB0409         10 PV-JCL-JOB-LETTERS            PIC X(02)  VALUE SPACE. 01750000
RB0409                                                                  01760000
       01  PS-PROGRAM-SUBSCRIPTS.                                       01770000
           05  INV-DTE-SUB                      PIC 9(04)  VALUE ZERO.  01780000
                                                                        01790000
       01  PS-PROGRAM-SWITCHES.                                         01800000
           05  PS-CC-OVERRIDE-EOF-SW            PIC X(01)  VALUE 'N'.   01810000
               88  PS-CC-OVERRIDE-EOF                      VALUE 'Y'.   01820000
           05  PS-END-OF-INVPAR-CURSOR-IND                              01830000
                                       PIC X(1)     VALUE 'N'.          01840000
               88  PS-END-OF-INVPAR-CURSOR          VALUE 'Y'.          01850000
                                                                        01860000
       01  DL-TITLE                              PIC X(23)              01870000
           VALUE 'JOB LETTER ASSIGNMENTS'.                              01880000
       01  DL-HEADING-1.                                                01890000
           05  FILLER                            PIC X(13)  VALUE SPACE.01900000
           05  FILLER                            PIC X(03)  VALUE 'JOB'.01910000
           05  FILLER                            PIC X(12)  VALUE SPACE.01920000
           05  FILLER                            PIC X(04)              01930000
                                                 VALUE 'SCAN'.          01940000
       01  DL-HEADING-2.                                                01950000
           05  FILLER                            PIC X(09)              01960000
                                                 VALUE 'INV DATE'.      01970000
           05  FILLER                            PIC X(03)  VALUE SPACE.01980000
           05  FILLER                            PIC X(08)              01990000
                                                 VALUE 'LETTERS'.       02000000
           05  FILLER                            PIC X(02)  VALUE SPACE.02010000
           05  FILLER                            PIC X(03)              02020000
                                                 VALUE 'STR'.           02030000
           05  FILLER                            PIC X(03)  VALUE SPACE.02040000
           05  FILLER                            PIC X(08)              02050000
                                                 VALUE 'SERVICE'.       02060000
RWJ01      05  FILLER                            PIC X(01) VALUE SPACE. 02070000
RWJ01      05  FILLER                            PIC X(04) VALUE 'JOBS'.02080000
                                                                        02090000
RWJ01  01  DL-DASHES                             PIC X(55) VALUE        02100000
RWJ01      '-------------------------------------------------------'.   02110000
                                                                        02120000
       01  DL-LINE1.                                                    02130000
           05  DL-INV-DTE                        PIC X(10)  VALUE SPACE.02140000
           05  FILLER                            PIC X(04)  VALUE SPACE.02150000
           05  DL-JOB-LETTERS                    PIC X(02)  VALUE SPACE.02160000
           05  FILLER                            PIC X(06)  VALUE SPACE.02170000
25248      05  DL-STR-NBR                        PIC X(04)  VALUE SPACE.02180000
25248      05  FILLER                            PIC X(03)  VALUE SPACE.02190000
           05  DL-SCAN-SERVICE                   PIC X(04)  VALUE SPACE.02200000
RWJ01      05  FILLER                            PIC X(04)  VALUE SPACE.02210000
  |        05  DL-JOB1                           PIC X(08)  VALUE SPACE.02220000
  |        05  FILLER                            PIC X(02)  VALUE SPACE.02230000
  |        05  DL-JOB2                           PIC X(08)  VALUE SPACE.02240000
RWJ01      05  FILLER                            PIC X(88) VALUE SPACE. 02250000
28545                                                                   02260000
28545 ***************************************************************** 02270000
28545 * TINCNTL DCLGEN                                                  02280000
28545 ***************************************************************** 02290000
28545      EXEC SQL                                                     02300000
28545          INCLUDE TINCNTL                                          02310000
28545      END-EXEC.                                                    02320000
                                                                        02330000
      ******************************************************************02340000
      *  LAYOUT USED FOR INVENTORY PARMS TABLE                          02350000
      ******************************************************************02360000
           EXEC SQL                                                     02370000
               INCLUDE TINVPAR                                          02380000
           END-EXEC.                                                    02390000
                                                                        02400000
RB0404******************************************************************02410000
RB0404*  LAYOUT USED FOR DATE ATTRIBUTE  TABLE                          02420000
RB0404******************************************************************02430000
RB0404     EXEC SQL                                                     02440000
RB0404         INCLUDE TDTATTR                                          02450000
RB0404     END-EXEC.                                                    02460000
RB0404                                                                  02470000
     *******************************************************************02480000
     **  SQL DB2 TINVPAR CURSOR DECLARATION                             02490000
     *******************************************************************02500000
           EXEC SQL                                                     02510000
               DECLARE TINVPAR_CSR CURSOR FOR                           02520000
25248              SELECT LOC_NBR                                       02530000
                         ,PLND_INV_DTE                                  02540000
RB0404                   ,INV_SRVC_CDE                                  02550000
28545                    ,A.INV_ID                                      02560000
28545              FROM TINVPAR A                                       02570000
28545                  ,TINCNTL B                                       02580000
                   WHERE ACTL_FIN_BK_DTE = :PC-DEFAULT-DTE              02590000
W33304               AND PLND_INV_DTE BETWEEN :DTATTR-FSCL-WK-BEG-DTE   02600000
W33304                                    AND :DTATTR-FSCL-WK-END-DTE   02610000
                     AND SCAN_INV_IND = 'Y'                             02620000
W33304               AND SCHD_PHY_CNT_CDE = 'PI'                        02630000
W33304               AND A.LOC_INV_STAT_CDE = 'IN'                      02640000
28545                AND A.INV_ID = B.INV_ID                            02650000
28545                AND B.ACTV_IND = 'Y'                               02660000
                   ORDER BY PLND_INV_DTE                                02670000
                           ,LOC_NBR                                     02680000
           END-EXEC.                                                    02690000
                                                                        02700000
      ******************************************************************02710000
      *  DB2 ERROR MESSAGES FORMAT AREA.                                02720000
      ******************************************************************02730000
           COPY DPWS004.                                                02740000
                                                                        02750000
      ******************************************************************02760000
      *  USED FOR DB2 ERRORS                                            02770000
      ******************************************************************02780000
           EXEC SQL                                                     02790000
               INCLUDE SQLCA                                            02800000
           END-EXEC.                                                    02810000
                                                                        02820000
       PROCEDURE DIVISION.                                              02830000
      ******************************************************************02840000
      *    OPEN ALL FILES.                                              02850000
      *    READ THE FIRST RECORD FROM THE INPUT FILE.                   02860000
      *    PROCESS ALL INPUT RECORDS UNTIL END OF FILE.                 02870000
      *    CLOSE ALL FILES.                                             02880000
      ******************************************************************02890000
       0000-MAIN-MODULE.                                                02900000
                                                                        02910000
           PERFORM 1000-INITIALIZATION.                                 02920000
                                                                        02930000
           PERFORM 2000-PROCESS-INVENTORY-DATES                         02940000
               UNTIL PS-END-OF-INVPAR-CURSOR.                           02950000
                                                                        02960000
           CLOSE CC-OVERRIDE-FILE                                       02970000
                 REPORT-FILE.                                           02980000
                                                                        02990000
       9999-EXIT-PROGRAM.                                               03000000
           STOP RUN.                                                    03010000
                                                                        03020000
      /*****************************************************************03030000
      * 1000-INITIALIZATION.                                            03040000
      ******************************************************************03050000
       1000-INITIALIZATION.                                             03060000
                                                                        03070000
           DISPLAY '***********************************************'.   03080000
                                                                        03090000
           OPEN INPUT  CC-OVERRIDE-FILE                                 03100000
                OUTPUT REPORT-FILE.                                     03110000
                                                                        03120000
W33304** NEXT FISCAL WEEK DATES FROM INPUT DATE SETUP....               03130000
RB0404     PERFORM 7000-READ-CC-OVERRIDE-FILE.                          03140000
W33304                                                                  03150000
W33304     IF CC-CONTROL-CCYY NOT NUMERIC                               03160000
W33304        OR CC-CONTROL-MM NOT NUMERIC                              03170000
W33304        OR CC-CONTROL-DD NOT NUMERIC                              03180000
W33304        OR CC-CONTROL-HYPHEN1 NOT = '-'                           03190000
W33304        OR CC-CONTROL-HYPHEN2 NOT = '-'                           03200000
W33304        MOVE +4002                 TO ABEND-CODE                  03210000
W33304        DISPLAY '**  ABEND     **'                                03220000
W33304        DISPLAY '**  PROGRAM   **  =  INKUP174'                   03230000
W33304        DISPLAY '**  INVALID PROCESSING DATE '                    03240000
W33304        CALL 'ILBOABN0'  USING ABEND-CODE                         03250000
W33304     ELSE                                                         03260000
W33304         PERFORM 1100-GET-NEXT-FWEEK-DTATTR                       03270000
RB0404     END-IF.                                                      03280000
                                                                        03290000
      ** OPEN INVENTORY PARMS TABLE...                                  03300000
           EXEC SQL                                                     03310000
               OPEN TINVPAR_CSR                                         03320000
           END-EXEC.                                                    03330000
                                                                        03340000
           EVALUATE SQLCODE                                             03350000
               WHEN +0                                                  03360000
                   CONTINUE                                             03370000
               WHEN OTHER                                               03380000
                   MOVE 'OPEN TINVPAR CURSOR' TO                        03390000
                       PV-DB2-OPERATION-ATTEMPTED                       03400000
                   MOVE '1000-INITIALIZATION' TO                        03410000
                       PV-PARAGRAPH-NAME                                03420000
                   PERFORM 9999-SQL-ABEND                               03430000
           END-EVALUATE.                                                03440000
                                                                        03450000
W33304******************************************************************03460000
W33304* TAKE THE INPUT CONTROL CARD DATE (WHICH SHOULD BE THE SATURDAY  03470000
W33304* RUN DATE AND USE IT TO OBTAIN THE BEGINNING AND ENDING DATES    03480000
W33304* OF THE VERY NEXT FISCAL WEEK. (7 DAYS FOLLOWING INPUT DATE)     03490000
W33304******************************************************************03500000
W33304 1100-GET-NEXT-FWEEK-DTATTR.                                      03510000
W33304                                                                  03520000
W33304     MOVE CC-CONTROL-DATE  TO DTATTR-KY-DTE.                      03530000
W33304                                                                  03540000
W33304     EXEC SQL                                                     03550000
W33304         SELECT KY_DTE                                            03560000
W33304               ,FSCL_WK_BEG_DTE                                   03570000
W33304               ,FSCL_WK_END_DTE                                   03580000
W33304         INTO   :DTATTR-KY-DTE                                    03590000
W33304               ,:DTATTR-FSCL-WK-BEG-DTE                           03600000
W33304               ,:DTATTR-FSCL-WK-END-DTE                           03610000
W33304         FROM TDTATTR                                             03620000
W33304         WHERE KY_DTE = (DATE(DAYS(:DTATTR-KY-DTE)+ 7))           03630000
W33304     END-EXEC.                                                    03640000
RB0404                                                                  03650000
RB0404     EVALUATE SQLCODE                                             03660000
RB0404         WHEN +0                                                  03670000
RB0404             CONTINUE                                             03680000
RB0404         WHEN OTHER                                               03690000
RB0404             MOVE 'SELECT DTATTR      ' TO                        03700000
RB0404                 PV-DB2-OPERATION-ATTEMPTED                       03710000
W33304             MOVE '1100-GET-NEXT-FWEEK-DTATTR' TO                 03720000
                       PV-PARAGRAPH-NAME                                03730000
RB0404             PERFORM 9999-SQL-ABEND                               03740000
RB0404     END-EVALUATE.                                                03750000
RB0404                                                                  03760000
      /*****************************************************************03770000
      * 2000-PROCESS-INVENTORY-DATES.                                   03780000
      ******************************************************************03790000
       2000-PROCESS-INVENTORY-DATES.                                    03800000
                                                                        03810000
      ** FIRST READ OF THE INVENTORY PARMS TABLES....                   03820000
           PERFORM 6000-FETCH-TINVPAR-TABLE.                            03830000
           IF SQLCODE = +100                                            03840000
               DISPLAY ' **************************************** '     03850000
               DISPLAY ' NO STORES FOUND DOING INVENTORY ON TINVPAR'    03860000
               DISPLAY ' **************************************** '     03870000
           ELSE                                                         03880000
RB0404         WRITE REPORT-REC                                         03890000
RB0404               FROM DL-TITLE AFTER ADVANCING 1 LINES              03900000
RB0404         WRITE REPORT-REC                                         03910000
RB0404               FROM DL-HEADING-1 AFTER ADVANCING 2 LINES          03920000
RB0404         WRITE REPORT-REC                                         03930000
RB0404               FROM DL-HEADING-2 AFTER ADVANCING 1 LINES          03940000
RB0404         WRITE REPORT-REC                                         03950000
RB0404               FROM DL-DASHES    AFTER ADVANCING 1 LINES          03960000
RB0404                                                                  03970000
      ** ASSIGN THE INVENTORY JOB NAMES ON THE DAILY BASIS.             03980000
RB0404         PERFORM 3000-LOAD-TABLE-BY-DAY                           03990000
RB0404           UNTIL PS-END-OF-INVPAR-CURSOR                          04000000
                                                                        04010000
           END-IF.                                                      04020000
                                                                        04030000
      ** CLOSE INVENTORY PARMS TABLE...                                 04040000
           EXEC SQL                                                     04050000
               CLOSE TINVPAR_CSR                                        04060000
           END-EXEC.                                                    04070000
                                                                        04080000
           EVALUATE SQLCODE                                             04090000
               WHEN +0                                                  04100000
                   CONTINUE                                             04110000
               WHEN OTHER                                               04120000
                   MOVE 'CLOSE TINVPAR CURSOR' TO                       04130000
                       PV-DB2-OPERATION-ATTEMPTED                       04140000
                   MOVE '2000-PROCESS-INVENTORY' TO                     04150000
                       PV-PARAGRAPH-NAME                                04160000
                   PERFORM 9999-SQL-ABEND                               04170000
           END-EVALUATE.                                                04180000
                                                                        04190000
RB0404/*****************************************************************04200000
RB0404* 3000-LOAD-TABLE-BY-DAY.                                         04210000
RB0404******************************************************************04220000
RB0404 3000-LOAD-TABLE-BY-DAY.                                          04230000
RB0404                                                                  04240000
RB0404     MOVE INVPAR-PLND-INV-DTE TO PV-CUR-PLND-INV-DTE.             04250000
RB0404                                                                  04260000
RB0404     PERFORM 4000-BUILD-JOB-NAMESL                                04270000
RB0404       VARYING INV-DTE-SUB FROM 1 BY 1                            04280000
RB0404       UNTIL PS-END-OF-INVPAR-CURSOR                              04290000
RB0404       OR INVPAR-PLND-INV-DTE NOT = PV-CUR-PLND-INV-DTE.          04300000
RB0404                                                                  04310000
RB0404     MOVE SPACES                TO DL-LINE1.                      04320000
RB0404     WRITE REPORT-REC FROM DL-LINE1 AFTER ADVANCING 1 LINE.       04330000
RB0404                                                                  04340000
RB0404     DISPLAY '*******************************************'.       04350000
RB0404     DISPLAY '*******************************************'.       04360000
RB0404     DISPLAY PV-NBR-OF-STR-IN-DAY                                 04370000
RB0404             ' STORES INVENTORIED ON ' PV-CUR-PLND-INV-DTE.       04380000
RB0404                                                                  04390000
RB0404     MOVE 0 TO PV-NBR-OF-STR-IN-DAY.                              04400000
                                                                        04410000
RB0404/*****************************************************************04420000
RB0404* 4000-BUILD-JOB-NAMESL                                           04430000
RB0404******************************************************************04440000
RB0404 4000-BUILD-JOB-NAMESL.                                           04450000
                                                                        04460000
RB0404     ADD 1               TO PV-NBR-OF-STR-IN-DAY.                 04470000
                                                                        04480000
23511      IF INV-DTE-SUB > 260                                         04490000
               DISPLAY '****************************************** '    04500000
23511          DISPLAY ' MORE THAN 260 STORES ARE INVENTORYING ON '     04510000
                         INVPAR-PLND-INV-DTE                            04520000
               DISPLAY ' TABLE IN PROGRAM MUST BE EXPANDED'             04530000
               DISPLAY '****************************************** '    04540000
               MOVE 'EXCEED MAX STORES ON A DATE'                       04550000
                                       TO PV-ABEND-MESSAGE              04560000
               MOVE '4000-BUILD-JOB-NAMESL        '                     04570000
                                       TO PV-PARAGRAPH-NAME             04580000
               MOVE +4003              TO ABEND-CODE                    04590000
               PERFORM 9999-ABEND                                       04600000
           END-IF.                                                      04610000
                                                                        04620000
25248      MOVE INVPAR-LOC-NBR        TO PV-EDIT-LOC-NBR.               04630000
           MOVE INVPAR-PLND-INV-DTE   TO DL-INV-DTE.                    04640000
                                                                        04650000
22960      MOVE INV-DTE-SUB           TO IN089-REQUESTED-NUMBER.        04660000
22960      PERFORM IN089-1000-BUILD-CODE.                               04670000
22960      MOVE IN089-RESULTING-CHARS TO DL-JOB-LETTERS.                04680000
                                                                        04690000
25248      MOVE INVPAR-LOC-NBR        TO PV-EDIT-LOC-NBR.               04700000
25248      MOVE PV-EDIT-LOC-NBR-ALPH  TO DL-STR-NBR.                    04710000
           MOVE INVPAR-INV-SRVC-CDE   TO DL-SCAN-SERVICE.               04720000
                                                                        04730000
RWJ01      PERFORM 9100-STRING-JOBS.                                    04740000
RWJ01                                                                   04750000
           WRITE REPORT-REC FROM DL-LINE1 AFTER ADVANCING 1 LINE.       04760000
                                                                        04770000
25248      PERFORM 6100-UPDATE-TINVPAR.                                 04780000
25248                                                                   04790000
           PERFORM 6000-FETCH-TINVPAR-TABLE.                            04800000
                                                                        04810000
      /*****************************************************************04820000
      * 6000-FETCH-TINVPAR-TABLE.                                       04830000
      ******************************************************************04840000
       6000-FETCH-TINVPAR-TABLE.                                        04850000
                                                                        04860000
           EXEC SQL                                                     04870000
               FETCH TINVPAR_CSR                                        04880000
25248          INTO  :INVPAR-LOC-NBR                                    04890000
                    ,:INVPAR-PLND-INV-DTE                               04900000
RB0404              ,:INVPAR-INV-SRVC-CDE                               04910000
28545               ,:INVPAR-INV-ID                                     04920000
           END-EXEC.                                                    04930000
                                                                        04940000
           EVALUATE SQLCODE                                             04950000
               WHEN +0                                                  04960000
                   CONTINUE                                             04970000
               WHEN +100                                                04980000
                   SET PS-END-OF-INVPAR-CURSOR TO TRUE                  04990000
               WHEN OTHER                                               05000000
                   MOVE '6000-FETCH-TINVPAR-TABLE'                      05010000
                       TO PV-PARAGRAPH-NAME                             05020000
                   MOVE 'FETCH TINVPAR RECORD' TO                       05030000
                       PV-DB2-OPERATION-ATTEMPTED                       05040000
                   PERFORM 9999-SQL-ABEND                               05050000
           END-EVALUATE.                                                05060000
                                                                        05070000
RB0409******************************************************************05080000
RB0409* 6100-UPDATE-TINVPAR.                                            05090000
RB0409******************************************************************05100000
RB0409 6100-UPDATE-TINVPAR.                                             05110000
                                                                        05120000
25248      MOVE DL-JOB1            TO INVPAR-JOB-NM.                    05130000
RB0409                                                                  05140000
RB0409     EXEC SQL                                                     05150000
RB0409         UPDATE TINVPAR                                           05160000
RB0409         SET JOB_NM = :INVPAR-JOB-NM                              05170000
25248          WHERE LOC_NBR = :INVPAR-LOC-NBR                          05180000
RB0409           AND PLND_INV_DTE = :INVPAR-PLND-INV-DTE                05190000
RB0409           AND INV_ID       = :INVPAR-INV-ID                      05200000
RB0409     END-EXEC.                                                    05210000
RB0409                                                                  05220000
RB0409     EVALUATE SQLCODE                                             05230000
RB0409         WHEN +0                                                  05240000
RB0409             CONTINUE                                             05250000
RB0409         WHEN OTHER                                               05260000
RB0409             MOVE '6100-UPDATE-TINVPAR'                           05270000
RB0409                 TO PV-PARAGRAPH-NAME                             05280000
RB0409             MOVE 'UPDATE TINVPAR RECORD' TO                      05290000
RB0409                 PV-DB2-OPERATION-ATTEMPTED                       05300000
RB0409             PERFORM 9999-SQL-ABEND                               05310000
RB0409     END-EVALUATE.                                                05320000
RB0409                                                                  05330000
      ******************************************************************05340000
      * 7000-READ-CC-OVERRIDE-FILE.                                     05350000
      ******************************************************************05360000
RB0404 7000-READ-CC-OVERRIDE-FILE.                                      05370000
                                                                        05380000
RB0404     READ CC-OVERRIDE-FILE INTO CC-CONTROL-CARD                   05390000
               AT END                                                   05400000
RB0404            SET PS-CC-OVERRIDE-EOF TO TRUE.                       05410000
                                                                        05420000
RB0404     IF NOT PS-CC-OVERRIDE-EOF                                    05430000
RB0404         DISPLAY 'INPUT CONTROL CARD DATE: ' CC-CONTROL-CARD      05440000
           END-IF.                                                      05450000
                                                                        05460000
RB0409******************************************************************05470000
  |   * 9100-STRING JOB NAMES FOR THE REPORT.                           05480000
W33304* W33304 HILO NOTE: THE INVPAR-INV-SRVC-CDE THAT POPULATES        05490000
W33304* DL-SCAN-SERVICE IS BEING REDUCED FRM 4 BYTES TO 2 BYTES. THE    05500000
W33304* 4 BYTE LENGTH IS KEPT BECAUSE OF A SUBSEQUENT UTILITY PROGRAM   05510000
W33304* THAT EXPECTS A 4 BYTE CODE.                                     05520000
  |   ******************************************************************05530000
  |    9100-STRING-JOBS.                                                05540000
  |                                                                     05550000
W33304     IF DL-SCAN-SERVICE = 'RG'                                    05560000
  |            STRING 'INK908' DELIMITED BY SIZE                        05570000
  |                   DL-JOB-LETTERS DELIMITED BY SIZE INTO DL-JOB1     05580000
216916*        STRING 'INK912' DELIMITED BY SIZE                        05590000
216916*               DL-JOB-LETTERS DELIMITED BY SIZE INTO DL-JOB2     05600000
RWJ01      ELSE                                                         05610000
W33304     IF DL-SCAN-SERVICE = 'WI'                                    05620000
24029          STRING 'INK908' DELIMITED BY SIZE                        05630000
24029                 DL-JOB-LETTERS DELIMITED BY SIZE INTO DL-JOB1     05640000
216916*        STRING 'INK911' DELIMITED BY SIZE                        05650000
216916*               DL-JOB-LETTERS DELIMITED BY SIZE INTO DL-JOB2     05660000
216916*    ELSE                                                         05670000
216916*    IF DL-SCAN-SERVICE = 'WE'                                    05680000
216916*        STRING 'INK908' DELIMITED BY SIZE                        05690000
216916*               DL-JOB-LETTERS DELIMITED BY SIZE INTO DL-JOB1     05700000
216916*        STRING 'INK913' DELIMITED BY SIZE                        05710000
216916*               DL-JOB-LETTERS DELIMITED BY SIZE INTO DL-JOB2     05720000
  |        END-IF.                                                      05730000
RWJ01                                                                   05740000
      ******************************************************************05750000
      *IN089-1000-BUILD-CODE.                                           05760000
      *    GET/BUILD THE TWO-CHARACTER CODE FOR THE JOB NAME            05770000
      ******************************************************************05780000
           COPY INPD089.                                                05790000
                                                                        05800000
      ******************************************************************05810000
      *  THIS ROUTINE FORCES AN ABEND DUE TO A NON-DB2 RELATED PROBLEM. 05820000
      ******************************************************************05830000
       9999-ABEND.                                                      05840000
                                                                        05850000
           DISPLAY '**  ABEND     **'.                                  05860000
           DISPLAY '**  PROGRAM   **  = INKUP174'                       05870000
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            05880000
           DISPLAY '**  ' PV-ABEND-MESSAGE.                             05890000
           CALL 'ILBOABN0'  USING ABEND-CODE.                           05900000
                                                                        05910000
      ******************************************************************05920000
      * 9999-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      05930000
      * EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 05940000
      ******************************************************************05950000
       9999-SQL-ABEND.                                                  05960000
                                                                        05970000
           DISPLAY '** ABEND     **'.                                   05980000
           DISPLAY '** PROGRAM   ** = INKUP174'.                        05990000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              06000000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     06010000
                                                                        06020000
      ******************************************************************06030000
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    06040000
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         06050000
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06060000
      * FORMAT.                                                         06070000
      ******************************************************************06080000
           COPY DPPD004.                                                06090000
                                                                        06100000
           MOVE +4013 TO ABEND-CODE.                                    06110000
           CALL 'ILBOABN0' USING ABEND-CODE.                            06120000
                                                                        06130000
