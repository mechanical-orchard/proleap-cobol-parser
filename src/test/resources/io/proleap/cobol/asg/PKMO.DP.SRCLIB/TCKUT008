000010 IDENTIFICATION DIVISION.                                         00001000
000020 PROGRAM-ID.               TCKUT008.                              00002000
000030 AUTHOR.                   JIM MYERS.                             00003000
000040 INSTALLATION.             KOHLS DEPARTMENT STORES.               00004000
000050 DATE-WRITTEN.             APRIL 19, 2002.                        00005000
000060 DATE-COMPILED.                                                   00006000
000070*----------------------------------------------------------------*00007000
000080*     CREATE SETTLEMENT FILE FOR FIFTH THIRD BANK                *00008000
000090*----------------------------------------------------------------*00009000
000091*----------------------------------------------------------------*00009100
000092*  PROGRAM NARRATIVE:                                            *00009200
000093*                                                                *00009300
000094*   PROGRAM PRODUCES THE DAILY BANKCARD TRANSMISSION FILE        *00009400
000095*   WHICH REFLECTS THE BANKCARD ACTIVITY FOR A GIVEN DATE.       *00009500
000096*   THIS PROGRAM READS A FLAT FILE CREATED FROM COSA DATA.       *00009600
000097*                                                                *00009700
000098*----------------------------------------------------------------*00009800
000099*                                                                *00009900
P9696 * DATE:        2014-01-16                                        *00010000
P9696 * WR/IR#:      P9696 - AJB SETTLEMENT                            *00010100
P9696 * PROGRAMMER:  COGNIZANT                                         *00010200
P9696 * DESCRIPTION: ADDED NEW OUTPUT FILE(AJB-SETTLEMENT-FILE) TO THE *00010300
P9696 *              PROGRAM WITH LENGTH 328. COPIED THE RECORDS IN    *00010400
P9696 *              TCRD005 LAYOUT TO TCRD011 LAYOUT.                 *00010500
P9696 *              POPULATED TRAILER FIELD OF TCRD011 COPYBOOK WITH  *00010600
P9696 *              TOTAL DOLLAR AMOUNT AND TOTAL NUMBER OF RECORDS   *00010700
P9696 *              COPIED.                                           *00010800
P9696 *              WRITE AJB-SETTLEMENT-FILE FROM TCRD011 LAYOUT.    *00010900
P9696 *              TCRD011 IS A NEW COPYBOOK CLONED COPY FROM TCRD005*00011000
P9696 *              LAYOUT WITHOUT COMP VARIABLES.                    *00011100
000103*----------------------------------------------------------------*00011200
SHIP  * DATE:        03/20/2019                                        *00011300
SHIP  * WR/IR#:      CHG0220426                                        *00011400
SHIP  * PROGRAMMER:  BARB SCHULTZ                                      *00011500
SHIP  * DESCRIPTION: MOVED 3 NEW FIELDS FROM TCRD005 TO TCRD011.       *00011600
SHIP  *              THIS WAS DONE FOR THE SETTLE BY SHIP PROJECT.     *00011800
SHIP  *----------------------------------------------------------------*00011900
SHIP2 * DATE:        01/21/2020                                        *00012000
SHIP2 * WR/IR#:      CHG0233046                                        *00012100
SHIP2 * PROGRAMMER:  BARB SCHULTZ                                      *00012200
SHIP2 * DESCRIPTION: DELETED THE MC FIELDS SO MC WOULD USE THE VISA    *00012300
SHIP2 *              FIELDS. BOTH VISA AND MC ARE GOING TO BE USING    *00012400
SHIP2 *              THE SAME MULT CLEAR FIELDS FROM THE DATABASE.     *00012600
SHIP2 *              MOVED THE PARTIAL SHIPMENT INDICATOR TO THE AJB   *00012700
SHIP2 *              FILE.                                             *00012800
000102*                                                                *00013000
052523*----------------------------------------------------------------*00013100
052523*  CHANGE MADE: ADD CHANGES FOR NEW COBRAND TENDER TYPE           00013200
052523*               ADD CHANGES FOR NEW COBRAND PAYMENTS              00013300
052523*  DATE: 05/25/2023                                               00013400
052523*  MADE BY: DAN PAYNTER              WR/IR #: CHG0289014          00013501
000103*----------------------------------------------------------------*00013700
000104 ENVIRONMENT DIVISION.                                            00013800
000105                                                                  00013900
000106                                                                  00014000
000107 CONFIGURATION SECTION.                                           00014100
000108                                                                  00014200
000109 SOURCE-COMPUTER.    IBM-3090.                                    00014300
000110 OBJECT-COMPUTER.    IBM-3090.                                    00014400
000111                                                                  00014500
000112                                                                  00014600
000113 INPUT-OUTPUT SECTION.                                            00014700
000114                                                                  00014800
000115 FILE-CONTROL.                                                    00014900
000116                                                                  00015000
000117     SELECT CONTROL-CARD-FILE          ASSIGN TO INP01.           00015100
000118     SELECT CREDIT-SETTLE-FILE         ASSIGN TO INP02.           00015200
000119     SELECT BANKCARD-TRANSMIT-FILE     ASSIGN TO OUT01.           00015300
P9696      SELECT AJB-SETTLEMENT-FILE        ASSIGN TO OUT02.           00015400
000120     EJECT                                                        00015500
000121                                                                  00015600
000122 DATA DIVISION.                                                   00015700
000123                                                                  00015800
000124 FILE SECTION.                                                    00015900
000125                                                                  00016000
000126 FD  CONTROL-CARD-FILE                                            00016100
000127     RECORDING MODE IS F                                          00016200
000128     BLOCK CONTAINS 0 RECORDS                                     00016300
000129     LABEL RECORDS ARE STANDARD.                                  00016400
000130                                                                  00016500
000131 01  CONTROL-CARD-RECORD              PIC X(80).                  00016600
000132                                                                  00016700
000133 FD  CREDIT-SETTLE-FILE                                           00016800
000134     RECORDING MODE IS F                                          00016900
000135     BLOCK CONTAINS 0 RECORDS                                     00017000
000136     LABEL RECORDS ARE STANDARD.                                  00017100
000137                                                                  00017200
000138 01  CREDIT-SETTLE-RECORD             PIC X(298).                 00017300
000139                                                                  00017400
000140 FD  BANKCARD-TRANSMIT-FILE                                       00017500
000141     RECORDING MODE IS F                                          00017600
000142     BLOCK CONTAINS 0                                             00017700
000143     LABEL RECORDS ARE STANDARD.                                  00017800
000144                                                                  00017900
000145 01  BANKCARD-TRANSMIT-RECORD         PIC X(80).                  00018000
P9696                                                                   00018100
P9696  FD  AJB-SETTLEMENT-FILE                                          00018200
P9696      RECORDING MODE IS F                                          00018300
P9696      BLOCK CONTAINS 0                                             00018400
P9696      LABEL RECORDS ARE STANDARD.                                  00018500
P9696                                                                   00018600
P9696  01  AJB-SETTLEMENT-RECORD            PIC X(328).                 00018700
000146                                                                  00018800
000147                                                                  00018900
000148 WORKING-STORAGE SECTION.                                         00019000
000149                                                                  00019100
000150 01  FILLER                           PIC X(32)  VALUE            00019200
000151     'TCKUT008 WORKING STORAGE BEGINS:'.                          00019300
000152                                                                  00019400
000153******************************************************************00019500
000154* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    00019600
000155******************************************************************00019700
000156 01  CC-CONTROL-CARD.                                             00019800
000157     05  CC-DATE-MMDDCCYY.                                        00019900
000158         10 CC-DATE-MMDD              PIC 9(04)    VALUE ZEROES.  00020000
000159         10 CC-DATE-CC                PIC 9(02)    VALUE ZEROES.  00020100
000160         10 CC-DATE-YY                PIC 9(02)    VALUE ZEROES.  00020200
000161     05  CC-SEQ-NUMBER                PIC 9(03)    VALUE ZEROES.  00020300
000162     05  FILLER                       PIC X(69)    VALUE SPACE.   00020400
000163                                                                  00020500
000164 01  PC-PROGRAM-CONSTANTS.                                        00020600
000165                                                                  00020700
000166*        -- MISCELLANEOUS CONSTANTS/LITERALS --                   00020800
000167                                                                  00020900
000168     05  PC-PROGRAM-NUMBER            PIC X(08)      VALUE        00021000
000169         'TCKUT008'.                                              00021100
000170     05  PC-KOHLS-OPERATING-COMPANY   PIC X(02)      VALUE '03'.  00021200
000171     05  PC-DEPARTMENT-STORE-TYPE     PIC X(02)      VALUE 'DS'.  00021300
000172                                                                  00021400
000173*        -- MESSAGES --                                           00021500
000174                                                                  00021600
000175     05  PC-START-PGM-MSSG            PIC X(06)      VALUE        00021700
000176         'START '.                                                00021800
000177     05  PC-NORMAL-EOJ-MSSG           PIC X(13)      VALUE        00021900
000178         '- NORMAL EOJ '.                                         00022000
000179     05  PC-ABEND-MSSG                PIC X(12)      VALUE        00022100
000180         '** ABEND ** '.                                          00022200
000181     05  PC-CAL-SUB-TRN-DTE-ERROR     PIC X(42)      VALUE        00022300
000182         'CAL SUBROUTINE ERROR ON TRN DTE CONVERSION'.            00022400
000183     05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        00022500
000184         'DB2 ERROR'.                                             00022600
000185     05  PC-DB-ATTEMPTING-MSSG        PIC X(14)      VALUE        00022700
000186         'ATTEMPTING TO '.                                        00022800
000187                                                                  00022900
000188 01  PS-PROCESS-SWITCHES.                                         00023000
000189     05  PS-END-OF-CONTROL-FILE-SW    PIC X(01)      VALUE 'N'.   00023100
000190         88  PS-NOT-END-CONTROL-FILE                 VALUE 'N'.   00023200
000191         88  PS-END-OF-CONTROL-FILE                  VALUE 'Y'.   00023300
000192     05  PS-END-OF-INPUT-SW           PIC X(01)      VALUE 'N'.   00023400
000193         88  PS-NOT-END-OF-INPUT                     VALUE 'N'.   00023500
000194         88  PS-END-OF-INPUT                         VALUE 'Y'.   00023600
000195                                                                  00023700
000199     EJECT                                                        00023800
000200 01  PV-PROGRAM-VARIABLES.                                        00023900
000201     05  PV-SAVE-MERCHANT-NO          PIC 9(15)      VALUE ZEROS. 00024000
000202     05  PV-SLS-TAX-AMT               PIC 9(8)V99   VALUE ZEROS.  00024100
000202     05  PV-SLS-TAX-AMT-1           REDEFINES PV-SLS-TAX-AMT.     00024200
               10  PV-SLS-TAX-DV             PIC 9(8).                  00024300
               10  PV-SLS-TAX-CV             PIC 9(2).                  00024400
000203     05  PV-ISO-CCYY-MM-DD.                                       00024500
000204         10  PV-ISO-CCYY.                                         00024600
000205             15  PV-ISO-CC            PIC 9(02)      VALUE ZEROS. 00024700
000206             15  PV-ISO-YY            PIC 9(02)      VALUE ZEROS. 00024800
000207         10  FILLER                   PIC X(01)      VALUE SPACES.00024900
000208         10  PV-ISO-MMDD.                                         00025000
000209             15  PV-ISO-MM            PIC 9(02)      VALUE ZEROS. 00025100
000210             15  FILLER               PIC X(01)      VALUE SPACES.00025200
000211             15  PV-ISO-DD            PIC 9(02)      VALUE ZEROS. 00025300
000212     05  PV-SALES-CCYYMMDD.                                       00025400
000213         10  PV-SALES-MMDDYY.                                     00025500
000214             15  PV-SALES-MMDD.                                   00025600
000215                 20  PV-SALES-MM      PIC 9(02)      VALUE ZEROS. 00025700
000216                 20  PV-SALES-DD      PIC 9(02)      VALUE ZEROS. 00025800
000217             15  PV-SALES-YY          PIC 9(02)      VALUE ZEROS. 00025900
000218     05  PV-TRAN-YYMMDD.                                          00026000
000219         10  PV-TRAN-YY               PIC 9(02)      VALUE ZEROS. 00026100
000220         10  PV-TRAN-MMDD.                                        00026200
000221             15  PV-TRAN-MM           PIC 9(02)      VALUE ZEROS. 00026300
000222             15  PV-TRAN-DD           PIC 9(02)      VALUE ZEROS. 00026400
000223     05  PV-BNKNET.                                               00026500
000224         10  PV-BNKNET-NBR            PIC X(09)      VALUE SPACES.00026600
000225         10  PV-BNKNET-DTE            PIC X(04)      VALUE SPACES.00026700
000226     05  PV-FMT-MERCHANT.                                         00026800
000227*        10  PV-MERCHANT              PIC X(13)      VALUE SPACES.00026900
000228         10  PV-MERCHANT              PIC 9(13)      VALUE ZEROES.00027000
000229         10  PV-MERCHANT-S            PIC X(03)      VALUE SPACES.00027100
000230     05  PV-FMT-MERCHANT-R REDEFINES PV-FMT-MERCHANT              00027200
000231                                      PIC X(16).                  00027300
000232*    05  PV-FMT-MER-NBR.                                          00027400
000233*        10  PV-MER-SPACES            PIC X(03)      VALUE SPACES.00027500
000234*        10  PV-MER-NBR               PIC X(13)      VALUE SPACES.00027600
000235*    05  PV-FMT-DB2-MER-NBR.                                      00027700
000236*        10  PV-MER-ZEROES-D          PIC 9(05)      VALUE ZEROES.00027800
000237*        10  PV-MER-NBR-D             PIC 9(13)      VALUE ZEROES.00027900
000238*    05  PV-FMT-DB2-MER-NBR-R REDEFINES PV-FMT-DB2-MER-NBR        00028000
000239*                                     PIC 9(18).                  00028100
000240                                                                  00028200
000244     05  PV-FMT-MER-NAME.                                         00028300
000245         10  PV-FMT-HRD-NAME          PIC X(08)      VALUE SPACES.00028400
000246         10  PV-FMT-STR-NBR           PIC 9(04)      VALUE ZEROES.00028500
000247     05  PV-ZIP-CODE.                                             00028600
000248         10  PV-ZIP-CODE-5            PIC X(05)      VALUE SPACES.00028700
000249         10  PV-ZIP-CODE-DASH         PIC X(01)      VALUE SPACES.00028800
000250         10  PV-ZIP-CODE-3            PIC X(03)      VALUE SPACES.00028900
000251         10  PV-ZIP-CODE-1            PIC X(01)      VALUE SPACES.00029000
000252     05  PV-ZIP-CODE-9.                                           00029100
000253         10  PV-ZIP-CODE-59           PIC X(05)      VALUE ZEROES.00029200
000254         10  PV-ZIP-CODE-PLUS49       PIC X(04)      VALUE ZEROES.00029300
000255     05  PV-ZIP-CODE-9RE REDEFINES PV-ZIP-CODE-9 PIC X(09).       00029400
000256     05  PV-ZIP-CODE-COMB.                                        00029500
000257         10  PV-ZIP-CODE-COMB-1       PIC 9(01)      VALUE ZEROES.00029600
000258         10  PV-ZIP-CODE-COMB-3       PIC 9(03)      VALUE ZEROES.00029700
000259     05  PV-ZIP-CODE-COMB-RE REDEFINES PV-ZIP-CODE-COMB PIC 9(04).00029800
000260     05  PV-ZIP-CODE-COM.                                         00029900
000261         10  PV-ZIP-CODE-COM-3        PIC 9(03)      VALUE ZEROES.00030000
000262         10  PV-ZIP-CODE-COM-1        PIC 9(01)      VALUE ZEROES.00030100
000263     05  PV-ZIP-CODE-COM-RE REDEFINES PV-ZIP-CODE-COM PIC 9(04).  00030200
000264     05  PV-RGST-TRN-ID.                                          00030300
000265         10  PV-RGST-ID               PIC X(04)      VALUE SPACES.00030400
000266         10  PV-TRN-ID                PIC X(04)      VALUE SPACES.00030500
000267     05  PV-PARAGRAPH-NAME            PIC X(30)      VALUE SPACES.00030600
000268     05  PV-OPERATION-MSG-1           PIC  X(40)     VALUE SPACE. 00030700
000269     05  PV-OPERATION-MSG-2           PIC  X(40)     VALUE SPACE. 00030800
000270     05  PV-DB2-ERROR-MSSG            PIC X(40)      VALUE SPACE. 00030900
000271         88  PV-SELECT-STORE-ROW                     VALUE        00031000
000272             'SELECT A ROW FROM THE XST00001 TABLE'.              00031100
000273     05  PV-4-DIGIT-STORE             PIC S9(04)  COMP.           00031200
000274*    05  PV-3-DIGIT-STORE             PIC 9(03)      VALUE ZEROS. 00031300
000275*    05  PV-3-CHAR-STORE  REDEFINES  PV-3-DIGIT-STORE             00031400
000276*                                     PIC X(03).                  00031500
000277     05  PV-STR-NBR                   PIC 9(04)      VALUE ZEROS. 00031600
000278     05  PV-CONTROL-NBR.                                          00031700
000279         10  PV-CN-JDAY               PIC 9(07)      VALUE ZEROS. 00031800
000280         10  PV-CN-SEQ-NBR            PIC 9(03)      VALUE ZEROS. 00031900
000281     05  PV-TIME.                                                 00032000
000282         10  PV-HH                    PIC 9(02)      VALUE ZEROS. 00032100
000283         10  PV-MI                    PIC 9(02)      VALUE ZEROS. 00032200
000284         10  FILLER                   PIC 9(04)      VALUE ZEROS. 00032300
000285     05  PV-HOLD-STORE-NMBR           PIC 9(04)      VALUE ZEROS. 00032400
000286     05  PV-ADDM-SEQ-NUM              PIC S9(01)     VALUE ZEROS. 00032500
000286     05  PV-TRK-DAT-CND-CDE.                                      00032600
001060         10  PV-TRK-DAT-CND-CDE1      PIC 9(01).                  00032700
001060         10  PV-TRK-DAT-CND-CDE2      PIC 9(01).                  00032800
000287     05  PV-TRAN-TYPE                 PIC X(02)  VALUE SPACES.    00032900
000287         88  PV-DISC-TRANS                       VALUE '01',      00033000
000287                                                       '02',      00033100
000287                                                       '11',      00033200
000287                                                       '12',      00033300
000287                                                       '23',      00033400
000287                                                       '24',      00033500
000287                                                       '25'.      00033600
000287         88  PV-DISC-SALE                        VALUE '01'.      00033700
000287         88  PV-DISC-ASSOC-SALE                  VALUE '02'.      00033800
000287         88  PV-DISC-RETURN                      VALUE '11'.      00033900
000287         88  PV-DISC-ASSOC-RETURN                VALUE '12'.      00034000
000287         88  PV-DISC-ADJUSTMENT                  VALUE '23',      00034100
000287                                                       '24',      00034200
000287                                                       '25'.      00034300
000287                                                                  00034400
000287* 003000 - SALE FROM CREDIT CARD ACCOUNT                          00034500
000287* 200030 - RETURN TO CREDIT CARD ACCOUNT                          00034600
000287     05  PV-DISCVR-PROC-CDE       PIC X(06).                      00034700
000287         88  PV-DISCVR-SALE                   VALUE '003000'.     00034800
000288         88  PV-DISCVR-RETURN                 VALUE '200030'.     00034900
000287                                                                  00035000
000287     05  PV-POS-DATA.                                             00035100
000289         10  PV-POS-DEVICE            PIC X(01).                  00035200
000290             88  PV-POS-ATTENDED                VALUE '0'.        00035300
000291             88  PV-POS-UNATTENDED              VALUE '1'.        00035400
000292             88  PV-NO-POS                      VALUE '2'.        00035500
000293             88  PV-POS-UNKNOWN                 VALUE '9'.        00035600
000294         10  PV-PARTIAL-APPROVED      PIC X(01).                  00035700
000295             88  PV-PART-NOT-SUPPORT            VALUE '0'.        00035800
000296             88  PV-PART-APP-PART-APP           VALUE '1'.        00035900
000297             88  PV-PART-APP-CASH-FULL-APP      VALUE '2'.        00036000
000298             88  PV-PART-APP-CASH-PART-APP      VALUE '3'.        00036100
000299             88  PV-PART-APP-FULL-APP           VALUE '4'.        00036200
000300         10  PV-POS-LOCATION          PIC X(01).                  00036300
000301             88  PV-POS-ON-PREMISES             VALUE '0'.        00036400
000302             88  PV-POS-OFF-PREMISES            VALUE '1'.        00036500
000303             88  PV-POS-HOME-PC                 VALUE '2'.        00036600
000304             88  PV-NO-POS                      VALUE '3'.        00036700
000305             88  PV-POS-UNKNOWN                 VALUE '9'.        00036800
000306         10  PV-POS-CARDHOLDER        PIC X(01).                  00036900
000307             88  PV-CARDHOLD-PRESENT            VALUE '0'.        00037000
000308             88  PV-CARDHOLD-NOT-PRESENT        VALUE '1'.        00037100
000309             88  PV-CARDHOLD-NT-PRES-MAIL       VALUE '2'.        00037200
000310             88  PV-CARDHOLD-NT-PRES-TELE       VALUE '3'.        00037300
000311             88  PV-CARDHOLD-NT-PRES-ORDER      VALUE '4'.        00037400
000312             88  PV-CARDHOLD-ELEC-ORDER         VALUE '5'.        00037500
000313             88  PV-CARDHOLD-UNKNOWN            VALUE '9'.        00037600
000314         10  PV-POS-CARD-PRESENCE     PIC X(01).                  00037700
000315             88  PV-CARD-PRESENT                VALUE '0'.        00037800
000316             88  PV-CARD-NOT-PRESENT            VALUE '1'.        00037900
000317             88  PV-CARD-UNKNOWN                VALUE '9'.        00038000
000318         10  PV-POS-CARD-CAPTURE      PIC X(01).                  00038100
000319             88  PV-POS-DEV-NO-CARD-CAP         VALUE '0'.        00038200
000320             88  PV-POS-DEV-CARD-CAP            VALUE '1'.        00038300
000321             88  PV-POS-DEV-UNKNOWN             VALUE '9'.        00038400
000322         10  PV-POS-TRAN-STATUS       PIC X(01).                  00038500
000323             88  PV-POS-TRAN-NORMAL             VALUE '0'.        00038600
000324             88  PV-POS-TRAN-PREAUTH-REQ        VALUE '4'.        00038700
000325         10  PV-POS-TRAN-SECURITY     PIC X(01).                  00038800
000326             88  PV-POS-TRAN-NO-CONCERN         VALUE '0'.        00038900
000327             88  PV-POS-TRAN-FRAUD              VALUE '1'.        00039000
000328             88  PV-POS-TRAN-ID-VERIFIED        VALUE '2'.        00039100
000329             88  PV-POS-TRAN-CARDHOLD-VER       VALUE '3'.        00039200
000330             88  PV-POS-TRAN-UNKNOWN            VALUE '9'.        00039300
000331         10  PV-RESERVED              PIC X(02) VALUE '00'.       00039400
000332         10  PV-POS-DEVICE-INPUT-CAP  PIC X(01).                  00039500
000333             88  PV-POS-DEV-UNSPECIFIED         VALUE '0'.        00039600
000334             88  PV-POS-VOICE                   VALUE '1'.        00039700
000335             88  PV-POS-MAG-STRIP-READER        VALUE '2'.        00039800
000336             88  PV-POS-BAR-CODE                VALUE '3'.        00039900
000337             88  PV-POS-OPTICAL-CHAR-REC        VALUE '4'.        00040000
000338             88  PV-POS-CIRCUIT-CARD-READ       VALUE '5'.        00040100
000339             88  PV-POS-KEY-ENTRY               VALUE '6'.        00040200
000340             88  PV-POS-MAG-KEY                 VALUE '7'.        00040300
000341             88  PV-POS-RFID                    VALUE 'R'.        00040400
000342             88  PV-POS-SET-W-CERT              VALUE 'S'.        00040500
000343             88  PV-POS-SET-WO-CERT             VALUE 'T'.        00040600
000344             88  PV-POS-SSL                     VALUE 'U'.        00040700
000345             88  PV-POS-NON-SEC-ECT             VALUE 'V'.        00040800
000346         10  PV-RESERVED-1            PIC X(02) VALUE '00'.       00040900
000347                                                                  00041000
000348 01  PV-BATCH-TOTALS.                                             00041100
000349     05  PV-BATCH-DETAIL-CNT  COMP-3  PIC S9(07)     VALUE ZEROS. 00041200
000350     05  PV-BATCH-SEQ-NBR     COMP-3  PIC S9(07)     VALUE ZEROS. 00041300
000351     05  PV-BATCH-SALES-TOT   COMP-3  PIC S9(08)V99  VALUE ZEROS. 00041400
000352     05  PV-BATCH-SALES-CNT   COMP-3  PIC S9(07)     VALUE ZEROS. 00041500
000353     05  PV-BATCH-RETURNS-TOT COMP-3  PIC S9(08)V99  VALUE ZEROS. 00041600
000354     05  PV-BATCH-RETURNS-CNT COMP-3  PIC S9(07)     VALUE ZEROS. 00041700
052523     05  PV-BATCH-PAYMENT-TOT COMP-3  PIC S9(08)V99  VALUE ZEROS. 00041800
052523     05  PV-BATCH-PAYMENT-CNT COMP-3  PIC S9(07)     VALUE ZEROS. 00041900
000355                                                                  00042000
000356 01  PV-FILE-TOTALS.                                              00042100
000357     05  PV-FILE-BATCH-CNT    COMP-3  PIC S9(07)     VALUE ZEROS. 00042200
000358     05  PV-FILE-SALES-TOT    COMP-3  PIC S9(09)V99  VALUE ZEROS. 00042300
000359     05  PV-FILE-SALES-CNT    COMP-3  PIC S9(07)     VALUE ZEROS. 00042400
000360     05  PV-FILE-RETURNS-TOT  COMP-3  PIC S9(09)V99  VALUE ZEROS. 00042500
000361     05  PV-FILE-RETURNS-CNT  COMP-3  PIC S9(09)     VALUE ZEROS. 00042600
052523     05  PV-FILE-PAYMENT-TOT  COMP-3  PIC S9(09)V99  VALUE ZEROS. 00042700
052523     05  PV-FILE-PAYMENT-CNT  COMP-3  PIC S9(09)     VALUE ZEROS. 00042800
000362                                                                  00042900
000363 01  PV-JOB-COUNTS.                                               00043000
000364     05  PV-CNT-READ-COUNT    COMP-3  PIC S9(09)     VALUE ZEROES.00043100
000365     05  PV-CNT-DETAIL-REC    COMP-3  PIC S9(09)     VALUE ZEROES.00043200
000366     05  PV-CNT-VISA1-ADDM    COMP-3  PIC S9(09)     VALUE ZEROES.00043300
000367     05  PV-CNT-VISA2-ADDM    COMP-3  PIC S9(09)     VALUE ZEROES.00043400
000368     05   PV-CNT-MSCARD-ADDM  COMP-3  PIC S9(09)     VALUE ZEROES.00043500
000369     05  PV-CNT-AMEX1-ADDM    COMP-3  PIC S9(09)     VALUE ZEROES.00043600
000369     05  PV-CNT-AMEX2-ADDM    COMP-3  PIC S9(09)     VALUE ZEROES.00043700
000369     05  PV-CNT-DISC1-ADDM    COMP-3  PIC S9(09)     VALUE ZEROES.00043800
000369     05  PV-CNT-DISC2-ADDM    COMP-3  PIC S9(09)     VALUE ZEROES.00043900
000370     05  PV-CNT-BATCH-COUNT   COMP-3  PIC S9(09)     VALUE ZEROES.00044000
P9696                                                                   00044100
P9696  01  PV-OUT2-TOTAL.                                               00044200
P9696      05  PV-TOT-TNDR-AMT      COMP-3  PIC S9(09)V99  VALUE ZEROES.00044300
P9696      05  PV-REC-COUNT         COMP-3  PIC 9(09)      VALUE ZEROES.00044400
P9696      05  PV-TOT-TNDR-AMT-DISP         PIC -9(09).99  VALUE ZEROES.00044500
P9696                                                                   00044600
000371     EJECT                                                        00044700
000372 01  ABEND-CODE  COMP                 PIC S9(04)     VALUE ZEROS. 00044800
000373     88  ABEND-4003-INVALID-CC                       VALUE +4003. 00044900
000374     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00045000
000375     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00045100
000376     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 00045200
000377     88  ABEND-4008-INV-TNDR-TYPE-CDE                VALUE +4008. 00045300
000378*----------------------------------------------------------------*00045400
000379*  DATE VALIDATION CALLING PARAMETER LIST                        *00045500
000380*----------------------------------------------------------------*00045600
000381     COPY DPWS500.                                                00045700
000382*----------------------------------------------------------------*00045800
000383*    STANDARD FILE LAYOUT FOR THE INPUT EXTRACT FILE             *00045900
000384*----------------------------------------------------------------*00046000
000385     COPY TCRD005.                                                00046100
000386*----------------------------------------------------------------*00046200
000387*    STANDARD FILE LAYOUT FOR THE OUTPUT BANKCARD FILE           *00046300
000388*----------------------------------------------------------------*00046400
000389     COPY TCRD006.                                                00046500
P9696 *----------------------------------------------------------------*00046600
P9696 *    STANDARD FILE LAYOUT FOR THE OUTPUT AJB SETTLEMENT FILE     *00046700
P9696 *----------------------------------------------------------------*00046800
P9696      COPY TCRD011.                                                00046900
000390*----------------------------------------------------------------*00047000
000391*    STANDARD DB2 ERROR HANDLING AREA                            *00047100
000392*----------------------------------------------------------------*00047200
000393     COPY DPWS004.                                                00047300
000394*----------------------------------------------------------------*00047400
000395*    LOCATION DOMAIN TABLE                                       *00047500
000396*----------------------------------------------------------------*00047600
000397     EXEC SQL                                                     00047700
000398         INCLUDE XST00001                                         00047800
000399     END-EXEC.                                                    00047900
000400*----------------------------------------------------------------*00048000
000401*    LOCATION ATTRIBUTE TABLE                                    *00048100
000402*----------------------------------------------------------------*00048200
000403     EXEC SQL                                                     00048300
000404         INCLUDE XST00025                                         00048400
000405     END-EXEC.                                                    00048500
000406*----------------------------------------------------------------*00048600
000407*    STANDARD DB2 COMMUNICATIONS AREA                            *00048700
000408*----------------------------------------------------------------*00048800
000409     EXEC SQL                                                     00048900
000410         INCLUDE SQLCA                                            00049000
000411     END-EXEC.                                                    00049100
000412*----------------------------------------------------------------*00049200
000413 PROCEDURE DIVISION.                                              00049300
000414*----------------------------------------------------------------*00049400
000415     DISPLAY PC-START-PGM-MSSG   PC-PROGRAM-NUMBER.               00049500
000416     ACCEPT PV-TIME FROM TIME.                                    00049600
000417                                                                  00049700
000418     PERFORM 1000-INITIALIZE.                                     00049800
000419                                                                  00049900
000420     PERFORM 2000-READ-CREDIT-SETTLE-FILE.                        00050000
000421                                                                  00050100
000422     IF PS-NOT-END-OF-INPUT                                       00050200
000423         PERFORM 8000-CREATE-XMIT-FILE-HEADER                     00050300
000424         PERFORM 8200-CREATE-BATCH-HEADER                         00050400
000425                                                                  00050500
000426         MOVE TC005-SETTLE-STORE-NBR                              00050600
000427                                 TO PV-HOLD-STORE-NMBR            00050700
000428                                                                  00050800
000429         PERFORM 3000-PROCESS-INPUT                               00050900
000430             UNTIL PS-END-OF-INPUT                                00051000
000431                                                                  00051100
000432*----------------------------------------------------------------*00051200
000433*    WRITE LAST BATCH TRAILER RECORD                             *00051300
000434*----------------------------------------------------------------*00051400
000435         PERFORM  8250-CREATE-BATCH-TRAILER                       00051500
000436                                                                  00051600
000437         PERFORM 8050-CREATE-XMIT-FILE-TRAILER                    00051700
000438     END-IF.                                                      00051800
000439                                                                  00051900
P9696      PERFORM  8500-CREATE-AJB-TRAILER                             00052000
P9696                                                                   00052100
000440     DISPLAY 'RECORDS READ IN = '  PV-CNT-READ-COUNT.             00052200
000441     DISPLAY 'BATCH COUNT     = '  PV-CNT-BATCH-COUNT.            00052300
000442     DISPLAY 'DETAIL REC      = '  PV-CNT-DETAIL-REC.             00052400
000443     DISPLAY 'VISA1 ADDM      = '  PV-CNT-VISA1-ADDM.             00052500
000444     DISPLAY 'VISA2 ADDM      = '  PV-CNT-VISA2-ADDM.             00052600
000445     DISPLAY 'MASTER CARD ADDM= '  PV-CNT-MSCARD-ADDM.            00052700
000446     DISPLAY 'AMEX VER 1 ADDM = '  PV-CNT-AMEX1-ADDM.             00052800
000446     DISPLAY 'AMEX VER 2 ADDM = '  PV-CNT-AMEX2-ADDM.             00052900
000446     DISPLAY 'DISC VER 1 ADDM = '  PV-CNT-DISC1-ADDM.             00053000
000446     DISPLAY 'DISC VER 2 ADDM = '  PV-CNT-DISC2-ADDM.             00053100
P9696      DISPLAY 'RECORDS WRITTEN IN OUTPUT 2 = '  PV-REC-COUNT.      00053200
P9696      DISPLAY 'TOTAL DOLLAR AMOUNT = '  PV-TOT-TNDR-AMT-DISP.      00053300
000447                                                                  00053400
000448     CLOSE  CREDIT-SETTLE-FILE                                    00053500
000449            BANKCARD-TRANSMIT-FILE.                               00053600
000450                                                                  00053700
000451     DISPLAY PC-NORMAL-EOJ-MSSG   PC-PROGRAM-NUMBER.              00053800
000452     GOBACK.                                                      00053900
000453                                                                  00054000
000454 1000-INITIALIZE.                                                 00054100
000455                                                                  00054200
000456     INITIALIZE PV-BATCH-TOTALS                                   00054300
000457                PV-FILE-TOTALS.                                   00054400
000458                                                                  00054500
000459     SET PS-NOT-END-OF-INPUT     TO TRUE.                         00054600
000460                                                                  00054700
000461     OPEN INPUT  CONTROL-CARD-FILE                                00054800
000462                 CREDIT-SETTLE-FILE                               00054900
000463          OUTPUT BANKCARD-TRANSMIT-FILE                           00055000
P9696                  AJB-SETTLEMENT-FILE.                             00055100
000464                                                                  00055200
000465     PERFORM 9900-SETUP-DATE.                                     00055300
000466                                                                  00055400
000467*----------------------------------------------------------------*00055500
000468*    READ-CREDIT-SETTLE-FILE                                     *00055600
000469*      READ THE INPUT FILE                                       *00055700
000470*----------------------------------------------------------------*00055800
000471 2000-READ-CREDIT-SETTLE-FILE.                                    00055900
000472                                                                  00056000
000473     READ CREDIT-SETTLE-FILE INTO TC005-EXTRACT-RECORD            00056100
000474        AT END                                                    00056200
000475           SET PS-END-OF-INPUT         TO TRUE.                   00056300
000476                                                                  00056400
000477        IF PS-NOT-END-OF-INPUT                                    00056500
000478            ADD +1               TO PV-CNT-READ-COUNT             00056600
000479        END-IF.                                                   00056700
000480                                                                  00056800
000481*----------------------------------------------------------------*00056900
000482*    PROCESS-INPUT                                               *00057000
000483*      PERFORMED ONLY VIA THE INITIAL CODE THAT PERFORMS THE     *00057100
000484*      HIGHEST LEVEL ROUTINES AND ONE-TIME MODULES               *00057200
000485*    FUNCTION: CREATE OUTPUT BATCH AND DETAIL RECORDS UNTIL ALL  *00057300
000486*      TRANSACTIONS HAVE BEEN PROCESSED.                         *00057400
000487*      CREATE BATCH HEADER AND BATCH TRAILERS FOR EACH STORE.    *00057500
000488*      BATCH BREAK IS BASED ON STORE NUMBER.  ALL DETAIL RECORDS *00057600
000489*      ARE PROCESSED IN THIS PARAGRAPH                           *00057700
000490*----------------------------------------------------------------*00057800
000491  3000-PROCESS-INPUT.                                             00057900
000492                                                                  00058000
000493     IF TC005-SETTLE-STORE-NBR  NOT = PV-HOLD-STORE-NMBR          00058100
000494         PERFORM 4000-COMPLETE-BATCH-PROCESS                      00058200
000495         MOVE TC005-SETTLE-STORE-NBR                              00058300
000496                                 TO PV-HOLD-STORE-NMBR            00058400
000497         PERFORM 5000-PROCESS-DETAIL                              00058500
000498     ELSE                                                         00058600
000499         PERFORM 5000-PROCESS-DETAIL                              00058700
000500     END-IF.                                                      00058800
000501                                                                  00058900
P9696      PERFORM 6000-CREATE-AJB-SETLMNT-REC.                         00059000
000502     PERFORM 2000-READ-CREDIT-SETTLE-FILE.                        00059100
000503*----------------------------------------------------------------*00059200
000504*    COMPLETE-BATCH-PROCESS                                      *00059300
000505*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00059400
000506*    FUNCTION:                                                   *00059500
000507*      CONTROL BREAK ON STORE NUMBER                             *00059600
000508*      CREATE THE BATCH TRAILER RECORD                           *00059700
000509*      CREATE THE BATCH HEADER RECORD                            *00059800
000510*                                                                *00059900
000511*----------------------------------------------------------------*00060000
000512 4000-COMPLETE-BATCH-PROCESS.                                     00060100
000513                                                                  00060200
000514     PERFORM  8250-CREATE-BATCH-TRAILER.                          00060300
000515     PERFORM  8200-CREATE-BATCH-HEADER.                           00060400
000516*----------------------------------------------------------------*00060500
000517*    PROCESS-DETAIL                                              *00060600
000518*      PERFORMED      VIA 3000-PROCESS-INPUT                     *00060700
000519*    FUNCTION: CREATE OUTPUT DETAIL RECORDS                      *00060800
000520*----------------------------------------------------------------*00060900
000521 5000-PROCESS-DETAIL.                                             00061000
000522                                                                  00061100
000523     INITIALIZE TC006-DETAIL-TRANS.                               00061200
000524                                                                  00061300
000525     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00061400
000526     ADD 1                       TO  PV-BATCH-SEQ-NBR.            00061500
000527     MOVE '40'                   TO  TC006-DT-TRAN-REC-CDE.       00061600
000528     MOVE  PV-BATCH-SEQ-NBR      TO  TC006-DT-BATCH-TRAN-NBR.     00061700
000529     MOVE  0                     TO  TC006-DT-ADDM-SEQ-NBR.       00061800
000530     MOVE  TC005-TNDR-ID         TO  TC006-DT-CARD-ACCT-NBR.      00061900
000531     MOVE  SPACES                TO  TC006-DT-MEMO-POST-FLG.      00062000
000532     MOVE  TC005-RGST-ID         TO  PV-RGST-ID.                  00062100
000533     MOVE  TC005-TRN-NBR         TO  PV-TRN-ID.                   00062200
000534     MOVE  PV-RGST-TRN-ID        TO  TC006-DT-DRAFT-LOCAT-NBR.    00062300
000535     MOVE  TC005-SLS-DTE         TO  PV-ISO-CCYY-MM-DD            00062400
000536     MOVE  PV-ISO-MM             TO  PV-SALES-MM.                 00062500
000537     MOVE  PV-ISO-DD             TO  PV-SALES-DD.                 00062600
000538     MOVE  PV-ISO-YY             TO  PV-SALES-YY.                 00062700
000539     MOVE  PV-SALES-MMDDYY       TO  TC006-DT-TRANS-DATE.         00062800
000540     MOVE  TC005-TNDR-AMT        TO  TC006-DT-TRANS-AMT.          00062900
000541                                                                  00063000
000542     IF (TC005-TNDR-TYP-CDE = '05' OR                             00063100
052523         TC005-TNDR-TYP-CDE = '24' OR                             00063200
000543         TC005-TNDR-TYP-CDE = '06' OR                             00063400
000543         TC005-TNDR-TYP-CDE = '07' OR                             00063500
000543         TC005-TNDR-TYP-CDE = '08')                               00063600
000544         IF TC005-AUTH-NBR = ZEROES                               00063700
000545             MOVE SPACES             TO  TC006-DT-AUTH-NBR        00063800
000546         ELSE                                                     00063900
000547             MOVE  TC005-AUTH-NBR    TO  TC006-DT-AUTH-NBR        00064000
000548         END-IF                                                   00064100
000549     ELSE                                                         00064200
000550         MOVE  TC005-AUTH-NBR    TO  TC006-DT-AUTH-NBR            00064300
000551     END-IF.                                                      00064400
000552                                                                  00064500
000553     IF TC005-VIP-SRC-CDE = ZERO                                  00064600
000554     OR TC005-VIP-SRC-CDE = SPACES                                00064700
000555         MOVE '5'                TO TC006-DT-AUTH-SOURCE          00064800
000556     ELSE                                                         00064900
000557         MOVE TC005-VIP-SRC-CDE  TO TC006-DT-AUTH-SOURCE          00065000
000558     END-IF.                                                      00065100
000559                                                                  00065200
000560     MOVE  SPACES                TO  TC006-DT-DISC-DATA.          00065300
000561                                                                  00065400
000574*  IF KEY ENTERED MOVE 9 ELSE MOVE 2                              00065500
000563     IF (XST00001-E-BUS-IND  = 'Y' OR                             00065600
000569        TC005-TNDR-ID-SRC-CDE  = '00')                            00065700
000564         MOVE '9'                TO  TC006-DT-POS-TERM-CAP        00065800
000565     ELSE                                                         00065900
000566         MOVE '2'                TO  TC006-DT-POS-TERM-CAP        00066000
000567     END-IF.                                                      00066100
000568                                                                  00066200
000574*  IF KEY ENTERED MOVE 01 ELSE MOVE 90                            00066300
000569     IF  TC005-TNDR-ID-SRC-CDE  = '00'                            00066400
000570         MOVE '01'               TO  TC006-DT-POS-ENTRY-MODE      00066500
000571     ELSE                                                         00066600
000572         MOVE '90'               TO  TC006-DT-POS-ENTRY-MODE      00066700
000573     END-IF.                                                      00066800
000574                                                                  00066900
000574*  IF IT'S MASTERCARD AND KEY ENTERED AND ECOMMERCE               00067000
000543*    IF  TC005-TNDR-TYP-CDE = '06' AND                            00067100
000569*        TC005-TNDR-ID-SRC-CDE  = '00' AND                        00067200
000563*        XST00001-E-BUS-IND   = 'Y'                               00067300
000570*        MOVE '81'               TO  TC006-DT-POS-ENTRY-MODE      00067400
000571*    END-IF.                                                      00067500
000574                                                                  00067600
052523     IF TC005-TRN-TYP-CDE = '30' AND                              00067800
052523        (TC005-COBRAND-PYMT-IND = 'Y' OR                          00067900
052523         TC005-TRLING-TRN-IND = 'Y')                              00068000
052523         SET TC006-CREDIT-CARD-PAYMENT TO TRUE                    00068100
052523         COMPUTE PV-BATCH-PAYMENT-TOT  =                          00068300
052523            ((TC005-TNDR-AMT * -1) + PV-BATCH-PAYMENT-TOT)        00068400
052523         ADD 1                         TO  PV-BATCH-PAYMENT-CNT   00068500
052523     ELSE                                                         00068600
000575     IF TC005-TNDR-AMT   >    0                                   00068700
000576         MOVE '05'               TO  TC006-DT-TRAN-TYPE           00068800
000577         ADD TC005-TNDR-AMT            TO  PV-BATCH-SALES-TOT     00068900
000578         ADD 1                         TO  PV-BATCH-SALES-CNT     00069000
000579     ELSE                                                         00069100
000580         MOVE '06'               TO  TC006-DT-TRAN-TYPE           00069200
000581         COMPUTE PV-BATCH-RETURNS-TOT  =                          00069300
000582            ((TC005-TNDR-AMT * -1) + PV-BATCH-RETURNS-TOT)        00069400
000583         ADD 1                         TO  PV-BATCH-RETURNS-CNT   00069500
000584         IF TC005-TRN-TYP-CDE = '01' AND                          00069600
000585            TC005-VOID-ABRT-CDE = 'N'                             00069700
000586             MOVE TC005-STR-NBR        TO  PV-STR-NBR             00069800
000587             DISPLAY '****  NEGATIVE SALE  ****'                  00069900
000588             DISPLAY 'STORE ' PV-STR-NBR                          00070000
000589             DISPLAY 'REGISTER ' PV-RGST-ID                       00070100
000590             DISPLAY 'TRANSACTION ' PV-TRN-ID                     00070200
000591             DISPLAY '*************************'                  00070300
000592         END-IF                                                   00070400
052523     END-IF                                                       00070500
000593     END-IF.                                                      00070600
000594                                                                  00070700
000595     IF XST00001-E-BUS-IND   = 'Y'                                00070800
000596         MOVE '7'                TO  TC006-DT-MAIL-PHONE-IND      00070900
000597         MOVE  '4'               TO  TC006-DT-CARD-ID-METHOD      00071000
000598     ELSE                                                         00071100
000599         MOVE SPACES             TO  TC006-DT-MAIL-PHONE-IND      00071200
000600         MOVE  '1'               TO  TC006-DT-CARD-ID-METHOD      00071300
000601     END-IF.                                                      00071400
000602                                                                  00071500
000603     ADD +1                      TO PV-CNT-DETAIL-REC.            00071600
000604                                                                  00071700
000605     MOVE TC006-DETAIL-TRANS     TO TC006-SETTLEMENT-RECORD.      00071800
000606                                                                  00071900
000607     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00072000
000608*----------------------------------------------------------------*00072100
000609*      DETERMINE IF AN ADDENDUM RECORD IS NEEDED TO BE CREATED   *00072200
000610*      CHECK TO SEE IF TRANSACTION IS FOR VISA/MASTER CARD/AMEX  *00072300
000611*----------------------------------------------------------------*00072400
000612                                                                  00072500
052523     IF TC005-TRN-TYP-CDE = '30' AND                              00072600
052523       (TC005-COBRAND-PYMT-IND = 'Y' OR                           00072700
052523        TC005-TRLING-TRN-IND = 'Y')                               00072800
052523         PERFORM 5100-VISA-ADDM-VER1-REC                          00072900
052523     ELSE                                                         00073000
052523     IF (TC005-TNDR-TYP-CDE    = '05' OR                          00073100
052523         TC005-TNDR-TYP-CDE    = '24')                            00073200
000614         PERFORM 5100-VISA-ADDM-VER1-REC                          00073400
000615     ELSE                                                         00073500
000616         IF TC005-TNDR-TYP-CDE = '06'                             00073600
000617             PERFORM 5200-MASTERCARD-ADDM-REC                     00073700
000618         ELSE                                                     00073800
000619             IF TC005-TNDR-TYP-CDE = '08'                         00073900
000620                 PERFORM 5300-AMEX-VER1-REC                       00074000
000621                 PERFORM 5350-AMEX-VER2-REC                       00074100
000622             ELSE                                                 00074200
000623                IF TC005-TNDR-TYP-CDE = '07'                      00074300
000624                   PERFORM 5400-DISCOVER-VER1-REC                 00074400
000625                   PERFORM 5500-DISCOVER-VER2-REC                 00074500
000626                ELSE                                              00074600
000627                  SET  ABEND-4008-INV-TNDR-TYPE-CDE  TO TRUE      00074700
000628                  MOVE '5000-PROCESS-DETAIL'                      00074800
000629                                       TO PV-PARAGRAPH-NAME       00074900
000630                  MOVE 'INVALID TNDR TYPE CDE  '                  00075000
000631                                       TO PV-OPERATION-MSG-1      00075100
000632                  PERFORM 9999-ABEND                              00075200
000633                END-IF                                            00075300
000634             END-IF                                               00075400
000635         END-IF                                                   00075500
052523     END-IF                                                       00075600
000636     END-IF.                                                      00075700
000637                                                                  00075800
000638*----------------------------------------------------------------*00075900
000639*    VISA-ADDM-VER1-REC                                          *00076000
000640*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00076100
000641*    FUNCTION:                                                   *00076200
000642*      CREATE VISA VER1 ADDENDUM OUTPUT RECORD                   *00076300
000643*----------------------------------------------------------------*00076400
000644 5100-VISA-ADDM-VER1-REC.                                         00076500
000645                                                                  00076600
000646     INITIALIZE TC006-VISA-DT-ADDM-VER1.                          00076700
000647                                                                  00076800
000648     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00076900
000649     MOVE 1                      TO  PV-ADDM-SEQ-NUM.             00077000
000650     MOVE  '41'                  TO  TC006-V1-DT-TRAN-REC-CDE.    00077100
000651     MOVE  PV-BATCH-SEQ-NBR      TO  TC006-V1-DT-BATCH-TRANS-NBR. 00077200
000652     MOVE  PV-ADDM-SEQ-NUM       TO  TC006-V1-DT-ADDM-SEQ-NBR.    00077300
000653     MOVE  1                     TO  TC006-V1-DT-FORMAT-VER-NBR.  00077400
000654     MOVE  TC005-TNDR-AMT        TO  TC006-V1-DT-AUTH-AMT.        00077500
000655     MOVE  '840'                 TO TC006-V1-DT-AUTH-AMT-CURRENCY.00077600
000656     IF XST00001-E-BUS-IND   = 'Y'                                00077700
000657         MOVE 'W'                TO  TC006-V1-DT-AUTH-CHAR-IND    00077800
000658     ELSE                                                         00077900
000659         MOVE 'E'                TO  TC006-V1-DT-AUTH-CHAR-IND    00078000
000660     END-IF.                                                      00078100
000661                                                                  00078200
000662     IF TC005-AUTH-NBR        = SPACES OR                         00078300
000663        TC005-AUTH-NBR        = ZEROES                            00078400
000664         MOVE SPACES             TO  TC006-V1-DT-AUTH-CHAR-IND    00078500
000665     END-IF.                                                      00078600
000666                                                                  00078700
000667     MOVE  TC005-VIP-RSPN-CDE    TO  TC006-V1-DT-AUTH-RESP-CDE.   00078800
000668     MOVE  TC005-CPS-TRN-ID      TO  TC006-V1-DT-TRANS-ID.        00078900
000669     MOVE  TC005-MC-CMPLIN-CDE   TO  TC006-V1-DT-VALID-CDE.       00079000
000670     MOVE  SPACES                TO  TC006-V1-DT-MER-CAT-CDE.     00079100
000671     MOVE  TC005-TNDR-AMT        TO  TC006-V1-DT-TOT-AUTH-AMT.    00079200
000672     MOVE  SPACES                TO TC006-V1-DT-CARD-ACT-TERM-IND.00079300
000673     MOVE  0                     TO  TC006-V1-DT-CASH-BACK.       00079400
000674     MOVE  TC005-AVS-RSPN-CDE    TO  TC006-V1-DT-AVS-RESP-CDE.    00079500
000675     MOVE  TC005-CVV-RSPN-CDE    TO  TC006-V1-DT-CVV2-RESP-CDE.   00079600
000676     MOVE  TC005-CRD-LVL-RSLT-CDE TO TC006-V1-DT-CRD-LVL-RESULTS. 00079700
000677                                                                  00079800
000678     MOVE TC006-VISA-DT-ADDM-VER1                                 00079900
000679                                 TO TC006-SETTLEMENT-RECORD.      00080000
000680                                                                  00080100
000681     ADD +1                      TO PV-CNT-VISA1-ADDM.            00080200
000682                                                                  00080300
000683     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00080400
000684                                                                  00080500
000685     IF XST00001-E-BUS-IND   = 'Y'                                00080600
000686         PERFORM 5150-VISA-ADDM-VER2-REC                          00080700
000687     END-IF.                                                      00080800
000688                                                                  00080900
000689     PERFORM 5170-VISA-ADDM-VER9-REC.                             00081000
000690                                                                  00081100
000691*----------------------------------------------------------------*00081200
000692*    VISA-ADDM-VER2-REC                                          *00081300
000693*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00081400
000694*    FUNCTION:                                                   *00081500
000695*      CREATE VISA VER2 ADDENDUM OUTPUT RECORD                   *00081600
000696*----------------------------------------------------------------*00081700
000697 5150-VISA-ADDM-VER2-REC.                                         00081800
000698                                                                  00081900
000699     INITIALIZE  TC006-VISA-DT-ADDM-VER2.                         00082000
000700                                                                  00082100
000701     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00082200
000702     ADD 1                       TO  PV-ADDM-SEQ-NUM.             00082300
000703     MOVE  '41'                  TO  TC006-V2-DT-TRAN-REC-CDE.    00082400
000704     MOVE  PV-BATCH-SEQ-NBR      TO  TC006-V2-DT-BATCH-TRANS-NBR. 00082500
000705     MOVE  PV-ADDM-SEQ-NUM       TO  TC006-V2-DT-ADDM-SEQ-NBR.    00082600
000706     MOVE  2                     TO  TC006-V2-DT-FORMAT-VER-NBE.  00082700
000707     MOVE  TC005-AVS-RSPN-CDE    TO  TC006-V2-DT-AVS-RESP-CDE.    00082800
000708     MOVE  '8668878884'          TO  TC006-V2-DT-MER-PHONE-NBR.   00082900
000709     MOVE  1                     TO  TC006-V2-DT-PUR-ID-FMT-CDE.  00083000
000710     MOVE PV-RGST-TRN-ID         TO  TC006-V2-DT-PUR-ID.          00083100
000711                                                                  00083200
000712     MOVE TC006-VISA-DT-ADDM-VER2                                 00083300
000713                                 TO TC006-SETTLEMENT-RECORD.      00083400
000714                                                                  00083500
000715     ADD +1                      TO PV-CNT-VISA2-ADDM.            00083600
000716                                                                  00083700
000717     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00083800
000718                                                                  00083900
000719*----------------------------------------------------------------*00084000
000720*    5170-VISA-ADDM-VER9-REC                                     *00084100
000721*      PERFORMED ONLY VIA (5100-VISA-ADDM-VER1-REC     )         *00084200
000722*    FUNCTION:                                                   *00084300
000723*      CREATE VER9 VISA ADDENDUM OUTPUT RECORD                   *00084400
000724*----------------------------------------------------------------*00084500
000725 5170-VISA-ADDM-VER9-REC.                                         00084600
000726                                                                  00084700
000727     INITIALIZE TC006-VISA-DT-ADDM-VER9.                          00084800
000728                                                                  00084900
000729     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00085000
000730     ADD 1                       TO  PV-ADDM-SEQ-NUM.             00085100
000731     MOVE '41'                   TO TC006-V9-DT-TRAN-REC-CDE.     00085200
000732     MOVE PV-BATCH-SEQ-NBR       TO TC006-V9-DT-BATCH-TRANS-NBR.  00085300
000733     MOVE PV-ADDM-SEQ-NUM        TO TC006-V9-DT-ADDM-SEQ-NBR.     00085400
000734     MOVE '9'                    TO TC006-V9-DT-FORMAT-VER-NBR.   00085500
000735     MOVE '1'                    TO TC006-V9-DT-FORMAT-VER-REC-TYP00085600
000736* A CHANGE NEEDS TO BE MADE FOR SPLIT TENDER                      00085700
000737* THE ENTIRE TAX IS GOING INTO ALL THE CARDS THAT ARE IN          00085800
000738*    ONE TRANSACTION AND THIS NEEDS TO GET SPLIT APART.           00085900
000739* I'M THINKING THIS NEEDS TO GET DONE BEFORE THIS PROGRAM.        00086000
000740     IF TC005-SLS-TX-AMT > 0.00                                   00086100
000741         MOVE '1'                TO TC006-V9-DT-SALES-TAX-IND     00086200
000742         MOVE TC005-SLS-TX-AMT   TO TC006-V9-DT-SALES-TAX-AMT     00086300
000743     ELSE                                                         00086400
000744         MOVE '2'                TO TC006-V9-DT-SALES-TAX-IND     00086500
000745         MOVE 0                  TO TC006-V9-DT-SALES-TAX-AMT     00086600
000746     END-IF.                                                      00086700
000747                                                                  00086800
000748     MOVE  SPACES                TO TC006-V9-DT-CRI.              00086900
000749     MOVE '0'                    TO TC006-V9-DT-NAT-TAX-IND.      00087000
000750     MOVE 0                      TO TC006-V9-DT-NAT-TAX-AMT.      00087100
000751     MOVE 0                      TO TC006-V9-DT-OTHER-TAX-AMT.    00087200
000752                                                                  00087300
000753     MOVE TC006-VISA-DT-ADDM-VER9                                 00087400
000754                                 TO TC006-SETTLEMENT-RECORD.      00087500
000755                                                                  00087600
000756     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00087700
000757                                                                  00087800
000758*  DETAIL TRANSACTION ADDENDUM RECORD FOR MASTERCARD VER9         00087900
000759******************************************************************00088000
000760*----------------------------------------------------------------*00088100
000761*    MASTERCARD-ADDM-REC                                         *00088200
000762*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00088300
000763*    FUNCTION:                                                   *00088400
000764*      CREATE MASTERCARD ADDENDUM OUTPUT RECORD                  *00088500
000765*----------------------------------------------------------------*00088600
000766 5200-MASTERCARD-ADDM-REC.                                        00088700
000767                                                                  00088800
000768     INITIALIZE TC006-MSTC-DT-ADDM-VER1.                          00088900
000769                                                                  00089000
000770     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00089100
000771     MOVE  '41'                  TO  TC006-MST1-DT-TRAN-REC-CDE.  00089200
000772     MOVE  PV-BATCH-SEQ-NBR      TO  TC006-MST1-DT-BATCH-TRANS-NBR00089300
000773     MOVE  1                     TO  TC006-MST1-DT-ADDM-SEQ-NBR.  00089400
000774     MOVE  '1'                   TO  TC006-MST1-DT-FMT-VER-NBR.   00089500
000775     IF TC005-BNKNET-NBR      = SPACES OR                         00089600
000776        TC005-BNKNET-NBR      = ZEROES                            00089700
000777         MOVE SPACES             TO  TC006-MST1-DT-BNKNET-REF-NBR 00089800
000778     ELSE                                                         00089900
000779         MOVE  TC005-BNKNET-NBR  TO  PV-BNKNET                    00090000
000780         MOVE  PV-BNKNET-NBR     TO  TC006-MST1-DT-BNKNET-REF-NBR 00090100
000781     END-IF.                                                      00090200
000782     MOVE  PV-BNKNET-DTE         TO  TC006-MST1-DT-BNKNET-DATE.   00090300
000783     MOVE  SPACES                TO  TC006-MST1-DT-MER-CAT-CDE.   00090400
000784     IF XST00001-E-BUS-IND   = 'Y'                                00090500
000785         MOVE '6'                TO  TC006-MST1-DT-CARD-ACT-TERM  00090600
000786     ELSE                                                         00090700
000787         MOVE  SPACES            TO  TC006-MST1-DT-CARD-ACT-TERM  00090800
000788     END-IF.                                                      00090900
000789                                                                  00091000
000790     MOVE  PV-RGST-TRN-ID        TO  TC006-MST1-DT-TERM-ID.       00091100
000791     MOVE  TC005-CVV-RSPN-CDE    TO  TC006-MST1-DT-CVV2-RESP-CDE. 00091200
000792                                                                  00091300
000793     ADD +1                      TO  PV-CNT-MSCARD-ADDM.          00091400
000794                                                                  00091500
000795     MOVE TC006-MSTC-DT-ADDM-VER1                                 00091600
000796                                 TO TC006-SETTLEMENT-RECORD.      00091700
000797                                                                  00091800
000798     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00091900
000799                                                                  00092000
000800     PERFORM 5250-MASTERCARD-ADDM-VER9-REC.                       00092100
000801*----------------------------------------------------------------*00092200
000802*    5250-MASTERCARD-ADDM-VER9-REC                               *00092300
000803*      PERFORMED ONLY VIA (5200-MASTERCARD-ADDM-REC)             *00092400
000804*    FUNCTION:                                                   *00092500
000805*      CREATE VER9 MASTERCARD ADDENDUM OUTPUT RECORD             *00092600
000806*----------------------------------------------------------------*00092700
000807 5250-MASTERCARD-ADDM-VER9-REC.                                   00092800
000808                                                                  00092900
000809     INITIALIZE TC006-MSTC-DT-ADDM-VER9.                          00093000
000810                                                                  00093100
000811     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00093200
000812     MOVE '41'                   TO  TC006-MST9-DT-TRAN-REC-CDE.  00093300
000813     MOVE PV-BATCH-SEQ-NBR       TO  TC006-MST9-DT-BATCH-TRANS-NBR00093400
000814     MOVE '2'                    TO  TC006-MST9-DT-ADDM-SEQ-NBR.  00093500
000815     MOVE '9'                    TO  TC006-MST9-DT-FMT-VER-NBR.   00093600
000816     MOVE '1'                    TO  TC006-MST9-DT-FMT-REC-TYP.   00093700
000817     MOVE 'NONE'                 TO  TC006-MST9-DT-CUST-CDE.      00093800
000818* A CHANGE NEEDS TO BE MADE FOR SPLIT TENDER                      00093900
000819* THE ENTIRE TAX IS GOING INTO ALL THE CARDS THAT ARE IN          00094000
000820*    ONE TRANSACTION AND THIS NEEDS TO GET SPLIT APART.           00094100
000821* I'M THINKING THIS NEEDS TO GET DONE BEFORE THIS PROGRAM.        00094200
000822     IF TC005-SLS-TX-AMT > 0.00                                   00094300
000823         MOVE '1'                TO TC006-MST9-DT-SLS-TAX-IND     00094400
000824         MOVE TC005-SLS-TX-AMT   TO TC006-MST9-DT-SLS-TAX-AMT     00094500
000825     ELSE                                                         00094600
000826         MOVE '2'                TO TC006-MST9-DT-SLS-TAX-IND     00094700
000827         MOVE 0                  TO TC006-MST9-DT-SLS-TAX-AMT     00094800
000828     END-IF.                                                      00094900
000829     MOVE 0                      TO  TC006-MST9-DT-FREIGHT-AMT.   00095000
000830     MOVE 0                      TO  TC006-MST9-DT-DUTY-AMT.      00095100
000831     MOVE 0                      TO  TC006-MST9-DT-NAT-TAX-IND.   00095200
000832     MOVE 0                      TO  TC006-MST9-DT-NAT-TAX-AMT.   00095300
000833     MOVE XST00001-ZIP-10-CDE    TO  PV-ZIP-CODE.                 00095400
000834     MOVE PV-ZIP-CODE-5          TO  PV-ZIP-CODE-59.              00095500
000835     IF PV-ZIP-CODE-DASH = '0'                                    00095600
000836         MOVE '0000'             TO  PV-ZIP-CODE-PLUS49           00095700
000837     ELSE                                                         00095800
000838         IF PV-ZIP-CODE-DASH = '-'                                00095900
000839             MOVE PV-ZIP-CODE-3       TO PV-ZIP-CODE-COM-3        00096000
000840             MOVE PV-ZIP-CODE-1       TO PV-ZIP-CODE-COM-1        00096100
000841             MOVE PV-ZIP-CODE-COM-RE  TO PV-ZIP-CODE-PLUS49       00096200
000842         ELSE                                                     00096300
000843             IF PV-ZIP-CODE-DASH > 0                              00096400
000844                 MOVE PV-ZIP-CODE-DASH    TO PV-ZIP-CODE-COMB-1   00096500
000845                 MOVE PV-ZIP-CODE-3       TO PV-ZIP-CODE-COMB-3   00096600
000846                 MOVE PV-ZIP-CODE-COMB-RE TO PV-ZIP-CODE-PLUS49   00096700
000847             END-IF                                               00096800
000848         END-IF                                                   00096900
000849     END-IF.                                                      00097000
000850     MOVE PV-ZIP-CODE-9RE        TO  TC006-MST9-DT-SHIP-POST-CDE. 00097100
000851     MOVE ZEROES TO PV-ZIP-CODE-COM-3                             00097200
000852                    PV-ZIP-CODE-COM-1                             00097300
000853                    PV-ZIP-CODE-COMB-1                            00097400
000854                    PV-ZIP-CODE-COMB-3                            00097500
000855                    PV-ZIP-CODE-PLUS49                            00097600
000856                    PV-ZIP-CODE-COMB-RE                           00097700
000857                    PV-ZIP-CODE-COM-RE                            00097800
000858                    PV-ZIP-CODE-9RE.                              00097900
000859     MOVE SPACES TO PV-ZIP-CODE-DASH                              00098000
000860                    PV-ZIP-CODE-3                                 00098100
000861                    PV-ZIP-CODE-1.                                00098200
000862                                                                  00098300
000863     MOVE TC006-MSTC-DT-ADDM-VER9                                 00098400
000864                                 TO TC006-SETTLEMENT-RECORD.      00098500
000865                                                                  00098600
000866     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00098700
000867                                                                  00098800
000868*----------------------------------------------------------------*00098900
000869*    AMEX-ADDM-VER1-REC                                          *00099000
000870*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00099100
000871*    FUNCTION:                                                   *00099200
000872*      CREATE AMERICAN EXPRESS ADDENDUM OUTPUT RECORD            *00099300
000873*----------------------------------------------------------------*00099400
000874 5300-AMEX-VER1-REC.                                              00099500
000875                                                                  00099600
000876     INITIALIZE  TC006-AMEX-DT-ADDM-V4111.                        00099700
000877                                                                  00099800
000878     MOVE 1                      TO  PV-ADDM-SEQ-NUM.             00099900
000811     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00100000
000879                                                                  00100100
000880     MOVE '41'                   TO TC006-AMEX-DT-TRAN-REC-CDE.   00100200
000881     MOVE SPACES                 TO TC006-AMEX-DT-BLANK.          00100300
000882     MOVE PV-BATCH-SEQ-NBR       TO TC006-AMEX-DT-BATCH-TRANS-NBR.00100400
000883     MOVE PV-ADDM-SEQ-NUM        TO TC006-AMEX-DT-ADDM-SEQ-MBR.   00100500
000884     MOVE '1'                    TO TC006-AMEX-DT-FMT-VER-NBR.    00100600
000885     MOVE '1'                    TO TC006-AMEX-DT-FMT-VER-TYP.    00100700
000886     MOVE TC005-CPS-TRN-ID       TO TC006-AMEX-DT-TRN-ID.         00100800
000887     MOVE '02'                   TO TC006-AMEX-DT-TRN-FMT-CDE.    00100900
000888                                                                  00101000
000889     IF XST00001-E-BUS-IND = 'Y'                                  00101100
000890       MOVE '04'                    TO TC006-AMEX-DT-MEDIA-CDE    00101200
000891     ELSE                                                         00101300
000892       MOVE '01'                    TO TC006-AMEX-DT-MEDIA-CDE    00101400
000893     END-IF                                                       00101500
000894                                                                  00101600
000895     MOVE '840'                  TO TC006-AMEX-CURRENCY-CDE.      00101700
000896     MOVE PV-RGST-TRN-ID         TO TC006-AMEX-DT-TERM-ID.        00101800
000897                                                                  00101900
000898     IF XST00001-E-BUS-IND = 'N'                                  00102000
000899        IF TC005-AUTH-SRC-CDE = '00'                              00102100
000900          MOVE '6'                    TO TC006-AMEX-DT-CD-INP-CAP 00102200
000901        ELSE                                                      00102300
000902          MOVE '2'                    TO TC006-AMEX-DT-CD-INP-CAP 00102400
000903        END-IF                                                    00102500
000904     ELSE                                                         00102600
000905        MOVE '1'                    TO TC006-AMEX-DT-CD-INP-CAP   00102700
000906     END-IF                                                       00102800
000907                                                                  00102900
000908     IF XST00001-E-BUS-IND = 'N'                                  00103000
000909       MOVE '6'                     TO TC006-AMEX-DT-CD-AUTH      00103100
000910     ELSE                                                         00103200
000911       MOVE '0'                     TO TC006-AMEX-DT-CD-AUTH      00103300
000912     END-IF                                                       00103400
000913                                                                  00103500
000914     IF XST00001-E-BUS-IND = 'N'                                  00103600
000915       MOVE '1'                    TO TC006-AMEX-DT-CD-CAP        00103700
000916     ELSE                                                         00103800
000917       MOVE '0'                    TO TC006-AMEX-DT-CD-CAP        00103900
000918     END-IF                                                       00104000
000919                                                                  00104100
000920     IF XST00001-E-BUS-IND = 'N'                                  00104200
000921       MOVE '1'                    TO TC006-AMEX-DT-CD-OPER-ENV   00104300
000922     ELSE                                                         00104400
000923       MOVE 'T'                    TO TC006-AMEX-DT-CD-OPER-ENV   00104500
000924     END-IF                                                       00104600
000925                                                                  00104700
000926     IF XST00001-E-BUS-IND = 'N'                                  00104800
000927       MOVE '0'                    TO TC006-AMEX-DT-CDHD-PRESENT  00104900
000928     ELSE                                                         00105000
000929       MOVE 'S'                    TO TC006-AMEX-DT-CDHD-PRESENT  00105100
000930     END-IF                                                       00105200
000931                                                                  00105300
000932     IF XST00001-E-BUS-IND = 'N'                                  00105400
000933       MOVE '1'                    TO TC006-AMEX-DT-CD-PRESENT    00105500
000934     ELSE                                                         00105600
000935       MOVE '0'                    TO TC006-AMEX-DT-CD-PRESENT    00105700
000936     END-IF                                                       00105800
000937                                                                  00105900
000938     IF XST00001-E-BUS-IND = 'N'                                  00106000
000939       IF  TC005-TNDR-ID-SRC-CDE  = '00'                          00106100
000940         MOVE '6'                    TO TC006-AMEX-DT-CD-DT-INP-MD00106200
000941       ELSE                                                       00106300
000942         MOVE '2'                    TO TC006-AMEX-DT-CD-DT-INP-MD00106400
000943       END-IF                                                     00106500
000944     ELSE                                                         00106600
000945       MOVE 'S'                    TO TC006-AMEX-DT-CD-DT-INP-MD  00106700
000946     END-IF                                                       00106800
000947                                                                  00106900
000948     MOVE '0'                    TO TC006-AMEX-DT-CD-AUTHENTIC.   00107000
000949     MOVE '0'                    TO TC006-AMEX-DT-CD-AUTHEN-EN.   00107100
000950     MOVE '1'                    TO TC006-AMEX-DT-CD-OUT-CAP.     00107200
000951                                                                  00107300
000952     IF XST00001-E-BUS-IND = 'N'                                  00107400
000953        MOVE '4'                    TO TC006-AMEX-DT-TERM-OUT-CAP 00107500
000954     ELSE                                                         00107600
000955        MOVE '3'                    TO TC006-AMEX-DT-TERM-OUT-CAP 00107700
000956     END-IF                                                       00107800
000957                                                                  00107900
000958     MOVE '0'                    TO TC006-AMEX-DT-PIN-OUT-CAP.    00108000
000959     MOVE SPACES                 TO TC006-AMEX-DT-FILLER.         00108100
000960                                                                  00108200
000793     ADD +1                      TO  PV-CNT-AMEX1-ADDM.           00108300
                                                                        00108400
000961     MOVE TC006-AMEX-DT-ADDM-V4111                                00108500
000962                                 TO TC006-SETTLEMENT-RECORD.      00108600
                                                                        00108700
000963                                                                  00108800
000964     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00108900
000965                                                                  00109000
000966*----------------------------------------------------------------*00109100
000967*    AMEX-ADDM-VER2-REC                                          *00109200
000968*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00109300
000969*    FUNCTION:                                                   *00109400
000970*      CREATE AMERICAN EXPRESS ADDENDUM OUTPUT RECORD            *00109500
000971*----------------------------------------------------------------*00109600
000972 5350-AMEX-VER2-REC.                                              00109700
000973                                                                  00109800
000974     INITIALIZE  TC006-AME2-DT-ADDM-V419A.                        00109900
000975                                                                  00110000
000976     ADD 1                       TO  PV-ADDM-SEQ-NUM.             00110100
000811     ADD 1                       TO  PV-BATCH-DETAIL-CNT.         00110200
000977                                                                  00110300
000978     MOVE '41'                   TO TC006-AME9-DT-TRAN-REC-CDE.   00110400
000979     MOVE SPACES                 TO TC006-AME9-DT-BLANK.          00110500
000980     MOVE PV-BATCH-SEQ-NBR       TO TC006-AME9-DT-BATCH-TRANS-NBR.00110600
000981     MOVE PV-ADDM-SEQ-NUM        TO TC006-AME9-DT-ADDM-SEQ-MBR.   00110700
000982     MOVE '9'                    TO TC006-AME9-DT-FMT-VER-NBR.    00110800
000983     MOVE 'A'                    TO TC006-AME9-DT-FMT-VER-TYP.    00110900
000984     MOVE SPACES                 TO TC006-AME9-DT-CUST-CODE.      00111000
000985                                                                  00111100
000986     MOVE XST00001-ZIP-10-CDE    TO  PV-ZIP-CODE.                 00111200
000987     MOVE PV-ZIP-CODE-5          TO  PV-ZIP-CODE-59.              00111300
000988     IF PV-ZIP-CODE-DASH = '0'                                    00111400
000989         MOVE '0000'             TO  PV-ZIP-CODE-PLUS49           00111500
000990     ELSE                                                         00111600
000991         IF PV-ZIP-CODE-DASH = '-'                                00111700
000992             MOVE PV-ZIP-CODE-3       TO PV-ZIP-CODE-COM-3        00111800
000993             MOVE PV-ZIP-CODE-1       TO PV-ZIP-CODE-COM-1        00111900
000994             MOVE PV-ZIP-CODE-COM-RE  TO PV-ZIP-CODE-PLUS49       00112000
000995         ELSE                                                     00112100
000996             IF PV-ZIP-CODE-DASH > 0                              00112200
000997                 MOVE PV-ZIP-CODE-DASH    TO PV-ZIP-CODE-COMB-1   00112300
000998                 MOVE PV-ZIP-CODE-3       TO PV-ZIP-CODE-COMB-3   00112400
000999                 MOVE PV-ZIP-CODE-COMB-RE TO PV-ZIP-CODE-PLUS49   00112500
001000             END-IF                                               00112600
001001         END-IF                                                   00112700
001002     END-IF.                                                      00112800
001003     MOVE PV-ZIP-CODE-9RE      TO  TC006-AME9-DT-SHIP-POSTAL-CDE. 00112900
001004     MOVE ZEROES TO PV-ZIP-CODE-COM-3                             00113000
001005                    PV-ZIP-CODE-COM-1                             00113100
001006                    PV-ZIP-CODE-COMB-1                            00113200
001007                    PV-ZIP-CODE-COMB-3                            00113300
001008                    PV-ZIP-CODE-PLUS49                            00113400
001009                    PV-ZIP-CODE-COMB-RE                           00113500
001010                    PV-ZIP-CODE-COM-RE                            00113600
001011                    PV-ZIP-CODE-9RE.                              00113700
001012     MOVE SPACES TO PV-ZIP-CODE-DASH                              00113800
001013                    PV-ZIP-CODE-3                                 00113900
001014                    PV-ZIP-CODE-1.                                00114000
001015                                                                  00114100
001016     MOVE TC005-SLS-TX-AMT       TO PV-SLS-TAX-AMT.               00114200
001019     MOVE PV-SLS-TAX-DV        TO TC006-AME9-DT-TOT-TAX-AMT(1:8). 00114300
001020     MOVE PV-SLS-TAX-CV        TO TC006-AME9-DT-TOT-TAX-AMT(9:2). 00114400
001023                                                                  00114500
000793     ADD +1                      TO  PV-CNT-AMEX2-ADDM.           00114600
                                                                        00114700
001024     MOVE TC006-AME2-DT-ADDM-V419A                                00114800
001025                                 TO TC006-SETTLEMENT-RECORD.      00114900
001026                                                                  00115000
001027     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00115100
001028*----------------------------------------------------------------*00115200
001029*    DISCOVER VER1 REC                                           *00115300
001030*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00115400
001031*    FUNCTION:                                                   *00115500
001032*      CREATE AMERICAN EXPRESS ADDENDUM OUTPUT RECORD            *00115600
001033*----------------------------------------------------------------*00115700
001034 5400-DISCOVER-VER1-REC.                                          00115800
001035                                                                  00115900
001036     INITIALIZE  TC006-DISC-DT-ADDM-VER1.                         00116000
001037                                                                  00116100
001038     MOVE 1                     TO  PV-ADDM-SEQ-NUM.              00116200
000811     ADD 1                      TO  PV-BATCH-DETAIL-CNT.          00116300
001039                                                                  00116400
001040     MOVE '41'                  TO TC006-DISC-DT-TRAN-REC-CDE.    00116500
001041     MOVE SPACES                TO TC006-DISC-DT-BLANK.           00116600
001042     MOVE PV-BATCH-SEQ-NBR      TO TC006-DISC-DT-BATCH-TRANS-NBR. 00116700
001043     MOVE PV-ADDM-SEQ-NUM       TO TC006-DISC-DT-ADDM-SEQ-MBR.    00116800
001044     MOVE '1'                   TO TC006-DISC-DT-FMT-VER-NBR.     00116900
001045     MOVE '0'                   TO TC006-DISC-DT-CASH-DISB.       00117000
001046     MOVE 'N'                   TO TC006-DISC-DT-PART-SHIP-IND.   00117100
001047     IF TC005-TRSM-TMST = '2008-01-01-01.00.00.000000'            00117200
001054      MOVE TC005-TRN-DTE(1:4)    TO TC006-DISC-DT-AUTH-YEAR       00117300
001047      MOVE TC005-TRN-DTE(6:2)    TO TC006-DISC-DT-AUTH-DTE(1:2)   00117400
001048      MOVE TC005-TRN-DTE(9:2)    TO TC006-DISC-DT-AUTH-DTE(3:2)   00117500
001047      IF TC005-NETWK-REF-ID NOT NUMERIC                           00117600
001047       MOVE TC005-STRT-TM(1:2) TO TC006-DISC-DT-AUTH-TME(1:2)     00117700
001055                                  TC006-DISC-DT-TRAN-TM(1:2)      00117800
001048       MOVE TC005-STRT-TM(4:2) TO TC006-DISC-DT-AUTH-TME(3:2)     00117900
001056                                  TC006-DISC-DT-TRAN-TM(3:2)      00118000
001051       MOVE TC005-STRT-TM(7:2) TO TC006-DISC-DT-AUTH-TME(5:2)     00118100
001057                                  TC006-DISC-DT-TRAN-TM(5:2)      00118200
001047      ELSE                                                        00118300
001047       MOVE TC005-NETWK-REF-ID(7:2) TO TC006-DISC-DT-AUTH-TME(1:2)00118400
001055                                       TC006-DISC-DT-TRAN-TM(1:2) 00118500
001048       MOVE TC005-NETWK-REF-ID(9:2) TO TC006-DISC-DT-AUTH-TME(3:2)00118600
001056                                       TC006-DISC-DT-TRAN-TM(3:2) 00118700
001051      MOVE TC005-NETWK-REF-ID(11:2) TO TC006-DISC-DT-AUTH-TME(5:2)00118800
001057                                       TC006-DISC-DT-TRAN-TM(5:2) 00118900
001051      END-IF                                                      00119000
001051     ELSE                                                         00119100
001054      MOVE TC005-TRSM-TMST(1:4)  TO TC006-DISC-DT-AUTH-YEAR       00119200
001047      MOVE TC005-TRSM-TMST(6:2)  TO TC006-DISC-DT-AUTH-DTE(1:2)   00119300
001048      MOVE TC005-TRSM-TMST(9:2)  TO TC006-DISC-DT-AUTH-DTE(3:2)   00119400
001047      IF TC005-NETWK-REF-ID NOT NUMERIC                           00119500
001047        MOVE TC005-TRSM-TMST(12:2) TO TC006-DISC-DT-AUTH-TME(1:2) 00119600
001055                                      TC006-DISC-DT-TRAN-TM(1:2)  00119700
001048        MOVE TC005-TRSM-TMST(15:2) TO TC006-DISC-DT-AUTH-TME(3:2) 00119800
001056                                      TC006-DISC-DT-TRAN-TM(3:2)  00119900
001051        MOVE TC005-TRSM-TMST(18:2) TO TC006-DISC-DT-AUTH-TME(5:2) 00120000
001057                                      TC006-DISC-DT-TRAN-TM(5:2)  00120100
001057      ELSE                                                        00120200
001047       MOVE TC005-NETWK-REF-ID(7:2) TO TC006-DISC-DT-AUTH-TME(1:2)00120300
001055                                       TC006-DISC-DT-TRAN-TM(1:2) 00120400
001048       MOVE TC005-NETWK-REF-ID(9:2) TO TC006-DISC-DT-AUTH-TME(3:2)00120500
001056                                       TC006-DISC-DT-TRAN-TM(3:2) 00120600
001051      MOVE TC005-NETWK-REF-ID(11:2) TO TC006-DISC-DT-AUTH-TME(5:2)00120700
001057                                       TC006-DISC-DT-TRAN-TM(5:2) 00120800
001051     END-IF.                                                      00120900
001052     MOVE SPACES                TO TC006-DISC-DT-MERCHANT-NBR.    00121000
001053     MOVE SPACES                TO TC006-DISC-DT-MERCH-CAT-CDE.   00121100
           MOVE TC005-TRN-TYP-CDE     TO PV-TRAN-TYPE.                  00121200
001058     EVALUATE TRUE                                                00121300
001058         WHEN  PV-DISC-SALE OR PV-DISC-ASSOC-SALE                 00121400
001058             IF TC005-TNDR-AMT > 0                                00121500
001058                SET PV-DISCVR-SALE        TO TRUE                 00121600
001058             ELSE                                                 00121700
001058                SET PV-DISCVR-RETURN      TO TRUE                 00121800
001058             END-IF                                               00121900
001058         WHEN  PV-DISC-RETURN OR PV-DISC-ASSOC-RETURN             00122000
001058             SET PV-DISCVR-RETURN       TO TRUE                   00122100
001058         WHEN  PV-DISC-ADJUSTMENT                                 00122200
001058             IF TC005-TNDR-AMT > 0                                00122300
001058                SET PV-DISCVR-SALE        TO TRUE                 00122400
001058             ELSE                                                 00122500
001058                SET PV-DISCVR-RETURN      TO TRUE                 00122600
001058             END-IF                                               00122700
001058     END-EVALUATE.                                                00122800
001058*    MOVE TC005-AUTH-NBR        TO TC006-DISC-DT-PROC-CDE.        00122900
001058     MOVE PV-DISCVR-PROC-CDE    TO TC006-DISC-DT-PROC-CDE.        00123000
           MOVE ZEROES                TO TC006-DISC-DT-STAN-NBR.        00123100
001059     MOVE TC005-SYS-TRC-AUD-NBR TO TC006-DISC-DT-STAN-NBR.        00123200
001060     MOVE TC005-TRK-DAT-CND-CDE TO PV-TRK-DAT-CND-CDE.            00123300
001060     MOVE PV-TRK-DAT-CND-CDE1   TO TC006-DISC-DT-TRK2-STAT1.      00123400
001060     MOVE PV-TRK-DAT-CND-CDE2   TO TC006-DISC-DT-TRK2-STAT2.      00123500
001062                                                                  00123600
000793     ADD +1                      TO  PV-CNT-DISC1-ADDM.           00123700
                                                                        00123800
001063     MOVE TC006-DISC-DT-ADDM-VER1                                 00123900
001064                                 TO TC006-SETTLEMENT-RECORD.      00124000
001065                                                                  00124100
001066     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00124200
001067                                                                  00124300
001068*----------------------------------------------------------------*00124400
001069*    DISCOVER VER2 REC                                           *00124500
001070*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00124600
001071*    FUNCTION:                                                   *00124700
001072*      CREATE AMERICAN EXPRESS ADDENDUM OUTPUT RECORD            *00124800
001073*----------------------------------------------------------------*00124900
001074 5500-DISCOVER-VER2-REC.                                          00125000
001075                                                                  00125100
001076     INITIALIZE  TC006-DIS2-DT-ADDM-VER2.                         00125200
001077                                                                  00125300
001078     ADD 1                      TO  PV-ADDM-SEQ-NUM.              00125400
000811     ADD 1                      TO  PV-BATCH-DETAIL-CNT.          00125500
001079                                                                  00125600
001080     MOVE  '41'                 TO TC006-DIS2-DT-TRAN-REC-CDE.    00125700
001081     MOVE  SPACES               TO TC006-DIS2-DT-BLANK.           00125800
001082     MOVE  PV-BATCH-SEQ-NBR     TO TC006-DIS2-DT-BATCH-TRANS-NBR. 00125900
001083     MOVE  PV-ADDM-SEQ-NUM      TO TC006-DIS2-DT-ADDM-SEQ-MBR.    00126000
001084     MOVE  '2'                  TO TC006-DIS2-DT-FMT-VER-NBR.     00126100
001085     EVALUATE TC005-TNDR-ID-SRC-CDE                               00126200
001086         WHEN '00'                                                00126300
001087            MOVE 01                  TO TC006-DIS2-DT-POS-ENT-MODE00126400
001088            MOVE 1                   TO TC006-DIS2-DT-PIN-ENT-CAP 00126500
001089            SET PV-POS-KEY-ENTRY     TO TRUE                      00126600
001090         WHEN '01'                                                00126700
001091            MOVE 02                  TO TC006-DIS2-DT-POS-ENT-MODE00126800
001092            MOVE 1                   TO TC006-DIS2-DT-PIN-ENT-CAP 00126900
001093            SET PV-POS-MAG-STRIP-READER TO TRUE                   00127000
001094         WHEN '02'                                                00127100
001095            MOVE 03                  TO TC006-DIS2-DT-POS-ENT-MODE00127200
001096            MOVE 1                   TO TC006-DIS2-DT-PIN-ENT-CAP 00127300
001097            SET PV-POS-BAR-CODE      TO TRUE                      00127400
               WHEN '04'                                                00127500
                  MOVE 01                  TO TC006-DIS2-DT-POS-ENT-MODE00127600
                  MOVE 1                   TO TC006-DIS2-DT-PIN-ENT-CAP 00127700
                  SET PV-POS-MAG-STRIP-READER TO TRUE                   00127800
               WHEN '05'                                                00127900
                  MOVE 02                  TO TC006-DIS2-DT-POS-ENT-MODE00128000
                  MOVE 1                   TO TC006-DIS2-DT-PIN-ENT-CAP 00128100
                 SET PV-POS-MAG-STRIP-READER TO TRUE                    00128200
001098         WHEN '06'                                                00128300
001099            MOVE 07                  TO TC006-DIS2-DT-POS-ENT-MODE00128400
001100            MOVE 0                   TO TC006-DIS2-DT-PIN-ENT-CAP 00128500
001101            SET PV-POS-KEY-ENTRY     TO TRUE                      00128600
               WHEN '90'                                                00128700
                  MOVE 02                  TO TC006-DIS2-DT-POS-ENT-MODE00128800
                  MOVE 1                   TO TC006-DIS2-DT-PIN-ENT-CAP 00128900
                  SET PV-POS-MAG-STRIP-READER TO TRUE                   00129000
               WHEN OTHER                                               00129100
                  MOVE 01                  TO TC006-DIS2-DT-POS-ENT-MODE00129200
                  MOVE 0                   TO TC006-DIS2-DT-PIN-ENT-CAP 00129300
                  SET PV-POS-KEY-ENTRY TO TRUE                          00129400
001102     END-EVALUATE.                                                00129500
001103     IF XST00001-E-BUS-IND = 'Y'                                  00129600
001104         SET PV-POS-UNATTENDED      TO TRUE                       00129700
001105         SET PV-POS-HOME-PC         TO TRUE                       00129800
001106         SET PV-CARDHOLD-ELEC-ORDER TO TRUE                       00129900
001107         SET PV-CARD-NOT-PRESENT    TO TRUE                       00130000
001108         SET PV-POS-DEV-CARD-CAP    TO TRUE                       00130100
001123         MOVE SPACES                TO TC006-DIS2-DT-AVS-RESP-CDE 00130200
001109     ELSE                                                         00130300
001110         SET PV-POS-ATTENDED        TO TRUE                       00130400
001111         SET PV-POS-ON-PREMISES     TO TRUE                       00130500
001112         SET PV-CARDHOLD-PRESENT    TO TRUE                       00130600
001113         SET PV-CARD-PRESENT        TO TRUE                       00130700
001114         SET PV-POS-DEV-CARD-CAP    TO TRUE                       00130800
001123         MOVE TC005-AVS-RSPN-CDE    TO TC006-DIS2-DT-AVS-RESP-CDE 00130900
001115     END-IF.                                                      00131000
001116     SET PV-POS-TRAN-UNKNOWN       TO TRUE.                       00131100
001117     SET PV-POS-TRAN-NORMAL        TO TRUE.                       00131200
001118     SET PV-PART-NOT-SUPPORT       TO TRUE.                       00131300
001119                                                                  00131400
001120     MOVE  PV-POS-DATA          TO TC006-DIS2-POS-DATA-CODE.      00131500
001121     IF TC005-VIP-RSPN-CDE = SPACES                               00131600
001121        MOVE '00'               TO TC006-DIS2-DT-AUTH-RESP-CDE    00131700
001121     ELSE                                                         00131800
001121        MOVE TC005-VIP-RSPN-CDE TO TC006-DIS2-DT-AUTH-RESP-CDE    00131900
001121     END-IF.                                                      00132000
001122     MOVE TC005-NETWK-REF-ID    TO TC006-DIS2-DT-NETWORK-REF-ID.  00132100
001125     MOVE TC005-SLS-TX-AMT      TO TC006-DIS2-DT-SALES-TAX.       00132200
                                                                        00132300
000793     ADD +1                      TO  PV-CNT-DISC2-ADDM.           00132400
                                                                        00132500
001126     MOVE TC006-DIS2-DT-ADDM-VER2                                 00132600
001127                                 TO TC006-SETTLEMENT-RECORD.      00132700
001128                                                                  00132800
001129     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00132900
P9696 ***************************************************************** 00133000
P9696 * 6000-CREATE-AJB-SETLMNT-REC                                     00133100
P9696 ***************************************************************** 00133200
P9696  6000-CREATE-AJB-SETLMNT-REC.                                     00133300
P9696                                                                   00133400
P9696      INITIALIZE  TC011-EXTRACT-RECORD.                            00133500
P9696                                                                   00133600
P9696      MOVE TC005-PARTN-NBR         TO TC011-PARTN-NBR.             00133700
P9696      MOVE TC005-STR-NBR           TO TC011-STR-NBR.               00133800
P9696      MOVE TC005-RGST-ID           TO TC011-RGST-ID.               00133900
P9696      MOVE TC005-TRN-NBR           TO TC011-TRN-NBR.               00134000
P9696      MOVE TC005-STRT-TM           TO TC011-STRT-TM.               00134100
P9696      MOVE TC005-SLS-CORR-SEQ-NBR  TO TC011-SLS-CORR-SEQ-NBR.      00134200
P9696      MOVE TC005-TRN-TYP-CDE       TO TC011-TRN-TYP-CDE.           00134300
P9696      MOVE TC005-SLS-DTE           TO TC011-SLS-DTE.               00134400
P9696      MOVE TC005-TRN-DTE           TO TC011-TRN-DTE.               00134500
P9696      MOVE TC005-TNDR-SEQ-NBR      TO TC011-TNDR-SEQ-NBR.          00134600
P9696      MOVE TC005-TNDR-TYP-CDE      TO TC011-TNDR-TYP-CDE.          00134700
P9696      MOVE TC005-TNDR-ID           TO TC011-TNDR-ID.               00134800
P9696      MOVE TC005-TNDR-AMT          TO TC011-TNDR-AMT.              00134900
P9696      MOVE TC005-TNDR-ID-SRC-CDE   TO TC011-TNDR-ID-SRC-CDE.       00135000
P9696      MOVE TC005-AUTH-NBR          TO TC011-AUTH-NBR.              00135100
P9696      MOVE TC005-AUTH-SRC-CDE      TO TC011-AUTH-SRC-CDE.          00135200
P9696      MOVE TC005-CPS-TRN-ID        TO TC011-CPS-TRN-ID.            00135300
P9696      MOVE TC005-MC-CMPLIN-CDE     TO TC011-MC-CMPLIN-CDE.         00135400
P9696      MOVE TC005-VIP-SRC-CDE       TO TC011-VIP-SRC-CDE.           00135500
P9696      MOVE TC005-VIP-RSPN-CDE      TO TC011-VIP-RSPN-CDE.          00135600
P9696      MOVE TC005-BNKNET-NBR        TO TC011-BNKNET-NBR.            00135700
P9696      MOVE TC005-SETTLE-STORE-NBR  TO TC011-SETTLE-STORE-NBR.      00135800
P9696      MOVE TC005-ECOMM-REAUTH-IND  TO TC011-ECOMM-REAUTH-IND.      00135900
P9696      MOVE TC005-ECOMM-ORD-NBR     TO TC011-ECOMM-ORD-NBR.         00136000
P9696      MOVE TC005-AUTH-REF-NBR      TO TC011-AUTH-REF-NBR.          00136100
P9696      MOVE TC005-TRAN-CDE          TO TC011-TRAN-CDE.              00136200
P9696      MOVE TC005-MERCHANT-NBR      TO TC011-MERCHANT-NBR.          00136300
P9696      MOVE TC005-AVS-RSPN-CDE      TO TC011-AVS-RSPN-CDE.          00136400
P9696      MOVE TC005-VOID-ABRT-CDE     TO TC011-VOID-ABRT-CDE.         00136500
P9696      MOVE TC005-SLS-TX-AMT        TO TC011-SLS-TX-AMT.            00136600
P9696      MOVE TC005-CRD-LVL-RSLT-CDE  TO TC011-CRD-LVL-RSLT-CDE.      00136700
P9696      MOVE TC005-CVV-RSPN-CDE      TO TC011-CVV-RSPN-CDE.          00136800
P9696      MOVE TC005-E-BUS-IND         TO TC011-E-BUS-IND.             00136900
P9696      MOVE TC005-NETWK-REF-ID      TO TC011-NETWK-REF-ID.          00137000
P9696      MOVE TC005-TRSM-TMST         TO TC011-TRSM-TMST.             00137100
P9696      MOVE TC005-SYS-TRC-AUD-NBR   TO TC011-SYS-TRC-AUD-NBR.       00137200
P9696      MOVE TC005-TRK-DAT-CND-CDE   TO TC011-TRK-DAT-CND-CDE.       00137300
P9696      MOVE TC005-OMNI-CHNL-FFLMT-TYP-CDE                           00137400
P9696                                 TO TC011-OMNI-CHNL-FFLMT-TYP-CDE. 00137500
SHIP       MOVE TC005-VISA-MULT-CLR-SEQ-NBR                             00137600
SHIP                                   TO TC011-VISA-MULT-CLR-SEQ-NBR.  00137700
SHIP       MOVE TC005-VISA-TOT-SHP-NBR TO TC011-VISA-TOT-SHP-NBR.       00137800
SHIP2      MOVE TC005-PAR-SHIP-IND     TO TC011-PAR-SHP-IND.            00137900
052523     MOVE TC005-TRLING-TRN-IND   TO TC011-TRLING-TRN-IND.         00138000
052523     MOVE TC005-COBRAND-PYMT-IND TO TC011-COBRAND-PYMT-IND.       00139000
P9696                                                                   00139300
P9696      PERFORM 8600-WRITE-TC-AJB-FILE.                              00139400
P9696                                                                   00139500
P9696 **CALCULATES TOTAL DOLLAR AMOUNT                                  00139600
P9696      COMPUTE PV-TOT-TNDR-AMT = TC005-TNDR-AMT + PV-TOT-TNDR-AMT   00139700
P9696      END-COMPUTE.                                                 00139800
P9696                                                                   00139900
001130*----------------------------------------------------------------*00140000
001131*    CREATE-XMIT-FILE-HEADER                                     *00140100
001132*      PERFORMED ONLY VIA (0000-MAINLINE) BEGINNING OF JOB       *00140200
001133*    FUNCTION:  CREATE THE OUTPUT BANKCARD TRANSMIT FILE         *00140300
001134*      HEADER RECORD THAT IS REQUIRED.                           *00140400
001135*----------------------------------------------------------------*00140500
001136 8000-CREATE-XMIT-FILE-HEADER.                                    00140600
001137                                                                  00140700
001138     INITIALIZE  TC006-FILE-HEADER.                               00140800
001139                                                                  00140900
001140     MOVE '00'                   TO  TC006-FH-TRAN-REC-CDE.       00141000
001141     MOVE  1                     TO  TC006-FH-REL-FILE-NBR.       00141100
001142     MOVE  PV-TRAN-YYMMDD        TO  TC006-FH-PROCESS-DATE.       00141200
001143     MOVE  00148                 TO  TC006-FH-ORIG-ID.            00141300
001144     MOVE 04200031               TO  TC006-FH-DEST-ID.            00141400
001145     MOVE PV-TRAN-YYMMDD         TO  TC006-FH-CREATE-DATE.        00141500
001146     MOVE PV-TIME                TO  TC006-FH-CREATE-TIME.        00141600
001147     MOVE CC-SEQ-NUMBER          TO  PV-CN-SEQ-NBR.               00141700
001148     MOVE PV-CONTROL-NBR         TO  TC006-FH-FILE-SUB-NBR.       00141800
001149                                                                  00141900
001150     MOVE TC006-FILE-HEADER  TO TC006-SETTLEMENT-RECORD.          00142000
001151                                                                  00142100
001152     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00142200
001153                                                                  00142300
001154*----------------------------------------------------------------*00142400
001155*    CREATE-XMIT-FILE-TRAILER                                    *00142500
001156*      PERFORMED ONLY VIA (0000-MAINLINE) END-OF-JOB CLEANUP     *00142600
001157*    FUNCTION:  CREATE THE OUTPUT BANKCARD TRANSMIT FILE         *00142700
001158*      TRAILER RECORD THAT IS REQUIRED AT THE END OF THE FILE.   *00142800
001159*----------------------------------------------------------------*00142900
001160 8050-CREATE-XMIT-FILE-TRAILER.                                   00143000
001161                                                                  00143100
001162     INITIALIZE  TC006-FILE-TRAILER.                              00143200
001163                                                                  00143300
001164     MOVE '90'                   TO  TC006-FT-TRAN-REC-CDE.       00143400
001165     MOVE  1                     TO  TC006-FT-REL-FILE-NBR.       00143500
001166     MOVE  PV-TRAN-YYMMDD        TO  TC006-FT-PROCESS-DATE.       00143600
001167     MOVE  PV-FILE-BATCH-CNT     TO  TC006-FT-BATCH-CNT.          00143700
001168     COMPUTE TC006-FT-NET-FILE-TOT  =                             00143900
001169         (PV-FILE-SALES-TOT   -  PV-FILE-RETURNS-TOT).            00144000
001170     MOVE  PV-FILE-SALES-CNT                                      00144100
001171                                 TO  TC006-FT-SALE-TRANS-CNT.     00144200
001172     MOVE  PV-FILE-SALES-TOT     TO  TC006-FT-SALE-TOT-AMT.       00144300
001173     MOVE  PV-FILE-RETURNS-CNT                                    00144400
001174                                 TO  TC006-FT-RETURN-TRANS-CNT.   00144500
001175     MOVE  PV-FILE-RETURNS-TOT                                    00144600
001176                                 TO  TC006-FT-RETURN-TOT-AMT.     00144700
001177                                                                  00144800
052523     MOVE  PV-FILE-PAYMENT-CNT                                    00144900
052523                                 TO  TC006-FT-PAYMNT-TRANS-CNT.   00145000
052523     MOVE  PV-FILE-PAYMENT-TOT                                    00145100
052523                                 TO  TC006-FT-PAYMNT-TOT-AMT.     00145200
052523                                                                  00145300
001178     MOVE TC006-FILE-TRAILER     TO TC006-SETTLEMENT-RECORD.      00145400
001179                                                                  00145500
001180     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00145600
001181                                                                  00145700
001182*----------------------------------------------------------------*00145800
001183*    CREATE-BATCH-HEADER                                         *00145900
001184*      PERFORMED ONLY VIA (0000-MAINLINE              )          *00146000
001185*                     VIA (4000-COMPLETE-BATCH-PROCESS)          *00146100
001186*    FUNCTION:  CREATE THE BATCH HEADER RECORD BATCH PROCESSING  *00146200
001187*----------------------------------------------------------------*00146300
001188 8200-CREATE-BATCH-HEADER.                                        00146400
001189                                                                  00146500
001190     INITIALIZE  TC006-BATCH-HEADER.                              00146600
001191                                                                  00146700
001192     PERFORM 8900-FIND-MERCHANT-NUMBER.                           00146800
001193                                                                  00146900
001194     ADD 1                       TO  PV-FILE-BATCH-CNT.           00147000
001195     MOVE '10'                   TO  TC006-BH-TRAN-REC-CDE.       00147100
001196     MOVE PV-FILE-BATCH-CNT      TO  TC006-BH-REL-BAT-NBR.        00147200
001197     MOVE PV-TRAN-YYMMDD         TO  TC006-BH-PROCESS-DATE.       00147300
001198     MOVE XST00025-BNKCRD-MERCH-NBR TO PV-MERCHANT.               00147400
001199*    MOVE XST00025-BNKCRD-MERCH-NBR                               00147500
001200*                                TO  PV-FMT-DB2-MER-NBR-R.        00147600
001201*    MOVE PV-MER-NBR-D           TO  PV-MERCHANT.                 00147700
001202     MOVE PV-FMT-MERCHANT-R      TO  TC006-BH-STORE-MER-NBR.      00147800
001203     MOVE 'KOHLS # '             TO  PV-FMT-HRD-NAME.             00147900
001204     MOVE TC005-SETTLE-STORE-NBR TO  PV-FMT-STR-NBR.              00148000
001205     MOVE  PV-FMT-MER-NAME       TO  TC006-BH-MER-NAME.           00148100
001206     MOVE XST00001-CTY-NM        TO  TC006-BH-MER-CITY.           00148200
001207     MOVE XST00001-ST-CDE        TO  TC006-BH-MER-STATE.          00148300
001208     MOVE SPACES                 TO  TC006-BH-SIC-CDE.            00148400
001209     MOVE 'E'                    TO  TC006-BH-TRAN-TYPE.          00148500
001210     MOVE XST00001-ZIP-10-CDE    TO  PV-ZIP-CODE.                 00148600
001211     MOVE PV-ZIP-CODE-5          TO  PV-ZIP-CODE-59.              00148700
001212     IF PV-ZIP-CODE-DASH = '0'                                    00148800
001213         MOVE '0000'             TO  PV-ZIP-CODE-PLUS49           00148900
001214     ELSE                                                         00149000
001215         IF PV-ZIP-CODE-DASH = '-'                                00149100
001216             MOVE PV-ZIP-CODE-3       TO PV-ZIP-CODE-COM-3        00149200
001217             MOVE PV-ZIP-CODE-1       TO PV-ZIP-CODE-COM-1        00149300
001218             MOVE PV-ZIP-CODE-COM-RE  TO PV-ZIP-CODE-PLUS49       00149400
001219         ELSE                                                     00149500
001220             IF PV-ZIP-CODE-DASH > 0                              00149600
001221                 MOVE PV-ZIP-CODE-DASH    TO PV-ZIP-CODE-COMB-1   00149700
001222                 MOVE PV-ZIP-CODE-3       TO PV-ZIP-CODE-COMB-3   00149800
001223                 MOVE PV-ZIP-CODE-COMB-RE TO PV-ZIP-CODE-PLUS49   00149900
001224             END-IF                                               00150000
001225         END-IF                                                   00150100
001226     END-IF.                                                      00150200
001227     MOVE PV-ZIP-CODE-9RE        TO  TC006-BH-MER-ZIP.            00150300
001228     MOVE ZEROES TO PV-ZIP-CODE-COM-3                             00150400
001229                    PV-ZIP-CODE-COM-1                             00150500
001230                    PV-ZIP-CODE-COMB-1                            00150600
001231                    PV-ZIP-CODE-COMB-3                            00150700
001232                    PV-ZIP-CODE-PLUS49                            00150800
001233                    PV-ZIP-CODE-COMB-RE                           00150900
001234                    PV-ZIP-CODE-COM-RE                            00151000
001235                    PV-ZIP-CODE-9RE.                              00151100
001236     MOVE SPACES TO PV-ZIP-CODE-DASH                              00151200
001237                    PV-ZIP-CODE-3                                 00151300
001238                    PV-ZIP-CODE-1.                                00151400
001239                                                                  00151500
001240     MOVE  TC006-BATCH-HEADER    TO  TC006-SETTLEMENT-RECORD.     00151600
001241                                                                  00151700
001242     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00151800
001243                                                                  00151900
001244     PERFORM 8230-BATCH-HEADER-AMEX-ADDM.                         00152000
001245                                                                  00152100
001246*----------------------------------------------------------------*00152200
001247*    BATCH-HEADER-AMEX-ADDM                                      *00152300
001248*      PERFORMED ONLY VIA (8200-CREATE-BATCH-HEADER   )          *00152400
001249*    FUNCTION:  CREATE THE BATCH ADDENDUM RECORD FOR EACH BATCH  *00152500
001250*               HEADER THAT WAS CREATED.                         *00152600
001251*----------------------------------------------------------------*00152700
001252 8230-BATCH-HEADER-AMEX-ADDM.                                     00152800
001253                                                                  00152900
001254     INITIALIZE  TC006-AMEX-BH-ADDM.                              00153000
001255                                                                  00153100
001256     MOVE  '11'                  TO  TC006-AMEX-BH-TRAN-REC-CDE.  00153200
001257     MOVE  PV-FMT-MER-NAME       TO  TC006-AMEX-BH-MER-NAME.      00153300
001258     MOVE  '10'                  TO  TC006-AMEX-BH-FORMAT-CDE.    00153400
001259     MOVE  SPACES                TO  TC006-AMEX-BH-SERV-EST-NBR.  00153500
001260     MOVE  XST00001-CTY-NM       TO  TC006-AMEX-BH-SERV-EST-CITY. 00153600
001261     MOVE  '501'                 TO  TC006-AMEX-BH-INV-BATCH-CDE. 00153700
001262     MOVE  '00'                  TO  TC006-AMEX-BH-INV-SUB-CDE.   00153800
001263     MOVE  '010056'              TO  TC006-AMEX-BH-PRC-CNTL-ID.   00153900
001264                                                                  00154000
001265     MOVE  TC006-AMEX-BH-ADDM    TO TC006-SETTLEMENT-RECORD.      00154100
001266                                                                  00154200
001267     PERFORM 8950-FIND-MERCHANT-NUMBER.                           00154300
001268     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00154400
001269                                                                  00154500
001270*----------------------------------------------------------------*00154600
001271*    CREATE-BATCH-TRAILER                                        *00154700
001272*      PERFORMED ONLY VIA (0000-MAINLINE              )          *00154800
001273*                     VIA (4000-COMPLETE-BATCH-PROCESS)          *00154900
001274*    FUNCTION:  CREATE THE BATCH TRAILER RECORD FOR EACH BATCH   *00155000
001275*               HEADER THAT WAS CREATED.  DETAIL TOTALS AND      *00155100
001276*               ARE MOVE TO TRAILER FIELDS.                      *00155200
001277*----------------------------------------------------------------*00155300
001278 8250-CREATE-BATCH-TRAILER.                                       00155400
001279                                                                  00155500
001280     INITIALIZE   TC006-BATCH-TRAILER.                            00155600
001281                                                                  00155700
001282     MOVE  '80'                  TO  TC006-BT-TRAN-REC-CDE.       00155800
001283     MOVE PV-FILE-BATCH-CNT      TO  TC006-BT-REL-BATCH-NBR.      00155900
001284     MOVE PV-TRAN-YYMMDD         TO  TC006-BT-PROCESS-DATE.       00156000
001285     MOVE PV-BATCH-DETAIL-CNT    TO  TC006-BT-RECORD-CNT.         00156100
001286     COMPUTE TC006-BT-NET-BATCH-TOTAL   =                         00156200
001287         ( PV-BATCH-SALES-TOT     -  PV-BATCH-RETURNS-TOT).       00156300
001288     MOVE  PV-BATCH-SALES-CNT    TO  TC006-BT-SALE-TRANS-CNT.     00156400
001289     MOVE  PV-BATCH-SALES-TOT    TO  TC006-BT-SALE-TOT-AMT.       00156500
001290     MOVE  PV-BATCH-RETURNS-CNT                                   00156600
001291                                 TO  TC006-BT-RETURN-TRANS-CNT.   00156700
001292     MOVE  PV-BATCH-RETURNS-TOT                                   00156800
001293                                 TO  TC006-BT-RETURN-TOT-AMT.     00156900
052523     MOVE  PV-BATCH-PAYMENT-CNT                                   00157000
052523                                 TO  TC006-BT-PAYMNT-TRANS-CNT.   00157100
052523     MOVE  PV-BATCH-PAYMENT-TOT                                   00157200
052523                                 TO  TC006-BT-PAYMNT-TOT-AMT.     00157300
001296                                                                  00157700
001297     MOVE   TC006-BATCH-TRAILER  TO TC006-SETTLEMENT-RECORD.      00157800
001298                                                                  00157900
001299     ADD +1                      TO PV-CNT-BATCH-COUNT.           00158000
001300                                                                  00158100
001301     PERFORM 8400-WRITE-BANK-TRANSMIT-FILE.                       00158200
001302                                                                  00158300
052523     ADD PV-BATCH-PAYMENT-CNT    TO  PV-FILE-PAYMENT-CNT.         00158400
052523     ADD PV-BATCH-PAYMENT-TOT    TO  PV-FILE-PAYMENT-TOT.         00158500
001303     ADD PV-BATCH-RETURNS-CNT    TO  PV-FILE-RETURNS-CNT.         00158600
001304     ADD PV-BATCH-RETURNS-TOT    TO  PV-FILE-RETURNS-TOT.         00158700
001305     ADD PV-BATCH-SALES-CNT      TO  PV-FILE-SALES-CNT.           00158800
001306     ADD PV-BATCH-SALES-TOT      TO  PV-FILE-SALES-TOT.           00158900
001307                                                                  00159000
001308     INITIALIZE PV-BATCH-TOTALS.                                  00159100
001309                                                                  00159200
001310*----------------------------------------------------------------*00159300
001311*    WRITE-BANK-TRANSMIT-FILE                                    *00159400
001312*      PERFORMED ONLY VIA (5000-PROCESS-DETAIL         )         *00159500
001313*                     VIA (5100-VISA-ADDM-REC           )        *00159600
001314*                     VIA (5150-VISA-ADDM-VER2-REC      )        *00159700
001315*                     VIA (5200-MASTERCARD-ADDM-REC     )        *00159800
001316*                     VIA (5300-AMEX-ADDM-REC           )        *00159900
001317*                     VIA (8000-CREATE-XMIT-FILE-HEADER )        *00160000
001318*                     VIA (8050-CREATE-XMIT-FILE-TRAILER)        *00160100
001319*                     VIA (8200-CREATE-BATCH-HEADER     )        *00160200
001320*    FUNCTION:                                                   *00160300
001321*      WRITE AN OUPUT RECORD CREATED IN THE BUILD PARAGRAPHS.    *00160400
001322*      WRITE OUT THE OUTPUT TRANSACTION RECORDS.                 *00160500
001323*----------------------------------------------------------------*00160600
001324 8400-WRITE-BANK-TRANSMIT-FILE.                                   00160700
001325     WRITE BANKCARD-TRANSMIT-RECORD FROM TC006-SETTLEMENT-RECORD. 00160800
001326                                                                  00160900
P9696 *----------------------------------------------------------------*00161000
P9696 *   CREATE TRAILER RECORD FOR NEW SETTLEMENT FILE.                00161100
P9696 *----------------------------------------------------------------*00161200
P9696  8500-CREATE-AJB-TRAILER.                                         00161300
P9696                                                                   00161400
P9696      INITIALIZE TC011-EXTRACT-RECORD.                             00161500
P9696      SET  AR025-TRAILER           TO TRUE.                        00161600
P9696      MOVE PV-REC-COUNT            TO TC011-TOTAL-COUNT.           00162000
P9696      MOVE PV-TOT-TNDR-AMT         TO TC011-TOTAL-DOLLAR-AMOUNT    00162100
P9696                                      PV-TOT-TNDR-AMT-DISP.        00162200
P9696      PERFORM 8600-WRITE-TC-AJB-FILE.                              00162300
P9696 *----------------------------------------------------------------*00162400
P9696 *   WRITES RECORD IN NEW SETTLEMENT FILE.                         00162500
P9696 *----------------------------------------------------------------*00162600
P9696  8600-WRITE-TC-AJB-FILE.                                          00162700
P9696                                                                   00162800
P9696      WRITE AJB-SETTLEMENT-RECORD  FROM TC011-EXTRACT-RECORD.      00162900
P9696      ADD +1  TO PV-REC-COUNT.                                     00163000
001327*----------------------------------------------------------------*00163100
001328*    FIND-MERCHANT-NUMBER                                        *00163200
001329*      PERFORMED ONLY VIA (8200-CREATE-BATCH-HEADER)   ROUTINE   *00163300
001330*    FUNCTION: LOOKUP THE MERCHANT NUMBER CORRESPONDING TO THE   *00163400
001331*      CURRENT STORE BEING PROCESSED.  THIS IS DONE ONLY WHEN A  *00163500
001332*      NEW STORE IS ENCOUNTERED.  DB/2 USED TO ACCESS STORE      *00163600
001333*      TABLE.                                                    *00163700
001334*----------------------------------------------------------------*00163800
001335 8900-FIND-MERCHANT-NUMBER.                                       00163900
001336                                                                  00164000
001337     MOVE TC005-SETTLE-STORE-NBR       TO PV-4-DIGIT-STORE.       00164100
001338                                                                  00164200
001339     EXEC SQL                                                     00164300
001340         SELECT COALESCE(BNKCRD_MERCH_NBR, 0)                     00164400
001341              , ZIP_10_CDE                                        00164500
001342              , CTY_NM                                            00164600
001343              , ST_CDE                                            00164700
001344              , COALESCE(E_BUS_IND, 'N')                          00164800
001345             INTO :XST00025-BNKCRD-MERCH-NBR                      00164900
001346                , :XST00001-ZIP-10-CDE                            00165000
001347                , :XST00001-CTY-NM                                00165100
001348                , :XST00001-ST-CDE                                00165200
001349                , :XST00001-E-BUS-IND                             00165300
001350             FROM XST_LOC      A                                  00165400
001351                , XST_LOC_ATTR B                                  00165500
001352             WHERE A.LOC_NBR = B.LOC_NBR                          00165600
001353             AND   A.LOC_NBR = :PV-4-DIGIT-STORE                  00165700
001354             AND   A.LOC_TYP_CDE = :PC-DEPARTMENT-STORE-TYPE      00165800
001355          WITH UR                                                 00165900
001356     END-EXEC.                                                    00166000
001357                                                                  00166100
001358     EVALUATE TRUE                                                00166200
001359         WHEN SQLCODE = ZERO                                      00166300
001360             CONTINUE                                             00166400
001361         WHEN SQLCODE = +100                                      00166500
001362             INITIALIZE XST00025-BNKCRD-MERCH-NBR                 00166600
001363                        XST00001-ZIP-10-CDE                       00166700
001364                        XST00001-CTY-NM                           00166800
001365                        XST00001-ST-CDE                           00166900
001366                        XST00001-E-BUS-IND                        00167000
001367         WHEN OTHER                                               00167100
001368             SET PV-SELECT-STORE-ROW  TO TRUE                     00167200
001369             PERFORM 9500-DB2-ERROR                               00167300
001370     END-EVALUATE.                                                00167400
001371*----------------------------------------------------------------*00167500
001372*    FIND-MERCHANT-NUMBER                                        *00167600
001373*    FUNCTION: LOOKUP THE MERCHANT NUMBER CORRESPONDING TO THE   *00167700
001374*      CURRENT STORE BEING PROCESSED.  THIS IS DONE ONLY WHEN A  *00167800
001375*      NEW STORE IS ENCOUNTERED.  DB/2 USED TO ACCESS STORE      *00167900
001376*      TABLE.                                                    *00168000
001377*----------------------------------------------------------------*00168100
001378 8950-FIND-MERCHANT-NUMBER.                                       00168200
001379                                                                  00168300
001380     EXEC SQL                                                     00168400
001381         SELECT COALESCE(DSCVR_MERCH_NBR, 0)                      00168500
001386             INTO :XST00025-DSCVR-MERCH-NBR                       00168600
001393         FROM XST_LOC_ATTR A                                      00168700
001394            , XST_LOC      B                                      00168800
001395         WHERE A.LOC_NBR    = :TC005-STR-NBR                      00168900
001396           AND A.LOC_NBR    = B.LOC_NBR                           00169000
001397           AND B.OPN_DTE   <= :TC005-SLS-DTE                      00169100
001398           AND B.CLO_DTE   >= :TC005-SLS-DTE                      00169200
001401     END-EXEC.                                                    00169300
001402                                                                  00169400
001403     EVALUATE TRUE                                                00169500
001404         WHEN SQLCODE = ZERO                                      00169600
001405             MOVE XST00025-DSCVR-MERCH-NBR                        00169700
001406                                      TO PV-SAVE-MERCHANT-NO      00169800
001407         WHEN SQLCODE = +100                                      00169900
001409             INITIALIZE XST00025-DSCVR-MERCH-NBR                  00170000
001410                        PV-SAVE-MERCHANT-NO                       00170100
001411         WHEN OTHER                                               00170200
001412             SET PV-SELECT-STORE-ROW  TO TRUE                     00170300
001413             PERFORM 9100-DB2-ERROR                               00170400
001414     END-EVALUATE.                                                00170500
001415*----------------------------------------------------------------*00170600
001416*    DB2-ERROR                                                   *00170700
001417*      PERFORMED ONLY VIA (8900-FIND-MERCHANT-NUMBER)            *00170800
001418*    FUNCTION: HANDLE DB2 ERRORS                                 *00170900
001419*----------------------------------------------------------------*00171000
001420 9500-DB2-ERROR.                                                  00171100
001421     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NUMBER.                    00171200
001422     DISPLAY PC-DB-ERROR-PREFIX                                   00171300
001423     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             00171400
001424                                                                  00171500
001425     COPY DPPD004.                                                00171600
001426                                                                  00171700
001427     SET ABEND-4013-DB2-ERROR         TO TRUE.                    00171800
001428     CALL 'ILBOABN0' USING ABEND-CODE.                            00171900
001429*----------------------------------------------------------------*00172000
001430*    SETUP-DATE                                                  *00172100
001431*      PERFORMED ONLY VIA (0000-MAINLINE) INITAL HOUSEKEEPING    *00172200
001432*    FUNCTION: ONETIME ROUTINE TO GET THE DATE RECORD            *00172300
001433*----------------------------------------------------------------*00172400
001434 9900-SETUP-DATE.                                                 00172500
001435                                                                  00172600
001436     READ CONTROL-CARD-FILE INTO CC-CONTROL-CARD                  00172700
001437        AT END                                                    00172800
001438           SET PS-END-OF-CONTROL-FILE  TO TRUE.                   00172900
001439                                                                  00173000
001440     DISPLAY 'TCKUT008 CONTROL CARD: ' CC-CONTROL-CARD.           00173100
001441                                                                  00173200
001442     CLOSE CONTROL-CARD-FILE.                                     00173300
001443                                                                  00173400
001444     IF PS-END-OF-CONTROL-FILE                                    00173500
001445         SET ABEND-4003-INVALID-CC       TO TRUE                  00173600
001446         MOVE '9900-SETUP-DATE'        TO PV-PARAGRAPH-NAME       00173700
001447         MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     00173800
001448         PERFORM 9999-ABEND                                       00173900
001449     ELSE                                                         00174000
001450         PERFORM 9910-CONVERT-INPUT-DATE                          00174100
001451     END-IF.                                                      00174200
001452                                                                  00174300
001453*----------------------------------------------------------------*00174400
001454*    FUNCTION: HANDLE DB2 ERRORS                                 *00174500
001455*----------------------------------------------------------------*00174600
001456 9100-DB2-ERROR.                                                  00174700
001457                                                                  00174800
001458     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NUMBER.                    00174900
001459     DISPLAY PC-DB-ERROR-PREFIX                                   00175000
001460     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             00175100
001461     COPY DPPD004.                                                00175200
001462     SET ABEND-4013-DB2-ERROR TO TRUE.                            00175300
001463     CALL 'ILBOABN0' USING ABEND-CODE.                            00175400
001464                                                                  00175500
001465******************************************************************00175600
001466*     CALL KOHLS CALENDAR ROUTINE:                                00175700
001467*         PASS: CONTROL CARD POS DATE (MMDDCCYY FORMAT).          00175800
001468*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 00175900
001469******************************************************************00176000
001470 9910-CONVERT-INPUT-DATE.                                         00176100
001471                                                                  00176200
001472     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              00176300
001473                                                                  00176400
001474     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   00176500
001475     SET  DPG52-LK-DTE-GREG-CC         TO TRUE.                   00176600
001476     MOVE CC-DATE-MMDDCCYY             TO DPG52-LK-DATE-INPUT.    00176700
001477     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    00176800
001478                                             DPG54 DPG55 DPG56.   00176900
001479     EVALUATE TRUE                                                00177000
001480         WHEN DPG54-SEVERE-ERROR                                  00177100
001481             DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NUMBER             00177200
001482             DISPLAY PC-CAL-SUB-TRN-DTE-ERROR                     00177300
001483             SET ABEND-4019-CAL-SUB-ERROR                         00177400
001484                                 TO TRUE                          00177500
001485             CALL 'ILBOABN0' USING ABEND-CODE                     00177600
001486         WHEN OTHER                                               00177700
001487             MOVE DPG55-JULIAN-DATE-CCYYDDD TO PV-CN-JDAY         00177800
001488             DISPLAY 'JUL DATE = '             PV-CN-JDAY         00177900
001489     END-EVALUATE.                                                00178000
001490                                                                  00178100
001491     MOVE CC-DATE-MMDD           TO PV-TRAN-MMDD.                 00178200
001492     MOVE CC-DATE-YY             TO PV-TRAN-YY.                   00178300
001493                                                                  00178400
001494     IF CC-SEQ-NUMBER   NOT NUMERIC                               00178500
001495     OR   CC-SEQ-NUMBER   = 0                                     00178600
001496         SET ABEND-4003-INVALID-CC       TO TRUE                  00178700
001497         MOVE '9910-CONVERT-INPUT-DATE' TO PV-PARAGRAPH-NAME      00178800
001498         MOVE 'SEQUENCE NUMBER INVALID' TO PV-OPERATION-MSG-1     00178900
001499         PERFORM 9999-ABEND                                       00179000
001500     END-IF.                                                      00179100
001501                                                                  00179200
001502*************************************************************     00179300
001503*  9999-ABEND                                                     00179400
001504*       ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                00179500
001505*************************************************************     00179600
001506 9999-ABEND.                                                      00179700
001507     DISPLAY '** ABEND           **'.                             00179800
001508     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NUMBER.        00179900
001509     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        00180000
001510     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       00180100
001520     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       00181000
001600     CALL 'ILBOABN0' USING ABEND-CODE.                            00190000
