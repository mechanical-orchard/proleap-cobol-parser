000100 IDENTIFICATION DIVISION.                                         00010003
000200 PROGRAM-ID.     APKUT070.                                        00020003
000300 AUTHOR.         ROBIN BERNOSKI.                                  00030051
000400 DATE-WRITTEN.   MAY 1998.                                        00040004
000500 DATE-COMPILED.                                                   00050003
000600***************************************************************** 00060016
000700*    COBOL 2 WITH SQL                                           * 00070016
000800*        - CREATE EXPENSE INVOICE JOURNALIZE STATUS -           * 00080019
000900*                                                               * 00090016
001000*  THIS PROGRAM RUNS AS A PART OF THE IMPORT JOURNALIZING       * 00100016
001100*  PROCESS.  IT WILL IDENTIFY ALL EXPENSE INVOICES THAT GO      * 00110016
001200*  WITH THE PO'S BEING JOURNALIZED AND CREATED STATUS UPDATE    * 00120016
001300*  RECORDS FOR EACH INVOICE.  THESE RECORDS WILL UPDATE ONLY    * 00130051
001400*  THE 'JOURNALIZE' CODE, BECAUSE THE PAYMENT STATUS WAS        * 00140016
001500*  UPDATED AT A DIFFERENT POINT IN THE PROCESSING.              * 00150051
001600*                                                               * 00160051
001700* INPUT:                                                        * 00170051
001800*  1. INVOICE ACTUAL COSTS             (APRD060)                * 00180051
001900*  2. RELEASED PO/STORES               (TPOSTRR)                * 00190051
002000*  3. AP CONTROL TABLE                 (TAPCNTL)                * 00200016
002100*                                                               * 00210016
002200* OUTPUT:                                                       * 00220016
002300*  1. STATUS UPDATE RECORDS            (APRD252)                * 00230016
002400*                                                               * 00240016
002500***************************************************************** 00250016
002600* CHANGE LOG:                                                   * 00260051
002700* 11/17/97   INITIAL VERSION.   WR4164                          * 00270051
002800*                                                               * 00280051
002900* 09/03/98    CAROLYN GIFFORD               WR# 6041            * 00290051
003000*             Y2K CHANGES. INITIALIZE PV-CURR-DB2-CENT TO ZEROS.* 00300051
003100*             REMOVE PV-CURR-JULIAN-DATE & DPWS500 FROM PROGRAM * 00310051
003200*             FIELDS ARE NOT USED.                              * 00320051
003300*                                                               * 00330052
003400* 06/17/2002  KEVIN CATLIN                  WR# 23500           * 00340056
003500*             ARK PO PROJECT PHASE 1.  IN PARAGRAPH B200,       * 00350055
003600*             REPLACE AP252-PAY-REQ-SEQ-NBR WITH AP252-PO-NBR.  * 00360052
003700*                                                               * 00370052
003800* 11/04/2002  MIKE BESKE                    WR# 23750           * 00380058
003900*             COLBY DATING PROJECT.  MODIFIED CODE IN B200-     * 00390057
004000*             TO REFLECT CHANGES WITH APRD252 COPYBOOK.  ALSO   * 00400057
004100*             INCREASED THE LRECL FROM 50 TO 80 FOR OUTPUT FILE.* 00410057
004200*                                                               * 00420057
004210* 03/11/2007  GREG WISIALOWSKI              WR# 21578           * 00421059
004220*             MBDC PROJECT. RECOMPILE                           * 00422059
004250*                                                               * 00425059
004260* 09/21/2010  NANCY EILBES                  IR# INC000001405388 * 00426060
004270*             CORRECT SELECT ON TPOSTRR TO HANDLE THE FACT THAT * 00427060
004271*             WITH APK038 RUNNING BEFORE APK037, THE STATUS     * 00427160
004272*             WILL NOT BE UPDATED TO 'P'. THIS SHOULD HAVE BEEN * 00427260
004273*             CHANGED FOR WR38002.                              * 00427360
004250*                                                               * 00427461
004260* 05/11/2021  JEAN KURK                     IR# CHG0256545      * 00427562
004270*             RECOMPILE FOR UPDATED APWS008 COPYBOOK            * 00427661
004280*                                                               * 00428060
004300***************************************************************** 00430057
004400                                                                  00440057
004500 ENVIRONMENT DIVISION.                                            00450057
004600 CONFIGURATION SECTION.                                           00460057
004700 SOURCE-COMPUTER.    IBM-3090.                                    00470057
004800 OBJECT-COMPUTER.    IBM-3090.                                    00480057
004900                                                                  00490057
005000 INPUT-OUTPUT SECTION.                                            00500057
005100 FILE-CONTROL.                                                    00510057
005200     SELECT INVC-IMPORT-FILE  ASSIGN TO UT-S-INP01.               00520057
005300     SELECT STATUS-UPDATE-FILE            ASSIGN TO UT-S-OUT01.   00530057
005400                                                                  00540057
005500 DATA DIVISION.                                                   00550057
005600 FILE SECTION.                                                    00560057
005700                                                                  00570057
005800 FD  INVC-IMPORT-FILE                                             00580057
005900     RECORDING MODE IS F                                          00590057
006000     LABEL RECORDS ARE STANDARD                                   00600057
006100     DATA RECORD IS INVC-COSTS-REC.                               00610057
006200 01  INVC-COSTS-REC.                                              00620057
006300     05 FILLER                        PIC  X(175).                00630057
006400                                                                  00640057
006500 FD  STATUS-UPDATE-FILE                                           00650057
006600     RECORDING MODE IS F                                          00660057
006700     LABEL RECORDS ARE STANDARD                                   00670057
006800     BLOCK CONTAINS 0 RECORDS                                     00680057
006900     DATA RECORD IS STATUS-UPDATE-REC.                            00690057
007000 01  STATUS-UPDATE-REC.                                           00700057
007100     05 FILLER                        PIC  X(80).                 00710057
007200                                                                  00720057
007300 WORKING-STORAGE SECTION.                                         00730057
007400                                                                  00740057
007500 01  PC-PROGRAM-CONSTANTS.                                        00750057
007600     05  FILLER                  PIC  X(30)  VALUE                00760057
007700         '** BEGINING OF APKUT070 W/S **'.                        00770057
007800                                                                  00780057
007900     05  PC-PROGRAM-NAME         PIC  X(08)  VALUE 'APKUT070'.    00790057
008000                                                                  00800057
008100 01  PV-PROGRAM-VARIABLES.                                        00810057
008200     05  PV-HOLD-PO-NBR          PIC S9(09)       VALUE ZEROS     00820057
008300                                             COMP.                00830057
008400     05  PV-PO-IN-PROCESS-9      PIC 9(09)        VALUE ZEROS.    00840057
008500     05  PV-DATE-TIME-FIELDS.                                     00850057
008600         10  PV-CURR-DB2-DATE.                                    00860057
008700             15  PV-CURR-DB2-CENT      PIC  9(02)  VALUE ZEROS.   00870057
008800             15  PV-CURR-DB2-YEAR      PIC  9(02)  VALUE ZEROS.   00880057
008900             15  FILLER                PIC  X(01)  VALUE '-'.     00890057
009000             15  PV-CURR-DB2-MONTH     PIC  9(02)  VALUE ZEROS.   00900057
009100             15  FILLER                PIC  X(02)  VALUE '-'.     00910057
009200             15  PV-CURR-DB2-DAY       PIC  9(02)  VALUE ZEROS.   00920057
009300                                                                  00930057
009400     05  PV-COUNTERS.                                             00940057
009500         10  PV-COUNT-POCSR-READ       PIC  9(07).                00950057
009600         10  PV-COUNT-INVC-READ        PIC  9(07).                00960057
009700         10  PV-COUNT-ENT-WROTE        PIC  9(07).                00970057
009800                                                                  00980057
009900 01  PS-PROGRAM-SWITCHES.                                         00990057
010000     05  PS-END-OF-INVOICES-SW   PIC X(01)        VALUE 'N'.      01000057
010100         88  END-OF-INVOICES                      VALUE 'Y'.      01010057
010200     05  PS-FOUND-PO-ROWS-SW     PIC X(01)        VALUE 'N'.      01020057
010300         88  NEW-PO-ROWS                          VALUE 'N'.      01030057
010400         88  FOUND-PO-ROWS                        VALUE 'Y'.      01040057
010500     05  PS-END-OF-PO-CSR-SW     PIC X(01)        VALUE 'N'.      01050057
010600         88  NEW-PO-CSR                           VALUE 'N'.      01060057
010700         88  END-OF-PO-CSR                        VALUE 'Y'.      01070057
010800     05  PS-END-OF-RCVR-FILE-SW   PIC X(01)       VALUE 'N'.      01080057
010900         88  END-OF-RCVR-FILE                     VALUE 'Y'.      01090057
011000     05  PS-END-OF-ELC-VAR-SW    PIC X(01)        VALUE 'N'.      01100057
011100         88  END-OF-ELC-VAR                       VALUE 'Y'.      01110057
011200     05  PS-ELC-COSTS-FOUND-SW   PIC X(01)        VALUE 'N'.      01120057
011300         88  ELC-COSTS-NOT-FOUND                  VALUE 'N'.      01130057
011400         88  ELC-COSTS-FOUND                      VALUE 'Y'.      01140057
011500                                                                  01150057
011600*----------------------------------------------------------------*01160057
011700* COMMUNICATIONS AREA2 FOR DB2                                   *01170057
011800*----------------------------------------------------------------*01180057
011900     COPY SQLCA2.                                                 01190057
012000                                                                  01200057
012100     EXEC SQL                                                     01210057
012200          INCLUDE SQLCA                                           01220057
012300     END-EXEC.                                                    01230057
012400                                                                  01240057
012500*----------------------------------------------------------------*01250057
012600* RELEASED PO/STORES TABLE                                       *01260057
012700*----------------------------------------------------------------*01270057
012800     EXEC SQL                                                     01280057
012900          INCLUDE TPOSTRR                                         01290057
013000     END-EXEC.                                                    01300057
013100                                                                  01310057
013200*----------------------------------------------------------------*01320057
013300* AP CONTROL TABLE                                               *01330057
013400*----------------------------------------------------------------*01340057
013500     EXEC SQL                                                     01350057
013600          INCLUDE TAPCNTL                                         01360057
013700     END-EXEC.                                                    01370057
013800                                                                  01380057
013900*----------------------------------------------------------------*01390057
014000* PO_CSR WILL RETREIVE ALL PO/STORE ROWS THAT WERE CREATED IN    *01400060
014100* THE BATCH MATCH FOR IMPORT POS.                                *01410060
014200*----------------------------------------------------------------*01420057
014300     EXEC SQL                                                     01430057
014400       DECLARE PO_CSR CURSOR FOR                                  01440057
014500         SELECT  PO_NBR                                           01450057
014600         FROM    TPOSTRR                                          01460057
014700         WHERE CRE_PRC_CDE         = 'B'                          01470057
014710           AND STATUS_CDE          = ' '                          01471060
014720           AND MTCH_LVL_CDE        = 'P'                          01472060
014800**           AND STATUS_CDE          = 'P'                        01480060
014900         ORDER BY PO_NBR                                          01490057
015000     END-EXEC.                                                    01500057
015100                                                                  01510057
015200*----------------------------------------------------------------*01520057
015300*  IMPORT PO - BATCH MATCH INVOICE EXTRACT FILE RECORD LAYOUT     01530057
015400*----------------------------------------------------------------*01540057
015500     COPY APRD060.                                                01550057
015600                                                                  01560057
015700*----------------------------------------------------------------*01570057
015800*  IMPORT PO - OPEN TO PAY INVOICE UPDATE FILE RECORD LAYOUT      01580057
015900*----------------------------------------------------------------*01590057
016000     COPY APRD252.                                                01600057
016100                                                                  01610057
016200*----------------------------------------------------------------*01620057
016300*  WORKING STORAGE AREA FOR DPKUT500, DATE MANIPULATION ROUTINE  *01630057
016400*----------------------------------------------------------------*01640057
016500                                                                  01650057
016600*----------------------------------------------------------------*01660057
016700*  ABEND DATA AREAS                                              *01670057
016800*----------------------------------------------------------------*01680057
016900 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01690057
017000                                             COMP SYNC.           01700057
017100     88  AC-BAD-DATA                         VALUE +4003.         01710057
017200     88  AC-DB2-ERROR                        VALUE +4013.         01720057
017300     88  AC-DATE-ERROR                       VALUE +4019.         01730057
017400                                                                  01740057
017500 01  ABEND-AREAS.                                                 01750057
017600     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01760057
017700             '*****       ABEND'.                                 01770057
017800     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01780057
017900             '*****   PROGRAM: APKUT070'.                         01790057
018000     05  AA-PARAGRAPH-LIT.                                        01800057
018100         10  FILLER              PIC  X(17)  VALUE                01810057
018200             '***** PARAGRAPH: '.                                 01820057
018300         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01830057
018400     05  AA-MESSAGE-LINE.                                         01840057
018500         10  FILLER              PIC  X(06)  VALUE '*****'.       01850057
018600         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01860057
018700     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01870057
018800             '*****    DB2 ERROR'.                                01880057
018900     05  AA-DB2-OPERATION-LIT.                                    01890057
019000         10  FILLER              PIC  X(17)  VALUE                01900057
019100             '***** OPERATION: '.                                 01910057
019200         10  AA-DB2-OPERATION.                                    01920057
019300             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01930057
019400             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01940057
019500     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01950057
019600     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01960057
019700     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01970057
019800     05  AA-DB2-TABLE-4          PIC  X(08)  VALUE SPACES.        01980057
019900                                                                  01990057
020000     COPY DPWS004.                                                02000057
020100 01  FILLER                      PIC  X(25)  VALUE                02010057
020200     '** END OF APKUT070 W/S **'.                                 02020057
020300                                                                  02030057
020400 PROCEDURE DIVISION.                                              02040057
020500 A100-MAIN.                                                       02050057
020600                                                                  02060057
020700     PERFORM B100-HOUSEKEEPING.                                   02070057
020800                                                                  02080057
020900     PERFORM B200-PROCESS-POS                                     02090057
021000       UNTIL END-OF-INVOICES                                      02100057
021100         OR  END-OF-PO-CSR.                                       02110057
021200                                                                  02120057
021300     PERFORM B300-END-PROGRAM.                                    02130057
021400                                                                  02140057
021500     GOBACK.                                                      02150057
021600                                                                  02160057
021700                                                                  02170057
021800*----------------------------------------------------------------*02180057
021900*    INITIALIZATION PROCESS AND INITIAL READS FOR THE INPUT.     *02190057
022000*----------------------------------------------------------------*02200057
022100 B100-HOUSEKEEPING.                                               02210057
022200                                                                  02220057
022300     OPEN INPUT  INVC-IMPORT-FILE                                 02230057
022400          OUTPUT STATUS-UPDATE-FILE.                              02240057
022500                                                                  02250057
022600     INITIALIZE DCLTPOSTRR                                        02260057
022700                DCLTAPCNTL                                        02270057
022800                AP060-INVOICE-EXTRACT                             02280057
022900                AP252-RECORD                                      02290057
023000                AA-DB2-TABLE-1                                    02300057
023100                AA-DB2-TABLE-2                                    02310057
023200                AA-DB2-TABLE-3                                    02320057
023300                AA-DB2-TABLE-4                                    02330057
023400                PV-COUNTERS.                                      02340057
023500                                                                  02350057
023600     PERFORM Y100-GET-BATCH-DATE.                                 02360057
023700     MOVE APCNTL-BTCH-PRC-DTE    TO PV-CURR-DB2-DATE.             02370057
023800     PERFORM X100-OPEN-PO-CSR.                                    02380057
023900                                                                  02390057
024000     PERFORM F100-FETCH-PO-CSR.                                   02400057
024100     IF END-OF-PO-CSR                                             02410057
024200         DISPLAY 'FIRST FETCH OF POSTRR CURSOR  '                 02420057
024300         DISPLAY ' '                                              02430057
024400         DISPLAY 'END OF PROCESSING             '                 02440057
024500     END-IF.                                                      02450057
024600                                                                  02460057
024700     PERFORM R100-READ-INVOICES.                                  02470057
024800     IF END-OF-INVOICES                                           02480057
024900         DISPLAY 'END OF FILE CONDITION'                          02490057
025000         DISPLAY 'FIRST READ OF IMPORT INVOICE FILE'              02500057
025100         DISPLAY 'IMPRT INV RECS PROCESSED   = '                  02510057
025200                               PV-COUNT-INVC-READ                 02520057
025300         DISPLAY ' '                                              02530057
025400         DISPLAY 'END OF PROCESSING             '                 02540057
025500     END-IF.                                                      02550057
025600                                                                  02560057
025700                                                                  02570057
025800*----------------------------------------------------------------*02580057
025900*    CONTROLS THE PROCESSING OF EACH PO AS FOLLOWS:              *02590057
026000*                                                                *02600057
026100*    - BUMPS PO_CSR AGAINST AP060(IMPORT INVOICES) FILE TO FIND  *02610057
026200*      A MATCH ON A PO NUMBER.                                   *02620057
026300*    - WHEN A MATCH IS FOUND:                                    *02630057
026400*      - A TPOSTRR ROW IS FETCHED                                *02640057
026500*      - AN OUTPUT RECORD IS CREATED TO UPDATE THE AP-PRC-CDE TO *02650057
026600*        'J' AND THE AP-PRC-DTE TO THE APCNTL-BTCH-PRC-DTE       *02660057
026700*      - THE STATUS CODE IS LEFT TO SPACES.                      *02670057
026800*                                                                *02680057
026900*----------------------------------------------------------------*02690057
027000 B200-PROCESS-POS.                                                02700057
027100                                                                  02710057
027200        IF POSTRR-PO-NBR > AP060-PO-NBR                           02720057
027300           PERFORM R100-READ-INVOICES                             02730057
027400        ELSE                                                      02740057
027500           IF POSTRR-PO-NBR < AP060-PO-NBR                        02750057
027600              PERFORM F100-FETCH-PO-CSR                           02760057
027700           ELSE                                                   02770057
027800              MOVE AP060-PO-NBR           TO AP252-PO-NBR         02780057
027900              MOVE AP060-INVOICE-NUMBER   TO AP252-INVOICE-ID     02790057
028000              MOVE SPACES                 TO AP252-PAYT-DTE       02800057
028100                                             AP252-NEW-STATUS-CDE 02810057
028200              MOVE 'J'                    TO AP252-AP-PRC-CDE     02820057
028300              MOVE PV-CURR-DB2-DATE       TO AP252-AP-PRC-DTE     02830057
028400              PERFORM W100-WRITE-STATUS-UPDATE-FILE               02840057
028500                                                                  02850057
028600* JUST PROCESSED THE MATCHING PO, GET NEW INPUTS                  02860057
028700           PERFORM R100-READ-INVOICES                             02870057
028800                                                                  02880057
028900           END-IF                                                 02890057
029000        END-IF.                                                   02900057
029100                                                                  02910057
029200                                                                  02920057
029300*----------------------------------------------------------------*02930057
029400*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *02940057
029500*----------------------------------------------------------------*02950057
029600 B300-END-PROGRAM.                                                02960057
029700                                                                  02970057
029800     DISPLAY 'POSTRR ROWS FETCHED    = ' PV-COUNT-POCSR-READ.     02980057
029900                                                                  02990057
030000     DISPLAY 'TOTAL PO WRITTEN = ' PV-COUNT-ENT-WROTE.            03000057
030100                                                                  03010057
030200     PERFORM X110-CLOSE-PO-CSR.                                   03020057
030300                                                                  03030057
030400     CLOSE INVC-IMPORT-FILE                                       03040057
030500           STATUS-UPDATE-FILE.                                    03050057
030600                                                                  03060057
030700                                                                  03070057
030800*----------------------------------------------------------------*03080057
030900*  RETRIEVES THE ELC CURSOR DATA                                 *03090057
031000*----------------------------------------------------------------*03100057
031100 F100-FETCH-PO-CSR.                                               03110057
031200                                                                  03120057
031300     EXEC SQL                                                     03130057
031400         FETCH   PO_CSR                                           03140057
031500         INTO    :POSTRR-PO-NBR                                   03150057
031600     END-EXEC.                                                    03160057
031700                                                                  03170057
031800     EVALUATE TRUE                                                03180057
031900         WHEN SQLCODE = ZERO                                      03190057
032000             ADD 1 TO PV-COUNT-POCSR-READ                         03200057
032100             SET FOUND-PO-ROWS TO TRUE                            03210057
032200                                                                  03220057
032300         WHEN SQLCODE = +100                                      03230057
032400             SET END-OF-PO-CSR TO TRUE                            03240057
032500             IF NEW-PO-ROWS                                       03250057
032600                 DISPLAY '* * * * * * * * * * * * * * * * * * '   03260057
032700                 DISPLAY 'NO POSTRR DATA TO PROCESS '             03270057
032800                 DISPLAY '* * * * * * * * * * * * * * * * * * '   03280057
032900             END-IF                                               03290057
033000             INITIALIZE POSTRR-PO-NBR                             03300057
033100                                                                  03310057
033200         WHEN SQLWARN0 NOT = SPACES                               03320057
033300         WHEN SQLCODE  NOT = ZERO                                 03330057
033400             MOVE 'F100-FETCH-PO-CSR'                             03340057
033500                                 TO AA-PARAGRAPH-NAME             03350057
033600             MOVE 'UNSUCCESSFUL FETCH WITH PO_CSR'                03360057
033700                                 TO AA-DB2-OPERATION              03370057
033800             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                03380057
033900             PERFORM Z999-DB2-ABEND                               03390057
034000     END-EVALUATE.                                                03400057
034100                                                                  03410057
034200                                                                  03420057
034300*----------------------------------------------------------------*03430057
034400*     READ THE IMPORT PO INVOICE COST FILE                        03440057
034500*----------------------------------------------------------------*03450057
034600 R100-READ-INVOICES.                                              03460057
034700                                                                  03470057
034800     MOVE 'R100-READ-INVOICES'   TO AA-PARAGRAPH-NAME.            03480057
034900                                                                  03490057
035000        READ INVC-IMPORT-FILE INTO AP060-INVOICE-EXTRACT          03500057
035100          AT END  SET END-OF-INVOICES TO TRUE.                    03510057
035200                                                                  03520057
035300     IF NOT END-OF-INVOICES                                       03530057
035400        ADD 1 TO PV-COUNT-INVC-READ.                              03540057
035500                                                                  03550057
035600                                                                  03560057
035700*----------------------------------------------------------------*03570057
035800*    WRITE THE PURCHASE JOURNAL TRANSACTION RECORDS TO THE FILE  *03580057
035900*----------------------------------------------------------------*03590057
036000 W100-WRITE-STATUS-UPDATE-FILE.                                   03600057
036100                                                                  03610057
036200     WRITE STATUS-UPDATE-REC FROM AP252-RECORD.                   03620057
036300     ADD 1 TO PV-COUNT-ENT-WROTE.                                 03630057
036400                                                                  03640057
036500                                                                  03650057
036600*---------------------------------------------------------------- 03660057
036700*    OPEN PO_CSR CURSOR.                                          03670057
036800*---------------------------------------------------------------- 03680057
036900 X100-OPEN-PO-CSR.                                                03690057
037000                                                                  03700057
037100     EXEC SQL                                                     03710057
037200         OPEN PO_CSR                                              03720057
037300     END-EXEC.                                                    03730057
037400                                                                  03740057
037500     EVALUATE TRUE                                                03750057
037600         WHEN SQLCODE = ZERO                                      03760057
037700             SET NEW-PO-ROWS                                      03770057
037800                 NEW-PO-CSR      TO TRUE                          03780057
037900                                                                  03790057
038000         WHEN SQLWARN0 NOT = SPACES                               03800057
038100         WHEN SQLCODE  NOT = ZERO                                 03810057
038200             MOVE 'X100-OPEN-PO-CSR'                              03820057
038300                                 TO AA-PARAGRAPH-NAME             03830057
038400             MOVE 'UNSUCCESSFUL OPEN ON PO_CSR'                   03840057
038500                                 TO AA-DB2-OPERATION              03850057
038600             MOVE 'TPOSTRR'      TO AA-DB2-TABLE-1                03860057
038700             PERFORM Z999-DB2-ABEND                               03870057
038800     END-EVALUATE.                                                03880057
038900                                                                  03890057
039000*---------------------------------------------------------------- 03900057
039100*    CLOSE THE PO_CSR CURSOR.                                     03910057
039200*---------------------------------------------------------------- 03920057
039300 X110-CLOSE-PO-CSR.                                               03930057
039400                                                                  03940057
039500     EXEC SQL                                                     03950057
039600         CLOSE PO_CSR                                             03960057
039700     END-EXEC.                                                    03970057
039800                                                                  03980057
039900       EVALUATE TRUE                                              03990057
040000           WHEN SQLCODE = ZERO                                    04000057
040100                CONTINUE                                          04010057
040200                                                                  04020057
040300           WHEN SQLWARN0 NOT = SPACES                             04030057
040400           WHEN SQLCODE  NOT = ZERO                               04040057
040500               MOVE 'X110-CLOSE-PO-CSR'                           04050057
040600                                 TO AA-PARAGRAPH-NAME             04060057
040700               MOVE 'UNSUCCESSFUL CLOSE ON PO_CSR'                04070057
040800                                 TO AA-DB2-OPERATION              04080057
040900               MOVE 'TPOSTRR'    TO AA-DB2-TABLE-1                04090057
041000               PERFORM Z999-DB2-ABEND                             04100057
041100       END-EVALUATE.                                              04110057
041200                                                                  04120057
041300*---------------------------------------------------------------* 04130057
041400*    RETRIEVES THE PAYMENT BATCH DATE FROM THE AP CONTROL TABLE   04140057
041500*    NOTE:  A NOT FOUND CONDITION WILL CAUSE AN ABEND.            04150057
041600*---------------------------------------------------------------* 04160057
041700 Y100-GET-BATCH-DATE.                                             04170057
041800                                                                  04180057
041900     EXEC SQL                                                     04190057
042000         SELECT BTCH_PRC_DTE                                      04200057
042100         INTO   :APCNTL-BTCH-PRC-DTE                              04210057
042200         FROM TAPCNTL                                             04220057
042300     END-EXEC.                                                    04230057
042400                                                                  04240057
042500     EVALUATE TRUE                                                04250057
042600         WHEN SQLCODE = ZERO                                      04260057
042700              CONTINUE                                            04270057
042800                                                                  04280057
042900         WHEN SQLWARN0 NOT = SPACES                               04290057
043000         WHEN SQLCODE  NOT = ZERO                                 04300057
043100         MOVE 'UNSUCCESSFUL SELECT OF PAYMENT CONTROL TBL'        04310057
043200                                 TO AA-DB2-OPERATION              04320057
043300         MOVE 'TAPCNTL'          TO AA-DB2-TABLE-1                04330057
043400         PERFORM Z999-DB2-ABEND                                   04340057
043500     END-EVALUATE.                                                04350057
043600                                                                  04360057
043700*----------------------------------------------------------------*04370057
043800*    ABEND ROUTINE FOR DB2 ERRORS                                *04380057
043900*----------------------------------------------------------------*04390057
044000 Z999-DB2-ABEND.                                                  04400057
044100                                                                  04410057
044200     DISPLAY AA-ABEND-LIT.                                        04420057
044300     DISPLAY AA-DB2-ERROR-LIT.                                    04430057
044400     DISPLAY AA-PROGRAM-LIT.                                      04440057
044500     DISPLAY AA-PARAGRAPH-LIT.                                    04450057
044600     DISPLAY AA-DB2-OPERATION-LIT.                                04460057
044700     DISPLAY AA-DB2-TABLE-1.                                      04470057
044800     DISPLAY AA-DB2-TABLE-2.                                      04480057
044900     DISPLAY AA-DB2-TABLE-3.                                      04490057
045000     DISPLAY AA-DB2-TABLE-4.                                      04500057
045100     DISPLAY '*****                PO = ' PV-HOLD-PO-NBR.         04510057
045200     SET AC-DB2-ERROR TO TRUE.                                    04520057
045300                                                                  04530057
045400     COPY DPPD004.                                                04540057
045500                                                                  04550057
045600     CALL 'ILBOABN0' USING ABEND-CODE.                            04560057
045700                                                                  04570057
