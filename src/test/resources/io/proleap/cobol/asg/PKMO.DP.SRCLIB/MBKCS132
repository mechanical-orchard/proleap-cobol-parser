00001 *************************                                         02/05/92
00002  IDENTIFICATION DIVISION.                                         MBKCS132
00003 *************************                                            LV039
00004  PROGRAM-ID.    MBKCS132.                                            CL**1
00005  AUTHOR.        MIKE FURLICK.                                        CL**1
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
00007  DATE-WRITTEN.  10-6-91.                                             CL**1
00008  DATE-COMPILED.                                                      CL**1
00009 *                                                                    CL**1
00010 *****************************************************************    CL**1
00011 *    R132 - MERCHANDISE AREA RESPONSIBILITY INQUIRY                  CL**1
00012 *                                                                    CL**1
00013 *    THIS PROGRAM GENERATES A LIST OF MERCHANDISE AREA RESPON-       CL**1
00014 *    SIBILITY ASSIGMENTS FOR A MERCHANDISE AREA.  THIS PROGRAM       CL**1
00015 *    IS INVOKED FROM THE MERCHANDISE LIST SCREEN (MBKCS102).         CL**1
00016 *                                                                    CL**1
00017 *****************************************************************    CL**1
262978* CHANGED 10/22/2021    BY JIM HUNTER      WR: CHG0262978                 
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
262978* MAKING THE CALL DYNAMIC VS STATIC.                                      
262978******************************************************************        
00018 *                                                                    CL**1
00019 *                                                                    CL**1
00020 *                                                                    CL**1
00021 *                                                                    CL**1
00022  ENVIRONMENT DIVISION.                                               CL**1
00023 *                                                                    CL**1
00024 *                                                                    CL**1
00025 *                                                                    CL**1
00026  DATA DIVISION.                                                      CL**1
00027 *                                                                    CL**1
00028 *                                                                    CL**1
00029  WORKING-STORAGE SECTION.                                            CL**1
00030 *                                                                    CL**1
00031  01  PC-PROGRAM-CONSTANTS.                                           CL**1
00032      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.   CL**1
00033      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072     CL**1
00034                                                      COMP SYNC.      CL**1
00035      05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE           CL**1
00036      'MB132A  '.                                                     CL**1
00037      05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE           CL**1
00038      'MBKM132 '.                                                     CL**1
00039      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE           CL**1
00040      'MBKCS132'.                                                     CL**1
00041      05  PC-BEGINNING                   PIC X(01)    VALUE 'B'.      CL**1
00042      05  PC-ENDING                      PIC X(01)    VALUE 'E'.      CL**1
00043      05  PC-SELECTED                    PIC X(01)    VALUE 'S'.      CL**1
00044      05  PC-ITEMS-PER-PANEL             PIC S9(04)   VALUE +9        CL**1
00045                                                      COMP SYNC.      CL**1
00046      05  PC-ITEMS-PER-BLOCK             PIC S9(04)   VALUE +14       CL**1
00047                                                      COMP SYNC.      CL**1
00048      05  PC-MAX-ITEMS-TO-BE-READ        PIC S9(04)   VALUE +100      CL**1
00049                                                      COMP SYNC.      CL**1
00050      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)   VALUE +2        CL**1
00051                                                      COMP SYNC.      CL**1
00052      05  PC-MAX-ITEMS                   PIC S9(09)   VALUE           CL**1
00053                                                      +1000000        CL**1
00054                                                      COMP-3.         CL**1
00055      05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314     CL**1
00056                                                      COMP SYNC.      CL**1
00057      05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5        CL**1
00058                                                      COMP SYNC.      CL**1
00059      05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128      CL**1
00060                                                      COMP SYNC.      CL**1
00061      05  FILLER REDEFINES PC-ERASE-EOF-COMP.                         CL**1
00062          10  FILLER                     PIC X(01).                   CL**1
00063          10  PC-ERASE-EOF               PIC X(01).                   CL**1
00064      05  PC-ZERO                        PIC X(3)     VALUE '000'.    CL**5
00065      05  PC-GMA                         PIC X(3)     VALUE 'GMA'.    CL*15
00066      05  PC-DMA                         PIC X(3)     VALUE 'DMA'.    CL*15
00067      05  PC-DPT                         PIC X(3)     VALUE 'DPT'.    CL*15
00068      05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**5
00069                                                      COMP-3.         CL**1
00070  01  PC-COMPANY                         PIC XX       VALUE '03'.     CL**1
00071 *                                                                    CL**1
00072  01  PC-TSYMSG-NUMBERS.                                              CL**1
00073      05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.     CL**1
00074      05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
00075      05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.     CL**2
00076      05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL**2
00077      05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.     CL**1
00078      05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.     CL**1
00079      05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.     CL**1
00080      05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.     CL**1
00081      05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.     CL**1
00082      05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.     CL**1
00083      05  PC-TSYMSG-00061                PIC 9(5)    VALUE 00061.     CL**1
00084      05  PC-TSYMSG-00062                PIC 9(5)    VALUE 00062.     CL**1
00085      05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**1
00086      05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
00087      05  PC-TSYMSG-99901                PIC 9(5)    VALUE 99901.     CL*32
00088 *                                                                    CL**1
00089  01  PM-PROGRAM-MESSAGES.                                            CL**1
00090      05  PM-PROGRAM-MESSAGE-9           PIC X(78)    VALUE           CL**1
00091      'ERROR TRYING TO REWRITE  TEMP STORAGE QUEUE - RESP '.          CL**1
00092      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-9.                      CL**1
00093          10  FILLER                     PIC X(51).                   CL**1
00094          10  PM-RESP-9                  PIC Z(03)9-.                 CL**1
00095          10  FILLER                     PIC X(22).                   CL**1
00096      05  PM-PROGRAM-MESSAGE-10          PIC X(78)    VALUE           CL**1
00097      'ERROR TRYING TO WRITE TO TEMP STORAGE QUEUE - RESP '.          CL**1
00098      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-10.                     CL**1
00099          10  FILLER                     PIC X(51).                   CL**1
00100          10  PM-RESP-10                 PIC Z(03)9-.                 CL**1
00101          10  FILLER                     PIC X(22).                   CL**1
00102      05  PM-PROGRAM-MESSAGE-11          PIC X(78)    VALUE           CL**1
00103      'LOGIC ERROR IN TRYING TO WRITE TO TEMP STORAGE QUEUE - BLOCK   CL**1
00104 -    '     '.                                                        CL**1
00105      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-11.                     CL**1
00106          10  FILLER                     PIC X(61).                   CL**1
00107          10  PM-BLOCK-NUMBER            PIC Z(03)9-.                 CL**1
00108          10  FILLER                     PIC X(12).                   CL**1
00109      05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE           CL**1
00110      'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                   CL**1
00111      05  PM-PROGRAM-MESSAGE-14          PIC X(78)    VALUE           CL**1
00112      'REQUESTED VALUE MUST BE GREATER THAN 0 AND LESS THAN 1,000,0   CL**1
00113 -    '00'.                                                           CL**1
00114      05  PM-PROGRAM-MESSAGE-22          PIC X(78)    VALUE           CL**1
00115      'LOGIC ERROR IN TRYING TO READ BG LIST QUEUE - RESP = '.        CL**1
00116      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-22.                     CL**1
00117          10  FILLER                     PIC X(61).                   CL**1
00118          10  PM-RESP-22                 PIC 9999.                    CL**1
00119          10  FILLER                     PIC X(12).                   CL**1
00120      05  PM-PROGRAM-MESSAGE-23          PIC X(78)    VALUE           CL**1
00121      'ERROR TRYING TO DELETE TEMP STORAGE QUEUE - RESP '.            CL**1
00122      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-23.                     CL**1
00123          10  FILLER                     PIC X(49).                   CL**1
00124          10  PM-RESP-23                 PIC Z(03)9-.                 CL**1
00125          10  FILLER                     PIC X(24).                   CL**1
00126      05  PM-PROGRAM-MESSAGE-24          PIC X(78)    VALUE           CL**1
00127      'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE - RESP '.         CL**1
00128      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-24.                     CL**1
00129          10  FILLER                     PIC X(52).                   CL**1
00130          10  PM-RESP-24                 PIC Z(03)9-.                 CL**1
00131          10  FILLER                     PIC X(21).                   CL**1
00132      05  PM-PROGRAM-MESSAGE-26          PIC X(78)    VALUE           CL**1
00133      'CONVERSION ROUTINE ERROR'.                                     CL**1
00134      05  PM-PROGRAM-MESSAGE-28          PIC X(78)    VALUE           CL**1
00135      'ERROR OCCURRED DURING TS QUEUE PROCESSING'.                    CL**1
00136 *                                                                    CL**1
00137  01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
00138      05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
00139                                                      COMP SYNC.      CL**1
00140      05  PS-RESP-SUB1                   PIC S9(04)   VALUE +0        CL**1
00141                                                      COMP SYNC.      CL**1
00142      05  PS-RESP-SUB2                   PIC S9(04)   VALUE +0        CL**1
00143                                                      COMP SYNC.      CL**1
00144      05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0        CL**1
00145                                                      COMP-3.         CL**1
00146                                                                      CL**1
00147  01  PS-PROGRAM-SWITCHES.                                            CL**1
00148      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.      CL**1
00149          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.      CL**1
00150          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.      CL**1
00151          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.      CL**1
00152          88  PS-SEND-DATA-ONLY                       VALUE '4'.      CL**1
00153          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.      CL**1
00154          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.      CL**1
00155      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.      CL**1
00156          88  PS-ERROR                                VALUE 'Y'.      CL**1
00157          88  PS-NO-ERROR                             VALUE 'N'.      CL**1
00158      05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.      CL**1
00159          88  PS-INTER-APPL-VALID                     VALUE 'Y'.      CL**1
00160          88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.      CL**1
00161      05  PS-SAME-ITEMS-DISPLAYED-SW     PIC X(01)    VALUE 'N'.      CL**1
00162          88  PS-SAME-ITEMS-DISPLAYED                 VALUE 'Y'.      CL**1
00163          88  PS-DIFFERENT-ITEMS-DISPLAYED            VALUE 'N'.      CL**1
00164      05  PS-CURSOR-POSITIONED-SW        PIC X(01)    VALUE 'N'.      CL**1
00165          88  PS-CURSOR-POSITIONED                    VALUE 'Y'.      CL**1
00166          88  PS-CURSOR-NOT-POSITIONED                VALUE 'N'.      CL**1
00167      05  PS-VALID-SELECTIONS-SW         PIC X(01)    VALUE 'Y'.      CL**1
00168          88  PS-VALID-SELECTIONS                     VALUE 'Y'.      CL**1
00169          88  PS-INVALID-SELECTIONS                   VALUE 'N'.      CL**1
00170      05  PS-VALID-BEG-ITEM-SW           PIC X(01)    VALUE 'N'.      CL**1
00171          88  PS-VALID-BEG-ITEM                       VALUE 'Y'.      CL**1
00172          88  PS-INVALID-BEG-ITEM                     VALUE 'N'.      CL**1
00173      05  PS-TOP-ITEM-IN-ARRAY-SW        PIC X(01)    VALUE 'N'.      CL**1
00174          88  PS-TOP-ITEM-IN-ARRAY                    VALUE 'Y'.      CL**1
00175          88  PS-TOP-ITEM-NOT-IN-ARRAY                VALUE 'N'.      CL**1
00176      05  PS-BOTTOM-ITEM-IN-ARRAY-SW     PIC X(01)    VALUE 'N'.      CL**1
00177          88  PS-BOTTOM-ITEM-IN-ARRAY                 VALUE 'Y'.      CL**1
00178          88  PS-BOTTOM-ITEM-NOT-IN-ARRAY             VALUE 'N'.      CL**1
00179      05  PS-TOP-ITEM-IN-TEMP-SW         PIC X(01)    VALUE 'N'.      CL**1
00180          88  PS-TOP-ITEM-IN-TEMP                     VALUE 'Y'.      CL**1
00181          88  PS-TOP-ITEM-NOT-IN-TEMP                 VALUE 'N'.      CL**1
00182      05  PS-BOTTOM-ITEM-IN-TEMP-SW      PIC X(01)    VALUE 'N'.      CL**1
00183          88  PS-BOTTOM-ITEM-IN-TEMP                  VALUE 'Y'.      CL**1
00184          88  PS-BOTTOM-ITEM-NOT-IN-TEMP              VALUE 'N'.      CL**1
00185      05  PS-LAST-BLOCK-IN-ARRAY-SW      PIC X(01)    VALUE 'N'.      CL**1
00186          88  PS-LAST-BLOCK-IN-ARRAY                  VALUE 'Y'.      CL**1
00187          88  PS-LAST-BLOCK-NOT-IN-ARRAY              VALUE 'N'.      CL**1
00188      05  PS-SELECTION-FOUND-SW          PIC X(01)    VALUE 'N'.      CL**1
00189          88  PS-SELECTION-FOUND                      VALUE 'Y'.      CL**1
00190          88  PS-NO-SELECTION-FOUND                   VALUE 'N'.      CL**1
00191      05  PS-WARNING-SW                  PIC X(01)    VALUE 'N'.      CL**1
00192          88  PS-WARNING                              VALUE 'Y'.      CL**1
00193          88  PS-NO-WARNING                           VALUE 'N'.      CL**1
00194      05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.      CL**1
00195          88  PS-INFORMATIONAL                        VALUE 'Y'.      CL**1
00196          88  PS-NOT-INFORMATIONAL                    VALUE 'N'.      CL**1
00197      05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.      CL**1
00198          88  PS-CONTINUE                             VALUE 'Y'.      CL*24
00199          88  PS-DONT-PROCESS                         VALUE 'N'.      CL*24
00200      05  PS-COMMAREA-SW                 PIC X(01)    VALUE 'N'.      CL*32
00201          88  PS-COMMAREA-VALID                       VALUE 'Y'.      CL*32
00202          88  PS-COMMAREA-NOT-VALID                   VALUE 'N'.      CL*32
00203      EJECT                                                           CL**1
00204  01  PV-PROGRAM-VARIABLES.                                           CL**1
00205      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0        CL**1
00206                                                      COMP SYNC.      CL**1
00207      05  PV-HIGHEST-ITEM-TO-BE-READ     PIC S9(09)   VALUE +0        CL**1
00208                                                      COMP-3.         CL**1
00209      05  PV-ENDING-ITEM-ON-PANEL        PIC S9(09)   VALUE +0        CL**1
00210                                                      COMP-3.         CL**1
00211      05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0        CL**1
00212                                                      COMP-3.         CL**1
00213      05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
00214                                                      COMP-3.         CL**1
00215      05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL**1
00216                                                      COMP-3.         CL**1
00217      05  PV-MAX-ITEMS-TO-BE-READ        PIC S9(09)   VALUE +0        CL**1
00218                                                      COMP-3.         CL**1
00219      05  PV-FIRST-ITEM-IN-ARRAY         PIC S9(09)   VALUE +0        CL**1
00220                                                      COMP-3.         CL**1
00221      05  PV-LAST-ITEM-IN-ARRAY          PIC S9(09)   VALUE +0        CL**1
00222                                                      COMP-3.         CL**1
00223      05  PV-LAST-ITEM-IN-TEMP           PIC S9(09)   VALUE +0        CL**1
00224                                                      COMP-3.         CL**1
00225      05  PV-BEGINNING-ITEM              PIC S9(09)   VALUE +0        CL**1
00226                                                      COMP-3.         CL**1
00227      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)   VALUE +0        CL**1
00228                                                      COMP-3.         CL**1
00229      05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
00230                                                      COMP SYNC.      CL**1
00231      05  PV-RESP                        PIC S9(04)   VALUE +0        CL**1
00232                                                      COMP SYNC.      CL**1
00233      05  PV-ITEM                        PIC S9(04)   VALUE +0        CL**1
00234                                                      COMP SYNC.      CL**1
00235      05  PV-RESP-ITEM                   PIC S9(04)   VALUE +0        CL**1
00236                                                      COMP SYNC.      CL**1
00237      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
00238                                                      COMP SYNC.      CL**1
00239      05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
00240                                                      COMP SYNC.      CL**1
00241      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)   VALUE +0        CL**1
00242                                                      COMP SYNC.      CL**1
00243      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**1
00244                                                      COMP SYNC.      CL**1
00245      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**1
00246                                                      COMP SYNC.      CL**1
00247      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)   VALUE +0        CL**1
00248                                                      COMP SYNC.      CL**1
00249      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)   VALUE +0        CL**1
00250                                                      COMP SYNC.      CL**1
00251      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)   VALUE +0        CL**1
00252                                                      COMP SYNC.      CL**1
00253      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)   VALUE +0        CL**1
00254                                                      COMP SYNC.      CL**1
00255      05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.   CL**1
00256      05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
00257      05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.         CL**1
00258      05  PV-BEGITMI.                                                 CL**1
00259          10  PV-BEGITMI-N               PIC 9(5).                    CL**1
00260      05  PV-DISPLAY5                    PIC ZZZZ9.                   CL**1
00261      05  PV-INCLUDE-HISTORY-DATE        PIC X(10)    VALUE           CL**1
00262                                                      '0001-01-01'.   CL**1
00263      05  PV-WORK-DATE.                                               CL*12
00264          10  PV-WD-MM                   PIC XX.                      CL*12
00265          10  FILLER                     PIC X        VALUE '/'.      CL*12
00266          10  PV-WD-DD                   PIC XX.                      CL*12
00267          10  FILLER                     PIC X        VALUE '/'.      CL*12
00268          10  PV-WD-YY                   PIC XX.                      CL*12
00269 *                                                                    CL**1
00270  01  PV-NO-DISPLAY-DATE                 PIC X(10)    VALUE           CL*27
00271                                                      '9999-09-09'.   CL*27
00272  01  PV-DB2-CURRENT-DATE                PIC X(10).                   CL*27
00273  01  PV-DB2-DATE                        PIC X(10).                   CL*17
00274  01  FILLER  REDEFINES PV-DB2-DATE.                                  CL**1
00275      05  PV-DD-CCYY.                                                 CL*12
00276          10  PV-DD-CC                   PIC XX.                      CL*13
00277          10  PV-DD-YY                   PIC XX.                      CL*13
00278      05  FILLER                         PIC X.                       CL**1
00279          88  PV-DD-DASH1                             VALUE '-'.      CL**1
00280      05  PV-DD-MM                       PIC XX.                      CL**1
00281      05  FILLER                         PIC X.                       CL**1
00282          88  PV-DD-DASH2                             VALUE '-'.      CL**1
00283      05  PV-DD-DD                       PIC XX.                      CL**1
00284 *                                                                    CL**1
00285  EJECT                                                               CL**1
00286 *****************************************************************    CL**1
00287 *    STANDARD COMMAREA.                                              CL**1
00288 *****************************************************************    CL**1
00289                                                                      CL**1
00290      COPY DPWS020.                                                   CL*39
00291      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
00292                                                                      CL**1
00293 *****************************************************************    CL**1
00294 *    INTER-APPLICATION COMMAREA.                                     CL**1
00295 *****************************************************************    CL**1
00296                                                                      CL**1
00297          10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**1
00298      COPY MBWS005.                                                   CL*39
00299 *****************************************************************    CL**1
00300 *    SPECIFIC COMMMAREA FOR MBKCS132.                                CL**1
00301 *****************************************************************    CL**1
00302          10  MB132-SPECIFIC-COMMAREA.                                CL**1
00303              15  MB132-APPL-CURSOR-POSITION          PIC S9(04)      CL**1
00304                                                      COMP.           CL**1
00305              15  MB132-BLOCK-ENTRIES OCCURS 2 TIMES.                 CL**1
00306                  20  MB132-BLOCK-MODIFIED-SW         PIC X(01).      CL**1
00307                      88  MB132-BLOCK-NOT-MODIFIED    VALUE 'N'.      CL**1
00308                      88  MB132-BLOCK-MODIFIED        VALUE 'Y'.      CL**1
00309                  20  MB132-ITEM-ARRAY.                               CL**1
00310                      25  MB132-ITEM-ENTRIES OCCURS 14 TIMES.         CL**1
00311                          30  MB132-LIST-ITEM-NUMBER                  CL**1
00312                                                      PIC S9(09)      CL**1
00313                                                          COMP-3.     CL**1
00314                          30  MB132-RESP-LEVEL        PIC X(3).       CL**1
00315                          30  MB132-RESP-START-DATE   PIC X(8).       CL**1
00316                          30  MB132-RESP-END-DATE     PIC X(8).       CL**1
00317                          30  MB132-WORKER-USERID     PIC X(8).       CL**1
00318                          30  MB132-LAST-NAME         PIC X(18).      CL**1
00319                          30  MB132-FIRST-NAME        PIC X(12).      CL**1
00320                          30  MB132-COLOR             PIC X.          CL*17
00321 *                                                                    CL**1
00322              15  MB132-BLK-SUB                       PIC S9(04)      CL**1
00323                                                          COMP        CL**1
00324                                                          SYNC.       CL**1
00325              15  MB132-ITEM-SUB                      PIC S9(04)      CL**1
00326                                                          COMP        CL**1
00327                                                          SYNC.       CL**1
00328              15  MB132-NUMBER-OF-ITEMS-READ          PIC S9(09)      CL**1
00329                                                          COMP-3.     CL**1
00330              15  MB132-NUMBER-OF-SELECTED-ITEMS      PIC S9(09)      CL**1
00331                                                          COMP-3.     CL**1
00332              15  MB132-ITEM-AT-TOP-OF-PANEL          PIC S9(09)      CL**1
00333                                                          COMP-3.     CL**1
00334              15  MB132-ITEM-AT-BOT-OF-PANEL          PIC S9(09)      CL**1
00335                                                          COMP-3.     CL**1
00336              15  MB132-HIGHEST-BLOCK-WRITTEN         PIC S9(04)      CL**1
00337                                                          COMP        CL**1
00338                                                          SYNC.       CL**1
00339              15  MB132-START-OF-SELECTED-RANGE       PIC S9(09)      CL**1
00340                                                          COMP-3.     CL**1
00341              15  MB132-END-OF-SELECTED-RANGE         PIC S9(09)      CL**1
00342                                                          COMP-3.     CL**1
00343              15  MB132-ITEMS-LEFT-INDICATOR          PIC X.          CL**1
00344                  88  MB132-ITEMS-LEFT-ON-DB            VALUE 'Y'.    CL**1
00345                  88  MB132-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.    CL**1
00346              15  MB132-TEMP-QUEUE-AVAIL-SW           PIC X.          CL**8
00347                  88  MB132-LIST-EXISTS                 VALUE 'Y'.    CL*24
00348                  88  MB132-IS-NO-LIST                  VALUE 'N'.    CL*24
00349              15  MB132-RESP-SUB                      PIC S9(4)       CL**1
00350                                                          COMP.       CL**1
00351              15  MB132-RESP-ITEM                     PIC S9(4)       CL**1
00352                                                          COMP.       CL**1
00353            12    MB132-LAST-KEY.                                     CL**7
00354              15  MB132-LAST-GMA                      PIC X(2).       CL**7
00355              15  MB132-LAST-DMA                      PIC X(2).       CL**1
00356              15  MB132-LAST-DEPT                     PIC X(3).       CL**1
00357            12    MB132-LAST-KEY-END.                                 CL**8
00358              15  MB132-LAST-MERCH-LEVEL              PIC X(3).       CL**1
00359              15  MB132-GMA-DESC                      PIC X(25).      CL**1
00360              15  MB132-DMA-DESC                      PIC X(25).      CL**1
00361              15  MB132-DEPT-DESC                     PIC X(25).      CL**1
00362              15  MB132-MERCH-LEVEL-DESC              PIC X(25).      CL**1
00363              15  MB132-SAVE-INTER-APPL-COMMAREA      PIC X(200).     CL**1
00364              15  MB132-TEMP-QUEUE-NAME.                              CL**1
00365                  20  MB132-TERM-ID                   PIC X(4).       CL**1
00366                  20  MB132-TASK-NUMBER               PIC S9(7)       CL**1
00367                                                          COMP-3.     CL**1
00368 *                                                                    CL**1
00369      EJECT                                                           CL**1
00370 *****************************************************************    CL**1
00371 *    MERCHANDISE AREA LIST QUEUE RECORD LAYOUT.                      CL**1
00372 *****************************************************************    CL**1
00373  01 MA-LIST-RECORD.                                                  CL**1
00374      COPY MBWS003.                                                   CL*39
00375                                                                      CL**1
00376 *                                                                    CL**1
00377      EJECT                                                           CL**1
00378 *****************************************************************    CL**1
00379 *    ABEND PROCESSING COPYBOOK.                                      CL**1
00380 *****************************************************************    CL**1
00381                                                                      CL**1
00382      COPY DPWS013.                                                   CL**1
00383                                                                      CL**1
00384      EJECT                                                           CL**1
00385 *****************************************************************    CL**1
00386 *    ATTRIBUTE SETTINGS COPYBOOK.                                    CL**1
00387 *****************************************************************    CL**1
00388                                                                      CL**1
00389      COPY DPWS015.                                                   CL**1
00390                                                                      CL**1
00391 *****************************************************************    CL**1
00392 *    CURRENT DATE AND TIME COPYBOOK.                                 CL**1
00393 *****************************************************************    CL**1
00394                                                                      CL**1
00395      COPY DPWS017.                                                   CL**1
00396                                                                      CL**1
00397 *****************************************************************    CL**1
00398 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                             CL**1
00399 *****************************************************************    CL**1
00400                                                                      CL**1
00401      COPY DPWS009.                                                   CL**1
                                                                        MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
00403 *****************************************************************    CL**1
00404 *    FUNCTION KEYS COPYBOOK.                                         CL**1
00405 *****************************************************************    CL**1
00406                                                                      CL**1
00407      COPY DPWS016.                                                   CL**1
00408                                                                      CL**1
00409 *****************************************************************    CL**1
00410 *    DPKUT045 COPYBOOK.                                              CL**1
00411 *****************************************************************    CL**1
00412                                                                      CL**1
00413      COPY DPWS045.                                                   CL**1
00414                                                                      CL**1
00415 *****************************************************************    CL**1
00416 *    NUMERIC EDIT LAYOUT.                                            CL**1
00417 *****************************************************************    CL**1
00418                                                                      CL**1
00419      COPY DPWS010I.                                                  CL**1
00420                                                                      CL**1
00421 *****************************************************************    CL**1
00422 *    MESSAGE RECORD LAYOUT                                           CL**1
00423 *****************************************************************    CL**1
00424                                                                      CL**1
00425      COPY DPRD507I.                                                  CL**1
00426                                                                      CL**1
00427 *****************************************************************    CL**1
00428 *    STANDARD ATTENTION IDENTIFIER LIST                              CL**1
00429 *****************************************************************    CL**1
00430                                                                      CL**1
00431      COPY DFHAID.                                                    CL**1
00432                                                                      CL**1
00433 *****************************************************************    CL**1
00434 *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST           CL**1
00435 *****************************************************************    CL**1
00436                                                                      CL**1
00437      COPY DFHBMSCA.                                                  CL**1
00438                                                                      CL**1
00439 *****************************************************************    CL**1
00440 *    MAP LAYOUT                                                      CL**1
00441 *****************************************************************    CL**1
00442                                                                      CL**1
00443      COPY MBKM132.                                                   CL**1
00444  01  MD-MAP-DATA-AREA  REDEFINES MB132AO PIC X(1413).                CL*30
00445 *                                                                    CL**1
00446  01  MBKM132-OCCURS-LAYOUT  REDEFINES  MD-MAP-DATA-AREA.             CL**1
00447      05  FILLER                PIC X(251).                           CL*29
00448      05  MBKM132-SCROLL-AREA OCCURS 9 TIMES.                         CL**1
00449 *                                                                    CL**1
00450          10  FILLER            PIC X(3).                             CL*17
00451          10  MBKM132-LEVELC    PIC X.                                CL*17
00452          10  MBKM132-LEVELH    PIC X.                                CL*17
00453          10  MBKM132-LEVEL     PIC X(3).                             CL*17
00454 *                                                                    CL**1
00455          10  FILLER            PIC X(3).                             CL*17
00456          10  MBKM132-SDATEC    PIC X.                                CL*17
00457          10  MBKM132-SDATEH    PIC X.                                CL*17
00458          10  MBKM132-SDATE     PIC X(08).                            CL*17
00459 *                                                                    CL**1
00460          10  FILLER            PIC X(3).                             CL*17
00461          10  MBKM132-EDATEC    PIC X.                                CL*17
00462          10  MBKM132-EDATEH    PIC X.                                CL*17
00463          10  MBKM132-EDATE     PIC X(08).                            CL*17
00464 *                                                                    CL**1
00465          10  FILLER            PIC X(3).                             CL*17
00466          10  MBKM132-USERIDC   PIC X.                                CL*17
00467          10  MBKM132-USERIDH   PIC X.                                CL*17
00468          10  MBKM132-USERID    PIC X(08).                            CL*17
00469 *                                                                    CL**1
00470          10  FILLER            PIC X(3).                             CL*17
00471          10  MBKM132-LNAMEC    PIC X.                                CL*17
00472          10  MBKM132-LNAMEH    PIC X.                                CL*17
00473          10  MBKM132-LNAME     PIC X(18).                            CL*17
00474 *                                                                    CL**1
00475          10  FILLER            PIC X(3).                             CL*17
00476          10  MBKM132-FNAMEC    PIC X.                                CL*17
00477          10  MBKM132-FNAMEH    PIC X.                                CL*17
00478          10  MBKM132-FNAME     PIC X(12).                            CL*17
00479 *                                                                    CL**1
00480  EJECT                                                               CL**1
00481 *                                                                    CL**1
00482 *    DB2 AREA FOR TMDSEAR                                            CL**1
00483 *                                                                    CL**1
00484      EXEC SQL                                                        CL**1
00485           INCLUDE TMDSEAR                                            CL**1
00486      END-EXEC.                                                       CL**1
00487 *                                                                    CL**1
00488 *    DB2 AREA FOR TRSPBAR                                            CL**1
00489 *                                                                    CL**1
00490      EXEC SQL                                                        CL**1
00491           INCLUDE TRSPBAR                                            CL**1
00492      END-EXEC.                                                       CL**1
00493 *                                                                    CL**1
00494 *    DB2 AREA FOR TWORKER                                            CL**1
00495 *                                                                    CL**1
00496      EXEC SQL                                                        CL**1
00497           INCLUDE TWORKER                                            CL**1
00498      END-EXEC.                                                       CL**1
00499 *                                                                    CL**1
00500 *    DB2 AREA FOR COMMUNICATIONS                                     CL**1
00501 *                                                                    CL**1
00502      EXEC SQL                                                        CL**1
00503           INCLUDE SQLCA                                              CL**1
00504      END-EXEC.                                                       CL**1
00505 *                                                                    CL**1
00506 *    CURSOR DECLARE FOR MERCH AREA RESPONSIBILITY LIST               CL**1
00507 *                                                                    CL**1
00508      EXEC SQL                                                        CL**1
00509           DECLARE RESP-LIST CURSOR                                   CL**1
00510           FOR SELECT                                                 CL**1
00511               R.RSPLVL_CDE,                                          CL**1
00512               R.WORKER_FIR_NAME,                                     CL**1
00513               R.WORKER_LAST_NAME,                                    CL**1
00514               R.WORKER_STRT_DTE,                                     CL**1
00515               R.WORKER_END_DTE,                                      CL**1
00516               W.UID_NBR                                              CL**1
00517           FROM TMDSEAR A,                                            CL**1
00518                TRSPBAR R,                                            CL**1
00519                TWORKER W                                             CL**3
00520               WHERE A.OPERCO_NBR     =  :PC-COMPANY                  CL**1
00521                 AND A.GMA_NBR        =  :MDSEAR-GMA-NBR              CL**1
00522                 AND A.DMA_NBR        =  :MDSEAR-DMA-NBR              CL**1
00523                 AND A.DEPT_NBR       =  :MDSEAR-DEPT-NBR             CL**1
00524                 AND A.MAJ_CL_NBR     =  :MDSEAR-MAJ-CL-NBR           CL**1
00525                 AND A.SUB_CL_NBR     =  :MDSEAR-SUB-CL-NBR           CL**1
00526                 AND A.MDSELV_CDE     =  :MDSEAR-MDSELV-CDE           CL**1
00527                 AND A.MDSEAR_DKEY    =  R.MDSEAR_DKEY                CL**1
00528                 AND R.WORKER_NBR     =  W.WORKER_NBR                 CL**1
00529                 AND R.WORKER_END_DTE >  :PV-DB2-DATE                 CL*24
00530           ORDER BY  R.RSPLVL_CDE,                                    CL**6
00531                     R.WORKER_STRT_DTE                                CL**1
00532      END-EXEC.                                                       CL**1
00533 *                                                                    CL**1
00534  EJECT                                                               CL**1
00535  LINKAGE SECTION.                                                    CL**1
00536                                                                      CL**1
00537  01  DFHCOMMAREA.                                                    CL**1
00538      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
00539                                         DEPENDING ON EIBCALEN.       CL**1
00540          10  FILLER                     PIC X.                       CL**1
00541                                                                      CL**1
00542 *                                                                    CL**1
00543 *                                                                    CL**1
00544 *                                                                    CL**1
00545  PROCEDURE DIVISION.                                                 CL**1
00546                                                                      CL**1
00547                                                                      CL**1
00548  A100-MAIN-MODULE.                                                   CL**1
00549                                                                      CL**1
00550 ******************************************************************   CL**1
00551 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.              CL**1
00552 ******************************************************************   CL**1
00553                                                                      CL**1
00554      PERFORM DP015-0000-CHECK-COMMAREA.                              CL**1
00555                                                                      CL**1
00556      IF DP020-SRC-RETURN-W-TRAN-ID                                   CL**1
00557          PERFORM B100-CONTROL-PROCESSING                             CL**1
00558      END-IF.                                                         CL**1
00559                                                                      CL**1
00560      PERFORM DP003-0000-RETURN-TO-CICS.                              CL**1
00561  EJECT                                                               CL**1
00562 ******************************************************************   CL**1
00563 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       CL**1
00564 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                       CL**1
00565 *                                                                    CL**1
00566 *    PERFORMED BY A100-MAIN-MODULE.                                  CL**1
00567 ******************************************************************   CL**1
00568 *                                                                    CL**1
00569  B100-CONTROL-PROCESSING.                                            CL**1
00570 *                                                                    CL**1
00571      MOVE LENGTH OF MB132-BLOCK-ENTRIES (1)                          CL**1
00572                                TO  PC-BLOCK-LENGTH.                  CL**1
00573      SET PS-CONTINUE           TO  TRUE.                             CL*24
00574 *                                                                    CL**1
00575      EVALUATE TRUE                                                   CL**1
00576          WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
00577              PERFORM C100-VALIDATE-COMMAREA                          CL*32
00578              IF  PS-COMMAREA-NOT-VALID                               CL*32
00579                  MOVE PC-TSYMSG-99901                                CL*32
00580                                TO  DP020-MSG-NUMBER                  CL*32
00581                  SET DP020-MSG-FATAL                                 CL*32
00582                                TO  TRUE                              CL*32
00583                  MOVE DP016-PF3                                      CL*32
00584                                TO  DP020-SRC-AID                     CL*32
00585                  PERFORM DP015-1000-START-NAVIGATOR                  CL*32
00586              ELSE                                                    CL*32
00587                  INITIALIZE MB132-SPECIFIC-COMMAREA                  CL*32
00588                  SET PS-SEND-MAP-N-DATA-FRSET                        CL*32
00589                                TO  TRUE                              CL*32
00590                  SET DP020-NEXT-ACT-READ-MAP                         CL*32
00591                                TO  TRUE                              CL*32
00592                  PERFORM C200-VALIDATE-TS-QUEUE                      CL*32
00593                  PERFORM D100-SETUP-INIT-PANEL                       CL*34
00594              END-IF                                                  CL*34
00595 *                                                                    CL**1
00596          WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
00597              PERFORM C300-PROCESS-PANEL                              CL**1
00598 *                                                                    CL**1
00599          WHEN DP020-NEXT-ACT-RETURN                                  CL**1
00600              SET PS-SEND-MAP-N-DATA-FRSET                            CL**1
00601                                TO  TRUE                              CL**1
00602              PERFORM C400-REFRESH-PANEL-FROM-TEMP                    CL**1
00603 *                                                                    CL**1
00604          WHEN DP020-NEXT-ACT-ERROR                                   CL**1
00605              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                    CL**1
00606              IF DP020-NAV-MNEMONIC = SPACES                          CL**1
00607                  MOVE SPACES   TO  ANAVCMDO                          CL**1
00608                  MOVE DP015-UNDERLINE                                CL**1
00609                                TO  ANAVCMDH                          CL**1
00610                  MOVE DP015-GREEN                                    CL**1
00611                                TO  ANAVCMDC                          CL**1
00612              ELSE                                                    CL**1
00613                  MOVE DP015-REVERSE                                  CL**1
00614                                TO  ANAVCMDH                          CL**1
00615                  MOVE DP015-RED                                      CL**1
00616                                TO  ANAVCMDC                          CL**1
00617              END-IF                                                  CL**1
00618 *                                                                    CL**1
00619              MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE                 CL**1
00620                                                                      CL**1
00621              SET DP020-MSG-FATAL                                     CL**1
00622                                TO  TRUE                              CL**1
00623              SET PS-SEND-DATA-ONLY-FRSET                             CL**1
00624                                TO  TRUE                              CL**1
00625              SET PS-SAME-ITEMS-DISPLAYED                             CL**1
00626                                TO  TRUE                              CL**1
00627              SET PS-CURSOR-POSITIONED                                CL**1
00628                                TO  TRUE                              CL**1
00629              PERFORM G100-DISPLAY-PANEL                              CL**1
00630 *                                                                    CL**1
00631          WHEN OTHER                                                  CL**1
00632              SET DP013-LOGIC-ABEND TO TRUE                           CL**1
00633              SET DP013-NO-ROLLBACK TO TRUE                           CL**1
00634              MOVE 'B100-CONTROL-PROCESSING'                          CL**1
00635                                TO  DP013-PARAGRAPH                   CL**1
00636              MOVE PM-PROGRAM-MESSAGE-12                              CL**1
00637                                TO  DP013-MESSAGE-TEXT(1)             CL**1
00638              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
00639      END-EVALUATE.                                                   CL**1
00640 *                                                                    CL**1
00641  EJECT                                                               CL**1
00642 ******************************************************************   CL**1
00643 *    ENSURE THIS PROGRAM WAS ENTERED PROPERLY.                       CL*32
00644 *                                                                    CL*32
00645 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00646 ******************************************************************   CL**1
00647 *                                                                    CL**1
00648  C100-VALIDATE-COMMAREA.                                             CL*32
00649 *                                                                    CL**1
00650      IF (DP020-MB-WORKER-RSPBL-LIST                                  CL*32
00651      OR  DP020-MB-WORKER-RSPBL-SELECT                                CL*35
00652      OR  DP020-MB-MERCH-AREA-LIST                                    CL*36
00653      OR  DP020-MB-MERCH-AREA-INQUIRY)                                CL*35
00654          SET PS-COMMAREA-VALID TO  TRUE                              CL*32
00655      ELSE                                                            CL*32
00656          SET PS-COMMAREA-NOT-VALID                                   CL*32
00657                                TO  TRUE                              CL*32
00658      END-IF.                                                         CL*32
00659 *                                                                    CL*32
00660  EJECT                                                               CL*32
00661 ******************************************************************   CL*32
00662 *    ENSURE THE QUEUE WAS PASSED WITH DATA.  STOP PROCESSING IF      CL*32
00663 *    NOT!                                                            CL*32
00664 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL*32
00665 ******************************************************************   CL*32
00666 *                                                                    CL*32
00667  C200-VALIDATE-TS-QUEUE.                                             CL*32
00668 *                                                                    CL*32
00669      MOVE 1                    TO  MB132-RESP-ITEM.                  CL*14
00670      IF (DP020-MB-WORKER-RSPBL-LIST                                  CL*37
00671      OR  DP020-MB-MERCH-AREA-LIST)                                   CL*37
00672          PERFORM M100-READ-LIST-QUEUE                                CL*31
00673          MOVE 1                TO  MB132-RESP-SUB                    CL**7
00674          SET MB132-LIST-EXISTS TO  TRUE                              CL*24
00675          MOVE MB003-KEY-DATA (1)                                     CL*26
00676                                TO  MB132-LAST-KEY                    CL**7
00677          MOVE MB003-MDSELV-NUMBER (1)                                CL*26
00678                                TO  MB132-LAST-MERCH-LEVEL            CL**7
00679      ELSE                                                            CL**7
00680          SET MB132-IS-NO-LIST  TO  TRUE                              CL*24
00681          MOVE MB005-REQUEST-DATA                                     CL**7
00682                                TO  MB132-LAST-KEY                    CL**7
00683          MOVE MB005-MDSEAR-LEVEL                                     CL**7
00684                                TO  MB132-LAST-MERCH-LEVEL            CL**7
00685      END-IF.                                                         CL**7
00686 *                                                                    CL**7
00687      PERFORM L300-READ-MDSEAR.                                       CL**1
00688 *                                                                    CL**1
00689  EJECT                                                               CL**1
00690 ******************************************************************   CL**1
00691 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED     CL**1
00692 *    ON WHAT FUNCTION KEY WAS SELECTED.                              CL**1
00693 *                                                                    CL**1
00694 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00695 ******************************************************************   CL**1
00696 *                                                                    CL**1
00697  C300-PROCESS-PANEL.                                                 CL**1
00698 *                                                                    CL**1
00699      PERFORM DP007-0000-GET-PANEL.                                   CL**1
00700      SET PS-SEND-DATA-ONLY-FRSET                                     CL**1
00701                                TO TRUE.                              CL**1
00702      EVALUATE TRUE                                                   CL**1
00703 *                                                                    CL**1
00704          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
00705              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**1
00706              SET PS-SAME-ITEMS-DISPLAYED  TO TRUE                    CL**1
00707              PERFORM C500-RESTORE-PANEL                              CL*21
00708              PERFORM G100-DISPLAY-PANEL                              CL**1
00709 *                                                                    CL**1
00710          WHEN DP020-SRC-AID = DP016-PF5                              CL**1
00711              MOVE SPACES       TO  ANAVCMDO                          CL*38
00712                                    ANAVKEYO                          CL*38
00713              PERFORM Z050-DELETE-TEMP-STORAGE                        CL**1
00714              PERFORM D100-SETUP-INIT-PANEL                           CL**1
00715 *                                                                    CL**1
00716 *    "NEXT" PROCESSING - POSITION TO NEXT BUSINESS GROUP             CL**1
00717 *                                                                    CL**1
00718          WHEN DP020-FK-NEXT-SELECTION(DP020-SRC-AID)                 CL*23
00719              IF  MB132-IS-NO-LIST                                    CL*24
00720                  MOVE PC-TSYMSG-00070                                CL*24
00721                                TO  DP020-MSG-NUMBER                  CL*24
00722                  SET DP020-MSG-INFORMATIONAL                         CL*24
00723                                TO  TRUE                              CL*24
00724                  PERFORM G100-DISPLAY-PANEL                          CL*24
00725              ELSE                                                    CL**7
00726                  PERFORM D500-GET-NEXT-RESP                          CL**7
00727                  IF  PS-CONTINUE                                     CL*24
00728                      PERFORM Z050-DELETE-TEMP-STORAGE                CL**7
00729                      PERFORM D100-SETUP-INIT-PANEL                   CL**7
00730                  ELSE                                                CL*24
00731                      PERFORM G100-DISPLAY-PANEL                      CL*24
00732                  END-IF                                              CL**7
00733              END-IF                                                  CL**7
00734 *                                                                    CL**1
00735          WHEN DP020-SRC-AID = DP016-PA2                              CL**1
00736              PERFORM DP009-0000-LOAD-FK-LINES                        CL**1
00737              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL**1
00738              SET PS-SEND-DATA-ONLY                                   CL**1
00739                                TO  TRUE                              CL**1
00740              MOVE -1           TO  ANAVCMDL                          CL**1
00741              PERFORM DP008-0000-WRITE-PANEL                          CL**1
00742 *                                                                    CL**1
00743          WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                     CL**1
00744               PERFORM E300-NAVIGATE                                  CL**1
00745 *                                                                    CL**1
00746          WHEN DP020-FK-RETURN(DP020-SRC-AID)                         CL**1
00747               PERFORM E300-NAVIGATE                                  CL**1
00748 *                                                                    CL**1
00749          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL**1
00750               PERFORM E400-DISPLAY-TOP-OF-LIST                       CL**1
00751 *                                                                    CL**1
00752          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL**1
00753               PERFORM E500-BROWSE-BACKWARD                           CL**1
00754 *                                                                    CL**1
00755          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL**1
00756               PERFORM E600-BROWSE-FORWARD                            CL**1
00757 *                                                                    CL**1
00758          WHEN DP020-SRC-AID = DP016-ENTER                            CL**1
00759              IF (DP020-NAV-MNEMONIC = LOW-VALUES) OR                 CL**1
00760                 (DP020-NAV-MNEMONIC = SPACES)                        CL**1
00761 *                PERFORM E800-CHECK-FOR-JUMP-BROWSE                  CL**5
00762                  PERFORM G100-DISPLAY-PANEL                          CL**5
00763              ELSE                                                    CL**1
00764                  PERFORM E300-NAVIGATE                               CL**1
00765              END-IF                                                  CL**1
00766 *                                                                    CL**1
00767          WHEN OTHER                                                  CL**1
00768              MOVE PC-TSYMSG-00045                                    CL**7
00769                                TO  DP020-MSG-NUMBER                  CL**7
00770              SET DP020-MSG-FATAL                                     CL**7
00771                                TO  TRUE                              CL**7
00772              PERFORM G100-DISPLAY-PANEL                              CL**1
00773      END-EVALUATE.                                                   CL**1
00774 *                                                                    CL**1
00775  EJECT                                                               CL**1
00776 ******************************************************************   CL**1
00777 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**1
00778 *    SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.          CL**1
00779 *    EDIT THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL     CL**1
00780 *    TO THE USER.  ALSO, RESTORE THE REQUESTED UPC AND SKU NBRS.     CL**1
00781 *                                                                    CL**1
00782 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00783 ******************************************************************   CL**1
00784 *                                                                    CL**1
00785  C400-REFRESH-PANEL-FROM-TEMP.                                       CL**1
00786 *                                                                    CL**1
00787      MOVE MB132-SAVE-INTER-APPL-COMMAREA                             CL**1
00788                                TO  MB005-INTER-APPL-COMMAREA.        CL**1
00789      PERFORM C500-RESTORE-PANEL.                                     CL*21
00790      PERFORM D400-REFRESH-BLOCK-ARRAY.                               CL*21
00791 *                                                                    CL**1
00792      SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                       CL**1
00793 *                                                                    CL**1
00794      PERFORM G100-DISPLAY-PANEL.                                     CL**1
00795  EJECT                                                               CL*21
00796 *                                                                    CL*21
00797 ******************************************************************   CL*21
00798 *    MOVE THE HEADING INFORMATION TO THE PANEL.                      CL*21
00799 *                                                                    CL*21
00800 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL*21
00801 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL*21
00802 ******************************************************************   CL*21
00803 *                                                                    CL*21
00804  C500-RESTORE-PANEL.                                                 CL*21
00805 *                                                                    CL*21
00806      MOVE MB132-LAST-GMA       TO  AGMAO.                            CL*21
00807      MOVE MB132-GMA-DESC       TO  AGMADESO.                         CL*21
00808      MOVE PC-GMA               TO  AMLEVELO.                         CL*22
00809 *                                                                    CL*22
00810      IF  MB132-LAST-DMA GREATER THAN ZERO                            CL*21
00811          MOVE MB132-LAST-DMA   TO  ADMAO                             CL*21
00812          MOVE MB132-DMA-DESC   TO  ADMADESO                          CL*21
00813          MOVE PC-DMA           TO  AMLEVELO                          CL*22
00814          MOVE DP015-ASK-BRT-OFF                                      CL*21
00815                                TO  ADMAHEDA                          CL*21
00816          MOVE DP015-ASK-NOR-OFF                                      CL*21
00817                                TO  ADMADESA                          CL*21
00818                                    ADMAA                             CL*21
00819      ELSE                                                            CL*21
00820          MOVE DP015-ASK-DRK-OFF                                      CL*21
00821                                TO  ADMAHEDA                          CL*21
00822                                    ADMADESA                          CL*21
00823                                    ADMAA                             CL*21
00824      END-IF.                                                         CL*21
00825 *                                                                    CL*21
00826      IF  MB132-LAST-DEPT GREATER THAN ZERO                           CL*21
00827          MOVE MB132-LAST-DEPT  TO  ADEPTO                            CL*21
00828          MOVE MB132-DEPT-DESC  TO  ADPTDESO                          CL*21
00829          MOVE PC-DPT           TO  AMLEVELO                          CL*22
00830          MOVE DP015-ASK-BRT-OFF                                      CL*21
00831                                TO  ADPTHEDA                          CL*21
00832          MOVE DP015-ASK-NOR-OFF                                      CL*21
00833                                TO  ADPTDESA                          CL*21
00834                                    ADEPTA                            CL*21
00835      ELSE                                                            CL*21
00836          MOVE DP015-ASK-DRK-OFF                                      CL*21
00837                                TO  ADPTHEDA                          CL*21
00838                                    ADPTDESA                          CL*21
00839                                    ADEPTA                            CL*21
00840      END-IF.                                                         CL*21
00841 *                                                                    CL*21
00842  EJECT                                                               CL**1
00843 *                                                                    CL**1
00844 ******************************************************************   CL**1
00845 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                            CL**1
00846 *    INITIALIZE ALL COUNTERS AND FLAGS.                              CL**1
00847 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.      CL**1
00848 *    DISPLAY THE PANEL TO USER.                                      CL**1
00849 *                                                                    CL**1
00850 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00851 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00852 ******************************************************************   CL**1
00853 *                                                                    CL**1
00854  D100-SETUP-INIT-PANEL.                                              CL**1
00855 *                                                                    CL**1
00856      INITIALIZE                  MB132-BLOCK-ENTRIES (1).            CL**1
00857      INITIALIZE                  MB132-BLOCK-ENTRIES (2).            CL**1
00858      MOVE +1                 TO  MB132-BLK-SUB.                      CL**1
00859      MOVE PC-ITEMS-PER-PANEL TO  PV-HIGHEST-ITEM-TO-BE-READ.         CL**1
00860      SET MB132-ITEMS-LEFT-ON-DB                                      CL**1
00861                              TO  TRUE.                               CL**1
00862 *                                                                    CL**1
00863      MOVE +0                 TO  MB132-ITEM-SUB                      CL**1
00864                                  MB132-NUMBER-OF-ITEMS-READ          CL**1
00865                                  MB132-NUMBER-OF-SELECTED-ITEMS      CL**1
00866                                  MB132-HIGHEST-BLOCK-WRITTEN         CL**1
00867                                  MB132-START-OF-SELECTED-RANGE       CL**1
00868                                  MB132-END-OF-SELECTED-RANGE.        CL**1
00869 *                                                                    CL**1
00870      PERFORM L300-READ-MDSEAR.                                       CL*20
00871      PERFORM L100-OPEN-CURSOR.                                       CL**1
00872 *                                                                    CL**1
00873      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**1
00874      SET PS-DIFFERENT-ITEMS-DISPLAYED                                CL**1
00875                              TO  TRUE.                               CL**1
00876 *                                                                    CL**1
00877      MOVE +1                 TO  MB132-ITEM-AT-TOP-OF-PANEL.         CL**1
00878 *                                                                    CL**1
00879      PERFORM G100-DISPLAY-PANEL.                                     CL**1
00880 *                                                                    CL**1
00881  EJECT                                                               CL**1
00882 ******************************************************************   CL**1
00883 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**1
00884 *    READ TEMPORARY STORAGE FILLING IN BOTH BLOCKS IN THE ARRAY      CL**1
00885 *    WITH THE ITEMS THAT WERE AT THE TOP OF THE LIST WHEN WE         CL**1
00886 *    HAD LEFT PREVIOUSLY.                                            CL**1
00887 *                                                                    CL**1
00888 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
00889 ******************************************************************   CL**1
00890 *                                                                    CL**1
00891  D400-REFRESH-BLOCK-ARRAY.                                           CL**1
00892 *                                                                    CL**1
00893      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
00894          1 + ((MB132-LIST-ITEM-NUMBER(1 1) - 1) /                    CL**1
00895                PC-ITEMS-PER-BLOCK).                                  CL**1
00896                                                                      CL**1
00897      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**1
00898      MOVE +1                   TO MB132-BLK-SUB.                     CL**1
00899                                                                      CL**1
00900      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
00901                                                                      CL**1
00902      ADD +1 TO PV-BLOCK-NUMBER.                                      CL**1
00903                                                                      CL**1
00904      IF (PV-BLOCK-NUMBER < MB132-HIGHEST-BLOCK-WRITTEN) OR           CL**1
00905         (PV-BLOCK-NUMBER = MB132-HIGHEST-BLOCK-WRITTEN)              CL**1
00906          ADD +1 TO MB132-BLK-SUB                                     CL**1
00907                                                                      CL**1
00908          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
00909      END-IF.                                                         CL**1
00910 *                                                                    CL**1
00911  EJECT                                                               CL**1
00912 ******************************************************************   CL**1
00913 *    READ THE TEMP STORAGE QUEUE, GET THE NEXT RESPONSIBILITY.       CL**1
00914 *    IF AT END, ISSUE MESSAGE, OTHERWISE CONTINUE PROCESSING.        CL**1
00915 *                                                                    CL**1
00916 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
00917 ******************************************************************   CL**1
00918 *                                                                    CL**1
00919  D500-GET-NEXT-RESP.                                                 CL**1
00920 *                                                                    CL**1
00921      ADD 1                     TO  MB132-RESP-SUB.                   CL**1
00922      IF  MB132-RESP-SUB GREATER THAN MB003-MAX-ITEMS                 CL*26
00923          ADD 1                 TO  MB132-RESP-ITEM                   CL**1
00924          MOVE 1                TO  MB132-RESP-SUB                    CL**1
00925      END-IF.                                                         CL**1
00926 *                                                                    CL**1
00927      PERFORM M100-READ-LIST-QUEUE.                                   CL**1
00928      IF  MB003-GMA-NUMBER (MB132-RESP-SUB) GREATER THAN SPACES       CL*26
00929          MOVE MB003-KEY-DATA (MB132-RESP-SUB)                        CL*26
00930                                TO  MB132-LAST-KEY                    CL*14
00931          MOVE MB003-MDSELV-NUMBER (MB132-RESP-SUB)                   CL*26
00932                                TO  MB132-LAST-MERCH-LEVEL            CL**2
00933          PERFORM L300-READ-MDSEAR                                    CL**1
00934      ELSE                                                            CL**1
00935          SUBTRACT 1          FROM  MB132-RESP-SUB                    CL**1
00936          SET PS-DONT-PROCESS   TO  TRUE                              CL*24
00937          MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER                  CL*24
00938          SET DP020-MSG-INFORMATIONAL                                 CL*24
00939                                TO  TRUE                              CL*24
00940      END-IF.                                                         CL**1
00941 *                                                                    CL**1
00942  EJECT                                                               CL**1
00943 ******************************************************************   CL**1
00944 *    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER        CL**1
00945 *    TRANSACTION, WRITE OUT THE LAST 2 BLOCKS FROM THE ARRAY TO      CL**1
00946 *    TEMPORARY STORAGE, SET UP THE INTER APPLICATION COMMAREA,       CL**1
00947 *    AND START THE NAVIGATOR.                                        CL**1
00948 *                                                                    CL**1
00949 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
00950 ******************************************************************   CL**1
00951 *                                                                    CL**1
00952  E300-NAVIGATE.                                                      CL**1
00953 *                                                                    CL**1
00954      MOVE +1 TO MB132-BLK-SUB.                                       CL**1
00955      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
00956 *                                                                    CL**1
00957      ADD +1 TO MB132-BLK-SUB.                                        CL**1
00958      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
00959 *                                                                    CL**1
00960      COMPUTE MB005-NUMBER-PROCESSED-ITEMS =                          CL**2
00961          ((MB132-RESP-ITEM - 1) * MB003-MAX-ITEMS) +                 CL*26
00962            MB132-RESP-SUB.                                           CL**2
00963 *                                                                    CL**2
00964      MOVE MB005-INTER-APPL-COMMAREA                                  CL**1
00965                                TO  MB132-SAVE-INTER-APPL-COMMAREA.   CL**1
00966      PERFORM DP015-1000-START-NAVIGATOR.                             CL**1
00967  EJECT                                                               CL**1
00968 ******************************************************************   CL**1
00969 *    IF THE USER HITS THE 1ST PAGE KEY, COMPUTE THE TOP ITEM         CL**1
00970 *    NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM              CL**1
00971 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
00972 *    TO BE READ.                                                     CL**1
00973 *                                                                    CL**1
00974 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
00975 ******************************************************************   CL**1
00976 *                                                                    CL**1
00977  E400-DISPLAY-TOP-OF-LIST.                                           CL**1
00978 *                                                                    CL**1
00979      IF  MB132-NUMBER-OF-ITEMS-READ > +0                             CL**1
00980          MOVE +1 TO PV-TOP-ITEM                                      CL**1
00981          PERFORM F500-BROWSE                                         CL**1
00982      ELSE                                                            CL**1
00983          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
00984          PERFORM G100-DISPLAY-PANEL                                  CL**1
00985      END-IF.                                                         CL**1
00986  EJECT                                                               CL**1
00987 ******************************************************************   CL**1
00988 *    IF THE USER HITS THE PAGE BACKARD KEY, COMPUTE THE TOP          CL**1
00989 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**1
00990 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
00991 *    TO BE READ.                                                     CL**1
00992 *                                                                    CL**1
00993 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
00994 ******************************************************************   CL**1
00995 *                                                                    CL**1
00996  E500-BROWSE-BACKWARD.                                               CL**1
00997 *                                                                    CL**1
00998      IF  MB132-NUMBER-OF-ITEMS-READ > +0                             CL**1
00999          COMPUTE PV-TOP-ITEM =                                       CL**1
01000              MB132-ITEM-AT-TOP-OF-PANEL - PC-ITEMS-PER-PANEL         CL**1
01001          PERFORM F500-BROWSE                                         CL**1
01002      ELSE                                                            CL**1
01003          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01004          PERFORM G100-DISPLAY-PANEL                                  CL**1
01005      END-IF.                                                         CL**1
01006 *                                                                    CL**1
01007  EJECT                                                               CL**1
01008 ******************************************************************   CL**1
01009 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP          CL**1
01010 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**1
01011 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
01012 *    TO BE READ.                                                     CL**1
01013 *                                                                    CL**1
01014 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01015 ******************************************************************   CL**1
01016 *                                                                    CL**1
01017  E600-BROWSE-FORWARD.                                                CL**1
01018 *                                                                    CL**1
01019      IF  MB132-NUMBER-OF-ITEMS-READ > +0                             CL**1
01020          COMPUTE PV-TOP-ITEM =                                       CL**1
01021              MB132-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL         CL**1
01022          PERFORM F500-BROWSE                                         CL**1
01023      ELSE                                                            CL**1
01024          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01025          PERFORM G100-DISPLAY-PANEL                                  CL**1
01026      END-IF.                                                         CL**1
01027 *                                                                    CL**1
01028  EJECT                                                               CL**1
01029 ******************************************************************   CL**1
01030 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO        CL**1
01031 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.       CL**1
01032 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST      CL**1
01033 *    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.          CL**1
01034 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT         CL**1
01035 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.              CL**1
01036 *                                                                    CL**1
01037 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01038 ******************************************************************   CL**1
01039 *                                                                    CL**1
01040 *E800-CHECK-FOR-JUMP-BROWSE.                                         CL**5
01041 *                                                                    CL**1
01042 *    SET PS-VALID-BEG-ITEM TO TRUE.                                  CL**5
01043 *                                                                    CL**5
01044 *    IF (ABEGITMA                   = PC-ERASE-EOF) OR               CL**5
01045 *       (MB132-NUMBER-OF-ITEMS-READ = +0)                            CL**5
01046 *        SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**5
01047 *        PERFORM G100-DISPLAY-PANEL                                  CL**5
01048 *    ELSE                                                            CL**5
01049 *                                                                    CL**1
01050 *        MOVE ABEGITMI         TO  DP010I-UNEDITED-FIELD             CL**5
01051 *        MOVE PC-FIELD-LENGTH  TO  DP010I-MAXIMUM-DIGITS             CL**5
01052 *        MOVE +0               TO  DP010I-MAXIMUM-DECIMALS           CL**5
01053 *        SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                     CL**5
262978*        CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
262978*             USING DP010I-NUMERIC-EDIT-AREA                              
01055 *                                                                    CL**1
01056 *        IF  NOT DP010I-ERROR-DETECTED                               CL**5
01057 *            MOVE DP010I-NUMERIC-FIELD                               CL**5
01058 *                              TO  PV-BEGITMI-N                      CL**5
01059 *            MOVE PV-BEGITMI-N TO  PV-BEGINNING-ITEM                 CL**5
01060 *                                                                    CL**1
01061 *            IF (PV-BEGINNING-ITEM >  0)          AND                CL**5
01062 *               (PV-BEGINNING-ITEM <  PC-MAX-ITEMS)                  CL**5
01063 *                MOVE PV-BEGINNING-ITEM TO PV-TOP-ITEM               CL**5
01064 *                                                                    CL**5
01065 *                COMPUTE PV-MAX-ITEMS-TO-BE-READ =                   CL**5
01066 *                    ((MB132-NUMBER-OF-ITEMS-READ +                  CL**5
01067 *                      PC-MAX-ITEMS-TO-BE-READ)   -                  CL**5
01068 *                      PC-ITEMS-PER-PANEL)        + 1                CL**5
01069 *                                                                    CL**1
01070 *                IF PV-TOP-ITEM > PV-MAX-ITEMS-TO-BE-READ            CL**5
01071 *                    MOVE PV-MAX-ITEMS-TO-BE-READ                    CL**5
01072 *                              TO  PV-TOP-ITEM                       CL**5
01073 *                    MOVE -1   TO  ABEGITML                          CL**5
01074 *                                                                    CL**1
01075 *                    IF MB132-NO-ITEMS-LEFT-ON-DB                    CL**5
01076 *                        MOVE PC-TSYMSG-00061                        CL**5
01077 *                              TO  DP020-MSG-NUMBER                  CL**5
01078 *                    ELSE                                            CL**5
01079 *                        MOVE PC-TSYMSG-00062                        CL**5
01080 *                              TO  DP020-MSG-NUMBER                  CL**5
01081 *                    END-IF                                          CL**5
01082 *                                                                    CL**1
01083 *                    SET PS-CURSOR-POSITIONED                        CL**5
01084 *                              TO  TRUE                              CL**5
01085 *                    SET DP020-MSG-INFORMATIONAL                     CL**5
01086 *                              TO  TRUE                              CL**5
01087 *                END-IF                                              CL**5
01088 *                PERFORM F500-BROWSE                                 CL**5
01089 *            ELSE                                                    CL**5
01090 *                MOVE PM-PROGRAM-MESSAGE-14                          CL**5
01091 *                              TO  DP020-MSG-MESSAGE                 CL**5
01092 *                MOVE -1       TO  ABEGITML                          CL**5
01093 *                MOVE DP015-REVERSE                                  CL**5
01094 *                              TO  ABEGITMH                          CL**5
01095 *                MOVE DP015-RED                                      CL**5
01096 *                              TO  ABEGITMC                          CL**5
01097 *                MOVE DP015-UNP-NUM-BRT-MDT                          CL**5
01098 *                              TO  ABEGITMA                          CL**5
01099 *                SET PS-CURSOR-POSITIONED                            CL**5
01100 *                              TO  TRUE                              CL**5
01101 *                SET DP020-MSG-FATAL                                 CL**5
01102 *                              TO  TRUE                              CL**5
01103 *                SET PS-INVALID-BEG-ITEM                             CL**5
01104 *                              TO  TRUE                              CL**5
01105 *            END-IF                                                  CL**5
01106 *                                                                    CL**1
01107 *        ELSE                                                        CL**5
01108 *            MOVE PC-TSYMSG-00008                                    CL**5
01109 *                              TO  DP020-MSG-NUMBER                  CL**5
01110 *            MOVE -1           TO  ABEGITML                          CL**5
01111 *            MOVE DP015-REVERSE                                      CL**5
01112 *                              TO  ABEGITMH                          CL**5
01113 *            MOVE DP015-RED    TO  ABEGITMC                          CL**5
01114 *            MOVE DP015-UNP-NUM-BRT-MDT                              CL**5
01115 *                              TO  ABEGITMA                          CL**5
01116 *            SET PS-CURSOR-POSITIONED                                CL**5
01117 *                              TO  TRUE                              CL**5
01118 *            SET DP020-MSG-FATAL                                     CL**5
01119 *                              TO  TRUE                              CL**5
01120 *            SET PS-INVALID-BEG-ITEM                                 CL**5
01121 *                              TO  TRUE                              CL**5
01122 *        END-IF                                                      CL**5
01123 *    END-IF.                                                         CL**5
01124 *                                                                    CL**1
01125 *    IF  PS-INVALID-BEG-ITEM                                         CL**5
01126 *        SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**5
01127 *        PERFORM DP017-0000-GET-CURR-DATE-TIME                       CL**5
01128 *        PERFORM I200-FORMAT-LIST-LINES                              CL**5
01129 *        PERFORM DP005-0000-FORMAT-MSG-LINES                         CL**5
01130 *        PERFORM DP008-0000-WRITE-PANEL                              CL**5
01131 *    END-IF.                                                         CL**5
01132 *                                                                    CL**1
01133  EJECT                                                               CL**1
01134 ******************************************************************   CL**1
01135 *    CALCULATE THE NEW TOP AND BOTTOM ITEM NUMBERS BASED ON WHERE    CL**1
01136 *    THE USER SPECIFIED TO GO ON THE LIST AND DETERMINE WHERE        CL**1
01137 *    THESE ITEMS CAN BE FOUND (I.E. ARRAY, TEMPORARY STORAGE).       CL**1
01138 *                                                                    CL**1
01139 *    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                          CL**1
01140 *    PERFORMED BY E500-BROWSE-BACKWARD.                              CL**1
01141 *    PERFORMED BY E600-BROWSE-FORWARD.                               CL**1
01142 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
01143 ******************************************************************   CL**1
01144 *                                                                    CL**1
01145  F500-BROWSE.                                                        CL**1
01146 *                                                                    CL**1
01147      IF  PV-TOP-ITEM < +1                                            CL**1
01148          MOVE +1               TO  PV-TOP-ITEM                       CL**1
01149          IF  PS-CURSOR-NOT-POSITIONED                                CL**1
01150              MOVE PC-TSYMSG-00069                                    CL**1
01151                                TO  DP020-MSG-NUMBER                  CL**1
01152              SET DP020-MSG-INFORMATIONAL                             CL**1
01153                                TO  TRUE                              CL**1
01154              SET PS-INFORMATIONAL                                    CL**1
01155                                TO  TRUE                              CL**1
01156              SET PS-CURSOR-POSITIONED                                CL**1
01157                                TO  TRUE                              CL**1
01158          END-IF                                                      CL**1
01159      END-IF.                                                         CL**1
01160 *                                                                    CL**1
01161      IF  MB132-NO-ITEMS-LEFT-ON-DB                                   CL**1
01162          IF  PV-TOP-ITEM > MB132-NUMBER-OF-ITEMS-READ                CL**1
01163              MOVE MB132-ITEM-AT-TOP-OF-PANEL                         CL**1
01164                                TO  PV-TOP-ITEM                       CL**1
01165              IF  PS-CURSOR-NOT-POSITIONED                            CL**1
01166                  MOVE -1       TO  ANAVCMDL                          CL**1
01167                  SET DP020-MSG-INFORMATIONAL                         CL**1
01168                                TO  TRUE                              CL**1
01169                  SET PS-CURSOR-POSITIONED                            CL**1
01170                                TO  TRUE                              CL**1
01171                  IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)               CL**1
01172                      MOVE PC-TSYMSG-00070                            CL**1
01173                                TO  DP020-MSG-NUMBER                  CL**1
01174                      SET PS-INFORMATIONAL                            CL**1
01175                                TO  TRUE                              CL**1
01176                  ELSE                                                CL**1
01177                      MOVE PC-TSYMSG-00061                            CL**1
01178                                TO  DP020-MSG-NUMBER                  CL*25
01179                  END-IF                                              CL**1
01180              END-IF                                                  CL**1
01181          END-IF                                                      CL**1
01182      END-IF.                                                         CL**1
01183 *                                                                    CL**1
01184      COMPUTE PV-BOTTOM-ITEM =                                        CL**1
01185          (PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1.                     CL**1
01186                                                                      CL**1
01187      IF  MB132-NO-ITEMS-LEFT-ON-DB                                   CL**1
01188          IF  PV-BOTTOM-ITEM > MB132-NUMBER-OF-ITEMS-READ             CL**1
01189              MOVE MB132-NUMBER-OF-ITEMS-READ                         CL**1
01190                                TO  PV-BOTTOM-ITEM                    CL**1
01191              IF  PS-CURSOR-NOT-POSITIONED                            CL**1
01192                  IF  PV-TOP-ITEM NOT = +1                            CL**1
01193                      IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)           CL**1
01194                          MOVE PC-TSYMSG-00070                        CL**1
01195                                TO  DP020-MSG-NUMBER                  CL**1
01196                          SET PS-INFORMATIONAL                        CL**1
01197                                TO  TRUE                              CL**1
01198                          SET DP020-MSG-INFORMATIONAL                 CL**1
01199                                TO  TRUE                              CL**1
01200                          SET PS-CURSOR-POSITIONED                    CL**1
01201                                TO  TRUE                              CL**1
01202                      END-IF                                          CL**1
01203                  END-IF                                              CL**1
01204              END-IF                                                  CL**1
01205          END-IF                                                      CL**1
01206      END-IF.                                                         CL**1
01207 *                                                                    CL**1
01208      PERFORM G300-DETERMINE-WHAT-IS-WHERE.                           CL**1
01209                                                                      CL**1
01210      IF  PS-TOP-ITEM-IN-ARRAY                                        CL**1
01211          IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**1
01212              IF  PS-BOTTOM-ITEM-IN-TEMP                              CL**1
01213                  PERFORM G500-SCROLL-FORWARD                         CL**1
01214              ELSE                                                    CL**1
01215                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**1
01216                      PERFORM G500-SCROLL-FORWARD                     CL**1
01217                  END-IF                                              CL**1
01218                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**1
01219              END-IF                                                  CL**1
01220          END-IF                                                      CL**1
01221      ELSE                                                            CL**1
01222 *                                                                    CL**1
01223          IF  PS-BOTTOM-ITEM-IN-ARRAY                                 CL**1
01224              PERFORM G600-SCROLL-BACKWARD                            CL**1
01225          ELSE                                                        CL**1
01226              IF  PS-TOP-ITEM-IN-TEMP                                 CL**1
01227                  PERFORM G700-GET-TOP-ITEMS-BLOCK                    CL**1
01228                  PERFORM G300-DETERMINE-WHAT-IS-WHERE                CL**1
01229                  IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                     CL**1
01230                      PERFORM G400-READ-ITEMS-INTO-ARRAY              CL**1
01231                  END-IF                                              CL**1
01232              ELSE                                                    CL**1
01233                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**1
01234                      PERFORM G800-GET-LAST-BLOCK-IN-TEMP             CL**1
01235                  END-IF                                              CL**1
01236                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**1
01237              END-IF                                                  CL**1
01238          END-IF                                                      CL**1
01239      END-IF.                                                         CL**1
01240 *                                                                    CL**1
01241      IF  PV-TOP-ITEM = MB132-ITEM-AT-TOP-OF-PANEL                    CL**1
01242          SET PS-SAME-ITEMS-DISPLAYED                                 CL**1
01243                                TO  TRUE                              CL**1
01244      ELSE                                                            CL**1
01245          SET PS-DIFFERENT-ITEMS-DISPLAYED                            CL**1
01246                                TO  TRUE                              CL**1
01247          MOVE PV-TOP-ITEM      TO  MB132-ITEM-AT-TOP-OF-PANEL        CL**1
01248      END-IF.                                                         CL**1
01249 *                                                                    CL**1
01250      PERFORM G100-DISPLAY-PANEL.                                     CL**1
01251 *                                                                    CL**1
01252  EJECT                                                               CL**1
01253 ******************************************************************   CL**1
01254 *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.          CL**1
01255 *                                                                    CL**1
01256 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
01257 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
01258 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
01259 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
01260 *    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                          CL**1
01261 *    PERFORMED BY E500-BROWSE-BACKWARD.                              CL**1
01262 *    PERFORMED BY E600-BROWSE-FORWARD.                               CL**1
01263 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
01264 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
01265 *    PERFORMED BY F500-BROWSE.                                       CL**1
01266 ******************************************************************   CL**1
01267 *                                                                    CL**1
01268  G100-DISPLAY-PANEL.                                                 CL**1
01269 *                                                                    CL**1
01270      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**1
01271      MOVE DP017-EDITED-TIME-HMS                                      CL**2
01272                                TO  ATIMEO.                           CL**2
01273 *                                                                    CL**2
01274      MOVE -1                   TO  ANAVCMDL.                         CL**2
01275      IF PS-SEND-MAP-N-DATA-FRSET                                     CL**1
01276          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**1
01277          PERFORM DP009-0000-LOAD-FK-LINES                            CL**1
01278      END-IF.                                                         CL**1
01279                                                                      CL**1
01280      PERFORM H200-FORMAT-PANEL-BODY.                                 CL**1
01281 *                                                                    CL**1
01282      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL**1
01283                                                                      CL**1
01284      PERFORM DP008-0000-WRITE-PANEL.                                 CL**1
01285  EJECT                                                               CL**1
01286 ******************************************************************   CL**1
01287 *    DETERMINE WHETHER THE TOP ITEM AND BOTTOM ITEM CAN BE FOUND     CL**1
01288 *    IN THE ARRAY, IN TEMPORARY STORAGE, OR NEITHER.                 CL**1
01289 *                                                                    CL**1
01290 *    PERFORMED BY F500-BROWSE.                                       CL**1
01291 ******************************************************************   CL**1
01292 *                                                                    CL**1
01293  G300-DETERMINE-WHAT-IS-WHERE.                                       CL**1
01294 *                                                                    CL**1
01295      MOVE MB132-LIST-ITEM-NUMBER(1 1)                                CL**1
01296                                TO  PV-FIRST-ITEM-IN-ARRAY.           CL**1
01297      COMPUTE PV-LAST-ITEM-IN-ARRAY =                                 CL**1
01298          (PV-FIRST-ITEM-IN-ARRAY +                                   CL**1
01299          (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-BLOCK)) - 1.         CL**1
01300      IF  PV-LAST-ITEM-IN-ARRAY > MB132-NUMBER-OF-ITEMS-READ          CL**1
01301          MOVE MB132-NUMBER-OF-ITEMS-READ                             CL**1
01302                                TO  PV-LAST-ITEM-IN-ARRAY             CL**1
01303      END-IF.                                                         CL**1
01304 *                                                                    CL**1
01305      COMPUTE PV-LAST-ITEM-IN-TEMP =                                  CL**1
01306          MB132-HIGHEST-BLOCK-WRITTEN * PC-ITEMS-PER-BLOCK.           CL**1
01307      IF  PV-LAST-ITEM-IN-TEMP > MB132-NUMBER-OF-ITEMS-READ           CL**1
01308          MOVE MB132-NUMBER-OF-ITEMS-READ                             CL**1
01309                                TO  PV-LAST-ITEM-IN-TEMP              CL**1
01310      END-IF.                                                         CL**1
01311 *                                                                    CL**1
01312      IF (PV-TOP-ITEM > PV-FIRST-ITEM-IN-ARRAY)                       CL**1
01313      OR (PV-TOP-ITEM = PV-FIRST-ITEM-IN-ARRAY)                       CL**1
01314          IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-ARRAY)                    CL**1
01315          OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-ARRAY)                    CL**1
01316              SET PS-TOP-ITEM-IN-ARRAY                                CL**1
01317                                TO  TRUE                              CL**1
01318          ELSE                                                        CL**1
01319              SET PS-TOP-ITEM-NOT-IN-ARRAY                            CL**1
01320                                TO  TRUE                              CL**1
01321          END-IF                                                      CL**1
01322      ELSE                                                            CL**1
01323          SET PS-TOP-ITEM-NOT-IN-ARRAY                                CL**1
01324                                TO  TRUE                              CL**1
01325      END-IF.                                                         CL**1
01326 *                                                                    CL**1
01327      IF (PV-BOTTOM-ITEM > PV-FIRST-ITEM-IN-ARRAY)                    CL**1
01328      OR (PV-BOTTOM-ITEM = PV-FIRST-ITEM-IN-ARRAY)                    CL**1
01329          IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-ARRAY)                 CL**1
01330          OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-ARRAY)                 CL**1
01331              SET PS-BOTTOM-ITEM-IN-ARRAY                             CL**1
01332                                TO  TRUE                              CL**1
01333          ELSE                                                        CL**1
01334              SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                         CL**1
01335                                TO  TRUE                              CL**1
01336          END-IF                                                      CL**1
01337      ELSE                                                            CL**1
01338          SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**1
01339                                TO  TRUE                              CL**1
01340      END-IF.                                                         CL**1
01341 *                                                                    CL**1
01342      IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-TEMP)                         CL**1
01343      OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-TEMP)                         CL**1
01344          SET PS-TOP-ITEM-IN-TEMP                                     CL**1
01345                                TO  TRUE                              CL**1
01346      ELSE                                                            CL**1
01347          SET PS-TOP-ITEM-NOT-IN-TEMP                                 CL**1
01348                                TO  TRUE                              CL**1
01349      END-IF.                                                         CL**1
01350 *                                                                    CL**1
01351      IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-TEMP)                      CL**1
01352      OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-TEMP)                      CL**1
01353          SET PS-BOTTOM-ITEM-IN-TEMP                                  CL**1
01354                                TO  TRUE                              CL**1
01355      ELSE                                                            CL**1
01356          SET PS-BOTTOM-ITEM-NOT-IN-TEMP                              CL**1
01357                                TO  TRUE                              CL**1
01358      END-IF.                                                         CL**1
01359 *                                                                    CL**1
01360      IF PV-LAST-ITEM-IN-TEMP > PV-LAST-ITEM-IN-ARRAY                 CL**1
01361          SET PS-LAST-BLOCK-NOT-IN-ARRAY                              CL**1
01362                                TO  TRUE                              CL**1
01363      ELSE                                                            CL**1
01364          SET PS-LAST-BLOCK-IN-ARRAY                                  CL**1
01365                                TO  TRUE                              CL**1
01366      END-IF.                                                         CL**1
01367 *                                                                    CL**1
01368  EJECT                                                               CL**1
01369 ******************************************************************   CL**1
01370 *    DETERMINE THE SPOT IN THE ARRAY WHERE THE LAST ITEM FROM        CL**1
01371 *    THE DATA BASE WAS ADDED SO WE KNOW WHERE TO ADD THE NEW         CL**1
01372 *    ITEMS.  USE THE SAVED UPC KEY TO START THE BROWSE.  H600        CL**1
01373 *    MUST BE PERFORMED TO POSITION TO THE FIRST UPC TO PROCESS.      CL**1
01374 *                                                                    CL**1
01375 *    PERFORMED BY F500-BROWSE.                                       CL**1
01376 ******************************************************************   CL**1
01377 *                                                                    CL**1
01378  G400-READ-ITEMS-INTO-ARRAY.                                         CL**1
01379 *                                                                    CL**1
01380      COMPUTE PS-ITEM-SUB =                                           CL**1
01381          (MB132-NUMBER-OF-ITEMS-READ -                               CL**1
01382           MB132-LIST-ITEM-NUMBER(1 1)) + 1.                          CL**1
01383                                                                      CL**1
01384      MOVE PS-ITEM-SUB TO MB132-ITEM-SUB.                             CL**1
01385                                                                      CL**1
01386      IF  MB132-ITEM-SUB > PC-ITEMS-PER-BLOCK                         CL**1
01387          SUBTRACT PC-ITEMS-PER-BLOCK                                 CL**1
01388                              FROM  MB132-ITEM-SUB                    CL**1
01389          MOVE PC-MAX-BLOCKS-IN-ARRAY                                 CL**1
01390                                TO  MB132-BLK-SUB                     CL**1
01391      ELSE                                                            CL**1
01392          MOVE +1               TO  MB132-BLK-SUB                     CL**1
01393      END-IF.                                                         CL**1
01394 *                                                                    CL**1
01395      MOVE PV-BOTTOM-ITEM       TO  PV-HIGHEST-ITEM-TO-BE-READ.       CL**1
01396 *                                                                    CL**1
01397      PERFORM L100-OPEN-CURSOR.                                       CL**1
01398      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**1
01399 *                                                                    CL**1
01400      IF  MB132-NO-ITEMS-LEFT-ON-DB                                   CL**1
01401          IF  PV-TOP-ITEM > MB132-NUMBER-OF-ITEMS-READ                CL**1
01402              MOVE MB132-NUMBER-OF-ITEMS-READ                         CL**1
01403                                TO  PV-TOP-ITEM                       CL**1
01404              IF  DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   CL**1
01405                  MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER          CL**1
01406                  SET DP020-MSG-INFORMATIONAL                         CL**1
01407                                TO  TRUE                              CL**1
01408                  SET PS-INFORMATIONAL                                CL**1
01409                                TO  TRUE                              CL**1
01410              END-IF                                                  CL**1
01411          END-IF                                                      CL**1
01412      END-IF.                                                         CL**1
01413 *                                                                    CL**1
01414  EJECT                                                               CL**1
01415 ******************************************************************   CL**1
01416 *    IF THE TOP ITEM WE NEED IS IN THE ARRAY, BUT THE BOTTOM         CL**1
01417 *    ITEM WE NEED IS IN TEMPORARY STORAGE OR HAS NOT BEEN READ       CL**1
01418 *    YET, WRITE OUT THE 1ST BLOCK IN THE ARRAY TO TEMPORARY          CL**1
01419 *    STORAGE.  MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK      CL**1
01420 *    AND READ THE BLOCK NEEDED INTO THE 2ND BLOCK OF THE ARRAY.      CL**1
01421 *    THE TOP ITEM WILL BE LOCATED IN THE 1ST BLOCK, AND THE          CL**1
01422 *    BOTTOM ITEM WILL EITHER BE LOCATED IN THE 2ND BLOCK OR          CL**1
01423 *    WILL BE PLACED IN THE 2ND BLOCK.                                CL**1
01424 *                                                                    CL**1
01425 *    PERFORMED BY F500-BROWSE.                                       CL**1
01426 ******************************************************************   CL**1
01427 *                                                                    CL**1
01428  G500-SCROLL-FORWARD.                                                CL**1
01429 *                                                                    CL**1
01430      MOVE +1                   TO  MB132-BLK-SUB.                    CL**1
01431      SET MB132-BLOCK-MODIFIED (1)                                    CL**1
01432                                TO  TRUE.                             CL**1
01433      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01434 *                                                                    CL**1
01435      MOVE MB132-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) TO             CL**1
01436           MB132-BLOCK-ENTRIES(MB132-BLK-SUB).                        CL**1
01437 *                                                                    CL**1
01438      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
01439          1 + ((PV-BOTTOM-ITEM - 1) / PC-ITEMS-PER-BLOCK).            CL**1
01440 *                                                                    CL**1
01441      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**1
01442      ADD +1                    TO  MB132-BLK-SUB.                    CL**1
01443      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
01444 *                                                                    CL**1
01445  EJECT                                                               CL**1
01446 ******************************************************************   CL**1
01447 *    IF TOP ITEM WE NEED IS NOT IN THE ARRAY, BUT THE BOTTOM         CL**1
01448 *    ITEM IS, WRITE BOTH BLOCKS TO TEMPORARY STORAGE.  MOVE          CL**1
01449 *    THE 1ST BLOCK IN THE ARRAY TO THE 2ND BLOCK OF THE ARRAY.       CL**1
01450 *    READ THE BLOCK THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK    CL**1
01451 *    OF THE ARRAY.                                                   CL**1
01452 *                                                                    CL**1
01453 *    PERFORMED BY F500-BROWSE.                                       CL**1
01454 ******************************************************************   CL**1
01455 *                                                                    CL**1
01456  G600-SCROLL-BACKWARD.                                               CL**1
01457 *                                                                    CL**1
01458      MOVE +1                   TO  MB132-BLK-SUB.                    CL**1
01459      SET MB132-BLOCK-MODIFIED (1)                                    CL**1
01460                                TO  TRUE.                             CL**1
01461      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01462 *                                                                    CL**1
01463      ADD +1 TO MB132-BLK-SUB.                                        CL**1
01464      SET MB132-BLOCK-MODIFIED (2)                                    CL**1
01465                                TO  TRUE.                             CL**1
01466      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01467                                                                      CL**1
01468      MOVE +1                   TO  MB132-BLK-SUB.                    CL**1
01469      MOVE MB132-BLOCK-ENTRIES(MB132-BLK-SUB) TO                      CL**1
01470           MB132-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY).               CL**1
01471 *                                                                    CL**1
01472      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
01473          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**1
01474 *                                                                    CL**1
01475      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**1
01476      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
01477 *                                                                    CL**1
01478  EJECT                                                               CL**1
01479 ******************************************************************   CL**1
01480 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**1
01481 *    ARRAY, BUT THE TOP ITEM IS IN TEMPORARY STORAGE, WRITE BOTH     CL**1
01482 *    BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ THE BLOCK       CL**1
01483 *    THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK OF THE ARRAY.     CL**1
01484 *    IF THERE IS ANOTHER BLOCK IN TEMPORARY STORAGE FOLLOWING        CL**1
01485 *    THE ONE JUST READ, READ THAT ONE INTO THE 2ND BLOCK OF THE      CL**1
01486 *    ARRAY, OTHERWISE INITIALIZE THE 2ND BLOCK OF THE ARRAY.         CL**1
01487 *                                                                    CL**1
01488 *    PERFORMED BY F500-BROWSE.                                       CL**1
01489 ******************************************************************   CL**1
01490 *                                                                    CL**1
01491  G700-GET-TOP-ITEMS-BLOCK.                                           CL**1
01492 *                                                                    CL**1
01493      SET MB132-BLOCK-MODIFIED (1)                                    CL**1
01494                                TO  TRUE.                             CL**1
01495      MOVE +1                   TO  MB132-BLK-SUB.                    CL**1
01496      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01497 *                                                                    CL**1
01498      SET MB132-BLOCK-MODIFIED (2)                                    CL**1
01499                                TO  TRUE.                             CL**1
01500      ADD +1                    TO  MB132-BLK-SUB.                    CL**1
01501      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01502 *                                                                    CL**1
01503      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
01504          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**1
01505 *                                                                    CL**1
01506      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**1
01507      MOVE +1                   TO  MB132-BLK-SUB.                    CL**1
01508 *                                                                    CL**1
01509      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
01510                                                                      CL**1
01511      ADD +1                    TO  PV-BLOCK-NUMBER.                  CL**1
01512      ADD +1                    TO  MB132-BLK-SUB.                    CL**1
01513 *                                                                    CL**1
01514      IF (PV-BLOCK-NUMBER < MB132-HIGHEST-BLOCK-WRITTEN) OR           CL**1
01515         (PV-BLOCK-NUMBER = MB132-HIGHEST-BLOCK-WRITTEN)              CL**1
01516          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
01517      ELSE                                                            CL**1
01518          PERFORM I100-INITIALIZE-BLOCK                               CL**1
01519      END-IF.                                                         CL**1
01520 *                                                                    CL**1
01521  EJECT                                                               CL**1
01522 ******************************************************************   CL**1
01523 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**1
01524 *    ARRAY AND BOTH ITEMS ARE NOT IN TEMPORARY STORAGE (THE          CL**1
01525 *    ITEMS HAVE NOT BEEN READ FROM THE DATA BASE YET), AND THE       CL**1
01526 *    LAST ITEM READ FROM THE DATA BASE IS IN TEMPORARY STORAGE,      CL**1
01527 *    WRITE BOTH BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ      CL**1
01528 *    THE HIGHEST BLOCK IN TEMPORARY STORAGE INTO THE 1ST BLOCK       CL**1
01529 *    OF THE ARRAY, AND INITIALIZE THE 2ND BLOCK IN THE ARRAY.        CL**1
01530 *    THE 2ND BLOCK WILL BE USED FOR THE NEW ITEMS TO BE READ.        CL**1
01531 *    THE 1ST BLOCK WILL NOW CONTAIN THE ITEMS THAT WERE LAST         CL**1
01532 *    READ FROM THE DATA BASE.                                        CL**1
01533 *                                                                    CL**1
01534 *    PERFORMED BY F500-BROWSE.                                       CL**1
01535 ******************************************************************   CL**1
01536 *                                                                    CL**1
01537  G800-GET-LAST-BLOCK-IN-TEMP.                                        CL**1
01538 *                                                                    CL**1
01539      SET MB132-BLOCK-MODIFIED (1)                                    CL**1
01540                                TO  TRUE.                             CL**1
01541      MOVE +1                   TO  MB132-BLK-SUB.                    CL**1
01542      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01543      SET MB132-BLOCK-MODIFIED (2)                                    CL**1
01544                                TO  TRUE.                             CL**1
01545      ADD +1                    TO  MB132-BLK-SUB.                    CL**1
01546      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01547 *                                                                    CL**1
01548      MOVE MB132-HIGHEST-BLOCK-WRITTEN                                CL**1
01549                                TO  PV-BLOCK-NUMBER.                  CL**1
01550      MOVE +1                   TO  MB132-BLK-SUB.                    CL**1
01551      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
01552 *                                                                    CL**1
01553      ADD +1                    TO  MB132-BLK-SUB.                    CL**1
01554      PERFORM I100-INITIALIZE-BLOCK.                                  CL**1
01555 *                                                                    CL**1
01556  EJECT                                                               CL**1
01557 ******************************************************************   CL**1
01558 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE        CL**1
01559 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,         CL**1
01560 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND      CL**1
01561 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE         CL**1
01562 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                       CL**1
01563 *                                                                    CL**1
01564 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
01565 *    PERFORMED BY G400-READ-ITEMS-INTO-ARRAY.                        CL**1
01566 ******************************************************************   CL**1
01567 *                                                                    CL**1
01568  H100-READ-ITEMS-FROM-DB.                                            CL**1
01569 *                                                                    CL**1
01570      PERFORM                                                         CL**1
01571          UNTIL (MB132-NO-ITEMS-LEFT-ON-DB)                           CL*25
01572 *          OR  (MB132-NUMBER-OF-ITEMS-READ =                         CL*25
01573 *               PC-MAX-ITEMS-TO-BE-READ)                             CL*25
01574 *               PV-HIGHEST-ITEM-TO-BE-READ)                          CL*24
01575 *                                                                    CL**1
01576          IF MB132-ITEM-SUB < PC-ITEMS-PER-BLOCK                      CL**1
01577              ADD +1            TO  MB132-ITEM-SUB                    CL**1
01578          ELSE                                                        CL**1
01579              ADD +1            TO  MB132-BLK-SUB                     CL**1
01580              MOVE +1           TO  MB132-ITEM-SUB                    CL**1
01581 *                                                                    CL**1
01582              IF MB132-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY               CL**1
01583                  MOVE +1       TO  MB132-BLK-SUB                     CL**1
01584                  SET MB132-BLOCK-MODIFIED (1)                        CL**1
01585                                TO  TRUE                              CL**1
01586                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01587                  MOVE MB132-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY)    CL**1
01588                  TO   MB132-BLOCK-ENTRIES(MB132-BLK-SUB)             CL**1
01589                  ADD +1        TO  MB132-BLK-SUB                     CL**1
01590                  PERFORM I100-INITIALIZE-BLOCK                       CL**1
01591              END-IF                                                  CL**1
01592          END-IF                                                      CL**1
01593 *                                                                    CL**1
01594          PERFORM L200-FETCH                                          CL**1
01595          IF  MB132-ITEMS-LEFT-ON-DB                                  CL**1
01596              ADD 1             TO  MB132-NUMBER-OF-ITEMS-READ        CL**1
01597              MOVE MB132-NUMBER-OF-ITEMS-READ                         CL**1
01598                                TO  MB132-LIST-ITEM-NUMBER            CL**1
01599                                        (MB132-BLK-SUB                CL**1
01600                                         MB132-ITEM-SUB)              CL**1
01601              MOVE RSPBAR-RSPLVL-CDE                                  CL**1
01602                                TO  MB132-RESP-LEVEL                  CL**1
01603                                        (MB132-BLK-SUB                CL**1
01604                                         MB132-ITEM-SUB)              CL**1
01605              MOVE RSPBAR-WORKER-FIR-NAME                             CL**1
01606                                TO  MB132-FIRST-NAME                  CL**1
01607                                        (MB132-BLK-SUB                CL**1
01608                                         MB132-ITEM-SUB)              CL**1
01609              MOVE RSPBAR-WORKER-LAST-NAME                            CL**1
01610                                TO  MB132-LAST-NAME                   CL**1
01611                                        (MB132-BLK-SUB                CL**1
01612                                         MB132-ITEM-SUB)              CL**1
01613              MOVE RSPBAR-WORKER-STRT-DTE                             CL**1
01614                                TO  PV-DB2-DATE                       CL*12
01615              MOVE PV-DD-MM     TO  PV-WD-MM                          CL*12
01616              MOVE PV-DD-DD     TO  PV-WD-DD                          CL*12
01617              MOVE PV-DD-YY     TO  PV-WD-YY                          CL*12
01618              MOVE PV-WORK-DATE TO  MB132-RESP-START-DATE             CL*12
01619                                        (MB132-BLK-SUB                CL**1
01620                                         MB132-ITEM-SUB)              CL**1
01621 *                                                                    CL*27
01622              IF  RSPBAR-WORKER-END-DTE = PV-NO-DISPLAY-DATE          CL*28
01623                  MOVE SPACES   TO  MB132-RESP-END-DATE               CL*27
01624                                        (MB132-BLK-SUB                CL*27
01625                                         MB132-ITEM-SUB)              CL*27
01626              ELSE                                                    CL*27
01627                  MOVE RSPBAR-WORKER-END-DTE                          CL*27
01628                                TO  PV-DB2-DATE                       CL*27
01629                  MOVE PV-DD-MM TO  PV-WD-MM                          CL*27
01630                  MOVE PV-DD-DD TO  PV-WD-DD                          CL*27
01631                  MOVE PV-DD-YY TO  PV-WD-YY                          CL*27
01632                  MOVE PV-WORK-DATE TO  MB132-RESP-END-DATE           CL*27
01633                                        (MB132-BLK-SUB                CL**1
01634                                         MB132-ITEM-SUB)              CL**1
01635              END-IF                                                  CL*27
01636              MOVE WORKER-UID-NBR                                     CL**1
01637                                TO  MB132-WORKER-USERID               CL**1
01638                                        (MB132-BLK-SUB                CL**1
01639                                         MB132-ITEM-SUB)              CL**1
01640 *                                                                    CL*17
01641              IF  RSPBAR-WORKER-END-DTE LESS THAN                     CL*17
01642                  PV-DB2-CURRENT-DATE                                 CL*17
01643                  MOVE DP015-TURQUOISE                                CL*17
01644                                TO  MB132-COLOR                       CL*17
01645                                        (MB132-BLK-SUB                CL*17
01646                                         MB132-ITEM-SUB)              CL*17
01647              ELSE                                                    CL*17
01648                  MOVE DP015-BLUE                                     CL*17
01649                                TO  MB132-COLOR                       CL*17
01650                                        (MB132-BLK-SUB                CL*17
01651                                         MB132-ITEM-SUB)              CL*17
01652              END-IF                                                  CL*17
01653          END-IF                                                      CL*17
01654      END-PERFORM.                                                    CL**1
01655 *                                                                    CL**1
01656  EJECT                                                               CL**1
01657 *                                                                    CL**1
01658 ******************************************************************   CL**1
01659 *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.               CL**1
01660 *                                                                    CL**1
01661 *    PERFORMED BY G100-DISPLAY-PANEL.                                CL**1
01662 ******************************************************************   CL**1
01663 *                                                                    CL**1
01664  H200-FORMAT-PANEL-BODY.                                             CL**1
01665 *                                                                    CL**1
01666      PERFORM I700-FORMAT-FROM-TO-LINE.                               CL**1
01667      PERFORM I200-FORMAT-LIST-LINES.                                 CL**1
01668      MOVE PC-COMPANY           TO  AOPERCOO.                         CL*17
01669                                                                      CL**1
01670      IF  MB132-NUMBER-OF-ITEMS-READ EQUAL ZERO                       CL**1
01671      AND DP020-MSG-NUMBER NOT NUMERIC                                CL**1
01672          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
01673          SET DP020-MSG-WARNING TO  TRUE                              CL**1
01674      END-IF.                                                         CL**1
01675 *                                                                    CL**1
01676  EJECT                                                               CL**1
01677 ******************************************************************   CL**1
01678 *    INITIALIZE A BLOCK IN THE ARRAY.                                CL**1
01679 *                                                                    CL**1
01680 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
01681 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
01682 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
01683 *    PERFORMED BY H100-READ-ITEMS-FROM-DB.                           CL**1
01684 ******************************************************************   CL**1
01685 *                                                                    CL**1
01686  I100-INITIALIZE-BLOCK.                                              CL**1
01687 *                                                                    CL**1
01688      INITIALIZE  MB132-BLOCK-ENTRIES (MB132-BLK-SUB).                CL**1
01689      SET MB132-BLOCK-NOT-MODIFIED(MB132-BLK-SUB) TO TRUE.            CL**1
01690  EJECT                                                               CL**1
01691 ******************************************************************   CL**1
01692 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.        CL**1
01693 *                                                                    CL**1
01694 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
01695 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
01696 ******************************************************************   CL**1
01697 *                                                                    CL**1
01698  I200-FORMAT-LIST-LINES.                                             CL**1
01699 *                                                                    CL**1
01700      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
01701          (MB132-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
01702 *                                                                    CL**1
01703      MOVE MB132-ITEM-AT-TOP-OF-PANEL                                 CL**1
01704                                TO  PV-ITEM-IN-USE.                   CL**1
01705      MOVE +1                   TO  PS-SUB.                           CL**1
01706 *                                                                    CL**1
01707      PERFORM J100-PROCESS-ITEMS                                      CL**1
01708          UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.             CL**1
01709 *                                                                    CL**1
01710  EJECT                                                               CL**1
01711 ******************************************************************   CL**1
01712 *    FORMAT THE LINE THAT WILL SHOW THE TOTAL NUMBER OF ITEMS WE     CL**1
01713 *    HAVE ON OUR LIST AND SHOW THE NUMBERS ASSOCIATED WITH THE       CL**1
01714 *    FIRST AND LAST ITEMS ON CURRENT PAGE.  THIS WILL HELP THE       CL**1
01715 *    USER DETERMINE HOW FAR THEY ARE INTO THE LIST.                  CL**1
01716 *                                                                    CL**1
01717 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
01718 ******************************************************************   CL**1
01719 *                                                                    CL**1
01720  I700-FORMAT-FROM-TO-LINE.                                           CL**1
01721 *                                                                    CL**1
01722 *    MOVE MB132-ITEM-AT-TOP-OF-PANEL                                 CL**5
01723 *                              TO  PV-DISPLAY5.                      CL**5
01724 *    MOVE PV-DISPLAY5          TO  ABEGITMO.                         CL**5
01725 *                                                                    CL**1
01726 *    MOVE DP015-GREEN          TO  ABEGITMC.                         CL**5
01727 *    MOVE DP015-UNDERLINE      TO  ABEGITMH.                         CL**5
01728 *    MOVE DP015-UNP-NUM-BRT-MDT                                      CL**5
01729 *                              TO  ABEGITMA.                         CL**5
01730 *                                                                    CL**1
01731 *    COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**5
01732 *        (MB132-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**5
01733 *                                                                    CL**1
01734 *    IF PV-ENDING-ITEM-ON-PANEL < MB132-NUMBER-OF-ITEMS-READ         CL**5
01735 *        MOVE PV-ENDING-ITEM-ON-PANEL                                CL**5
01736 *                              TO  PV-DISPLAY5                       CL**5
01737 *    ELSE                                                            CL**5
01738 *        MOVE MB132-NUMBER-OF-ITEMS-READ                             CL**5
01739 *                              TO  PV-DISPLAY5                       CL**5
01740 *    END-IF.                                                         CL**5
01741 *    MOVE PV-DISPLAY5          TO  ATOITMO.                          CL**5
01742 *                                                                    CL**1
01743 *    MOVE MB132-NUMBER-OF-ITEMS-READ                                 CL**5
01744 *                              TO  PV-DISPLAY5.                      CL**5
01745 *    MOVE PV-DISPLAY5          TO  ATOTITMO.                         CL**5
01746 *                                                                    CL**1
01747  EJECT                                                               CL**1
01748 ******************************************************************   CL**1
01749 *    PROCESS EACH ITEM IN THE ARRAY AND MOVE IT TO THE MAP.          CL**1
01750 *    FILL THE MAP UNTIL WE HAVE REACHED THE MAXIMUM NUMBER OF        CL**1
01751 *    MAP ENTRIES.                                                    CL**1
01752 *                                                                    CL**1
01753 *    PERFORMED BY I200-FORMAT-LIST-LINES.                            CL**1
01754 ******************************************************************   CL**1
01755 *                                                                    CL**1
01756  J100-PROCESS-ITEMS.                                                 CL**1
01757 *                                                                    CL**1
01758      IF (PV-ITEM-IN-USE < MB132-NUMBER-OF-ITEMS-READ) OR             CL**1
01759         (PV-ITEM-IN-USE = MB132-NUMBER-OF-ITEMS-READ)                CL**1
01760          PERFORM K100-SET-SUBSCRIPTS                                 CL**1
01761 *                                                                    CL**1
01762          IF (PS-SEND-MAP-N-DATA-FRSET)                               CL**1
01763          OR (PS-DIFFERENT-ITEMS-DISPLAYED)                           CL**1
01764 *                                                                    CL**1
01765              MOVE MB132-RESP-LEVEL(MB132-BLK-SUB MB132-ITEM-SUB)     CL**1
01766                                TO  MBKM132-LEVEL    (PS-SUB)         CL**1
01767 *                                                                    CL**1
01768              MOVE MB132-RESP-START-DATE                              CL**1
01769                                   (MB132-BLK-SUB MB132-ITEM-SUB)     CL**1
01770                                TO  MBKM132-SDATE    (PS-SUB)         CL**1
01771 *                                                                    CL**1
01772              MOVE MB132-RESP-END-DATE                                CL**1
01773                                   (MB132-BLK-SUB MB132-ITEM-SUB)     CL**1
01774                                TO  MBKM132-EDATE    (PS-SUB)         CL**1
01775 *                                                                    CL**1
01776              MOVE MB132-WORKER-USERID                                CL**1
01777                                   (MB132-BLK-SUB MB132-ITEM-SUB)     CL**1
01778                                TO  MBKM132-USERID   (PS-SUB)         CL**1
01779 *                                                                    CL**1
01780              MOVE MB132-LAST-NAME                                    CL**1
01781                                   (MB132-BLK-SUB MB132-ITEM-SUB)     CL**1
01782                                TO  MBKM132-LNAME    (PS-SUB)         CL**1
01783 *                                                                    CL**1
01784              MOVE MB132-FIRST-NAME                                   CL**1
01785                                   (MB132-BLK-SUB MB132-ITEM-SUB)     CL**1
01786                                TO  MBKM132-FNAME    (PS-SUB)         CL**1
01787 *                                                                    CL*17
01788              MOVE MB132-COLOR     (MB132-BLK-SUB MB132-ITEM-SUB)     CL*17
01789                                TO  MBKM132-LEVELC   (PS-SUB)         CL*17
01790                                    MBKM132-SDATEC   (PS-SUB)         CL*17
01791                                    MBKM132-EDATEC   (PS-SUB)         CL*17
01792                                    MBKM132-USERIDC  (PS-SUB)         CL*17
01793                                    MBKM132-LNAMEC   (PS-SUB)         CL*17
01794                                    MBKM132-FNAMEC   (PS-SUB)         CL*17
01795          END-IF                                                      CL**1
01796                                                                      CL**1
01797      ELSE                                                            CL**1
01798                                                                      CL**1
01799          IF (PS-SEND-MAP-N-DATA-FRSET)     OR                        CL**1
01800             (PS-DIFFERENT-ITEMS-DISPLAYED)                           CL**1
01801              MOVE SPACES       TO  MBKM132-LEVEL    (PS-SUB)         CL**1
01802                                    MBKM132-SDATE    (PS-SUB)         CL**1
01803                                    MBKM132-EDATE    (PS-SUB)         CL**1
01804                                    MBKM132-USERID   (PS-SUB)         CL**1
01805                                    MBKM132-LNAME    (PS-SUB)         CL**1
01806                                    MBKM132-FNAME    (PS-SUB)         CL**1
01807          END-IF                                                      CL**1
01808                                                                      CL**1
01809      END-IF.                                                         CL**1
01810                                                                      CL**1
01811      ADD +1 TO PV-ITEM-IN-USE.                                       CL**1
01812      ADD +1 TO PS-SUB.                                               CL**1
01813 *                                                                    CL**1
01814  EJECT                                                               CL**1
01815 ******************************************************************   CL**1
01816 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM     CL**1
01817 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL    CL**1
01818 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                      CL**1
01819 *                                                                    CL**1
01820 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS       CL**1
01821 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT        CL**1
01822 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION      CL**1
01823 *    US IN THE 2ND BLOCK OF THE ARRAY.                               CL**1
01824 *                                                                    CL**1
01825 *    PERFORMED BY F100-EDIT.                                         CL**1
01826 *    PERFORMED BY F300-CHECK-SELECTIONS.                             CL**1
01827 *    PERFORMED BY J100-PROCESS-ITEMS.                                CL**1
01828 ******************************************************************   CL**1
01829 *                                                                    CL**1
01830  K100-SET-SUBSCRIPTS.                                                CL**1
01831 *                                                                    CL**1
01832      COMPUTE PS-ITEM-SUB =                                           CL**1
01833          (PV-ITEM-IN-USE - MB132-LIST-ITEM-NUMBER(1 1)) + 1.         CL**1
01834                                                                      CL**1
01835      MOVE PS-ITEM-SUB TO MB132-ITEM-SUB.                             CL**1
01836                                                                      CL**1
01837      IF MB132-ITEM-SUB > PC-ITEMS-PER-BLOCK                          CL**1
01838          SUBTRACT PC-ITEMS-PER-BLOCK FROM MB132-ITEM-SUB             CL**1
01839                                                                      CL**1
01840          MOVE PC-MAX-BLOCKS-IN-ARRAY TO MB132-BLK-SUB                CL**1
01841      ELSE                                                            CL**1
01842          MOVE +1                     TO MB132-BLK-SUB                CL**1
01843      END-IF.                                                         CL**1
01844 *                                                                    CL**1
01845  EJECT                                                               CL**1
01846 ******************************************************************   CL**1
01847 *    OPEN THE RESPONSIBILITY LIST CURSOR.                            CL**1
01848 *                                                                    CL**1
01849 *    PERFORMED BY D100                                               CL**1
01850 ******************************************************************   CL**1
01851 *                                                                    CL**1
01852  L100-OPEN-CURSOR.                                                   CL**1
01853 *                                                                    CL*11
01854      MOVE MB132-LAST-GMA       TO  MDSEAR-GMA-NBR.                   CL*11
01855      MOVE MB132-LAST-DMA       TO  MDSEAR-DMA-NBR.                   CL*11
01856      MOVE MB132-LAST-DEPT      TO  MDSEAR-DEPT-NBR.                  CL*11
01857      IF  MB132-LAST-DMA EQUAL ZERO                                   CL*20
01858          MOVE PC-GMA           TO  MDSEAR-MDSELV-CDE                 CL*20
01859      ELSE                                                            CL*20
01860          IF  MB132-LAST-DEPT EQUAL ZERO                              CL*20
01861              MOVE PC-DMA       TO  MDSEAR-MDSELV-CDE                 CL*20
01862          ELSE                                                        CL*20
01863              MOVE PC-DPT       TO  MDSEAR-MDSELV-CDE                 CL*20
01864          END-IF                                                      CL*20
01865      END-IF.                                                         CL*20
01866 *                                                                    CL**1
01867      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL*17
01868      MOVE DP017-CURRENT-YMD-YYYY                                     CL*17
01869                                TO  PV-DD-CCYY.                       CL*17
01870      MOVE DP017-CURRENT-YMD-MONTH                                    CL*17
01871                                TO  PV-DD-MM.                         CL*17
01872      MOVE DP017-CURRENT-YMD-DAY                                      CL*17
01873                                TO  PV-DD-DD.                         CL*17
01874      SET PV-DD-DASH1           TO  TRUE.                             CL*17
01875      SET PV-DD-DASH2           TO  TRUE.                             CL*17
01876      MOVE PV-DB2-DATE          TO  PV-DB2-CURRENT-DATE.              CL*17
01877 *                                                                    CL*17
01878      IF  MB005-INCLUDE-HISTORY                                       CL*17
01879          MOVE PV-INCLUDE-HISTORY-DATE                                CL*17
01880                                TO  PV-DB2-DATE                       CL*17
01881      END-IF.                                                         CL**1
01882 *                                                                    CL**1
01883      PERFORM                                                         CL**1
01884          WITH TEST AFTER                                             CL**1
01885          VARYING PV-SQL-SUB                                          CL**1
01886          FROM 1 BY 1                                                 CL**1
01887          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
01888             OR SQLCODE = 0                                           CL**1
01889             OR SQLCODE = +100                                        CL**1
01890 *                                                                    CL**1
01891          EXEC SQL                                                    CL**1
01892               OPEN RESP-LIST                                         CL**1
01893          END-EXEC                                                    CL**1
01894 *                                                                    CL**1
01895          EVALUATE TRUE                                               CL**1
01896              WHEN SQLCODE = -904                                     CL**1
01897              WHEN SQLCODE = -913                                     CL**1
01898              WHEN SQLCODE = ZERO                                     CL**1
01899              WHEN SQLCODE = +100                                     CL**1
01900                   CONTINUE                                           CL**1
01901              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
01902              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
01903                   MOVE 'L100-OPEN-CURSOR'                            CL**1
01904                                TO  DP013-PARAGRAPH                   CL**1
01905                   MOVE 'OPEN RESP-LIST CURSOR'                       CL**1
01906                                TO  DP013-MESSAGE-TEXT (1)            CL**1
01907                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
01908                   SET DP013-DB2-ABEND                                CL**1
01909                                TO  TRUE                              CL**1
01910                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
01911          END-EVALUATE                                                CL**1
01912      END-PERFORM.                                                    CL**1
01913 *                                                                    CL**1
01914      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
01915          MOVE 'L100-OPEN-CURSOR'                                     CL**1
01916                                TO  DP013-PARAGRAPH                   CL**1
01917          MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'                 CL**1
01918                                TO  DP013-MESSAGE-TEXT (1)            CL**1
01919          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
01920          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
01921          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
01922      END-IF.                                                         CL**1
01923 *                                                                    CL**1
01924  EJECT                                                               CL**1
01925 ******************************************************************   CL**1
01926 *    FETCH THE ROWS FOR THE DEPARTMENT LIST.                         CL**1
01927 *                                                                    CL**1
01928 *    PERFORMED BY H100                                               CL**1
01929 ******************************************************************   CL**1
01930 *                                                                    CL**1
01931  L200-FETCH.                                                         CL**1
01932 *                                                                    CL**1
01933      PERFORM                                                         CL**1
01934          WITH TEST AFTER                                             CL**1
01935          VARYING PV-SQL-SUB                                          CL**1
01936          FROM 1 BY 1                                                 CL**1
01937          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
01938             OR SQLCODE = 0                                           CL**1
01939             OR SQLCODE = +100                                        CL**1
01940 *                                                                    CL**1
01941          EXEC SQL                                                    CL**1
01942               FETCH RESP-LIST                                        CL**1
01943               INTO                                                   CL**1
01944                     :RSPBAR-RSPLVL-CDE,                              CL**3
01945                     :RSPBAR-WORKER-FIR-NAME,                         CL**1
01946                     :RSPBAR-WORKER-LAST-NAME,                        CL**1
01947                     :RSPBAR-WORKER-STRT-DTE,                         CL**1
01948                     :RSPBAR-WORKER-END-DTE,                          CL**1
01949                     :WORKER-UID-NBR                                  CL**1
01950          END-EXEC                                                    CL**1
01951 *                                                                    CL**1
01952          EVALUATE TRUE                                               CL**1
01953              WHEN SQLCODE = -904                                     CL**1
01954              WHEN SQLCODE = -913                                     CL**1
01955              WHEN SQLCODE = ZERO                                     CL**1
01956              WHEN SQLCODE = +100                                     CL**1
01957                   CONTINUE                                           CL**1
01958              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
01959              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
01960                   MOVE 'L200-FETCH'                                  CL**1
01961                                TO  DP013-PARAGRAPH                   CL**1
01962                   MOVE 'FETCH RESP-LIST CURSOR'                      CL**1
01963                                TO  DP013-MESSAGE-TEXT (1)            CL**1
01964                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
01965                   SET DP013-DB2-ABEND                                CL**1
01966                                TO  TRUE                              CL**1
01967                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
01968          END-EVALUATE                                                CL**1
01969      END-PERFORM.                                                    CL**1
01970 *                                                                    CL**1
01971      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
01972          MOVE 'L200-FETCH'                                           CL**1
01973                                TO  DP013-PARAGRAPH                   CL**1
01974          MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'                CL**1
01975                                TO  DP013-MESSAGE-TEXT (1)            CL**1
01976          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
01977          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
01978          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
01979      END-IF.                                                         CL**1
01980 *                                                                    CL**1
01981      IF  SQLCODE EQUAL +100                                          CL**1
01982          SET MB132-NO-ITEMS-LEFT-ON-DB                               CL**1
01983                                TO  TRUE                              CL**1
01984      END-IF.                                                         CL**1
01985 *                                                                    CL**1
01986  EJECT                                                               CL**1
01987 ******************************************************************   CL**1
01988 *    OBTAIN THE LOWEST LEVEL INFORMATION FIRST, THEN DMA AND GMA     CL**1
01989 *    INFORMATION, CONDITIONALLY.                                     CL**1
01990 *                                                                    CL**1
01991 *    PERFORMED BY C200, D500                                         CL*32
01992 ******************************************************************   CL**1
01993 *                                                                    CL**1
01994  L300-READ-MDSEAR.                                                   CL**1
01995 *                                                                    CL**1
01996      MOVE MB132-LAST-GMA       TO  MDSEAR-GMA-NBR                    CL**1
01997                                    AGMAO.                            CL**4
01998      MOVE MB132-LAST-DMA       TO  MDSEAR-DMA-NBR                    CL**1
01999                                    ADMAO.                            CL**4
02000      MOVE MB132-LAST-DEPT      TO  MDSEAR-DEPT-NBR                   CL**1
02001                                    ADEPTO.                           CL**4
02002      MOVE PC-ZERO              TO  MDSEAR-MAJ-CL-NBR                 CL*11
02003                                    MDSEAR-SUB-CL-NBR.                CL**1
02004 *                                                                    CL*15
02005      IF  MB132-LAST-DEPT GREATER THAN ZERO                           CL*15
02006          MOVE DP015-ASK-BRT-OFF                                      CL*19
02007                                TO  ADPTHEDA                          CL*19
02008          MOVE DP015-ASK-NOR-OFF                                      CL*19
02009                                TO  ADPTDESA                          CL*19
02010                                    ADEPTA                            CL*19
02011          MOVE PC-DPT           TO  MDSEAR-MDSELV-CDE                 CL*15
02012          PERFORM L400-ACTUAL-READ                                    CL*15
02013          IF  SQLCODE EQUAL ZERO                                      CL*15
02014              MOVE MDSEAR-DESC  TO  MB132-DEPT-DESC                   CL*15
02015                                    ADPTDESO                          CL*15
02016          ELSE                                                        CL*15
02017              MOVE 'DESCRIPTION N/A'                                  CL*15
02018                                TO  MB132-DEPT-DESC                   CL*15
02019                                    ADPTDESO                          CL*15
02020          END-IF                                                      CL*15
02021      ELSE                                                            CL*15
02022          MOVE DP015-ASK-DRK-OFF                                      CL*15
02023                                TO  ADPTHEDA                          CL*15
02024                                    ADPTDESA                          CL*15
02025                                    ADEPTA                            CL*15
02026      END-IF.                                                         CL*15
02027 *                                                                    CL**1
02028      IF  MB132-LAST-DMA GREATER THAN ZERO                            CL*15
02029          MOVE DP015-ASK-BRT-OFF                                      CL*19
02030                                TO  ADMAHEDA                          CL*19
02031          MOVE DP015-ASK-NOR-OFF                                      CL*19
02032                                TO  ADMADESA                          CL*19
02033                                    ADMAA                             CL*19
02034          MOVE PC-ZERO          TO  MDSEAR-DEPT-NBR                   CL*15
02035          MOVE PC-DMA           TO  MDSEAR-MDSELV-CDE                 CL*15
02036          PERFORM L400-ACTUAL-READ                                    CL*15
02037          IF  SQLCODE EQUAL ZERO                                      CL*15
02038              MOVE MDSEAR-DESC  TO  MB132-DMA-DESC                    CL*15
02039                                    ADMADESO                          CL*15
02040          ELSE                                                        CL*15
02041              MOVE 'DESCRIPTION N/A'                                  CL*15
02042                                TO  MB132-DMA-DESC                    CL**1
02043                                    ADMADESO                          CL**4
02044          END-IF                                                      CL*15
02045      ELSE                                                            CL*15
02046          MOVE DP015-ASK-DRK-OFF                                      CL*15
02047                                TO  ADMAHEDA                          CL*15
02048                                    ADMADESA                          CL*15
02049                                    ADMAA                             CL*15
02050      END-IF.                                                         CL**1
02051 *                                                                    CL**1
02052      MOVE PC-ZERO              TO  MDSEAR-DMA-NBR.                   CL**4
02053      MOVE PC-GMA               TO  MDSEAR-MDSELV-CDE.                CL*19
02054      PERFORM L400-ACTUAL-READ.                                       CL**1
02055      IF  SQLCODE EQUAL ZERO                                          CL**1
02056          MOVE MDSEAR-DESC      TO  MB132-GMA-DESC                    CL**1
02057                                    AGMADESO                          CL**4
02058      ELSE                                                            CL**1
02059          MOVE 'DESCRIPTION N/A'                                      CL**1
02060                                TO  MB132-GMA-DESC                    CL**1
02061                                    AGMADESO                          CL**4
02062      END-IF.                                                         CL**1
02063 *                                                                    CL*15
02064      IF  ADMAA EQUAL DP015-ASK-DRK-OFF                               CL*15
02065          MOVE PC-GMA           TO  AMLEVELO                          CL*15
02066      ELSE                                                            CL*15
02067          IF  ADEPTA EQUAL DP015-ASK-DRK-OFF                          CL*15
02068              MOVE PC-DMA       TO  AMLEVELO                          CL*15
02069          ELSE                                                        CL*15
02070              MOVE PC-DPT       TO  AMLEVELO                          CL*16
02071          END-IF                                                      CL*15
02072      END-IF.                                                         CL*15
02073 *                                                                    CL**1
02074  EJECT                                                               CL**1
02075 ******************************************************************   CL**1
02076 *    THIS IS WHERE THE ACTUAL RETRIEVAL OF DATA FROM MDSEAR IS       CL**1
02077 *    PERFORMED.                                                      CL**1
02078 *                                                                    CL**1
02079 *    PERFORMED BY C200, D500                                         CL*32
02080 ******************************************************************   CL**1
02081 *                                                                    CL**1
02082  L400-ACTUAL-READ.                                                   CL**1
02083 *                                                                    CL**1
02084      PERFORM                                                         CL**1
02085          WITH TEST AFTER                                             CL**1
02086          VARYING PV-SQL-SUB                                          CL**1
02087          FROM 1 BY 1                                                 CL**1
02088          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
02089             OR SQLCODE = 0                                           CL**1
02090             OR SQLCODE = +100                                        CL**1
02091 *                                                                    CL**1
02092          EXEC SQL                                                    CL**1
02093               SELECT                                                 CL**1
02094                      MDSEAR_DESC                                     CL**1
02095               INTO                                                   CL**1
02096                      :MDSEAR-DESC                                    CL**1
02097               FROM                                                   CL**1
02098                      TMDSEAR                                         CL**1
02099               WHERE                                                  CL**1
02100                      OPERCO_NBR     = :PC-COMPANY                    CL**1
02101                 AND  GMA_NBR        = :MDSEAR-GMA-NBR                CL**1
02102                 AND  DMA_NBR        = :MDSEAR-DMA-NBR                CL**1
02103                 AND  DEPT_NBR       = :MDSEAR-DEPT-NBR               CL**1
02104                 AND  MAJ_CL_NBR     = :MDSEAR-MAJ-CL-NBR             CL**1
02105                 AND  SUB_CL_NBR     = :MDSEAR-SUB-CL-NBR             CL**1
02106                 AND  MDSELV_CDE     = :MDSEAR-MDSELV-CDE             CL**1
02107          END-EXEC                                                    CL**1
02108 *                                                                    CL**1
02109          EVALUATE TRUE                                               CL**1
02110              WHEN SQLCODE = -904                                     CL**1
02111              WHEN SQLCODE = -913                                     CL**1
02112              WHEN SQLCODE = ZERO                                     CL**1
02113              WHEN SQLCODE = +100                                     CL**1
02114                   CONTINUE                                           CL**1
02115              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
02116              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
02117                   MOVE 'L400-ACTUAL-READ'                            CL**1
02118                                TO  DP013-PARAGRAPH                   CL**1
02119                   MOVE 'READ MDESAR'                                 CL**1
02120                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02121                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
02122                   SET DP013-DB2-ABEND                                CL**1
02123                                TO  TRUE                              CL**1
02124                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
02125          END-EVALUATE                                                CL**1
02126      END-PERFORM.                                                    CL**1
02127 *                                                                    CL**1
02128      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
02129          MOVE 'L400-ACTUAL-READ'                                     CL**1
02130                                TO  DP013-PARAGRAPH                   CL**1
02131          MOVE 'MAX RETRIES EXCEEDED FOR READ MDSEAR'                 CL**1
02132                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02133          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
02134          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
02135          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02136      END-IF.                                                         CL**1
02137 *                                                                    CL**1
02138  EJECT                                                               CL**1
02139 ******************************************************************   CL**1
02140 *    READ THE TEMPORARY STORAGE QUEUE THAT CONTAINS THE SELECTED     CL**1
02141 *    BUSINESS GROUPS FROM MBKCS120 (BUSINESS GROUP LIST).            CL**1
02142 *                                                                    CL**1
02143 *    PERFORMED BY C200, D500                                         CL*32
02144 ******************************************************************   CL**1
02145 *                                                                    CL**1
02146  M100-READ-LIST-QUEUE.                                               CL**1
02147 *                                                                    CL**1
02148      EXEC CICS                                                       CL**1
02149          READQ TS                                                    CL**1
02150          QUEUE(MB005-LIST-QUEUE-NAME)                                CL**1
02151          INTO(MA-LIST-RECORD)                                        CL**1
02152          LENGTH(MB005-LIST-QUEUE-LENGTH)                             CL**1
02153          ITEM(MB132-RESP-ITEM)                                       CL**1
02154          RESP(PV-RESP)                                               CL**1
02155      END-EXEC.                                                       CL**1
02156 *                                                                    CL**1
02157      IF  PV-RESP EQUAL DFHRESP(NORMAL)                               CL**7
02158          CONTINUE                                                    CL**7
02159      ELSE                                                            CL**7
02160          MOVE PV-RESP          TO  PM-RESP-22                        CL**1
02161          SET DP013-LOGIC-ABEND TO  TRUE                              CL**1
02162          SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
02163          MOVE 'M100-READ-LIST-QUEUE'                                 CL**1
02164                                TO  DP013-PARAGRAPH                   CL**1
02165          MOVE PM-PROGRAM-MESSAGE-22                                  CL**1
02166                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02167          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02168      END-IF.                                                         CL**1
02169 *                                                                    CL**1
02170  EJECT                                                               CL**1
02171 *                                                                    CL**1
02172 ******************************************************************   CL**1
02173 *    DELETE THE TEMPORARY STORAGE QUEUE.                             CL**1
02174 *                                                                    CL**1
02175 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
02176 ******************************************************************   CL**1
02177 *                                                                    CL**1
02178  Z050-DELETE-TEMP-STORAGE.                                           CL**1
02179 *                                                                    CL**1
02180      EXEC CICS                                                       CL**1
02181          DELETEQ TS                                                  CL**1
02182          QUEUE(MB132-TEMP-QUEUE-NAME)                                CL**1
02183          RESP(PV-RESP)                                               CL**1
02184      END-EXEC.                                                       CL**1
02185                                                                      CL**1
02186      IF (PV-RESP NOT = DFHRESP(NORMAL)) AND                          CL**1
02187         (PV-RESP NOT = DFHRESP(QIDERR))                              CL**1
02188          MOVE PV-RESP TO PM-RESP-23                                  CL**1
02189                                                                      CL**1
02190          SET DP013-LOGIC-ABEND TO TRUE                               CL**1
02191          SET DP013-NO-ROLLBACK TO TRUE                               CL**1
02192                                                                      CL**1
02193          MOVE 'Z050-DELETE-TEMP-STORAGE' TO DP013-PARAGRAPH          CL**1
02194          MOVE PM-PROGRAM-MESSAGE-23      TO DP013-MESSAGE-TEXT(1)    CL**1
02195                                                                      CL**1
02196          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02197      END-IF.                                                         CL**1
02198                                                                      CL**1
02199      MOVE +0 TO MB132-HIGHEST-BLOCK-WRITTEN.                         CL**1
02200  EJECT                                                               CL**1
02201 ******************************************************************   CL**1
02202 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.             CL**1
02203 *                                                                    CL**1
02204 *    PERFORMED BY D400-REFRESH-BLOCK-ARRAY.                          CL**1
02205 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
02206 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
02207 *    PERFORMED BY G500-SCROLL-FORWARD.                               CL**1
02208 *    PERFORMED BY G600-SCROLL-BACKWARD.                              CL**1
02209 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02210 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02211 ******************************************************************   CL**1
02212 *                                                                    CL**1
02213  Z100-READ-TEMP-STORAGE.                                             CL**1
02214 *                                                                    CL**1
02215      EXEC CICS                                                       CL**1
02216          READQ TS                                                    CL**1
02217          QUEUE(MB132-TEMP-QUEUE-NAME)                                CL**1
02218          INTO(MB132-BLOCK-ENTRIES(MB132-BLK-SUB))                    CL**1
02219          LENGTH(PC-BLOCK-LENGTH)                                     CL**1
02220          ITEM(PV-BLOCK-NUMBER)                                       CL**1
02221          RESP(PV-RESP)                                               CL**1
02222      END-EXEC.                                                       CL**1
02223 *                                                                    CL**1
02224      IF PV-RESP NOT = DFHRESP(NORMAL)                                CL**1
02225          MOVE PV-RESP          TO  PM-RESP-24                        CL**1
02226          EXEC CICS                                                   CL**1
02227               DELETEQ TS                                             CL**1
02228               QUEUE(MB132-TEMP-QUEUE-NAME)                           CL**1
02229               RESP(PV-RESP)                                          CL**1
02230          END-EXEC                                                    CL**1
02231          SET DP013-LOGIC-ABEND TO  TRUE                              CL**1
02232          SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
02233          MOVE 'Z100-READ-TEMP-STORAGE'                               CL**1
02234                                TO  DP013-PARAGRAPH                   CL**1
02235          MOVE PM-PROGRAM-MESSAGE-24                                  CL**1
02236                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02237          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02238      END-IF.                                                         CL**1
02239                                                                      CL**1
02240      SET MB132-BLOCK-NOT-MODIFIED(MB132-BLK-SUB) TO TRUE.            CL**1
02241  EJECT                                                               CL**1
02242 ******************************************************************   CL**1
02243 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.          CL**1
02244 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.        CL**1
02245 *                                                                    CL**1
02246 *    PERFORMED BY E300-NAVIGATE.                                     CL**1
02247 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
02248 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
02249 *    PERFORMED BY G500-SCROLL-FORWARD.                               CL**1
02250 *    PERFORMED BY G600-SCROLL-BACKWARD.                              CL**1
02251 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02252 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02253 *    PERFORMED BY H100-READ-ITEMS-FROM-DB.                           CL**1
02254 ******************************************************************   CL**1
02255 *                                                                    CL**1
02256  Z150-WRITE-TEMP-STORAGE.                                            CL**1
02257 *                                                                    CL**1
02258      IF MB132-HIGHEST-BLOCK-WRITTEN = +0                             CL**1
02259          MOVE EIBTASKN         TO  DP020-SRC-TASK-NUMBER             CL**1
02260          MOVE EIBTASKN         TO  MB132-TASK-NUMBER                 CL**1
02261          MOVE EIBTRMID         TO  MB132-TERM-ID                     CL**1
02262      END-IF.                                                         CL**1
02263 *                                                                    CL**1
02264      MOVE MB132-LIST-ITEM-NUMBER(MB132-BLK-SUB 1)                    CL**1
02265                                TO  PV-LIST-ITEM-NUMBER.              CL**1
02266      COMPUTE PV-BLOCK-NUMBER =                                       CL**1
02267          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).       CL**1
02268 *                                                                    CL**1
02269      IF (PV-BLOCK-NUMBER < MB132-HIGHEST-BLOCK-WRITTEN)              CL**1
02270      OR (PV-BLOCK-NUMBER = MB132-HIGHEST-BLOCK-WRITTEN)              CL**1
02271          IF  MB132-BLOCK-MODIFIED(MB132-BLK-SUB)                     CL**1
02272              EXEC CICS                                               CL**1
02273                  WRITEQ TS                                           CL**1
02274                  QUEUE(MB132-TEMP-QUEUE-NAME)                        CL**1
02275                  FROM(MB132-BLOCK-ENTRIES(MB132-BLK-SUB))            CL**1
02276                  LENGTH(PC-BLOCK-LENGTH)                             CL**1
02277                  ITEM(PV-BLOCK-NUMBER)                               CL**1
02278                  REWRITE                                             CL**1
02279                  RESP(PV-RESP)                                       CL**1
02280              END-EXEC                                                CL**1
02281 *                                                                    CL**1
02282              IF  PV-RESP NOT = DFHRESP(NORMAL)                       CL**1
02283                  MOVE PV-RESP  TO  PM-RESP-9                         CL**1
02284                  EXEC CICS                                           CL**1
02285                      DELETEQ TS                                      CL**1
02286                      QUEUE(MB132-TEMP-QUEUE-NAME)                    CL**1
02287                      RESP(PV-RESP)                                   CL**1
02288                  END-EXEC                                            CL**1
02289 *                                                                    CL**1
02290                  SET DP013-LOGIC-ABEND                               CL**1
02291                                TO  TRUE                              CL**1
02292                  SET DP013-NO-ROLLBACK                               CL**1
02293                                TO  TRUE                              CL**1
02294                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**1
02295                                TO  DP013-PARAGRAPH                   CL**1
02296                  MOVE PM-PROGRAM-MESSAGE-9                           CL**1
02297                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02298                  PERFORM DP013-0000-PROCESS-ABEND                    CL**1
02299              END-IF                                                  CL**1
02300          END-IF                                                      CL**1
02301      ELSE                                                            CL**1
02302 *                                                                    CL**1
02303          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                          CL**1
02304              MB132-HIGHEST-BLOCK-WRITTEN + 1                         CL**1
02305          IF  PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN              CL**1
02306              EXEC CICS                                               CL**1
02307                  WRITEQ TS                                           CL**1
02308                  QUEUE(MB132-TEMP-QUEUE-NAME)                        CL**1
02309                  FROM(MB132-BLOCK-ENTRIES(MB132-BLK-SUB))            CL**1
02310                  LENGTH(PC-BLOCK-LENGTH)                             CL**1
02311                  ITEM(PV-BLOCK-NUMBER)                               CL**1
02312                  RESP(PV-RESP)                                       CL**1
02313              END-EXEC                                                CL**1
02314 *                                                                    CL**1
02315              IF  PV-RESP NOT = DFHRESP(NORMAL)                       CL**1
02316                  MOVE PV-RESP  TO  PM-RESP-10                        CL**1
02317                  EXEC CICS                                           CL**1
02318                      DELETEQ TS                                      CL**1
02319                      QUEUE(MB132-TEMP-QUEUE-NAME)                    CL**1
02320                      RESP(PV-RESP)                                   CL**1
02321                  END-EXEC                                            CL**1
02322 *                                                                    CL**1
02323                  SET DP013-LOGIC-ABEND                               CL**1
02324                                TO  TRUE                              CL**1
02325                  SET DP013-NO-ROLLBACK                               CL**1
02326                                TO  TRUE                              CL**1
02327                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**1
02328                                TO  DP013-PARAGRAPH                   CL**1
02329                  MOVE PM-PROGRAM-MESSAGE-10                          CL**1
02330                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02331                  PERFORM DP013-0000-PROCESS-ABEND                    CL**1
02332              END-IF                                                  CL**1
02333              ADD +1            TO  MB132-HIGHEST-BLOCK-WRITTEN       CL**1
02334          ELSE                                                        CL**1
02335              SET DP013-LOGIC-ABEND                                   CL**1
02336                                TO  TRUE                              CL**1
02337              SET DP013-NO-ROLLBACK                                   CL**1
02338                                TO  TRUE                              CL**1
02339              MOVE 'Z150-WRITE-TEMP-STORAGE'                          CL**1
02340                                TO  DP013-PARAGRAPH                   CL**1
02341              MOVE PV-BLOCK-NUMBER                                    CL**1
02342                                TO  PM-BLOCK-NUMBER                   CL**1
02343              MOVE PM-PROGRAM-MESSAGE-11                              CL**1
02344                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02345              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
02346          END-IF                                                      CL**1
02347      END-IF.                                                         CL**1
02348                                                                      CL**1
02349      SET MB132-BLOCK-NOT-MODIFIED(MB132-BLK-SUB) TO TRUE.            CL**1
02350 *                                                                    CL**1
02351  EJECT                                                               CL**1
02352 ******************************************************************   CL**1
02353 *    FILL IN SCREEN HEADER MODULE                                    CL**1
02354 ******************************************************************   CL**1
02355                                                                      CL**1
02356      COPY DPPD002.                                                   CL**1
02357  EJECT                                                               CL**1
02358 ******************************************************************   CL**1
02359 *    RETURN TO CICS MODULE                                           CL**1
02360 ******************************************************************   CL**1
02361                                                                      CL**1
02362      COPY DPPD003.                                                   CL**1
02363  EJECT                                                               CL**1
02364 ******************************************************************   CL**1
02365 *    FORMAT MESSAGE LINES MODULE                                     CL**1
02366 ******************************************************************   CL**1
02367                                                                      CL**1
02368      COPY DPPD005.                                                   CL**1
02369  EJECT                                                               CL**1
02370 ******************************************************************   CL**1
02371 *    GET PANEL MODULE                                                CL**1
02372 ******************************************************************   CL**1
02373                                                                      CL**1
02374      COPY DPPD007.                                                   CL**1
02375  EJECT                                                               CL**1
02376 ******************************************************************   CL**1
02377 *    WRITE PANEL MODULE                                              CL**1
02378 ******************************************************************   CL**1
02379                                                                      CL**1
02380      COPY DPPD008.                                                   CL**1
02381  EJECT                                                               CL**1
02382 ******************************************************************   CL**1
02383 *    TOGGLE THE FUNCTION KEY LINE MODULE                             CL**1
02384 ******************************************************************   CL**1
02385                                                                      CL**1
02386      COPY DPPD009.                                                   CL**1
02387  EJECT                                                               CL**1
02388 ******************************************************************   CL**1
02389 *    ABEND PROCESSOR MODULE                                          CL**1
02390 ******************************************************************   CL**1
02391                                                                      CL**1
02392      COPY DPPD013.                                                   CL**1
02393  EJECT                                                               CL**1
02394 ******************************************************************   CL**1
02395 *    CHECK COMMUNICATION AREA MODULE                                 CL**1
02396 ******************************************************************   CL**1
02397                                                                      CL**1
02398      COPY DPPD015.                                                   CL**1
02399  EJECT                                                               CL**1
02400 ******************************************************************   CL**1
02401 *    UPDATE TIME AND DATE MODULE                                     CL**1
02402 ******************************************************************   CL**1
02403                                                                      CL**1
02404      COPY DPPD017.                                                   CL**1
02405  EJECT                                                               CL**1
