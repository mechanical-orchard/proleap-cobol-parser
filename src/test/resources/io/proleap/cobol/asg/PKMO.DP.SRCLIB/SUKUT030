000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020003
000300******************************************************************00030003
000400                                                                  00040003
000500 PROGRAM-ID.             SUKUT030.                                00050099
000600 AUTHOR.                 LYNN MCADAMS.                            00060003
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070003
000800 DATE-WRITTEN            FEBRUARY, 2000.                          00080099
000900 DATE-COMPILED.                                                   00090003
001000                                                                  00100003
001100*----------------------------------------------------------------*00110003
001200* THIS PROGRAM WILL TAKE INFORMATION FROM THE SHIPPING UNIT      *00120099
001300* DATABASE AND USE IT AGAINST THE PO AND VENDOR TABLE TO OBTAIN  *00130099
001400* THE VENDOR NAME FOR EACH PO.                                   *00140099
001500*----------------------------------------------------------------*00150003
001600                                                                  00160003
001700******************************************************************00170003
001800 ENVIRONMENT DIVISION.                                            00180003
001900******************************************************************00190003
002000                                                                  00200003
002100 CONFIGURATION SECTION.                                           00210003
002200                                                                  00220003
002300 SOURCE-COMPUTER.        IBM-3090.                                00230003
002400 OBJECT-COMPUTER.        IBM-3090.                                00240003
002500                                                                  00250003
002600 INPUT-OUTPUT SECTION.                                            00260003
002700                                                                  00270003
002800 FILE-CONTROL.                                                    00280003
002900                                                                  00290003
003000      SELECT EXTRACT-FILE-IN        ASSIGN TO INP01.              00300088
003100      SELECT EXTRACT-FILE-OUT       ASSIGN TO OUT01.              00310088
003200                                                                  00320003
003300******************************************************************00330003
003400 DATA DIVISION.                                                   00340003
003500******************************************************************00350003
003600                                                                  00360003
003700 FILE SECTION.                                                    00370003
003800 FD  EXTRACT-FILE-IN                                              00380091
003900     LABEL RECORDS ARE STANDARD                                   00390003
004000     BLOCK CONTAINS 0 RECORDS                                     00400003
004100     RECORDING MODE IS F                                          00410003
004200     RECORD CONTAINS 200 CHARACTERS                               00420099
004300     DATA RECORD IS EXTRACT-IN-RECORD.                            00430088
004400                                                                  00440003
004500 01  EXTRACT-IN-RECORD               PIC X(200).                  00450099
004600                                                                  00460003
004700 FD  EXTRACT-FILE-OUT                                             00470088
004800     LABEL RECORDS ARE STANDARD                                   00480003
004900     BLOCK CONTAINS 0 RECORDS                                     00490003
005000     RECORDING MODE IS F                                          00500003
005100     RECORD CONTAINS 200 CHARACTERS                               00510099
005200     DATA RECORD IS EXTRACT-OUT-RECORD.                           00520088
005300                                                                  00530003
005400 01  EXTRACT-OUT-RECORD              PIC X(200).                  00540099
005500*------------------------------------------------------*          00550003
005600 WORKING-STORAGE SECTION.                                         00560003
005700*------------------------------------------------------*          00570003
005800 01 PC-PROGRAM-CONSTANTS.                                         00580099
005900    05  PC-PROGRAM-NAME              PIC X(08) VALUE 'SUKUT030'.  00590099
006000                                                                  00600099
006100 01 PC-PROGRAM-VARIABLES.                                         00610099
006200    05 PV-NULL-IND                   PIC S9(04)    VALUE ZERO     00620099
006300                                                   COMP SYNC.     00630099
006400    05 PV-ABEND-CODE                 PIC 9(04)     VALUE ZERO.    00640099
006500    05 PV-ABEND-PARA-NAME            PIC X(30)     VALUE SPACE.   00650099
006600    05 PV-DONT-SHIP-BEF-DTE          PIC X(10)     VALUE SPACE.   00660099
006700    05 PV-DB2-OPERATION-MSG-1        PIC X(40)     VALUE SPACE.   00670099
006800    05 PV-DB2-TABLE-NAME             PIC X(12)     VALUE SPACE.   00680099
006900    05 PV-SQLCODE                    PIC Z(8)9-.                  00690099
007000                                                                  00700099
007100    05  PV-SAVE-FIELDS.                                           00710099
007200        10  PV-SAVE-PO               PIC S9(09)    COMP.          00720099
007300                                                                  00730099
007400 01 DK-DB-KEYS.                                                   00740099
007500    05  DK-PO-NBR                    PIC S9(9)     COMP           00750099
007600                                                   VALUE ZERO.    00760099
007700                                                                  00770099
007800 01 PS-PROGRAM-SWITCHES.                                          00780003
007900    05  PS-FIRST-TIME-SW             PIC X(01)     VALUE 'N'.     00790099
008000        88  PS-FIRST-TIME-YES                      VALUE 'Y'.     00800099
008100        88  PS-FIRST-TIME-NO                       VALUE 'N'.     00810099
008200    05  PS-END-OF-FILE-SW            PIC X(01)     VALUE 'N'.     00820099
008300        88  PS-END-OF-FILE                         VALUE 'Y'.     00830099
008400    05  PS-END-OF-TABLE-SW           PIC X(01)     VALUE SPACE.   00840099
008500        88 PS-END-OF-TABLE           VALUE 'Y'.                   00850099
008600                                                                  00860025
008700 01 WS-CALC-FIELDS.                                               00870084
008800    05  WS-RECORDS-READ-QTY          PIC S9(07)    COMP-3         00880089
008900                                                   VALUE ZERO.    00890099
009000    05  WS-RECORDS-WRITE-QTY         PIC S9(07)    COMP-3         00900089
009100                                                   VALUE ZERO.    00910099
009200*                                                                 00920099
009300*** INPUT AND OUTPUT FILE RECORD LAYOUT ****                      00930099
009400     COPY SURD008.                                                00940099
009500                                                                  00950091
009600                                                                  00960099
009700*** DB2 MESSAGE AREAS ****                                        00970099
009800     COPY DPWS004.                                                00980099
009900                                                                  00990099
010000*---------------------------------------------------------------* 01000099
010100*    DB2 AREA FOR COMMUNICATIONS                                * 01010099
010200*---------------------------------------------------------------* 01020099
010300     EXEC SQL                                                     01030099
010400          INCLUDE SQLCA                                           01040099
010500     END-EXEC.                                                    01050099
010600                                                                  01060099
010700*---------------------------------------------------------------* 01070099
010800*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 01080099
010900*---------------------------------------------------------------* 01090099
011000     EXEC SQL                                                     01100099
011100          INCLUDE TPURCHS                                         01110099
011200     END-EXEC.                                                    01120099
011300                                                                  01130099
011400*---------------------------------------------------------------* 01140099
011500*    DB2 AREA FOR THE PURCHASE ORDER PLANNED SHIPMENT TABLE     * 01150099
011600*---------------------------------------------------------------* 01160099
011700     EXEC SQL                                                     01170099
011800          INCLUDE TPLNSHP                                         01180099
011900     END-EXEC.                                                    01190099
012000                                                                  01200099
012100*---------------------------------------------------------------* 01210099
012200*    DB2 AREA FOR THE VENDOR TABLE                              * 01220099
012300*---------------------------------------------------------------* 01230099
012400     EXEC SQL                                                     01240099
012500          INCLUDE TENTNME                                         01250099
012600     END-EXEC.                                                    01260099
012700*                                                                 01270099
012800********************************************************          01280099
012900 PROCEDURE DIVISION.                                              01290099
013000********************************************************          01300099
013100 0000-MAIN.                                                       01310099
013200     PERFORM 1000-INITIALIZATION.                                 01320099
013300                                                                  01330099
013400     IF  PS-END-OF-FILE                                           01340099
013500         NEXT SENTENCE                                            01350099
013600     ELSE                                                         01360099
013700         SET PS-FIRST-TIME-NO TO TRUE                             01370099
013800         PERFORM 2000-PROCESS-FILES                               01380099
013900           UNTIL  PS-END-OF-FILE                                  01390099
014000     END-IF.                                                      01400099
014100                                                                  01410099
014200     CLOSE EXTRACT-FILE-IN                                        01420099
014300           EXTRACT-FILE-OUT.                                      01430099
014400                                                                  01440099
014500     DISPLAY 'NUMBER OF RECORDS READ IS:     '                    01450099
014600         WS-RECORDS-READ-QTY.                                     01460099
014700     DISPLAY 'NUMBER OF RECORDS WRITTEN IS:  '                    01470099
014800         WS-RECORDS-WRITE-QTY.                                    01480099
014900                                                                  01490099
015000     STOP RUN.                                                    01500099
015100*                                                                 01510099
015200*                                                                 01520099
015300********************************************************          01530099
015400 1000-INITIALIZATION.                                             01540099
015500********************************************************          01550099
015600      OPEN INPUT  EXTRACT-FILE-IN                                 01560099
015700           OUTPUT EXTRACT-FILE-OUT.                               01570099
015800                                                                  01580099
015900*READ FIRST INPUT RECORD.                                         01590099
016000      PERFORM 8000-READ-INPUT-FILE.                               01600099
016100      SET PS-FIRST-TIME-YES TO TRUE.                              01610099
016200*                                                                 01620099
016300*                                                                 01630099
016400********************************************************          01640099
016500 2000-PROCESS-FILES.                                              01650099
016600********************************************************          01660099
016700      IF PV-SAVE-PO = SU008-PO-NBR                                01670099
016800         MOVE ENTNME-ENT-NAME-DESC TO SU008-VEND-NAME             01680099
016900         MOVE PURCHS-DEPT-NBR      TO SU008-DEPT-NBR              01690099
017000         MOVE PURCHS-ENT-ID        TO SU008-ENT-ID                01700099
017100         MOVE PURCHS-PO-TYP-CDE    TO SU008-PO-TYP-CDE            01710099
017200         MOVE PURCHS-NEW-STR-PO-IND TO SU008-NEW-STR-IND          01720099
017300         MOVE PV-DONT-SHIP-BEF-DTE  TO SU008-DONT-SHIP-BEF-DTE    01730099
017400      ELSE                                                        01740099
017500         MOVE SU008-PO-NBR         TO PV-SAVE-PO                  01750099
017600         PERFORM 2110-GET-VEND-NAME                               01760099
017700      END-IF.                                                     01770099
017800                                                                  01780099
017900      PERFORM 3000-WRITE-HEADER-RECORD.                           01790099
018000                                                                  01800099
018100*READ NEXT INPUT RECORD.                                          01810099
018200      PERFORM 8000-READ-INPUT-FILE.                               01820099
018300*                                                                 01830099
018400*                                                                 01840099
018500********************************************************          01850099
018600 2110-GET-VEND-NAME.                                              01860099
018700********************************************************          01870099
018800     MOVE SU008-PO-NBR     TO DK-PO-NBR.                          01880099
018900                                                                  01890099
019000     EXEC SQL                                                     01900099
019100                SELECT                                            01910099
019200                      A.DEPT_NBR                                  01920099
019300                    , A.ENT_ID                                    01930099
019400                    , A.PO_TYP_CDE                                01940099
019500                    , A.NEW_STR_PO_IND                            01950099
019600                    , B.ENT_NAME_DESC                             01960099
019700                    , CHAR(C.DONT_SHIP_BEF_DTE,ISO)               01970099
019800                 INTO   :PURCHS-DEPT-NBR                          01980099
019900                       ,:PURCHS-ENT-ID                            01990099
020000                       ,:PURCHS-PO-TYP-CDE                        02000099
020100                       ,:PURCHS-NEW-STR-PO-IND                    02010099
020200                       ,:ENTNME-ENT-NAME-DESC                     02020099
020300                       ,:PV-DONT-SHIP-BEF-DTE                     02030099
020400                FROM TPURCHS A                                    02040099
020500                   , TENTNME B                                    02050099
020600                   , TPLNSHP C                                    02060099
020700                WHERE A.PO_NBR           = :DK-PO-NBR             02070099
021000                  AND A.VER_STATUS_CDE   = 'A'                    02071099
021000                  AND A.PO_TYP_CDE NOT LIKE 'FB'                  02072099
020800                  AND A.ENT_ID           = B.ENT_ID               02080099
                        AND B.TYPE_CDE         = '01'                   02100099
021100                  AND C.PO_NBR           = A.PO_NBR               02110099
021200                  AND C.VER_STATUS_CDE   = 'A'                    02120099
021300     END-EXEC.                                                    02130099
021400                                                                  02140099
021500     EVALUATE TRUE                                                02150099
021600          WHEN SQLCODE = ZERO                                     02160099
021700              MOVE ENTNME-ENT-NAME-DESC TO SU008-VEND-NAME        02170099
021800              MOVE PURCHS-DEPT-NBR      TO SU008-DEPT-NBR         02180099
021900              MOVE PURCHS-ENT-ID        TO SU008-ENT-ID           02190099
022000              MOVE PURCHS-PO-TYP-CDE    TO SU008-PO-TYP-CDE       02200099
022100              MOVE PURCHS-NEW-STR-PO-IND TO SU008-NEW-STR-IND     02210099
022200              MOVE PV-DONT-SHIP-BEF-DTE                           02220099
022300                                   TO SU008-DONT-SHIP-BEF-DTE     02230099
022400          WHEN SQLCODE = +100                                     02240099
022500              SET PS-END-OF-TABLE TO TRUE                         02250099
022600          WHEN OTHER                                              02260099
022700              MOVE '2110-GET-VEND-NAME'                           02270099
022800                                       TO PV-ABEND-PARA-NAME      02280099
022900              MOVE 'SELECT TPURCHS, TENTNME ROWS '                02290099
023000                                       TO PV-DB2-OPERATION-MSG-1  02300099
023100              MOVE 'TPURCHS'           TO PV-DB2-TABLE-NAME       02310099
023200              PERFORM 9998-SQL-ABEND                              02320099
023300      END-EVALUATE.                                               02330099
023400*                                                                 02340099
023500*                                                                 02350099
023600********************************************************          02360099
023700 3000-WRITE-HEADER-RECORD.                                        02370099
023800********************************************************          02380099
023900      WRITE EXTRACT-OUT-RECORD          FROM                      02390099
024000                                 SU008-EXTRACT-RECORD.            02400099
024100      ADD  +1                    TO WS-RECORDS-WRITE-QTY.         02410099
024200*                                                                 02420099
024300*                                                                 02430099
024400********************************************************          02440099
024500 8000-READ-INPUT-FILE.                                            02450099
024600********************************************************          02460099
024700      INITIALIZE SU008-EXTRACT-RECORD.                            02470099
024800      READ EXTRACT-FILE-IN       INTO                             02480099
024900                                  SU008-EXTRACT-RECORD            02490099
025000         AT END                                                   02500099
025100            SET PS-END-OF-FILE TO TRUE                            02510099
025200         NOT AT END                                               02520099
025300           ADD  +1                    TO WS-RECORDS-READ-QTY      02530099
025400      END-READ.                                                   02540099
025500*                                                                 02550099
025600*                                                                 02560099
025700********************************************************          02570099
025800 9998-SQL-ABEND.                                                  02580099
025900********************************************************          02590099
026000     MOVE SQLCODE     TO PV-SQLCODE.                              02600099
026100     DISPLAY '** ABEND           ** = SQLABEND'.                  02610099
026200     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          02620099
026300     DISPLAY '** PARAGRAPH       ** = ' PV-ABEND-PARA-NAME.       02630099
026400     DISPLAY '** TABLE AFFECTED  ** = ' PV-DB2-TABLE-NAME.        02640099
026500     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.   02650099
026600     DISPLAY '** SQLCODE         ** = ' PV-SQLCODE.               02660099
026700     DISPLAY '** PO NUMBER       ** = ' DK-PO-NBR.                02670099
026800     COPY DPPD004.                                                02680099
026900     MOVE +4013                  TO PV-ABEND-CODE.                02690099
027000     CALL 'ILBOABN0'   USING PV-ABEND-CODE.                       02700099
