000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'PREPACK TRANSCRIPTION EDIT'.                                      
000300 PROGRAM-ID.    RCKCS809.                                                 
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  SPRING 2000.                                              
000700 DATE-COMPILED.                                                           
000800******************************************************************        
000900*    E809 - PREPACK PO LINE TROUBLE ROUTINE                               
001000*                                                                         
001100******************************************************************        
      * TOM PRIMEAU 03/10/10 WR#38216                                           
      * REMOVED 'PC-870 PIC S9(4) COMP VALUE+870' FROM WORKING                  
      * STORAGE.                                                                
      * CHANGED VARIABLE IN PT-STORE-TABLE 'PT-STORE-INFO'                      
      * OCCURS 1 TO 1500 TIMES TO OCCURS 1 TO 2000 TIMES.                       
      * ADD NEW WORKING STORAGE VARIABLE TO 'PT-STORE-TABLE'                    
      * 'PT-E-BUS-IND PIC X(01)'.                                               
      * MODIFIED THE 'STORE-CSR' TO SELECT 'A.E_BUS_IND'.                       
      * ADDED XLT00010-E-BUS-IND TO FETCH STATEMENT IN PARAGRAPH                
      * 7811-FETCH-STORE-CSR.                                                   
      * ADDED MOVE OF XLT00010-E-BUS-IND TO 1100-LOAD-STORE-TABLE.              
      * ADDED THE MOVE OF THE EBUSINESS IND FOR THE CORRECT STORE               
      * TO THE 'XLT00010-E-BUS-IND' IN PARA 7150-GET-TYPE-CODE.                 
      * CHANGED THE CONDITION TO CHECK THE EBUSINESS INDICATOR                  
      * INSTEAD OF 'PC-870', AND CHECK 'LOC-TYP-CDE='DC'.                       
      ******************************************************************        
001200 ENVIRONMENT DIVISION.                                                    
001300 CONFIGURATION SECTION.                                                   
001400 SOURCE-COMPUTER.        IBM-3090.                                        
001500 OBJECT-COMPUTER.        IBM-3090.                                        
001600 DATA DIVISION.                                                           
001700 WORKING-STORAGE SECTION.                                                 
001800                                                                          
001900 01  PS-PROGRAM-SWITCHES.                                                 
002000     05  PS-DONE-SW                   PIC  X    VALUE 'N'.                
002100         88  PS-NOT-DONE                        VALUE 'N'.                
002200         88  PS-DONE                            VALUE 'Y'.                
002300     05  PS-TALLPLN-DISTRO-SW         PIC  X    VALUE 'N'.                
002400         88  PS-NO-TALLPLN-DISTRO               VALUE 'N'.                
002500         88  PS-TALLPLN-DISTRO                  VALUE 'Y'.                
002600     05  PS-TMESTDS-DISTRO-SW         PIC  X    VALUE 'N'.                
002700         88  PS-NO-TMESTDS-DISTRO               VALUE 'N'.                
002800         88  PS-TMESTDS-DISTRO                  VALUE 'Y'.                
002900     05  PS-ALLOC-SW                  PIC  X    VALUE 'Y'.                
003000         88  PS-DONT-DO-ALLOC                   VALUE 'N'.                
003100         88  PS-DO-ALLOC                        VALUE 'Y'.                
003200*    05  PS-DISCREPANCY-SW            PIC  X    VALUE 'N'.                
003300*        88  PS-NO-DISCREPANCY                  VALUE 'N'.                
003400*        88  PS-DISCREPANCY                     VALUE 'Y'.                
003500     05  PS-MESSAGE-SW                PIC  X    VALUE 'N'.                
003600         88  PS-USE-SPECIFIC-MSG                VALUE 'Y'.                
003700     05  PS-OVER-SHORT-SW             PIC  X VALUE SPACES.                
003800         88  PS-OVER                            VALUE 'O'.                
003900         88  PS-SHORT                           VALUE 'S'.                
004000     05  PS-VARIANCES-SW              PIC  X VALUE 'N'.                   
004100         88  PS-DIFFERENT-VARIANCES-NO       VALUE 'N'.                   
004200         88  PS-DIFFERENT-VARIANCES-YES      VALUE 'Y'.                   
004300     05  PS-USE-LINE-NBR-SW           PIC  X VALUE 'N'.                   
004400         88  PS-DONT-USE-LINE-NBR            VALUE 'N'.                   
004500         88  PS-USE-LINE-NBR                 VALUE 'Y'.                   
004600     05  PS-TRBL-FOUND-SW             PIC  X VALUE 'N'.                   
004700         88  PS-TRBL-FOUND                   VALUE 'Y'.                   
004800         88  PS-TRBL-NOT-FOUND               VALUE 'N'.                   
004900     05  PS-CREATE-267-TRBL-SW        PIC  X VALUE 'N'.                   
005000         88  PS-DONT-CREATE-267-TRBL         VALUE 'N'.                   
005100         88  PS-CREATE-267-TRBL              VALUE 'Y'.                   
005200     05  PS-CREATE-269-TRBL-SW        PIC  X VALUE 'N'.                   
005300         88  PS-DONT-CREATE-269-TRBL         VALUE 'N'.                   
005400         88  PS-CREATE-269-TRBL              VALUE 'Y'.                   
005500     05  PS-STORE-CLOSED-SW           PIC  X VALUE 'Y'.                   
005600         88  PS-STORE-CLOSED                 VALUE 'N'.                   
005700         88  PS-STORE-OPEN                   VALUE 'Y'.                   
005800     05  PS-PARA5000-SW               PIC  X VALUE 'N'.                   
005900         88  PS-NORMAL-PERFORM               VALUE 'N'.                   
006000         88  PS-PERFORMED-BY-PARA-5000       VALUE 'Y'.                   
006100     05  PS-STORE-CSR-SW              PIC  X VALUE 'N'.                   
006200         88  PS-END-STORE-CSR                VALUE 'Y'.                   
           05  PS-WEB-TROUBLE-SW            PIC  X VALUE 'N'.                   
               88  PS-NO-WEB-TROUBLE               VALUE 'N'.                   
               88  PS-WEB-TROUBLE                  VALUE 'Y'.                   
           05  PS-CALL-API                  PIC  X VALUE 'N'.                   
               88  PS-CALL-API-NO                  VALUE 'N'.                   
               88  PS-CALL-API-YES                 VALUE 'Y'.                   
                                                                                
006400 01  PS-PACK-LEVEL-SWITCHES.                                              
006500     05  PS-DC-BAD-PACK-SW            PIC  X    VALUE 'N'.                
006600         88  PS-DC-BAD-PACK                     VALUE 'Y'.                
006700     05  PS-ANALYST-BAD-RATIO-SW      PIC  X    VALUE 'N'.                
006800         88  PS-ANALYST-BAD-RATIO               VALUE 'Y'.                
006900     05  PS-ZERO-BEST-CASE-SW         PIC  X    VALUE 'N'.                
007000         88  PS-ZERO-BEST-CASE                  VALUE 'Y'.                
007100     05  PS-INVALID-STR-PLAN-SW       PIC  X    VALUE 'N'.                
007200         88  PS-INVALID-STR-PLAN                VALUE 'Y'.                
007300     05  PS-TRB-PACK-LEVEL-SW         PIC X(01).                          
007400             88  PS-PACK-LEVEL-TROUBLE          VALUE 'Y'.                
007500     05  PS-TRB-PACK-OVER-SW          PIC X(01).                          
007600             88  PS-PACK-OVER-YES               VALUE 'Y'.                
007700     05  PS-TRB-PACK-UNDER-SW         PIC X(01).                          
007800             88  PS-PACK-UNDER-YES              VALUE 'Y'.                
007900     05  PS-TRB-PACK-OVER-UNDER-SW    PIC X(01).                          
008000             88  PS-PACK-OVER-UNDER-YES         VALUE 'Y'.                
008100     05  PS-TRB-PACK-ODD-UNITS-SW     PIC X(01).                          
008200             88  PS-PACK-ODD-UNITS-YES          VALUE 'Y'.                
008300     05  PS-TRB-PACK-RATIO-CHGD-SW    PIC X(01).                          
008400             88  PS-PACK-RATIO-CHGD-YES          VALUE 'Y'.               
008500                                                                          
008600 01  PT-TROUBLE-TABLE.                                                    
008700     05  PT-TROUBLES OCCURS 50 TIMES INDEXED BY PT-TRB-IDX.               
008800         10  PT-TRB-LINE-NBR          PIC S9(4) COMP.                     
008900         10  PT-TRB-LINE-LEVEL-SW     PIC X(01).                          
009000             88  PT-LINE-LEVEL-TROUBLE   VALUE 'Y'.                       
009100         10  PT-LINE-RCVD-QTY         PIC S9(09) COMP.                    
009200         10  PT-LINE-OTR-QTY          PIC S9(09) COMP.                    
009300         10  PT-LINE-PCT-OVER-SHT     PIC S9(04)V999 COMP.                
009400         10  PT-LINE-PCT-VARIANCE     PIC S9(04)V9   COMP.                
009500         10  PT-LINE-ODD-UNITS        PIC S9(04)     COMP.                
009600         10  PT-TRB-SWITCHES.                                             
009700             15  PT-LINE-OVER-WITHIN  PIC X(01).                          
009800                 88  PT-LINE-OVER-WITHIN-YES         VALUE 'Y'.           
009900             15  PT-LINE-OVER-OUTSIDE PIC X(01).                          
010000                 88  PT-LINE-OVER-OUTSIDE-YES        VALUE 'Y'.           
010100             15  PT-LINE-OVER-CHGD-DISTRO                                 
010200                                      PIC X(01).                          
010300                 88  PT-LINE-OVER-CHGD-DISTRO-YES    VALUE 'Y'.           
010400             15  PT-LINE-ZERO-OTR     PIC X(01).                          
010500                 88  PT-LINE-ZERO-OTR-YES            VALUE 'Y'.           
010600             15  PT-LINE-SHRT-WITHIN  PIC X(01).                          
010700                 88  PT-LINE-SHRT-WITHIN-YES         VALUE 'Y'.           
010800             15  PT-LINE-SHRT-WI-SPEC PIC X(01).                          
010900                 88  PT-LINE-SHRT-WI-SPEC-YES        VALUE 'Y'.           
011000             15  PT-LINE-SHRT-OUTSIDE PIC X(01).                          
011100                 88  PT-LINE-SHRT-OUTSIDE-YES        VALUE 'Y'.           
011200             15  PT-LINE-SHRT-SPECIFIC PIC X(01).                         
011300                 88  PT-LINE-SHRT-SPECIFIC-YES       VALUE 'Y'.           
011400             15  PT-LINE-SHRT-APPR-SW  PIC X(01).                         
011500                 88  PT-LINE-SHRT-APPR-YES           VALUE 'Y'.           
011600             15  PT-LINE-SHRT-PIC-AD  PIC X(01).                          
011700                 88  PT-LINE-SHRT-PIC-AD-YES         VALUE 'Y'.           
011800             15  PT-LINE-UNTIED-PACK  PIC X(01).                          
011900                 88  PT-LINE-UNTIED-PACK-YES         VALUE 'Y'.           
012000             15  PT-LINE-RATIO-CHG-SW PIC X(01).                          
012100                 88  PT-LINE-RATIO-CHGD-YES          VALUE 'Y'.           
012200             15  PT-LINE-ODD-UNITS-SW PIC X(01).                          
012300                 88  PT-LINE-ODD-UNITS-YES           VALUE 'Y'.           
012400                                                                          
012500 01  PT-STORE-COUNT-TABLE.                                                
012600     05  FILLER-COUNT OCCURS 50 TIMES INDEXED BY PT-SC-IDX.               
012700         10  PT-STORE-COUNT           PIC S9(4) COMP.                     
012800/                                                                         
012900*  THESE ARE THE INITIAL VALUES FOR A 4 DIMENSIONAL TABLE THAT            
013000*  DEFINES THE VARIOUS FLAVORS OF DC/ANALYST BAD PACK.  EACH              
013100*  DIMENSION HOLDS A DIFFERENT CATEGORY OF ERROR.  ONLY ONE               
013200*  ERROR CAN BE FLAGGED WITHIN EACH GROUP.                                
013300                                                                          
013400 01  PC-TRBL-REASON-MATRIX.                                               
013500* OVERAGES/SHORTAGES (OCCURRENCE 1)                                       
013600     05  FILLER                       PIC X(34) VALUE                     
013700         '1ODD UNIT LINE OUTSIDE   TANNONE  '.                            
013800     05  FILLER                       PIC X(34) VALUE                     
013900         '2ODD UNIT PACK OUTSIDE   TINNONE  '.                            
014000     05  FILLER                       PIC X(34) VALUE                     
014100         '3ODD UNIT LINE WITHIN    NANNONE  '.                            
014200     05  FILLER                       PIC X(34) VALUE                     
014300         '4ODD UNIT PACK WITHIN    NINNONE  '.                            
014400     05  FILLER                       PIC X(34) VALUE                     
014500         '5                                 '.                            
014600*                                                                         
014700* BEST CASE ERRORS (OCCURRENCE 2)                                         
014800     05  FILLER                       PIC X(34) VALUE                     
014900         '1BEST CASE OUTSIDE       TAN000000'.                            
015000     05  FILLER                       PIC X(34) VALUE                     
015100         '2SHORT PIC AD            TANNO    '.                            
015200     05  FILLER                       PIC X(34) VALUE                     
015300         '3BEST CASE WITHIN        NAN000000'.                            
015400     05  FILLER                       PIC X(34) VALUE                     
015500         '4                                 '.                            
015600     05  FILLER                       PIC X(34) VALUE                     
015700         '5                                 '.                            
015800*                                                                         
015900* MISSING LINE ERRORS (OCCURRENCE 3)                                      
016000     05  FILLER                       PIC X(34) VALUE                     
016100         '1MISSING LINE            TAN000000'.                            
016200     05  FILLER                       PIC X(34) VALUE                     
016300         '2                                 '.                            
016400     05  FILLER                       PIC X(34) VALUE                     
016500         '3                                 '.                            
016600     05  FILLER                       PIC X(34) VALUE                     
016700         '4                                 '.                            
016800     05  FILLER                       PIC X(34) VALUE                     
016900         '5                                 '.                            
017000*                                                                         
017100* RATIO ERRORS   (OCCURRENCE 4)                                           
017200     05  FILLER                       PIC X(34) VALUE                     
017300         '1NEW RATIO OUTSIDE       TAN000000'.                            
017400     05  FILLER                       PIC X(34) VALUE                     
017500         '2NEW RATIO WITHIN        NAN000000'.                            
017600     05  FILLER                       PIC X(34) VALUE                     
017700         '3                                 '.                            
017800     05  FILLER                       PIC X(34) VALUE                     
017900         '4                                 '.                            
018000     05  FILLER                       PIC X(34) VALUE                     
018100         '5                                 '.                            
018200*                                                                         
018300 01  PT-TRBL-REASON-TABLE REDEFINES PC-TRBL-REASON-MATRIX.                
018400     05  PT-TRBL-REASONS OCCURS 4 TIMES                                   
018500                           INDEXED BY PT-TRBL-CLASS-IDX.                  
018600         10  FILLER OCCURS 5 TIMES INDEXED BY PT-TRBL-REAS-IDX.           
018700             15 PT-SEQUENCE           PIC 9.                              
018800             15 PT-REASON-DESC        PIC X(24).                          
018900             15 PT-NOTIF-TYPE         PIC X(01).                          
019000                 88 PT-NOTIFY-TYPE        VALUE 'N'.                      
019100                 88 PT-TRBL-TYPE          VALUE 'T'.                      
019200             15 PT-TRBL-STATUS        PIC X(01).                          
019300                 88 PT-TRBL-ACTIVE        VALUE 'A'.                      
019400                 88 PT-TRBL-INACTIVE      VALUE 'I'.                      
019500             15 PT-TRBL-SELECT-SW     PIC X(01).                          
019600                 88 PT-TRBL-SELECTED      VALUE 'Y'.                      
019700                 88 PT-TRBL-NOT-SELECTED  VALUE 'N'.                      
019800             15  FILLER               PIC X(06).                          
019900                                                                          
020000 01  PC-TOLERANCES.                                                       
020100**   05  PC-LINE-ODD-UNIT-TOL         PIC S9(4) COMP VALUE +12.           
020200**   05  PC-LINE-ODD-UNIT-DOL-TOL     PIC S9(4)V99 COMP                   
020300**                                        VALUE +500.00.                  
020400**   05  PC-PACK-ODD-UNIT-TOL         PIC S9(4) COMP VALUE +36.           
020500**   05  PC-PACK-ODD-UNIT-DOL-TOL     PIC S9(4)V99 COMP                   
020600**                                        VALUE +2000.00.                 
020700**   05  PC-BEST-CASE-SHRT-OLD-STR-TOL                                    
020800**                                    PIC S9(4) COMP VALUE +25.           
020900**   05  PC-BEST-CASE-SHRT-NEW-STR-TOL                                    
021000**                                    PIC S9(4) COMP VALUE ZERO.          
021100**   05  PC-BEST-CASE-OVER-OLD-STR-TOL                                    
021200**                                    PIC S9(4) COMP VALUE +5.            
021300**   05  PC-BEST-CASE-OVER-NEW-STR-TOL                                    
021400**                                    PIC S9(4) COMP VALUE ZERO.          
021500     05  PC-MISSING-LINES-TOL         PIC S9(4) COMP VALUE ZERO.          
021600     05  PC-MEMBER-OFF-TOL            PIC S9(4) COMP VALUE +0.            
021700     05  PC-RATIO-OFF-PER-MEMB-TOL    PIC S9(4) COMP VALUE +0.            
021800                                                                          
021900 01  PT-ITEM-INFO-TABLE.                                                  
022000     05  PT-ITEM-INFO OCCURS 50 TIMES INDEXED BY PT-ITEM-IDX.             
022100         10  PT-PURITM-PO-LNE-NBR     PIC S9(9)    COMP.                  
022200         10  PT-PURITM-UNT-RTL-PR-AMT PIC S9(6)V99 COMP-3.                
022300         10  PT-PURITM-GP-RTL-AMT     PIC S9(5)V99 COMP-3.                
022400         10  PT-PURITM-GP-QTY         PIC S9(4)    COMP.                  
022500                                                                          
022600 01  PT-STORE-TABLE.                                                      
W38216     05  PT-STORE-INFO OCCURS 1 TO 2000 TIMES                             
022800             DEPENDING ON PV-STORE-COUNTER                                
022900             ASCENDING KEY IS PT-STR-NBR                                  
023000             INDEXED BY PT-STR-IDX.                                       
023100         10  PT-STR-NBR               PIC S9(04) COMP.                    
023200         10  PT-TYPE-CODE             PIC X(02).                          
023300         10  PT-DC-NMBR               PIC 9(04).                          
023400         10  PT-DC-RCT-START-DATE     PIC X(10).                          
023600         10  PT-DC-RCT-STOP-DATE      PIC X(10).                          
024300         10  PT-CLOSED-DATE           PIC X(10).                          
W38216         10  PT-E-BUS-IND             PIC X(01).                          
024400/                                                                         
024500 01  PC-BAD-PACK-GENERIC-TEXT.                                            
024600     02  PC-BPG-LINE-1.                                                   
024700         05  FILLER                   PIC X(15) VALUE                     
024800             'PACK ID      : '.                                           
024900         05  PV-BPG-PACK-ID           PIC 9(4).                           
025000         05  FILLER                   PIC X(31) VALUE SPACES.             
025100                                                                          
025200     02  PC-BPG-LINE-2.                                                   
025300         05  FILLER                   PIC X(14) VALUE                     
025400             'PACK RECEIVED:'.                                            
025500         05  PV-BPG-PACK-RCVD         PIC ZZZZ9.                          
025600         05  FILLER                   PIC X(05) VALUE SPACE.              
025700         05  FILLER                   PIC X(21) VALUE                     
025800             'PICTURED AD       :  '.                                     
025900         05  FILLER                   PIC X(02) VALUE SPACE.              
026000         05  PV-BPG-AD-YES-NO         PIC X(03) VALUE SPACE.              
026100                                                                          
026200     02  PC-BPG-LINE-3.                                                   
026300         05  FILLER                   PIC X(14) VALUE                     
026400             'PACK OTR     :'.                                            
026500         05  PV-BPG-PACK-OTR          PIC ZZZZ9.                          
026600         05  FILLER                   PIC X(05) VALUE SPACE.              
026700         05  FILLER                   PIC X(09) VALUE                     
026800             'ODD UNIT '.                                                 
026900         05  PV-BPG-WITHIN-OUTSIDE    PIC X(07) VALUE SPACES.             
027000         05  FILLER                   PIC X(05) VALUE '  :'.              
027100         05  PV-BPG-ODD-UNITS         PIC ZZZZ9.                          
027200                                                                          
027300     02  PC-BPG-LINE-4.                                                   
027400         05  FILLER                   PIC X(06) VALUE                     
027500             'PACKS '.                                                    
027600         05  PV-BPG-OVER-SHORT        PIC X(05) VALUE ' OVER'.            
027700         05  FILLER                   PIC X(03) VALUE '  :'.              
027800         05  PV-BPG-PACK-VARIANCE     PIC ZZZZ9.                          
027900         05  FILLER                   PIC X(05) VALUE SPACE.              
028000         05  FILLER                   PIC X(19) VALUE                     
028100             'ODD UNIT DOLLARS  :'.                                       
028200         05  PV-BPG-ODD-UNIT-DOLLARS  PIC $$$$$$9.                        
028300                                                                          
028400     02  PC-BPG-LINE-5.                                                   
028500         05  FILLER                   PIC X(15) VALUE                     
028600             'MISSING LINES: '.                                           
028700         05  FILLER                   PIC X(01) VALUE SPACE.              
028800         05  PV-BPG-LINE-COUNT        PIC ZZ9.                            
028900         05  FILLER                   PIC X(05) VALUE SPACE.              
029000         05  FILLER                   PIC X(20) VALUE                     
029100             'RATIO LINE CHANGES: '.                                      
029200         05  FILLER                   PIC X(03) VALUE SPACE.              
029300         05  PV-BPG-RATIO-YES-NO      PIC X(03) VALUE SPACES.             
029400         05  FILLER                   PIC X(03) VALUE SPACE.              
029500                                                                          
029600 01  PC-OVER-SHORT-GENERIC-TEXT.                                          
029700     02  PC-OS-LINE-1.                                                    
029800         05  FILLER                   PIC X(15) VALUE                     
029900             'PACK ID      : '.                                           
030000         05  PV-OS-PACK-ID            PIC 9(4).                           
030100         05  FILLER                   PIC X(05) VALUE SPACE.              
030200         05  FILLER                   PIC X(20) VALUE                     
030300             'PICTURED AD       : '.                                      
030400         05  PV-OS-AD-YES-NO          PIC X(03) VALUE SPACE.              
030500         05  FILLER                   PIC X(03) VALUE SPACE.              
030600                                                                          
030700     02  PC-OS-LINE-2.                                                    
030800         05  FILLER                   PIC X(14) VALUE                     
030900             'LINE RECEIVED:'.                                            
031000         05  PV-OS-LINE-RCVD          PIC ZZZZ9.                          
031100         05  FILLER                   PIC X(31) VALUE SPACE.              
031200                                                                          
031300     02  PC-OS-LINE-3.                                                    
031400         05  FILLER                   PIC X(14) VALUE                     
031500             'LINE OTR     :'.                                            
031600         05  PV-OS-LINE-OTR           PIC ZZZZ9.                          
031700         05  FILLER                   PIC X(31) VALUE SPACE.              
031800                                                                          
031900     02  PC-OS-LINE-4.                                                    
032000         05  FILLER                   PIC X(06) VALUE                     
032100             'LINE  '.                                                    
032200         05  PV-OS-OVER-SHORT         PIC X(05) VALUE ' OVER'.            
032300         05  FILLER                   PIC X(03) VALUE '  :'.              
032400         05  PV-OS-LINE-VARIANCE      PIC ZZZZ9.                          
032500         05  FILLER                   PIC X(31) VALUE SPACE.              
032600                                                                          
032700     02  PC-OS-LINE-5.                                                    
032800         05  FILLER                   PIC X(50) VALUE                     
032900         'LINE OVER/SHORT AS A RESULT OF PRIOR RECEIVERS'.                
033000/                                                                         
033100 01  PV-PROGRAM-VARIABLES.                                                
033200                                                                          
*******    05  DK-SKU-DEPT                  PIC X(03).                          
*******    05  DK-SKU-CLASS                 PIC X(02).                          
           05  DK-SKU-SEQ                   PIC X(03).                          
           05  DK-INTR-UPC-ID               PIC S9(09) COMP.                    
           05  DK-FROM-TMST                 PIC X(26).                          
           05  DK-TO-TMST                   PIC X(26).                          
           05  DK-ITM-NBR                   PIC S9(15)V COMP-3.                 
                                                                                
           05  PV-DB2-COUNT                 PIC S9(09) VALUE +0                 
                                                       COMP-3.                  
                                                                                
           05  PV-FROM-TMST.                                                    
               10  PV-FROM-DATE  PIC X(10).                                     
               10  FILLER        PIC X(16) VALUE '-00.00.00.000000'.            
                                                                                
           05  PV-TO-TMST.                                                      
               10  PV-TO-DATE    PIC X(10).                                     
               10  FILLER        PIC X(16) VALUE '-23.59.59.999999'.            
                                                                                
           05  PV-DB2-CURRENT-DATE          PIC X(10).                          
                                                                                
033300     05  PV-ITEM                      PIC S9(4) VALUE ZERO                
033400                                                COMP SYNC.                
033500     05  PV-CICS-RESP                 PIC S9(4) VALUE ZERO                
033600                                                COMP SYNC.                
033700     05  PV-STORE-COUNTER             PIC S9(4) COMP VALUE ZERO.          
033800     05  PV-EFF-CLOSE-DATE            PIC X(10) VALUE SPACES.             
033900     05  PV-SAVE-STR-DISTRO-PK        PIC S9(9) COMP VALUE ZERO.          
034000     05  DK-PO-LNE-NBR                PIC S9(09) COMP VALUE ZERO.         
034100     05  PV-EIBDATE.                                                      
034200         10  PV-EIBDATE-N             PIC 9(5).                           
034300         10  FILLER                   PIC X(5).                           
034400     05  PV-CURRENT-DATE              PIC X(10).                          
034500     05  PV-DB2-START-DATE            PIC X(10).                          
034600     05  PV-DB2-END-DATE              PIC X(10).                          
034700     05  PV-STORE-NUMBER.                                                 
034800         10  PV-STORE-NUMBER-N        PIC 9(4).                           
034900     05  PV-TEMP-AMT                  PIC 9(7)V9(2).                      
035000     05  PV-TEMP-QTY                  PIC 9(4).                           
035100     05  PV-SHIPT-OVRG-PCT            PIC S9(2)V  COMP-3                  
035200                                                     VALUE ZERO.          
035300     05  PV-SHIPT-SHTG-PCT            PIC S9(2)V  COMP-3                  
035400                                                     VALUE ZERO.          
035500     05  PV-RATIO                     PIC S9V9999 COMP-3                  
035600                                                     VALUE ZERO.          
035700     05  PV-PCT-OVR-SHT               PIC S9(4)V99 COMP-3                 
035800                                                     VALUE ZERO.          
035900     05  PV-PCT-OVR-SHT-TEMP          PIC S999    COMP-3                  
036000                                                     VALUE ZERO.          
036100     05  PV-SAVE-VARIANCE             PIC S9(04)V9   COMP                 
036200                                                     VALUE ZERO.          
036300     05  PV-CULPRIT-LNE-NBR           PIC S9(09)     COMP                 
036400                                                     VALUE ZERO.          
036500     05  PV-DIFFERENCE                PIC S9(04)     COMP                 
036600                                                     VALUE ZERO.          
036700 01  PV-COUNTERS.                                                         
036800     05  PV-SUM-STR-OTR-UNITS         PIC S9(9) COMP VALUE ZERO.          
036900     05  PV-SUM-OTR-PACKS             PIC S9(9) COMP VALUE ZERO.          
037000     05  PV-SUM-STR-PLAN-QTY          PIC S9(9) COMP VALUE ZERO.          
037100     05  PV-TOT-ODD-UNITS             PIC S9(9) COMP VALUE ZERO.          
037200     05  PV-PACK-ODD-UNITS            PIC S9(9) COMP VALUE ZERO.          
037300     05  PV-PACK-ODD-UNITS-DOL        PIC S9(4)V99 COMP                   
037400                                                     VALUE ZERO.          
037500     05  PV-TEMP-STORE-COUNT          PIC S9(4) COMP VALUE ZERO.          
037600     05  PV-TRBLS-COUNT               PIC S9(4) COMP VALUE ZERO.          
037700     05  PV-NOTIFS-COUNT              PIC S9(4) COMP VALUE ZERO.          
037800     05  PV-PACK-RTL-PR-AMT           PIC S9(7)V99 COMP-3                 
037900                                                     VALUE ZERO.          
038000     05  PV-RECITM-COUNT              PIC S9(9) COMP VALUE ZERO.          
038100                                                                          
038200     05  PV-PURITM-COUNT              PIC S9(9) COMP VALUE ZERO.          
038300     05  PV-RESULT                    PIC S9(9) COMP VALUE ZERO.          
038400     05  PV-REMAINDER                 PIC S9(9) COMP VALUE ZERO.          
038500                                                                          
038600     05  PV-LINE-COUNT                PIC S9(4) COMP VALUE ZERO.          
038700     05  PV-OVER-COUNT                PIC S9(4) COMP VALUE ZERO.          
038800     05  PV-SHORT-COUNT               PIC S9(4) COMP VALUE ZERO.          
038900     05  PV-EVEN-COUNT                PIC S9(4) COMP VALUE ZERO.          
039000     05  PV-DIFF-LINE-COUNT           PIC S9(4) COMP VALUE ZERO.          
039100     05  PV-TOTAL-UNITS               PIC S9(9) COMP VALUE ZERO.          
039200     05  PV-SUM-BEST-CASE-UNITS       PIC S9(9) COMP VALUE ZERO.          
039300     05  PV-TOT-BEST-CASE-UNITS       PIC S9(9) COMP VALUE ZERO.          
039400     05  PV-TOT-OTR                   PIC S9(9) COMP VALUE ZERO.          
039500     05  PV-NBR-RATIOS-CHGD           PIC S9(4) COMP VALUE ZERO.          
039600/                                                                         
039700 01  PC-PROGRAM-CONSTANTS.                                                
039800     05  PC-MAX-STORES                PIC S9(04) COMP VALUE +200.         
039900     05  PC-RCKCS806                  PIC X(08) VALUE                     
040000                                                'RCKCS806'.               
040100     05  PC-RCKCS809                  PIC X(08) VALUE                     
040200                                                'RCKCS809'.               
040300     05  PC-RCKCS810                  PIC X(08) VALUE                     
040400                                                'RCKCS810'.               
040500     05  PC-RCKCS233                  PIC X(08) VALUE                     
040600                                                'RCKCS233'.               
040700     05  PC-TMKCS521                  PIC X(08) VALUE                     
040800                                                'TMKCS521'.               
040900     05  PC-10                        PIC S9(4) COMP VALUE +10.           
041000     05  PC-100                       PIC S9(4) COMP VALUE +100.          
041100     05  PC-600                       PIC S9(4) COMP VALUE +600.          
041200     05  PC-999                       PIC S9(9) COMP VALUE +999.          
041300     05  PC-99999                     PIC S9(9) COMP VALUE +99999.        
041400                                                                          
           05  PC-FCLTY-ID                  PIC S9(4) COMP VALUE +1.            
                                                                                
           05  PC-WEB-COMPLETE-TEXT.                                            
               10 PC-WEB-LINE-TEXT          PIC X(42) VALUE                     
               'ITEM RECEIVED AND WEB INDICATOR OFF IN VSM'.                    
               10 FILLER                    PIC X(208) VALUE SPACES.            
                                                                                
041500     05  PC-TROUBLE-REASONS.                                              
041600         10 PC-133                    PIC S9(4) COMP VALUE +133.          
041700* RETAIL PRICE DISCREPANCY                                                
041800*        10 PC-134                    PIC S9(4) COMP VALUE +134.          
041900* PENDING PRICE CHANGE                                                    
042000         10 PC-222                    PIC S9(4) COMP VALUE +222.          
042100* NO STORE DISTRIBUTION                                                   
042200         10 PC-225                    PIC S9(4) COMP VALUE +225.          
042300* MISDIRECTED FREIGHT                                                     
042400         10 PC-261                    PIC S9(4) COMP VALUE +261.          
042500* STORE CLOSED                                                            
042600         10 PC-262                    PIC S9(4) COMP VALUE +262.          
042700* STORE NOT OPEN FOR RECEIVING                                            
042800         10 PC-263                    PIC S9(4) COMP VALUE +263.          
042900* UNTIED PREPACK PO LINE                                                  
043000         10 PC-264                    PIC S9(4) COMP VALUE +264.          
043100* INVALID STORE DISTRO                                                    
043200         10 PC-265                    PIC S9(4) COMP VALUE +265.          
043300* PACK DEFINITION ERROR                                                   
043400         10 PC-267                    PIC S9(4) COMP VALUE +267.          
043500* DC BAD PACK                                                             
043600         10 PC-269                    PIC S9(4) COMP VALUE +269.          
043700* ANALYST BAD PACK                                                        
043800         10 PC-271                    PIC S9(4) COMP VALUE +271.          
043900* ANALYST BAD PACK WITHIN TOLERANCE                                       
               10 PC-401                    PIC S9(4) COMP VALUE +401.          
      * ITEM RECEIVED AND WEB INDICATOR OFF IN VSM                              
044000         10 PC-522                    PIC S9(4) COMP VALUE +522.          
044100* LINE CANCELLED                                                          
044200         10 PC-523                    PIC S9(4) COMP VALUE +523.          
044300* LINE COMPLETE                                                           
044400         10 PC-524                    PIC S9(4) COMP VALUE +524.          
044500* LINE CANCELLED BALANCE                                                  
044600         10 PC-528                    PIC S9(4) COMP VALUE +528.          
044700* LINE CANCELLED                                                          
044800         10 PC-529                    PIC S9(4) COMP VALUE +529.          
044900* LINE COMPLETE                                                           
044800         10 PC-534                    PIC S9(4) COMP VALUE +534.          
044900* PO LINE REVISE STATUS                                                   
045000         10 PC-570                    PIC S9(4) COMP VALUE +570.          
045100* PACK SHORT WITHIN                                                       
045200         10 PC-571                    PIC S9(4) COMP VALUE +571.          
045300* PACK SHORT OUTSIDE                                                      
045400         10 PC-573                    PIC S9(4) COMP VALUE +573.          
045500* PACK SHORT APPROVED PRORATE                                             
045600         10 PC-574                    PIC S9(4) COMP VALUE +574.          
045700* PACK SHORT SPECIFIC PLAN                                                
045800         10 PC-575                    PIC S9(4) COMP VALUE +575.          
045900* PACK SHORT WITHIN SPECIFIC                                              
046000         10 PC-576                    PIC S9(4) COMP VALUE +576.          
046100* PACK OVER - CHANGED DISTRO                                              
046200         10 PC-577                    PIC S9(4) COMP VALUE +577.          
046300* PACK OVER - ZERO OTR                                                    
046400         10 PC-579                    PIC S9(4) COMP VALUE +579.          
046500* PACK OVER WITHIN                                                        
046600         10 PC-580                    PIC S9(4) COMP VALUE +580.          
046700* PACK OVER OUTSIDE                                                       
046800         10 PC-581                    PIC S9(4) COMP VALUE +581.          
046900* PICT AD - STR 0 PACKS                                                   
047000         10 PC-582                    PIC S9(4) COMP VALUE +582.          
047100* PACK LINE SHORT W/IN                                                    
047200         10 PC-583                    PIC S9(4) COMP VALUE +583.          
047300* PACK LINE SHORT OUTSIDE                                                 
047400         10 PC-585                    PIC S9(4) COMP VALUE +585.          
047500* PACK LINE SHORT APP PRORATE                                             
047600         10 PC-586                    PIC S9(4) COMP VALUE +586.          
047700* PACK LINE SHORT SPECIFIC                                                
047800         10 PC-587                    PIC S9(4) COMP VALUE +587.          
047900* PACK LINE SHORT W/IN SPECIFIC                                           
048000         10 PC-588                    PIC S9(4) COMP VALUE +588.          
048100* PACK LINE OVER - CHANGED DISTRO                                         
048200         10 PC-589                    PIC S9(4) COMP VALUE +589.          
048300* PACK LINE OVER - 0 OTR                                                  
048400         10 PC-591                    PIC S9(4) COMP VALUE +591.          
048500* PACK LINE OVER W/IN                                                     
048600         10 PC-592                    PIC S9(4) COMP VALUE +592.          
048700* PACK LINE OVER OUTSIDE                                                  
048800         10 PC-593                    PIC S9(4) COMP VALUE +593.          
048900* PACK LINE SHORT PIC AD                                                  
049000                                                                          
049100/                                                                         
049200 01  PC-MESSAGE-TEXTS.                                                    
049300     05  PC-LINE-COMPLETE-TEXT.                                           
049400         10  PC-LINE-COMP-TEXT-1.                                         
049500             15  PC-LC-TEXT-1         PIC X(25) VALUE                     
049600             '         UNITS RECEIVED: '.                                 
049700             15  PC-LC-RCVD           PIC ZZZZZZZZ9.                      
049800         10  FILLER                   PIC X(216) VALUE SPACES.            
049900                                                                          
050000     05  PC-LINE-UNTIED-TEXT.                                             
050100         10  PC-LINE-UNTIE-TEXT-1.                                        
050200             15  PC-UT-TEXT-1         PIC X(25) VALUE                     
050300             '         UNITS RECEIVED: '.                                 
050400             15  PC-UT-RCVD           PIC ZZZZZZZZ9.                      
050500         10  FILLER                   PIC X(216) VALUE SPACES.            
050600                                                                          
050700     05  PC-PRICE-DISC-TEXT.                                              
050800         10  PC-PRICE-DISC-TEXT-1.                                        
050900             15  PC-PD-TEXT-1         PIC X(15) VALUE                     
051000             'PO UNIT RTL  : '.                                           
051100             15  PC-PD-PO-UNT-RTL     PIC ZZZZZZ9.99.                     
051200             15  PC-PD-TEXT-2         PIC X(15) VALUE                     
051300             ' SKU UNIT RTL: '.                                           
051400             15  PC-PD-SKU-UNT-RTL    PIC ZZZZZZ9.99.                     
051500         10  PC-PRICE-DISC-TEXT-2.                                        
051600             15  PC-PD-TEXT-5         PIC X(21) VALUE                     
051700             'PO GRP QTY   :       '.                                     
051800             15  PC-PD-PO-GP-QTY      PIC ZZZ9.                           
051900             15  PC-PD-TEXT-6         PIC X(21) VALUE                     
052000             ' SKU GRP QTY :       '.                                     
052100             15  PC-PD-SKU-GP-QTY     PIC ZZZ9.                           
052200         10  PC-PRICE-DISC-TEXT-3.                                        
052300             15  PC-PD-TEXT-3         PIC X(15) VALUE                     
052400             'PO GRP RTL   : '.                                           
052500             15  PC-PD-PO-GP-RTL      PIC ZZZZZZ9.99.                     
052600             15  PC-PD-TEXT-4         PIC X(15) VALUE                     
052700             ' SKU GRP RTL : '.                                           
052800             15  PC-PD-SKU-GP-RTL     PIC ZZZZZZ9.99.                     
052900                                                                          
055200                                                                          
055300     05  PC-MASTER-SPECIFIC-TEXT.                                         
055400         10  FILLER                   PIC X(50) VALUE                     
055500             'UNMATCHED SPECIFIC PLAN.   MASTER PLAN USED.'.              
055600         10  FILLER.                                                      
055700             15  FILLER               PIC X(25) VALUE                     
055800             '      SPECIFIC PLAN QTY: '.                                 
055900             15  PC-OS-SPECIFIC-QTY   PIC ZZZZZZZZ9.                      
056000             15  FILLER               PIC X(16) VALUE SPACES.             
056100         10  FILLER.                                                      
056200             15  FILLER               PIC X(25) VALUE                     
056300             '         UNITS RECEIVED: '.                                 
056400             15  PC-OS-MS-RCVD        PIC ZZZZZZZZ9.                      
056500             15  FILLER               PIC X(16) VALUE SPACES.             
056600         10  FILLER.                                                      
056700             15  FILLER               PIC X(25) VALUE                     
056800             '  UNITS OPEN-TO-RECEIVE: '.                                 
056900             15  PC-OS-MS-OTR         PIC ZZZZZZZZ9.                      
057000             15  FILLER               PIC X(16) VALUE SPACES.             
057100         10  FILLER.                                                      
057200             15  FILLER               PIC X(18) VALUE                     
057300             '            UNITS '.                                        
057400             15  PC-OS-MS-TEXT        PIC X(05).                          
057500             15  FILLER               PIC X(02) VALUE                     
057600                                    ': '.                                 
057700             15  PC-OS-MS-DIFF        PIC ZZZZZZZZ9.                      
057800             15  FILLER               PIC X(16) VALUE SPACES.             
057900                                                                          
058000 01  PC-PREPACK-TEXTS.                                                    
058100     05  PC-ZERO-BEST-CASE-TEXT.                                          
058200         10  PC-ZERO-BEST-CASE-LINE-1.                                    
058300             15 FILLER                PIC X(9) VALUE                      
058400             'PACK ID: '.                                                 
058500             15  PV-ZBC-PACK-ID       PIC 9(4) VALUE ZERO.                
058600             15  FILLER               PIC X(37) VALUE SPACES.             
058700         10  PC-ZERO-BEST-CASE-LINE-2.                                    
058800             15 FILLER                PIC X(20) VALUE                     
058900             'ZERO BEST CASE UNITS'.                                      
059000             15  FILLER               PIC X(30) VALUE SPACES.             
059100                                                                          
059200     05  PC-BAD-STORE-PLAN-TEXT.                                          
059300         10  PC-BAD-STORE-PLAN-LINE-1.                                    
059400             15 FILLER                PIC X(9) VALUE                      
059500             'PACK ID: '.                                                 
059600             15  PV-BSP-PACK-ID       PIC 9(4) VALUE ZERO.                
059700             15  FILLER               PIC X(37) VALUE SPACES.             
059800         10  PC-BAD-STORE-PLAN-LINE-2.                                    
059900             15 FILLER                PIC X(25) VALUE                     
060000             'INVALID PACK STORE DISTRO'.                                 
060100             15  FILLER               PIC X(25) VALUE SPACES.             
060200         10  PC-BAD-STORE-PLAN-LINE-3.                                    
060300             15 FILLER                PIC X(30) VALUE                     
060400             'CHECK PO PACKS AND REALLOCATE '.                            
060500             15  FILLER               PIC X(20) VALUE SPACES.             
060600         10  PC-BAD-STORE-PLAN-LINE-4.                                    
060700             15 FILLER                PIC X(50) VALUE SPACES.             
060800                                                                          
060900     05  PC-BAD-STORE-CNSTR-TEXT.                                         
061000         10  PC-BAD-STORE-CNSTR-LINE-1.                                   
061100             15 FILLER                PIC X(9) VALUE                      
061200             'PACK ID: '.                                                 
061300             15  PV-BSC-PACK-ID       PIC 9(4) VALUE ZERO.                
061400             15  FILLER               PIC X(37) VALUE SPACES.             
061500         10  PC-BAD-STORE-CNSTR-LINE-2.                                   
061600             15 FILLER                PIC X(40) VALUE                     
061700             'INVALID STORE CONSTRAINTS PER PACK RATIO'.                  
061800             15  FILLER               PIC X(10) VALUE SPACES.             
061900         10  PC-BAD-STORE-CNSTR-LINE-3.                                   
062000             15 FILLER                PIC X(30) VALUE                     
062100             'STORE VALID BUT OUT OF RATIO  '.                            
062200             15  FILLER               PIC X(20) VALUE SPACES.             
062300/                                                                         
062400 01  PC-STORE-TEXTS.                                                      
062500     05  PC-STR-CLS-TEXT.                                                 
062600         10  PC-STORE-TEXT            PIC X(13) VALUE                     
062700         'STORE NUMBER '.                                                 
062800         10  PC-STORE-NUMBER          PIC X(04).                          
062900         10  FILLER                   PIC X(07) VALUE                     
063000         ' CLOSED'.                                                       
063100         10  FILLER                   PIC X(226) VALUE SPACES.            
063200     05  PC-STR-NOT-RCVG-TEXT.                                            
063300         10  PC-STR-TEXT              PIC X(13) VALUE                     
063400         'STORE NUMBER '.                                                 
063500         10  PC-STR-NO                PIC X(04).                          
063600         10  FILLER                   PIC X(23) VALUE                     
063700         ' NOT OPEN FOR RECEIVING'.                                       
063800         10  FILLER                   PIC X(210) VALUE SPACES.            
064000/                                                                         
064100     COPY RCWS806.                                                        
064200/                                                                         
064300     COPY RCWS808.                                                        
064400/                                                                         
064500     COPY RCWS809.                                                        
064600/                                                                         
064700     COPY RCWS810.                                                        
064800/                                                                         
064900     COPY TMWS500.                                                        
065000/                                                                         
065100     COPY DPWS500.                                                        
065200/                                                                         
065300     COPY RCWS001.                                                        
065400/                                                                         
      ******** LOGISTICS DOMAIN ITEM ACCESS COPYBOOK                            
           COPY XLWS001.                                                        
065400/                                                                         
065500     EXEC SQL                                                             
065600          INCLUDE SQLCA                                                   
065700     END-EXEC.                                                            
065800/                                                                         
065900     EXEC SQL                                                             
066000          INCLUDE TPURITM                                                 
066100     END-EXEC.                                                            
066200/                                                                         
066300     EXEC SQL                                                             
066400          INCLUDE TALLPLN                                                 
066500     END-EXEC.                                                            
066600/                                                                         
066700     EXEC SQL                                                             
066800          INCLUDE TMESTDS                                                 
066900     END-EXEC.                                                            
067000/                                                                         
067500     EXEC SQL                                                             
067600          INCLUDE TCOCNTL                                                 
067700     END-EXEC.                                                            
067800/                                                                         
007100******************************************************************        
007200* DCLGEN OF XLT_LOC                                                       
007300******************************************************************        
007900*                                                                         
008000     EXEC SQL                                                             
008100         INCLUDE XLT00010                                                 
008200     END-EXEC.                                                            
007100******************************************************************        
007200* DCLGEN OF XLT_DC_LOC_ASGMT                                              
007300******************************************************************        
007900*                                                                         
008000     EXEC SQL                                                             
008100         INCLUDE XLT00014                                                 
008200     END-EXEC.                                                            
069100     EXEC SQL                                                             
069200          INCLUDE TTRBNTF                                                 
069300     END-EXEC.                                                            
069400/                                                                         
069500     EXEC SQL                                                             
069600          INCLUDE TRECITM                                                 
069700     END-EXEC.                                                            
069400/                                                                         
143300     EXEC SQL                                                             
143400         DECLARE STORE-CSR  CURSOR FOR                                    
143500             SELECT A.LOC_NBR                                             
143600                  , A.LOC_TYP_CDE                                         
016100                  , A.CLO_DTE                                             
016100                  , A.CLO_DTE -                                           
016100                            COALESCE(A.STP_ORD_DAYS_QTY,0) DAYS           
016100                            AS EFF_STOP_DATE                              
052000                  , B.EFF_BEG_DTE                                         
052200                  , B.DC_NBR                                              
W38216                  , A.E_BUS_IND                                           
144300               FROM XLT_LOC A                                             
                        , XLT_DC_LOC_ASGMT B                                    
144500              WHERE A.LOC_TYP_CDE IN ('DC', 'DS', 'CS', 'RV')             
052800                AND B.LOC_NBR     = A.LOC_NBR                             
052900                AND B.EFF_BEG_DTE =                                       
053000                (SELECT MAX(C.EFF_BEG_DTE)                                
053100                   FROM XLT_DC_LOC_ASGMT C                                
053200                  WHERE C.LOC_NBR = A.LOC_NBR                             
053210                    AND DATE(EFF_BEG_DTE) <= CURRENT DATE)                
073500             ORDER BY LOC_TYP_CDE                                         
008200     END-EXEC.                                                            
073700/                                                                         
073800 LINKAGE SECTION.                                                         
073900                                                                          
074000 01  DFHCOMMAREA.                                                         
074100     05  FILLER                       OCCURS 1 TO 4072 TIMES              
074200                                      DEPENDING ON EIBCALEN.              
074300         10  FILLER                   PIC X.                              
074400                                                                          
074500                                                                          
074600 PROCEDURE DIVISION.                                                      
074700                                                                          
074800 0000-MAIN-MODULE.                                                        
074900                                                                          
075000     PERFORM 1000-INITIAL-PROCESS.                                        
075100                                                                          
075200     IF PS-NOT-DONE                                                       
075300         PERFORM 2000-LINE-TROUBLES                                       
075400             VARYING RC808-LINE-IDX  FROM 1 BY 1                          
075500             UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT                 
075600             OR PS-DONE                                                   
075700     END-IF.                                                              
075800                                                                          
075900     IF PS-NOT-DONE                                                       
076000         PERFORM 2300-TEST-PACK-ID                                        
076100             VARYING RC808-LINE-IDX  FROM 1 BY 1                          
076200             UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT                 
076300             OR PS-DONE                                                   
076400     END-IF.                                                              
076500                                                                          
076600     IF PS-NOT-DONE AND PS-DO-ALLOC                                       
076700         PERFORM 2500-ODD-UNITS                                           
076800             VARYING RC808-LINE-IDX  FROM 1 BY 1                          
076900             UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT                 
077000             OR PS-DONE                                                   
077100         PERFORM 2520-CHECK-TOLERANCES                                    
077200     END-IF                                                               
077300                                                                          
077400     IF PS-NOT-DONE AND PS-DO-ALLOC                                       
077500         PERFORM 2600-UNITS-OVER-SHORT                                    
077600             VARYING RC808-LINE-IDX  FROM 1 BY 1                          
077700             UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT                 
077800             OR PS-DONE                                                   
077900     END-IF.                                                              
078000                                                                          
078100*RPM DO THE FOLLOWING REGARDLESS OF PS-DO-ALLOC                           
078200* 02/02/00  THESE EDITS DO NOT APPLY TO UNTIED LINES  DRS                 
078300     IF PS-NOT-DONE AND RC809-PREPK-ID NOT = 99                           
078400         PERFORM 0010-TEST-LINE-SWITCHES                                  
078500         PERFORM 0020-PACK-OVER-SHORT                                     
078600         PERFORM 0030-CHECK-RATIOS                                        
078700         SET PS-DIFFERENT-VARIANCES-NO                                    
078800                                      TO TRUE                             
078900* 2/14                                                                    
079000         PERFORM 4010-VERIFY-PACK                                         
079100* 2/14                                                                    
079200                                                                          
079300         PERFORM 0040-CHECK-VARIANCES                                     
079400             VARYING PT-TRB-IDX FROM 1 BY 1                               
079500             UNTIL PT-TRB-LINE-NBR (PT-TRB-IDX) = ZERO                    
079600                                                                          
079700         MOVE ZERO                    TO PV-TOT-ODD-UNITS                 
079800         PERFORM 0050-CHECK-ODD-UNITS                                     
079900             VARYING PT-TRB-IDX FROM 1 BY 1                               
080000             UNTIL PT-TRB-LINE-NBR (PT-TRB-IDX) = ZERO                    
080100                                                                          
080200     END-IF.                                                              
080300                                                                          
080400     IF PS-NOT-DONE AND PS-DO-ALLOC                                       
080500         PERFORM 0100-RECITM-VS-PURITM                                    
080600     END-IF                                                               
080700                                                                          
080800                                                                          
080900     IF PS-NOT-DONE AND PS-DO-ALLOC                                       
081000         PERFORM 3000-STORE-TROUBLE                                       
081100     END-IF                                                               
081200                                                                          
081300     IF PS-INVALID-STR-PLAN                                               
081400         SET PS-DONT-DO-ALLOC         TO TRUE                             
081500     END-IF                                                               
081600                                                                          
081700     IF PS-NOT-DONE AND PS-DO-ALLOC                                       
081800         IF PV-DIFF-LINE-COUNT NOT > PC-MISSING-LINES-TOL AND             
081900                 PV-PACK-ODD-UNITS = ZERO   AND                           
082000                 PV-NBR-RATIOS-CHGD = ZERO                                
082100             PERFORM 4000-PACK-TROUBLE                                    
082200         ELSE                                                             
082300             PERFORM 0200-BEST-CASE-OVER-SHORT                            
082400             PERFORM 4900-DC-BAD-PACK                                     
082500         END-IF                                                           
082600     END-IF                                                               
082700                                                                          
082800     IF RC809-PREPACK-EDIT-ONLY AND RC809-DIDNT-ALLOC-DUE-TO-TRBL         
082900         MOVE ZERO                    TO RC809-RETURN-CODE                
083000     END-IF                                                               
083100                                                                          
083200     IF RC809-PREPACK-EDIT-ONLY OR RC809-PREPACK-ERROR-NBR > ZERO         
083300         PERFORM 8150-DELETE-TEMP-QUEUE                                   
083400     ELSE                                                                 
083500         IF PS-NOT-DONE AND PS-DO-ALLOC AND RC809-CREATE-AUTO             
083600             PERFORM 8500-CALL-DISTRO-ROUTINE                             
083700         END-IF                                                           
083800     END-IF.                                                              
083900                                                                          
084000     PERFORM 0000-GOBACK.                                                 
084100 0000-GOBACK.                                                             
084200     MOVE RC809-COMMAREA              TO DFHCOMMAREA.                     
084300     GOBACK.                                                              
084400/                                                                         
084500 0010-TEST-LINE-SWITCHES.                                                 
084600                                                                          
084700     MOVE ZERO                        TO                                  
084800                                 RC809-LINES-IN-TRBL-COUNT                
084900                                                                          
085000     PERFORM VARYING PT-TRB-IDX FROM 1 BY 1                               
085100             UNTIL PT-TRB-LINE-NBR (PT-TRB-IDX) = ZERO                    
085200                                                                          
085300     IF PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                                
085400         ADD 1                        TO                                  
085500                                 RC809-LINES-IN-TRBL-COUNT                
085600     END-IF                                                               
085700                                                                          
085800     IF PV-PACK-RTL-PR-AMT > COCNTL-PREPK-ODU-TOL-AMT                     
085900         SET PS-PACK-ODD-UNITS-YES    TO TRUE                             
086000     END-IF                                                               
086100                                                                          
086200     EVALUATE TRUE                                                        
086300     WHEN (PT-LINE-OVER-WITHIN-YES (PT-TRB-IDX)     OR                    
086400         PT-LINE-OVER-OUTSIDE-YES (PT-TRB-IDX)      OR                    
086500         PT-LINE-OVER-CHGD-DISTRO-YES (PT-TRB-IDX)  OR                    
086600         PT-LINE-ZERO-OTR-YES (PT-TRB-IDX) )                              
086700             ADD 1                    TO PV-OVER-COUNT                    
086800                                                                          
086900     WHEN                                                                 
087000          PT-LINE-SHRT-WITHIN-YES (PT-TRB-IDX)       OR                   
087100          PT-LINE-SHRT-OUTSIDE-YES (PT-TRB-IDX)      OR                   
087200          PT-LINE-SHRT-SPECIFIC-YES (PT-TRB-IDX)     OR                   
087300          PT-LINE-SHRT-APPR-YES (PT-TRB-IDX)         OR                   
087400          PT-LINE-SHRT-PIC-AD-YES (PT-TRB-IDX)                            
087500             ADD 1                    TO PV-SHORT-COUNT                   
087600     WHEN OTHER                                                           
087700             ADD 1                    TO PV-EVEN-COUNT                    
087800     END-EVALUATE                                                         
087900                                                                          
088000     END-PERFORM.                                                         
088100                                                                          
088200     EVALUATE TRUE                                                        
088300         WHEN PV-OVER-COUNT = ZERO AND                                    
088400                        PV-SHORT-COUNT = ZERO                             
088500             CONTINUE                                                     
088600         WHEN PV-OVER-COUNT > ZERO AND                                    
088700              PV-SHORT-COUNT > ZERO                                       
088800             SET PS-PACK-OVER-UNDER-YES                                   
088900                                      TO TRUE                             
089000         WHEN PV-OVER-COUNT > ZERO                                        
089100                 AND PV-OVER-COUNT = PV-LINE-COUNT                        
089200             SET PS-PACK-OVER-YES     TO TRUE                             
089300         WHEN PV-SHORT-COUNT = PV-LINE-COUNT                              
089400             SET PS-PACK-UNDER-YES    TO TRUE                             
089500     END-EVALUATE.                                                        
089600/                                                                         
089700 0020-PACK-OVER-SHORT.                                                    
089800     PERFORM                                                              
089900         VARYING RC808-LINE-IDX  FROM 1 BY 1                              
090000         UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT                     
090100             OR PS-DONE                                                   
090200         ADD RC808-BEST-CASE-UNITS(RC808-LINE-IDX)                        
090300                                      TO PV-TOT-BEST-CASE-UNITS           
090400         IF RC808-LNE-OTR-QTY (RC808-LINE-IDX) > ZERO                     
090500             ADD RC808-LNE-OTR-QTY (RC808-LINE-IDX)                       
090600                                      TO PV-TOT-OTR                       
090700         END-IF                                                           
090800     END-PERFORM.                                                         
090900                                                                          
091000     EVALUATE TRUE                                                        
091100         WHEN PV-TOT-BEST-CASE-UNITS > PV-TOT-OTR                         
091200             SET PS-PACK-OVER-YES     TO TRUE                             
091300         WHEN PV-TOT-BEST-CASE-UNITS < PV-TOT-OTR                         
091400             SET PS-PACK-UNDER-YES    TO TRUE                             
091500     END-EVALUATE.                                                        
091600/                                                                         
091700 0030-CHECK-RATIOS.                                                       
091800     PERFORM                                                              
091900         VARYING RC808-LINE-IDX  FROM 1 BY 1                              
092000         UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT OR PS-DONE          
092100                                                                          
092200         IF RC808-RECITM-RATO-QTY (RC808-LINE-IDX) >                      
092300                       RC808-PURITM-RATO-QTY (RC808-LINE-IDX)             
092400             SUBTRACT  RC808-PURITM-RATO-QTY (RC808-LINE-IDX)             
092500             FROM RC808-RECITM-RATO-QTY (RC808-LINE-IDX)                  
092600             GIVING PV-DIFFERENCE                                         
092700         ELSE                                                             
092800             SUBTRACT RC808-RECITM-RATO-QTY (RC808-LINE-IDX)              
092900             FROM RC808-PURITM-RATO-QTY (RC808-LINE-IDX)                  
093000             GIVING PV-DIFFERENCE                                         
093100         END-IF                                                           
093200                                                                          
093300         IF PV-DIFFERENCE > ZERO                                          
093400             ADD 1                    TO PV-NBR-RATIOS-CHGD               
093500             MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                     
093600                                      TO PV-CULPRIT-LNE-NBR               
093700                                                                          
093800             IF RC808-RECITM-RATO-QTY (RC808-LINE-IDX) > ZERO             
093900                 AND                                                      
094000                 PV-DIFFERENCE NOT > PC-RATIO-OFF-PER-MEMB-TOL            
094100                 SET PT-TRBL-SELECTED (4, 2)                              
094200                                      TO TRUE                             
094300             ELSE                                                         
094400                 SET PT-TRBL-SELECTED (4, 1)                              
094500                                      TO TRUE                             
094600             END-IF                                                       
094700                                                                          
094800         END-IF                                                           
094900     END-PERFORM.                                                         
095000                                                                          
095100     IF PV-NBR-RATIOS-CHGD > PC-MEMBER-OFF-TOL                            
095200         SET PT-TRBL-SELECTED (4, 1)  TO TRUE                             
095300     END-IF.                                                              
095400/                                                                         
095500 0040-CHECK-VARIANCES.                                                    
095600     IF PT-TRB-IDX = 1                                                    
095700         MOVE PT-LINE-PCT-VARIANCE (PT-TRB-IDX)                           
095800                                      TO PV-SAVE-VARIANCE                 
095900     END-IF.                                                              
096000                                                                          
096100     IF PT-LINE-PCT-VARIANCE (PT-TRB-IDX) = PV-SAVE-VARIANCE              
096200         CONTINUE                                                         
096300     ELSE                                                                 
096400         SET PS-DIFFERENT-VARIANCES-YES                                   
096500                                      TO TRUE                             
096600     END-IF.                                                              
096700                                                                          
096800 0050-CHECK-ODD-UNITS.                                                    
096900     ADD PT-LINE-ODD-UNITS (PT-TRB-IDX)                                   
097000                                      TO PV-TOT-ODD-UNITS.                
097100/                                                                         
097200 0100-RECITM-VS-PURITM.                                                   
097300                                                                          
097400     PERFORM 7550-COUNT-PURITM-LINES                                      
097500     PERFORM 7600-COUNT-RECITM-LINES                                      
097600     IF PV-PURITM-COUNT > PV-RECITM-COUNT                                 
097700      OR PV-PURITM-COUNT = 0                                              
097800         COMPUTE PV-DIFF-LINE-COUNT = PV-PURITM-COUNT                     
097900                                    - PV-RECITM-COUNT                     
098000         IF PV-DIFF-LINE-COUNT > PC-MISSING-LINES-TOL                     
098100             SET PT-TRBL-SELECTED (3, 1)                                  
098200                                      TO TRUE                             
098300             SET  PS-DC-BAD-PACK                                          
098400                                      TO TRUE                             
098500         END-IF                                                           
098600     END-IF.                                                              
098700/                                                                         
098800 0200-BEST-CASE-OVER-SHORT.                                               
098900                                                                          
099000     SET RC808-LINE-IDX               TO RC809-DRIVER-LNE-PTR             
099100     MOVE RC808-BEST-CASE-UNITS(RC808-LINE-IDX)                           
099200                                      TO PV-TOTAL-UNITS                   
099300                                                                          
099400     MOVE RC808-LNE-OTR-PACK-QTY(RC809-DRIVER-LNE-PTR)                    
099500                                      TO PV-SUM-STR-OTR-UNITS             
099600                                                                          
099700     DIVIDE RC808-RECITM-RATO-QTY (RC808-LINE-IDX)                        
099800               INTO PV-TOTAL-UNITS                                        
099900                                                                          
100000     EVALUATE TRUE                                                        
100100         WHEN PV-TOTAL-UNITS        = PV-SUM-STR-OTR-UNITS                
100200             PERFORM VARYING PT-TRB-IDX FROM 1 BY 1                       
100300                 UNTIL PT-TRB-LINE-NBR (PT-TRB-IDX) = ZERO                
100400                IF PT-LINE-OVER-OUTSIDE-YES     (PT-TRB-IDX) OR           
100500                   PT-LINE-OVER-CHGD-DISTRO-YES (PT-TRB-IDX) OR           
100600                   PT-LINE-ZERO-OTR-YES         (PT-TRB-IDX) OR           
100700                   PT-LINE-SHRT-OUTSIDE-YES     (PT-TRB-IDX) OR           
100800                   PT-LINE-SHRT-SPECIFIC-YES    (PT-TRB-IDX) OR           
100900                   PT-LINE-SHRT-PIC-AD-YES      (PT-TRB-IDX)              
101000*               (BEST CASE OUTSIDE)                                       
101100                      SET PT-TRBL-SELECTED (2, 1)                         
101200                                      TO TRUE                             
101300                 END-IF                                                   
101400             END-PERFORM                                                  
101500                                                                          
101600         WHEN PV-TOTAL-UNITS        > PV-SUM-STR-OTR-UNITS                
101700             PERFORM 0110-OVERAGE-TROUBLE                                 
101800         WHEN PV-TOTAL-UNITS        < PV-SUM-STR-OTR-UNITS                
101900                  PERFORM 0120-SHORTAGE-TROUBLE                           
102000                                                                          
102100     END-EVALUATE.                                                        
102200                                                                          
102300     IF PT-TRBL-SELECTED (2, 3)                                           
102400*        (BEST CASE WITHIN)                                               
102500         PERFORM VARYING PT-TRB-IDX FROM 1 BY 1                           
102600                 UNTIL PT-TRB-LINE-NBR (PT-TRB-IDX) = ZERO                
102700         IF PT-LINE-OVER-OUTSIDE-YES     (PT-TRB-IDX) OR                  
102800            PT-LINE-OVER-CHGD-DISTRO-YES (PT-TRB-IDX) OR                  
102900            PT-LINE-ZERO-OTR-YES         (PT-TRB-IDX) OR                  
103000            PT-LINE-SHRT-OUTSIDE-YES     (PT-TRB-IDX) OR                  
103100            PT-LINE-SHRT-SPECIFIC-YES    (PT-TRB-IDX) OR                  
103200            PT-LINE-SHRT-PIC-AD-YES      (PT-TRB-IDX)                     
103300*               (BEST CASE OUTSIDE)                                       
103400                 SET PT-TRBL-SELECTED (2, 1)                              
103500                                      TO TRUE                             
103600         END-IF                                                           
103700         END-PERFORM                                                      
103800     END-IF.                                                              
103900                                                                          
104000 0110-OVERAGE-TROUBLE.                                                    
104100******************************************************************        
104200*    THIS PARAGRAPH SETS THE SWITCHES FOR OVERAGE TROUBLES.               
104300******************************************************************        
104400                                                                          
104500     SET PS-OVER          TO TRUE                                         
104600                                                                          
104700     COMPUTE PV-DIFFERENCE =                                              
104800        ((PV-TOTAL-UNITS - PV-SUM-STR-OTR-UNITS) /                        
104900               PV-SUM-STR-OTR-UNITS)                                      
105000     ON SIZE ERROR                                                        
105100         COMPUTE PV-PCT-OVR-SHT ROUNDED = PC-99999 / PC-100               
105200         MOVE PC-999 TO RC809-OVER-SHORT-PCT                              
105300                                                                          
105400     NOT ON SIZE ERROR                                                    
105500                                                                          
105600     IF PV-DIFFERENCE < PC-10                                             
105700                                                                          
105800         COMPUTE PV-RATIO ROUNDED =                                       
105900             (PV-TOTAL-UNITS - PV-SUM-STR-OTR-UNITS) /                    
106000             PV-SUM-STR-OTR-UNITS                                         
106100         COMPUTE PV-PCT-OVR-SHT ROUNDED = PV-RATIO * PC-100               
106200         MOVE PV-PCT-OVR-SHT TO PV-PCT-OVR-SHT-TEMP                       
106300                                                                          
106400         IF PV-PCT-OVR-SHT > PV-PCT-OVR-SHT-TEMP                          
106500             COMPUTE RC809-OVER-SHORT-PCT =                               
106600                 PV-PCT-OVR-SHT-TEMP + 1                                  
106700         ELSE                                                             
106800             MOVE PV-PCT-OVR-SHT-TEMP TO RC809-OVER-SHORT-PCT             
106900         END-IF                                                           
107000     ELSE                                                                 
107100         COMPUTE PV-PCT-OVR-SHT ROUNDED = PC-99999 / PC-100               
107200         MOVE PC-999 TO RC809-OVER-SHORT-PCT                              
107300     END-IF                                                               
107400                                                                          
107500     END-COMPUTE                                                          
107600                                                                          
107700*    IF RC809-NEW-STR-PO                                                  
107800*        IF RC809-OVER-SHORT-PCT > PC-BEST-CASE-OVER-NEW-STR-TOL          
107900*            SET PT-TRBL-SELECTED (2, 1)                                  
108000*                                     TO TRUE                             
108100*        ELSE                                                             
108200*            SET PT-TRBL-SELECTED (2, 3)                                  
108300*                                     TO TRUE                             
108400*    ELSE                                                                 
108500*        IF RC809-OVER-SHORT-PCT > PC-BEST-CASE-OVER-OLD-STR-TOL          
108600*            SET PT-TRBL-SELECTED (2, 1)                                  
108700*                                     TO TRUE                             
108800*        ELSE                                                             
108900*            SET PT-TRBL-SELECTED (2, 3)                                  
109000*                                     TO TRUE                             
109100*        END-IF                                                           
109200*    END-IF.                                                              
109300                                                                          
109400     IF RC809-OVER-SHORT-PCT > PV-SHIPT-OVRG-PCT                          
109500         SET PT-TRBL-SELECTED (2, 1)                                      
109600                                      TO TRUE                             
109700     ELSE                                                                 
109800         SET PT-TRBL-SELECTED (2, 3)                                      
109900                                      TO TRUE                             
110000     END-IF                                                               
110100                                                                          
110200     MOVE 'OVER '                     TO PV-BPG-OVER-SHORT.               
110300                                                                          
110400 0120-SHORTAGE-TROUBLE.                                                   
110500******************************************************************        
110600*    THIS PARAGRAPH SETS THE SWITCHES FOR SHORTAGE TROUBLES.              
110700******************************************************************        
110800                                                                          
110900     SET PS-SHORT         TO TRUE.                                        
111000                                                                          
111100     IF ((PV-SUM-STR-OTR-UNITS - PV-TOTAL-UNITS) /                        
111200        PV-SUM-STR-OTR-UNITS) < PC-10                                     
111300         COMPUTE PV-RATIO ROUNDED =                                       
111400             (PV-SUM-STR-OTR-UNITS - PV-TOTAL-UNITS) /                    
111500             PV-SUM-STR-OTR-UNITS                                         
111600                                                                          
111700         COMPUTE PV-PCT-OVR-SHT ROUNDED = PV-RATIO * PC-100               
111800                                                                          
111900         MOVE PV-PCT-OVR-SHT TO PV-PCT-OVR-SHT-TEMP                       
112000                                                                          
112100         IF PV-PCT-OVR-SHT > PV-PCT-OVR-SHT-TEMP                          
112200             COMPUTE RC809-OVER-SHORT-PCT =                               
112300                 PV-PCT-OVR-SHT-TEMP + 1                                  
112400         ELSE                                                             
112500             MOVE PV-PCT-OVR-SHT-TEMP TO RC809-OVER-SHORT-PCT             
112600         END-IF                                                           
112700     ELSE                                                                 
112800         COMPUTE PV-PCT-OVR-SHT ROUNDED = PC-99999 / PC-100               
112900         MOVE PC-999 TO RC809-OVER-SHORT-PCT                              
113000     END-IF.                                                              
113100                                                                          
113200*    IF RC809-NEW-STR-PO                                                  
113300*        IF RC809-OVER-SHORT-PCT > PC-BEST-CASE-SHRT-NEW-STR-TOL          
113400*            SET PT-TRBL-SELECTED (2, 1)                                  
113500*                                     TO TRUE                             
113600*        ELSE                                                             
113700*            SET PT-TRBL-SELECTED (2, 3)                                  
113800*                                     TO TRUE                             
113900*    ELSE                                                                 
114000*        IF RC809-OVER-SHORT-PCT > PC-BEST-CASE-SHRT-OLD-STR-TOL          
114100*            SET PT-TRBL-SELECTED (2, 1)                                  
114200*                                     TO TRUE                             
114300*        ELSE                                                             
114400*            SET PT-TRBL-SELECTED (2, 3)                                  
114500*                                     TO TRUE                             
114600*        END-IF                                                           
114700*    END-IF.                                                              
114800                                                                          
114900     IF RC809-OVER-SHORT-PCT > PV-SHIPT-SHTG-PCT                          
115000         SET PT-TRBL-SELECTED (2, 1)  TO TRUE                             
115100     ELSE                                                                 
115200         SET PT-TRBL-SELECTED (2, 3)  TO TRUE                             
115300     END-IF                                                               
115400                                                                          
115500* IF WE ARE SHORT OUTSIDE LIMITS AND A PICTURED AD, THEN                  
115600* TURN ON THE PIC AD TRBL                                                 
115700* (BEST CASE OUTSIDE AND PICTURED AD)                                     
115800     IF PT-TRBL-SELECTED (2, 1) AND RC809-AD-YES                          
115900         SET PT-TRBL-SELECTED (2, 2)  TO TRUE                             
116000     END-IF                                                               
116100                                                                          
116200     MOVE 'SHORT'                     TO PV-BPG-OVER-SHORT.               
116300/                                                                         
116400 1000-INITIAL-PROCESS.                                                    
116500                                                                          
                                                                                
116600     INITIALIZE RC808-PACK-CONTENTS                                       
116700                RC809-COMMAREA                                            
116800                PT-TROUBLE-TABLE                                          
116900                PS-PACK-LEVEL-SWITCHES                                    
117000                PT-ITEM-INFO-TABLE                                        
117100                                                                          
117200     IF EIBCALEN = ZERO                                                   
117300         SET PS-DONE                  TO TRUE                             
117400         MOVE 809                     TO RC809-PREPACK-PGM-NBR            
117500         MOVE 42                      TO RC809-PREPACK-ERROR-NBR          
117600         PERFORM RC001-RETURN-MSG                                         
117700     ELSE                                                                 
117800         SET  PS-NO-TALLPLN-DISTRO                                        
117900              PS-NO-TMESTDS-DISTRO                                        
118000              PS-DO-ALLOC             TO TRUE                             
118100*             PS-NO-DISCREPANCY       TO TRUE                             
118200         MOVE DFHCOMMAREA             TO RC809-COMMAREA                   
118300         MOVE 809                     TO RC809-PREPACK-PGM-NBR            
118400                                                                          
118500         PERFORM 8100-READ-TEMP-STORAGE                                   
118600             VARYING PV-ITEM FROM 1 BY 1                                  
118700             UNTIL PV-ITEM > RC809-QUEUE-REC-COUNT                        
118800                   OR PS-DONE                                             
118900     END-IF.                                                              
119000                                                                          
119100     IF PS-NOT-DONE                                                       
119200       PERFORM VARYING RC808-LINE-IDX                                     
119300         FROM 1 BY 1 UNTIL                                                
119400                   RC808-LINE-IDX > RC809-QUEUE-REC-COUNT                 
119500             SET PT-TRB-IDX           TO RC808-LINE-IDX                   
119600             MOVE RC808-PRPK-LNE-NBR(RC808-LINE-IDX)                      
119700                                      TO PT-TRB-LINE-NBR                  
119800                                         (PT-TRB-IDX)                     
119900             ADD 1                    TO PV-LINE-COUNT                    
120000       END-PERFORM                                                        
120100     END-IF.                                                              
120200     IF PS-NOT-DONE                                                       
120300         PERFORM 1010-INIT-REASON-TABLE                                   
120400             VARYING PT-TRBL-CLASS-IDX FROM 1 BY 1 UNTIL                  
120500                     PT-TRBL-CLASS-IDX > 4                                
120600             AFTER   PT-TRBL-REAS-IDX FROM 1 BY 1 UNTIL                   
120700                     PT-TRBL-REAS-IDX > 5                                 
120800         PERFORM 1100-LOAD-STORE-TABLE                                    
120900         PERFORM 1200-GET-CONTROL-INFO                                    
121000         EXEC SQL                                                         
121100              SET :PV-CURRENT-DATE = CURRENT DATE                         
121200         END-EXEC                                                         
121300                                                                          
121400     END-IF.                                                              
121500                                                                          
121600                                                                          
121700 1010-INIT-REASON-TABLE.                                                  
121800     SET PT-TRBL-NOT-SELECTED (PT-TRBL-CLASS-IDX,                         
121900                               PT-TRBL-REAS-IDX)                          
122000                                      TO TRUE.                            
122100/                                                                         
122200 1100-LOAD-STORE-TABLE.                                                   
122300     PERFORM 7810-OPEN-STORE-CSR.                                         
122400     PERFORM 7811-FETCH-STORE-CSR.                                        
122500     PERFORM VARYING PT-STR-IDX                                           
122600             FROM 1 BY 1 UNTIL PS-END-STORE-CSR                           
122700         ADD +1                       TO PV-STORE-COUNTER                 
122800         MOVE XLT00010-LOC-NBR         TO  PT-STR-NBR                     
122900                                         (PT-STR-IDX)                     
123000         MOVE XLT00010-LOC-TYP-CDE     TO  PT-TYPE-CODE                   
123100                                         (PT-STR-IDX)                     
123200         MOVE XLT00014-DC-NBR         TO  PT-DC-NMBR                      
123300                                         (PT-STR-IDX)                     
123400         MOVE XLT00014-EFF-BEG-DTE    TO PT-DC-RCT-START-DATE             
123700                                         (PT-STR-IDX)                     
124000         MOVE PV-EFF-CLOSE-DATE       TO PT-DC-RCT-STOP-DATE              
124100                                         (PT-STR-IDX)                     
124200                                                                          
125300         MOVE XLT00010-CLO-DTE        TO PT-CLOSED-DATE                   
125400                                         (PT-STR-IDX)                     
W38216         MOVE XLT00010-E-BUS-IND      TO PT-E-BUS-IND                     
W38216                                         (PT-STR-IDX)                     
125500         PERFORM 7811-FETCH-STORE-CSR                                     
125600     END-PERFORM.                                                         
125700                                                                          
125800     PERFORM 7812-CLOSE-STORE-CSR.                                        
125900/                                                                         
126000 1200-GET-CONTROL-INFO.                                                   
126100                                                                          
126200     PERFORM 7150-GET-TYPE-CODE.                                          
126300                                                                          
126400     IF PS-NOT-DONE                                                       
126500         IF XLT00010-LOC-TYP-CDE = 'DS' OR 'CS' OR 'RV'                   
131400             MOVE XLT00014-DC-NBR   TO COCNTL-OPER-UNT-ID                 
126700         ELSE                                                             
126800             MOVE RC809-OPER-UNT-ID TO COCNTL-OPER-UNT-ID                 
126900         END-IF                                                           
127000     END-IF.                                                              
127100                                                                          
127200     PERFORM 7400-GET-CONTROL.                                            
127300                                                                          
127400     EVALUATE TRUE                                                        
127500     WHEN NOT RC809-AD-YES AND NOT RC809-IMPORT-YES AND NOT               
127600             RC809-NEW-STR-PO                                             
127700         MOVE COCNTL-PREPK-OVRG-PCT   TO PV-SHIPT-OVRG-PCT                
127800         MOVE COCNTL-PREPK-SHTG-PCT   TO PV-SHIPT-SHTG-PCT                
127900     WHEN RC809-NEW-STR-PO                                                
128000         MOVE COCNTL-NWSTRPPK-OVRG-PCT                                    
128100                                      TO PV-SHIPT-OVRG-PCT                
128200         MOVE COCNTL-NWSTRPPK-SHTG-PCT                                    
128300                                      TO PV-SHIPT-SHTG-PCT                
128400     WHEN RC809-AD-YES AND RC809-IMPORT-YES                               
128500         MOVE COCNTL-IMPADVPPK-OVRG-PCT                                   
128600                                      TO PV-SHIPT-OVRG-PCT                
128700         MOVE COCNTL-IMPADVPPK-SHTG-PCT                                   
128800                                      TO PV-SHIPT-SHTG-PCT                
128900     WHEN RC809-IMPORT-YES                                                
129000         MOVE COCNTL-PREPK-OVRG-PCT   TO PV-SHIPT-OVRG-PCT                
129100         MOVE COCNTL-PREPK-SHTG-PCT   TO PV-SHIPT-SHTG-PCT                
129200* 3/8/00                                                                  
129300*        MOVE COCNTL-IMPRTPPK-OVRG-PCT                                    
129400*                                     TO PV-SHIPT-OVRG-PCT                
129500*        MOVE COCNTL-IMPRTPPK-SHTG-PCT                                    
129600*                                     TO PV-SHIPT-SHTG-PCT                
129700* 3/8/00                                                                  
129800     WHEN OTHER                                                           
129900         MOVE COCNTL-PREPK-OVRG-PCT   TO PV-SHIPT-OVRG-PCT                
130000         MOVE COCNTL-PREPK-SHTG-PCT   TO PV-SHIPT-SHTG-PCT                
130100     END-EVALUATE.                                                        
130200                                                                          
130300     IF PS-NOT-DONE                                                       
130400         PERFORM 1220-GET-DATE-RANGE                                      
130500     END-IF.                                                              
130600                                                                          
133600                                                                          
133700 1220-GET-DATE-RANGE.                                                     
133800******************************************************************        
133900*    THIS PARAGRAPH CALCULATES THE END DATE FROM TODAYS DATE              
134000*    USING DAYS-PR-CHG-NBR OF COCNTL TABLE.  THIS END DATE ALONG          
134100*    WITH TODAY'S DATE (BEGIN DATE) WILL BE USED TO RETRIEVE              
134200*    THE PRICE CHANGE THAT FALLS BETWEEN THESE DATES.                     
134300******************************************************************        
134400                                                                          
134500     INITIALIZE DPG51 DPG52                                               
134600                DPG53 DPG54                                               
134700                DPG55 DPG56.                                              
134800     MOVE EIBDATE                     TO PV-EIBDATE-N.                    
134900     MOVE PV-EIBDATE                  TO DPG52-LK-DATE-INPUT.             
135000                                                                          
135100     SET DPG51-DO-NOT-INCR-DECR-DATE                                      
135200         DPG51-ACTUAL-CALENDAR-ONLY                                       
135300         DPG52-LK-DTE-JULIAN          TO TRUE.                            
135400                                                                          
135500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
135600                           DPG53 DPG54                                    
135700                           DPG55 DPG56.                                   
135800                                                                          
135900     MOVE DPG55-DB2-ISO-DATE-FMT      TO PV-DB2-START-DATE.               
136000                                                                          
136100     INITIALIZE DPG51 DPG52                                               
136200                DPG53 DPG54                                               
136300                DPG55 DPG56.                                              
136400     MOVE PV-EIBDATE                  TO DPG52-LK-DATE-INPUT.             
136500                                                                          
136600     SET DPG51-INCREMENT-DATE         TO TRUE.                            
136700     SET DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                            
136800     SET DPG52-LK-DTE-JULIAN          TO TRUE.                            
136900                                                                          
137000     MOVE COCNTL-DAYS-PR-CHG-NBR      TO DPG51-INCR-DECR-DAYS-9.          
137100                                                                          
137200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52                  
137300                           DPG53 DPG54                                    
137400                           DPG55 DPG56.                                   
137500                                                                          
137600     MOVE DPG55-DB2-ISO-DATE-FMT      TO PV-DB2-END-DATE.                 
137700/                                                                         
137800 2000-LINE-TROUBLES.                                                      
137900                                                                          
138000     MOVE ZERO                        TO PV-SUM-STR-OTR-UNITS             
138100                                         PV-SUM-STR-PLAN-QTY              
138200     SET PS-NORMAL-PERFORM            TO TRUE                             
138300     MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                             
138400                                      TO DK-PO-LNE-NBR                    
138500     PERFORM 2100-LINE-STATUS.                                            
138600                                                                          
138700     IF PURITM-STATUS-CDE = 'CA' OR 'CM' OR 'CB' OR 'RV'                  
138800         SET PS-DONT-DO-ALLOC                                             
138900             RC809-DIDNT-ALLOC-DUE-TO-TRBL                                
139000                                      TO TRUE                             
139100     END-IF.                                                              
139200                                                                          
139300     IF PS-NOT-DONE                                                       
139400         PERFORM 2200-NO-DISTRO-CHECK                                     
139500     END-IF.                                                              
139600                                                                          
140700/                                                                         
140800 2100-LINE-STATUS.                                                        
140900                                                                          
141000     SET PT-TRB-IDX                   TO RC808-LINE-IDX                   
141100                                                                          
141200     PERFORM 7610-RECITM-RATO-QTYS                                        
141300     MOVE RECITM-PREPK-RATO-QTY       TO RC808-RECITM-RATO-QTY            
141400                                         (RC808-LINE-IDX)                 
141500                                                                          
141500     INITIALIZE XL001-ITEM-COMMAREA                                       
141500                                                                          
141600     PERFORM 7000-GET-TPURITM-RECORD.                                     
                                                                                
           IF PS-CALL-API-YES AND                                               
              ((DK-SKU-SEQ NOT = '000') AND                                     
               (DK-SKU-SEQ NOT = '999'))                                        
                  PERFORM 7025-CALL-CICS-API-ARCH.                              
                                                                                
      ***************************************                                   
W38216* CHECK E-COMMERCE DC FOR E-BUS-IND=Y                                     
W38216* AND LOCATION TYPE='DC'.                                                 
      ***************************************                                   
W38216     IF XLT00010-E-BUS-IND = 'Y' AND                                      
W38216        XLT00010-LOC-TYP-CDE = 'DC' AND                                   
             RC809-FCLTY-ID     = PC-FCLTY-ID                                   
               IF XL001-WEB-ITEM-NOT-FOUND OR                                   
                  ((DK-SKU-SEQ = '000') OR                                      
                   (DK-SKU-SEQ = '999'))                                        
                   SET TM500-UPDATE      TO TRUE                                
                   SET TM500-CREATE-AUTO TO TRUE                                
                   SET TM500-IN-TROUBLE  TO TRUE                                
                   SET TM500-NO-DETAILS  TO TRUE                                
                   SET PS-USE-LINE-NBR   TO TRUE                                
                   MOVE PC-401           TO TM500-TRBL-RSN-CDE                  
                   PERFORM 8000-CREATE-TROUBLE-RECORD                           
               END-IF                                                           
           END-IF.                                                              
                                                                                
141700     PERFORM 2110-LOAD-ITEM-TABLE.                                        
141800                                                                          
141900     MOVE PURITM-PREPK-RATO-QTY       TO RC808-PURITM-RATO-QTY            
142000                                         (RC808-LINE-IDX)                 
142100     ADD PURITM-UNT-RTL-PR-AMT        TO PV-PACK-RTL-PR-AMT               
142200                                                                          
142300* TRY TO RESOLVE ANY PRE-EXISTING LINE STATUS TROUBLES                    
142400     IF PS-DO-ALLOC AND RC809-RESOLVE-AUTO                                
142500         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
142600                                      TO TM500-PO-LNE-NBR                 
142700         SET TM500-UPDATE             TO TRUE                             
142800         SET PS-USE-LINE-NBR          TO TRUE                             
142900         MOVE PC-522                  TO TM500-TRBL-RSN-CDE               
143000         PERFORM 8000-CREATE-TROUBLE-RECORD                               
143100                                                                          
143200         IF PS-NOT-DONE                                                   
143300             SET TM500-UPDATE         TO TRUE                             
143400             SET TM500-CREATE-AUTO    TO TRUE                             
143500             SET PS-USE-LINE-NBR      TO TRUE                             
143600             MOVE PC-523              TO TM500-TRBL-RSN-CDE               
143700             PERFORM 8000-CREATE-TROUBLE-RECORD                           
143800         END-IF                                                           
143900                                                                          
144000         IF PS-NOT-DONE                                                   
144100             SET TM500-UPDATE         TO TRUE                             
144200             SET TM500-CREATE-AUTO    TO TRUE                             
144300             SET PS-USE-LINE-NBR      TO TRUE                             
144400             MOVE PC-524              TO TM500-TRBL-RSN-CDE               
144500             PERFORM 8000-CREATE-TROUBLE-RECORD                           
144600         END-IF                                                           
144700                                                                          
144800         IF PS-NOT-DONE                                                   
144900             SET TM500-UPDATE         TO TRUE                             
145000             SET TM500-CREATE-AUTO    TO TRUE                             
145100             SET PS-USE-LINE-NBR      TO TRUE                             
145200             MOVE PC-528              TO TM500-TRBL-RSN-CDE               
145300             PERFORM 8000-CREATE-TROUBLE-RECORD                           
145400         END-IF                                                           
145500                                                                          
145600         IF PS-NOT-DONE                                                   
145700             SET TM500-UPDATE         TO TRUE                             
145800             SET TM500-CREATE-AUTO    TO TRUE                             
145900             SET PS-USE-LINE-NBR      TO TRUE                             
146000             MOVE PC-529              TO TM500-TRBL-RSN-CDE               
146100             PERFORM 8000-CREATE-TROUBLE-RECORD                           
146200         END-IF                                                           
145500                                                                          
145600         IF PS-NOT-DONE                                                   
145700             SET TM500-UPDATE         TO TRUE                             
145800             SET TM500-CREATE-AUTO    TO TRUE                             
145900             SET PS-USE-LINE-NBR      TO TRUE                             
146000             MOVE PC-534              TO TM500-TRBL-RSN-CDE               
146100             PERFORM 8000-CREATE-TROUBLE-RECORD                           
146200         END-IF                                                           
146300     END-IF.                                                              
146400                                                                          
146500     EVALUATE PURITM-STATUS-CDE                                           
146600     WHEN 'CA'                                                            
146700         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
146800                                      TO TM500-PO-LNE-NBR                 
146900         SET TM500-CREATE             TO TRUE                             
147000         SET TM500-CREATE-AUTO        TO TRUE                             
147100         SET PS-USE-LINE-NBR          TO TRUE                             
147200         MOVE PC-522                  TO TM500-TRBL-RSN-CDE               
147300         IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) > ZERO                  
147400             MOVE RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX)                   
147500                                      TO PC-LC-RCVD                       
147600         ELSE                                                             
147700             MOVE RC808-PKSL-ITM-QTY (RC808-LINE-IDX)                     
147800                                      TO PC-LC-RCVD                       
147900         END-IF                                                           
148000         SET TM500-ADD-DETAILS        TO TRUE                             
148100         MOVE PC-LINE-COMPLETE-TEXT   TO TM500-FREEFORM-TEXT              
148200         PERFORM 8000-CREATE-TROUBLE-RECORD                               
148300                                                                          
148400         SET RC809-IN-TROUBLE         TO TRUE                             
148500         SET PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                           
148600                                      TO TRUE                             
148700     WHEN 'CB'                                                            
148800         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
148900                                      TO TM500-PO-LNE-NBR                 
149000         SET TM500-CREATE             TO TRUE                             
149100         SET TM500-CREATE-AUTO        TO TRUE                             
149200         SET PS-USE-LINE-NBR          TO TRUE                             
149300         MOVE PC-524                  TO TM500-TRBL-RSN-CDE               
149400         IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) > ZERO                  
149500             MOVE RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX)                   
149600                                      TO PC-LC-RCVD                       
149700         ELSE                                                             
149800             MOVE RC808-PKSL-ITM-QTY (RC808-LINE-IDX)                     
149900                                      TO PC-LC-RCVD                       
150000         END-IF                                                           
150100         SET TM500-ADD-DETAILS        TO TRUE                             
150200         MOVE PC-LINE-COMPLETE-TEXT   TO TM500-FREEFORM-TEXT              
150300         PERFORM 8000-CREATE-TROUBLE-RECORD                               
150400         SET RC809-IN-TROUBLE         TO TRUE                             
150500         SET PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                           
150600                                      TO TRUE                             
150700     WHEN 'CM'                                                            
150800         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
150900                                      TO TM500-PO-LNE-NBR                 
151000         SET TM500-CREATE             TO TRUE                             
151100         SET TM500-CREATE-AUTO        TO TRUE                             
151200         SET PS-USE-LINE-NBR          TO TRUE                             
151300         MOVE PC-523                  TO TM500-TRBL-RSN-CDE               
151400         IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) > ZERO                  
151500             MOVE RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX)                   
151600                                      TO PC-LC-RCVD                       
151700         ELSE                                                             
151800             MOVE RC808-PKSL-ITM-QTY (RC808-LINE-IDX)                     
151900                                      TO PC-LC-RCVD                       
152000         END-IF                                                           
152100         SET TM500-ADD-DETAILS        TO TRUE                             
152200         MOVE PC-LINE-COMPLETE-TEXT   TO TM500-FREEFORM-TEXT              
152300         PERFORM 8000-CREATE-TROUBLE-RECORD                               
152400         SET RC809-IN-TROUBLE         TO TRUE                             
152500         SET PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                           
152600                                      TO TRUE                             
150700     WHEN 'RV'                                                            
150800         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
150900                                      TO TM500-PO-LNE-NBR                 
151000         SET TM500-CREATE             TO TRUE                             
151100         SET TM500-CREATE-AUTO        TO TRUE                             
151200         SET PS-USE-LINE-NBR          TO TRUE                             
151300         MOVE PC-534                  TO TM500-TRBL-RSN-CDE               
151400         IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) > ZERO                  
151500             MOVE RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX)                   
151600                                      TO PC-LC-RCVD                       
151700         ELSE                                                             
151800             MOVE RC808-PKSL-ITM-QTY (RC808-LINE-IDX)                     
151900                                      TO PC-LC-RCVD                       
152000         END-IF                                                           
152100         SET TM500-ADD-DETAILS        TO TRUE                             
152200         MOVE PC-LINE-COMPLETE-TEXT   TO TM500-FREEFORM-TEXT              
152300         PERFORM 8000-CREATE-TROUBLE-RECORD                               
152400         SET RC809-IN-TROUBLE         TO TRUE                             
152500         SET PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                           
152600                                      TO TRUE                             
152700     END-EVALUATE.                                                        
152800 2110-LOAD-ITEM-TABLE.                                                    
152900     SET PT-ITEM-IDX                  TO RC808-LINE-IDX                   
153000     MOVE PURITM-PO-LNE-NBR           TO PT-PURITM-PO-LNE-NBR             
153100                                         (PT-ITEM-IDX)                    
153200     MOVE PURITM-UNT-RTL-PR-AMT       TO PT-PURITM-UNT-RTL-PR-AMT         
153300                                         (PT-ITEM-IDX)                    
153400     MOVE PURITM-GP-RTL-AMT           TO PT-PURITM-GP-RTL-AMT             
153500                                         (PT-ITEM-IDX)                    
153600     MOVE PURITM-GP-QTY               TO PT-PURITM-GP-QTY                 
153700                                         (PT-ITEM-IDX).                   
153800/                                                                         
153900 2200-NO-DISTRO-CHECK.                                                    
154000                                                                          
154100     IF PS-NOT-DONE                                                       
154200         PERFORM 7050-GET-TALLPLN                                         
154300     END-IF.                                                              
154400                                                                          
154500     IF PS-NOT-DONE AND PS-TALLPLN-DISTRO                                 
154600        PERFORM 7100-GET-TMESTDS                                          
154700     END-IF.                                                              
154800                                                                          
154900***************************************************************           
155000* RESOLVE A 'MISDIRECT' TROUBLE RECORD.  TALLPLN DOES NOT HAVE            
155100* TO EXIST IN ORDER TO RESOLVE THIS TROUBLE.                              
155200*                                                                         
155300* RESOLVE A 'NO DISTRO' TROUBLE RECORD ONLY IF BOTH                       
155400* TALLPLN AND TMESTDS EXIST.                                              
155500*                                                                         
155600* CREATE 'MISDIRECT' TROUBLE IF TALLPLN DOES NOT EXIST.                   
155700* THE SPLIT FOR THE DC ON THIS RECEIPT MAY NOT HAVE BEEN ADDED.           
155800* IF THE SPLIT IS DELETED BEFORE THE PURCHASE ORDER IS RELEASED,          
155900* THE TALLPLN ROW IS DELETED.  IF THE SPLIT IS ADDED AFTER THE            
156000* PURCHASE ORDER IS RELEASED AND THE SPLIT IS THEN DELETED, THE           
156100* TALLPLN ROW IS DELETED.                                                 
156200*                                                                         
156300* CREATE 'NO DISTRO' TROUBLE IF ONLY TMESTDS DOES NOT EXIST.              
156400* THIS TROUBLE WOULD BE CREATED IF THE DISTRO WAS DELETED OR IF           
156500* THE SPLIT WAS DELETED AFTER THE PURCHASE ORDER WAS RELEASED.            
156600* THE TALLPLN IS NOT DELETED BUT THE SPLIT ORDER QUANTITY IS              
156700* UPDATED TO ZERO.                                                        
156800***************************************************************           
156900                                                                          
157000     IF PS-NOT-DONE AND RC809-RESOLVE-AUTO                                
157100         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
157200                                      TO TM500-PO-LNE-NBR                 
157300         SET TM500-UPDATE             TO TRUE                             
157400         SET PS-USE-LINE-NBR          TO TRUE                             
157500         MOVE PC-225                  TO TM500-TRBL-RSN-CDE               
157600         PERFORM 8000-CREATE-TROUBLE-RECORD                               
157700                                                                          
157800         IF PS-TALLPLN-DISTRO AND PS-TMESTDS-DISTRO                       
157900             MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                     
158000                                      TO TM500-PO-LNE-NBR                 
158100             SET TM500-UPDATE         TO TRUE                             
158200             SET PS-USE-LINE-NBR      TO TRUE                             
158300             MOVE PC-222              TO TM500-TRBL-RSN-CDE               
158400             PERFORM 8000-CREATE-TROUBLE-RECORD                           
158500        END-IF                                                            
158600     ELSE                                                                 
158700         IF PS-NO-TALLPLN-DISTRO                                          
158800            PERFORM 2250-MISDIRECT-TROUBLE                                
158900     END-IF                                                               
159000                                                                          
159100     IF PS-NO-TALLPLN-DISTRO                                              
159200           CONTINUE                                                       
159300     ELSE                                                                 
159400        IF PS-NO-TMESTDS-DISTRO                                           
159500           PERFORM 2240-NO-DISTRO-TROUBLE.                                
159600                                                                          
159700     IF PS-NOT-DONE                                                       
159800        IF PS-NO-TALLPLN-DISTRO OR                                        
159900           PS-NO-TMESTDS-DISTRO                                           
160000             SET PS-DONT-DO-ALLOC                                         
160100                 RC809-DIDNT-ALLOC-DUE-TO-TRBL                            
160200                                      TO TRUE                             
160300        END-IF                                                            
160400     END-IF.                                                              
160500/                                                                         
160600 2240-NO-DISTRO-TROUBLE.                                                  
160700                                                                          
160800     MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                             
160900                                      TO TM500-PO-LNE-NBR                 
161000     SET TM500-ADD-DETAILS                                                
161100         TM500-CREATE                                                     
161200         TM500-CREATE-AUTO                                                
161300         PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                               
161400                                      TO TRUE                             
161500         SET PS-USE-LINE-NBR          TO TRUE                             
161600     MOVE PC-222                      TO TM500-TRBL-RSN-CDE               
161700     PERFORM 8000-CREATE-TROUBLE-RECORD                                   
161800                                                                          
161900     SET TM500-NO-DETAILS                                                 
162000         RC809-IN-TROUBLE    TO TRUE.                                     
162100/                                                                         
162200 2250-MISDIRECT-TROUBLE.                                                  
162300                                                                          
162400     MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                             
162500                                      TO TM500-PO-LNE-NBR                 
162600     SET TM500-ADD-DETAILS                                                
162700         TM500-CREATE                                                     
162800         TM500-CREATE-AUTO                                                
162900         PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                               
163000         PS-USE-LINE-NBR              TO TRUE                             
163100     MOVE PC-225                      TO TM500-TRBL-RSN-CDE               
163200     PERFORM 8000-CREATE-TROUBLE-RECORD                                   
163300                                                                          
163400     SET TM500-NO-DETAILS                                                 
163500         RC809-IN-TROUBLE             TO TRUE.                            
      /                                                                         
163700                                                                          
163800 2300-TEST-PACK-ID.                                                       
163900     IF RC809-PREPK-ID = 99                                               
164000         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
164100                                      TO TM500-PO-LNE-NBR                 
164200         SET TM500-ADD-DETAILS                                            
164300             TM500-CREATE                                                 
164400             TM500-CREATE-AUTO                                            
164500             PT-LINE-UNTIED-PACK-YES (PT-TRB-IDX)                         
164600             PT-LINE-LEVEL-TROUBLE (PT-TRB-IDX)                           
164700             PS-USE-LINE-NBR                                              
164800             PS-DONT-DO-ALLOC         TO TRUE                             
164900         MOVE PC-263                  TO TM500-TRBL-RSN-CDE               
165000         IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) > ZERO                  
165100             MOVE RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX)                   
165200                                      TO PC-UT-RCVD                       
165300         ELSE                                                             
165400             MOVE RC808-PKSL-ITM-QTY (RC808-LINE-IDX)                     
165500                                      TO PC-UT-RCVD                       
165600         END-IF                                                           
165700         SET TM500-ADD-DETAILS        TO TRUE                             
165800         MOVE PC-LINE-UNTIED-TEXT     TO TM500-FREEFORM-TEXT              
165900         PERFORM 8000-CREATE-TROUBLE-RECORD                               
166000                                                                          
166100         SET TM500-NO-DETAILS                                             
166200             RC809-IN-TROUBLE         TO TRUE                             
166300     END-IF.                                                              
166400/                                                                         
179800/                                                                         
179900 2500-ODD-UNITS.                                                          
180000                                                                          
180100                                                                          
180200*       RC808-BEST-CASE-UNITS IS CALCULATED IN RCKCS808 USING             
180300*       RECITM-DTL-CK-ITM-QTY OR RECITM-PKSL-ITM-QTY                      
180400*       AND RECITM-PREPK-ODD-UNT-QTY                                      
180500                                                                          
180600     SET PT-ITEM-IDX                  TO RC808-LINE-IDX                   
180700                                                                          
180800     IF RC808-ODD-UNITS (RC808-LINE-IDX) > ZERO                           
180900                                                                          
181000         ADD RC808-ODD-UNITS (RC808-LINE-IDX)                             
181100                                      TO PV-PACK-ODD-UNITS                
181200                                                                          
181300         IF PT-PURITM-GP-QTY (PT-ITEM-IDX) < 2                            
181400             MOVE PT-PURITM-UNT-RTL-PR-AMT (PT-ITEM-IDX)                  
181500                                      TO PV-TEMP-AMT                      
181600         ELSE                                                             
181700             COMPUTE PV-TEMP-AMT =                                        
181800                            PT-PURITM-GP-RTL-AMT (PT-ITEM-IDX)            
181900                            / PT-PURITM-GP-QTY (PT-ITEM-IDX)              
182000         END-IF                                                           
182100                                                                          
182200         MULTIPLY RC808-ODD-UNITS (RC808-LINE-IDX)                        
182300                     BY PV-TEMP-AMT                                       
182400         ADD PV-TEMP-AMT              TO PV-PACK-ODD-UNITS-DOL            
182500                                                                          
182600         IF (RC808-ODD-UNITS (RC808-LINE-IDX) NOT >                       
182700                         COCNTL-LNE-ODU-TOL-QTY AND                       
182800           (PV-TEMP-AMT NOT > COCNTL-LNE-ODU-TOL-AMT) )                   
182900             SET PT-TRBL-SELECTED (1, 3)                                  
183000                                      TO TRUE                             
183100         ELSE                                                             
183200             SET PT-TRBL-SELECTED (1, 1)                                  
183300                                      TO TRUE                             
183400         END-IF                                                           
183500     END-IF.                                                              
183600                                                                          
183700     IF RC808-BEST-CASE-UNITS (RC808-LINE-IDX) = ZERO                     
183800         SET PS-ZERO-BEST-CASE                                            
183900             PS-DONE                                                      
184000             RC809-DIDNT-ALLOC-DUE-TO-TRBL                                
184100                                      TO TRUE                             
184200         PERFORM 2510-ZERO-BEST-CASE-ERROR                                
184300     END-IF.                                                              
184400                                                                          
184500 2510-ZERO-BEST-CASE-ERROR.                                               
184600     SET TM500-CREATE                                                     
184700         TM500-CREATE-AUTO                                                
184800         TM500-ADD-DETAILS            TO TRUE                             
184900     SET  PS-DONT-USE-LINE-NBR        TO TRUE                             
185000     MOVE PC-265                      TO TM500-TRBL-RSN-CDE               
185100     MOVE RC809-PREPK-ID              TO PV-ZBC-PACK-ID                   
185200     MOVE PC-ZERO-BEST-CASE-TEXT      TO TM500-FREEFORM-TEXT              
185300     PERFORM 8000-CREATE-TROUBLE-RECORD.                                  
185400                                                                          
185500 2520-CHECK-TOLERANCES.                                                   
185600     IF PT-TRBL-SELECTED (1, 1)                                           
185700         CONTINUE                                                         
185800     ELSE                                                                 
185900         IF PV-PACK-ODD-UNITS > ZERO                                      
186000             IF PV-PACK-ODD-UNITS NOT > COCNTL-PREPK-ODU-TOL-QTY          
186100                     AND PV-PACK-ODD-UNITS-DOL                            
186200                          NOT > COCNTL-PREPK-ODU-TOL-AMT                  
186300                 SET PT-TRBL-SELECTED (1, 4)                              
186400                                      TO TRUE                             
186500                 SET PT-TRBL-CLASS-IDX                                    
186600                                      TO 1                                
186700                 SET PT-TRBL-REAS-IDX                                     
186800                                      TO 4                                
186900             ELSE                                                         
187000                 SET PT-TRBL-SELECTED (1, 2)                              
187100                                      TO TRUE                             
187200                 SET PT-TRBL-CLASS-IDX                                    
187300                                      TO 1                                
187400                 SET PT-TRBL-REAS-IDX TO 4                                
187500             END-IF                                                       
187600         END-IF                                                           
187700     END-IF.                                                              
187800/                                                                         
187900 2600-UNITS-OVER-SHORT.                                                   
188000******************************************************************        
188100*    THIS PARAGRAPH CALLS THE FOLLOWING PARAGRAPH:                        
188200*    - 2610 RETRIEVES THE TOLERANCES OF OVER/SHORT ALLOWED                
188300*    - 2620 DETERMINES IF THE PACKS RECEIVED ARE SHORT OR OVER            
188400******************************************************************        
188500                                                                          
188600     SET PT-TRB-IDX                   TO RC808-LINE-IDX                   
188700     MOVE ZERO                        TO PV-SUM-STR-OTR-UNITS             
188800                                         PV-SUM-STR-PLAN-QTY              
188900     IF RC808-LNE-OTR-QTY (RC808-LINE-IDX) > ZERO                         
189000         PERFORM 2620-OVER-OR-SHORT-TROUBLE                               
189100     ELSE                                                                 
189200         SET PT-LINE-ZERO-OTR-YES (PT-TRB-IDX)                            
189300                                      TO TRUE                             
189400         PERFORM 2601-ZERO-OTR                                            
189500     END-IF.                                                              
189600 2601-ZERO-OTR.                                                           
189700     SET PT-TRB-IDX                   TO RC808-LINE-IDX                   
189800     IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) = ZERO                      
189900       MOVE RC808-PKSL-ITM-QTY(RC808-LINE-IDX) TO PV-TOTAL-UNITS          
190000     ELSE                                                                 
190100       MOVE RC808-DTL-CK-ITM-QTY(RC808-LINE-IDX) TO PV-TOTAL-UNITS        
190200     END-IF                                                               
190300                                                                          
190400     MOVE PC-99999                    TO PT-LINE-PCT-OVER-SHT             
190500                                         (PT-TRB-IDX)                     
190600     MOVE PV-TOTAL-UNITS              TO PT-LINE-RCVD-QTY                 
190700                                         (PT-TRB-IDX)                     
190800     MOVE ZERO                        TO PT-LINE-OTR-QTY                  
190900                                         (PT-TRB-IDX).                    
191000                                                                          
191100 2620-OVER-OR-SHORT-TROUBLE.                                              
191200                                                                          
191300     IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) = ZERO                      
191400       MOVE RC808-PKSL-ITM-QTY(RC808-LINE-IDX) TO PV-TOTAL-UNITS          
191500     ELSE                                                                 
191600       MOVE RC808-DTL-CK-ITM-QTY(RC808-LINE-IDX) TO PV-TOTAL-UNITS        
191700     END-IF                                                               
191800                                                                          
191900     PERFORM VARYING RC808-STR-IDX FROM 1 BY 1                            
192000             UNTIL RC808-STR-NBR (RC808-LINE-IDX, RC808-STR-IDX)          
192100                     = ZERO                                               
192200                 OR RC808-STR-IDX > PC-MAX-STORES                         
192300                 IF  RC808-STR-OTR-QTY                                    
192400                       (RC808-LINE-IDX, RC808-STR-IDX) > ZERO             
192500                     ADD RC808-STR-OTR-QTY                                
192600                       (RC808-LINE-IDX, RC808-STR-IDX)                    
192700                                      TO PV-SUM-STR-OTR-UNITS             
192800                 END-IF                                                   
192900             ADD RC808-STR-DISTRO-QTY                                     
193000                       (RC808-LINE-IDX, RC808-STR-IDX)                    
193100                                      TO PV-SUM-STR-PLAN-QTY              
193200     END-PERFORM                                                          
193300                                                                          
193400     IF PS-NOT-DONE                                                       
193500        IF RC809-SPECIFIC-PLAN                                            
193600* THE RC808 TABLE WAS BUILT USING A SPECIFIC PLAN                         
193700           EVALUATE TRUE                                                  
193800             WHEN PV-TOTAL-UNITS = PV-SUM-STR-OTR-UNITS                   
193900                  CONTINUE                                                
194000             WHEN PV-TOTAL-UNITS NOT = PV-SUM-STR-OTR-UNITS               
194100                  SET PS-USE-SPECIFIC-MSG  TO TRUE                        
194200                  MOVE PV-SUM-STR-PLAN-QTY TO PC-OS-SPECIFIC-QTY          
194300                  MOVE RC808-LNE-DISTRO-QTY (RC808-LINE-IDX)              
194400                                           TO PV-SUM-STR-PLAN-QTY         
194500                  IF PS-NOT-DONE                                          
194600                      EVALUATE TRUE                                       
194700                         WHEN PV-TOTAL-UNITS           >                  
194800                                    PV-SUM-STR-OTR-UNITS                  
194900                             PERFORM 2421-OVERAGE-TROUBLE                 
195000                         WHEN PV-TOTAL-UNITS           =                  
195100                                    PV-SUM-STR-OTR-UNITS                  
195200                             CONTINUE                                     
195300                         WHEN PV-TOTAL-UNITS           <                  
195400                                    PV-SUM-STR-OTR-UNITS                  
195500                             PERFORM 2422-SHORTAGE-TROUBLE                
195600                      END-EVALUATE                                        
195700                  END-IF                                                  
195800           END-EVALUATE                                                   
195900        ELSE                                                              
196000           EVALUATE TRUE                                                  
196100             WHEN PV-TOTAL-UNITS        = PV-SUM-STR-OTR-UNITS            
196200                  CONTINUE                                                
196300                                                                          
196400             WHEN PV-TOTAL-UNITS        > PV-SUM-STR-OTR-UNITS            
196500                  PERFORM 2421-OVERAGE-TROUBLE                            
196600                                                                          
196700             WHEN PV-TOTAL-UNITS        < PV-SUM-STR-OTR-UNITS            
196800                  PERFORM 2422-SHORTAGE-TROUBLE                           
196900                                                                          
197000           END-EVALUATE                                                   
197100         END-IF                                                           
197200     END-IF.                                                              
197300                                                                          
197400 2421-OVERAGE-TROUBLE.                                                    
197500******************************************************************        
197600*    THIS PARAGRAPH SETS THE SWITCHES FOR OVERAGE TROUBLES.               
197700******************************************************************        
197800                                                                          
197900     SET PS-OVER          TO TRUE                                         
198000     IF ((PV-TOTAL-UNITS - PV-SUM-STR-OTR-UNITS) /                        
198100        PV-SUM-STR-OTR-UNITS) < PC-10                                     
198200         COMPUTE PV-RATIO ROUNDED =                                       
198300             (PV-TOTAL-UNITS - PV-SUM-STR-OTR-UNITS) /                    
198400             PV-SUM-STR-OTR-UNITS                                         
198500         COMPUTE PV-PCT-OVR-SHT ROUNDED = PV-RATIO * PC-100               
198600         MOVE PV-PCT-OVR-SHT TO PV-PCT-OVR-SHT-TEMP                       
198700                                                                          
198800         IF PV-PCT-OVR-SHT > PV-PCT-OVR-SHT-TEMP                          
198900             COMPUTE RC809-OVER-SHORT-PCT =                               
199000                 PV-PCT-OVR-SHT-TEMP + 1                                  
199100         ELSE                                                             
199200             MOVE PV-PCT-OVR-SHT-TEMP TO RC809-OVER-SHORT-PCT             
199300         END-IF                                                           
199400     ELSE                                                                 
199500         COMPUTE PV-PCT-OVR-SHT ROUNDED = PC-99999 / PC-100               
199600         MOVE PC-999 TO RC809-OVER-SHORT-PCT                              
199700     END-IF.                                                              
199800                                                                          
199900     SET PT-TRB-IDX                   TO RC808-LINE-IDX                   
200000     MOVE PV-PCT-OVR-SHT              TO PT-LINE-PCT-OVER-SHT             
200100                                         (PT-TRB-IDX)                     
200200     MOVE PV-TOTAL-UNITS              TO PT-LINE-RCVD-QTY                 
200300                                         (PT-TRB-IDX)                     
200400     MOVE PV-SUM-STR-OTR-UNITS        TO PT-LINE-OTR-QTY                  
200500                                         (PT-TRB-IDX)                     
200600                                                                          
200700     IF PV-PCT-OVR-SHT > PV-SHIPT-OVRG-PCT                                
200800        IF RC809-SPECIFIC-PLAN                                            
200900            SET PT-LINE-OVER-OUTSIDE-YES (PT-TRB-IDX)                     
201000                                      TO TRUE                             
201100        ELSE                                                              
201200            IF RC808-CURR-SPLIT-QTY (RC808-LINE-IDX)                      
201300                                    = PV-SUM-STR-PLAN-QTY                 
201400               SET PT-LINE-OVER-OUTSIDE-YES                               
201500                         (PT-TRB-IDX) TO TRUE                             
201600            ELSE                                                          
201700                SET PT-LINE-OVER-CHGD-DISTRO-YES                          
201800                            (PT-TRB-IDX)                                  
201900                                      TO TRUE                             
202000            END-IF                                                        
202100        END-IF                                                            
202200     ELSE                                                                 
202300        IF RC809-SPECIFIC-PLAN                                            
202400             SET PT-LINE-OVER-WITHIN-YES (PT-TRB-IDX)                     
202500                                   TO TRUE                                
202600        ELSE                                                              
202700             IF RC808-CURR-SPLIT-QTY (RC808-LINE-IDX)                     
202800                                         = PV-SUM-STR-PLAN-QTY            
202900                SET PT-LINE-OVER-WITHIN-YES (PT-TRB-IDX)                  
203000                                    TO TRUE                               
203100             ELSE                                                         
203200                SET PT-LINE-OVER-CHGD-DISTRO-YES                          
203300                            (PT-TRB-IDX)                                  
203400                                      TO TRUE                             
203500                SET RC809-IN-TROUBLE TO TRUE                              
203600             END-IF                                                       
203700        END-IF                                                            
203800     END-IF.                                                              
203900                                                                          
204000 2422-SHORTAGE-TROUBLE.                                                   
204100******************************************************************        
204200*    THIS PARAGRAPH SETS THE SWITCHES FOR SHORTAGE TROUBLES.              
204300******************************************************************        
204400                                                                          
204500     SET PS-SHORT         TO TRUE.                                        
204600                                                                          
204700     IF ((PV-SUM-STR-OTR-UNITS - PV-TOTAL-UNITS) /                        
204800        PV-SUM-STR-OTR-UNITS) < PC-10                                     
204900         COMPUTE PV-RATIO ROUNDED =                                       
205000             (PV-SUM-STR-OTR-UNITS - PV-TOTAL-UNITS) /                    
205100             PV-SUM-STR-OTR-UNITS                                         
205200                                                                          
205300         COMPUTE PV-PCT-OVR-SHT ROUNDED = PV-RATIO * PC-100               
205400                                                                          
205500         MOVE PV-PCT-OVR-SHT TO PV-PCT-OVR-SHT-TEMP                       
205600                                                                          
205700         IF PV-PCT-OVR-SHT > PV-PCT-OVR-SHT-TEMP                          
205800             COMPUTE RC809-OVER-SHORT-PCT =                               
205900                 PV-PCT-OVR-SHT-TEMP + 1                                  
206000         ELSE                                                             
206100             MOVE PV-PCT-OVR-SHT-TEMP TO RC809-OVER-SHORT-PCT             
206200         END-IF                                                           
206300     ELSE                                                                 
206400         COMPUTE PV-PCT-OVR-SHT ROUNDED = PC-99999 / PC-100               
206500         MOVE PC-999 TO RC809-OVER-SHORT-PCT                              
206600     END-IF.                                                              
206700                                                                          
206800     SET PT-TRB-IDX                   TO RC808-LINE-IDX                   
206900     MOVE PV-PCT-OVR-SHT              TO PT-LINE-PCT-OVER-SHT             
207000                                         (PT-TRB-IDX)                     
207100     MOVE PV-TOTAL-UNITS              TO PT-LINE-RCVD-QTY                 
207200                                         (PT-TRB-IDX)                     
207300     MOVE PV-SUM-STR-OTR-UNITS        TO PT-LINE-OTR-QTY                  
207400                                         (PT-TRB-IDX)                     
207500                                                                          
207600     IF PV-PCT-OVR-SHT > PV-SHIPT-SHTG-PCT                                
207700          PERFORM 2422A-PRORATE-TROUBLE                                   
207800     ELSE                                                                 
207900          IF RC809-SPECIFIC-PLAN                                          
208000               SET PT-LINE-SHRT-WI-SPEC-YES                               
208100                     (PT-TRB-IDX)     TO TRUE                             
208200          ELSE                                                            
208300               SET PT-LINE-SHRT-WITHIN-YES                                
208400                     (PT-TRB-IDX) TO TRUE                                 
208500          END-IF                                                          
208600     END-IF.                                                              
208700/                                                                         
208800 2422A-PRORATE-TROUBLE.                                                   
208900                                                                          
209000     EVALUATE TRUE                                                        
209100        WHEN RC809-AD-YES                                                 
209200             SET PT-LINE-SHRT-PIC-AD-YES (PT-TRB-IDX)                     
209300                                      TO TRUE                             
209400        WHEN RC809-SPECIFIC-PLAN                                          
209500             SET PT-LINE-SHRT-SPECIFIC-YES (PT-TRB-IDX)                   
209600                                      TO TRUE                             
209700        WHEN OTHER                                                        
209800             SET PT-LINE-SHRT-OUTSIDE-YES                                 
209900                     (PT-TRB-IDX)     TO TRUE                             
210000             SET PT-LINE-LEVEL-TROUBLE                                    
210100                     (PT-TRB-IDX)     TO TRUE                             
210200     END-EVALUATE.                                                        
210300/                                                                         
210400 3000-STORE-TROUBLE.                                                      
210500                                                                          
210600*    COUNT THE NUMBER OF STORES FOR EACH LINE AND SAVE THE RESULT         
210700*    IN A TABLE                                                           
210800                                                                          
210900     INITIALIZE PT-STORE-COUNT-TABLE.                                     
211000     PERFORM 3001-COUNT-STORES                                            
211100         VARYING RC808-STR-IDX FROM 1 BY 1                                
211200         UNTIL RC808-STR-NBR                                              
211300                        (RC808-LINE-IDX, RC808-STR-IDX) = ZERO            
211400                         OR RC808-STR-IDX > PC-MAX-STORES                 
211500         AFTER                                                            
211600             RC808-LINE-IDX FROM 1 BY 1                                   
211700             UNTIL RC808-PRPK-LNE-NBR                                     
211800                  (RC808-LINE-IDX) = ZERO                                 
211900                   OR RC808-LINE-IDX > RC809-QUEUE-REC-COUNT              
212000                                                                          
212100* DO ALL LINES HAVE THE SAME NUMBER OF STORES??                           
212200     PERFORM VARYING PT-SC-IDX FROM 1 BY 1                                
212300             UNTIL PT-SC-IDX > RC809-QUEUE-REC-COUNT                      
212400             IF PT-SC-IDX = 1                                             
212500                 MOVE PT-STORE-COUNT (PT-SC-IDX)                          
212600                                      TO PV-TEMP-STORE-COUNT              
212700             ELSE                                                         
212800                 IF PT-STORE-COUNT (PT-SC-IDX) NOT =                      
212900                                         PV-TEMP-STORE-COUNT              
213000                     SET PS-INVALID-STR-PLAN                              
213100                                      TO TRUE                             
213200                     PERFORM 3210-BAD-STORE-PLAN                          
213300                 END-IF                                                   
213400             END-IF                                                       
213500     END-PERFORM                                                          
213600                                                                          
213700* DO WE HAVE THE SAME STORES ON EVERY LINE??                              
213800     IF NOT PS-INVALID-STR-PLAN                                           
213900         PERFORM 3002-STORE-CONSISTENCY                                   
214000         VARYING RC808-STR-IDX FROM 1 BY 1                                
214100                 UNTIL RC808-STR-IDX > PV-TEMP-STORE-COUNT                
214200                         OR PS-INVALID-STR-PLAN                           
214300                 AFTER                                                    
214400                     RC808-LINE-IDX FROM 1 BY 1                           
214500                     UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT         
214600                         OR PS-INVALID-STR-PLAN                           
214700     END-IF                                                               
214800                                                                          
214900                                                                          
215000     IF NOT PS-INVALID-STR-PLAN                                           
215100         SET RC808-LINE-IDX           TO 1                                
215200         PERFORM 3100-STORE-STATUS                                        
215300         VARYING RC808-STR-IDX FROM 1 BY 1                                
215400                 UNTIL RC808-STR-IDX > PV-TEMP-STORE-COUNT                
215500                         OR PS-INVALID-STR-PLAN                           
215600                         OR PS-DONE                                       
215700                 AFTER                                                    
215800                     RC808-LINE-IDX FROM 1 BY 1                           
215900                     UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT         
216000     END-IF                                                               
216100                                                                          
216200                                                                          
216300* HERE WE HAVE TO CHECK ALL STORES ACROSS ALL LINES.                      
216400     IF PS-NOT-DONE                                                       
216500         IF NOT PS-INVALID-STR-PLAN                                       
216600             PERFORM 3200-PACK-QTYS                                       
216700             VARYING RC808-STR-IDX FROM 1 BY 1                            
216800                 UNTIL RC808-STR-IDX > PV-TEMP-STORE-COUNT                
216900                         OR PS-INVALID-STR-PLAN                           
217000                 AFTER                                                    
217100                    RC808-LINE-IDX FROM 1 BY 1                            
217200                    UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT          
217300         END-IF                                                           
217400     END-IF.                                                              
217500                                                                          
217600* HERE WE HAVE TO CHECK IF ALL STORE ALLOCATIONS ARE EVENLY               
217700* DIVISIBLE BY THE PURITM RATIO QTY                                       
217800     IF PS-NOT-DONE                                                       
217900         IF NOT PS-INVALID-STR-PLAN                                       
218000             PERFORM 3205-STORE-PLAN-VS-RATIO                             
218100             VARYING RC808-STR-IDX FROM 1 BY 1                            
218200                 UNTIL RC808-STR-IDX > PV-TEMP-STORE-COUNT                
218300                         OR PS-INVALID-STR-PLAN                           
218400                 AFTER                                                    
218500                    RC808-LINE-IDX FROM 1 BY 1                            
218600                    UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT          
218700         END-IF                                                           
218800     END-IF.                                                              
218900                                                                          
219000* ARE ALL THE CONSTRAINT QTYS FOR EVERY LINE AN EVEN MULTIPLE             
219100* OF THAT LINE'S PACK RATIO?                                              
219200                                                                          
219300     IF NOT PS-INVALID-STR-PLAN                                           
219400         PERFORM 3300-VERIFY-CONSTAINTS                                   
219500         VARYING RC808-STR-IDX FROM 1 BY 1                                
219600                 UNTIL RC808-STR-IDX > PV-TEMP-STORE-COUNT                
219700                         OR PS-INVALID-STR-PLAN                           
219800                 AFTER                                                    
219900                     RC808-LINE-IDX FROM 1 BY 1                           
220000                     UNTIL RC808-LINE-IDX > RC809-QUEUE-REC-COUNT         
220100                         OR PS-INVALID-STR-PLAN                           
220200     END-IF.                                                              
220300                                                                          
220400 3001-COUNT-STORES.                                                       
220500     SET PT-SC-IDX                    TO RC808-LINE-IDX                   
220600     ADD 1                            TO PT-STORE-COUNT                   
220700                                         (PT-SC-IDX).                     
220800 3002-STORE-CONSISTENCY.                                                  
220900     IF RC808-STR-NBR (RC808-LINE-IDX, RC808-STR-IDX) NOT =               
221000                RC808-STR-NBR (1, RC808-STR-IDX)                          
221100         SET PS-INVALID-STR-PLAN      TO TRUE                             
221200         MOVE 'STORES NOT A MEMBER OF ALL LINES IN A PACK'                
221300                                      TO PC-BAD-STORE-PLAN-LINE-4         
221400         PERFORM 3210-BAD-STORE-PLAN                                      
221500     END-IF.                                                              
221600                                                                          
221700 3100-STORE-STATUS.                                                       
221800     MOVE RC808-STR-NBR (RC808-LINE-IDX, RC808-STR-IDX)                   
221900                                      TO PV-STORE-NUMBER-N                
222200                                                                          
222300     PERFORM 7650-CHECK-STORE-CLOSED                                      
222400                                                                          
222500     IF PS-NOT-DONE AND PS-STORE-OPEN                                     
222600         PERFORM 7700-CHK-IF-RECEIVING                                    
222700     END-IF.                                                              
222800                                                                          
222900 3200-PACK-QTYS.                                                          
223000     IF RC808-LINE-IDX = 1                                                
223100         MOVE RC808-STR-DISTRO-PK (RC808-LINE-IDX, RC808-STR-IDX)         
223200                                      TO                                  
223300             PV-SAVE-STR-DISTRO-PK                                        
223400     ELSE                                                                 
223500         IF RC808-STR-DISTRO-PK (RC808-LINE-IDX, RC808-STR-IDX)           
223600                               = PV-SAVE-STR-DISTRO-PK                    
223700             CONTINUE                                                     
223800         ELSE                                                             
223900             SET PS-INVALID-STR-PLAN  TO TRUE                             
224000             PERFORM 3210-BAD-STORE-PLAN                                  
224100         END-IF                                                           
224200     END-IF.                                                              
224300                                                                          
224400 3205-STORE-PLAN-VS-RATIO.                                                
224500     DIVIDE RC808-STR-DISTRO-QTY (RC808-LINE-IDX, RC808-STR-IDX)          
224600         BY RC808-PURITM-RATO-QTY (RC808-LINE-IDX)                        
224700         GIVING PV-RESULT                                                 
224800         REMAINDER PV-REMAINDER                                           
224900                                                                          
225000     IF PV-REMAINDER > ZERO                                               
225100         SET PS-INVALID-STR-PLAN      TO TRUE                             
225200         PERFORM 3210-BAD-STORE-PLAN                                      
225300     END-IF.                                                              
225400                                                                          
225500 3210-BAD-STORE-PLAN.                                                     
225600     SET TM500-CREATE                                                     
225700         TM500-CREATE-AUTO                                                
225800         TM500-ADD-DETAILS            TO TRUE                             
225900     SET PS-DONT-USE-LINE-NBR         TO TRUE                             
226000     MOVE PC-264                      TO TM500-TRBL-RSN-CDE               
226100     MOVE RC809-PREPK-ID              TO PV-BSP-PACK-ID                   
226200     MOVE PC-BAD-STORE-PLAN-TEXT      TO TM500-FREEFORM-TEXT              
226300     PERFORM 8000-CREATE-TROUBLE-RECORD.                                  
226400     SET RC809-DIDNT-ALLOC-DUE-TO-TRBL                                    
226500                                      TO TRUE.                            
226600/                                                                         
226700 3300-VERIFY-CONSTAINTS.                                                  
226800                                                                          
226900     DIVIDE RC808-STR-CNSTR-QTY (RC808-LINE-IDX, RC808-STR-IDX)           
227000         BY RC808-PURITM-RATO-QTY (RC808-LINE-IDX)                        
227100         GIVING PV-RESULT                                                 
227200         REMAINDER PV-REMAINDER                                           
227300                                                                          
227400     IF PV-REMAINDER > ZERO                                               
227500         SET PS-INVALID-STR-PLAN      TO TRUE                             
227600         SET TM500-CREATE                                                 
227700             TM500-CREATE-AUTO                                            
227800             TM500-ADD-DETAILS        TO TRUE                             
227900         SET PS-DONT-USE-LINE-NBR     TO TRUE                             
228000         MOVE PC-264                  TO TM500-TRBL-RSN-CDE               
228100         MOVE RC809-PREPK-ID          TO PV-BSC-PACK-ID                   
228200         MOVE PC-BAD-STORE-CNSTR-TEXT TO TM500-FREEFORM-TEXT              
228300         PERFORM 8000-CREATE-TROUBLE-RECORD                               
228400         SET RC809-DIDNT-ALLOC-DUE-TO-TRBL                                
228500                                      TO TRUE                             
228600     END-IF.                                                              
228700                                                                          
228800/                                                                         
228900 4000-PACK-TROUBLE.                                                       
229000                                                                          
229100     MOVE ZERO                        TO PV-SUM-STR-OTR-UNITS             
229200                                         PV-SUM-BEST-CASE-UNITS           
229300                                                                          
229400     PERFORM 4001-SUM-PACK-OTR                                            
229500         VARYING RC808-STR-IDX FROM 1 BY 1                                
229600                 UNTIL RC808-STR-IDX > PV-TEMP-STORE-COUNT                
229700                         OR RC808-STR-IDX > PC-MAX-STORES                 
229800         AFTER                                                            
229900             RC808-LINE-IDX FROM 1 BY 1                                   
230000             UNTIL RC808-PRPK-LNE-NBR                                     
230100                  (RC808-LINE-IDX) = ZERO                                 
230200                   OR RC808-LINE-IDX > RC809-QUEUE-REC-COUNT              
230300                                                                          
230400     PERFORM 4002-SUM-PACK-BEST-CASE                                      
230500         VARYING RC808-LINE-IDX FROM 1 BY 1                               
230600                 UNTIL RC808-PRPK-LNE-NBR                                 
230700                      (RC808-LINE-IDX) = ZERO                             
230800                   OR RC808-LINE-IDX > RC809-QUEUE-REC-COUNT              
230900                                                                          
231000     EVALUATE TRUE                                                        
231100                                                                          
231200         WHEN PS-PACK-OVER-YES                                            
231300*            ALL LINES IN THE PACK ARE OVER                               
231400             PERFORM 4200-PACK-OVERAGE                                    
231500                                                                          
231600         WHEN PS-PACK-OVER-UNDER-YES                                      
231700         WHEN PS-PACK-UNDER-YES                                           
231800*            ALL LINES IN THE PACK ARE SHORT                              
231900             PERFORM 4300-PACK-SHORTAGE                                   
232000                                                                          
232100     END-EVALUATE.                                                        
232200                                                                          
232300 4001-SUM-PACK-OTR.                                                       
232400                                                                          
232500         IF RC808-STR-OTR-QTY (RC808-LINE-IDX, RC808-STR-IDX)             
232600                 > ZERO                                                   
232700             ADD RC808-STR-OTR-QTY                                        
232800                   (RC808-LINE-IDX, RC808-STR-IDX)                        
232900                                      TO PV-SUM-STR-OTR-UNITS             
233000         END-IF                                                           
233100         IF RC808-LINE-IDX = RC809-DRIVER-LNE-PTR                         
233200             IF RC808-STR-OTR-PK                                          
233300                           (RC808-LINE-IDX, RC808-STR-IDX) > ZERO         
233400                 ADD RC808-STR-OTR-PK                                     
233500                           (RC808-LINE-IDX, RC808-STR-IDX)                
233600                                      TO PV-SUM-OTR-PACKS                 
233700             END-IF                                                       
233800         END-IF.                                                          
233900                                                                          
234000 4002-SUM-PACK-BEST-CASE.                                                 
234100                                                                          
234200     IF RC808-BEST-CASE-UNITS(RC808-LINE-IDX) > ZERO                      
234300         ADD RC808-BEST-CASE-UNITS(RC808-LINE-IDX)                        
234400                                      TO PV-SUM-BEST-CASE-UNITS           
234500     END-IF.                                                              
234600                                                                          
234700 4010-VERIFY-PACK.                                                        
234800     MOVE PV-LINE-COUNT               TO RC806-NBR-OF-LINES               
234900     PERFORM VARYING RC808-LINE-IDX FROM 1 BY 1                           
235000                     UNTIL                                                
235100                        RC808-LINE-IDX > RC809-QUEUE-REC-COUNT            
235200         SET RC806-LINE-IDX           TO RC808-LINE-IDX                   
235300         MOVE RC808-PURITM-RATO-QTY (RC808-LINE-IDX)                      
235400                                      TO RC806-PO-RATIO                   
235500                                           (RC806-LINE-IDX)               
235600         MOVE RC808-RECITM-RATO-QTY (RC808-LINE-IDX)                      
235700                                      TO RC806-RC-RATIO                   
235800                                           (RC806-LINE-IDX)               
235900                                                                          
236000         IF RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX) > ZERO                  
236100             MOVE RC808-DTL-CK-ITM-QTY (RC808-LINE-IDX)                   
236200                                      TO RC806-RCVG-QTY                   
236300                                           (RC806-LINE-IDX)               
236400         ELSE                                                             
236500             MOVE RC808-PKSL-ITM-QTY (RC808-LINE-IDX)                     
236600                                      TO RC806-RCVG-QTY                   
236700                                           (RC806-LINE-IDX)               
236800         END-IF                                                           
236900                                                                          
237000         IF RC808-LNE-OTR-QTY (RC808-LINE-IDX) > ZERO                     
237100             MOVE RC808-LNE-OTR-QTY (RC808-LINE-IDX)                      
237200                                      TO RC806-UNIT-QTY                   
237300                                           (RC806-LINE-IDX)               
237400         ELSE                                                             
237500             MOVE ZERO                TO RC806-UNIT-QTY                   
237600                                           (RC806-LINE-IDX)               
237700         END-IF                                                           
237800                                                                          
237900         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
238000                                      TO RC806-PKSL-LNE-NBR               
238100                                           (RC806-LINE-IDX)               
238200     END-PERFORM                                                          
238300                                                                          
238400     SET RC806-VALIDATE-AND-CALC      TO TRUE                             
238500     PERFORM 8300-VALIDATION-MODULE.                                      
238600                                                                          
238700     PERFORM VARYING RC806-LINE-IDX FROM 1 BY 1                           
238800             UNTIL RC806-LINE-IDX > RC806-NBR-OF-LINES                    
238900         SET PT-TRB-IDX               TO RC806-LINE-IDX                   
239000         MOVE RC806-PCNT-VARIANCE (RC806-LINE-IDX)                        
239100                                      TO PT-LINE-PCT-VARIANCE             
239200                                         (PT-TRB-IDX)                     
239300         MOVE RC806-ODD-UNITS (RC806-LINE-IDX)                            
239400                                      TO PT-LINE-ODD-UNITS                
239500                                         (PT-TRB-IDX)                     
239600     END-PERFORM.                                                         
239700                                                                          
239800 4200-PACK-OVERAGE.                                                       
239900                                                                          
240000     IF PS-DIFFERENT-VARIANCES-NO                                         
240100                                                                          
240200         IF PV-TOT-ODD-UNITS = ZERO                                       
240300*            NO ODD UNITS AND VARIANCES ARE THE SAME                      
240400             SET PT-TRB-IDX  TO 1                                         
240500             PERFORM 4230-PACK-OVERAGE-TROUBLE                            
240600         ELSE                                                             
240700             CONTINUE                                                     
240800*            ODD UNITS AND VARIANCES ARE THE SAME                         
240900         END-IF                                                           
241000     ELSE                                                                 
241100         IF PV-TOT-ODD-UNITS = ZERO                                       
241200*            NO ODD UNITS AND DIFFERENT VARIANCES                         
241300             PERFORM 4235-RESOLVE-DC-BAD-PACK                             
241400             PERFORM 5000-CREATE-SEPARATE-LINE-TRBL                       
241500                 VARYING PT-TRB-IDX FROM 1 BY 1                           
241600                 UNTIL PT-TRB-LINE-NBR (PT-TRB-IDX) = ZERO                
241700             SET PS-NORMAL-PERFORM    TO TRUE                             
241800         ELSE                                                             
241900             CONTINUE                                                     
242000*            ODD UNITS AND DIFFERENT VARIANCES                            
242100         END-IF                                                           
242200     END-IF.                                                              
242300                                                                          
242400 4230-PACK-OVERAGE-TROUBLE.                                               
242500                                                                          
242600     PERFORM 4235-RESOLVE-DC-BAD-PACK                                     
242700     PERFORM 4231-PURE-OVRAGE-TEXT                                        
242800*    MOVE ZERO                        TO TM500-PO-LNE-NBR                 
242900*    MOVE PT-TRB-LINE-NBR (PT-TRB-IDX)                                    
243000*                                     TO TM500-PO-LNE-NBR                 
243100                                                                          
243200     SET TM500-CREATE                                                     
243300         TM500-CREATE-AUTO            TO TRUE                             
243400     SET PS-DONT-USE-LINE-NBR         TO TRUE                             
243500                                                                          
243600     EVALUATE TRUE                                                        
243700     WHEN PT-LINE-OVER-WITHIN-YES (PT-TRB-IDX)                            
243800         MOVE PC-579                  TO TM500-TRBL-RSN-CDE               
243900         PERFORM 8000-CREATE-TROUBLE-RECORD                               
244000                                                                          
244100     WHEN PT-LINE-OVER-OUTSIDE-YES (PT-TRB-IDX)                           
244200         MOVE PC-580                  TO TM500-TRBL-RSN-CDE               
244300         PERFORM 8000-CREATE-TROUBLE-RECORD                               
244400                                                                          
244500     WHEN PT-LINE-OVER-CHGD-DISTRO-YES (PT-TRB-IDX)                       
244600         MOVE PC-576                  TO TM500-TRBL-RSN-CDE               
244700         PERFORM 8000-CREATE-TROUBLE-RECORD                               
244800                                                                          
244900     WHEN PT-LINE-ZERO-OTR-YES (PT-TRB-IDX)                               
245000         MOVE PC-577                  TO TM500-TRBL-RSN-CDE               
245100         PERFORM 8000-CREATE-TROUBLE-RECORD                               
245200     END-EVALUATE.                                                        
245300                                                                          
245400 4231-PURE-OVRAGE-TEXT.                                                   
245500                                                                          
245600     PERFORM 8010-FORMAT-BPG-MESSAGE.                                     
245700     MOVE PT-LINE-PCT-VARIANCE (PT-TRB-IDX)                               
245800                                      TO TM500-OVER-SHORT-PCT.            
245900                                                                          
246000                                                                          
246100 4235-RESOLVE-DC-BAD-PACK.                                                
246200     MOVE ZERO                        TO DK-PO-LNE-NBR                    
246300     MOVE PC-267                      TO TRBNTF-TRBL-RSN-CDE              
246400     MOVE RC809-PREPK-ID              TO TRBNTF-PREPK-ID                  
246500     PERFORM 7801-FIND-UNRESOLVED-TROUBLE.                                
246600                                                                          
246700     IF PS-TRBL-FOUND                                                     
246800*            RESOLVE THE DC BAD PACK TROUBLE                              
246900             SET TM500-UPDATE                                             
247000                 TM500-RESOLVE-AUTO                                       
247100                 TM500-ADD-DETAILS    TO TRUE                             
247200             SET PS-DONT-USE-LINE-NBR TO TRUE                             
247300             MOVE PC-267              TO TM500-TRBL-RSN-CDE               
247400             MOVE 'NEW PACK OVERAGE TROUBLE HAS BEEN CREATED'             
247500                                      TO TM500-FREEFORM-TEXT              
247600             PERFORM 8000-CREATE-TROUBLE-RECORD                           
247700     END-IF.                                                              
247800                                                                          
247900/                                                                         
248000 4300-PACK-SHORTAGE.                                                      
248100                                                                          
248200                                                                          
248300     IF PS-DIFFERENT-VARIANCES-NO                                         
248400                                                                          
248500         IF PV-TOT-ODD-UNITS = ZERO                                       
248600*            THERE ARE NO ODD UNITS AND VARIANCES ARE THE SAME            
248700             SET PT-TRB-IDX  TO 1                                         
248800             PERFORM 4310-PACK-SHORTAGE-TROUBLE                           
248900         ELSE                                                             
249000*            THERE ARE ODD UNITS AND VARIANCES ARE THE SAME               
249100             CONTINUE                                                     
249200         END-IF                                                           
249300                                                                          
249400     ELSE                                                                 
249500                                                                          
249600         IF PV-TOT-ODD-UNITS = ZERO                                       
249700*            NO ODD UNITS AND DIFFERENT VARIANCES                         
249800             PERFORM 4235-RESOLVE-DC-BAD-PACK                             
249900             PERFORM 5000-CREATE-SEPARATE-LINE-TRBL                       
250000                 VARYING PT-TRB-IDX FROM 1 BY 1                           
250100                 UNTIL PT-TRB-LINE-NBR (PT-TRB-IDX) = ZERO                
250200             SET PS-NORMAL-PERFORM    TO TRUE                             
250300         ELSE                                                             
250400*            ODD UNITS AND DIFFERENT VARIANCES                            
250500             CONTINUE                                                     
250600         END-IF                                                           
250700     END-IF.                                                              
250800                                                                          
250900 4310-PACK-SHORTAGE-TROUBLE.                                              
251000                                                                          
251100     PERFORM 4335-RESOLVE-DC-BAD-PACK                                     
251200     PERFORM 4311-PURE-SHTAGE-TEXT                                        
251300     SET TM500-CREATE                                                     
251400         TM500-CREATE-AUTO            TO TRUE                             
251500     SET PS-DONT-USE-LINE-NBR         TO TRUE                             
251600     MOVE ZERO                        TO TM500-PO-LNE-NBR                 
251700     EVALUATE TRUE                                                        
251800     WHEN PT-LINE-SHRT-WITHIN-YES (PT-TRB-IDX)                            
251900         MOVE PC-570                  TO TM500-TRBL-RSN-CDE               
252000         PERFORM 8000-CREATE-TROUBLE-RECORD                               
252100                                                                          
252200     WHEN PT-LINE-SHRT-WI-SPEC-YES (PT-TRB-IDX)                           
252300         MOVE PC-575                  TO TM500-TRBL-RSN-CDE               
252400         PERFORM 8000-CREATE-TROUBLE-RECORD                               
252500                                                                          
252600     WHEN PT-LINE-SHRT-OUTSIDE-YES (PT-TRB-IDX)                           
252700         MOVE PC-571                  TO TM500-TRBL-RSN-CDE               
252800         PERFORM 8000-CREATE-TROUBLE-RECORD                               
252900                                                                          
253000     WHEN PT-LINE-SHRT-SPECIFIC-YES (PT-TRB-IDX)                          
253100         MOVE PC-574                  TO TM500-TRBL-RSN-CDE               
253200         PERFORM 8000-CREATE-TROUBLE-RECORD                               
253300                                                                          
253400     WHEN PT-LINE-SHRT-APPR-YES (PT-TRB-IDX)                              
253500         MOVE PC-573                  TO TM500-TRBL-RSN-CDE               
253600         PERFORM 8000-CREATE-TROUBLE-RECORD                               
253700                                                                          
253800     WHEN PT-LINE-SHRT-PIC-AD-YES (PT-TRB-IDX)                            
253900         MOVE PC-581                  TO TM500-TRBL-RSN-CDE               
254000         PERFORM 8000-CREATE-TROUBLE-RECORD                               
254100     END-EVALUATE.                                                        
254200                                                                          
254300 4311-PURE-SHTAGE-TEXT.                                                   
254400                                                                          
254500     PERFORM 8010-FORMAT-BPG-MESSAGE.                                     
254600                                                                          
254700     MOVE PT-LINE-PCT-VARIANCE (PT-TRB-IDX)                               
254800                                      TO TM500-OVER-SHORT-PCT.            
254900                                                                          
255000 4335-RESOLVE-DC-BAD-PACK.                                                
255100     MOVE ZERO                        TO DK-PO-LNE-NBR                    
255200     MOVE PC-267                      TO TRBNTF-TRBL-RSN-CDE              
255300     MOVE RC809-PREPK-ID              TO TRBNTF-PREPK-ID                  
255400                                                                          
255500     PERFORM 7801-FIND-UNRESOLVED-TROUBLE.                                
255600                                                                          
255700     IF PS-TRBL-FOUND                                                     
255800*            RESOLVE THE DC BAD PACK TROUBLE                              
255900             SET TM500-UPDATE                                             
256000                 TM500-RESOLVE-AUTO                                       
256100                 TM500-ADD-DETAILS    TO TRUE                             
256200             SET PS-DONT-USE-LINE-NBR TO TRUE                             
256300             MOVE PC-267              TO TM500-TRBL-RSN-CDE               
256400             MOVE 'NEW PACK SHORTAGE TROUBLE HAS BEEN CREATED'            
256500                                      TO TM500-FREEFORM-TEXT              
256600             PERFORM 8000-CREATE-TROUBLE-RECORD                           
256700     END-IF.                                                              
256800/                                                                         
256900 4900-DC-BAD-PACK.                                                        
257000                                                                          
257100     PERFORM 4911-COUNT-SELECTIONS VARYING                                
257200         PT-TRBL-CLASS-IDX FROM 1 BY 1 UNTIL                              
257300             PT-TRBL-CLASS-IDX > 4                                        
257400         AFTER                                                            
257500             PT-TRBL-REAS-IDX FROM 1 BY 1 UNTIL                           
257600             PT-TRBL-REAS-IDX > 5.                                        
257700                                                                          
257800     IF PV-TRBLS-COUNT > ZERO OR PV-NOTIFS-COUNT > ZERO                   
257900         MOVE ZERO                    TO TM500-PO-LNE-NBR                 
258000         PERFORM 4910-RESOLVE-DC-BAD-PACK                                 
258100                                                                          
258200         EVALUATE TRUE                                                    
258300         WHEN PV-TRBLS-COUNT = ZERO AND PV-NOTIFS-COUNT > ZERO            
258400             MOVE PC-271              TO TM500-TRBL-RSN-CDE               
258500             PERFORM 4920-FORMAT-BAD-PACK-DETAIL                          
258600             PERFORM 8000-CREATE-TROUBLE-RECORD                           
258700         WHEN RC809-CREATE-DC-BAD-PACK                                    
258800         WHEN PS-CREATE-267-TRBL                                          
258900             MOVE PC-267              TO TM500-TRBL-RSN-CDE               
259000             PERFORM 4920-FORMAT-BAD-PACK-DETAIL                          
259100             PERFORM 8000-CREATE-TROUBLE-RECORD                           
259200         WHEN PS-CREATE-269-TRBL                                          
259300             MOVE PC-269              TO TM500-TRBL-RSN-CDE               
259400             PERFORM 4920-FORMAT-BAD-PACK-DETAIL                          
259500             PERFORM 8000-CREATE-TROUBLE-RECORD                           
259600         END-EVALUATE                                                     
259700                                                                          
259800     END-IF                                                               
259900                                                                          
260000     MOVE ZERO                        TO PV-TRBLS-COUNT                   
260100                                         PV-NOTIFS-COUNT                  
260200     SET PS-DONT-CREATE-269-TRBL                                          
260300         PS-DONT-CREATE-267-TRBL      TO TRUE.                            
260400                                                                          
260500 4910-RESOLVE-DC-BAD-PACK.                                                
260600     MOVE ZERO                        TO DK-PO-LNE-NBR                    
260700     MOVE PC-267                      TO TRBNTF-TRBL-RSN-CDE              
260800     MOVE RC809-PREPK-ID              TO TRBNTF-PREPK-ID                  
260900                                                                          
261000     PERFORM 7800-FIND-ANY-TROUBLE.                                       
261100                                                                          
261200     IF PS-TRBL-FOUND                                                     
261300                                                                          
261400         PERFORM 7801-FIND-UNRESOLVED-TROUBLE                             
261500                                                                          
261600         IF PS-TRBL-FOUND                                                 
261700*               UNRESOLVED DC BAD PACK TROUBLE TROUBLE WAS FOUND          
261800*               SO RESOLVE IT AND CREATE ANALYST BAD PACK TROUBLE         
261900                                                                          
262000             SET TM500-UPDATE                                             
262100                 TM500-RESOLVE-AUTO                                       
262200                 TM500-ADD-DETAILS    TO TRUE                             
262300             SET PS-DONT-USE-LINE-NBR TO TRUE                             
262400             MOVE PC-267              TO TM500-TRBL-RSN-CDE               
262500             MOVE 'NEW BAD PACK TROUBLE HAS BEEN CREATED'                 
262600                                      TO TM500-FREEFORM-TEXT              
262700             PERFORM 8000-CREATE-TROUBLE-RECORD                           
262800             SET PS-CREATE-269-TRBL   TO TRUE                             
262900                                                                          
263000         ELSE                                                             
263100*            DC BAD PACK TROUBLE IS IN CLOSED STATUS                      
263200*            CREATE ANALYST BAD PACK TROUBLE ONLY                         
263300*                 IF NONE ALREADY EXIST                                   
263400             MOVE ZERO                TO DK-PO-LNE-NBR                    
263500             MOVE PC-269              TO TRBNTF-TRBL-RSN-CDE              
263600             MOVE RC809-PREPK-ID      TO TRBNTF-PREPK-ID                  
263700             PERFORM 7801-FIND-UNRESOLVED-TROUBLE                         
263800                                                                          
263900             IF PS-TRBL-FOUND                                             
264000                 SET PS-DONT-CREATE-269-TRBL                              
264100                                      TO TRUE                             
264200             ELSE                                                         
264300                 SET PS-CREATE-269-TRBL                                   
264400                                      TO TRUE                             
264500             END-IF                                                       
264600     ELSE                                                                 
264700*        NO DC BAD PACK TROUBLE WAS FOUND                                 
264800         SET PS-CREATE-267-TRBL       TO TRUE                             
264900                                                                          
265000     END-IF.                                                              
265100                                                                          
265200                                                                          
265300 4911-COUNT-SELECTIONS.                                                   
265400* COUNT THE FLAGGED REASONS.                                              
265500     IF PT-TRBL-ACTIVE (PT-TRBL-CLASS-IDX, PT-TRBL-REAS-IDX)              
265600       AND PT-TRBL-SELECTED (PT-TRBL-CLASS-IDX, PT-TRBL-REAS-IDX)         
265700         IF PT-TRBL-TYPE (PT-TRBL-CLASS-IDX, PT-TRBL-REAS-IDX)            
265800             ADD 1                    TO PV-TRBLS-COUNT                   
265900         ELSE                                                             
266000             ADD 1                    TO PV-NOTIFS-COUNT                  
266100         END-IF                                                           
266200     END-IF.                                                              
266300                                                                          
266400 4920-FORMAT-BAD-PACK-DETAIL.                                             
266500                                                                          
266600     PERFORM 8010-FORMAT-BPG-MESSAGE.                                     
266700/                                                                         
266800 5000-CREATE-SEPARATE-LINE-TRBL.                                          
266900     SET PS-PERFORMED-BY-PARA-5000    TO TRUE                             
267000                                                                          
267100     SET PS-USE-LINE-NBR                                                  
267200         TM500-CREATE                                                     
267300         TM500-LINE-LEVEL                                                 
267400         TM500-CREATE-AUTO            TO TRUE                             
267500     MOVE ZERO                        TO TM500-PREPK-ID                   
267600                                                                          
267700     MOVE PT-TRB-LINE-NBR (PT-TRB-IDX)                                    
267800                                      TO TM500-PO-LNE-NBR                 
267900                                                                          
268000     EVALUATE TRUE                                                        
268100         WHEN PT-LINE-OVER-WITHIN-YES      (PT-TRB-IDX)                   
268200         WHEN PT-LINE-OVER-OUTSIDE-YES     (PT-TRB-IDX)                   
268300         WHEN PT-LINE-OVER-CHGD-DISTRO-YES (PT-TRB-IDX)                   
268400         WHEN PT-LINE-ZERO-OTR-YES         (PT-TRB-IDX)                   
268500             PERFORM 5010-LINE-OVERAGE-TROUBLE                            
268600                                                                          
268700         WHEN PT-LINE-SHRT-WITHIN-YES      (PT-TRB-IDX)                   
268800         WHEN PT-LINE-SHRT-WI-SPEC-YES     (PT-TRB-IDX)                   
268900         WHEN PT-LINE-SHRT-OUTSIDE-YES     (PT-TRB-IDX)                   
269000         WHEN PT-LINE-SHRT-SPECIFIC-YES    (PT-TRB-IDX)                   
269100         WHEN PT-LINE-SHRT-APPR-YES        (PT-TRB-IDX)                   
269200         WHEN PT-LINE-SHRT-PIC-AD-YES      (PT-TRB-IDX)                   
269300             PERFORM 5020-LINE-SHORTAGE-TROUBLE                           
269400     END-EVALUATE.                                                        
269500                                                                          
269600 5010-LINE-OVERAGE-TROUBLE.                                               
269700                                                                          
269800     SET TM500-CREATE                                                     
269900         TM500-CREATE-AUTO                                                
270000         PS-USE-LINE-NBR                                                  
270100         TM500-LINE-LEVEL                                                 
270200         PS-OVER                      TO TRUE                             
270300                                                                          
270400     EVALUATE TRUE                                                        
270500     WHEN PT-LINE-OVER-WITHIN-YES (PT-TRB-IDX)                            
270600         MOVE PC-591                  TO TM500-TRBL-RSN-CDE               
270700                                                                          
270800     WHEN PT-LINE-OVER-OUTSIDE-YES (PT-TRB-IDX)                           
270900         MOVE PC-592                  TO TM500-TRBL-RSN-CDE               
271000                                                                          
271100     WHEN PT-LINE-OVER-CHGD-DISTRO-YES (PT-TRB-IDX)                       
271200         MOVE PC-588                  TO TM500-TRBL-RSN-CDE               
271300                                                                          
271400     WHEN PT-LINE-ZERO-OTR-YES (PT-TRB-IDX)                               
271500         MOVE PC-589                  TO TM500-TRBL-RSN-CDE               
271600     END-EVALUATE.                                                        
271700                                                                          
271800     MOVE ' OVER'                     TO PV-OS-OVER-SHORT                 
271900     PERFORM 5050-CREATE-OS-TEXT                                          
272000     PERFORM 8000-CREATE-TROUBLE-RECORD.                                  
272100                                                                          
272200 5020-LINE-SHORTAGE-TROUBLE.                                              
272300                                                                          
272400     SET TM500-CREATE                                                     
272500         TM500-CREATE-AUTO                                                
272600         PS-USE-LINE-NBR                                                  
272700         TM500-LINE-LEVEL                                                 
272800         PS-SHORT                     TO TRUE                             
272900                                                                          
273000     EVALUATE TRUE                                                        
273100     WHEN PT-LINE-SHRT-WITHIN-YES (PT-TRB-IDX)                            
273200         MOVE PC-582                  TO TM500-TRBL-RSN-CDE               
273300                                                                          
273400     WHEN PT-LINE-SHRT-WI-SPEC-YES (PT-TRB-IDX)                           
273500         MOVE PC-587                  TO TM500-TRBL-RSN-CDE               
273600                                                                          
273700     WHEN PT-LINE-SHRT-OUTSIDE-YES (PT-TRB-IDX)                           
273800         MOVE PC-583                  TO TM500-TRBL-RSN-CDE               
273900                                                                          
274000     WHEN PT-LINE-SHRT-SPECIFIC-YES (PT-TRB-IDX)                          
274100         MOVE PC-586                  TO TM500-TRBL-RSN-CDE               
274200                                                                          
274300     WHEN PT-LINE-SHRT-APPR-YES (PT-TRB-IDX)                              
274400         MOVE PC-585                  TO TM500-TRBL-RSN-CDE               
274500                                                                          
274600     WHEN PT-LINE-SHRT-PIC-AD-YES (PT-TRB-IDX)                            
274700         MOVE PC-593                  TO TM500-TRBL-RSN-CDE               
274800     END-EVALUATE.                                                        
274900                                                                          
275000     MOVE 'SHORT'                     TO PV-OS-OVER-SHORT                 
275100                                                                          
275200     PERFORM 5050-CREATE-OS-TEXT                                          
275300     PERFORM 8000-CREATE-TROUBLE-RECORD.                                  
275400                                                                          
275500 5050-CREATE-OS-TEXT.                                                     
275600******************************************************************        
275700*    THIS PARAGRAPH CREATES THE FREEFORM TEXT OF TROUBLE RECORD.          
275800******************************************************************        
275900                                                                          
276000     SET  TM500-ADD-DETAILS           TO TRUE.                            
276100     MOVE PC-RCKCS809                 TO TM500-CRE-UID.                   
276200                                                                          
276300     MOVE RC809-PREPK-ID              TO PV-OS-PACK-ID                    
276400     IF RC809-AD-YES                                                      
276500         MOVE 'YES'                   TO PV-OS-AD-YES-NO                  
276600     ELSE                                                                 
276700         MOVE ' NO'                   TO PV-OS-AD-YES-NO                  
276800     END-IF                                                               
276900                                                                          
277000     MOVE PT-LINE-OTR-QTY (PT-TRB-IDX)                                    
277100                                      TO PV-OS-LINE-OTR                   
277200     MOVE PT-LINE-RCVD-QTY (PT-TRB-IDX)                                   
277300                                      TO PV-OS-LINE-RCVD                  
277400     IF PT-LINE-OTR-QTY (PT-TRB-IDX)                                      
277500                         > PT-LINE-RCVD-QTY (PT-TRB-IDX)                  
277600         SUBTRACT PT-LINE-RCVD-QTY (PT-TRB-IDX)                           
277700                 FROM PT-LINE-OTR-QTY (PT-TRB-IDX)                        
277800                 GIVING PV-OS-LINE-VARIANCE                               
277900     ELSE                                                                 
278000         SUBTRACT PT-LINE-OTR-QTY (PT-TRB-IDX)                            
278100                 FROM PT-LINE-RCVD-QTY (PT-TRB-IDX)                       
278200                 GIVING PV-OS-LINE-VARIANCE                               
278300     END-IF                                                               
278400                                                                          
278500     MOVE PT-LINE-PCT-VARIANCE (PT-TRB-IDX)                               
278600                                      TO TM500-OVER-SHORT-PCT.            
278700                                                                          
278800     MOVE PC-OVER-SHORT-GENERIC-TEXT  TO TM500-FREEFORM-TEXT.             
278900                                                                          
279000                                                                          
279100*    IF PS-USE-SPECIFIC-MSG                                               
279200*        MOVE PC-MASTER-SPECIFIC-TEXT TO TM500-FREEFORM-TEXT              
279300*    ELSE                                                                 
279400*        MOVE PC-OVER-SHORT-TEXT-L    TO TM500-FREEFORM-TEXT              
279500*    END-IF.                                                              
279600/                                                                         
279700 7000-GET-TPURITM-RECORD.                                                 
279800*                                                                         
279900*    THIS PARAGRAPH CHECKS TABLE TPURITM.  IF THE PO LINE                 
280000*    IS COMPLETED OR CANCELLED, IT RETURNS A MESSAGE TO THE               
280100*    CALLING PROGRAM NOT TO CREATE A RECEIPT DISTRIBUTION.                
280200*                                                                         
280300     EXEC SQL                                                             
280400          SELECT                                                          
280500                 PURITM.PO_LNE_NBR                                        
280600               , PURITM.SKU_SEQ_NBR                                       
280800               , PURITM.STATUS_CDE                                        
280900               , PURITM.UNT_RTL_PR_AMT                                    
281000               , PURITM.GP_RTL_AMT                                        
281100               , PURITM.GP_QTY                                            
281200               , PURITM.PREPK_RATO_QTY                                    
280700               , PURITM.ITM_NBR                                           
281300            INTO                                                          
281400                 :PURITM-PO-LNE-NBR                                       
281500               , :PURITM-SKU-SEQ-NBR                                      
281700               , :PURITM-STATUS-CDE                                       
281800               , :PURITM-UNT-RTL-PR-AMT                                   
281900               , :PURITM-GP-RTL-AMT                                       
282000               , :PURITM-GP-QTY                                           
282100               , :PURITM-PREPK-RATO-QTY                                   
281600               , :PURITM-ITM-NBR                                          
282200            FROM                                                          
282300                 TPURITM PURITM                                           
282400           WHERE PO_NBR             = :RC809-PO-NBR                       
282500             AND VER_STATUS_CDE     = 'A'                                 
282600             AND APP_PO_LNE_NBR     = :DK-PO-LNE-NBR                      
282700     END-EXEC                                                             
282800                                                                          
           MOVE SPACES TO DK-SKU-SEQ                                            
           MOVE ZERO   TO DK-ITM-NBR                                            
                                                                                
282900     EVALUATE TRUE                                                        
283000         WHEN SQLCODE = ZERO                                              
                    MOVE PURITM-SKU-SEQ-NBR TO DK-SKU-SEQ                       
                    MOVE PURITM-ITM-NBR     TO DK-ITM-NBR                       
                    SET  PS-CALL-API-YES    TO TRUE                             
283100              CONTINUE                                                    
283200         WHEN SQLCODE = -904                                              
283300         WHEN SQLCODE = -911                                              
283400         WHEN SQLCODE = -913                                              
283500             SET PS-DONE                                                  
283600                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
283700             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
283800             MOVE 1                   TO RC809-PREPACK-ERROR-NBR          
283900             PERFORM RC001-RETURN-MSG                                     
284000         WHEN OTHER                                                       
284100             SET PS-DONE              TO TRUE                             
284200             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
284300             MOVE 2                   TO RC809-PREPACK-ERROR-NBR          
284400             PERFORM RC001-RETURN-MSG                                     
284500     END-EVALUATE.                                                        
284600/                                                                         
       7025-CALL-CICS-API-ARCH.                                                 
                                                                                
           MOVE DK-ITM-NBR TO XL001-KEY-ITM-NBR                                 
           SET XL001-BY-ITEM                                                    
               XL001-SELECT-SKU                                                 
               XL001-SELECT-WEB-SKU TO TRUE                                     
           CALL XL001-VSM-PGM USING DFHEIBLK                                    
                                    XL001-COMMAREA                              
                                    XL001-ITEM-COMMAREA                         
           EVALUATE TRUE                                                        
              WHEN XL001-SUCCESSFUL                                             
                   CONTINUE                                                     
              WHEN XL001-SKU-SQLCODE = +100                                     
                   SET PS-DONE                                                  
                       RC809-SKU-NOT-FOUND-FOR-LINE                             
                                       TO TRUE                                  
                   MOVE DK-PO-LNE-NBR  TO RC001-PO-LNE-NBR                      
                   MOVE 14             TO RC809-PREPACK-ERROR-NBR               
                   PERFORM RC001-RETURN-MSG                                     
              WHEN XL001-SKU-SQLCODE = -904                                     
              WHEN XL001-SKU-SQLCODE = -911                                     
              WHEN XL001-SKU-SQLCODE = -913                                     
                   SET PS-DONE                                                  
                       RC809-DB2-TIMEOUT-ERROR                                  
                                       TO TRUE                                  
                   MOVE DK-PO-LNE-NBR  TO RC001-PO-LNE-NBR                      
                   MOVE 43             TO RC809-PREPACK-ERROR-NBR               
                   PERFORM RC001-RETURN-MSG                                     
              WHEN OTHER                                                        
                   SET PS-DONE          TO TRUE                                 
                   MOVE DK-PO-LNE-NBR   TO RC001-PO-LNE-NBR                     
                   MOVE 46              TO RC809-PREPACK-ERROR-NBR              
                   PERFORM RC001-RETURN-MSG                                     
           END-EVALUATE.                                                        
      /                                                                         
284700 7050-GET-TALLPLN.                                                        
284800******************************************************************        
284900*    THIS PARAGRAPH CHECKS TABLE TALLPLN TO MAKE SURE THAT THERE          
285000*    IS A PLAN ASSOCIATED WITH THIS PO.  IF NOT, PROCESSING STOPS         
285100*    AND AN ERROR MESSAGE IS RETURNED TO THE CALLING PROGRAM.             
285200******************************************************************        
285300                                                                          
285400     EXEC SQL                                                             
285500         SELECT PLAN_NBR                                                  
285600         INTO :ALLPLN-PLAN-NBR                                            
285700          FROM TALLPLN                                                    
285800         WHERE PO_NBR     = :RC809-PO-NBR                                 
285900           AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                            
286000           AND DEST_NBR   = :RC809-OPER-UNT-ID                            
286100           AND STATUS_CDE = 'AC'                                          
286200         END-EXEC                                                         
286300                                                                          
286400     EVALUATE TRUE                                                        
286500         WHEN SQLCODE = ZERO                                              
286600             SET PS-TALLPLN-DISTRO    TO TRUE                             
286700                                                                          
286800         WHEN SQLCODE = +100                                              
286900             SET PS-NO-TALLPLN-DISTRO TO TRUE                             
287000                                                                          
287100         WHEN SQLCODE = -904                                              
287200         WHEN SQLCODE = -911                                              
287300         WHEN SQLCODE = -913                                              
287400             SET PS-DONE                                                  
287500                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
287600             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
287700             MOVE 3                   TO RC809-PREPACK-ERROR-NBR          
287800             PERFORM RC001-RETURN-MSG                                     
287900                                                                          
288000         WHEN OTHER                                                       
288100             SET PS-DONE              TO TRUE                             
288200             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
288300             MOVE 4                   TO RC809-PREPACK-ERROR-NBR          
288400             PERFORM RC001-RETURN-MSG                                     
288500                                                                          
288600     END-EVALUATE.                                                        
288700/                                                                         
288800 7100-GET-TMESTDS.                                                        
288900* SHOULD BE A COUNT                                                       
289000     EXEC SQL                                                             
289100         SELECT PO_NBR                                                    
289200         INTO :MESTDS-PO-NBR                                              
289300         FROM TMESTDS                                                     
289400         WHERE PO_NBR         = :RC809-PO-NBR                             
289500             AND PO_LNE_NBR   = :PURITM-PO-LNE-NBR                        
289600             AND PLAN_NBR     = :ALLPLN-PLAN-NBR                          
289700     END-EXEC                                                             
289800                                                                          
289900     EVALUATE TRUE                                                        
290000         WHEN SQLCODE = ZERO                                              
290100         WHEN SQLCODE = -811                                              
290200             SET PS-TMESTDS-DISTRO    TO TRUE                             
290300                                                                          
290400         WHEN SQLCODE = +100                                              
290500             SET PS-NO-TMESTDS-DISTRO TO TRUE                             
290600                                                                          
290700         WHEN SQLCODE = -904                                              
290800         WHEN SQLCODE = -911                                              
290900         WHEN SQLCODE = -913                                              
291000             SET PS-DONE                                                  
291100                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
291200             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
291300             MOVE 5                   TO RC809-PREPACK-ERROR-NBR          
291400             PERFORM RC001-RETURN-MSG                                     
291500                                                                          
291600         WHEN OTHER                                                       
291700             SET PS-DONE              TO TRUE                             
291800             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
291900             MOVE 6                   TO RC809-PREPACK-ERROR-NBR          
292000             PERFORM RC001-RETURN-MSG                                     
292100                                                                          
292200     END-EVALUATE.                                                        
292300/                                                                         
292400 7150-GET-TYPE-CODE.                                                      
292500******************************************************************        
292600*    THIS PARAGRAPH RETRIEVES THE TYPE-CODE OF XLT_LOC.                   
292700******************************************************************        
292800                                                                          
292900     SEARCH ALL PT-STORE-INFO                                             
293000     WHEN PT-STR-NBR (PT-STR-IDX) = RC809-OPER-UNT-ID                     
293100     MOVE PT-TYPE-CODE (PT-STR-IDX)   TO XLT00010-LOC-TYP-CDE             
293300     MOVE PT-DC-NMBR (PT-STR-IDX)     TO XLT00014-DC-NBR                  
W38216     MOVE PT-E-BUS-IND (PT-STR-IDX)   TO XLT00010-E-BUS-IND               
293500     MOVE PT-DC-RCT-START-DATE (PT-STR-IDX)                               
293600                                      TO                                  
293700                                     XLT00014-EFF-BEG-DTE                 
293800     MOVE PT-DC-RCT-STOP-DATE (PT-STR-IDX)                                
293900                                      TO                                  
294000                                     PV-EFF-CLOSE-DATE                    
294900     END-SEARCH.                                                          
295000/                                                                         
301100/                                                                         
306300 7400-GET-CONTROL.                                                        
306400                                                                          
306500         EXEC SQL                                                         
306600              SELECT                                                      
306700                     IMPRTPPK_OVRG_PCT                                    
306800                   , IMPRTPPK_SHTG_PCT                                    
306900                   , IMPADVPPK_OVRG_PCT                                   
307000                   , IMPADVPPK_SHTG_PCT                                   
307100                   , PREPK_OVRG_PCT                                       
307200                   , PREPK_SHTG_PCT                                       
307300                   , NWSTRPPK_OVRG_PCT                                    
307400                   , NWSTRPPK_SHTG_PCT                                    
307500                   , LNE_ODU_TOL_QTY                                      
307600                   , LNE_ODU_TOL_AMT                                      
307700                   , PREPK_ODU_TOL_QTY                                    
307800                   , PREPK_ODU_TOL_AMT                                    
307900                   , DAYS_PR_CHG_NBR                                      
308000                INTO                                                      
308100                     :COCNTL-IMPRTPPK-OVRG-PCT                            
308200                   , :COCNTL-IMPRTPPK-SHTG-PCT                            
308300                   , :COCNTL-IMPADVPPK-OVRG-PCT                           
308400                   , :COCNTL-IMPADVPPK-SHTG-PCT                           
308500                   , :COCNTL-PREPK-OVRG-PCT                               
308600                   , :COCNTL-PREPK-SHTG-PCT                               
308700                   , :COCNTL-NWSTRPPK-OVRG-PCT                            
308800                   , :COCNTL-NWSTRPPK-SHTG-PCT                            
308900                   , :COCNTL-LNE-ODU-TOL-QTY                              
309000                   , :COCNTL-LNE-ODU-TOL-AMT                              
309100                   , :COCNTL-PREPK-ODU-TOL-QTY                            
309200                   , :COCNTL-PREPK-ODU-TOL-AMT                            
309300                   , :COCNTL-DAYS-PR-CHG-NBR                              
309400                FROM TCOCNTL                                              
309500               WHERE OPER_UNT_ID = :COCNTL-OPER-UNT-ID                    
309600                 AND FCLTY_ID    = :RC809-FCLTY-ID                        
309700         END-EXEC                                                         
309800                                                                          
309900     EVALUATE TRUE                                                        
310000         WHEN SQLCODE = +0                                                
310100             CONTINUE                                                     
310200                                                                          
310300         WHEN SQLCODE = -904                                              
310400         WHEN SQLCODE = -911                                              
310500         WHEN SQLCODE = -913                                              
310600             SET PS-DONE                                                  
310700                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
310800             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
310900             MOVE 17                  TO RC809-PREPACK-ERROR-NBR          
311000             PERFORM RC001-RETURN-MSG                                     
311100                                                                          
311200         WHEN OTHER                                                       
311300             SET  PS-DONE TO TRUE                                         
311400             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
311500             MOVE 18                  TO RC809-PREPACK-ERROR-NBR          
311600             PERFORM RC001-RETURN-MSG                                     
311700                                                                          
311800     END-EVALUATE.                                                        
311900/                                                                         
312000 7550-COUNT-PURITM-LINES.                                                 
312100******************************************************************        
312200*    THIS PARAGRAPH COUNTS ACTIVE RECEIVERS ON THE PO.                    
312300******************************************************************        
312400                                                                          
312500     MOVE ZERO                    TO PV-PURITM-COUNT                      
312600     EXEC SQL                                                             
312700         SELECT COUNT(*)                                                  
312800         INTO :PV-PURITM-COUNT                                            
312900         FROM TPURITM                                                     
313000         WHERE PO_NBR        = :RC809-PO-NBR                              
313100         AND VER_STATUS_CDE  = 'A'                                        
313200         AND PO_PREPK_ID     = :RC809-PREPK-ID                            
313300         END-EXEC                                                         
313400                                                                          
313500     EVALUATE TRUE                                                        
313600         WHEN SQLCODE = ZERO                                              
313700             CONTINUE                                                     
313800                                                                          
313900         WHEN SQLCODE = -904                                              
314000         WHEN SQLCODE = -911                                              
314100         WHEN SQLCODE = -913                                              
314200             SET PS-DONE                                                  
314300                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
314400             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
314500             MOVE 23                  TO RC809-PREPACK-ERROR-NBR          
314600             PERFORM RC001-RETURN-MSG                                     
314700                                                                          
314800         WHEN OTHER                                                       
314900             SET  PS-DONE             TO TRUE                             
315000             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
315100             MOVE 24                  TO RC809-PREPACK-ERROR-NBR          
315200             PERFORM RC001-RETURN-MSG                                     
315300     END-EVALUATE.                                                        
315400/                                                                         
315500 7600-COUNT-RECITM-LINES.                                                 
315600******************************************************************        
315700*    THIS PARAGRAPH COUNTS ACTIVE RECEIVERS ON THE PO.                    
315800******************************************************************        
315900                                                                          
316000     MOVE ZERO                    TO PV-RECITM-COUNT                      
316100     EXEC SQL                                                             
316200         SELECT COUNT(*)                                                  
316300         INTO :PV-RECITM-COUNT                                            
316400         FROM TRECITM                                                     
316500         WHERE ORD_NBR       = :RC809-PO-NBR                              
316600         AND REC_SEQ_NBR     = :RC809-REC-SEQ-NBR                         
316700         AND VER_STATUS_CDE  = 'A'                                        
316800         AND PREPK_ID        = :RC809-PREPK-ID                            
316900         AND PREPK_RATO_QTY  > 0                                          
317000         END-EXEC                                                         
317100                                                                          
317200     EVALUATE TRUE                                                        
317300         WHEN SQLCODE = ZERO                                              
317400             CONTINUE                                                     
317500                                                                          
317600         WHEN SQLCODE = -904                                              
317700         WHEN SQLCODE = -911                                              
317800         WHEN SQLCODE = -913                                              
317900             SET PS-DONE                                                  
318000                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
318100             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
318200             MOVE 25                  TO RC809-PREPACK-ERROR-NBR          
318300             PERFORM RC001-RETURN-MSG                                     
318400                                                                          
318500         WHEN OTHER                                                       
318600             SET PS-DONE              TO TRUE                             
318700             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
318800             MOVE 26                  TO RC809-PREPACK-ERROR-NBR          
318900             PERFORM RC001-RETURN-MSG                                     
319000                                                                          
319100     END-EVALUATE.                                                        
319200/                                                                         
319300 7610-RECITM-RATO-QTYS.                                                   
319400                                                                          
319500     MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                             
319600                                      TO RECITM-ORD-LNE-NBR               
319700     EXEC SQL                                                             
319800         SELECT PREPK_RATO_QTY                                            
319900         INTO :RECITM-PREPK-RATO-QTY                                      
320000         FROM TRECITM                                                     
320100         WHERE ORD_NBR       = :RC809-PO-NBR                              
320200         AND REC_SEQ_NBR     = :RC809-REC-SEQ-NBR                         
320300         AND ORD_LNE_NBR     = :RECITM-ORD-LNE-NBR                        
320400         AND VER_STATUS_CDE = 'A'                                         
320500     END-EXEC                                                             
320600                                                                          
320700     EVALUATE TRUE                                                        
320800         WHEN SQLCODE = ZERO                                              
320900         WHEN SQLCODE = +100                                              
321000             CONTINUE                                                     
321100                                                                          
321200         WHEN SQLCODE = -904                                              
321300         WHEN SQLCODE = -911                                              
321400         WHEN SQLCODE = -913                                              
321500             SET PS-DONE                                                  
321600                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
321700             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
321800             MOVE 27                  TO RC809-PREPACK-ERROR-NBR          
321900             PERFORM RC001-RETURN-MSG                                     
322000                                                                          
322100                                                                          
322200        WHEN OTHER                                                        
322300             SET  PS-DONE             TO TRUE                             
322400             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
322500             MOVE 28                  TO RC809-PREPACK-ERROR-NBR          
322600             PERFORM RC001-RETURN-MSG                                     
322700                                                                          
322800     END-EVALUATE.                                                        
322900/                                                                         
323000 7650-CHECK-STORE-CLOSED.                                                 
323100                                                                          
323200     SEARCH ALL PT-STORE-INFO                                             
323300     WHEN PT-STR-NBR (PT-STR-IDX) = PV-STORE-NUMBER-N                     
323400         IF PV-CURRENT-DATE < PT-CLOSED-DATE (PT-STR-IDX)                 
323500             CONTINUE                                                     
323600         ELSE                                                             
323700             SET TM500-CREATE                                             
323800                 TM500-CREATE-AUTO                                        
323900                 PS-USE-LINE-NBR      TO TRUE                             
324000             MOVE PC-261              TO TM500-TRBL-RSN-CDE               
324100             SET  TM500-ADD-DETAILS   TO TRUE                             
324200             MOVE PV-STORE-NUMBER     TO PC-STORE-NUMBER                  
324300             MOVE PC-STR-CLS-TEXT     TO TM500-FREEFORM-TEXT              
324400             MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                     
324500                                      TO TM500-PO-LNE-NBR                 
324600              PERFORM 8000-CREATE-TROUBLE-RECORD                          
324700              SET PS-DONT-DO-ALLOC                                        
324800                  PS-STORE-CLOSED                                         
324900                  RC809-DIDNT-ALLOC-DUE-TO-TRBL                           
325000                  TM500-NO-DETAILS                                        
325100                  TM500-IN-TROUBLE    TO TRUE                             
325200         END-IF                                                           
325300     END-SEARCH.                                                          
325400/                                                                         
325500 7700-CHK-IF-RECEIVING.                                                   
325600                                                                          
325700     SEARCH ALL PT-STORE-INFO                                             
325800     WHEN PT-STR-NBR (PT-STR-IDX) = PV-STORE-NUMBER-N                     
325900                                                                          
326000         IF (PV-CURRENT-DATE >= PT-DC-RCT-START-DATE                      
326100                                (PT-STR-IDX) AND                          
326200             PV-CURRENT-DATE <= PT-DC-RCT-STOP-DATE                       
326300                                (PT-STR-IDX) )                            
326900             CONTINUE                                                     
327000         ELSE                                                             
327100             SET TM500-CREATE                                             
327200                 TM500-CREATE-AUTO                                        
327300                 PS-USE-LINE-NBR   TO TRUE                                
327400             MOVE PC-262               TO TM500-TRBL-RSN-CDE              
327500             SET TM500-ADD-DETAILS    TO TRUE                             
327600             MOVE PV-STORE-NUMBER     TO PC-STR-NO                        
327700             MOVE PC-STR-NOT-RCVG-TEXT TO TM500-FREEFORM-TEXT             
327800             MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                     
327900                                      TO TM500-PO-LNE-NBR                 
328000             PERFORM 8000-CREATE-TROUBLE-RECORD                           
328100             SET PS-DONT-DO-ALLOC                                         
328200                 RC809-DIDNT-ALLOC-DUE-TO-TRBL                            
328300                 TM500-NO-DETAILS                                         
328400                 TM500-IN-TROUBLE     TO TRUE                             
328500         END-IF                                                           
328600     END-SEARCH.                                                          
328700/                                                                         
328800 7800-FIND-ANY-TROUBLE.                                                   
328900                                                                          
329000     EXEC SQL                                                             
329100         SELECT NOTIF_NBR                                                 
329200             INTO :TRBNTF-NOTIF-NBR                                       
329300             FROM TTRBNTF                                                 
329400             WHERE PO_NBR         = :RC809-PO-NBR                         
329500               AND PO_LNE_NBR     = :DK-PO-LNE-NBR                        
329600               AND TRBL_RSN_CDE   = :TRBNTF-TRBL-RSN-CDE                  
329700               AND REC_SEQ_NBR    = :RC809-REC-SEQ-NBR                    
329800               AND PREPK_ID       = :TRBNTF-PREPK-ID                      
329900     END-EXEC                                                             
330000                                                                          
330100     EVALUATE TRUE                                                        
330200         WHEN SQLCODE = ZERO                                              
330300         WHEN SQLCODE = -811                                              
330400             SET PS-TRBL-FOUND        TO TRUE                             
330500                                                                          
330600         WHEN SQLCODE = +100                                              
330700             SET PS-TRBL-NOT-FOUND    TO TRUE                             
330800                                                                          
330900         WHEN SQLCODE = -904                                              
331000         WHEN SQLCODE = -911                                              
331100         WHEN SQLCODE = -913                                              
331200             SET PS-DONE                                                  
331300                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
331400             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
331500             MOVE 35                  TO RC809-PREPACK-ERROR-NBR          
331600             PERFORM RC001-RETURN-MSG                                     
331700                                                                          
331800         WHEN OTHER                                                       
331900             SET PS-DONE              TO TRUE                             
332000             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
332100             MOVE 36                  TO RC809-PREPACK-ERROR-NBR          
332200             PERFORM RC001-RETURN-MSG                                     
332300                                                                          
332400     END-EVALUATE.                                                        
332500                                                                          
332600 7801-FIND-UNRESOLVED-TROUBLE.                                            
332700                                                                          
332800     EXEC SQL                                                             
332900         SELECT NOTIF_NBR                                                 
333000             INTO :TRBNTF-NOTIF-NBR                                       
333100             FROM TTRBNTF                                                 
333200             WHERE PO_NBR         = :RC809-PO-NBR                         
333300               AND PO_LNE_NBR     = :DK-PO-LNE-NBR                        
333400               AND TRBL_RSN_CDE   = :TRBNTF-TRBL-RSN-CDE                  
333500               AND REC_SEQ_NBR    = :RC809-REC-SEQ-NBR                    
333600               AND PREPK_ID       = :TRBNTF-PREPK-ID                      
333700               AND RESOLVED_IND IN ('N', 'I')                             
333800     END-EXEC                                                             
333900                                                                          
334000     EVALUATE TRUE                                                        
334100         WHEN SQLCODE = ZERO                                              
334200         WHEN SQLCODE = -811                                              
334300             SET PS-TRBL-FOUND        TO TRUE                             
334400                                                                          
334500         WHEN SQLCODE = +100                                              
334600             SET PS-TRBL-NOT-FOUND    TO TRUE                             
334700                                                                          
334800         WHEN SQLCODE = -904                                              
334900         WHEN SQLCODE = -911                                              
335000         WHEN SQLCODE = -913                                              
335100             SET PS-DONE                                                  
335200                 RC809-DB2-TIMEOUT-ERROR  TO TRUE                         
335300             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
335400             MOVE 29                  TO RC809-PREPACK-ERROR-NBR          
335500             PERFORM RC001-RETURN-MSG                                     
335600                                                                          
335700         WHEN OTHER                                                       
335800             SET PS-DONE              TO TRUE                             
335900             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
336000             MOVE 30                  TO RC809-PREPACK-ERROR-NBR          
336100             PERFORM RC001-RETURN-MSG                                     
336200                                                                          
336300     END-EVALUATE.                                                        
336400/                                                                         
336500 7810-OPEN-STORE-CSR.                                                     
336600                                                                          
336700     EXEC SQL                                                             
336800          OPEN STORE-CSR                                                  
336900     END-EXEC.                                                            
337000                                                                          
337100     IF SQLCODE NOT = ZERO                                                
337200         SET PS-DONE                  TO TRUE                             
337300         MOVE DK-PO-LNE-NBR           TO RC001-PO-LNE-NBR                 
337400         MOVE 31                      TO RC809-PREPACK-ERROR-NBR          
337500         PERFORM RC001-RETURN-MSG                                         
337600                                                                          
337700     END-IF.                                                              
337800                                                                          
337900 7811-FETCH-STORE-CSR.                                                    
338000                                                                          
338100     EXEC SQL                                                             
338200          FETCH STORE-CSR                                                 
366300          INTO  :XLT00010-LOC-NBR                                         
                   ,  :XLT00010-LOC-TYP-CDE                                     
                   ,  :XLT00010-CLO-DTE                                         
                   ,  :PV-EFF-CLOSE-DATE                                        
                   ,  :XLT00014-EFF-BEG-DTE                                     
                   ,  :XLT00014-DC-NBR                                          
W38216             ,  :XLT00010-E-BUS-IND                                       
339400     END-EXEC.                                                            
339500                                                                          
339600     EVALUATE TRUE                                                        
339700         WHEN SQLCODE = ZERO                                              
339800             CONTINUE                                                     
339900         WHEN SQLCODE = +100                                              
340000              SET PS-END-STORE-CSR    TO TRUE                             
340100                                                                          
340200         WHEN OTHER                                                       
340300             SET PS-DONE              TO TRUE                             
340400             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
340500             MOVE 32                  TO RC809-PREPACK-ERROR-NBR          
340600             PERFORM RC001-RETURN-MSG                                     
340700                                                                          
340800     END-EVALUATE.                                                        
340900                                                                          
341000 7812-CLOSE-STORE-CSR.                                                    
341100                                                                          
341200     EXEC SQL                                                             
341300          CLOSE STORE-CSR                                                 
341400     END-EXEC.                                                            
341500                                                                          
341600     IF SQLCODE NOT = ZERO                                                
341700         SET PS-DONE                  TO TRUE                             
341800         MOVE DK-PO-LNE-NBR           TO RC001-PO-LNE-NBR                 
341900         MOVE 33                      TO RC809-PREPACK-ERROR-NBR          
342000         PERFORM RC001-RETURN-MSG                                         
342100     END-IF.                                                              
342200/                                                                         
342300 8000-CREATE-TROUBLE-RECORD.                                              
342400                                                                          
342500     IF TM500-OVER-SHORT-PCT < ZERO                                       
342600        MULTIPLY TM500-OVER-SHORT-PCT BY -1                               
342700                 GIVING TM500-OVER-SHORT-PCT                              
342800     END-IF                                                               
342900                                                                          
343000     MOVE RC809-OPER-UNT-ID           TO TM500-OPER-UNT-ID                
343100     MOVE RC809-FCLTY-ID              TO TM500-FCLTY-ID                   
343200     MOVE RC809-PO-NBR                TO TM500-PO-NBR                     
343300                                                                          
343400     IF PS-PERFORMED-BY-PARA-5000                                         
343500         CONTINUE                                                         
343600     ELSE                                                                 
343700* RPM 12/9: ADDED THE FOLLOWING IF BLOCK                                  
343800     IF PS-USE-LINE-NBR                                                   
343900         MOVE RC808-PRPK-LNE-NBR (RC808-LINE-IDX)                         
344000                                      TO TM500-PO-LNE-NBR                 
344100         MOVE ZERO                    TO TM500-PREPK-ID                   
344200         SET TM500-LINE-LEVEL         TO TRUE                             
344300     ELSE                                                                 
344400         MOVE ZERO                    TO TM500-PO-LNE-NBR                 
344500         MOVE RC809-PREPK-ID          TO TM500-PREPK-ID                   
344600         SET TM500-PACK-LEVEL         TO TRUE                             
344700     END-IF                                                               
344800     END-IF                                                               
344900                                                                          
345000     MOVE RC809-REC-SEQ-NBR           TO TM500-REC-SEQ-NBR                
345100     MOVE RC809-UNITS-TO-ALLOC        TO TM500-UNITS-TO-ALLOC             
345200     MOVE RC809-AD-ITM-IND            TO TM500-AD-SW                      
345300*    MOVE RC809-RTV-SW                TO TM500-RTV-SW                     
345400*    MOVE RC809-REDISTRO-SW           TO TM500-REDISTRO-SW                
345500                                                                          
345600     MOVE RC809-DEPT-NBR              TO TM500-DEPT-NBR                   
345700     MOVE RC809-PRORATE-IND           TO TM500-PRORATE-IND                
345800     MOVE 'RCKCS809'                  TO TM500-CRE-UID                    
345900                                         TM500-NOTIF-UID                  
346000*                                                                         
346100     EXEC CICS                                                            
346200         LINK PROGRAM  (PC-TMKCS521)                                      
346300              COMMAREA (TM500-FIELDS)                                     
346400              LENGTH   (PC-600)                                           
346500     END-EXEC.                                                            
346600                                                                          
346700     MOVE TM500-TRBL-RSN-CDE          TO RC001-TRBL-RSN-CDE               
346800     EVALUATE TRUE                                                        
346900         WHEN TM500-CALL-SUCCESSFUL                                       
347000         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                                
347100         WHEN TM500-DIDNT-ALLOC-DUE-TO-TRBL                               
347200              CONTINUE                                                    
347300                                                                          
347400         WHEN TM500-CREATE AND TM500-DUPLICATE-TROUBLE                    
347800              CONTINUE                                                    
347900                                                                          
348000         WHEN OTHER                                                       
348100             SET PS-DONE              TO TRUE                             
348200             MOVE DK-PO-LNE-NBR       TO RC001-PO-LNE-NBR                 
348300             MOVE 37                  TO RC809-PREPACK-ERROR-NBR          
348400             MOVE TM500-RETURN-CODE   TO RC001-TM500-RC                   
348500             PERFORM RC001-RETURN-MSG                                     
348600                                                                          
348700     END-EVALUATE.                                                        
348800                                                                          
348900 8010-FORMAT-BPG-MESSAGE.                                                 
349000                                                                          
349100     MOVE RC809-PREPK-ID              TO PV-BPG-PACK-ID                   
349200     MOVE PV-DIFF-LINE-COUNT          TO PV-BPG-LINE-COUNT                
349300     MOVE PV-PACK-ODD-UNITS           TO PV-BPG-ODD-UNITS                 
349400     MOVE PV-PACK-ODD-UNITS-DOL       TO PV-BPG-ODD-UNIT-DOLLARS          
349500                                                                          
349600     IF PT-TRBL-SELECTED (4, 1) OR PT-TRBL-SELECTED (4, 2)                
349700         MOVE 'YES'                   TO PV-BPG-RATIO-YES-NO              
349800     ELSE                                                                 
349900         MOVE ' NO'                   TO PV-BPG-RATIO-YES-NO              
350000     END-IF                                                               
350100                                                                          
350200     IF RC809-AD-YES                                                      
350300         MOVE 'YES'                   TO PV-BPG-AD-YES-NO                 
350400     ELSE                                                                 
350500         MOVE ' NO'                   TO PV-BPG-AD-YES-NO                 
350600     END-IF                                                               
350700                                                                          
350800     DIVIDE RC808-BEST-CASE-UNITS (RC809-DRIVER-LNE-PTR)                  
350900         BY RC808-RECITM-RATO-QTY (RC809-DRIVER-LNE-PTR)                  
351000         GIVING PV-TOTAL-UNITS                                            
351100                                                                          
351200     MOVE PV-TOTAL-UNITS              TO PV-BPG-PACK-OTR                  
351300                                                                          
351400     MOVE RC808-LNE-OTR-PACK-QTY(RC809-DRIVER-LNE-PTR)                    
351500                                      TO PV-BPG-PACK-OTR                  
351600                                                                          
351700     IF RC808-LNE-OTR-PACK-QTY(RC809-DRIVER-LNE-PTR) >                    
351800                 PV-TOTAL-UNITS                                           
351900         SUBTRACT PV-TOTAL-UNITS                                          
352000              FROM   RC808-LNE-OTR-PACK-QTY(RC809-DRIVER-LNE-PTR)         
352100                 GIVING PV-BPG-PACK-VARIANCE                              
352200         MOVE 'SHORT'                 TO PV-BPG-OVER-SHORT                
352300     ELSE                                                                 
352400         SUBTRACT RC808-LNE-OTR-PACK-QTY(RC809-DRIVER-LNE-PTR)            
352500                 FROM  PV-TOTAL-UNITS                                     
352600                 GIVING PV-BPG-PACK-VARIANCE                              
352700         MOVE ' OVER'                 TO PV-BPG-OVER-SHORT                
352800     END-IF                                                               
352900                                                                          
353000     MOVE PV-TOTAL-UNITS              TO PV-BPG-PACK-RCVD                 
353100                                                                          
353200     MOVE PC-BAD-PACK-GENERIC-TEXT    TO TM500-FREEFORM-TEXT              
353300     SET TM500-CREATE                                                     
353400         TM500-CREATE-AUTO                                                
353500         TM500-ADD-DETAILS                                                
353600         PS-DONT-USE-LINE-NBR         TO TRUE.                            
353700                                                                          
353800* DRS 4/4/00                                                              
353900     MOVE PT-LINE-PCT-VARIANCE (RC809-DRIVER-LNE-PTR)                     
354000                                      TO TM500-OVER-SHORT-PCT.            
354100                                                                          
354200                                                                          
354300/                                                                         
354400 8100-READ-TEMP-STORAGE.                                                  
354500     EXEC CICS READQ TS                                                   
354600         QUEUE (RC809-QUEUE-NAME)                                         
354700         INTO  (RC808-PACK-LINE-TABLE(PV-ITEM))                           
354800         ITEM  (PV-ITEM)                                                  
354900         RESP  (PV-CICS-RESP)                                             
355000     END-EXEC.                                                            
355100                                                                          
355200     IF ((PV-CICS-RESP = DFHRESP (NORMAL)) OR                             
355300               (PV-CICS-RESP = DFHRESP (ITEMERR)))                        
355400         CONTINUE                                                         
355500     ELSE                                                                 
355600         SET PS-DONE                                                      
355700             RC809-CROAK              TO TRUE                             
355800         MOVE DK-PO-LNE-NBR           TO RC001-PO-LNE-NBR                 
355900         MOVE 38                      TO RC809-PREPACK-ERROR-NBR          
356000         PERFORM RC001-RETURN-MSG                                         
356100                                                                          
356200     END-IF.                                                              
356300                                                                          
356400 8150-DELETE-TEMP-QUEUE.                                                  
356500                                                                          
356600     EXEC CICS DELETEQ TS                                                 
356700         QUEUE   (RC809-QUEUE-NAME)                                       
356800         RESP    (PV-CICS-RESP)                                           
356900     END-EXEC.                                                            
357000                                                                          
357100     IF PV-CICS-RESP  = DFHRESP (NORMAL)                                  
357200        OR PV-CICS-RESP = DFHRESP (QIDERR)                                
357300         CONTINUE                                                         
357400     ELSE                                                                 
357500         SET RC809-CROAK              TO TRUE                             
357600         MOVE DK-PO-LNE-NBR           TO RC001-PO-LNE-NBR                 
357700         MOVE 39                      TO RC809-PREPACK-ERROR-NBR          
357800         PERFORM RC001-RETURN-MSG                                         
357900     END-IF.                                                              
358000/                                                                         
358100 8300-VALIDATION-MODULE.                                                  
358200                                                                          
358300     EXEC CICS LINK                                                       
358400         PROGRAM  (PC-RCKCS806)                                           
358500         COMMAREA (RC806-PRODUCT-PACK-VALIDATION)                         
358600         RESP     (PV-CICS-RESP)                                          
358700     END-EXEC.                                                            
358800                                                                          
358900*  CHECK CICS RETURN CODE                                                 
359000     IF PV-CICS-RESP = DFHRESP(NORMAL)                                    
359100         CONTINUE                                                         
359200     ELSE                                                                 
359300         SET PS-DONE                                                      
359400             RC809-CROAK              TO TRUE                             
359500         MOVE DK-PO-LNE-NBR           TO RC001-PO-LNE-NBR                 
359600         MOVE 40                      TO RC809-PREPACK-ERROR-NBR          
359700         PERFORM RC001-RETURN-MSG                                         
359800     END-IF.                                                              
359900/                                                                         
360000 8500-CALL-DISTRO-ROUTINE.                                                
360100                                                                          
360200     EXEC CICS                                                            
360300         LINK PROGRAM  (PC-RCKCS810)                                      
360400              COMMAREA (RC809-COMMAREA)                                   
360500     END-EXEC.                                                            
360600                                                                          
360700* ANY ERRORS GENERATED IN RCKCS810 WILL PASS THRU TO THE HOST             
360800* PROGRAM.  THERE'S NO NEED TO HANDLE THEM HERE                           
360900/                                                                         
360000     COPY RCPD001.                                                        
360900/                                                                         
