000100*-----------------------*                                         00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300*-----------------------*                                         00030001
000400 PROGRAM-ID.    RCKCS812.                                         00040001
000500 AUTHOR.        JOE LAROSA.                                       00050001
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060001
000700 DATE-WRITTEN.  APRIL, 2000.                                      00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*    E812 - RC-LINE LIST BY PRE-PACK                            * 00100001
001100*                                                               * 00110001
001200*    THIS PROGRAM GENERATES A LIST OF ITEMS FOR A PO/RECEIVER   * 00120003
001300*                                                               * 00130001
001400*    THE DP030-OVERRIDE-APPL-ERROR SWITCH IS SET TO TRUE WHEN   * 00140001
001500*    ENTERING THE PROGRAM IN ORDER TO GIVE CONTROL BACK TO THE  * 00150001
001600*    LIST WHEN A NEXT-ACT-APPL-ERROR IS SENT BACK FROM THE      * 00160001
001700*    UPDATE.  THE DP030-RC-APPL-ERROR IS CHECKED TO DETERMINE   * 00170001
001800*    IF A NEXT-ACT-APPL-ERROR IS BEING RETURNED TO THE LIST.    * 00180001
001900*---------------------------------------------------------------* 00190051
001910*  CHANGED 10/20/14 BY CHERI PARMLEY       CHG#0094517          * 00191052
001920*   EXPANDED PO# FROM 7 TO 8 DIGITS                             * 00192051
001930*---------------------------------------------------------------* 00193052
001940* CHANGED 11/11/2021    BY JIM HUNTER      WR: CHG0263784         00194052
001950* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00195052
001960* MAKING THE CALL DYNAMIC VS STATIC.                              00196052
002000***************************************************************** 00200001
002100 ENVIRONMENT DIVISION.                                            00210001
002200 DATA DIVISION.                                                   00220001
002300                                                                  00230001
002400 WORKING-STORAGE SECTION.                                         00240001
002500 01  PS-PROGRAM-SWITCHES.                                         00250001
002600     05  PS-ERROR-SW                  PIC X(01) VALUE 'Y'.        00260001
002700         88  PS-NO-ERROR                        VALUE 'Y'.        00270001
002800         88  PS-ERROR                           VALUE 'N'.        00280001
002900     05  PS-COMMAREA-SW               PIC X(01) VALUE 'N'.        00290001
003000         88  PS-COMMAREA-VALID                  VALUE 'Y'.        00300001
003100         88  PS-COMMAREA-NOT-VALID              VALUE 'N'.        00310001
003200     05  PS-DONE-SW                   PIC X(01) VALUE 'N'.        00320001
003300         88  PS-DONE                            VALUE 'Y'.        00330001
003400         88  PS-NOT-DONE                        VALUE 'N'.        00340001
003500     05  PS-LINE-P2L-UPLOAD-SW        PIC X(01) VALUE 'N'.        00350039
003600         88  PS-LINE-P2L-UPLOAD-DONE            VALUE 'Y'.        00360039
003700         88  PS-LINE-P2L-UPLOAD-NOT-DONE        VALUE 'N'.        00370039
003800                                                                  00380001
003900 01  PC-PROGRAM-CONSTANTS.                                        00390001
004000     05  PC-CURRENT-MAP-NAME          PIC X(08) VALUE 'RC812A  '. 00400001
004100     05  PC-CURRENT-MAPSET-NAME       PIC X(08) VALUE 'RCKM812 '. 00410001
004200     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'RCKCS812'. 00420001
004300                                                                  00430001
004400     05  PC-LIST-QUEUE-SEQ            PIC 9(01) VALUE 1.          00440001
004500     05  PC-SEL-QUEUE-SEQ             PIC 9(01) VALUE 2.          00450001
004600                                                                  00460001
004700     05  PC-ITEMS-PER-PANEL           PIC S9(4) VALUE +12         00470001
004800                                                COMP SYNC.        00480001
004900     05  PC-MAX-BLOCKS-IN-ARRAY       PIC S9(4) VALUE +2          00490001
005000                                                COMP SYNC.        00500001
005100     05  PC-MAX-ITEMS                 PIC S9(9) VALUE +1000000    00510001
005200                                                COMP-3.           00520001
005300     05  PC-MSG-NUMBER-LENGTH         PIC S9(4) VALUE +7          00530001
005400                                                COMP SYNC.        00540001
005500     05  PC-MAX-RETRIES               PIC S9(3) VALUE +3 COMP-3.  00550001
005600                                                                  00560001
005700     05  PC-ADD                       PIC X(03) VALUE 'ADD'.      00570001
005800     05  PC-INQ                       PIC X(03) VALUE 'INQ'.      00580001
005900     05  PC-UPD                       PIC X(03) VALUE 'UPD'.      00590001
006000     05  PC-DEL                       PIC X(03) VALUE 'DEL'.      00600001
006100     05  PC-ERR                       PIC X(03) VALUE 'ERR'.      00610001
006200     05  PC-DEFAULT-TMST              PIC X(26) VALUE             00620039
006300                     '9999-09-09-09.09.09.999999'.                00630039
006400                                                                  00640001
006500*----------------------------------------------------------------*00650019
006600*  INCLUDED PROGRAM SWITCHES FOR XLKUT001       **   WR # 21361  *00660038
006700*----------------------------------------------------------------*00670019
006800     05  PS-CALL-API-SW               PIC  X    VALUE 'N'.        00680019
006900         88  PS-CALL-API-NO                     VALUE 'N'.        00690019
007000         88  PS-CALL-API-YES                    VALUE 'Y'.        00700019
007100*----------------------------------------------------------------*00710019
007200* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *00720038
007300*----------------------------------------------------------------*00730019
007400     05  PC-TSYMSG-NUMBERS.                                       00740001
007500         10  PC-TSYMSG-00005          PIC 9(05) VALUE 00005.      00750001
007600         10  PC-TSYMSG-00008          PIC 9(05) VALUE 00008.      00760001
007700         10  PC-TSYMSG-00047          PIC 9(05) VALUE 00047.      00770001
007800         10  PC-TSYMSG-00050          PIC 9(05) VALUE 00050.      00780001
007900         10  PC-TSYMSG-00051          PIC 9(05) VALUE 00051.      00790001
008000         10  PC-TSYMSG-00052          PIC 9(05) VALUE 00052.      00800001
008100         10  PC-TSYMSG-00053          PIC 9(05) VALUE 00053.      00810001
008200         10  PC-TSYMSG-00054          PIC 9(05) VALUE 00054.      00820001
008300         10  PC-TSYMSG-00055          PIC 9(05) VALUE 00055.      00830001
008400         10  PC-TSYMSG-00057          PIC 9(05) VALUE 00057.      00840001
008500         10  PC-TSYMSG-00069          PIC 9(05) VALUE 00069.      00850001
008600         10  PC-TSYMSG-00070          PIC 9(05) VALUE 00070.      00860001
008700         10  PC-TSYMSG-00083          PIC 9(05) VALUE 00083.      00870001
008800         10  PC-TSYMSG-00101          PIC 9(05) VALUE 00101.      00880001
008900         10  PC-TSYMSG-00279          PIC 9(05) VALUE 00279.      00890001
009000         10  PC-TSYMSG-00551          PIC 9(05) VALUE 00551.      00900003
009100         10  PC-TSYMSG-00984          PIC 9(05)  VALUE 00984.     00910041
009200         10  PC-TSYMSG-03138          PIC 9(05)  VALUE 03138.     00920041
009300                                                                  00930001
009400*----------------------------------------------------------------*00940019
009500* INCLUDED PROGRAM CONSTANTS PC-000 AND PC-999.      WR # 21361  *00950038
009600*----------------------------------------------------------------*00960019
009700     05  PC-000                       PIC X(03) VALUE '000'.      00970019
009800     05  PC-999                       PIC X(03) VALUE '999'.      00980019
009900*----------------------------------------------------------------*00990019
010000* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01000038
010100*----------------------------------------------------------------*01010019
010200 01  DK-DB2-KEYS.                                                 01020001
010300     05  DK-ORD-NBR                   PIC S9(9) COMP VALUE +0.    01030001
010400     05  DK-RCVR-NBR                  PIC S9(9) COMP VALUE +0.    01040001
010500     05  DK-OPER-UNT-ID               PIC S9(4) COMP VALUE +0.    01050001
010600     05  DK-FCLTY-ID                  PIC S9(4) COMP VALUE +0.    01060001
010700     05  DK-PREPK-ID                  PIC S9(4) COMP VALUE +0.    01070001
010800     05  DK-LNE-NBR                   PIC S9(4) COMP VALUE +0.    01080001
010900                                                                  01090001
011000 01  PA-PROGRAM-ACCUMULATORS.                                     01100001
011100     05  PA-TOT-FCSE-PK-COUNT         PIC S9(9) VALUE +0.         01110001
011200     05  PA-TOT-P2L-PK-COUNT          PIC S9(9) VALUE +0.         01120005
011300     05  PA-TOT-ODD-PK-COUNT          PIC S9(9) VALUE +0.         01130005
011400     05  PA-FCSE-QTY                  PIC S9(9) VALUE +0.         01140005
011500     05  PA-P2L-QTY                   PIC S9(9) VALUE +0.         01150005
011600     05  PA-ODD-QTY                   PIC S9(9) VALUE +0.         01160005
011700     05  PA-ODD-QTY-DIFF              PIC S9(9) VALUE +0.         01170008
011800                                                                  01180001
011900 01  PV-PROGRAM-VARIABLES.                                        01190001
012000     05  PV-SUB                       PIC S9(4) VALUE +0          01200001
012100                                                COMP SYNC.        01210001
012200     05  PV-REMAINDER                 PIC S9(4) VALUE +0          01220001
012300                                                COMP SYNC.        01230001
012400     05  PV-BLOCK-NUMBER              PIC S9(4) VALUE +0          01240001
012500                                                COMP SYNC.        01250001
012600     05  PV-CICS-RESP                 PIC S9(4) VALUE +0          01260001
012700                                                COMP SYNC.        01270001
012800     05  PV-ITEM                      PIC S9(4) VALUE +0          01280001
012900                                                COMP SYNC.        01290001
013000     05  PV-SEL-QUEUE-ITEM            PIC S9(4) VALUE +0          01300001
013100                                                COMP SYNC.        01310001
013200     05  PV-SAVE-ITEM                 PIC S9(4) VALUE +0          01320001
013300                                                COMP SYNC.        01330001
013400     05  PV-HIGHEST-BLOCK-WRITTEN     PIC S9(4) VALUE +0          01340001
013500                                                COMP SYNC.        01350001
013600     05  PV-LIST-ITEM-NUMBER          PIC S9(4) VALUE +0          01360001
013700                                                COMP SYNC.        01370001
013800     05  PV-FIRST-BLOCK-IN-ARRAY      PIC S9(4) VALUE +0          01380001
013900                                                COMP SYNC.        01390001
014000     05  PV-NEXT-BLOCK-IN-ARRAY       PIC S9(4) VALUE +0          01400001
014100                                                COMP SYNC.        01410001
014200     05  PV-PREV-BLOCK-IN-ARRAY       PIC S9(4) VALUE +0          01420001
014300                                                COMP SYNC.        01430001
014400     05  PV-FIRST-BLOCK-IN-RANGE      PIC S9(4) VALUE +0          01440001
014500                                                COMP SYNC.        01450001
014600     05  PV-LAST-BLOCK-IN-RANGE       PIC S9(4) VALUE +0          01460001
014700                                                COMP SYNC.        01470001
014800     05  PV-START-OF-SELECTED-RANGE   PIC S9(4) VALUE +0          01480001
014900                                                COMP SYNC.        01490001
015000     05  PV-END-OF-SELECTED-RANGE     PIC S9(4) VALUE +0          01500001
015100                                                COMP SYNC.        01510001
015200     05  PV-RETRY-COUNTER             PIC S9(4) VALUE +0          01520001
015300                                                COMP SYNC.        01530001
015400     05  PV-NULL-IND                  PIC S9(4) VALUE +0          01540001
015500                                                COMP SYNC.        01550001
015600     05  PV-READ-COUNT                PIC S9(9) VALUE +0 COMP-3.  01560001
015700     05  PV-ITEMS-PROCESSED           PIC S9(9) VALUE +0 COMP-3.  01570001
015800     05  PV-HOLD-SELECTED-ITEMS       PIC S9(9) VALUE +0 COMP-3.  01580001
015900     05  PV-ITEM-IN-USE               PIC S9(9) VALUE +0 COMP-3.  01590001
016000     05  PV-TOP-ITEM                  PIC S9(9) VALUE +0 COMP-3.  01600001
016100     05  PV-BOTTOM-ITEM               PIC S9(9) VALUE +0 COMP-3.  01610001
016200     05  PV-TEMP-BLOCK-NUMBER         PIC S9(9) VALUE +0 COMP-3.  01620001
016300     05  PV-DB2-COUNT                 PIC S9(9) VALUE +0 COMP-3.  01630001
016400                                                                  01640001
016500     05  PV-DB2-DATE.                                             01650001
016600         10  PV-DB2-CC                PIC X(02).                  01660001
016700         10  PV-DB2-YY                PIC X(02).                  01670001
016800         10  FILLER                   PIC X(01).                  01680001
016900         10  PV-DB2-MM                PIC X(02).                  01690001
017000         10  FILLER                   PIC X(01).                  01700001
017100         10  PV-DB2-DD                PIC X(02).                  01710001
017200*----------------------------------------------------------------*01720019
017300* INCLUDED PROGRAM CONSTANTS PV-CS-SKU.              WR # 21361  *01730038
017400*----------------------------------------------------------------*01740019
017500 01  PV-CS-SKU                        PIC X(08).                  01750019
017600*----------------------------------------------------------------*01760019
017700* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *01770038
017800*----------------------------------------------------------------*01780019
017900*---------------------------------------------------------------* 01790001
018000*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 01800001
018100*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 01810001
018200*   APPLICATION-SPECIFIC COMMAREA.                              * 01820001
018300*---------------------------------------------------------------* 01830001
018400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01840001
018500     05  LQW-BLOCK-MODIFIED           PIC X(01) VALUE SPACE.      01850001
018600     05  LQW-ITEM-ENTRIES OCCURS 12 TIMES INDEXED BY LQW-IDX.     01860001
018700         10  LQW-LIST-ITEM-NUMBER     PIC S9(09) COMP-3.          01870001
018800         10  LQW-TEMP-SELECTED-SW     PIC X(01).                  01880001
018900         10  LQW-SELECTED-SW          PIC X(01).                  01890001
019000             88  LQW-SELECT                     VALUE 'S'.        01900001
019100             88  LQW-DESELECT                   VALUE ' '.        01910001
019200         10  LQW-ACTION               PIC X(03).                  01920001
019300         10  LQW-LINE                 PIC 9(04).                  01930001
019400         10  LQW-CLASS                PIC X(02).                  01940001
019500         10  LQW-SKU.                                             01950005
019600             15  LQW-SKU-DEPT         PIC X(03).                  01960037
019700             15  LQW-SKU-CL-NBR       PIC X(02).                  01970037
019800*---------------------------------------------------------------* 01980016
019900*                                                 WR # 21361    * 01990038
020000*   LQW-SKU-SEQ-NBR FIELD IS INCREASED FROM X(03) TO X(08).     * 02000016
020100*---------------------------------------------------------------* 02010016
020200             15  LQW-SKU-SEQ-NBR      PIC X(08).                  02020015
020300*---------------------------------------------------------------* 02030016
020400*   CHANGES MADE FOR WR # 21361 ENDS HERE*                        02040038
020500*---------------------------------------------------------------* 02050016
020600         10  LQW-RATIO                PIC 9(05).                  02060005
020700         10  LQW-FCSE-QTY             PIC 9(05).                  02070001
020800         10  LQW-P2L-QTY              PIC 9(05).                  02080001
020900         10  LQW-ODD-QTY              PIC 9(05).                  02090001
021000         10  LQW-TOTAL-QTY            PIC 9(06).                  02100001
021100                                                                  02110001
021200*---------------------------------------------------------------* 02120001
021300*  RECORD LAYOUT(S) FOR THE LIST SELECTION TEMP STORAGE QUEUE.  * 02130006
021400*---------------------------------------------------------------* 02140001
021500     COPY RCWS801.                                                02150001
021600                                                                  02160001
021700     COPY RCWS013.                                                02170006
021800                                                                  02180006
021900     COPY RCWS074.                                                02190041
022000                                                                  02200041
022100***************************************************************** 02210041
022200*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 02220041
022300*             AUTOVERIFY (AUTOVE) MODULE (RCKUT127).            * 02230041
022400***************************************************************** 02240041
022500     COPY RCWS040.                                                02250041
022600                                                                  02260041
022700*---------------------------------------------------------------* 02270001
022800*    MAP LAYOUT                                                 * 02280001
022900*---------------------------------------------------------------* 02290001
023000     COPY RCKM812.                                                02300001
023100                                                                  02310001
023200 01  MR-OCCURS-LAYOUT REDEFINES RC812AO.                          02320001
023300     05  FILLER                       PIC X(143).                 02330051
023400     05  MR-SCROLL-AREA OCCURS 12 TIMES.                          02340001
023500         10  MR-SELECTL               PIC S9(04) COMP.            02350001
023600         10  MR-SELECTA               PIC  X(01).                 02360001
023700         10  MR-SELECTC               PIC  X(01).                 02370001
023800         10  MR-SELECTH               PIC  X(01).                 02380001
023900         10  MR-SELECT                PIC  X(01).                 02390001
024000                                                                  02400001
024100         10  MR-ACTIONL               PIC S9(04) COMP.            02410001
024200         10  MR-ACTIONA               PIC  X(01).                 02420001
024300         10  MR-ACTIONC               PIC  X(01).                 02430001
024400         10  MR-ACTIONH               PIC  X(01).                 02440001
024500         10  MR-ACTION                PIC  X(03).                 02450001
024600                                                                  02460001
024700         10  MR-LINEL                 PIC S9(04) COMP.            02470001
024800         10  MR-LINEA                 PIC  X(01).                 02480001
024900         10  MR-LINEC                 PIC  X(01).                 02490001
025000         10  MR-LINEH                 PIC  X(01).                 02500001
025100         10  MR-LINE                  PIC  9(04).                 02510001
025200                                                                  02520001
025300         10  MR-CLASSL                PIC S9(04) COMP.            02530001
025400         10  MR-CLASSA                PIC  X(01).                 02540001
025500         10  MR-CLASSC                PIC  X(01).                 02550001
025600         10  MR-CLASSH                PIC  X(01).                 02560001
025700         10  MR-CLASS                 PIC  X(02).                 02570001
025800                                                                  02580001
025900         10  MR-SKUL                  PIC S9(04) COMP.            02590001
026000         10  MR-SKUA                  PIC  X(01).                 02600001
026100         10  MR-SKUC                  PIC  X(01).                 02610001
026200         10  MR-SKUH                  PIC  X(01).                 02620001
026300         10  MR-SKU                   PIC  X(08).                 02630023
026400                                                                  02640001
026500         10  MR-RATIOL                PIC S9(04) COMP.            02650001
026600         10  MR-RATIOA                PIC  X(01).                 02660001
026700         10  MR-RATIOC                PIC  X(01).                 02670001
026800         10  MR-RATIOH                PIC  X(01).                 02680001
026900         10  MR-RATIO-X.                                          02690005
027000             15  MR-RATIO             PIC  Z(4)9.                 02700005
027100                                                                  02710001
027200         10  MR-FCSE-QTYL             PIC S9(04) COMP.            02720001
027300         10  MR-FCSE-QTYA             PIC  X(01).                 02730001
027400         10  MR-FCSE-QTYC             PIC  X(01).                 02740001
027500         10  MR-FCSE-QTYH             PIC  X(01).                 02750001
027600         10  MR-FCSE-QTY-X.                                       02760001
027700             15  MR-FCSE-QTY          PIC  Z(4)9.                 02770001
027800                                                                  02780001
027900         10  MR-P2L-QTYL              PIC S9(04) COMP.            02790001
028000         10  MR-P2L-QTYA              PIC  X(01).                 02800001
028100         10  MR-P2L-QTYC              PIC  X(01).                 02810001
028200         10  MR-P2L-QTYH              PIC  X(01).                 02820001
028300         10  MR-P2L-QTY-X.                                        02830001
028400             15  MR-P2L-QTY           PIC  Z(4)9.                 02840001
028500                                                                  02850001
028600         10  MR-ODD-QTYL              PIC S9(04) COMP.            02860001
028700         10  MR-ODD-QTYA              PIC  X(01).                 02870001
028800         10  MR-ODD-QTYC              PIC  X(01).                 02880001
028900         10  MR-ODD-QTYH              PIC  X(01).                 02890001
029000         10  MR-ODD-QTY-X.                                        02900001
029100             15  MR-ODD-QTY           PIC  Z(4)9.                 02910001
029200                                                                  02920001
029300         10  MR-TOTAL-QTYL            PIC S9(04) COMP.            02930001
029400         10  MR-TOTAL-QTYA            PIC  X(01).                 02940001
029500         10  MR-TOTAL-QTYC            PIC  X(01).                 02950001
029600         10  MR-TOTAL-QTYH            PIC  X(01).                 02960001
029700         10  MR-TOTAL-QTY-X.                                      02970001
029800             15  MR-TOTAL-QTY         PIC  Z(5)9.                 02980001
029900                                                                  02990001
030000*---------------------------------------------------------------* 03000001
030100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03010001
030200*---------------------------------------------------------------* 03020001
030300     COPY DPWS015.                                                03030001
030400                                                                  03040001
030500*---------------------------------------------------------------* 03050001
030600*    FUNCTION KEYS COPYBOOK.                                    * 03060001
030700*---------------------------------------------------------------* 03070001
030800     COPY DPWS016.                                                03080001
030900                                                                  03090001
031000*---------------------------------------------------------------* 03100001
031100*    NUMERIC EDIT LAYOUT.                                       * 03110001
031200*---------------------------------------------------------------* 03120001
031300     COPY DPWS010I.                                               03130001
031400                                                                  03140001
031500******************************************************************03150053
031600** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **03160053
031610** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **03161053
031700******************************************************************03170053
031800     COPY DPWS030.                                                03180001
031810     COPY DPWS930.                                                03181053
031900                                                                  03190001
032000*---------------------------------------------------------------* 03200001
032100*    STANDARD COMMAREA.                                         * 03210001
032200*---------------------------------------------------------------* 03220001
032300     COPY DPWS020.                                                03230001
032400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03240001
032500                                                                  03250001
032600*---------------------------------------------------------------* 03260001
032700* INTER-APPLICATION COMMAREA.                                   * 03270001
032800*---------------------------------------------------------------* 03280001
032900         10  INTER-APPL-COMM-AREA     PIC X(200).                 03290001
033000     COPY RCWS800.                                                03300001
033100     COPY RCWS015.                                                03310006
033200                                                                  03320001
033300*---------------------------------------------------------------* 03330001
033400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03340001
033500*---------------------------------------------------------------* 03350001
033600         10  ASC-SPECIFIC-COMMAREA.                               03360001
033700             15  ASC-INT-APPL-FORMAT-IND     PIC X(01).           03370001
033800             15  ASC-USE-SELECTION-QUEUE-IND PIC X(01).           03380001
033900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03390001
034000             15  ASC-SEL-QUEUE-NAME-IN       PIC X(08).           03400007
034100             15  ASC-NUMBER-OF-TS-ITEMS      PIC S9(5) COMP-3.    03410001
034200             15  ASC-SEL-SUB                 PIC S9(4) COMP.      03420001
034300             15  ASC-SEL-ITEM                PIC S9(4) COMP.      03430001
034400             15  ASC-LIST-KEYS.                                   03440001
034500                 20  ASC-KEY-PO-NBR          PIC S9(9) COMP.      03450001
034600                 20  ASC-KEY-REC-SEQ-NBR     PIC S9(9) COMP.      03460001
034700                 20  ASC-KEY-OPER-UNT-ID     PIC S9(4) COMP.      03470001
034800                 20  ASC-KEY-FCLTY-ID        PIC S9(4) COMP.      03480001
034900                 20  ASC-KEY-PACK-ID         PIC S9(4) COMP.      03490003
035000             15  ASC-HEADER-FIELDS.                               03500004
035100                 20  ASC-OPER-UNT-ID         PIC 9(04).           03510004
035200                 20  ASC-FCLTY-ID            PIC 9(04).           03520004
035210*CLP 10/20/14                                                     03521051
035300                 20  ASC-PO-NBR              PIC 9(08).           03530051
035400                 20  ASC-REC-SEQ-NBR         PIC 9(04).           03540004
035500                 20  ASC-PACK-ID             PIC 9(04).           03550004
035600                 20  ASC-FCSE-TOT            PIC S9(6).           03560012
035700                 20  ASC-P2L-TOT             PIC S9(6).           03570012
035800                 20  ASC-ODD-TOT             PIC S9(5).           03580012
035900                 20  ASC-DEPT                PIC X(03).           03590005
036000                 20  ASC-DEPT-N              PIC 9(04).           03600041
036100                 20  ASC-ZONE                PIC X(07).           03610006
036200                 20  ASC-STATUS-CDE          PIC X(02).           03620047
036300             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03630001
036400                 20  ASC-BLOCK-MODIFIED-SW   PIC X(01).           03640001
036500                     88  ASC-BLOCK-NOT-MODIFIED        VALUE 'N'. 03650001
036600                     88  ASC-BLOCK-MODIFIED            VALUE 'Y'. 03660001
036700                 20  ASC-ITEM-ARRAY.                              03670001
036800                     25  ASC-ITEM-ENTRIES OCCURS 12 TIMES.        03680001
036900                         30  ASC-LIST-ITEM-NUMBER                 03690001
037000                                             PIC S9(9) COMP-3.    03700001
037100                         30  ASC-TEMP-SELECTED-SW                 03710001
037200                                             PIC X(01).           03720001
037300                             88  ASC-VALID-SELECT      VALUE ' '  03730001
037400                                                             'S'. 03740001
037500                             88  ASC-TEMP-NO-SELECT    VALUE ' '. 03750001
037600                             88  ASC-TEMP-SELECT       VALUE 'S'. 03760001
037700                         30  ASC-SELECTED-SW                      03770001
037800                                             PIC X(01).           03780001
037900                             88  ASC-NO-SELECT         VALUE ' '. 03790001
038000                             88  ASC-SELECT            VALUE 'S'. 03800001
038100                         30  ASC-ACTION      PIC X(03).           03810001
038200                             88  ASC-DEL             VALUE 'DEL'. 03820001
038300                             88  ASC-INQ             VALUE 'INQ'. 03830001
038400                             88  ASC-UPD             VALUE 'UPD'. 03840001
038500                             88  ASC-ERR             VALUE 'ERR'. 03850001
038600                         30  ASC-LINE        PIC 9(04).           03860001
038700                         30  ASC-CLASS       PIC X(02).           03870001
038800                         30  ASC-SKU.                             03880005
038900                             35 ASC-SKU-DEPT     PIC X(03).       03890032
039000                             35 ASC-SKU-CLASS    PIC X(02).       03900032
039100*----------------------------------------------------------------*03910016
039200*                                             WR # 21361         *03920038
039300* CHANGED THE STRUCTURE OF ASC TO MATCH THE APPL COMMAREA.       *03930016
039400* ASC-SKU-SEQ-NBR FIELD IS INCREASED FROM X(03) TO X(08).        *03940016
039500*----------------------------------------------------------------*03950016
039600                             35 ASC-SKU-SEQ-NBR  PIC X(08).       03960025
039700*----------------------------------------------------------------*03970016
039800* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *03980038
039900*----------------------------------------------------------------*03990016
040000                         30  ASC-RATIO       PIC 9(05).           04000005
040100                         30  ASC-FCSE-QTY    PIC 9(05).           04010001
040200                         30  ASC-P2L-QTY     PIC 9(05).           04020001
040300                         30  ASC-ODD-QTY     PIC 9(05).           04030001
040400                         30  ASC-TOTAL-QTY   PIC 9(06).           04040001
040500                                                                  04050001
040600             15  ASC-BLK-SUB                 PIC S9(4) COMP SYNC. 04060001
040700             15  ASC-ITEM-SUB                PIC S9(4) COMP SYNC. 04070001
040800             15  ASC-NUMBER-OF-ITEMS-READ    PIC S9(9) COMP-3.    04080001
040900             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(9) COMP-3.   04090001
041000             15  ASC-ITEMS-DISPLAYED         PIC S9(3) COMP-3.    04100001
041100             15  ASC-ITEM-AT-TOP-OF-PANEL    PIC S9(9) COMP-3.    04110001
041200             15  ASC-ITEM-AT-BOT-OF-PANEL    PIC S9(9) COMP-3.    04120001
041300             15  ASC-HIGHEST-BLOCK-WRITTEN   PIC S9(4) COMP SYNC. 04130001
041400             15  ASC-START-OF-SELECTED-RANGE PIC S9(9) COMP-3.    04140001
041500             15  ASC-END-OF-SELECTED-RANGE   PIC S9(9) COMP-3.    04150001
041600             15  ASC-ITEMS-LEFT-INDICATOR    PIC X(01).           04160001
041700                 88  ASC-ITEMS-LEFT-ON-DB              VALUE 'Y'. 04170001
041800                 88  ASC-NO-ITEMS-LEFT-ON-DB           VALUE 'N'. 04180001
041900             15  ASC-TEMP-QUEUE-UPDATE-SW                         04190001
042000                                             PIC X(01).           04200001
042100                 88  ASC-UPDATE-TSQ                    VALUE 'Y'. 04210001
042200                 88  ASC-NO-TSQ-UPDATE                 VALUE ' '. 04220001
042300             15  ASC-LIST-QUEUE-NAME.                             04230001
042400                 20  ASC-LIST-TERM-ID        PIC X(04).           04240001
042500                 20  ASC-LIST-TASK-NUMBER    PIC S9(5) COMP-3.    04250001
042600                 20  ASC-LIST-SEQ            PIC 9(01).           04260001
042700             15  ASC-SEL-QUEUE-NAME.                              04270001
042800                 20  ASC-SEL-TERM-ID         PIC X(04).           04280001
042900                 20  ASC-SEL-TASK-NUMBER     PIC S9(5) COMP-3.    04290001
043000                 20  ASC-SEL-SEQ             PIC 9(01).           04300001
043100                                                                  04310001
043200             15  ASC-START-ITEM-REQUEST.                          04320001
043300                 20  ASC-START-ITEM-REQUEST-N PIC 9(7).           04330001
043400             15  ASC-AUTO-VE-SW                  PIC X(01).       04340041
043500                 88  ASC-AUTO-VE-YES                VALUE 'Y'.    04350041
043600                 88  ASC-AUTO-VE-NO                 VALUE 'N'.    04360041
043700                                                                  04370001
043800*---------------------------------------------------------------* 04380001
043900*    ABEND PROCESSING COPYBOOK.                                 * 04390001
044000*---------------------------------------------------------------* 04400001
044100     COPY DPWS013.                                                04410001
044200                                                                  04420001
044300******** LOGISTICS DOMAIN ITEM ACCESS COPYBOOK  ** WR/IR 21361 ***04430038
044400     COPY XLWS001.                                                04440016
044500****************************   END OF CHANGES   ** WR/IR 21361 ***04450038
044600*---------------------------------------------------------------* 04460001
044700*    DB2 AREA FOR DISTRIBUTION HEADER TABLE                     * 04470001
044800*---------------------------------------------------------------* 04480001
044900     EXEC SQL                                                     04490001
045000          INCLUDE TDISTHD                                         04500001
045100     END-EXEC.                                                    04510001
045200                                                                  04520001
045300*---------------------------------------------------------------* 04530001
045400*    DB2 AREA FOR THE DISTRIBUTION DETAIL TABLE                 * 04540001
045500*---------------------------------------------------------------* 04550001
045600     EXEC SQL                                                     04560001
045700          INCLUDE TDISTDT                                         04570001
045800     END-EXEC.                                                    04580001
045900                                                                  04590001
046000*---------------------------------------------------------------* 04600001
046100*    DB2 AREA FOR THE RECEIVER HEADER TABLE                     * 04610001
046200*---------------------------------------------------------------* 04620001
046300     EXEC SQL                                                     04630001
046400          INCLUDE TRECEIV                                         04640001
046500     END-EXEC.                                                    04650001
046600                                                                  04660001
046700*---------------------------------------------------------------* 04670005
046800*    DB2 AREA FOR THE RECEIVER ITEM TABLE                       * 04680005
046900*---------------------------------------------------------------* 04690005
047000     EXEC SQL                                                     04700005
047100          INCLUDE TRECITM                                         04710005
047200     END-EXEC.                                                    04720005
047300                                                                  04730005
047400*---------------------------------------------------------------* 04740005
047500*    DB2 AREA FOR THE PURCHASE HEADER TABLE                     * 04750005
047600*---------------------------------------------------------------* 04760005
047700     EXEC SQL                                                     04770005
047800          INCLUDE TPURCHS                                         04780005
047900     END-EXEC.                                                    04790005
048000                                                                  04800005
048100*---------------------------------------------------------------* 04810005
048200*    DB2 AREA FOR THE PURCHASE ITEM TABLE                       * 04820005
048300*---------------------------------------------------------------* 04830005
048400     EXEC SQL                                                     04840005
048500          INCLUDE TPURITM                                         04850005
048600     END-EXEC.                                                    04860005
048700                                                                  04870005
048800*---------------------------------------------------------------* 04880006
048900*    DB2 AREA FOR THE MERCHANDISING TABLE                       * 04890006
049000*---------------------------------------------------------------* 04900006
049100     EXEC SQL                                                     04910006
049200          INCLUDE TMDSEDP                                         04920006
049300     END-EXEC.                                                    04930006
049400                                                                  04940006
049500*---------------------------------------------------------------* 04950006
049600*    DB2 AREA FOR THE MERCHANDISING TABLE                       * 04960006
049700*---------------------------------------------------------------* 04970006
049800     EXEC SQL                                                     04980006
049900          INCLUDE TMDSEAR                                         04990006
050000     END-EXEC.                                                    05000006
050100                                                                  05010006
050200*---------------------------------------------------------------* 05020001
050300*    DB2 AREA FOR COMMUNICATIONS                                * 05030001
050400*---------------------------------------------------------------* 05040001
050500     EXEC SQL                                                     05050001
050600          INCLUDE SQLCA                                           05060001
050700     END-EXEC.                                                    05070001
050800                                                                  05080001
050900*---------------------------------------------------------------* 05090001
051000*  CURSOR TO SELECT DETAIL LINES (BY PACK ID)                   * 05100001
051100*---------------------------------------------------------------* 05110001
051200                                                                  05120001
051300     EXEC SQL                                                     05130001
051400          DECLARE PREPK-SEARCH-CSR CURSOR FOR                     05140001
051500           SELECT A.ORD_LNE_NBR                                   05150001
051600                , A.PREPK_RATO_QTY                                05160005
051700             FROM TRECITM A                                       05170001
051800            WHERE A.ORD_NBR        = :DK-ORD-NBR                  05180001
051900              AND A.REC_SEQ_NBR    = :DK-RCVR-NBR                 05190001
052000              AND A.PREPK_ID       = :DK-PREPK-ID                 05200001
052100         ORDER BY A.ORD_LNE_NBR                                   05210001
052200     END-EXEC.                                                    05220001
052300                                                                  05230001
052400*---------------------------------------------------------------* 05240001
052500*---------------------------------------------------------------* 05250001
052600 LINKAGE SECTION.                                                 05260001
052700                                                                  05270001
052800 01  DFHCOMMAREA.                                                 05280001
052900     05  FILLER                         OCCURS  1 TO 4072 TIMES   05290001
053000                                        DEPENDING ON EIBCALEN.    05300001
053100         10  FILLER                     PIC X.                    05310001
053200                                                                  05320001
053300***************************************************************** 05330001
053400***************************************************************** 05340001
053500 PROCEDURE DIVISION.                                              05350001
053600*---------------------------------------------------------------* 05360001
053700*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 05370001
053800*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 05380001
053900*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 05390001
054000*---------------------------------------------------------------* 05400001
054100 0000-MAIN-MODULE.                                                05410001
054200                                                                  05420001
054300     INITIALIZE DP030-CICS-API-FIELDS.                            05430001
054400                                                                  05440001
054500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05450001
054600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05460001
054700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05470001
054800                                                                  05480001
054900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05490001
055000                                                                  05500001
055100     MOVE LENGTH OF RC812AI        TO DP030-MAP-LENGTH (1).       05510001
055200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05520001
055300     SET DP030-OVERRIDE-APPL-ERROR TO TRUE.                       05530001
055400                                                                  05540001
055500     PERFORM 0001-CALL-CICS-ARCH-API.                             05550001
055600     PERFORM 1000-CONTROL-PROCESSING                              05560001
055700                                                                  05570001
055800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05580001
055900     PERFORM 0001-CALL-CICS-ARCH-API.                             05590001
056000                                                                  05600001
056100*---------------------------------------------------------------* 05610001
056200*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 05620001
056300*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 05630001
056400*---------------------------------------------------------------* 05640001
056500 0001-CALL-CICS-ARCH-API.                                         05650001
056610     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05661053
056700                                    DFHCOMMAREA                   05670053
056800                                    DP030-CICS-API-FIELDS         05680053
056900                                    DP020-STANDARD-COMMAREA       05690053
057000                                    RC812AI.                      05700053
057100                                                                  05710001
057200     IF DP030-RC-CALL-SUCCESSFUL OR                               05720001
057300        DP030-RC-APPL-ERROR                                       05730001
057400         CONTINUE                                                 05740001
057500     ELSE                                                         05750001
057600         SET DP013-NO-ROLLBACK                                    05760001
057700             DP013-XCTL-DISPLAY-RESTART                           05770001
057800             DP013-CICS-ABEND      TO TRUE                        05780001
057900         MOVE '0001-CALL-CICS-ARCH-API'                           05790001
058000                                   TO DP013-PARAGRAPH             05800001
058020         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O05802053
058030-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05803053
058300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05830001
058400         PERFORM DP013-0000-PROCESS-ABEND                         05840001
058500     END-IF.                                                      05850001
058600                                                                  05860001
058700*----------------------------------------------------------------*05870001
058800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05880001
058900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05890001
059000*                                                                *05900001
059100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05910001
059200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05920001
059300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05930001
059400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05940001
059500*----------------------------------------------------------------*05950001
059600 1000-CONTROL-PROCESSING.                                         05960001
059700                                                                  05970001
059800     EVALUATE TRUE                                                05980001
059900         WHEN DP030-RC-APPL-ERROR                                 05990001
060000             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06000001
060100             MOVE ZEROES      TO ASC-ITEM-AT-TOP-OF-PANEL         06010001
060200             PERFORM 4000-BUILD-INITIAL-PANEL                     06020008
060300             PERFORM 3200-RESET-ATTRIBUTES                        06030008
060400                                                                  06040001
060500         WHEN DP020-NEXT-ACT-INITIAL                              06050001
060600             INITIALIZE ASC-SPECIFIC-COMMAREA                     06060001
060700             MOVE EIBTRMID          TO ASC-LIST-TERM-ID           06070001
060800                                       ASC-SEL-TERM-ID            06080001
060900             MOVE DP020-SRC-TASK-NUMBER                           06090001
061000                                    TO ASC-LIST-TASK-NUMBER       06100001
061100                                       ASC-SEL-TASK-NUMBER        06110001
061200             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               06120001
061300             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                06130001
061400             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06140001
061500             IF PS-COMMAREA-NOT-VALID                             06150001
061600                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            06160001
061700             ELSE                                                 06170001
061800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06180008
061900                 PERFORM 3200-RESET-ATTRIBUTES                    06190008
062000             END-IF                                               06200001
062100                                                                  06210001
062200         WHEN DP020-NEXT-ACT-READ-MAP                             06220001
062300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06230001
062400             PERFORM 2000-PROCESS-PANEL                           06240001
062500                                                                  06250001
062600         WHEN DP020-NEXT-ACT-RETURN                               06260001
062700             MOVE ASC-KEY-PO-NBR      TO DK-ORD-NBR               06270008
062800             MOVE ASC-KEY-REC-SEQ-NBR TO DK-RCVR-NBR              06280008
062900             MOVE ASC-KEY-OPER-UNT-ID TO DK-OPER-UNT-ID           06290008
063000             MOVE ASC-KEY-FCLTY-ID    TO DK-FCLTY-ID              06300008
063100             MOVE ASC-KEY-PACK-ID     TO DK-PREPK-ID              06310008
063200                                                                  06320008
063300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06330001
063400             MOVE ZEROES      TO ASC-ITEM-AT-TOP-OF-PANEL         06340001
063500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 06350001
063600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06360001
063700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06370001
063800                                                                  06380001
063900         WHEN OTHER                                               06390001
064000             SET DP013-LOGIC-ABEND TO TRUE                        06400001
064100             SET DP013-NO-ROLLBACK TO TRUE                        06410001
064200             MOVE '1000-CONTROL-PROCESSING'                       06420001
064300                                   TO DP013-PARAGRAPH             06430001
064400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06440001
064500                                   TO DP013-MESSAGE-TEXT(1)       06450001
064600             PERFORM DP013-0000-PROCESS-ABEND                     06460001
064700     END-EVALUATE.                                                06470001
064800                                                                  06480001
064900*----------------------------------------------------------------*06490001
065000* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *06500001
065100*----------------------------------------------------------------*06510001
065200 1100-PROCESS-INTER-APPL-COMM.                                    06520001
065300                                                                  06530001
065400     SET PS-COMMAREA-VALID         TO TRUE.                       06540001
065500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06550001
065600                                                                  06560001
065700     IF RC800-NUMBER-OF-SELECTED-ITEMS = ZERO                     06570001
065800         SET ASC-NO-TSQ-UPDATE TO TRUE                            06580001
065900         SET DP020-MSG-FATAL                                      06590001
066000             DP020-NEXT-ACT-APPL-ERROR                            06600001
066100             PS-ERROR          TO TRUE                            06610001
066200         MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER                06620001
066300     ELSE                                                         06630001
066400         MOVE RC800-REC-NBR-N      TO ASC-KEY-PO-NBR              06640001
066500                                      ASC-PO-NBR                  06650004
066600         MOVE RC800-REC-SEQ-NBR-N  TO ASC-KEY-REC-SEQ-NBR         06660001
066700                                      ASC-REC-SEQ-NBR             06670004
066800         MOVE RC800-OPER-UNIT-ID   TO ASC-KEY-OPER-UNT-ID         06680001
066900                                      ASC-OPER-UNT-ID             06690004
067000         MOVE RC800-FACILITY-ID    TO ASC-KEY-FCLTY-ID            06700001
067100                                      ASC-FCLTY-ID                06710004
067200                                                                  06720001
067300         SET ASC-USE-SELECTION-QUEUE TO TRUE                      06730001
067400                                                                  06740001
067500         MOVE RC800-NUMBER-OF-SELECTED-ITEMS                      06750001
067600                                  TO ASC-NUMBER-OF-SELECTED-ITEMS 06760001
067700         MOVE RC800-NUMBER-OF-TS-ITEMS                            06770001
067800                                   TO ASC-NUMBER-OF-TS-ITEMS      06780001
067900         MOVE RC800-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME-IN       06790007
068000         MOVE RC801-MAX-ITEMS      TO ASC-SEL-SUB                 06800001
068100         MOVE ZEROES               TO ASC-SEL-ITEM                06810001
068200         PERFORM 2160-GET-NEXT-RECORD                             06820001
068300     END-IF.                                                      06830003
068400                                                                  06840001
068500*----------------------------------------------------------------*06850001
068600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06860001
068700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06870001
068800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06880001
068900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06890001
069000* FUNCTION KEYS CAN GET THIS FAR.                                *06900001
069100*----------------------------------------------------------------*06910001
069200 2000-PROCESS-PANEL.                                              06920001
069300     EVALUATE TRUE                                                06930001
069400         WHEN DP020-SRC-AID = DP016-CLEAR                         06940001
069500             MOVE ZEROES TO ASC-ITEM-AT-TOP-OF-PANEL              06950001
069600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06960001
069700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06970001
069800                                                                  06980001
069900         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06990001
070000             PERFORM 2050-DELETE-LIST-QUEUE                       07000001
070100             PERFORM 4000-BUILD-INITIAL-PANEL                     07010001
070200             PERFORM 3200-RESET-ATTRIBUTES                        07020006
070300                                                                  07030001
070400         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07040001
070500             PERFORM 2140-DESELECT-ALL-ITEMS                      07050001
070600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07060001
070700                                                                  07070001
070800         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 07080001
070900              PERFORM 2150-SELECT-ALL-ITEMS                       07090001
071000              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                07100001
071100                                                                  07110001
071200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07120001
071300             IF ASC-USE-SELECTION-QUEUE                           07130001
071400                 PERFORM 2050-DELETE-LIST-QUEUE                   07140003
071500                 PERFORM 2160-GET-NEXT-RECORD                     07150001
071600                 PERFORM 4000-BUILD-INITIAL-PANEL                 07160001
071700                 PERFORM 3200-RESET-ATTRIBUTES                    07170001
071800             ELSE                                                 07180001
071900*--- BOTTOM OF LIST ---                                           07190001
072000                 PERFORM 3200-RESET-ATTRIBUTES                    07200006
072100                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07210001
072200                 SET DP020-MSG-INFORMATIONAL TO TRUE              07220001
072300             END-IF                                               07230001
072400                                                                  07240001
072500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07250001
072600             IF ASC-USE-SELECTION-QUEUE                           07260001
072700                 PERFORM 2050-DELETE-LIST-QUEUE                   07270003
072800                 PERFORM 2170-GET-PREV-RECORD                     07280001
072900                 PERFORM 4000-BUILD-INITIAL-PANEL                 07290001
073000                 PERFORM 3200-RESET-ATTRIBUTES                    07300001
073100             ELSE                                                 07310001
073200*--- TOP OF LIST ---                                              07320001
073300                 PERFORM 3200-RESET-ATTRIBUTES                    07330006
073400                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         07340001
073500                 SET DP020-MSG-INFORMATIONAL TO TRUE              07350001
073600             END-IF                                               07360001
073700                                                                  07370001
073800         WHEN OTHER                                               07380001
073900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07390001
074000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07400001
074100             IF  PS-NO-ERROR                                      07410001
074200                 SET DP030-CONTINUE-GO TO TRUE                    07420001
074300                 PERFORM 2100-CHECK-FUNCTION-KEY                  07430001
074400             ELSE                                                 07440001
074500                 SET DP030-OVERRIDE-GO TO TRUE                    07450001
074600             END-IF                                               07460001
074700     END-EVALUATE.                                                07470001
074800                                                                  07480001
074900*----------------------------------------------------------------*07490001
075000*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07500001
075100*----------------------------------------------------------------*07510001
075200 2050-DELETE-LIST-QUEUE.                                          07520001
075300                                                                  07530001
075400     EXEC CICS                                                    07540001
075500         DELETEQ TS                                               07550001
075600           QUEUE (ASC-LIST-QUEUE-NAME)                            07560001
075700            RESP (PV-CICS-RESP)                                   07570001
075800     END-EXEC.                                                    07580001
075900                                                                  07590001
076000     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07600001
076100        (PV-CICS-RESP = DFHRESP(QIDERR))                          07610001
076200         CONTINUE                                                 07620001
076300     ELSE                                                         07630001
076400         SET DP013-CICS-ABEND      TO TRUE                        07640001
076500         SET DP013-NO-ROLLBACK     TO TRUE                        07650001
076600                                                                  07660001
076700         MOVE '2050-DELETE-LIST-QUEUE'                            07670001
076800                                   TO DP013-PARAGRAPH             07680001
076900         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07690001
077000                                   TO DP013-MESSAGE-TEXT (1)      07700001
077100         PERFORM DP013-0000-PROCESS-ABEND                         07710001
077200     END-IF.                                                      07720001
077300                                                                  07730001
077400     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07740001
077500                                                                  07750001
077600*----------------------------------------------------------------*07760001
077700* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07770001
077800* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07780001
077900* CICS ARCHITECTURE API.                                         *07790001
078000*----------------------------------------------------------------*07800001
078100 2100-CHECK-FUNCTION-KEY.                                         07810001
078200                                                                  07820001
078300     EVALUATE TRUE                                                07830001
078400*F22=STR LIST (RCKCS298 - 'RCLFCSTR')                             07840006
078500     WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)                  07850006
078600         IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO                   07860006
078700             MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER            07870006
078800             MOVE -1               TO MR-SELECTL (1)              07880006
078900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07890006
079000             SET PS-ERROR          TO TRUE                        07900006
079100             SET DP030-OVERRIDE-GO TO TRUE                        07910006
079200             SET DP020-MSG-FATAL   TO TRUE                        07920006
079300             SET ASC-NO-TSQ-UPDATE TO TRUE                        07930006
079400         ELSE                                                     07940006
079500             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    07950006
079600               TO RC013-SELECTED-ITEMS                            07960006
079700             PERFORM 5000-PREPARE-SEL-QUEUE                       07970006
079800             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    07980006
079900               TO RC015-NUMBER-OF-SELECTED-ITEMS                  07990006
080000         END-IF                                                   08000006
080100                                                                  08010006
080200         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08020001
080300             MOVE +1 TO PV-TOP-ITEM                               08030001
080400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08040001
080500             PERFORM 3200-RESET-ATTRIBUTES                        08050006
080600                                                                  08060001
080700         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08070001
080800             PERFORM 2110-BROWSE-BACKWARD                         08080001
080900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08090001
081000             PERFORM 3200-RESET-ATTRIBUTES                        08100006
081100                                                                  08110001
081200         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08120001
081300             PERFORM 2120-BROWSE-FORWARD                          08130001
081400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08140001
081500             PERFORM 3200-RESET-ATTRIBUTES                        08150006
081600                                                                  08160001
081700         WHEN DP020-SRC-AID = DP016-ENTER                         08170001
081800             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08180001
081900             IF PS-ERROR                                          08190001
082000                 CONTINUE                                         08200001
082100             ELSE                                                 08210001
082200                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08220001
082300             END-IF                                               08230001
082400                                                                  08240001
082500         WHEN OTHER                                               08250001
082600             SET DP013-NO-ROLLBACK                                08260001
082700                 DP013-XCTL-DISPLAY-RESTART                       08270001
082800                 DP013-CICS-ABEND  TO TRUE                        08280001
082900             MOVE '2100-CHECK-FUNCTION-KEY'                       08290001
083000                                   TO DP013-PARAGRAPH             08300001
083100             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08310001
083200                                   TO DP013-MESSAGE-TEXT (1)      08320001
083300             PERFORM DP013-0000-PROCESS-ABEND                     08330001
083400     END-EVALUATE.                                                08340001
083500                                                                  08350001
083600*----------------------------------------------------------------*08360001
083700*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08370001
083800*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08380001
083900*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08390001
084000*    MESSAGE.                                                    *08400001
084100*----------------------------------------------------------------*08410001
084200 2110-BROWSE-BACKWARD.                                            08420001
084300                                                                  08430001
084400     SUBTRACT PC-ITEMS-PER-PANEL                                  08440001
084500         FROM ASC-ITEM-AT-TOP-OF-PANEL                            08450001
084600         GIVING PV-TOP-ITEM.                                      08460001
084700                                                                  08470001
084800     IF ((PV-TOP-ITEM < +1)                                       08480001
084900       OR (PV-TOP-ITEM = +1))                                     08490001
085000         MOVE +1                     TO PV-TOP-ITEM               08500001
085100* -- TOP OF LIST --                                               08510001
085200         MOVE PC-TSYMSG-00069        TO DP020-MSG-NUMBER          08520001
085300         SET DP020-MSG-INFORMATIONAL TO TRUE                      08530001
085400     END-IF.                                                      08540001
085500                                                                  08550001
085600*----------------------------------------------------------------*08560001
085700*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08570001
085800*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08580001
085900*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08590001
086000*----------------------------------------------------------------*08600001
086100 2120-BROWSE-FORWARD.                                             08610001
086200                                                                  08620001
086300     ADD PC-ITEMS-PER-PANEL                                       08630001
086400         ASC-ITEM-AT-TOP-OF-PANEL                                 08640001
086500         GIVING PV-TOP-ITEM.                                      08650001
086600                                                                  08660001
086700     IF PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                    08670001
086800         MOVE ASC-ITEM-AT-TOP-OF-PANEL   TO PV-TOP-ITEM           08680001
086900* -- BOTTOM OF LIST --                                            08690001
087000         MOVE PC-TSYMSG-00070            TO DP020-MSG-NUMBER      08700001
087100         SET DP020-MSG-INFORMATIONAL     TO TRUE                  08710001
087200     ELSE                                                         08720001
087300         COMPUTE PV-BOTTOM-ITEM = PV-TOP-ITEM                     08730001
087400                                + PC-ITEMS-PER-PANEL - 1          08740001
087500         IF PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ             08750001
087600* -- BOTTOM OF LIST --                                            08760001
087700             MOVE PC-TSYMSG-00070        TO DP020-MSG-NUMBER      08770001
087800             SET DP020-MSG-INFORMATIONAL TO TRUE                  08780001
087900         END-IF                                                   08790001
088000     END-IF.                                                      08800001
088100                                                                  08810001
088200*----------------------------------------------------------------*08820001
088300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08830001
088400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08840001
088500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08850001
088600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08860001
088700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08870001
088800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08880001
088900*----------------------------------------------------------------*08890001
089000 2130-CHECK-FOR-JUMP-BROWSE.                                      08900001
089100                                                                  08910001
089200     SET PS-NO-ERROR               TO TRUE.                       08920001
089300     IF (ASC-START-ITEM-REQUEST = SPACE)                          08930001
089400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08940001
089500                                   TO PV-TOP-ITEM                 08950001
089600     ELSE                                                         08960001
089700         MOVE ASC-START-ITEM-REQUEST                              08970001
089800                                   TO DP010I-UNEDITED-FIELD       08980001
089900         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08990001
090000         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     09000001
090100         SET DP010I-NEGATIVE-NOT-ALLOWED                          09010001
090200                                   TO TRUE                        09020001
090310         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09031052
090320              USING DP010I-NUMERIC-EDIT-AREA                      09032052
090400                                                                  09040001
090500         IF  NOT DP010I-ERROR-DETECTED                            09050001
090600             MOVE DP010I-NUMERIC-FIELD                            09060001
090700                                   TO ASC-START-ITEM-REQUEST-N    09070001
090800             IF  ASC-START-ITEM-REQUEST-N > ZERO                  09080001
090900                 IF  ASC-START-ITEM-REQUEST-N >                   09090001
091000                                          ASC-NUMBER-OF-ITEMS-READ09100001
091100                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09110001
091200                     COMPUTE PV-TOP-ITEM =                        09120001
091300                             ASC-NUMBER-OF-ITEMS-READ             09130001
091400                             - PC-ITEMS-PER-PANEL + 1             09140001
091500                     IF  PV-TOP-ITEM < +1                         09150001
091600                         MOVE +1   TO PV-TOP-ITEM                 09160001
091700                         MOVE PC-TSYMSG-00070                     09170001
091800                                   TO DP020-MSG-NUMBER            09180001
091900                         SET DP020-MSG-INFORMATIONAL              09190001
092000                                   TO TRUE                        09200001
092100                     END-IF                                       09210001
092200                 ELSE                                             09220001
092300                     MOVE ASC-START-ITEM-REQUEST-N                09230001
092400                                   TO PV-TOP-ITEM                 09240001
092500                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09250001
092600                     COMPUTE PV-BOTTOM-ITEM =                     09260001
092700                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09270001
092800                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09280001
092900*                        -- BOTTOM OF LIST --                     09290001
093000                         MOVE PC-TSYMSG-00070                     09300001
093100                                   TO DP020-MSG-NUMBER            09310001
093200                         SET DP020-MSG-INFORMATIONAL              09320001
093300                                   TO TRUE                        09330001
093400                     END-IF                                       09340001
093500                 END-IF                                           09350001
093600             ELSE                                                 09360001
093700*                --- VALUE OUT OF RANGE ----                      09370001
093800                 MOVE PC-TSYMSG-00101                             09380001
093900                                   TO DP020-MSG-NUMBER            09390001
094000                 MOVE -1           TO ASTRTITL                    09400001
094100                 SET DP030-SET-CURSOR-APPL-1                      09410001
094200                                   TO TRUE                        09420001
094300                 MOVE DP015-REVERSE                               09430001
094400                                   TO ASTRTITH                    09440001
094500                 MOVE DP015-RED    TO ASTRTITC                    09450001
094600                 MOVE DP015-UNP-NUM-BRT-MDT                       09460001
094700                                   TO ASTRTITA                    09470001
094800                 SET DP020-MSG-FATAL                              09480001
094900                                   TO TRUE                        09490001
095000                 SET PS-ERROR      TO TRUE                        09500001
095100             END-IF                                               09510001
095200                                                                  09520001
095300         ELSE                                                     09530001
095400             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09540001
095500             MOVE -1               TO ASTRTITL                    09550001
095600             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09560001
095700             MOVE DP015-REVERSE    TO ASTRTITH                    09570001
095800             MOVE DP015-RED        TO ASTRTITC                    09580001
095900             MOVE DP015-UNP-NUM-BRT-MDT                           09590001
096000                                   TO ASTRTITA                    09600001
096100             SET DP020-MSG-FATAL   TO TRUE                        09610001
096200             SET PS-ERROR          TO TRUE                        09620001
096300         END-IF                                                   09630001
096400     END-IF.                                                      09640001
096500                                                                  09650001
096600*----------------------------------------------------------------*09660001
096700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09670001
096800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09680001
096900*----------------------------------------------------------------*09690001
097000 2140-DESELECT-ALL-ITEMS.                                         09700001
097100                                                                  09710001
097200     MOVE +1                       TO ASC-BLK-SUB.                09720001
097300                                                                  09730001
097400     PERFORM 2141-CLEAR-SELECTED-INDS                             09740001
097500         VARYING ASC-ITEM-SUB                                     09750001
097600         FROM 1 BY 1                                              09760001
097700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09770001
097800                                                                  09780001
097900     ADD +1                        TO ASC-BLK-SUB.                09790001
098000                                                                  09800001
098100     PERFORM 2141-CLEAR-SELECTED-INDS                             09810001
098200         VARYING ASC-ITEM-SUB                                     09820001
098300         FROM 1 BY 1                                              09830001
098400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09840001
098500                                                                  09850001
098600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09860001
098700                                   TO PV-LIST-ITEM-NUMBER.        09870001
098800                                                                  09880001
098900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09890001
099000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09900001
099100                                                                  09910001
099200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09920001
099300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09930001
099400         MOVE +1                   TO ASC-BLK-SUB                 09940001
099500                                                                  09950001
099600         PERFORM 5100-WRITE-TEMP-STORAGE                          09960001
099700                                                                  09970001
099800         MOVE +1                   TO PV-BLOCK-NUMBER             09980001
099900                                                                  09990001
100000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10000001
100100             PV-FIRST-BLOCK-IN-ARRAY - 1                          10010001
100200                                                                  10020001
100300         PERFORM                                                  10030001
100400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10040001
100500                                                                  10050001
100600             PERFORM 4410-READ-TEMP-STORAGE                       10060001
100700                                                                  10070001
100800             PERFORM 2141-CLEAR-SELECTED-INDS                     10080001
100900                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10090001
101000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10100001
101100                                                                  10110001
101200             PERFORM 5100-WRITE-TEMP-STORAGE                      10120001
101300                                                                  10130001
101400             ADD +1                TO PV-BLOCK-NUMBER             10140001
101500                                                                  10150001
101600         END-PERFORM                                              10160001
101700                                                                  10170001
101800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10180001
101900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10190001
102000                                                                  10200001
102100         PERFORM                                                  10210001
102200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10220001
102300                   ASC-HIGHEST-BLOCK-WRITTEN                      10230001
102400                                                                  10240001
102500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10250001
102600                                   TO PV-BLOCK-NUMBER             10260001
102700                                                                  10270001
102800             PERFORM 4410-READ-TEMP-STORAGE                       10280001
102900                                                                  10290001
103000             PERFORM 2141-CLEAR-SELECTED-INDS                     10300001
103100                 VARYING ASC-ITEM-SUB                             10310001
103200                 FROM 1 BY 1                                      10320001
103300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10330001
103400                                                                  10340001
103500             PERFORM 5100-WRITE-TEMP-STORAGE                      10350001
103600                                                                  10360001
103700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10370001
103800                                                                  10380001
103900         END-PERFORM                                              10390001
104000                                                                  10400001
104100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10410001
104200                                   TO PV-BLOCK-NUMBER             10420001
104300                                                                  10430001
104400         PERFORM 4410-READ-TEMP-STORAGE                           10440001
104500     END-IF.                                                      10450001
104600                                                                  10460001
104700                                                                  10470001
104800     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.10480001
104900     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 10490001
105000     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   10500001
105100                                                                  10510001
105200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10520001
105300                                                                  10530001
105400*----------------------------------------------------------------*10540001
105500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10550001
105600*----------------------------------------------------------------*10560001
105700 2141-CLEAR-SELECTED-INDS.                                        10570001
105800                                                                  10580001
105900     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          10590001
106000             NOT EQUAL ZERO                                       10600001
106100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10610001
106200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10620001
106300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10630001
106400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10640001
106500                                   TO TRUE                        10650001
106600         END-IF                                                   10660001
106700     END-IF.                                                      10670001
106800                                                                  10680001
106900*----------------------------------------------------------------*10690001
107000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10700001
107100*  FOR ALL ITEMS.                                                *10710001
107200*----------------------------------------------------------------*10720001
107300 2150-SELECT-ALL-ITEMS.                                           10730001
107400                                                                  10740001
107500     MOVE +1                       TO ASC-BLK-SUB.                10750001
107600                                                                  10760001
107700     PERFORM 2151-SET-SELECTED-INDS                               10770001
107800         VARYING ASC-ITEM-SUB                                     10780001
107900         FROM 1 BY 1                                              10790001
108000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10800001
108100                                                                  10810001
108200     ADD +1                        TO ASC-BLK-SUB.                10820001
108300                                                                  10830001
108400     PERFORM 2151-SET-SELECTED-INDS                               10840001
108500         VARYING ASC-ITEM-SUB                                     10850001
108600         FROM 1 BY 1                                              10860001
108700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10870001
108800                                                                  10880001
108900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10890001
109000                                   TO PV-LIST-ITEM-NUMBER.        10900001
109100                                                                  10910001
109200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10920001
109300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10930001
109400                                                                  10940001
109500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10950001
109600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10960001
109700         MOVE +1                   TO ASC-BLK-SUB                 10970001
109800                                                                  10980001
109900         PERFORM 5100-WRITE-TEMP-STORAGE                          10990001
110000                                                                  11000001
110100         MOVE +1                   TO PV-BLOCK-NUMBER             11010001
110200                                                                  11020001
110300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11030001
110400             PV-FIRST-BLOCK-IN-ARRAY - 1                          11040001
110500                                                                  11050001
110600         PERFORM                                                  11060001
110700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11070001
110800                                                                  11080001
110900             PERFORM 4410-READ-TEMP-STORAGE                       11090001
111000                                                                  11100001
111100             PERFORM 2151-SET-SELECTED-INDS                       11110001
111200                 VARYING ASC-ITEM-SUB                             11120001
111300                 FROM 1 BY 1                                      11130001
111400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11140001
111500                                                                  11150001
111600             PERFORM 5100-WRITE-TEMP-STORAGE                      11160001
111700                                                                  11170001
111800             ADD +1                TO PV-BLOCK-NUMBER             11180001
111900         END-PERFORM                                              11190001
112000                                                                  11200001
112100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11210001
112200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11220001
112300                                                                  11230001
112400         PERFORM                                                  11240001
112500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11250001
112600                   ASC-HIGHEST-BLOCK-WRITTEN                      11260001
112700                                                                  11270001
112800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11280001
112900                                   TO PV-BLOCK-NUMBER             11290001
113000                                                                  11300001
113100             PERFORM 4410-READ-TEMP-STORAGE                       11310001
113200                                                                  11320001
113300             PERFORM 2151-SET-SELECTED-INDS                       11330001
113400                 VARYING ASC-ITEM-SUB                             11340001
113500                 FROM 1 BY 1                                      11350001
113600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11360001
113700                                                                  11370001
113800             PERFORM 5100-WRITE-TEMP-STORAGE                      11380001
113900                                                                  11390001
114000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11400001
114100         END-PERFORM                                              11410001
114200                                                                  11420001
114300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             11430001
114400                                   TO PV-BLOCK-NUMBER             11440001
114500                                                                  11450001
114600         PERFORM 4410-READ-TEMP-STORAGE                           11460001
114700     END-IF.                                                      11470001
114800                                                                  11480001
114900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11490001
115000          ASC-NUMBER-OF-SELECTED-ITEMS.                           11500001
115100                                                                  11510001
115200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11520001
115300                                                                  11530001
115400*----------------------------------------------------------------*11540001
115500*    MARK EACH ITEM AS BEING SELECTED.                           *11550001
115600*----------------------------------------------------------------*11560001
115700 2151-SET-SELECTED-INDS.                                          11570001
115800                                                                  11580001
115900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11590001
116000             NOT EQUAL ZERO                                       11600001
116100         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11610001
116200             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11620001
116300                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11630001
116400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11640001
116500                                   TO TRUE                        11650001
116600         END-IF                                                   11660001
116700     END-IF.                                                      11670001
116800                                                                  11680001
116900******************************************************************11690001
117000* GET THE KEYS OF THE NEXT SELECTED OBJECT FROM THE              *11700001
117100* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *11710001
117200******************************************************************11720001
117300 2160-GET-NEXT-RECORD.                                            11730001
117400                                                                  11740001
117500     ADD  +1 TO ASC-SEL-SUB.                                      11750001
117600                                                                  11760001
117700     IF ASC-SEL-SUB > RC801-MAX-ITEMS                             11770001
117800         ADD  +1 TO ASC-SEL-ITEM                                  11780001
117900         MOVE +1 TO ASC-SEL-SUB                                   11790001
118000     END-IF.                                                      11800001
118100                                                                  11810001
118200     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 11820001
118300         PERFORM 9100-READ-SEL-QUEUE                              11830001
118400         IF RC801-ITEM (ASC-SEL-SUB) > ZERO                       11840001
118500             MOVE RC801-PACK-ID (ASC-SEL-SUB) TO ASC-KEY-PACK-ID  11850003
118600                                                 ASC-PACK-ID      11860004
118700             SET RC801-INQ (ASC-SEL-SUB) TO TRUE                  11870001
118800             PERFORM 9200-REWRITE-LIST-QUEUE                      11880001
118900         ELSE                                                     11890001
119000             SUBTRACT +1 FROM ASC-SEL-SUB                         11900001
119100*--- BOTTOM OF LIST ---                                           11910001
119200             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             11920001
119300             SET DP020-MSG-INFORMATIONAL TO TRUE                  11930001
119400         END-IF                                                   11940001
119500     ELSE                                                         11950001
119600         SUBTRACT +1 FROM ASC-SEL-ITEM                            11960001
119700         MOVE RC801-MAX-ITEMS TO ASC-SEL-SUB                      11970001
119800         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                 11980001
119900         SET DP020-MSG-INFORMATIONAL TO TRUE                      11990001
120000     END-IF.                                                      12000001
120100                                                                  12010001
120200******************************************************************12020001
120300* GET THE KEYS OF THE PREVIOUS SELECTED OBJECT FROM THE          *12030001
120400* INPUT SELECTED-ITEMS TEMP STORAGE QUEUE.                       *12040001
120500******************************************************************12050001
120600 2170-GET-PREV-RECORD.                                            12060001
120700                                                                  12070001
120800     SUBTRACT +1 FROM ASC-SEL-SUB.                                12080001
120900                                                                  12090001
121000     IF ASC-SEL-SUB < +1                                          12100001
121100         SUBTRACT +1 FROM ASC-SEL-ITEM                            12110001
121200         MOVE RC801-MAX-ITEMS TO ASC-SEL-SUB                      12120001
121300     END-IF.                                                      12130001
121400                                                                  12140001
121500     IF ASC-SEL-ITEM > ZERO                                       12150001
121600         PERFORM 9100-READ-SEL-QUEUE                              12160001
121700         MOVE RC801-PACK-ID (ASC-SEL-SUB) TO ASC-KEY-PACK-ID      12170003
121800                                             ASC-PACK-ID          12180004
121900     ELSE                                                         12190001
122000         MOVE +1 TO ASC-SEL-ITEM                                  12200001
122100                    ASC-SEL-SUB                                   12210001
122200*--- TOP OF LIST ---                                              12220001
122300         MOVE PC-TSYMSG-00069        TO DP020-MSG-NUMBER          12230001
122400         SET DP020-MSG-INFORMATIONAL TO TRUE                      12240001
122500     END-IF.                                                      12250001
122600                                                                  12260001
122700*----------------------------------------------------------------*12270001
122800*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *12280001
122900*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *12290001
123000*----------------------------------------------------------------*12300001
123100 2200-MOVE-SCREEN-TO-COMMAREA.                                    12310001
123200                                                                  12320001
123300     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             12330001
123400     MOVE +1                       TO PV-SUB.                     12340001
123500                                                                  12350001
123600     PERFORM 3100-SET-SUBSCRIPTS.                                 12360001
123700                                                                  12370001
123800     IF  ASTRTITL > ZERO                                          12380001
123900         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      12390001
124000     ELSE                                                         12400001
124100         IF  ASTRTITF = DP015-ERASE-EOF                           12410001
124200             INITIALIZE ASC-START-ITEM-REQUEST                    12420001
124300         END-IF                                                   12430001
124400     END-IF.                                                      12440001
124500                                                                  12450001
124600     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12460001
124700         VARYING PV-SUB                                           12470001
124800         FROM 1 BY 1                                              12480001
124900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12490001
125000                                                                  12500001
125100/                                                                 12510001
125200*----------------------------------------------------------------*12520001
125300*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *12530001
125400*----------------------------------------------------------------*12540001
125500 2210-MOVE-LINES-TO-COMMAREA.                                     12550001
125600                                                                  12560001
125700     IF  MR-SELECTL (PV-SUB) > ZERO                               12570001
125800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     12580001
125900                                   TO TRUE                        12590001
126000         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        12600001
126100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12610001
126200     ELSE                                                         12620001
126300         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                12630001
126400             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         12640001
126500             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        12650001
126600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12660001
126700         END-IF                                                   12670001
126800     END-IF.                                                      12680001
126900                                                                  12690001
127000     ADD +1                        TO ASC-ITEM-SUB.               12700001
127100                                                                  12710001
127200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        12720001
127300         ADD +1                    TO ASC-BLK-SUB                 12730001
127400         MOVE +1                   TO ASC-ITEM-SUB                12740001
127500     END-IF.                                                      12750001
127600                                                                  12760001
127700/                                                                 12770001
127800*----------------------------------------------------------------*12780001
127900*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *12790001
128000*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *12800001
128100*----------------------------------------------------------------*12810001
128200 3000-EDIT-DATA-IN-COMMAREA.                                      12820001
128300                                                                  12830001
128400     SET PS-NO-ERROR               TO TRUE.                       12840001
128500                                                                  12850001
128600     PERFORM 3200-RESET-ATTRIBUTES.                               12860001
128700                                                                  12870001
128800     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12880001
128900**                                                                12890001
129000* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12900001
129100* EDITTING IS DONE FROM THE BOTTOM UP.                            12910001
129200**                                                                12920001
129300     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12930001
129400         ASC-ITEMS-DISPLAYED - 1.                                 12940001
129500                                                                  12950001
129600     PERFORM 3100-SET-SUBSCRIPTS.                                 12960001
129700     PERFORM 3300-EDIT-SELECTIONS                                 12970001
129800       VARYING PV-SUB FROM PV-SUB BY -1                           12980001
129900         UNTIL PV-SUB < +1.                                       12990001
130000                                                                  13000001
130100*----------------------------------------------------------------*13010001
130200*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13020001
130300*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13030001
130400*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13040001
130500*                                                                *13050001
130600*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13060001
130700*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13070001
130800*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13080001
130900*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13090001
131000*----------------------------------------------------------------*13100001
131100 3100-SET-SUBSCRIPTS.                                             13110001
131200                                                                  13120001
131300     COMPUTE ASC-ITEM-SUB =                                       13130001
131400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13140001
131500                                                                  13150001
131600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13160001
131700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13170001
131800                                                                  13180001
131900         MOVE PC-MAX-BLOCKS-IN-ARRAY                              13190001
132000                                   TO ASC-BLK-SUB                 13200001
132100     ELSE                                                         13210001
132200         MOVE +1                   TO ASC-BLK-SUB                 13220001
132300     END-IF.                                                      13230001
132400                                                                  13240001
132500*----------------------------------------------------------------*13250001
132600*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *13260001
132700*----------------------------------------------------------------*13270001
132800 3200-RESET-ATTRIBUTES.                                           13280001
132900                                                                  13290001
133000     MOVE DP015-UNP-ALP-NOR-OFF     TO ASTRTITA.                  13300001
133100     MOVE DP015-GREEN               TO ASTRTITC.                  13310001
133200     MOVE DP015-UNDERLINE           TO ASTRTITH.                  13320001
133300                                                                  13330001
133400     PERFORM                                                      13340001
133500       VARYING PV-SUB FROM 1 BY 1                                 13350001
133600         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13360001
133700                                                                  13370001
133800         IF PV-SUB > ASC-NUMBER-OF-ITEMS-READ                     13380006
133900             MOVE DP015-ASK-DRK-OFF     TO MR-SELECTA (PV-SUB)    13390006
134000             MOVE DP015-HL-OFF          TO MR-SELECTH (PV-SUB)    13400006
134100             MOVE SPACE                 TO MR-SELECT (PV-SUB)     13410006
134200                                           MR-ACTION (PV-SUB)     13420006
134300         ELSE                                                     13430006
134400             MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    13440006
134500             MOVE DP015-GREEN           TO MR-SELECTC (PV-SUB)    13450006
134600             MOVE DP015-UNDERLINE       TO MR-SELECTH (PV-SUB)    13460006
134700         END-IF                                                   13470006
134800                                                                  13480001
134900     END-PERFORM.                                                 13490003
135000                                                                  13500001
135100*----------------------------------------------------------------*13510001
135200*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *13520001
135300*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *13530001
135400*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *13540001
135500*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *13550001
135600*----------------------------------------------------------------*13560001
135700 3300-EDIT-SELECTIONS.                                            13570001
135800                                                                  13580001
135900     EVALUATE TRUE                                                13590001
136000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13600001
136100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13610001
136200                 CONTINUE                                         13620001
136300                                                                  13630001
136400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13640001
136500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13650001
136600                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS13660001
136700                 MOVE ASC-TEMP-SELECTED-SW                        13670001
136800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13680001
136900                                   TO ASC-SELECTED-SW             13690001
137000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13700001
137100             END-IF                                               13710001
137200                                                                  13720001
137300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13730001
137400                 = SPACE                                          13740001
137500             EVALUATE TRUE                                        13750001
137600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13760001
137700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13770001
137800                     MOVE SPACE    TO ASC-SELECTED-SW             13780001
137900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13790001
138000                                                                  13800001
138100             END-EVALUATE                                         13810001
138200                                                                  13820001
138300         WHEN OTHER                                               13830001
138400             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            13840001
138500             SET DP020-MSG-FATAL   TO TRUE                        13850001
138600             MOVE -1               TO MR-SELECTL (PV-SUB)         13860001
138700             SET DP030-SET-CURSOR-APPL-1                          13870001
138800                                   TO TRUE                        13880001
138900             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         13890001
139000             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         13900001
139100             SET PS-ERROR          TO TRUE                        13910001
139200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13920001
139300                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13930001
139400                 MOVE SPACE        TO ASC-SELECTED-SW             13940001
139500                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13950001
139600             END-IF                                               13960001
139700     END-EVALUATE.                                                13970001
139800                                                                  13980001
139900     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             13990001
140000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14000001
140100                                                                  14010001
140200     IF  ASC-ITEM-SUB < 1                                         14020001
140300         SUBTRACT +1 FROM ASC-BLK-SUB                             14030001
140400         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14040001
140500     END-IF.                                                      14050001
140600                                                                  14060001
140700*----------------------------------------------------------------*14070001
140800*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *14080001
140900*    INITIALIZE ALL COUNTERS AND FLAGS.                          *14090001
141000*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *14100001
141100*    DISPLAY THE PANEL TO USER.                                  *14110001
141200*----------------------------------------------------------------*14120001
141300 4000-BUILD-INITIAL-PANEL.                                        14130001
141400                                                                  14140001
141500     INITIALIZE ASC-BLOCK-ENTRIES (1)                             14150001
141600                ASC-BLOCK-ENTRIES (2).                            14160001
141700                                                                  14170001
141800     MOVE +1                  TO ASC-BLK-SUB.                     14180001
141900                                                                  14190001
142000     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            14200001
142100                                                                  14210001
142200     MOVE +0                  TO ASC-ITEM-SUB                     14220001
142300                                 ASC-NUMBER-OF-ITEMS-READ         14230001
142400                                 ASC-NUMBER-OF-SELECTED-ITEMS     14240001
142500                                 ASC-HIGHEST-BLOCK-WRITTEN        14250001
142600                                 ASC-START-OF-SELECTED-RANGE      14260001
142700                                 ASC-END-OF-SELECTED-RANGE        14270001
142800                                 ASC-ITEM-AT-TOP-OF-PANEL.        14280001
142900                                                                  14290001
143000     PERFORM 4100-PREPARE-CURSOR.                                 14300001
143100                                                                  14310005
143200     PERFORM 8400-CHECK-AUTOVE.                                   14320041
143300                                                                  14330041
143400     MOVE ZEROES TO PA-TOT-FCSE-PK-COUNT                          14340005
143500                    PA-TOT-P2L-PK-COUNT                           14350005
143600                    PA-TOT-ODD-PK-COUNT.                          14360005
143700                                                                  14370005
143800     PERFORM 7000-GET-DEPT.                                       14380005
143900     MOVE PURCHS-DEPT-NBR  TO ASC-DEPT.                           14390006
144000                                                                  14400005
144100     IF  ASC-DEPT  >  SPACES                                      14410041
144200         PERFORM 7005-NUM-EDIT                                    14420041
144300     ELSE                                                         14430041
144400         MOVE ZEROES                  TO ASC-DEPT-N               14440041
144500     END-IF.                                                      14450041
144600                                                                  14460041
144700     PERFORM 7100-GET-ZONE-DESC.                                  14470006
144800     MOVE MDSEDP-STR-ZN-ID TO ASC-ZONE.                           14480006
144900                                                                  14490006
145000     PERFORM 4010-OPEN-CURSOR.                                    14500001
145100                                                                  14510001
145200     PERFORM 4300-READ-ITEMS-FROM-DB.                             14520001
145300                                                                  14530001
145400     PERFORM 4020-CLOSE-CURSOR.                                   14540001
145500                                                                  14550001
145600     MOVE +1 TO PV-TOP-ITEM.                                      14560001
145700                                                                  14570001
145800     IF ASC-NUMBER-OF-ITEMS-READ = ZERO                           14580001
145900         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14590001
146000         SET DP020-MSG-FATAL           TO TRUE                    14600001
146100         MOVE PC-TSYMSG-00050          TO DP020-MSG-NUMBER        14610001
146200     ELSE                                                         14620001
146300         MOVE -1                       TO MR-SELECTL (1)          14630001
146400         SET DP030-SET-CURSOR-APPL-1   TO TRUE                    14640001
146500         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14650001
146600     END-IF.                                                      14660001
146700                                                                  14670001
146800*----------------------------------------------------------------*14680001
146900* OPEN THE PRE-PACK CURSOR.                                      *14690001
147000*----------------------------------------------------------------*14700001
147100 4010-OPEN-CURSOR.                                                14710001
147200                                                                  14720001
147300     EXEC SQL                                                     14730001
147400         OPEN PREPK-SEARCH-CSR                                    14740001
147500     END-EXEC.                                                    14750001
147600                                                                  14760001
147700     EVALUATE TRUE                                                14770001
147800         WHEN SQLCODE = ZERO                                      14780001
147900             SET ASC-ITEMS-LEFT-ON-DB TO TRUE                     14790004
148000                                                                  14800001
148100         WHEN SQLCODE = -904                                      14810001
148200         WHEN SQLCODE = -911                                      14820001
148300         WHEN SQLCODE = -913                                      14830001
148400             PERFORM 9900-SOFT-ABORT                              14840001
148500                                                                  14850001
148600         WHEN SQLWARN0 NOT = SPACE                                14860001
148700         WHEN SQLCODE  NOT = ZERO                                 14870001
148800             MOVE '4010-OPEN-CURSOR'                              14880001
148900                                 TO DP013-PARAGRAPH               14890001
149000             MOVE 'OPEN PRE-PACK CURSOR'                          14900001
149100                                 TO DP013-MESSAGE-TEXT (1)        14910001
149200             MOVE SQLCA          TO DP013-SQLCA                   14920001
149300             MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (1)      14930001
149400             SET DP013-DB2-ABEND TO TRUE                          14940001
149500             PERFORM DP013-0000-PROCESS-ABEND                     14950001
149600     END-EVALUATE.                                                14960003
149700                                                                  14970001
149800*----------------------------------------------------------------*14980001
149900* CLOSE THE PRE-PACK CURSOR                                      *14990001
150000*----------------------------------------------------------------*15000001
150100 4020-CLOSE-CURSOR.                                               15010001
150200                                                                  15020001
150300     EXEC SQL                                                     15030001
150400         CLOSE PREPK-SEARCH-CSR                                   15040001
150500     END-EXEC.                                                    15050001
150600                                                                  15060001
150700     EVALUATE TRUE                                                15070001
150800         WHEN SQLCODE = ZERO                                      15080001
150900             CONTINUE                                             15090001
151000                                                                  15100001
151100         WHEN SQLCODE = -904                                      15110001
151200         WHEN SQLCODE = -911                                      15120001
151300         WHEN SQLCODE = -913                                      15130001
151400             PERFORM 9900-SOFT-ABORT                              15140001
151500                                                                  15150001
151600         WHEN SQLWARN0 NOT = SPACE                                15160001
151700         WHEN SQLCODE  NOT = ZERO                                 15170001
151800             MOVE '4020-CLOSE-CURSOR'                             15180001
151900                                 TO DP013-PARAGRAPH               15190001
152000             MOVE 'CLOSE PRE-PACK CURSOR'                         15200001
152100                                 TO DP013-MESSAGE-TEXT (1)        15210001
152200             MOVE SQLCA          TO DP013-SQLCA                   15220001
152300             MOVE 'TRECITM'      TO DP013-DB2-TABLE-NAME (1)      15230001
152400             SET DP013-DB2-ABEND TO TRUE                          15240001
152500             PERFORM DP013-0000-PROCESS-ABEND                     15250001
152600     END-EVALUATE.                                                15260001
152700                                                                  15270001
152800*----------------------------------------------------------------*15280001
152900*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *15290001
153000*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *15300001
153100*----------------------------------------------------------------*15310001
153200 4100-PREPARE-CURSOR.                                             15320001
153300                                                                  15330001
153400     MOVE ASC-KEY-PO-NBR            TO DK-ORD-NBR.                15340001
153500     MOVE ASC-KEY-REC-SEQ-NBR       TO DK-RCVR-NBR.               15350001
153600     MOVE ASC-KEY-OPER-UNT-ID       TO DK-OPER-UNT-ID.            15360001
153700     MOVE ASC-KEY-FCLTY-ID          TO DK-FCLTY-ID.               15370001
153800                                                                  15380001
153900     MOVE ASC-KEY-PACK-ID           TO DK-PREPK-ID.               15390003
154000                                                                  15400001
154100*----------------------------------------------------------------*15410001
154200*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15420001
154300*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15430001
154400*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15440001
154500*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15450001
154600*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15460001
154700*                                                                *15470001
154800*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15480001
154900*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15490001
155000*    UPON INITIALIZATION.                                        *15500001
155100*----------------------------------------------------------------*15510001
155200 4300-READ-ITEMS-FROM-DB.                                         15520001
155300                                                                  15530001
155400     PERFORM                                                      15540001
155500       VARYING PV-READ-COUNT FROM 1 BY 1                          15550001
155600         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15560001
155700               OR (ASC-NO-ITEMS-LEFT-ON-DB))                      15570001
155800                                                                  15580001
155900         PERFORM 4310-FETCH                                       15590001
156000                                                                  15600001
156100         IF ASC-ITEMS-LEFT-ON-DB                                  15610001
156200             IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                 15620001
156300                 ADD +1  TO ASC-ITEM-SUB                          15630001
156400             ELSE                                                 15640001
156500                 ADD  +1 TO ASC-BLK-SUB                           15650001
156600                 MOVE +1 TO ASC-ITEM-SUB                          15660001
156700                                                                  15670001
156800                 IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY          15680001
156900                     MOVE +1 TO ASC-BLK-SUB                       15690001
157000                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           15700001
157100                     PERFORM 5100-WRITE-TEMP-STORAGE              15710001
157200                     MOVE ASC-BLOCK-ENTRIES                       15720001
157300                                         (PC-MAX-BLOCKS-IN-ARRAY) 15730001
157400                       TO ASC-BLOCK-ENTRIES (ASC-BLK-SUB)         15740001
157500                     ADD +1 TO ASC-BLK-SUB                        15750001
157600                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   15760001
157700                     SET ASC-BLOCK-NOT-MODIFIED (ASC-BLK-SUB)     15770001
157800                            TO TRUE                               15780001
157900                 END-IF                                           15790001
158000             END-IF                                               15800001
158100                                                                  15810001
158200             ADD +1 TO ASC-NUMBER-OF-ITEMS-READ                   15820001
158300             MOVE ASC-NUMBER-OF-ITEMS-READ                        15830001
158400               TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) 15840001
158500                                                                  15850005
158600             MOVE RECITM-ORD-LNE-NBR    TO ASC-LINE               15860005
158700                                        (ASC-BLK-SUB ASC-ITEM-SUB)15870001
158800             MOVE RECITM-PREPK-RATO-QTY TO ASC-RATIO              15880005
158900                                        (ASC-BLK-SUB ASC-ITEM-SUB)15890005
159000                                                                  15900005
159100             MOVE RECITM-ORD-LNE-NBR    TO DK-LNE-NBR             15910006
159200                                                                  15920006
159300             PERFORM 7200-GET-SKU                                 15930006
159400*----------------------------------------------------------------*15940038
159500* CHANGES MADE TO VERIFY ITM-NBR AND CALL XLKUT001.  WR/IR# 21361*15950039
159600*----------------------------------------------------------------*15960039
159700             IF PURITM-ITM-NBR < 0                                15970041
159800                MOVE '4300-READ-ITEMS-FROM-DB'                    15980041
159900                                 TO DP013-PARAGRAPH               15990041
160000                MOVE 'PURITM-ITM-NBR < 0'                         16000041
160100                                 TO DP013-MESSAGE-TEXT (1)        16010041
160200                MOVE SQLCA       TO DP013-SQLCA                   16020041
160300                MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)       16030041
160400                SET DP013-DB2-ABEND                               16040041
160500                    DP013-NO-ROLLBACK                             16050041
160600                                 TO TRUE                          16060041
160700                PERFORM DP013-0000-PROCESS-ABEND                  16070041
160800             END-IF                                               16080041
160900                                                                  16090041
161000             IF PURITM-ITM-NBR = 0                                16100041
161100                IF PURITM-SKU-SEQ-NBR = PC-000                    16110041
161200                   MOVE '00000000' TO PV-CS-SKU                   16120041
161300                ELSE                                              16130041
161400                   IF PURITM-SKU-SEQ-NBR = PC-999                 16140041
161500                      MOVE '99999999' TO PV-CS-SKU                16150041
161600                   ELSE                                           16160041
161700                      MOVE '4300-READ-ITEMS-FROM-DB'              16170041
161800                                   TO DP013-PARAGRAPH             16180041
161900                      MOVE 'PURITM-ITM-NBR = 0'                   16190041
162000                                   TO DP013-MESSAGE-TEXT (1)      16200041
162100                      MOVE SQLCA      TO DP013-SQLCA              16210041
162200                      MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1) 16220041
162300                      SET DP013-DB2-ABEND                         16230041
162400                          DP013-NO-ROLLBACK                       16240041
162500                                   TO TRUE                        16250041
162600                      PERFORM DP013-0000-PROCESS-ABEND            16260041
162700                   END-IF                                         16270041
162800                END-IF                                            16280041
162900             END-IF                                               16290041
163000                                                                  16300041
163100             IF PURITM-ITM-NBR > 0 AND                            16310041
163200                PS-CALL-API-YES    AND                            16320041
163300                ((PURITM-SKU-SEQ-NBR NOT = PC-000) AND            16330041
163400                (PURITM-SKU-SEQ-NBR NOT = PC-999))                16340041
163500                PERFORM 4305-CALL-XLKUT-DOMAIN-PGM                16350041
163600             END-IF                                               16360041
163700                                                                  16370039
163800             MOVE PURCHS-DEPT-NBR       TO ASC-SKU-DEPT           16380032
163900                                        (ASC-BLK-SUB ASC-ITEM-SUB)16390032
164000             MOVE PURITM-CL-NBR         TO ASC-CLASS              16400032
164100                                        (ASC-BLK-SUB ASC-ITEM-SUB)16410032
164200                                           ASC-SKU-CLASS          16420032
164300                                        (ASC-BLK-SUB ASC-ITEM-SUB)16430032
164400             MOVE PV-CS-SKU             TO ASC-SKU-SEQ-NBR        16440033
164500                                        (ASC-BLK-SUB ASC-ITEM-SUB)16450005
164600*----------------------------------------------------------------*16460039
164700* END OF CHANGES                                    WR/IR#  21361*16470039
164800*----------------------------------------------------------------*16480039
164900                                                                  16490003
165000                                                                  16500005
165100             IF ASC-AUTO-VE-YES                                   16510041
165200                 INITIALIZE RC074-FIELDS                          16520041
165300                 SET RC074-PACK-QTY-YES     TO TRUE               16530043
165400                 MOVE RECITM-ORD-LNE-NBR  TO RC074-LINE-NBR       16540041
165500                 MOVE ASC-KEY-PACK-ID     TO RC074-PACK-ID        16550045
165600                 PERFORM 4350-CALL-RCKUT128                       16560041
165700                 MOVE RC074-TOTAL-ACTL-PACK-QTY TO                16570044
165800                    ASC-FCSE-QTY (ASC-BLK-SUB ASC-ITEM-SUB)       16580041
165900                 COMPUTE PA-TOT-FCSE-PK-COUNT =                   16590050
166100                         (RC074-TOTAL-ACTL-PACK-QTY /             16610050
166101                           RECITM-PREPK-RATO-QTY)                 16610150
166110                 MOVE PA-TOT-FCSE-PK-COUNT         TO ASC-FCSE-TOT16611050
166200                 MOVE RC074-P2L-ACTL-PACK-QTY  TO                 16620044
166300                    ASC-P2L-QTY (ASC-BLK-SUB ASC-ITEM-SUB)        16630041
166400                 COMPUTE PA-TOT-P2L-PK-COUNT                      16640044
166500                       = PA-TOT-P2L-PK-COUNT                      16650044
166600                       + RC074-P2L-ACTL-PACK-QTY                  16660044
166700                 MOVE PA-TOT-P2L-PK-COUNT          TO ASC-P2L-TOT 16670044
166800                 IF RECITM-STATUS-CDE = 'VE'                      16680041
166900                     MOVE RC074-VERIFY-ODD-QTY     TO ASC-ODD-QTY 16690041
167000                                        (ASC-BLK-SUB ASC-ITEM-SUB)16700041
167100                 ELSE                                             16710041
167200                     MOVE RC074-ACTUAL-ODD-QTY     TO ASC-ODD-QTY 16720041
167300                                        (ASC-BLK-SUB ASC-ITEM-SUB)16730041
167400                 END-IF                                           16740041
167500                 COMPUTE PA-TOT-ODD-PK-COUNT                      16750041
167600                       = PA-TOT-ODD-PK-COUNT                      16760041
167700                       + ASC-ODD-QTY    (ASC-BLK-SUB ASC-ITEM-SUB)16770041
167800                 MOVE PA-TOT-ODD-PK-COUNT          TO ASC-ODD-TOT 16780041
167900                                                                  16790041
168000             ELSE                                                 16800041
168100                 PERFORM 4320-SUM-TDISTDT-QTYS                    16810041
168200                 MOVE DISTDT-FCSE-ACTL-UNT-QTY TO ASC-FCSE-QTY    16820041
168300                                (ASC-BLK-SUB ASC-ITEM-SUB)        16830041
168400                 COMPUTE PA-TOT-FCSE-PK-COUNT                     16840041
168500                       = PA-TOT-FCSE-PK-COUNT                     16850041
168600                       + DISTDT-FCSE-ACTL-UNT-QTY                 16860041
168700                 MOVE DISTDT-FCSE-ACTL-UNT-QTY TO PA-FCSE-QTY     16870041
168800                 MOVE PA-TOT-FCSE-PK-COUNT         TO ASC-FCSE-TOT16880041
168900                                                                  16890041
169000                 SET PS-LINE-P2L-UPLOAD-NOT-DONE TO TRUE          16900041
169100                 PERFORM 4340-CHECK-TDISTHD                       16910041
169200                                                                  16920041
169300                 IF PS-LINE-P2L-UPLOAD-DONE                       16930041
169400                     MOVE DISTDT-ACTL-ALLOC-QTY TO ASC-P2L-QTY    16940041
169500                                        (ASC-BLK-SUB ASC-ITEM-SUB)16950041
169600                     COMPUTE PA-TOT-P2L-PK-COUNT                  16960041
169700                           = PA-TOT-P2L-PK-COUNT                  16970041
169800                           + DISTDT-ACTL-ALLOC-QTY                16980041
169900                 ELSE                                             16990041
170000                     MOVE DISTDT-P2L-SPLT-UNT-QTY  TO ASC-P2L-QTY 17000041
170100                                        (ASC-BLK-SUB ASC-ITEM-SUB)17010041
170200                     COMPUTE PA-TOT-P2L-PK-COUNT                  17020041
170300                           = PA-TOT-P2L-PK-COUNT                  17030041
170400                           + DISTDT-P2L-SPLT-UNT-QTY              17040041
170500                 END-IF                                           17050041
170600                 MOVE PA-TOT-P2L-PK-COUNT          TO ASC-P2L-TOT 17060041
170700                                                                  17070041
170800                 MOVE DISTDT-PREPK-ODD-UNT-QTY     TO ASC-ODD-QTY 17080041
170900                                        (ASC-BLK-SUB ASC-ITEM-SUB)17090041
171000                 COMPUTE PA-TOT-ODD-PK-COUNT                      17100041
171100                       = PA-TOT-ODD-PK-COUNT                      17110041
171200                       + DISTDT-PREPK-ODD-UNT-QTY                 17120041
171300                 MOVE PA-TOT-ODD-PK-COUNT          TO ASC-ODD-TOT 17130041
171400             END-IF                                               17140041
171500                                                                  17150041
171600             COMPUTE ASC-TOTAL-QTY (ASC-BLK-SUB ASC-ITEM-SUB)     17160041
171700                     = ASC-FCSE-QTY (ASC-BLK-SUB ASC-ITEM-SUB)    17170041
171800                     + ASC-P2L-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)    17180041
171900                     + ASC-ODD-QTY  (ASC-BLK-SUB ASC-ITEM-SUB)    17190041
172000                                                                  17200041
172100         END-IF                                                   17210001
172200     END-PERFORM.                                                 17220001
172300                                                                  17230001
172400     IF ASC-NUMBER-OF-ITEMS-READ > ZERO                           17240005
172500         MOVE +1    TO ASC-BLK-SUB                                17250005
172600         PERFORM 5100-WRITE-TEMP-STORAGE                          17260001
172700         ADD +1     TO ASC-BLK-SUB                                17270005
172800         PERFORM 5100-WRITE-TEMP-STORAGE                          17280001
172900                                                                  17290001
173000         MOVE 1     TO ASC-BLK-SUB                                17300005
173100                       PV-BLOCK-NUMBER                            17310005
173200         PERFORM 4410-READ-TEMP-STORAGE                           17320001
173300         IF ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1              17330005
173400             MOVE 2 TO ASC-BLK-SUB                                17340005
173500                       PV-BLOCK-NUMBER                            17350005
173600             PERFORM 4410-READ-TEMP-STORAGE                       17360001
173700         END-IF                                                   17370001
173800     END-IF.                                                      17380001
173900                                                                  17390020
174000*----------------------------------------------------------------*17400020
174100*                                               **   WR # 21361  *17410038
174200*  ADDERD NEW PARAGRAPH TO INCLUDE XLKUT001 LOGIC                *17420020
174300*----------------------------------------------------------------*17430020
174400 4305-CALL-XLKUT-DOMAIN-PGM.                                      17440021
174500            INITIALIZE XL001-ITEM-COMMAREA                        17450020
174600            MOVE PURITM-ITM-NBR   TO XL001-KEY-ITM-NBR            17460020
174700                                                                  17470020
174800            SET  XL001-BY-ITEM                                    17480020
174900                 XL001-SELECT-SKU TO TRUE                         17490020
175000                                                                  17500020
175100            CALL XL001-VSM-PGM USING  DFHEIBLK                    17510020
175200                                      XL001-COMMAREA              17520020
175300                                      XL001-ITEM-COMMAREA         17530020
175400                                                                  17540020
175500            EVALUATE TRUE                                         17550020
175600                                                                  17560020
175700                WHEN XL001-SKU-SQLCODE = +0                       17570020
175800                      MOVE XL001-SKU-NBR                          17580020
175900                                       TO  PV-CS-SKU              17590020
176000                                                                  17600020
176100                WHEN XL001-SKU-SQLCODE = +100                     17610020
176200                      MOVE SPACES      TO  PV-CS-SKU              17620020
176300                                                                  17630020
176400                WHEN XL001-SKU-CONTENTION                         17640020
176500                      MOVE '4305-CALL-XLKUT-DOMAIN-PGM'           17650035
176600                                       TO DP013-PARAGRAPH         17660020
176700                      MOVE 'SKU CONTENTION'                       17670020
176800                                       TO DP013-MESSAGE-TEXT (1)  17680020
176900                      MOVE 'XLV_SKU '  TO DP013-DB2-TABLE-NAME (1)17690039
177000                      MOVE XL001-SQLCA TO DP013-SQLCA             17700020
177100                      SET DP013-DB2-ABEND                         17710020
177200                           DP013-NO-ROLLBACK                      17720020
177300                                       TO TRUE                    17730020
177400                      PERFORM DP013-0000-PROCESS-ABEND            17740020
177500                                                                  17750020
177600                WHEN OTHER                                        17760020
177700                      MOVE '4305-CALL-XLKUT-DOMAIN-PGM'           17770035
177800                                       TO DP013-PARAGRAPH         17780020
177900                      MOVE 'INVALID RETURN'                       17790020
178000                                       TO DP013-MESSAGE-TEXT (1)  17800020
178100                      MOVE 'XLV_SKU '  TO DP013-DB2-TABLE-NAME (1)17810037
178200                      MOVE XL001-SQLCA TO DP013-SQLCA             17820020
178300                      SET DP013-DB2-ABEND                         17830020
178400                                       TO TRUE                    17840020
178500                      PERFORM DP013-0000-PROCESS-ABEND            17850020
178600            END-EVALUATE.                                         17860022
178700*----------------------------------------------------------------*17870020
178800* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *17880038
178900*----------------------------------------------------------------*17890020
179000                                                                  17900001
179100*----------------------------------------------------------------*17910001
179200*    FETCH A RCVR ROW                                            *17920001
179300*----------------------------------------------------------------*17930001
179400 4310-FETCH.                                                      17940001
179500                                                                  17950001
179600     EXEC SQL                                                     17960001
179700         FETCH PREPK-SEARCH-CSR                                   17970001
179800          INTO :RECITM-ORD-LNE-NBR                                17980001
179900             , :RECITM-PREPK-RATO-QTY                             17990005
180000     END-EXEC.                                                    18000001
180100                                                                  18010001
180200     EVALUATE TRUE                                                18020001
180300       WHEN SQLCODE = +0                                          18030001
180400           CONTINUE                                               18040001
180500                                                                  18050001
180600       WHEN SQLCODE = +100                                        18060001
180700           SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                    18070001
180800                                                                  18080001
180900       WHEN SQLWARN0 NOT = SPACE                                  18090001
181000       WHEN SQLCODE < +0                                          18100001
181100       WHEN SQLCODE > +0                                          18110001
181200           MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH            18120001
181300           MOVE 'FETCH PREPACK CSR' TO DP013-MESSAGE-TEXT (1)     18130001
181400           MOVE SQLCA               TO DP013-SQLCA                18140001
181500           MOVE 'TRECITM'           TO DP013-DB2-TABLE-NAME (1)   18150001
181600           MOVE 'TRECEIV'           TO DP013-DB2-TABLE-NAME (2)   18160001
181700           SET DP013-DB2-ABEND      TO TRUE                       18170001
181800           PERFORM DP013-0000-PROCESS-ABEND                       18180001
181900                                                                  18190001
182000     END-EVALUATE.                                                18200001
182100                                                                  18210001
182200*----------------------------------------------------------------*18220003
182300 4320-SUM-TDISTDT-QTYS.                                           18230003
182400                                                                  18240003
182500      EXEC SQL                                                    18250003
182600         SELECT                                                   18260003
182700                SUM(ACTL_ALLOC_QTY)                               18270005
182800              , SUM(P2L_SPLT_UNT_QTY)                             18280005
182900              , SUM(FCSE_SPLT_UNT_QTY)                            18290005
183000              , SUM(FCSE_ACTL_UNT_QTY)                            18300005
183100              , SUM(PREPK_ODD_UNT_QTY)                            18310003
183200           INTO                                                   18320003
183300                :DISTDT-ACTL-ALLOC-QTY                            18330005
183400              , :DISTDT-P2L-SPLT-UNT-QTY                          18340005
183500              , :DISTDT-FCSE-SPLT-UNT-QTY                         18350005
183600              , :DISTDT-FCSE-ACTL-UNT-QTY                         18360005
183700              , :DISTDT-PREPK-ODD-UNT-QTY                         18370003
183800           FROM TDISTDT                                           18380003
183900          WHERE ORD_NBR      = :DK-ORD-NBR                        18390003
184000            AND RCVR_SEQ_NBR = :DK-RCVR-NBR                       18400003
184100            AND ORD_LNE_NBR  = :DK-LNE-NBR                        18410003
184200      END-EXEC.                                                   18420003
184300                                                                  18430003
184400      EVALUATE TRUE                                               18440003
184500           WHEN SQLCODE = ZERO                                    18450003
184600               CONTINUE                                           18460003
184700                                                                  18470003
184800           WHEN SQLCODE = -305                                    18480003
184900               MOVE ZEROES TO DISTDT-ACTL-ALLOC-QTY               18490005
185000                              DISTDT-P2L-SPLT-UNT-QTY             18500005
185100                              DISTDT-FCSE-SPLT-UNT-QTY            18510005
185200                              DISTDT-FCSE-ACTL-UNT-QTY            18520005
185300                              DISTDT-PREPK-ODD-UNT-QTY            18530003
185400                                                                  18540003
185500         WHEN SQLCODE = -904                                      18550003
185600         WHEN SQLCODE = -911                                      18560003
185700         WHEN SQLCODE = -913                                      18570003
185800             PERFORM 9900-SOFT-ABORT                              18580003
185900                                                                  18590003
186000         WHEN SQLWARN0 NOT = SPACES                               18600003
186100         WHEN SQLCODE < ZERO                                      18610003
186200         WHEN SQLCODE > ZERO                                      18620003
186300             MOVE '4320-SUM-TDISTDT-QTYS'                         18630003
186400                             TO DP013-PARAGRAPH                   18640003
186500             MOVE 'UNSUCCESSFUL COUNT OF PACK QUANTITIES'         18650003
186600                             TO DP013-MESSAGE-TEXT (1)            18660003
186700             MOVE SQLCA      TO DP013-SQLCA                       18670003
186800             MOVE 'TDISTDT ' TO DP013-DB2-TABLE-NAME (1)          18680003
186900             SET DP013-DB2-ABEND                                  18690003
187000                 DP013-NO-ROLLBACK TO TRUE                        18700003
187100             PERFORM DP013-0000-PROCESS-ABEND                     18710003
187200     END-EVALUATE.                                                18720003
187300                                                                  18730003
187400*----------------------------------------------------------------*18740011
187500 4330-SUM-TDISTDT-TOTS.                                           18750011
187600                                                                  18760011
187700      EXEC SQL                                                    18770011
187800         SELECT                                                   18780011
187900                SUM(ACTL_ALLOC_QTY)                               18790011
188000              , SUM(P2L_SPLT_UNT_QTY)                             18800011
188100              , SUM(FCSE_SPLT_UNT_QTY)                            18810011
188200              , SUM(FCSE_ACTL_UNT_QTY)                            18820011
188300              , SUM(PREPK_ODD_UNT_QTY)                            18830011
188400           INTO                                                   18840011
188500                :DISTDT-ACTL-ALLOC-QTY                            18850011
188600              , :DISTDT-P2L-SPLT-UNT-QTY                          18860011
188700              , :DISTDT-FCSE-SPLT-UNT-QTY                         18870011
188800              , :DISTDT-FCSE-ACTL-UNT-QTY                         18880011
188900              , :DISTDT-PREPK-ODD-UNT-QTY                         18890011
189000           FROM TDISTDT                                           18900011
189100          WHERE ORD_NBR      = :DK-ORD-NBR                        18910011
189200            AND RCVR_SEQ_NBR = :DK-RCVR-NBR                       18920011
189300***         AND ORD_LNE_NBR  = :DK-LNE-NBR                        18930011
189400      END-EXEC.                                                   18940011
189500                                                                  18950011
189600      EVALUATE TRUE                                               18960011
189700           WHEN SQLCODE = ZERO                                    18970011
189800               CONTINUE                                           18980011
189900                                                                  18990011
190000           WHEN SQLCODE = -305                                    19000011
190100               MOVE ZEROES TO DISTDT-ACTL-ALLOC-QTY               19010011
190200                              DISTDT-P2L-SPLT-UNT-QTY             19020011
190300                              DISTDT-FCSE-SPLT-UNT-QTY            19030011
190400                              DISTDT-FCSE-ACTL-UNT-QTY            19040011
190500                              DISTDT-PREPK-ODD-UNT-QTY            19050011
190600                                                                  19060011
190700         WHEN SQLCODE = -904                                      19070011
190800         WHEN SQLCODE = -911                                      19080011
190900         WHEN SQLCODE = -913                                      19090011
191000             PERFORM 9900-SOFT-ABORT                              19100011
191100                                                                  19110011
191200         WHEN SQLWARN0 NOT = SPACES                               19120011
191300         WHEN SQLCODE < ZERO                                      19130011
191400         WHEN SQLCODE > ZERO                                      19140011
191500             MOVE '4330-SUM-TDISTDT-TOTS'                         19150011
191600                             TO DP013-PARAGRAPH                   19160011
191700             MOVE 'UNSUCCESSFUL COUNT OF PACK QUANTITIES'         19170011
191800                             TO DP013-MESSAGE-TEXT (1)            19180011
191900             MOVE SQLCA      TO DP013-SQLCA                       19190011
192000             MOVE 'TDISTDT ' TO DP013-DB2-TABLE-NAME (1)          19200011
192100             SET DP013-DB2-ABEND                                  19210011
192200                 DP013-NO-ROLLBACK TO TRUE                        19220011
192300             PERFORM DP013-0000-PROCESS-ABEND                     19230011
192400     END-EVALUATE.                                                19240011
192500                                                                  19250011
192600*----------------------------------------------------------------*19260039
192700* GET THE PACK-TO-LIGHT UPLOAD TIMESTAMP FROM THE HEADER TABLE.  *19270039
192800*----------------------------------------------------------------*19280039
192900 4340-CHECK-TDISTHD.                                              19290039
193000                                                                  19300039
193100      EXEC SQL                                                    19310039
193200         SELECT                                                   19320039
193300                RSLTS_RCVD_TMST                                   19330040
193400           INTO                                                   19340039
193500                :DISTHD-RSLTS-RCVD-TMST                           19350039
193600           FROM TDISTHD                                           19360039
193700          WHERE ORD_NBR      = :DK-ORD-NBR                        19370039
193800            AND RCVR_SEQ_NBR = :DK-RCVR-NBR                       19380039
193900            AND ORD_LNE_NBR  = :DK-LNE-NBR                        19390039
194000      END-EXEC.                                                   19400039
194100                                                                  19410039
194200      EVALUATE TRUE                                               19420039
194300         WHEN SQLCODE = ZERO                                      19430039
194400               IF  DISTHD-RSLTS-RCVD-TMST = PC-DEFAULT-TMST       19440039
194500                   CONTINUE                                       19450039
194600               ELSE                                               19460039
194700                   SET PS-LINE-P2L-UPLOAD-DONE TO TRUE            19470039
194800               END-IF                                             19480039
194900                                                                  19490039
195000         WHEN SQLCODE = -904                                      19500039
195100         WHEN SQLCODE = -911                                      19510039
195200         WHEN SQLCODE = -913                                      19520039
195300             PERFORM 9900-SOFT-ABORT                              19530039
195400                                                                  19540039
195500         WHEN SQLWARN0 NOT = SPACES                               19550039
195600         WHEN SQLCODE < ZERO                                      19560039
195700         WHEN SQLCODE > ZERO                                      19570039
195800             MOVE '4340-CHECK-TDISTHD'                            19580039
195900                             TO DP013-PARAGRAPH                   19590039
196000             MOVE 'UNSUCCESSFUL SELECT OF TDISTHD'                19600039
196100                             TO DP013-MESSAGE-TEXT (1)            19610039
196200             MOVE SQLCA      TO DP013-SQLCA                       19620039
196300             MOVE 'TDISTHD ' TO DP013-DB2-TABLE-NAME (1)          19630039
196400             SET DP013-DB2-ABEND                                  19640039
196500                 DP013-NO-ROLLBACK TO TRUE                        19650039
196600             PERFORM DP013-0000-PROCESS-ABEND                     19660039
196700     END-EVALUATE.                                                19670039
196800                                                                  19680039
196900 4350-CALL-RCKUT128.                                              19690041
197000     MOVE ASC-KEY-OPER-UNT-ID TO RC074-OPER-UNT-ID.               19700041
197100     MOVE ASC-KEY-FCLTY-ID    TO RC074-FCLTY-ID.                  19710041
197200     MOVE ASC-KEY-PO-NBR      TO RC074-PO-NBR.                    19720041
197300     MOVE ASC-KEY-REC-SEQ-NBR TO RC074-RCVR-SEQ-NBR.              19730041
197400                                                                  19740041
197500     CALL RC074-UNIT-CRTN-CNT-PGM USING  DFHEIBLK                 19750041
197600                                         RC074-COMMAREA           19760041
197700                                         RC074-FIELDS.            19770041
197800                                                                  19780041
197900     EVALUATE TRUE                                                19790041
198000         WHEN RC074-SUCCESSFUL                                    19800041
198100             CONTINUE                                             19810041
198200         WHEN OTHER                                               19820041
198300             MOVE '4350-CALL-RCKUT128'                            19830041
198400                                 TO DP013-PARAGRAPH               19840041
198500             STRING                                               19850041
198600                  'UNSUCCESSFUL CALL TO RCKUT128 '                19860041
198700                  'SUCCESS-IND = '                                19870041
198800                  RC074-SUCCESS-IND                               19880041
198900                               DELIMITED BY SIZE                  19890041
199000                               INTO DP013-MESSAGE-TEXT (1)        19900041
199100             MOVE RC074-CRA-RET-MSG                               19910041
199200                                 TO DP013-MESSAGE-TEXT (2)        19920041
199300             MOVE RC074-SQLCA    TO DP013-SQLCA                   19930041
199400             SET DP013-DB2-ABEND                                  19940041
199500                 DP013-XCTL-DISPLAY-RESTART                       19950041
199600                                 TO TRUE                          19960041
199700             PERFORM DP013-0000-PROCESS-ABEND                     19970041
199800     END-EVALUATE.                                                19980041
199900                                                                  19990041
200000*----------------------------------------------------------------*20000011
200100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *20010001
200200*----------------------------------------------------------------*20020001
200300 4400-MOVE-COMMAREA-TO-SCREEN.                                    20030001
200400                                                                  20040001
200500     IF (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))              20050001
200600       AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))            20060001
200700        OR (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))            20070001
200800         MOVE +1     TO ASC-BLK-SUB                               20080001
200900         PERFORM 5100-WRITE-TEMP-STORAGE                          20090001
201000         ADD +1      TO ASC-BLK-SUB                               20100001
201100         PERFORM 5100-WRITE-TEMP-STORAGE                          20110001
201200         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 20120001
201300           GIVING PV-BLOCK-NUMBER REMAINDER PV-REMAINDER          20130001
201400         IF PV-REMAINDER > ZERO                                   20140001
201500             ADD +1  TO PV-BLOCK-NUMBER                           20150001
201600         END-IF                                                   20160001
201700         MOVE +1     TO ASC-BLK-SUB                               20170001
201800         PERFORM 4410-READ-TEMP-STORAGE                           20180001
201900         ADD +1      TO ASC-BLK-SUB                               20190001
202000                                  PV-BLOCK-NUMBER                 20200001
202100         PERFORM 4410-READ-TEMP-STORAGE                           20210001
202200     END-IF.                                                      20220001
202300                                                                  20230001
202400     MOVE +1         TO ASC-BLK-SUB.                              20240001
202500                                                                  20250001
202600     COMPUTE ASC-ITEM-SUB =                                       20260001
202700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20270001
202800         + PC-ITEMS-PER-PANEL).                                   20280001
202900                                                                  20290001
203000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         20300001
203100         ADD +1                    TO ASC-BLK-SUB                 20310001
203200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20320001
203300     END-IF.                                                      20330001
203400                                                                  20340001
203500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20350001
203600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20360001
203700                                                                  20370001
203800     PERFORM 4420-FORMAT-LIST-LINES                               20380001
203900       VARYING PV-SUB FROM PC-ITEMS-PER-PANEL BY -1               20390001
204000         UNTIL PV-SUB < +1.                                       20400001
204100                                                                  20410001
204200     COMPUTE ASC-ITEMS-DISPLAYED =                                20420001
204300         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20430001
204400                                                                  20440001
204500     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20450001
204600                                      ASTRTITO.                   20460001
204700                                                                  20470008
204800     MOVE ASC-OPER-UNT-ID          TO AOPERO.                     20480004
204900     MOVE ASC-FCLTY-ID             TO AFCLTYO.                    20490004
205000     MOVE ASC-PO-NBR               TO APOO.                       20500004
205100     MOVE ASC-REC-SEQ-NBR          TO ARCVRO.                     20510004
205200     MOVE ASC-PACK-ID              TO APKIDO.                     20520004
205300     MOVE ASC-FCSE-TOT             TO AFCSETO.                    20530005
205400     MOVE ASC-P2L-TOT              TO AP2LTO.                     20540005
205500     MOVE ASC-ODD-TOT              TO AODDTO.                     20550005
205600                                                                  20560005
205700     PERFORM 7000-GET-DEPT.                                       20570005
205800     MOVE PURCHS-DEPT-NBR          TO ASC-DEPT                    20580005
205900                                      ADEPTO.                     20590005
206000                                                                  20600004
206100     PERFORM 7100-GET-ZONE-DESC.                                  20610006
206200     MOVE MDSEDP-STR-ZN-ID         TO ASC-ZONE                    20620006
206300                                      AZONEO.                     20630006
206400                                                                  20640006
206500     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20650004
206600     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20660004
206700     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20670004
206800                                   TO ASELITO.                    20680004
206900                                                                  20690004
207000     IF DP020-MSG-NUMBER-X = SPACE                                20700001
207100         IF ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ   20710001
207200* --- MORE ITEMS TO DISPLAY ----                                  20720001
207300             MOVE PC-TSYMSG-00279        TO DP020-MSG-NUMBER      20730001
207400             SET DP020-MSG-INFORMATIONAL TO TRUE                  20740001
207500         END-IF                                                   20750001
207600     END-IF.                                                      20760001
207700                                                                  20770001
207800*----------------------------------------------------------------*20780001
207900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20790001
208000*----------------------------------------------------------------*20800001
208100 4410-READ-TEMP-STORAGE.                                          20810001
208200                                                                  20820001
208300     EXEC CICS                                                    20830001
208400         READQ TS                                                 20840001
208500             QUEUE (ASC-LIST-QUEUE-NAME)                          20850001
208600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20860001
208700             ITEM  (PV-BLOCK-NUMBER)                              20870001
208800             RESP  (PV-CICS-RESP)                                 20880001
208900     END-EXEC.                                                    20890001
209000                                                                  20900001
209100     IF ((PV-CICS-RESP = DFHRESP (NORMAL))                        20910001
209200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20920001
209300         CONTINUE                                                 20930001
209400     ELSE                                                         20940001
209500         SET DP013-CICS-ABEND  TO TRUE                            20950001
209600         SET DP013-NO-ROLLBACK TO TRUE                            20960001
209700         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         20970001
209800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20980001
209900                               TO DP013-MESSAGE-TEXT(1)           20990001
210000         PERFORM DP013-0000-PROCESS-ABEND                         21000001
210100     END-IF.                                                      21010001
210200                                                                  21020001
210300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             21030001
210400                                                                  21040001
210500     IF PV-CICS-RESP = DFHRESP (ITEMERR)                          21050001
210600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               21060001
210700     END-IF.                                                      21070001
210800                                                                  21080001
210900*----------------------------------------------------------------*21090001
211000*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *21100001
211100*----------------------------------------------------------------*21110003
211200 4420-FORMAT-LIST-LINES.                                          21120001
211300                                                                  21130001
211400     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       21140001
211500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                21150001
211600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           21160001
211700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           21170001
211800         MOVE SPACE              TO MR-SELECT (PV-SUB)            21180001
211900                                    MR-ACTION (PV-SUB)            21190001
212000     ELSE                                                         21200001
212100         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       21210001
212200                                                   > SPACE        21220001
212300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21230001
212400                                 TO MR-SELECT (PV-SUB)            21240003
212500         ELSE                                                     21250001
212600             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21260001
212700                                 TO MR-SELECT (PV-SUB)            21270003
212800         END-IF                                                   21280001
212900                                                                  21290001
213000         IF DP030-SET-CURSOR-TRAILER                              21300001
213100             IF ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21310001
213200                 > SPACE)                                         21320001
213300               OR (PV-SUB = 1))                                   21330001
213400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              21340003
213500                 MOVE -1         TO MR-SELECTL (PV-SUB)           21350003
213600             END-IF                                               21360001
213700         END-IF                                                   21370001
213800                                                                  21380003
213900         IF PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL            21390001
214000             MOVE ASC-ACTION  (ASC-BLK-SUB ASC-ITEM-SUB)          21400005
214100                                   TO MR-ACTION (PV-SUB)          21410001
214200             MOVE ASC-LINE    (ASC-BLK-SUB ASC-ITEM-SUB)          21420005
214300                                   TO MR-LINE   (PV-SUB)          21430003
214400             MOVE ASC-CLASS   (ASC-BLK-SUB ASC-ITEM-SUB)          21440005
214500                                   TO MR-CLASS  (PV-SUB)          21450003
214600             MOVE ASC-SKU-SEQ-NBR (ASC-BLK-SUB ASC-ITEM-SUB)      21460034
214700                                   TO MR-SKU    (PV-SUB)          21470003
214800             MOVE ASC-RATIO   (ASC-BLK-SUB ASC-ITEM-SUB)          21480005
214900                                   TO MR-RATIO  (PV-SUB)          21490003
215000             MOVE ASC-FCSE-QTY(ASC-BLK-SUB ASC-ITEM-SUB)          21500005
215100                                   TO MR-FCSE-QTY (PV-SUB)        21510003
215200             MOVE ASC-P2L-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          21520005
215300                                   TO MR-P2L-QTY(PV-SUB)          21530003
215400             MOVE ASC-ODD-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          21540005
215500                                   TO MR-ODD-QTY(PV-SUB)          21550003
215600             MOVE ASC-TOTAL-QTY(ASC-BLK-SUB ASC-ITEM-SUB)         21560005
215700                                   TO MR-TOTAL-QTY (PV-SUB)       21570003
215800***          IF ASC-ADJUSTED-PO (ASC-BLK-SUB ASC-ITEM-SUB)        21580003
215900***              MOVE DP015-YELLOW TO MR-RECEIVER-STATC (PV-SUB)  21590003
216000***          END-IF                                               21600003
216100         END-IF                                                   21610001
216200     END-IF.                                                      21620001
216300                                                                  21630001
216400     SUBTRACT +1 FROM ASC-ITEM-SUB.                               21640001
216500                                                                  21650001
216600     IF ASC-ITEM-SUB < + 1                                        21660001
216700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21670001
216800         MOVE +1                 TO ASC-BLK-SUB                   21680001
216900     END-IF.                                                      21690001
217000                                                                  21700001
217100*----------------------------------------------------------------*21710001
217200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21720001
217300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21730001
217400* FOR THE SELECTED ITEMS QUEUE.                                  *21740001
217500*                                                                *21750001
217600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21760001
217700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21770001
217800* THE ARRAY IS FULL.                                             *21780001
217900*----------------------------------------------------------------*21790001
218000 5000-PREPARE-SEL-QUEUE.                                          21800001
218100                                                                  21810001
218200     MOVE +1                       TO ASC-BLK-SUB.                21820001
218300     PERFORM 5100-WRITE-TEMP-STORAGE.                             21830001
218400     ADD +1                        TO ASC-BLK-SUB.                21840001
218500     PERFORM 5100-WRITE-TEMP-STORAGE.                             21850001
218600                                                                  21860001
218700     MOVE ASC-KEY-PO-NBR           TO  RC015-PO-NBR.              21870006
218800     MOVE ASC-KEY-REC-SEQ-NBR      TO  RC015-REC-SEQ-NBR.         21880006
218900     MOVE ASC-KEY-OPER-UNT-ID      TO  RC015-OPER-UNT-ID.         21890006
219000     MOVE ASC-KEY-FCLTY-ID         TO  RC015-FCLTY-ID.            21900006
219100     MOVE ASC-SEL-QUEUE-NAME       TO  RC015-SEL-QUEUE-NAME.      21910006
219200     PERFORM 6010-DELETE-SEL-QUEUE.                               21920001
219300                                                                  21930001
219400     IF ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                       21940001
219500         SET ASC-UPDATE-TSQ TO TRUE                               21950001
219600     END-IF.                                                      21960001
219700                                                                  21970001
219800     SET RC013-IDX TO 1.                                          21980006
219900     MOVE ZEROES   TO RC015-NUMBER-OF-TS-ITEMS.                   21990006
220000     INITIALIZE RC013-SELECTED-ITEM-ARRAY.                        22000006
220100                                                                  22010001
220200     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22020001
220300       VARYING PV-ITEM FROM 1 BY 1                                22030001
220400         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         22040001
220500                                                                  22050001
220600     IF RC013-IDX > 1                                             22060006
220700         PERFORM 5205-WRITE-SEL-QUEUE                             22070001
220800         ADD +1 TO RC015-NUMBER-OF-TS-ITEMS                       22080006
220900     END-IF.                                                      22090001
221000                                                                  22100001
221100*----------------------------------------------------------------*22110001
221200*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22120001
221300*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22130001
221400*----------------------------------------------------------------*22140001
221500 5100-WRITE-TEMP-STORAGE.                                         22150001
221600                                                                  22160001
221700     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22170001
221800                                   TO PV-LIST-ITEM-NUMBER.        22180001
221900     COMPUTE PV-BLOCK-NUMBER =                                    22190001
222000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22200001
222100                                                                  22210001
222200     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22220001
222300       OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)           22230001
222400         IF ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                       22240001
222500             PERFORM 5105-REWRITE-ASC-LISTQ                       22250001
222600         END-IF                                                   22260001
222700     ELSE                                                         22270001
222800         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22280001
222900                 ASC-HIGHEST-BLOCK-WRITTEN + 1                    22290003
223000         PERFORM 5110-WRITE-ASC-LISTQ                             22300001
223100         ADD +1 TO ASC-HIGHEST-BLOCK-WRITTEN                      22310001
223200     END-IF.                                                      22320001
223300                                                                  22330001
223400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22340001
223500                                                                  22350001
223600*----------------------------------------------------------------*22360001
223700*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *22370001
223800*  SPECIFIC COMMAREA.                                            *22380001
223900*----------------------------------------------------------------*22390001
224000 5105-REWRITE-ASC-LISTQ.                                          22400001
224100                                                                  22410001
224200     EXEC CICS                                                    22420001
224300         WRITEQ TS                                                22430001
224400             QUEUE (ASC-LIST-QUEUE-NAME)                          22440001
224500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22450001
224600             ITEM  (PV-BLOCK-NUMBER)                              22460001
224700             REWRITE                                              22470001
224800             RESP  (PV-CICS-RESP)                                 22480001
224900     END-EXEC.                                                    22490001
225000                                                                  22500001
225100     IF PV-CICS-RESP = DFHRESP(NORMAL)                            22510001
225200         CONTINUE                                                 22520001
225300     ELSE                                                         22530001
225400         SET DP013-CICS-ABEND          TO TRUE                    22540001
225500         SET DP013-NO-ROLLBACK         TO TRUE                    22550001
225600         MOVE '5105-REWRITE-ASC-LISTQ' TO DP013-PARAGRAPH         22560001
225700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22570001
225800           TO DP013-MESSAGE-TEXT(1)                               22580001
225900         PERFORM DP013-0000-PROCESS-ABEND                         22590001
226000     END-IF.                                                      22600001
226100                                                                  22610001
226200*----------------------------------------------------------------*22620001
226300*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *22630001
226400*  SPECIFIC COMMAREA.                                            *22640001
226500*----------------------------------------------------------------*22650001
226600 5110-WRITE-ASC-LISTQ.                                            22660001
226700                                                                  22670001
226800     EXEC CICS                                                    22680001
226900         WRITEQ TS                                                22690001
227000             QUEUE (ASC-LIST-QUEUE-NAME)                          22700001
227100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22710001
227200             ITEM  (PV-BLOCK-NUMBER)                              22720001
227300             RESP  (PV-CICS-RESP)                                 22730001
227400     END-EXEC.                                                    22740001
227500                                                                  22750001
227600     IF PV-CICS-RESP NOT = DFHRESP (NORMAL)                       22760001
227700         SET DP013-CICS-ABEND        TO TRUE                      22770001
227800         SET DP013-NO-ROLLBACK       TO TRUE                      22780001
227900         MOVE '5110-WRITE-ASC-LISTQ' TO DP013-PARAGRAPH           22790001
228000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22800001
228100           TO DP013-MESSAGE-TEXT(1)                               22810001
228200         PERFORM DP013-0000-PROCESS-ABEND                         22820001
228300     END-IF.                                                      22830001
228400                                                                  22840001
228500*----------------------------------------------------------------*22850001
228600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22860001
228700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22870001
228800*----------------------------------------------------------------*22880003
228900 5200-FILL-SEL-QUEUE-RECORD.                                      22890001
229000                                                                  22900001
229100     PERFORM 6112-READ-LIST-QUEUE.                                22910001
229200                                                                  22920001
229300     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        22930001
229400         PERFORM                                                  22940001
229500           VARYING LQW-IDX FROM 1 BY 1                            22950003
229600             UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        22960003
229700                OR LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      22970003
229800                                                                  22980003
229900             IF LQW-SELECT (LQW-IDX)                              22990003
230000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              23000001
230100                            TO RC013-ITEM (RC013-IDX)             23010010
230200                 MOVE SPACE TO RC013-ACTION-SW (RC013-IDX)        23020010
230300                 MOVE RC015-OPER-UNT-ID                           23030006
230400                            TO RC013-OPER-UNT-ID(RC013-IDX)       23040006
230500                 MOVE RC015-FCLTY-ID                              23050006
230600                            TO RC013-FCLTY-ID(RC013-IDX)          23060006
230700                 MOVE RC015-PO-NBR                                23070006
230800                            TO RC013-PO-NBR(RC013-IDX)            23080006
230900                 MOVE RC015-REC-SEQ-NBR                           23090006
231000                            TO RC013-REC-SEQ-NBR(RC013-IDX)       23100006
231100                 MOVE LQW-LINE (LQW-IDX)                          23110003
231200                            TO RC013-PKSL-LNE-NBR-N (RC013-IDX)   23120006
231300                 SET RC013-IDX UP BY 1                            23130006
231400                 IF RC013-IDX > RC013-MAX-ITEMS                   23140010
231500                     PERFORM 5205-WRITE-SEL-QUEUE                 23150001
231600                     ADD +1        TO RC015-NUMBER-OF-TS-ITEMS    23160006
231700                     INITIALIZE RC013-SELECTED-ITEM-ARRAY         23170006
231800                     SET RC013-IDX TO 1                           23180006
231900                 END-IF                                           23190001
232000             END-IF                                               23200001
232100         END-PERFORM                                              23210001
232200     END-IF.                                                      23220001
232300                                                                  23230001
232400*----------------------------------------------------------------*23240001
232500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23250001
232600*----------------------------------------------------------------*23260001
232700 5205-WRITE-SEL-QUEUE.                                            23270001
232800                                                                  23280001
232900     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO RC013-SELECTED-ITEMS.   23290006
233000                                                                  23300001
233100     EXEC CICS                                                    23310001
233200         WRITEQ TS                                                23320003
233300          QUEUE (ASC-SEL-QUEUE-NAME)                              23330003
233400           FROM (RC013-DC-SELECT-RECORD)                          23340006
233500           ITEM (PV-SEL-QUEUE-ITEM)                               23350003
233600           RESP (PV-CICS-RESP)                                    23360003
233700     END-EXEC.                                                    23370001
233800                                                                  23380001
233900     IF PV-CICS-RESP = DFHRESP (NORMAL)                           23390003
234000         CONTINUE                                                 23400001
234100     ELSE                                                         23410001
234200         SET DP013-CICS-ABEND        TO TRUE                      23420003
234300         SET DP013-NO-ROLLBACK       TO TRUE                      23430003
234400         MOVE '5205-WRITE-SEL-QUEUE' TO DP013-PARAGRAPH           23440003
234500         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23450001
234600                                     TO DP013-MESSAGE-TEXT(1)     23460003
234700         PERFORM DP013-0000-PROCESS-ABEND                         23470001
234800     END-IF.                                                      23480001
234900                                                                  23490001
235000*----------------------------------------------------------------*23500001
235100*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *23510001
235200*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *23520001
235300*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *23530001
235400*  THE USER.                                                     *23540001
235500*----------------------------------------------------------------*23550001
235600 6000-REFRESH-PANEL-FROM-TEMP.                                    23560001
235700                                                                  23570001
235800     IF ASC-UPDATE-TSQ                                            23580003
235900         SET ASC-NO-TSQ-UPDATE TO TRUE                            23590003
236000         MOVE ZERO             TO PV-SAVE-ITEM                    23600003
236100                                  PV-SEL-QUEUE-ITEM               23610003
236200         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23620001
236300                               TO PV-HOLD-SELECTED-ITEMS          23630003
236400                                                                  23640008
236500         MOVE +1               TO PV-ITEMS-PROCESSED              23650008
236600                                                                  23660008
236700***      MOVE RC015-SEL-QUEUE-NAME TO ASC-SEL-QUEUE-NAME-IN       23670014
236800         PERFORM 6100-UPDATE-TSQ                                  23680001
236900           UNTIL PV-ITEMS-PROCESSED > ASC-NUMBER-OF-SELECTED-ITEMS23690003
237000                                                                  23700011
237100         PERFORM 6010-DELETE-SEL-QUEUE                            23710011
237200                                                                  23720011
237300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23730001
237400                    ASC-BLOCK-ENTRIES (2)                         23740001
237500     END-IF.                                                      23750001
237600                                                                  23760001
237700*----------------------------------------------------------------*23770001
237800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23780001
237900*----------------------------------------------------------------*23790001
238000 6010-DELETE-SEL-QUEUE.                                           23800001
238100                                                                  23810001
238200     EXEC CICS                                                    23820001
238300         DELETEQ TS                                               23830001
238400             QUEUE (ASC-SEL-QUEUE-NAME)                           23840001
238500             RESP  (PV-CICS-RESP)                                 23850001
238600     END-EXEC.                                                    23860001
238700                                                                  23870001
238800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23880001
238900         (PV-CICS-RESP = DFHRESP(QIDERR)))                        23890001
239000         CONTINUE                                                 23900001
239100     ELSE                                                         23910001
239200         SET DP013-CICS-ABEND         TO TRUE                     23920003
239300         SET DP013-NO-ROLLBACK        TO TRUE                     23930003
239400         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          23940003
239500         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         23950001
239600                                      TO DP013-MESSAGE-TEXT (1)   23960003
239700         PERFORM DP013-0000-PROCESS-ABEND                         23970001
239800     END-IF.                                                      23980001
239900                                                                  23990001
240000*----------------------------------------------------------------*24000001
240100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24010001
240200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24020001
240300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24030001
240400*    THE TEMP QUEUE.                                             *24040001
240500*----------------------------------------------------------------*24050001
240600 6100-UPDATE-TSQ.                                                 24060001
240700                                                                  24070001
240800     ADD +1 TO PV-SEL-QUEUE-ITEM.                                 24080008
240900     PERFORM 6105-READ-SEL-QUEUE.                                 24090001
241000                                                                  24100001
241100     PERFORM                                                      24110001
241200       VARYING RC013-IDX FROM 1 BY 1                              24120008
241300         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     24130003
241400            OR (RC013-IDX GREATER THAN RC013-MAX-ITEMS))          24140008
241500                                                                  24150003
241600         IF RC013-ACTION-SW (RC013-IDX) > SPACE                   24160008
241700             PERFORM 6110-PROCESS-ITEMS                           24170001
241800         END-IF                                                   24180001
241900                                                                  24190003
242000         ADD +1 TO PV-ITEMS-PROCESSED                             24200003
242100     END-PERFORM.                                                 24210001
242200                                                                  24220001
242300     PERFORM 6111-WRITE-LIST-QUEUE.                               24230001
242400                                                                  24240001
242500*----------------------------------------------------------------*24250001
242600*    READ THE LIST QUEUE RECORD.                                 *24260001
242700*----------------------------------------------------------------*24270001
242800 6105-READ-SEL-QUEUE.                                             24280001
242900                                                                  24290001
243000     EXEC CICS                                                    24300001
243100         READQ TS                                                 24310003
243200         QUEUE (ASC-SEL-QUEUE-NAME)                               24320008
243300          INTO (RC013-DC-SELECT-RECORD)                           24330008
243400          ITEM (PV-SEL-QUEUE-ITEM)                                24340003
243500          RESP (PV-CICS-RESP)                                     24350003
243600     END-EXEC.                                                    24360001
243700                                                                  24370001
243800     IF PV-CICS-RESP = DFHRESP (NORMAL)                           24380003
243900         CONTINUE                                                 24390001
244000     ELSE                                                         24400001
244100         SET DP013-CICS-ABEND       TO TRUE                       24410003
244200         SET DP013-NO-ROLLBACK      TO TRUE                       24420003
244300         MOVE '6105-READ-SEL-QUEUE' TO DP013-PARAGRAPH            24430003
244400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24440001
244500                                    TO DP013-MESSAGE-TEXT(1)      24450003
244600         PERFORM DP013-0000-PROCESS-ABEND                         24460001
244700     END-IF.                                                      24470001
244800                                                                  24480001
244900*----------------------------------------------------------------*24490001
245000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24500001
245100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24510001
245200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24520001
245300*----------------------------------------------------------------*24530001
245400 6110-PROCESS-ITEMS.                                              24540001
245500                                                                  24550001
245600     COMPUTE PV-ITEM = 1 + ((RC013-ITEM (RC013-IDX) - 1)          24560008
245700                     / PC-ITEMS-PER-PANEL).                       24570001
245800                                                                  24580001
245900     IF PV-ITEM NOT EQUAL PV-SAVE-ITEM                            24590003
246000         IF PV-SAVE-ITEM NOT EQUAL ZERO                           24600003
246100             PERFORM 6111-WRITE-LIST-QUEUE                        24610001
246200         END-IF                                                   24620001
246300                                                                  24630003
246400         MOVE PV-ITEM TO PV-SAVE-ITEM                             24640003
246500                                                                  24650001
246600         PERFORM 6112-READ-LIST-QUEUE                             24660001
246700         IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                24670003
246800             CONTINUE                                             24680001
246900         END-IF                                                   24690001
247000     END-IF.                                                      24700001
247100                                                                  24710001
247200     COMPUTE PV-SUB = (RC013-ITEM (RC013-IDX)                     24720008
247300                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24730001
247400                                                                  24740001
247500     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       24750001
247600     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        24760001
247700                                     (PV-SUB).                    24770001
247800                                                                  24780008
247900     MOVE LQW-LINE (PV-SUB) TO DK-LNE-NBR.                        24790009
248000     IF ASC-AUTO-VE-YES                                           24800046
248100         INITIALIZE RC074-FIELDS                                  24810046
248200         SET RC074-PACK-QTY-YES     TO TRUE                       24820046
248300         MOVE DK-LNE-NBR          TO RC074-LINE-NBR               24830049
248400         MOVE ASC-KEY-PACK-ID     TO RC074-PACK-ID                24840046
248500         PERFORM 4350-CALL-RCKUT128                               24850046
248600         MOVE RC074-TOTAL-ACTL-PACK-QTY    TO PA-FCSE-QTY         24860046
248700         MOVE RC074-P2L-ACTL-PACK-QTY      TO PA-P2L-QTY          24870046
248800         MOVE PA-TOT-P2L-PK-COUNT          TO ASC-P2L-TOT         24880046
248900                                                                  24890046
249000         MOVE ZEROES TO PA-ODD-QTY-DIFF                           24900046
249100         IF ASC-STATUS-CDE = 'VE'                                 24910047
249200             IF RC074-VERIFY-ODD-QTY NOT = LQW-ODD-QTY (PV-SUB)   24920046
249300                 COMPUTE PA-ODD-QTY-DIFF = (LQW-ODD-QTY (PV-SUB)  24930046
249400                                     - RC074-VERIFY-ODD-QTY)      24940046
249500                                     * -1                         24950046
249600                 MOVE RC074-VERIFY-ODD-QTY                        24960046
249700                                           TO LQW-ODD-QTY (PV-SUB)24970046
249800             END-IF                                               24980046
249900         ELSE                                                     24990046
250000             IF RC074-ACTUAL-ODD-QTY NOT = LQW-ODD-QTY (PV-SUB)   25000046
250100                 COMPUTE PA-ODD-QTY-DIFF = (LQW-ODD-QTY (PV-SUB)  25010046
250200                                     - RC074-ACTUAL-ODD-QTY)      25020046
250300                                     * -1                         25030046
250400                 MOVE RC074-ACTUAL-ODD-QTY                        25040046
250500                                           TO LQW-ODD-QTY (PV-SUB)25050046
250600             END-IF                                               25060046
250700         END-IF                                                   25070046
250800                                                                  25080046
250900     ELSE                                                         25090046
251000         PERFORM 4320-SUM-TDISTDT-QTYS                            25100046
251100         IF DISTDT-FCSE-ACTL-UNT-QTY > ZERO                       25110046
251200             MOVE DISTDT-FCSE-ACTL-UNT-QTY TO PA-FCSE-QTY         25120046
251300         ELSE                                                     25130046
251400             MOVE DISTDT-FCSE-SPLT-UNT-QTY TO PA-FCSE-QTY         25140046
251500         END-IF                                                   25150046
251600         IF DISTDT-ACTL-ALLOC-QTY > ZERO                          25160046
251700             MOVE DISTDT-ACTL-ALLOC-QTY    TO PA-P2L-QTY          25170046
251800         ELSE                                                     25180046
251900             MOVE DISTDT-P2L-SPLT-UNT-QTY  TO PA-P2L-QTY          25190046
252000         END-IF                                                   25200046
252100                                                                  25210013
252200         MOVE ZEROES TO PA-ODD-QTY-DIFF                           25220046
252300         IF DISTDT-PREPK-ODD-UNT-QTY NOT = LQW-ODD-QTY (PV-SUB)   25230046
252400             COMPUTE PA-ODD-QTY-DIFF = (LQW-ODD-QTY (PV-SUB)      25240046
252500                                     - DISTDT-PREPK-ODD-UNT-QTY)  25250046
252600                                     * -1                         25260046
252700         END-IF                                                   25270046
252800                                                                  25280046
252900         MOVE DISTDT-PREPK-ODD-UNT-QTY TO LQW-ODD-QTY (PV-SUB)    25290046
253000     END-IF.                                                      25300046
253100     COMPUTE LQW-TOTAL-QTY (PV-SUB) = PA-FCSE-QTY                 25310013
253200                                    + PA-P2L-QTY                  25320013
253300                                    + DISTDT-PREPK-ODD-UNT-QTY.   25330013
253400                                                                  25340013
253500     COMPUTE ASC-ODD-TOT = ASC-ODD-TOT                            25350011
253600                         + PA-ODD-QTY-DIFF.                       25360011
253700                                                                  25370009
253800     EVALUATE TRUE                                                25380001
253900         WHEN RC013-INQ (RC013-IDX)                               25390008
254000              MOVE PC-INQ TO LQW-ACTION (PV-SUB)                  25400003
254100                                                                  25410001
254200         WHEN RC013-UPD (RC013-IDX)                               25420008
254300              MOVE PC-UPD TO LQW-ACTION (PV-SUB)                  25430003
254400                                                                  25440001
254500         WHEN RC013-DEL (RC013-IDX)                               25450008
254600              MOVE PC-DEL TO LQW-ACTION (PV-SUB)                  25460003
254700                                                                  25470001
254800         WHEN RC013-ERR (RC013-IDX)                               25480008
254900              MOVE PC-ERR TO LQW-ACTION (PV-SUB)                  25490003
255000     END-EVALUATE.                                                25500001
255100                                                                  25510008
255200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25520001
255300                                                                  25530001
255400*----------------------------------------------------------------*25540001
255500*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25550001
255600*----------------------------------------------------------------*25560001
255700 6111-WRITE-LIST-QUEUE.                                           25570001
255800                                                                  25580001
255900     EXEC CICS                                                    25590001
256000         WRITEQ TS                                                25600001
256100          QUEUE (ASC-LIST-QUEUE-NAME)                             25610003
256200           FROM (LQW-LIST-QUEUE-WORK-AREA)                        25620003
256300           ITEM (PV-SAVE-ITEM)                                    25630003
256400        REWRITE                                                   25640003
256500           RESP (PV-CICS-RESP)                                    25650003
256600     END-EXEC.                                                    25660001
256700                                                                  25670001
256800     IF PV-CICS-RESP = DFHRESP (NORMAL)                           25680003
256900       OR PV-CICS-RESP = DFHRESP (ITEMERR)                        25690003
257000         CONTINUE                                                 25700001
257100     ELSE                                                         25710001
257200         SET DP013-CICS-ABEND         TO TRUE                     25720003
257300         SET DP013-NO-ROLLBACK        TO TRUE                     25730003
257400         MOVE '6111-WRITE-LIST-QUEUE' TO DP013-PARAGRAPH          25740003
257500         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25750001
257600                                      TO DP013-MESSAGE-TEXT(1)    25760003
257700         PERFORM DP013-0000-PROCESS-ABEND                         25770001
257800     END-IF.                                                      25780001
257900                                                                  25790001
258000*----------------------------------------------------------------*25800001
258100*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25810001
258200*----------------------------------------------------------------*25820001
258300 6112-READ-LIST-QUEUE.                                            25830001
258400                                                                  25840001
258500     EXEC CICS                                                    25850001
258600         READQ TS                                                 25860001
258700         QUEUE (ASC-LIST-QUEUE-NAME)                              25870003
258800          INTO (LQW-LIST-QUEUE-WORK-AREA)                         25880003
258900          ITEM (PV-ITEM)                                          25890003
259000          RESP (PV-CICS-RESP)                                     25900003
259100     END-EXEC.                                                    25910001
259200                                                                  25920001
259300     IF PV-CICS-RESP = DFHRESP (NORMAL)                           25930003
259400         CONTINUE                                                 25940001
259500     ELSE                                                         25950001
259600         SET DP013-CICS-ABEND        TO TRUE                      25960003
259700         SET DP013-NO-ROLLBACK       TO TRUE                      25970003
259800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25980003
259900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25990001
260000                                     TO DP013-MESSAGE-TEXT(1)     26000003
260100         PERFORM DP013-0000-PROCESS-ABEND                         26010001
260200     END-IF.                                                      26020001
260300                                                                  26030001
260400*----------------------------------------------------------------*26040005
260500*    GET PO DEPARTMENT FOR DISPLAY                               *26050005
260600*----------------------------------------------------------------*26060005
260700 7000-GET-DEPT.                                                   26070005
260800                                                                  26080005
260900     EXEC SQL                                                     26090005
261000         SELECT DEPT_NBR                                          26100005
261100           INTO :PURCHS-DEPT-NBR                                  26110005
261200           FROM TPURCHS A                                         26120005
261300          WHERE A.PO_NBR = :DK-ORD-NBR                            26130005
261400            AND A.VER_STATUS_CDE = 'A'                            26140005
261500     END-EXEC.                                                    26150005
261600                                                                  26160005
261700     EVALUATE TRUE                                                26170005
261800         WHEN SQLCODE = ZERO                                      26180005
261900         WHEN SQLCODE = +100                                      26190005
262000              CONTINUE                                            26200005
262100                                                                  26210005
262200         WHEN SQLCODE = -904                                      26220005
262300         WHEN SQLCODE = -911                                      26230005
262400         WHEN SQLCODE = -913                                      26240005
262500             PERFORM 9900-SOFT-ABORT                              26250005
262600                                                                  26260005
262700         WHEN SQLWARN0 NOT = SPACE                                26270005
262800         WHEN SQLCODE < ZERO                                      26280005
262900         WHEN SQLCODE > ZERO                                      26290005
263000              MOVE '7000-GET-DEPT'                                26300005
263100                                   TO DP013-PARAGRAPH             26310005
263200              MOVE 'SELECT DEPT NUMBER'                           26320005
263300                                   TO DP013-MESSAGE-TEXT (1)      26330005
263400              MOVE SQLCA           TO DP013-SQLCA                 26340005
263500              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    26350005
263600              SET DP013-DB2-ABEND  TO TRUE                        26360005
263700              PERFORM DP013-0000-PROCESS-ABEND                    26370005
263800     END-EVALUATE.                                                26380005
263900                                                                  26390006
264000*----------------------------------------------------------------*26400041
264100* NUMERIC EDIT TO CONVERT DEPT TO NUMERIC                        *26410041
264200*----------------------------------------------------------------*26420041
264300 7005-NUM-EDIT.                                                   26430041
264400     IF  PURCHS-DEPT-NBR >  SPACES                                26440041
264500         MOVE PURCHS-DEPT-NBR           TO DP010I-UNEDITED-FIELD  26450041
264600         MOVE LENGTH OF PURCHS-DEPT-NBR TO DP010I-MAXIMUM-DIGITS  26460041
264700         MOVE ZERO                      TO DP010I-MAXIMUM-DECIMALS26470041
264800         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  26480041
264910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         26491052
264920              USING DP010I-NUMERIC-EDIT-AREA                      26492052
265000         IF  DP010I-ERROR-DETECTED                                26500041
265100             MOVE  ZEROES               TO  ASC-DEPT-N            26510041
265200         ELSE                                                     26520041
265300             MOVE DP010I-NUMERIC-FIELD  TO  ASC-DEPT-N            26530041
265400         END-IF                                                   26540041
265500     ELSE                                                         26550041
265600             MOVE  ZEROES               TO  ASC-DEPT-N            26560041
265700     END-IF.                                                      26570041
265800                                                                  26580041
265900                                                                  26590041
266000*----------------------------------------------------------------*26600006
266100*    GET MERCHANDISE ZONE DESCRIPTION.                           *26610006
266200*----------------------------------------------------------------*26620006
266300 7100-GET-ZONE-DESC.                                              26630006
266400                                                                  26640006
266500     EXEC SQL                                                     26650006
266600         SELECT C.STR_ZN_ID                                       26660006
266700           INTO :MDSEDP-STR-ZN-ID                                 26670006
266800           FROM TPURCHS A,                                        26680006
266900                TMDSEAR B,                                        26690006
267000                TMDSEDP C                                         26700006
267100          WHERE A.PO_NBR          = :DK-ORD-NBR                   26710006
267200            AND A.VER_STATUS_CDE  = 'A'                           26720006
267300            AND A.DEPT_NBR        = B.DEPT_NBR                    26730006
267400            AND B.MDSELV_CDE      = 'DPT'                         26740006
267500            AND B.OPERCO_NBR      = '03'                          26750006
267600            AND (B.STRT_DTE      <= CURRENT DATE AND              26760006
267700                 B.END_DTE       > CURRENT DATE)                  26770006
267800            AND B.MDSEAR_DKEY     = C.MDSEAR_DKEY                 26780006
267900     END-EXEC                                                     26790006
268000                                                                  26800006
268100     EVALUATE TRUE                                                26810006
268200         WHEN SQLCODE = ZERO                                      26820006
268300         WHEN SQLCODE = +100                                      26830006
268400             CONTINUE                                             26840006
268500                                                                  26850006
268600         WHEN SQLCODE = -904                                      26860006
268700         WHEN SQLCODE = -911                                      26870006
268800         WHEN SQLCODE = -913                                      26880006
268900             PERFORM 9900-SOFT-ABORT                              26890006
269000                                                                  26900006
269100         WHEN SQLWARN0 NOT = SPACES                               26910006
269200         WHEN SQLCODE < ZERO                                      26920006
269300         WHEN SQLCODE > ZERO                                      26930006
269400             MOVE '7100-GET-ZONE-DESC'                            26940006
269500                                   TO DP013-PARAGRAPH             26950006
269600             MOVE 'UNSUCCESSFUL SELECT OF ZONE DESC'              26960006
269700                                   TO DP013-MESSAGE-TEXT (1)      26970006
269800             MOVE SQLCA      TO DP013-SQLCA                       26980006
269900             MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)          26990006
270000             MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (2)          27000006
270100             MOVE 'TMDSEDP ' TO DP013-DB2-TABLE-NAME (3)          27010006
270200             SET DP013-DB2-ABEND                                  27020006
270300                 DP013-NO-ROLLBACK TO TRUE                        27030006
270400             PERFORM DP013-0000-PROCESS-ABEND                     27040006
270500     END-EVALUATE.                                                27050006
270600                                                                  27060005
270700*----------------------------------------------------------------*27070005
270800*    GET SHOP KEEPING UNIT FOR ITEM.                             *27080005
270900*----------------------------------------------------------------*27090005
271000*                                               **   WR # 21361  *27100038
271100* ADDED CODE TO INCLUDE XLKUT001 LOGIC.                          *27110017
271200*----------------------------------------------------------------*27120017
271300 7200-GET-SKU.                                                    27130006
271400     SET PS-CALL-API-NO TO TRUE.                                  27140026
271500     MOVE SPACES             TO ASC-STATUS-CDE.                   27150047
271600                                                                  27160047
271700     EXEC SQL                                                     27170005
271800         SELECT B.CL_NBR                                          27180005
271900              , B.SKU_SEQ_NBR                                     27190005
272000              , A.STATUS_CDE                                      27200005
272100              , B.ITM_NBR                                         27210017
272200           INTO :PURITM-CL-NBR                                    27220005
272300              , :PURITM-SKU-SEQ-NBR                               27230005
272400              , :RECITM-STATUS-CDE                                27240005
272500              , :PURITM-ITM-NBR                                   27250017
272600           FROM TRECITM A                                         27260005
272700              , TPURITM B                                         27270005
272800          WHERE A.ORD_NBR          = :DK-ORD-NBR                  27280005
272900            AND A.ORD_NBR          = B.PO_NBR                     27290005
273000            AND A.REC_SEQ_NBR      = :DK-RCVR-NBR                 27300005
273100            AND A.ORD_LNE_NBR      = :DK-LNE-NBR                  27310005
273200            AND A.ORD_LNE_NBR      = B.APP_PO_LNE_NBR             27320005
273300            AND A.VER_STATUS_CDE   = 'A'                          27330005
273400            AND A.PO_VER_NBR       = B.VER_NBR                    27340005
273500     END-EXEC.                                                    27350005
273600                                                                  27360005
273700     EVALUATE TRUE                                                27370005
273800         WHEN SQLCODE = ZERO                                      27380005
273900             SET PS-CALL-API-YES TO TRUE                          27390034
274000             MOVE RECITM-STATUS-CDE  TO ASC-STATUS-CDE            27400047
274100                                                                  27410005
274200         WHEN SQLCODE = +100                                      27420005
274300         WHEN SQLCODE = -305                                      27430005
274400             MOVE SPACES TO PURITM-CL-NBR                         27440005
274500                            PURITM-SKU-SEQ-NBR                    27450005
274600                                                                  27460005
274700         WHEN SQLCODE = -904                                      27470005
274800         WHEN SQLCODE = -911                                      27480005
274900         WHEN SQLCODE = -913                                      27490005
275000             PERFORM 9900-SOFT-ABORT                              27500005
275100                                                                  27510005
275200         WHEN SQLWARN0 NOT = SPACES                               27520005
275300         WHEN SQLCODE < ZERO                                      27530005
275400         WHEN SQLCODE > ZERO                                      27540005
275500             MOVE '7100-GET-SKU' TO DP013-PARAGRAPH               27550005
275600             MOVE 'GET SKU FOR LINE'                              27560005
275700                                 TO DP013-MESSAGE-TEXT (1)        27570005
275800             MOVE SQLCA          TO DP013-SQLCA                   27580005
275900             MOVE 'TRECITM ' TO DP013-DB2-TABLE-NAME (1)          27590005
276000             SET DP013-DB2-ABEND                                  27600005
276100                 DP013-NO-ROLLBACK                                27610005
276200                                  TO TRUE                         27620005
276300             PERFORM DP013-0000-PROCESS-ABEND                     27630005
276400     END-EVALUATE.                                                27640005
276500                                                                  27650005
276600*----------------------------------------------------------------*27660041
276700*    CALL (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)             27670041
276800*    TO SEE IF THIS IS AN AUTOVE PO                               27680041
276900*----------------------------------------------------------------*27690041
277000 8400-CHECK-AUTOVE.                                               27700041
277100                                                                  27710041
277200     INITIALIZE RC040-FIELDS.                                     27720041
277300     MOVE ASC-KEY-OPER-UNT-ID TO RC040-SIGNON-LOCATION.           27730041
277400     MOVE ASC-KEY-PO-NBR      TO RC040-PO-NBR.                    27740041
277500     MOVE ASC-KEY-REC-SEQ-NBR TO RC040-PO-RCVR.                   27750041
277600     SET  RC040-RCVR-EXISTS   TO TRUE.                            27760041
277700     MOVE ASC-DEPT-N          TO RC040-DEPT.                      27770041
277800     MOVE DP020-USERID        TO RC040-USER-ID.                   27780041
277900     MOVE 'RCKCS812'          TO RC040-CALLING-PROGRAM.           27790041
278000                                                                  27800041
278100     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  27810041
278200                                        RC040-COMMAREA            27820041
278300                                        RC040-FIELDS.             27830041
278400     EVALUATE TRUE                                                27840041
278500         WHEN RC040-SUCCESSFUL                                    27850041
278600              MOVE RC040-AUTO-VE-SW     TO ASC-AUTO-VE-SW         27860041
278700         WHEN RC040-DATABASE-BUSY OR                              27870041
278800              RC040-INVALID-SQL                                   27880041
278900                  MOVE PC-TSYMSG-00984  TO DP020-MSG-NUMBER       27890041
279000                  SET DP020-MSG-WARNING TO TRUE                   27900041
279100                  SET DP030-OVERRIDE-GO TO TRUE                   27910041
279200                  SET PS-ERROR          TO TRUE                   27920041
279300         WHEN RC040-NOT-SUCCESSFUL                                27930041
279400                  MOVE PC-TSYMSG-03138  TO DP020-MSG-NUMBER       27940041
279500                  SET DP020-MSG-WARNING TO TRUE                   27950041
279600                  SET DP030-OVERRIDE-GO TO TRUE                   27960041
279700                  SET PS-ERROR          TO TRUE                   27970041
279800         WHEN OTHER                                               27980041
279900             MOVE '8400-CHECK-AUTOVE ' TO DP013-PARAGRAPH         27990041
280000             MOVE 'UNSUCCESSFUL CALL TO AUTO VE MOD'              28000041
280100                                         TO DP013-MESSAGE-TEXT (1)28010041
280200             MOVE RC040-SUCCESS-IND      TO DP013-MESSAGE-TEXT (2)28020041
280300             MOVE RC040-SQLCA            TO DP013-SQLCA           28030041
280400             SET DP013-DB2-ABEND                                  28040041
280500                 DP013-XCTL-DISPLAY-RESTART  TO TRUE              28050041
280600             SET PS-ERROR                    TO TRUE              28060041
280700             PERFORM DP013-0000-PROCESS-ABEND                     28070041
280800     END-EVALUATE.                                                28080041
280900                                                                  28090041
281000*----------------------------------------------------------------*28100034
281100* CHANGES MADE FOR WR # 21361 ENDS HERE.                         *28110038
281200*----------------------------------------------------------------*28120034
281300*----------------------------------------------------------------*28130001
281400*    READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE     *28140001
281500*----------------------------------------------------------------*28150001
281600 9100-READ-SEL-QUEUE.                                             28160001
281700                                                                  28170001
281800     EXEC CICS                                                    28180001
281900         READQ TS                                                 28190001
282000         QUEUE (ASC-SEL-QUEUE-NAME-IN)                            28200007
282100          INTO (RC801-PREPACK-SELECT-RECORD)                      28210003
282200          ITEM (ASC-SEL-ITEM)                                     28220003
282300          RESP (PV-CICS-RESP)                                     28230003
282400     END-EXEC.                                                    28240001
282500                                                                  28250001
282600     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        28260003
282700         CONTINUE                                                 28270001
282800     ELSE                                                         28280001
282900         SET DP013-LOGIC-ABEND                                    28290001
283000             DP013-NO-ROLLBACK      TO TRUE                       28300003
283100         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            28310003
283200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   28320001
283300                                    TO DP013-MESSAGE-TEXT (1)     28330003
283400         PERFORM DP013-0000-PROCESS-ABEND                         28340001
283500     END-IF.                                                      28350001
283600                                                                  28360001
283700*----------------------------------------------------------------*28370001
283800*    UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE     *28380001
283900*----------------------------------------------------------------*28390001
284000 9200-REWRITE-LIST-QUEUE.                                         28400001
284100                                                                  28410001
284200     EXEC CICS                                                    28420001
284300         WRITEQ TS                                                28430003
284400          QUEUE (ASC-SEL-QUEUE-NAME-IN)                           28440007
284500           FROM (RC801-PREPACK-SELECT-RECORD)                     28450003
284600           ITEM (ASC-SEL-ITEM)                                    28460003
284700           RESP (PV-CICS-RESP)                                    28470003
284800        REWRITE                                                   28480003
284900     END-EXEC.                                                    28490001
285000                                                                  28500001
285100     IF PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                    28510003
285200         SET DP013-CICS-ABEND                                     28520001
285300             DP013-NO-ROLLBACK          TO TRUE                   28530003
285400         MOVE '9200-REWRITE-LIST-QUEUE' TO DP013-PARAGRAPH        28540003
285500         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   28550001
285600                                        TO DP013-MESSAGE-TEXT (1) 28560003
285700         PERFORM DP013-0000-PROCESS-ABEND                         28570001
285800     END-IF.                                                      28580001
285900                                                                  28590001
286000******************************************************************28600001
286100*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *28610001
286200*    AND THE ERROR SWITCHES.                                     *28620001
286300******************************************************************28630001
286400 9900-SOFT-ABORT.                                                 28640001
286500                                                                  28650003
286600     SET PS-ERROR             TO TRUE.                            28660003
286700     SET DP020-MSG-FATAL      TO TRUE.                            28670003
286800     MOVE PC-TSYMSG-00551     TO DP020-MSG-NUMBER.                28680003
286900     SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                        28690003
287000     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          28700001
287100     PERFORM 0001-CALL-CICS-ARCH-API.                             28710001
287200                                                                  28720001
287300*----------------------------------------------------------------*28730001
287400*    ABEND PROCESSOR MODULE                                      *28740001
287500*----------------------------------------------------------------*28750001
287600     COPY DPPD013.                                                28760001
