       IDENTIFICATION DIVISION.                                         00010023
000300 PROGRAM-ID.    MLKUP030                                          00020009
000400 AUTHOR.        TESS BESTE.                                       00030009
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040009
000600 DATE-WRITTEN.  11-12-93.                                         00050009
000700 DATE-COMPILED.                                                   00060009
000800                                                                  00070009
000900******************************************************************00080009
001000*           MLKUP030 - FORMAT FOR LEDGER UPDATE                   00090009
001100*                                                                 00100009
001200* THIS PROGRAM READS FOUR TRANSACTION EXTRACT FILES (PURCHASE,    00110009
001300* SALE, PRICE CHANGE, AND ADJUSTMENT), FORMATS THE TRANSACTIONS   00120009
001400* INTO THE LAYOUTS USED BY THE MERCHANDISE LEDGER UPDATE, AND     00130009
001500* WRITES THEM TO A COMMON OUTPUT FILE.                            00140009
001600******************************************************************00150009
      *                                                                *00160018
      ******************** HISTORY OF CHANGES **************************00170018
      * CHG ID/                                                        *00180018
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                    *00190018
      * -------  ----------  ----------------------------------------  *00200018
      * 5408     10/27/97    MODIFIED B300-FORMAT-PRICE-CHANGE-TRANS   *00210018
      *                      TO MOVE ONE NEW FIELD THAT WAS ADDED TO   *00220018
      *                      MLRD023 TO KDM2809.  THE FIELD            *00230018
      *                      THE FIELD IS ML023-PC-MKDN-MKUP-RSN-CDE.  *00240018
      *                      - KARI SUTTON - (MARKDOWN/UP REPORT)      *00250018
      * 5830     11/26/97    MODIFIED B100-FORMAT-PURCHASE-TRANS       *00260018
      *                      AND B200-FORMAT-SALE-TRANS TO MOVE THREE  *00270018
      *                      NEW FIELDS THAT WERE ADDED TO KDM2809     *00280018
      *                      NEW FIELDS:                               *00290018
      *                          D115-FIN-LIAB-DTE                     *00300018
      *                          D115-AP-TRANS-CDE                     *00310018
      *                          D115-SALE-TYP-CDE                     *00320018
      *                      - BOB MCASEY  - (M/L MODIFICATION)        *00330018
      * 21731    12-03-2001  MODIFIED B100-FORMAT-PURCHASE-TRANS       *00340018
      *                      TO ADD MOVE STATEMENTS FOR NON-INTELLIGENT*00350018
      *                      SKU PROJECT               - V. LEE YANG   *00360018
      * 23511    03-02-2002  - CAROL WOJCIECHOWSKI                      00370021
      *                      MODIFIED LENGTH OF OC-OUTPUT-CONTROL-RECORD00380021
      *                      AND ML-FORMATTED-TRANS-RECORD              00390021
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00400023
W28543* W28543  11-30-2005 REMOVE CALENDAR ROUTINE AND REPLACE WITH     00410024
W28543*                    ML CONTROL TABLE/DATE ATTRIBUTE TABLE. PGM   00420024
W25843*                    IS NOW DB2. ADD INP05 WITH CONTROL DATE      00430024
W26606* W28582  24-01-2006   - JOHN SELWITSCHKA                         00440048
W26606*                      PRICE CHANGE COPYBOOKS EXPANSION.          00450043
W26606*                      MODIFIED PRICE-CHANGE-EXTRACT-FILE LRECL.  00460043
207210*CHG0207210  JIM HUNTER          08/24/18                         00470050
207210*        RENAME KDM2809 TO MLWS050 AND REMOVED COMMENTED          00480050
207210*        REFERENCE TO KDU1805.                                    00490050
      ******************************************************************00500018
001700                                                                  00510009
002000 ENVIRONMENT DIVISION.                                            00520009
002200 CONFIGURATION SECTION.                                           00530009
002300 SOURCE-COMPUTER.        IBM-3090.                                00540009
002400 OBJECT-COMPUTER.        IBM-3090.                                00550009
002500 INPUT-OUTPUT SECTION.                                            00560009
002600 FILE-CONTROL.                                                    00570009
002700     SELECT PURCHASE-EXTRACT-FILE                                 00580009
002800         ASSIGN TO INP01.                                         00590009
002900     SELECT SALE-EXTRACT-FILE                                     00600009
003000         ASSIGN TO INP02.                                         00610009
003100     SELECT PRICE-CHANGE-EXTRACT-FILE                             00620009
003200         ASSIGN TO INP03.                                         00630009
003300     SELECT ADJUSTMENT-EXTRACT-FILE                               00640009
003400         ASSIGN TO INP04.                                         00650009
W28543     SELECT ML-DATE-CONTROL-FILE                                  00660024
W28543         ASSIGN TO INP05.                                         00670024
003500     SELECT ML-FORMATTED-TRANS-FILE                               00680009
003600         ASSIGN TO OUT01.                                         00690009
003700                                                                  00700009
004000 DATA DIVISION.                                                   00710009
004100 FILE SECTION.                                                    00720009
004200                                                                  00730009
004300 FD  PURCHASE-EXTRACT-FILE                                        00740009
004400     LABEL RECORDS ARE STANDARD                                   00750009
004500     RECORDING MODE IS F                                          00760009
004600     BLOCK CONTAINS 0 RECORDS.                                    00770009
004700 01  PURCHASE-EXTRACT-RECORD     PIC X(150).                      00780009
004800                                                                  00790009
005000 FD  SALE-EXTRACT-FILE                                            00800009
005100     LABEL RECORDS ARE STANDARD                                   00810009
005200     RECORDING MODE IS F                                          00820009
005300     BLOCK CONTAINS 0 RECORDS.                                    00830009
005400 01  SALE-EXTRACT-RECORD         PIC X(80).                       00840009
005500                                                                  00850009
005700 FD  PRICE-CHANGE-EXTRACT-FILE                                    00860009
005800     LABEL RECORDS ARE STANDARD                                   00870009
005900     RECORDING MODE IS F                                          00880009
006000     BLOCK CONTAINS 0 RECORDS.                                    00890009
W26606 01  PRICE-CHANGE-EXTRACT-RECORD PIC X(130).                      00900043
006300                                                                  00910009
006400 FD  ADJUSTMENT-EXTRACT-FILE                                      00920009
006500     LABEL RECORDS ARE STANDARD                                   00930009
006600     RECORDING MODE IS F                                          00940009
006700     BLOCK CONTAINS 0 RECORDS.                                    00950009
006800 01  ADJUSTMENT-EXTRACT-RECORD PIC X(90).                         00960009
006300                                                                  00970024
W28543 FD  ML-DATE-CONTROL-FILE                                         00980028
W28543     LABEL RECORDS ARE STANDARD                                   00990028
W28543     RECORDING MODE IS F                                          01000028
W28543     BLOCK CONTAINS 0 RECORDS.                                    01010028
W28543 01  ML-DATE-CONTROL-RECORD    PIC X(80).                         01020028
007000                                                                  01030009
007100 FD  ML-FORMATTED-TRANS-FILE                                      01040009
007200     LABEL RECORDS ARE STANDARD                                   01050009
007300     RECORDING MODE IS F                                          01060009
007400     BLOCK CONTAINS 0 RECORDS.                                    01070009
W23511 01  ML-FORMATTED-TRANS-RECORD PIC X(125).                        01080021
007700                                                                  01090009
007800 WORKING-STORAGE SECTION.                                         01100009
007900                                                                  01110009
008300                                                                  01120009
008400 01  PS-PROGRAM-SWITCHES.                                         01130009
008500     05  PS-EOF-PURCHASE-EXTRACT-SW   PIC  X        VALUE 'N'.    01140009
008600         88  PS-EOF-PURCHASE-EXTRACT                VALUE 'Y'.    01150009
008700     05  PS-EOF-SALE-EXTRACT-SW       PIC  X        VALUE 'N'.    01160009
008800         88  PS-EOF-SALE-EXTRACT                    VALUE 'Y'.    01170009
008900     05  PS-EOF-PRICE-CHANGE-EXTRACT-SW                           01180009
009000                                      PIC  X        VALUE 'N'.    01190009
009100         88  PS-EOF-PRICE-CHANGE-EXTRACT            VALUE 'Y'.    01200009
009200     05  PS-EOF-ADJUSTMENT-EXTRACT-SW PIC  X        VALUE 'N'.    01210009
009300         88  PS-EOF-ADJUSTMENT-EXTRACT              VALUE 'Y'.    01220009
009400                                                                  01230009
009500 01  PV-PROGRAM-VARIABLES.                                        01240009
W26603*    05  PV-5-DIGIT-STORE.                                        01250023
W26603*        10  FILLER                   PIC  X        VALUE '0'.    01260023
W26603*        10  PV-5-DIGIT-STORE-2-4     PIC  X(3).                  01270023
W26603*        10  FILLER                   PIC  X.                     01280023
010000     05  PV-ACCT-NO.                                              01290009
W26603*****    10  FILLER                   PIC  X(2)     VALUE '00'.   01300023
W26603         10  PV-ACCT-NO-STORE-NBR     PIC  X(5).                  01310023
010300     05  PV-ISO-FMT-DATE.                                         01320009
010400         10  PV-ISO-FMT-CC            PIC  9(02).                 01330009
010500         10  PV-ISO-FMT-YY            PIC  9(02).                 01340009
010600         10  FILLER                   PIC  X.                     01350009
010700         10  PV-ISO-FMT-MM            PIC  9(02).                 01360009
010800         10  FILLER                   PIC  X.                     01370009
010900         10  PV-ISO-FMT-DD            PIC  9(02).                 01380009
           05  PV-FORMATTED-DATE.                                       01390016
               10  PV-FMT-DTE-CCYY          PIC X(04).                  01400016
               10  FILLER                   PIC X(01).                  01410016
               10  PV-FMT-DTE-MM            PIC X(02).                  01420016
               10  FILLER                   PIC X(01).                  01430016
               10  PV-FMT-DTE-DD            PIC X(02).                  01440016
           05  PV-UNFMT-DATE.                                           01450016
               10  PV-UNFMT-DTE-CCYY        PIC X(04).                  01460016
               10  PV-UNFMT-DTE-MM          PIC X(02).                  01470016
               10  PV-UNFMT-DTE-DD          PIC X(02).                  01480016
W28543     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACE. 01490026
W28543     05  PV-DB2-OPER-ATTEMPTED        PIC  X(30)     VALUE SPACE. 01500026
W28543     05  PV-ABEND-CODE                PIC S9(04)     COMP         01510026
W28543                                                     VALUE ZERO.  01520026
011000                                                                  01530009
011100 01  RC-RECORD-COUNTS.                                            01540009
011200     05  RC-XT-EXTRACT-COUNTS.                                    01550009
011300         10  RC-XT-PURCHASE-EXTRACT-CNT     PIC S9(7) COMP-3      01560009
011400                                                      VALUE ZERO. 01570009
011500         10  RC-XT-SALE-EXTRACT-CNT         PIC S9(7) COMP-3      01580009
011600                                                      VALUE ZERO. 01590009
011700         10  RC-XT-PRICE-CHANGE-EXTRACT-CNT PIC S9(7) COMP-3      01600009
011800                                                      VALUE ZERO. 01610009
011900         10  RC-XT-ADJUSTMENT-EXTRACT-CNT   PIC S9(7) COMP-3      01620009
012000                                                      VALUE ZERO. 01630009
012100     05  RC-ML-FORMATTED-TRANS-COUNTS.                            01640009
012200         10  RC-ML-PURCHASE-TRANS-CNT       PIC S9(7) COMP-3      01650009
012300                                                      VALUE ZERO. 01660009
012400         10  RC-ML-TRANSFER-FROM-TRANS-CNT  PIC S9(7) COMP-3      01670009
012500                                                      VALUE ZERO. 01680009
012600         10  RC-ML-TRANSFER-TO-TRANS-CNT    PIC S9(7) COMP-3      01690009
012700                                                      VALUE ZERO. 01700009
012800         10  RC-ML-SALE-CNT                 PIC S9(7) COMP-3      01710009
012900                                                      VALUE ZERO. 01720009
013000         10  RC-ML-MARKDOWN-CNT             PIC S9(7) COMP-3      01730009
013100                                                      VALUE ZERO. 01740009
013200         10  RC-ML-MARKUP-CNT               PIC S9(7) COMP-3      01750009
013300                                                      VALUE ZERO. 01760009
013400         10  RC-ML-ADJUSTMENT-CNT           PIC S9(7) COMP-3      01770009
013500                                                      VALUE ZERO. 01780009
013600                                                                  01790009
013700 01  DF-DISPLAY-FIELDS.                                           01800009
013800     05  DF-XT-COUNTS-TITLE-1         PIC  X(32)    VALUE         01810009
013900                  'NUMBER OF EXTRACT RECORDS READ'.               01820009
014000     05  DF-XT-COUNTS-TITLE-2         PIC  X(32)    VALUE ALL '-'.01830009
014100     05  DF-XT-COUNT-DISPLAY.                                     01840009
014200         10  FILLER                   PIC  X(4)     VALUE SPACE.  01850009
014300         10  DF-XT-TRANS-TYPE         PIC  X(20).                 01860009
014400         10  DF-XT-RECORD-CNT         PIC  Z(6)9.                 01870009
014500     05  DF-ML-COUNTS-TITLE-1         PIC  X(43)    VALUE         01880009
014600                  'NUMBER OF FORMATTED ML TRANSACTIONS WRITTEN'.  01890009
014700     05  DF-ML-COUNTS-TITLE-2         PIC  X(43)    VALUE ALL '-'.01900009
014800     05  DF-ML-TRANS-HEADING.                                     01910009
014900         10  FILLER                   PIC  X(4)     VALUE SPACE.  01920009
015000         10  DF-ML-TRANS-TYPE-HEAD    PIC  X(18).                 01930009
015100     05  DF-ML-COUNT-DISPLAY.                                     01940009
015200         10  FILLER                   PIC  X(6)     VALUE SPACE.  01950009
015300         10  DF-ML-TRANS-TYPE         PIC  X(18).                 01960009
015400         10  DF-ML-RECORD-CNT         PIC  Z(6)9.                 01970009
015500                                                                  01980009
015600 01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.01990009
015700                                                                  02000009
016100*                                                                 02010025
W28543******************************************************************02020024
W28543*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        02030024
W28543******************************************************************02040024
W28543     COPY DPWS004.                                                02050024
W28543                                                                  02060024
W28543     EXEC SQL                                                     02070024
W28543         INCLUDE SQLCA                                            02080024
W28543     END-EXEC.                                                    02090024
W28543                                                                  02100024
W28543     EXEC SQL                                                     02110024
W28543         INCLUDE TDTATTR                                          02120024
W28543     END-EXEC.                                                    02130024
W28543                                                                  02140024
016500******************************************************************02150009
016600* CALENDAR ROUTINE WORK AREA.                                     02160009
016700******************************************************************02170009
016800*                                                                 02180024
016900*    COPY DPWS500.                                                02190024
017000*                                                                 02200024
017100                                                                  02210009
017200******************************************************************02220009
017300* INPUT CONTROL CARD LAYOUT.                                      02230009
017400******************************************************************02240009
017500 01  CC-CONTROL-CARD.                                             02250009
W28543*    05  CC-CALENDAR-TYPE        PIC  X(02)    VALUE SPACE.       02260024
W28543     05  FILLER                  PIC  X(03)    VALUE SPACE.       02270024
017800     05  CC-INPUT-DATE.                                           02280034
017900         10  CC-ISO-FMT-CC       PIC  X(02)    VALUE SPACE.       02290009
018000         10  CC-ISO-FMT-YY       PIC  X(02)    VALUE SPACE.       02300009
018100         10  CC-ISO-FMT-DASH1    PIC  X        VALUE SPACE.       02310009
018200         10  CC-ISO-FMT-MM       PIC  X(02)    VALUE SPACE.       02320009
018300         10  CC-ISO-FMT-DASH2    PIC  X        VALUE SPACE.       02330009
018400         10  CC-ISO-FMT-DD       PIC  X(02)    VALUE SPACE.       02340009
018500     05  FILLER                  PIC  X(67)    VALUE SPACE.       02350009
018600                                                                  02360009
W28543 01  CC-CONTROL-DATE             PIC  X(10)    VALUE SPACE.       02370035
018800******************************************************************02380009
018900* OUTPUT CONTROL RECORD LAYOUT. THE CONTROL RECORD IS THE FIRST   02390009
019000* RECORD WRITTEN TO THE FORMATTED TRANSACTION FILE.               02400009
019100******************************************************************02410009
019200 01  OC-OUTPUT-CONTROL-RECORD.                                    02420009
019300     05  FILLER                  PIC  X(02)    VALUE SPACE.       02430009
019400     05  FILLER                  PIC  X(18)    VALUE SPACE.       02440009
019500     05  FILLER                  PIC  X(08)    VALUE 'DSAIC40U'.  02450009
019600     05  FILLER                  PIC  X(01)    VALUE SPACE.       02460009
W28543     05  OC-WEEK-END-DATE.                                        02470040
W28543         10  OC-WEEK-END-MM      PIC  X(02)    VALUE SPACE.       02480040
W28543         10  OC-WEEK-END-DD      PIC  X(02)    VALUE SPACE.       02490040
W28543         10  OC-WEEK-END-YY      PIC  X(02)    VALUE SPACE.       02500040
019800     05  FILLER                  PIC  X(01)    VALUE SPACE.       02510009
019900     05  OC-NEW-MONTH            PIC  X(01)    VALUE SPACE.       02520009
020000     05  FILLER                  PIC  X(01)    VALUE SPACE.       02530009
020100     05  FILLER                  PIC  X(01)    VALUE SPACE.       02540009
W28543     05  FILLER                  PIC  X(82)    VALUE SPACE.       02550038
020300                                                                  02560009
020400                                                                  02570009
020500***************************************************************** 02580009
020600* PURCHASE EXTRACT RECORD LAYOUT                                  02590009
020700***************************************************************** 02600009
020800                                                                  02610009
21731      COPY MLRD021.                                                02620022
021000                                                                  02630009
021100                                                                  02640009
021200***************************************************************** 02650009
021300* SALE EXTRACT RECORD LAYOUT                                      02660009
021400***************************************************************** 02670009
021500                                                                  02680009
021600     COPY MLRD022.                                                02690022
021700                                                                  02700009
021800                                                                  02710009
021900***************************************************************** 02720009
022000* PRICE CHANGE EXTRACT RECORD LAYOUT                              02730009
022100***************************************************************** 02740009
022200                                                                  02750009
W26606     COPY MLRD023.                                                02760047
022400                                                                  02770009
022500                                                                  02780009
022600***************************************************************** 02790009
022700* ADJUSTMENT EXTRACT RECORD LAYOUT                                02800009
022800***************************************************************** 02810009
022900                                                                  02820009
023000     COPY MLRD024.                                                02830022
023100                                                                  02840009
023200                                                                  02850009
023300***************************************************************** 02860009
023400* MERCHANDISE LEDGER FORMATTED TRANSACTION LAYOUT                 02870009
023500***************************************************************** 02880009
023600                                                                  02890009
207210     COPY MLWS050.                                                02900050
023800                                                                  02910009
023900                                                                  02920009
024000 LINKAGE SECTION.                                                 02930009
024100                                                                  02940009
024200                                                                  02950009
024300 PROCEDURE DIVISION.                                              02960009
024400                                                                  02970009
024500 A100-MAIN-MODULE.                                                02980009
024600                                                                  02990009
W28543     OPEN INPUT  ML-DATE-CONTROL-FILE.                            03000024
024700     OPEN OUTPUT ML-FORMATTED-TRANS-FILE.                         03010024
024800                                                                  03020009
W28543     PERFORM B050-PROCESS-CONTROL-CARD.                           03030030
025000                                                                  03040009
025100     DISPLAY DF-XT-COUNTS-TITLE-1.                                03050009
025200     DISPLAY DF-XT-COUNTS-TITLE-2.                                03060009
025300                                                                  03070009
025400*    *------------------------------------------------------------03080009
025500*    * PROCESS THE PURCHASE EXTRACT FILE AND DISPLAY THE          03090009
025600*    * NUMBER OF PURCHASE EXTRACT RECORDS READ.                   03100009
025700*    *------------------------------------------------------------03110009
025800     OPEN INPUT PURCHASE-EXTRACT-FILE.                            03120009
025900     PERFORM Z100-READ-PURCHASE-EXTRACT.                          03130009
026000     PERFORM B100-FORMAT-PURCHASE-TRANS                           03140009
026100         UNTIL PS-EOF-PURCHASE-EXTRACT.                           03150009
026200     CLOSE PURCHASE-EXTRACT-FILE.                                 03160009
026300     MOVE 'PURCHASE:'                TO DF-XT-TRANS-TYPE.         03170009
026400     MOVE RC-XT-PURCHASE-EXTRACT-CNT TO DF-XT-RECORD-CNT.         03180009
026500     DISPLAY DF-XT-COUNT-DISPLAY.                                 03190009
026600                                                                  03200009
026700*    *------------------------------------------------------------03210009
026800*    * PROCESS THE SALE EXTRACT FILE AND DISPLAY THE              03220009
026900*    * NUMBER OF SALE EXTRACT RECORDS READ.                       03230009
027000*    *------------------------------------------------------------03240009
027100     OPEN INPUT SALE-EXTRACT-FILE.                                03250009
027200     PERFORM Z200-READ-SALE-EXTRACT.                              03260009
027300     PERFORM B200-FORMAT-SALE-TRANS                               03270009
027400         UNTIL PS-EOF-SALE-EXTRACT.                               03280009
027500     CLOSE SALE-EXTRACT-FILE.                                     03290009
027600     MOVE 'SALE:'                TO DF-XT-TRANS-TYPE.             03300009
027700     MOVE RC-XT-SALE-EXTRACT-CNT TO DF-XT-RECORD-CNT.             03310009
027800     DISPLAY DF-XT-COUNT-DISPLAY.                                 03320009
027900                                                                  03330009
028000*    *------------------------------------------------------------03340009
028100*    * PROCESS THE PRICE CHANGE EXTRACT FILE AND DISPLAY THE      03350009
028200*    * NUMBER OF PRICE CHANGE EXTRACT RECORDS READ.               03360009
028300*    *------------------------------------------------------------03370009
028400     OPEN INPUT PRICE-CHANGE-EXTRACT-FILE.                        03380009
028500     PERFORM Z300-READ-PRICE-CHANGE-EXTRACT.                      03390009
028600     PERFORM B300-FORMAT-PRICE-CHANGE-TRANS                       03400009
028700         UNTIL PS-EOF-PRICE-CHANGE-EXTRACT.                       03410009
028800     CLOSE PRICE-CHANGE-EXTRACT-FILE.                             03420009
028900     MOVE 'PRICE CHANGE:'                TO DF-XT-TRANS-TYPE.     03430009
029000     MOVE RC-XT-PRICE-CHANGE-EXTRACT-CNT TO DF-XT-RECORD-CNT.     03440009
029100     DISPLAY DF-XT-COUNT-DISPLAY.                                 03450009
029200                                                                  03460009
029300*    *------------------------------------------------------------03470009
029400*    * PROCESS THE ADJUSTMENT EXTRACT FILE AND DISPLAY THE        03480009
029500*    * NUMBER OF ADJUSTMENT EXTRACT RECORDS READ.                 03490009
029600*    *------------------------------------------------------------03500009
029700     OPEN INPUT ADJUSTMENT-EXTRACT-FILE.                          03510009
029800     PERFORM Z400-READ-ADJUSTMENT-EXTRACT.                        03520009
029900     PERFORM B400-FORMAT-ADJUSTMENT-TRANS                         03530009
030000         UNTIL PS-EOF-ADJUSTMENT-EXTRACT.                         03540009
030100     CLOSE ADJUSTMENT-EXTRACT-FILE.                               03550009
030200     MOVE 'ADJUSTMENT:'                TO DF-XT-TRANS-TYPE.       03560009
030300     MOVE RC-XT-ADJUSTMENT-EXTRACT-CNT TO DF-XT-RECORD-CNT.       03570009
030400     DISPLAY DF-XT-COUNT-DISPLAY.                                 03580009
030500     DISPLAY ' '.                                                 03590009
030600                                                                  03600009
030700     CLOSE ML-FORMATTED-TRANS-FILE.                               03610009
030800                                                                  03620009
030900     DISPLAY DF-ML-COUNTS-TITLE-1.                                03630009
031000     DISPLAY DF-ML-COUNTS-TITLE-2.                                03640009
031100*    *------------------------------------------------------------03650009
031200*    * DISPLAY THE NUMBER OF PURCHASE TRANSACTIONS WRITTEN.       03660009
031300*    *------------------------------------------------------------03670009
031400     MOVE 'PURCHASE'                    TO DF-ML-TRANS-TYPE-HEAD. 03680009
031500     DISPLAY DF-ML-TRANS-HEADING.                                 03690009
031600     MOVE 'PURCHASE:'                   TO DF-ML-TRANS-TYPE.      03700009
031700     MOVE RC-ML-PURCHASE-TRANS-CNT      TO DF-ML-RECORD-CNT.      03710009
031800     DISPLAY DF-ML-COUNT-DISPLAY.                                 03720009
031900     MOVE 'TRANSFER FROM:'              TO DF-ML-TRANS-TYPE.      03730009
032000     MOVE RC-ML-TRANSFER-FROM-TRANS-CNT TO DF-ML-RECORD-CNT.      03740009
032100     DISPLAY DF-ML-COUNT-DISPLAY.                                 03750009
032200     MOVE 'TRANSFER TO:'                TO DF-ML-TRANS-TYPE.      03760009
032300     MOVE RC-ML-TRANSFER-TO-TRANS-CNT   TO DF-ML-RECORD-CNT.      03770009
032400     DISPLAY DF-ML-COUNT-DISPLAY.                                 03780009
032500     DISPLAY ' '.                                                 03790009
032600*    *------------------------------------------------------------03800009
032700*    * DISPLAY THE NUMBER OF SALE TRANSACTIONS WRITTEN.           03810009
032800*    *------------------------------------------------------------03820009
032900     MOVE 'SALE'                        TO DF-ML-TRANS-TYPE-HEAD. 03830009
033000     DISPLAY DF-ML-TRANS-HEADING.                                 03840009
033100     MOVE 'SALE:'                       TO DF-ML-TRANS-TYPE.      03850009
033200     MOVE RC-ML-SALE-CNT                TO DF-ML-RECORD-CNT.      03860009
033300     DISPLAY DF-ML-COUNT-DISPLAY.                                 03870009
033400     DISPLAY ' '.                                                 03880009
033500*    *------------------------------------------------------------03890009
033600*    * DISPLAY THE NUMBER OF PRICE CHANGE TRANSACTIONS WRITTEN.   03900009
033700*    *------------------------------------------------------------03910009
033800     MOVE 'PRICE CHANGE'                TO DF-ML-TRANS-TYPE-HEAD. 03920009
033900     DISPLAY DF-ML-TRANS-HEADING.                                 03930009
034000     MOVE 'MARKDOWN:'                   TO DF-ML-TRANS-TYPE.      03940009
034100     MOVE RC-ML-MARKDOWN-CNT            TO DF-ML-RECORD-CNT.      03950009
034200     DISPLAY DF-ML-COUNT-DISPLAY.                                 03960009
034300     MOVE 'MARKUP:'                     TO DF-ML-TRANS-TYPE.      03970009
034400     MOVE RC-ML-MARKUP-CNT              TO DF-ML-RECORD-CNT.      03980009
034500     DISPLAY DF-ML-COUNT-DISPLAY.                                 03990009
034600     DISPLAY ' '.                                                 04000009
034700*    *------------------------------------------------------------04010009
034800*    * DISPLAY THE NUMBER OF ADJUSTMENT TRANSACTIONS WRITTEN.     04020009
034900*    *------------------------------------------------------------04030009
035000     MOVE 'ADJUSTMENT'                  TO DF-ML-TRANS-TYPE-HEAD. 04040009
035100     DISPLAY DF-ML-TRANS-HEADING.                                 04050009
035200     MOVE 'ADJUSTMENT:'                 TO DF-ML-TRANS-TYPE.      04060009
035300     MOVE RC-ML-ADJUSTMENT-CNT          TO DF-ML-RECORD-CNT.      04070009
035400     DISPLAY DF-ML-COUNT-DISPLAY.                                 04080009
035500                                                                  04090009
035600     STOP RUN.                                                    04100009
035700                                                                  04110009
035800                                                                  04120009
035900******************************************************************04130009
036000* ACCEPT THE INPUT CONTROL CARD, VALIDATE ITS DATE, AND USE IT TO 04140009
036100* BUILD AND WRITE THE CONTROL RECORD FOR THE ML FORMATTED         04150009
036200* TRANSACTION FILE.                                               04160009
036300******************************************************************04170009
036400 B050-PROCESS-CONTROL-CARD.                                       04180009
036500                                                                  04190009
W28543     READ ML-DATE-CONTROL-FILE                                    04200024
W28543          INTO CC-CONTROL-CARD.                                   04210024
036700                                                                  04220009
036800     IF CC-CONTROL-CARD = SPACE                                   04230009
036900         DISPLAY '** ABEND **'                                    04240009
037000         DISPLAY '** PGM = MLKUP030'                              04250009
037100         DISPLAY '** INPUT CONTROL CARD MISSING OR BLANK'         04260009
037200         MOVE +4003 TO ABEND-CODE                                 04270009
037300         CALL 'ILBOABN0' USING ABEND-CODE                         04280009
W28543     ELSE                                                         04290024
037600         DISPLAY '** MLKUP030 INPUT CONTROL CARD ='               04300024
037600                                                  CC-CONTROL-CARD 04310024
W28543         MOVE CC-INPUT-DATE TO CC-CONTROL-DATE                    04320034
W28543         PERFORM B050-SELECT-TDTATTR                              04330024
037400     END-IF.                                                      04340009
040300                                                                  04350009
040400     IF  DTATTR-DAY-NM = 'SATURDAY'                               04360024
040500         CONTINUE                                                 04370009
040600     ELSE                                                         04380009
040700         DISPLAY '** ABEND **'                                    04390009
040800         DISPLAY '** PGM = MLKUP030'                              04400009
040900         DISPLAY '** CONTROL CARD DATE NOT A SATURDAY DATE.'      04410009
041000         MOVE +4003 TO ABEND-CODE                                 04420009
041100         CALL 'ILBOABN0' USING ABEND-CODE                         04430009
041200     END-IF.                                                      04440009
041300                                                                  04450009
W28543     MOVE DTATTR-FSCL-WK-END-DTE(6:2)  TO OC-WEEK-END-MM.         04460040
W28543     MOVE DTATTR-FSCL-WK-END-DTE(9:2)  TO OC-WEEK-END-DD.         04470040
W28543     MOVE DTATTR-FSCL-WK-END-DTE(3:2)  TO OC-WEEK-END-YY.         04480040
041500                                                                  04490025
041600     IF  DTATTR-WK-IN-MN-NBR = '1'                                04500025
041700         MOVE 'Y'         TO OC-NEW-MONTH                         04510009
041800     END-IF.                                                      04520009
041900                                                                  04530009
042000     MOVE OC-OUTPUT-CONTROL-RECORD TO ML-FORMATTED-TRANS-RECORD.  04540009
042200     PERFORM Z500-WRITE-ML-FORMATTED-TRANS.                       04550009
042300                                                                  04560009
W28543                                                                  04570024
W28543****************************************************************  04580024
W28543*  DATE TABLE CURSOR                                              04590024
W28543****************************************************************  04600024
W28543 B050-SELECT-TDTATTR.                                             04610024
W28543                                                                  04620024
W28543     EXEC SQL                                                     04630024
W28543           SELECT DAY_NM                                          04640025
W28543                 ,FSCL_WK_BEG_DTE                                 04650024
W28543                 ,FSCL_WK_END_DTE                                 04660024
W28543                 ,FSCL_MN_END_DTE                                 04670024
W28543                 ,FSCL_MN_NBR                                     04680025
W28543                 ,WK_IN_MN_NBR                                    04690037
W28543             INTO :DTATTR-DAY-NM                                  04700025
W28543                 ,:DTATTR-FSCL-WK-BEG-DTE                         04710024
W28543                 ,:DTATTR-FSCL-WK-END-DTE                         04720024
W28543                 ,:DTATTR-FSCL-MN-END-DTE                         04730024
W28543                 ,:DTATTR-FSCL-MN-NBR                             04740025
W28543                 ,:DTATTR-WK-IN-MN-NBR                            04750037
W28543             FROM TDTATTR                                         04760024
W28543            WHERE KY_DTE = :CC-CONTROL-DATE                       04770034
W28543     END-EXEC.                                                    04780024
W28543                                                                  04790024
W28543     EVALUATE TRUE                                                04800024
W28543         WHEN SQLCODE = ZERO                                      04810024
W28543             DISPLAY 'DTATTR-KEY-DATE:       ' CC-CONTROL-DATE    04820034
W28543             DISPLAY 'DTATTR-DAY-NAME:       ' DTATTR-DAY-NM      04830024
W28543             DISPLAY 'DTATTR-FSCL WK RANGE : '                    04840031
W28543                      DTATTR-FSCL-WK-BEG-DTE, ' THRU ',           04850031
W28543                      DTATTR-FSCL-WK-END-DTE                      04860031
W28543             DISPLAY 'DTATTR-FSCL-MN-END-DT: '                    04870031
W28543                                         DTATTR-FSCL-MN-END-DTE   04880024
W28543         WHEN OTHER                                               04890024
W28543             DISPLAY 'DTATTR-KY-DTE: ' CC-CONTROL-DATE            04900034
W28543             MOVE    'B050-SELECT-TDTATTR'                        04910024
W28543                                          TO PV-PARAGRAPH-NAME    04920024
W28543             MOVE    'SELECT CONTROL DATES'                       04930024
W28543                                          TO PV-DB2-OPER-ATTEMPTED04940024
W28543             PERFORM 9998-SQL-ABEND                               04950024
W28543     END-EVALUATE.                                                04960024
W28543                                                                  04970024
W28543                                                                  04980024
042400                                                                  04990024
042500******************************************************************05000009
042600* FORMAT AND WRITE THE PURCHASE TRANSACTIONS.                     05010009
042700******************************************************************05020009
042800 B100-FORMAT-PURCHASE-TRANS.                                      05030009
042900                                                                  05040009
043000     ADD +1 TO RC-XT-PURCHASE-EXTRACT-CNT.                        05050009
043100                                                                  05060009
043200     EVALUATE TRUE                                                05070009
043300         WHEN ML021-PURCH-PURCHASE                                05080009
043400             MOVE SPACE                  TO D115-PURCH-JOURNAL-REC05090009
043500             MOVE ML021-PURCH-TRANS-CDE  TO D115-CODE-10          05100009
043600             MOVE ML021-PURCH-BATCH-NBR  TO D115-BATCH-NO         05110009
W26603                                                                  05120023
W26603*            MOVE ML021-PURCH-STORE-NBR  TO PV-5-DIGIT-STORE-2-4  05130023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           05140023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        05150023
W26603*               THRU CHECK-DIGIT-EXIT                             05160023
W26603*            MOVE CD-STORE-NO            TO D115-STORE-10         05170023
W26603             MOVE ML021-PURCH-STORE-NBR  TO D115-STORE-10         05180023
W26603                                                                  05190023
044200             MOVE ML021-PURCH-DEPT-NBR   TO D115-DEPT-10X         05200009
044300             MOVE ML021-PURCH-CLASS-NBR  TO D115-CLASS-10X        05210009
044400             MOVE ML021-PURCH-DOC-5-NBR  TO D115-DOC-NO-10        05220009
044500             MOVE ML021-PURCH-DOC-DTE    TO PV-ISO-FMT-DATE       05230009
044600             MOVE PV-ISO-FMT-MM          TO D115-DOC-MM           05240009
044700             MOVE PV-ISO-FMT-DD          TO D115-DOC-DD           05250009
044800             MOVE ML021-PURCH-VEND-NBR   TO D115-VEND-NO-10       05260009
044900             MOVE ML021-PURCH-PO-NBR     TO D115-PO-NO            05270009
W26603                                                                  05280023
W26603*            MOVE ML021-PURCH-STORE-NBR  TO PV-ACCT-NO-STORE-NBR  05290023
W26603*            MOVE PV-ACCT-NO             TO D115-ACCT-NO          05300023
W26603             MOVE ML021-PURCH-STORE-NBR  TO D115-ACCT-NO          05310023
W26603                                                                  05320023
045200             MOVE ML021-PURCH-KOHLS-MM   TO D115-KOHLS-MM         05330009
045300             MOVE ML021-PURCH-EXTD-GRO-COST-AMT                   05340009
045400                                         TO D115-MERCH-AMT        05350009
045500             MOVE ML021-PURCH-DISC-AMT   TO D115-DISCT-AMT        05360009
045600             MOVE ML021-PURCH-FRGT-AMT   TO D115-FRGHT-AMT        05370009
045700             MOVE ML021-PURCH-EXTD-NET-COST-AMT                   05380009
045800                                         TO D115-NET-COST         05390009
045900             MOVE ML021-PURCH-EXTD-RTL-AMT                        05400009
046000                                         TO D115-RETAIL-AMT       05410009
046100             MOVE ML021-PURCH-DR-CR-CDE  TO D115-TRANS-CD         05420009
W28543*            MOVE DPG56-FISCAL-PERIOD-NBR-X TO                    05430025
W28543             MOVE DTATTR-FSCL-MN-NBR        TO                    05440025
046300                  D115-PJ-FISCAL-PERIOD                           05450009
W28543*            MOVE DPG56-FISCAL-PERIOD-WEEK-X TO                   05460025
W28543             MOVE DTATTR-FSCL-WK-NBR         TO                   05470025
046500                  D115-PJ-FISCAL-WK                               05480009
                   MOVE ML021-PURCH-FIN-LIAB-DTE TO PV-FORMATTED-DATE   05490016
                   MOVE PV-FMT-DTE-CCYY          TO PV-UNFMT-DTE-CCYY   05500016
                   MOVE PV-FMT-DTE-MM            TO PV-UNFMT-DTE-MM     05510016
                   MOVE PV-FMT-DTE-DD            TO PV-UNFMT-DTE-DD     05520016
                   MOVE PV-UNFMT-DATE            TO D115-FIN-LIAB-DTE   05530016
                   MOVE ML021-PURCH-AP-TRANS-CDE TO D115-AP-TRANS-CDE   05540016
046600             MOVE D115-PURCH-JOURNAL-REC                          05550009
046700                                      TO ML-FORMATTED-TRANS-RECORD05560009
046800             PERFORM Z500-WRITE-ML-FORMATTED-TRANS                05570009
046900             ADD +1 TO RC-ML-PURCHASE-TRANS-CNT                   05580009
047000         WHEN ML021-PURCH-TRANSFER-FRM-STORE                      05590009
047100             MOVE SPACE                  TO D115-TRANSFER-FROM-REC05600009
047200             MOVE ML021-PURCH-TRANS-CDE  TO D115-CODE-30          05610009
W26603                                                                  05620023
W26603*            MOVE ML021-PURCH-STORE-NBR  TO PV-5-DIGIT-STORE-2-4  05630023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           05640023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        05650023
W26603*            MOVE CD-STORE-NO            TO D115-TRANSFER-FROM    05660023
W26603             MOVE ML021-PURCH-STORE-NBR  TO D115-TRANSFER-FROM    05670023
W26603                                                                  05680023
047700             MOVE ML021-PURCH-DEPT-NBR   TO D115-DEPT-30X         05690009
047800             MOVE ML021-PURCH-CLASS-NBR  TO D115-CLASS-30X        05700009
21731              MOVE ML021-PURCH-SKU        TO D115-SKU-30           05710020
048000             MOVE ML021-PURCH-DOC-5-NBR  TO D115-DOC-NO-30        05720009
048100             MOVE ML021-PURCH-DOC-DTE    TO PV-ISO-FMT-DATE       05730009
048200             MOVE PV-ISO-FMT-MM          TO D115-TRANS-MM         05740009
048300             MOVE PV-ISO-FMT-DD          TO D115-TRANS-DD         05750009
W26603                                                                  05760023
W26603*            MOVE ML021-PURCH-REL-STORE-NBR                       05770023
W26603*                                        TO PV-5-DIGIT-STORE-2-4  05780023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           05790023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        05800023
W26603*            MOVE CD-STORE-NO            TO D115-TRANSFER-TO      05810023
W26603             MOVE ML021-PURCH-REL-STORE-NBR TO D115-TRANSFER-TO   05820023
W26603                                                                  05830023
048900             MOVE ML021-PURCH-KOHLS-MM   TO D115-KOHLS-MM-30      05840009
049000             MOVE ML021-PURCH-QTY        TO D115-TRANS-UNITS      05850009
049100             MOVE ML021-PURCH-PER-UNT-RTL-AMT                     05860009
049200                                         TO D115-RETAIL-PER-UN    05870009
049300             MOVE ML021-PURCH-BATCH-NBR  TO D115-TRANS-BATCHX     05880009
049400             MOVE ZERO                   TO D115-TRANS-SCAN-NO    05890009
049500             MOVE ML021-PURCH-EXTD-NET-COST-AMT                   05900009
049600                                      TO D115-TOTAL-TRNSFR-FM-COST05910009
W28543*            MOVE DPG56-FISCAL-PERIOD-NBR-X TO                    05920025
W28543             MOVE DTATTR-FSCL-MN-NBR        TO                    05930025
049800                  D115-TFR-FISCAL-PERIOD                          05940009
W28543*            MOVE DPG56-FISCAL-PERIOD-WEEK-X TO                   05950025
W28543             MOVE DTATTR-FSCL-WK-NBR         TO                   05960025
050000                  D115-TFR-FISCAL-WK                              05970009
050100             MOVE D115-TRANSFER-FROM-REC                          05980009
050200                                      TO ML-FORMATTED-TRANS-RECORD05990009
050300             PERFORM Z500-WRITE-ML-FORMATTED-TRANS                06000009
050400             ADD +1 TO RC-ML-TRANSFER-FROM-TRANS-CNT              06010009
050500         WHEN ML021-PURCH-TRANSFER-TO-STORE                       06020009
050600             MOVE SPACE                  TO D115-TRANSFER-TO-REC  06030009
050700             MOVE ML021-PURCH-TRANS-CDE  TO D115-CODE-31          06040009
W26603                                                                  06050023
W26603*            MOVE ML021-PURCH-STORE-NBR  TO PV-5-DIGIT-STORE-2-4  06060023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           06070023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        06080023
W26603*            MOVE CD-STORE-NO            TO D115-TRANSFER-TO31    06090023
W26603             MOVE ML021-PURCH-STORE-NBR  TO D115-TRANSFER-TO31    06100023
W26603                                                                  06110023
051200             MOVE ML021-PURCH-DEPT-NBR   TO D115-DEPT-31          06120009
051300             MOVE ML021-PURCH-CLASS-NBR  TO D115-CLASS-31         06130009
21731 *            MOVE ML021-PURCH-SEQ-NBR    TO D115-SEQ-31           06140019
21731              MOVE ML021-PURCH-SKU        TO D115-SKU-31           06150020
051500             MOVE ML021-PURCH-DOC-5-NBR  TO D115-DOC-NO-31        06160009
051600             MOVE ML021-PURCH-DOC-DTE    TO PV-ISO-FMT-DATE       06170009
051700             MOVE PV-ISO-FMT-MM          TO D115-MM-31            06180009
051800             MOVE PV-ISO-FMT-DD          TO D115-DD-31            06190009
W26603                                                                  06200023
W26603*            MOVE ML021-PURCH-REL-STORE-NBR                       06210023
W26603*                                        TO PV-5-DIGIT-STORE-2-4  06220023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           06230023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        06240023
W26603*            MOVE CD-STORE-NO            TO D115-TRANSFER-FROM-31 06250023
W26603             MOVE ML021-PURCH-REL-STORE-NBR                       06260023
W26603                                         TO D115-TRANSFER-FROM-31 06270023
W26603                                                                  06280023
052400             MOVE ML021-PURCH-KOHLS-MM   TO D115-KOHLS-MM-31      06290009
052500             MOVE ML021-PURCH-QTY        TO D115-UNITS-TRANSFER   06300009
052600             MOVE ML021-PURCH-PER-UNT-RTL-AMT                     06310009
052700                                         TO D115-RETAIL-PER       06320009
052800             MOVE ML021-PURCH-BATCH-NBR  TO D115-TRANS-BATCHX-31  06330009
052900             MOVE ML021-PURCH-EXTD-NET-COST-AMT                   06340009
053000                                      TO D115-TOTAL-TRNSFR-TO-COST06350009
W28543*            MOVE DPG56-FISCAL-PERIOD-NBR-X TO                    06360025
W28543             MOVE DTATTR-FSCL-MN-NBR        TO                    06370025
053200                  D115-TTR-FISCAL-PERIOD                          06380009
053300*            MOVE DPG56-FISCAL-PERIOD-WEEK-X TO                   06390025
W28543             MOVE DTATTR-FSCL-WK-NBR         TO                   06400025
053400                  D115-TTR-FISCAL-WK                              06410009
053500             MOVE D115-TRANSFER-TO-REC                            06420009
053600                                      TO ML-FORMATTED-TRANS-RECORD06430009
053700             PERFORM Z500-WRITE-ML-FORMATTED-TRANS                06440009
053800             ADD +1 TO RC-ML-TRANSFER-TO-TRANS-CNT                06450009
053900         WHEN OTHER                                               06460009
054000             MOVE +4008 TO ABEND-CODE                             06470009
054100             DISPLAY '** ABEND     **'                            06480009
054200             DISPLAY '** PROGRAM = MLKUP030'                      06490009
054300             DISPLAY                                              06500009
054400                   '** PARAGRAPH = B100-FORMAT-PURCHASE-TRANS'    06510009
054500             DISPLAY '** TRANS-CDE ' ML021-PURCH-TRANS-CDE        06520009
054600                       ' ON PURCHASE-EXTRACT-RECORD IS NOT VALID.'06530009
054700             DISPLAY '** PURCHASE-EXTRACT-RECORD: '               06540009
054800                     PURCHASE-EXTRACT-RECORD                      06550009
054900             CALL 'ILBOABN0'  USING ABEND-CODE                    06560009
055000     END-EVALUATE.                                                06570009
055100                                                                  06580009
055200     PERFORM Z100-READ-PURCHASE-EXTRACT.                          06590009
055300                                                                  06600009
055400                                                                  06610009
055500******************************************************************06620009
055600* FORMAT AND WRITE THE SALE TRANSACTIONS.                         06630009
055700******************************************************************06640009
055800 B200-FORMAT-SALE-TRANS.                                          06650009
055900                                                                  06660009
056000     ADD +1 TO RC-XT-SALE-EXTRACT-CNT.                            06670009
056100                                                                  06680009
056200     EVALUATE TRUE                                                06690009
056300         WHEN ML022-SALE                                          06700009
056400             MOVE SPACE                  TO D115-SALES-REC        06710009
056500             MOVE ML022-SALE-TRANS-CDE   TO D115-CODE-20          06720009
W26603                                                                  06730023
W26603*            MOVE ML022-SALE-STORE-NBR   TO PV-5-DIGIT-STORE-2-4  06740023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           06750023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        06760023
W26603*            MOVE CD-STORE-NO            TO D115-STORE-20         06770023
W26603             MOVE ML022-SALE-STORE-NBR   TO D115-STORE-20         06780023
W26603                                                                  06790023
057000             MOVE ML022-SALE-DEPT-NBR    TO D115-DEPT-20X         06800009
057100             MOVE ML022-SALE-CLASS-NBR   TO D115-CLASS-20X        06810009
057200             MOVE ML022-SALE-FIN-LIAB-DTE TO PV-ISO-FMT-DATE      06820009
057300             MOVE PV-ISO-FMT-MM          TO D115-SALES-MM         06830009
057400             MOVE PV-ISO-FMT-DD          TO D115-SALES-DD         06840009
057500             MOVE PV-ISO-FMT-YY          TO D115-SALES-YY         06850009
057600             MOVE ML022-SALE-EXTD-RTL-AMT                         06860009
057700                                         TO D115-SALE-AMT         06870009
057800             MOVE ML022-SALE-FSCL-WK-NBR TO D115-SALE-WEEK        06880009
057900             MOVE ML022-SALE-FSCL-DAY    TO D115-SALE-DAY         06890009
W28543*            MOVE DPG56-FISCAL-PERIOD-NBR-X TO                    06900025
W28543             MOVE DTATTR-FSCL-MN-NBR        TO                    06910025
058100                  D115-SR-FISCAL-PERIOD                           06920009
058200*            MOVE DPG56-FISCAL-PERIOD-WEEK-X TO                   06930025
W28543             MOVE DTATTR-FSCL-WK-NBR        TO                    06940025
058300                  D115-SR-FISCAL-WK                               06950009
                   MOVE ML022-SALE-TYPE-2 TO                            06960017
                        D115-SALE-TYP-CDE                               06970015
058400             MOVE D115-SALES-REC TO ML-FORMATTED-TRANS-RECORD     06980009
058500             PERFORM Z500-WRITE-ML-FORMATTED-TRANS                06990009
058600             ADD +1 TO RC-ML-SALE-CNT                             07000009
058700         WHEN OTHER                                               07010009
058800             MOVE +4008 TO ABEND-CODE                             07020009
058900             DISPLAY '** ABEND     **'                            07030009
059000             DISPLAY '** PROGRAM = MLKUP030'                      07040009
059100             DISPLAY '** PARAGRAPH = B200-FORMAT-SALE-TRANS'      07050009
059200             DISPLAY '** TRANS-CDE ' ML022-SALE-TRANS-CDE         07060009
059300                   ' ON SALE-EXTRACT-RECORD IS NOT VALID.'        07070009
059400             DISPLAY '** SALE-EXTRACT-RECORD: '                   07080009
059500                     SALE-EXTRACT-RECORD                          07090009
059600             CALL 'ILBOABN0'  USING ABEND-CODE                    07100009
059700     END-EVALUATE.                                                07110009
059800                                                                  07120009
059900     PERFORM Z200-READ-SALE-EXTRACT.                              07130009
060000                                                                  07140009
060100                                                                  07150009
060200******************************************************************07160009
060300* FORMAT AND WRITE THE PRICE CHANGE TRANSACTIONS.                 07170009
060400******************************************************************07180009
060500 B300-FORMAT-PRICE-CHANGE-TRANS.                                  07190009
060600                                                                  07200009
060700     ADD +1 TO RC-XT-PRICE-CHANGE-EXTRACT-CNT.                    07210009
060800                                                                  07220009
060900     EVALUATE TRUE                                                07230009
061000         WHEN ML023-PC-MARKDOWN                                   07240009
061100             MOVE SPACE                  TO D115-MKDWN-REC        07250009
061200             MOVE ML023-PC-TRANS-CDE     TO D115-CODE-40          07260009
061300             MOVE ML023-PC-BATCH-NBR     TO D115-BATCH-NO-40      07270009
W26603                                                                  07280023
W26603*            MOVE ML023-PC-STORE-NBR     TO PV-5-DIGIT-STORE-2-4  07290023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           07300023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        07310023
W26603*            MOVE CD-STORE-NO            TO D115-STORE-40         07320023
W26603             MOVE ML023-PC-STORE-NBR     TO D115-STORE-40         07330023
W26603                                                                  07340023
061800             MOVE ML023-PC-DEPT-NBR      TO D115-DEPT-40X         07350009
061900             MOVE ML023-PC-CLASS-NBR     TO D115-CLASS-40X        07360009
062000             MOVE ML023-PC-DOC-5-NBR     TO D115-DOC-NO-40        07370009
062100             MOVE ML023-PC-FIN-LIAB-DTE  TO PV-ISO-FMT-DATE       07380009
062200             MOVE PV-ISO-FMT-MM          TO D115-MKDWN-MM         07390009
062300             MOVE PV-ISO-FMT-DD          TO D115-MKDWN-DD         07400009
062400             MOVE ML023-PC-KOHLS-MM      TO D115-KOHLS-MM-40      07410009
062500             MOVE ML023-PC-OLD-RSN-CDE   TO D115-MKDWN-REASON     07420009
062600             MOVE ML023-PC-OLD-PR-AMT    TO D115-MKDWN-OPRICE     07430009
062700             MOVE ML023-PC-NEW-PR-AMT    TO D115-MKDWN-NPRICE     07440009
062800             MOVE ML023-PC-QTY           TO D115-MKDWN-QTY        07450009
062900             MOVE ML023-PC-CATEGORY      TO D115-CATEGORY-40      07460009
063000             MOVE ML023-PC-DOC-7-NBR                              07470009
063100                                 TO D115-7-DIGIT-DOCUMENT-NMBR-40 07480009
                   MOVE ML023-PC-MKDN-MKUP-RSN-CDE                      07490012
                                       TO D115-MKDWN-MKDN-MKUP-RSN-CDE  07500012
W28543*            MOVE DPG56-FISCAL-PERIOD-NBR-X TO                    07510025
W28543             MOVE DTATTR-FSCL-MN-NBR        TO                    07520025
063300                  D115-MKDWN-FISCAL-PERIOD                        07530009
W28543*            MOVE DPG56-FISCAL-PERIOD-WEEK-X TO                   07540025
W28543             MOVE DTATTR-FSCL-WK-NBR        TO                    07550025
063500                  D115-MKDWN-FISCAL-WK                            07560009
063600             MOVE D115-MKDWN-REC TO ML-FORMATTED-TRANS-RECORD     07570009
063700             PERFORM Z500-WRITE-ML-FORMATTED-TRANS                07580009
063800             ADD +1 TO RC-ML-MARKDOWN-CNT                         07590009
063900         WHEN ML023-PC-MARKUP                                     07600009
064000             MOVE SPACE                  TO D115-MARKON-REC       07610009
064100             MOVE ML023-PC-TRANS-CDE     TO D115-CODE-50          07620009
064200             MOVE ML023-PC-BATCH-NBR     TO D115-BATCH-NO-50      07630009
W26603                                                                  07640023
W26603*            MOVE ML023-PC-STORE-NBR     TO PV-5-DIGIT-STORE-2-4  07650023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           07660023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        07670023
W26603*            MOVE CD-STORE-NO            TO D115-STORE-50         07680023
W26603             MOVE ML023-PC-STORE-NBR     TO D115-STORE-50         07690023
W26603                                                                  07700023
064700             MOVE ML023-PC-DEPT-NBR      TO D115-DEPT-50X         07710009
064800             MOVE ML023-PC-CLASS-NBR     TO D115-CLASS-50X        07720009
064900             MOVE ML023-PC-DOC-5-NBR     TO D115-DOC-NO-50        07730009
065000             MOVE ML023-PC-FIN-LIAB-DTE  TO PV-ISO-FMT-DATE       07740009
065100             MOVE PV-ISO-FMT-MM          TO D115-MARKON-MM        07750009
065200             MOVE PV-ISO-FMT-DD          TO D115-MARKON-DD        07760009
065300             MOVE ML023-PC-KOHLS-MM      TO D115-KOHLS-MM-50      07770009
065400             MOVE ML023-PC-OLD-RSN-CDE   TO D115-MARKON-REASON    07780009
065500             MOVE ML023-PC-OLD-PR-AMT    TO D115-MARKON-OPRICE    07790009
065600             MOVE ML023-PC-NEW-PR-AMT    TO D115-MARKON-NPRICE    07800009
065700             MOVE ML023-PC-QTY           TO D115-MARKON-QTY       07810009
065800             MOVE ML023-PC-CATEGORY      TO D115-CATEGORY-50      07820009
065900             MOVE ML023-PC-DOC-7-NBR                              07830009
066000                                 TO D115-7-DIGIT-DOCUMENT-NMBR-50 07840009
                   MOVE ML023-PC-MKDN-MKUP-RSN-CDE                      07850012
                                       TO D115-MARKON-MKDN-MKUP-RSN-CDE 07860012
W28543*            MOVE DPG56-FISCAL-PERIOD-NBR-X TO                    07870025
W28543             MOVE DTATTR-FSCL-MN-NBR        TO                    07880025
066200                  D115-MARKON-FISCAL-PERIOD                       07890009
W28543*            MOVE DPG56-FISCAL-PERIOD-WEEK-X TO                   07900025
W28543             MOVE DTATTR-FSCL-WK-NBR        TO                    07910025
066400                  D115-MARKON-FISCAL-WK                           07920009
066500             MOVE D115-MARKON-REC TO ML-FORMATTED-TRANS-RECORD    07930009
066600             PERFORM Z500-WRITE-ML-FORMATTED-TRANS                07940009
066700             ADD +1 TO RC-ML-MARKUP-CNT                           07950009
066800         WHEN OTHER                                               07960009
066900             MOVE +4008 TO ABEND-CODE                             07970009
067000             DISPLAY '** ABEND     **'                            07980009
067100             DISPLAY '** PROGRAM = MLKUP030'                      07990009
067200             DISPLAY                                              08000009
067300                   '** PARAGRAPH = B300-FORMAT-PRICE-CHANGE-TRANS'08010009
067400             DISPLAY '** TRANS-CDE ' ML023-PC-TRANS-CDE           08020009
067500                   ' ON PRICE-CHANGE-EXTRACT-RECORD IS NOT VALID.'08030009
067600             DISPLAY '** PRICE-CHANGE-EXTRACT-RECORD: '           08040009
067700                     PRICE-CHANGE-EXTRACT-RECORD                  08050009
067800             CALL 'ILBOABN0'  USING ABEND-CODE                    08060009
067900     END-EVALUATE.                                                08070009
068000                                                                  08080009
068100     PERFORM Z300-READ-PRICE-CHANGE-EXTRACT.                      08090009
068200                                                                  08100009
068300                                                                  08110009
068400******************************************************************08120009
068500* FORMAT AND WRITE THE ADJUSTMENT TRANSACTIONS.                   08130009
068600******************************************************************08140009
068700 B400-FORMAT-ADJUSTMENT-TRANS.                                    08150009
068800                                                                  08160009
068900     ADD +1 TO RC-XT-ADJUSTMENT-EXTRACT-CNT.                      08170009
069000                                                                  08180009
069100     EVALUATE TRUE                                                08190009
069200         WHEN ML024-ADJ-ADJUSTMENT                                08200009
069300             MOVE SPACE                  TO D115-ADJ-REC          08210009
069400             MOVE ML024-ADJ-TRANS-CDE    TO D115-CODE-80          08220009
W26603                                                                  08230023
W26603*            MOVE ML024-ADJ-STORE-NBR    TO PV-5-DIGIT-STORE-2-4  08240023
W26603*            MOVE PV-5-DIGIT-STORE       TO CD-STORE-NO           08250023
W26603*            PERFORM CALCULATE-CHECK-DIGIT                        08260023
W26603*            MOVE CD-STORE-NO            TO D115-STORE-80         08270023
W26603             MOVE ML024-ADJ-STORE-NBR    TO D115-STORE-80         08280023
W26603                                                                  08290023
069900             MOVE ML024-ADJ-DEPT-NBR     TO D115-DEPT-80X         08300009
070000             MOVE ML024-ADJ-CLASS-NBR    TO D115-CLASS-80X        08310009
070100             MOVE ML024-ADJ-FIN-LIAB-DTE TO PV-ISO-FMT-DATE       08320009
070200             MOVE PV-ISO-FMT-MM          TO D115-ADJ-MM           08330009
070300             MOVE PV-ISO-FMT-DD          TO D115-ADJ-DD           08340009
070400             MOVE PV-ISO-FMT-YY          TO D115-ADJ-YY           08350009
070500             MOVE ML024-ADJ-KOHLS-MM     TO D115-KOHLS-MM-80      08360009
070600             MOVE ML024-ADJ-AT-RTL-AMT   TO D115-AT-RETAIL        08370009
070700             MOVE ML024-ADJ-AT-COST-AMT  TO D115-AT-COST          08380009
W28543*            MOVE DPG56-FISCAL-PERIOD-NBR-X TO                    08390025
W28543             MOVE DTATTR-FSCL-MN-NBR        TO                    08400025
070900                  D115-AR-FISCAL-PERIOD                           08410009
W28543*            MOVE DPG56-FISCAL-PERIOD-WEEK-X TO                   08420025
W28543             MOVE DTATTR-FSCL-WK-NBR        TO                    08430025
071100                  D115-AR-FISCAL-WK                               08440009
071200             MOVE D115-ADJ-REC   TO ML-FORMATTED-TRANS-RECORD     08450009
071300             PERFORM Z500-WRITE-ML-FORMATTED-TRANS                08460009
071400             ADD +1 TO RC-ML-ADJUSTMENT-CNT                       08470009
071500         WHEN OTHER                                               08480009
071600             MOVE +4008 TO ABEND-CODE                             08490009
071700             DISPLAY '** ABEND     **'                            08500009
071800             DISPLAY '** PROGRAM = MLKUP030'                      08510009
071900             DISPLAY                                              08520009
072000                   '** PARAGRAPH = B400-FORMAT-ADJUSTMENT-TRANS'  08530009
072100             DISPLAY '** TRANS-CDE ' ML024-ADJ-TRANS-CDE          08540009
072200                   ' ON ADJUSTMENT-EXTRACT-RECORD IS NOT VALID.'  08550009
072300             DISPLAY '** ADJUSTMENT-EXTRACT-RECORD: '             08560009
072400                     ADJUSTMENT-EXTRACT-RECORD                    08570009
072500             CALL 'ILBOABN0'  USING ABEND-CODE                    08580009
072600     END-EVALUATE.                                                08590009
072700                                                                  08600009
072800     PERFORM Z400-READ-ADJUSTMENT-EXTRACT.                        08610009
072900                                                                  08620009
073000                                                                  08630009
073100 Z100-READ-PURCHASE-EXTRACT.                                      08640009
073200                                                                  08650009
073300     READ PURCHASE-EXTRACT-FILE                                   08660009
073400         INTO ML021-PURCH-RECORD                                  08670009
073500             AT END SET PS-EOF-PURCHASE-EXTRACT TO TRUE.          08680009
073600                                                                  08690009
073700                                                                  08700009
073800 Z200-READ-SALE-EXTRACT.                                          08710009
073900                                                                  08720009
074000     READ SALE-EXTRACT-FILE                                       08730009
074100         INTO ML022-SALE-RECORD                                   08740009
074200             AT END SET PS-EOF-SALE-EXTRACT TO TRUE.              08750009
074300                                                                  08760009
074400                                                                  08770009
074500 Z300-READ-PRICE-CHANGE-EXTRACT.                                  08780009
074600                                                                  08790009
074700     READ PRICE-CHANGE-EXTRACT-FILE                               08800009
074800         INTO ML023-PC-RECORD                                     08810009
074900             AT END SET PS-EOF-PRICE-CHANGE-EXTRACT TO TRUE.      08820009
075000                                                                  08830009
075100                                                                  08840009
075200 Z400-READ-ADJUSTMENT-EXTRACT.                                    08850009
075300                                                                  08860009
075400     READ ADJUSTMENT-EXTRACT-FILE                                 08870009
075500         INTO ML024-ADJ-RECORD                                    08880009
075600             AT END SET PS-EOF-ADJUSTMENT-EXTRACT TO TRUE.        08890009
075700                                                                  08900009
075800                                                                  08910009
075900 Z500-WRITE-ML-FORMATTED-TRANS.                                   08920009
076000                                                                  08930009
076100     WRITE ML-FORMATTED-TRANS-RECORD.                             08940009
076200                                                                  08950009
076300                                                                  08960009
076400******************************************************************08970009
076500* CODE FOR CALCULATION OF CHECK-DIGIT FOR STORE NUMBER.           08980009
076600******************************************************************08990009
076700*                                                                 09000025
W28543                                                                  09010027
W28543 9998-SQL-ABEND.                                                  09020027
W28543                                                                  09030027
W28543     MOVE +4013 TO PV-ABEND-CODE.                                 09040027
W28543     DISPLAY '** ABEND **         ** = SQLERROR'.                 09050027
W28543     DISPLAY '** PROGRAM          ** = MLKUP030'.                 09060029
W28543     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       09070027
W28543     DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.   09080027
W28543                                                                  09090027
W28543*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE         09100027
W28543*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.        09110027
W28543     COPY DPPD004.                                                09120027
W28543                                                                  09130027
W28543     PERFORM 9999-ABEND.                                          09140027
W28543                                                                  09150027
W28543                                                                  09160027
W28543 9999-ABEND.                                                      09170027
W28543                                                                  09180027
W28543     CALL 'ILBOABN0'  USING PV-ABEND-CODE.                        09190027
