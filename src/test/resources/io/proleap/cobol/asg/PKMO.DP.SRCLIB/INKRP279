       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.         INKRP279.                                            
       INSTALLATION.       KOHLS DEPARTMENT STORES.                             
       DATE-WRITTEN.       08/31/2004.                                          
       DATE-COMPILED.                                                           
      *                                                                         
      ******************************************************************        
      *     INKRP279 - PHYSICAL INVENTORY TOP EXCEPTION REPORT.                 
      *                (BY RETAIL EXCEPTION)                                    
      *                                                                         
      *CHANGE HISTORY:                                                          
      * WR/PROJ  DATE        DESCRIPTION OF CHANGES                             
      * -------  ----------  ----------------------------------------           
W26600* W26600  07-29-2004 INVENTORY STORE EXPANSION CHANGES. ALSO              
W26600*                    MODIFY PROGRAM FOR EXCEPTION REPORTING               
W26600*                    RE-WRITE. REMOVE STORE-INV-FILE (INRD024).           
W26600*                    WR26600   SCOTT JACKSON                              
W28545* W28545  08-10-2006 REMOVE TINVPAR, NOT REFERENCED DEPT INV              
      ******************************************************************        
      * WXXXXX  02-01-2005 MODIFY PROGRAM TO NOT PRINT DETAIL LINE              
      *                    TO REPORT IF VARIANCE IS EQUAL TO 0.                 
      *                    WRXXXXX   ERIN SEARL                                 
      ******************************************************************        
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
       CONFIGURATION SECTION.                                                   
       INPUT-OUTPUT SECTION.                                                    
       FILE-CONTROL.                                                            
      *                                                                         
           SELECT STORE-CONTROL-FILE                                            
               ASSIGN TO INP01.                                                 
      *                                                                         
           SELECT STORE-MERGE-FILE                                              
               ASSIGN TO INP02.                                                 
      *                                                                         
           SELECT EXCEPT-CONTROL-FILE                                           
               ASSIGN TO INP03.                                                 
      *                                                                         
           SELECT STORE-INV-EXCEPTION-RPT                                       
               ASSIGN TO RPT01.                                                 
      *                                                                         
       DATA DIVISION.                                                           
       FILE SECTION.                                                            
      *                                                                         
       FD  STORE-CONTROL-FILE                                                   
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  STORE-CONTROL-RECORD.                                                
           05  FILLER                  PIC X(05).                               
           05  SCR-STORE-NMBR          PIC 9(04).                               
           05  SCR-REST-OF-RECORD      PIC X(71).                               
      *                                                                         
       FD  STORE-MERGE-FILE                                                     
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  STORE-MERGE-RECORD          PIC X(100).                              
      *                                                                         
       FD  EXCEPT-CONTROL-FILE                                                  
           LABEL RECORDS ARE OMITTED                                            
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
       01  EXCEPT-CONTROL-RECORD.                                               
           05  ECR-EXCEPT-CONTROL      PIC 9(05).                               
           05  ECR-REST-OF-RECORD      PIC X(75).                               
      *                                                                         
       FD  STORE-INV-EXCEPTION-RPT                                              
           LABEL RECORDS ARE OMITTED                                            
           RECORD CONTAINS 132 CHARACTERS                                       
           RECORDING  MODE IS F                                                 
           DATA RECORD IS REPORT-LINE.                                          
       01  REPORT-LINE         PIC X(132).                                      
      *                                                                         
      /*****************************************************************        
       WORKING-STORAGE SECTION.                                                 
      ******************************************************************        
      *                                                                         
       01  ABEND-CODE                  PIC S9(04)  VALUE ZERO COMP SYNC.        
      *                                                                         
       01  PV-PROGRAM-VARIABLES.                                                
           05  PV-SUB                  PIC S9(4)    VALUE +0  COMP.             
           05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.               
           05  PV-DB2-OPER-ATTEMPTED   PIC X(30)    VALUE SPACES.               
           05  PV-CHAR-STORE           PIC X(04)    VALUE SPACES.               
W26600     05  PV-STORE-NUM            PIC 9(04)    VALUE ZERO.                 
W26600     05  PV-AREA-NUMBER          PIC 9(06)    VALUE ZERO.                 
      *    05  PV-ITEM-NMBR            PIC S9(15)V  VALUE +0  COMP-3.           
      *    05  PV-NUMERIC-STORE        PIC S9(9)    VALUE +0.                   
      *    05  PV-PHY-INV-OH-VAR       PIC S9(09) COMP VALUE ZERO.              
           05  PV-DEFAULT-CURRENT-DATE.                                         
               10  PV-DF-CC            PIC XX       VALUE '20'.                 
               10  PV-DF-YY            PIC XX.                                  
               10  FILLER              PIC X        VALUE '-'.                  
               10  PV-DF-MM            PIC XX.                                  
               10  FILLER              PIC X        VALUE '-'.                  
               10  PV-DF-DD            PIC XX.                                  
           05  PV-CURRENT-DATE.                                                 
               10  PV-CD-YY            PIC XX.                                  
               10  PV-CD-MM            PIC XX.                                  
               10  PV-CD-DD            PIC XX.                                  
           05  PV-TOTAL-INV-QTY        PIC S9(5)    COMP-3 VALUE 0.             
           05  PV-TOTAL-FS-QTY         PIC S9(5)    COMP-3 VALUE 0.             
           05  PV-VARIANCE-QTY         PIC S9(5)    COMP-3 VALUE 0.             
           05  PV-TOTAL-EXT-PRICE      PIC S9(13)V99 COMP-3 VALUE 0.            
           05  PV-ABS-DIFF-RTL         PIC S9(09)V99 COMP VALUE 0.              
           05  PV-SYS-RETAIL           PIC S9(09)V99 COMP VALUE 0.              
           05  PV-CALC-INV-RTL         PIC S9(09)V99 COMP VALUE 0.              
           05  PV-CALC-EXTD-RTL        PIC S9(09)V99 COMP VALUE 0.              
           05  PV-STORE-EXCEPT-COUNT   PIC 9(05)    VALUE ZEROS.                
           05  PV-PAGE-COUNT           PIC S9(05) COMP-3 VALUE 0.               
           05  PV-LINE-COUNT           PIC S9(05) COMP-3 VALUE 0.               
           05  PV-ADVANCE-LINE         PIC S9(04) COMP   VALUE +1.              
           05  PV-DTL-LINE-PRT-ACCUM   PIC S9(13) COMP-3 VALUE 0.               
           05  PV-CURRENT-TIME.                                                 
               10  PV-CT-HH            PIC XX.                                  
               10  PV-CT-MM            PIC XX.                                  
           05  PV-LOW-RANGE            PIC S9(09)V99 COMP-3 VALUE 0.            
           05  PV-HIGH-RANGE           PIC S9(09)V99 COMP-3 VALUE 0.            
           05  PV-STORE-REC-COUNT      PIC S9(09)    COMP-3 VALUE 0.            
           05  PV-STORE-COUNT          PIC S9(09)    COMP-3 VALUE 0.            
           05  PV-EDIT-SKU             PIC  9(08)    VALUE ZEROES.              
      *                                                                         
       01  SA-SAVE-AREA.                                                        
           05  SA-STORE-NUMBER         PIC  9(04)    VALUE ZEROES.              
           05  SA-SAVE-STORE-NUMBER    PIC  9(04)    VALUE ZEROES.              
           05  SA-SKU                  PIC  9(08)    VALUE ZEROES.              
           05  SA-AREA-NUMBER          PIC  9(08)    VALUE ZEROES.              
      *    05  SA-SUMINV-LOC           PIC S9(04)    COMP.                      
      *    05  SA-SUMINV-SKU           PIC S9(08)V   COMP-3.                    
      *    05  SA-SUMINV-AREA-NBR      PIC S9(09)    COMP.                      
      *    05  SA-SKU-ATTRIBUTES.                                               
      *        10  SA-DEPT             PIC 9(04)    VALUE ZEROES.               
      *        10  SA-CLASS            PIC 9(04)    VALUE ZEROES.               
      *        10  SA-SUB-CLASS        PIC 9(04)    VALUE ZEROES.               
           05  SA-SKU-ATTR.                                                     
               10  SA1-DEPT                PIC 9(04) VALUE ZEROS.               
               10  FILLER                  PIC X(01) VALUE '-'.                 
               10  SA1-CLASS               PIC 9(04) VALUE ZEROS.               
               10  FILLER                  PIC X(01) VALUE '-'.                 
               10  SA1-SCL                 PIC 9(04) VALUE ZEROS.               
           05  SA-STORE-FOR-HEADER     PIC 9(04)    VALUE ZEROES.               
           05  SA-SKU-SAVE             PIC X(08)    VALUE SPACES.               
           05  SA-SKU-DESCRIP-SAVE     PIC X(25)    VALUE SPACES.               
      *                                                                         
       01  PS-PROGRAM-SWITCHES.                                                 
           05  PS-INP01-DONE-SW            PIC X(01) VALUE 'N'.                 
               88  STORE-CONTROL-DONE                VALUE 'Y'.                 
           05  PS-END-OF-INPUT-SW          PIC X(01) VALUE 'N'.                 
               88  PS-END-OF-INPUT                   VALUE 'Y'.                 
               88  PS-NOT-END-OF-INPUT               VALUE 'N'.                 
           05  PS-EMPTY-STORE-FILE-SW      PIC X(01) VALUE 'N'.                 
               88  PS-EMPTY-STORE-FILE               VALUE 'Y'.                 
               88  PS-CONTINUE-PROCESSING            VALUE 'N'.                 
      *    05  PS-INP02-DONE-SW            PIC X(01) VALUE 'N'.                 
      *        88  ABSOLUTE-DIFF-END                 VALUE 'Y'.                 
           05  PS-FIRST-TIME-SW            PIC X(01) VALUE 'N'.                 
               88  FIRST-TIME-THRU                   VALUE 'N'.                 
               88  CONTINUE-PROCESSING               VALUE 'Y'.                 
           05  END-OF-CURSOR-SW            PIC X(01) VALUE 'N'.                 
               88  END-OF-CURSOR                     VALUE 'Y'.                 
           05  PS-CLEARANCE-STAT-SW        PIC X(01) VALUE 'N'.                 
      *    05  PS-TSUMINV-DONE-SW          PIC X(01) VALUE 'N'.                 
      *        88  NO-MORE-UPCS                      VALUE 'Y'.                 
           05  PS-FIRST-STORE-REC-SW       PIC X(01) VALUE 'N'.                 
               88  FIRST-REC-FOR-STORE               VALUE 'Y'.                 
      *                                                                         
       01  PC-PROGRAM-CONSTANTS.                                                
           05  PC-PRINT-LINE-MAX           PIC S9(04)      VALUE +57            
                               COMP.                                            
           05  PC-PROGRAM-NAME         PIC X(08)    VALUE 'INKRP279'.           
           05  PC-OPERCO-NBR           PIC X(02)    VALUE '03'.                 
      *                                                                         
       01  RP-REPORT-WORK-RECORD           PIC X(132)      VALUE SPACES.        
      *                                                                         
                                                                                
       01  HL1-HEADING-LINE-1.                                                  
           05  FILLER                  PIC X(32) VALUE SPACES.                  
           05  FILLER                  PIC X(23) VALUE                          
               'PHYSICAL INVENTORY TOP '.                                       
           05  HL1-EXCEPT-CONTROL      PIC Z,ZZZ9.                              
           05  FILLER                  PIC X(39) VALUE                          
               ' EXCEPTION REPORT BY FINANCIAL DOLLARS'.                        
                                                                                
       01  HL2-HEADING-LINE-2.                                                  
           05  FILLER                  PIC X(09) VALUE ' STORE:'.               
           05  HL2-STORE-DESCRIPTION   PIC X(45).                               
           05  FILLER                  PIC X(78) VALUE SPACES.                  
                                                                                
       01  HL3-HEADING-LINE-3.                                                  
           05  FILLER                  PIC X(61) VALUE SPACES.                  
           05  FILLER                  PIC X(17) VALUE                          
               '***INVENTORIED***'.                                             
           05  FILLER                  PIC X(01) VALUE SPACES.                  
           05  FILLER                  PIC X(14) VALUE                          
               '     CUTOFF   '.                                                
                                                                                
       01  HL4-HEADING-LINE-4.                                                  
           05  FILLER                  PIC X(03) VALUE SPACES.                  
           05  FILLER                  PIC X(14) VALUE 'DPT  MCL  SCL '.        
           05  FILLER                  PIC X(04) VALUE SPACES.                  
           05  FILLER                  PIC X(06) VALUE 'SKU   '.                
           05  FILLER                  PIC X(07) VALUE SPACES.                  
           05  FILLER                  PIC X(11) VALUE 'DESCRIPTION'.           
           05  FILLER                  PIC X(11) VALUE SPACES.                  
           05  FILLER                  PIC X(04) VALUE 'AREA'.                  
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(06) VALUE '  QTY '.                
           05  FILLER                  PIC X(04) VALUE SPACES.                  
           05  FILLER                  PIC X(05) VALUE 'PRICE'.                 
           05  FILLER                  PIC X(08) VALUE SPACES.                  
           05  FILLER                  PIC X(05) VALUE 'PRICE'.                 
           05  FILLER                  PIC X(08) VALUE SPACES.                  
           05  FILLER                  PIC X(08) VALUE 'VARIANCE'.              
           05  FILLER                  PIC X(03) VALUE SPACES.                  
           05  FILLER                  PIC X(14)                                
                                       VALUE 'EXTD VAR PRICE'.                  
                                                                                
       01  HL5-HEADING-LINE-5.                                                  
W21732     05  FILLER                  PIC X(03) VALUE SPACES.                  
25248      05  FILLER                  PIC X(14) VALUE '--------------'.        
W21732     05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(08) VALUE '--------'.              
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(25)                                
                                 VALUE '-------------------------'.             
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(06) VALUE '------'.                
           05  FILLER                  PIC X(01) VALUE SPACES.                  
           05  FILLER                  PIC X(06) VALUE '------'.                
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(09) VALUE '---------'.             
           05  FILLER                  PIC X(01) VALUE SPACES.                  
           05  FILLER                  PIC X(14)                                
                                             VALUE '--------------'.            
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(10) VALUE '----------'.            
           05  FILLER                  PIC X(02) VALUE SPACES.                  
           05  FILLER                  PIC X(15)                                
                                             VALUE '---------------'.           
                                                                                
       01  DL-DETAIL-LINE.                                                      
           05  FILLER                      PIC X(02) VALUE SPACES.              
W26600     05  DL1-DMS.                                                         
               10  DL1-DEPT                PIC 9(04) VALUE ZEROS.               
               10  FILLER                  PIC X(01) VALUE '-'.                 
               10  DL1-MCL                 PIC 9(04) VALUE ZEROS.               
               10  FILLER                  PIC X(01) VALUE '-'.                 
               10  DL1-SCL                 PIC 9(04) VALUE ZEROS.               
W21732     05  FILLER                      PIC X(02) VALUE SPACES.              
           05  DL1-SKU                     PIC X(08).                           
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  DL1-SKU-DESCRIP             PIC X(25).                           
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  DL1-AREA                    PIC Z(06).                           
           05  DL1-AREA-ALPHA REDEFINES                                         
               DL1-AREA                    PIC X(06).                           
           05  FILLER                      PIC X(01) VALUE SPACES.              
           05  DL1-INV-ONHND               PIC ZZZZ9-.                          
           05  FILLER                      PIC X(01) VALUE SPACES.              
           05  DL1-INV-PRICE               PIC $$$,$$$.99.                      
           05  FILLER                      PIC X(05) VALUE SPACES.              
           05  DL1-FS-PRICE                PIC $$$,$$$.99.                      
           05  FILLER                      PIC X(02) VALUE SPACES.              
           05  DL1-VARIANCE                PIC $$$,$$$.99-.                     
           05  FILLER                      PIC X(04) VALUE SPACES.              
           05  DL1-EXTEND-PRICE            PIC $,$$$,$$$.99-.                   
                                                                                
       01  DL-NO-EXCEPTION-LINE.                                                
           05  FILLER                  PIC X(49)    VALUE                       
               '************* NO EXCEPTIONS EXIST ***************'.             
           05  FILLER                  PIC X(83)    VALUE SPACES.               
                                                                                
       01  DL-EXCEPTION-SUMMARY-LINE.                                           
           05  FILLER                  PIC X(10)    VALUE                       
               '** STORE: '.                                                    
           05  DLESL-STORE             PIC X(04).                               
           05  FILLER                  PIC X(32)    VALUE                       
               ' EXCEPTIONS RANGE FROM A LOW OF '.                              
           05  DLESL-LOW               PIC $,$$$,$$$.99-.                       
           05  FILLER                  PIC X(14)    VALUE                       
               ' TO A HIGH OF '.                                                
           05  DLESL-HIGH              PIC $,$$$,$$$.99-.                       
           05  FILLER                  PIC X(03)    VALUE ' **'.                
                                                                                
      *                                                                         
      ******************************************************************        
      * COPYBOOK FOR REMAINING REPORT HEADING LINES, DETAIL LINE                
      ******************************************************************        
           COPY DPWS132O.                                                       
      *                                                                         
      ******************************************************************        
      *  INVENTORY EXCEPTIONS BY STORE EXTRACT - INPUT RECORD LAYOUT            
      ******************************************************************        
           COPY INRD024.                                                        
      *                                                                         
      ******************************************************************        
      *  SQL ABEND ROUTINE WORKING STORAGE                                      
      ******************************************************************        
           COPY DPWS004.                                                        
      *                                                                         
      *                                                                         
      ******************************************************************        
      * DB2 TABLE DCLGEN - TSKXREF                                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE TSKXREF                                                  
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * DB2 TABLE DCLGEN - IMV_SKU                                              
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE IMV00001                                                 
           END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * DB2 TABLE DCLGEN - TSUMINV                                              
      ******************************************************************        
      *    EXEC SQL                                                             
      *        INCLUDE TSUMINV                                                  
      *    END-EXEC.                                                            
      *                                                                         
      ******************************************************************        
      * XMT_LOC TABLE DCLGEN                                                    
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE XMT00001                                                 
           END-EXEC.                                                            
      *                                                                         
      *                                                                         
      ******************************************************************        
      * DB2 TABLE ERROR HANDLING                                                
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE SQLCA                                                    
           END-EXEC.                                                            
      *                                                                         
      *****************************************************************         
           COPY SQLCA2.                                                         
      *                                                                         
      *****************************************************************         
       PROCEDURE DIVISION.                                                      
      *****************************************************************         
      *                                                                         
       1000-MAIN-MODULE.                                                        
      *                                                                         
           PERFORM 1000-INITIALIZATION.                                         
      *                                                                         
           PERFORM 2000-PROCESS-INPUT                                           
               UNTIL PS-END-OF-INPUT.                                           
      *                                                                         
           PERFORM 9000-END-OF-JOB-TASKS.                                       
      *                                                                         
       9999-EXIT-PROGRAM.                                                       
           STOP RUN.                                                            
      *                                                                         
      /****************************************************************         
      * 1000-INITIALIZATION.                                                    
      *****************************************************************         
       1000-INITIALIZATION.                                                     
      *                                                                         
           DISPLAY '**********************************'.                        
           DISPLAY '* START OF INKRP279               '.                        
           DISPLAY '**********************************'.                        
      *                                                                         
           OPEN INPUT  STORE-CONTROL-FILE                                       
                INPUT  STORE-MERGE-FILE                                         
                INPUT  EXCEPT-CONTROL-FILE                                      
                OUTPUT STORE-INV-EXCEPTION-RPT.                                 
      *                                                                         
           ACCEPT PV-CURRENT-DATE    FROM DATE.                                 
           ACCEPT PV-CURRENT-TIME    FROM TIME.                                 
      *                                                                         
           MOVE PV-CD-MM            TO DP132O-RUN-MONTH.                        
           MOVE PV-CD-DD            TO DP132O-RUN-DAY.                          
           MOVE PV-CD-YY            TO DP132O-RUN-YEAR.                         
           MOVE PV-CT-HH            TO DP132O-RUN-HOUR.                         
           MOVE PV-CT-MM            TO DP132O-RUN-MINUTE.                       
           MOVE PC-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.                     
           MOVE 1                   TO DP132O-REPORT-NUMBER.                    
           MOVE ZEROS               TO PV-TOTAL-INV-QTY.                        
           MOVE ZEROS               TO PV-TOTAL-EXT-PRICE.                      
           MOVE ZEROS               TO PV-STORE-REC-COUNT.                      
           MOVE ZEROS               TO PV-PAGE-COUNT                            
                                       PV-LINE-COUNT.                           
      *                                                                         
      ** GET THE TOP XXXXX CONTROL RECORD FOR THE REPORT.                       
           PERFORM 5100-READ-EXCEPT-CONTROL-FILE.                               
      *                                                                         
      ** DETERMINE WHICH STORES ARE BEING PROCESSED THIS RUN.                   
           PERFORM 5300-READ-STORE-CONTROL.                                     
      *                                                                         
           IF NOT STORE-CONTROL-DONE                                            
               PERFORM 2500-PROCESS-STORE-CONTROL                               
           ELSE                                                                 
               SET PS-EMPTY-STORE-FILE TO TRUE                                  
           END-IF.                                                              
      *                                                                         
      *                                                                         
      ** READ OF THE EXCEPTION MERGE FILE.                                      
      *                                                                         
W26600     IF NOT PS-EMPTY-STORE-FILE                                           
               PERFORM 5000-READ-INV-FILE                                       
      *                                                                         
               IF PS-END-OF-INPUT                                               
                   MOVE ZEROS TO SA-STORE-FOR-HEADER                            
                   PERFORM 7900-WRITE-NO-EXCEPTIONS                             
               ELSE                                                             
                   MOVE IN024-STORE-NUMBER    TO SA-STORE-NUMBER                
                                                 SA-STORE-FOR-HEADER            
                                                 DLESL-STORE                    
      *            MOVE IN024-SKU-ATTRIBUTES  TO SA-SKU-ATTRIBUTES              
                   MOVE IN024-SKU             TO SA-SKU                         
                   MOVE IN024-ABSOLUTE-VAR-PRICE  TO PV-HIGH-RANGE              
                                                                                
                   SET CONTINUE-PROCESSING TO TRUE                              
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      /****************************************************************         
      * 2000-PROCESS-INPUT.                                                     
      * 1. IF MERGE-FILE STORE <> CONTROL-FILE-STORE - NO EXCEPTIONS            
      * 2. IF MERGE-FILE STORE =  MERGE-FILE STORE CONTINUE ALL RECS            
      *****************************************************************         
       2000-PROCESS-INPUT.                                                      
      **                                                                        
           IF IN024-STORE-NUMBER IS EQUAL TO SA-STORE-NUMBER                    
               PERFORM 2200-PROCESS-SKU                                         
           ELSE                                                                 
               PERFORM 2400-PROCESS-STORE-BREAK                                 
28545          PERFORM 2200-PROCESS-SKU                                         
           END-IF.                                                              
      *                                                                         
           PERFORM 5000-READ-INV-FILE.                                          
      *                                                                         
      *                                                                         
      ******************************************************************        
      *                                                                         
      ******************************************************************        
       2200-PROCESS-SKU.                                                        
      *                                                                         
                                                                                
           MOVE IN024-STORE-NUMBER        TO SA-STORE-NUMBER                    
           MOVE IN024-SKU                 TO SA-SKU                             
           MOVE IN024-AREA-NUMBER         TO SA-AREA-NUMBER                     
                                                                                
           PERFORM 6000-PROCESS-MERGE-RECORD.                                   
      *                                                                         
      *    MOVE LAST PRINTED VARIANCE AMOUNT TO THE LOW RANGE                   
      *    MOVE PV-ABS-DIFF-RTL TO PV-LOW-RANGE.                                
      *                                                                         
           IF IN024-ABSOLUTE-VAR-PRICE IS NOT EQUAL TO 0                        
               PERFORM 8400-PRT-DETAIL                                          
               MOVE IN024-ABSOLUTE-VAR-PRICE  TO PV-LOW-RANGE                   
           END-IF.                                                              
                                                                                
           MOVE SPACES             TO DL-DETAIL-LINE.                           
      *                                                                         
      *****************************************************************         
      * 2400-PROCESS-STORE-BREAK.                                               
      *****************************************************************         
       2400-PROCESS-STORE-BREAK.                                                
      *                                                                         
           IF PV-STORE-REC-COUNT IS GREATER THAN 0                              
               PERFORM 7700-PRINT-EXCEPTION-RANGE                               
           ELSE                                                                 
               MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD               
               MOVE 2                    TO PV-ADVANCE-LINE                     
               PERFORM 7300-PRINT-DETAIL-RECORD                                 
           END-IF.                                                              
      *                                                                         
28545 *    MOVE ZEROS                TO PV-PAGE-COUNT                           
28545      MOVE ZEROS                TO PV-LINE-COUNT                           
                                        PV-STORE-REC-COUNT.                     
      *                                                                         
           MOVE IN024-STORE-NUMBER   TO SA-STORE-NUMBER                         
                                        SA-STORE-FOR-HEADER.                    
      *                                                                         
           MOVE IN024-SKU            TO SA-SKU.                                 
      *                                                                         
           MOVE IN024-ABSOLUTE-VAR-PRICE  TO PV-HIGH-RANGE                      
      *                                                                         
           PERFORM 5300-READ-STORE-CONTROL.                                     
           PERFORM 2500-PROCESS-STORE-CONTROL.                                  
      *                                                                         
           PERFORM 7100-PRINT-HEADINGS.                                         
      *                                                                         
      *****************************************************************         
      * 2500-PROCESS-STORE-CONTROL.                                             
      *****************************************************************         
       2500-PROCESS-STORE-CONTROL.                                              
      *                                                                         
            MOVE SCR-STORE-NMBR  TO SA-SAVE-STORE-NUMBER.                       
      *                                                                         
      *                                                                         
      /*****************************************************************        
      * 5000-READ-INV-FILE.                                                     
      *    READ THE MERGED INPUT EXCEPTION SKUS.                                
      ******************************************************************        
       5000-READ-INV-FILE.                                                      
      *                                                                         
           READ STORE-MERGE-FILE                                                
             INTO IN024-INV-EXCEPTS-STR-REC                                     
                AT END  SET PS-END-OF-INPUT TO TRUE                             
           END-READ.                                                            
      *                                                                         
      ******************************************************************        
      * 5100-READ THE EXCEPTION CONTROL FILE.                                   
      *    READ THE TOP EXCEPTION CONTROL FILE.                                 
      ******************************************************************        
       5100-READ-EXCEPT-CONTROL-FILE.                                           
                                                                                
           READ EXCEPT-CONTROL-FILE                                             
             AT END                                                             
               SET PS-END-OF-INPUT TO TRUE                                      
               DISPLAY '*************************************'                  
               DISPLAY '**  ABEND PROGRAM = INKRP279'                           
               DISPLAY '**  PARAGRAPH     = 1000-INITIALIZTION'                 
               DISPLAY '**'                                                     
               DISPLAY '**  MISSING EXCEPTION CONTROL RECORD'                   
               DISPLAY '**  INP03'                                              
               DISPLAY '*************************************'                  
               MOVE +4008          TO ABEND-CODE                                
               PERFORM 9990-ABEND                                               
           END-READ.                                                            
      *                                                                         
      ******************************************************************        
      * 5300-READ THE STORE CONTROL FILE.                                       
      *    READ THE STORE CONTROL FILE WHICH LETS US KNOW WHICH STORES          
      *  WE ARE PROCESSING THIS RUN.                                            
      ******************************************************************        
       5300-READ-STORE-CONTROL.                                                 
                                                                                
           READ STORE-CONTROL-FILE NEXT                                         
                AT END                                                          
                    MOVE 'Y'    TO PS-INP01-DONE-SW                             
           END-READ.                                                            
      *                                                                         
           ADD 1                TO PV-STORE-COUNT.                              
      *                                                                         
           SET FIRST-REC-FOR-STORE TO TRUE.                                     
      *                                                                         
      /*****************************************************************        
      * 6000-PROCESS-MERGE-RECORD.                                              
      * MOVE THE COPY BOOK (INRD288) VALUES TO THE OUTPUT RECORD VALUES         
      ******************************************************************        
       6000-PROCESS-MERGE-RECORD.                                               
      *                                                                         
     **    MOVE VARIANCE INFORMATION FROM MERGE FILE                            
           MOVE IN024-AREA-NUMBER         TO DL1-AREA.                          
           MOVE IN024-ABSOLUTE-VAR-PRICE  TO DL1-VARIANCE.                      
           MOVE IN024-SYSTEM-PRICE        TO DL1-FS-PRICE.                      
           MOVE IN024-DEPT                TO SA1-DEPT.                          
           MOVE IN024-CLASS               TO SA1-CLASS.                         
           MOVE IN024-SUB-CLASS           TO SA1-SCL.                           
           MOVE SA-SKU-ATTR               TO DL1-DMS.                           
           MOVE IN024-SKU                 TO DL1-SKU, PV-EDIT-SKU,              
                                             SA-SKU-SAVE.                       
     **    SELECT SKU DESCRIPTION                                               
           PERFORM 8600-SELECT-IMV-SKU.                                         
                                                                                
     **    SELECT INVENTORY QUANTITY                                            
     **    PERFORM 8800-SELECT-TSUMINV                                          
     *     MOVE IN024-QUANTITY            TO DL1-INV-ONHND.                     
                                                                                
     **    DETERMINE INVENTORY RETAIL / EXTENDED RETAIL                         
           PERFORM 6100-INVENTORY-RETAIL.                                       
                                                                                
      *    MOVE PV-CALC-INV-RTL           TO DL1-INV-PRICE.                     
      *    MOVE PV-CALC-EXTD-RTL          TO DL1-EXTEND-PRICE.                  
                                                                                
      *    MOVE ZEROS                     TO PV-DTL-LINE-PRT-ACCUM.             
      *                                                                         
      /*****************************************************************        
      * 6100-INVENTORY-RETAIL.                                                  
      * WRITE THE RETAIL AMOUNTS                                                
      ******************************************************************        
      *                                                                         
       6100-INVENTORY-RETAIL.                                                   
      *                                                                         
           MOVE IN024-PRICE               TO DL1-INV-PRICE                      
           MOVE IN024-SYSTEM-PRICE        TO DL1-FS-PRICE                       
           MOVE IN024-ABSOLUTE-VAR-PRICE  TO DL1-VARIANCE                       
                                                                                
           COMPUTE PV-CALC-EXTD-RTL = ( IN024-ABSOLUTE-VAR-PRICE                
                                      * IN024-QUANTITY ).                       
      *                                                                         
           MOVE PV-CALC-EXTD-RTL           TO DL1-EXTEND-PRICE.                 
      *                                                                         
      ******************************************************************        
      * 7100-PRINT-HEADINGS.                                                    
      ******************************************************************        
       7100-PRINT-HEADINGS.                                                     
      *                                                                         
           ADD 1                    TO PV-PAGE-COUNT.                           
           MOVE PV-PAGE-COUNT       TO DP132O-PAGE-NUMBER.                      
           MOVE PC-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.                     
           MOVE 1                   TO DP132O-REPORT-NUMBER.                    
                                                                                
           WRITE REPORT-LINE                                                    
             FROM DP132O-STANDRD-HEADER-132-COLS AFTER ADVANCING PAGE.          
                                                                                
           MOVE ECR-EXCEPT-CONTROL  TO HL1-EXCEPT-CONTROL.                      
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM HL1-HEADING-LINE-1 AFTER ADVANCING 1 LINE.                    
                                                                                
           PERFORM 8500-SELECT-XMTLOC.                                          
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL2-HEADING-LINE-2 AFTER ADVANCING 1 LINE.                    
                                                                                
      *    IF (PV-STORE-REC-COUNT IS GREATER THAN 0   OR                        
      *        FIRST-TIME-THRU)                                                 
      *    END-IF.                                                              
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL3-HEADING-LINE-3 AFTER ADVANCING 1 LINE.                    
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL4-HEADING-LINE-4 AFTER ADVANCING 1 LINE.                    
                                                                                
           WRITE REPORT-LINE                                                    
             FROM HL5-HEADING-LINE-5 AFTER ADVANCING 1 LINE.                    
                                                                                
           MOVE 7                   TO PV-LINE-COUNT.                           
      *                                                                         
      ******************************************************************        
      * 7300-PRINT-DETAIL-RECORD.                                               
      ******************************************************************        
       7300-PRINT-DETAIL-RECORD.                                                
      *                                                                         
           IF PV-LINE-COUNT = 0                                                 
               OR (PV-LINE-COUNT + PV-ADVANCE-LINE > PC-PRINT-LINE-MAX)         
               PERFORM 7100-PRINT-HEADINGS                                      
           END-IF.                                                              
      *                                                                         
           WRITE REPORT-LINE FROM RP-REPORT-WORK-RECORD                         
               AFTER ADVANCING PV-ADVANCE-LINE LINE.                            
      *                                                                         
           ADD PV-ADVANCE-LINE  TO PV-LINE-COUNT.                               
           MOVE +1              TO PV-ADVANCE-LINE.                             
      *                                                                         
           ADD 1 TO PV-STORE-REC-COUNT.                                         
      *                                                                         
      ******************************************************************        
      * 7700-PRINT THE STORE EXCEPTION SUMMARY LINE.                            
      ******************************************************************        
       7700-PRINT-EXCEPTION-RANGE.                                              
      *                                                                         
           MOVE SA-STORE-NUMBER TO DLESL-STORE.                                 
           MOVE PV-LOW-RANGE    TO DLESL-LOW.                                   
           MOVE PV-HIGH-RANGE   TO DLESL-HIGH.                                  
      *                                                                         
           MOVE DL-EXCEPTION-SUMMARY-LINE TO RP-REPORT-WORK-RECORD.             
           MOVE 3                    TO PV-ADVANCE-LINE.                        
           PERFORM 7300-PRINT-DETAIL-RECORD.                                    
      *                                                                         
      *    MOVE IN024-ABSOLUTE-VAR-QTY TO PV-HIGH-RANGE                         
      *                                   PV-LOW-RANGE.                         
      *                                                                         
      ******************************************************************        
      * 7900-WRITE-NO-EXCEPTIONS.                                               
      ******************************************************************        
       7900-WRITE-NO-EXCEPTIONS.                                                
      *                                                                         
           ADD 1                    TO PV-PAGE-COUNT.                           
           MOVE 1                   TO DP132O-PAGE-NUMBER.                      
           MOVE PC-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.                     
           MOVE 1                   TO DP132O-REPORT-NUMBER.                    
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM DP132O-STANDRD-HEADER-132-COLS AFTER ADVANCING PAGE.          
      *                                                                         
           MOVE ECR-EXCEPT-CONTROL  TO HL1-EXCEPT-CONTROL.                      
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM HL1-HEADING-LINE-1 AFTER ADVANCING 1 LINE.                    
      *                                                                         
25248      PERFORM 8500-SELECT-XMTLOC.                                          
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM HL2-HEADING-LINE-2 AFTER ADVANCING 1 LINE.                    
      *                                                                         
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM HL3-HEADING-LINE-3 AFTER ADVANCING 1 LINE.                    
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM HL4-HEADING-LINE-4 AFTER ADVANCING 1 LINE.                    
      *                                                                         
           WRITE REPORT-LINE                                                    
             FROM HL5-HEADING-LINE-5 AFTER ADVANCING 1 LINE.                    
      *                                                                         
           MOVE 7                   TO PV-LINE-COUNT.                           
                                                                        INRD024 
           WRITE REPORT-LINE FROM RP-REPORT-WORK-RECORD                 INRD024 
               AFTER ADVANCING PV-ADVANCE-LINE LINE.                    INRD024 
                                                                        INRD024 
           ADD PV-ADVANCE-LINE  TO PV-LINE-COUNT.                       INRD024 
           MOVE +1              TO PV-ADVANCE-LINE.                     INRD024 
      *                                                                         
      *****************************************************************         
      * 8400-PRT-DETAIL.                                                        
      *****************************************************************         
       8400-PRT-DETAIL.                                                         
      *                                                                         
           MOVE DL-DETAIL-LINE       TO RP-REPORT-WORK-RECORD.                  
           PERFORM 7300-PRINT-DETAIL-RECORD.                                    
      *                                                                         
      /*****************************************************************        
      * 8500-SELECT-XMTLOC.                                                     
      ******************************************************************        
       8500-SELECT-XMTLOC.                                                      
      *                                                                         
           INITIALIZE DCLXMT00001.                                              
      *                                                                         
           MOVE SA-STORE-NUMBER     TO XMT00001-LOC-NBR                         
                                       PV-CHAR-STORE.                           
      *                                                                         
           EXEC SQL                                                             
             SELECT LOC_NM                                                      
               INTO :XMT00001-LOC-NM                                            
               FROM XMT_LOC                                                     
              WHERE LOC_NBR = :XMT00001-LOC-NBR                                 
           END-EXEC.                                                            
      *                                                                         
           EVALUATE TRUE                                                        
             WHEN SQLCODE = +0                                                  
               STRING PV-CHAR-STORE DELIMITED BY SIZE                           
                      ' - ' DELIMITED BY SIZE                                   
                      XMT00001-LOC-NM DELIMITED BY SIZE                         
                                     INTO HL2-STORE-DESCRIPTION                 
             WHEN OTHER                                                         
               STRING PV-CHAR-STORE DELIMITED BY SIZE                           
                      ' - NOT FOUND ON XMTLOC' DELIMITED BY SIZE                
                                     INTO HL2-STORE-DESCRIPTION                 
           END-EVALUATE.                                                        
      *                                                                         
      ******************************************************************        
      * 8600-SELECT-IMV-SKU.                                                    
      ******************************************************************        
       8600-SELECT-IMV-SKU.                                                     
      *                                                                         
           INITIALIZE DCLIMV00001.                                              
      *                                                                         
           MOVE PV-EDIT-SKU         TO IMV00001-SKU-NBR.                        
      *                                                                         
           EXEC SQL                                                             
             SELECT                                                             
                   SKU_DESC                                                     
             INTO                                                               
                  :IMV00001-SKU-DESC                                            
             FROM IMV_SKU                                                       
             WHERE                                                              
                   SKU_NBR         = :IMV00001-SKU-NBR                          
           END-EXEC.                                                            
      *                                                                         
           EVALUATE SQLCODE                                                     
               WHEN +0                                                          
                   MOVE IMV00001-SKU-DESC (1:25) TO DL1-SKU-DESCRIP,            
                                                    SA-SKU-DESCRIP-SAVE         
               WHEN OTHER                                                       
                   MOVE '****'        TO DL1-SKU-DESCRIP,                       
                                         SA-SKU-DESCRIP-SAVE                    
           END-EVALUATE.                                                        
      *                                                                         
      /****************************************************************         
      * 9000-END-OF-JOB-TASKS.                                                  
      *****************************************************************         
       9000-END-OF-JOB-TASKS.                                                   
      *                                                                         
           IF PV-STORE-REC-COUNT IS GREATER THAN 0                              
               PERFORM 7700-PRINT-EXCEPTION-RANGE                               
           ELSE                                                                 
               IF PV-STORE-COUNT IS GREATER THAN ZEROS                          
                   MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD           
                   MOVE 2                    TO PV-ADVANCE-LINE                 
                   PERFORM 7300-PRINT-DETAIL-RECORD                             
               END-IF                                                           
           END-IF.                                                              
      *                                                                         
      ***   GENERATE 'NO EXCEPTION' LINES FOR STORES WE DID NOT                 
      *** PROCESS ANY EXCEPTION INFORMATION FOR. (THIS EXCLUDES                 
      *** STORE WE HAVE ALL READY WORKED WITH I THIS PROGRAM)                   
      *                                                                         
      *    MOVE ZEROS               TO PV-SUB.                                  
      *    PERFORM 2600-STORE-W-NO-EXCEPTIONS                                   
      *      VARYING PV-SUB FROM 1 BY 1                                         
      *        UNTIL PV-SUB IS GREATER THAN 999.                                
      *                                                                         
      *    IF PV-STORE-COUNT IS EQUAL TO ZEROS                                  
      *        MOVE DL-NO-EXCEPTION-LINE TO RP-REPORT-WORK-RECORD               
      *        MOVE 2                    TO PV-ADVANCE-LINE                     
      *        PERFORM 7300-PRINT-DETAIL-RECORD                                 
      *    END-IF.                                                              
      *                                                                         
           CLOSE STORE-MERGE-FILE                                               
                 EXCEPT-CONTROL-FILE                                            
                 STORE-CONTROL-FILE                                             
                 STORE-INV-EXCEPTION-RPT.                                       
      *                                                                         
           DISPLAY '**********************************'.                        
           DISPLAY '* END OF INKRP279                 '.                        
           DISPLAY '**********************************'.                        
      *                                                                         
      /****************************************************************         
      * 9900-SQL-ABEND.                                                         
      *  STANDARD DB2 ERROR ABEND ROUTINE                                       
      *  THIS ROUTINE FORCES AN ABEND DUE TO A DB2 PROBLEM.                     
      *****************************************************************         
       9900-SQL-ABEND.                                                          
      *                                                                         
           MOVE +4013                 TO ABEND-CODE.                            
           DISPLAY '**  ABEND     **'.                                          
           DISPLAY '**  PROGRAM   **  =  INKRP279'.                             
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.                    
           DISPLAY '**  OPERATION **  = ' PV-DB2-OPER-ATTEMPTED.                
      *                                                                         
      *    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
      *    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
      *                                                                         
           COPY DPPD004.                                                        
      *                                                                         
           PERFORM 9990-ABEND.                                                  
      *                                                                         
       9990-ABEND.                                                              
                                                                                
           CALL 'ILBOABN0'  USING ABEND-CODE.                                   
