000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT056.                                         00020000
000300 AUTHOR.        MIKE BESKE.                                       00030007
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   OCTOBER 2000.                                     00050007
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080006
000900*   AHKUT056.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.      *00090006
001000*                                                                *00100006
001100*   PURPOSE:                                                     *00110006
001200*   THIS PROGRAM CREATES AN EXTRACT FILE FROM: TVNDINV.          *00120006
001300*   THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE:           *00130006
001400*   1) LOADED TO THE "ARCHIVE/HISTORY" VERSIONS OF THE TABLES.   *00140006
001500*   2) DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.      *00150006
001600*                                                                *00160006
001700*   PROCESSING OVERVIEW:                                         *00170006
001800*   THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,    *00180006
001900*   1) INCREMENT COUNT OF RECORDS READ.                          *00190006
002000*   2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.              *00200006
002100*      2.A) IF NO MATCH(ES):                                     *00210006
002200*           2.A.1) PROCESSING CONTINUES                          *00220006
002300*           2.A.2) DO NOT PERFORM ERROR/REPORTING ROUTINES;      *00230006
002400*                  THIS SYSTEM DOES NOT CLEANSE DATA NOR REPORT  *00240006
002500*                  ON UNCLEAN DATA.  IT SIMPLY MIGRATES          *00250006
002600*                  CONDITIONS OCCURRING IN OPERATIONAL           *00260006
002700*                  TABLES OVER TO THE ARCHIVE/HISTORY TABLES.    *00270006
002800*      2.B) IF MATCH(ES):                                        *00280006
002900*           2.B.1) INCREMENT COUNT OF ROW(S) FOUND.              *00290006
003000*           2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.       *00300006
003100*           2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.           *00310006
003200*           2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE       *00320006
003300*                  AT THIS TIME.  THEY WILL BE REMOVED IN OTHER  *00330006
003400*                  PROCESSING, AFTER HAVING BEEN LOADED TO THE   *00340006
003500*                  ARCHIVE/HISTORY TABLE.                        *00350006
003600*   3) EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *00360006
003700*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *00370006
003800*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *00380006
003900******************************************************************00390006
004000 ENVIRONMENT DIVISION.                                            00400000
004100 CONFIGURATION SECTION.                                           00410000
004200 SOURCE-COMPUTER.        IBM-3090.                                00420000
004300 OBJECT-COMPUTER.        IBM-3090.                                00430000
004400                                                                  00440000
004500 INPUT-OUTPUT SECTION.                                            00450000
004600 FILE-CONTROL.                                                    00460000
004700                                                                  00470000
004800     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00480000
004900     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00490000
005000                                                                  00500000
005100******************************************************************00510000
005200 DATA DIVISION.                                                   00520000
005300 FILE SECTION.                                                    00530000
005400                                                                  00540000
005500 FD  IN-DRIVER-FILE                                               00550000
005600     RECORDING MODE IS F                                          00560000
005700     LABEL RECORDS ARE STANDARD                                   00570000
005800     BLOCK CONTAINS 0 RECORDS.                                    00580000
005900 01  IN-DRIVER-RECORD                PIC  X(023).                 00590001
006000                                                                  00600000
006100**** TVNDINV:                                                     00610004
006200 FD  OUT-EXTRACT-FILE                                             00620000
006300     RECORDING MODE IS F                                          00630000
006400     LABEL RECORDS ARE STANDARD                                   00640000
006500     BLOCK CONTAINS 0 RECORDS.                                    00650000
006600 01  OUT-EXTRACT-RECORD              PIC  X(136).                 00660001
006700                                                                  00670000
006800                                                                  00680000
006900                                                                  00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100                                                                  00710000
007200 01  PC-PROGRAM-CONSTANTS.                                        00720000
007300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT056'.  00730000
007400     05  PC-PGM-PROGRESS-DESC.                                    00740000
007500         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00750000
007600         10  PC-CONTINUING           PIC X(10) VALUE              00760000
007700                                               'CONTINUING'.      00770000
007800         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00780000
007900         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00790000
008000     05  PC-ABEND-INFO.                                           00800000
008100         10  PC-ABEND                PIC X(11) VALUE              00810000
008200                                               '** ABEND **'.     00820000
008300         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00830000
008400                                               '- PARA       : '. 00840000
008500         10  PC-ABEND-MSG-DISPLAY-PARA                            00850000
008600                                     PIC X(15) VALUE              00860000
008700                                               '  CALLED PARA: '. 00870000
008800         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00880000
008900                                               '  FOR ABEND# : '. 00890000
009000         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00900000
009100                                               '- ERROR IS   : '. 00910000
009200         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00920000
009300         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00930000
009400                                               '- ACTION     : '. 00940000
009500                                                                  00950000
009600     05  PC-TEST-AND-SET-NULL-IND.                                00960000
009700         10  PC-NOT-NULL             PIC S9(4) COMP               00970000
009800                                               VALUE ZERO.        00980000
009900         10  PC-NULL                 PIC S9(4) COMP               00990000
010000                                               VALUE -1.          01000000
010100         10  PC-NULL-CONV-ERR        PIC S9(4) COMP               01010000
010200                                               VALUE -2.          01020000
010300         10  PC-NULLIF-QUESTION-MARK PIC X(01) VALUE '?'.         01030000
010400                                                                  01040000
010500     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 100000.      01050000
010600                                                                  01060000
010700 01  PS-PROGRAM-SWITCHES.                                         01070000
010800     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         01080000
010900         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         01090000
011000         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01100000
011100     05  PS-CURSOR-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01110000
011200         88  PS-CURSOR-HAS-DATA                VALUE 'Y'.         01120000
011300         88  PS-CURSOR-HAS-NO-DATA             VALUE 'N'.         01130000
011400     05  PS-TABLE-LOOP-DONE-SW       PIC X(01) VALUE 'N'.         01140000
011500         88  PS-TABLE-LOOP-DONE                VALUE 'Y'.         01150000
011600         88  PS-TABLE-LOOP-NOT-DONE            VALUE 'N'.         01160000
011700                                                                  01170000
011800 01  PV-PROGRAM-VARIABLES.                                        01180000
011900     05  PV-PAYT-REQ-SEQ-NBR-COMP    PIC S9(9) VALUE 0 COMP.      01190000
012010     05  PV-PAYT-REQ-LNE-NBR-COMP    PIC S9(9) VALUE 0 COMP.      01201001
012100     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01210000
012200     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01220000
012300     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01230000
012400     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01240000
012500     05  PV-NULL-INDICATORS.                                      01250000
012600         10  PV-NULL-IND-VER-NBR     PIC S9(4) COMP               01260000
012700                                               VALUE 0.           01270000
012800         10  PV-NULL-IND-PO-LNE-NBR  PIC S9(4) COMP               01280000
012900                                               VALUE 0.           01290000
013000                                                                  01300000
013100     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01310000
013200     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01320000
013300     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01330000
013400     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01340000
013500     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01350000
013600     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01360000
013700                                                                  01370000
013800     05  PV-TMST                     PIC X(26) VALUE SPACES.      01380000
013900     05  PV-TIMESTAMP-DETAIL                                      01390000
014000         REDEFINES                                                01400000
014100         PV-TMST.                                                 01410000
014200         10  PV-TIMESTAMP-19.                                     01420000
014300             15  PV-TMS-DATE.                                     01430000
014400                 20  PV-TMS-YEAR.                                 01440000
014500                     25  PV-TMS-CC   PIC X(02).                   01450000
014600                     25  PV-TMS-YY   PIC X(02).                   01460000
014700                 20  FILLER          PIC X(01).                   01470000
014800                 20  PV-TMS-MONTH    PIC X(02).                   01480000
014900                 20  FILLER          PIC X(01).                   01490000
015000                 20  PV-TMS-DAY      PIC X(02).                   01500000
015100             15  FILLER              PIC X(01).                   01510000
015200             15  PV-TMS-HOUR         PIC X(02).                   01520000
015300             15  FILLER              PIC X(01).                   01530000
015400             15  PV-TMS-MINUTE       PIC X(02).                   01540000
015500             15  FILLER              PIC X(01).                   01550000
015600             15  PV-TMS-SECOND       PIC X(02).                   01560000
015700         10  FILLER                  PIC X(01).                   01570000
015800         10  PV-TMS-MSECOND          PIC X(06).                   01580000
015900                                                                  01590000
016000 01  DM-DISPLAY-MESSAGE.                                          01600000
016100     05  DM-01-10.                                                01610000
016200         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01620000
016300         10  FILLER                  PIC X(02) VALUE ': '.        01630000
016400     05  DM-11-80.                                                01640000
016500         10  FILLER                  PIC X(37) VALUE              01650000
016600                        'SELECT ROWS MATCHING TO DRIVER FILE, '.  01660000
016700         10  FILLER                  PIC X(30) VALUE              01670000
016800                        'CREATING TVNDINV EXTRACT FILE.'.         01680004
016900         10  FILLER                  PIC X(01) VALUE SPACE.       01690000
017000         10  FILLER                  PIC X(01) VALUE ALL '*'.     01700000
017100     05  DM-81-120.                                               01710000
017200         10  FILLER                  PIC X(40) VALUE ALL '*'.     01720000
017300                                                                  01730000
017400 01  DP-DISPLAY-PROGRESS-MSG.                                     01740000
017500     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01750000
017600     05  FILLER                      PIC X(02) VALUE SPACE.       01760000
017700     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01770000
017800     05  FILLER                      PIC X(04) VALUE ' AT '.      01780000
017900     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01790000
018000     05  FILLER                      PIC X(03) VALUE '.  '.       01800000
018100     05  FILLER                      PIC X(03) VALUE              01810000
018200                                         'IN:'.                   01820000
018300     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01830000
018400                                               VALUE ZERO.        01840000
018500     05  FILLER                      PIC X(02) VALUE ', '.        01850000
018600*    05  FILLER                      PIC X(16) VALUE              01860000
018700*                                        'DRIVER W/ROW(S):'.      01870000
018800*    05  DP-MATCHES-FOUND-CNT        PIC ZZZ,ZZZ,ZZ9              01880000
018900*                                              VALUE ZERO.        01890000
019000*    05  FILLER                      PIC X(02) VALUE ', '.        01900000
019100     05  FILLER                      PIC X(14) VALUE              01910000
019200                                         'ROWS SELECTED:'.        01920000
019300     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01930000
019400                                               VALUE ZERO.        01940000
019500     05  FILLER                      PIC X(02) VALUE ', '.        01950000
019600     05  FILLER                      PIC X(04) VALUE              01960000
019700                                         'OUT:'.                  01970000
019800     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01980000
019900                                               VALUE ZERO.        01990000
020000     05  FILLER                      PIC X(01) VALUE '.'.         02000000
020100                                                                  02010000
020200 01  ABEND-CODE                      PIC S9(04)                   02020000
020300                                               VALUE ZEROES       02030000
020400                                               COMP SYNC.         02040000
020500                                                                  02050000
020600*---------------------------------------------------------------* 02060000
020700*  DB2 FORMATTED MESSAGE AREA                                     02070000
020800*---------------------------------------------------------------* 02080000
020900     COPY DPWS004.                                                02090000
021000                                                                  02100000
021100                                                                  02110000
021200*---------------------------------------------------------------* 02120000
021300*  AHRD005  - RECORD LAYOUT FOR DRIVER FILE, INPUT.             * 02130001
021400*---------------------------------------------------------------* 02140000
021500     COPY AHRD005.                                                02150001
021600                                                                  02160000
021700                                                                  02170000
022300                                                                  02230000
022400*---------------------------------------------------------------* 02240000
022500*    DB2 AREA FOR TVNDINV                                       * 02250004
022600*---------------------------------------------------------------* 02260000
022700     EXEC SQL                                                     02270000
022800          INCLUDE TVNDINV                                         02280003
022900     END-EXEC.                                                    02290000
023000                                                                  02300000
023100*---------------------------------------------------------------* 02310000
023200*    DB2 AREA FOR COMMUNICATIONS                                * 02320000
023300*---------------------------------------------------------------* 02330000
023400     EXEC SQL                                                     02340000
023500          INCLUDE SQLCA                                           02350000
023600     END-EXEC.                                                    02360000
023700                                                                  02370000
023800                                                                  02380000
023900*---------------------------------------------------------------* 02390000
024000*    DEFINE CURSOR FOR TVNDINV :                                * 02400004
024100*    PULL ALL AVAILABLE COLUMNS, SO EXTRACT FILE WILL CONTAIN   * 02410000
024200*    ALL DATA TO POPULATE "ARCHIVE HISTORY" COPY OF THIS TABLE. * 02420000
024300*---------------------------------------------------------------* 02430000
024400     EXEC SQL                                                     02440000
024500          DECLARE TABLE-CURSOR CURSOR FOR                         02450000
024600           SELECT PAYT_REQ_SEQ_NBR                                02460000
024700                 ,PAYT_REQ_LNE_NBR                                02470000
024800                 ,UPC_EAN_QUAL_CDE                                02480001
024810                 ,UPC_EAN_CDE                                     02481001
024820                 ,VEND_STYL_CDE                                   02482001
024830                 ,COLOR_CDE                                       02483001
024840                 ,COLOR_DESC                                      02484001
024850                 ,SIZE_CDE                                        02485001
024860                 ,SIZE_DESC                                       02486001
024870                 ,SKU_DESC                                        02487001
024880                 ,DEPT_NBR                                        02488001
024890                 ,CL_CDE                                          02489001
024891                 ,SKU_SEQ_NBR                                     02489101
025300           FROM   TVNDINV                                         02530004
025400          WHERE  (PAYT_REQ_SEQ_NBR = :PV-PAYT-REQ-SEQ-NBR-COMP    02540001
025420            AND   PAYT_REQ_LNE_NBR = :PV-PAYT-REQ-LNE-NBR-COMP)   02542001
025600            FOR  FETCH ONLY                                       02560000
025700           WITH  UR                                               02570000
025800     END-EXEC.                                                    02580000
025900                                                                  02590000
026000                                                                  02600000
026100 PROCEDURE DIVISION.                                              02610000
026200********************                                              02620000
026300                                                                  02630000
026400 0000-PROGRAM-MAINLINE.                                           02640000
026500                                                                  02650000
026600     PERFORM 1000-INITIALIZE.                                     02660000
026700                                                                  02670000
026800     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02680000
026900     PERFORM 2000-PROCESS-DRIVER-FILE                             02690000
027000         UNTIL PS-IN-DRIVER-EOF.                                  02700000
027100                                                                  02710000
027200     PERFORM 6000-EOJ-ROUTINE.                                    02720000
027300     STOP RUN.                                                    02730000
027400                                                                  02740000
027500                                                                  02750000
027600******************************************************************02760006
027700*   INITIALIZATIONS                                              *02770006
027800******************************************************************02780006
027900 1000-INITIALIZE.                                                 02790000
028000                                                                  02800000
028100     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02810000
028200     DISPLAY DM-DISPLAY-MESSAGE.                                  02820000
028300                                                                  02830000
028400     MOVE PC-BEGINNING            TO DP-STATUS-DESCRIPTION.       02840000
028500     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02850000
028600                                                                  02860000
028700     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02870000
028800     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02880000
028900                                                                  02890000
029000                                                                  02900000
029100******************************************************************02910006
029200*   1) GET NEXT RECORD FROM DRIVER FILE, AND                     *02920006
029300*      1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR          *02930006
029400*      1B- OPEN TABLE CURSOR                                     *02940006
029500*      1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL                 *02950006
029600*          ROWS FOR THIS INPUT DRIVER RECORD                     *02960006
029700*      2) FOR EACH ROW,                                          *02970006
029800*         2A- INCREMENT COUNTS                                   *02980006
029900*         2B- WRITE EXTRACT RECORD                               *02990006
030000*      1D- CLOSE TABLE CURSOR                                    *03000006
030100******************************************************************03010006
030200 2000-PROCESS-DRIVER-FILE.                                        03020000
030300                                                                  03030000
030400     PERFORM 9050-READ-IN-DRIVER-FILE.                            03040000
030500     IF PS-IN-DRIVER-EOF                                          03050000
030600         CONTINUE                                                 03060000
030700     ELSE                                                         03070000
030810         MOVE AH005-PAYT-REQ-SEQ-NBR                              03081001
030900                                   TO PV-PAYT-REQ-SEQ-NBR-COMP    03090005
030901         MOVE AH005-PAYT-REQ-LNE-NBR                              03090101
030910                                   TO PV-PAYT-REQ-LNE-NBR-COMP    03091005
031100         PERFORM 2100-CHECK-PGM-PROGRESS                          03110000
031200         SET PS-TABLE-LOOP-NOT-DONE   TO TRUE                     03120000
031300         SET PS-CURSOR-HAS-NO-DATA    TO TRUE                     03130000
031400         PERFORM 9100-OPEN-TABLE-CURSOR                           03140000
031500         PERFORM 3000-EXTRACT-ROWS-FROM-TABLE                     03150000
031600             UNTIL PS-TABLE-LOOP-DONE                             03160000
031700         PERFORM 9190-CLOSE-TABLE-CURSOR                          03170000
031800     END-IF.                                                      03180000
031900                                                                  03190000
032000                                                                  03200000
032100******************************************************************03210006
032200*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *03220006
032300*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *03230006
032400*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *03240006
032500******************************************************************03250006
032600 2100-CHECK-PGM-PROGRESS.                                         03260000
032700     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         03270000
032800         BY        PC-HOW-OFTEN-TO-DISPLAY                        03280000
032900         GIVING    PV-DISPLAY-NTH-MULTIPLE                        03290000
033000         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      03300000
033100                                                                  03310000
033200     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           03320000
033300         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      03330000
033400         PERFORM 6200-DISPLAY-PGM-PROGRESS                        03340000
033500     END-IF.                                                      03350000
033600                                                                  03360000
033700                                                                  03370000
033800******************************************************************03380006
033900*   EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD       *03390006
034000******************************************************************03400006
034100 3000-EXTRACT-ROWS-FROM-TABLE.                                    03410000
034200     INITIALIZE DCLTVNDINV.                                       03420004
034300     PERFORM 9150-FETCH-TABLE-CURSOR.                             03430000
034400     IF PS-TABLE-LOOP-DONE                                        03440000
034500         CONTINUE                                                 03450000
034600     ELSE                                                         03460000
034800         PERFORM 9750-WRITE-EXTRACT-RECORD                        03480000
034900     END-IF.                                                      03490000
035000                                                                  03500000
040000                                                                  04000000
040100******************************************************************04010006
040200*   DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES           *04020006
040300******************************************************************04030006
040400 6000-EOJ-ROUTINE.                                                04040000
040500                                                                  04050000
040600     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           04060000
040700     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         04070000
040800                                                                  04080000
040900     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     04090000
041000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04100000
041100                                                                  04110000
041200                                                                  04120000
041300******************************************************************04130006
041400*   DISPLAY PROGRAM PROGRESS.                                    *04140006
041500******************************************************************04150006
041600 6200-DISPLAY-PGM-PROGRESS.                                       04160000
041700                                                                  04170000
041800     EXEC SQL                                                     04180000
041900          SET :PV-TMST = CURRENT TIMESTAMP                        04190000
042000     END-EXEC.                                                    04200000
042100                                                                  04210000
042200     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                04220000
042300     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           04230000
042400     MOVE PV-IN-DRIVER-RECS-READ-CNT                              04240000
042500                                    TO DP-IN-CNT.                 04250000
042600*    MOVE PV-RECS-WITH-MATCHES-CNT  TO DP-MATCHES-FOUND-CNT.      04260000
042700     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      04270000
042800     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                04280000
042900                                                                  04290000
043000     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             04300000
043100                                                                  04310000
043200                                                                  04320000
043300******************************************************************04330006
043400*   FILE AND DB2 TABLE ACCESS PARAGRAPHS.                        *04340006
043500*   90XX- INPUT:  DRIVER FILE                                    *04350006
043600*   91XX- INPUT:  TABLE CURSOR                                   *04360006
043700*   97XX- OUTPUT: TABLE EXTRACT                                  *04370006
043800******************************************************************04380006
043900                                                                  04390000
044000******************************************************************04400006
044100*   OPEN  INPUT DRIVER FILE                                      *04410006
044200******************************************************************04420006
044300 9000-OPEN-IN-DRIVER-FILE.                                        04430000
044400     OPEN  INPUT  IN-DRIVER-FILE.                                 04440000
044500                                                                  04450000
044600                                                                  04460000
044700******************************************************************04470006
044800*   READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT          *04480006
044900******************************************************************04490006
045000 9050-READ-IN-DRIVER-FILE.                                        04500000
045100     READ IN-DRIVER-FILE                                          04510000
045200          INTO AH005-TMIITEM                                      04520001
045300          AT END                                                  04530000
045400              SET PS-IN-DRIVER-EOF TO TRUE.                       04540000
045500                                                                  04550000
045600     IF PS-IN-DRIVER-EOF                                          04560000
045700         CONTINUE                                                 04570000
045800     ELSE                                                         04580000
045900         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     04590000
046000     END-IF.                                                      04600000
046100                                                                  04610000
046200                                                                  04620000
046300******************************************************************04630006
046400*   CLOSE INPUT DRIVER FILE                                      *04640006
046500******************************************************************04650006
046600 9090-CLOSE-IN-DRIVER-FILE.                                       04660000
046700     CLOSE IN-DRIVER-FILE.                                        04670000
046800                                                                  04680000
046900                                                                  04690000
047000******************************************************************04700006
047100*   OPEN  TABLE CURSOR                                           *04710006
047200******************************************************************04720006
047300 9100-OPEN-TABLE-CURSOR.                                          04730000
047400     EXEC SQL                                                     04740000
047500          OPEN TABLE-CURSOR                                       04750000
047600     END-EXEC.                                                    04760000
047700                                                                  04770000
047800     EVALUATE TRUE                                                04780000
047900         WHEN SQLCODE = ZERO                                      04790000
048000              ADD +1 TO PV-RECS-WITH-MATCHES-CNT                  04800000
048100              SET PS-CURSOR-HAS-DATA TO TRUE                      04810000
048200         WHEN SQLCODE = +100                                      04820000
048300              SET PS-TABLE-LOOP-DONE TO TRUE                      04830000
048400         WHEN SQLWARN0 NOT EQUAL SPACE                            04840000
048500         WHEN SQLCODE  NOT EQUAL ZERO                             04850000
048600              MOVE '9100-OPEN-TABLE-CURSOR'                       04860000
048700                                 TO PV-PARAGRAPH-NAME             04870000
048800              MOVE 'OPEN TABLE CURSOR'                            04880000
048900                                 TO PV-DB2-OPERATION-MSG-1        04890000
049000              MOVE 'TVNDINV'     TO PV-DB2-TABLE-NAME             04900004
049100              PERFORM 9999-DB2-ABEND                              04910000
049200     END-EVALUATE.                                                04920000
049300                                                                  04930000
049400                                                                  04940000
049500******************************************************************04950006
049600*   FETCH TABLE CURSOR                                           *04960006
049700******************************************************************04970006
049800 9150-FETCH-TABLE-CURSOR.                                         04980000
049900     EXEC SQL                                                     04990000
050000         FETCH TABLE-CURSOR                                       05000000
050100          INTO  :VNDINV-PAYT-REQ-SEQ-NBR                          05010002
050200               ,:VNDINV-PAYT-REQ-LNE-NBR                          05020002
050300               ,:VNDINV-UPC-EAN-QUAL-CDE                          05030002
050310               ,:VNDINV-UPC-EAN-CDE                               05031002
050400               ,:VNDINV-VEND-STYL-CDE                             05040002
050500               ,:VNDINV-COLOR-CDE                                 05050002
050510               ,:VNDINV-COLOR-DESC                                05051002
050600               ,:VNDINV-SIZE-CDE                                  05060002
050610               ,:VNDINV-SIZE-DESC                                 05061002
050620               ,:VNDINV-SKU-DESC                                  05062002
050630               ,:VNDINV-DEPT-NBR                                  05063002
050640               ,:VNDINV-CL-CDE                                    05064002
050650               ,:VNDINV-SKU-SEQ-NBR                               05065002
050700     END-EXEC.                                                    05070000
050800                                                                  05080000
050900     EVALUATE TRUE                                                05090000
051000         WHEN SQLCODE = ZERO                                      05100000
051100              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   05110000
051200              SET PS-CURSOR-HAS-DATA TO TRUE                      05120000
051300         WHEN SQLCODE = +100                                      05130000
051400              SET PS-TABLE-LOOP-DONE TO TRUE                      05140000
051500         WHEN SQLWARN0 NOT EQUAL SPACE                            05150000
051600         WHEN SQLCODE NOT EQUAL ZERO                              05160000
051700              MOVE '9150-FETCH-TABLE-CURSOR'                      05170000
051800                                 TO PV-PARAGRAPH-NAME             05180000
051900              MOVE 'FETCH TABLE CURSOR'                           05190000
052000                                 TO PV-DB2-OPERATION-MSG-1        05200000
052100              MOVE 'TVNDINV'     TO PV-DB2-TABLE-NAME             05210004
052200              PERFORM 9999-DB2-ABEND                              05220000
052300     END-EVALUATE.                                                05230000
052400                                                                  05240000
052500                                                                  05250000
052600******************************************************************05260006
052700*   CLOSE TABLE CURSOR                                           *05270006
052800******************************************************************05280006
052900 9190-CLOSE-TABLE-CURSOR.                                         05290000
053000     EXEC SQL                                                     05300000
053100          CLOSE TABLE-CURSOR                                      05310000
053200     END-EXEC.                                                    05320000
053300                                                                  05330000
053400     EVALUATE TRUE                                                05340000
053500         WHEN SQLCODE = ZERO                                      05350000
053600              CONTINUE                                            05360000
053700         WHEN SQLWARN0 NOT EQUAL SPACE                            05370000
053800         WHEN SQLCODE NOT EQUAL ZERO                              05380000
053900              MOVE '9190-CLOSE-TABLE-CURSOR'                      05390000
054000                                 TO PV-PARAGRAPH-NAME             05400000
054100              MOVE 'CLOSE TABLE CURSOR'                           05410000
054200                                 TO PV-DB2-OPERATION-MSG-1        05420000
054300              MOVE 'TVNDINV'     TO PV-DB2-TABLE-NAME             05430004
054400              PERFORM 9999-DB2-ABEND                              05440000
054500     END-EVALUATE.                                                05450000
054600                                                                  05460000
054700                                                                  05470000
054800******************************************************************05480006
054900*   OPEN OUTPUT EXTRACT FILE                                     *05490006
055000******************************************************************05500006
055100 9700-OPEN-OUT-EXTRACT-FILE.                                      05510000
055200     OPEN OUTPUT OUT-EXTRACT-FILE.                                05520000
055300                                                                  05530000
055400                                                                  05540000
055500******************************************************************05550006
055600*   WRITE A RECORD TO THE TABLE EXTRACT FILE                     *05560006
055700******************************************************************05570006
055800 9750-WRITE-EXTRACT-RECORD.                                       05580000
055910     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTVNDINV.                 05591004
056000     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            05600000
056100                                                                  05610000
056200                                                                  05620000
056300******************************************************************05630006
056400*   CLOSE OUTPUT EXTRACT FILE                                    *05640006
056500******************************************************************05650006
056600 9790-CLOSE-OUT-EXTRACT-FILE.                                     05660000
056700     CLOSE OUT-EXTRACT-FILE.                                      05670000
056800                                                                  05680000
056900                                                                  05690000
057000******************************************************************05700006
057100*   DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *05710006
057200*   AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN            *05720006
057300*   SQL ERROR OR WARNING CODE OCCURS.                            *05730006
057400******************************************************************05740006
057500 9999-DB2-ABEND.                                                  05750000
057600                                                                  05760000
057700     DISPLAY PC-CURRENT-PROGRAM-NAME                              05770000
057800             ' 9999-DB2-ABEND'.                                   05780000
057900     DISPLAY PC-CURRENT-PROGRAM-NAME                              05790000
058000             ' ** ABEND           **'.                            05800000
058100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05810000
058200             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       05820000
058300     DISPLAY PC-CURRENT-PROGRAM-NAME                              05830000
058400             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       05840000
058500     DISPLAY PC-CURRENT-PROGRAM-NAME                              05850000
058600             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  05860000
058700                                                                  05870000
058800     DISPLAY PC-CURRENT-PROGRAM-NAME                              05880000
058900             ' ** SQLCODE         ** = ' SQLCODE.                 05890000
059000     MOVE SQLCODE TO PV-SQLCODE.                                  05900000
059100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05910000
059200             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          05920000
059300                                                                  05930000
059400     DISPLAY PC-CURRENT-PROGRAM-NAME                              05940000
059500             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            05950000
059600                                                                  05960000
059700                                                                  05970000
059800*----------------------------------------------------------------*05980000
059900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *05990000
060000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *06000000
060100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *06010000
060200* FORMAT.                                                        *06020000
060300*----------------------------------------------------------------*06030000
060400     COPY DPPD004.                                                06040000
060500                                                                  06050000
060600     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     06060000
060700     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           06070000
060800     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           06080000
060900     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         06090000
061000                                                                  06100000
061100*----------------------------------------------------------------*06110000
061200* CALL ABEND                                                     *06120000
061300*----------------------------------------------------------------*06130000
061400     MOVE +4013                  TO ABEND-CODE.                   06140000
061500     CALL 'ILBOABN0' USING ABEND-CODE.                            06150000
061600*                                                                 06160000
