000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.              TRKUP088.                               00020000
000300 AUTHOR.                  DENISE HAHN.                            00030000
000400 DATE-WRITTEN.            JUNE 2018.                              00040000
000500 DATE-COMPILED.                                                   00050000
000600                                                                  00060000
000700******************************************************************00070000
000800* THIS PROGRAM READ A FLAT FILE CREATED BY TRKUT088 OF EFC RC    *00080000
000900* SHIPMENTS THAT ARE NOT MARKED AS BEING DOWNLOADED, BUT THE     *00090000
000910* INBOUND TRIP SHOWS AS BEING ET (END TRIP) STATUS.              *00091000
000920* THE EFC SHIPMENTS FOR THESE TRIPS WILL BE UPDATED TO INDICATE  *00092000
000930* DOWNLOAD COMPLETE TO PREVENT ABENDS IN EFC SWEEPER PROGRAM     *00093000
000931* WSKCS303 & WSKCS301.                                           *00093100
000940******************************************************************00094000
000950 ENVIRONMENT DIVISION.                                            00095000
000960 CONFIGURATION SECTION.                                           00096000
000970                                                                  00097000
000980 INPUT-OUTPUT SECTION.                                            00098000
000990 FILE-CONTROL.                                                    00099000
001000                                                                  00100000
001100     SELECT INPUT-FILE                                            00110000
001200        ASSIGN TO INP01.                                          00120000
001300                                                                  00130000
001400 DATA DIVISION.                                                   00140000
001500 FILE SECTION.                                                    00150000
001600                                                                  00160000
001700 FD  INPUT-FILE                                                   00170000
001800     RECORDING MODE IS F                                          00180000
001900     LABEL RECORDS ARE STANDARD                                   00190000
002000     RECORD CONTAINS 100 CHARACTERS                               00200000
002100     DATA RECORD IS INPUT-RECORD.                                 00210000
002200                                                                  00220000
002300 01  INPUT-RECORD                PIC X(100).                      00230000
002400                                                                  00240000
002500                                                                  00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700                                                                  00270000
002800                                                                  00280000
002900 01  PROGRAM-VARIABLES.                                           00290000
003000                                                                  00300000
003100     05  PV-INPUT-COUNT              PIC  9(09)      VALUE ZERO.  00310000
003110     05  PV-INPUT-COUNT-NO-TMST      PIC  9(09) VALUE ZEROES.     00311000
003120     05  PV-INPUT-COUNT-TMST         PIC  9(09) VALUE ZEROES.     00312000
003200     05  PV-UPDATE-COUNT             PIC  9(09)      VALUE ZERO.  00320000
003400                                                                  00340000
003500     05  PV-DISP-COUNT               PIC  Z(09)      VALUE ZERO.  00350000
003510     05  PV-DISP-TRIP                PIC  Z(10).                  00351000
003520     05  PV-DISP-DEST                PIC  Z(04).                  00352000
003530     05  PV-DISP-SQLCODE             PIC  -999.                   00353000
004100                                                                  00410000
004200     05  PV-PARAGRAPH                PIC X(30).                   00420000
004300     05  PV-DB2-FUNCTION             PIC X(30).                   00430000
004400                                                                  00440000
004500 01  PROGRAM-SWITCHES.                                            00450000
004600     05  PS-END-OF-INPUT-SW          PIC X(01)       VALUE 'N'.   00460000
004700         88  PS-END-OF-INPUT                         VALUE 'Y'.   00470000
004800         88  PS-NOT-END-OF-INPUT                     VALUE 'N'.   00480000
004900     05  PS-ERROR-SW                 PIC X(01)       VALUE 'N'.   00490000
005000         88  PS-ERROR                                VALUE 'Y'.   00500000
005100         88  PS-ERROR-NO                             VALUE 'N'.   00510000
005200                                                                  00520000
005300                                                                  00530000
005400 01  ABEND-CODE                PIC S9(04)  VALUE +0 COMP SYNC.    00540000
005500     88 ABEND-4013                         VALUE +4013.           00550000
005600***************************************************************** 00560000
005700*    INPUT FILE LAYOUT.                                         * 00570000
005800***************************************************************** 00580000
005900     COPY TRRD072.                                                00590000
006000                                                                  00600000
006100***************************************************************** 00610000
006200*    SQL ABEND ROUTINE WORKING STORAGE                          * 00620000
006300***************************************************************** 00630000
006400     COPY DPWS004.                                                00640000
006500                                                                  00650000
006600                                                                  00660000
006700     EXEC SQL                                                     00670000
006800        INCLUDE WST00001                                          00680000
006900     END-EXEC.                                                    00690000
007000                                                                  00700000
007100     EXEC SQL                                                     00710000
007200        INCLUDE SQLCA                                             00720000
007300     END-EXEC.                                                    00730000
007400                                                                  00740000
007500                                                                  00750000
007600***********************************************************       00760000
007700 PROCEDURE DIVISION.                                              00770000
007800***********************************************************       00780000
007840 0000-PROGRAM-MAINLINE.                                           00784000
007900                                                                  00790000
008000     DISPLAY '************************************************'   00800000
008100     DISPLAY '** TRKUP088                                   **'   00810000
008200     DISPLAY '************************************************'   00820000
008300                                                                  00830000
008400     SET  PS-NOT-END-OF-INPUT                                     00840000
008500          PS-ERROR-NO            TO  TRUE.                        00850000
008600                                                                  00860000
008700     OPEN INPUT INPUT-FILE.                                       00870000
008800                                                                  00880000
008900     PERFORM 3000-READ-RECORD.                                    00890000
009000                                                                  00900000
009100     PERFORM 2000-PROCESS-INPUT                                   00910000
009200       UNTIL PS-END-OF-INPUT                                      00920000
009300          OR PS-ERROR.                                            00930000
009400                                                                  00940000
009500     DISPLAY '************************************************'   00950000
009600     DISPLAY '*                                              *'   00960000
009700     MOVE PV-INPUT-COUNT  TO PV-DISP-COUNT                        00970000
009800     DISPLAY '**   --INPUT COUNT:  ' PV-DISP-COUNT                00980000
009900                                                                  00990000
009910     DISPLAY '*                                              *'   00991000
009920     MOVE PV-INPUT-COUNT-NO-TMST TO  PV-DISP-COUNT                00992000
009930     DISPLAY '** NO TMST COUNT:    ' PV-DISP-COUNT                00993000
009940                                                                  00994000
009950     DISPLAY '*                                              *'   00995000
009960     MOVE PV-INPUT-COUNT-TMST    TO  PV-DISP-COUNT                00996000
009970     DISPLAY '** TMST COUNT:       ' PV-DISP-COUNT                00997000
009980                                                                  00998000
010000     MOVE PV-UPDATE-COUNT TO PV-DISP-COUNT                        01000000
010100     DISPLAY '**   --UPDATE COUNT: ' PV-DISP-COUNT                01010000
010200                                                                  01020000
010300     DISPLAY '*                                              *'   01030000
010400     DISPLAY '************************************************'   01040000
010500                                                                  01050000
010600     CLOSE INPUT-FILE.                                            01060000
010700                                                                  01070000
010800     STOP RUN.                                                    01080000
010900                                                                  01090000
011000 2000-PROCESS-INPUT.                                              01100000
011100                                                                  01110000
011200     IF  TR072-TMST-SW  =  'Y'                                    01120000
011300         PERFORM 3100-UPDATE-WO-TMST                              01130000
011400     ELSE                                                         01140000
011500         PERFORM 3200-UPDATE-WITH-TMST                            01150000
011700     END-IF.                                                      01170000
011800                                                                  01180000
011900     PERFORM 3000-READ-RECORD.                                    01190000
012000                                                                  01200000
012100                                                                  01210000
012200 3000-READ-RECORD.                                                01220000
012300                                                                  01230000
012400     READ INPUT-FILE                                              01240000
012500       INTO TR072-DATA-RECORD                                     01250000
012600         AT END SET   PS-END-OF-INPUT  TO  TRUE.                  01260000
012700                                                                  01270000
012800     IF  PS-END-OF-INPUT                                          01280000
012900         CONTINUE                                                 01290000
013000     ELSE                                                         01300000
013020         MOVE TR072-INTR-TRIP-ID TO PV-DISP-TRIP                  01302002
013060         MOVE TR072-DEST-LOC-NBR TO PV-DISP-DEST                  01306002
013600                                                                  01360000
013700         DISPLAY 'TRIP:'        PV-DISP-TRIP                      01370000
013800                 '  SHPMT:'     TR072-EXT-SHP-ID                  01380000
013900                 '  DWNLD:'     TR072-DWNLD-TMST                  01390000
014000                 '  DEST:'      PV-DISP-DEST                      01400000
014100                 '  CDE:'       TR072-DWNLD-CDE                   01410000
014200                 '  ST:'        TR072-TRIP-STATUS-CDE             01420000
014300                 ' '            TR072-STATUS-DTE                  01430000
014400                 ' '            TR072-STATUS-TME                  01440000
014500                 '  TMST:'      TR072-TMST-SW                     01450000
014510                                                                  01451000
014520         ADD +1 TO PV-INPUT-COUNT                                 01452000
014521         IF  TR072-TMST-SW  =  'Y'                                01452100
014522             ADD +1 TO PV-INPUT-COUNT-TMST                        01452200
014523         ELSE                                                     01452300
014524             ADD +1 TO PV-INPUT-COUNT-NO-TMST                     01452400
014525         END-IF                                                   01452500
014530     END-IF.                                                      01453000
014540                                                                  01454000
014550                                                                  01455000
014560 3100-UPDATE-WO-TMST.                                             01456000
014570                                                                  01457000
014580     MOVE TR072-INTR-TRIP-ID     TO  WST00001-INTR-TRIP-ID.       01458000
014581     MOVE TR072-EXT-SHP-ID       TO  WST00001-EXT-SHP-ID.         01458100
014590                                                                  01459000
014600     EXEC SQL                                                     01460000
014700         UPDATE WST_SHPMT_XREF_HDR                                01470000
014800         SET DWNLD_CDE        = 'C'                               01480000
014900         WHERE EXT_SHP_ID     = :WST00001-EXT-SHP-ID              01490000
014910           AND INTR_TRIP_ID   = :WST00001-INTR-TRIP-ID            01491000
015000     END-EXEC.                                                    01500000
015100                                                                  01510000
015200     EVALUATE TRUE                                                01520000
015300         WHEN SQLCODE = +0                                        01530000
015400             ADD +1 TO PV-UPDATE-COUNT                            01540000
015500         WHEN SQLCODE = +100                                      01550000
015600             MOVE SQLCODE   TO  PV-DISP-SQLCODE                   01560000
015810             DISPLAY 'TRIP:'        PV-DISP-TRIP                  01581000
015820                     '  SHPMT:'     TR072-EXT-SHP-ID              01582000
015830                     '  DWNLD:'     TR072-DWNLD-TMST              01583000
015840                     '  DEST:'      PV-DISP-DEST                  01584000
015850                     '  CDE:'       TR072-DWNLD-CDE               01585000
015860                     '  ST:'        TR072-TRIP-STATUS-CDE         01586000
015870                     ' '            TR072-STATUS-DTE              01587000
015880                     ' '            TR072-STATUS-TME              01588000
015890                     '  TMST:'      TR072-TMST-SW                 01589000
015891                     '  SHIPMENT NOT UPDATED'                     01589100
015892                     '  SQL:'        PV-DISP-SQLCODE              01589200
015893                                                                  01589300
015900         WHEN OTHER                                               01590000
016000             MOVE '3100-UPDATE-WO-TMST'                           01600001
016100                                    TO PV-PARAGRAPH               01610000
016200             MOVE 'UPDATE          '                              01620000
016300                                    TO PV-DB2-FUNCTION            01630000
016301             MOVE SQLCODE       TO  PV-DISP-SQLCODE               01630100
016310             DISPLAY 'TRIP:'        PV-DISP-TRIP                  01631000
016320                     '  SHPMT:'     TR072-EXT-SHP-ID              01632000
016330                     '  DWNLD:'     TR072-DWNLD-TMST              01633000
016340                     '  DEST:'      PV-DISP-DEST                  01634000
016350                     '  CDE:'       TR072-DWNLD-CDE               01635000
016360                     '  ST:'        TR072-TRIP-STATUS-CDE         01636000
016370                     ' '            TR072-STATUS-DTE              01637000
016380                     ' '            TR072-STATUS-TME              01638000
016390                     '  TMST:'      TR072-TMST-SW                 01639000
016391                     '  SHIPMENT NOT UPDATED'                     01639100
016392                     '  SQL:'        PV-DISP-SQLCODE              01639200
016393                                                                  01639300
016400             PERFORM 9900-DB2-ABEND                               01640000
016500     END-EVALUATE.                                                01650000
016600                                                                  01660000
016610 3200-UPDATE-WITH-TMST.                                           01661001
016620                                                                  01662001
016630     MOVE TR072-INTR-TRIP-ID     TO  WST00001-INTR-TRIP-ID.       01663001
016640     MOVE TR072-EXT-SHP-ID       TO  WST00001-EXT-SHP-ID.         01664001
016650                                                                  01665001
016660     EXEC SQL                                                     01666001
016670         UPDATE WST_SHPMT_XREF_HDR                                01667001
016680         SET DWNLD_CDE        = 'C'                               01668001
016681           , DWNLD_TMST       =  CURRENT TIMESTAMP                01668101
016690         WHERE EXT_SHP_ID     = :WST00001-EXT-SHP-ID              01669001
016691           AND INTR_TRIP_ID   = :WST00001-INTR-TRIP-ID            01669101
016692     END-EXEC.                                                    01669201
016693                                                                  01669301
016694     EVALUATE TRUE                                                01669401
016695         WHEN SQLCODE = +0                                        01669501
016696             ADD +1 TO PV-UPDATE-COUNT                            01669601
016697         WHEN SQLCODE = +100                                      01669701
016698             MOVE SQLCODE   TO  PV-DISP-SQLCODE                   01669801
016699             DISPLAY 'TRIP:'        PV-DISP-TRIP                  01669901
016700                     '  SHPMT:'     TR072-EXT-SHP-ID              01670001
016701                     '  DWNLD:'     TR072-DWNLD-TMST              01670101
016702                     '  DEST:'      PV-DISP-DEST                  01670201
016703                     '  CDE:'       TR072-DWNLD-CDE               01670301
016704                     '  ST:'        TR072-TRIP-STATUS-CDE         01670401
016705                     ' '            TR072-STATUS-DTE              01670501
016706                     ' '            TR072-STATUS-TME              01670601
016707                     '  TMST:'      TR072-TMST-SW                 01670701
016708                     '  SHIPMENT NOT UPDATED'                     01670801
016709                     '  SQL:'        PV-DISP-SQLCODE              01670901
016710                                                                  01671001
016711         WHEN OTHER                                               01671101
016712             MOVE '3200-UPDATE-WITH-TMST'                         01671201
016713                                    TO PV-PARAGRAPH               01671301
016714             MOVE 'UPDATE          '                              01671401
016715                                    TO PV-DB2-FUNCTION            01671501
016716             MOVE SQLCODE       TO  PV-DISP-SQLCODE               01671601
016717             DISPLAY 'TRIP:'        PV-DISP-TRIP                  01671701
016718                     '  SHPMT:'     TR072-EXT-SHP-ID              01671801
016719                     '  DWNLD:'     TR072-DWNLD-TMST              01671901
016720                     '  DEST:'      PV-DISP-DEST                  01672001
016721                     '  CDE:'       TR072-DWNLD-CDE               01672101
016722                     '  ST:'        TR072-TRIP-STATUS-CDE         01672201
016723                     ' '            TR072-STATUS-DTE              01672301
016724                     ' '            TR072-STATUS-TME              01672401
016725                     '  TMST:'      TR072-TMST-SW                 01672501
016726                     '  SHIPMENT NOT UPDATED'                     01672601
016727                     '  SQL:'        PV-DISP-SQLCODE              01672701
016728                                                                  01672801
016729             PERFORM 9900-DB2-ABEND                               01672901
016730     END-EVALUATE.                                                01673001
016731                                                                  01673101
016740******************************************************************01674000
016800 9900-DB2-ABEND.                                                  01680000
016900                                                                  01690000
017000     DISPLAY '** ABEND **'.                                       01700000
017100     DISPLAY '** PROGRAM   ** = TRKUP088'                         01710000
017200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH.                   01720000
017300     DISPLAY '** OPERATION ** = ' PV-DB2-FUNCTION.                01730000
017400                                                                  01740000
017500* ROUTINE TO DISPLAY ABEND IN READABLE FORMAT                     01750000
017600     COPY DPPD004.                                                01760000
017700                                                                  01770000
017800     EXEC SQL                                                     01780000
017900         ROLLBACK                                                 01790000
018000     END-EXEC.                                                    01800000
018100                                                                  01810000
018200     SET ABEND-4013           TO TRUE.                            01820000
018300     CALL 'ILBOABN0' USING ABEND-CODE.                            01830000
018400                                                                  01840000
018500                                                                  01850000
