000200******************************************************************00010001
000300 IDENTIFICATION DIVISION.                                         00020001
000400******************************************************************00030001
000600 PROGRAM-ID.    PCKUP006.                                         00040001
000700 AUTHOR.        DEANNA BRANTNER.                                  00050001
000800 INSTALLATION.  KOHLS.                                            00060001
000900 DATE-WRITTEN   FEBRUARY, 2002.                                   00070001
001000 DATE-COMPILED.                                                   00080001
001200******************************************************************00090001
001300*  THIS PROGRAM DELETES ROWS FROM THE PCT_RCVR_LNE_DTL TABLE      00100001
001400*  USING INPUT CREATED FROM PROGRAM PCKUT020.                     00110001
001500******************************************************************00120001
001600                                                                  00130001
001700******************************************************************00140001
001800 ENVIRONMENT DIVISION.                                            00150001
002100 CONFIGURATION SECTION.                                           00160001
002300 SOURCE-COMPUTER.        IBM-3090.                                00170001
002400 OBJECT-COMPUTER.        IBM-3090.                                00180001
002410******************************************************************00190001
002600 INPUT-OUTPUT SECTION.                                            00200001
002800 FILE-CONTROL.                                                    00210001
003000                                                                  00220001
003100     SELECT INPUT-FILE                                            00230001
003200         ASSIGN TO INP01.                                         00240001
003000                                                                  00241001
003100     SELECT OUTPUT-FILE                                           00242001
003200         ASSIGN TO OUT01.                                         00243001
003300******************************************************************00250001
003400 DATA DIVISION.                                                   00260001
003700 FILE SECTION.                                                    00270001
003710******************************************************************00280001
003900                                                                  00290001
004000 FD  INPUT-FILE                                                   00300001
004100     RECORDING MODE IS F                                          00310001
004200     LABEL RECORDS ARE STANDARD                                   00320001
004300     BLOCK CONTAINS 0 RECORDS.                                    00330001
004400                                                                  00340001
004500 01  INPUT-RECORD        PIC  X(025).                             00350001
003900                                                                  00351001
004000 FD  OUTPUT-FILE                                                  00352001
004100     RECORDING MODE IS F                                          00353001
004200     LABEL RECORDS ARE STANDARD                                   00354001
004300     BLOCK CONTAINS 0 RECORDS.                                    00355001
004400                                                                  00356001
004500 01  OUTPUT-RECORD        PIC  X(080).                            00357011
004600                                                                  00360001
004800******************************************************************00370001
004900 WORKING-STORAGE SECTION.                                         00380001
005000******************************************************************00390001
004900*INPUT FILE LAYOUT.                                               00400001
005000******************************************************************00400101
006500     COPY PCRD021.                                                00401001
005100*                                                                 00402001
006200************************************                              00410001
006300*  DB2 FORMATTED MESSAGE AREA                                     00420001
006400************************************                              00430001
006500     COPY DPWS004.                                                00440001
006600                                                                  00450001
006900************************************                              00460001
007000*  COMMUNICATIONS AREA FOR DB2                                    00470001
007100************************************                              00480001
007200     EXEC SQL                                                     00490001
007300          INCLUDE SQLCA                                           00500001
007400     END-EXEC.                                                    00510001
007500                                                                  00520001
007600******************************************************************00530001
007700*  COBOL DECLARATION AND DCLGEN MEMBER FOR PCT_RCVR_LNE_DTL       00540001
007800*  TABLE                                                          00550001
007900******************************************************************00560001
008000     EXEC SQL                                                     00570001
008100          INCLUDE PCT00007                                        00580001
008200     END-EXEC.                                                    00590001
008210*                                                                 00600001
009100 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00610001
009200                                                   COMP SYNC.     00620001
009300                                                                  00630001
009400 01  PS-PROGRAM-SWITCHES.                                         00640001
009500     05  PS-END-OF-FILE-SW           PIC  X(01)    VALUE 'N'.     00650001
009600         88  PS-END-OF-FILE                        VALUE 'Y'.     00660001
009700         88  PS-NOT-END-OF-FILE                    VALUE 'N'.     00670001
009500     05  PS-END-OF-CSR-SW            PIC  X(01)    VALUE 'N'.     00671003
009600         88  PS-END-OF-CSR                         VALUE 'Y'.     00672003
009700         88  PS-NOT-END-OF-CSR                     VALUE 'N'.     00673003
009900                                                                  00680001
010000 01  PC-PROGRAM-CONSTANTS.                                        00690001
010100     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     00700001
010200                                                   COMP SYNC.     00710001
010300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00720001
010400         'PCKUP006'.                                              00730001
010500     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 020.     00740001
010600                                                                  00750001
010700 01  PV-PROGRAM-VARIABLES.                                        00760001
010900     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  00780001
011000     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  00790001
011100     05  PV-OPEN-COUNTER             PIC S9(04)    VALUE ZERO     00800001
011200                                                   COMP SYNC.     00810001
011300     05  PV-CLOSE-COUNTER            PIC S9(04)    VALUE ZERO     00820001
011400                                                   COMP SYNC.     00830001
011500     05  PV-FETCH-COUNTER            PIC S9(09)    VALUE ZERO     00840012
011600                                                   COMP SYNC.     00850001
011700     05  PV-DELETE-COUNT             PIC S9(09)    VALUE ZERO     00860001
011800                                                   COMP SYNC.     00870001
011700     05  PV-WRITE-COUNT              PIC S9(09)    VALUE ZERO     00871001
011800                                                   COMP SYNC.     00872001
011900     05  PV-NOT-FOUND-COUNT          PIC S9(09)    VALUE ZERO     00880001
012000                                                   COMP SYNC.     00890001
012100     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             00900001
012200     05  PV-COMMIT-COUNT             PIC S9(09)    VALUE +0       00910001
012300                                                   COMP SYNC.     00920001
012400     05  PV-COMMIT-COUNTER           PIC 9(03)     VALUE ZERO.    00930001
012500                                                                  00940001
012600     05  PV-DB2-COUNT                PIC S9(09)    VALUE ZERO     00950001
012700                                                   COMP-3.        00960001
020500     EXEC SQL                                                     00961003
020600         DECLARE PO-RCVR-CSR CURSOR FOR                           00962003
020600           SELECT PO_NBR                                          00962103
020600                 ,RCVR_SEQ_NBR                                    00963003
020600                 ,PO_LNE_NBR                                      00964003
020600                 ,ACTN_CDE                                        00965003
020600                 ,WRKD_UNT_TMST                                   00966003
020600                 ,BUS_DTE                                         00967003
020600                 ,OPER_UNT_ID                                     00968003
020600                 ,SHFT_NBR                                        00969003
020600                 ,UNT_QTY                                         00969103
020600                 ,CART_QTY                                        00969203
020600                 ,PRCG_AREA_CDE                                   00969303
020600                 ,EXTD_RTL_AMT                                    00969403
020700             FROM  PCT_RCVR_LNE_DTL                               00969503
020800             WHERE PO_NBR       = :PC021-PO-NBR                   00969603
020800               AND RCVR_SEQ_NBR = :PC021-RCVR-NBR                 00969703
020500     END-EXEC.                                                    00969803
013500                                                                  00970001
013600******************************************************************00980001
013700 PROCEDURE DIVISION.                                              00990001
013705     DISPLAY '**** START OF PCKUP006 ****'.                       01000001
013800******************************************************************01010001
013900                                                                  01020001
014100******************************************************************01030001
014110 0000-PROGRAM-MAINLINE.                                           01040001
014400******************************************************************01050001
014600     PERFORM 1000-INITIALIZE.                                     01060001
014700     IF PS-NOT-END-OF-FILE                                        01070001
014800         PERFORM 2000-PROCESS-INPUT-RECS                          01080001
014900            UNTIL PS-END-OF-FILE                                  01090001
015000     END-IF.                                                      01100001
015100     PERFORM 9000-EOJ-ROUTINE.                                    01110001
015200                                                                  01120001
015300     STOP RUN.                                                    01130001
015400                                                                  01140001
015600******************************************************************01150001
015610 1000-INITIALIZE.                                                 01160001
016000******************************************************************01170001
016200     OPEN INPUT  INPUT-FILE                                       01180003
016200         OUTPUT OUTPUT-FILE.                                      01181003
016300     PERFORM 3000-READ-INPUT-FILE.                                01190001
016400                                                                  01200001
016800******************************************************************01220001
016810 2000-PROCESS-INPUT-RECS.                                         01230001
016820******************************************************************01240001
017400     PERFORM 4000-OPEN-CURSOR                                     01250004
017400     PERFORM 4100-FETCH-CURSOR UNTIL PS-END-OF-CSR.               01250104
017400     PERFORM 4200-CLOSE-CURSOR.                                   01250204
017400     SET PS-NOT-END-OF-CSR TO TRUE.                               01250309
017500     ADD +1 TO PV-COMMIT-COUNTER.                                 01260001
017600                                                                  01270001
017700     IF PV-COMMIT-COUNTER > PC-COMMIT-HOLD                        01280001
017800         EXEC SQL                                                 01290001
017900            COMMIT                                                01300001
018000         END-EXEC                                                 01310001
018100                                                                  01320001
018200         IF SQLCODE NOT = +0                                      01330001
018300             DISPLAY '### COMMIT FAILED ! ###'                    01340001
018400             PERFORM 9999-SQL-ABEND                               01350001
018500         END-IF                                                   01360001
018600                                                                  01370001
018700         ADD +1  TO PV-COMMIT-COUNT                               01380001
018800         MOVE +0 TO PV-COMMIT-COUNTER                             01390001
018900     END-IF.                                                      01400001
019000                                                                  01410001
019100     PERFORM 3000-READ-INPUT-FILE.                                01420001
019200                                                                  01430001
019210******************************************************************01450001
019300 3000-READ-INPUT-FILE.                                            01460001
019400******************************************************************01470001
019500      READ INPUT-FILE INTO PC021-EXTRACT-RECORD                   01480001
019700          AT END SET PS-END-OF-FILE TO TRUE.                      01490001
019800                                                                  01500001
026200******************************************************************01510003
026300*  OPEN THE CURSOR.                                               01511003
026400******************************************************************01512003
026100 4000-OPEN-CURSOR.                                                01513003
026500                                                                  01514003
026600      EXEC SQL                                                    01515003
026700           OPEN PO-RCVR-CSR                                       01516003
026800      END-EXEC.                                                   01517003
026900                                                                  01518003
027000      EVALUATE TRUE                                               01519003
028200          WHEN SQLCODE = ZERO                                     01519103
027100          WHEN SQLCODE = -904                                     01519203
027200          WHEN SQLCODE = -911                                     01519303
027300              CONTINUE                                            01519403
027400          WHEN SQLWARN0 NOT = SPACES                              01519503
027500          WHEN SQLCODE < ZERO                                     01519603
027600          WHEN SQLCODE > ZERO                                     01519703
027700              MOVE '4000-OPEN-CURSOR    '                         01519803
027800                              TO PV-PARAGRAPH-NAME                01519903
027900              MOVE 'OPEN THE PO-RCVR-CSR '                        01520003
028000                              TO PV-DB2-OPERATION-ATTEMPTED       01520103
022300             PERFORM 9999-SQL-ABEND                               01520203
028400      END-EVALUATE.                                               01520303
028500                                                                  01520403
019900******************************************************************01521001
020000 4100-FETCH-CURSOR.                                               01530004
020100******************************************************************01540001
020500     EXEC SQL                                                     01550001
020600         FETCH  PO-RCVR-CSR                                       01560003
020600         INTO   :PCT00007-PO-NBR                                  01569304
020600               ,:PCT00007-RCVR-SEQ-NBR                            01569404
020600               ,:PCT00007-PO-LNE-NBR                              01569504
020600               ,:PCT00007-ACTN-CDE                                01569604
020600               ,:PCT00007-WRKD-UNT-TMST                           01569704
020600               ,:PCT00007-BUS-DTE                                 01569804
020600               ,:PCT00007-OPER-UNT-ID                             01569904
020600               ,:PCT00007-SHFT-NBR                                01570004
020600               ,:PCT00007-UNT-QTY                                 01570104
020600               ,:PCT00007-CART-QTY                                01570204
020600               ,:PCT00007-PRCG-AREA-CDE                           01570304
020600               ,:PCT00007-EXTD-RTL-AMT                            01570404
020900     END-EXEC.                                                    01590001
021000                                                                  01600001
021100     EVALUATE TRUE                                                01610001
021200         WHEN SQLCODE = 0                                         01620001
021500             ADD +1           TO PV-FETCH-COUNTER                 01621003
021300             PERFORM 4500-WRITE-OUTPUT-RECORD                     01630001
017400             PERFORM 5000-DELETE-INPUT-RECS                       01631020
021400         WHEN SQLCODE = +100                                      01640001
021500             SET  PS-END-OF-CSR  TO TRUE                          01650006
021600         WHEN SQLCODE < 0                                         01660001
021700         WHEN SQLCODE > 0                                         01670001
021800         WHEN SQLWARN0 = 'W'                                      01680001
021900             MOVE '4000-RETRIEVE-INFO '                           01690001
022000                         TO PV-PARAGRAPH-NAME                     01700001
022100             MOVE 'RETRIEVE PCT_RCVR_LNE_DTL '                    01710001
022200                         TO PV-DB2-OPERATION-ATTEMPTED            01720001
022300             PERFORM 9999-SQL-ABEND                               01730001
022400     END-EVALUATE.                                                01740001
022600                                                                  01750001
026200******************************************************************01750103
026300*  CLOSE THE CURSOR.                                              01750203
026400******************************************************************01750303
026100 4200-CLOSE-CURSOR.                                               01750403
026500                                                                  01750503
026600      EXEC SQL                                                    01750603
026700          CLOSE PO-RCVR-CSR                                       01750707
026800      END-EXEC.                                                   01750803
026900                                                                  01750903
027000      EVALUATE TRUE                                               01751003
028200          WHEN SQLCODE = ZERO                                     01751103
027100          WHEN SQLCODE = -904                                     01751203
027200          WHEN SQLCODE = -911                                     01751303
027300              CONTINUE                                            01751403
027400          WHEN SQLWARN0 NOT = SPACES                              01751503
027500          WHEN SQLCODE < ZERO                                     01751603
027600          WHEN SQLCODE > ZERO                                     01751703
027700              MOVE '4200-CLOSE-CURSOR    '                        01751803
027800                              TO PV-PARAGRAPH-NAME                01751903
027900              MOVE 'CLOSE THE PO-RCVR-CSR '                       01752003
028000                              TO PV-DB2-OPERATION-ATTEMPTED       01752103
022300             PERFORM 9999-SQL-ABEND                               01752203
028400      END-EVALUATE.                                               01752303
028500                                                                  01752403
033900******************************************************************01752501
034000*  WRITE THE OUTPUT RECORD                                        01752601
034100******************************************************************01753001
033800 4500-WRITE-OUTPUT-RECORD.                                        01754001
034200                                                                  01755001
035300     WRITE OUTPUT-RECORD FROM DCLPCT00007.                        01759201
035500                                                                  01759301
035600     ADD +1 TO PV-WRITE-COUNT.                                    01759401
035700                                                                  01759501
019900******************************************************************01760001
020000 5000-DELETE-INPUT-RECS.                                          01761001
020100******************************************************************01762001
020500     EXEC SQL                                                     01763001
020600         DELETE                                                   01764001
020700             FROM  PCT_RCVR_LNE_DTL                               01765001
020800             WHERE PO_NBR       = :PC021-PO-NBR                   01766001
020800               AND RCVR_SEQ_NBR = :PC021-RCVR-NBR                 01767001
020900     END-EXEC.                                                    01768001
021000                                                                  01769001
021100     EVALUATE TRUE                                                01769101
021200         WHEN SQLCODE = 0                                         01769201
021300*            ADD +1           TO PV-DELETE-COUNT                  01769318
021300             ADD SQLERRD(3)   TO PV-DELETE-COUNT                  01769418
021400         WHEN SQLCODE = +100                                      01769518
021500             CONTINUE                                             01769618
021600         WHEN SQLCODE < 0                                         01769718
021700         WHEN SQLCODE > 0                                         01769818
021800         WHEN SQLWARN0 = 'W'                                      01769918
021900             MOVE '5000-DELETE-INPUT-RECS'                        01770018
022000                         TO PV-PARAGRAPH-NAME                     01770118
022100             MOVE 'DELETE OF PCT_RCVR_LNE_DTL '                   01770218
022200                         TO PV-DB2-OPERATION-ATTEMPTED            01770318
022300             PERFORM 9999-SQL-ABEND                               01770418
022400     END-EVALUATE.                                                01770518
022600                                                                  01770618
022610******************************************************************01771001
022700 9000-EOJ-ROUTINE.                                                01780001
022800******************************************************************01790001
023100     CLOSE INPUT-FILE                                             01800003
023100          OUTPUT-FILE.                                            01801003
023200                                                                  01810001
017800     EXEC SQL                                                     01811001
017900        COMMIT                                                    01812001
018000     END-EXEC.                                                    01813001
018100                                                                  01814001
018200     IF SQLCODE NOT = +0                                          01815001
018300         DISPLAY '### COMMIT FAILED ! ###'                        01816001
018400         PERFORM 9999-SQL-ABEND                                   01817001
018500     END-IF.                                                      01818001
018600                                                                  01819001
018700     ADD +1  TO PV-COMMIT-COUNT.                                  01819101
018800     MOVE +0 TO PV-COMMIT-COUNTER.                                01819201
023300     MOVE PV-FETCH-COUNTER  TO PV-DISPLAY-COUNT.                  01820003
023400     DISPLAY 'TOTAL INPUT RECORDS FETCHED  ' PV-DISPLAY-COUNT.    01830003
023300     MOVE PV-DELETE-COUNT  TO PV-DISPLAY-COUNT.                   01831003
023400     DISPLAY 'TOTAL INPUT RECORDS DELETED  ' PV-DISPLAY-COUNT.    01832003
023500     MOVE PV-NOT-FOUND-COUNT TO PV-DISPLAY-COUNT.                 01840001
023600     DISPLAY 'TOTAL INPUT RECORDS NOT FOUND' PV-DISPLAY-COUNT.    01850001
023700     MOVE PV-COMMIT-COUNT  TO PV-DISPLAY-COUNT.                   01860001
023800     DISPLAY 'TOTAL COMMITS TAKEN          ' PV-DISPLAY-COUNT.    01870001
023900                                                                  01880001
024000******************************************************************01900001
024100 9999-SQL-ABEND.                                                  01910001
024200******************************************************************01920001
024600     DISPLAY '9999-SQL-ABEND'.                                    01930001
024700     DISPLAY '** ABEND     **'.                                   01940001
024800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        01950001
024900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              01960001
025000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     01970001
025100                                                                  01980001
025200******************************************************************01990001
025300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    02000001
025400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         02010001
025500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     02020001
025600* FORMAT.                                                         02030001
025700******************************************************************02040001
025800     COPY DPPD004.                                                02050001
025900                                                                  02060001
026000     MOVE +4013                  TO ABEND-CODE.                   02070001
026100     CALL 'ILBOABN0' USING ABEND-CODE.                            02080001
