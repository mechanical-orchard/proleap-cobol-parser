000010 IDENTIFICATION DIVISION.                                         00010000
000020 PROGRAM-ID.    POKCS115.                                         00020000
000030 AUTHOR.        DIANE DARR.                                       00030000
000040 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000050 DATE-WRITTEN.  08/14/2000.                                       00050000
000060 DATE-COMPILED.                                                   00060000
000070                                                                  00070000
000080***************************************************************** 00080000
000090                                                                  00090000
000100*---------------------------------------------------------------* 00100000
000110*    TRANID      - W115                                         * 00110000
000120*    TYPE        - CICS ARCHITECTURE INQUIRY - DB2              * 00120000
000130*    DESCRIPTION - INQUIRY ON PURCHASE ORDER VENDOR DISCOUNT    * 00130000
000140*                  INFORMATION                                  * 00140000
000150*    MAPSET      - POKM115                                      * 00150000
000160*                                                               * 00160000
000170*    THIS PROGRAM ALLOWS THE USER TO INQUIRE ON VENDOR          * 00170000
000180*    DISOUNT PERCENTS/DOLLARS AND PAYMENT TERMS.                * 00180000
000190*                                                               * 00190000
000430*---------------------------------------------------------------* 00200000
C98147*  11-14-14   LINDA FRIESS                 CHG0098147             00210021
C98147*  CHANGE: EXPANDED PO NUMBER TO 8 DIGITS IN MAP AND COMMAREA     00220021
C98147*---------------------------------------------------------------* 00230021
CICS  *  CHANGED 11/17/2022    BY BARB SCHULTZ    WR: CHG0278485        00240024
CICS  *                                                                 00241022
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL     00242022
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.      00243022
CICS  *---------------------------------------------------------------* 00243122
001310                                                                  00244022
001310                                                                  00245022
001310                                                                  00246022
001320 ENVIRONMENT DIVISION.                                            00250000
001330 DATA DIVISION.                                                   00260000
001340/                                                                 00270000
001350 WORKING-STORAGE SECTION.                                         00280000
001360                                                                  00290000
001670 01 DK-DB2-KEYS.                                                  00300000
001680     05  DK-DEPT-NBR                  PIC X(03)  VALUE SPACES.    00310000
001710     05  DK-PO-TYP-CDE                PIC X(02)  VALUE SPACES.    00320000
001720     05  DK-STATUS-CDE                PIC X(02)  VALUE SPACES.    00330000
001730     05  DK-PO-NBR                    PIC S9(09) VALUE +0         00340000
001740                                                 COMP.            00350000
001770     05  DK-ENT-NAME-DESC             PIC X(30)  VALUE SPACES.    00360000
001780     05  DK-AGRMT-TYP-ID              PIC X(01)  VALUE SPACES.    00370000
001810     05  DK-PAYT-TERM-ID              PIC S9(04) VALUE +0         00380000
001820                                                 COMP.            00390000
001710     05  DK-TYP-CDE                   PIC S9(04) VALUE +0         00400010
001820                                                 COMP.            00410010
001870                                                                  00420000
001880 01 PC-PROGRAM-CONSTANTS.                                         00430000
001900     05  PC-CURRENT-PROGRAM-NAME      PIC X(08)  VALUE 'POKCS115'.00440000
001910     05  PC-CURRENT-MAP-NAME          PIC X(08)  VALUE 'PO115A  '.00450000
001920     05  PC-CURRENT-MAPSET-NAME       PIC X(08)  VALUE 'POKM115 '.00460000
002010     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +3        00470000
002020                                                 COMP.            00480000
003840 01 PV-PROGRAM-VARIABLES.                                         00490000
003870     05  PV-CICS-RESPONSE             PIC S9(04) VALUE +0         00500000
003880                                                 COMP SYNC.       00510000
003890     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         00520000
003900                                                 COMP SYNC.       00530000
004720     05  PV-EDIT-PAYT-TERM-ID         PIC ZZ9.                    00540000
004910/                                                                 00550000
005010*----------------------------------------------------------------*00560000
005020*    PAYMENT TERMS                                               *00570000
005030*----------------------------------------------------------------*00580000
005040                                                                  00590000
005050     COPY POWS020.                                                00600000
005060/                                                                 00610000
005240*----------------------------------------------------------------*00620000
005250*    MAP LAYOUT                                                  *00630000
005260*----------------------------------------------------------------*00640000
005270                                                                  00650000
005280     COPY POKM115.                                                00660000
005290                                                                  00670000
005300/                                                                 00680000
005380*----------------------------------------------------------------*00690000
005390*    FUNCTION KEYS COPYBOOK                                      *00700000
005400*----------------------------------------------------------------*00710000
005410                                                                  00720000
005420     COPY DPWS016.                                                00730000
005430                                                                  00740000
005440/                                                                 00750000
005650*----------------------------------------------------------------*00760000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.           *00770022
005680*----------------------------------------------------------------*00790000
005690     COPY DPWS030.                                                00800000
CICS       COPY DPWS930.                                                00801022
005700                                                                  00810000
005440/                                                                 00820017
005760*----------------------------------------------------------------*00830000
005770*    STANDARD COMMAREA.                                          *00840000
005780*----------------------------------------------------------------*00850000
005790                                                                  00860000
005800     COPY DPWS020.                                                00870000
005810     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00880000
005820                                                                  00890000
005830*----------------------------------------------------------------*00900000
005840*    INTER-APPLICATION COMMAREA.                                 *00910000
005850*----------------------------------------------------------------*00920000
005860                                                                  00930000
005870         10  INTER-APPL-COMM-AREA PIC X(200).                     00940000
005880     COPY POWS017.                                                00950004
005930*----------------------------------------------------------------*00960000
005940*    SPECIFIC COMMMAREA FOR POKCS115.                            *00970000
005950*----------------------------------------------------------------*00980000
005960         10  ASC-SPECIFIC-COMMAREA.                               00990000
006350             15  ASC-KEY-FIELDS.                                  01000000
006360                 20  ASC-KEY-PO-NBR         PIC S9(09) COMP.      01010000
006370                 20  ASC-KEY-ENT-ID         PIC S9(09) COMP.      01020000
006380                 20  ASC-KEY-DEPT-NBR       PIC X(03).            01030000
006390                 20  ASC-KEY-ENT-NAME-DESC  PIC X(30).            01040000
006400                 20  ASC-KEY-STATUS-CDE     PIC X(02).            01050000
006410             15  ASC-SCREEN-FIELDS.                               01060000
C98147                 20  ASC-PO-NBR             PIC X(08).            01070021
006430                 20  ASC-PO-NBR-N REDEFINES ASC-PO-NBR            01080000
C98147                                            PIC 9(08).            01090021
006470                 20  ASC-PO-TYP-CDE         PIC X(02).            01100000
006510                 20  ASC-LINE-ITEM-PCT      PIC X(03).            01110000
006520                 20  ASC-LINE-ITEM-PCT-N REDEFINES                01120000
006530                     ASC-LINE-ITEM-PCT      PIC 9(03).            01130000
006790                 20  ASC-PAYT-TERM-ID       PIC X(03).            01140000
006800                 20  ASC-PAYT-TERM-ID-N REDEFINES                 01150000
006810                     ASC-PAYT-TERM-ID       PIC 9(03).            01160000
006820                 20  ASC-PAYT-TERM-ID-DESC  PIC X(28).            01170000
006840                 20  ASC-ADSC-DOL-AMT-N     PIC 9(06)V99.         01180000
006850                 20  ASC-VEX-PAY-DAYS-QTY   PIC X(03).            01190000
006860                 20  ASC-VEX-PAY-DAYS-QTY-N REDEFINES             01200000
006870                     ASC-VEX-PAY-DAYS-QTY   PIC 9(03).            01210000
006850                 20  ASC-AEX-PAY-DAYS-QTY   PIC X(03).            01220000
006860                 20  ASC-AEX-PAY-DAYS-QTY-N REDEFINES             01230000
006870                     ASC-AEX-PAY-DAYS-QTY   PIC 9(03).            01240000
006890                 20  ASC-VDSC-PCT-N         PIC 99V99.            01250000
006890                 20  ASC-ADSC-PCT-N         PIC 99V99.            01260000
006890                 20  ASC-MOS-DSC-PCT-N      PIC 99V99.            01270011
006890                 20  ASC-TRADE-DSC-PCT-N    PIC 99V99.            01280011
006970                 20  ASC-WARNING-MSG-NBR    PIC S9(05) COMP-3.    01290000
006980                 20  ASC-WARNING-MSG        PIC X(79).            01300000
007300/                                                                 01310000
007310*----------------------------------------------------------------*01320000
007320*    ABEND PROCESSING COPYBOOK.                                  *01330000
007330*----------------------------------------------------------------*01340000
007340                                                                  01350000
00735      COPY DPWS013.                                                01360000
007360/                                                                 01370000
007380*----------------------------------------------------------------*01380000
007390*    SYSTEM MESSAGE COPYBOOK                                     *01390000
007400*----------------------------------------------------------------*01400000
007410                                                                  01410000
007420     COPY DPRD507I.                                               01420000
007430/                                                                 01430000
007450*----------------------------------------------------------------*01440000
007460*    DB2 SQL COMMUNICATION AREA                                   01450000
007470*----------------------------------------------------------------*01460000
007480     EXEC SQL                                                     01470000
007490          INCLUDE SQLCA                                           01480000
007500     END-EXEC.                                                    01490000
007510                                                                  01500000
007520/                                                                 01510000
009480*----------------------------------------------------------------*01520000
009490*    DB2 DCLGEN FOR PAYMENT TERMS TABLE                           01530000
009500*----------------------------------------------------------------*01540000
009510     EXEC SQL                                                     01550000
009520          INCLUDE TPAYTRM                                         01560000
009530     END-EXEC.                                                    01570000
009540                                                                  01580000
009550/                                                                 01590000
009800*----------------------------------------------------------------*01600000
009810*    DB2 DCLGEN FOR PO AGREEMENT TABLE                            01610000
009820*----------------------------------------------------------------*01620000
009830     EXEC SQL                                                     01630000
009840          INCLUDE TPOAGMT                                         01640000
009850     END-EXEC.                                                    01650000
009860                                                                  01660000
009870/                                                                 01670000
011570 LINKAGE SECTION.                                                 01680000
011580                                                                  01690000
011590 01  DFHCOMMAREA.                                                 01700000
011600     05  FILLER                       OCCURS  1 TO 4072 TIMES     01710000
011610                                      DEPENDING ON EIBCALEN.      01720000
011620         10  FILLER                   PIC X.                      01730000
011630                                                                  01740000
011650 PROCEDURE DIVISION.                                              01750000
011660                                                                  01760000
011670*----------------------------------------------------------------*01770000
011680*    THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. *01780000
011690*    THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  *01790000
011700*    MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            *01800000
011710*                                                                *01810000
011720*    THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  *01820000
011730*    LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       *01830000
011740*----------------------------------------------------------------*01840000
011750 0000-MAIN-MODULE.                                                01850000
011760                                                                  01860000
011770     INITIALIZE DP030-CICS-API-FIELDS.                            01870000
011780     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01880000
011790     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01890000
011800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01900000
011810     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01910000
011820     MOVE LENGTH OF PO115AI        TO DP030-MAP-LENGTH (1).       01920000
011830     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01930000
011840     PERFORM 0001-CALL-CICS-ARCH-API.                             01940000
011850                                                                  01950000
011860     PERFORM 1000-CONTROL-PROCESSING.                             01960000
011870                                                                  01970000
011880     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01980000
011890     PERFORM 0001-CALL-CICS-ARCH-API.                             01990000
011900                                                                  02000000
011910                                                                  02010017
011920 0001-CALL-CICS-ARCH-API.                                         02020000
011930                                                                  02030000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      02040022
011950                                    DFHCOMMAREA                   02050022
011960                                    DP030-CICS-API-FIELDS         02060022
011970                                    DP020-STANDARD-COMMAREA       02070022
011980                                    PO115AI.                      02080022
011990                                                                  02090000
012000     IF  DP030-RC-CALL-SUCCESSFUL                                 02100000
012010         CONTINUE                                                 02110000
012020     ELSE                                                         02120000
012030         SET DP013-NO-ROLLBACK                                    02130000
012040             DP013-XCTL-DISPLAY-RESTART                           02140000
012050             DP013-CICS-ABEND      TO TRUE                        02150000
CICS           MOVE '0001-CALL-CICS-ARCH-API'                           02160022
012070                                   TO DP013-PARAGRAPH             02170000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O02180022
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      02190022
012100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      02200000
012110         PERFORM DP013-0000-PROCESS-ABEND                         02210000
012120     END-IF.                                                      02220000
012130                                                                  02230000
012140/                                                                 02240000
012150*----------------------------------------------------------------*02250000
012160*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02260000
012170*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02270000
012180*----------------------------------------------------------------*02280000
012190                                                                  02290000
012200 1000-CONTROL-PROCESSING.                                         02300000
012210                                                                  02310000
012220     EVALUATE TRUE                                                02320000
012230         WHEN DP020-NEXT-ACT-INITIAL                              02330000
012240              PERFORM 1100-PROCESS-INTER-APPL-COMM                02340000
012310              PERFORM 4000-BUILD-INITIAL-PANEL                    02350000
012380                                                                  02360000
012390         WHEN DP020-NEXT-ACT-READ-MAP                             02370000
012400              PERFORM 2000-PROCESS-PANEL                          02380000
012410                                                                  02390000
012700         WHEN OTHER                                               02400000
012710              SET DP013-LOGIC-ABEND                               02410000
012720                  DP013-NO-ROLLBACK TO TRUE                       02420000
012730              MOVE '1000-CONTROL-PROCESSING'                      02430000
012740                                    TO DP013-PARAGRAPH            02440000
012750              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  02450000
012760                                    TO DP013-MESSAGE-TEXT(1)      02460000
012770              MOVE DP020-NEXT-APPL-ACTIVITY                       02470000
012780                                    TO DP013-MESSAGE-TEXT(2)      02480000
012790              PERFORM DP013-0000-PROCESS-ABEND                    02490000
012800     END-EVALUATE.                                                02500000
012820                                                                  02510017
012830*----------------------------------------------------------------*02520000
012840*    DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE  *02530000
012850*    INTER-APPLICATION FORMAT CODE.                              *02540000
012890*----------------------------------------------------------------*02550000
012900 1100-PROCESS-INTER-APPL-COMM.                                    02560000
012910                                                                  02570000
012940     INITIALIZE ASC-SPECIFIC-COMMAREA.                            02580000
012950                                                                  02590000
013240     MOVE PO017-PO-NBR          TO DK-PO-NBR                      02600004
013250                                   ASC-KEY-PO-NBR.                02610000
013270     MOVE PO017-DEPT-NBR        TO DK-DEPT-NBR                    02620004
013280                                   ASC-KEY-DEPT-NBR.              02630000
013310     MOVE PO017-ENT-NAME-DESC   TO DK-ENT-NAME-DESC               02640006
013300                                   ASC-KEY-ENT-NAME-DESC.         02650000
013300/                                                                 02660017
025510*----------------------------------------------------------------*02670000
025460*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*02680000
025470*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*02690000
025480*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *02700000
025490*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *02710000
025500*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *02720000
025510*----------------------------------------------------------------*02730000
025520                                                                  02740000
025530 2000-PROCESS-PANEL.                                              02750000
025550     EVALUATE TRUE                                                02760000
097700                                                                  02770013
096600         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02780000
096700             INITIALIZE ASC-SCREEN-FIELDS                         02790000
096800             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   02800000
096900             MOVE ASC-KEY-DEPT-NBR TO DK-DEPT-NBR                 02810000
097000             MOVE ASC-KEY-STATUS-CDE                              02820000
097100                                   TO DK-STATUS-CDE               02830000
097200             MOVE ASC-PO-TYP-CDE                                  02840000
097300                                   TO DK-PO-TYP-CDE               02850000
097400             MOVE ASC-KEY-ENT-NAME-DESC                           02860000
097500                                   TO DK-ENT-NAME-DESC            02870000
097600             PERFORM 4000-BUILD-INITIAL-PANEL                     02880000
097700                                                                  02890000
101200         WHEN OTHER                                               02900000
101300             PERFORM 2100-CHECK-FUNCTION-KEY                      02910000
097700                                                                  02920013
029770     END-EVALUATE.                                                02930000
029780                                                                  02940000
033700*----------------------------------------------------------------*02950000
033710*    ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED    *02960000
033720*    FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED*02970000
033730*    FROM THE CICS ARCHITECTURE API.                             *02980000
033740*----------------------------------------------------------------*02990000
033750                                                                  03000000
102300 2100-CHECK-FUNCTION-KEY.                                         03010000
102400                                                                  03020000
102500     EVALUATE TRUE                                                03030000
033750                                                                  03040013
102600         WHEN DP020-SRC-AID = DP016-ENTER                         03050000
102700             CONTINUE                                             03060000
102800                                                                  03070000
102900         WHEN DP020-FK-LOCAL-RETURN (DP020-SRC-AID)               03080000
103000             CONTINUE                                             03090000
103100                                                                  03100000
103200         WHEN OTHER                                               03110000
103300             SET DP013-NO-ROLLBACK                                03120000
103400                 DP013-XCTL-DISPLAY-RESTART                       03130000
103500                 DP013-CICS-ABEND  TO TRUE                        03140000
103600             MOVE '2100-CHECK-FUNCTION-KEY'                       03150000
103700                                   TO DP013-PARAGRAPH             03160000
103800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      03170000
103900                                   TO DP013-MESSAGE-TEXT (1)      03180000
104000             PERFORM DP013-0000-PROCESS-ABEND                     03190000
104100     END-EVALUATE.                                                03200000
104200                                                                  03210000
034030/                                                                 03220000
067270*----------------------------------------------------------------*03230000
067280*    FORMAT PAYMENT TERM DESCRIPTION                             *03240000
067290*----------------------------------------------------------------*03250000
074290                                                                  03260000
067300 3170-FORMAT-PAYMENT-TERM-DESC.                                   03270000
067310                                                                  03280000
067320     INITIALIZE ASC-PAYT-TERM-ID-DESC.                            03290000
067330                                                                  03300000
067340     MOVE POAGMT-PAYT-TERM-ID      TO PV-EDIT-PAYT-TERM-ID.       03310000
067350     COPY POPD001.                                                03320000
067360                                                                  03330000
067370     MOVE ASC-PAYT-TERM-ID-DESC  TO ATERMDEO.                     03340000
067380                                                                  03350000
067390/                                                                 03360000
073700*----------------------------------------------------------------*03370000
073710*  THIS PARAGRAPH BUILDS THE INITIAL SCREEN                      *03380000
073730*----------------------------------------------------------------*03390000
073750 4000-BUILD-INITIAL-PANEL.                                        03400000
073760                                                                  03410000
074190* GET PAYMENT INFO                                                03420000
073760                                                                  03430013
074200     MOVE 2                      TO DK-AGRMT-TYP-ID.              03440000
074210     PERFORM 4060-GET-PO-AGREEMENT-INFO.                          03450000
074220     IF  SQLCODE = +0                                             03460000
074250         COMPUTE ASC-VDSC-PCT-N =                                 03470000
074260                 POAGMT-DISC-PCT * 100                            03480000
074270         MOVE POAGMT-DISC-PAY-DAY-QTY                             03490000
074280                                 TO ASC-VEX-PAY-DAYS-QTY-N        03500000
074290         MOVE POAGMT-PAYT-TERM-ID                                 03510000
074300                                 TO ASC-PAYT-TERM-ID-N            03520000
074310                                    DK-PAYT-TERM-ID               03530000
074320         PERFORM 4040-GET-PAYMENT-TERM-INFO                       03540000
074330         IF  SQLCODE = +0                                         03550000
074340             PERFORM 3170-FORMAT-PAYMENT-TERM-DESC                03560000
074350         END-IF                                                   03570000
074360     END-IF.                                                      03580000
074370                                                                  03590002
074190* GET MARK OUT OF STOCK PERCENT                                   03600007
                                                                        03610008
074200     MOVE 5                      TO DK-AGRMT-TYP-ID.              03620007
074200     MOVE 7                      TO DK-TYP-CDE.                   03630008
074210     PERFORM 4065-GET-PO-AGREEMENT-INFO.                          03640008
                                                                        03650008
074220     IF  SQLCODE = +0                                             03660008
074250         COMPUTE ASC-MOS-DSC-PCT-N =                              03670008
074260                 POAGMT-DISC-PCT * 100                            03680008
074360     END-IF.                                                      03690008
074370                                                                  03700008
074190* GET TRADE DISCOUT                                               03710008
074200     MOVE 8                      TO DK-TYP-CDE.                   03720008
074210     PERFORM 4065-GET-PO-AGREEMENT-INFO.                          03730009
074220     IF  SQLCODE = +0                                             03740008
074250         COMPUTE ASC-TRADE-DSC-PCT-N =                            03750009
074260                 POAGMT-DISC-PCT * 100                            03760008
074360     END-IF.                                                      03770008
074370                                                                  03780008
074190* GET ADDITIONAL VENDOR DISCOUNT INFO                             03790012
074200     MOVE 1                      TO DK-TYP-CDE.                   03800012
074210     PERFORM 4065-GET-PO-AGREEMENT-INFO.                          03810012
074220     IF  SQLCODE = +0                                             03820012
074230         MOVE POAGMT-DISC-DOL-AMT                                 03830012
074240                                 TO ASC-ADSC-DOL-AMT-N            03840012
074250         COMPUTE ASC-ADSC-PCT-N =                                 03850012
074260                 POAGMT-DISC-PCT * 100                            03860012
074270         MOVE POAGMT-DISC-PAY-DAY-QTY                             03870012
074280                                 TO ASC-AEX-PAY-DAYS-QTY-N        03880012
074360     END-IF.                                                      03890012
074370                                                                  03900012
067200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        03910008
074380/                                                                 03920017
078410*----------------------------------------------------------------*03930000
078420*    GET PAYMENT TERM INFORMATION                                *03940000
078430*----------------------------------------------------------------*03950000
078440                                                                  03960000
078450 4040-GET-PAYMENT-TERM-INFO.                                      03970000
078460                                                                  03980000
078470     PERFORM                                                      03990000
078480         WITH TEST AFTER                                          04000000
078490         VARYING PV-RETRY-COUNTER                                 04010000
078500         FROM 1 BY 1                                              04020000
078510         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04030000
078520             OR (SQLCODE = +0)                                    04040000
078530             OR (SQLCODE = +100))                                 04050000
078540                                                                  04060000
078550         EXEC SQL                                                 04070000
078560               SELECT PAY_TERM_ID                                 04080000
078570                     ,DISCOUNT_DAYS_QTY                           04090000
078580                     ,DISCOUNT_PCT                                04100000
078590                     ,DUE_DAY_QTY                                 04110000
078600                     ,DUE_DAY_FR_DTE_TXT                          04120000
078610                     ,OTHER_TXT                                   04130000
078620                INTO :PAYTRM-PAY-TERM-ID                          04140000
078630                    ,:PAYTRM-DISCOUNT-DAYS-QTY                    04150000
078640                    ,:PAYTRM-DISCOUNT-PCT                         04160000
078650                    ,:PAYTRM-DUE-DAY-QTY                          04170000
078660                    ,:PAYTRM-DUE-DAY-FR-DTE-TXT                   04180000
078670                    ,:PAYTRM-OTHER-TXT                            04190000
078680                FROM TPAYTRM                                      04200000
078690               WHERE PAY_TERM_ID = :DK-PAYT-TERM-ID               04210000
078700         END-EXEC                                                 04220000
078710                                                                  04230000
078720         EVALUATE TRUE                                            04240000
078730             WHEN SQLCODE = +0                                    04250000
078740             WHEN SQLCODE = +100                                  04260000
078750             WHEN SQLCODE = -904                                  04270000
078760             WHEN SQLCODE = -913                                  04280000
078770                  CONTINUE                                        04290000
078780                                                                  04300000
078790             WHEN SQLWARN0 NOT = SPACES                           04310000
078800             WHEN SQLCODE < +0                                    04320000
078810             WHEN SQLCODE > +0                                    04330000
078820                  MOVE '4040-GET-PAYMENT-TERM-INFO'               04340000
078830                                  TO DP013-PARAGRAPH              04350000
078840                  MOVE 'UNSUCCESSFUL SELECT PAYMENT TERMS'        04360000
078850                                  TO DP013-MESSAGE-TEXT (1)       04370000
078860                  MOVE SQLCA      TO DP013-SQLCA                  04380000
078870                  MOVE 'TPAYTRM ' TO DP013-DB2-TABLE-NAME (1)     04390000
078880                  SET DP013-DB2-ABEND                             04400000
078890                      DP013-XCTL-DISPLAY-RESTART                  04410000
078900                                  TO TRUE                         04420000
078910                  PERFORM DP013-0000-PROCESS-ABEND                04430000
078920         END-EVALUATE                                             04440000
078930     END-PERFORM.                                                 04450000
078940                                                                  04460000
078950     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        04470000
078960         MOVE '4040-GET-PAYMENT-TERM-INFO'                        04480000
078970                                  TO DP013-PARAGRAPH              04490000
078980         MOVE 'MAX RETRIES EXCEEDED ON SELECT PAYMENT TERMS'      04500000
078990                                  TO DP013-MESSAGE-TEXT (1)       04510000
079000         MOVE SQLCA               TO DP013-SQLCA                  04520000
079010         MOVE 'TPAYTRM '          TO DP013-DB2-TABLE-NAME (1)     04530000
079020         SET DP013-DB2-ABEND                                      04540000
079030             DP013-XCTL-DISPLAY-RESTART                           04550000
079040                                  TO TRUE                         04560000
079050         PERFORM DP013-0000-PROCESS-ABEND                         04570000
079060     END-IF.                                                      04580000
079070                                                                  04590000
079080/                                                                 04600000
079980*----------------------------------------------------------------*04610000
079990*    GET THE PURCHASE ORDER AGREEMENT INFORMATION                *04620000
080000*----------------------------------------------------------------*04630000
080010 4060-GET-PO-AGREEMENT-INFO.                                      04640000
080020                                                                  04650000
080030     PERFORM                                                      04660000
080040         WITH TEST AFTER                                          04670000
080050         VARYING PV-RETRY-COUNTER                                 04680000
080060         FROM 1 BY 1                                              04690000
080070         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               04700000
080080             OR (SQLCODE = +0)                                    04710000
080090             OR (SQLCODE = +100))                                 04720000
080100                                                                  04730000
080110         EXEC SQL                                                 04740000
080130             SELECT  PAYT_TERM_ID                                 04750000
080140                    ,DISC_DOL_AMT                                 04760000
080150                    ,DISC_PCT                                     04770000
080160                    ,DISC_PAY_DAY_QTY                             04780000
080180                INTO :POAGMT-PAYT-TERM-ID                         04790000
080190                    ,:POAGMT-DISC-DOL-AMT                         04800000
080200                    ,:POAGMT-DISC-PCT                             04810000
080210                    ,:POAGMT-DISC-PAY-DAY-QTY                     04820000
080220                FROM TPOAGMT                                      04830000
080230               WHERE PO_NBR         = :DK-PO-NBR                  04840000
080240                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            04850000
080250                 AND VER_STATUS_CDE = 'A'                         04860000
080260         END-EXEC                                                 04870000
080270                                                                  04880000
080280                                                                  04890000
080290                                                                  04900000
080300         EVALUATE TRUE                                            04910000
080310             WHEN SQLCODE = +0                                    04920000
080320             WHEN SQLCODE = +100                                  04930000
080330             WHEN SQLCODE = -904                                  04940000
080340             WHEN SQLCODE = -913                                  04950000
080350                  CONTINUE                                        04960000
080360                                                                  04970000
080370             WHEN SQLWARN0 NOT = SPACES                           04980000
080380             WHEN SQLCODE < +0                                    04990000
080390             WHEN SQLCODE > +0                                    05000000
080400                  MOVE '4060-GET-PO-AGREEMENT-INFO'               05010000
080410                                  TO DP013-PARAGRAPH              05020000
080420                  MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'   05030000
080430                                  TO DP013-MESSAGE-TEXT (1)       05040000
080440                  MOVE SQLCA      TO DP013-SQLCA                  05050000
080450                  MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)     05060000
080460                  SET DP013-DB2-ABEND                             05070000
080470                      DP013-XCTL-DISPLAY-RESTART                  05080000
080480                                  TO TRUE                         05090000
080490                  PERFORM DP013-0000-PROCESS-ABEND                05100000
080500         END-EVALUATE                                             05110000
080510     END-PERFORM.                                                 05120000
080520                                                                  05130000
080530     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05140000
080540         MOVE '4060-GET-PO-AGREEMENT-INFO'                        05150000
080550                                  TO DP013-PARAGRAPH              05160000
080560         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE AGREEMENT' 05170000
080570                                  TO DP013-MESSAGE-TEXT (1)       05180000
080580         MOVE SQLCA               TO DP013-SQLCA                  05190000
080590         MOVE 'TPOAGMT '          TO DP013-DB2-TABLE-NAME (1)     05200000
080600         SET DP013-DB2-ABEND                                      05210000
080610             DP013-XCTL-DISPLAY-RESTART                           05220000
080620                                  TO TRUE                         05230000
080630         PERFORM DP013-0000-PROCESS-ABEND                         05240000
080640     END-IF.                                                      05250000
080650/                                                                 05260017
079980*----------------------------------------------------------------*05270008
079990*    GET THE PURCHASE ORDER MOS/TRADE INFORMATION                *05280008
080000*----------------------------------------------------------------*05290008
080010 4065-GET-PO-AGREEMENT-INFO.                                      05300008
080020                                                                  05310008
080030     PERFORM                                                      05320008
080040         WITH TEST AFTER                                          05330008
080050         VARYING PV-RETRY-COUNTER                                 05340008
080060         FROM 1 BY 1                                              05350008
080070         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               05360008
080080             OR (SQLCODE = +0)                                    05370008
080090             OR (SQLCODE = +100))                                 05380008
080100                                                                  05390008
080110         EXEC SQL                                                 05400008
080150             SELECT  DISC_PCT                                     05410008
080140                    ,DISC_DOL_AMT                                 05420012
080160                    ,DISC_PAY_DAY_QTY                             05430012
080200                INTO :POAGMT-DISC-PCT                             05440008
080190                    ,:POAGMT-DISC-DOL-AMT                         05450012
080210                    ,:POAGMT-DISC-PAY-DAY-QTY                     05460012
080220                FROM TPOAGMT                                      05470008
080230               WHERE PO_NBR         = :DK-PO-NBR                  05480008
080240                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            05490008
080240                 AND TYP_CDE        = :DK-TYP-CDE                 05500008
080250                 AND VER_STATUS_CDE = 'A'                         05510008
080260         END-EXEC                                                 05520008
080270                                                                  05530008
080280                                                                  05540008
080290                                                                  05550008
080300         EVALUATE TRUE                                            05560008
080310             WHEN SQLCODE = +0                                    05570008
080320             WHEN SQLCODE = +100                                  05580008
080330             WHEN SQLCODE = -904                                  05590008
080340             WHEN SQLCODE = -913                                  05600008
080350                  CONTINUE                                        05610008
080360                                                                  05620008
080370             WHEN SQLWARN0 NOT = SPACES                           05630008
080380             WHEN SQLCODE < +0                                    05640008
080390             WHEN SQLCODE > +0                                    05650008
080400                  MOVE '4065-GET-PO-AGREEMENT-INFO'               05660008
080410                                  TO DP013-PARAGRAPH              05670008
080420                  MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'   05680008
080430                                  TO DP013-MESSAGE-TEXT (1)       05690008
080440                  MOVE SQLCA      TO DP013-SQLCA                  05700008
080450                  MOVE 'TPOAGMT ' TO DP013-DB2-TABLE-NAME (1)     05710008
080460                  SET DP013-DB2-ABEND                             05720008
080470                      DP013-XCTL-DISPLAY-RESTART                  05730008
080480                                  TO TRUE                         05740008
080490                  PERFORM DP013-0000-PROCESS-ABEND                05750008
080500         END-EVALUATE                                             05760008
080510     END-PERFORM.                                                 05770008
080520                                                                  05780008
080530     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05790008
080540         MOVE '4065-GET-PO-AGREEMENT-INFO'                        05800008
080550                                  TO DP013-PARAGRAPH              05810008
080560         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHASE AGREEMENT' 05820008
080570                                  TO DP013-MESSAGE-TEXT (1)       05830008
080580         MOVE SQLCA               TO DP013-SQLCA                  05840008
080590         MOVE 'TPOAGMT '          TO DP013-DB2-TABLE-NAME (1)     05850008
080600         SET DP013-DB2-ABEND                                      05860008
080610             DP013-XCTL-DISPLAY-RESTART                           05870008
080620                                  TO TRUE                         05880008
080630         PERFORM DP013-0000-PROCESS-ABEND                         05890008
080640     END-IF.                                                      05900008
080670/                                                                 05910000
084320*----------------------------------------------------------------*05920000
084330*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *05930000
084340*----------------------------------------------------------------*05940000
084350 4400-MOVE-COMMAREA-TO-SCREEN.                                    05950000
084360                                                                  05960000
084370     MOVE ASC-KEY-PO-NBR         TO APONUMO.                      05970000
084470     MOVE ASC-KEY-DEPT-NBR       TO ADEPTO.                       05980000
084550     MOVE ASC-KEY-ENT-NAME-DESC  TO AVENDNMO.                     05990000
084750     MOVE ASC-PAYT-TERM-ID-N        TO ATERMIDO.                  06000000
084760     MOVE ASC-PAYT-TERM-ID-DESC     TO ATERMDEO.                  06010000
084760     MOVE ASC-MOS-DSC-PCT-N         TO AMOSPCTO.                  06020011
084760     MOVE ASC-TRADE-DSC-PCT-N       TO ATRDPCTO.                  06030011
084770     MOVE ASC-ADSC-DOL-AMT-N        TO AADSCDOO.                  06040000
084780     MOVE ASC-VEX-PAY-DAYS-QTY-N    TO AVEXDAYO.                  06050000
084780     MOVE ASC-AEX-PAY-DAYS-QTY-N    TO AAEXDAYO.                  06060000
084790     MOVE ASC-VDSC-PCT-N            TO AVDSCPEO.                  06070000
084790     MOVE ASC-ADSC-PCT-N            TO AADSCPEO.                  06080000
084860                                                                  06090000
084870     IF  ASC-WARNING-MSG-NBR > +0                                 06100000
084880         PERFORM 4410-GET-MESSAGE                                 06110000
084890         MOVE ASC-WARNING-MSG    TO AMSGO                         06120000
084900         MOVE +0                 TO ASC-WARNING-MSG-NBR           06130000
084910     ELSE                                                         06140000
084920         MOVE SPACES             TO ASC-WARNING-MSG               06150000
084930     END-IF.                                                      06160000
084940                                                                  06170000
084950/                                                                 06180000
084960*----------------------------------------------------------------*06190000
084970*    GET MESSAGE TEXT AND DISPLAY ON WARNING LINE                *06200000
084980*----------------------------------------------------------------*06210000
084990 4410-GET-MESSAGE.                                                06220000
085000                                                                  06230000
085010     MOVE ASC-WARNING-MSG-NBR    TO DP507I-MSG-NUMBER.            06240000
085020                                                                  06250000
085030     EXEC CICS READ                                               06260000
085040               DATASET ('DPSYSMSG')                               06270000
085050               RIDFLD  (DP507I-MSG-NUMBER)                        06280000
085060               INTO    (DP507I-MESSAGES-INPUT-RECORD)             06290000
085070               RESP    (PV-CICS-RESPONSE)                         06300000
085080     END-EXEC.                                                    06310000
085090                                                                  06320000
085100     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   06330000
085110         SET DP013-LINK-RETURN                                    06340000
085120             DP013-CICS-ABEND                                     06350000
085130             DP013-NO-ROLLBACK   TO TRUE                          06360000
085140         MOVE '4410-GET-MESSAGE' TO DP013-PARAGRAPH               06370000
085150         MOVE 'ATTEMPTING TO READ THE SYSTEM MESSAGES FILE FOR THE06380000
085160-             ' FOLLOWING MESSAGE NUMBER: '                       06390000
085170                                 TO DP013-MESSAGE-TEXT (1)        06400000
085180         MOVE DP507I-MSG-NUMBER  TO DP013-MESSAGE-TEXT (2)        06410000
085190         PERFORM DP013-0000-PROCESS-ABEND                         06420000
085200     ELSE                                                         06430000
085210         MOVE DP507I-MSG-TEXT    TO ASC-WARNING-MSG               06440000
085220     END-IF.                                                      06450000
085230                                                                  06460000
085240/                                                                 06470000
135440                                                                  06480000
135450     COPY DPPD013.                                                06490000
135460*----------------------------------------------------------------*06500000
