      *************************                                         00010007
       IDENTIFICATION DIVISION.                                         00020007
      *************************                                         00030007
       PROGRAM-ID.      XMKUT215.                                       00040007
       AUTHOR.          B. GRAHAM - STRATAGEM                           00050007
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060007
       DATE-WRITTEN.    05/05/2008.                                     00070007
       DATE-COMPILED.                                                   00080007
                                                                        00090007
      ***************************************************************** 00100007
      *    ******  MUST BE COMPILED AS A BATCH PROGRAM.                 00110007
      *            WITH ORACLE                                          00120007
      ***************************************************************** 00130007
      *                                                               * 00140007
      *               --- GET ORACLE TABLE INFO ---                   * 00150007
      *                                                               * 00160007
      *  THIS PROGRAM RETURNS SKU, LOC NBR, ONHAND QTY AND RTL AMT      00170007
      *  FOR SKUS ON AN INPUT FILE BASED UPON AN INPUT BEGINNING OF     00180007
      *  WEEK DATE. THIS PROCESS IS EXPECTED TO RUN AT THE BEGINNING    00190007
      *  OF THE MONTH SO THE DATE IS ALSO THE BEGINNING OF THE MONTH.   00200007
      *                                                               * 00210007
      *---------------------------------------------------------------* 00220007
      *                                                                 00230007
      *CHANGE HISTORY:                                                  00240007
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00250007
      * ------- ---------- ----------- -------------------------------- 00260007
      * W34517  07-29-2008 B.GRAHAM ORIGINAL IMPLEMENTATION             00270007
      *                                                                 00280007
RONNA * RONNA   10/15/2018 RONNA MCDONALD - CHANGE ORACLE SIGNON FOR    00290007
RONNA *                                     MAINFRAME REFACTORING       00300007
RONNA *                                                                 00310007
      ******************************************************************00320007
      *---------------------------------------------------------------* 00330007
       EJECT                                                            00340007
                                                                        00350007
       ENVIRONMENT DIVISION.                                            00360007
      *                                                                 00370007
       CONFIGURATION SECTION.                                           00380007
                                                                        00390007
       SOURCE-COMPUTER. IBM-3090.                                       00400007
       OBJECT-COMPUTER. IBM-3090.                                       00410007
                                                                        00420007
                                                                        00430007
       INPUT-OUTPUT SECTION.                                            00440007
                                                                        00450007
       FILE-CONTROL.                                                    00460007
                                                                        00470007
RONNA      SELECT ORACLE-LOGON-FILE                                     00480007
RONNA          ASSIGN TO ORALOGON.                                      00490007
                                                                        00500007
           SELECT BOM-DATE-CTL                                          00510007
               ASSIGN TO INP02.                                         00520007
                                                                        00530007
           SELECT SKU-CURR-PREV-ATTR-FILE                               00540007
               ASSIGN TO INP03.                                         00550007
                                                                        00560007
           SELECT SKU-CURR-PREV-ATTR-UPD-FILE                           00570007
               ASSIGN TO OUT01.                                         00580007
                                                                        00590007
           SELECT ERROR-WARN-FILE                                       00600007
               ASSIGN TO OUT02.                                         00610007
                                                                        00620007
                                                                        00630007
       DATA DIVISION.                                                   00640007
                                                                        00650007
       FILE SECTION.                                                    00660007
                                                                        00670007
RONNA  FD  ORACLE-LOGON-FILE                                            00680008
           LABEL RECORDS ARE STANDARD                                   00690007
           RECORDING MODE IS F                                          00700007
           BLOCK CONTAINS 0 RECORDS.                                    00710007
                                                                        00720007
RONNA  01  ORACLE-LOGON-RECORD            PIC X(80).                    00730008
                                                                        00850007
                                                                        00860007
       FD  BOM-DATE-CTL                                                 00870007
           LABEL RECORDS ARE STANDARD                                   00880007
           RECORDING MODE IS F                                          00890007
           BLOCK CONTAINS 0 RECORDS.                                    00900007
                                                                        00910007
       01  BOM-DATE-REC                  PIC X(80).                     00920007
                                                                        00930007
       FD  SKU-CURR-PREV-ATTR-FILE                                      00940007
           LABEL RECORDS ARE STANDARD                                   00950007
           RECORDING MODE IS F                                          00960007
           BLOCK CONTAINS 0 RECORDS.                                    00970007
                                                                        00980007
       01  SKU-CURR-PREV-ATTR-REC        PIC X(175).                    00990007
                                                                        01000007
       FD  SKU-CURR-PREV-ATTR-UPD-FILE                                  01010007
           LABEL RECORDS ARE STANDARD                                   01020007
           RECORDING MODE IS F                                          01030007
           BLOCK CONTAINS 0 RECORDS.                                    01040007
       01  SKU-CURR-PREV-ATTR-UPD-REC    PIC X(175).                    01050007
                                                                        01060007
       FD  ERROR-WARN-FILE                                              01070007
           LABEL RECORDS ARE STANDARD                                   01080007
           RECORDING MODE IS F                                          01090007
           BLOCK CONTAINS 0 RECORDS.                                    01100007
       01  ERROR-WARN-REC                PIC X(175).                    01110007
                                                                        01120007
      *                                                                 01130007
       WORKING-STORAGE SECTION.                                         01140007
                                                                        01150007
       01  IOC-ORACLE-CONNECTION.                                       01160007
           05  IOC-USER-NAME              PIC X(40).                    01170007
               88 IOC-AUTO-LOGON                         VALUE '/'.     01180007
           05  IOC-PASSWORD               PIC X(40).                    01190007
                                                                        01200007
       01  PA-PROGRAM-ACCUMULATORS.                                     01210007
           05  PA-SKU-RECS-IN                  PIC 9(07) VALUE ZEROS.   01220007
           05  PA-LOC-ROWS-IN                  PIC 9(05) VALUE ZEROS.   01230007
           05  PA-SKU-LOC-RECS-OUT             PIC 9(07) VALUE ZEROS.   01240007
           05  PA-ERROR-RECS-OUT               PIC 9(07) VALUE ZEROS.   01250007
           05  PA-SKU-NO-LOCS-CNT              PIC 9(07) VALUE ZEROS.   01260007
           05  PA-SKU-NO-DIM-CNT               PIC 9(07) VALUE ZEROS.   01270007
           05  PA-LOC-CNVR-ERROR-CNT           PIC 9(07) VALUE ZEROS.   01280007
                                                                        01290007
       01  PC-PROGRAM-CONSTANTS.                                        01300007
           05  PC-LOC-TBL-MAX                  PIC 9(04) VALUE 9998.    01310007
           05  PC-PGM-NAME                     PIC X(08) VALUE          01320007
                                                           'XMKUT215'.  01330007
           05  PC-NOLOC                        PIC X(05) VALUE          01340007
                                                              'NOLOC'.  01350007
           05  PC-NODIM                        PIC X(05) VALUE          01360007
                                                              'NODIM'.  01370007
           05  PC-BADLC                        PIC X(05) VALUE          01380007
                                                              'BADLC'.  01390007
           05  PC-W                            PIC X(01) VALUE 'W'.     01400007
                                                                        01410007
           05  PC-E                            PIC X(01) VALUE 'E'.     01420007
                                                                        01430007
       01  PS-PROGRAM-SWITCHES.                                         01440007
                                                                        01450007
           05  PS-SKU-CURR-PREV-AT-END-SW        PIC X(01) VALUE 'N'.   01460007
               88  PS-SKU-CURR-PREV-AT-END-YES             VALUE 'Y'.   01470007
               88  PS-SKU-CURR-PREV-AT-END-NO              VALUE 'N'.   01480007
                                                                        01490007
           05  PS-LOC-RECS-AT-END-SW             PIC X(01) VALUE 'N'.   01500007
               88  PS-LOC-RECS-AT-END-YES                  VALUE 'Y'.   01510007
               88  PS-LOC-RECS-AT-END-NO                   VALUE 'N'.   01520007
                                                                        01530007
           05  PS-SKU-MDSE-FOUND-SW              PIC X(01) VALUE 'N'.   01540007
               88  PS-SKU-MDSE-FOUND-YES                   VALUE 'Y'.   01550007
               88  PS-SKU-MDSE-FOUND-NO                    VALUE 'N'.   01560007
                                                                        01570007
           05  PS-SKU-LOCS-AT-END-SW             PIC X(01) VALUE 'N'.   01580007
               88  PS-SKU-LOCS-AT-END-YES                  VALUE 'Y'.   01590007
               88  PS-SKU-LOCS-AT-END-NO                   VALUE 'N'.   01600007
                                                                        01610007
           05  PS-LOCS-FOUND-SW                  PIC X(01) VALUE 'N'.   01620007
               88  PS-LOCS-FOUND-YES                       VALUE 'Y'.   01630007
               88  PS-LOCS-FOUND-NO                        VALUE 'N'.   01640007
                                                                        01650007
           05  PS-LOC-CSR-AT-END-SW              PIC X(01) VALUE 'N'.   01660007
               88  PS-LOC-CSR-AT-END-YES                   VALUE 'Y'.   01670007
               88  PS-LOC-CSR-AT-END-NO                    VALUE 'N'.   01680007
                                                                        01690007
           05  PS-ORACLE-CC-AT-END-SW            PIC X(01) VALUE 'N'.   01700007
               88  PS-ORACLE-CC-AT-END-YES                 VALUE 'Y'.   01710007
               88  PS-ORACLE-CC-AT-END-NO                  VALUE 'N'.   01720007
                                                                        01730007
           05  PS-BOM-DATE-FILE-AT-END-SW        PIC X(01) VALUE 'N'.   01740007
               88  PS-BOM-DATE-FILE-AT-END-YES             VALUE 'Y'.   01750007
               88  PS-BOM-DATE-FILE-AT-END-NO              VALUE 'N'.   01760007
                                                                        01770007
       01  PT-LOC-TABLE.                                                01780007
           05  PT-LOCATIONS OCCURS 9999 TIMES.                          01790007
               10  PT-LOC-ID                     PIC  9(10).            01800007
               10  PT-LOC-NBR                    PIC  9(05).            01810007
                                                                        01820007
                                                                        01830007
       01  PV-PROGRAM-VARIABLES.                                        01840007
           05  PV-CNVRTED-SQLCODE                 PIC Z9999-.           01850007
           05  PV-LOC-SUB                        PIC 9(05) VALUE ZEROS. 01860007
RONNA      05  PV-ORACLE-USERID-LEN         PIC S9(04)  VALUE ZEROS     01870007
RONNA                                                   COMP SYNC.      01880007
RONNA      05  PV-ORACLE-PASSWORD-LEN       PIC S9(04)  VALUE ZEROS     01890007
RONNA                                                   COMP SYNC.      01900007
           05  PV-ABEND-CODE           PIC S9(04)  VALUE +0  COMP.      02000007
               88  PV-ABEND-4001                   VALUE 4001.          02010007
      *            EMPTY INPUT FILE                                     02020007
               88  PV-ABEND-4013                   VALUE 4013.          02030007
      *            SQL ERROR                                            02040007
                                                                        02050007
                                                                        02060007
                                                                        02070007
      *** INPUT SKU-CURR-PREV-ATTR-REC                                  02080007
           COPY MLRD556.                                                02090007
                                                                        02100007
                                                                        02110007
      *----------------------------------------------------------------*02120007
      *  BAD SQL CALL DATA AREAS                                       *02130007
      *----------------------------------------------------------------*02140007
                                                                        02150007
       01  WS-ERROR-FIELDS.                                             02160007
           05 WS-MSG-TEXT                  PIC X(512).                  02170007
           05 WS-MAX-SIZE                  PIC S9(09) COMP              02180007
                                                       VALUE +512.      02190007
           05 WS-MSG-LENGTH                PIC S9(09) COMP.             02200007
           05 WS-ABEND-CODE                PIC S9(04) COMP SYNC         02210007
                                                      VALUE ZEROS.      02220007
       EJECT                                                            02230007
           EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     02240007
                                                                        02250007
      *                                                                 02260007
      *---------------------------------------------------------------* 02270007
      *    ORACLE LOGON WORKING STORAGE COPYBOOK.                       02280007
      *---------------------------------------------------------------* 02290007
       01  USERNAME                        PIC X(10)      VARYING.      02300007
       01  PASSWD                          PIC X(10)      VARYING.      02310007
       01  PC-ENT01-TYPE-CDE               PIC X(02)      VALUE '01'.   02320007
       01  PV-ORACLE-ID                    PIC X(01)      VALUE '/'.    02330007
       01  PV-COUNTERS.                                                 02340007
           05   PV-NEXT-SEQ               PIC S9(8)V COMP-3             02350007
                                                      VALUE ZERO.       02360007
      ******************************************************************02370007
      * PV-PREV-BOM-DATE, PV-PREV-EOM-DATE, PV-CURR-FSCL-MN-NBR         02380007
      * ARE NOT USED IN THIS PROGRAM                                    02390007
      ******************************************************************02400007
       01  PV-BOM-DATE-REC.                                             02410007
           05  PV-CURR-BOM-DATE        PIC  X(10).                      02420007
           05  FILLER                  PIC  X(01).                      02430007
           05  PV-PREV-BOM-DATE        PIC  X(10).                      02440007
           05  FILLER                  PIC  X(01).                      02450007
           05  PV-PREV-EOM-DATE        PIC  X(10).                      02460007
           05  FILLER                  PIC  X(01).                      02470007
           05  PV-CURR-FSCL-MN-NBR     PIC  X(02).                      02480007
           05  FILLER                  PIC  X(45).                      02490007
                                                                        02500007
      ******************************************************************02510007
      * COBOL DECLARATION FOR TABLE XMT_LOC_DIM                         02520007
      ******************************************************************02530007
           EXEC SQL                                                     02540007
               INCLUDE XMT00009                                         02550007
           END-EXEC.                                                    02560007
                                                                        02570007
      ******************************************************************02580007
      * COBOL DECLARATION FOR TABLE XMT_SKU_MDSE_DIM                    02590007
      ******************************************************************02600007
           EXEC SQL                                                     02610007
               INCLUDE XMT00010                                         02620007
           END-EXEC.                                                    02630007
                                                                        02640007
      ******************************************************************02650007
      * COBOL DECLARATION FOR TABLE XMT_WKLY_SKUXLOC_INV_FCT            02660007
      * NEED TO HARD CODE DCLGEN DOES NOT EXIST                         02670007
      ******************************************************************02680007
                                                                        02690007
       01  XMT-WKLY-SKUXLOC-INV-FCT.                                    02700007
           05  SL-TM-DIM-BOW-KY-DTE               PIC X(19).            02710007
           05  SL-CW-SKU-ID                       PIC S9(10) COMP-3.    02720007
           05  SL-CW-LOC-ID                       PIC S9(10) COMP-3.    02730007
           05  SL-BOP-INV-UNT-QTY                 PIC S9(12) COMP-3.    02740007
           05  SL-BOP-INV-EXTD-RTL-AMT            PIC S9(13)V99 COMP-3. 02750007
                                                                        02760007
                                                                        02770007
           EXEC SQL END DECLARE SECTION END-EXEC.                       02780007
                                                                        02790007
           EXEC SQL INCLUDE SQLCACOB      END-EXEC.                     02800007
                                                                        02810007
       EJECT                                                            02820007
      *                                                                 02830007
       LINKAGE SECTION.                                                 02840007
      *                                                                 02850007
      *                                                                 02860007
       PROCEDURE DIVISION.                                              02870007
                                                                        02880007
      ******************************************************************02890007
       0000-MAIN.                                                       02900007
      ******************************************************************02910007
                                                                        02920007
           PERFORM 1000-INIT.                                           02930007
                                                                        02940007
           PERFORM 2000-PROCESS-SKU-CURR-PREV                           02950007
               UNTIL PS-SKU-CURR-PREV-AT-END-YES.                       02960007
                                                                        02970007
           PERFORM 9000-EOJ.                                            02980007
                                                                        02990007
           STOP RUN.                                                    03000007
                                                                        03010007
                                                                        03020007
      ******************************************************************03030007
       1000-INIT.                                                       03040007
      ******************************************************************03050007
                                                                        03060007
RONNA      OPEN INPUT  ORACLE-LOGON-FILE                                03070007
                       BOM-DATE-CTL                                     03080007
                       SKU-CURR-PREV-ATTR-FILE                          03090007
                OUTPUT SKU-CURR-PREV-ATTR-UPD-FILE                      03100007
                       ERROR-WARN-FILE.                                 03110007
                                                                        03120007
           PERFORM 8000-READ-ORACLE-SRC-CTL.                            03130007
                                                                        03140007
           PERFORM 8100-READ-BOM-DATE-CTL.                              03150007
                                                                        03160007
           PERFORM 8200-ORACLE-LOGON.                                   03170007
                                                                        03180007
           PERFORM 8300-LOAD-LOC-ID-TBL.                                03190007
                                                                        03200007
                                                                        03210007
      ******************************************************************03220007
       2000-PROCESS-SKU-CURR-PREV.                                      03230007
      ******************************************************************03240007
                                                                        03250007
           PERFORM 8400-READ-SKU-CURR-PREV-FILE.                        03260007
                                                                        03270007
           IF PS-SKU-CURR-PREV-AT-END-NO                                03280007
              PERFORM 2100-GET-SKU-MDSE-DIM                             03290007
              IF PS-SKU-MDSE-FOUND-YES                                  03300007
                  PERFORM 2200-DECLARE-OPEN-SKU-LOC-CSR                 03310007
                  SET PS-LOCS-FOUND-NO      TO TRUE                     03320007
                  SET PS-SKU-LOCS-AT-END-NO TO TRUE                     03330007
                  PERFORM 2300-PROCESS-SKU-LOCS                         03340007
                      UNTIL PS-SKU-LOCS-AT-END-YES                      03350007
                  IF PS-LOCS-FOUND-NO                                   03360007
                      ADD 1         TO PA-SKU-NO-LOCS-CNT               03370007
                      MOVE PC-W     TO ML556-ERR-WRN-TYPE-CDE           03380007
                      MOVE PC-NOLOC TO ML556-ERR-WRN-CDE                03390007
                      PERFORM 2800-WRITE-ERROR-REC                      03400007
                  END-IF                                                03410007
              ELSE                                                      03420007
                  ADD 1             TO PA-SKU-NO-DIM-CNT                03430007
                  MOVE PC-W         TO ML556-ERR-WRN-TYPE-CDE           03440007
                  MOVE PC-NODIM     TO ML556-ERR-WRN-CDE                03450007
                  PERFORM 2800-WRITE-ERROR-REC                          03460007
              END-IF                                                    03470007
           END-IF.                                                      03480007
                                                                        03490007
                                                                        03500007
      ******************************************************************03510007
       2100-GET-SKU-MDSE-DIM.                                           03520007
      ******************************************************************03530007
                                                                        03540007
           MOVE ML556-SKU-NBR         TO SKU-NBR.                       03550007
                                                                        03560007
           EXEC SQL                                                     03570007
               SELECT CW_SKU_ID                                         03580007
                   INTO :CW-SKU-ID                                      03590007
                       FROM XMT_SKU_MDSE_DIM                            03600007
                   WHERE SKU_NBR = :SKU-NBR                             03610007
           END-EXEC                                                     03620007
                                                                        03630007
           EVALUATE TRUE                                                03640007
             WHEN SQLCODE = ZEROS                                       03650007
                 SET PS-SKU-MDSE-FOUND-YES    TO TRUE                   03660007
             WHEN SQLCODE = 1403                                        03670007
                 SET PS-SKU-MDSE-FOUND-NO     TO TRUE                   03680007
             WHEN OTHER                                                 03690007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     03700007
                 DISPLAY '2100-GET-SKU-MDSE-DIM BAD RETURN   '          03710007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 03720007
                 PERFORM 9998-SQL-ERROR                                 03730007
                                                                        03740007
           END-EVALUATE.                                                03750007
                                                                        03760007
                                                                        03770007
                                                                        03780007
      ******************************************************************03790007
       2200-DECLARE-OPEN-SKU-LOC-CSR.                                   03800007
      ******************************************************************03810007
                                                                        03820007
           EXEC SQL                                                     03830007
                DECLARE SKU_LOC_CSR CURSOR FOR                          03840007
                   SELECT                                               03850007
                        CW_LOC_ID                                       03860007
                       ,BOP_INV_UNT_QTY                                 03870007
                       ,BOP_INV_EXTD_RTL_AMT                            03880007
                   FROM                                                 03890007
                        XMT_WKLY_SKUXLOC_INV_FCT                        03900007
                   WHERE CW_SKU_ID         = :CW-SKU-ID                 03910007
                   AND TM_DIM_BOW_KY_DTE = TO_DATE(:PV-CURR-BOM-DATE)   03920007
                                                                        03930007
           END-EXEC.                                                    03940007
                                                                        03950007
                                                                        03960007
           EVALUATE TRUE                                                03970007
             WHEN SQLCODE = ZEROS                                       03980007
                 CONTINUE                                               03990007
             WHEN OTHER                                                 04000007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     04010007
                                                                        04020007
                 DISPLAY '2200-DECLARE-OPEN-SKU-LOC-CSR / DECLARE '     04030007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 04040007
                 PERFORM 9998-SQL-ERROR                                 04050007
                                                                        04060007
           END-EVALUATE.                                                04070007
                                                                        04080007
                                                                        04090007
           EXEC SQL                                                     04100007
               OPEN SKU_LOC_CSR                                         04110007
           END-EXEC.                                                    04120007
                                                                        04130007
           EVALUATE TRUE                                                04140007
               WHEN SQLCODE = ZERO                                      04150007
                   CONTINUE                                             04160007
               WHEN OTHER                                               04170007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     04180007
                 DISPLAY '2200-DECLARE-OPEN-SKU-LOC-CSR / OPEN '        04190007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 04200007
                 PERFORM 9998-SQL-ERROR                                 04210007
                                                                        04220007
           END-EVALUATE.                                                04230007
                                                                        04240007
                                                                        04250007
      ******************************************************************04260007
       2300-PROCESS-SKU-LOCS.                                           04270007
      ******************************************************************04280007
                                                                        04290007
           PERFORM 2400-FETCH-LOCS.                                     04300007
                                                                        04310007
           IF PS-SKU-LOCS-AT-END-NO                                     04320007
               MOVE SL-BOP-INV-UNT-QTY TO ML556-ONHAND-QTY              04330007
               MOVE SL-BOP-INV-EXTD-RTL-AMT                             04340007
                                       TO ML556-EXTD-RTL-AMT            04350007
               PERFORM 2600-CONVERT-LOC                                 04360007
               IF ML556-LOC-NBR = ZEROS                                 04370007
                   ADD 1         TO PA-LOC-CNVR-ERROR-CNT               04380007
                   MOVE PC-E     TO ML556-ERR-WRN-TYPE-CDE              04390007
                   MOVE PC-BADLC TO ML556-ERR-WRN-CDE                   04400007
                   DISPLAY 'LOC CONVERSION ERROR FOR SKU '              04410007
                            ML556-SKU-NBR ' ORACLE LOC ID '             04420007
                            SL-CW-LOC-ID                                04430007
                   PERFORM 2800-WRITE-ERROR-REC                         04440007
               ELSE                                                     04450007
                   PERFORM 2700-WRITE-SKU-CURR-PREV-UPD                 04460007
               END-IF                                                   04470007
           ELSE                                                         04480007
               PERFORM 2500-CLOSE-SKU-LOC-CSR                           04490007
           END-IF.                                                      04500007
                                                                        04510007
      ******************************************************************04520007
       2400-FETCH-LOCS.                                                 04530007
      ******************************************************************04540007
                                                                        04550007
           EXEC SQL                                                     04560007
               FETCH SKU_LOC_CSR                                        04570007
               INTO :SL-CW-LOC-ID,                                      04580007
                    :SL-BOP-INV-UNT-QTY,                                04590007
                    :SL-BOP-INV-EXTD-RTL-AMT                            04600007
           END-EXEC.                                                    04610007
                                                                        04620007
           EVALUATE TRUE                                                04630007
             WHEN SQLCODE = ZERO                                        04640007
                 SET PS-LOCS-FOUND-YES      TO TRUE                     04650007
             WHEN SQLCODE = 1403                                        04660007
                 SET PS-SKU-LOCS-AT-END-YES TO TRUE                     04670007
             WHEN OTHER                                                 04680007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     04690007
                 DISPLAY '2400-FETCH-LOCS        '                      04700007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 04710007
                 PERFORM 9998-SQL-ERROR                                 04720007
                                                                        04730007
           END-EVALUATE.                                                04740007
                                                                        04750007
                                                                        04760007
      ******************************************************************04770007
       2500-CLOSE-SKU-LOC-CSR.                                          04780007
      ******************************************************************04790007
                                                                        04800007
           EXEC SQL                                                     04810007
               CLOSE SKU_LOC_CSR                                        04820007
           END-EXEC.                                                    04830007
                                                                        04840007
           EVALUATE TRUE                                                04850007
             WHEN SQLCODE = 0                                           04860007
               CONTINUE                                                 04870007
             WHEN OTHER                                                 04880007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     04890007
                                                                        04900007
                 DISPLAY '2500-CLOSE-SKU-LOC-CSR           '            04910007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 04920007
                 PERFORM 9998-SQL-ERROR                                 04930007
                                                                        04940007
           END-EVALUATE.                                                04950007
                                                                        04960007
                                                                        04970007
      ******************************************************************04980007
       2600-CONVERT-LOC.                                                04990007
      ******************************************************************05000007
                                                                        05010007
           PERFORM VARYING PV-LOC-SUB FROM 1 BY 1                       05020007
                   UNTIL PV-LOC-SUB > PA-LOC-ROWS-IN                    05030007
                                                                        05040007
                   IF SL-CW-LOC-ID = PT-LOC-ID (PV-LOC-SUB)             05050007
                       MOVE PT-LOC-NBR (PV-LOC-SUB)                     05060007
                                            TO ML556-LOC-NBR            05070007
                       MOVE PA-LOC-ROWS-IN TO PV-LOC-SUB                05080007
                   END-IF                                               05090007
           END-PERFORM.                                                 05100007
                                                                        05110007
                                                                        05120007
      ******************************************************************05130007
       2700-WRITE-SKU-CURR-PREV-UPD.                                    05140007
      ******************************************************************05150007
                                                                        05160007
           WRITE SKU-CURR-PREV-ATTR-UPD-REC FROM                        05170007
                                  ML556-CURR-PREV-SKU-ATTR-REC.         05180007
                                                                        05190007
           ADD 1 TO PA-SKU-LOC-RECS-OUT.                                05200007
                                                                        05210007
                                                                        05220007
      ******************************************************************05230007
       2800-WRITE-ERROR-REC.                                            05240007
      ******************************************************************05250007
                                                                        05260007
           WRITE ERROR-WARN-REC FROM ML556-CURR-PREV-SKU-ATTR-REC.      05270007
                                                                        05280007
           ADD 1 TO PA-ERROR-RECS-OUT.                                  05290007
                                                                        05300007
                                                                        05310007
      ******************************************************************05320007
       8000-READ-ORACLE-SRC-CTL.                                        05330007
      ******************************************************************05340007
                                                                        05350007
RONNA      READ ORACLE-LOGON-FILE                                       05360007
RONNA          INTO IOC-ORACLE-CONNECTION                               05370007
RONNA          AT END                                                   05380007
RONNA              SET PS-ORACLE-CC-AT-END-YES TO TRUE                  05390007
RONNA      END-READ.                                                    05400007
                                                                        05410007
           IF (PS-ORACLE-CC-AT-END-YES )                                05420007
RONNA         OR (IOC-ORACLE-CONNECTION  = SPACES)                      05430007
             DISPLAY '**********************************'               05440007
             DISPLAY '* ABEND: 8000-READ-ORACLE-SRC-CTL '               05450007
             DISPLAY '*   MISSING CONTROL CARD '                        05460007
             DISPLAY '* THE PROGRAM WILL ABEND'                         05470007
             DISPLAY '**********************************'               05480007
             MOVE 4005 TO PV-ABEND-CODE                                 05490007
             PERFORM 9999-OTHER-ABEND                                   05500007
           END-IF.                                                      05510007
                                                                        05520007
      ******************************************************************05530007
       8100-READ-BOM-DATE-CTL.                                          05540007
      ******************************************************************05550007
                                                                        05560007
           READ BOM-DATE-CTL INTO PV-BOM-DATE-REC                       05570007
               AT END                                                   05580007
                   SET PS-BOM-DATE-FILE-AT-END-YES TO TRUE.             05590007
                                                                        05600007
           IF PS-BOM-DATE-FILE-AT-END-YES                               05610007
               DISPLAY '**********************************'             05620007
               DISPLAY '* ABEND: 8100-READ-BOM-DATE-CTL'                05630007
               DISPLAY '*   MISSING CONTROL CARD INFORMATION'           05640007
               DISPLAY '* THE PROGRAM WILL ABEND'                       05650007
               DISPLAY '**********************************'             05660007
               MOVE 4005 TO PV-ABEND-CODE                               05670007
               PERFORM 9999-OTHER-ABEND                                 05680007
           ELSE                                                         05690007
               DISPLAY 'BOM DATE REC ' PV-BOM-DATE-REC                  05700007
           END-IF.                                                      05710007
                                                                        05720007
      ******************************************************************05730007
      *  LOG ON TO ORACLE                                               05740007
      ******************************************************************05750007
                                                                        05760007
       8200-ORACLE-LOGON.                                               05770007
                                                                        05780007
RONNA      IF IOC-AUTO-LOGON                                            05790007
RONNA          DISPLAY  PC-PGM-NAME    ' - AUTO LOGON TO ORACLE'        05800007
RONNA          EXEC SQL                                                 05810007
RONNA               CONNECT :USERNAME                                   05820007
RONNA          END-EXEC                                                 05830007
RONNA      ELSE                                                         05840007
RONNA          INITIALIZE PV-ORACLE-USERID-LEN                          05850007
RONNA                     PV-ORACLE-PASSWORD-LEN                        05860007
RONNA          INSPECT IOC-USER-NAME                                    05870007
RONNA              TALLYING PV-ORACLE-USERID-LEN                        05880007
RONNA           FOR CHARACTERS BEFORE INITIAL SPACE                     05890007
RONNA       INSPECT IOC-PASSWORD                                        05900007
RONNA           TALLYING PV-ORACLE-PASSWORD-LEN                         05910007
RONNA           FOR CHARACTERS BEFORE INITIAL SPACE                     05920007
RONNA       MOVE IOC-USER-NAME     (1:PV-ORACLE-USERID-LEN) TO          05930007
RONNA                 USERNAME-ARR                                      05940007
RONNA       MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   05950007
RONNA       MOVE IOC-PASSWORD        (1:PV-ORACLE-PASSWORD-LEN) TO      05960007
RONNA                 PASSWD-ARR                                        05970007
RONNA       MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   05980007
RONNA       DISPLAY  PC-PGM-NAME    ' - LOGON TO ORACLE AS USER '       05990007
RONNA                 USERNAME-ARR                                      06000007
RONNA       EXEC SQL                                                    06010007
RONNA         CONNECT :USERNAME IDENTIFIED BY :PASSWD                   06020007
RONNA       END-EXEC                                                    06030007
RONNA       INITIALIZE IOC-PASSWORD                                     06040007
RONNA                  PASSWD                                           06050007
RONNA       END-IF.                                                     06060007
                                                                        06070007
                                                                        06330007
           IF SQLCODE = 0                                               06340007
RONNA          DISPLAY 'CONNECTED TO ORACLE AS USER: ' USERNAME         06360007
           ELSE                                                         06370007
               DISPLAY 'ERROR LOGGING ONTO ORACLE'                      06380007
               PERFORM 9998-SQL-ERROR                                   06390007
           END-IF.                                                      06400007
                                                                        06410007
           EXEC SQL                                                     06420007
            ALTER SESSION                                               06430007
                SET NLS_DATE_FORMAT = 'YYYY-MM-DD-HH24.MI.SS'           06440007
           END-EXEC.                                                    06450007
                                                                        06460007
      ******************************************************************06470007
      *  LOAD WORKING-STORAGE LOCATION-ID TABLE INTO WORKING STORAGE    06480007
      *  FROM ORACLE DATA.                                              06490007
      ******************************************************************06500007
                                                                        06510007
       8300-LOAD-LOC-ID-TBL.                                            06520007
                                                                        06530007
           PERFORM 8305-DECLARE-OPEN-LOC-CSR.                           06540007
                                                                        06550007
           SET PS-LOC-CSR-AT-END-NO TO TRUE.                            06560007
                                                                        06570007
           PERFORM 8310-PROCESS-LOC-CSR                                 06580007
               UNTIL PS-LOC-CSR-AT-END-YES.                             06590007
                                                                        06600007
      ******************************************************************06610007
       8305-DECLARE-OPEN-LOC-CSR.                                       06620007
      ******************************************************************06630007
                                                                        06640007
           EXEC SQL                                                     06650007
                DECLARE LOC_CSR CURSOR FOR                              06660007
                   SELECT                                               06670007
                        CW_LOC_ID                                       06680007
                       ,LOC_NBR                                         06690007
                   FROM                                                 06700007
                        XMT_LOC_DIM                                     06710007
           END-EXEC.                                                    06720007
                                                                        06730007
                                                                        06740007
           EVALUATE TRUE                                                06750007
             WHEN SQLCODE = ZEROS                                       06760007
                 CONTINUE                                               06770007
             WHEN OTHER                                                 06780007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     06790007
                                                                        06800007
                 DISPLAY '8305-DECLARE-OPEN-LOC-CSR / DECLARE '         06810007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 06820007
                 PERFORM 9998-SQL-ERROR                                 06830007
                                                                        06840007
           END-EVALUATE.                                                06850007
                                                                        06860007
                                                                        06870007
           EXEC SQL                                                     06880007
               OPEN LOC_CSR                                             06890007
           END-EXEC.                                                    06900007
                                                                        06910007
           EVALUATE TRUE                                                06920007
               WHEN SQLCODE = ZERO                                      06930007
                   CONTINUE                                             06940007
               WHEN OTHER                                               06950007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     06960007
                 DISPLAY '8305-DECLARE-OPEN-LOC-CSR / OPEN '            06970007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 06980007
                 PERFORM 9998-SQL-ERROR                                 06990007
                                                                        07000007
           END-EVALUATE.                                                07010007
                                                                        07020007
                                                                        07030007
      ******************************************************************07040007
       8310-PROCESS-LOC-CSR.                                            07050007
      ******************************************************************07060007
                                                                        07070007
           PERFORM 8315-FETCH-LOCS-CSR.                                 07080007
                                                                        07090007
           IF PS-LOC-CSR-AT-END-NO                                      07100007
               PERFORM 8325-LOAD-LOC-ID-TBL                             07110007
           END-IF.                                                      07120007
                                                                        07130007
      ******************************************************************07140007
       8315-FETCH-LOCS-CSR.                                             07150007
      ******************************************************************07160007
                                                                        07170007
           EXEC SQL                                                     07180007
               FETCH LOC_CSR                                            07190007
               INTO :CW-LOC-ID,                                         07200007
                    :LOC-NBR                                            07210007
           END-EXEC.                                                    07220007
                                                                        07230007
           EVALUATE TRUE                                                07240007
             WHEN SQLCODE = ZERO                                        07250007
                 ADD 1 TO PA-LOC-ROWS-IN                                07260007
             WHEN SQLCODE = 1403                                        07270007
                 SET PS-LOC-CSR-AT-END-YES TO TRUE                      07280007
             WHEN OTHER                                                 07290007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     07300007
                 DISPLAY '8315-FETCH-LOCS-CSR    '                      07310007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 07320007
                 PERFORM 9998-SQL-ERROR                                 07330007
                                                                        07340007
           END-EVALUATE.                                                07350007
                                                                        07360007
                                                                        07370007
      ******************************************************************07380007
       8320-CLOSE-LOC-CSR.                                              07390007
      ******************************************************************07400007
                                                                        07410007
           EXEC SQL                                                     07420007
               CLOSE LOC_CSR                                            07430007
           END-EXEC.                                                    07440007
                                                                        07450007
           EVALUATE TRUE                                                07460007
             WHEN SQLCODE = 0                                           07470007
               CONTINUE                                                 07480007
             WHEN OTHER                                                 07490007
                 MOVE SQLCODE TO PV-CNVRTED-SQLCODE                     07500007
                                                                        07510007
                 DISPLAY '8320-CLOSE-LOC-CSR '                          07520007
                 DISPLAY 'SQLCODE: ' PV-CNVRTED-SQLCODE                 07530007
                 PERFORM 9998-SQL-ERROR                                 07540007
                                                                        07550007
           END-EVALUATE.                                                07560007
                                                                        07570007
      ******************************************************************07580007
      *  LOAD WORKING-STORAGE LOCATION-ID TABLE                         07590007
      ******************************************************************07600007
                                                                        07610007
       8325-LOAD-LOC-ID-TBL.                                            07620007
                                                                        07630007
           IF PA-LOC-ROWS-IN < PC-LOC-TBL-MAX OR                        07640007
              PA-LOC-ROWS-IN = PC-LOC-TBL-MAX                           07650007
               MOVE CW-LOC-ID       TO PT-LOC-ID (PA-LOC-ROWS-IN)       07660007
               MOVE LOC-NBR         TO PT-LOC-NBR (PA-LOC-ROWS-IN)      07670007
           ELSE                                                         07680007
             DISPLAY '*********** ABEND ************************'       07690007
             DISPLAY ' TABLE OVERFLOW ON INTERNAL LOC-ID TABLE  '       07700007
             DISPLAY ' INCREASE PC-LOC-TBL-MAX LIMIT '                  07710007
             DISPLAY ' CURRENT LIMIT = ' PC-LOC-TBL-MAX                 07720007
             DISPLAY '******************************************'       07730007
             DISPLAY '  '                                               07740007
             MOVE +4004 TO PV-ABEND-CODE                                07750007
             CALL 'ILBOABN0' USING PV-ABEND-CODE                        07760007
           END-IF.                                                      07770007
                                                                        07780007
                                                                        07790007
                                                                        07800007
      ******************************************************************07810007
       8400-READ-SKU-CURR-PREV-FILE.                                    07820007
      ******************************************************************07830007
                                                                        07840007
           READ SKU-CURR-PREV-ATTR-FILE INTO                            07850007
                                      ML556-CURR-PREV-SKU-ATTR-REC      07860007
              AT END                                                    07870007
                   SET PS-SKU-CURR-PREV-AT-END-YES TO TRUE.             07880007
                                                                        07890007
           IF PS-SKU-CURR-PREV-AT-END-NO                                07900007
               ADD 1 TO PA-SKU-RECS-IN                                  07910007
           END-IF.                                                      07920007
                                                                        07930007
                                                                        07940007
      ******************************************************************07950007
       9000-EOJ.                                                        07960007
      ******************************************************************07970007
                                                                        07980007
           DISPLAY 'PA-LOC-ROWS-IN      ' PA-LOC-ROWS-IN.               07990007
           DISPLAY 'PA-SKU-RECS-IN      ' PA-SKU-RECS-IN.               08000007
           DISPLAY 'PA-SKU-LOC-RECS-OUT '                               08010007
                                       PA-SKU-LOC-RECS-OUT.             08020007
           DISPLAY 'PA-SKU-NO-LOCS-CNT  '                               08030007
                                       PA-SKU-NO-LOCS-CNT.              08040007
           DISPLAY 'PA-SKU-NO-DIM-CNT   '                               08050007
                                       PA-SKU-NO-DIM-CNT.               08060007
           DISPLAY 'PA-LOC-CNVR-ERROR-CNT '                             08070007
                                       PA-LOC-CNVR-ERROR-CNT.           08080007
           DISPLAY 'PA-ERROR-RECS-OUT   ' PA-ERROR-RECS-OUT.            08090007
                                                                        08100007
           CLOSE ORACLE-LOGON-FILE                                      08110007
                 BOM-DATE-CTL                                           08120007
                 SKU-CURR-PREV-ATTR-FILE                                08130007
                 SKU-CURR-PREV-ATTR-UPD-FILE                            08140007
                 ERROR-WARN-FILE.                                       08150007
                                                                        08160007
           EXEC SQL                                                     08170007
               COMMIT WORK RELEASE                                      08180007
           END-EXEC.                                                    08190007
                                                                        08200007
      ******************************************************************08210007
      *9998-SQL-ERROR.                                                  08220007
      ******************************************************************08230007
       9998-SQL-ERROR.                                                  08240007
                                                                        08250007
           DISPLAY '** ABEND **       ** = SQLERROR'.                   08260007
           DISPLAY '** PROGRAM        ** = XMKUT215'.                   08270007
           DISPLAY '** SQLERRM        ** = ' SQLERRM.                   08280007
           DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  08290007
           DISPLAY '** SQLERRD(5)     ** = ' SQLERRD(5).                08300007
                                                                        08310007
                                                                        08320007
           MOVE SPACES TO WS-MSG-TEXT.                                  08330007
                                                                        08340007
           CALL 'SQLGLM' USING WS-MSG-TEXT,                             08350007
                               WS-MAX-SIZE,                             08360007
                               WS-MSG-LENGTH.                           08370007
           DISPLAY 'MESSAGE TEXT      ** = ' WS-MSG-TEXT.               08380007
                                                                        08390007
           SET PV-ABEND-4013 TO TRUE.                                   08400007
                                                                        08410007
           PERFORM 9999-OTHER-ABEND.                                    08420007
                                                                        08430007
      ******************************************************************08440007
      * DO THE NECESSARY PROCESSING TO ABEND FOR MISCELLANEOUS REASONS.*08450007
      ******************************************************************08460007
       9999-OTHER-ABEND.                                                08470007
                                                                        08480007
           DISPLAY '*************************************************'  08490007
           DISPLAY '**  ABEND     **'.                                  08500007
           DISPLAY '**  PROGRAM   **  = ' PC-PGM-NAME.                  08510007
           DISPLAY '************************************************'.  08520007
           CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08530007
                                                                        08540007
                                                                        08550007
