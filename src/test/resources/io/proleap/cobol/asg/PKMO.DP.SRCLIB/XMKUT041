000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400 PROGRAM-ID.      XMKUT041.                                       00040000
000500 AUTHOR.          VLADIMIR FILIPOVIC.                             00050000
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060000
000700 DATE-WRITTEN.    01/13/06.                                       00070000
000800 DATE-COMPILED.                                                   00080000
000900******************************************************************00090000
001000* THIS PROGRAM WILL CREATE THE LOAD FILE FOR DD/FORECAST          00100000
001300* HISTORICAL TABLE.                                               00110000
      *                                                                 00120000
      * 02/20/2006 VLADIMIR FILIPOVIC                                   00130000
      * CHANGED 7200-GET-SKU-IDS TO ISSUE A RETURN CODE OF 4095 IF      00140000
      * NO SKUS WERE FOUND ON XMT_SKU_MDSE_DIM TABLE.                   00150000
      *                                                                 00160000
      * 02/24/2006 LINDA FRIESS                        WR# 28981        00170000
      *    CHANGED TIMESTAMP ON OUTPUT FILE TO BE ALL ZEROES.           00180000
      *                                                                 00190000
C87524*                                                                 00191000
C87524* 01/12/2018 COGNIZANT                           WR# CHG0187524   00192000
C87524*    EXIT IS NOT TERMINATING THE PROGRAM WITHIN THE CURRENT       00193000
C87524*    COMPILED VERSION OF THE PROGRAM.HENCE COMMENTED EXIT.        00194000
C87524*                                                                 00194103
C04126* 07/30/2018 COGNIZANT                           WR# CHG0204126   00194203
C04126*    ORACLE LOGON STANDARDS PROGRAM CHANGE                        00194303
C04126******************************************************************00199203
004200******************************************************************00200000
004300 ENVIRONMENT DIVISION.                                            00210000
004400******************************************************************00220000
004500*                                                                 00230000
004600 CONFIGURATION SECTION.                                           00240000
004700 SOURCE-COMPUTER. IBM-3090.                                       00250000
004800 OBJECT-COMPUTER. IBM-3090.                                       00260000
004900*                                                                 00270000
005000 INPUT-OUTPUT SECTION.                                            00280000
005100 FILE-CONTROL.                                                    00290000
005200                                                                  00300000
005300     SELECT DD-FORECAST-EXTRACT-FILE                              00310000
005400         ASSIGN                       TO INP01.                   00320000
005500                                                                  00330000
005300     SELECT HISTORICAL-FORECAST-FILE                              00340000
005400         ASSIGN                       TO OUT01.                   00350000
005500                                                                  00360000
           SELECT ORACLE-LOGON-FILE                                     00361001
               ASSIGN                       TO ORALOGON.                00362001
                                                                        00363001
008000     EJECT                                                        00370000
008100*                                                                 00380000
008200***************************************************************** 00390000
008300 DATA DIVISION.                                                   00400000
008400***************************************************************** 00410000
008500*                                                                 00420000
008600 FILE SECTION.                                                    00430000
008700*                                                                 00440000
009800 FD  DD-FORECAST-EXTRACT-FILE                                     00450000
009900     RECORDING MODE IS F                                          00460000
010000     BLOCK CONTAINS 0 RECORDS.                                    00470000
010100 01  DD-FORECAST-EXTRACT-RECORD        PIC  X(30).                00480000
008700*                                                                 00490000
009800 FD  HISTORICAL-FORECAST-FILE                                     00500000
009900     RECORDING MODE IS F                                          00510000
010000     BLOCK CONTAINS 0 RECORDS.                                    00520000
010100 01  HISTORICAL-FORECAST-RECORD           PIC  X(59).             00530000
      *                                                                 00531002
       FD  ORACLE-LOGON-FILE                                            00532001
           RECORDING MODE IS F                                          00533001
           LABEL RECORDS ARE STANDARD                                   00534001
           BLOCK CONTAINS 0 RECORDS                                     00535001
           RECORD CONTAINS 80 CHARACTERS                                00536001
           DATA RECORDS IS OL-ORACLE-LOGON-RECORD.                      00537001
       01  OL-ORACLE-LOGON-RECORD      PIC X(80).                       00538001
013700     EJECT                                                        00540000
013800                                                                  00550000
013900 WORKING-STORAGE SECTION.                                         00560000
020300*-----------------------------------------------------------------00570000
020400*    COPYBOOK FOR DD FORECAST EXTRACT INPUT FILE                  00580000
020300*-----------------------------------------------------------------00590000
013800     COPY MRRD016.                                                00600000
013900*                                                                 00610000
020300*-----------------------------------------------------------------00620000
020400*    COPYBOOK FOR HISTORICAL FORECAST OUTPUT FILE                 00630000
020300*-----------------------------------------------------------------00640000
014000     COPY MHRD010.                                                00650000
014100*                                                                 00660000
       01  PV-PROGRAM-VARIABLES.                                        00670000
           05  PV-ORACLE-USERID-LEN         PIC S9(04)  VALUE ZEROS     00671001
                                                        COMP SYNC.      00672001
           05  PV-ORACLE-PASSWORD-LEN       PIC S9(04)  VALUE ZEROS     00673001
                                                        COMP SYNC.      00674001
           05  PV-LOC-SUB                   PIC S9(05)  VALUE +0        00680000
                                                        COMP-3.         00690000
           05  PV-PREV-SKU                  PIC 9(15).                  00700000
           05  PV-NUM-RETRIEVED-SKU-IDS     PIC 9(09)   VALUE 0.        00710000
           05  PV-CURR-DATE                 PIC X(10)   VALUE SPACES.   00720000
           05  PV-PARAGRAPH-NAME            PIC X(30)   VALUE SPACES.   00730000
           05  PV-OPERATION                 PIC X(30)   VALUE SPACES.   00740000
           05  PV-RECORDS-WRITTEN           PIC 9(09)   VALUE 0.        00750000
           05  PV-RECORDS-BYPASSED          PIC 9(09)   VALUE 0.        00760000
                                                                        00770000
       01  PV-ORACLE-BOW-DATE.                                          00780000
           10  PV-BOW-DATE                  PIC X(10).                  00790000
           10  FILLER                       PIC X(01) VALUE '-'.        00800000
           10  FILLER                       PIC X(08) VALUE '00.00.00'. 00810000
                                                                        00820000
       01  PV-DD-FCST-EXTRACT-RECORD.                                   00830000
           05  PV-SKU                          PIC 9(15).               00840000
           05  PV-STORE-NBR                    PIC 9(5).                00850000
           05  PV-DD-FCTR                      PIC 9(6).9.              00860000
           05  PV-FCST-SALES-QTY               PIC 9(6).9.              00870000
                                                                        00880000
033500 01  PC-PROGRAM-CONSTANTS.                                        00890000
           05  PC-AUTO-LOGON               PIC  X(01)   VALUE '/'.      00891001
033600     05  PC-PROGRAM-NAME              PIC X(08)   VALUE           00900000
033700                                                  'XMKUT041'.     00910000
034700     05  PC-1                         PIC S9(3)   VALUE +1        00920000
034800                                                  COMP-3.         00930000
034900*                                                                 00940000
035000 01  PS-PROGRAM-SWITCHES.                                         00950000
006510     05  PS-END-OF-LOGON-FILE-SW      PIC X(01)      VALUE 'N'.   00951001
006530         88  PS-END-OF-LOGON-FILE                    VALUE 'Y'.   00952001
           05  PS-ORA-SRC-CTL-DONE-SW       PIC X(01)      VALUE 'N'.   00953001
               88  PS-ORA-SRC-EMPTY                        VALUE 'Y'.   00954001
035100     05  PS-SLS-FCST-SW               PIC X(01)      VALUE 'N'.   00960000
035200         88  END-OF-SLS-FCST-FILE                    VALUE 'Y'.   00970000
035300         88  NOT-END-SLS-FCST-FILE                   VALUE 'N'.   00980000
035100     05  PS-END-OF-LOC-CSR-SW         PIC X(01)      VALUE 'N'.   00990000
035200         88  END-OF-LOCATION-CSR                     VALUE 'Y'.   01000000
035300         88  NOT-END-OF-LOC-CSR                      VALUE 'N'.   01010000
           05 PS-MISSING-SKUS-SW            PIC X(1)       VALUE 'N'.   01020000
               88  MISSING-SKUS                            VALUE 'Y'.   01030000
                                                                        01040000
       01  CC-ORACLE-CONNECTION.                                        01040201
           05  CC-ORACLE-USERID           PIC X(40).                    01040301
               88 CC-AUTO-LOGON                       VALUE '/'.        01040401
           05  CC-ORACLE-PASSWORD         PIC X(40).                    01040501
                                                                        01041001
020300******************************************************************01050000
020400* WORKING-STORAGE FOR CALENDAR ROUTINE                            01060000
020500******************************************************************01070000
020600     COPY DPWS500.                                                01080000
034900*                                                                 01090000
035700******************************************************************01100000
035800*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01110000
035900******************************************************************01120000
036000     COPY DPWS004.                                                01130000
034900*                                                                 01140000
036100****************************************************************  01150000
036200**ORACLE DECLARE SECTION                                          01160000
036300****************************************************************  01170000
036400     EXEC SQL BEGIN DECLARE SECTION END-EXEC.                     01180000
036500                                                                  01190000
036600 01  USERNAME                    PIC  X(10)  VARYING.             01200000
036700 01  PASSWD                      PIC  X(10)  VARYING.             01210000
036800 01  PV-ORACLE-ID                PIC  X(01)  VALUE '/'.           01220000
037200                                                                  01230000
037900******************************************************************01240000
038000* COBOL DECLARATION FOR TABLE XMT_LOC_DIM                         01250000
038100******************************************************************01260000
038200     EXEC SQL                                                     01270000
038300         INCLUDE XMT00009                                         01280000
038400     END-EXEC.                                                    01290000
037200                                                                  01300000
037900******************************************************************01310000
038000* COBOL DECLARATION FOR TABLE XMT_SKU_MDSE_DIM                    01320000
038100******************************************************************01330000
038200     EXEC SQL                                                     01340000
038300         INCLUDE XMT00010                                         01350000
038400     END-EXEC.                                                    01360000
042000                                                                  01370000
042100     EXEC SQL END DECLARE SECTION END-EXEC.                       01380000
042200     EXEC SQL INCLUDE SQLCACOB    END-EXEC.                       01390000
042300                                                                  01400000
042400******************************************************************01410000
042500*  ERROR PROCESSING VARIABLES                                     01420000
042600******************************************************************01430000
042700                                                                  01440000
042800 01  ABEND-CODE                          PIC S9(04)  VALUE +0     01450000
042900                                                     COMP SYNC.   01460000
                                                                        01470000
042400******************************************************************01480000
042500*  LOC ID CROSS-REFERENCE TABLE                                   01490000
042600******************************************************************01500000
       01  LOCATION-TABLE.                                              01510000
           05  LOC-ENTRY              OCCURS 9999 TIMES.                01520000
               10  LOC-ID                PIC 9(10).                     01530000
      *                                                                 01540000
043000*                                                                 01550000
043100****************************************************************  01560000
043200 PROCEDURE DIVISION.                                              01570000
043300****************************************************************  01580000
043700 0000-PROGRAM-MAINLINE.                                           01590000
043800                                                                  01600000
043900     PERFORM 1000-INITIALIZATION.                                 01610000
044000                                                                  01620000
045500     PERFORM 2000-PROCESS-FILE                                    01630000
045600        UNTIL END-OF-SLS-FCST-FILE.                               01640000
                                                                        01650000
045700     PERFORM 8000-END-ROUTINE.                                    01660000
045900                                                                  01670000
           IF MISSING-SKUS                                              01680000
              MOVE 4095 TO RETURN-CODE.                                 01690000
                                                                        01700000
046000     STOP RUN.                                                    01710000
046100                                                                  01720000
046100                                                                  01730000
046200****************************************************************  01740000
046300* OPENS ALL FILES ASSOCIATED WITH THE JOB,                        01750000
046400* AND LOGS INTO THE ORACLE DATABASE.                              01760000
046600****************************************************************  01770000
046700 1000-INITIALIZATION.                                             01780000
046800*                                                                 01790000
051100     PERFORM 9000-ORACLE-SETUP.                                   01800000
      *                                                                 01810000
           PERFORM 6200-DECLARE-LOC-CURSOR.                             01820000
           PERFORM 6400-OPEN-LOC-CURSOR.                                01830000
      *                                                                 01840000
      *    --- CREATE TABLE FOR CW_LOC_ID CROSS-REFERENCE ---           01850000
           INITIALIZE LOCATION-TABLE.                                   01860000
           PERFORM 1200-POPULATE-LOC-TABLE                              01870000
              UNTIL END-OF-LOCATION-CSR.                                01880000
C87524*    EXIT                                                         01890000
      *                                                                 01900000
           PERFORM 6600-CLOSE-LOC-CURSOR.                               01910000
      *                                                                 01920000
           PERFORM 1500-GET-BOW-DATE.                                   01930000
           MOVE PV-ORACLE-BOW-DATE TO MH010-BOW-DATE.                   01940000
      *                                                                 01950000
           OPEN INPUT  DD-FORECAST-EXTRACT-FILE                         01960000
                OUTPUT HISTORICAL-FORECAST-FILE.                        01970000
      *                                                                 01980000
           PERFORM 6000-READ-DD-FORECAST-RECORD.                        01990000
      *                                                                 02000000
076500****************************************************************  02010000
076600* THIS PARAGRAPH WILL POPULATE THE LOCATION TABLE.                02020000
076700****************************************************************  02030000
       1200-POPULATE-LOC-TABLE.                                         02040000
                                                                        02050000
           PERFORM 7000-FETCH-LOC-CURSOR.                               02060000
                                                                        02070000
           IF NOT-END-OF-LOC-CSR                                        02080000
              MOVE LOC-NBR   IN XMT00009 TO PV-LOC-SUB                  02090000
              MOVE CW-LOC-ID IN XMT00009 TO LOC-ID(PV-LOC-SUB)          02100000
           END-IF.                                                      02110000
                                                                        02120000
                                                                        02130000
052800****************************************************************  02140000
052900*    GET THE BEGINNING OF WEEK DATE                               02150000
053000****************************************************************  02160000
053100 1500-GET-BOW-DATE.                                               02170000
053200                                                                  02180000
045600     ACCEPT PV-CURR-DATE FROM DATE YYYYMMDD.                      02190000
053800                                                                  02200000
054200     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02210000
054300     SET DPG51-FISCAL-JAN-DEC-F2                                  02220000
054400         DPG51-DO-NOT-INCR-DECR-DATE                              02230000
054500         DPG52-LK-DTE-ISO            TO TRUE.                     02240000
054600     MOVE PV-CURR-DATE TO DPG52-LK-DATE-INPUT.                    02250000
054700                                                                  02260000
054800     CALL DP500-KOHLS-CALENDAR-ROUTINE                            02270000
054900         USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.               02280000
055000                                                                  02290000
055100     IF DPG54-SEVERE-ERROR                                        02300000
055200         DISPLAY '** ABEND ** IN XMKUT041'                        02310000
055300         DISPLAY '** PARAGRAPH: 1500-GET-BOW-DATE'                02320000
055500         DISPLAY '** CALENDAR ROUTINE ERROR MESSAGE = '           02330000
055600                     DPG54-ERROR-MESSAGE                          02340000
055700         DISPLAY '** DPG51 = ' DPG51                              02350000
055800         DISPLAY '** DPG52 = ' DPG52                              02360000
055900         DISPLAY '** DPG53 = ' DPG53                              02370000
056000         DISPLAY '** DPG54 = ' DPG54                              02380000
056100         DISPLAY '** DPG55 = ' DPG55                              02390000
056200         DISPLAY '** DPG56 = ' DPG56                              02400000
056300         MOVE +4003 TO ABEND-CODE                                 02410000
056400         CALL 'ILBOABN0' USING ABEND-CODE                         02420000
056500     ELSE                                                         02430000
058000         IF DPG54-WARNING-ERROR                                   02440000
058200             DISPLAY '** WARNING RETURNED BY CALENDAR ROUTINE'    02450000
058400             DISPLAY '** CALLED BY 1500-GET-BOW-DATE'             02460000
058600             DISPLAY '** WARNING MESSAGE = ' DPG54-ERROR-MESSAGE  02470000
058800         END-IF                                                   02480000
058900     END-IF.                                                      02490000
059000                                                                  02500000
059100     MOVE DPG55-1ST-WKDY-DB2ISO-FMT TO PV-BOW-DATE.               02510000
059300                                                                  02520000
059400     DISPLAY SPACES.                                              02530000
059500     DISPLAY '** BEGIN OF WEEK DATE: ' PV-BOW-DATE.               02540000
059600                                                                  02550000
                                                                        02560000
076500****************************************************************  02570000
076600* THIS PARAGRAPH WILL PROCESS THE INPUT FILE.                     02580000
076700****************************************************************  02590000
076800 2000-PROCESS-FILE.                                               02600000
      *                                                                 02610000
           IF NOT-END-SLS-FCST-FILE                                     02620000
      *       ---- ON SKU NBR BREAK, GET SKU ID ----                    02630000
              IF PV-SKU NOT EQUAL PV-PREV-SKU                           02640000
                 PERFORM 7200-GET-SKU-ID                                02650000
                 MOVE PV-SKU TO PV-PREV-SKU                             02660000
              END-IF                                                    02670000
                                                                        02680000
      *       ---- GET LOCATION ID FROM INTERNAL TABLE ----             02690000
              MOVE MR016-STORE-NBR    TO PV-LOC-SUB                     02700000
              MOVE LOC-ID(PV-LOC-SUB) TO MH010-CW-LOC-ID                02710000
                                                                        02720000
      *       --- IF HAVE VALID SKU & LOC ID'S, WRITE RECORD ---        02730000
              IF (MH010-CW-SKU-ID > 0) AND (MH010-CW-LOC-ID > 0)        02740000
                 MOVE PV-DD-FCTR TO MH010-DD-FCTR-NBR                   02750000
                 MOVE PV-FCST-SALES-QTY TO MH010-FCST-SLS-QTY           02760000
                 PERFORM 7500-WRITE-FORECAST-RECORD                     02770000
              ELSE                                                      02780000
                 ADD +1 TO PV-RECORDS-BYPASSED                          02790000
              END-IF                                                    02800000
                                                                        02810000
              PERFORM 6000-READ-DD-FORECAST-RECORD                      02820000
           END-IF.                                                      02830000
                                                                        02840000
108600****************************************************************  02850000
108700*     READ DD-FORECAST EXTRACT FILE                               02860000
108800****************************************************************  02870000
108900 6000-READ-DD-FORECAST-RECORD.                                    02880000
                                                                        02890000
048000     READ DD-FORECAST-EXTRACT-FILE                                02900000
048100        INTO MR016-DD-FCST-EXTRACT-RECORD                         02910000
048200          AT END SET END-OF-SLS-FCST-FILE TO TRUE.                02920000
108500     MOVE MR016-SKU TO PV-SKU.                                    02930000
           MOVE MR016-STORE-NBR TO PV-STORE-NBR.                        02940000
           MOVE MR016-DD-FCTR   TO PV-DD-FCTR.                          02950000
           MOVE MR016-FCST-SALES-QTY TO PV-FCST-SALES-QTY.              02960000
                                                                        02970000
      *----------------------------------------------------------------*02980000
      * DECLARE CURSOR FOR LOCATION TABLE                               02990000
      *----------------------------------------------------------------*03000000
       6200-DECLARE-LOC-CURSOR.                                         03010000
      *                                                                 03020000
           EXEC SQL                                                     03030000
             DECLARE LOCATION_CSR CURSOR FOR                            03040000
               SELECT                                                   03050000
                     LOC_NBR                                            03060000
                    ,CW_LOC_ID                                          03070000
               FROM XMT_LOC_DIM                                         03080000
               WHERE LOC_TYP_CDE = 'DS'                                 03090000
               ORDER BY LOC_NBR ASC                                     03100000
           END-EXEC.                                                    03110000
                                                                        03120000
      *----------------------------------------------------------------*03130000
      * OPEN THE LOCATION_CSR                                           03140000
      *----------------------------------------------------------------*03150000
       6400-OPEN-LOC-CURSOR.                                            03160000
                                                                        03170000
           EXEC SQL                                                     03180000
                 OPEN LOCATION_CSR                                      03190000
           END-EXEC.                                                    03200000
                                                                        03210000
           EVALUATE TRUE                                                03220000
               WHEN SQLCODE = ZERO                                      03230000
                   CONTINUE                                             03240000
               WHEN SQLCODE = 1403                                      03250000
                   SET END-OF-LOCATION-CSR TO TRUE                      03260000
               WHEN OTHER                                               03270000
071700             MOVE '6400-OPEN-LOC-CURSOR' TO PV-PARAGRAPH-NAME     03280000
071900             MOVE 'OPEN CURSOR'          TO PV-OPERATION          03290000
072000             PERFORM 9900-SQL-ERROR                               03300000
           END-EVALUATE.                                                03310000
                                                                        03320000
                                                                        03330000
      *----------------------------------------------------------------*03340000
      * CLOSE THE LOCATION CURSOR                                       03350000
      *----------------------------------------------------------------*03360000
       6600-CLOSE-LOC-CURSOR.                                           03370000
                                                                        03380000
           EXEC SQL                                                     03390000
                CLOSE LOCATION_CSR                                      03400000
           END-EXEC.                                                    03410000
                                                                        03420000
           EVALUATE TRUE                                                03430000
               WHEN SQLCODE = ZERO                                      03440000
                   CONTINUE                                             03450000
               WHEN OTHER                                               03460000
071700             MOVE '6600-CLOSE-LOC-CURSOR' TO PV-PARAGRAPH-NAME    03470000
071900             MOVE 'CLOSE CURSOR'          TO PV-OPERATION         03480000
072000             PERFORM 9900-SQL-ERROR                               03490000
           END-EVALUATE.                                                03500000
                                                                        03510000
                                                                        03520000
079951******************************************************************03530000
079952* FETCH THE LOCATION CURSOR                                       03540000
079953******************************************************************03550000
079954 7000-FETCH-LOC-CURSOR.                                           03560000
079955                                                                  03570000
079956     EXEC SQL                                                     03580000
079957          FETCH LOCATION_CSR                                      03590000
079959          INTO :XMT00009.LOC-NBR                                  03600000
079960              ,:XMT00009.CW-LOC-ID                                03610000
079965     END-EXEC.                                                    03620000
108500                                                                  03630000
           EVALUATE TRUE                                                03640000
               WHEN SQLCODE = ZERO                                      03650000
                   CONTINUE                                             03660000
               WHEN SQLCODE = 1403                                      03670000
                   SET END-OF-LOCATION-CSR TO TRUE                      03680000
               WHEN OTHER                                               03690000
080000             MOVE '7000-FETCH-LOC-CURSOR' TO PV-PARAGRAPH-NAME    03700000
080200             MOVE 'FETCH CURSOR'          TO PV-OPERATION         03710000
080300             PERFORM 9900-SQL-ERROR                               03720000
           END-EVALUATE.                                                03730000
                                                                        03740000
                                                                        03750000
079951******************************************************************03760000
079952*    READ ORACLE TABLE TO GET SKU ID                              03770000
079953******************************************************************03780000
079954 7200-GET-SKU-ID.                                                 03790000
      *                                                                 03800000
097900     EXEC SQL                                                     03810000
098000           SELECT NVL(MAX(CW_SKU_ID),0)                           03820000
098400             INTO :XMT00010.CW-SKU-ID                             03830000
098800             FROM XMT_SKU_MDSE_DIM                                03840000
098900            WHERE SKU_NBR = :PV-SKU                               03850000
099000     END-EXEC.                                                    03860000
099100                                                                  03870000
           EVALUATE TRUE                                                03880000
               WHEN SQLCODE = ZERO                                      03890000
                   IF (CW-SKU-ID = 0)                                   03900000
                      DISPLAY '** SKU ' PV-SKU                          03910000
                              ' NOT FOUND ON XMT_SKU_MDSE_DIM TABLE'    03920000
                      SET MISSING-SKUS TO TRUE                          03930000
                   ELSE                                                 03940000
                      ADD +1 TO PV-NUM-RETRIEVED-SKU-IDS                03950000
                   END-IF                                               03960000
                   MOVE CW-SKU-ID TO MH010-CW-SKU-ID                    03970000
               WHEN SQLCODE = 1403                                      03980000
100400             MOVE ZERO TO MH010-CW-SKU-ID                         03990000
059500             DISPLAY '** SKU ' PV-SKU                             04000000
                           ' NOT FOUND ON XMT_SKU_MDSE_DIM TABLE'       04010000
100300         WHEN SQLCODE = -2112                                     04020000
100400             MOVE ZERO TO MH010-CW-SKU-ID                         04030000
059500             DISPLAY '** SKU ' MR016-SKU                          04040000
                           ' RETURNED MULTIPLE ROWS'                    04050000
100800         WHEN OTHER                                               04060000
100900             MOVE '7200-GET-SKU-ID'   TO PV-PARAGRAPH-NAME        04070000
101100             MOVE 'SELECT FOR SKU ID' TO PV-OPERATION             04080000
                   DISPLAY 'ERROR RETRIEVING SKU ID FOR SKU ' PV-SKU    04090000
101200             PERFORM 9900-SQL-ERROR                               04100000
101300     END-EVALUATE.                                                04110000
079955                                                                  04120000
079951******************************************************************04130000
079952*    WRITE THE CURRENT WEEK SERVICE LEVEL DATA TO A STAGING FILE  04140000
079953******************************************************************04150000
079954 7500-WRITE-FORECAST-RECORD.                                      04160000
221000*                                                                 04170000
           WRITE HISTORICAL-FORECAST-RECORD                             04180000
                FROM MH010-FORECAST-HIST-RECORD.                        04190000
                                                                        04200000
           ADD +1 TO PV-RECORDS-WRITTEN.                                04210000
                                                                        04220000
108600****************************************************************  04230000
108700*     CLOSE FILES, ETC.                                           04240000
108800****************************************************************  04250000
108900 8000-END-ROUTINE.                                                04260000
                                                                        04270000
047000     CLOSE DD-FORECAST-EXTRACT-FILE                               04280000
                 HISTORICAL-FORECAST-FILE.                              04290000
                                                                        04300000
075900     DISPLAY SPACES.                                              04310000
076000     DISPLAY '** NUMBER OF RECORDS WRITTEN:  '                    04320000
076100                                         PV-RECORDS-WRITTEN.      04330000
075800     DISPLAY '** NUMBER OF RECORDS BYPASSED: '                    04340000
                                               PV-RECORDS-BYPASSED.     04350000
                                                                        04360000
075800     DISPLAY '** NUMBER OF SKU IDS RETRIEVED: '                   04370000
                                               PV-NUM-RETRIEVED-SKU-IDS.04380000
                                                                        04390000
      ****************************************************************  04391001
      * CONNECT TO ORACLE.                                              04392001
      ****************************************************************  04393001
       9000-ORACLE-SETUP.                                               04394001
                                                                        04395001
           OPEN INPUT ORACLE-LOGON-FILE.                                04396001
                                                                        04397001
           PERFORM 9100-READ-ORACLE-LOGON.                              04398001
                                                                        04399001
           CLOSE ORACLE-LOGON-FILE.                                     04399101
                                                                        04399201
           IF ((PS-END-OF-LOGON-FILE)                                   04399301
                   OR (CC-ORACLE-CONNECTION = SPACES))                  04399401
               DISPLAY '** ABEND **'                                    04399501
               DISPLAY PC-PROGRAM-NAME ' - ORACLE LOGON CONTROL CARD '  04399601
                         'NOT PROVIDED'                                 04399701
               SET PS-ORA-SRC-EMPTY TO TRUE                             04399801
               CALL 'ILBOABN0' USING ABEND-CODE                         04399901
           END-IF.                                                      04400001
                                                                        04400101
           IF CC-AUTO-LOGON                                             04400201
               DISPLAY PC-PROGRAM-NAME ' - AUTO LOGON TO ORACLE'        04400301
               EXEC SQL                                                 04400401
                    CONNECT :USERNAME                                   04400501
               END-EXEC                                                 04400601
           ELSE                                                         04400701
               INITIALIZE PV-ORACLE-USERID-LEN                          04400801
                          PV-ORACLE-PASSWORD-LEN                        04400901
               INSPECT CC-ORACLE-USERID                                 04401001
                   TALLYING PV-ORACLE-USERID-LEN                        04401101
                FOR CHARACTERS BEFORE INITIAL SPACE                     04401201
            INSPECT CC-ORACLE-PASSWORD                                  04401301
                TALLYING PV-ORACLE-PASSWORD-LEN                         04401401
                FOR CHARACTERS BEFORE INITIAL SPACE                     04401501
            MOVE CC-ORACLE-USERID (1:PV-ORACLE-USERID-LEN) TO           04401601
                      USERNAME-ARR                                      04401701
            MOVE PV-ORACLE-USERID-LEN TO USERNAME-LEN                   04401801
            MOVE CC-ORACLE-PASSWORD (1:PV-ORACLE-PASSWORD-LEN) TO       04401901
                      PASSWD-ARR                                        04402001
            MOVE PV-ORACLE-PASSWORD-LEN TO PASSWD-LEN                   04402101
            DISPLAY PC-PROGRAM-NAME ' - LOGON TO ORACLE AS USER '       04402201
                      USERNAME-ARR                                      04402301
            EXEC SQL                                                    04402401
              CONNECT :USERNAME IDENTIFIED BY :PASSWD                   04402501
            END-EXEC                                                    04402601
            INITIALIZE CC-ORACLE-PASSWORD                               04402701
                       PASSWD                                           04402801
            END-IF.                                                     04402901
                                                                        04403001
020500     IF (SQLCODE NOT = 0)                                         04403101
020900         DISPLAY PV-PARAGRAPH-NAME                                04403201
020910         DISPLAY PC-PROGRAM-NAME ' - ERROR LOGGING ON TO ORACLE'  04403301
               PERFORM 9900-SQL-ERROR                                   04403401
021200     END-IF.                                                      04403501
                                                                        04403601
                                                                        04403701
           EXEC SQL                                                     04403801
            ALTER SESSION                                               04403901
                SET NLS_DATE_FORMAT = 'YYYY-MM-DD-HH24.MI.SS'           04404001
           END-EXEC.                                                    04404101
                                                                        04404201
                                                                        04404301
      ***************************************************************** 04404401
      *  9100-READ-ORACLE-LOGON.                                      * 04404501
      ***************************************************************** 04404601
       9100-READ-ORACLE-LOGON.                                          04404701
                                                                        04404801
034510     READ ORACLE-LOGON-FILE                                       04404901
034520         INTO CC-ORACLE-CONNECTION                                04405001
034530         AT END                                                   04405101
034540             SET PS-END-OF-LOGON-FILE TO TRUE                     04405201
034550     END-READ.                                                    04405301
                                                                        04405401
113900                                                                  04950000
114000******************************************************************04960000
114100*    ABEND ON AN SQL ERROR.                                       04970000
114200******************************************************************04980000
114300 9900-SQL-ERROR.                                                  04990000
114400                                                                  05000000
114500     DISPLAY '*** ABEND ***'.                                     05010000
114600     DISPLAY '** XMKUT041 - SQL ERROR - ORACLE'.                  05020000
114700     DISPLAY '** PROGRAM          ** = ' PC-PROGRAM-NAME.         05030000
114800     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.       05040000
114900     DISPLAY '** OPERATION        ** = ' PV-OPERATION.            05050000
115000                                                                  05060000
115100*    THE FOLLOWING COPYBOOK UTILIZES MODULE DSNTIAR TO FORMAT     05070000
115200*    THE INFO IN SQLCA INTO UNDERSTANDABLE VERBAGE.               05080000
115300     COPY DPPD004.                                                05090000
115400                                                                  05100000
115500     MOVE +4013 TO ABEND-CODE.                                    05110000
115600     CALL 'ILBOABN0' USING ABEND-CODE.                            05120000
115700                                                                  05130000
115800 EJECT                                                            05140000
