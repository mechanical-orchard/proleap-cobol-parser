000500 IDENTIFICATION DIVISION.                                                 
000600 TITLE 'CREATE UPC ID REPLENISHMENT EXTRACT'.                             
000700                                                                          
000710* WR28890 - REPLENISHMENT 2005                                            
000720* WILL BE USED TO RETRIEVE THE UPC ID FOR THE ITEMS                       
000730* EXTRACTED BY PROGRAM SUKUT109                                           
001100                                                                          
001200 PROGRAM-ID.             SUKUT110.                                        
001300 AUTHOR.                 PATRICK BURKE.                                   
001400 INSTALLATION.           KOHLS DEPARTMENT STORES.                         
001500 DATE-WRITTEN            JUNE 2005.                                       
001600 DATE-COMPILED.                                                           
001700                                                                          
001800 ENVIRONMENT DIVISION.                                                    
001900 CONFIGURATION SECTION.                                                   
002000                                                                          
002100 SOURCE-COMPUTER.        IBM-3090.                                        
002200 OBJECT-COMPUTER.        IBM-3090.                                        
002300 INPUT-OUTPUT SECTION.                                                    
002400 FILE-CONTROL.                                                            
002500                                                                          
002600     SELECT STORES-UNLOADED-TRAILERS                                      
002700         ASSIGN TO INP01.                                                 
002800     SELECT REPORT-EXTRACT-FILE                                           
002900         ASSIGN TO OUT01.                                                 
003000                                                                          
003100 DATA DIVISION.                                                           
003200 FILE SECTION.                                                            
003300                                                                          
003400 FD  STORES-UNLOADED-TRAILERS                                             
003500     RECORDING MODE IS F                                                  
003600     LABEL RECORDS ARE STANDARD                                           
003700     BLOCK CONTAINS 0 RECORDS.                                            
003800                                                                          
003900 01  STORES-UNLOADED-TRAILERS-REC     PIC X(040).                         
004000                                                                          
004100 FD  REPORT-EXTRACT-FILE                                                  
004200     RECORDING MODE IS F                                                  
004300     LABEL RECORDS ARE STANDARD                                           
004400     BLOCK CONTAINS 0 RECORDS.                                            
004500                                                                          
004600 01  REPORT-EXTRACT-REC             PIC X(50).                            
004700                                                                          
004800 WORKING-STORAGE SECTION.                                                 
004900                                                                          
005000 01  FILLER.                                                              
005100     05  FILLER                      PIC  X(36)    VALUE                  
005200         ' ***** WORKING STORAGE PGM=SUKUT110 '.                          
005300     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.           
005400     05  FILLER                      PIC  X(10)    VALUE                  
005500         ' LOCATION='.                                                    
005600     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.           
005700     05  FILLER                      PIC  X(06)    VALUE                  
005800         ' *****'.                                                        
005900                                                                          
006000 01  PS-SWITCHES.                                                         
006100     05  PS-EOF-SW                    PIC X(01) VALUE 'N'.                
006200         88  PS-EOF-EXTRACT-YES                 VALUE 'Y'.                
006300         88  PS-EOF-EXTRACT-NO                  VALUE 'N'.                
006600                                                                          
006610     05  PS-WRITE-SU062-SW            PIC X(01) VALUE 'N'.                
006620         88  PS-WRITE-SU062-YES                 VALUE 'Y'.                
006630         88  PS-WRITE-SU062-NO                  VALUE 'N'.                
006640                                                                          
006700 01  PC-CONSTANTS.                                                        
006800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE                  
006900                                                   'SUKUT110'.            
007000     05  PC-ILBOABN0                 PIC  X(08)    VALUE                  
007100                                                   'ILBOABN0'.            
007200     05  PC-MAX-RETRIES              PIC S9(04)    VALUE  +3              
007300                                                   COMP.                  
007400                                                                          
007500 01  PV-MISC-STUFF.                                                       
007600     05  PV-UPC-NBR                   PIC S9(15) COMP.                    
007601     05  PV-PREV-UPC-NBR              PIC S9(15) COMP.                    
007610     05  PV-INTR-UPC-NBR              PIC S9(09) COMP.                    
007700     05  PV-ABEND-PARAGRAPH           PIC  X(30) VALUE SPACES.            
007800     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(60) VALUE SPACE.             
007900     05  PV-SQL-CODE                  PIC  9(04) VALUE ZERO.              
008000     05  PV-ABEND-CODE                PIC S9(04) VALUE ZERO               
008100                                                   COMP SYNC.             
008200     05  PV-RETRY-COUNTER             PIC S9(04) VALUE ZERO               
008300                                                 COMP SYNC.               
008400     05  PV-COMMIT-COUNTER            PIC S9(04) VALUE ZERO               
008500                                                 COMP SYNC.               
008600     05  PV-READ-COUNTER              PIC S9(09) COMP-3                   
008700                                              VALUE ZERO.                 
008710     05  PV-WRITE-1-COUNTER           PIC S9(09) COMP-3                   
008720                                              VALUE ZERO.                 
008730     05  PV-NOT-FOUND-COUNTER         PIC S9(09) COMP-3                   
008740                                              VALUE ZERO.                 
008800     05  PV-TRIP-CNT                  PIC S9(04) COMP-3                   
008900                                              VALUE ZERO.                 
009000     05  PV-NULL-IND-1                PIC S9(04)  VALUE +0  COMP.         
009300     05  PV-BYPASS-COUNT              PIC S9(09) COMP-3                   
009400                                              VALUE ZERO.                 
009500     05  PV-DISP-NBR                  PIC ZZZ,ZZZ,ZZ9.                    
009600     05  PV-ABEND-OPERATION           PIC X(20) VALUE SPACES.             
009700     05  PV-ABEND-STRUCTURE-1         PIC X(20) VALUE SPACES.             
009800                                                                          
009900 01  ABEND-CODE                       PIC S9(04)     VALUE +0             
010000                                                     COMP SYNC.           
010100     88  ABEND-4001-WRITE-ERROR                      VALUE +4001.         
010200     88  ABEND-4002-READ-ERROR                       VALUE +4002.         
010300     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003.         
010400     88  ABEND-4004-TABLE-ERROR                      VALUE +4004.         
010500     88  ABEND-4005-OPEN-ERROR                       VALUE +4005.         
010600     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006.         
010700     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007.         
010800     88  ABEND-4008-DATS-ERROR                       VALUE +4008.         
010900     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009.         
011000     88  ABEND-4013-DB2-ERROR                        VALUE +4013.         
011100                                                                          
011200 01  PV-COUNT-MSG-1.                                                      
011300     05  FILLER                       PIC X(26) VALUE                     
011400         'RECORDS WRITTEN TO OUT01 ='.                                    
011500     05  PV-MSG-1-COUNT               PIC Z,ZZZ,ZZZ,ZZ9.                  
011600                                                                          
011610 01  PV-COUNT-MSG-2.                                                      
011620     05  FILLER                       PIC X(26) VALUE                     
011630         'RECORDS NOT FOUND (+100) ='.                                    
011640     05  PV-MSG-2-COUNT               PIC Z,ZZZ,ZZZ,ZZ9.                  
011650                                                                          
011700 01  PV-COUNT-MSG-4.                                                      
011800     05  FILLER                       PIC X(26) VALUE                     
011900         'RECORDS READ             ='.                                    
012000     05  PV-MSG-READ-COUNT            PIC Z,ZZZ,ZZZ,ZZ9.                  
012100                                                                          
012200 01  CC-CONTROL-CARD.                                                     
012300     05  CC-PROGRAM-NAME              PIC X(08)    VALUE SPACES.          
012400     05  FILLER                       PIC X(72)    VALUE SPACES.          
012500                                                                          
012600*    STORE UNLOADED ITEM REC FILE.                                        
012700     COPY SURD062.                                                        
012800                                                                          
012900*    REPORT EXTRACT FILE                                                  
013000     COPY SURD061.                                                        
013100/                                                                         
014001                                                                          
014010*****************************************************************         
014020*    DB2 AREA FOR XLT_UPC                                       *         
014030*****************************************************************         
014040     EXEC SQL                                                             
014050          INCLUDE XLT00006                                                
014060     END-EXEC.                                                            
014070/                                                                         
014080*****************************************************************         
014100                                                                          
014200     EXEC SQL                                                             
014300         INCLUDE SQLCA                                                    
014400     END-EXEC.                                                            
014500                                                                          
014600     COPY SQLCA2.                                                         
014700                                                                          
014800     COPY DPWS004.                                                        
016300*---------------------------------------------------------------*         
016400 PROCEDURE DIVISION.                                                      
016500                                                                          
016600     PERFORM 1000-INITIALIZATION.                                         
016700                                                                          
016800     PERFORM 2000-PROCESS UNTIL PS-EOF-EXTRACT-YES                        
016900                                                                          
017000     PERFORM 9000-QUIT.                                                   
017100                                                                          
017200     GOBACK.                                                              
017300/                                                                         
017400 1000-INITIALIZATION.                                                     
017500     MOVE '1000-INITIALIZATION         '  TO PV-ABEND-PARAGRAPH.          
017600                                                                          
017700     OPEN INPUT STORES-UNLOADED-TRAILERS                                  
017800     OPEN OUTPUT REPORT-EXTRACT-FILE                                      
017900                                                                          
018000     PERFORM 8000-READ-EXTRACT.                                           
018100                                                                          
018200     IF PS-EOF-EXTRACT-YES                                                
018300         DISPLAY SPACES                                                   
018400         DISPLAY ALL '*'                                                  
018500         DISPLAY '  INPUT FILE IS EMPTY '                                 
018600         DISPLAY ALL '*'                                                  
018700         DISPLAY SPACES                                                   
018800     END-IF.                                                              
018900/                                                                         
019000 2000-PROCESS.                                                            
019100                                                                          
019200     MOVE '2000-PROCESS'                  TO PV-ABEND-PARAGRAPH.          
019300                                                                          
019400     PERFORM 2200-BUILD-EXTRACT-REC.                                      
019900                                                                          
020000     PERFORM 8000-READ-EXTRACT.                                           
020100/                                                                         
020110******************************************************************        
020200 2200-BUILD-EXTRACT-REC.                                                  
020300                                                                          
020400     INITIALIZE SU062-STR-UNLOAD-ITEM-REC.                                
020420                                                                          
020430     IF  SU061-UPC-NBR      =           PV-PREV-UPC-NBR                   
020431         CONTINUE                                                         
020450     ELSE                                                                 
020460         PERFORM 7300-SELECT-XLT-UPC                                      
020480         MOVE SU061-UPC-NBR           TO PV-PREV-UPC-NBR                  
020820     END-IF.                                                              
020821                                                                          
020830     MOVE PV-INTR-UPC-NBR         TO SU062-INTR-UPC-ID.                   
020840     MOVE SU061-DEST-LOC-NBR      TO SU062-DEST-LOC-NBR.                  
020850     MOVE SU061-SHPD-UNT-QTY      TO SU062-SHPD-UNT-QTY.                  
020860     MOVE SU061-STR-UNLOAD-DATE   TO SU062-STR-UNLOAD-DATE.               
020900                                                                          
020901     IF PS-WRITE-SU062-NO                                                 
020902         CONTINUE                                                         
020903     ELSE                                                                 
020910         PERFORM 8200-WRITE-SU062                                         
020920     END-IF.                                                              
020921                                                                          
020930     INITIALIZE PS-WRITE-SU062-SW.                                        
021000/                                                                         
024600******************************************************************        
024700*  SELECT INTERNAL UPC ID FROM XLT UPC                                    
024800******************************************************************        
024900 7300-SELECT-XLT-UPC.                                                     
025070                                                                          
025071      INITIALIZE DCLXLT00006.                                             
025072                                                                          
025073*     MOVE SU061-UPC-NBR      TO   PV-UPC-NBR.                            
025074                                                                          
025080      EXEC SQL                                                            
025100         SELECT  A.INTR_UPC_ID                                            
025500           INTO :XLT00006-INTR-UPC-ID                                     
025510           FROM  XLT_UPC A                                                
025600          WHERE  A.UPC_NBR       = :SU061-UPC-NBR                         
025700      WITH UR                                                             
025701      END-EXEC                                                            
025710                                                                          
025800        EVALUATE TRUE                                                     
025900            WHEN SQLCODE = ZERO                                           
026000                MOVE XLT00006-INTR-UPC-ID  TO PV-INTR-UPC-NBR             
026100                SET PS-WRITE-SU062-YES     TO TRUE                        
026300            WHEN SQLCODE = +100                                           
026310                ADD 1                   TO PV-NOT-FOUND-COUNTER           
026320                SET PS-WRITE-SU062-NO   TO TRUE                           
026500            WHEN SQLWARN0 NOT = SPACES                                    
026600            WHEN SQLCODE < ZERO                                           
026700            WHEN SQLCODE > ZERO                                           
026800                MOVE '7300-SELECT-XLT-UPC'  TO PV-ABEND-PARAGRAPH         
026900                MOVE 'SELECT INTERNAL UPC ID'                             
027000                                    TO PV-DB2-OPERATION-ATTEMPTED         
027100                PERFORM 9100-SQL-ABEND                                    
027200         END-EVALUATE.                                                    
028000/                                                                         
029600******************************************************************        
033300/                                                                         
033400 8000-READ-EXTRACT.                                                       
033500                                                                          
033600     MOVE '8000-READ-EXTRACT   '  TO PV-ABEND-PARAGRAPH.                  
033700*                                                                         
033800     READ STORES-UNLOADED-TRAILERS                                        
033900         INTO                                                             
034000             SU061-STR-UNLOAD-ITEM-REC                                    
034100         AT END                                                           
034200             SET PS-EOF-EXTRACT-YES   TO TRUE                             
034300         NOT AT END                                                       
034400             ADD 1                    TO PV-READ-COUNTER                  
034500                                         PV-COMMIT-COUNTER                
034700     END-READ.                                                            
034800                                                                          
034900 8200-WRITE-SU062.                                                        
035000     MOVE '8200-WRITE-SU062    '  TO PV-ABEND-PARAGRAPH.                  
035100     WRITE                                                                
035200         REPORT-EXTRACT-REC                                               
035300         FROM SU062-STR-UNLOAD-ITEM-REC                                   
035400     END-WRITE.                                                           
035500     ADD 1                            TO PV-WRITE-1-COUNTER.              
035600/                                                                         
035700 9000-QUIT.                                                               
035800                                                                          
035900     CLOSE STORES-UNLOADED-TRAILERS                                       
036000           REPORT-EXTRACT-FILE                                            
036100                                                                          
036200     MOVE PV-READ-COUNTER             TO PV-MSG-READ-COUNT                
036300     DISPLAY PV-COUNT-MSG-4.                                              
036400                                                                          
036500     MOVE PV-WRITE-1-COUNTER          TO PV-MSG-1-COUNT                   
036600     DISPLAY PV-COUNT-MSG-1.                                              
036700                                                                          
036710     MOVE PV-NOT-FOUND-COUNTER        TO PV-MSG-2-COUNT                   
036720     DISPLAY PV-COUNT-MSG-2.                                              
036730                                                                          
036800/                                                                         
036900 9100-SQL-ABEND.                                                          
037000******************************************************************        
037100*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL            
037200*  ERROR OR WARNING CODE OCCURS.                                          
037300******************************************************************        
037400     DISPLAY '9100-SQL-ABEND'.                                            
037500     DISPLAY '** ABEND     **'.                                           
037600     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.                
037700     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.                     
037800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.             
037900     DISPLAY '**              ** = '                                      
038000     MOVE SQLCODE TO PV-SQL-CODE.                                         
038100     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                            
038200     MOVE +4013 TO PV-ABEND-CODE.                                         
038300     CALL 'ILBOABN0' USING PV-ABEND-CODE.                                 
038400                                                                          
